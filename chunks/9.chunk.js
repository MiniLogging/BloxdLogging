"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11713:(w,p,e)=>{e.d(p,{c:()=>a,e:()=>c,i:()=>s,k:()=>m,l:()=>y,n:()=>K,r:()=>J});var r=e(11023),I=e(11308),d=e(11063),f=e(11038),q=e(11716),E=e(11331),j=e(11491),X=e(11099),k=e(11301);const m=Object.freeze(new r.c(0,0,0,0)),J=Object.freeze(r.k.Zero()),K=Object.freeze(r.g.Zero()),y=Object.freeze(j.c.Zero()),c=Object.freeze(I.b.Black()),s=Object.freeze(new I.e(0,0,0,0)),O={key:0,repeatCount:0,loopMode:2};class a{static _PrepareAnimation(w,p,e,d,f,q,E,X){let k;if(!isNaN(parseFloat(f))&&isFinite(f)?k=a.ANIMATIONTYPE_FLOAT:f instanceof r.c?k=a.ANIMATIONTYPE_QUATERNION:f instanceof r.k?k=a.ANIMATIONTYPE_VECTOR3:f instanceof r.g?k=a.ANIMATIONTYPE_VECTOR2:f instanceof I.b?k=a.ANIMATIONTYPE_COLOR3:f instanceof I.e?k=a.ANIMATIONTYPE_COLOR4:f instanceof j.c&&(k=a.ANIMATIONTYPE_SIZE),void 0==k)return null;const m=new a(w,p,e,k,E),J=[{frame:0,value:f},{frame:d,value:q}];return m.setKeys(J),void 0!==X&&m.setEasingFunction(X),m}static CreateAnimation(w,p,e,r){const I=new a(w+"Animation",w,e,p,a.ANIMATIONLOOPMODE_CONSTANT);return I.setEasingFunction(r),I}static CreateAndStartAnimation(w,p,e,r,I,d,f,q,E,j,X){const k=a._PrepareAnimation(w,e,r,I,d,f,q,E);return k?(p.iw&&(X=p.iw()),X?X.beginDirectAnimation(p,[k],0,I,k.loopMode!==a.ANIMATIONLOOPMODE_CONSTANT,1,j):null):null}static CreateAndStartHierarchyAnimation(w,p,e,r,I,d,f,q,E,j,X){const k=a._PrepareAnimation(w,r,I,d,f,q,E,j);if(!k)return null;return p.iw().beginDirectHierarchyAnimation(p,e,[k],0,d,1===k.loopMode,1,X)}static CreateMergeAndStartAnimation(w,p,e,r,I,d,f,q,E,j){const X=a._PrepareAnimation(w,e,r,I,d,f,q,E);return X?(p.animations.push(X),p.iw().beginAnimation(p,0,I,1===X.loopMode,1,j)):null}static MakeAnimationAdditive(w,p,e){let I;I="object"===typeof p?p:{referenceFrame:p??0,range:e,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let d=w;if(I.cloneOriginalAnimation&&(d=w.clone(),d.name=I.clonedAnimationName||d.name),!d._keys.length)return d;const f=I.referenceFrame&&I.referenceFrame>=0?I.referenceFrame:0;let q=0;const E=d._keys[0];let j=d._keys.length-1;const X=d._keys[j],k={referenceValue:E.value,referencePosition:r.d.ne[0],referenceQuaternion:r.d.Quaternion[0],referenceScaling:r.d.ne[1],keyPosition:r.d.ne[2],keyQuaternion:r.d.Quaternion[1],keyScaling:r.d.ne[3]};let m=E.frame,J=X.frame;if(I.range){const w=d.getRange(I.range);w&&(m=w.from,J=w.to)}else m=I.fromFrame??m,J=I.toFrame??J;if(m!==E.frame&&(q=d.createKeyForFrame(m)),J!==X.frame&&(j=d.createKeyForFrame(J)),1===d._keys.length){const w=d._getKeyValue(d._keys[0]);k.referenceValue=w.clone?w.clone():w}else if(f<=E.frame){const w=d._getKeyValue(E.value);k.referenceValue=w.clone?w.clone():w}else if(f>=X.frame){const w=d._getKeyValue(X.value);k.referenceValue=w.clone?w.clone():w}else{O.key=0;const w=d._interpolate(f,O);k.referenceValue=w.clone?w.clone():w}d.dataType===a.ANIMATIONTYPE_QUATERNION?k.referenceValue.normalize().conjugateInPlace():d.dataType===a.ANIMATIONTYPE_MATRIX&&(k.referenceValue.decompose(k.referenceScaling,k.referenceQuaternion,k.referencePosition),k.referenceQuaternion.normalize().conjugateInPlace());let K=Number.MAX_VALUE;const y=I.clipKeys?[]:null;for(let c=q;c<=j;c++){let w=d._keys[c];if((y||I.cloneOriginalAnimation)&&(w={frame:w.frame,value:w.value.clone?w.value.clone():w.value,inTangent:w.inTangent,outTangent:w.outTangent,interpolation:w.interpolation,lockedTangent:w.lockedTangent},y&&(K===Number.MAX_VALUE&&(K=w.frame),w.frame-=K,y.push(w))),!c||d.dataType===a.ANIMATIONTYPE_FLOAT||w.value!==E.value)switch(d.dataType){case a.ANIMATIONTYPE_MATRIX:w.value.decompose(k.keyScaling,k.keyQuaternion,k.keyPosition),k.keyPosition.zk(k.referencePosition),k.keyScaling.divideInPlace(k.referenceScaling),k.referenceQuaternion.multiplyToRef(k.keyQuaternion,k.keyQuaternion),r.b.ComposeToRef(k.keyScaling,k.keyQuaternion,k.keyPosition,w.value);break;case a.ANIMATIONTYPE_QUATERNION:k.referenceValue.multiplyToRef(w.value,w.value);break;case a.ANIMATIONTYPE_VECTOR2:case a.ANIMATIONTYPE_VECTOR3:case a.ANIMATIONTYPE_COLOR3:case a.ANIMATIONTYPE_COLOR4:w.value.subtractToRef(k.referenceValue,w.value);break;case a.ANIMATIONTYPE_SIZE:w.value.width-=k.referenceValue.width,w.value.height-=k.referenceValue.height;break;default:w.value-=k.referenceValue}}return y&&d.setKeys(y,!0),d}static TransitionTo(w,p,e,r,I,d,f){let q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(f<=0)return e[w]=p,q&&q(),null;const E=I*(f/1e3);d.setKeys([{frame:0,value:e[w].clone?e[w].clone():e[w]},{frame:E,value:p}]),e.animations||(e.animations=[]),e.animations.push(d);const j=r.beginAnimation(e,0,E,!1);return j.onAnimationEnd=q,j}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const w of this._runtimeAnimations)if(!w.isStopped())return!0;return!1}constructor(w,p,e,r,I,d){this.name=w,this.targetProperty=p,this.framePerSecond=e,this.dataType=r,this.loopMode=I,this.enableBlending=d,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=p.split("."),this.dataType=r,this.loopMode=void 0===I?a.ANIMATIONLOOPMODE_CYCLE:I,this.uniqueId=a._UniqueIdGenerator++}toString(w){let p="Name: "+this.name+", property: "+this.targetProperty;if(p+=", datatype: "+["Float","ne","Quaternion","Matrix","pd","Vector2"][this.dataType],p+=", nKeys: "+(this._keys?this._keys.length:"none"),p+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),w){p+=", Ranges: {";let w=!0;for(const e in this._ranges)w&&(p+=", ",w=!1),p+=e;p+="}"}return p}addEvent(w){this._events.push(w),this._events.sort(((w,p)=>w.frame-p.frame))}removeEvents(w){for(let p=0;p<this._events.length;p++)this._events[p].frame===w&&(this._events.splice(p,1),p--)}getEvents(){return this._events}createRange(w,p,e){this._ranges[w]||(this._ranges[w]=new q.c(w,p,e))}deleteRange(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this._ranges[w];if(e){if(p){const w=e.from,p=e.to;for(let e=this._keys.length-1;e>=0;e--)this._keys[e].frame>=w&&this._keys[e].frame<=p&&this._keys.splice(e,1)}this._ranges[w]=null}}getRange(w){return this._ranges[w]}getKeys(){return this._keys}getHighestFrame(){let w=0;for(let p=0,e=this._keys.length;p<e;p++)w<this._keys[p].frame&&(w=this._keys[p].frame);return w}getEasingFunction(){return this._easingFunction}setEasingFunction(w){this._easingFunction=w}floatInterpolateFunction(w,p,e){return(0,d.Lerp)(w,p,e)}floatInterpolateFunctionWithTangents(w,p,e,r,I){return(0,d.Hermite)(w,p,e,r,I)}quaternionInterpolateFunction(w,p,e){return r.c.Slerp(w,p,e)}quaternionInterpolateFunctionWithTangents(w,p,e,I,d){return r.c.Hermite(w,p,e,I,d).normalize()}vector3InterpolateFunction(w,p,e){return r.k.Lerp(w,p,e)}vector3InterpolateFunctionWithTangents(w,p,e,I,d){return r.k.Hermite(w,p,e,I,d)}vector2InterpolateFunction(w,p,e){return r.g.Lerp(w,p,e)}vector2InterpolateFunctionWithTangents(w,p,e,I,d){return r.g.Hermite(w,p,e,I,d)}sizeInterpolateFunction(w,p,e){return j.c.Lerp(w,p,e)}color3InterpolateFunction(w,p,e){return I.b.Lerp(w,p,e)}color3InterpolateFunctionWithTangents(w,p,e,r,d){return I.b.Hermite(w,p,e,r,d)}color4InterpolateFunction(w,p,e){return I.e.Lerp(w,p,e)}color4InterpolateFunctionWithTangents(w,p,e,r,d){return I.e.Hermite(w,p,e,r,d)}_getKeyValue(w){return"function"===typeof w?w():w}evaluate(w){return O.key=0,this._interpolate(w,O)}_interpolate(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(p.loopMode===a.ANIMATIONLOOPMODE_CONSTANT&&p.repeatCount>0)return p.highLimitValue.clone?p.highLimitValue.clone():p.highLimitValue;const r=this._keys;let I;if(this._coreAnimation)I=this._coreAnimation._key;else{const d=r.length;for(I=p.key;I>=0&&w<r[I].frame;)--I;for(;I+1<=d-1&&w>=r[I+1].frame;)++I;if(p.key=I,I<0)return e?void 0:this._getKeyValue(r[0].value);if(I+1>d-1)return e?void 0:this._getKeyValue(r[d-1].value);this._key=I}const d=r[I],f=r[I+1];if(e&&(w===d.frame||w===f.frame))return;const q=this._getKeyValue(d.value),E=this._getKeyValue(f.value);if(1===d.interpolation)return f.frame>w?q:E;const j=void 0!==d.outTangent&&void 0!==f.inTangent,X=f.frame-d.frame;let k=(w-d.frame)/X;const O=d.easingFunction||this.getEasingFunction();switch(O&&(k=O.ease(k)),this.dataType){case a.ANIMATIONTYPE_FLOAT:{const w=j?this.floatInterpolateFunctionWithTangents(q,d.outTangent*X,E,f.inTangent*X,k):this.floatInterpolateFunction(q,E,k);switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return w;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(p.offsetValue??0)*p.repeatCount+w}break}case a.ANIMATIONTYPE_QUATERNION:{const w=j?this.quaternionInterpolateFunctionWithTangents(q,d.outTangent.scale(X),E,f.inTangent.scale(X),k):this.quaternionInterpolateFunction(q,E,k);switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return w;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return w.addInPlace((p.offsetValue||m).scale(p.repeatCount))}return w}case a.ANIMATIONTYPE_VECTOR3:{const w=j?this.vector3InterpolateFunctionWithTangents(q,d.outTangent.scale(X),E,f.inTangent.scale(X),k):this.vector3InterpolateFunction(q,E,k);switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return w;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return w.add((p.offsetValue||J).scale(p.repeatCount))}break}case a.ANIMATIONTYPE_VECTOR2:{const w=j?this.vector2InterpolateFunctionWithTangents(q,d.outTangent.scale(X),E,f.inTangent.scale(X),k):this.vector2InterpolateFunction(q,E,k);switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return w;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return w.add((p.offsetValue||K).scale(p.repeatCount))}break}case a.ANIMATIONTYPE_SIZE:switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(q,E,k);case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(q,E,k).add((p.offsetValue||y).scale(p.repeatCount))}break;case a.ANIMATIONTYPE_COLOR3:{const w=j?this.color3InterpolateFunctionWithTangents(q,d.outTangent.scale(X),E,f.inTangent.scale(X),k):this.color3InterpolateFunction(q,E,k);switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return w;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return w.add((p.offsetValue||c).scale(p.repeatCount))}break}case a.ANIMATIONTYPE_COLOR4:{const w=j?this.color4InterpolateFunctionWithTangents(q,d.outTangent.scale(X),E,f.inTangent.scale(X),k):this.color4InterpolateFunction(q,E,k);switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return w;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return w.add((p.offsetValue||s).scale(p.repeatCount))}break}case a.ANIMATIONTYPE_MATRIX:switch(p.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:case a.ANIMATIONLOOPMODE_YOYO:return a.AllowMatricesInterpolation?this.matrixInterpolateFunction(q,E,k,p.workValue):q;case a.ANIMATIONLOOPMODE_RELATIVE:case a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q}}return 0}matrixInterpolateFunction(w,p,e,I){return a.AllowMatrixDecomposeForInterpolation?I?(r.b.DecomposeLerpToRef(w,p,e,I),I):r.b.DecomposeLerp(w,p,e):I?(r.b.LerpToRef(w,p,e,I),I):r.b.Lerp(w,p,e)}clone(){const w=new a(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(w.enableBlending=this.enableBlending,w.blendingSpeed=this.blendingSpeed,this._keys&&w.setKeys(this._keys),this._ranges){w._ranges={};for(const p in this._ranges){const e=this._ranges[p];e&&(w._ranges[p]=e.clone())}}return w}setKeys(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=p?w:w.slice(0)}createKeyForFrame(w){O.key=0;const p=this._interpolate(w,O,!0);if(!p)return this._keys[O.key].frame===w?O.key:O.key+1;const e={frame:w,value:p.clone?p.clone():p};return this._keys.splice(O.key+1,0,e),O.key+1}serialize(){const w={};w.name=this.name,w.property=this.targetProperty,w.framePerSecond=this.framePerSecond,w.dataType=this.dataType,w.loopBehavior=this.loopMode,w.enableBlending=this.enableBlending,w.blendingSpeed=this.blendingSpeed;const p=this.dataType;w.keys=[];const e=this.getKeys();for(let r=0;r<e.length;r++){const I=e[r],d={};switch(d.frame=I.frame,p){case a.ANIMATIONTYPE_FLOAT:d.values=[I.value],void 0!==I.inTangent&&d.values.push(I.inTangent),void 0!==I.outTangent&&(void 0===I.inTangent&&d.values.push(void 0),d.values.push(I.outTangent)),void 0!==I.interpolation&&(void 0===I.inTangent&&d.values.push(void 0),void 0===I.outTangent&&d.values.push(void 0),d.values.push(I.interpolation));break;case a.ANIMATIONTYPE_QUATERNION:case a.ANIMATIONTYPE_MATRIX:case a.ANIMATIONTYPE_VECTOR3:case a.ANIMATIONTYPE_COLOR3:case a.ANIMATIONTYPE_COLOR4:d.values=I.value.ze(),void 0!=I.inTangent&&d.values.push(I.inTangent.ze()),void 0!=I.outTangent&&(void 0===I.inTangent&&d.values.push(void 0),d.values.push(I.outTangent.ze())),void 0!==I.interpolation&&(void 0===I.inTangent&&d.values.push(void 0),void 0===I.outTangent&&d.values.push(void 0),d.values.push(I.interpolation))}w.keys.push(d)}w.ranges=[];for(const r in this._ranges){const p=this._ranges[r];if(!p)continue;const e={};e.name=r,e.from=p.from,e.to=p.to,w.ranges.push(e)}return w}static _UniversalLerp(w,p,e){const r=w.constructor;return r.Lerp?r.Lerp(w,p,e):r.Slerp?r.Slerp(w,p,e):w.toFixed?w*(1-e)+e*p:p}static Parse(w){const p=new a(w.name,w.property,w.framePerSecond,w.dataType,w.loopBehavior),e=w.dataType,d=[];let f,q;for(w.enableBlending&&(p.enableBlending=w.enableBlending),w.blendingSpeed&&(p.blendingSpeed=w.blendingSpeed),q=0;q<w.keys.length;q++){const p=w.keys[q];let E,j,X;switch(e){case a.ANIMATIONTYPE_FLOAT:f=p.values[0],p.values.length>=2&&(E=p.values[1]),p.values.length>=3&&(j=p.values[2]),p.values.length>=4&&(X=p.values[3]);break;case a.ANIMATIONTYPE_QUATERNION:if(f=r.c.Ve(p.values),p.values.length>=8){const w=r.c.Ve(p.values.slice(4,8));w.equals(r.c.Zero())||(E=w)}if(p.values.length>=12){const w=r.c.Ve(p.values.slice(8,12));w.equals(r.c.Zero())||(j=w)}p.values.length>=13&&(X=p.values[12]);break;case a.ANIMATIONTYPE_MATRIX:f=r.b.Ve(p.values),p.values.length>=17&&(X=p.values[16]);break;case a.ANIMATIONTYPE_COLOR3:f=I.b.Ve(p.values),p.values[3]&&(E=I.b.Ve(p.values[3])),p.values[4]&&(j=I.b.Ve(p.values[4])),p.values[5]&&(X=p.values[5]);break;case a.ANIMATIONTYPE_COLOR4:f=I.e.Ve(p.values),p.values[4]&&(E=I.e.Ve(p.values[4])),p.values[5]&&(j=I.e.Ve(p.values[5])),p.values[6]&&(X=I.e.Ve(p.values[6]));break;case a.ANIMATIONTYPE_VECTOR3:default:f=r.k.Ve(p.values),p.values[3]&&(E=r.k.Ve(p.values[3])),p.values[4]&&(j=r.k.Ve(p.values[4])),p.values[5]&&(X=p.values[5])}const k={};k.frame=p.frame,k.value=f,void 0!=E&&(k.inTangent=E),void 0!=j&&(k.outTangent=j),void 0!=X&&(k.interpolation=X),d.push(k)}if(p.setKeys(d),w.ranges)for(q=0;q<w.ranges.length;q++)f=w.ranges[q],p.createRange(f.name,f.from,f.to);return p}static AppendSerializedAnimations(w,p){k.e.AppendSerializedAnimations(w,p)}static async ParseFromFileAsync(w,p){return await new Promise(((e,r)=>{const I=new X.b;I.addEventListener("readystatechange",(()=>{if(4==I.readyState)if(200==I.status){let p=JSON.parse(I.responseText);if(p.animations&&(p=p.animations),p.length){const w=[];for(const e of p)w.push(this.Parse(e));e(w)}else{const r=this.Parse(p);w&&(r.name=w),e(r)}}else r("Unable to load the animation")})),I.open("GET",p),I.send()}))}static async ParseFromSnippetAsync(w){return await new Promise(((p,e)=>{const r=new X.b;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const e=JSON.parse(JSON.parse(r.responseText).jsonPayload);if(e.animations){const r=JSON.parse(e.animations),I=[];for(const p of r.animations){const e=this.Parse(p);e.snippetId=w,I.push(e)}p(I)}else{const r=JSON.parse(e.animation),I=this.Parse(r);I.snippetId=w,p(I)}}else e("Unable to load the snippet "+w)})),r.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),r.send()}))}}a._UniqueIdGenerator=0,a.AllowMatricesInterpolation=!1,a.AllowMatrixDecomposeForInterpolation=!0,a.SnippetUrl="https://snippet.babylonjs.com",a.ANIMATIONTYPE_FLOAT=0,a.ANIMATIONTYPE_VECTOR3=1,a.ANIMATIONTYPE_QUATERNION=2,a.ANIMATIONTYPE_MATRIX=3,a.ANIMATIONTYPE_COLOR3=4,a.ANIMATIONTYPE_COLOR4=7,a.ANIMATIONTYPE_VECTOR2=5,a.ANIMATIONTYPE_SIZE=6,a.ANIMATIONLOOPMODE_RELATIVE=0,a.ANIMATIONLOOPMODE_CYCLE=1,a.ANIMATIONLOOPMODE_CONSTANT=2,a.ANIMATIONLOOPMODE_YOYO=4,a.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,a.CreateFromSnippetAsync=a.ParseFromSnippetAsync,(0,f.d)("BABYLON.Animation",a),E.b._AnimationRangeFactory=(w,p,e)=>new q.c(w,p,e)},11716:(w,p,e)=>{e.d(p,{c:()=>r});class r{constructor(w,p,e){this.name=w,this.from=p,this.to=e}clone(){return new r(this.name,this.from,this.to)}}},11232:(w,p,e)=>{e.d(p,{b:()=>f,e:()=>q});var r=e(11240),I=e(11081),d=e(11247);class f{get K(){return this._isDisposed}constructor(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,w&&w.iw?this._engine=w.iw().getEngine():this._engine=w,this._updatable=e,this._instanced=f,this._divisor=E||1,this._label=j,p instanceof r.e?(this._data=null,this._buffer=p):(this._data=p,this._buffer=null),this.byteStride=q?I:I*Float32Array.BYTES_PER_ELEMENT,d||this.create()}createVertexBuffer(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const E=d?p:p*Float32Array.BYTES_PER_ELEMENT,j=r?d?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new q(this._engine,this,w,this._updatable,!0,j,void 0===I?this._instanced:I,E,e,void 0,void 0,!0,this._divisor||f)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!w&&this._buffer||(w=w||this._data,w&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w),this._data=w):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(w,this._label),this._data=w):this._buffer=this._engine.createVertexBuffer(w,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.eq>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.eq,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.eq,void 0,this._label));I.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(w){this.create(w)}updateDirectly(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w,r?p:p*Float32Array.BYTES_PER_ELEMENT,e?e*this.byteStride:void 0),this._data=0===p&&void 0===e?w:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class q{get K(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(w){const p=0!=w;this._instanceDivisor=w,p!==this._instanced&&(this._instanced=p,this._computeHashCode())}get _maxVerticesCount(){const w=this.getData();return w?Array.isArray(w)?w.length/(this.byteStride/4)-this.byteOffset/4:(w.byteLength-this.byteOffset)/this.byteStride:0}constructor(w,p,e,r,I,E,j,X,k,m){let J=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]&&arguments[11],y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,c=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let s=!1;if(this.wE=w,"object"===typeof r&&null!==r?(s=r.updatable??!1,I=r.postponeInternalCreation,E=r.stride,j=r.instanced,X=r.offset,k=r.size,m=r.type,J=r.normalized??!1,K=r.useBytes??!1,y=r.divisor??1,c=r.takeBufferOwnership??!1,this._label=r.label):s=!!r,p instanceof f?(this._buffer=p,this._ownsBuffer=c):(this._buffer=new f(w,p,s,E,I,j,K,y,this._label),this._ownsBuffer=!0),this.uniqueId=q._Counter++,this._kind=e,void 0===m){const w=this.getData();this.type=w?q.GetDataType(w):q.FLOAT}else this.type=m;const O=(0,d.i)(this.type);K?(this._size=k||(E?E/O:q.DeduceStride(e)),this.byteStride=E||this._buffer.byteStride||this._size*O,this.byteOffset=X||0):(this._size=k||E||q.DeduceStride(e),this.byteStride=E?E*O:this._buffer.byteStride||this._size*O,this.byteOffset=(X||0)*O),this.normalized=J,this._instanced=void 0!==j&&j,this._instanceDivisor=j?y:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var w;null===(w=this._buffer)||void 0===w||w._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(w,p){const e=this.getData();return e?(0,d.f)(e,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,w,p):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,d.i)(this.type)}getOffset(){return this.byteOffset/(0,d.i)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,d.i)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(w){this._buffer.create(w),this._alignBuffer()}update(w){this._buffer.update(w),this._alignBuffer()}updateDirectly(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(w,p,void 0,e),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(w,p){(0,d.e)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,w,this.normalized,((w,e)=>{for(let r=0;r<this._size;r++)p(w[r],e+r)}))}_alignBuffer(){}static DeduceStride(w){switch(w){case q.UVKind:case q.UV2Kind:case q.UV3Kind:case q.UV4Kind:case q.UV5Kind:case q.UV6Kind:return 2;case q.NormalKind:case q.PositionKind:return 3;case q.ColorKind:case q.ColorInstanceKind:case q.MatricesIndicesKind:case q.MatricesIndicesExtraKind:case q.MatricesWeightsKind:case q.MatricesWeightsExtraKind:case q.TangentKind:return 4;default:throw new Error("Invalid kind '"+w+"'")}}static GetDataType(w){return w instanceof Int8Array?q.BYTE:w instanceof Uint8Array?q.UNSIGNED_BYTE:w instanceof Int16Array?q.SHORT:w instanceof Uint16Array?q.UNSIGNED_SHORT:w instanceof Int32Array?q.INT:w instanceof Uint32Array?q.UNSIGNED_INT:q.FLOAT}static GetTypeByteLength(w){return(0,d.i)(w)}static ForEach(w,p,e,r,I,f,q,E){(0,d.e)(w,p,e,r,I,f,q,((w,p)=>{for(let e=0;e<r;e++)E(w[e],p+e)}))}static GetFloatData(w,p,e,r,I,f,q,E){return(0,d.f)(w,p,e,r,I,f,q,E)}}q._Counter=0,q.BYTE=5120,q.UNSIGNED_BYTE=5121,q.SHORT=5122,q.UNSIGNED_SHORT=5123,q.INT=5124,q.UNSIGNED_INT=5125,q.FLOAT=5126,q.PositionKind="position",q.NormalKind="normal",q.TangentKind="tangent",q.UVKind="uv",q.UV2Kind="uv2",q.UV3Kind="uv3",q.UV4Kind="uv4",q.UV5Kind="uv5",q.UV6Kind="uv6",q.ColorKind="color",q.ColorInstanceKind="instanceColor",q.MatricesIndicesKind="matricesIndices",q.MatricesWeightsKind="matricesWeights",q.MatricesIndicesExtraKind="matricesIndicesExtra",q.MatricesWeightsExtraKind="matricesWeightsExtra"},11247:(w,p,e)=>{e.d(p,{c:()=>m,d:()=>k,e:()=>E,f:()=>j,i:()=>f,m:()=>q,q:()=>X});var r=e(11081);function I(w,p,e,r){switch(p){case 5120:{let p=w.getInt8(e);return r&&(p=Math.max(p/127,-1)),p}case 5121:{let p=w.getUint8(e);return r&&(p/=255),p}case 5122:{let p=w.getInt16(e,!0);return r&&(p=Math.max(p/32767,-1)),p}case 5123:{let p=w.getUint16(e,!0);return r&&(p/=65535),p}case 5124:return w.getInt32(e,!0);case 5125:return w.getUint32(e,!0);case 5126:return w.getFloat32(e,!0);default:throw new Error(`Invalid component type ${p}`)}}function d(w,p,e,r,I){switch(p){case 5120:r&&(I=Math.round(127*I)),w.setInt8(e,I);break;case 5121:r&&(I=Math.round(255*I)),w.setUint8(e,I);break;case 5122:r&&(I=Math.round(32767*I)),w.setInt16(e,I,!0);break;case 5123:r&&(I=Math.round(65535*I)),w.setUint16(e,I,!0);break;case 5124:w.setInt32(e,I,!0);break;case 5125:w.setUint32(e,I,!0);break;case 5126:w.setFloat32(e,I,!0);break;default:throw new Error(`Invalid component type ${p}`)}}function f(w){switch(w){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${w}'`)}}function q(w){switch(w){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${w}'`)}}function E(w,p,e,r,q,E,j,X){const k=new Array(r),m=new Array(r);if(w instanceof Array){let I=p/4;const d=e/4;for(let p=0;p<E;p+=r){for(let p=0;p<r;p++)k[p]=m[p]=w[I+p];X(m,p);for(let p=0;p<r;p++)k[p]!==m[p]&&(w[I+p]=m[p]);I+=d}}else{const J=ArrayBuffer.isView(w)?new DataView(w.buffer,w.byteOffset,w.byteLength):new DataView(w),K=f(q);for(let w=0;w<E;w+=r){for(let w=0,e=p;w<r;w++,e+=K)k[w]=m[w]=I(J,q,e,j);X(m,w);for(let w=0,e=p;w<r;w++,e+=K)k[w]!==m[w]&&d(J,q,e,j,m[w]);p+=e}}}function j(w,p,e,I,d,q,j,X){const k=p*f(e),m=j*p;if(5126!==e||d!==k){const r=new Float32Array(m);return E(w,I,d,p,e,m,q,((w,e)=>{for(let I=0;I<p;I++)r[e+I]=w[I]})),r}if(!(w instanceof Array||w instanceof Float32Array)||0!==I||w.length!==m){if(w instanceof Array){const p=I/4;return w.slice(p,p+m)}if(w instanceof ArrayBuffer)return new Float32Array(w,I,m);{const p=w.byteOffset+I;return 0!==(3&p)&&(r.c.Warn("Float array must be aligned to 4-bytes border"),X=!0),X?new Float32Array(w.buffer.slice(p,p+m*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(w.buffer,p,m)}}return X?w.slice():w}function X(w,p,e,I,d,j,X,k){const m=f(e),J=q(e),K=X*p;if(Array.isArray(w)){if(0!==(3&I)||0!==(3&d))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const r=I/4,f=d/4;if(r+(X-1)*f+p>w.length)throw new Error("Last accessed index is out of bounds.");if(f<p)throw new Error("Data stride cannot be smaller than the component size.");if(f!==p){const r=new J(K);return E(w,I,d,p,e,K,j,((w,e)=>{for(let I=0;I<p;I++)r[e+I]=w[I]})),r}return new J(w.slice(r,r+K))}let y,c=I;w instanceof ArrayBuffer?y=w:(y=w.buffer,c+=w.byteOffset);if(c+(X-1)*d+p*m>y.byteLength)throw new Error("Last accessed byte is out of bounds.");const s=p*m;if(d<s)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(d!==s){const w=new J(K);return E(y,c,d,p,e,K,j,((e,r)=>{for(let I=0;I<p;I++)w[r+I]=e[I]})),w}return 1!==m&&0!==(c&m-1)&&(r.c.Warn("Array must be aligned to border of element size. Data will be copied."),k=!0),k?new J(y.slice(c,c+K*m)):new J(y,c,K)}function k(w,p,e,I,d,q,j,X){const k=p*f(e),m=j*p;if(X.length!==m)throw new Error("Output length is not valid");if(5126===e&&d===k)if(w instanceof Array){const p=I/4;X.set(w,p)}else if(w instanceof ArrayBuffer){const p=new Float32Array(w,I,m);X.set(p)}else{const p=w.byteOffset+I;if(0!==(3&p))return r.c.Warn("Float array must be aligned to 4-bytes border"),void X.set(new Float32Array(w.buffer.slice(p,p+m*Float32Array.BYTES_PER_ELEMENT)));const e=new Float32Array(w.buffer,p,m);X.set(e)}else E(w,I,d,p,e,m,q,((w,e)=>{for(let r=0;r<p;r++)X[e+r]=w[r]}))}function m(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(w)){for(let I=0;I<p;I++)if(w[e+I]-r>65535)return!0;return!1}return 4===w.BYTES_PER_ELEMENT}},11240:(w,p,e)=>{e.d(p,{e:()=>r});class r{get underlyingResource(){return null}constructor(){this.references=0,this.eq=0,this.is32Bits=!1,this.uniqueId=r._Counter++}}r._Counter=0},11374:(w,p,e)=>{e.d(p,{d:()=>c});var r=e(11207),I=e(11213),d=e(11376),f=e(11071),q=e(11056),E=e(11023),j=e(11331),X=e(11081),k=e(11038),m=e(11094),J=e(11378),K=e(11386),y=e(11301);class c extends j.b{get position(){return this._position}set position(w){this._position=w}set upVector(w){this._upVector=w}get upVector(){return this._upVector}get screenArea(){let w=0,p=0;if(this.mode===c.PERSPECTIVE_CAMERA)this.fovMode===c.FOVMODE_VERTICAL_FIXED?(p=2*this.ge*Math.tan(this.fov/2),w=this.getEngine().getAspectRatio(this)*p):(w=2*this.ge*Math.tan(this.fov/2),p=w/this.getEngine().getAspectRatio(this));else{const e=this.getEngine().getRenderWidth()/2,r=this.getEngine().getRenderHeight()/2;w=(this.orthoRight??e)-(this.orthoLeft??-e),p=(this.orthoTop??r)-(this.orthoBottom??-r)}return w*p}set orthoLeft(w){this._orthoLeft=w;for(const p of this._rigCameras)p.orthoLeft=w}get orthoLeft(){return this._orthoLeft}set orthoRight(w){this._orthoRight=w;for(const p of this._rigCameras)p.orthoRight=w}get orthoRight(){return this._orthoRight}set orthoBottom(w){this._orthoBottom=w;for(const p of this._rigCameras)p.orthoBottom=w}get orthoBottom(){return this._orthoBottom}set orthoTop(w){this._orthoTop=w;for(const p of this._rigCameras)p.orthoTop=w}get orthoTop(){return this._orthoTop}setFocalLength(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(p/(2*w))}set mode(w){this._mode=w;for(const p of this._rigCameras)p.mode=w}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(w,p,e){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(w,e,!1),this._position=E.k.Zero(),this._upVector=E.k.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.ge=1,this.maxZ=1e4,this.inertia=.9,this._mode=c.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new J.d(0,0,1,1),this.layerMask=268435455,this.fovMode=c.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=c.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new q.d,this.onProjectionMatrixChangedObservable=new q.d,this.onAfterCheckInputsObservable=new q.d,this.onRestoreStateObservable=new q.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new E.b,this._postProcesses=new Array,this._activeMeshes=new d.e(256),this._globalPosition=E.k.Zero(),this._computedViewMatrix=E.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=E.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=E.c.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.iw().addCamera(this),r&&!this.iw().activeCamera&&(this.iw().activeCamera=this),this.position=p,this.renderPassId=this.iw().getEngine().createRenderPassId(`Camera ${w}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"hX"}toString(w){let p="Name: "+this.name;if(p+=", type: "+this.getClassName(),this.animations)for(let e=0;e<this.animations.length;e++)p+=", animation[0]: "+this.animations[e].toString(w);return p}applyVerticalCorrection(){const w=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-w.x:w.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(w){return-1!==this._activeMeshes.indexOf(w)}isReady(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(w)for(const p of this._postProcesses)if(p&&!p.isReady())return!1;return super.isReady(w)}_initCache(){super._initCache(),this._cache.position=new E.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new E.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.ge=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(w){w||super._updateCache(),this._cache.position.X(this.position),this._cache.upVector.X(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let w=this._cache.mode===this.mode&&this._cache.ge===this.ge&&this._cache.maxZ===this.maxZ;if(!w)return!1;const p=this.getEngine();return this.mode===c.PERSPECTIVE_CAMERA?w=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===p.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(w=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===p.getRenderWidth()&&this._cache.renderHeight===p.getRenderHeight(),this.oblique&&(w=w&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),w}attachControl(w,p){}Sk(w){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let w=0;w<this._postProcesses.length;w++)if(null!==this._postProcesses[w])return this._postProcesses[w];return null}_cascadePostProcessesToRigCams(){const w=this._getFirstPostProcess();w&&w.markTextureDirty();for(let p=0,e=this._rigCameras.length;p<e;p++){const w=this._rigCameras[p],e=w._rigPostProcess;if(e){"pass"===e.getEffectName()&&(w.isIntermediate=0===this._postProcesses.length),w._postProcesses=this._postProcesses.slice(0).concat(e),e.markTextureDirty()}else w._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!w.isReusable()&&this._postProcesses.indexOf(w)>-1?(X.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==p||p<0?this._postProcesses.push(w):null===this._postProcesses[p]?this._postProcesses[p]=w:this._postProcesses.splice(p,0,w),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.kX(),this._postProcesses.indexOf(w))}detachPostProcess(w){const p=this._postProcesses.indexOf(w);-1!==p&&(this._postProcesses[p]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.kX(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return E.b.Identity()}getViewMatrix(w){return!w&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.iw().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(w){this._doNotComputeProjectionMatrix=!0,void 0!==w&&(this._projectionMatrix=w)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(w){if(this._doNotComputeProjectionMatrix||!w&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.ge=this.ge,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const p=this.getEngine(),e=this.iw(),r=p.useReverseDepthBuffer;if(this.mode===c.PERSPECTIVE_CAMERA){let w;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=p.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.ge<=0&&(this.ge=.1),w=e.useRightHandedSystem?E.b.PerspectiveFovRHToRef:E.b.PerspectiveFovLHToRef,w(this.fov,p.getAspectRatio(this),r?this.maxZ:this.ge,r?this.ge:this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED,p.isNDCHalfZRange,this.projectionPlaneTilt,r)}else{var I,d,f;const w=p.getRenderWidth()/2,q=p.getRenderHeight()/2;e.useRightHandedSystem?this.oblique?E.b.ObliqueOffCenterRHToRef(this.orthoLeft??-w,this.orthoRight??w,this.orthoBottom??-q,this.orthoTop??q,r?this.maxZ:this.ge,r?this.ge:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,p.isNDCHalfZRange):E.b.OrthoOffCenterRHToRef(this.orthoLeft??-w,this.orthoRight??w,this.orthoBottom??-q,this.orthoTop??q,r?this.maxZ:this.ge,r?this.ge:this.maxZ,this._projectionMatrix,p.isNDCHalfZRange):this.oblique?E.b.ObliqueOffCenterLHToRef(this.orthoLeft??-w,this.orthoRight??w,this.orthoBottom??-q,this.orthoTop??q,r?this.maxZ:this.ge,r?this.ge:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,p.isNDCHalfZRange):E.b.OrthoOffCenterLHToRef(this.orthoLeft??-w,this.orthoRight??w,this.orthoBottom??-q,this.orthoTop??q,r?this.maxZ:this.ge,r?this.ge:this.maxZ,this._projectionMatrix,p.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(I=this.oblique)||void 0===I?void 0:I.angle,this._cache.obliqueLength=null===(d=this.oblique)||void 0===d?void 0:d.length,this._cache.obliqueOffset=null===(f=this.oblique)||void 0===f?void 0:f.offset,this._cache.renderWidth=p.getRenderWidth(),this._cache.renderHeight=p.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(w){return(this.radius||(this.target?E.k.Distance(this.position,this.target):this.position.length()))+w}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?K.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=K.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),p&&this.rigCameras.length>0){let p=!1;for(const e of this.rigCameras)e._updateFrustumPlanes(),p=p||w.isInFrustum(e._frustumPlanes);return p}return w.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(w){return this._updateFrustumPlanes(),w.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,m.c)("Ray")}getForwardRayToRef(w){throw(0,m.c)("Ray")}dispose(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.iw().stopAnimation(this),this.iw().removeCamera(this);this._rigCameras.length>0;){const w=this._rigCameras.pop();w&&w.dispose()}if(this._parentContainer){const w=this._parentContainer.cameras.indexOf(this);w>-1&&this._parentContainer.cameras.splice(w,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==c.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let w=this._postProcesses.length;for(;--w>=0;){const p=this._postProcesses[w];p&&p.dispose(this)}}let e=this.customRenderTargets.length;for(;--e>=0;)this.customRenderTargets[e].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.iw().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(w,p)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(w,p){if(this.cameraRigMode!==w){for(;this._rigCameras.length>0;){const w=this._rigCameras.pop();w&&w.dispose()}if(this.cameraRigMode=w,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=p.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=f.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==c.RIG_MODE_NONE){const w=this.createRigCamera(this.name+"_L",0);w&&(w._isLeftCamera=!0);const p=this.createRigCamera(this.name+"_R",1);p&&(p._isRightCamera=!0),w&&p&&(this._rigCameras.push(w),this._rigCameras.push(p))}this._setRigMode(p),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(w){}_getVRProjectionMatrix(){return E.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.ge,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(w,p){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[w]=p,"interaxialDistance"===w&&(this._cameraRigParams.stereoHalfAngle=f.g.ToRadians(p/.0637))}createRigCamera(w,p){return null}_updateRigCameras(){for(let w=0;w<this._rigCameras.length;w++)this._rigCameras[w].ge=this.ge,this._rigCameras[w].maxZ=this.maxZ,this._rigCameras[w].fov=this.fov,this._rigCameras[w].upVector.X(this.upVector);this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const w=y.e.Serialize(this);return w.uniqueId=this.uniqueId,w.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(w),this.inputs&&this.inputs.serialize(w),y.e.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w.isEnabled=this.isEnabled(),w}clone(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=y.e.Clone(c.GetConstructorFromName(this.getClassName(),w,this.iw(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return e.name=w,e.parent=p,this.onClonedObservable.notifyObservers(e),e}ej(w){const p=E.k.Zero();return this.getDirectionToRef(w,p),p}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(w,p){E.k.TransformNormalToRef(w,this.getWorldMatrix(),p)}static GetConstructorFromName(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=j.b.Construct(w,p,e,{interaxial_distance:r,isStereoscopicSideBySide:I});return d||(()=>c._CreateDefaultParsedCamera(p,e))}ke(){return this.getWorldMatrix()}static Parse(w,p){const e=w.type,r=c.GetConstructorFromName(e,w.name,p,w.interaxial_distance,w.isStereoscopicSideBySide),I=y.e.Parse(r,w,p);if(void 0!==w.parentId&&(I._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(I._waitingParentInstanceIndex=w.parentInstanceIndex),I.inputs&&(I.inputs.parse(w),I._setupInputs()),w.upVector&&(I.upVector=E.k.Ve(w.upVector)),I.setPosition&&(I.position.te(0,0,0),I.setPosition(E.k.Ve(w.position))),w.target&&I.setTarget&&I.setTarget(E.k.Ve(w.target)),w.cameraRigMode){const p=w.interaxial_distance?{interaxialDistance:w.interaxial_distance}:{};I.setCameraRigMode(w.cameraRigMode,p)}if(w.animations){for(let p=0;p<w.animations.length;p++){const e=w.animations[p],r=(0,k.c)("BABYLON.Animation");r&&I.animations.push(r.Parse(e))}j.b.ParseAnimationRanges(I,w,p)}return w.autoAnimate&&p.beginAnimation(I,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),void 0!==w.isEnabled&&I.yE(w.isEnabled),I}_calculateHandednessMultiplier(){let w=this.iw().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(w*=-1),w}}c._CreateDefaultParsedCamera=(w,p)=>{throw(0,m.c)("UniversalCamera")},c.PERSPECTIVE_CAMERA=0,c.ORTHOGRAPHIC_CAMERA=1,c.FOVMODE_VERTICAL_FIXED=0,c.FOVMODE_HORIZONTAL_FIXED=1,c.RIG_MODE_NONE=0,c.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c.RIG_MODE_STEREOSCOPIC_INTERLACED=14,c.RIG_MODE_VR=20,c.RIG_MODE_CUSTOM=22,c.ForceAttachControlToAlwaysPreventDefault=!1,(0,r.c)([(0,I.G)("position")],c.prototype,"_position",void 0),(0,r.c)([(0,I.G)("upVector")],c.prototype,"_upVector",void 0),(0,r.c)([(0,I.J)()],c.prototype,"orthoLeft",null),(0,r.c)([(0,I.J)()],c.prototype,"orthoRight",null),(0,r.c)([(0,I.J)()],c.prototype,"orthoBottom",null),(0,r.c)([(0,I.J)()],c.prototype,"orthoTop",null),(0,r.c)([(0,I.J)()],c.prototype,"fov",void 0),(0,r.c)([(0,I.J)()],c.prototype,"projectionPlaneTilt",void 0),(0,r.c)([(0,I.J)()],c.prototype,"ge",void 0),(0,r.c)([(0,I.J)()],c.prototype,"maxZ",void 0),(0,r.c)([(0,I.J)()],c.prototype,"inertia",void 0),(0,r.c)([(0,I.J)()],c.prototype,"mode",null),(0,r.c)([(0,I.J)()],c.prototype,"layerMask",void 0),(0,r.c)([(0,I.J)()],c.prototype,"fovMode",void 0),(0,r.c)([(0,I.J)()],c.prototype,"cameraRigMode",void 0),(0,r.c)([(0,I.J)()],c.prototype,"interaxialDistance",void 0),(0,r.c)([(0,I.J)()],c.prototype,"isStereoscopicSideBySide",void 0)},11561:(w,p,e)=>{e.d(p,{d:()=>k});var r=e(11207),I=e(11213),d=e(11374),f=e(11023),q=e(11027),E=e(11358);e(11331).b.AddNodeConstructor("TargetCamera",((w,p)=>()=>new k(w,f.k.Zero(),p)));const j=f.b.Zero(),X=f.c.Identity();class k extends d.d{constructor(w,p,e){super(w,p,e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new f.k(0,0,0),this.cameraRotation=new f.g(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=f.k.Zero(),this._initialFocalDistance=1,this._viewMatrix=f.b.Zero(),this._cameraTransformMatrix=f.b.Zero(),this._cameraRotationMatrix=f.b.Zero(),this._transformedReferencePoint=f.k.Zero(),this._deferredPositionUpdate=new f.k,this._deferredRotationQuaternionUpdate=new f.c,this._deferredRotationUpdate=new f.k,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=f.k.Forward(this.iw().useRightHandedSystem),this.rotation=new f.k(0,this.iw().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(w){this.getWorldMatrix();const p=f.d.ne[0],e=f.d.ne[1];return e.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(e,p),p.scaleInPlace(w),this.globalPosition.add(p)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const w=this.lockedTarget;w.ke().getTranslationToRef(w.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.te(0,0,0),this.cameraRotation.te(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new f.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new f.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new f.c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(w){w||super._updateCache();const p=this._getLockedTargetPosition();p?this._cache.lockedTarget?this._cache.lockedTarget.X(p):this._cache.lockedTarget=p.clone():this._cache.lockedTarget=null,this._cache.rotation.X(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.X(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const w=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(w):!w)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const w=this.getEngine();return this.speed*Math.sqrt(w.getDeltaTime()/(100*w.getFps()))}setTarget(w){this.upVector.normalize(),this._initialFocalDistance=w.Je(this.position).length(),this.position.z===w.z&&(this.position.z+=q.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.iw().useRightHandedSystem?f.b.LookAtRHToRef(this.position,w,f.k.UpReadOnly,j):f.b.LookAtLHToRef(this.position,w,f.k.UpReadOnly,j),j.invert();const p=this.rotationQuaternion||X;f.c.FromRotationMatrixToRef(j,p),p.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(w){this.setTarget(w)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(f.d.Matrix[0]),f.k.TransformNormalToRef(this.cameraDirection,f.d.Matrix[0],f.d.ne[0]),this._deferredPositionUpdate.addInPlace(f.d.ne[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.X(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.X(this._deferredPositionUpdate)}_checkInputs(){const w=this.invertRotation?-this.inverseRotationSpeed:1,p=this._decideIfNeedsToMove(),e=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.X(this.rotation),this._deferredPositionUpdate.X(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.X(this.rotationQuaternion),p&&this._updatePosition(),e){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*w,this._deferredRotationUpdate.y+=this.cameraRotation.y*w,!this.noRotationConstraint){const w=1.570796;this._deferredRotationUpdate.x>w&&(this._deferredRotationUpdate.x=w),this._deferredRotationUpdate.x<-w&&(this._deferredRotationUpdate.x=-w)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.X(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(f.c.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.X(this._deferredRotationQuaternionUpdate))}}p&&(Math.abs(this.cameraDirection.x)<this.speed*q.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*q.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*q.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),e&&(Math.abs(this.cameraRotation.x)<this.speed*q.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*q.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):f.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return f.k.TransformNormalToRef(f.k.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),f.k.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?E.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(f.c.FromEulerVectorToRef(this.rotation,X),E.b.Y.rotateByQuaternionToRef(X,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(w,p,e){if(this.iw().useRightHandedSystem?f.b.LookAtRHToRef(w,p,e,this._viewMatrix):f.b.LookAtLHToRef(w,p,e,this._viewMatrix),this.parent){const w=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(w,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.X(w)}createRigCamera(w,p){if(this.cameraRigMode!==d.d.RIG_MODE_NONE){const p=new k(w,this.position.clone(),this.iw());return p.isRigCamera=!0,p.rigParent=this,this.cameraRigMode===d.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new f.c),p._cameraRigParams={},p.rotationQuaternion=new f.c),p.mode=this.mode,p.orthoLeft=this.orthoLeft,p.orthoRight=this.orthoRight,p.orthoTop=this.orthoTop,p.orthoBottom=this.orthoBottom,p}return null}_updateRigCameras(){const w=this._rigCameras[0],p=this._rigCameras[1];switch(this.ke(),this.cameraRigMode){case d.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case d.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const e=this.cameraRigMode===d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*e,w),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,p);break}case d.d.RIG_MODE_VR:w.rotationQuaternion?(w.rotationQuaternion.X(this.rotationQuaternion),p.rotationQuaternion.X(this.rotationQuaternion)):(w.rotation.X(this.rotation),p.rotation.X(this.rotation)),w.position.X(this.position),p.position.X(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(w,p){this.getTarget().subtractToRef(this.position,k._TargetFocalPoint),k._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const e=k._TargetFocalPoint.addInPlace(this.position);f.b.TranslationToRef(-e.x,-e.y,-e.z,k._TargetTransformMatrix),k._TargetTransformMatrix.multiplyToRef(f.b.RotationAxis(p.upVector,w),k._RigCamTransformMatrix),f.b.TranslationToRef(e.x,e.y,e.z,k._TargetTransformMatrix),k._RigCamTransformMatrix.multiplyToRef(k._TargetTransformMatrix,k._RigCamTransformMatrix),f.k.TransformCoordinatesToRef(this.position,k._RigCamTransformMatrix,p.position),p.setTarget(e)}getClassName(){return"TargetCamera"}}k._RigCamTransformMatrix=new f.b,k._TargetTransformMatrix=new f.b,k._TargetFocalPoint=new f.k,(0,r.c)([(0,I.J)()],k.prototype,"updateUpVectorFromRotation",void 0),(0,r.c)([(0,I.G)()],k.prototype,"rotation",void 0),(0,r.c)([(0,I.J)()],k.prototype,"speed",void 0),(0,r.c)([(0,I.v)("lockedTargetId")],k.prototype,"lockedTarget",void 0)},11256:(w,p,e)=>{e.d(p,{c:()=>r});class r{constructor(w,p,e){this.bu=w,this.bv=p,this.distance=e,this.faceId=0,this.subMeshId=0}}},11354:(w,p,e)=>{e.d(p,{d:()=>d});var r=e(11023),I=e(11232);class d{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var w;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||e&&!this.pickedMesh.isVerticesDataPresent(I.e.NormalKind))return null;let d,f=this.pickedMesh.Ke();0===(null===(w=f)||void 0===w?void 0:w.length)&&(f=null);const q=r.d.ne[0],E=r.d.ne[1],j=r.d.ne[2];if(e){const w=this.pickedMesh.getVerticesData(I.e.NormalKind);let p=f?r.k.FromArrayToRef(w,3*f[3*this.faceId],q):q.te(w[3*this.faceId*3],w[3*this.faceId*3+1],w[3*this.faceId*3+2]),e=f?r.k.FromArrayToRef(w,3*f[3*this.faceId+1],E):E.te(w[3*(3*this.faceId+1)],w[3*(3*this.faceId+1)+1],w[3*(3*this.faceId+1)+2]),X=f?r.k.FromArrayToRef(w,3*f[3*this.faceId+2],j):j.te(w[3*(3*this.faceId+2)],w[3*(3*this.faceId+2)+1],w[3*(3*this.faceId+2)+2]);p=p.scale(this.bu),e=e.scale(this.bv),X=X.scale(1-this.bu-this.bv),d=new r.k(p.x+e.x+X.x,p.y+e.y+X.y,p.z+e.z+X.z)}else{const w=this.pickedMesh.getVerticesData(I.e.PositionKind),p=f?r.k.FromArrayToRef(w,3*f[3*this.faceId],q):q.te(w[3*this.faceId*3],w[3*this.faceId*3+1],w[3*this.faceId*3+2]),e=f?r.k.FromArrayToRef(w,3*f[3*this.faceId+1],E):E.te(w[3*(3*this.faceId+1)],w[3*(3*this.faceId+1)+1],w[3*(3*this.faceId+1)+2]),X=f?r.k.FromArrayToRef(w,3*f[3*this.faceId+2],j):j.te(w[3*(3*this.faceId+2)],w[3*(3*this.faceId+2)+1],w[3*(3*this.faceId+2)+2]),k=p.Je(e),m=X.Je(e);d=r.k.Cross(k,m)}const X=(w,p)=>{if(-1!==this.thinInstanceIndex){const e=w.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];e&&r.k.TransformNormalToRef(p,e,p)}let e=w.getWorldMatrix();w.nonUniformScaling&&(r.d.Matrix[0].X(e),e=r.d.Matrix[0],e.setTranslationFromFloats(0,0,0),e.invert(),e.transposeToRef(r.d.Matrix[1]),e=r.d.Matrix[1]),r.k.TransformNormalToRef(p,e,p)};if(p&&X(this.pickedMesh,d),this.ray){const w=r.d.ne[0].X(d);p||X(this.pickedMesh,w),r.k.Dot(w,this.ray.direction)>0&&d.negateInPlace()}return d.normalize(),d}getTextureCoordinates(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.e.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(w))return null;const p=this.pickedMesh.Ke();if(!p)return null;const e=this.pickedMesh.getVerticesData(w);if(!e)return null;let d=r.g.Ve(e,2*p[3*this.faceId]),f=r.g.Ve(e,2*p[3*this.faceId+1]),q=r.g.Ve(e,2*p[3*this.faceId+2]);return d=d.scale(this.bu),f=f.scale(this.bv),q=q.scale(1-this.bu-this.bv),new r.g(d.x+f.x+q.x,d.y+f.y+q.y)}}},11400:(w,p,e)=>{e.d(p,{b:()=>r});let r=!1},11273:(w,p,e)=>{e.d(p,{d:()=>f});var r=e(11030),I=e(11023),d=e(11027);class f{constructor(w,p,e){this.vectors=(0,r.d)(8,I.k.Zero),this.center=I.k.Zero(),this.centerWorld=I.k.Zero(),this.extendSize=I.k.Zero(),this.extendSizeWorld=I.k.Zero(),this.directions=(0,r.d)(3,I.k.Zero),this.vectorsWorld=(0,r.d)(8,I.k.Zero),this.minimumWorld=I.k.Zero(),this.maximumWorld=I.k.Zero(),this.minimum=I.k.Zero(),this.maximum=I.k.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(w,p,e)}reConstruct(w,p,e){const r=w.x,d=w.y,f=w.z,q=p.x,E=p.y,j=p.z,X=this.vectors;this.minimum.te(r,d,f),this.maximum.te(q,E,j),X[0].te(r,d,f),X[1].te(q,E,j),X[2].te(q,d,f),X[3].te(r,E,f),X[4].te(r,d,j),X[5].te(q,E,f),X[6].te(r,E,j),X[7].te(q,d,j),p.addToRef(w,this.center).scaleInPlace(.5),p.subtractToRef(w,this.extendSize).scaleInPlace(.5),this._worldMatrix=e||I.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(w){const p=f._TmpVector3,e=this.maximum.subtractToRef(this.minimum,p[0]),r=e.length();e.normalizeFromLength(r);const I=r*w,d=e.scaleInPlace(.5*I),q=this.center.subtractToRef(d,p[1]),E=this.center.addToRef(d,p[2]);return this.reConstruct(q,E,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(w){const p=this.minimumWorld,e=this.maximumWorld,r=this.directions,d=this.vectorsWorld,f=this.vectors;if(w.isIdentity()){p.X(this.minimum),e.X(this.maximum);for(let w=0;w<8;++w)d[w].X(f[w]);this.extendSizeWorld.X(this.extendSize),this.centerWorld.X(this.center)}else{p.Pe(Number.MAX_VALUE),e.Pe(-Number.MAX_VALUE);for(let r=0;r<8;++r){const q=d[r];I.k.TransformCoordinatesToRef(f[r],w,q),p.minimizeInPlace(q),e.maximizeInPlace(q)}e.subtractToRef(p,this.extendSizeWorld).scaleInPlace(.5),e.addToRef(p,this.centerWorld).scaleInPlace(.5)}I.k.FromArrayToRef(w.m,0,r[0]),I.k.FromArrayToRef(w.m,4,r[1]),I.k.FromArrayToRef(w.m,8,r[2]),this._worldMatrix=w}isInFrustum(w){return f.IsInFrustum(this.vectorsWorld,w)}isCompletelyInFrustum(w){return f.IsCompletelyInFrustum(this.vectorsWorld,w)}intersectsPoint(w){const p=this.minimumWorld,e=this.maximumWorld,r=p.x,I=p.y,f=p.z,q=e.x,E=e.y,j=e.z,X=w.x,k=w.y,m=w.z,J=-d.c;return!(q-X<J||J>X-r)&&(!(E-k<J||J>k-I)&&!(j-m<J||J>m-f))}intersectsSphere(w){return f.IntersectsSphere(this.minimumWorld,this.maximumWorld,w.centerWorld,w.radiusWorld)}intersectsMinMax(w,p){const e=this.minimumWorld,r=this.maximumWorld,I=e.x,d=e.y,f=e.z,q=r.x,E=r.y,j=r.z,X=w.x,k=w.y,m=w.z,J=p.x,K=p.y,y=p.z;return!(q<X||I>J)&&(!(E<k||d>K)&&!(j<m||f>y))}dispose(){var w,p;null===(w=this._drawWrapperFront)||void 0===w||w.dispose(),null===(p=this._drawWrapperBack)||void 0===p||p.dispose()}static Intersects(w,p){return w.intersectsMinMax(p.minimumWorld,p.maximumWorld)}static IntersectsSphere(w,p,e,r){const d=f._TmpVector3[0];I.k.ClampToRef(e,w,p,d);return I.k.DistanceSquared(e,d)<=r*r}static IsCompletelyInFrustum(w,p){for(let e=0;e<6;++e){const r=p[e];for(let p=0;p<8;++p)if(r.dotCoordinate(w[p])<0)return!1}return!0}static IsInFrustum(w,p){for(let e=0;e<6;++e){let r=!0;const I=p[e];for(let p=0;p<8;++p)if(I.dotCoordinate(w[p])>=0){r=!1;break}if(r)return!1}return!0}}f._TmpVector3=(0,r.d)(3,I.k.Zero)},11265:(w,p,e)=>{e.d(p,{b:()=>k});var r=e(11030),I=e(11023),d=e(11273),f=e(11275);const q={min:0,max:0},E={min:0,max:0},j=(w,p,e)=>{const r=I.k.Dot(p.centerWorld,w),d=Math.abs(I.k.Dot(p.directions[0],w))*p.extendSize.x+Math.abs(I.k.Dot(p.directions[1],w))*p.extendSize.y+Math.abs(I.k.Dot(p.directions[2],w))*p.extendSize.z;e.min=r-d,e.max=r+d},X=(w,p,e)=>(j(w,p,q),j(w,e,E),!(q.min>E.max||E.min>q.max));class k{constructor(w,p,e){this._isLocked=!1,this.boundingBox=new d.d(w,p,e),this.boundingSphere=new f.d(w,p,e)}reConstruct(w,p,e){this.boundingBox.reConstruct(w,p,e),this.boundingSphere.reConstruct(w,p,e)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(w){this._isLocked=w}update(w){this._isLocked||(this.boundingBox._update(w),this.boundingSphere._update(w))}centerOn(w,p){const e=k._TmpVector3[0].X(w).zk(p),r=k._TmpVector3[1].X(w).addInPlace(p);return this.boundingBox.reConstruct(e,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(e,r,this.boundingBox.getWorldMatrix()),this}encapsulate(w){const p=I.k.Minimize(this.minimum,w),e=I.k.Maximize(this.maximum,w);return this.reConstruct(p,e,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(w){const p=I.d.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(p);const e=I.d.ne[0];return I.k.TransformCoordinatesToRef(w.boundingBox.minimumWorld,p,e),this.encapsulate(e),I.k.TransformCoordinatesToRef(w.boundingBox.maximumWorld,p,e),this.encapsulate(e),this}scale(w){return this.boundingBox.scale(w),this.boundingSphere.scale(w),this}isInFrustum(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===p||3===p)&&this.boundingSphere.isCenterInFrustum(w))return!0;if(!this.boundingSphere.isInFrustum(w))return!1;return!(1!==p&&3!==p)||this.boundingBox.isInFrustum(w)}get diagonalLength(){const w=this.boundingBox;return w.maximumWorld.subtractToRef(w.minimumWorld,k._TmpVector3[0]).length()}isCompletelyInFrustum(w){return this.boundingBox.isCompletelyInFrustum(w)}_checkCollision(w){return w._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(w){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(w)&&!!this.boundingBox.intersectsPoint(w))}intersects(w,p){if(!f.d.Intersects(this.boundingSphere,w.boundingSphere))return!1;if(!d.d.Intersects(this.boundingBox,w.boundingBox))return!1;if(!p)return!0;const e=this.boundingBox,r=w.boundingBox;return!!X(e.directions[0],e,r)&&(!!X(e.directions[1],e,r)&&(!!X(e.directions[2],e,r)&&(!!X(r.directions[0],e,r)&&(!!X(r.directions[1],e,r)&&(!!X(r.directions[2],e,r)&&(!!X(I.k.Cross(e.directions[0],r.directions[0]),e,r)&&(!!X(I.k.Cross(e.directions[0],r.directions[1]),e,r)&&(!!X(I.k.Cross(e.directions[0],r.directions[2]),e,r)&&(!!X(I.k.Cross(e.directions[1],r.directions[0]),e,r)&&(!!X(I.k.Cross(e.directions[1],r.directions[1]),e,r)&&(!!X(I.k.Cross(e.directions[1],r.directions[2]),e,r)&&(!!X(I.k.Cross(e.directions[2],r.directions[0]),e,r)&&(!!X(I.k.Cross(e.directions[2],r.directions[1]),e,r)&&!!X(I.k.Cross(e.directions[2],r.directions[2]),e,r))))))))))))))}}k._TmpVector3=(0,r.d)(2,I.k.Zero)},11275:(w,p,e)=>{e.d(p,{d:()=>d});var r=e(11030),I=e(11023);class d{constructor(w,p,e){this.center=I.k.Zero(),this.centerWorld=I.k.Zero(),this.minimum=I.k.Zero(),this.maximum=I.k.Zero(),this.reConstruct(w,p,e)}reConstruct(w,p,e){this.minimum.X(w),this.maximum.X(p);const r=I.k.Distance(w,p);p.addToRef(w,this.center).scaleInPlace(.5),this.radius=.5*r,this._update(e||I.b.IdentityReadOnly)}scale(w){const p=this.radius*w,e=d._TmpVector3,r=e[0].Pe(p),I=this.center.subtractToRef(r,e[1]),f=this.center.addToRef(r,e[2]);return this.reConstruct(I,f,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(w){if(w.isIdentity())this.centerWorld.X(this.center),this.radiusWorld=this.radius;else{I.k.TransformCoordinatesToRef(this.center,w,this.centerWorld);const p=d._TmpVector3[0];I.k.TransformNormalFromFloatsToRef(1,1,1,w,p),this.radiusWorld=Math.max(Math.abs(p.x),Math.abs(p.y),Math.abs(p.z))*this.radius}}isInFrustum(w){const p=this.centerWorld,e=this.radiusWorld;for(let r=0;r<6;r++)if(w[r].dotCoordinate(p)<=-e)return!1;return!0}isCenterInFrustum(w){const p=this.centerWorld;for(let e=0;e<6;e++)if(w[e].dotCoordinate(p)<0)return!1;return!0}intersectsPoint(w){const p=I.k.DistanceSquared(this.centerWorld,w);return!(this.radiusWorld*this.radiusWorld<p)}static Intersects(w,p){const e=I.k.DistanceSquared(w.centerWorld,p.centerWorld),r=w.radiusWorld+p.radiusWorld;return!(r*r<e)}static CreateFromCenterAndRadius(w,p,e){this._TmpVector3[0].X(w),this._TmpVector3[1].te(0,0,p),this._TmpVector3[2].X(w),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].zk(this._TmpVector3[1]);const r=new d(this._TmpVector3[0],this._TmpVector3[2]);return r._worldMatrix=e||I.b.Identity(),r}}d._TmpVector3=(0,r.d)(3,I.k.Zero)},11471:(w,p,e)=>{e(11132).d.prototype.createDepthStencilTexture=function(w,p,e){if(p.isCube){const e=w.width||w;return this._createDepthStencilCubeTexture(e,p)}return this._createDepthStencilTexture(w,p,e)}},11446:(w,p,e)=>{e(11416).ThinEngine.prototype.setAlphaMode=function(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==w){switch(w){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}p||(this.depthCullingState.depthMask=0===w),this._alphaMode=w}else if(!p){const p=0===w;this.depthCullingState.depthMask!==p&&(this.depthCullingState.depthMask=p)}}},11448:(w,p,e)=>{var r=e(11416);r.ThinEngine.prototype.updateDynamicIndexBuffer=function(w,p){let e;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(w),e=w.is32Bits?p instanceof Uint32Array?p:new Uint32Array(p):p instanceof Uint16Array?p:new Uint16Array(p),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},r.ThinEngine.prototype.updateDynamicVertexBuffer=function(w,p,e,r){this.bindArrayBuffer(w),void 0===e&&(e=0);const I=p.byteLength||p.length;void 0===r||r>=I&&0===e?p instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e,new Float32Array(p)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e,p):p instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e,new Float32Array(p).subarray(0,r/4)):(p=p instanceof ArrayBuffer?new Uint8Array(p,0,r):new Uint8Array(p.buffer,p.byteOffset,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e,p)),this._resetVertexBufferBinding()}},11457:(w,p,e)=>{var r=e(11161),I=e(11081),d=e(11416),f=e(11464),q=e(11437);class E extends f.d{setDepthStencilTexture(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(w,p),!w)return;const e=this._engine,r=this._context,I=w._hardwareTexture;if(I&&w._autoMSAAManagement&&this._MSAAFramebuffer){const p=e._currentFramebuffer;e._bindUnboundFramebuffer(this._MSAAFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,(0,q.c)(w.format)?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,r.RENDERBUFFER,I.getMSAARenderBuffer()),e._bindUnboundFramebuffer(p)}}constructor(w,p,e,r,I){super(w,p,e,r),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=I}_cloneRenderTargetWrapper(){let w=null;return this._colorTextureArray&&this._depthStencilTextureArray?(w=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),w.texture.isReady=!0):w=super._cloneRenderTargetWrapper(),w}_swapRenderTargetWrapper(w){super._swapRenderTargetWrapper(w),w._framebuffer=this._framebuffer,w._depthStencilBuffer=this._depthStencilBuffer,w._MSAAFramebuffer=this._MSAAFramebuffer,w._colorTextureArray=this._colorTextureArray,w._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,d=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const w=this._engine,p=w._currentFramebuffer,e=this._context;w._bindUnboundFramebuffer(this._framebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null),w._bindUnboundFramebuffer(p),e.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(w,p,e,r,I,d)}shareDepth(w){super.shareDepth(w);const p=this._context,e=this._depthStencilBuffer,r=w._MSAAFramebuffer||w._framebuffer,I=this._engine;w._depthStencilBuffer&&w._depthStencilBuffer!==e&&p.deleteRenderbuffer(w._depthStencilBuffer),w._depthStencilBuffer=e;const d=w._generateStencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT;I._bindUnboundFramebuffer(r),p.framebufferRenderbuffer(p.FRAMEBUFFER,d,p.RENDERBUFFER,e),I._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const I=w._hardwareTexture;if(!I)return;const d=this._framebuffer,f=this._engine,q=f._currentFramebuffer;let E;if(f._bindUnboundFramebuffer(d),f.webGLVersion>1){const d=this._context;var j;if(E=d["COLOR_ATTACHMENT"+p],w.is2DArray||w.is3D)e=e??(null===(j=this.layerIndices)||void 0===j?void 0:j[p])??0,d.framebufferTextureLayer(d.FRAMEBUFFER,E,I.underlyingResource,r,e);else if(w.isCube){var X;e=e??(null===(X=this.faceIndices)||void 0===X?void 0:X[p])??0,d.framebufferTexture2D(d.FRAMEBUFFER,E,d.TEXTURE_CUBE_MAP_POSITIVE_X+e,I.underlyingResource,r)}else d.framebufferTexture2D(d.FRAMEBUFFER,E,d.TEXTURE_2D,I.underlyingResource,r)}else{const w=this._context;E=w["COLOR_ATTACHMENT"+p+"_WEBGL"];const d=void 0!==e?w.TEXTURE_CUBE_MAP_POSITIVE_X+e:w.TEXTURE_2D;w.framebufferTexture2D(w.FRAMEBUFFER,E,d,I.underlyingResource,r)}if(w._autoMSAAManagement&&this._MSAAFramebuffer){const w=this._context;f._bindUnboundFramebuffer(this._MSAAFramebuffer),w.framebufferRenderbuffer(w.FRAMEBUFFER,E,w.RENDERBUFFER,I.getMSAARenderBuffer())}f._bindUnboundFramebuffer(q)}setTexture(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(w,p,e),this._bindTextureRenderTarget(w,p)}setLayerAndFaceIndices(w,p){var e;if(super.setLayerAndFaceIndices(w,p),!this.textures||!this.layerIndices||!this.faceIndices)return;const r=(null===(e=this._attachments)||void 0===e?void 0:e.length)??this.textures.length;for(let I=0;I<r;I++){const w=this.textures[I];w&&(w.is2DArray||w.is3D?this._bindTextureRenderTarget(w,I,this.layerIndices[I]):w.isCube?this._bindTextureRenderTarget(w,I,this.faceIndices[I]):this._bindTextureRenderTarget(w,I))}}setLayerAndFaceIndex(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(w,p,e),!this.textures||!this.layerIndices||!this.faceIndices)return;const r=this.textures[w];r.is2DArray||r.is3D?this._bindTextureRenderTarget(this.textures[w],w,this.layerIndices[w]):r.isCube&&this._bindTextureRenderTarget(this.textures[w],w,this.faceIndices[w])}resolveMSAATextures(){const w=this._engine,p=w._currentFramebuffer;w._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),w._bindUnboundFramebuffer(p)}dispose(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const p=this._context;w||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(p.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(p.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(p.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(w)}}e(11471);d.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(w,p,e){const r=new E(w,p,e,this,this._gl);return this._renderTargetWrapperCache.push(r),r},d.ThinEngine.prototype.createRenderTargetTexture=function(w,p){const e=this._createHardwareRenderTargetWrapper(!1,!1,w);let r,I,d=!0,f=!1,q=!1,E=1;void 0!==p&&"object"===typeof p&&(d=p.generateDepthBuffer??!0,f=!!p.generateStencilBuffer,q=!!p.noColorAttachment,r=p.colorAttachment,E=p.samples??1,I=p.label);const j=r||(q?null:this._createInternalTexture(w,p,!0,5)),X=w.width||w,k=w.height||w,m=this._currentFramebuffer,J=this._gl,K=J.createFramebuffer();if(this._bindUnboundFramebuffer(K),e._depthStencilBuffer=this._setupFramebufferDepthAttachments(f,d,X,k),!j||j.is2DArray||j.is3D||J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,j._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(m),e.label=I??"RenderTargetWrapper",e._framebuffer=K,e._generateDepthBuffer=d,e._generateStencilBuffer=f,e.setTextures(j),r){if(e._samples=r.samples,r.samples>1){const w=r._hardwareTexture.getMSAARenderBuffer(0);e._MSAAFramebuffer=J.createFramebuffer(),this._bindUnboundFramebuffer(e._MSAAFramebuffer),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.RENDERBUFFER,w),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(e,E);return e},d.ThinEngine.prototype._createDepthStencilTexture=function(w,p,e){const d=this._gl,f=w.layers||0,E=w.depth||0;let j=d.TEXTURE_2D;0!==f?j=d.TEXTURE_2D_ARRAY:0!==E&&(j=d.TEXTURE_3D);const X=new r.d(this,12);if(X.label=p.label,!this._caps.depthTextureExtension)return I.c.Error("Depth texture is not supported by your browser or hardware."),X;const k={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...p};if(this._bindTextureDirectly(j,X,!0),this._setupDepthStencilTexture(X,w,0!==k.comparisonFunction&&k.bilinearFiltering,k.comparisonFunction,k.samples),void 0!==k.depthTextureFormat){if(15!==k.depthTextureFormat&&16!==k.depthTextureFormat&&17!==k.depthTextureFormat&&13!==k.depthTextureFormat&&14!==k.depthTextureFormat&&18!==k.depthTextureFormat)return I.c.Error(`Depth texture ${k.depthTextureFormat} format is not supported.`),X;X.format=k.depthTextureFormat}else X.format=k.generateStencil?13:16;const m=(0,q.c)(X.format),J=this._getWebGLTextureTypeFromDepthTextureFormat(X.format),K=m?d.DEPTH_STENCIL:d.DEPTH_COMPONENT,y=this._getInternalFormatFromDepthTextureFormat(X.format,!0,m);return X.is2DArray?d.texImage3D(j,0,y,X.width,X.height,f,0,K,J,null):X.is3D?d.texImage3D(j,0,y,X.width,X.height,E,0,K,J,null):d.texImage2D(j,0,y,X.width,X.height,0,K,J,null),this._bindTextureDirectly(j,null),this._internalTexturesCache.push(X),e._depthStencilBuffer&&(d.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),this._bindUnboundFramebuffer(e._MSAAFramebuffer??e._framebuffer),e._generateStencilBuffer=m,e._depthStencilTextureWithStencil=m,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,e.samples,X.format),this._bindUnboundFramebuffer(null),X},d.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(w,p){var e;if(this.webGLVersion<2||!w)return 1;if(w.samples===p)return p;const r=this._gl;p=Math.min(p,this.getCaps().maxMSAASamples),w._depthStencilBuffer&&(r.deleteRenderbuffer(w._depthStencilBuffer),w._depthStencilBuffer=null),w._MSAAFramebuffer&&(r.deleteFramebuffer(w._MSAAFramebuffer),w._MSAAFramebuffer=null);const I=null===(e=w.texture)||void 0===e?void 0:e._hardwareTexture;if(null===I||void 0===I||I.releaseMSAARenderBuffers(),w.texture&&p>1&&"function"===typeof r.renderbufferStorageMultisample){const e=r.createFramebuffer();if(!e)throw new Error("Unable to create multi sampled framebuffer");w._MSAAFramebuffer=e,this._bindUnboundFramebuffer(w._MSAAFramebuffer);const d=this._createRenderBuffer(w.texture.width,w.texture.height,p,-1,this._getRGBABufferInternalSizedFormat(w.texture.type,w.texture.format,w.texture._useSRGBBuffer),r.COLOR_ATTACHMENT0,!1);if(!d)throw new Error("Unable to create multi sampled framebuffer");null===I||void 0===I||I.addMSAARenderBuffer(d)}this._bindUnboundFramebuffer(w._MSAAFramebuffer??w._framebuffer),w.texture&&(w.texture.samples=p),w._samples=p;const d=w._depthStencilTexture?w._depthStencilTexture.format:void 0;return w._depthStencilBuffer=this._setupFramebufferDepthAttachments(w._generateStencilBuffer,w._generateDepthBuffer,w.width,w.height,p,d),this._bindUnboundFramebuffer(null),p},d.ThinEngine.prototype._setupDepthStencilTexture=function(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const d=p.width??p,f=p.height??p,q=p.layers||0,E=p.depth||0;w.baseWidth=d,w.baseHeight=f,w.width=d,w.height=f,w.is2DArray=q>0,w.depth=q||E,w.isReady=!0,w.samples=I,w.generateMipMaps=!1,w.samplingMode=e?2:1,w.type=0,w._comparisonFunction=r;const j=this._gl,X=this._getTextureTarget(w),k=this._getSamplingParameters(w.samplingMode,!1);j.texParameteri(X,j.TEXTURE_MAG_FILTER,k.mag),j.texParameteri(X,j.TEXTURE_MIN_FILTER,k.min),j.texParameteri(X,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(X,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===r?(j.texParameteri(X,j.TEXTURE_COMPARE_FUNC,515),j.texParameteri(X,j.TEXTURE_COMPARE_MODE,j.NONE)):(j.texParameteri(X,j.TEXTURE_COMPARE_FUNC,r),j.texParameteri(X,j.TEXTURE_COMPARE_MODE,j.COMPARE_REF_TO_TEXTURE)))}},11118:(w,p,e)=>{e.d(p,{c:()=>t,d:()=>M,i:()=>i,f:()=>V,m:()=>b});class r{constructor(){this.children=[]}isValid(w){return!0}process(w,p,e){let r="";if(this.line){let e=this.line;const X=p.processor;if(X){var I,d,f,q,E,j;X.lineProcessor&&(e=X.lineProcessor(e,p.isFragment,p.processingContext));const r=(null===(I=p.processor)||void 0===I?void 0:I.attributeKeywordName)??"attribute",k=p.isFragment&&null!==(d=p.processor)&&void 0!==d&&d.varyingFragmentKeywordName?null===(f=p.processor)||void 0===f?void 0:f.varyingFragmentKeywordName:!p.isFragment&&null!==(q=p.processor)&&void 0!==q&&q.varyingVertexKeywordName?null===(E=p.processor)||void 0===E?void 0:E.varyingVertexKeywordName:"varying";if(!p.isFragment&&X.attributeProcessor&&this.line.startsWith(r))e=X.attributeProcessor(this.line,w,p.processingContext);else if(X.varyingProcessor&&(null!==(j=X.varyingCheck)&&void 0!==j&&j.call(X,this.line,p.isFragment)||!X.varyingCheck&&this.line.startsWith(k)))e=X.varyingProcessor(this.line,p.isFragment,w,p.processingContext);else if(X.uniformProcessor&&X.uniformRegexp&&X.uniformRegexp.test(this.line))p.lookForClosingBracketForUniformBuffer||(e=X.uniformProcessor(this.line,p.isFragment,w,p.processingContext));else if(X.uniformBufferProcessor&&X.uniformBufferRegexp&&X.uniformBufferRegexp.test(this.line))p.lookForClosingBracketForUniformBuffer||(e=X.uniformBufferProcessor(this.line,p.isFragment,p.processingContext),p.lookForClosingBracketForUniformBuffer=!0);else if(X.textureProcessor&&X.textureRegexp&&X.textureRegexp.test(this.line))e=X.textureProcessor(this.line,p.isFragment,w,p.processingContext);else if((X.uniformProcessor||X.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!p.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?X.uniformProcessor&&(e=X.uniformProcessor(this.line,p.isFragment,w,p.processingContext)):X.uniformBufferProcessor&&(e=X.uniformBufferProcessor(this.line,p.isFragment,p.processingContext),p.lookForClosingBracketForUniformBuffer=!0)}p.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(p.lookForClosingBracketForUniformBuffer=!1,X.endOfUniformBufferProcessor&&(e=X.endOfUniformBufferProcessor(this.line,p.isFragment,p.processingContext)))}r+=e+"\n"}for(const X of this.children)r+=X.process(w,p,e);return this.additionalDefineKey&&(w[this.additionalDefineKey]=this.additionalDefineValue||"true",e[this.additionalDefineKey]=w[this.additionalDefineKey]),r}}class I{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(w){this._lines.length=0;for(const p of w){if(!p||"\r"===p)continue;if("#"===p[0]){this._lines.push(p);continue}const w=p.trim();if(!w)continue;if(w.startsWith("//")){this._lines.push(p);continue}const e=w.indexOf(";");if(-1===e)this._lines.push(w);else if(e===w.length-1)w.length>1&&this._lines.push(w);else{const w=p.split(";");for(let p=0;p<w.length;p++){let e=w[p];e&&(e=e.trim(),e&&this._lines.push(e+(p!==w.length-1?";":"")))}}}}}class d extends r{process(w,p,e){for(let r=0;r<this.children.length;r++){const I=this.children[r];if(I.isValid(w))return I.process(w,p,e)}return""}}class f extends r{isValid(w){return this.testExpression.isTrue(w)}}class q{isTrue(w){return!0}static postfixToInfix(w){const p=[];for(const e of w)if(void 0===q._OperatorPriority[e])p.push(e);else{const w=p[p.length-1],r=p[p.length-2];p.length-=2,p.push(`(${r}${e}${w})`)}return p[p.length-1]}static infixToPostfix(w){const p=q._InfixToPostfixCache.get(w);if(p)return p.accessTime=Date.now(),p.result;if(!w.includes("&&")&&!w.includes("||")&&!w.includes(")")&&!w.includes("("))return[w];const e=[];let r=-1;const I=()=>{X=X.trim(),""!==X&&(e.push(X),X="")},d=w=>{r<q._Stack.length-1&&(q._Stack[++r]=w)},f=()=>q._Stack[r],E=()=>-1===r?"!!INVALID EXPRESSION!!":q._Stack[r--];let j=0,X="";for(;j<w.length;){const p=w.charAt(j),k=j<w.length-1?w.substring(j,2+j):"";if("("===p)X="",d(p);else if(")"===p){for(I();-1!==r&&"("!==f();)e.push(E());E()}else if(q._OperatorPriority[k]>1){for(I();-1!==r&&q._OperatorPriority[f()]>=q._OperatorPriority[k];)e.push(E());d(k),j++}else X+=p;j++}for(I();-1!==r;)"("===f()?E():e.push(E());return q._InfixToPostfixCache.size>=q.InfixToPostfixCacheLimitSize&&q.ClearCache(),q._InfixToPostfixCache.set(w,{result:e,accessTime:Date.now()}),e}static ClearCache(){const w=Array.from(q._InfixToPostfixCache.entries()).sort(((w,p)=>w[1].accessTime-p[1].accessTime));for(let p=0;p<q.InfixToPostfixCacheCleanupSize;p++)q._InfixToPostfixCache.delete(w[p][0])}}q.InfixToPostfixCacheLimitSize=5e4,q.InfixToPostfixCacheCleanupSize=25e3,q._InfixToPostfixCache=new Map,q._OperatorPriority={")":0,"(":1,"||":2,"&&":3},q._Stack=["","","","","","","","","","","","","","","","","","","",""];class E extends q{constructor(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=w,this.not=p}isTrue(w){let p=void 0!==w[this.define];return this.not&&(p=!p),p}}class j extends q{isTrue(w){return this.leftOperand.isTrue(w)||this.rightOperand.isTrue(w)}}class X extends q{isTrue(w){return this.leftOperand.isTrue(w)&&this.rightOperand.isTrue(w)}}class k extends q{constructor(w,p,e){super(),this.define=w,this.operand=p,this.testValue=e}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(w){let p=!1;const e=parseInt(void 0!=w[this.define]?w[this.define]:this.define),r=parseInt(void 0!=w[this.testValue]?w[this.testValue]:this.testValue);if(isNaN(e)||isNaN(r))return!1;switch(this.operand){case">":p=e>r;break;case"<":p=e<r;break;case"<=":p=e<=r;break;case">=":p=e>=r;break;case"==":p=e===r;break;case"!=":p=e!==r}return p}}var m=e(11094),J=e(11120);const K=/defined\s*?\((.+?)\)/g,y=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=/__decl__/,O=/light\{X\}.(\w*)/g,a=/\{X\}/g,A=[],z=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function M(w){w.processor&&w.processor.initializeShaders&&w.processor.initializeShaders(w.processingContext)}function i(w,p,e,r){var I;null!==(I=p.processor)&&void 0!==I&&I.preProcessShaderCode&&(w=p.processor.preProcessShaderCode(w,p.isFragment)),V(w,p,(w=>{p.processCodeAfterIncludes&&(w=p.processCodeAfterIncludes(p.isFragment?"fragment":"vertex",w,p.defines));const I=function(w,p,e){let r=function(w,p){var e;if(null!==(e=p.processor)&&void 0!==e&&e.noPrecision)return w;const r=p.shouldUseHighPrecisionShader;-1===w.indexOf("precision highp float")?w=r?"precision highp float;\n"+w:"precision mediump float;\n"+w:r||(w=w.replace("precision highp float","precision mediump float"));return w}(w,p);if(!p.processor)return r;if(0===p.processor.shaderLanguage&&-1!==r.indexOf("#version 3")&&(r=r.replace("#version 300 es",""),!p.processor.parseGLES3))return r;const I=p.defines,d=R(p,e);p.processor.preProcessor&&(r=p.processor.preProcessor(r,I,d,p.isFragment,p.processingContext));const f={};r=v(r,d,p,f),p.processor.postProcessor&&(r=p.processor.postProcessor(r,I,p.isFragment,p.processingContext,e?{drawBuffersExtensionDisabled:!e.getCaps().drawBuffersExtension}:{},d,f));null!==e&&void 0!==e&&e._features.needShaderCodeInlining&&(r=e.inlineShaderCode(r));return r}(w,p,r);e(I,w)}))}function t(w,p,e){return e.processor&&e.processor.finalizeShaders?e.processor.finalizeShaders(w,p,e.processingContext):{vertexCode:w,fragmentCode:p}}function n(w){const p=/defined\((.+)\)/.exec(w);if(p&&p.length)return new E(p[1].trim(),"!"===w[0]);const e=["==","!=",">=","<=","<",">"];let r="",I=0;for(r of e)if(I=w.indexOf(r),I>-1)break;if(-1===I)return new E(w);const d=w.substring(0,I).trim(),f=w.substring(I+r.length).trim();return new k(d,r,f)}function l(w,p){const e=new f,r=w.substring(0,p);let I=w.substring(p);return I=I.substring(0,(I.indexOf("//")+1||I.length+1)-1).trim(),e.testExpression="#ifdef"===r?new E(I):"#ifndef"===r?new E(I,!0):function(w){w=w.replace(K,"defined[$1]");const p=q.infixToPostfix(w),e=[];for(const I of p)if("||"!==I&&"&&"!==I)e.push(I);else if(e.length>=2){let w=e[e.length-1],p=e[e.length-2];e.length-=2;const r="&&"==I?new X:new j;"string"===typeof w&&(w=w.replace(y,"defined($1)")),"string"===typeof p&&(p=p.replace(y,"defined($1)")),r.leftOperand="string"===typeof p?n(p):p,r.rightOperand="string"===typeof w?n(w):w,e.push(r)}let r=e[e.length-1];return"string"===typeof r&&(r=r.replace(y,"defined($1)")),"string"===typeof r?n(r):r}(I),e}function N(w,p,e,I){let d=w.currentLine;for(;U(w,e,I);){d=w.currentLine;const f=d.substring(0,5).toLowerCase();if("#else"===f){const e=new r;return p.children.push(e),void U(w,e,I)}if("#elif"===f){const w=l(d,5);p.children.push(w),e=w}}}function U(w,p,e){for(;w.canRead;){w.lineIndex++;const I=w.currentLine;if(I.indexOf("#")>=0){const r=z.exec(I);if(r&&r.length){switch(r[0]){case"#ifdef":{const r=new d;p.children.push(r);const f=l(I,6);r.children.push(f),N(w,r,f,e);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const r=new d;p.children.push(r);const f=l(I,7);r.children.push(f),N(w,r,f,e);break}case"#if":{const r=new d,f=l(I,3);p.children.push(r),r.children.push(f),N(w,r,f,e);break}}continue}}const f=new r;if(f.line=I,p.children.push(f),"#"===I[0]&&"d"===I[1]){const w=I.replace(";","").split(" ");f.additionalDefineKey=w[1],3===w.length&&(f.additionalDefineValue=w[2])}}return!1}function v(w,p,e,d){const f=new r,q=new I;return q.lineIndex=-1,q.lines=w.split("\n"),U(q,f,d),f.process(p,e,d)}function R(w,p){var e;const r=w.defines,I={};for(const d of r){const w=d.replace("#define","").replace(";","").trim().split(" ");I[w[0]]=w.length>1?w[1]:""}return 0===(null===(e=w.processor)||void 0===e?void 0:e.shaderLanguage)&&(I.GL_ES="true"),I.__VERSION__=w.version,I[w.platformName]="true",(0,J.k)(I,null===p||void 0===p?void 0:p.isNDCHalfZRange,null===p||void 0===p?void 0:p.useReverseDepthBuffer,null===p||void 0===p?void 0:p.useExactSrgbConversions),I}function V(w,p,e){let r;for(A.length=0;null!==(r=c.exec(w));)A.push(r);let I=String(w),d=[w],f=!1;for(const q of A){let w=q[1];if(-1!==w.indexOf("__decl__")&&(w=w.replace(s,""),p.supportsUniformBuffers&&(w=w.replace("Vertex","Ubo").replace("Fragment","Ubo")),w+="Declaration"),!p.includesShadersStore[w]){const r=p.shadersRepository+"ShadersInclude/"+w+".fx";return void b.loadFile(r,(r=>{p.includesShadersStore[w]=r,V(d.join(""),p,e)}))}{let e=p.includesShadersStore[w];if(q[2]){const w=q[3].split(",");for(let p=0;p<w.length;p+=2){const r=new RegExp(w[p],"g"),I=w[p+1];e=e.replace(r,I)}}if(q[4]){const w=q[5];if(-1!==w.indexOf("..")){const r=w.split(".."),I=parseInt(r[0]);let d=parseInt(r[1]),f=e.slice(0);e="",isNaN(d)&&(d=p.indexParameters[r[1]]);for(let w=I;w<d;w++)p.supportsUniformBuffers||(f=f.replace(O,((w,p)=>p+"{X}"))),e+=f.replace(a,w.toString())+"\n"}else p.supportsUniformBuffers||(e=e.replace(O,((w,p)=>p+"{X}"))),e=e.replace(a,w)}const r=[];for(const w of d){const p=w.split(q[0]);for(let w=0;w<p.length-1;w++)r.push(p[w]),r.push(e);r.push(p[p.length-1])}d=r,f=f||e.indexOf("#include<")>=0||e.indexOf("#include <")>=0}}A.length=0,I=d.join(""),f?V(I.toString(),p,e):e(I)}const b={loadFile:(w,p,e,r,I,d)=>{throw(0,m.c)("FileTools")}}},11430:(w,p,e)=>{e.d(p,{e:()=>r});class r{get underlyingResource(){return this._webGLTexture}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=p,!w&&(w=p.createTexture(),!w))throw new Error("Unable to create webGL texture");this.set(w)}setUsage(){}set(w){this._webGLTexture=w}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(w){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(w)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const w of this._MSAARenderBuffers)this._context.deleteRenderbuffer(w);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var w;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._MSAARenderBuffers)||void 0===w?void 0:w[p])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11120:(w,p,e)=>{e.d(p,{d:()=>I,g:()=>d,k:()=>q,n:()=>f,o:()=>E});var r=e(11094);e(11075);const I={};function d(w,p){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(p?p+"\n":"")+w}function f(w,p,e,d,f,q,E){const j=E||I.loadFile;if(j){return j(w,p,e,d,f,q)}throw(0,r.c)("FileTools")}function q(w,p,e,r){if(w)return p?w.IS_NDC_HALF_ZRANGE="":delete w.IS_NDC_HALF_ZRANGE,e?w.USE_REVERSE_DEPTHBUFFER="":delete w.USE_REVERSE_DEPTHBUFFER,void(r?w.USE_EXACT_SRGB_CONVERSIONS="":delete w.USE_EXACT_SRGB_CONVERSIONS);{let w="";return p&&(w+="#define IS_NDC_HALF_ZRANGE"),e&&(w&&(w+="\n"),w+="#define USE_REVERSE_DEPTHBUFFER"),r&&(w&&(w+="\n"),w+="#define USE_EXACT_SRGB_CONVERSIONS"),w}}function E(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;switch(w){case 3:{const w=(ArrayBuffer,new Int8Array(p));return r&&w.set(new Int8Array(r)),w}case 0:{const w=(ArrayBuffer,new Uint8Array(p));return r&&w.set(new Uint8Array(r)),w}case 4:{const w=p instanceof ArrayBuffer?new Int16Array(p):new Int16Array(e?p/2:p);return r&&w.set(new Int16Array(r)),w}case 5:case 8:case 9:case 10:case 2:{const w=p instanceof ArrayBuffer?new Uint16Array(p):new Uint16Array(e?p/2:p);return r&&w.set(new Uint16Array(r)),w}case 6:{const w=p instanceof ArrayBuffer?new Int32Array(p):new Int32Array(e?p/4:p);return r&&w.set(new Int32Array(r)),w}case 7:case 11:case 12:case 13:case 14:case 15:{const w=p instanceof ArrayBuffer?new Uint32Array(p):new Uint32Array(e?p/4:p);return r&&w.set(new Uint32Array(r)),w}case 1:{const w=p instanceof ArrayBuffer?new Float32Array(p):new Float32Array(e?p/4:p);return r&&w.set(new Float32Array(r)),w}}const I=(ArrayBuffer,new Uint8Array(p));return r&&I.set(new Uint8Array(r)),I}},11132:(w,p,e)=>{e.d(p,{d:()=>a});var r=e(11051),I=e(11081),d=e(11139),f=e(11047),q=e(11088);class E{constructor(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,w&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(w){this._zOffset!==w&&(this._zOffset=w,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(w){this._zOffsetUnits!==w&&(this._zOffsetUnits=w,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(w){this._cullFace!==w&&(this._cullFace=w,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(w){this._cull!==w&&(this._cull=w,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(w){this._depthFunc!==w&&(this._depthFunc=w,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(w){this._depthMask!==w&&(this._depthMask=w,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(w){this._depthTest!==w&&(this._depthTest=w,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(w){this._frontFace!==w&&(this._frontFace=w,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(w){this.isDirty&&(this._isCullDirty&&(this.cull?w.enable(w.CULL_FACE):w.disable(w.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(w.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(w.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?w.enable(w.DEPTH_TEST):w.disable(w.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(w.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(w.enable(w.POLYGON_OFFSET_FILL),w.polygonOffset(this.zOffset,this.zOffsetUnits)):w.disable(w.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(w.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class j{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(w){this._func!==w&&(this._func=w,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(w){this._funcRef!==w&&(this._funcRef=w,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(w){this._funcMask!==w&&(this._funcMask=w,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(w){this._opStencilFail!==w&&(this._opStencilFail=w,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(w){this._opDepthFail!==w&&(this._opDepthFail=w,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(w){this._opStencilDepthPass!==w&&(this._opStencilDepthPass=w,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(w){this._mask!==w&&(this._mask=w,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(w){this._enabled!==w&&(this._enabled=w,this._isStencilTestDirty=!0)}constructor(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,w&&this.reset()}reset(){var w;this.stencilMaterial=void 0,null===(w=this.stencilGlobal)||void 0===w||w.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(w){var p;if(!w)return;const e=!this.useStencilGlobalOnly&&!(null===(p=this.stencilMaterial)||void 0===p||!p.enabled);this.enabled=e?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=e?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=e?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=e?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=e?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=e?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=e?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=e?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?w.enable(w.STENCIL_TEST):w.disable(w.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(w.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(w.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(w.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class X{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=X.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=X.KEEP,this.opDepthFail=X.KEEP,this.opStencilDepthPass=X.REPLACE}get stencilFunc(){return this.func}set stencilFunc(w){this.func=w}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(w){this.funcRef=w}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(w){this.funcMask=w}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(w){this.opStencilFail=w}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(w){this.opDepthFail=w}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(w){this.opStencilDepthPass=w}get stencilMask(){return this.mask}set stencilMask(w){this.mask=w}get stencilTest(){return this.enabled}set stencilTest(w){this.enabled=w}}X.ALWAYS=519,X.KEEP=7680,X.REPLACE=7681;class k{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(w){this._alphaBlend!==w&&(this._alphaBlend=w,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(w,p,e,r){this._blendConstants[0]===w&&this._blendConstants[1]===p&&this._blendConstants[2]===e&&this._blendConstants[3]===r||(this._blendConstants[0]=w,this._blendConstants[1]=p,this._blendConstants[2]=e,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(w,p,e,r){this._blendFunctionParameters[0]===w&&this._blendFunctionParameters[1]===p&&this._blendFunctionParameters[2]===e&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=w,this._blendFunctionParameters[1]=p,this._blendFunctionParameters[2]=e,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(w,p){this._blendEquationParameters[0]===w&&this._blendEquationParameters[1]===p||(this._blendEquationParameters[0]=w,this._blendEquationParameters[1]=p,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(w){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?w.enable(w.BLEND):w.disable(w.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(w.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(w.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(w.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var m=e(11094),J=e(11161),K=e(11075),y=e(11056),c=e(11120),s=e(11173);function O(w,p){if((0,K.i)()){const{requestAnimationFrame:e}=p||window;if("function"===typeof e)return e(w)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(w);return setTimeout(w,16)}class a{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(w){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(w){w!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=w,this._depthCullingState.depthFunc=w?518:515)}setColorWrite(w){w!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=w)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(w){if(w)return this.isNDCHalfZRange?w.IS_NDC_HALF_ZRANGE="":delete w.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?w.USE_REVERSE_DEPTHBUFFER="":delete w.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?w.USE_EXACT_SRGB_CONVERSIONS="":delete w.USE_EXACT_SRGB_CONVERSIONS);{let w="";return this.isNDCHalfZRange&&(w+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(w&&(w+="\n"),w+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(w&&(w+="\n"),w+="#define USE_EXACT_SRGB_CONVERSIONS"),w}}_rebuildInternalTextures(){const w=this._internalTexturesCache.slice();for(const p of w)p._rebuild()}_rebuildRenderTargetWrappers(){const w=this._renderTargetWrapperCache.slice();for(const p of w)p._rebuild()}_rebuildEffects(){for(const w in this._compiledEffects){const p=this._compiledEffects[w];p._pipelineContext=null,p._prepareEffect()}d.e.ResetCache()}_rebuildGraphicsResources(){var w;this.wipeCaches(!0),this._rebuildEffects(),null===(w=this._rebuildComputeEffects)||void 0===w||w.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){I.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(w){setTimeout((()=>{this._clearEmptyResources();const p=this._depthCullingState.depthTest,e=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,I=this._stencilState.stencilTest;w(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=p,this._depthCullingState.depthFunc=e,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=I,this._flagContextRestored()}),0)}get K(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(w){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(w){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const w=new Uint8Array(4),p=[w,w,w,w,w,w];this._emptyCubeTexture=this.createRawCubeTexture(p,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(w){if(!w)return this._activeRenderLoops.length=0,void this._cancelFrame();const p=this._activeRenderLoops.indexOf(w);p>=0&&(this._activeRenderLoops.splice(p,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const w=this._frameHandler;if(this._frameHandler=0,(0,K.i)()){const{cancelAnimationFrame:p}=this.getHostWindow()||window;if("function"===typeof p)return p(w)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(w);return clearTimeout(w)}}Jm(){this.onBeginFrameObservable.notifyObservers(this)}Km(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(w){this._maxFPS=w,void 0!==w&&(this._minFrameTime=w<=0?Number.MAX_VALUE:1e3/w)}_isOverFrameTime(w){if(!w||void 0===this._maxFPS)return!1;const p=w-this._lastFrameTime;return this._lastFrameTime=w,this._renderAccumulator+=p,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(w){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(w)){let w=!0;(this.K||!this.renderEvenInBackground&&this._windowIsBackground)&&(w=!1),w&&(this.Jm(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.Km())}}_renderLoop(w){this._processFrame(w),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let w=0;w<this._activeRenderLoops.length;w++){(0,this._activeRenderLoops[w])()}}_renderViews(){return!1}_queueNewFrame(w,p){return O(w,p)}runRenderLoop(w){-1===this._activeRenderLoops.indexOf(w)&&(this._activeRenderLoops.push(w),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(w){this._depthCullingState.depthTest=w}setZOffset(w){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-w:w}getZOffset(){const w=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-w:w}setZOffsetUnits(w){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-w:w}getZOffsetUnits(){const w=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-w:w}getHostWindow(){return(0,K.i)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(w){this._compatibilityMode=!0}_rebuildTextures(){for(const w of this.scenes)w._rebuildTextures();for(const w of this._virtualScenes)w._rebuildTextures()}_releaseRenderTargetWrapper(w){const p=this._renderTargetWrapperCache.indexOf(w);-1!==p&&this._renderTargetWrapperCache.splice(p,1)}get currentViewport(){return this._cachedViewport}setViewport(w,p,e){const r=p||this.getRenderWidth(),I=e||this.getRenderHeight(),d=w.x||0,f=w.y||0;this._cachedViewport=w,this._viewport(d*r,f*I,r*w.width,I*w.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(w){return new Path2D(w)}get description(){let w=this.name+this.version;return this._caps.parallelShaderCompile&&(w+=" - Parallel shader compilation"),w}_createTextureBase(w,p,e,d){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7?arguments[7]:void 0,X=arguments.length>8?arguments[8]:void 0,k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0,A=arguments.length>15?arguments[15]:void 0;const z="data:"===(w=w||"").substring(0,5),M="blob:"===w.substring(0,5),i=z&&-1!==w.indexOf(";base64,"),t=m||new J.d(this,1);t!==m&&(t.label=w.substring(0,60));const n=w;!this._transformTextureUrl||i||m||k||(w=this._transformTextureUrl(w)),n!==w&&(t._originalUrl=n);const l=w.lastIndexOf(".");let N=y||(l>-1?w.substring(l).toLowerCase():"");N.indexOf("?")>-1&&(N=N.split("?")[0]);const U=(0,s.b)(N,c);d&&d.addPendingData(t),t.url=w,t.generateMipMaps=!p,t.samplingMode=f,t.invertY=e,t._useSRGBBuffer=this._getUseSRGBBuffer(!!A,p),this._doNotHandleContextLost||(t._buffer=k);let v=null;q&&!m&&(v=t.onLoadedObservable.add(q)),m||this._internalTexturesCache.push(t);const R=(e,m)=>{d&&d.removePendingData(t),w===n?(v&&t.onLoadedObservable.remove(v),r.d.UseFallbackTexture&&w!==r.d.FallbackTexture&&this._createTextureBase(r.d.FallbackTexture,p,t.invertY,d,f,null,E,j,X,k,t),e=(e||"Unknown error")+(r.d.UseFallbackTexture?" - Fallback texture was used":""),t.onErrorObservable.notifyObservers({message:e,exception:m}),E&&E(e,m)):(I.c.Warn(`Failed to load ${w}, falling back to ${n}`),this._createTextureBase(n,p,t.invertY,d,f,q,E,j,X,k,t,K,y,c,O,A))};if(U){const p=async w=>{(await U).loadData(w,t,((w,p,e,r,I,q)=>{q?R("TextureLoader failed to load data"):j(t,N,d,{width:w,height:p},t.invertY,!e,r,(()=>(I(),!1)),f)}),O)};k?k instanceof ArrayBuffer?p(new Uint8Array(k)):ArrayBuffer.isView(k)?p(k):E&&E("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(w,(w=>{p(new Uint8Array(w))}),void 0,d?d.offlineProvider:void 0,!0,((w,p)=>{R("Unable to load "+(w&&w.responseURL,p))}))}else{const e=w=>{M&&!this._doNotHandleContextLost&&(t._buffer=w),j(t,N,d,w,t.invertY,p,!1,X,f)};!z||i?k&&("string"===typeof k.decoding||k.close)?e(k):a._FileToolsLoadImage(w||"",e,R,d?d.offlineProvider:null,c,t.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof k||k instanceof ArrayBuffer||ArrayBuffer.isView(k)||k instanceof Blob?a._FileToolsLoadImage(k,e,R,d?d.offlineProvider:null,c,t.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):k&&e(k)}return t}_rebuildBuffers(){for(const w of this._uniformBuffers)w._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,K.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const w in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,w)&&(this._boundTexturesCache[w]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(w){this._name=w}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(w){this._hardwareScalingLevel=w,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(w){this._doNotHandleContextLost=w}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(w,p,e){var I,d;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new E,this._stencilStateComposer=new j,this._stencilState=new X,this._alphaState=new k,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new y.d,this.onCanvasFocusObservable=new y.d,this.onNewSceneAddedObservable=new y.d,this.onResizeObservable=new y.d,this.onCanvasPointerOutObservable=new y.d,this.onEffectErrorObservable=new y.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new y.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=w=>this._renderLoop(w),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new y.d,this.onAfterShaderCompilationObservable=new y.d,this.onBeginFrameObservable=new y.d,this.onEndFrameObservable=new y.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new y.d,this.onContextRestoredObservable=new y.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.ue=new y.d,this.onReleaseEffectsObservable=new y.d,r.d.Instances.push(this),this.startTime=q.b.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,f.e.SetMatrixPrecision(!!p.useHighPrecisionMatrix),(0,K.h)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=e??!1,p.antialias=w??p.antialias,p.deterministicLockstep=p.deterministicLockstep??!1,p.lockstepMaxSteps=p.lockstepMaxSteps??4,p.timeStep=p.timeStep??1/60,p.stencil=p.stencil??!0,this._audioContext=(null===(I=p.audioEngineOptions)||void 0===I?void 0:I.audioContext)??null,this._audioDestination=(null===(d=p.audioEngineOptions)||void 0===d?void 0:d.audioDestination)??null,this.premultipliedAlpha=p.premultipliedAlpha??!0,this._doNotHandleContextLost=!!p.doNotHandleContextLost,this._isStencilEnable=!!p.stencil,this.useExactSrgbConversions=p.useExactSrgbConversions??!1;const m=(0,K.i)()&&window.devicePixelRatio||1,J=p.limitDeviceRatio||m;e=e||p.adaptToDeviceRatio||!1,this._hardwareScalingLevel=e?1/Math.min(J,m):1,this._lastDevicePixelRatio=m,this._creationOptions=p}resize(){let w,p,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const w=(0,K.i)()&&window.devicePixelRatio||1,p=this._lastDevicePixelRatio/w;this._lastDevicePixelRatio=w,this._hardwareScalingLevel*=p}if((0,K.i)()&&(0,K.f)())if(this._renderingCanvas){var r,I;const e=null===(r=(I=this._renderingCanvas).getBoundingClientRect)||void 0===r?void 0:r.call(I);w=this._renderingCanvas.clientWidth||(null===e||void 0===e?void 0:e.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,p=this._renderingCanvas.clientHeight||(null===e||void 0===e?void 0:e.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else w=window.innerWidth,p=window.innerHeight;else w=this._renderingCanvas?this._renderingCanvas.width:100,p=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(w/this._hardwareScalingLevel,p/this._hardwareScalingLevel,e)}setSize(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(w|=0,p|=0,!e&&this._renderingCanvas.width===w&&this._renderingCanvas.height===p)return!1;if(this._renderingCanvas.width=w,this._renderingCanvas.height=p,this.scenes){for(let w=0;w<this.scenes.length;w++){const p=this.scenes[w];for(let w=0;w<p.cameras.length;w++){p.cameras[w]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(w,p,e,r,I,d,f,q,E,j,X){throw(0,m.c)("engine.rawTexture")}createRawCubeTexture(w,p,e,r,I,d,f,q){throw(0,m.c)("engine.rawTexture")}createRawTexture3D(w,p,e,r,I,d,f,q,E,j,X){throw(0,m.c)("engine.rawTexture")}createRawTexture2DArray(w,p,e,r,I,d,f,q,E,j,X){throw(0,m.c)("engine.rawTexture")}_sharedInit(w){this._renderingCanvas=w}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const w=navigator.userAgent;this.hostInformation.isMobile=-1!==w.indexOf("Mobile")||-1!==w.indexOf("Mac")&&(0,K.f)()&&"ontouchend"in document},this._checkForMobile(),(0,K.i)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(w){return document.createElement("video")}_reportDrawCall(){var w;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(w=this._drawCalls)||void 0===w||w.addCount(p,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(w,p){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(w,p){return createImageBitmap(w,p)}resizeImageBitmap(w,p,e){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(w){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(w,p){if("undefined"===typeof document)return new OffscreenCanvas(w,p);const e=document.createElement("canvas");return e.width=w,e.height=p,e}createCanvas(w,p){return a._CreateCanvas(w,p)}static _FileToolsLoadImage(w,p,e,r,I,d,f){throw(0,m.c)("FileTools")}_loadFile(w,p,e,r,I,d){const f=(0,c.n)(w,p,e,r,I,d);return this._activeRequests.push(f),f.onCompleteObservable.add((()=>{const w=this._activeRequests.indexOf(f);-1!==w&&this._activeRequests.splice(w,1)})),f}static _FileToolsLoadFile(w,p,e,r,I,d){if(c.d.loadFile)return c.d.loadFile(w,p,e,r,I,d);throw(0,m.c)("FileTools")}dispose(){var w;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(w=this.releaseComputeEffects)||void 0===w||w.call(this),d.e.ResetCache();for(const e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.ue.notifyObservers(this),this.ue.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,K.i)()&&window.removeEventListener("resize",this._checkForMobile);const p=r.d.Instances.indexOf(this);p>=0&&r.d.Instances.splice(p,1),r.d.Instances.length||(r.d.OnEnginesDisposedObservable.notifyObservers(this),r.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(w){throw(0,m.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(w,p){for(let e=0;e<r.d.Instances.length;e++){const I=r.d.Instances[e];for(let e=0;e<I.scenes.length;e++)I.scenes[e].markAllMaterialsAsDirty(w,p)}}}a._RenderPassIdCounter=0,a._RescalePostProcessFactory=null,a.CollisionsEpsilon=.001,a.QueueNewFrame=O},11552:(w,p,e)=>{e.d(p,{c:()=>r});class r{}r.AUTOSAMPLERSUFFIX="Sampler",r.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",r.ALPHA_DISABLE=0,r.ALPHA_ADD=1,r.ALPHA_COMBINE=2,r.ALPHA_SUBTRACT=3,r.ALPHA_MULTIPLY=4,r.ALPHA_MAXIMIZED=5,r.ALPHA_ONEONE=6,r.ALPHA_PREMULTIPLIED=7,r.ALPHA_PREMULTIPLIED_PORTERDUFF=8,r.ALPHA_INTERPOLATE=9,r.ALPHA_SCREENMODE=10,r.ALPHA_ONEONE_ONEONE=11,r.ALPHA_ALPHATOCOLOR=12,r.ALPHA_REVERSEONEMINUS=13,r.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,r.ALPHA_ONEONE_ONEZERO=15,r.ALPHA_EXCLUSION=16,r.ALPHA_LAYER_ACCUMULATE=17,r.ALPHA_EQUATION_ADD=0,r.ALPHA_EQUATION_SUBSTRACT=1,r.ALPHA_EQUATION_REVERSE_SUBTRACT=2,r.ALPHA_EQUATION_MAX=3,r.ALPHA_EQUATION_MIN=4,r.ALPHA_EQUATION_DARKEN=5,r.DELAYLOADSTATE_NONE=0,r.DELAYLOADSTATE_LOADED=1,r.DELAYLOADSTATE_LOADING=2,r.DELAYLOADSTATE_NOTLOADED=4,r.NEVER=512,r.ALWAYS=519,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.GEQUAL=518,r.NOTEQUAL=517,r.KEEP=7680,r.ZERO=0,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.TEXTURE_CLAMP_ADDRESSMODE=0,r.TEXTURE_WRAP_ADDRESSMODE=1,r.TEXTURE_MIRROR_ADDRESSMODE=2,r.TEXTURE_CREATIONFLAG_STORAGE=1,r.TEXTUREFORMAT_ALPHA=0,r.TEXTUREFORMAT_LUMINANCE=1,r.TEXTUREFORMAT_LUMINANCE_ALPHA=2,r.TEXTUREFORMAT_RGB=4,r.TEXTUREFORMAT_RGBA=5,r.TEXTUREFORMAT_RED=6,r.TEXTUREFORMAT_R=6,r.TEXTUREFORMAT_R16_UNORM=33322,r.TEXTUREFORMAT_RG16_UNORM=33324,r.TEXTUREFORMAT_RGB16_UNORM=32852,r.TEXTUREFORMAT_RGBA16_UNORM=32859,r.TEXTUREFORMAT_R16_SNORM=36760,r.TEXTUREFORMAT_RG16_SNORM=36761,r.TEXTUREFORMAT_RGB16_SNORM=36762,r.TEXTUREFORMAT_RGBA16_SNORM=36763,r.TEXTUREFORMAT_RG=7,r.TEXTUREFORMAT_RED_INTEGER=8,r.TEXTUREFORMAT_R_INTEGER=8,r.TEXTUREFORMAT_RG_INTEGER=9,r.TEXTUREFORMAT_RGB_INTEGER=10,r.TEXTUREFORMAT_RGBA_INTEGER=11,r.TEXTUREFORMAT_BGRA=12,r.TEXTUREFORMAT_DEPTH24_STENCIL8=13,r.TEXTUREFORMAT_DEPTH32_FLOAT=14,r.TEXTUREFORMAT_DEPTH16=15,r.TEXTUREFORMAT_DEPTH24=16,r.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,r.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,r.TEXTUREFORMAT_STENCIL8=19,r.TEXTUREFORMAT_UNDEFINED=4294967295,r.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,r.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,r.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,r.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,r.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,r.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,r.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,r.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,r.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,r.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,r.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,r.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,r.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,r.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,r.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,r.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,r.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,r.TEXTURETYPE_UNSIGNED_BYTE=0,r.TEXTURETYPE_UNSIGNED_INT=0,r.TEXTURETYPE_FLOAT=1,r.TEXTURETYPE_HALF_FLOAT=2,r.TEXTURETYPE_BYTE=3,r.TEXTURETYPE_SHORT=4,r.TEXTURETYPE_UNSIGNED_SHORT=5,r.TEXTURETYPE_INT=6,r.TEXTURETYPE_UNSIGNED_INTEGER=7,r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,r.TEXTURETYPE_UNSIGNED_INT_24_8=12,r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,r.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,r.TEXTURETYPE_UNDEFINED=16,r.TEXTURE_2D=3553,r.TEXTURE_2D_ARRAY=35866,r.TEXTURE_CUBE_MAP=34067,r.TEXTURE_CUBE_MAP_ARRAY=3735928559,r.TEXTURE_3D=32879,r.TEXTURE_NEAREST_SAMPLINGMODE=1,r.TEXTURE_NEAREST_NEAREST=1,r.TEXTURE_BILINEAR_SAMPLINGMODE=2,r.TEXTURE_LINEAR_LINEAR=2,r.TEXTURE_TRILINEAR_SAMPLINGMODE=3,r.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,r.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,r.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,r.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,r.TEXTURE_NEAREST_LINEAR=7,r.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,r.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,r.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,r.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,r.TEXTURE_LINEAR_NEAREST=12,r.TEXTURE_EXPLICIT_MODE=0,r.TEXTURE_SPHERICAL_MODE=1,r.TEXTURE_PLANAR_MODE=2,r.TEXTURE_CUBIC_MODE=3,r.TEXTURE_PROJECTION_MODE=4,r.TEXTURE_SKYBOX_MODE=5,r.TEXTURE_INVCUBIC_MODE=6,r.TEXTURE_EQUIRECTANGULAR_MODE=7,r.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,r.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,r.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,r.TEXTURE_FILTERING_QUALITY_HIGH=64,r.TEXTURE_FILTERING_QUALITY_MEDIUM=16,r.TEXTURE_FILTERING_QUALITY_LOW=8,r.SCALEMODE_FLOOR=1,r.SCALEMODE_NEAREST=2,r.SCALEMODE_CEILING=3,r.MATERIAL_TextureDirtyFlag=1,r.MATERIAL_LightDirtyFlag=2,r.MATERIAL_FresnelDirtyFlag=4,r.MATERIAL_AttributesDirtyFlag=8,r.MATERIAL_MiscDirtyFlag=16,r.MATERIAL_PrePassDirtyFlag=32,r.MATERIAL_ImageProcessingDirtyFlag=64,r.MATERIAL_AllDirtyFlag=127,r.MATERIAL_TriangleFillMode=0,r.MATERIAL_WireFrameFillMode=1,r.MATERIAL_PointFillMode=2,r.MATERIAL_PointListDrawMode=3,r.MATERIAL_LineListDrawMode=4,r.MATERIAL_LineLoopDrawMode=5,r.MATERIAL_LineStripDrawMode=6,r.MATERIAL_TriangleStripDrawMode=7,r.MATERIAL_TriangleFanDrawMode=8,r.MATERIAL_ClockWiseSideOrientation=0,r.MATERIAL_CounterClockWiseSideOrientation=1,r.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,r.MATERIAL_DIFFUSE_MODEL_BURLEY=1,r.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,r.MATERIAL_DIFFUSE_MODEL_LEGACY=3,r.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,r.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,r.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,r.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,r.ACTION_NothingTrigger=0,r.ACTION_OnPickTrigger=1,r.ACTION_OnLeftPickTrigger=2,r.ACTION_OnRightPickTrigger=3,r.ACTION_OnCenterPickTrigger=4,r.ACTION_OnPickDownTrigger=5,r.ACTION_OnDoublePickTrigger=6,r.ACTION_OnPickUpTrigger=7,r.ACTION_OnPickOutTrigger=16,r.ACTION_OnLongPressTrigger=8,r.ACTION_OnPointerOverTrigger=9,r.ACTION_OnPointerOutTrigger=10,r.ACTION_OnEveryFrameTrigger=11,r.ACTION_OnIntersectionEnterTrigger=12,r.ACTION_OnIntersectionExitTrigger=13,r.ACTION_OnKeyDownTrigger=14,r.ACTION_OnKeyUpTrigger=15,r.PARTICLES_BILLBOARDMODE_Y=2,r.PARTICLES_BILLBOARDMODE_ALL=7,r.PARTICLES_BILLBOARDMODE_STRETCHED=8,r.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,r.MESHES_CULLINGSTRATEGY_STANDARD=0,r.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,r.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,r.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,r.SCENELOADER_NO_LOGGING=0,r.SCENELOADER_MINIMAL_LOGGING=1,r.SCENELOADER_SUMMARY_LOGGING=2,r.SCENELOADER_DETAILED_LOGGING=3,r.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,r.PREPASS_POSITION_TEXTURE_TYPE=1,r.PREPASS_VELOCITY_TEXTURE_TYPE=2,r.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,r.PREPASS_COLOR_TEXTURE_TYPE=4,r.PREPASS_DEPTH_TEXTURE_TYPE=5,r.PREPASS_NORMAL_TEXTURE_TYPE=6,r.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,r.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,r.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,r.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,r.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,r.PREPASS_ALBEDO_TEXTURE_TYPE=12,r.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,r.BUFFER_CREATIONFLAG_READ=1,r.BUFFER_CREATIONFLAG_WRITE=2,r.BUFFER_CREATIONFLAG_READWRITE=3,r.BUFFER_CREATIONFLAG_UNIFORM=4,r.BUFFER_CREATIONFLAG_VERTEX=8,r.BUFFER_CREATIONFLAG_INDEX=16,r.BUFFER_CREATIONFLAG_STORAGE=32,r.BUFFER_CREATIONFLAG_INDIRECT=64,r.RENDERPASS_MAIN=0,r.INPUT_ALT_KEY=18,r.INPUT_CTRL_KEY=17,r.INPUT_META_KEY1=91,r.INPUT_META_KEY2=92,r.INPUT_META_KEY3=93,r.INPUT_SHIFT_KEY=16,r.SNAPSHOTRENDERING_STANDARD=0,r.SNAPSHOTRENDERING_FAST=1,r.PERSPECTIVE_CAMERA=0,r.ORTHOGRAPHIC_CAMERA=1,r.FOVMODE_VERTICAL_FIXED=0,r.FOVMODE_HORIZONTAL_FIXED=1,r.RIG_MODE_NONE=0,r.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,r.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,r.RIG_MODE_STEREOSCOPIC_INTERLACED=14,r.RIG_MODE_VR=20,r.RIG_MODE_CUSTOM=22,r.MAX_SUPPORTED_UV_SETS=6,r.GL_ALPHA_EQUATION_ADD=32774,r.GL_ALPHA_EQUATION_MIN=32775,r.GL_ALPHA_EQUATION_MAX=32776,r.GL_ALPHA_EQUATION_SUBTRACT=32778,r.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,r.GL_ALPHA_FUNCTION_SRC=768,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,r.GL_ALPHA_FUNCTION_SRC_ALPHA=770,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,r.GL_ALPHA_FUNCTION_DST_ALPHA=772,r.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,r.GL_ALPHA_FUNCTION_DST_COLOR=774,r.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,r.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,r.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,r.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,r.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,r.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,r.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,r.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,r.SnippetUrl="https://snippet.babylonjs.com",r.FOGMODE_NONE=0,r.FOGMODE_EXP=1,r.FOGMODE_EXP2=2,r.FOGMODE_LINEAR=3,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.PositionKind="position",r.NormalKind="dp",r.TangentKind="tangent",r.UVKind="uv",r.UV2Kind="uv2",r.UV3Kind="uv3",r.UV4Kind="uv4",r.UV5Kind="uv5",r.UV6Kind="uv6",r.ColorKind="color",r.ColorInstanceKind="instanceColor",r.MatricesIndicesKind="matricesIndices",r.MatricesWeightsKind="matricesWeights",r.MatricesIndicesExtraKind="matricesIndicesExtra",r.MatricesWeightsExtraKind="matricesWeightsExtra",r.ANIMATIONTYPE_FLOAT=0,r.ANIMATIONTYPE_VECTOR3=1,r.ANIMATIONTYPE_QUATERNION=2,r.ANIMATIONTYPE_MATRIX=3,r.ANIMATIONTYPE_COLOR3=4,r.ANIMATIONTYPE_COLOR4=7,r.ANIMATIONTYPE_VECTOR2=5,r.ANIMATIONTYPE_SIZE=6,r.ShadowMinZ=0,r.ShadowMaxZ=1e4},11411:(w,p,e)=>{e.d(p,{e:()=>t});var r=e(11161),I=e(11051),d=e(11416),f=e(11088);class q{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new E(w)}sampleFrame(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.b.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const p=w-this._lastFrameTimeMs;this._rollingFrameTime.add(p)}this._lastFrameTimeMs=w}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const w=this._rollingFrameTime.history(0);return 0===w?0:1e3/w}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class E{constructor(w){this._samples=new Array(w),this.reset()}add(w){let p;if(this.isSaturated()){const w=this._samples[this._pos];p=w-this.average,this.average-=p/(this._sampleCount-1),this._m2-=p*(w-this.average)}else this._sampleCount++;p=w-this.average,this.average+=p/this._sampleCount,this._m2+=p*(w-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=w,this._pos++,this._pos%=this._samples.length}history(w){if(w>=this._sampleCount||w>=this._samples.length)return 0;const p=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(p-w)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(w){const p=this._samples.length;return(w%p+p)%p}}var j=e(11422),X=e(11081),k=e(11430),m=(e(11446),e(11194));function J(w,p,e,r){let I,d=1;1===r?I=new Float32Array(p*e*4):2===r?(I=new Uint16Array(p*e*4),d=15360):I=7===r?new Uint32Array(p*e*4):new Uint8Array(p*e*4);for(let f=0;f<p;f++)for(let r=0;r<e;r++){const e=3*(r*p+f),q=4*(r*p+f);I[q+0]=w[e+0],I[q+1]=w[e+1],I[q+2]=w[e+2],I[q+3]=d}return I}function K(w){return function(p,e,I,d,f,q,E,j){let X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const m=w?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,J=w?10:11,K=new r.d(this,J);K.baseWidth=e,K.baseHeight=I,K.baseDepth=d,K.width=e,K.height=I,K.depth=d,K.format=f,K.type=k,K.generateMipMaps=q,K.samplingMode=j,w?K.is3D=!0:K.is2DArray=!0,this._doNotHandleContextLost||(K._bufferView=p),w?this.updateRawTexture3D(K,p,f,E,X,k):this.updateRawTexture2DArray(K,p,f,E,X,k),this._bindTextureDirectly(m,K,!0);const y=this._getSamplingParameters(j,q);return this._gl.texParameteri(m,this._gl.TEXTURE_MAG_FILTER,y.mag),this._gl.texParameteri(m,this._gl.TEXTURE_MIN_FILTER,y.min),q&&this._gl.generateMipmap(m),this._bindTextureDirectly(m,null),this._internalTexturesCache.push(K),K}}function y(w){return function(p,e,r,I){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const q=w?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,E=this._getWebGLTextureType(f),j=this._getInternalFormat(r),X=this._getRGBABufferInternalSizedFormat(f,r);this._bindTextureDirectly(q,p,!0),this._unpackFlipY(void 0===I||!!I),this._doNotHandleContextLost||(p._bufferView=e,p.format=r,p.invertY=I,p._compression=d),p.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&e?this._gl.compressedTexImage3D(q,0,this.getCaps().s3tc[d],p.width,p.height,p.depth,0,e):this._gl.texImage3D(q,0,X,p.width,p.height,p.depth,0,j,E,e),p.generateMipMaps&&this._gl.generateMipmap(q),this._bindTextureDirectly(q,null),p.isReady=!0}}d.ThinEngine.prototype.updateRawTexture=function(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!w)return;const q=this._getRGBABufferInternalSizedFormat(d,e,f),E=this._getInternalFormat(e),j=this._getWebGLTextureType(d);this._bindTextureDirectly(this._gl.TEXTURE_2D,w,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(w._bufferView=p,w.format=e,w.type=d,w.invertY=r,w._compression=I),w.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),I&&p?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[I],w.width,w.height,0,p):this._gl.texImage2D(this._gl.TEXTURE_2D,0,q,w.width,w.height,0,E,j,p),w.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),w.isReady=!0},d.ThinEngine.prototype.createRawTexture=function(w,p,e,I,d,f,q){let E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,X=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const k=new r.d(this,3);k.baseWidth=p,k.baseHeight=e,k.width=p,k.height=e,k.format=I,k.generateMipMaps=d,k.samplingMode=q,k.invertY=f,k._compression=E,k.type=j,k._useSRGBBuffer=this._getUseSRGBBuffer(X,!d),this._doNotHandleContextLost||(k._bufferView=w),this.updateRawTexture(k,w,I,f,E,j,k._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,k,!0);const m=this._getSamplingParameters(q,d);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,m.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,m.min),d&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(k),k},d.ThinEngine.prototype.createRawCubeTexture=function(w,p,e,I,d,f,q){let E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const j=this._gl,k=new r.d(this,8);k.isCube=!0,k.format=e,k.type=I,this._doNotHandleContextLost||(k._bufferViewArray=w);const J=this._getWebGLTextureType(I);let K=this._getInternalFormat(e);K===j.RGB&&(K=j.RGBA),J!==j.FLOAT||this._caps.textureFloatLinearFiltering?J!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?J!==j.FLOAT||this._caps.textureFloatRender?J!==j.HALF_FLOAT||this._caps.colorBufferFloat||(d=!1,X.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(d=!1,X.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(d=!1,q=1,X.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(d=!1,q=1,X.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const y=p,c=y;k.width=y,k.height=c,k.invertY=f,k._compression=E;if(!this.needPOTTextures||(0,m.i)(k.width)&&(0,m.i)(k.height)||(d=!1),w)this.updateRawCubeTexture(k,w,e,I,f,E);else{const w=this._getRGBABufferInternalSizedFormat(I),p=0;this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,k,!0);for(let e=0;e<6;e++)E?j.compressedTexImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+e,p,this.getCaps().s3tc[E],k.width,k.height,0,void 0):j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+e,p,w,k.width,k.height,0,K,J,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,k,!0),w&&d&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const s=this._getSamplingParameters(q,d);return j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,s.mag),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,s.min),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null),k.generateMipMaps=d,k.samplingMode=q,k.isReady=!0,k},d.ThinEngine.prototype.updateRawCubeTexture=function(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;w._bufferViewArray=p,w.format=e,w.type=r,w.invertY=I,w._compression=d;const q=this._gl,E=this._getWebGLTextureType(r);let j=this._getInternalFormat(e);const X=this._getRGBABufferInternalSizedFormat(r);let k=!1;j===q.RGB&&(j=q.RGBA,k=!0),this._bindTextureDirectly(q.TEXTURE_CUBE_MAP,w,!0),this._unpackFlipY(void 0===I||!!I),w.width%4!==0&&q.pixelStorei(q.UNPACK_ALIGNMENT,1);for(let m=0;m<6;m++){let e=p[m];d?q.compressedTexImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+m,f,this.getCaps().s3tc[d],w.width,w.height,0,e):(k&&(e=J(e,w.width,w.height,r)),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+m,f,X,w.width,w.height,0,j,E,e))}(!this.needPOTTextures||(0,m.i)(w.width)&&(0,m.i)(w.height))&&w.generateMipMaps&&0===f&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),w.isReady=!0},d.ThinEngine.prototype.createRawCubeTextureFromUrl=function(w,p,e,r,I,d,f,q){let E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,k=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const m=this._gl,K=this.createRawCubeTexture(null,e,r,I,!d,k,X,null);null===p||void 0===p||p.addPendingData(K),K.url=w,K.isReady=!1,this._internalTexturesCache.push(K);const y=w=>{if(!K._hardwareTexture)return;const e=K.width,d=f(w);if(d){if(q){const w=this._getWebGLTextureType(I);let p=this._getInternalFormat(r);const f=this._getRGBABufferInternalSizedFormat(I);let E=!1;p===m.RGB&&(p=m.RGBA,E=!0),this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,K,!0),this._unpackFlipY(!1);const j=q(d);for(let r=0;r<j.length;r++){const d=e>>r;for(let e=0;e<6;e++){let q=j[r][e];E&&(q=J(q,d,d,I)),m.texImage2D(e,r,f,d,d,0,p,w,q)}}this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(K,d,r,I,k);K.isReady=!0,null===p||void 0===p||p.removePendingData(K),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear(),E&&E()}};return this._loadFile(w,(w=>{y(w)}),void 0,null===p||void 0===p?void 0:p.offlineProvider,!0,((w,e)=>{null===p||void 0===p||p.removePendingData(K),j&&w&&j(w.status+" "+w.statusText,e)})),K},d.ThinEngine.prototype.createRawTexture2DArray=K(!1),d.ThinEngine.prototype.createRawTexture3D=K(!0),d.ThinEngine.prototype.updateRawTexture2DArray=y(!1),d.ThinEngine.prototype.updateRawTexture3D=y(!0);var c=e(11120);d.ThinEngine.prototype._readTexturePixelsSync=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const X=this._gl;if(!X)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const w=X.createFramebuffer();if(!w)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=w}var k,m;(X.bindFramebuffer(X.FRAMEBUFFER,this._dummyFramebuffer),r>-1)?X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+r,null===(k=w._hardwareTexture)||void 0===k?void 0:k.underlyingResource,I):X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,null===(m=w._hardwareTexture)||void 0===m?void 0:m.underlyingResource,I);let J=void 0!==w.type?this._getWebGLTextureType(w.type):X.UNSIGNED_BYTE;if(q)d||(d=(0,c.o)(w.type,4*p*e));else if(J===X.UNSIGNED_BYTE)d||(d=new Uint8Array(4*p*e)),J=X.UNSIGNED_BYTE;else d||(d=new Float32Array(4*p*e)),J=X.FLOAT;return f&&this.flushFramebuffer(),X.readPixels(E,j,p,e,X.RGBA,J,d),X.bindFramebuffer(X.FRAMEBUFFER,this._currentFramebuffer),d},d.ThinEngine.prototype._readTexturePixels=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(w,p,e,r,I,d,f,q,E,j))};e(11448);d.ThinEngine.prototype._createDepthStencilCubeTexture=function(w,p){const e=new r.d(this,12);if(e.isCube=!0,1===this.webGLVersion)return X.c.Error("Depth cube texture is not supported by WebGL 1."),e;const I={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...p},d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,e,!0),this._setupDepthStencilTexture(e,w,I.bilinearFiltering,I.comparisonFunction);for(let r=0;r<6;r++)I.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,d.DEPTH24_STENCIL8,w,w,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,d.DEPTH_COMPONENT24,w,w,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);return this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(e),e},d.ThinEngine.prototype._setCubeMapTextureParams=function(w,p,e){const r=this._gl;r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,p?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),w.samplingMode=p?3:2,p&&this.getCaps().textureMaxLevel&&void 0!==e&&e>0&&(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAX_LEVEL,e),w._maxLodLevel=e),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)},d.ThinEngine.prototype.createCubeTexture=function(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,K=arguments.length>13&&void 0!==arguments[13]&&arguments[13],y=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const c=this._gl;return this.createCubeTextureBase(w,p,e,!!r,I,d,f,q,E,j,k,J,(w=>this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,w,!0)),((w,p)=>{const e=this.needPOTTextures?(0,m.f)(p[0].width,this._caps.maxCubemapTextureSize):p[0].width,d=e,q=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,w,!0),this._unpackFlipY(!1);const E=f?this._getInternalFormat(f,w._useSRGBBuffer):w._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:c.RGBA;let j=f?this._getInternalFormat(f):c.RGBA;w._useSRGBBuffer&&1===this.webGLVersion&&(j=E);for(let r=0;r<q.length;r++)if(p[r].width!==e||p[r].height!==d){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void X.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=e,this._workingCanvas.height=d,this._workingContext.drawImage(p[r],0,0,p[r].width,p[r].height,0,0,e,d),c.texImage2D(q[r],0,E,j,c.UNSIGNED_BYTE,this._workingCanvas)}else c.texImage2D(q[r],0,E,j,c.UNSIGNED_BYTE,p[r]);r||c.generateMipmap(c.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(w,!r),w.width=e,w.height=d,w.isReady=!0,f&&(w.format=f),w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear(),I&&I()}),!!K,y)},d.ThinEngine.prototype.generateMipMapsForCubemap=function(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(w.generateMipMaps){const e=this._gl;this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,w,!0),e.generateMipmap(e.TEXTURE_CUBE_MAP),p&&this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null)}};e(11457);d.ThinEngine.prototype.setDepthStencilTexture=function(w,p,e,r){void 0!==w&&(p&&(this._boundUniforms[w]=p),e&&e.depthStencilTexture?this._setTexture(w,e,!1,!0,r):this._setTexture(w,null,void 0,void 0,r))},d.ThinEngine.prototype.createRenderTargetCubeTexture=function(w,p){const e=this._createHardwareRenderTargetWrapper(!1,!0,w),I={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...p};I.generateStencilBuffer=I.generateDepthBuffer&&I.generateStencilBuffer,(1!==I.type||this._caps.textureFloatLinearFiltering)&&(2!==I.type||this._caps.textureHalfFloatLinearFiltering)||(I.samplingMode=1);const d=this._gl,f=new r.d(this,5);this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,f,!0);const q=this._getSamplingParameters(I.samplingMode,I.generateMipMaps);1!==I.type||this._caps.textureFloat||(I.type=0,X.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,q.mag),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,q.min),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);for(let r=0;r<6;r++)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this._getRGBABufferInternalSizedFormat(I.type,I.format),w,w,0,this._getInternalFormat(I.format),this._getWebGLTextureType(I.type),null);const E=d.createFramebuffer();return this._bindUnboundFramebuffer(E),e._depthStencilBuffer=this._setupFramebufferDepthAttachments(I.generateStencilBuffer,I.generateDepthBuffer,w,w),I.generateMipMaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),e._framebuffer=E,e._generateDepthBuffer=I.generateDepthBuffer,e._generateStencilBuffer=I.generateStencilBuffer,f.width=w,f.height=w,f.isReady=!0,f.isCube=!0,f.samples=1,f.generateMipMaps=I.generateMipMaps,f.samplingMode=I.samplingMode,f.type=I.type,f.format=I.format,this._internalTexturesCache.push(f),e.setTextures(f),e};var s=e(11475),O=e(11494);d.ThinEngine.prototype.createPrefilteredCubeTexture=function(w,p,I,d){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(w,p,null,!1,(async w=>{if(!w)return void(f&&f(null));const q=w.texture;if(k?w.info.sphericalPolynomial&&(q._sphericalPolynomial=w.info.sphericalPolynomial):q._sphericalPolynomial=new s.h,q._source=9,this.getCaps().textureLOD)return void(f&&f(q));const E=this._gl,j=w.width;if(!j)return;const{DDSTools:m}=await e.e(26).then(e.bind(e,13635)),J=[];for(let e=0;e<3;e++){const f=1-e/2,k=d,K=Math.log2(j)*I+d,y=k+(K-k)*f,c=Math.round(Math.min(Math.max(y,0),K)),s=new r.d(this,2);if(s.type=q.type,s.format=q.format,s.width=Math.pow(2,Math.max(Math.log2(j)-c,0)),s.height=s.width,s.isCube=!0,s._cachedWrapU=0,s._cachedWrapV=0,this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,s,!0),s.samplingMode=2,E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),w.isDDS){const p=w.info,e=w.data;this._unpackFlipY(p.isCompressed),m.UploadDDSLevels(this,s,e,p,!0,6,c)}else X.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null);const a=new O.b(p);a._isCube=!0,a._texture=s,s.isReady=!0,J.push(a)}q._lodTextureHigh=J[2],q._lodTextureMid=J[1],q._lodTextureLow=J[0],f&&f(q)}),q,E,j,k,I,d)},d.ThinEngine.prototype.createUniformBuffer=function(w,p){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create uniform buffer");const r=new j.c(e);return this.bindUniformBuffer(r),w instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,w,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(w),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},d.ThinEngine.prototype.createDynamicUniformBuffer=function(w,p){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create dynamic uniform buffer");const r=new j.c(e);return this.bindUniformBuffer(r),w instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,w,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(w),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},d.ThinEngine.prototype.updateUniformBuffer=function(w,p,e,r){this.bindUniformBuffer(w),void 0===e&&(e=0),void 0===r?p instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,p):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,new Float32Array(p)):p instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,p.subarray(e,e+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(p).subarray(e,e+r)),this.bindUniformBuffer(null)},d.ThinEngine.prototype.bindUniformBuffer=function(w){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,w?w.underlyingResource:null)},d.ThinEngine.prototype.bindUniformBufferBase=function(w,p,e){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,p,w?w.underlyingResource:null)},d.ThinEngine.prototype.bindUniformBlock=function(w,p,e){const r=w.program,I=this._gl.getUniformBlockIndex(r,p);4294967295!==I&&this._gl.uniformBlockBinding(r,I,e)};var a=e(11075),A=e(11132);A.d.prototype.displayLoadingUI=function(){if(!(0,a.i)())return;const w=this.loadingScreen;w&&w.displayLoadingUI()},A.d.prototype.hideLoadingUI=function(){if(!(0,a.i)())return;const w=this._loadingScreen;w&&w.hideLoadingUI()},Object.defineProperty(A.d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=A.d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(w){this._loadingScreen=w},enumerable:!0,configurable:!0}),Object.defineProperty(A.d.prototype,"loadingUIText",{set:function(w){this.loadingScreen.loadingUIText=w},enumerable:!0,configurable:!0}),Object.defineProperty(A.d.prototype,"loadingUIBackgroundColor",{set:function(w){this.loadingScreen.loadingUIBackgroundColor=w},enumerable:!0,configurable:!0}),A.d.prototype.getInputElement=function(){return this._renderingCanvas},A.d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},A.d.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},A.d.prototype.getAspectRatio=function(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=w.viewport;return this.getRenderWidth(p)*e.width/(this.getRenderHeight(p)*e.height)},A.d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},A.d.prototype._verifyPointerLock=function(){var w;null===(w=this._onPointerLockChange)||void 0===w||w.call(this)},A.d.prototype.setAlphaEquation=function(w){if(this._alphaEquation!==w){switch(w){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=w}},A.d.prototype.getInputElement=function(){return this._renderingCanvas},A.d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},A.d.prototype.setDepthFunction=function(w){this._depthCullingState.depthFunc=w},A.d.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},A.d.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},A.d.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},A.d.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},A.d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},A.d.prototype.setDepthWrite=function(w){this._depthCullingState.depthMask=w},A.d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},A.d.prototype.setStencilBuffer=function(w){this._stencilState.stencilTest=w},A.d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},A.d.prototype.setStencilMask=function(w){this._stencilState.stencilMask=w},A.d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},A.d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},A.d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},A.d.prototype.setStencilFunction=function(w){this._stencilState.stencilFunc=w},A.d.prototype.setStencilFunctionReference=function(w){this._stencilState.stencilFuncRef=w},A.d.prototype.setStencilFunctionMask=function(w){this._stencilState.stencilFuncMask=w},A.d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},A.d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},A.d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},A.d.prototype.setStencilOperationFail=function(w){this._stencilState.stencilOpStencilFail=w},A.d.prototype.setStencilOperationDepthFail=function(w){this._stencilState.stencilOpDepthFail=w},A.d.prototype.setStencilOperationPass=function(w){this._stencilState.stencilOpStencilDepthPass=w},A.d.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},A.d.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},A.d.prototype.setAlphaConstants=function(w,p,e,r){this._alphaState.setAlphaBlendConstants(w,p,e,r)},A.d.prototype.getAlphaMode=function(){return this._alphaMode},A.d.prototype.getAlphaEquation=function(){return this._alphaEquation},A.d.prototype.getRenderPassNames=function(){return this._renderPassNames},A.d.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},A.d.prototype.createRenderPassId=function(w){const p=++A.d._RenderPassIdCounter;return this._renderPassNames[p]=w??"NONAME",p},A.d.prototype.releaseRenderPassId=function(w){this._renderPassNames[w]=void 0;for(let p=0;p<this.scenes.length;++p){const e=this.scenes[p];for(let p=0;p<e.meshes.length;++p){const r=e.meshes[p];if(r.oe)for(let p=0;p<r.oe.length;++p){r.oe[p]._removeDrawWrapper(w)}}}};e(11471);function z(w){if(w.requestPointerLock){const p=w.requestPointerLock();p instanceof Promise?p.then((()=>{w.focus()})).catch((()=>{})):w.focus()}}var M=e(11496),i=e(11127);class t extends d.ThinEngine{static get NpmPackage(){return A.d.NpmPackage}static get Version(){return A.d.Version}static get Instances(){return I.d.Instances}static get LastCreatedEngine(){return I.d.LastCreatedEngine}static get LastCreatedScene(){return I.d.LastCreatedScene}static DefaultLoadingScreenFactory(w){return A.d.DefaultLoadingScreenFactory(w)}get _supportsHardwareTextureRescaling(){return!!t._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(w,p,e){super(w,p,e,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new q,this._drawCalls=new M.d,w&&(this._features.supportRenderPasses=!0,e=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(w){super._sharedInit(w),function(w,p,e){w._onCanvasFocus=()=>{w.onCanvasFocusObservable.notifyObservers(w)},w._onCanvasBlur=()=>{w.onCanvasBlurObservable.notifyObservers(w)},w._onCanvasContextMenu=p=>{w.disableContextMenu&&p.preventDefault()},p.addEventListener("focus",w._onCanvasFocus),p.addEventListener("blur",w._onCanvasBlur),p.addEventListener("contextmenu",w._onCanvasContextMenu),w._onBlur=()=>{w.disablePerformanceMonitorInBackground&&w.performanceMonitor.disable(),w._windowIsBackground=!0},w._onFocus=()=>{w.disablePerformanceMonitorInBackground&&w.performanceMonitor.enable(),w._windowIsBackground=!1},w._onCanvasPointerOut=e=>{document.elementFromPoint(e.clientX,e.clientY)!==p&&w.onCanvasPointerOutObservable.notifyObservers(e)};const r=w.getHostWindow();r&&"function"===typeof r.addEventListener&&(r.addEventListener("blur",w._onBlur),r.addEventListener("focus",w._onFocus)),p.addEventListener("pointerout",w._onCanvasPointerOut),e.doNotHandleTouchAction||function(w){w&&w.setAttribute&&(w.setAttribute("touch-action","none"),w.style.touchAction="none",w.style.webkitTapHighlightColor="transparent")}(p),!A.d.audioEngine&&e.audioEngine&&A.d.AudioEngineFactory&&(A.d.audioEngine=A.d.AudioEngineFactory(w.getRenderingCanvas(),w.getAudioContext(),w.getAudioDestination())),(0,a.f)()&&(w._onFullscreenChange=()=>{w.isFullscreen=!!document.fullscreenElement,w.isFullscreen&&w._pointerLockRequested&&p&&z(p)},document.addEventListener("fullscreenchange",w._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",w._onFullscreenChange,!1),w._onPointerLockChange=()=>{w.isPointerLock=document.pointerLockElement===p},document.addEventListener("pointerlockchange",w._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",w._onPointerLockChange,!1)),w.enableOfflineSupport=void 0!==A.d.OfflineProviderFactory,w._deterministicLockstep=!!e.deterministicLockstep,w._lockstepMaxSteps=e.lockstepMaxSteps||0,w._timeStep=e.timeStep||1/60}(this,w,this._creationOptions)}resizeImageBitmap(w,p,e){return function(w,p,e,r){const I=w.createCanvas(e,r).getContext("2d");if(!I)throw new Error("Unable to get 2d context for resizeImageBitmap");return I.drawImage(p,0,0),I.getImageData(0,0,e,r).data}(this,w,p,e)}async _createImageBitmapFromSource(w,p){return await async function(w,p,e){return await new Promise(((r,I)=>{const d=new Image;d.onload=()=>{d.decode().then((()=>{w.createImageBitmap(d,e).then((w=>{r(w)}))}))},d.onerror=()=>{I(`Error loading image ${d.src}`)},d.src=p}))}(this,w,p)}switchFullscreen(w){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(w)}enterFullscreen(w){this.isFullscreen||(this._pointerLockRequested=w,this._renderingCanvas&&function(w){const p=w.requestFullscreen||w.webkitRequestFullscreen;p&&p.call(w)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const w=document;document.exitFullscreen?document.exitFullscreen():w.webkitCancelFullScreen&&w.webkitCancelFullScreen()}()}setDitheringState(w){w?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(w){w?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(w,p,e,r){const I=this._cachedViewport;return this._cachedViewport=null,this._viewport(w,p,e,r),I}scissorClear(w,p,e,r,I){this.enableScissor(w,p,e,r),this.clear(I,!0,!0,!0),this.disableScissor()}enableScissor(w,p,e,r){const I=this._gl;I.enable(I.SCISSOR_TEST),I.scissor(w,p,e,r)}disableScissor(){const w=this._gl;w.disable(w.SCISSOR_TEST)}async _loadFileAsync(w,p,e){return await new Promise(((r,I)=>{this._loadFile(w,(w=>{r(w)}),void 0,p,e,((w,p)=>{I(p)}))}))}getVertexShaderSource(w){const p=this._gl.getAttachedShaders(w);return p?this._gl.getShaderSource(p[0]):null}getFragmentShaderSource(w){const p=this._gl.getAttachedShaders(w);return p?this._gl.getShaderSource(p[1]):null}set framebufferDimensionsObject(w){this._framebufferDimensionsObject=w,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const w of this.scenes)w.resetCachedMaterial(),w._rebuildGeometries();for(const w of this._virtualScenes)w.resetCachedMaterial(),w._rebuildGeometries();super._rebuildBuffers()}getFontOffset(w){return function(w){const p=document.createElement("span");p.textContent="Hg",p.style.font=w;const e=document.createElement("div");e.style.display="inline-block",e.style.width="1px",e.style.height="0px",e.style.verticalAlign="bottom";const r=document.createElement("div");r.style.whiteSpace="nowrap",r.appendChild(p),r.appendChild(e),document.body.appendChild(r);let I=0,d=0;try{d=e.getBoundingClientRect().top-p.getBoundingClientRect().top,e.style.verticalAlign="baseline",I=e.getBoundingClientRect().top-p.getBoundingClientRect().top}finally{document.body.removeChild(r)}return{ascent:I,height:d,descent:d-I}}(w)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:w}=this.customAnimationFrameRequester;w&&w(this.customAnimationFrameRequester.O)}}else super._cancelFrame()}_renderLoop(w){this._processFrame(w),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.O=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.O):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&z(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Jm(){this._measureFps(),super.Jm()}_deletePipelineContext(w){const p=w;p&&p.program&&p.transformFeedback&&(this.deleteTransformFeedback(p.transformFeedback),p.transformFeedback=null),super._deletePipelineContext(w)}createShaderProgram(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;I=I||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const f=super.createShaderProgram(w,p,e,r,I,d);return this.onAfterShaderCompilationObservable.notifyObservers(this),f}_createShaderProgram(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const d=r.createProgram();if(w.program=d,!d)throw new Error("Unable to create program");if(r.attachShader(d,p),r.attachShader(d,e),this.webGLVersion>1&&I){const p=this.createTransformFeedback();this.bindTransformFeedback(p),this.setTranformFeedbackVaryings(d,I),w.transformFeedback=p}return r.linkProgram(d),this.webGLVersion>1&&I&&this.bindTransformFeedback(null),w.context=r,w.vertexShader=p,w.fragmentShader=e,w.isParallelCompiled||this._finalizePipelineContext(w),d}_releaseTexture(w){super._releaseTexture(w)}_releaseRenderTargetWrapper(w){super._releaseRenderTargetWrapper(w);for(const p of this.scenes){for(const e of p.postProcesses)e._outputTexture===w&&(e._outputTexture=null);for(const e of p.cameras)for(const p of e._postProcesses)p&&p._outputTexture===w&&(p._outputTexture=null)}}_rescaleTexture(w,p,e,r,I){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const d=this.createRenderTargetTexture({width:p.width,height:p.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const f=()=>{this._rescalePostProcess.onApply=function(p){p._bindTexture("textureSampler",w)};let f=e;f||(f=this.scenes[this.scenes.length-1]),f.postProcessManager.directRender([this._rescalePostProcess],d,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,p,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,r,0,0,p.width,p.height,0),this.unBindFramebuffer(d),d.dispose(),I&&I()},q=this._rescalePostProcess.getEffect();q?q.executeWhenCompiled(f):this._rescalePostProcess.onEffectCreatedObservable.addOnce((w=>{w.executeWhenCompiled(f)}))}}wrapWebGLTexture(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const f=new k.e(w,this._gl),q=new r.d(this,0,!0);return q._hardwareTexture=f,q.baseWidth=I,q.baseHeight=d,q.width=I,q.height=d,q.isReady=!0,q.useMipMaps=p,this.updateTextureSamplingMode(e,q),q}_uploadImageToTexture(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const I=this._gl,d=this._getWebGLTextureType(w.type),f=this._getInternalFormat(w.format),q=this._getRGBABufferInternalSizedFormat(w.type,f),E=w.isCube?I.TEXTURE_CUBE_MAP:I.TEXTURE_2D;this._bindTextureDirectly(E,w,!0),this._unpackFlipY(w.invertY);let j=I.TEXTURE_2D;w.isCube&&(j=I.TEXTURE_CUBE_MAP_POSITIVE_X+e),I.texImage2D(j,r,q,f,d,p),this._bindTextureDirectly(E,null,!0)}updateTextureComparisonFunction(w,p){if(1===this.webGLVersion)return void X.c.Error("WebGL 1 does not support texture comparison.");const e=this._gl;w.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,w,!0),0===p?(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,515),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.NONE)):(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,p),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,w,!0),0===p?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_FUNC,515),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_MODE,e.NONE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_FUNC,p),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),w._comparisonFunction=p}createInstancesBuffer(w){const p=this._gl.createBuffer();if(!p)throw new Error("Unable to create instance buffer");const e=new j.c(p);return e.eq=w,this.bindArrayBuffer(e),this._gl.bufferData(this._gl.ARRAY_BUFFER,w,this._gl.DYNAMIC_DRAW),e.references=1,e}deleteInstancesBuffer(w){this._gl.deleteBuffer(w)}async _clientWaitAsync(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const r=this._gl;return await new Promise(((I,d)=>{(0,i.g)((()=>{const e=r.clientWaitSync(w,p,0);if(e==r.WAIT_FAILED)throw new Error("clientWaitSync failed");return e!=r.TIMEOUT_EXPIRED}),I,d,e)}))}_readPixelsAsync(w,p,e,r,I,d,f){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const q=this._gl,E=q.createBuffer();q.bindBuffer(q.PIXEL_PACK_BUFFER,E),q.bufferData(q.PIXEL_PACK_BUFFER,f.byteLength,q.STREAM_READ),q.readPixels(w,p,e,r,I,d,0),q.bindBuffer(q.PIXEL_PACK_BUFFER,null);const j=q.fenceSync(q.SYNC_GPU_COMMANDS_COMPLETE,0);return j?(q.flush(),this._clientWaitAsync(j,0,10).then((()=>(q.deleteSync(j),q.bindBuffer(q.PIXEL_PACK_BUFFER,E),q.getBufferSubData(q.PIXEL_PACK_BUFFER,0,f),q.bindBuffer(q.PIXEL_PACK_BUFFER,null),q.deleteBuffer(E),f)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(w,p){1===I.d.Instances.length&&A.d.audioEngine&&(A.d.audioEngine.dispose(),A.d.audioEngine=null);const e=w.getHostWindow();e&&"function"===typeof e.removeEventListener&&(e.removeEventListener("blur",w._onBlur),e.removeEventListener("focus",w._onFocus)),p&&(p.removeEventListener("focus",w._onCanvasFocus),p.removeEventListener("blur",w._onCanvasBlur),p.removeEventListener("pointerout",w._onCanvasPointerOut),p.removeEventListener("contextmenu",w._onCanvasContextMenu)),(0,a.f)()&&(document.removeEventListener("fullscreenchange",w._onFullscreenChange),document.removeEventListener("mozfullscreenchange",w._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",w._onFullscreenChange),document.removeEventListener("msfullscreenchange",w._onFullscreenChange),document.removeEventListener("pointerlockchange",w._onPointerLockChange),document.removeEventListener("mspointerlockchange",w._onPointerLockChange),document.removeEventListener("mozpointerlockchange",w._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",w._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_R16_UNORM=33322,t.TEXTUREFORMAT_RG16_UNORM=33324,t.TEXTUREFORMAT_RGB16_UNORM=32852,t.TEXTUREFORMAT_RGBA16_UNORM=32859,t.TEXTUREFORMAT_R16_SNORM=36760,t.TEXTUREFORMAT_RG16_SNORM=36761,t.TEXTUREFORMAT_RGB16_SNORM=36762,t.TEXTUREFORMAT_RGBA16_SNORM=36763,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3},11051:(w,p,e)=>{e.d(p,{d:()=>I});var r=e(11056);class I{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}I.Instances=[],I.OnEnginesDisposedObservable=new r.d,I._LastCreatedScene=null,I.UseFallbackTexture=!0,I.FallbackTexture=""},11047:(w,p,e)=>{e.d(p,{e:()=>r});class r{static SetMatrixPrecision(w){if(r.MatrixTrackPrecisionChange=!1,w&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(let p=0;p<r.MatrixTrackedMatrices.length;++p){const w=r.MatrixTrackedMatrices[p],e=w.gm;w.gm=new Array(16);for(let p=0;p<16;++p)w.gm[p]=e[p]}r.MatrixUse64Bits=w,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null}}r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[]},11464:(w,p,e)=>{e.d(p,{d:()=>I});var r=e(11437);class I{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(w){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=w,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,w&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,r.c)(w.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var w;return(null===(w=this._textures)||void 0===w?void 0:w[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(w){var p,e;if(!this._textures)return-1;const r=this._textures[w],I=(null===(p=this._layerIndices)||void 0===p?void 0:p[w])??0,d=(null===(e=this._faceIndices)||void 0===e?void 0:e[w])??0;return r.isCube?6*I+d:r.is3D?0:I}get samples(){return this._samples}setSamples(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===w&&!e)return w;const r=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,w,p):this._engine.updateRenderTargetTextureSampleCount(this,w);return this._samples=w,r}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(w,p,e,r,I){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=w,this._isCube=p,this._size=e,this._engine=r,this._depthStencilTexture=null,this.label=I}setTextures(w){Array.isArray(w)?this._textures=w:this._textures=w?[w]:null}setTexture(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[p]!==w&&(this._textures[p]&&e&&this._textures[p].dispose(),this._textures[p]=w)}setLayerAndFaceIndices(w,p){this._layerIndices=w,this._faceIndices=p}setLayerAndFaceIndex(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==p&&p>=0&&(this._layerIndices[w]=p),void 0!==e&&e>=0&&(this._faceIndices[w]=e)}createDepthStencilTexture(){var w;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,f=arguments.length>5?arguments[5]:void 0;return null===(w=this._depthStencilTexture)||void 0===w||w.dispose(),this._depthStencilTextureWithStencil=r,this._depthStencilTextureLabel=f,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:e,comparisonFunction:p,generateStencil:r,isCube:this._isCube,samples:I,depthTextureFormat:d,label:f},this),this._depthStencilTexture}_shareDepth(w){this.shareDepth(w)}shareDepth(w){this._depthStencilTexture&&(w._depthStencilTexture&&w._depthStencilTexture.dispose(),w._depthStencilTexture=this._depthStencilTexture,w._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(w){this.texture&&this.texture._swapAndDie(w),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let w=null;if(this._isMulti){const p=this.textures;if(p&&p.length>0){let e=!1,r=p.length,I=-1;const d=p[p.length-1]._source;14!==d&&12!==d||(e=!0,I=p[p.length-1].format,r--);const f=[],q=[],E=[],j=[],X=[],k=[],m=[],J={};for(let w=0;w<r;++w){const e=p[w];f.push(e.samplingMode),q.push(e.type),E.push(e.format);void 0!==J[e.uniqueId]?(j.push(-1),m.push(0)):(J[e.uniqueId]=w,e.is2DArray?(j.push(35866),m.push(e.depth)):e.isCube?(j.push(34067),m.push(0)):e.is3D?(j.push(32879),m.push(e.depth)):(j.push(3553),m.push(0))),this._faceIndices&&X.push(this._faceIndices[w]??0),this._layerIndices&&k.push(this._layerIndices[w]??0)}const K={samplingModes:f,generateMipMaps:p[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:e,depthTextureFormat:I,types:q,formats:E,textureCount:r,targetTypes:j,faceIndex:X,layerIndex:k,layerCounts:m,label:this.label},y={width:this.width,height:this.height,depth:this.depth};w=this._engine.createMultipleRenderTarget(y,K);for(let c=0;c<r;++c){if(-1!==j[c])continue;const e=J[p[c].uniqueId];w.setTexture(w.textures[e],c)}}}else{var p,e,r,I;const f={};if(f.generateDepthBuffer=this._generateDepthBuffer,f.generateMipMaps=(null===(p=this.texture)||void 0===p?void 0:p.generateMipMaps)??!1,f.generateStencilBuffer=this._generateStencilBuffer,f.samplingMode=null===(e=this.texture)||void 0===e?void 0:e.samplingMode,f.type=null===(r=this.texture)||void 0===r?void 0:r.type,f.format=null===(I=this.texture)||void 0===I?void 0:I.format,f.noColorAttachment=!this._textures,f.label=this.label,this.isCube)w=this._engine.createRenderTargetCubeTexture(this.width,f);else{var d;const p={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(d=this.texture)||void 0===d?void 0:d.depth:void 0};w=this._engine.createRenderTargetTexture(p,f)}w.texture&&(w.texture.isReady=!0)}return w}_swapRenderTargetWrapper(w){if(this._textures&&w._textures)for(let p=0;p<this._textures.length;++p)this._textures[p]._swapAndDie(w._textures[p],!1),w._textures[p].isReady=!0;this._depthStencilTexture&&w._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(w._depthStencilTexture),w._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const w=this._cloneRenderTargetWrapper();if(w){if(this._depthStencilTexture){const p=this._depthStencilTexture.samplingMode,e=this._depthStencilTexture.format,r=2===p||3===p||11===p;w.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,r,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,e,this._depthStencilTextureLabel)}this.samples>1&&w.setSamples(this.samples),w._swapRenderTargetWrapper(this),w.dispose()}}releaseTextures(){if(this._textures)for(let w=0;w<this._textures.length;++w)this._textures[w].dispose();this._textures=null}dispose(){var w;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(w=this._depthStencilTexture)||void 0===w||w.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11146:(w,p,e)=>{e.d(p,{e:()=>r});class r{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?r.ShadersRepository:r.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?r.ShadersStore:r.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?r.IncludesShadersStore:r.IncludesShadersStoreWGSL}}r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={}},11157:(w,p,e)=>{e.d(p,{d:()=>m,f:()=>a,g:()=>K,j:()=>J,l:()=>y,p:()=>O,q:()=>k,s:()=>j,t:()=>X,v:()=>E,w:()=>q});class r{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.wE._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(w){w&&this.program&&w(this.program)}setEngine(w){this.wE=w}_fillEffectInformation(w,p,e,r,I,d,f,q){const E=this.wE;if(E.supportsUniformBuffers)for(const X in p)w.bindUniformBlock(X,p[X]);let j;for(this.wE.getUniforms(this,e).forEach(((w,p)=>{r[e[p]]=w})),this._uniforms=r,j=0;j<I.length;j++){null==w.getUniform(I[j])&&(I.splice(j,1),j--)}I.forEach(((w,p)=>{d[w]=p}));for(const X of E.getAttributes(this,f))q.push(X)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(w,p){const e=this._valueCache[w],r=p.updateFlag;return(void 0===e||e!==r)&&(this._valueCache[w]=r,!0)}_cacheFloat2(w,p,e){let r=this._valueCache[w];if(!r||2!==r.length)return r=[p,e],this._valueCache[w]=r,!0;let I=!1;return r[0]!==p&&(r[0]=p,I=!0),r[1]!==e&&(r[1]=e,I=!0),I}_cacheFloat3(w,p,e,r){let I=this._valueCache[w];if(!I||3!==I.length)return I=[p,e,r],this._valueCache[w]=I,!0;let d=!1;return I[0]!==p&&(I[0]=p,d=!0),I[1]!==e&&(I[1]=e,d=!0),I[2]!==r&&(I[2]=r,d=!0),d}_cacheFloat4(w,p,e,r,I){let d=this._valueCache[w];if(!d||4!==d.length)return d=[p,e,r,I],this._valueCache[w]=d,!0;let f=!1;return d[0]!==p&&(d[0]=p,f=!0),d[1]!==e&&(d[1]=e,f=!0),d[2]!==r&&(d[2]=r,f=!0),d[3]!==I&&(d[3]=I,f=!0),f}setInt(w,p){const e=this._valueCache[w];void 0!==e&&e===p||this.wE.setInt(this._uniforms[w],p)&&(this._valueCache[w]=p)}setInt2(w,p,e){this._cacheFloat2(w,p,e)&&(this.wE.setInt2(this._uniforms[w],p,e)||(this._valueCache[w]=null))}setInt3(w,p,e,r){this._cacheFloat3(w,p,e,r)&&(this.wE.setInt3(this._uniforms[w],p,e,r)||(this._valueCache[w]=null))}setInt4(w,p,e,r,I){this._cacheFloat4(w,p,e,r,I)&&(this.wE.setInt4(this._uniforms[w],p,e,r,I)||(this._valueCache[w]=null))}setIntArray(w,p){this._valueCache[w]=null,this.wE.setIntArray(this._uniforms[w],p)}setIntArray2(w,p){this._valueCache[w]=null,this.wE.setIntArray2(this._uniforms[w],p)}setIntArray3(w,p){this._valueCache[w]=null,this.wE.setIntArray3(this._uniforms[w],p)}setIntArray4(w,p){this._valueCache[w]=null,this.wE.setIntArray4(this._uniforms[w],p)}setUInt(w,p){const e=this._valueCache[w];void 0!==e&&e===p||this.wE.setUInt(this._uniforms[w],p)&&(this._valueCache[w]=p)}setUInt2(w,p,e){this._cacheFloat2(w,p,e)&&(this.wE.setUInt2(this._uniforms[w],p,e)||(this._valueCache[w]=null))}setUInt3(w,p,e,r){this._cacheFloat3(w,p,e,r)&&(this.wE.setUInt3(this._uniforms[w],p,e,r)||(this._valueCache[w]=null))}setUInt4(w,p,e,r,I){this._cacheFloat4(w,p,e,r,I)&&(this.wE.setUInt4(this._uniforms[w],p,e,r,I)||(this._valueCache[w]=null))}setUIntArray(w,p){this._valueCache[w]=null,this.wE.setUIntArray(this._uniforms[w],p)}setUIntArray2(w,p){this._valueCache[w]=null,this.wE.setUIntArray2(this._uniforms[w],p)}setUIntArray3(w,p){this._valueCache[w]=null,this.wE.setUIntArray3(this._uniforms[w],p)}setUIntArray4(w,p){this._valueCache[w]=null,this.wE.setUIntArray4(this._uniforms[w],p)}setArray(w,p){this._valueCache[w]=null,this.wE.setArray(this._uniforms[w],p)}setArray2(w,p){this._valueCache[w]=null,this.wE.setArray2(this._uniforms[w],p)}setArray3(w,p){this._valueCache[w]=null,this.wE.setArray3(this._uniforms[w],p)}setArray4(w,p){this._valueCache[w]=null,this.wE.setArray4(this._uniforms[w],p)}setMatrices(w,p){p&&(this._valueCache[w]=null,this.wE.setMatrices(this._uniforms[w],p))}setMatrix(w,p){this._cacheMatrix(w,p)&&(this.wE.setMatrices(this._uniforms[w],p.ze())||(this._valueCache[w]=null))}setMatrix3x3(w,p){this._valueCache[w]=null,this.wE.setMatrix3x3(this._uniforms[w],p)}setMatrix2x2(w,p){this._valueCache[w]=null,this.wE.setMatrix2x2(this._uniforms[w],p)}setFloat(w,p){const e=this._valueCache[w];void 0!==e&&e===p||this.wE.setFloat(this._uniforms[w],p)&&(this._valueCache[w]=p)}setVector2(w,p){this._cacheFloat2(w,p.x,p.y)&&(this.wE.setFloat2(this._uniforms[w],p.x,p.y)||(this._valueCache[w]=null))}setFloat2(w,p,e){this._cacheFloat2(w,p,e)&&(this.wE.setFloat2(this._uniforms[w],p,e)||(this._valueCache[w]=null))}setVector3(w,p){this._cacheFloat3(w,p.x,p.y,p.z)&&(this.wE.setFloat3(this._uniforms[w],p.x,p.y,p.z)||(this._valueCache[w]=null))}setFloat3(w,p,e,r){this._cacheFloat3(w,p,e,r)&&(this.wE.setFloat3(this._uniforms[w],p,e,r)||(this._valueCache[w]=null))}setVector4(w,p){this._cacheFloat4(w,p.x,p.y,p.z,p.w)&&(this.wE.setFloat4(this._uniforms[w],p.x,p.y,p.z,p.w)||(this._valueCache[w]=null))}setQuaternion(w,p){this._cacheFloat4(w,p.x,p.y,p.z,p.w)&&(this.wE.setFloat4(this._uniforms[w],p.x,p.y,p.z,p.w)||(this._valueCache[w]=null))}setFloat4(w,p,e,r,I){this._cacheFloat4(w,p,e,r,I)&&(this.wE.setFloat4(this._uniforms[w],p,e,r,I)||(this._valueCache[w]=null))}setColor3(w,p){this._cacheFloat3(w,p.r,p.g,p.b)&&(this.wE.setFloat3(this._uniforms[w],p.r,p.g,p.b)||(this._valueCache[w]=null))}setColor4(w,p,e){this._cacheFloat4(w,p.r,p.g,p.b,e)&&(this.wE.setFloat4(this._uniforms[w],p.r,p.g,p.b,e)||(this._valueCache[w]=null))}setDirectColor4(w,p){this._cacheFloat4(w,p.r,p.g,p.b,p.a)&&(this.wE.setFloat4(this._uniforms[w],p.r,p.g,p.b,p.a)||(this._valueCache[w]=null))}_getVertexShaderCode(){return this.vertexShader?this.wE._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.wE._getShaderSource(this.fragmentShader):null}}var I=e(11120);const d=new WeakMap,f={_webGLVersion:2,cachedPipelines:{}};function q(w){let p=d.get(w);if(!p){if(!w)return f;p={_webGLVersion:w.TEXTURE_BINDING_3D?2:1,_context:w,parallelShaderCompile:w.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},d.set(w,p)}return p}function E(w){d.delete(w)}function j(w,p,e,r,I,d){const f=q(r);d||(d=f._createShaderProgramInjection??m);return d(w,s(p,"vertex",r,f._contextWasLost),s(e,"fragment",r,f._contextWasLost),r,I,f.validateShaderPrograms)}function X(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6?arguments[6]:void 0;const E=q(I);f||(f=E._createShaderProgramInjection??m);const j=E._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return f(w,c(p,"vertex",r,j,I,E._contextWasLost),c(e,"fragment",r,j,I,E._contextWasLost),I,d,E.validateShaderPrograms)}function k(w,p){const e=new r,I=q(w);return I.parallelShaderCompile&&!I.disableParallelShaderCompile&&(e.isParallelCompiled=!0),e.context=I._context,e}function m(w,p,e,r){let I=arguments.length>5?arguments[5]:void 0;const d=r.createProgram();if(w.program=d,!d)throw new Error("Unable to create program");return r.attachShader(d,p),r.attachShader(d,e),r.linkProgram(d),w.context=r,w.vertexShader=p,w.fragmentShader=e,w.isParallelCompiled||K(w,r,I),d}function J(w,p,e){const r=w;if(r._isDisposed)return!1;const I=q(p);return!!(I&&I.parallelShaderCompile&&I.parallelShaderCompile.COMPLETION_STATUS_KHR&&r.program&&p.getProgramParameter(r.program,I.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(K(r,p,e),!0)}function K(w,p,e){const r=w.context,I=w.vertexShader,d=w.fragmentShader,f=w.program;if(!r.getProgramParameter(f,r.LINK_STATUS)){if(!p.getShaderParameter(I,p.COMPILE_STATUS)){const e=p.getShaderInfoLog(I);if(e)throw w.vertexCompilationError=e,new Error("VERTEX SHADER "+e)}if(!p.getShaderParameter(d,p.COMPILE_STATUS)){const e=p.getShaderInfoLog(d);if(e)throw w.fragmentCompilationError=e,new Error("FRAGMENT SHADER "+e)}const e=r.getProgramInfoLog(f);if(e)throw w.programLinkError=e,new Error(e)}if(e){r.validateProgram(f);if(!r.getProgramParameter(f,r.VALIDATE_STATUS)){const p=r.getProgramInfoLog(f);if(p)throw w.programValidationError=p,new Error(p)}}r.deleteShader(I),r.deleteShader(d),w.vertexShader=void 0,w.fragmentShader=void 0,w.onCompiled&&(w.onCompiled(),w.onCompiled=void 0)}function y(w,p,e,r,I,d,f,E,k){let m=arguments.length>10?arguments[10]:void 0,J=arguments.length>11?arguments[11]:void 0,K=arguments.length>12?arguments[12]:void 0;const y=q(w.context);J||(J=y.createRawShaderProgramInjection??j),K||(K=y.createShaderProgramInjection??X);const c=w;c.program=r?J(c,p,e,c.context,k):K(c,p,e,E,c.context,k),c.program.__SPECTOR_rebuildProgram=f,m()}function c(w,p,e,r,d,f){return s((0,I.g)(w,e,r),p,d,f)}function s(w,p,e,r){const I=e.createShader("vertex"===p?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(!I){let w=e.NO_ERROR,I=e.NO_ERROR;for(;(I=e.getError())!==e.NO_ERROR;)w=I;throw new Error(`Something went wrong while creating a gl ${p} shader object. gl error=${w}, gl isContextLost=${e.isContextLost()}, _contextWasLost=${r}`)}return e.shaderSource(I,w),e.compileShader(I),I}function O(w,p){p.useProgram(w)}function a(w,p){const e=w;if(!e.isParallelCompiled)return void p(w);const r=e.onCompiled;e.onCompiled=()=>{null===r||void 0===r||r(),p(w)}}},11416:(w,p,e)=>{e.r(p),e.d(p,{ThinEngine:()=>A});var r=e(11157),I=e(11419),d=e(11081),f=e(11075);class q{constructor(){this.shaderLanguage=0}postProcessor(w,p,e,r,I){if(I.drawBuffersExtensionDisabled){const p=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;w=w.replace(p,"")}return w}}const E=/(flat\s)?\s*varying\s*.*/;class j{constructor(){this.shaderLanguage=0}attributeProcessor(w){return w.replace("attribute","in")}varyingCheck(w,p){return E.test(w)}varyingProcessor(w,p){return w.replace("varying",p?"in":"out")}postProcessor(w,p,e){const r=-1!==w.search(/#extension.+GL_EXT_draw_buffers.+require/);if(w=(w=w.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),e){const p=-1!==w.search(/layout *\(location *= *0\) *out/g);w=(w=(w=(w=(w=(w=(w=w.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r||p?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==p.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+w}return w}}var X=e(11422),k=e(11194),m=e(11132),J=e(11430),K=e(11161),y=e(11139),c=e(11120),s=e(11151),O=e(11437);class a{}class A extends m.d{get name(){return this._name}set name(w){this._name=w}get version(){return this._webGLVersion}static get ShadersRepository(){return y.e.ShadersRepository}static set ShadersRepository(w){y.e.ShadersRepository=w}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(w){this._framebufferDimensionsObject=w}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(w,p,e,I){if(e=e||{},super(p??e.antialias,e,I),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!w)return;let f=null;if(w.getContext){if(f=w,void 0===e.bX&&(e.bX=!1),void 0===e.xrCompatible&&(e.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const w=navigator.userAgent;for(const p of A.ExceptionList){const r=p.key,I=p.targets;if(new RegExp(r).test(w)){if(p.capture&&p.captureConstraint){const e=p.capture,r=p.captureConstraint,I=new RegExp(e).exec(w);if(I&&I.length>0){if(parseInt(I[I.length-1])>=r)continue}}for(const w of I)switch(w){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":e.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,r.v)(this._gl)}:(this._onContextLost=w=>{w.preventDefault(),this._contextWasLost=!0,(0,r.v)(this._gl),d.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},f.addEventListener("webglcontextrestored",this._onContextRestored,!1),e.powerPreference=e.powerPreference||"high-performance"),f.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(e.xrCompatible=!1),!e.disableWebGL2Support)try{this._gl=f.getContext("webgl2",e)||f.getContext("experimental-webgl2",e),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(k){}if(!this._gl){if(!f)throw new Error("The provided canvas is null or undefined.");try{this._gl=f.getContext("webgl",e)||f.getContext("experimental-webgl",e)}catch(k){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=w,f=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const p=this._gl.getContextAttributes();p&&(e.stencil=p.stencil)}this._sharedInit(f),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==e.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=e.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let r=0;r<this._caps.maxVertexAttribs;r++)this._currentBufferPointers[r]=new a;this._shaderProcessor=this.webGLVersion>1?new j:new q;const E=`Babylon.js v${A.Version}`;d.c.Log(E+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",E);const X=(0,r.w)(this._gl);X.validateShaderPrograms=this.validateShaderPrograms,X.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(w){return null}areAllEffectsReady(){for(const w in this._compiledEffects){if(!this._compiledEffects[w].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const w=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=w&&(this._glRenderer=this._gl.getParameter(w.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(w.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const w=this._gl.getExtension("WEBGL_draw_buffers");if(null!==w){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=w.drawBuffersWEBGL.bind(w),this._caps.maxDrawBuffers=this._gl.getParameter(w.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let p=0;p<16;p++)this._gl["COLOR_ATTACHMENT"+p+"_WEBGL"]=w["COLOR_ATTACHMENT"+p+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const w=this._gl.getExtension("WEBGL_depth_texture");null!=w&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=w.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const w=this._gl.getExtension("OES_vertex_array_object");null!=w&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=w.createVertexArrayOES.bind(w),this._gl.bindVertexArray=w.bindVertexArrayOES.bind(w),this._gl.deleteVertexArray=w.deleteVertexArrayOES.bind(w))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const w=this._gl.getExtension("ANGLE_instanced_arrays");null!=w?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=w.drawArraysInstancedANGLE.bind(w),this._gl.drawElementsInstanced=w.drawElementsInstancedANGLE.bind(w),this._gl.vertexAttribDivisor=w.vertexAttribDivisorANGLE.bind(w)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const w=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),p=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);w&&p&&(this._caps.highPrecisionShaderSupported=0!==w.precision&&0!==p.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const w=this._gl.getExtension("EXT_blend_minmax");null!=w&&(this._caps.blendMinMax=!0,this._gl.MAX=w.MAX_EXT,this._gl.MIN=w.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const w=this._gl.getExtension("EXT_sRGB");null!=w&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:w.SRGB_EXT,SRGB8:w.SRGB_ALPHA_EXT,SRGB8_ALPHA8:w.SRGB_ALPHA_EXT})}if(this._creationOptions){const w=this._creationOptions.forceSRGBBufferSupportState;void 0!==w&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&w)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let p=0;p<this._maxSimultaneousTextures;p++)this._nextFreeTextureSlots.push(p);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const w=this._workingCanvas.getContext("2d");w&&(this._workingContext=w)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const w=this.getGlInfo();return w&&w.renderer?w.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=I;let d=0;if(p&&w){let p=!0;if(this._currentRenderTarget){var f;const e=null===(f=this._currentRenderTarget.texture)||void 0===f?void 0:f.format;if(8===e||9===e||10===e||11===e){var q;const e=null===(q=this._currentRenderTarget.texture)||void 0===q?void 0:q.type;7===e||5===e?(A._TempClearColorUint32[0]=255*w.r,A._TempClearColorUint32[1]=255*w.g,A._TempClearColorUint32[2]=255*w.b,A._TempClearColorUint32[3]=255*w.a,this._gl.clearBufferuiv(this._gl.COLOR,0,A._TempClearColorUint32),p=!1):(A._TempClearColorInt32[0]=255*w.r,A._TempClearColorInt32[1]=255*w.g,A._TempClearColorInt32[2]=255*w.b,A._TempClearColorInt32[3]=255*w.a,this._gl.clearBufferiv(this._gl.COLOR,0,A._TempClearColorInt32),p=!1)}}p&&(this._gl.clearColor(w.r,w.g,w.b,void 0!==w.a?w.a:1),d|=this._gl.COLOR_BUFFER_BIT)}e&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),d|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),d|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(d)}_viewport(w,p,e,r){w===this._viewportCached.x&&p===this._viewportCached.y&&e===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=w,this._viewportCached.y=p,this._viewportCached.z=e,this._viewportCached.w=r,this._gl.viewport(w,p,e,r))}Km(){super.Km(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const E=w;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=w,this._bindUnboundFramebuffer(E._framebuffer);const j=this._gl;var X;if(!w.isMulti)if(w.is2DArray||w.is3D)j.framebufferTextureLayer(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,null===(X=w.texture._hardwareTexture)||void 0===X?void 0:X.underlyingResource,f,q),E._currentLOD=f;else if(w.isCube){var k;j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+p,null===(k=w.texture._hardwareTexture)||void 0===k?void 0:k.underlyingResource,f)}else if(E._currentLOD!==f){var m;j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,null===(m=w.texture._hardwareTexture)||void 0===m?void 0:m.underlyingResource,f),E._currentLOD=f}const J=w._depthStencilTexture;if(J){w.is3D&&(w.texture.width===J.width&&w.texture.height===J.height&&w.texture.depth===J.depth||d.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const e=w._depthStencilTextureWithStencil?j.DEPTH_STENCIL_ATTACHMENT:j.DEPTH_ATTACHMENT;var K;if(w.is2DArray||w.is3D)j.framebufferTextureLayer(j.FRAMEBUFFER,e,null===(K=J._hardwareTexture)||void 0===K?void 0:K.underlyingResource,f,q);else if(w.isCube){var y;j.framebufferTexture2D(j.FRAMEBUFFER,e,j.TEXTURE_CUBE_MAP_POSITIVE_X+p,null===(y=J._hardwareTexture)||void 0===y?void 0:y.underlyingResource,f)}else{var c;j.framebufferTexture2D(j.FRAMEBUFFER,e,j.TEXTURE_2D,null===(c=J._hardwareTexture)||void 0===c?void 0:c.underlyingResource,f)}}E._MSAAFramebuffer&&this._bindUnboundFramebuffer(E._MSAAFramebuffer),this._cachedViewport&&!I?this.setViewport(this._cachedViewport,e,r):(e||(e=w.width,f&&(e/=Math.pow(2,f))),r||(r=w.height,f&&(r/=Math.pow(2,f))),this._viewport(0,0,e,r)),this.wipeCaches()}setStateCullFaceType(w,p){const e=this.cullBackFaces??w??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==e||p)&&(this._depthCullingState.cullFace=e)}setState(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==w||e)&&(this._depthCullingState.cull=w),this.setStateCullFaceType(I,e),this.setZOffset(p),this.setZOffsetUnits(f);const q=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==q||e)&&(this._depthCullingState.frontFace=q),this._stencilStateComposer.stencilMaterial=d}_resolveAndGenerateMipMapsFramebuffer(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w.disableAutomaticMSAAResolve||(w.isMulti?this.resolveMultiFramebuffer(w):this.resolveFramebuffer(w)),p||(w.isMulti?this.generateMipMapsMultiFramebuffer(w):this.generateMipMapsFramebuffer(w))}_bindUnboundFramebuffer(w){this._currentFramebuffer!==w&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,w),this._currentFramebuffer=w)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(w){const p=this._getTextureTarget(w);this._bindTextureDirectly(p,w,!0),this._gl.generateMipmap(p),this._bindTextureDirectly(p,null)}unBindFramebuffer(w,p,e){const r=w;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(w,p),e&&(r._MSAAFramebuffer&&this._bindUnboundFramebuffer(r._framebuffer),e()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(w){var p;w.isMulti||null===(p=w.texture)||void 0===p||!p.generateMipMaps||w.isCube||this.generateMipmaps(w.texture)}resolveFramebuffer(w){const p=w,e=this._gl;if(!p._MSAAFramebuffer||p.isMulti)return;let r=p.resolveMSAAColors?e.COLOR_BUFFER_BIT:0;r|=p._generateDepthBuffer&&p.resolveMSAADepth?e.DEPTH_BUFFER_BIT:0,r|=p._generateStencilBuffer&&p.resolveMSAAStencil?e.STENCIL_BUFFER_BIT:0,e.bindFramebuffer(e.READ_FRAMEBUFFER,p._MSAAFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,p._framebuffer),e.blitFramebuffer(0,0,w.width,w.height,0,0,w.width,w.height,r,e.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(w,p,e){return this._createVertexBuffer(w,this._gl.STATIC_DRAW)}_createVertexBuffer(w,p){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create vertex buffer");const r=new X.c(e);return this.bindArrayBuffer(r),"number"!==typeof w?w instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(w),p),r.eq=4*w.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,w,p),r.eq=w.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(w),p),r.eq=w),this._resetVertexBufferBinding(),r.references=1,r}createDynamicVertexBuffer(w,p){return this._createVertexBuffer(w,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(w,p,e){const r=this._gl.createBuffer(),I=new X.c(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(I);const d=this._normalizeIndexData(w);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,d,p?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),I.references=1,I.is32Bits=4===d.BYTES_PER_ELEMENT,I}_normalizeIndexData(w){if(2===w.BYTES_PER_ELEMENT)return w;if(this._caps.uintIndices){if(w instanceof Uint32Array)return w;for(let p=0;p<w.length;p++)if(w[p]>=65535)return new Uint32Array(w);return new Uint16Array(w)}return new Uint16Array(w)}bindArrayBuffer(w){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(w,this._gl.ARRAY_BUFFER)}bindUniformBlock(w,p,e){const r=w.program,I=this._gl.getUniformBlockIndex(r,p);this._gl.uniformBlockBinding(r,I,e)}bindIndexBuffer(w){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(w,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(w,p){(this._vaoRecordInProgress||this._currentBoundBuffer[p]!==w)&&(this._gl.bindBuffer(p,w?w.underlyingResource:null),this._currentBoundBuffer[p]=w)}updateArrayBuffer(w){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,w)}_vertexAttribPointer(w,p,e,r,I,d,f){const q=this._currentBufferPointers[p];if(!q)return;let E=!1;q.active?(q.buffer!==w&&(q.buffer=w,E=!0),q.size!==e&&(q.size=e,E=!0),q.type!==r&&(q.type=r,E=!0),q.normalized!==I&&(q.normalized=I,E=!0),q.stride!==d&&(q.stride=d,E=!0),q.offset!==f&&(q.offset=f,E=!0)):(E=!0,q.active=!0,q.index=p,q.size=e,q.type=r,q.normalized=I,q.stride=d,q.offset=f,q.buffer=w),(E||this._vaoRecordInProgress)&&(this.bindArrayBuffer(w),r===this._gl.UNSIGNED_INT||r===this._gl.INT?this._gl.vertexAttribIPointer(p,e,r,d,f):this._gl.vertexAttribPointer(p,e,r,I,d,f))}_bindIndexBufferWithCache(w){null!=w&&this._cachedIndexBuffer!==w&&(this._cachedIndexBuffer=w,this.bindIndexBuffer(w),this._uintIndicesCurrentlySet=w.is32Bits)}_bindVertexBuffersAttributes(w,p,e){const r=p.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let I=0;I<r.length;I++){const d=p.getAttributeLocation(I);if(d>=0){const p=r[I];let f=null;if(e&&(f=e[p]),f||(f=w[p]),!f)continue;this._gl.enableVertexAttribArray(d),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[d]=!0);const q=f.getBuffer();q&&(this._vertexAttribPointer(q,d,f.getSize(),f.type,f.normalized,f.byteStride,f.byteOffset),f.getIsInstanced()&&(this._gl.vertexAttribDivisor(d,f.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(d),this._currentInstanceBuffers.push(q))))}}}recordVertexArrayObject(w,p,e,r){const I=this._gl.createVertexArray();if(!I)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(I),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(w,e,r),this.bindIndexBuffer(p),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),I}bindVertexArrayObject(w,p){this._cachedVertexArrayObject!==w&&(this._cachedVertexArrayObject=w,this._gl.bindVertexArray(w),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=p&&p.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(w,p,e,r,I){if(this._cachedVertexBuffers!==w||this._cachedEffectForVertexBuffers!==I){this._cachedVertexBuffers=w,this._cachedEffectForVertexBuffers=I;const p=I.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let d=0;for(let f=0;f<p;f++)if(f<e.length){const p=I.getAttributeLocation(f);p>=0&&(this._gl.enableVertexAttribArray(p),this._vertexAttribArraysEnabled[p]=!0,this._vertexAttribPointer(w,p,e[f],this._gl.FLOAT,!1,r,d)),d+=4*e[f]}}this._bindIndexBufferWithCache(p)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(w,p,e,r){this._cachedVertexBuffers===w&&this._cachedEffectForVertexBuffers===e||(this._cachedVertexBuffers=w,this._cachedEffectForVertexBuffers=e,this._bindVertexBuffersAttributes(w,e,r)),this._bindIndexBufferWithCache(p)}unbindInstanceAttributes(){let w;for(let p=0,e=this._currentInstanceLocations.length;p<e;p++){const e=this._currentInstanceBuffers[p];w!=e&&e.references&&(w=e,this.bindArrayBuffer(e));const r=this._currentInstanceLocations[p];this._gl.vertexAttribDivisor(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(w){this._gl.deleteVertexArray(w)}_releaseBuffer(w){return w.references--,0===w.references&&(this._deleteBuffer(w),!0)}_deleteBuffer(w){this._gl.deleteBuffer(w.underlyingResource)}updateAndBindInstancesBuffer(w,p,e){if(this.bindArrayBuffer(w),p&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,p),void 0!==e[0].index)this.bindInstancesBuffer(w,e,!0);else for(let r=0;r<4;r++){const p=e[r];this._vertexAttribArraysEnabled[p]||(this._gl.enableVertexAttribArray(p),this._vertexAttribArraysEnabled[p]=!0),this._vertexAttribPointer(w,p,4,this._gl.FLOAT,!1,64,16*r),this._gl.vertexAttribDivisor(p,1),this._currentInstanceLocations.push(p),this._currentInstanceBuffers.push(w)}}bindInstancesBuffer(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(w);let r=0;if(e)for(let I=0;I<p.length;I++){r+=4*p[I].attributeSize}for(let I=0;I<p.length;I++){const e=p[I];void 0===e.index&&(e.index=this._currentEffect.getAttributeLocationByName(e.attributeName)),e.index<0||(this._vertexAttribArraysEnabled[e.index]||(this._gl.enableVertexAttribArray(e.index),this._vertexAttribArraysEnabled[e.index]=!0),this._vertexAttribPointer(w,e.index,e.attributeSize,e.attributeType||this._gl.FLOAT,e.normalized||!1,r,e.offset),this._gl.vertexAttribDivisor(e.index,void 0===e.divisor?1:e.divisor),this._currentInstanceLocations.push(e.index),this._currentInstanceBuffers.push(w))}}disableInstanceAttributeByName(w){if(!this._currentEffect)return;const p=this._currentEffect.getAttributeLocationByName(w);this.disableInstanceAttribute(p)}disableInstanceAttribute(w){let p,e=!1;for(;-1!==(p=this._currentInstanceLocations.indexOf(w));)this._currentInstanceLocations.splice(p,1),this._currentInstanceBuffers.splice(p,1),e=!0,p=this._currentInstanceLocations.indexOf(w);e&&(this._gl.vertexAttribDivisor(w,0),this.disableAttributeByIndex(w))}disableAttributeByIndex(w){this._gl.disableVertexAttribArray(w),this._vertexAttribArraysEnabled[w]=!1,this._currentBufferPointers[w].active=!1}draw(w,p,e,r){this.drawElementsType(w?0:1,p,e,r)}drawPointClouds(w,p,e){this.drawArraysType(2,w,p,e)}drawUnIndexed(w,p,e,r){this.drawArraysType(w?0:1,p,e,r)}drawElementsType(w,p,e,r){this.applyStates(),this._reportDrawCall();const I=this._drawMode(w),d=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,f=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(I,e,d,p*f,r):this._gl.drawElements(I,e,d,p*f)}drawArraysType(w,p,e,r){this.applyStates(),this._reportDrawCall();const I=this._drawMode(w);r?this._gl.drawArraysInstanced(I,p,e,r):this._gl.drawArrays(I,p,e)}_drawMode(w){switch(w){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(w){this._compiledEffects[w._key]&&delete this._compiledEffects[w._key];const p=w.getPipelineContext();p&&this._deletePipelineContext(p)}_deletePipelineContext(w){const p=w;p&&p.program&&(p.program.__SPECTOR_rebuildProgram=null,(0,s.m)(p),this._gl&&(this._currentProgram===p.program&&this._setProgram(null),this._gl.deleteProgram(p.program)))}_getGlobalDefines(w){return(0,c.k)(w,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(w,p,e,I,d,f,q,E,j){let X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10?arguments[10]:void 0;const m="string"===typeof w?w:w.vertexToken||w.vertexSource||w.vertexElement||w.vertex,J="string"===typeof w?w:w.fragmentToken||w.fragmentSource||w.fragmentElement||w.fragment,K=this._getGlobalDefines(),c=void 0!==p.attributes;let s=d??p.defines??"";K&&(s+=K);const O=m+"+"+J+"@"+s;if(this._compiledEffects[O]){const w=this._compiledEffects[O];return q&&w.isReady()&&q(w),w._refCount++,w}this._gl&&(0,r.w)(this._gl);const a=new y.e(w,p,c?this:e,I,this,d,f,q,E,j,O,p.shaderLanguage??X,p.extraInitializationsAsync??k);return this._compiledEffects[O]=a,a}_getShaderSource(w){return this._gl.getShaderSource(w)}createRawShaderProgram(w,p,e,I){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const f=(0,r.w)(this._gl);return f._contextWasLost=this._contextWasLost,f.validateShaderPrograms=this.validateShaderPrograms,(0,r.s)(w,p,e,I||this._gl,d)}createShaderProgram(w,p,e,I,d){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const q=(0,r.w)(this._gl);return q._contextWasLost=this._contextWasLost,q.validateShaderPrograms=this.validateShaderPrograms,(0,r.t)(w,p,e,I,d||this._gl,f)}inlineShaderCode(w){return w}createPipelineContext(w){if(this._gl){(0,r.w)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const p=(0,r.q)(this._gl,w);return p.wE=this,p}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(w){return(0,r.g)(w,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(w,p,e,I,d,f,q,E,j,X,k){const m=(0,r.w)(this._gl);return m._contextWasLost=this._contextWasLost,m.validateShaderPrograms=this.validateShaderPrograms,m._createShaderProgramInjection=this._createShaderProgram.bind(this),m.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),m.createShaderProgramInjection=this.createShaderProgram.bind(this),m.loadFileInjection=this._loadFile.bind(this),(0,r.l)(w,p,e,I,d,f,q,E,j,X,k)}_createShaderProgram(w,p,e,I){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,r.d)(w,p,e,I,d)}_isRenderingStateCompiled(w){return!this._isDisposed&&(0,r.j)(w,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(w,p){(0,r.f)(w,p)}getUniforms(w,p){const e=new Array,r=w;for(let I=0;I<p.length;I++)e.push(this._gl.getUniformLocation(r.program,p[I]));return e}getAttributes(w,p){const e=[],r=w;for(let d=0;d<p.length;d++)try{e.push(this._gl.getAttribLocation(r.program,p[d]))}catch(I){e.push(-1)}return e}enableEffect(w){(w=null!==w&&(0,I.d)(w)?w.effect:w)&&w!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(w),this._currentEffect=w,w.onBind&&w.onBind(w),w._onBindObservable&&w._onBindObservable.notifyObservers(w))}setInt(w,p){return!!w&&(this._gl.uniform1i(w,p),!0)}setInt2(w,p,e){return!!w&&(this._gl.uniform2i(w,p,e),!0)}setInt3(w,p,e,r){return!!w&&(this._gl.uniform3i(w,p,e,r),!0)}setInt4(w,p,e,r,I){return!!w&&(this._gl.uniform4i(w,p,e,r,I),!0)}setIntArray(w,p){return!!w&&(this._gl.uniform1iv(w,p),!0)}setIntArray2(w,p){return!(!w||p.length%2!==0)&&(this._gl.uniform2iv(w,p),!0)}setIntArray3(w,p){return!(!w||p.length%3!==0)&&(this._gl.uniform3iv(w,p),!0)}setIntArray4(w,p){return!(!w||p.length%4!==0)&&(this._gl.uniform4iv(w,p),!0)}setUInt(w,p){return!!w&&(this._gl.uniform1ui(w,p),!0)}setUInt2(w,p,e){return!!w&&(this._gl.uniform2ui(w,p,e),!0)}setUInt3(w,p,e,r){return!!w&&(this._gl.uniform3ui(w,p,e,r),!0)}setUInt4(w,p,e,r,I){return!!w&&(this._gl.uniform4ui(w,p,e,r,I),!0)}setUIntArray(w,p){return!!w&&(this._gl.uniform1uiv(w,p),!0)}setUIntArray2(w,p){return!(!w||p.length%2!==0)&&(this._gl.uniform2uiv(w,p),!0)}setUIntArray3(w,p){return!(!w||p.length%3!==0)&&(this._gl.uniform3uiv(w,p),!0)}setUIntArray4(w,p){return!(!w||p.length%4!==0)&&(this._gl.uniform4uiv(w,p),!0)}setArray(w,p){return!!w&&(!(p.length<1)&&(this._gl.uniform1fv(w,p),!0))}setArray2(w,p){return!(!w||p.length%2!==0)&&(this._gl.uniform2fv(w,p),!0)}setArray3(w,p){return!(!w||p.length%3!==0)&&(this._gl.uniform3fv(w,p),!0)}setArray4(w,p){return!(!w||p.length%4!==0)&&(this._gl.uniform4fv(w,p),!0)}setMatrices(w,p){return!!w&&(this._gl.uniformMatrix4fv(w,!1,p),!0)}setMatrix3x3(w,p){return!!w&&(this._gl.uniformMatrix3fv(w,!1,p),!0)}setMatrix2x2(w,p){return!!w&&(this._gl.uniformMatrix2fv(w,!1,p),!0)}setFloat(w,p){return!!w&&(this._gl.uniform1f(w,p),!0)}setFloat2(w,p,e){return!!w&&(this._gl.uniform2f(w,p,e),!0)}setFloat3(w,p,e,r){return!!w&&(this._gl.uniform3f(w,p,e,r),!0)}setFloat4(w,p,e,r,I){return!!w&&(this._gl.uniform4f(w,p,e,r,I),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const w=this._colorWrite;this._gl.colorMask(w,w,w,w)}}wipeCaches(w){this.preventCacheWipeBetweenFrames&&!w||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),w&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(w,p){const e=this._gl;let r=e.NEAREST,I=e.NEAREST,d=!1;switch(w){case 11:r=e.LINEAR,I=p?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;break;case 3:r=e.LINEAR,d=!0,I=p?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;break;case 8:d=!0,r=e.NEAREST,I=p?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;break;case 4:r=e.NEAREST,I=p?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;break;case 5:r=e.NEAREST,I=p?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;break;case 6:d=!0,r=e.NEAREST,I=p?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;break;case 7:r=e.NEAREST,I=e.LINEAR;break;case 1:r=e.NEAREST,I=e.NEAREST;break;case 9:r=e.LINEAR,I=p?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;break;case 10:d=!0,r=e.LINEAR,I=p?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;break;case 2:r=e.LINEAR,I=e.LINEAR;break;case 12:r=e.LINEAR,I=e.NEAREST}return{min:I,mag:r,hasMipMaps:d}}_createTexture(){const w=this._gl.createTexture();if(!w)throw new Error("Unable to create texture");return w}_createHardwareTexture(){return new J.e(this._createTexture(),this._gl)}_createInternalTexture(w,p){let e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=!1,f=!1,q=0,E=3,j=5,X=!1,k=1,m=!1,J=0;void 0!==p&&"object"===typeof p?(I=!!p.generateMipMaps,f=!!p.createMipMaps,q=void 0===p.type?0:p.type,E=void 0===p.samplingMode?3:p.samplingMode,j=void 0===p.format?5:p.format,X=void 0!==p.useSRGBBuffer&&p.useSRGBBuffer,k=p.samples??1,e=p.label,m=!!p.createMSAATexture,J=p.comparisonFunction||0):I=!!p,X&&(X=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==q||this._caps.textureFloatLinearFiltering)&&(2!==q||this._caps.textureHalfFloatLinearFiltering)||(E=1),1!==q||this._caps.textureFloat||(q=0,d.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const y=(0,O.e)(j),c=(0,O.c)(j),s=this._gl,a=new K.d(this,r),A=w.width||w,z=w.height||w,M=w.depth||0,i=w.layers||0,t=this._getSamplingParameters(E,(I||f)&&!y),n=0!==i?s.TEXTURE_2D_ARRAY:0!==M?s.TEXTURE_3D:s.TEXTURE_2D,l=y?this._getInternalFormatFromDepthTextureFormat(j,!0,c):this._getRGBABufferInternalSizedFormat(q,j,X),N=y?c?s.DEPTH_STENCIL:s.DEPTH_COMPONENT:this._getInternalFormat(j),U=y?this._getWebGLTextureTypeFromDepthTextureFormat(j):this._getWebGLTextureType(q);if(this._bindTextureDirectly(n,a),0!==i?(a.is2DArray=!0,s.texImage3D(n,0,l,A,z,i,0,N,U,null)):0!==M?(a.is3D=!0,s.texImage3D(n,0,l,A,z,M,0,N,U,null)):s.texImage2D(n,0,l,A,z,0,N,U,null),s.texParameteri(n,s.TEXTURE_MAG_FILTER,t.mag),s.texParameteri(n,s.TEXTURE_MIN_FILTER,t.min),s.texParameteri(n,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(n,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),y&&this.webGLVersion>1&&(0===J?(s.texParameteri(n,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(n,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(n,s.TEXTURE_COMPARE_FUNC,J),s.texParameteri(n,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE))),(I||f)&&this._gl.generateMipmap(n),this._bindTextureDirectly(n,null),a._useSRGBBuffer=X,a.baseWidth=A,a.baseHeight=z,a.width=A,a.height=z,a.depth=i||M,a.isReady=!0,a.samples=k,a.generateMipMaps=I,a.samplingMode=E,a.type=q,a.format=j,a.label=e,a.comparisonFunction=J,this._internalTexturesCache.push(a),m){let w=null;if(w=(0,O.e)(a.format)?this._setupFramebufferDepthAttachments((0,O.c)(a.format),19!==a.format,a.width,a.height,k,a.format,!0):this._createRenderBuffer(a.width,a.height,k,-1,this._getRGBABufferInternalSizedFormat(a.type,a.format,a._useSRGBBuffer),-1),!w)throw new Error("Unable to create render buffer");a._autoMSAAManagement=!0;let p=a._hardwareTexture;p||(p=a._hardwareTexture=this._createHardwareTexture()),p.addMSAARenderBuffer(w)}return a}_getUseSRGBBuffer(w,p){return w&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||p)}createTexture(w,p,e,r){var I=this;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,m=arguments.length>11?arguments[11]:void 0,J=arguments.length>12?arguments[12]:void 0,y=arguments.length>13?arguments[13]:void 0,c=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(w,p,e,r,d,f,q,(function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];return I._prepareWebGLTexture(...p,X)}),((w,p,e,I,d,f)=>{const q=this._gl,E=e.width===w&&e.height===p;d._creationFlags=y??0;const j=this._getTexImageParametersForCreateTexture(d.format,d._useSRGBBuffer);if(E)return q.texImage2D(q.TEXTURE_2D,0,j.internalFormat,j.format,j.type,e),!1;const X=this._caps.maxTextureSize;if(e.width>X||e.height>X||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=w,this._workingCanvas.height=p,this._workingContext.drawImage(e,0,0,e.width,e.height,0,0,w,p),q.texImage2D(q.TEXTURE_2D,0,j.internalFormat,j.format,j.type,this._workingCanvas),d.width=w,d.height=p,!1);{const w=new K.d(this,2);this._bindTextureDirectly(q.TEXTURE_2D,w,!0),q.texImage2D(q.TEXTURE_2D,0,j.internalFormat,j.format,j.type,e),this._rescaleTexture(w,d,r,j.format,(()=>{this._releaseTexture(w),this._bindTextureDirectly(q.TEXTURE_2D,d,!0),f()}))}return!0}),E,j,X,k,m,J,c)}_getTexImageParametersForCreateTexture(w,p){let e,r;return 1===this.webGLVersion?(e=this._getInternalFormat(w,p),r=e):(e=this._getInternalFormat(w,!1),r=this._getRGBABufferInternalSizedFormat(0,w,p)),{internalFormat:r,format:e,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(w,p,e,r,I){}_unpackFlipY(w){this._unpackFlipYCached!==w&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,w?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=w))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(w){return w.isCube?this._gl.TEXTURE_CUBE_MAP:w.is3D?this._gl.TEXTURE_3D:w.is2DArray||w.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this._getTextureTarget(p),I=this._getSamplingParameters(w,p.useMipMaps||e);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,I.mag,p),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,I.min),e&&I.hasMipMaps&&(p.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),p.samplingMode=w}updateTextureDimensions(w,p,e){}updateTextureWrappingMode(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const I=this._getTextureTarget(w);null!==p&&(this._setTextureParameterInteger(I,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(p),w),w._cachedWrapU=p),null!==e&&(this._setTextureParameterInteger(I,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(e),w),w._cachedWrapV=e),(w.is2DArray||w.is3D)&&null!==r&&(this._setTextureParameterInteger(I,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),w),w._cachedWrapR=r),this._bindTextureDirectly(I,null)}_uploadCompressedDataToTextureDirectly(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const q=this._gl;let E=q.TEXTURE_2D;if(w.isCube&&(E=q.TEXTURE_CUBE_MAP_POSITIVE_X+d),w._useSRGBBuffer)switch(p){case 37492:case 36196:this._caps.etc2?p=q.COMPRESSED_SRGB8_ETC2:w._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?p=q.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:w._useSRGBBuffer=!1;break;case 36492:p=q.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:p=q.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?p=q.COMPRESSED_SRGB_S3TC_DXT1_EXT:w._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?p=q.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:w._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?p=q.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:w._useSRGBBuffer=!1;break;default:w._useSRGBBuffer=!1}this._gl.compressedTexImage2D(E,f,p,e,r,0,I)}_uploadDataToTextureDirectly(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=this._gl,q=this._getWebGLTextureType(w.type),E=this._getInternalFormat(w.format),j=void 0===I?this._getRGBABufferInternalSizedFormat(w.type,w.format,w._useSRGBBuffer):this._getInternalFormat(I,w._useSRGBBuffer);this._unpackFlipY(w.invertY);let X=f.TEXTURE_2D;w.isCube&&(X=f.TEXTURE_CUBE_MAP_POSITIVE_X+e);const k=Math.round(Math.log(w.width)*Math.LOG2E),m=Math.round(Math.log(w.height)*Math.LOG2E),J=d?w.width:Math.pow(2,Math.max(k-r,0)),K=d?w.height:Math.pow(2,Math.max(m-r,0));f.texImage2D(X,r,j,J,K,0,E,q,p)}updateTextureData(w,p,e,r,I,d){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const j=this._gl,X=this._getWebGLTextureType(w.type),k=this._getInternalFormat(w.format);this._unpackFlipY(w.invertY);let m=j.TEXTURE_2D,J=j.TEXTURE_2D;w.isCube&&(J=j.TEXTURE_CUBE_MAP_POSITIVE_X+f,m=j.TEXTURE_CUBE_MAP),this._bindTextureDirectly(m,w,!0),j.texSubImage2D(J,q,e,r,I,d,k,X,p),E&&this._gl.generateMipmap(J),this._bindTextureDirectly(m,null)}_uploadArrayBufferViewToTexture(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const I=this._gl,d=w.isCube?I.TEXTURE_CUBE_MAP:I.TEXTURE_2D;this._bindTextureDirectly(d,w,!0),this._uploadDataToTextureDirectly(w,p,e,r),this._bindTextureDirectly(d,null,!0)}_prepareWebGLTextureContinuation(w,p,e,r,I){const d=this._gl;if(!d)return;const f=this._getSamplingParameters(I,!e);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,f.mag),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,f.min),e||r||d.generateMipmap(d.TEXTURE_2D),this._bindTextureDirectly(d.TEXTURE_2D,null),p&&p.removePendingData(w),w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear()}_prepareWebGLTexture(w,p,e,r,I,d,f,q,E,j){const X=this.getCaps().maxTextureSize,m=Math.min(X,this.needPOTTextures?(0,k.f)(r.width,X):r.width),J=Math.min(X,this.needPOTTextures?(0,k.f)(r.height,X):r.height),K=this._gl;K&&(w._hardwareTexture?(this._bindTextureDirectly(K.TEXTURE_2D,w,!0),this._unpackFlipY(void 0===I||!!I),w.baseWidth=r.width,w.baseHeight=r.height,w.width=m,w.height=J,w.isReady=!0,w.type=-1!==w.type?w.type:0,w.format=-1!==w.format?w.format:j??(".jpg"!==p||w._useSRGBBuffer?5:4),q(m,J,r,p,w,(()=>{this._prepareWebGLTextureContinuation(w,e,d,f,E)}))||this._prepareWebGLTextureContinuation(w,e,d,f,E)):e&&e.removePendingData(w))}_getInternalFormatFromDepthTextureFormat(w,p,e){const r=this._gl;if(!p)return r.STENCIL_INDEX8;let I=e?r.DEPTH_STENCIL:r.DEPTH_COMPONENT;return this.webGLVersion>1?15===w?I=r.DEPTH_COMPONENT16:16===w?I=r.DEPTH_COMPONENT24:17===w||13===w?I=e?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24:14===w?I=r.DEPTH_COMPONENT32F:18===w&&(I=e?r.DEPTH32F_STENCIL8:r.DEPTH_COMPONENT32F):I=r.DEPTH_COMPONENT16,I}_getWebGLTextureTypeFromDepthTextureFormat(w){const p=this._gl;let e=p.UNSIGNED_INT;return 15===w?e=p.UNSIGNED_SHORT:17===w||13===w?e=p.UNSIGNED_INT_24_8:14===w?e=p.FLOAT:18===w?e=p.FLOAT_32_UNSIGNED_INT_24_8_REV:19===w&&(e=p.UNSIGNED_BYTE),e}_setupFramebufferDepthAttachments(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=arguments.length>5?arguments[5]:void 0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const q=this._gl;d=d??(w?13:14);const E=this._getInternalFormatFromDepthTextureFormat(d,p,w);return w&&p?this._createRenderBuffer(e,r,I,q.DEPTH_STENCIL,E,f?-1:q.DEPTH_STENCIL_ATTACHMENT):p?this._createRenderBuffer(e,r,I,E,E,f?-1:q.DEPTH_ATTACHMENT):w?this._createRenderBuffer(e,r,I,E,E,f?-1:q.STENCIL_ATTACHMENT):null}_createRenderBuffer(w,p,e,r,I,d){let f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const q=this._gl.createRenderbuffer();return this._updateRenderBuffer(q,w,p,e,r,I,d,f)}_updateRenderBuffer(w,p,e,r,I,d,f){let q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const E=this._gl;return E.bindRenderbuffer(E.RENDERBUFFER,w),r>1&&E.renderbufferStorageMultisample?E.renderbufferStorageMultisample(E.RENDERBUFFER,r,d,p,e):E.renderbufferStorage(E.RENDERBUFFER,I,p,e),-1!==f&&E.framebufferRenderbuffer(E.FRAMEBUFFER,f,E.RENDERBUFFER,w),q&&E.bindRenderbuffer(E.RENDERBUFFER,null),w}_releaseTexture(w){this._deleteTexture(w._hardwareTexture),this.unbindAllTextures();const p=this._internalTexturesCache.indexOf(w);-1!==p&&this._internalTexturesCache.splice(p,1),w._lodTextureHigh&&w._lodTextureHigh.dispose(),w._lodTextureMid&&w._lodTextureMid.dispose(),w._lodTextureLow&&w._lodTextureLow.dispose(),w._irradianceTexture&&w._irradianceTexture.dispose()}_deleteTexture(w){null===w||void 0===w||w.release()}_setProgram(w){this._currentProgram!==w&&((0,r.p)(w,this._gl),this._currentProgram=w)}bindSamplers(w){const p=w.getPipelineContext();this._setProgram(p.program);const e=w.getSamplers();for(let r=0;r<e.length;r++){const p=w.getUniform(e[r]);p&&(this._boundUniforms[r]=p)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=!1;const f=p&&p._associatedChannel>-1;e&&f&&(this._activeChannel=p._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==p||r){if(this._activateCurrentTexture(),p&&p.isMultiview)throw d.c.Error(["_bindTextureDirectly called with a multiview texture!",w,p]),"_bindTextureDirectly called with a multiview texture!";var q;this._gl.bindTexture(w,(null===p||void 0===p||null===(q=p._hardwareTexture)||void 0===q?void 0:q.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=p,p&&(p._associatedChannel=this._activeChannel)}else e&&(I=!0,this._activateCurrentTexture());return f&&!e&&this._bindSamplerUniformToChannel(p._associatedChannel,this._activeChannel),I}_bindTexture(w,p,e){if(void 0===w)return;p&&(p._associatedChannel=w),this._activeChannel=w;const r=p?this._getTextureTarget(p):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,p)}unbindAllTextures(){for(let w=0;w<this._maxSimultaneousTextures;w++)this._activeChannel=w,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(w,p,e,r){void 0!==w&&(p&&(this._boundUniforms[w]=p),this._setTexture(w,e))}_bindSamplerUniformToChannel(w,p){const e=this._boundUniforms[w];e&&e._currentState!==p&&(this._gl.uniform1i(e,p),e._currentState=p)}_getTextureWrapMode(w){switch(w){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(w,p){let e,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!p)return null!=this._boundTexturesCache[w]&&(this._activeChannel=w,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(p.video){this._activeChannel=w;const e=p.getInternalTexture();e&&(e._associatedChannel=w),p.update()}else if(4===p.delayLoadState)return p.delayLoad(),!1;e=I?p.depthStencilTexture:p.isReady()?p.getInternalTexture():p.isCube?this.emptyCubeTexture:p.is3D?this.emptyTexture3D:p.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&e&&(e._associatedChannel=w);let d=!0;this._boundTexturesCache[w]===e&&(r||this._bindSamplerUniformToChannel(e._associatedChannel,w),d=!1),this._activeChannel=w;const f=this._getTextureTarget(e);if(d&&this._bindTextureDirectly(f,e,r),e&&!e.isMultiview){if(e.isCube&&e._cachedCoordinatesMode!==p.coordinatesMode){e._cachedCoordinatesMode=p.coordinatesMode;const w=3!==p.coordinatesMode&&5!==p.coordinatesMode?1:0;p.wrapU=w,p.wrapV=w}e._cachedWrapU!==p.wrapU&&(e._cachedWrapU=p.wrapU,this._setTextureParameterInteger(f,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(p.wrapU),e)),e._cachedWrapV!==p.wrapV&&(e._cachedWrapV=p.wrapV,this._setTextureParameterInteger(f,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(p.wrapV),e)),e.is3D&&e._cachedWrapR!==p.wrapR&&(e._cachedWrapR=p.wrapR,this._setTextureParameterInteger(f,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(p.wrapR),e)),this._setAnisotropicLevel(f,e,p.anisotropicFilteringLevel)}return!0}setTextureArray(w,p,e,r){if(void 0!==w&&p){this._textureUnits&&this._textureUnits.length===e.length||(this._textureUnits=new Int32Array(e.length));for(let p=0;p<e.length;p++){const r=e[p].getInternalTexture();r?(this._textureUnits[p]=w+p,r._associatedChannel=w+p):this._textureUnits[p]=-1}this._gl.uniform1iv(p,this._textureUnits);for(let w=0;w<e.length;w++)this._setTexture(this._textureUnits[w],e[w],!0)}}_setAnisotropicLevel(w,p,e){const r=this._caps.textureAnisotropicFilterExtension;11!==p.samplingMode&&3!==p.samplingMode&&2!==p.samplingMode&&(e=1),r&&p._cachedAnisotropicFilteringLevel!==e&&(this._setTextureParameterFloat(w,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this._caps.maxAnisotropy),p),p._cachedAnisotropicFilteringLevel=e)}_setTextureParameterFloat(w,p,e,r){this._bindTextureDirectly(w,r,!0,!0),this._gl.texParameterf(w,p,e)}_setTextureParameterInteger(w,p,e,r){r&&this._bindTextureDirectly(w,r,!0,!0),this._gl.texParameteri(w,p,e)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let w=0;w<this._caps.maxVertexAttribs;w++)this.disableAttributeByIndex(w)}else for(let w=0,p=this._vertexAttribArraysEnabled.length;w<p;w++)w>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[w]||this.disableAttributeByIndex(w)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var w;((0,f.i)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(w=this._gl.getExtension("WEBGL_lose_context"))||void 0===w||w.loseContext());(0,r.v)(this._gl)}attachContextLostEvent(w){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",w,!1)}attachContextRestoredEvent(w){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",w,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(w){const p=this._gl;for(;p.getError()!==p.NO_ERROR;);let e=!0;const r=p.createTexture();p.bindTexture(p.TEXTURE_2D,r),p.texImage2D(p.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(w),1,1,0,p.RGBA,this._getWebGLTextureType(w),null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);const I=p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,I),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,r,0);const d=p.checkFramebufferStatus(p.FRAMEBUFFER);if(e=e&&d===p.FRAMEBUFFER_COMPLETE,e=e&&p.getError()===p.NO_ERROR,e&&(p.clear(p.COLOR_BUFFER_BIT),e=e&&p.getError()===p.NO_ERROR),e){p.bindFramebuffer(p.FRAMEBUFFER,null);const w=p.RGBA,r=p.UNSIGNED_BYTE,I=new Uint8Array(4);p.readPixels(0,0,1,1,w,r,I),e=e&&p.getError()===p.NO_ERROR}for(p.deleteTexture(r),p.deleteFramebuffer(I),p.bindFramebuffer(p.FRAMEBUFFER,null);!e&&p.getError()!==p.NO_ERROR;);return e}_getWebGLTextureType(w){if(1===this._webGLVersion){switch(w){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(w){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=p?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(w){case 0:e=this._gl.ALPHA;break;case 1:e=this._gl.LUMINANCE;break;case 2:e=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:e=this._gl.RED;break;case 7:case 33324:case 36761:e=this._gl.RG;break;case 4:case 32852:case 36762:e=p?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:e=p?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(w){case 8:e=this._gl.RED_INTEGER;break;case 9:e=this._gl.RG_INTEGER;break;case 10:e=this._gl.RGB_INTEGER;break;case 11:e=this._gl.RGBA_INTEGER}return e}_getRGBABufferInternalSizedFormat(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==p)switch(p){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return e?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(w){case 3:switch(p){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(p){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return e?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return e?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(p){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(p){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(p){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(p){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(p){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(p){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(p){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return e?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(w,p,e,r){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const E=I?4:3,j=I?this._gl.RGBA:this._gl.RGB,X=e*r*E;if(q){if(q.length<X)return d.c.Error(`Data buffer is too small to store the read pixels (${q.length} should be more than ${X})`),Promise.resolve(q)}else q=new Uint8Array(X);return f&&this.flushFramebuffer(),this._gl.readPixels(w,p,e,r,j,this._gl.UNSIGNED_BYTE,q),Promise.resolve(q)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const w=m.d._CreateCanvas(1,1),p=w.getContext("webgl")||w.getContext("experimental-webgl");this._IsSupported=null!=p&&!!window.WebGLRenderingContext}catch(w){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const w=m.d._CreateCanvas(1,1),p=w.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||w.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!p}catch(w){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}A._TempClearColorUint32=new Uint32Array(4),A._TempClearColorInt32=new Int32Array(4),A.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],A._ConcatenateShader=c.g,A._IsSupported=null,A._HasMajorPerformanceCaveat=null},11623:(w,p,e)=>{var r;e.d(p,{c:()=>I}),function(w){w[w.PointerMove=0]="PointerMove",w[w.PointerDown=1]="PointerDown",w[w.PointerUp=2]="PointerUp"}(r||(r={}));class I{}I.DOM_DELTA_PIXEL=0,I.DOM_DELTA_LINE=1,I.DOM_DELTA_PAGE=2},11619:(w,p,e)=>{e.d(p,{c:()=>r,f:()=>d,i:()=>I});class r{}r.KEYDOWN=1,r.KEYUP=2;class I{constructor(w,p){this.type=w,this.event=p}}class d extends I{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(w){this.skipOnKeyboardObservable=w}constructor(w,p){super(w,p),this.type=w,this.event=p,this.skipOnKeyboardObservable=!1}}},11611:(w,p,e)=>{e.d(p,{c:()=>I,d:()=>f,h:()=>q});var r=e(11023);class I{}I.POINTERDOWN=1,I.POINTERUP=2,I.POINTERMOVE=4,I.POINTERWHEEL=8,I.POINTERPICK=16,I.POINTERTAP=32,I.POINTERDOUBLETAP=64;class d{constructor(w,p){this.type=w,this.event=p}}class f extends d{constructor(w,p,e,I){super(w,p),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new r.g(e,I)}}class q extends d{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(w,p),this._pickInfo=e,this._inputManager=r}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11729:(w,p,e)=>{e.d(p,{b:()=>m});var r=e(11207),I=e(11213),d=e(11023),f=e(11308),q=e(11331),E=e(11288),j=e(11038),X=e(11317),k=e(11301);class m extends q.b{get range(){return this._range}set range(w){this._range=w,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(w){this._intensityMode=w,this._computePhotometricScale()}get radius(){return this._radius}set radius(w){this._radius=w,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(w){this._shadowEnabled!==w&&(this._shadowEnabled=w,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(w){this._includedOnlyMeshes=w,this._hookArrayForIncludedOnly(w)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(w){this._excludedMeshes=w,this._hookArrayForExcluded(w)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(w){this._excludeWithLayerMask=w,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(w){this._includeOnlyWithLayerMask=w,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(w){this._lightmapMode!==w&&(this._lightmapMode=w,this._markMeshesAsLightDirty())}getViewMatrix(w){return null}getProjectionMatrix(w,p){return null}constructor(w,p){super(w,p,!1),this.br=new f.b(1,1,1),this.PX=new f.b(1,1,1),this.falloffType=m.FALLOFF_DEFAULT,this.Se=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=m.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.iw().addLight(this),this._uniformBuffer=new E.d(this.iw().getEngine(),void 0,void 0,w),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(w,p){return this}_bindLight(w,p,e,r){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=w.toString();let q=!1;if(this._uniformBuffer.bindToEffect(e,"Light"+d),this._renderId!==p.getRenderId()||this._lastUseSpecular!==r||!this._uniformBuffer.useUbo){this._renderId=p.getRenderId(),this._lastUseSpecular=r;const w=this.getScaledIntensity();this.transferToEffect(e,d),this.br.scaleToRef(w,f.h.pd[0]),this._uniformBuffer.updateColor4("vLightDiffuse",f.h.pd[0],this.range,d),r&&(this.PX.scaleToRef(w,f.h.pd[1]),this._uniformBuffer.updateColor4("vLightSpecular",f.h.pd[1],this.radius,d)),q=!0}if(this.transferTexturesToEffect(e,d),p.shadowsEnabled&&this.shadowEnabled&&I){const w=this.getShadowGenerator(p.activeCamera)??this.getShadowGenerator();w&&(w.bindShadowLight(d,e),q=!0)}q?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(w){let p="Name: "+this.name;if(p+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let e=0;e<this.animations.length;e++)p+=", animation[0]: "+this.animations[e].toString(w);return p}_syncParentEnabledState(){super._syncParentEnabledState(),this.K()||this._resyncMeshes()}yE(w){super.yE(w),this._resyncMeshes()}getShadowGenerator(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(w)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return d.k.Zero()}canAffectMesh(w){return!w||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(w))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(w))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&w.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&w.layerMask)))}dispose(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const w=this._shadowGenerators.values();for(let p=w.next();!0!==p.done;p=w.next()){p.value.dispose()}this._shadowGenerators=null}if(this.iw().stopAnimation(this),this._parentContainer){const w=this._parentContainer.lights.indexOf(this);w>-1&&this._parentContainer.lights.splice(w,1),this._parentContainer=null}for(const e of this.iw().meshes)e._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.iw().removeLight(this),super.dispose(w,p)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Se}clone(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=m.GetConstructorFromName(this.getTypeID(),w,this.iw());if(!e)return null;const r=k.e.Clone(e,this);return w&&(r.name=w),p&&(r.parent=p),r.yE(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}serialize(){const w=k.e.Serialize(this);if(w.uniqueId=this.uniqueId,w.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(w),this.excludedMeshes.length>0){w.excludedMeshesIds=[];for(const p of this.excludedMeshes)w.excludedMeshesIds.push(p.id)}if(this.includedOnlyMeshes.length>0){w.includedOnlyMeshesIds=[];for(const p of this.includedOnlyMeshes)w.includedOnlyMeshesIds.push(p.id)}return k.e.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w.isEnabled=this.isEnabled(),w}static GetConstructorFromName(w,p,e){const r=q.b.Construct("Light_Type_"+w,p,e);return r||null}static Parse(w,p){const e=m.GetConstructorFromName(w.type,w.name,p);if(!e)return null;const r=k.e.Parse(e,w,p);if(w.excludedMeshesIds&&(r._excludedMeshesIds=w.excludedMeshesIds),w.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=w.includedOnlyMeshesIds),void 0!==w.parentId&&(r._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(r._waitingParentInstanceIndex=w.parentInstanceIndex),void 0!==w.falloffType&&(r.falloffType=w.falloffType),void 0!==w.lightmapMode&&(r.lightmapMode=w.lightmapMode),w.animations){for(let p=0;p<w.animations.length;p++){const e=w.animations[p],I=(0,j.c)("BABYLON.Animation");I&&r.animations.push(I.Parse(e))}q.b.ParseAnimationRanges(r,w,p)}return w.autoAnimate&&p.beginAnimation(r,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),void 0!==w.isEnabled&&r.yE(w.isEnabled),r}_hookArrayForExcluded(w){var p=this;const e=w.push;w.push=function(){for(var r=arguments.length,I=new Array(r),d=0;d<r;d++)I[d]=arguments[d];const f=e.apply(w,I);for(const w of I)w._resyncLightSource(p);return f};const r=w.splice;w.splice=(p,e)=>{const I=r.apply(w,[p,e]);for(const w of I)w._resyncLightSource(this);return I};for(const I of w)I._resyncLightSource(this)}_hookArrayForIncludedOnly(w){var p=this;const e=w.push;w.push=function(){for(var r=arguments.length,I=new Array(r),d=0;d<r;d++)I[d]=arguments[d];const f=e.apply(w,I);return p._resyncMeshes(),f};const r=w.splice;w.splice=(p,e)=>{const I=r.apply(w,[p,e]);return this._resyncMeshes(),I},this._resyncMeshes()}_resyncMeshes(){for(const w of this.iw().meshes)w._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const w of this.iw().meshes)-1!==w.lightSources.indexOf(this)&&w._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.iw().resetCachedMaterial()}_getPhotometricScale(){let w=0;const p=this.getTypeID();let e=this.intensityMode;switch(e===m.INTENSITYMODE_AUTOMATIC&&(e=p===m.LIGHTTYPEID_DIRECTIONALLIGHT?m.INTENSITYMODE_ILLUMINANCE:m.INTENSITYMODE_LUMINOUSINTENSITY),p){case m.LIGHTTYPEID_POINTLIGHT:case m.LIGHTTYPEID_SPOTLIGHT:switch(e){case m.INTENSITYMODE_LUMINOUSPOWER:w=1/(4*Math.PI);break;case m.INTENSITYMODE_LUMINOUSINTENSITY:w=1;break;case m.INTENSITYMODE_LUMINANCE:w=this.radius*this.radius}break;case m.LIGHTTYPEID_DIRECTIONALLIGHT:switch(e){case m.INTENSITYMODE_ILLUMINANCE:w=1;break;case m.INTENSITYMODE_LUMINANCE:{let p=this.radius;p=Math.max(p,.001);w=2*Math.PI*(1-Math.cos(p));break}}break;case m.LIGHTTYPEID_HEMISPHERICLIGHT:w=1}return w}_reorderLightsInScene(){const w=this.iw();0!=this._renderPriority&&(w.requireLightSorting=!0),this.iw().sortLightsByPriority()}_isReady(){return!0}}m.FALLOFF_DEFAULT=X.c.FALLOFF_DEFAULT,m.FALLOFF_PHYSICAL=X.c.FALLOFF_PHYSICAL,m.FALLOFF_GLTF=X.c.FALLOFF_GLTF,m.FALLOFF_STANDARD=X.c.FALLOFF_STANDARD,m.LIGHTMAP_DEFAULT=X.c.LIGHTMAP_DEFAULT,m.LIGHTMAP_SPECULAR=X.c.LIGHTMAP_SPECULAR,m.LIGHTMAP_SHADOWSONLY=X.c.LIGHTMAP_SHADOWSONLY,m.INTENSITYMODE_AUTOMATIC=X.c.INTENSITYMODE_AUTOMATIC,m.INTENSITYMODE_LUMINOUSPOWER=X.c.INTENSITYMODE_LUMINOUSPOWER,m.INTENSITYMODE_LUMINOUSINTENSITY=X.c.INTENSITYMODE_LUMINOUSINTENSITY,m.INTENSITYMODE_ILLUMINANCE=X.c.INTENSITYMODE_ILLUMINANCE,m.INTENSITYMODE_LUMINANCE=X.c.INTENSITYMODE_LUMINANCE,m.LIGHTTYPEID_POINTLIGHT=X.c.LIGHTTYPEID_POINTLIGHT,m.LIGHTTYPEID_DIRECTIONALLIGHT=X.c.LIGHTTYPEID_DIRECTIONALLIGHT,m.LIGHTTYPEID_SPOTLIGHT=X.c.LIGHTTYPEID_SPOTLIGHT,m.LIGHTTYPEID_HEMISPHERICLIGHT=X.c.LIGHTTYPEID_HEMISPHERICLIGHT,m.LIGHTTYPEID_RECT_AREALIGHT=X.c.LIGHTTYPEID_RECT_AREALIGHT,(0,r.c)([(0,I.j)()],m.prototype,"diffuse",void 0),(0,r.c)([(0,I.j)()],m.prototype,"specular",void 0),(0,r.c)([(0,I.J)()],m.prototype,"falloffType",void 0),(0,r.c)([(0,I.J)()],m.prototype,"intensity",void 0),(0,r.c)([(0,I.J)()],m.prototype,"range",null),(0,r.c)([(0,I.J)()],m.prototype,"intensityMode",null),(0,r.c)([(0,I.J)()],m.prototype,"radius",null),(0,r.c)([(0,I.J)()],m.prototype,"_renderPriority",void 0),(0,r.c)([(0,I.e)("_reorderLightsInScene")],m.prototype,"renderPriority",void 0),(0,r.c)([(0,I.J)("shadowEnabled")],m.prototype,"_shadowEnabled",void 0),(0,r.c)([(0,I.J)("excludeWithLayerMask")],m.prototype,"_excludeWithLayerMask",void 0),(0,r.c)([(0,I.J)("includeOnlyWithLayerMask")],m.prototype,"_includeOnlyWithLayerMask",void 0),(0,r.c)([(0,I.J)("lightmapMode")],m.prototype,"_lightmapMode",void 0)},11317:(w,p,e)=>{e.d(p,{c:()=>r});class r{static CompareLightsPriority(w,p){return w.shadowEnabled!==p.shadowEnabled?(p.shadowEnabled?1:0)-(w.shadowEnabled?1:0):p.renderPriority-w.renderPriority}}r.FALLOFF_DEFAULT=0,r.FALLOFF_PHYSICAL=1,r.FALLOFF_GLTF=2,r.FALLOFF_STANDARD=3,r.LIGHTMAP_DEFAULT=0,r.LIGHTMAP_SPECULAR=1,r.LIGHTMAP_SHADOWSONLY=2,r.INTENSITYMODE_AUTOMATIC=0,r.INTENSITYMODE_LUMINOUSPOWER=1,r.INTENSITYMODE_LUMINOUSINTENSITY=2,r.INTENSITYMODE_ILLUMINANCE=3,r.INTENSITYMODE_LUMINANCE=4,r.LIGHTTYPEID_POINTLIGHT=0,r.LIGHTTYPEID_DIRECTIONALLIGHT=1,r.LIGHTTYPEID_SPOTLIGHT=2,r.LIGHTTYPEID_HEMISPHERICLIGHT=3,r.LIGHTTYPEID_RECT_AREALIGHT=4},11786:(w,p,e)=>{e.d(p,{b:()=>E});var r=e(11207),I=e(11213),d=e(11023),f=e(11729),q=e(11358);class E extends f.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=d.b.Identity(),this._projectionMatrix=d.b.Identity()}_setPosition(w){this._position=w}get position(){return this._position}set position(w){this._setPosition(w)}_setDirection(w){this._direction=w}get direction(){return this._direction}set direction(w){this._setDirection(w)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(w){this._shadowMinZ=w,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(w){this._shadowMaxZ=w,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=d.k.Zero()),d.k.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=d.k.Zero()),d.k.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(w){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(w){return this.direction=d.k.Normalize(w.Je(this.position)),this.direction}getRotation(){this.direction.normalize();const w=d.k.Cross(this.direction,q.b.Y),p=d.k.Cross(w,this.direction);return d.k.RotationFromAxis(w,p,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=d.k.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ke(w){return!w&&this.isSynchronized()?(this._currentRenderId=this.iw().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.X(this.position),this._worldMatrix||(this._worldMatrix=d.b.Identity()),d.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(w){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===w||void 0===w?void 0:w.ge)||0}getDepthMaxZ(w){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===w||void 0===w?void 0:w.maxZ)||1e4}setShadowProjectionMatrix(w,p,e){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(p,e,w):this._setDefaultShadowProjectionMatrix(w,p,e),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(w){const p=d.d.ne[0];let e=this.position;this.computeTransformedInformation()&&(e=this.transformedPosition),d.k.NormalizeToRef(this.getShadowDirection(w),p),1===Math.abs(d.k.Dot(p,d.k.Up()))&&(p.z=1e-13);const r=d.d.ne[1];return e.addToRef(p,r),d.b.LookAtLHToRef(e,r,d.k.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(w,p){return this.setShadowProjectionMatrix(this._projectionMatrix,w??this._viewMatrix,p??[]),this._projectionMatrix}}(0,r.c)([(0,I.G)()],E.prototype,"position",null),(0,r.c)([(0,I.G)()],E.prototype,"direction",null),(0,r.c)([(0,I.J)()],E.prototype,"shadowMinZ",null),(0,r.c)([(0,I.J)()],E.prototype,"shadowMaxZ",null)},11397:(w,p,e)=>{e.d(p,{d:()=>r});class r{static get ForceFullSceneLoadingForIncremental(){return r._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(w){r._ForceFullSceneLoadingForIncremental=w}static get ShowLoadingScreen(){return r._ShowLoadingScreen}static set ShowLoadingScreen(w){r._ShowLoadingScreen=w}static get loggingLevel(){return r._LoggingLevel}static set loggingLevel(w){r._LoggingLevel=w}static get CleanBoneMatrixWeights(){return r._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(w){r._CleanBoneMatrixWeights=w}}r._ForceFullSceneLoadingForIncremental=!1,r._ShowLoadingScreen=!0,r._CleanBoneMatrixWeights=!1,r._LoggingLevel=0},11586:(w,p,e)=>{e.d(p,{d:()=>F});var r=e(11207),I=e(11213),d=e(11081),f=e(11376),q=e(11573),E=e(11590),j=e(11023),X=e(11232),k=e(11648),m=e(11657);class J extends k.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class K extends m.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"PBRBRDF",90,new J,p),this._useEnergyConservation=K.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=K.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=K.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=K.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=K.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=K.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=K.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=K.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=K.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=K.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=K.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=K.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=K.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=K.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=K.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=K.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=K.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=K.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=w._dirtyCallbacks[16],this._enable(!0)}prepareDefines(w){w.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,w.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,w.SPHERICAL_HARMONICS=this._useSphericalHarmonics,w.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,w.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,w.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,w.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,w.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,w.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}K.DEFAULT_USE_ENERGY_CONSERVATION=!0,K.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,K.DEFAULT_USE_SPHERICAL_HARMONICS=!0,K.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,K.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,K.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,K.DEFAULT_DIFFUSE_MODEL=0,K.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,K.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"useEnergyConservation",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"useSphericalHarmonics",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"mixIblRadianceWithIrradiance",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"useLegacySpecularEnergyConservation",void 0),(0,r.c)([(0,I.J)("baseDiffuseModel"),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"baseDiffuseModel",void 0),(0,r.c)([(0,I.J)("dielectricSpecularModel"),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"dielectricSpecularModel",void 0),(0,r.c)([(0,I.J)("conductorSpecularModel"),(0,I.e)("_markAllSubMeshesAsMiscDirty")],K.prototype,"conductorSpecularModel",void 0);var y=e(11661),c=e(11308),s=e(11593),O=e(11203),a=e(11670),A=e(11511),z=e(11674),M=(e(11681),e(11692)),i=e(11310);class t extends k.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class n extends m.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"PBRClearCoat",100,new t,p),this._isEnabled=!1,this.isEnabled=!1,this.Se=1,this.roughness=0,this._indexOfRefraction=n._DefaultIndexOfRefraction,this.indexOfRefraction=n._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=c.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=w._dirtyCallbacks[1]}isReadyForSubMesh(w,p,e){if(!this._isEnabled)return!0;const r=this._material._disableBumpMap;if(w._areTexturesDirty&&p.texturesEnabled){if(this._texture&&z.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&z.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(e.getCaps().standardDerivatives&&this._bumpTexture&&z.d.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&z.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(w,p){this._isEnabled?(w.CLEARCOAT=!0,w.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,w.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,w._areTexturesDirty&&p.texturesEnabled&&(this._texture&&z.d.ClearCoatTextureEnabled?(0,i.N)(this._texture,w,"CLEARCOAT_TEXTURE"):w.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&z.d.ClearCoatTextureEnabled?(0,i.N)(this._textureRoughness,w,"CLEARCOAT_TEXTURE_ROUGHNESS"):w.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&z.d.ClearCoatBumpTextureEnabled?(0,i.N)(this._bumpTexture,w,"CLEARCOAT_BUMP"):w.CLEARCOAT_BUMP=!1,w.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===n._DefaultIndexOfRefraction,this._isTintEnabled?(w.CLEARCOAT_TINT=!0,this._tintTexture&&z.d.ClearCoatTintTextureEnabled?((0,i.N)(this._tintTexture,w,"CLEARCOAT_TINT_TEXTURE"),w.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):w.CLEARCOAT_TINT_TEXTURE=!1):(w.CLEARCOAT_TINT=!1,w.CLEARCOAT_TINT_TEXTURE=!1))):(w.CLEARCOAT=!1,w.CLEARCOAT_TEXTURE=!1,w.CLEARCOAT_TEXTURE_ROUGHNESS=!1,w.CLEARCOAT_BUMP=!1,w.CLEARCOAT_TINT=!1,w.CLEARCOAT_TINT_TEXTURE=!1,w.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,w.CLEARCOAT_DEFAULTIOR=!1,w.CLEARCOAT_TEXTUREDIRECTUV=0,w.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,w.CLEARCOAT_BUMPDIRECTUV=0,w.CLEARCOAT_REMAP_F0=!1,w.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,w.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(w,p,e,r){if(!this._isEnabled)return;const I=r.materialDefines,d=this._material.isFrozen,f=this._material._disableBumpMap,q=this._material._invertNormalMapX,E=this._material._invertNormalMapY;if(!w.useUbo||!d||!w.isSync){var j,X,k,m;if((this._texture||this._textureRoughness)&&z.d.ClearCoatTextureEnabled)w.updateFloat4("vClearCoatInfos",(null===(j=this._texture)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(X=this._texture)||void 0===X?void 0:X.level)??0,(null===(k=this._textureRoughness)||void 0===k?void 0:k.coordinatesIndex)??0,(null===(m=this._textureRoughness)||void 0===m?void 0:m.level)??0),this._texture&&(0,i.r)(this._texture,w,"clearCoat"),this._textureRoughness&&!I.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,i.r)(this._textureRoughness,w,"clearCoatRoughness");this._bumpTexture&&e.getCaps().standardDerivatives&&z.d.ClearCoatTextureEnabled&&!f&&(w.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,i.r)(this._bumpTexture,w,"clearCoatBump"),p._mirroredCameraPosition?w.updateFloat2("vClearCoatTangentSpaceParams",q?1:-1,E?1:-1):w.updateFloat2("vClearCoatTangentSpaceParams",q?-1:1,E?-1:1)),this._tintTexture&&z.d.ClearCoatTintTextureEnabled&&(w.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,i.r)(this._tintTexture,w,"clearCoatTint")),w.updateFloat2("vClearCoatParams",this.Se,this.roughness);const r=1-this._indexOfRefraction,d=1+this._indexOfRefraction,J=Math.pow(-r/d,2),K=1/this._indexOfRefraction;w.updateFloat4("vClearCoatRefractionParams",J,K,r,d),this._isTintEnabled&&(w.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),w.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}p.texturesEnabled&&(this._texture&&z.d.ClearCoatTextureEnabled&&w.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!I.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&z.d.ClearCoatTextureEnabled&&w.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&e.getCaps().standardDerivatives&&z.d.ClearCoatBumpTextureEnabled&&!f&&w.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&z.d.ClearCoatTintTextureEnabled&&w.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(w){return this._texture===w||(this._textureRoughness===w||(this._bumpTexture===w||this._tintTexture===w))}getActiveTextures(w){this._texture&&w.push(this._texture),this._textureRoughness&&w.push(this._textureRoughness),this._bumpTexture&&w.push(this._bumpTexture),this._tintTexture&&w.push(this._tintTexture)}getAnimatables(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&w.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&w.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&w.push(this._tintTexture)}dispose(w){var p,e,r,I;w&&(null===(p=this._texture)||void 0===p||p.dispose(),null===(e=this._textureRoughness)||void 0===e||e.dispose(),null===(r=this._bumpTexture)||void 0===r||r.dispose(),null===(I=this._tintTexture)||void 0===I||I.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(w,p,e){return w.CLEARCOAT_BUMP&&p.addFallback(e++,"CLEARCOAT_BUMP"),w.CLEARCOAT_TINT&&p.addFallback(e++,"CLEARCOAT_TINT"),w.CLEARCOAT&&p.addFallback(e++,"CLEARCOAT"),e}getSamplers(w){w.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}n._DefaultIndexOfRefraction=1.5,(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,r.c)([(0,I.J)()],n.prototype,"intensity",void 0),(0,r.c)([(0,I.J)()],n.prototype,"roughness",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"indexOfRefraction",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRoughnessFromMainTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"textureRoughness",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"remapF0OnInterfaceChange",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isTintEnabled",void 0),(0,r.c)([(0,I.j)()],n.prototype,"tintColor",void 0),(0,r.c)([(0,I.J)()],n.prototype,"tintColorAtDistance",void 0),(0,r.c)([(0,I.J)()],n.prototype,"tintThickness",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"tintTexture",void 0);class l extends k.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class N extends m.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"PBRIridescence",110,new l,p),this._isEnabled=!1,this.isEnabled=!1,this.Se=1,this.minimumThickness=N._DefaultMinimumThickness,this.maximumThickness=N._DefaultMaximumThickness,this.indexOfRefraction=N._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=w._dirtyCallbacks[1]}isReadyForSubMesh(w,p){if(!this._isEnabled)return!0;if(w._areTexturesDirty&&p.texturesEnabled){if(this._texture&&z.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&z.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(w,p){this._isEnabled?(w.IRIDESCENCE=!0,w._areTexturesDirty&&p.texturesEnabled&&(this._texture&&z.d.IridescenceTextureEnabled?(0,i.N)(this._texture,w,"IRIDESCENCE_TEXTURE"):w.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&z.d.IridescenceTextureEnabled?(0,i.N)(this._thicknessTexture,w,"IRIDESCENCE_THICKNESS_TEXTURE"):w.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(w.IRIDESCENCE=!1,w.IRIDESCENCE_TEXTURE=!1,w.IRIDESCENCE_THICKNESS_TEXTURE=!1,w.IRIDESCENCE_TEXTUREDIRECTUV=0,w.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(w,p){if(!this._isEnabled)return;const e=this._material.isFrozen;if(!w.useUbo||!e||!w.isSync){var r,I,d,f;if((this._texture||this._thicknessTexture)&&z.d.IridescenceTextureEnabled)w.updateFloat4("vIridescenceInfos",(null===(r=this._texture)||void 0===r?void 0:r.coordinatesIndex)??0,(null===(I=this._texture)||void 0===I?void 0:I.level)??0,(null===(d=this._thicknessTexture)||void 0===d?void 0:d.coordinatesIndex)??0,(null===(f=this._thicknessTexture)||void 0===f?void 0:f.level)??0),this._texture&&(0,i.r)(this._texture,w,"iridescence"),this._thicknessTexture&&(0,i.r)(this._thicknessTexture,w,"iridescenceThickness");w.updateFloat4("vIridescenceParams",this.Se,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}p.texturesEnabled&&(this._texture&&z.d.IridescenceTextureEnabled&&w.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&z.d.IridescenceTextureEnabled&&w.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(w){return this._texture===w||this._thicknessTexture===w}getActiveTextures(w){this._texture&&w.push(this._texture),this._thicknessTexture&&w.push(this._thicknessTexture)}getAnimatables(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&w.push(this._thicknessTexture)}dispose(w){var p,e;w&&(null===(p=this._texture)||void 0===p||p.dispose(),null===(e=this._thicknessTexture)||void 0===e||e.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(w,p,e){return w.IRIDESCENCE&&p.addFallback(e++,"IRIDESCENCE"),e}getSamplers(w){w.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}N._DefaultMinimumThickness=100,N._DefaultMaximumThickness=400,N._DefaultIndexOfRefraction=1.3,(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isEnabled",void 0),(0,r.c)([(0,I.J)()],N.prototype,"intensity",void 0),(0,r.c)([(0,I.J)()],N.prototype,"minimumThickness",void 0),(0,r.c)([(0,I.J)()],N.prototype,"maximumThickness",void 0),(0,r.c)([(0,I.J)()],N.prototype,"indexOfRefraction",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"texture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"thicknessTexture",void 0);class U extends k.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class v extends m.c{set angle(w){this.direction.x=Math.cos(w),this.direction.y=Math.sin(w)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"PBRAnisotropic",110,new U,p),this._isEnabled=!1,this.isEnabled=!1,this.Se=1,this.direction=new j.g(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=w._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=w._dirtyCallbacks[16]}isReadyForSubMesh(w,p){return!this._isEnabled||!(w._areTexturesDirty&&p.texturesEnabled&&this._texture&&z.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(w,p,e){this._isEnabled?(w.ANISOTROPIC=this._isEnabled,this._isEnabled&&!e.isVerticesDataPresent(X.e.TangentKind)&&(w._needUVs=!0,w.MAINUV1=!0),w._areTexturesDirty&&p.texturesEnabled&&(this._texture&&z.d.AnisotropicTextureEnabled?(0,i.N)(this._texture,w,"ANISOTROPIC_TEXTURE"):w.ANISOTROPIC_TEXTURE=!1),w._areMiscDirty&&(w.ANISOTROPIC_LEGACY=this._legacy)):(w.ANISOTROPIC=!1,w.ANISOTROPIC_TEXTURE=!1,w.ANISOTROPIC_TEXTUREDIRECTUV=0,w.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(w,p){if(!this._isEnabled)return;const e=this._material.isFrozen;w.useUbo&&e&&w.isSync||(this._texture&&z.d.AnisotropicTextureEnabled&&(w.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,i.r)(this._texture,w,"anisotropy")),w.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Se)),p.texturesEnabled&&this._texture&&z.d.AnisotropicTextureEnabled&&w.setTexture("anisotropySampler",this._texture)}hasTexture(w){return this._texture===w}getActiveTextures(w){this._texture&&w.push(this._texture)}getAnimatables(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture)}dispose(w){w&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(w,p,e){return w.ANISOTROPIC&&p.addFallback(e++,"ANISOTROPIC"),e}getSamplers(w){w.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(w,p,e){super.parse(w,p,e),void 0===w.legacy&&(this.legacy=!0)}}(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,r.c)([(0,I.J)()],v.prototype,"intensity",void 0),(0,r.c)([(0,I.E)()],v.prototype,"direction",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],v.prototype,"legacy",void 0);class R extends k.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class V extends m.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"Sheen",120,new R,p),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Se=1,this.color=c.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=w._dirtyCallbacks[1]}isReadyForSubMesh(w,p){if(!this._isEnabled)return!0;if(w._areTexturesDirty&&p.texturesEnabled){if(this._texture&&z.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&z.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(w,p){this._isEnabled?(w.SHEEN=!0,w.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,w.SHEEN_ROUGHNESS=null!==this._roughness,w.SHEEN_ALBEDOSCALING=this._albedoScaling,w.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,w._areTexturesDirty&&p.texturesEnabled&&(this._texture&&z.d.SheenTextureEnabled?((0,i.N)(this._texture,w,"SHEEN_TEXTURE"),w.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):w.SHEEN_TEXTURE=!1,this._textureRoughness&&z.d.SheenTextureEnabled?(0,i.N)(this._textureRoughness,w,"SHEEN_TEXTURE_ROUGHNESS"):w.SHEEN_TEXTURE_ROUGHNESS=!1)):(w.SHEEN=!1,w.SHEEN_TEXTURE=!1,w.SHEEN_TEXTURE_ROUGHNESS=!1,w.SHEEN_LINKWITHALBEDO=!1,w.SHEEN_ROUGHNESS=!1,w.SHEEN_ALBEDOSCALING=!1,w.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,w.SHEEN_GAMMATEXTURE=!1,w.SHEEN_TEXTUREDIRECTUV=0,w.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(w,p,e,r){if(!this._isEnabled)return;const I=r.materialDefines,d=this._material.isFrozen;if(!w.useUbo||!d||!w.isSync){var f,q,E,j;if((this._texture||this._textureRoughness)&&z.d.SheenTextureEnabled)w.updateFloat4("vSheenInfos",(null===(f=this._texture)||void 0===f?void 0:f.coordinatesIndex)??0,(null===(q=this._texture)||void 0===q?void 0:q.level)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(j=this._textureRoughness)||void 0===j?void 0:j.level)??0),this._texture&&(0,i.r)(this._texture,w,"sheen"),this._textureRoughness&&!I.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,i.r)(this._textureRoughness,w,"sheenRoughness");w.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Se),null!==this._roughness&&w.updateFloat("vSheenRoughness",this._roughness)}p.texturesEnabled&&(this._texture&&z.d.SheenTextureEnabled&&w.setTexture("sheenSampler",this._texture),this._textureRoughness&&!I.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&z.d.SheenTextureEnabled&&w.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(w){return this._texture===w||this._textureRoughness===w}getActiveTextures(w){this._texture&&w.push(this._texture),this._textureRoughness&&w.push(this._textureRoughness)}getAnimatables(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&w.push(this._textureRoughness)}dispose(w){var p,e;w&&(null===(p=this._texture)||void 0===p||p.dispose(),null===(e=this._textureRoughness)||void 0===e||e.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(w,p,e){return w.SHEEN&&p.addFallback(e++,"SHEEN"),e}getSamplers(w){w.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"linkSheenWithAlbedo",void 0),(0,r.c)([(0,I.J)()],V.prototype,"intensity",void 0),(0,r.c)([(0,I.j)()],V.prototype,"color",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMainTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"roughness",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"textureRoughness",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoScaling",void 0);class b extends k.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class h extends m.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(w){this._scene.enableSubSurfaceForPrePass()&&w&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(w))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(w){this._volumeIndexOfRefraction=w>=1?w:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"PBRSubSurface",130,new b,p),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=c.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=c.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=h.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=h.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=w.iw(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=w._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=w._dirtyCallbacks[32]}isReadyForSubMesh(w,p){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(w._areTexturesDirty&&p.texturesEnabled){if(this._thicknessTexture&&z.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&z.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&z.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const w=this._getRefractionTexture(p);if(w&&z.d.RefractionTextureEnabled&&!w.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(w,p){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return w.SUBSURFACE=!1,w.SS_DISPERSION=!1,w.SS_TRANSLUCENCY=!1,w.SS_SCATTERING=!1,w.SS_REFRACTION=!1,w.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,w.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,w.SS_THICKNESSANDMASK_TEXTURE=!1,w.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,w.SS_HAS_THICKNESS=!1,w.SS_REFRACTIONINTENSITY_TEXTURE=!1,w.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,w.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,w.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,w.SS_REFRACTIONMAP_3D=!1,w.SS_REFRACTIONMAP_OPPOSITEZ=!1,w.SS_LODINREFRACTIONALPHA=!1,w.SS_GAMMAREFRACTION=!1,w.SS_RGBDREFRACTION=!1,w.SS_LINEARSPECULARREFRACTION=!1,w.SS_LINKREFRACTIONTOTRANSPARENCY=!1,w.SS_ALBEDOFORREFRACTIONTINT=!1,w.SS_ALBEDOFORTRANSLUCENCYTINT=!1,w.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,w.SS_USE_THICKNESS_AS_DEPTH=!1,w.SS_USE_GLTF_TEXTURES=!1,w.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,w.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,w.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(w.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(w._areTexturesDirty){if(w.SUBSURFACE=!0,w.SS_DISPERSION=this._isDispersionEnabled,w.SS_TRANSLUCENCY=this._isTranslucencyEnabled,w.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,w.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,w.SS_SCATTERING=this._isScatteringEnabled,w.SS_THICKNESSANDMASK_TEXTURE=!1,w.SS_REFRACTIONINTENSITY_TEXTURE=!1,w.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,w.SS_HAS_THICKNESS=!1,w.SS_USE_GLTF_TEXTURES=!1,w.SS_REFRACTION=!1,w.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,w.SS_REFRACTIONMAP_3D=!1,w.SS_GAMMAREFRACTION=!1,w.SS_RGBDREFRACTION=!1,w.SS_LINEARSPECULARREFRACTION=!1,w.SS_REFRACTIONMAP_OPPOSITEZ=!1,w.SS_LODINREFRACTIONALPHA=!1,w.SS_LINKREFRACTIONTOTRANSPARENCY=!1,w.SS_ALBEDOFORREFRACTIONTINT=!1,w.SS_ALBEDOFORTRANSLUCENCYTINT=!1,w.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,w.SS_USE_THICKNESS_AS_DEPTH=!1,w.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,w.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,w._areTexturesDirty&&p.texturesEnabled&&(this._thicknessTexture&&z.d.ThicknessTextureEnabled&&(0,i.N)(this._thicknessTexture,w,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&z.d.RefractionIntensityTextureEnabled&&(0,i.N)(this._refractionIntensityTexture,w,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&z.d.TranslucencyIntensityTextureEnabled&&(0,i.N)(this._translucencyIntensityTexture,w,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&z.d.TranslucencyColorTextureEnabled&&((0,i.N)(this._translucencyColorTexture,w,"SS_TRANSLUCENCYCOLOR_TEXTURE"),w.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),w.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,w.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,w.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,w.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&p.texturesEnabled){const e=this._getRefractionTexture(p);e&&z.d.RefractionTextureEnabled&&(w.SS_REFRACTION=!0,w.SS_REFRACTIONMAP_3D=e.isCube,w.SS_GAMMAREFRACTION=e.gammaSpace,w.SS_RGBDREFRACTION=e.isRGBD,w.SS_LINEARSPECULARREFRACTION=e.linearSpecularLOD,w.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&e.isCube?!e.invertZ:e.invertZ,w.SS_LODINREFRACTIONALPHA=e.lodLevelInAlpha,w.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,w.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,w.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=e.isCube&&e.boundingBoxSize,w.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(w.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(w,p,e,r){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)w.updateFloat2("vThicknessParam",0,0);else{r.getRenderingMesh().getWorldMatrix().decompose(j.d.ne[0]);const p=Math.max(Math.abs(j.d.ne[0].x),Math.abs(j.d.ne[0].y),Math.abs(j.d.ne[0].z));w.updateFloat2("vThicknessParam",this.minimumThickness*p,(this.maximumThickness-this.minimumThickness)*p)}}bindForSubMesh(w,p,e,r){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const I=r.materialDefines,d=this._material.isFrozen,f=this._material.realTimeFiltering,q=I.LODBASEDMICROSFURACE,E=this._getRefractionTexture(p);if(!w.useUbo||!d||!w.isSync){if(this._thicknessTexture&&z.d.ThicknessTextureEnabled&&(w.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,i.r)(this._thicknessTexture,w,"thickness")),this._refractionIntensityTexture&&z.d.RefractionIntensityTextureEnabled&&I.SS_REFRACTIONINTENSITY_TEXTURE&&(w.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,i.r)(this._refractionIntensityTexture,w,"refractionIntensity")),this._translucencyColorTexture&&z.d.TranslucencyColorTextureEnabled&&I.SS_TRANSLUCENCYCOLOR_TEXTURE&&(w.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,i.r)(this._translucencyColorTexture,w,"translucencyColor")),this._translucencyIntensityTexture&&z.d.TranslucencyIntensityTextureEnabled&&I.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(w.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,i.r)(this._translucencyIntensityTexture,w,"translucencyIntensity")),E&&z.d.RefractionTextureEnabled){w.Ze("refractionMatrix",E.getRefractionTextureMatrix());let p=1;E.isCube||E.depth&&(p=E.depth);const e=E.getSize().width,r=this.volumeIndexOfRefraction;if(w.updateFloat4("vRefractionInfos",E.level,1/r,p,this._invertRefractionY?-1:1),w.updateFloat4("vRefractionMicrosurfaceInfos",e,E.lodGenerationScale,E.lodGenerationOffset,1/this.indexOfRefraction),f&&w.updateFloat2("vRefractionFilteringInfo",e,Math.log2(e)),E.boundingBoxSize){const p=E;w.updateVector3("vRefractionPosition",p.boundingBoxPosition),w.updateVector3("vRefractionSize",p.boundingBoxSize)}}this._isScatteringEnabled&&w.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),w.updateColor3("vDiffusionDistance",this.diffusionDistance),w.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),w.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),w.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),w.updateFloat("dispersion",this.dispersion)}p.texturesEnabled&&(this._thicknessTexture&&z.d.ThicknessTextureEnabled&&w.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&z.d.RefractionIntensityTextureEnabled&&I.SS_REFRACTIONINTENSITY_TEXTURE&&w.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&z.d.TranslucencyIntensityTextureEnabled&&I.SS_TRANSLUCENCYINTENSITY_TEXTURE&&w.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&z.d.TranslucencyColorTextureEnabled&&I.SS_TRANSLUCENCYCOLOR_TEXTURE&&w.setTexture("translucencyColorSampler",this._translucencyColorTexture),E&&z.d.RefractionTextureEnabled&&(q?w.setTexture("refractionSampler",E):(w.setTexture("refractionSampler",E._lodTextureMid||E),w.setTexture("refractionSamplerLow",E._lodTextureLow||E),w.setTexture("refractionSamplerHigh",E._lodTextureHigh||E))))}_getRefractionTexture(w){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?w.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(w){z.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&w.push(this._refractionTexture)}hasTexture(w){return this._thicknessTexture===w||(this._refractionTexture===w||(this._refractionIntensityTexture===w||(this._translucencyIntensityTexture===w||this._translucencyColorTexture===w)))}hasRenderTargetTextures(){return!!(z.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(w){this._thicknessTexture&&w.push(this._thicknessTexture),this._refractionTexture&&w.push(this._refractionTexture),this._translucencyColorTexture&&w.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&w.push(this._translucencyIntensityTexture)}getAnimatables(w){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&w.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&w.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&w.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&w.push(this._translucencyIntensityTexture)}dispose(w){w&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(w,p,e){return w.SS_SCATTERING&&p.addFallback(e++,"SS_SCATTERING"),w.SS_TRANSLUCENCY&&p.addFallback(e++,"SS_TRANSLUCENCY"),e}getSamplers(w){w.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}h.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,h.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isRefractionEnabled",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isTranslucencyEnabled",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isDispersionEnabled",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markScenePrePassDirty")],h.prototype,"isScatteringEnabled",void 0),(0,r.c)([(0,I.J)()],h.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,r.c)([(0,I.J)()],h.prototype,"refractionIntensity",void 0),(0,r.c)([(0,I.J)()],h.prototype,"translucencyIntensity",void 0),(0,r.c)([(0,I.J)()],h.prototype,"useAlbedoToTintRefraction",void 0),(0,r.c)([(0,I.J)()],h.prototype,"useAlbedoToTintTranslucency",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"thicknessTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"refractionTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"indexOfRefraction",void 0),(0,r.c)([(0,I.J)()],h.prototype,"_volumeIndexOfRefraction",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"volumeIndexOfRefraction",null),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"invertRefractionY",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"linkRefractionWithTransparency",void 0),(0,r.c)([(0,I.J)()],h.prototype,"minimumThickness",void 0),(0,r.c)([(0,I.J)()],h.prototype,"maximumThickness",void 0),(0,r.c)([(0,I.J)()],h.prototype,"useThicknessAsDepth",void 0),(0,r.c)([(0,I.j)()],h.prototype,"tintColor",void 0),(0,r.c)([(0,I.J)()],h.prototype,"tintColorAtDistance",void 0),(0,r.c)([(0,I.J)()],h.prototype,"dispersion",void 0),(0,r.c)([(0,I.j)()],h.prototype,"diffusionDistance",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useMaskFromThicknessTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"refractionIntensityTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"translucencyIntensityTexture",void 0),(0,r.c)([(0,I.j)()],h.prototype,"translucencyColor",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"translucencyColorTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useGltfStyleTextures",void 0),(0,r.c)([(0,I.J)()],h.prototype,"applyAlbedoAfterSubSurface",void 0),(0,r.c)([(0,I.J)()],h.prototype,"legacyTransluceny",void 0);var P=e(11698),u=e(11320),Y=e(11706);const L={effect:null,subMesh:null};class W extends k.b{constructor(w){super(w),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class F extends a.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(w){this._realTimeFiltering=w,this.kX(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(w){this._realTimeFilteringQuality=w,this.kX(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(w){w!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=w||this.iw().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(w,p){super(w,p,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||F.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new j.o(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=F.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=c.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new c.b(0,0,0),this._albedoColor=new c.b(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new c.b(1,1,1),this._reflectionColor=new c.b(1,1,1),this._emissiveColor=new c.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=F.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new f.e(16),this._globalAmbientColor=new c.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new K(this),this.clearCoat=new n(this),this.iridescence=new N(this),this.anisotropy=new v(this),this.sheen=new V(this),this.subSurface=new h(this),this.detailMap=new P.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),z.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,q.e)(this.iw()),this.prePassConfiguration=new y.e}get hasRenderTargetTextures(){return!!(z.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var w;return this._transparencyMode===F.PBRMATERIAL_OPAQUE||this._transparencyMode===F.PBRMATERIAL_ALPHATEST||(null===(w=this.subSurface)||void 0===w?void 0:w.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var w;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(w=this.subSurface)||void 0===w||!w.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===F.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.ie&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==F.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.ie||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(w,p,e){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const r=p._drawWrapper;if(r.effect&&this.isFrozen&&r._wasPreviouslyReady&&r._wasPreviouslyUsingInstances===e)return!0;p.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),p.materialDefines=new W(this._eventInfo.defineNames));const I=p.materialDefines;if(this._isReadyForSubMesh(p))return!0;const f=this.iw(),q=f.getEngine();if(I._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,f.texturesEnabled)){if(this._albedoTexture&&z.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&z.d.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&z.d.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&z.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&z.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const w=this._getReflectionTexture();if(w&&z.d.ReflectionTextureEnabled){if(!w.isReadyOrNotBlocking())return!1;var E;if(w.irradianceTexture){if(!w.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!w.sphericalPolynomial&&null!==(E=w.getInternalTexture())&&void 0!==E&&E._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&z.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&z.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(z.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(q.getCaps().standardDerivatives&&this._bumpTexture&&z.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&z.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=I,this._eventInfo.subMesh=p,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(I._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(I.AREALIGHTUSED)for(let d=0;d<w.lightSources.length;d++)if(!w.lightSources[d]._isReady())return!1;q.getCaps().standardDerivatives||w.isVerticesDataPresent(X.e.NormalKind)||(w.createNormals(!0),d.c.Warn("PBRMaterial: Normals have been created for the mesh: "+w.name));const j=p.effect,k=I._areLightsDisposed;let m=this._prepareEffect(w,I,this.onCompiled,this.onError,e,null,p.getRenderingMesh().hasThinInstances),J=!1;if(m)if(this._onEffectCreatedObservable&&(L.effect=m,L.subMesh=p,this._onEffectCreatedObservable.notifyObservers(L)),this.allowShaderHotSwapping&&j&&!m.isReady()){if(m=j,I.markAsUnprocessed(),J=this.isFrozen,k)return I._areLightsDisposed=!0,!1}else f.resetCachedMaterial(),p.setEffect(m,I,this._materialContext);return!(!p.effect||!p.effect.isReady())&&(I._renderId=f.getRenderId(),r._wasPreviouslyReady=!J,r._wasPreviouslyUsingInstances=!!e,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(w,p){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(w,p,d,f,q),!p.isDirty)return null;p.markAsProcessed();const E=this.iw().getEngine(),j=new M.c;let k=0;p.USESPHERICALINVERTEX&&j.addFallback(k++,"USESPHERICALINVERTEX"),p.FOG&&j.addFallback(k,"FOG"),p.SPECULARAA&&j.addFallback(k,"SPECULARAA"),p.POINTSIZE&&j.addFallback(k,"POINTSIZE"),p.LOGARITHMICDEPTH&&j.addFallback(k,"LOGARITHMICDEPTH"),p.PARALLAX&&j.addFallback(k,"PARALLAX"),p.PARALLAX_RHS&&j.addFallback(k,"PARALLAX_RHS"),p.PARALLAXOCCLUSION&&j.addFallback(k++,"PARALLAXOCCLUSION"),p.ENVIRONMENTBRDF&&j.addFallback(k++,"ENVIRONMENTBRDF"),p.TANGENT&&j.addFallback(k++,"TANGENT"),p.BUMP&&j.addFallback(k++,"BUMP"),k=(0,i.s)(p,j,this._maxSimultaneousLights,k++),p.SPECULARTERM&&j.addFallback(k++,"SPECULARTERM"),p.USESPHERICALFROMREFLECTIONMAP&&j.addFallback(k++,"USESPHERICALFROMREFLECTIONMAP"),p.USEIRRADIANCEMAP&&j.addFallback(k++,"USEIRRADIANCEMAP"),p.LIGHTMAP&&j.addFallback(k++,"LIGHTMAP"),p.NORMAL&&j.addFallback(k++,"NORMAL"),p.AMBIENT&&j.addFallback(k++,"AMBIENT"),p.EMISSIVE&&j.addFallback(k++,"EMISSIVE"),p.VERTEXCOLOR&&j.addFallback(k++,"VERTEXCOLOR"),p.MORPHTARGETS&&j.addFallback(k++,"MORPHTARGETS"),p.MULTIVIEW&&j.addFallback(0,"MULTIVIEW");const m=[X.e.PositionKind];p.NORMAL&&m.push(X.e.NormalKind),p.TANGENT&&m.push(X.e.TangentKind);for(let e=1;e<=6;++e)p["UV"+e]&&m.push(`uv${1===e?"":e}`);p.VERTEXCOLOR&&m.push(X.e.ColorKind),(0,i.z)(m,w,p,j),(0,i.C)(m,p),(0,i.E)(m,w,p),(0,i.v)(m,w,p);let J="pbr";const K=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],c=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],O=["Material","Scene","Mesh"],a={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:p.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=j,this._eventInfo.fallbackRank=k,this._eventInfo.defines=p,this._eventInfo.uniforms=K,this._eventInfo.attributes=m,this._eventInfo.samplers=c,this._eventInfo.uniformBuffersNames=O,this._eventInfo.customCode=void 0,this._eventInfo.mesh=w,this._eventInfo.indexParameters=a,this._callbackPluginEventGeneric(128,this._eventInfo),Y.c.AddUniformsAndSamplers(K,c),y.e.AddUniforms(K),y.e.AddSamplers(c),(0,u.b)(K),s.e&&(s.e.PrepareUniforms(K,p),s.e.PrepareSamplers(c,p)),(0,i.X)({uniformsNames:K,uniformBuffersNames:O,samplers:c,defines:p,maxSimultaneousLights:this._maxSimultaneousLights});const A={};this.customShaderNameResolve&&(J=this.customShaderNameResolve(J,K,O,c,p,m,A));const z=p.toString(),t=E.createEffect(J,{attributes:m,uniformsNames:K,uniformBuffersNames:O,samplers:c,defines:z,fallbacks:j,onCompiled:r,onError:I,indexParameters:a,processFinalCode:A.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:p.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([e.e(20),e.e(45)]).then(e.bind(e,13747)),Promise.all([e.e(18),e.e(46)]).then(e.bind(e,13931))]):await Promise.all([Promise.all([e.e(13),e.e(48)]).then(e.bind(e,14008)),Promise.all([e.e(12),e.e(49)]).then(e.bind(e,14161))]),this._shadersLoaded=!0}},E);return this._eventInfo.customCode=void 0,t}_prepareDefines(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this.iw(),f=d.getEngine();(0,i.L)(d,w,p,!0,this._maxSimultaneousLights,this._disableLighting),p._needNormals=!0,(0,i.P)(d,p);const q=this.needAlphaBlendingForMesh(w)&&this.iw().useOrderIndependentTransparency;if((0,i.W)(d,p,this.canRenderToMRT&&!q),(0,i.T)(d,p,q),Y.c.PrepareDefines(f.currentRenderPassId,w,p),p.METALLICWORKFLOW=this.isMetallicWorkflow(),p._areTexturesDirty){p._needUVs=!1;for(let w=1;w<=6;++w)p["MAINUV"+w]=!1;if(d.texturesEnabled){p.ALBEDODIRECTUV=0,p.BASE_WEIGHTDIRECTUV=0,p.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,p.AMBIENTDIRECTUV=0,p.OPACITYDIRECTUV=0,p.EMISSIVEDIRECTUV=0,p.REFLECTIVITYDIRECTUV=0,p.MICROSURFACEMAPDIRECTUV=0,p.METALLIC_REFLECTANCEDIRECTUV=0,p.REFLECTANCEDIRECTUV=0,p.BUMPDIRECTUV=0,p.LIGHTMAPDIRECTUV=0,f.getCaps().textureLOD&&(p.LODBASEDMICROSFURACE=!0),this._albedoTexture&&z.d.DiffuseTextureEnabled?((0,i.N)(this._albedoTexture,p,"ALBEDO"),p.GAMMAALBEDO=this._albedoTexture.gammaSpace):p.ALBEDO=!1,this._baseWeightTexture&&z.d.BaseWeightTextureEnabled?(0,i.N)(this._baseWeightTexture,p,"BASE_WEIGHT"):p.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&z.d.BaseDiffuseRoughnessTextureEnabled?(0,i.N)(this._baseDiffuseRoughnessTexture,p,"BASE_DIFFUSE_ROUGHNESS"):p.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&z.d.AmbientTextureEnabled?((0,i.N)(this._ambientTexture,p,"AMBIENT"),p.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):p.AMBIENT=!1,this._opacityTexture&&z.d.OpacityTextureEnabled?((0,i.N)(this._opacityTexture,p,"OPACITY"),p.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):p.OPACITY=!1;const w=this._getReflectionTexture();if(w&&z.d.ReflectionTextureEnabled){switch(p.REFLECTION=!0,p.GAMMAREFLECTION=w.gammaSpace,p.RGBDREFLECTION=w.isRGBD,p.LODINREFLECTIONALPHA=w.lodLevelInAlpha,p.LINEARSPECULARREFLECTION=w.linearSpecularLOD,p.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(p.NUM_SAMPLES=""+this.realTimeFilteringQuality,f._features.needTypeSuffixInShaderConstants&&(p.NUM_SAMPLES=p.NUM_SAMPLES+"u"),p.REALTIME_FILTERING=!0,this.iw().iblCdfGenerator&&(p.IBL_CDF_FILTERING=!0)):p.REALTIME_FILTERING=!1,p.INVERTCUBICMAP=w.coordinatesMode===A.e.INVCUBIC_MODE,p.REFLECTIONMAP_3D=w.isCube,p.REFLECTIONMAP_OPPOSITEZ=p.REFLECTIONMAP_3D&&this.iw().useRightHandedSystem?!w.invertZ:w.invertZ,p.REFLECTIONMAP_CUBIC=!1,p.REFLECTIONMAP_EXPLICIT=!1,p.REFLECTIONMAP_PLANAR=!1,p.REFLECTIONMAP_PROJECTION=!1,p.REFLECTIONMAP_SKYBOX=!1,p.REFLECTIONMAP_SPHERICAL=!1,p.REFLECTIONMAP_EQUIRECTANGULAR=!1,p.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,p.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,w.coordinatesMode){case A.e.EXPLICIT_MODE:p.REFLECTIONMAP_EXPLICIT=!0;break;case A.e.PLANAR_MODE:p.REFLECTIONMAP_PLANAR=!0;break;case A.e.PROJECTION_MODE:p.REFLECTIONMAP_PROJECTION=!0;break;case A.e.SKYBOX_MODE:p.REFLECTIONMAP_SKYBOX=!0;break;case A.e.SPHERICAL_MODE:p.REFLECTIONMAP_SPHERICAL=!0;break;case A.e.EQUIRECTANGULAR_MODE:p.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case A.e.FIXED_EQUIRECTANGULAR_MODE:p.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case A.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:p.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case A.e.CUBIC_MODE:case A.e.INVCUBIC_MODE:default:p.REFLECTIONMAP_CUBIC=!0,p.USE_LOCAL_REFLECTIONMAP_CUBIC=!!w.boundingBoxSize}w.coordinatesMode!==A.e.SKYBOX_MODE&&(w.irradianceTexture?(p.USEIRRADIANCEMAP=!0,p.USESPHERICALFROMREFLECTIONMAP=!1,p.USESPHERICALINVERTEX=!1,w.irradianceTexture._dominantDirection&&(p.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):w.isCube&&(p.USESPHERICALFROMREFLECTIONMAP=!0,p.USEIRRADIANCEMAP=!1,p.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||f.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?p.USESPHERICALINVERTEX=!1:p.USESPHERICALINVERTEX=!0))}else p.REFLECTION=!1,p.REFLECTIONMAP_3D=!1,p.REFLECTIONMAP_SPHERICAL=!1,p.REFLECTIONMAP_PLANAR=!1,p.REFLECTIONMAP_CUBIC=!1,p.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,p.REFLECTIONMAP_PROJECTION=!1,p.REFLECTIONMAP_SKYBOX=!1,p.REFLECTIONMAP_EXPLICIT=!1,p.REFLECTIONMAP_EQUIRECTANGULAR=!1,p.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,p.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,p.INVERTCUBICMAP=!1,p.USESPHERICALFROMREFLECTIONMAP=!1,p.USEIRRADIANCEMAP=!1,p.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,p.USESPHERICALINVERTEX=!1,p.REFLECTIONMAP_OPPOSITEZ=!1,p.LODINREFLECTIONALPHA=!1,p.GAMMAREFLECTION=!1,p.RGBDREFLECTION=!1,p.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&z.d.LightmapTextureEnabled?((0,i.N)(this._lightmapTexture,p,"LIGHTMAP"),p.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,p.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,p.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):p.LIGHTMAP=!1,this._emissiveTexture&&z.d.EmissiveTextureEnabled?((0,i.N)(this._emissiveTexture,p,"EMISSIVE"),p.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):p.EMISSIVE=!1,z.d.SpecularTextureEnabled?(this._metallicTexture?((0,i.N)(this._metallicTexture,p,"REFLECTIVITY"),p.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,p.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,p.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,p.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,p.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,i.N)(this._reflectivityTexture,p,"REFLECTIVITY"),p.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,p.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,p.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):p.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(p.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,i.N)(this._metallicReflectanceTexture,p,"METALLIC_REFLECTANCE"),p.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):p.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,i.N)(this._reflectanceTexture,p,"REFLECTANCE"),p.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):p.REFLECTANCE=!1):(p.METALLIC_REFLECTANCE=!1,p.REFLECTANCE=!1),this._microSurfaceTexture?(0,i.N)(this._microSurfaceTexture,p,"MICROSURFACEMAP"):p.MICROSURFACEMAP=!1):(p.REFLECTIVITY=!1,p.MICROSURFACEMAP=!1),f.getCaps().standardDerivatives&&this._bumpTexture&&z.d.BumpTextureEnabled&&!this._disableBumpMap?((0,i.N)(this._bumpTexture,p,"BUMP"),this._useParallax&&this._albedoTexture&&z.d.DiffuseTextureEnabled?(p.PARALLAX=!0,p.PARALLAX_RHS=d.useRightHandedSystem,p.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):p.PARALLAX=!1,p.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(p.BUMP=!1,p.PARALLAX=!1,p.PARALLAX_RHS=!1,p.PARALLAXOCCLUSION=!1,p.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&z.d.ReflectionTextureEnabled?(p.ENVIRONMENTBRDF=!0,p.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(p.ENVIRONMENTBRDF=!1,p.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?p.ALPHAFROMALBEDO=!0:p.ALPHAFROMALBEDO=!1}p.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===F.LIGHTFALLOFF_STANDARD?(p.USEPHYSICALLIGHTFALLOFF=!1,p.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===F.LIGHTFALLOFF_GLTF?(p.USEPHYSICALLIGHTFALLOFF=!1,p.USEGLTFLIGHTFALLOFF=!0):(p.USEPHYSICALLIGHTFALLOFF=!0,p.USEGLTFLIGHTFALLOFF=!1),p.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.ce&&this._twoSidedLighting?p.TWOSIDEDLIGHTING=!0:p.TWOSIDEDLIGHTING=!1,p.MIRRORED=!!d._mirroredCameraPosition,p.SPECULARAA=f.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(p._areTexturesDirty||p._areMiscDirty)&&(p.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,p.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,p.ALPHABLEND=this.needAlphaBlendingForMesh(w),p.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,p.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),p._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(p),p.FORCENORMALFORWARD=this._forceNormalForward,p.RADIANCEOCCLUSION=this._useRadianceOcclusion,p.HORIZONOCCLUSION=this._useHorizonOcclusion,p._areMiscDirty&&((0,i.O)(w,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(w),p,this._applyDecalMapAfterDetailMap),p.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!w.isVerticesDataPresent(X.e.NormalKind),p.DEBUGMODE=this._debugMode),(0,i.K)(d,f,this,p,!!e,r,I),this._eventInfo.defines=p,this._eventInfo.mesh=w,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,i.J)(w,p,!0,!0,!0,this._transparencyMode!==F.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(w,p,e){const r={clipPlane:!1,useInstances:!1,...e};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const e=new W(this._eventInfo.defineNames),I=this._prepareEffect(w,e,void 0,void 0,r.useInstances,r.clipPlane,w.hasThinInstances);this._onEffectCreatedObservable&&(L.effect=I,L.subMesh=null,this._onEffectCreatedObservable.notifyObservers(L)),I.isReady()?p&&p(this):I.onCompileObservable.add((()=>{p&&p(this)}))})()}buildUniformLayout(){const w=this._uniformBuffer;w.addUniform("vAlbedoInfos",2),w.addUniform("vBaseWeightInfos",2),w.addUniform("vBaseDiffuseRoughnessInfos",2),w.addUniform("vAmbientInfos",4),w.addUniform("vOpacityInfos",2),w.addUniform("vEmissiveInfos",2),w.addUniform("vLightmapInfos",2),w.addUniform("vReflectivityInfos",3),w.addUniform("vMicroSurfaceSamplerInfos",2),w.addUniform("vReflectionInfos",2),w.addUniform("vReflectionFilteringInfo",2),w.addUniform("vReflectionPosition",3),w.addUniform("vReflectionSize",3),w.addUniform("vBumpInfos",3),w.addUniform("albedoMatrix",16),w.addUniform("baseWeightMatrix",16),w.addUniform("baseDiffuseRoughnessMatrix",16),w.addUniform("ambientMatrix",16),w.addUniform("opacityMatrix",16),w.addUniform("emissiveMatrix",16),w.addUniform("lightmapMatrix",16),w.addUniform("reflectivityMatrix",16),w.addUniform("microSurfaceSamplerMatrix",16),w.addUniform("bumpMatrix",16),w.addUniform("vTangentSpaceParams",2),w.addUniform("reflectionMatrix",16),w.addUniform("vReflectionColor",3),w.addUniform("vAlbedoColor",4),w.addUniform("baseWeight",1),w.addUniform("baseDiffuseRoughness",1),w.addUniform("vLightingIntensity",4),w.addUniform("vReflectionMicrosurfaceInfos",3),w.addUniform("vReflectionDominantDirection",3),w.addUniform("pointSize",1),w.addUniform("vReflectivityColor",4),w.addUniform("vEmissiveColor",3),w.addUniform("vAmbientColor",3),w.addUniform("vDebugMode",2),w.addUniform("vMetallicReflectanceFactors",4),w.addUniform("vMetallicReflectanceInfos",2),w.addUniform("metallicReflectanceMatrix",16),w.addUniform("vReflectanceInfos",2),w.addUniform("reflectanceMatrix",16),w.addUniform("vSphericalL00",3),w.addUniform("vSphericalL1_1",3),w.addUniform("vSphericalL10",3),w.addUniform("vSphericalL11",3),w.addUniform("vSphericalL2_2",3),w.addUniform("vSphericalL2_1",3),w.addUniform("vSphericalL20",3),w.addUniform("vSphericalL21",3),w.addUniform("vSphericalL22",3),w.addUniform("vSphericalX",3),w.addUniform("vSphericalY",3),w.addUniform("vSphericalZ",3),w.addUniform("vSphericalXX_ZZ",3),w.addUniform("vSphericalYY_ZZ",3),w.addUniform("vSphericalZZ",3),w.addUniform("vSphericalXY",3),w.addUniform("vSphericalYZ",3),w.addUniform("vSphericalZX",3),w.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(w,p,e){const r=this.iw(),I=e.materialDefines;if(!I)return;const d=e.effect;if(!d)return;this._activeEffect=d,p.getMeshUniformBuffer().bindToEffect(d,"Mesh"),p.transferToEffect(w);const f=r.getEngine();this._uniformBuffer.bindToEffect(d,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,p,w,this.isFrozen),Y.c.Bind(f.currentRenderPassId,this._activeEffect,p,w,this);const q=r.activeCamera;q?this._uniformBuffer.updateFloat4("cameraInfo",q.ge,q.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=e,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),I.OBJECTSPACE_NORMALMAP&&(w.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const j=this._mustRebind(r,d,e,p.visibility);(0,i.d)(p,this._activeEffect,this.prePassConfiguration);let X=null;const k=this._uniformBuffer;if(j){if(this.bindViewProjection(d),X=this._getReflectionTexture(),!k.useUbo||!this.isFrozen||!k.isSync||e._drawWrapper._forceRebindOnNextCall){var m;if(r.texturesEnabled){if(this._albedoTexture&&z.d.DiffuseTextureEnabled&&(k.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,i.r)(this._albedoTexture,k,"albedo")),this._baseWeightTexture&&z.d.BaseWeightTextureEnabled&&(k.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,i.r)(this._baseWeightTexture,k,"baseWeight")),this._baseDiffuseRoughnessTexture&&z.d.BaseDiffuseRoughnessTextureEnabled&&(k.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,i.r)(this._baseDiffuseRoughnessTexture,k,"baseDiffuseRoughness")),this._ambientTexture&&z.d.AmbientTextureEnabled&&(k.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,i.r)(this._ambientTexture,k,"ambient")),this._opacityTexture&&z.d.OpacityTextureEnabled&&(k.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,i.r)(this._opacityTexture,k,"opacity")),X&&z.d.ReflectionTextureEnabled){if(k.Ze("reflectionMatrix",X.getReflectionTextureMatrix()),k.updateFloat2("vReflectionInfos",X.level*r.iblIntensity,0),X.boundingBoxSize){const w=X;k.updateVector3("vReflectionPosition",w.boundingBoxPosition),k.updateVector3("vReflectionSize",w.boundingBoxSize)}if(this.realTimeFiltering){const w=X.getSize().width;k.updateFloat2("vReflectionFilteringInfo",w,Math.log2(w))}if(I.USEIRRADIANCEMAP)I.USEIRRADIANCEMAP&&I.USE_IRRADIANCE_DOMINANT_DIRECTION&&k.updateVector3("vReflectionDominantDirection",X.irradianceTexture._dominantDirection);else{const w=X.sphericalPolynomial;if(I.USESPHERICALFROMREFLECTIONMAP&&w)if(I.SPHERICAL_HARMONICS){const p=w.preScaledHarmonics;k.updateVector3("vSphericalL00",p.l00),k.updateVector3("vSphericalL1_1",p.l1_1),k.updateVector3("vSphericalL10",p.l10),k.updateVector3("vSphericalL11",p.l11),k.updateVector3("vSphericalL2_2",p.l2_2),k.updateVector3("vSphericalL2_1",p.l2_1),k.updateVector3("vSphericalL20",p.l20),k.updateVector3("vSphericalL21",p.l21),k.updateVector3("vSphericalL22",p.l22)}else k.updateFloat3("vSphericalX",w.x.x,w.x.y,w.x.z),k.updateFloat3("vSphericalY",w.y.x,w.y.y,w.y.z),k.updateFloat3("vSphericalZ",w.z.x,w.z.y,w.z.z),k.updateFloat3("vSphericalXX_ZZ",w.xx.x-w.zz.x,w.xx.y-w.zz.y,w.xx.z-w.zz.z),k.updateFloat3("vSphericalYY_ZZ",w.yy.x-w.zz.x,w.yy.y-w.zz.y,w.yy.z-w.zz.z),k.updateFloat3("vSphericalZZ",w.zz.x,w.zz.y,w.zz.z),k.updateFloat3("vSphericalXY",w.xy.x,w.xy.y,w.xy.z),k.updateFloat3("vSphericalYZ",w.yz.x,w.yz.y,w.yz.z),k.updateFloat3("vSphericalZX",w.zx.x,w.zx.y,w.zx.z)}k.updateFloat3("vReflectionMicrosurfaceInfos",X.getSize().width,X.lodGenerationScale,X.lodGenerationOffset)}this._emissiveTexture&&z.d.EmissiveTextureEnabled&&(k.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,i.r)(this._emissiveTexture,k,"emissive")),this._lightmapTexture&&z.d.LightmapTextureEnabled&&(k.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,i.r)(this._lightmapTexture,k,"lightmap")),z.d.SpecularTextureEnabled&&(this._metallicTexture?(k.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,i.r)(this._metallicTexture,k,"reflectivity")):this._reflectivityTexture&&(k.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,i.r)(this._reflectivityTexture,k,"reflectivity")),this._metallicReflectanceTexture&&(k.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,i.r)(this._metallicReflectanceTexture,k,"metallicReflectance")),this._reflectanceTexture&&I.REFLECTANCE&&(k.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,i.r)(this._reflectanceTexture,k,"reflectance")),this._microSurfaceTexture&&(k.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,i.r)(this._microSurfaceTexture,k,"microSurfaceSampler"))),this._bumpTexture&&f.getCaps().standardDerivatives&&z.d.BumpTextureEnabled&&!this._disableBumpMap&&(k.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,i.r)(this._bumpTexture,k,"bump"),r._mirroredCameraPosition?k.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):k.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&k.updateFloat("pointSize",this.pointSize),I.METALLICWORKFLOW){var J;c.h.ed[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,c.h.ed[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const w=(null===(J=this.subSurface)||void 0===J?void 0:J._indexOfRefraction)??1.5,p=1;c.h.ed[0].b=w;const e=Math.pow((w-p)/(w+p),2);c.h.ed[0].a=e,k.updateDirectColor4("vReflectivityColor",c.h.ed[0]),k.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else k.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);k.updateColor3("vEmissiveColor",z.d.EmissiveTextureEnabled?this._emissiveColor:c.b.BlackReadOnly),k.updateColor3("vReflectionColor",this._reflectionColor),!I.SS_REFRACTION&&null!==(m=this.subSurface)&&void 0!==m&&m._linkRefractionWithTransparency?k.updateColor4("vAlbedoColor",this._albedoColor,1):k.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),k.updateFloat("baseWeight",this._baseWeight),k.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*r.environmentIntensity,this._lightingInfos.w=this._specularIntensity,k.updateVector4("vLightingIntensity",this._lightingInfos),r.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),k.updateColor3("vAmbientColor",this._globalAmbientColor),k.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(r.texturesEnabled){if(this._albedoTexture&&z.d.DiffuseTextureEnabled&&k.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&z.d.BaseWeightTextureEnabled&&k.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&z.d.BaseDiffuseRoughnessTextureEnabled&&k.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&z.d.AmbientTextureEnabled&&k.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&z.d.OpacityTextureEnabled&&k.setTexture("opacitySampler",this._opacityTexture),X&&z.d.ReflectionTextureEnabled){I.LODBASEDMICROSFURACE?k.setTexture("reflectionSampler",X):(k.setTexture("reflectionSampler",X._lodTextureMid||X),k.setTexture("reflectionSamplerLow",X._lodTextureLow||X),k.setTexture("reflectionSamplerHigh",X._lodTextureHigh||X)),I.USEIRRADIANCEMAP&&k.setTexture("irradianceSampler",X.irradianceTexture);const w=this.iw().iblCdfGenerator;this.realTimeFiltering&&w&&k.setTexture("icdfSampler",w.getIcdfTexture())}I.ENVIRONMENTBRDF&&k.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&z.d.EmissiveTextureEnabled&&k.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&z.d.LightmapTextureEnabled&&k.setTexture("lightmapSampler",this._lightmapTexture),z.d.SpecularTextureEnabled&&(this._metallicTexture?k.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&k.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&k.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&I.REFLECTANCE&&k.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&k.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&f.getCaps().standardDerivatives&&z.d.BumpTextureEnabled&&!this._disableBumpMap&&k.setTexture("bumpSampler",this._bumpTexture)}this.iw().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(p)&&this.iw().depthPeelingRenderer.bind(d),this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,u.e)(this._activeEffect,this,r),this.bindEyePosition(d)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(j||!this.isFrozen){var K;if(r.lightsEnabled&&!this._disableLighting&&(0,i.f)(r,p,this._activeEffect,I,this._maxSimultaneousLights),(r.fogEnabled&&p.applyFog&&r.fogMode!==E.c.FOGMODE_NONE||X||this.subSurface.refractionTexture||p.receiveShadows||I.PREPASS)&&this.bindView(d),(0,i.e)(r,p,this._activeEffect,!0),I.NUM_MORPH_INFLUENCERS&&(0,i.j)(p,this._activeEffect),I.BAKED_VERTEX_ANIMATION_TEXTURE)null===(K=p.bakedVertexAnimationManager)||void 0===K||K.bind(d,I.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,i.i)(I,this._activeEffect,r)}this._afterBind(p,this._activeEffect,e),k.update()}getAnimatables(){const w=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&w.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&w.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&w.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&w.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&w.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&w.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&w.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?w.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&w.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&w.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&w.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&w.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&w.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&w.push(this._microSurfaceTexture),w}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.iw().environmentTexture}getActiveTextures(){const w=super.getActiveTextures();return this._albedoTexture&&w.push(this._albedoTexture),this._baseWeightTexture&&w.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&w.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&w.push(this._ambientTexture),this._opacityTexture&&w.push(this._opacityTexture),this._reflectionTexture&&w.push(this._reflectionTexture),this._emissiveTexture&&w.push(this._emissiveTexture),this._reflectivityTexture&&w.push(this._reflectivityTexture),this._metallicTexture&&w.push(this._metallicTexture),this._metallicReflectanceTexture&&w.push(this._metallicReflectanceTexture),this._reflectanceTexture&&w.push(this._reflectanceTexture),this._microSurfaceTexture&&w.push(this._microSurfaceTexture),this._bumpTexture&&w.push(this._bumpTexture),this._lightmapTexture&&w.push(this._lightmapTexture),w}hasTexture(w){return!!super.hasTexture(w)||(this._albedoTexture===w||(this._baseWeightTexture===w||(this._baseDiffuseRoughnessTexture===w||(this._ambientTexture===w||(this._opacityTexture===w||(this._reflectionTexture===w||(this._emissiveTexture===w||(this._reflectivityTexture===w||(this._metallicTexture===w||(this._metallicReflectanceTexture===w||(this._reflectanceTexture===w||(this._microSurfaceTexture===w||(this._bumpTexture===w||this._lightmapTexture===w)))))))))))))}setPrePassRenderer(){var w;if(null===(w=this.subSurface)||void 0===w||!w.isScatteringEnabled)return!1;const p=this.iw().enableSubSurfaceForPrePass();return p&&(p.enabled=!0),!0}dispose(w,p){var e,r,I,d,f,q,E,j,X,k,m,J,K,y;(this._breakShaderLoadedCheck=!0,p)&&(this._environmentBRDFTexture&&this.iw().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(e=this._albedoTexture)||void 0===e||e.dispose(),null===(r=this._baseWeightTexture)||void 0===r||r.dispose(),null===(I=this._baseDiffuseRoughnessTexture)||void 0===I||I.dispose(),null===(d=this._ambientTexture)||void 0===d||d.dispose(),null===(f=this._opacityTexture)||void 0===f||f.dispose(),null===(q=this._reflectionTexture)||void 0===q||q.dispose(),null===(E=this._emissiveTexture)||void 0===E||E.dispose(),null===(j=this._metallicTexture)||void 0===j||j.dispose(),null===(X=this._reflectivityTexture)||void 0===X||X.dispose(),null===(k=this._bumpTexture)||void 0===k||k.dispose(),null===(m=this._lightmapTexture)||void 0===m||m.dispose(),null===(J=this._metallicReflectanceTexture)||void 0===J||J.dispose(),null===(K=this._reflectanceTexture)||void 0===K||K.dispose(),null===(y=this._microSurfaceTexture)||void 0===y||y.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(w,p)}}F.PBRMATERIAL_OPAQUE=O.b.MATERIAL_OPAQUE,F.PBRMATERIAL_ALPHATEST=O.b.MATERIAL_ALPHATEST,F.PBRMATERIAL_ALPHABLEND=O.b.MATERIAL_ALPHABLEND,F.PBRMATERIAL_ALPHATESTANDBLEND=O.b.MATERIAL_ALPHATESTANDBLEND,F.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,F.LIGHTFALLOFF_PHYSICAL=0,F.LIGHTFALLOFF_GLTF=1,F.LIGHTFALLOFF_STANDARD=2,F.ForceGLSL=!1,(0,r.c)([(0,I.p)()],F.prototype,"_imageProcessingConfiguration",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsMiscDirty")],F.prototype,"debugMode",void 0)},11564:(w,p,e)=>{e.d(p,{d:()=>k});var r=e(11207),I=e(11213),d=e(11573),f=e(11308),q=e(11586),E=e(11038),j=e(11203),X=e(11301);class k extends q.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(w){this.subSurface.refractionTexture=w,w?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(w){this.subSurface.indexOfRefraction=w}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(w){this.subSurface.invertRefractionY=w}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(w){this.subSurface.linkRefractionWithTransparency=w,w&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===q.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(w){w!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=w?q.d.LIGHTFALLOFF_PHYSICAL:q.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===q.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(w){w!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=w?q.d.LIGHTFALLOFF_GLTF:q.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(w){this._attachImageProcessingConfiguration(w),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(w){this.imageProcessingConfiguration.colorCurvesEnabled=w}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(w){this.imageProcessingConfiguration.colorGradingEnabled=w}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(w){this._imageProcessingConfiguration.toneMappingEnabled=w}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(w){this._imageProcessingConfiguration.exposure=w}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(w){this._imageProcessingConfiguration.contrast=w}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(w){this._imageProcessingConfiguration.colorGradingTexture=w}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(w){this._imageProcessingConfiguration.colorCurves=w}constructor(w,p){super(w,p,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=k.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=f.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new f.b(0,0,0),this.albedoColor=new f.b(1,1,1),this.baseWeight=1,this.reflectivityColor=new f.b(1,1,1),this.reflectionColor=new f.b(1,1,1),this.emissiveColor=new f.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,d.e)(this.iw())}getClassName(){return"PBRMaterial"}clone(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=X.e.Clone((()=>new k(w,this.iw())),this,{cloneTexturesOnlyOnce:p});return r.id=w,r.name=w,this.stencil.copyTo(r.stencil),this._clonePlugins(r,e),r}serialize(){const w=super.serialize();return w.customType="BABYLON.PBRMaterial",w}static Parse(w,p,e){const r=X.e.Parse((()=>new k(w.name,p)),w,p,e);return w.stencil&&r.stencil.parse(w.stencil,p,e),j.b._ParsePlugins(w,r,p,e),w.clearCoat&&r.clearCoat.parse(w.clearCoat,p,e),w.anisotropy&&r.anisotropy.parse(w.anisotropy,p,e),w.brdf&&r.brdf.parse(w.brdf,p,e),w.sheen&&r.sheen.parse(w.sheen,p,e),w.subSurface&&r.subSurface.parse(w.subSurface,p,e),w.iridescence&&r.iridescence.parse(w.iridescence,p,e),r}}k.PBRMATERIAL_OPAQUE=q.d.PBRMATERIAL_OPAQUE,k.PBRMATERIAL_ALPHATEST=q.d.PBRMATERIAL_ALPHATEST,k.PBRMATERIAL_ALPHABLEND=q.d.PBRMATERIAL_ALPHABLEND,k.PBRMATERIAL_ALPHATESTANDBLEND=q.d.PBRMATERIAL_ALPHATESTANDBLEND,k.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=q.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"directIntensity",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"emissiveIntensity",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"environmentIntensity",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"specularIntensity",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"disableBumpMap",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"albedoTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"baseWeightTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"baseDiffuseRoughnessTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"ambientTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"ambientTextureStrength",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],k.prototype,"opacityTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"reflectionTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"emissiveTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"reflectivityTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"metallicTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"metallic",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"roughness",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"metallicF0Factor",void 0),(0,r.c)([(0,I.j)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"metallicReflectanceColor",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"metallicReflectanceTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"reflectanceTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"microSurfaceTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"bumpTexture",void 0),(0,r.c)([(0,I.C)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty",null)],k.prototype,"lightmapTexture",void 0),(0,r.c)([(0,I.j)("ambient"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"ambientColor",void 0),(0,r.c)([(0,I.j)("albedo"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"albedoColor",void 0),(0,r.c)([(0,I.J)("baseWeight"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"baseWeight",void 0),(0,r.c)([(0,I.J)("baseDiffuseRoughness"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"baseDiffuseRoughness",void 0),(0,r.c)([(0,I.j)("reflectivity"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"reflectivityColor",void 0),(0,r.c)([(0,I.j)("reflection"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"reflectionColor",void 0),(0,r.c)([(0,I.j)("emissive"),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"emissiveColor",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"microSurface",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useLightmapAsShadowmap",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],k.prototype,"useAlphaFromAlbedoTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],k.prototype,"forceAlphaTest",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],k.prototype,"alphaCutOff",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useSpecularOverAlpha",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useAmbientInGrayScale",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,r.c)([(0,I.J)()],k.prototype,"usePhysicalLightFalloff",null),(0,r.c)([(0,I.J)()],k.prototype,"useGLTFLightFalloff",null),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useRadianceOverAlpha",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useObjectSpaceNormalMap",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useParallax",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useParallaxOcclusion",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"parallaxScaleBias",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsLightsDirty")],k.prototype,"disableLighting",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"forceIrradianceInFragment",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsLightsDirty")],k.prototype,"maxSimultaneousLights",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"invertNormalMapX",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"invertNormalMapY",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"twoSidedLighting",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useAlphaFresnel",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useLinearAlphaFresnel",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"environmentBRDFTexture",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"forceNormalForward",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"enableSpecularAntiAliasing",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useHorizonOcclusion",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useRadianceOcclusion",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],k.prototype,"unlit",void 0),(0,r.c)([(0,I.J)(),(0,I.e)("_markAllSubMeshesAsMiscDirty")],k.prototype,"applyDecalMapAfterDetailMap",void 0),(0,E.d)("BABYLON.PBRMaterial",k)},11173:(w,p,e)=>{e.d(p,{b:()=>f});var r=e(11081);const I=new Map;function d(w,p){(function(w){return I.delete(w)})(w)&&r.c.Warn(`Extension with the name '${w}' already exists`),I.set(w,p)}function f(w,p){"image/ktx"!==p&&"image/ktx2"!==p||(w=".ktx"),I.has(w)||(w.endsWith(".ies")&&d(".ies",(async()=>await e.e(28).then(e.bind(e,13622)).then((w=>new w._IESTextureLoader)))),w.endsWith(".dds")&&d(".dds",(async()=>await e.e(25).then(e.bind(e,13630)).then((w=>new w._DDSTextureLoader)))),w.endsWith(".basis")&&d(".basis",(async()=>await e.e(29).then(e.bind(e,13639)).then((w=>new w._BasisTextureLoader)))),w.endsWith(".env")&&d(".env",(async()=>await Promise.all([e.e(24),e.e(30)]).then(e.bind(e,13645)).then((w=>new w._ENVTextureLoader)))),w.endsWith(".hdr")&&d(".hdr",(async()=>await e.e(31).then(e.bind(e,13651)).then((w=>new w._HDRTextureLoader)))),(w.endsWith(".ktx")||w.endsWith(".ktx2"))&&(d(".ktx",(async()=>await e.e(32).then(e.bind(e,13654)).then((w=>new w._KTXTextureLoader)))),d(".ktx2",(async()=>await e.e(32).then(e.bind(e,13654)).then((w=>new w._KTXTextureLoader))))),w.endsWith(".tga")&&d(".tga",(async()=>await e.e(33).then(e.bind(e,13659)).then((w=>new w._TGATextureLoader)))),w.endsWith(".exr")&&d(".exr",(async()=>await e.e(34).then(e.bind(e,13666)).then((w=>new w._ExrTextureLoader)))));const r=I.get(w);return r?Promise.resolve(r(p)):null}},11494:(w,p,e)=>{e.d(p,{b:()=>m});var r=e(11207),I=e(11213),d=e(11056),f=e(11023),q=e(11051),E=e(11190),j=(e(11107),e(11491));class X{get wrapU(){return this._wrapU}set wrapU(w){this._wrapU=w}get wrapV(){return this._wrapV}set wrapV(w){this._wrapV=w}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(w){this._texture&&(this._texture.isCube=w)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(w){this._texture&&(this._texture.is3D=w)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(w){this._texture&&(this._texture.is2DArray=w)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(w){return void 0!==(null===w||void 0===w?void 0:w.shareDepth)}constructor(w){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=j.c.Zero(),this._cachedBaseSize=j.c.Zero(),this._initialSamplingMode=2,this._texture=X._IsRenderTargetWrapper(w)?w.texture:w,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(w){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(w,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var k=e(11301);class m extends X{set ie(w){this._hasAlpha!==w&&(this._hasAlpha=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))))}get ie(){return this._hasAlpha}set getAlphaFromRGB(w){this._getAlphaFromRGB!==w&&(this._getAlphaFromRGB=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(w){this._coordinatesIndex!==w&&(this._coordinatesIndex=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(w){this._coordinatesMode!==w&&(this._coordinatesMode=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(w){this._wrapU=w}get wrapV(){return this._wrapV}set wrapV(w){this._wrapV=w}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(w){this._texture?this._texture.isCube=w:this._isCube=w}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(w){this._texture&&(this._texture.is3D=w)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(w){this._texture&&(this._texture.is2DArray=w)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(w){var p;if(this._texture){if(this._texture._gammaSpace===w)return;this._texture._gammaSpace=w}else{if(this._gammaSpace===w)return;this._gammaSpace=w}null===(p=this.iw())||void 0===p||p.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(w){var p;w!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=w),null===(p=this.iw())||void 0===p||p.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(w){this._texture&&(this._texture._lodGenerationOffset=w)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(w){this._texture&&(this._texture._lodGenerationScale=w)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(w){this._texture&&(this._texture._linearSpecularLOD=w)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(w){this._texture&&(this._texture._irradianceTexture=w)}get uid(){return this._uid||(this._uid=(0,E.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(w){this._onDisposeObserver&&this.ue.remove(this._onDisposeObserver),this._onDisposeObserver=this.ue.add(w)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=m.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.ue=new d.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,w?m._IsScene(w)?this._scene=w:this._engine=w:this._scene=q.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=p,this._uid=null}iw(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return f.b.IdentityReadOnly}getReflectionTextureMatrix(){return f.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(w){}get canRescale(){return!1}_getFromCache(w,p,e,r,I,d){const f=this._getEngine();if(!f)return null;const q=f._getUseSRGBBuffer(!!I,p),E=f.getLoadedTexturesCache();for(let j=0;j<E.length;j++){const f=E[j];if((void 0===I||q===f._useSRGBBuffer)&&(void 0===r||r===f.invertY)&&f.url===w&&f.generateMipMaps===!p&&(!e||e===f.samplingMode)&&(void 0===d||d===f.isCube))return f.incrementReferences(),f}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const w=this.iw();w&&w.markAllMaterialsAsDirty(1)}readPixels(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const j=this._getEngine();if(!j)return null;const X=this.getSize();let k=X.width,m=X.height;0!==p&&(k/=Math.pow(2,p),m/=Math.pow(2,p),k=Math.round(k),m=Math.round(m)),q=Math.min(k,q),E=Math.min(m,E);try{return this._texture.isCube?j._readTexturePixels(this._texture,q,E,w,p,e,r,I,d,f):j._readTexturePixels(this._texture,q,E,-1,p,e,r,I,d,f)}catch(J){return null}}_readPixelsSync(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const d=this.getSize();let f=d.width,q=d.height;const E=this._getEngine();if(!E)return null;0!=p&&(f/=Math.pow(2,p),q/=Math.pow(2,p),f=Math.round(f),q=Math.round(q));try{return this._texture.isCube?E._readTexturePixelsSync(this._texture,f,q,w,p,e,r,I):E._readTexturePixelsSync(this._texture,f,q,-1,p,e,r,I)}catch(j){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const w=this._scene.textures.indexOf(this);if(w>=0&&this._scene.textures.splice(w,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const w=this._parentContainer.textures.indexOf(this);w>-1&&this._parentContainer.textures.splice(w,1),this._parentContainer=null}}this.ue.notifyObservers(this),this.ue.clear(),this.metadata=null,super.dispose()}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!w)return null;const p=k.e.Serialize(this);return k.e.AppendSerializedAnimations(this,p),p}static WhenAllReady(w,p){let e=w.length;if(0!==e)for(let r=0;r<w.length;r++){const I=w[r];if(I.isReady())0===--e&&p();else{const w=I.onLoadObservable;w?w.addOnce((()=>{0===--e&&p()})):0===--e&&p()}}else p()}static _IsScene(w){return"Scene"===w.getClassName()}}m.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,r.c)([(0,I.J)()],m.prototype,"uniqueId",void 0),(0,r.c)([(0,I.J)()],m.prototype,"name",void 0),(0,r.c)([(0,I.J)()],m.prototype,"displayName",void 0),(0,r.c)([(0,I.J)()],m.prototype,"metadata",void 0),(0,r.c)([(0,I.J)("ie")],m.prototype,"_hasAlpha",void 0),(0,r.c)([(0,I.J)("getAlphaFromRGB")],m.prototype,"_getAlphaFromRGB",void 0),(0,r.c)([(0,I.J)()],m.prototype,"level",void 0),(0,r.c)([(0,I.J)("coordinatesIndex")],m.prototype,"_coordinatesIndex",void 0),(0,r.c)([(0,I.J)()],m.prototype,"optimizeUVAllocation",void 0),(0,r.c)([(0,I.J)("coordinatesMode")],m.prototype,"_coordinatesMode",void 0),(0,r.c)([(0,I.J)()],m.prototype,"wrapU",null),(0,r.c)([(0,I.J)()],m.prototype,"wrapV",null),(0,r.c)([(0,I.J)()],m.prototype,"wrapR",void 0),(0,r.c)([(0,I.J)()],m.prototype,"anisotropicFilteringLevel",void 0),(0,r.c)([(0,I.J)()],m.prototype,"isCube",null),(0,r.c)([(0,I.J)()],m.prototype,"is3D",null),(0,r.c)([(0,I.J)()],m.prototype,"is2DArray",null),(0,r.c)([(0,I.J)()],m.prototype,"gammaSpace",null),(0,r.c)([(0,I.J)()],m.prototype,"invertZ",void 0),(0,r.c)([(0,I.J)()],m.prototype,"lodLevelInAlpha",void 0),(0,r.c)([(0,I.J)()],m.prototype,"lodGenerationOffset",null),(0,r.c)([(0,I.J)()],m.prototype,"lodGenerationScale",null),(0,r.c)([(0,I.J)()],m.prototype,"linearSpecularLOD",null),(0,r.c)([(0,I.C)()],m.prototype,"irradianceTexture",null),(0,r.c)([(0,I.J)()],m.prototype,"isRenderTarget",void 0)},11681:(w,p,e)=>{var r=e(11690),I=e(11494);I.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(I.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=r.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((w=>{this._texture._sphericalPolynomial=w,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(w){this._texture&&(this._texture._sphericalPolynomial=w)},enumerable:!0,configurable:!0})},11161:(w,p,e)=>{e.d(p,{d:()=>f});var r,I=e(11056),d=e(11164);!function(w){w[w.Unknown=0]="Unknown",w[w.Url=1]="Url",w[w.Temp=2]="Temp",w[w.Raw=3]="Raw",w[w.Dynamic=4]="Dynamic",w[w.RenderTarget=5]="RenderTarget",w[w.MultiRenderTarget=6]="MultiRenderTarget",w[w.Cube=7]="Cube",w[w.CubeRaw=8]="CubeRaw",w[w.CubePrefiltered=9]="CubePrefiltered",w[w.Raw3D=10]="Raw3D",w[w.Raw2DArray=11]="Raw2DArray",w[w.DepthStencil=12]="DepthStencil",w[w.CubeRawRGBD=13]="CubeRawRGBD",w[w.Depth=14]="Depth"}(r||(r={}));class f extends d.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(w){this.generateMipMaps=w}get uniqueId(){return this._uniqueId}_setUniqueId(w){this._uniqueId=w}getEngine(){return this._engine}get source(){return this._source}constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new I.d,this.onErrorObservable=new I.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=w,this._source=p,this._uniqueId=f._Counter++,e||(this._hardwareTexture=w._createHardwareTexture())}incrementReferences(){this._references++}updateSize(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,w,p,e),this.width=w,this.height=p,this.depth=e,this.baseWidth=w,this.baseHeight=p,this.baseDepth=e,this._size=w*p*e}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const w=this.onRebuildCallback(this),p=p=>{p._swapAndDie(this,!1),this.isReady=w.isReady};return void(w.isAsync?w.proxy.then(p):p(w.proxy))}let w;switch(this.source){case 2:case 12:case 14:break;case 1:return void(w=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(w=>{w._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:w=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),w._swapAndDie(this,!1),this.isReady=!0;break;case 10:w=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),w._swapAndDie(this,!1),this.isReady=!0;break;case 11:w=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),w._swapAndDie(this,!1),this.isReady=!0;break;case 4:w=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),w._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(w=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{w._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:w=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),w._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return w=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(w=>{w&&w._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(w._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(w){var p;let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(p=this._hardwareTexture)||void 0===p||p.setUsage(w._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),w._hardwareTexture=this._hardwareTexture,e&&(w._isRGBD=this._isRGBD),this._lodTextureHigh&&(w._lodTextureHigh&&w._lodTextureHigh.dispose(),w._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(w._lodTextureMid&&w._lodTextureMid.dispose(),w._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(w._lodTextureLow&&w._lodTextureLow.dispose(),w._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(w._irradianceTexture&&w._irradianceTexture.dispose(),w._irradianceTexture=this._irradianceTexture);const r=this._engine.getLoadedTexturesCache();let I=r.indexOf(this);-1!==I&&r.splice(I,1),I=r.indexOf(w),-1===I&&r.push(w)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}f._Counter=0},11546:(w,p,e)=>{e.d(p,{b:()=>I});var r=e(11511);class I extends r.e{constructor(w,p,e,I,d){let f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,X=arguments.length>9?arguments[9]:void 0,k=arguments.length>10?arguments[10]:void 0,m=arguments.length>11?arguments[11]:void 0;super(null,d,!f,q,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,X),this.format=I,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==j||(E=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==j||(E=1),this._texture=this._engine.createRawTexture(w,p,e,I,f,q,E,null,j,X??0,k??!1),this.wrapU=r.e.CLAMP_ADDRESSMODE,this.wrapV=r.e.CLAMP_ADDRESSMODE,this._waitingForData=!!m&&!w)}update(w){this._getEngine().updateRawTexture(this._texture,w,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const w=new I(null,this.getSize().width,this.getSize().height,this.format,this.iw(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return w._texture=this._texture,this._texture.incrementReferences(),w}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(w,p,e,r){return new I(w,p,e,1,r,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(w,p,e,r){return new I(w,p,e,2,r,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(w,p,e,r){return new I(w,p,e,0,r,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(w,p,e,r){return new I(w,p,e,4,r,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(w,p,e,r){return new I(w,p,e,5,r,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(w,p,e,r){return new I(w,p,e,5,r,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(w,p,e,d){let f=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r.e.TRILINEAR_SAMPLINGMODE;return new I(w,p,e,6,d,f,q,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(w,p,e,d){let f=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r.e.TRILINEAR_SAMPLINGMODE;return new I(w,p,e,6,d,f,q,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11517:(w,p,e)=>{e.d(p,{d:()=>J});var r=e(11056),I=e(11023),d=e(11511),f=e(11519),q=e(11194),E=e(11139),j=e(11081),X=e(11526),k=e(11030);class m{get renderList(){return this._renderList}set renderList(w){this._renderList!==w&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),w&&(this._unObserveRenderList=(0,k.i)(w,this._renderListHasChanged)),this._renderList=w)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(w){w!==this._disableImageProcessing&&(this._disableImageProcessing=w,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(w){if(this._name===w)return;if(this._name=w,!this._scene)return;const p=this._scene.getEngine();for(let e=0;e<this._renderPassIds.length;++e){const w=this._renderPassIds[e];p._renderPassNames[w]=`${this._name}#${e}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(w,p){let e;e=Array.isArray(w)?w:[w];for(let r=0;r<e.length;++r)for(let w=0;w<this.options.numPasses;++w){let I=e[r];e[r].isAnInstance&&(I=e[r].sourceMesh),I.setMaterialForRenderPass(this._renderPassIds[w],void 0!==p?Array.isArray(p)?p[w]:p:void 0)}}constructor(w,p,e){this._unObserveRenderList=null,this._renderListHasChanged=(w,p)=>{const e=this._renderList?this._renderList.length:0;if(0===p&&e>0||0===e)for(const r of this._scene.meshes)r._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new r.d,this.onAfterRenderObservable=new r.d,this.onBeforeRenderingManagerRenderObservable=new r.d,this.onAfterRenderingManagerRenderObservable=new r.d,this.onFastPathRenderObservable=new r.d,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=w,this._scene=p,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...e},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new X.b(p),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const w=this._scene.getEngine();for(let p=0;p<this.options.numPasses;++p)w.releaseRenderPassId(this._renderPassIds[p]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const w=this._scene.getEngine();for(let p=0;p<this.options.numPasses;++p)this._renderPassIds[p]=w.createRenderPassId(`${this.name}#${p}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(w){this._refreshRate=w,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(w,p){this.prepareRenderList(),this.initRender(w,p);const e=this._checkReadiness();return this.finishRender(),e}prepareRenderList(){const w=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let p=0;p<this._waitingRenderList.length;p++){const e=this._waitingRenderList[p],r=w.getMeshById(e);r&&this.renderList.push(r)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const w=this._scene.meshes;for(let p=0;p<w.length;p++){const e=w[p];this.renderListPredicate(e)&&this.renderList.push(e)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(w,p){const e=this._scene.getEngine(),r=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,r&&(r!==this._scene.activeCamera&&(this._scene.setTransformMatrix(r.getViewMatrix(),r.getProjectionMatrix(!0)),this._scene.activeCamera=r),e.setViewport(r.rigParent?r.rigParent.viewport:r.viewport,w,p)),this._defaultRenderListPrepared=!1}finishRender(){const w=this._scene;this._disableImageProcessing&&(w.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),w.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==w.activeCamera&&w.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),w.getEngine().setViewport(this._currentSceneCamera.viewport)),w.resetCachedMaterial()}render(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._scene,r=e.getEngine(),I=r.currentRenderPassId;r.currentRenderPassId=this._renderPassIds[w],this.onBeforeRenderObservable.notifyObservers(w);if(r.snapshotRendering&&1===r.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(w);else{let p=null;const r=this.renderList?this.renderList:e.getActiveMeshes().data,I=this.renderList?this.renderList.length:e.getActiveMeshes().length;this.getCustomRenderList&&(p=this.getCustomRenderList(w,r,I)),p?this._prepareRenderingManager(p,p.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(r,I,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),p=r),this.onBeforeRenderingManagerRenderObservable.notifyObservers(w),this._renderingManager.render(this.customRenderFunction,p,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(w)}p||this.onAfterRenderObservable.notifyObservers(w),r.currentRenderPassId=I}_checkReadiness(){const w=this._scene,p=w.getEngine(),e=p.currentRenderPassId;let r=!0;w.getViewMatrix()||w.updateTransformMatrix();const I=this.options.numPasses;for(let f=0;f<I&&r;f++){let e=null;const d=this.renderList?this.renderList:w.getActiveMeshes().data,q=this.renderList?this.renderList.length:w.getActiveMeshes().length;p.currentRenderPassId=this._renderPassIds[f],this.onBeforeRenderObservable.notifyObservers(f),this.getCustomRenderList&&(e=this.getCustomRenderList(f,d,q)),e||(e=d),this.options.doNotChangeAspectRatio||w.updateTransformMatrix(!0);for(let w=0;w<e.length&&r;++w){const p=e[w];if(p.isEnabled()&&!p.isBlocked&&p.isVisible&&p.oe)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(p,this.refreshRate,!0)){r=!1;continue}}else if(!p.isReady(!0)){r=!1;continue}}this.onAfterRenderObservable.notifyObservers(f),I>1&&(w.incrementRenderId(),w.resetCachedMaterial())}const d=this.particleSystemList||w.tm;for(const f of d)f.isReady()||(r=!1);return p.currentRenderPassId=e,r}_prepareRenderingManager(w,p,e){const r=this._scene,I=r.activeCamera,d=this.cameraForLOD??I;this._renderingManager.reset();const f=r.getRenderId(),q=r.getFrameId();for(let j=0;j<p;j++){const p=w[j];if(p&&!p.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(p,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!p.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let w,E=null;if(d){const w=p._internalAbstractMeshDataInfo._currentLOD.get(d);w&&w[1]===q?E=w[0]:(E=r.customLODSelector?r.customLODSelector(p,d):p.getLOD(d),w?(w[0]=E,w[1]=q):p._internalAbstractMeshDataInfo._currentLOD.set(d,[E,q]))}else E=p;if(!E)continue;if(E!==p&&0!==E.billboardMode&&E.ke(),E._preActivateForIntermediateRendering(f),w=!(!e||!I)&&0===(p.layerMask&I.layerMask),p.isEnabled()&&p.isVisible&&p.oe&&!w){if(E!==p&&E._activate(f,!0),p._activate(f,!0)&&p.oe.length){p.isAnInstance?p._internalAbstractMeshDataInfo._actAsRegularMesh&&(E=p):E._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,E._internalAbstractMeshDataInfo._isActiveIntermediate=!0,r._prepareSkeleton(E);for(let w=0;w<E.oe.length;w++){const p=E.oe[w];this._renderingManager.dispatch(p,E)}}p._postActivate()}}}const E=this.particleSystemList||r.tm;for(let j=0;j<E.length;j++){const w=E[j],p=w.i;w.isStarted()&&p&&(!p.position||p.isEnabled())&&this._renderingManager.dispatchParticles(w)}}setRenderingOrder(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(w,p,e,r)}setRenderingAutoClearDepthStencil(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(w,p,e,r),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const w=new m(this.name,this._scene,this.options);return this.renderList&&(w.renderList=this.renderList.slice(0)),w}dispose(){const w=this.renderList?this.renderList:this._scene.getActiveMeshes().data,p=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let e=0;e<p;e++){const p=w[e];p&&void 0!==p.getMaterialForRenderPass(this.renderPassId)&&p.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===m.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=m.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}m.REFRESHRATE_RENDER_ONCE=0,m.REFRESHRATE_RENDER_ONEVERYFRAME=1,m.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,E.e.prototype.setDepthStencilTexture=function(w,p){this._engine.setDepthStencilTexture(this._samplers[w],this._uniforms[w],p,w)};class J extends d.e{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(w){this._objectRenderer.renderListPredicate=w}get renderList(){return this._objectRenderer.renderList}set renderList(w){this._objectRenderer.renderList=w}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(w){this._objectRenderer.particleSystemList=w}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(w){this._objectRenderer.getCustomRenderList=w}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(w){this._objectRenderer.renderParticles=w}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(w){this._objectRenderer.renderSprites=w}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(w){this._objectRenderer.forceLayerMaskCheck=w}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(w){this._objectRenderer.activeCamera=w}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(w){this._objectRenderer.cameraForLOD=w}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(w){this._objectRenderer.disableImageProcessing=w}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(w){this._objectRenderer.customIsReadyFunction=w}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(w){this._objectRenderer.customRenderFunction=w}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(w){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(w)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(w){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(w)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(w){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(w)}set onClear(w){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(w)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(w){this._objectRenderer._waitingRenderList=w}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(w,p){this._objectRenderer.setMaterialForRendering(w,p)}get isMulti(){var w;return(null===(w=this._renderTarget)||void 0===w?void 0:w.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(w){if(this._boundingBoxSize&&this._boundingBoxSize.equals(w))return;this._boundingBoxSize=w;const p=this.iw();p&&p.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var w;return(null===(w=this._renderTarget)||void 0===w?void 0:w._depthStencilTexture)??null}constructor(w,p,e){let f,q,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:d.e.TRILINEAR_SAMPLINGMODE,y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=arguments.length>9&&void 0!==arguments[9]&&arguments[9],s=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,a=arguments.length>12&&void 0!==arguments[12]&&arguments[12],A=arguments.length>13?arguments[13]:void 0,z=arguments.length>14?arguments[14]:void 0,M=arguments.length>15&&void 0!==arguments[15]&&arguments[15],i=arguments.length>16&&void 0!==arguments[16]&&arguments[16],t=!0;if("object"===typeof E){const w=E;E=!!w.generateMipMaps,X=w.doNotChangeAspectRatio??!0,k=w.type??0,J=!!w.isCube,K=w.samplingMode??d.e.TRILINEAR_SAMPLINGMODE,y=w.generateDepthBuffer??!0,c=!!w.generateStencilBuffer,s=!!w.isMulti,O=w.format??5,a=!!w.delayAllocation,A=w.samples,z=w.creationFlags,M=!!w.noColorAttachment,i=!!w.useSRGBBuffer,f=w.colorAttachment,t=w.gammaSpace??t,q=w.existingObjectRenderer}if(super(null,e,!E,void 0,K,void 0,void 0,void 0,void 0,O),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new r.d,this.onAfterUnbindObservable=new r.d,this.onClearObservable=new r.d,this.onResizeObservable=new r.d,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=I.k.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(e=this.iw()))return;const n=this.iw().getEngine();this._gammaSpace=t,this._coordinatesMode=d.e.PROJECTION_MODE,this.name=w,this.isRenderTarget=!0,this._initialSizeParameter=p,this._dontDisposeObjectRenderer=!!q,this._processSizeParameter(p),this._objectRenderer=q??new m(w,e,{numPasses:J?6:this.getRenderLayers()||1,doNotChangeAspectRatio:X}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const w of this._scene._beforeRenderTargetClearStage)w.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(n):this.skipInitialClear||n.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const w of this._scene._beforeRenderTargetDrawStage)w.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var w;if(!this._disableEngineStages)for(const e of this._scene._afterRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer);const p=(null===(w=this._texture)||void 0===w?void 0:w.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const e of this._scene._afterRenderTargetPostProcessStage)e.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=p),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),n):j.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(n):this.skipInitialClear||n.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=n.onResizeObservable.add((()=>{})),this._generateMipMaps=!!E,this._doNotChangeAspectRatio=X,s||(this._renderTargetOptions={generateMipMaps:E,type:k,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:y,generateStencilBuffer:c,samples:A,creationFlags:z,noColorAttachment:M,useSRGBBuffer:i,colorAttachment:f,label:this.name},this.samplingMode===d.e.NEAREST_SAMPLINGMODE&&(this.wrapU=d.e.CLAMP_ADDRESSMODE,this.wrapV=d.e.CLAMP_ADDRESSMODE),a||(J?(this._renderTarget=e.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=d.e.INVCUBIC_MODE,this._textureMatrix=I.b.Identity()):this._renderTarget=e.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==A&&(this.samples=A)))}createDepthStencilTexture(){var w;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,f=arguments.length>5?arguments[5]:void 0;null===(w=this._renderTarget)||void 0===w||w.createDepthStencilTexture(p,e,r,I,d,f)}_processSizeParameter(w){if(w.ratio){this._sizeRatio=w.ratio;const p=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(p.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(p.getRenderHeight(),this._sizeRatio)}}else this._size=w}get samples(){var w;return(null===(w=this._renderTarget)||void 0===w?void 0:w.samples)??this._samples}set samples(w){this._renderTarget&&(this._samples=this._renderTarget.setSamples(w))}addPostProcess(w){if(!this._postProcessManager){const w=this.iw();if(!w)return;this._postProcessManager=new f.d(w),this._postProcesses=new Array}this._postProcesses.push(w),this._postProcesses[0].wm=!1}clearPostProcesses(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(w)for(const w of this._postProcesses)w.dispose();this._postProcesses=[]}}removePostProcess(w){if(!this._postProcesses)return;const p=this._postProcesses.indexOf(w);-1!==p&&(this._postProcesses.splice(p,1),this._postProcesses.length>0&&(this._postProcesses[0].wm=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(w){this._objectRenderer.refreshRate=w}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const w=this._size.layers;if(w)return w;const p=this._size.depth;return p||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(w){const p=Math.max(1,this.getRenderSize()*w);this.resize(p)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(w){var p;const e=this.isCube;null===(p=this._renderTarget)||void 0===p||p.dispose(),this._renderTarget=null;const r=this.iw();r&&(this._processSizeParameter(w),this._renderTarget=e?r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(w,p)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(e.bind(e,11555)).then((w=>this._dumpTools=w))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const w=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),w}_render(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this.iw();if(e){if(void 0!==this.useCameraPostProcesses&&(w=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let r=0;r<6;r++)this._renderToTarget(r,w,p),e.incrementRenderId(),e.resetCachedMaterial();else this._renderToTarget(0,w,p);else for(let r=0;r<this.getRenderLayers();r++)this._renderToTarget(0,w,p,r),e.incrementRenderId(),e.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(w,p){const e=w*p,r=(0,q.n)(e+16384/(128+e));return Math.min((0,q.d)(w),r)}_bindFrameBuffer(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.iw();if(!e)return;const r=e.getEngine();this._renderTarget&&r.bindFramebuffer(this._renderTarget,this.isCube?w:void 0,void 0,void 0,this.ignoreCameraViewport,0,p)}_unbindFrameBuffer(w,p){this._renderTarget&&w.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(p)}))}_prepareFrame(w,p,e,r){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(p,e):r&&w.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(p,e)}_renderToTarget(w,p,e){var r,I;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const f=this.iw();if(!f)return;const q=f.getEngine();this._currentFaceIndex=w,this._currentLayer=d,this._currentUseCameraPostProcess=p,this._currentDumpForDebug=e,this._prepareFrame(f,w,d,p),null===(r=q._debugPushGroup)||void 0===r||r.call(q,`render to face #${w} layer #${d}`,2),this._objectRenderer.render(w+d,!0),null===(I=q._debugPopGroup)||void 0===I||I.call(q,2),this._unbindFrameBuffer(q,w),this._texture&&this.isCube&&5===w&&q.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(w,p,e,r)}setRenderingAutoClearDepthStencil(w,p){this._objectRenderer.setRenderingAutoClearDepthStencil(w,p)}clone(){const w=this.getSize(),p=new J(this.name,w,this.iw(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return p.ie=this.ie,p.level=this.level,p.coordinatesMode=this.coordinatesMode,this.renderList&&(p.renderList=this.renderList.slice(0)),p}serialize(){if(!this.name)return null;const w=super.serialize();if(w.renderTargetSize=this.getRenderSize(),w.renderList=[],this.renderList)for(let p=0;p<this.renderList.length;p++)w.renderList.push(this.renderList[p].id);return w}disposeFramebufferObjects(){var w;null===(w=this._renderTarget)||void 0===w||w.dispose(!0)}releaseInternalTexture(){var w;null===(w=this._renderTarget)||void 0===w||w.releaseTextures(),this._texture=null}dispose(){var w;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.iw().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const p=this.iw();if(!p)return;let e=p.customRenderTargets.indexOf(this);e>=0&&p.customRenderTargets.splice(e,1);for(const r of p.cameras)e=r.customRenderTargets.indexOf(this),e>=0&&r.customRenderTargets.splice(e,1);null===(w=this._renderTarget)||void 0===w||w.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}J.REFRESHRATE_RENDER_ONCE=m.REFRESHRATE_RENDER_ONCE,J.REFRESHRATE_RENDER_ONEVERYFRAME=m.REFRESHRATE_RENDER_ONEVERYFRAME,J.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=m.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,d.e._CreateRenderTargetTexture=(w,p,e,r,I)=>new J(w,p,e,r)},11511:(w,p,e)=>{e.d(p,{e:()=>a});var r=e(11207),I=e(11213),d=e(11056),f=e(11023),q=e(11494),E=e(11038),j=e(11094),X=e(11127),k=e(11182),m=e(11292),J=e(11116);function K(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=p.width,I=p.height;if(w instanceof Float32Array){let p=w.byteLength/w.BYTES_PER_ELEMENT;const e=new Uint8Array(p);for(;--p>=0;){let r=w[p];r<0?r=0:r>1&&(r=1),e[p]=255*r}w=e}const d=document.createElement("canvas");d.width=r,d.height=I;const f=d.getContext("2d");if(!f)return null;const q=f.createImageData(r,I);if(q.data.set(w),f.putImageData(q,0,0),e){const w=document.createElement("canvas");w.width=r,w.height=I;const p=w.getContext("2d");return p?(p.translate(0,I),p.scale(1,-1),p.drawImage(d,0,0),w.toDataURL("image/png")):null}return d.toDataURL("image/png")}function y(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=w.getInternalTexture();if(!r)return null;const I=w._readPixelsSync(p,e);return I?K(I,w.getSize(),r.invertY):null}async function c(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=w.getInternalTexture();if(!r)return null;const I=await w.readPixels(p,e);return I?K(I,w.getSize(),r.invertY):null}var s=e(11400),O=e(11301);class a extends q.b{static _CreateVideoTexture(w,p,e){arguments.length>5&&void 0!==arguments[5]||a.TRILINEAR_SAMPLINGMODE;throw(0,j.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(w){this._isBlocking=w}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(w,p,e,r){let I,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.TRILINEAR_SAMPLINGMODE,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],m=arguments.length>9?arguments[9]:void 0,J=arguments.length>10?arguments[10]:void 0,K=arguments.length>11?arguments[11]:void 0,y=arguments.length>12?arguments[12]:void 0,c=arguments.length>13?arguments[13]:void 0;super(p),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new d.d,this._isBlocking=!0,this.name=w||"",this.url=w;let O=!1,A=null,z=!0;"object"===typeof e&&null!==e?(I=e.noMipmap??!1,r=e.invertY??!s.b,f=e.samplingMode??a.TRILINEAR_SAMPLINGMODE,q=e.G??null,E=e.onError??null,j=e.buffer??null,k=e.deleteBuffer??!1,m=e.format,J=e.mimeType,K=e.loaderOptions,y=e.creationFlags,O=e.useSRGBBuffer??!1,A=e.internalTexture??null,z=e.gammaSpace??z,c=e.forcedExtension??c):I=!!e,this._gammaSpace=z,this._noMipmap=I,this._invertY=void 0===r?!s.b:r,this._initialSamplingMode=f,this._buffer=j,this._deleteBuffer=k,this._mimeType=J,this._loaderOptions=K,this._creationFlags=y,this._useSRGBBuffer=O,this._forcedExtension=c,void 0!==m&&(this._format=m);const M=this.iw(),i=this._getEngine();if(!i)return;i.onBeforeTextureInitObservable.notifyObservers(this);const t=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),q&&q(),!this.isBlocking&&M&&M.resetCachedMaterial()},n=(w,p)=>{this._loadingError=!0,this._errorObject={message:w,exception:p},E&&E(w,p),a.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!A)return this._delayedOnLoad=t,void(this._delayedOnError=n);if(this._texture=A??this._getFromCache(this.url,I,f,this._invertY,O,this.isCube),this._texture)if(this._texture.isReady)X.c.SetImmediate((()=>t()));else{const w=this._texture.onLoadedObservable.add(t);this._texture.onErrorObservable.add((p=>{var e;n(p.message,p.exception),null===(e=this._texture)||void 0===e||e.onLoadedObservable.remove(w)}))}else if(M&&M.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=t,this._delayedOnError=n;else{try{this._texture=i.createTexture(this.url,I,this._invertY,M,f,t,n,this._buffer,void 0,this._format,this._forcedExtension,J,K,y,O)}catch(l){throw n("error loading",l),l}k&&(this._buffer=null)}}updateURL(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.iw().markAllMaterialsAsDirty(1,(w=>w.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=w),this.url=w,this._buffer=p,this._forcedExtension=r,this.delayLoadState=4,e&&(this._delayedOnLoad=e),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const w=this.iw();w&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?X.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=w.getEngine().createTexture(this.url,this._noMipmap,this._invertY,w,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(w,p,e,r){w*=this._cachedUScale,p*=this._cachedVScale,w-=this.uRotationCenter*this._cachedUScale,p-=this.vRotationCenter*this._cachedVScale,e-=this.wRotationCenter,f.k.TransformCoordinatesFromFloatsToRef(w,p,e,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}getTextureMatrix(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*w===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*w,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=f.b.Zero(),this._rowGenerationMatrix=new f.b,this._t0=f.k.Zero(),this._t1=f.k.Zero(),this._t2=f.k.Zero()),f.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(f.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,f.d.Matrix[0]),f.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,f.d.Matrix[1]),f.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,f.d.Matrix[2]),f.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,f.d.Matrix[3]),f.d.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(f.d.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(f.d.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(f.d.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.zk(this._t0),this._t2.zk(this._t0),f.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const p=this.iw();if(!p)return this._cachedTextureMatrix;const e=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&e!==this._cachedIdentity3x2&&p.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const w=this.iw();if(!w)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==a.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===w.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=f.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=f.b.Zero());const p=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case a.PLANAR_MODE:f.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case a.PROJECTION_MODE:{f.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const p=w.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=p.updateFlag,p.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:f.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return p&&w.markAllMaterialsAsDirty(1,(w=>w.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const w={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,G:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return O.e.Clone((()=>new a(this._texture?this._texture.url:null,this.iw(),w)),this)}serialize(){var w;const p=this.name;a.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const e=super.serialize(a._SerializeInternalTextureUniqueId);if(!e)return null;if(a.SerializeBuffers||a.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))e.base64String=this._buffer,e.name=e.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const w=this.mimeType||"image/png";e.base64String=`data:${w};base64,${(0,J.m)(this._buffer)}`}else(a.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(e.base64String=!this._engine||this._engine._features.supportSyncTextureRead?y(this):c(this));var r;(e.invertY=this._invertY,e.samplingMode=this.samplingMode,e._creationFlags=this._creationFlags,e._useSRGBBuffer=this._useSRGBBuffer,a._SerializeInternalTextureUniqueId)&&(e.internalTextureUniqueId=null===(r=this._texture)||void 0===r?void 0:r.uniqueId);return e.internalTextureLabel=null===(w=this._texture)||void 0===w?void 0:w.label,e.noMipmap=this._noMipmap,this.name=p,e}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(w,p,e){if(w.customType){const r=k.c.Instantiate(w.customType).Parse(w,p,e);return w.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==w.samplingMode&&r.updateSamplingMode(w.samplingMode),r}if(w.isCube&&!w.isRenderTarget)return a._CubeTextureParser(w,p,e);const r=void 0!==w.internalTextureUniqueId;if(!w.name&&!w.isRenderTarget&&!r)return null;let I;if(r){const e=p.getEngine().getLoadedTexturesCache();for(const p of e)if(p.uniqueId===w.internalTextureUniqueId){I=p;break}}const d=p=>{if(p&&p._texture&&(p._texture._cachedWrapU=null,p._texture._cachedWrapV=null,p._texture._cachedWrapR=null),w.samplingMode){const e=w.samplingMode;p&&p.samplingMode!==e&&p.updateSamplingMode(e)}if(p&&w.animations)for(let e=0;e<w.animations.length;e++){const r=w.animations[e],I=(0,E.c)("BABYLON.Animation");I&&p.animations.push(I.Parse(r))}p&&p._texture&&(r&&!I&&p._texture._setUniqueId(w.internalTextureUniqueId),p._texture.label=w.internalTextureLabel)};return O.e.Parse((()=>{let r=!0;if(w.noMipmap&&(r=!1),w.mirrorPlane){const e=a._CreateMirror(w.name,w.renderTargetSize,p,r);return e._waitingRenderList=w.renderList,e.mirrorPlane=m.e.Ve(w.mirrorPlane),d(e),e}if(w.isRenderTarget){let e=null;if(w.isCube){if(p.reflectionProbes)for(let r=0;r<p.reflectionProbes.length;r++){const e=p.reflectionProbes[r];if(e.name===w.name)return e.cubeTexture}}else e=a._CreateRenderTargetTexture(w.name,w.renderTargetSize,p,r,w._creationFlags??0),e._waitingRenderList=w.renderList;return d(e),e}if(w.isVideo){const I=a._CreateVideoTexture(e+(w.url||w.name),e+(w.src||w.url),p,r,w.invertY,w.samplingMode,w.settings||{});return d(I),I}{let f;if(w.base64String&&!I)f=a.CreateFromBase64String(w.base64String,w.base64String,p,!r,w.invertY,w.samplingMode,(()=>{d(f)}),w._creationFlags??0,w._useSRGBBuffer??!1),f.name=w.name;else{let q;q=w.name&&(w.name.indexOf("://")>0||w.name.startsWith("data:"))?w.name:e+w.name,w.url&&(w.url.startsWith("data:")||a.UseSerializedUrlIfAny)&&(q=w.url);const E={noMipmap:!r,invertY:w.invertY,samplingMode:w.samplingMode,G:()=>{d(f)},internalTexture:I};f=new a(q,p,E)}return f}}),w,p)}static CreateFromBase64String(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:a.TRILINEAR_SAMPLINGMODE;return new a("data:"+p,e,r,I,d,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.TRILINEAR_SAMPLINGMODE,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,X=arguments.length>10?arguments[10]:void 0,k=arguments.length>11?arguments[11]:void 0;return"data:"!==w.substring(0,5)&&(w="data:"+w),new a(w,e,I,d,f,q,E,p,r,j,void 0,void 0,X,k)}}a.SerializeBuffers=!0,a.ForceSerializeBuffers=!1,a.OnTextureLoadErrorObservable=new d.d,a._SerializeInternalTextureUniqueId=!1,a._CubeTextureParser=(w,p,e)=>{throw(0,j.c)("CubeTexture")},a._CreateMirror=(w,p,e,r)=>{throw(0,j.c)("MirrorTexture")},a._CreateRenderTargetTexture=(w,p,e,r,I)=>{throw(0,j.c)("RenderTargetTexture")},a.NEAREST_SAMPLINGMODE=1,a.NEAREST_NEAREST_MIPLINEAR=8,a.BILINEAR_SAMPLINGMODE=2,a.LINEAR_LINEAR_MIPNEAREST=11,a.TRILINEAR_SAMPLINGMODE=3,a.LINEAR_LINEAR_MIPLINEAR=3,a.NEAREST_NEAREST_MIPNEAREST=4,a.NEAREST_LINEAR_MIPNEAREST=5,a.NEAREST_LINEAR_MIPLINEAR=6,a.NEAREST_LINEAR=7,a.NEAREST_NEAREST=1,a.LINEAR_NEAREST_MIPNEAREST=9,a.LINEAR_NEAREST_MIPLINEAR=10,a.LINEAR_LINEAR=2,a.LINEAR_NEAREST=12,a.EXPLICIT_MODE=0,a.SPHERICAL_MODE=1,a.PLANAR_MODE=2,a.CUBIC_MODE=3,a.PROJECTION_MODE=4,a.SKYBOX_MODE=5,a.INVCUBIC_MODE=6,a.EQUIRECTANGULAR_MODE=7,a.FIXED_EQUIRECTANGULAR_MODE=8,a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,a.CLAMP_ADDRESSMODE=0,a.WRAP_ADDRESSMODE=1,a.MIRROR_ADDRESSMODE=2,a.UseSerializedUrlIfAny=!1,(0,r.c)([(0,I.J)()],a.prototype,"url",void 0),(0,r.c)([(0,I.J)()],a.prototype,"uOffset",void 0),(0,r.c)([(0,I.J)()],a.prototype,"vOffset",void 0),(0,r.c)([(0,I.J)()],a.prototype,"uScale",void 0),(0,r.c)([(0,I.J)()],a.prototype,"vScale",void 0),(0,r.c)([(0,I.J)()],a.prototype,"uAng",void 0),(0,r.c)([(0,I.J)()],a.prototype,"vAng",void 0),(0,r.c)([(0,I.J)()],a.prototype,"wAng",void 0),(0,r.c)([(0,I.J)()],a.prototype,"uRotationCenter",void 0),(0,r.c)([(0,I.J)()],a.prototype,"vRotationCenter",void 0),(0,r.c)([(0,I.J)()],a.prototype,"wRotationCenter",void 0),(0,r.c)([(0,I.J)()],a.prototype,"homogeneousRotationInUVTransform",void 0),(0,r.c)([(0,I.J)()],a.prototype,"isBlocking",null),(0,E.d)("BABYLON.Texture",a),O.e._TextureParser=a.Parse},11437:(w,p,e)=>{function r(w){return 13===w||14===w||15===w||16===w||17===w||18===w||19===w}function I(w){return 13===w||17===w||18===w||19===w}e.d(p,{c:()=>I,e:()=>r})},11164:(w,p,e)=>{e.d(p,{e:()=>r});class r{get wrapU(){return this._cachedWrapU}set wrapU(w){this._cachedWrapU=w}get wrapV(){return this._cachedWrapV}set wrapV(w){this._cachedWrapV=w}get wrapR(){return this._cachedWrapR}set wrapR(w){this._cachedWrapR=w}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(w){this._cachedAnisotropicFilteringLevel=w}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(w){this._comparisonFunction=w}get useMipMaps(){return this._useMipMaps}set useMipMaps(w){this._useMipMaps=w}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=w,this._cachedWrapV=p,this._cachedWrapR=e,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=I,this._comparisonFunction=d,this}compareSampler(w){return this._cachedWrapU===w._cachedWrapU&&this._cachedWrapV===w._cachedWrapV&&this._cachedWrapR===w._cachedWrapR&&this._cachedAnisotropicFilteringLevel===w._cachedAnisotropicFilteringLevel&&this.samplingMode===w.samplingMode&&this._comparisonFunction===w._comparisonFunction&&this._useMipMaps===w._useMipMaps}}},11320:(w,p,e)=>{function r(w){-1===w.indexOf("vClipPlane")&&w.push("vClipPlane"),-1===w.indexOf("vClipPlane2")&&w.push("vClipPlane2"),-1===w.indexOf("vClipPlane3")&&w.push("vClipPlane3"),-1===w.indexOf("vClipPlane4")&&w.push("vClipPlane4"),-1===w.indexOf("vClipPlane5")&&w.push("vClipPlane5"),-1===w.indexOf("vClipPlane6")&&w.push("vClipPlane6")}function I(w,p,e){const r=!!(w.clipPlane??p.clipPlane),I=!!(w.clipPlane2??p.clipPlane2),d=!!(w.clipPlane3??p.clipPlane3),f=!!(w.clipPlane4??p.clipPlane4),q=!!(w.clipPlane5??p.clipPlane5),E=!!(w.clipPlane6??p.clipPlane6);r&&e.push("#define CLIPPLANE"),I&&e.push("#define CLIPPLANE2"),d&&e.push("#define CLIPPLANE3"),f&&e.push("#define CLIPPLANE4"),q&&e.push("#define CLIPPLANE5"),E&&e.push("#define CLIPPLANE6")}function d(w,p,e){let r=!1;const I=!!(w.clipPlane??p.clipPlane),d=!!(w.clipPlane2??p.clipPlane2),f=!!(w.clipPlane3??p.clipPlane3),q=!!(w.clipPlane4??p.clipPlane4),E=!!(w.clipPlane5??p.clipPlane5),j=!!(w.clipPlane6??p.clipPlane6);return e.CLIPPLANE!==I&&(e.CLIPPLANE=I,r=!0),e.CLIPPLANE2!==d&&(e.CLIPPLANE2=d,r=!0),e.CLIPPLANE3!==f&&(e.CLIPPLANE3=f,r=!0),e.CLIPPLANE4!==q&&(e.CLIPPLANE4=q,r=!0),e.CLIPPLANE5!==E&&(e.CLIPPLANE5=E,r=!0),e.CLIPPLANE6!==j&&(e.CLIPPLANE6=j,r=!0),r}function f(w,p,e){let r=p.clipPlane??e.clipPlane;q(w,"vClipPlane",r),r=p.clipPlane2??e.clipPlane2,q(w,"vClipPlane2",r),r=p.clipPlane3??e.clipPlane3,q(w,"vClipPlane3",r),r=p.clipPlane4??e.clipPlane4,q(w,"vClipPlane4",r),r=p.clipPlane5??e.clipPlane5,q(w,"vClipPlane5",r),r=p.clipPlane6??e.clipPlane6,q(w,"vClipPlane6",r)}function q(w,p,e){e&&w.setFloat4(p,e.dp.x,e.dp.y,e.dp.z,e.d)}e.d(p,{b:()=>r,e:()=>f,h:()=>d,l:()=>I})},11599:(w,p,e)=>{function r(w){w.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}e.d(p,{b:()=>r})},11419:(w,p,e)=>{function r(w){return void 0===w.getPipelineContext}e.d(p,{d:()=>r})},11286:(w,p,e)=>{e.d(p,{b:()=>I});var r=e(11127);class I{static GetEffect(w){return void 0===w.getPipelineContext?w.effect:w}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=w.createDrawContext(),p&&(this.materialContext=w.createMaterialContext())}setEffect(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var r;(this.effect=w,void 0!==p&&(this.defines=p),e)&&(null===(r=this.drawContext)||void 0===r||r.reset())}dispose(){var w;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const w=this.effect;p?w.dispose():r.c.SetImmediate((()=>{w.getEngine().onEndFrameObservable.addOnce((()=>{w.dispose()}))})),this.effect=null}null===(w=this.drawContext)||void 0===w||w.dispose()}}},11151:(w,p,e)=>{e.d(p,{d:()=>k,h:()=>J,l:()=>j,m:()=>X});var r=e(11075),I=e(11157),d=e(11146),f=e(11081),q=e(11118),E=e(11120);function j(w,p){return(0,I.w)(p).cachedPipelines[w]}function X(w){const p=w._name,e=w.context;if(p&&e){const w=(0,I.w)(e),r=w.cachedPipelines[p];null===r||void 0===r||r.dispose(),delete w.cachedPipelines[p]}}function k(w,p,e,I,d,f,E){let j,X;const k=(0,r.i)()?null===f||void 0===f?void 0:f.getHostDocument():null;j="string"===typeof p?p:p.vertexSource?"source:"+p.vertexSource:p.vertexElement?(null===k||void 0===k?void 0:k.getElementById(p.vertexElement))||p.vertexElement:p.vertex||p,X="string"===typeof p?p:p.fragmentSource?"source:"+p.fragmentSource:p.fragmentElement?(null===k||void 0===k?void 0:k.getElementById(p.fragmentElement))||p.fragmentElement:p.fragment||p;const J=[void 0,void 0],K=()=>{if(J[0]&&J[1]){w.isFragment=!0;const[r,j]=J;(0,q.i)(j,w,((f,j)=>{E&&(E._fragmentSourceCodeBeforeMigration=j),e&&(f=e("fragment",f));const X=(0,q.c)(r,f,w);w=null;const k=function(w,p,e,r){if(e){return{vertexSourceCode:(1===r?"//":"")+"#define SHADER_NAME vertex:"+(e.vertexElement||e.vertex||e.spectorName||e)+"\n"+w,fragmentSourceCode:(1===r?"//":"")+"#define SHADER_NAME fragment:"+(e.fragmentElement||e.fragment||e.spectorName||e)+"\n"+p}}return{vertexSourceCode:w,fragmentSourceCode:p}}(X.vertexCode,X.fragmentCode,p,d);null===I||void 0===I||I(k.vertexSourceCode,k.fragmentSourceCode)}),f)}};m(j,"Vertex","",(p=>{(0,q.d)(w),(0,q.i)(p,w,((w,r)=>{E&&(E._rawVertexSourceCode=p,E._vertexSourceCodeBeforeMigration=r),e&&(w=e("vertex",w)),J[0]=w,K()}),f)}),d),m(X,"Fragment","Pixel",(w=>{E&&(E._rawFragmentSourceCode=w),J[1]=w,K()}),d)}function m(w,p,e,I,f,q){if("undefined"!==typeof HTMLElement&&w instanceof HTMLElement){return void I((0,r.c)(w))}if("source:"===w.substring(0,7))return void I(w.substring(7));if("base64:"===w.substring(0,7)){return void I(window.atob(w.substring(7)))}const j=d.e.GetShadersStore(f);if(j[w+p+"Shader"])return void I(j[w+p+"Shader"]);if(e&&j[w+e+"Shader"])return void I(j[w+e+"Shader"]);let X;if(X="."===w[0]||"/"===w[0]||w.indexOf("http")>-1?w:d.e.GetShadersRepository(f)+w,!(q=q||E.n))throw new Error("loadFileInjection is not defined");q(X+"."+p.toLowerCase()+".fx",I)}const J=(w,p,e,r)=>{try{const d=w.context?(0,I.w)(w.context):null;d&&(d.disableParallelShaderCompile=w.disableParallelCompilation);const f=w.existingPipelineContext||p(w.shaderProcessingContext);return f._name=w.name,w.name&&d&&(d.cachedPipelines[w.name]=f),e(f,w.vertex,w.fragment,!!w.createAsRaw,"","",w.rebuildRebind,w.defines,w.transformFeedbackVaryings,"",(()=>{r(f,(()=>{var p;null===(p=w.onRenderingStateCompiled)||void 0===p||p.call(w,f)}))})),f}catch(d){throw f.c.Error("Error compiling effect"),d}}},11139:(w,p,e)=>{e.d(p,{e:()=>E});var r=e(11056),I=e(11081),d=e(11146),f=e(11151),q=e(11127);class E{static get ShadersRepository(){return d.e.ShadersRepository}static set ShadersRepository(w){d.e.ShadersRepository=w}get K(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new r.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,m=arguments.length>9?arguments[9]:void 0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,y=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new r.d,this.onErrorObservable=new r.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=w,this._key=J;const c=this._key.replace(/\r/g,"").replace(/\n/g,"|");let s;if(p.attributes){const w=p;if(this._engine=e,this._attributesNames=w.attributes,this._uniformsNames=w.uniformsNames.concat(w.samplers),this._samplerList=w.samplers.slice(),this.defines=w.defines,this.onError=w.onError,this.onCompiled=w.onCompiled,this._fallbacks=w.fallbacks,this._indexParameters=w.indexParameters,this._transformFeedbackVaryings=w.transformFeedbackVaryings||null,this._multiTarget=!!w.multiTarget,this._shaderLanguage=w.shaderLanguage??0,this._disableParallelShaderCompilation=!!w.disableParallelShaderCompilation,w.uniformBuffersNames){this._uniformBuffersNamesList=w.uniformBuffersNames.slice();for(let p=0;p<w.uniformBuffersNames.length;p++)this._uniformBuffersNames[w.uniformBuffersNames[p]]=p}this._processFinalCode=w.processFinalCode??null,this._processCodeAfterIncludes=w.processCodeAfterIncludes??void 0,y=w.extraInitializationsAsync,s=w.existingPipelineContext}else this._engine=d,this.defines=null==q?"":q,this._uniformsNames=e.concat(I),this._samplerList=I?I.slice():[],this._attributesNames=p,this._uniformBuffersNamesList=[],this._shaderLanguage=K,this.onError=k,this.onCompiled=X,this._indexParameters=m,this._fallbacks=j;"WEBGL2"===this._engine.shaderPlatformName&&(s=(0,f.l)(c,this._engine._gl)??s),this._attributeLocationByName={},this.uniqueId=E._UniqueIdSeed++,s?(this._pipelineContext=s,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,y),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.K||this.dispose(!0)}))}async _processShaderCodeAsync(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;r&&await r(),this._processingContext=e||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const I={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:w??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:d.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:d.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,f.d)(I,this.name,this._processFinalCode,((w,e)=>{this._vertexSourceCode=w,this._fragmentSourceCode=e,this._prepareEffect(p)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.K||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(w){return this._attributes[w]}getAttributeLocationByName(w){return this._attributeLocationByName[w]}getAttributesCount(){return this._attributes.length}getUniformIndex(w){return this._uniformsNames.indexOf(w)}getUniform(w){return this._uniforms[w]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((w=>{this.executeWhenCompiled(w)}))}executeWhenCompiled(w){this.isReady()?w(this):(this.onCompileObservable.add((p=>{w(p)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(w){(0,q.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(p=>{this._processCompilationErrors(p,w)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var w;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(w=this._pipelineContext)||void 0===w?void 0:w._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var w;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(w=this._pipelineContext)||void 0===w?void 0:w._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(w,p,e,r){this._isReady=!1,this._vertexSourceCodeOverride=w,this._fragmentSourceCodeOverride=p,this.onError=(w,p)=>{r&&r(p)},this.onCompiled=()=>{var w,p;const r=this.getEngine().scenes;if(r)for(let e=0;e<r.length;e++)r[e].markAllMaterialsAsDirty(127);null===(w=(p=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===w||w.call(p,e)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(w){if(this._pipelineContext=w,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let p=0;p<this._attributesNames.length;p++){const w=this._attributesNames[p];this._attributeLocationByName[w]=this._attributes[p]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),E.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this._pipelineContext;this._isReady=!1;try{const e=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),r=e?null:this.defines,I=e?this._vertexSourceCodeOverride:this._vertexSourceCode,d=e?this._fragmentSourceCodeOverride:this._fragmentSourceCode,q=this._engine;this._pipelineContext=(0,f.h)({existingPipelineContext:w?p:null,vertex:I,fragment:d,context:"WEBGL2"===q.shaderPlatformName||"WEBGL1"===q.shaderPlatformName?q._gl:void 0,rebuildRebind:(w,p,e,r)=>this._rebuildProgram(w,p,e,r),defines:r,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:e,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:e=>{p&&!w&&this._engine._deletePipelineContext(p),e&&this._onRenderingStateCompiled(e)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(p)}catch(e){this._processCompilationErrors(e,p)}}_getShaderCodeAndErrorLine(w,p,e){const r=e?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let I=null;if(p&&w){const d=p.match(r);if(d&&2===d.length){const p=parseInt(d[1]),r=w.split("\n",-1);r.length>=p&&(I=`Offending line [${p}] in ${e?"fragment":"vertex"} code: ${r[p-1]}`)}}return[w,I]}_processCompilationErrors(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=w.message;const e=this._attributesNames,r=this._fallbacks;if(I.c.Error("Unable to compile effect:"),I.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),I.c.Error(`Attributes: ${e.join(" ")}`),I.c.Error("Defines:\n"+this.defines),E.LogShaderCodeOnCompilationError){var d,f;let w=null,p=null,e=null;var q;if(null!==(d=this._pipelineContext)&&void 0!==d&&d._getVertexShaderCode()&&([e,w]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),e&&(I.c.Error("Vertex code:"),I.c.Error(e))),null!==(f=this._pipelineContext)&&void 0!==f&&f._getFragmentShaderCode())[e,p]=this._getShaderCodeAndErrorLine(null===(q=this._pipelineContext)||void 0===q?void 0:q._getFragmentShaderCode(),this._compilationError,!0),e&&(I.c.Error("Fragment code:"),I.c.Error(e));w&&I.c.Error(w),p&&I.c.Error(p)}I.c.Error("Error: "+this._compilationError);const j=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};p&&(this._pipelineContext=p,this._isReady=!0,j()),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,I.c.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,j(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,p||j())}get isSupported(){return""===this._compilationError}_bindTexture(w,p){this._engine._bindTexture(this._samplers[w],p,w)}setTexture(w,p){this._engine.setTexture(this._samplers[w],this._uniforms[w],p,w)}setTextureArray(w,p){const e=w+"Ex";if(-1===this._samplerList.indexOf(e+"0")){const r=this._samplerList.indexOf(w);for(let w=1;w<p.length;w++){const p=e+(w-1).toString();this._samplerList.splice(r+w,0,p)}let I=0;for(const w of this._samplerList)this._samplers[w]=I,I+=1}this._engine.setTextureArray(this._samplers[w],this._uniforms[w],p,w)}bindUniformBuffer(w,p){const e=this._uniformBuffersNames[p];void 0===e||E._BaseCache[e]===w&&this._engine._features.useUBOBindingCache||(E._BaseCache[e]=w,this._engine.bindUniformBufferBase(w,e,p))}bindUniformBlock(w,p){this._engine.bindUniformBlock(this._pipelineContext,w,p)}setInt(w,p){return this._pipelineContext.setInt(w,p),this}setInt2(w,p,e){return this._pipelineContext.setInt2(w,p,e),this}setInt3(w,p,e,r){return this._pipelineContext.setInt3(w,p,e,r),this}setInt4(w,p,e,r,I){return this._pipelineContext.setInt4(w,p,e,r,I),this}setIntArray(w,p){return this._pipelineContext.setIntArray(w,p),this}setIntArray2(w,p){return this._pipelineContext.setIntArray2(w,p),this}setIntArray3(w,p){return this._pipelineContext.setIntArray3(w,p),this}setIntArray4(w,p){return this._pipelineContext.setIntArray4(w,p),this}setUInt(w,p){return this._pipelineContext.setUInt(w,p),this}setUInt2(w,p,e){return this._pipelineContext.setUInt2(w,p,e),this}setUInt3(w,p,e,r){return this._pipelineContext.setUInt3(w,p,e,r),this}setUInt4(w,p,e,r,I){return this._pipelineContext.setUInt4(w,p,e,r,I),this}setUIntArray(w,p){return this._pipelineContext.setUIntArray(w,p),this}setUIntArray2(w,p){return this._pipelineContext.setUIntArray2(w,p),this}setUIntArray3(w,p){return this._pipelineContext.setUIntArray3(w,p),this}setUIntArray4(w,p){return this._pipelineContext.setUIntArray4(w,p),this}setFloatArray(w,p){return this._pipelineContext.setArray(w,p),this}setFloatArray2(w,p){return this._pipelineContext.setArray2(w,p),this}setFloatArray3(w,p){return this._pipelineContext.setArray3(w,p),this}setFloatArray4(w,p){return this._pipelineContext.setArray4(w,p),this}setArray(w,p){return this._pipelineContext.setArray(w,p),this}setArray2(w,p){return this._pipelineContext.setArray2(w,p),this}setArray3(w,p){return this._pipelineContext.setArray3(w,p),this}setArray4(w,p){return this._pipelineContext.setArray4(w,p),this}setMatrices(w,p){return this._pipelineContext.setMatrices(w,p),this}setMatrix(w,p){return this._pipelineContext.setMatrix(w,p),this}setMatrix3x3(w,p){return this._pipelineContext.setMatrix3x3(w,p),this}setMatrix2x2(w,p){return this._pipelineContext.setMatrix2x2(w,p),this}setFloat(w,p){return this._pipelineContext.setFloat(w,p),this}setBool(w,p){return this._pipelineContext.setInt(w,p?1:0),this}setVector2(w,p){return this._pipelineContext.setVector2(w,p),this}setFloat2(w,p,e){return this._pipelineContext.setFloat2(w,p,e),this}setVector3(w,p){return this._pipelineContext.setVector3(w,p),this}setFloat3(w,p,e,r){return this._pipelineContext.setFloat3(w,p,e,r),this}setVector4(w,p){return this._pipelineContext.setVector4(w,p),this}setQuaternion(w,p){return this._pipelineContext.setQuaternion(w,p),this}setFloat4(w,p,e,r,I){return this._pipelineContext.setFloat4(w,p,e,r,I),this}setColor3(w,p){return this._pipelineContext.setColor3(w,p),this}setColor4(w,p,e){return this._pipelineContext.setColor4(w,p,e),this}setDirectColor4(w,p){return this._pipelineContext.setDirectColor4(w,p),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(E.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,f.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;p&&(d.e.GetShadersStore(r)[`${w}PixelShader`]=p),e&&(d.e.GetShadersStore(r)[`${w}VertexShader`]=e)}static ResetCache(){E._BaseCache={}}}E.LogShaderCodeOnCompilationError=!0,E.PersistentMode=!1,E.AutomaticallyClearCodeCache=!1,E._UniqueIdSeed=0,E._BaseCache={},E.ShadersStore=d.e.ShadersStore,E.IncludesShadersStore=d.e.IncludesShadersStore},11692:(w,p,e)=>{e.d(p,{c:()=>r});class r{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(w,p){this._defines[w]||(w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w),this._defines[w]=new Array),this._defines[w].push(p)}addCPUSkinningFallback(w,p){this._mesh=p,w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(w,p){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,w=w.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),p._bonesComputationForcedToCPU=!0;const e=this._mesh.iw();for(let w=0;w<e.meshes.length;w++){const r=e.meshes[w];if(r.material){if(r.computeBonesUsingShaders&&0!==r.numBoneInfluencers)if(r.material.getEffect()===p)r.computeBonesUsingShaders=!1;else if(r.oe)for(const w of r.oe){if(w.effect===p){r.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&r.computeBonesUsingShaders&&r.numBoneInfluencers>0&&(r.computeBonesUsingShaders=!1)}}else{const p=this._defines[this._currentRank];if(p)for(let e=0;e<p.length;e++)w=w.replace("#define "+p[e],"");this._currentRank++}return w}}},11537:(w,p,e)=>{e.d(p,{e:()=>j,g:()=>X});var r=e(11232),I=e(11378),d=e(11056),f=e(11139),q=e(11286);e(11540);const E={nw:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class j{constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;this._fullscreenViewport=new I.d(0,0,1,1);const e=p.nw??E.nw,d=p.indices??E.indices;this.wE=w,this._vertexBuffers={[r.e.PositionKind]:new r.e(w,e,r.e.PositionKind,!1,!1,2)},this._indexBuffer=w.createIndexBuffer(d),this._indexBufferLength=d.length,this._onContextRestoredObserver=w.onContextRestoredObservable.add((()=>{this._indexBuffer=w.createIndexBuffer(d);for(const w in this._vertexBuffers){this._vertexBuffers[w]._rebuild()}}))}setViewport(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.wE.setViewport(w)}bindBuffers(w){this.wE.bindBuffers(this._vertexBuffers,this._indexBuffer,w)}applyEffectWrapper(w){this.wE.setState(!0),this.wE.depthCullingState.depthTest=!1,this.wE.stencilState.stencilTest=!1,this.wE.enableEffect(w.drawWrapper),this.bindBuffers(w.effect),w.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.wE.depthCullingState.depthTest,this._savedStateStencilTest=this.wE.stencilState.stencilTest}restoreStates(){this.wE.depthCullingState.depthTest=this._savedStateDepthTest,this.wE.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.wE.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(w){return void 0!==w.renderTarget}render(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!w.effect.isReady())return;this.saveStates(),this.setViewport();const e=null===p?null:this._isRenderTargetTexture(p)?p.renderTarget:p;e&&this.wE.bindFramebuffer(e),this.applyEffectWrapper(w),this.draw(),e&&this.wE.unBindFramebuffer(e),this.restoreStates()}dispose(){const w=this._vertexBuffers[r.e.PositionKind];w&&(w.dispose(),delete this._vertexBuffers[r.e.PositionKind]),this._indexBuffer&&this.wE._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.wE.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class X{static RegisterShaderCodeProcessing(w,p){p?X._CustomShaderCodeProcessing[w??""]=p:delete X._CustomShaderCodeProcessing[w??""]}static _GetShaderCodeProcessing(w){return X._CustomShaderCodeProcessing[w]??X._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(w){this.options.name=w}isReady(){var w;return(null===(w=this._drawWrapper.effect)||void 0===w?void 0:w.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(w){this._drawWrapper.effect=w}constructor(w){this.alphaMode=0,this.onEffectCreatedObservable=new d.d(void 0,!0),this.onApplyObservable=new d.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...w,name:w.name||"effectWrapper",wE:w.wE,uniforms:w.uniforms||w.uniformNames||[],uniformNames:void 0,samplers:w.samplers||w.samplerNames||[],samplerNames:void 0,attributeNames:w.attributeNames||["position"],uniformBuffers:w.uniformBuffers||[],defines:w.defines||"",useShaderStore:w.useShaderStore||!1,vertexUrl:w.vertexUrl||w.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:w.fragmentShader||"pass",indexParameters:w.indexParameters,blockCompilation:w.blockCompilation||!1,shaderLanguage:w.shaderLanguage||0,onCompiled:w.onCompiled||void 0,extraInitializations:w.extraInitializations||void 0,extraInitializationsAsync:w.extraInitializationsAsync||void 0,useAsPostProcess:w.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),w.vertexUrl||w.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.wE.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new q.b(this.options.wE),this._webGPUReady=1===this.options.shaderLanguage;const p=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,p,this.options.extraInitializations)}_gatherImports(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(w&&this._webGPUReady?p.push(Promise.all([e.e(42).then(e.bind(e,13719))])):p.push(Promise.all([Promise.resolve().then(e.bind(e,11540))])))}_postConstructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,r&&this._importPromises.push(...r);const I=this.options.wE.isWebGPU&&!X.ForceGLSL;this._gatherImports(I,this._importPromises),void 0!==e&&e(I,this._importPromises),I&&this._webGPUReady&&(this.options.shaderLanguage=1),w||this.updateEffect(p)}updateEffect(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0;const j=X._GetShaderCodeProcessing(this.name);if(null!==j&&void 0!==j&&j.defineCustomBindings){var k,m;const r=(null===(k=p)||void 0===k?void 0:k.slice())??[];r.push(...this.options.uniforms);const I=(null===(m=e)||void 0===m?void 0:m.slice())??[];I.push(...this.options.samplers),w=j.defineCustomBindings(this.name,w,r,I),p=r,e=I}this.options.defines=w||"";const J=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let K;K=this.options.extraInitializationsAsync?async()=>{null===J||void 0===J||J(),await this.options.extraInitializationsAsync()}:J,this.options.useShaderStore?this._drawWrapper.effect=this.options.wE.createEffect({vertex:q??this._shaderPath.vertex,fragment:E??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:p||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:e||this.options.samplers,defines:null!==w?w:"",fallbacks:null,onCompiled:I??this.options.onCompiled,onError:d??null,indexParameters:r||this.options.indexParameters,processCodeAfterIncludes:null!==j&&void 0!==j&&j.processCodeAfterIncludes?(w,p)=>j.processCodeAfterIncludes(this.name,w,p):null,processFinalCode:null!==j&&void 0!==j&&j.processFinalCode?(w,p)=>j.processFinalCode(this.name,w,p):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:K},this.options.wE):this._drawWrapper.effect=new f.e(this._shaderPath,this.options.attributeNames,p||this.options.uniforms,e||this.options.samplerNames,this.options.wE,w,void 0,I||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,K),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var w,p;let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!e&&(this.options.wE.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(w=X._GetShaderCodeProcessing(this.name))||void 0===w||null===(p=w.bindCustomBindings)||void 0===p||p.call(w,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}X.ForceGLSL=!1,X._CustomShaderCodeProcessing={}},11603:(w,p,e)=>{e.d(p,{d:()=>d,f:()=>I});var r=e(11599);function I(w,p){p.EXPOSURE&&w.push("exposureLinear"),p.CONTRAST&&w.push("contrast"),p.COLORGRADING&&w.push("colorTransformSettings"),(p.VIGNETTE||p.DITHER)&&w.push("vInverseScreenSize"),p.VIGNETTE&&(w.push("vignetteSettings1"),w.push("vignetteSettings2")),p.COLORCURVES&&(0,r.b)(w),p.DITHER&&w.push("ditherIntensity")}function d(w,p){p.COLORGRADING&&w.push("txColorTransform")}},11593:(w,p,e)=>{e.d(p,{e:()=>J});var r=e(11207),I=e(11213),d=e(11056),f=e(11308),q=e(11301),E=e(11599);class j{constructor(){this._dirty=!0,this._tempColor=new f.e(0,0,0,0),this._globalCurve=new f.e(0,0,0,0),this._highlightsCurve=new f.e(0,0,0,0),this._midtonesCurve=new f.e(0,0,0,0),this._shadowsCurve=new f.e(0,0,0,0),this._positiveCurve=new f.e(0,0,0,0),this._negativeCurve=new f.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(w){this._globalHue=w,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(w){this._globalDensity=w,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(w){this._globalSaturation=w,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(w){this._globalExposure=w,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(w){this._highlightsHue=w,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(w){this._highlightsDensity=w,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(w){this._highlightsSaturation=w,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(w){this._highlightsExposure=w,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(w){this._midtonesHue=w,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(w){this._midtonesDensity=w,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(w){this._midtonesSaturation=w,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(w){this._midtonesExposure=w,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(w){this._shadowsHue=w,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(w){this._shadowsDensity=w,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(w){this._shadowsSaturation=w,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(w){this._shadowsExposure=w,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";w._dirty&&(w._dirty=!1,w._getColorGradingDataToRef(w._globalHue,w._globalDensity,w._globalSaturation,w._globalExposure,w._globalCurve),w._getColorGradingDataToRef(w._highlightsHue,w._highlightsDensity,w._highlightsSaturation,w._highlightsExposure,w._tempColor),w._tempColor.multiplyToRef(w._globalCurve,w._highlightsCurve),w._getColorGradingDataToRef(w._midtonesHue,w._midtonesDensity,w._midtonesSaturation,w._midtonesExposure,w._tempColor),w._tempColor.multiplyToRef(w._globalCurve,w._midtonesCurve),w._getColorGradingDataToRef(w._shadowsHue,w._shadowsDensity,w._shadowsSaturation,w._shadowsExposure,w._tempColor),w._tempColor.multiplyToRef(w._globalCurve,w._shadowsCurve),w._highlightsCurve.subtractToRef(w._midtonesCurve,w._positiveCurve),w._midtonesCurve.subtractToRef(w._shadowsCurve,w._negativeCurve)),p&&(p.setFloat4(e,w._positiveCurve.r,w._positiveCurve.g,w._positiveCurve.b,w._positiveCurve.a),p.setFloat4(r,w._midtonesCurve.r,w._midtonesCurve.g,w._midtonesCurve.b,w._midtonesCurve.a),p.setFloat4(I,w._negativeCurve.r,w._negativeCurve.g,w._negativeCurve.b,w._negativeCurve.a))}_getColorGradingDataToRef(w,p,e,r,I){null!=w&&(w=j._Clamp(w,0,360),p=j._Clamp(p,-100,100),e=j._Clamp(e,-100,100),r=j._Clamp(r,-100,100),p=j._ApplyColorGradingSliderNonlinear(p),p*=.5,r=j._ApplyColorGradingSliderNonlinear(r),p<0&&(p*=-1,w=(w+180)%360),j._FromHSBToRef(w,p,50+.25*r,I),I.scaleToRef(2,I),I.a=1+.01*e)}static _ApplyColorGradingSliderNonlinear(w){w/=100;let p=Math.abs(w);return p=Math.pow(p,2),w<0&&(p*=-1),p*=100,p}static _FromHSBToRef(w,p,e,r){let I=j._Clamp(w,0,360);const d=j._Clamp(p/100,0,1),f=j._Clamp(e/100,0,1);if(0===d)r.r=f,r.g=f,r.b=f;else{I/=60;const w=Math.floor(I),p=I-w,e=f*(1-d),q=f*(1-d*p),E=f*(1-d*(1-p));switch(w){case 0:r.r=f,r.g=E,r.b=e;break;case 1:r.r=q,r.g=f,r.b=e;break;case 2:r.r=e,r.g=f,r.b=E;break;case 3:r.r=e,r.g=q,r.b=f;break;case 4:r.r=E,r.g=e,r.b=f;break;default:r.r=f,r.g=e,r.b=q}}r.a=1}static _Clamp(w,p,e){return Math.min(Math.max(w,p),e)}clone(){return q.e.Clone((()=>new j),this)}serialize(){return q.e.Serialize(this)}static Parse(w){return q.e.Parse((()=>new j),w,null,null)}}j.PrepareUniforms=E.b,(0,r.c)([(0,I.J)()],j.prototype,"_globalHue",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_globalDensity",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_globalSaturation",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_globalExposure",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_highlightsHue",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_highlightsDensity",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_highlightsSaturation",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_highlightsExposure",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_midtonesHue",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_midtonesDensity",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_midtonesSaturation",void 0),(0,r.c)([(0,I.J)()],j.prototype,"_midtonesExposure",void 0),q.e._ColorCurvesParser=j.Parse;var X=e(11194),k=e(11603),m=e(11038);class J{constructor(){this.colorCurves=new j,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=J.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new f.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=J.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new d.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(w){this._colorCurvesEnabled!==w&&(this._colorCurvesEnabled=w,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(w){this._colorGradingTexture!==w&&(this._colorGradingTexture=w,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(w){this._colorGradingEnabled!==w&&(this._colorGradingEnabled=w,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(w){this._colorGradingWithGreenDepth!==w&&(this._colorGradingWithGreenDepth=w,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(w){this._colorGradingBGR!==w&&(this._colorGradingBGR=w,this._updateParameters())}get exposure(){return this._exposure}set exposure(w){this._exposure!==w&&(this._exposure=w,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(w){this._toneMappingEnabled!==w&&(this._toneMappingEnabled=w,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(w){this._toneMappingType!==w&&(this._toneMappingType=w,this._updateParameters())}get contrast(){return this._contrast}set contrast(w){this._contrast!==w&&(this._contrast=w,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(w){this.vignetteCenterY=w}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(w){this.vignetteCenterX=w}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(w){this._vignetteBlendMode!==w&&(this._vignetteBlendMode=w,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(w){this._vignetteEnabled!==w&&(this._vignetteEnabled=w,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(w){this._ditheringEnabled!==w&&(this._ditheringEnabled=w,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(w){this._ditheringIntensity!==w&&(this._ditheringIntensity=w,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(w){this._skipFinalColorClamp!==w&&(this._skipFinalColorClamp=w,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(w){this._applyByPostProcess!==w&&(this._applyByPostProcess=w,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(w){this._isEnabled!==w&&(this._isEnabled=w,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(w){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return w.VIGNETTE=!1,w.TONEMAPPING=0,w.CONTRAST=!1,w.EXPOSURE=!1,w.COLORCURVES=!1,w.COLORGRADING=!1,w.COLORGRADING3D=!1,w.DITHER=!1,w.IMAGEPROCESSING=!1,w.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(w.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(w.VIGNETTE=this.vignetteEnabled,w.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===J._VIGNETTEMODE_MULTIPLY,w.VIGNETTEBLENDMODEOPAQUE=!w.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case J.TONEMAPPING_KHR_PBR_NEUTRAL:w.TONEMAPPING=3;break;case J.TONEMAPPING_ACES:w.TONEMAPPING=2;break;default:w.TONEMAPPING=1}else w.TONEMAPPING=0;w.CONTRAST=1!==this.contrast,w.EXPOSURE=1!==this.exposure,w.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,w.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,w.COLORGRADING?w.COLORGRADING3D=this.colorGradingTexture.is3D:w.COLORGRADING3D=!1,w.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,w.SAMPLER3DBGRMAP=this.colorGradingBGR,w.DITHER=this._ditheringEnabled,w.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,w.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,w.IMAGEPROCESSING=w.VIGNETTE||!!w.TONEMAPPING||w.CONTRAST||w.EXPOSURE||w.COLORCURVES||w.COLORGRADING||w.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(w,p){if(this._colorCurvesEnabled&&this.colorCurves&&j.Bind(this.colorCurves,w),this._vignetteEnabled||this._ditheringEnabled){const e=1/(this.outputTextureWidth||w.getEngine().getRenderWidth()),r=1/(this.outputTextureHeight||w.getEngine().getRenderHeight());if(w.setFloat2("vInverseScreenSize",e,r),this._ditheringEnabled&&w.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const I=null!=p?p:r/e;let d=Math.tan(.5*this.vignetteCameraFov),f=d*I;const q=Math.sqrt(f*d);f=(0,X.l)(f,q,this.vignetteStretch),d=(0,X.l)(d,q,this.vignetteStretch),w.setFloat4("vignetteSettings1",f,d,-f*this.vignetteCenterX,-d*this.vignetteCenterY);const E=-2*this.vignetteWeight;w.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,E)}}if(w.setFloat("exposureLinear",this.exposure),w.setFloat("contrast",this.contrast),this.colorGradingTexture){w.setTexture("txColorTransform",this.colorGradingTexture);const p=this.colorGradingTexture.getSize().height;w.setFloat4("colorTransformSettings",(p-1)/p,.5/p,p,this.colorGradingTexture.level)}}clone(){return q.e.Clone((()=>new J),this)}serialize(){return q.e.Serialize(this)}static Parse(w){const p=q.e.Parse((()=>new J),w,null,null);return void 0!==w.vignetteCentreX&&(p.vignetteCenterX=w.vignetteCentreX),void 0!==w.vignetteCentreY&&(p.vignetteCenterY=w.vignetteCentreY),p}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}J.TONEMAPPING_STANDARD=0,J.TONEMAPPING_ACES=1,J.TONEMAPPING_KHR_PBR_NEUTRAL=2,J.PrepareUniforms=k.f,J.PrepareSamplers=k.d,J._VIGNETTEMODE_MULTIPLY=0,J._VIGNETTEMODE_OPAQUE=1,(0,r.c)([(0,I.i)()],J.prototype,"colorCurves",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_colorCurvesEnabled",void 0),(0,r.c)([(0,I.C)("colorGradingTexture")],J.prototype,"_colorGradingTexture",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_colorGradingEnabled",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_colorGradingWithGreenDepth",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_colorGradingBGR",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_exposure",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_toneMappingEnabled",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_toneMappingType",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_contrast",void 0),(0,r.c)([(0,I.J)()],J.prototype,"vignetteStretch",void 0),(0,r.c)([(0,I.J)()],J.prototype,"vignetteCenterX",void 0),(0,r.c)([(0,I.J)()],J.prototype,"vignetteCenterY",void 0),(0,r.c)([(0,I.J)()],J.prototype,"vignetteWeight",void 0),(0,r.c)([(0,I.k)()],J.prototype,"vignetteColor",void 0),(0,r.c)([(0,I.J)()],J.prototype,"vignetteCameraFov",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_vignetteBlendMode",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_vignetteEnabled",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_ditheringEnabled",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_ditheringIntensity",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_skipFinalColorClamp",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_applyByPostProcess",void 0),(0,r.c)([(0,I.J)()],J.prototype,"_isEnabled",void 0),(0,r.c)([(0,I.J)()],J.prototype,"outputTextureWidth",void 0),(0,r.c)([(0,I.J)()],J.prototype,"outputTextureHeight",void 0),q.e._ImageProcessingConfigurationParser=J.Parse,(0,m.d)("BABYLON.ImageProcessingConfiguration",J)},11698:(w,p,e)=>{e.d(p,{b:()=>k});var r=e(11207),I=e(11203),d=e(11213),f=e(11674),q=e(11648),E=e(11657),j=e(11310);class X extends q.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class k extends E.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(w,"DetailMap",140,new X,p),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=I.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=w._dirtyCallbacks[1]}isReadyForSubMesh(w,p,e){return!this._isEnabled||!(w._areTexturesDirty&&p.texturesEnabled&&e.getCaps().standardDerivatives&&this._texture&&f.d.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(w,p){if(this._isEnabled){w.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const e=p.getEngine();w._areTexturesDirty&&(e.getCaps().standardDerivatives&&this._texture&&f.d.DetailTextureEnabled&&this._isEnabled?((0,j.N)(this._texture,w,"DETAIL"),w.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):w.DETAIL=!1)}else w.DETAIL=!1}bindForSubMesh(w,p){if(!this._isEnabled)return;const e=this._material.isFrozen;w.useUbo&&e&&w.isSync||this._texture&&f.d.DetailTextureEnabled&&(w.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,j.r)(this._texture,w,"detail")),p.texturesEnabled&&this._texture&&f.d.DetailTextureEnabled&&w.setTexture("detailSampler",this._texture)}hasTexture(w){return this._texture===w}getActiveTextures(w){this._texture&&w.push(this._texture)}getAnimatables(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture)}dispose(w){var p;w&&(null===(p=this._texture)||void 0===p||p.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(w){w.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,r.c)([(0,d.C)("detailTexture"),(0,d.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"texture",void 0),(0,r.c)([(0,d.J)()],k.prototype,"diffuseBlendLevel",void 0),(0,r.c)([(0,d.J)()],k.prototype,"roughnessBlendLevel",void 0),(0,r.c)([(0,d.J)()],k.prototype,"bumpLevel",void 0),(0,r.c)([(0,d.J)(),(0,d.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"normalBlendMethod",void 0),(0,r.c)([(0,d.J)(),(0,d.e)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isEnabled",void 0)},11203:(w,p,e)=>{e.d(p,{b:()=>c});var r=e(11207),I=e(11213),d=e(11071),f=e(11056),q=e(11051),E=e(11227),j=e(11288),X=e(11081),k=e(11292),m=e(11286),J=e(11301);class K{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(w){this._func=w}get funcRef(){return this._funcRef}set funcRef(w){this._funcRef=w}get funcMask(){return this._funcMask}set funcMask(w){this._funcMask=w}get opStencilFail(){return this._opStencilFail}set opStencilFail(w){this._opStencilFail=w}get opDepthFail(){return this._opDepthFail}set opDepthFail(w){this._opDepthFail=w}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(w){this._opStencilDepthPass=w}get mask(){return this._mask}set mask(w){this._mask=w}get enabled(){return this._enabled}set enabled(w){this._enabled=w}getClassName(){return"MaterialStencilState"}copyTo(w){J.e.Clone((()=>w),this)}serialize(){return J.e.Serialize(this)}parse(w,p,e){J.e.Parse((()=>this),w,p,e)}}(0,r.c)([(0,I.J)()],K.prototype,"func",null),(0,r.c)([(0,I.J)()],K.prototype,"funcRef",null),(0,r.c)([(0,I.J)()],K.prototype,"funcMask",null),(0,r.c)([(0,I.J)()],K.prototype,"opStencilFail",null),(0,r.c)([(0,I.J)()],K.prototype,"opDepthFail",null),(0,r.c)([(0,I.J)()],K.prototype,"opStencilDepthPass",null),(0,r.c)([(0,I.J)()],K.prototype,"mask",null),(0,r.c)([(0,I.J)()],K.prototype,"enabled",null);var y=e(11310);class c{get _supportGlowLayer(){return!1}set _glowModeEnabled(w){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(w){if(this._alpha===w)return;const p=this._alpha;this._alpha=w,1!==p&&1!==w||this.kX(c.MiscDirtyFlag+c.PrePassDirtyFlag)}get alpha(){return this._alpha}set ce(w){this._backFaceCulling!==w&&(this._backFaceCulling=w,this.kX(c.TextureDirtyFlag))}get ce(){return this._backFaceCulling}set cullBackFaces(w){this._cullBackFaces!==w&&(this._cullBackFaces=w,this.kX(c.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(w){this._blockDirtyMechanism!==w&&(this._blockDirtyMechanism=w,w||this.km())}atomicMaterialsUpdate(w){this.blockDirtyMechanism=!0;try{w(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(w){this._onDisposeObserver&&this.ue.remove(this._onDisposeObserver),this._onDisposeObserver=this.ue.add(w)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new f.d),this._onBindObservable}set onBind(w){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(w)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new f.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new f.d),this._onEffectCreatedObservable}set alphaMode(w){this._alphaMode!==w&&(this._alphaMode=w,this.kX(c.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(w){this._needDepthPrePass!==w&&(this._needDepthPrePass=w,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(w){this._fogEnabled!==w&&(this._fogEnabled=w,this.kX(c.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case c.WireFrameFillMode:case c.LineListDrawMode:case c.LineLoopDrawMode:case c.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(w){this.fillMode=w?c.WireFrameFillMode:c.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case c.PointFillMode:case c.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(w){this.fillMode=w?c.PointFillMode:c.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(w){this._fillMode!==w&&(this._fillMode=w,this.kX(c.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(w){const p=this.iw().getEngine().getCaps().fragmentDepthSupported;w&&!p&&X.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=w&&p,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(w){this._drawWrapper=w}constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.ue=new f.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new K,this._useUBO=!1,this._fillMode=c.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=w;const I=p||q.d.LastCreatedScene;I&&(this._scene=I,this._dirtyCallbacks={},this._forceGLSL=r,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=w||d.g.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new m.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new j.d(this._scene.getEngine(),void 0,void 0,w),this._useUBO=this.iw().getEngine().supportsUniformBuffers,this._createUniformBuffer(),e||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),c.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var w;const p=this.iw().getEngine();null===(w=this._uniformBuffer)||void 0===w||w.dispose(),p.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new j.d(p,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new j.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(w){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.km(),this.checkReadyOnlyOnce=!0}unfreeze(){this.km(),this.checkReadyOnlyOnce=!1}isReady(w,p){return!0}isReadyForSubMesh(w,p,e){const r=p.materialDefines;return!!r&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}iw(){return this._scene}_getEffectiveOrientation(w){return null!==this.sideOrientation?this.sideOrientation:w.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(w){this._transparencyMode!==w&&(this._transparencyMode=w,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===c.MATERIAL_ALPHABLEND||this._transparencyMode===c.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===c.MATERIAL_ALPHATEST||this._transparencyMode===c.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===c.MATERIAL_OPAQUE||this._transparencyMode===c.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(w){return this._hasTransparencyMode?this._transparencyModeIsBlend:w.visibility<1||!this._disableAlphaBlending&&(w.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(w){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(w)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}km(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this.iw().meshes;for(const e of p)if(e.oe)for(const p of e.oe)if(p.Yw()===this)for(const e of p._drawWrappers)e&&this._materialContext===e.materialContext&&(e._wasPreviouslyReady=!1,e._wasPreviouslyUsingInstances=null,e._forceRebindOnNextCall=w);w&&this.kX(c.AllDirtyFlag)}_preBind(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.getEngine(),r=(null==p?this.sideOrientation:p)===c.ClockWiseSideOrientation;return e.enableEffect(w||this._getDrawWrapper()),e.setState(this.ce,this.zOffset,!1,r,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),r}bind(w,p){}buildUniformLayout(){const w=this._uniformBuffer;this._eventInfo.ubo=w,this._callbackPluginEventGeneric(8,this._eventInfo),w.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(w,p,e){const r=e._drawWrapper;this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),r._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(w){}bindView(w){this._useUBO?this._needToBindSceneUbo=!0:w.setMatrix("view",this.iw().getViewMatrix())}bindViewProjection(w){this._useUBO?this._needToBindSceneUbo=!0:(w.setMatrix("viewProjection",this.iw().getTransformMatrix()),w.setMatrix("projection",this.iw().getProjectionMatrix()))}bindEyePosition(w,p){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(w,p)}_afterBind(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&p&&(this._needToBindSceneUbo=!1,(0,y.n)(p,this.iw().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=w?w.visibility:1,this._onBindObservable&&w&&this._onBindObservable.notifyObservers(w),this.disableDepthWrite){const w=this._scene.getEngine();this._cachedDepthWriteState=w.getDepthWrite(),w.setDepthWrite(!1)}if(this.disableColorWrite){const w=this._scene.getEngine();this._cachedColorWriteState=w.getColorWrite(),w.setColorWrite(!1)}if(0!==this.depthFunction){const w=this._scene.getEngine();this._cachedDepthFunctionState=w.getDepthFunction()||0,w.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(w){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=w,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(w){return null}_clonePlugins(w,p){const e={};if(this._serializePlugins(e),c._ParsePlugins(e,w,this._scene,p),this.pluginManager)for(const r of this.pluginManager._plugins){const p=w.pluginManager.getPlugin(r.name);p&&r.copyTo(p)}}getBindedMeshes(){if(this.meshMap){const w=[];for(const p in this.meshMap){const e=this.meshMap[p];e&&w.push(e)}return w}return this._scene.meshes.filter((w=>w.material===this))}forceCompilation(w,p,e,r){const I={clipPlane:!1,useInstances:!1,...e},d=this.iw(),f=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const q=()=>{if(!this._scene||!this._scene.getEngine())return;const e=d.clipPlane;if(I.clipPlane&&(d.clipPlane=new k.e(0,0,0,1)),this._storeEffectOnSubMeshes){let e=!0,d=null;if(w.oe){const p=new E.b(0,0,0,0,0,w,void 0,!1,!1);p.materialDefines&&(p.materialDefines._renderId=-1),this.isReadyForSubMesh(w,p,I.useInstances)||(p.effect&&p.effect.getCompilationError()&&p.effect.allFallbacksProcessed()?d=p.effect.getCompilationError():(e=!1,setTimeout(q,16)))}e&&(this.allowShaderHotSwapping=f,d&&r&&r(d),p&&p(this))}else this.isReady()?(this.allowShaderHotSwapping=f,p&&p(this)):setTimeout(q,16);I.clipPlane&&(d.clipPlane=e)};q()}async forceCompilationAsync(w,p){return await new Promise(((e,r)=>{this.forceCompilation(w,(()=>{e()}),p,(w=>{r(w)}))}))}kX(w){this.iw().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(c._DirtyCallbackArray.length=0,w&c.ImageProcessingDirtyFlag&&c._DirtyCallbackArray.push(c._ImageProcessingDirtyCallBack),w&c.TextureDirtyFlag&&c._DirtyCallbackArray.push(c._TextureDirtyCallBack),w&c.LightDirtyFlag&&c._DirtyCallbackArray.push(c._LightsDirtyCallBack),w&c.FresnelDirtyFlag&&c._DirtyCallbackArray.push(c._FresnelDirtyCallBack),w&c.AttributesDirtyFlag&&c._DirtyCallbackArray.push(c._AttributeDirtyCallBack),w&c.MiscDirtyFlag&&c._DirtyCallbackArray.push(c._MiscDirtyCallBack),w&c.PrePassDirtyFlag&&c._DirtyCallbackArray.push(c._PrePassDirtyCallBack),c._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(c._RunDirtyCallBacks),this.iw().resetCachedMaterial())}resetDrawCache(){const w=this.iw().meshes;for(const p of w)if(p.oe)for(const w of p.oe)w.Yw()===this&&w.resetDrawCache()}_markAllSubMeshesAsDirty(w){const p=this.iw();if(p.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=p.meshes;for(const r of e)if(r.oe)for(const e of r.oe){if((e.Yw()||(p._hasDefaultMaterial?p.defaultMaterial:null))===this)for(const p of e._drawWrappers)p&&p.defines&&p.defines.markAllAsDirty&&this._materialContext===p.materialContext&&w(p.defines)}}_markScenePrePassDirty(){if(this.iw().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const w=this.iw().enablePrePassRenderer();w&&w.kX()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(c._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(c._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(c._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(c._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(c._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(c._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(c._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(c._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(c._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const w=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.ue.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(w)}))}}setPrePassRenderer(w){return!1}dispose(w,p,e){const r=this.iw();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),this._eventInfo.forceDisposeTextures=p,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const w=this._parentContainer.materials.indexOf(this);w>-1&&this._parentContainer.materials.splice(w,1),this._parentContainer=null}if(!0!==e)if(this.meshMap)for(const I in this.meshMap){const w=this.meshMap[I];this._disposeMeshResources(w)}else{const w=r.meshes;for(const p of w)this._disposeMeshResources(p)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.ue.notifyObservers(this),this.ue.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(w){if(!w)return;const p=w.me,e=w._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(w.oe&&e)for(const I of w.oe){const w=I._drawWrappers;for(let d=0;d<w.length;d++){var r;const f=null===(r=w[d])||void 0===r?void 0:r.effect;if(!f)continue;e[d]===this&&(null===p||void 0===p||p._releaseVertexArrayObject(f),I._removeDrawWrapper(d,!0,!0))}}}else null===p||void 0===p||p._releaseVertexArrayObject(this._drawWrapper.effect);w.material!==this||w.sourceMesh||(w.material=null)}serialize(){const w=J.e.Serialize(this);return w.stencil=this.stencil.serialize(),w.uniqueId=this.uniqueId,this._serializePlugins(w),w}_serializePlugins(w){if(w.plugins={},this.pluginManager)for(const p of this.pluginManager._plugins)p.doNotSerialize||(w.plugins[p.getClassName()]=p.serialize())}static Parse(w,p,e){if(w.customType){if("BABYLON.PBRMaterial"===w.customType&&w.overloadedAlbedo&&(w.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return X.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else w.customType="BABYLON.StandardMaterial";const r=d.g.Instantiate(w.customType).Parse(w,p,e);return r._loadedUniqueId=w.uniqueId,r}static _ParsePlugins(w,p,e,r){if(w.plugins)for(const q in w.plugins){var I,f;const E=w.plugins[q];let j=null===(I=p.pluginManager)||void 0===I?void 0:I.getPlugin(E.name);if(!j){const w=d.g.Instantiate("BABYLON."+q);w&&(j=new w(p))}null===(f=j)||void 0===f||f.parse(E,e,r)}}}c.TriangleFillMode=0,c.WireFrameFillMode=1,c.PointFillMode=2,c.PointListDrawMode=3,c.LineListDrawMode=4,c.LineLoopDrawMode=5,c.LineStripDrawMode=6,c.TriangleStripDrawMode=7,c.TriangleFanDrawMode=8,c.ClockWiseSideOrientation=0,c.CounterClockWiseSideOrientation=1,c.ImageProcessingDirtyFlag=64,c.TextureDirtyFlag=1,c.LightDirtyFlag=2,c.FresnelDirtyFlag=4,c.AttributesDirtyFlag=8,c.MiscDirtyFlag=16,c.PrePassDirtyFlag=32,c.AllDirtyFlag=127,c.MATERIAL_OPAQUE=0,c.MATERIAL_ALPHATEST=1,c.MATERIAL_ALPHABLEND=2,c.MATERIAL_ALPHATESTANDBLEND=3,c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,c.MATERIAL_NORMALBLENDMETHOD_RNM=1,c.OnEventObservable=new f.d,c._AllDirtyCallBack=w=>w.markAllAsDirty(),c._ImageProcessingDirtyCallBack=w=>w.markAsImageProcessingDirty(),c._TextureDirtyCallBack=w=>w.markAsTexturesDirty(),c._FresnelDirtyCallBack=w=>w.markAsFresnelDirty(),c._MiscDirtyCallBack=w=>w.markAsMiscDirty(),c._PrePassDirtyCallBack=w=>w.markAsPrePassDirty(),c._LightsDirtyCallBack=w=>w.markAsLightDirty(),c._AttributeDirtyCallBack=w=>w.markAsAttributesDirty(),c._FresnelAndMiscDirtyCallBack=w=>{c._FresnelDirtyCallBack(w),c._MiscDirtyCallBack(w)},c._TextureAndMiscDirtyCallBack=w=>{c._TextureDirtyCallBack(w),c._MiscDirtyCallBack(w)},c._DirtyCallbackArray=[],c._RunDirtyCallBacks=w=>{for(const p of c._DirtyCallbackArray)p(w)},(0,r.c)([(0,I.J)()],c.prototype,"id",void 0),(0,r.c)([(0,I.J)()],c.prototype,"uniqueId",void 0),(0,r.c)([(0,I.J)()],c.prototype,"name",void 0),(0,r.c)([(0,I.J)()],c.prototype,"metadata",void 0),(0,r.c)([(0,I.J)()],c.prototype,"checkReadyOnEveryCall",void 0),(0,r.c)([(0,I.J)()],c.prototype,"checkReadyOnlyOnce",void 0),(0,r.c)([(0,I.J)()],c.prototype,"state",void 0),(0,r.c)([(0,I.J)("alpha")],c.prototype,"_alpha",void 0),(0,r.c)([(0,I.J)("ce")],c.prototype,"_backFaceCulling",void 0),(0,r.c)([(0,I.J)("cullBackFaces")],c.prototype,"_cullBackFaces",void 0),(0,r.c)([(0,I.J)()],c.prototype,"sideOrientation",void 0),(0,r.c)([(0,I.J)("alphaMode")],c.prototype,"_alphaMode",void 0),(0,r.c)([(0,I.J)()],c.prototype,"_needDepthPrePass",void 0),(0,r.c)([(0,I.J)()],c.prototype,"disableDepthWrite",void 0),(0,r.c)([(0,I.J)()],c.prototype,"disableColorWrite",void 0),(0,r.c)([(0,I.J)()],c.prototype,"forceDepthWrite",void 0),(0,r.c)([(0,I.J)()],c.prototype,"depthFunction",void 0),(0,r.c)([(0,I.J)()],c.prototype,"separateCullingPass",void 0),(0,r.c)([(0,I.J)("fogEnabled")],c.prototype,"_fogEnabled",void 0),(0,r.c)([(0,I.J)()],c.prototype,"pointSize",void 0),(0,r.c)([(0,I.J)()],c.prototype,"zOffset",void 0),(0,r.c)([(0,I.J)()],c.prototype,"zOffsetUnits",void 0),(0,r.c)([(0,I.J)()],c.prototype,"pointsCloud",null),(0,r.c)([(0,I.J)()],c.prototype,"fillMode",null),(0,r.c)([(0,I.J)()],c.prototype,"useLogarithmicDepth",null),(0,r.c)([(0,I.J)()],c.prototype,"transparencyMode",null)},11648:(w,p,e)=>{e.d(p,{b:()=>r});class r{constructor(w){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=w,w)for(const p in w)Object.prototype.hasOwnProperty.call(w,p)&&this._setDefaultValue(p)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||w,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const w of Object.keys(this))"_"!==w[0]&&this._keys.push(w);if(this._externalProperties)for(const w in this._externalProperties)-1===this._keys.indexOf(w)&&this._keys.push(w)}isEqual(w){if(this._keys.length!==w._keys.length)return!1;for(let p=0;p<this._keys.length;p++){const e=this._keys[p];if(this[e]!==w[e])return!1}return!0}cloneTo(w){this._keys.length!==w._keys.length&&(w._keys=this._keys.slice(0));for(let p=0;p<this._keys.length;p++){const e=this._keys[p];w[e]=this[e]}}reset(){for(const w of this._keys)this._setDefaultValue(w)}_setDefaultValue(w){var p,e,r,I;const d=(null===(p=this._externalProperties)||void 0===p||null===(e=p[w])||void 0===e?void 0:e.type)??typeof this[w],f=null===(r=this._externalProperties)||void 0===r||null===(I=r[w])||void 0===I?void 0:I.default;switch(d){case"number":this[w]=f??0;break;case"string":this[w]=f??"";break;default:this[w]=f??!1}}toString(){let w="";for(let p=0;p<this._keys.length;p++){const e=this._keys[p],r=this[e];switch(typeof r){case"number":case"string":w+="#define "+e+" "+r+"\n";break;default:r&&(w+="#define "+e+"\n")}}return w}}},11674:(w,p,e)=>{e.d(p,{d:()=>I});var r=e(11132);class I{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(w){this._DiffuseTextureEnabled!==w&&(this._DiffuseTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(w){this._BaseWeightTextureEnabled!==w&&(this._BaseWeightTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(w){this._BaseDiffuseRoughnessTextureEnabled!==w&&(this._BaseDiffuseRoughnessTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(w){this._DetailTextureEnabled!==w&&(this._DetailTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(w){this._DecalMapEnabled!==w&&(this._DecalMapEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(w){this._AmbientTextureEnabled!==w&&(this._AmbientTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(w){this._OpacityTextureEnabled!==w&&(this._OpacityTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(w){this._ReflectionTextureEnabled!==w&&(this._ReflectionTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(w){this._EmissiveTextureEnabled!==w&&(this._EmissiveTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(w){this._SpecularTextureEnabled!==w&&(this._SpecularTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(w){this._BumpTextureEnabled!==w&&(this._BumpTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(w){this._LightmapTextureEnabled!==w&&(this._LightmapTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(w){this._RefractionTextureEnabled!==w&&(this._RefractionTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(w){this._ColorGradingTextureEnabled!==w&&(this._ColorGradingTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(w){this._FresnelEnabled!==w&&(this._FresnelEnabled=w,r.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(w){this._ClearCoatTextureEnabled!==w&&(this._ClearCoatTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(w){this._ClearCoatBumpTextureEnabled!==w&&(this._ClearCoatBumpTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(w){this._ClearCoatTintTextureEnabled!==w&&(this._ClearCoatTintTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(w){this._SheenTextureEnabled!==w&&(this._SheenTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(w){this._AnisotropicTextureEnabled!==w&&(this._AnisotropicTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(w){this._ThicknessTextureEnabled!==w&&(this._ThicknessTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(w){this._RefractionIntensityTextureEnabled!==w&&(this._RefractionIntensityTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(w){this._TranslucencyIntensityTextureEnabled!==w&&(this._TranslucencyIntensityTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(w){this._TranslucencyColorTextureEnabled!==w&&(this._TranslucencyColorTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(w){this._IridescenceTextureEnabled!==w&&(this._IridescenceTextureEnabled=w,r.d.MarkAllMaterialsAsDirty(1))}}I._DiffuseTextureEnabled=!0,I._BaseWeightTextureEnabled=!0,I._BaseDiffuseRoughnessTextureEnabled=!0,I._DetailTextureEnabled=!0,I._DecalMapEnabled=!0,I._AmbientTextureEnabled=!0,I._OpacityTextureEnabled=!0,I._ReflectionTextureEnabled=!0,I._EmissiveTextureEnabled=!0,I._SpecularTextureEnabled=!0,I._BumpTextureEnabled=!0,I._LightmapTextureEnabled=!0,I._RefractionTextureEnabled=!0,I._ColorGradingTextureEnabled=!0,I._FresnelEnabled=!0,I._ClearCoatTextureEnabled=!0,I._ClearCoatBumpTextureEnabled=!0,I._ClearCoatTintTextureEnabled=!0,I._SheenTextureEnabled=!0,I._AnisotropicTextureEnabled=!0,I._ThicknessTextureEnabled=!0,I._RefractionIntensityTextureEnabled=!0,I._TranslucencyIntensityTextureEnabled=!0,I._TranslucencyColorTextureEnabled=!0,I._IridescenceTextureEnabled=!0},11310:(w,p,e)=>{e.d(p,{C:()=>t,E:()=>J,I:()=>m,J:()=>R,K:()=>v,L:()=>N,N:()=>s,O:()=>l,P:()=>V,T:()=>b,W:()=>h,X:()=>u,Z:()=>K,d:()=>A,e:()=>k,f:()=>M,i:()=>X,j:()=>y,n:()=>c,r:()=>O,s:()=>n,v:()=>a,z:()=>i});var r=e(11081),I=e(11308),d=e(11051),f=e(11317),q=e(11320);const E=I.b.Black(),j={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function X(w,p,e){if(!w||w.LOGARITHMICDEPTH||w.indexOf&&w.indexOf("LOGARITHMICDEPTH")>=0){const w=e.activeCamera;1===w.mode&&r.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),p.setFloat("logarithmicDepthConstant",2/(Math.log(w.maxZ+1)/Math.LN2))}}function k(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e&&w.fogEnabled&&(!p||p.applyFog)&&0!==w.fogMode&&(e.setFloat4("vFogInfos",w.fogMode,w.fogStart,w.fogEnd,w.fogDensity),r?(w.fogColor.toLinearSpaceToRef(E,w.getEngine().useExactSrgbConversions),e.setColor3("vFogColor",E)):e.setColor3("vFogColor",w.fogColor))}function m(w,p,e,r,I,d,f,q,E,X){const k=w.numMaxInfluencers||w.numInfluencers;return k<=0?0:(p.push("#define MORPHTARGETS"),w.hasPositions&&p.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),w.hasNormals&&p.push("#define MORPHTARGETTEXTURE_HASNORMALS"),w.hasTangents&&p.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),w.hasUVs&&p.push("#define MORPHTARGETTEXTURE_HASUVS"),w.hasUV2s&&p.push("#define MORPHTARGETTEXTURE_HASUV2S"),w.hasColors&&p.push("#define MORPHTARGETTEXTURE_HASCOLORS"),w.supportsPositions&&I&&p.push("#define MORPHTARGETS_POSITION"),w.supportsNormals&&d&&p.push("#define MORPHTARGETS_NORMAL"),w.supportsTangents&&f&&p.push("#define MORPHTARGETS_TANGENT"),w.supportsUVs&&q&&p.push("#define MORPHTARGETS_UV"),w.supportsUV2s&&E&&p.push("#define MORPHTARGETS_UV2"),w.supportsColors&&X&&p.push("#define MORPHTARGETS_COLOR"),p.push("#define NUM_MORPH_INFLUENCERS "+k),w.isUsingTextureForTargets&&p.push("#define MORPHTARGETS_TEXTURE"),j.NUM_MORPH_INFLUENCERS=k,j.NORMAL=d,j.TANGENT=f,j.UV=q,j.UV2=E,j.COLOR=X,J(e,r,j,I),k)}function J(w,p,e){let I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const f=e.NUM_MORPH_INFLUENCERS;if(f>0&&d.d.LastCreatedEngine){const q=d.d.LastCreatedEngine.getCaps().maxVertexAttribs,E=p.morphTargetManager;if(null!==E&&void 0!==E&&E.isUsingTextureForTargets)return;const j=E&&E.supportsPositions&&I,X=E&&E.supportsNormals&&e.NORMAL,k=E&&E.supportsTangents&&e.TANGENT,m=E&&E.supportsUVs&&e.UV1,J=E&&E.supportsUV2s&&e.UV2,K=E&&E.supportsColors&&e.VERTEXCOLOR;for(let e=0;e<f;e++)j&&w.push("position"+e),X&&w.push("normal"+e),k&&w.push("tangent"+e),m&&w.push("uv_"+e),J&&w.push("uv2_"+e),K&&w.push("color"+e),w.length>q&&r.c.Error("Cannot add more vertex attributes for mesh "+p.name)}}function K(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w.push("world0"),w.push("world1"),w.push("world2"),w.push("world3"),p&&(w.push("previousWorld0"),w.push("previousWorld1"),w.push("previousWorld2"),w.push("previousWorld3"))}function y(w,p){const e=w.morphTargetManager;w&&e&&p.setFloatArray("morphTargetInfluences",e.influences)}function c(w,p){p.bindToEffect(w,"Scene")}function s(w,p,e){p._needUVs=!0,p[e]=!0,w.optimizeUVAllocation&&w.getTextureMatrix().isIdentityAs3x2()?(p[e+"DIRECTUV"]=w.coordinatesIndex+1,p["MAINUV"+(w.coordinatesIndex+1)]=!0):p[e+"DIRECTUV"]=0}function O(w,p,e){const r=w.getTextureMatrix();p.Ze(e+"Matrix",r)}function a(w,p,e){e.BAKED_VERTEX_ANIMATION_TEXTURE&&e.INSTANCES&&w.push("bakedVertexAnimationSettingsInstanced")}function A(w,p,e){var r;if(p&&w&&(w.computeBonesUsingShaders&&p._bonesComputationForcedToCPU&&(w.computeBonesUsingShaders=!1),w.useBones&&w.computeBonesUsingShaders&&w.skeleton)){const I=w.skeleton;if(I.isUsingTextureForMatrices&&p.getUniformIndex("boneTextureWidth")>-1){const e=I.getTransformMatrixTexture(w);p.setTexture("boneSampler",e),p.setFloat("boneTextureWidth",4*(I.bones.length+1))}else{const d=I.getTransformMatrices(w);d&&(p.setMatrices("mBones",d),e&&w.iw().prePassRenderer&&w.iw().prePassRenderer.getIndex(2)&&(e.previousBones[w.uniqueId]||(e.previousBones[w.uniqueId]=d.slice()),p.setMatrices("mPreviousBones",e.previousBones[w.uniqueId]),r=d,e.previousBones[w.uniqueId].set(r)))}}}function z(w,p,e,r,I){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];w._bindLight(p,e,r,I,d)}function M(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const d=Math.min(p.lightSources.length,I);for(let f=0;f<d;f++){z(p.lightSources[f],f,w,e,"boolean"===typeof r?r:r.SPECULARTERM,p.receiveShadows)}}function i(w,p,e,r){e.NUM_BONE_INFLUENCERS>0&&(r.addCPUSkinningFallback(0,p),w.push("matricesIndices"),w.push("matricesWeights"),e.NUM_BONE_INFLUENCERS>4&&(w.push("matricesIndicesExtra"),w.push("matricesWeightsExtra")))}function t(w,p){(p.INSTANCES||p.THIN_INSTANCES)&&K(w,!!p.PREPASS_VELOCITY),p.INSTANCESCOLOR&&w.push("instanceColor")}function n(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=0;for(let d=0;d<e&&w["LIGHT"+d];d++)d>0&&(I=r+d,p.addFallback(I,"LIGHT"+d)),w.SHADOWS||(w["SHADOW"+d]&&p.addFallback(r,"SHADOW"+d),w["SHADOWPCF"+d]&&p.addFallback(r,"SHADOWPCF"+d),w["SHADOWPCSS"+d]&&p.addFallback(r,"SHADOWPCSS"+d),w["SHADOWPOISSON"+d]&&p.addFallback(r,"SHADOWPOISSON"+d),w["SHADOWESM"+d]&&p.addFallback(r,"SHADOWESM"+d),w["SHADOWCLOSEESM"+d]&&p.addFallback(r,"SHADOWCLOSEESM"+d));return I++}function l(w,p,e,r,I,d,f){let q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];f._areMiscDirty&&(f.LOGARITHMICDEPTH=e,f.POINTSIZE=r,f.FOG=I&&function(w,p){return p.fogEnabled&&w.applyFog&&0!==p.fogMode}(w,p),f.NONUNIFORMSCALING=w.nonUniformScaling,f.ALPHATEST=d,f.DECAL_AFTER_DETAIL=q)}function N(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!e._areLightsDirty)return e._needNormals;let f=0;const q={needNormals:e._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(w.lightsEnabled&&!d)for(const j of p.lightSources)if(U(w,p,j,f,e,r,q),f++,f===I)break;e.SPECULARTERM=q.specularEnabled,e.SHADOWS=q.shadowEnabled;for(let j=f;j<I;j++)void 0!==e["LIGHT"+j]&&(e["LIGHT"+j]=!1,e["HEMILIGHT"+j]=!1,e["POINTLIGHT"+j]=!1,e["DIRLIGHT"+j]=!1,e["SPOTLIGHT"+j]=!1,e["AREALIGHT"+j]=!1,e["SHADOW"+j]=!1,e["SHADOWCSM"+j]=!1,e["SHADOWCSMDEBUG"+j]=!1,e["SHADOWCSMNUM_CASCADES"+j]=!1,e["SHADOWCSMUSESHADOWMAXZ"+j]=!1,e["SHADOWCSMNOBLEND"+j]=!1,e["SHADOWCSM_RIGHTHANDED"+j]=!1,e["SHADOWPCF"+j]=!1,e["SHADOWPCSS"+j]=!1,e["SHADOWPOISSON"+j]=!1,e["SHADOWESM"+j]=!1,e["SHADOWCLOSEESM"+j]=!1,e["SHADOWCUBE"+j]=!1,e["SHADOWLOWQUALITY"+j]=!1,e["SHADOWMEDIUMQUALITY"+j]=!1);const E=w.getEngine().getCaps();return void 0===e.SHADOWFLOAT&&(q.needRebuild=!0),e.SHADOWFLOAT=q.shadowEnabled&&(E.textureFloatRender&&E.textureFloatLinearFiltering||E.textureHalfFloatRender&&E.textureHalfFloatLinearFiltering),e.LIGHTMAPEXCLUDED=q.lightmapMode,q.needRebuild&&e.rebuild(),q.needNormals}function U(w,p,e,r,I,d,q){switch(q.needNormals=!0,void 0===I["LIGHT"+r]&&(q.needRebuild=!0),I["LIGHT"+r]=!0,I["SPOTLIGHT"+r]=!1,I["HEMILIGHT"+r]=!1,I["POINTLIGHT"+r]=!1,I["DIRLIGHT"+r]=!1,I["AREALIGHT"+r]=!1,e.prepareLightSpecificDefines(I,r),I["LIGHT_FALLOFF_PHYSICAL"+r]=!1,I["LIGHT_FALLOFF_GLTF"+r]=!1,I["LIGHT_FALLOFF_STANDARD"+r]=!1,e.falloffType){case f.c.FALLOFF_GLTF:I["LIGHT_FALLOFF_GLTF"+r]=!0;break;case f.c.FALLOFF_PHYSICAL:I["LIGHT_FALLOFF_PHYSICAL"+r]=!0;break;case f.c.FALLOFF_STANDARD:I["LIGHT_FALLOFF_STANDARD"+r]=!0}if(d&&!e.PX.equalsFloats(0,0,0)&&(q.specularEnabled=!0),I["SHADOW"+r]=!1,I["SHADOWCSM"+r]=!1,I["SHADOWCSMDEBUG"+r]=!1,I["SHADOWCSMNUM_CASCADES"+r]=!1,I["SHADOWCSMUSESHADOWMAXZ"+r]=!1,I["SHADOWCSMNOBLEND"+r]=!1,I["SHADOWCSM_RIGHTHANDED"+r]=!1,I["SHADOWPCF"+r]=!1,I["SHADOWPCSS"+r]=!1,I["SHADOWPOISSON"+r]=!1,I["SHADOWESM"+r]=!1,I["SHADOWCLOSEESM"+r]=!1,I["SHADOWCUBE"+r]=!1,I["SHADOWLOWQUALITY"+r]=!1,I["SHADOWMEDIUMQUALITY"+r]=!1,p&&p.receiveShadows&&w.shadowsEnabled&&e.shadowEnabled){const p=e.getShadowGenerator(w.activeCamera)??e.getShadowGenerator();if(p){const w=p.getShadowMap();w&&w.renderList&&w.renderList.length>0&&(q.shadowEnabled=!0,p.prepareDefines(I,r))}}e.lightmapMode!=f.c.LIGHTMAP_DEFAULT?(q.lightmapMode=!0,I["LIGHTMAPEXCLUDED"+r]=!0,I["LIGHTMAPNOSPECULAR"+r]=e.lightmapMode==f.c.LIGHTMAP_SHADOWSONLY):(I["LIGHTMAPEXCLUDED"+r]=!1,I["LIGHTMAPNOSPECULAR"+r]=!1)}function v(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=function(w,p){let e=!1;if(w.activeCamera){const r=p.CAMERA_ORTHOGRAPHIC?1:0,I=p.CAMERA_PERSPECTIVE?1:0,d=1===w.activeCamera.mode?1:0,f=0===w.activeCamera.mode?1:0;(r^d||I^f)&&(p.CAMERA_ORTHOGRAPHIC=1===d,p.CAMERA_PERSPECTIVE=1===f,e=!0)}return e}(w,r);!1!==d&&(E=(0,q.h)(e,w,r)),r.DEPTHPREPASS!==!p.getColorWrite()&&(r.DEPTHPREPASS=!r.DEPTHPREPASS,E=!0),r.INSTANCES!==I&&(r.INSTANCES=I,E=!0),r.THIN_INSTANCES!==f&&(r.THIN_INSTANCES=f,E=!0),E&&r.markAsUnprocessed()}function R(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!p._areAttributesDirty&&p._needNormals===p._normals&&p._needUVs===p._uvs)return!1;p._normals=p._needNormals,p._uvs=p._needUVs,p.NORMAL=p._needNormals&&w.isVerticesDataPresent("normal"),p._needNormals&&w.isVerticesDataPresent("tangent")&&(p.TANGENT=!0);for(let q=1;q<=6;++q)p["UV"+q]=!!p._needUVs&&w.isVerticesDataPresent(`uv${1===q?"":q}`);if(e){const e=w.useVertexColors&&w.isVerticesDataPresent("color");p.VERTEXCOLOR=e,p.VERTEXALPHA=w.hasVertexAlpha&&e&&d}return w.isVerticesDataPresent("instanceColor")&&(w.hasInstances||w.hasThinInstances)&&(p.INSTANCESCOLOR=!0),r&&function(w,p){if(w.useBones&&w.computeBonesUsingShaders&&w.skeleton){p.NUM_BONE_INFLUENCERS=w.numBoneInfluencers;const e=void 0!==p.BONETEXTURE;if(w.skeleton.isUsingTextureForMatrices&&e)p.BONETEXTURE=!0;else{p.BonesPerMesh=w.skeleton.bones.length+1,p.BONETEXTURE=!e&&void 0;const r=w.iw().prePassRenderer;if(r&&r.enabled){const e=-1===r.excludedSkinnedMesh.indexOf(w);p.BONES_VELOCITY_ENABLED=e}}}else p.NUM_BONE_INFLUENCERS=0,p.BonesPerMesh=0,void 0!==p.BONETEXTURE&&(p.BONETEXTURE=!1)}(w,p),I&&function(w,p){const e=w.morphTargetManager;e?(p.MORPHTARGETS_UV=e.supportsUVs&&p.UV1,p.MORPHTARGETS_UV2=e.supportsUV2s&&p.UV2,p.MORPHTARGETS_TANGENT=e.supportsTangents&&p.TANGENT,p.MORPHTARGETS_NORMAL=e.supportsNormals&&p.NORMAL,p.MORPHTARGETS_POSITION=e.supportsPositions,p.MORPHTARGETS_COLOR=e.supportsColors,p.MORPHTARGETTEXTURE_HASUVS=e.hasUVs,p.MORPHTARGETTEXTURE_HASUV2S=e.hasUV2s,p.MORPHTARGETTEXTURE_HASTANGENTS=e.hasTangents,p.MORPHTARGETTEXTURE_HASNORMALS=e.hasNormals,p.MORPHTARGETTEXTURE_HASPOSITIONS=e.hasPositions,p.MORPHTARGETTEXTURE_HASCOLORS=e.hasColors,p.NUM_MORPH_INFLUENCERS=e.numMaxInfluencers||e.numInfluencers,p.MORPHTARGETS=p.NUM_MORPH_INFLUENCERS>0,p.MORPHTARGETS_TEXTURE=e.isUsingTextureForTargets):(p.MORPHTARGETS_UV=!1,p.MORPHTARGETS_UV2=!1,p.MORPHTARGETS_TANGENT=!1,p.MORPHTARGETS_NORMAL=!1,p.MORPHTARGETS_POSITION=!1,p.MORPHTARGETS_COLOR=!1,p.MORPHTARGETTEXTURE_HASUVS=!1,p.MORPHTARGETTEXTURE_HASUV2S=!1,p.MORPHTARGETTEXTURE_HASTANGENTS=!1,p.MORPHTARGETTEXTURE_HASNORMALS=!1,p.MORPHTARGETTEXTURE_HASPOSITIONS=!1,p.MORPHTARGETTEXTURE_HAS_COLORS=!1,p.MORPHTARGETS=!1,p.NUM_MORPH_INFLUENCERS=0)}(w,p),f&&function(w,p){const e=w.bakedVertexAnimationManager;p.BAKED_VERTEX_ANIMATION_TEXTURE=!(!e||!e.isEnabled)}(w,p),!0}function V(w,p){if(w.activeCamera){const e=p.MULTIVIEW;p.MULTIVIEW=null!==w.activeCamera.outputRenderTarget&&w.activeCamera.outputRenderTarget.getViewCount()>1,p.MULTIVIEW!=e&&p.markAsUnprocessed()}}function b(w,p,e){const r=p.ORDER_INDEPENDENT_TRANSPARENCY,I=p.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;p.ORDER_INDEPENDENT_TRANSPARENCY=w.useOrderIndependentTransparency&&e,p.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!w.getEngine().getCaps().textureFloatLinearFiltering,r===p.ORDER_INDEPENDENT_TRANSPARENCY&&I===p.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||p.markAsUnprocessed()}function h(w,p,e){const r=p.PREPASS;if(!p._arePrePassDirty)return;const I=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(w.prePassRenderer&&w.prePassRenderer.enabled&&e){p.PREPASS=!0,p.SCENE_MRT_COUNT=w.prePassRenderer.mrtCount,p.PREPASS_NORMAL_WORLDSPACE=w.prePassRenderer.generateNormalsInWorldSpace,p.PREPASS_COLOR=!0,p.PREPASS_COLOR_INDEX=0;for(let e=0;e<I.length;e++){const r=w.prePassRenderer.getIndex(I[e].type);-1!==r?(p[I[e].define]=!0,p[I[e].index]=r):p[I[e].define]=!1}}else{p.PREPASS=!1;for(let w=0;w<I.length;w++)p[I[w].define]=!1}p.PREPASS!=r&&(p.markAsUnprocessed(),p.markAsImageProcessingDirty())}function P(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];I&&I.push("Light"+w),d||(p.push("vLightData"+w,"vLightDiffuse"+w,"vLightSpecular"+w,"vLightDirection"+w,"vLightWidth"+w,"vLightHeight"+w,"vLightFalloff"+w,"vLightGround"+w,"lightMatrix"+w,"shadowsInfo"+w,"depthValues"+w),e.push("shadowTexture"+w),e.push("depthTexture"+w),p.push("viewFrustumZ"+w,"cascadeBlendFactor"+w,"lightSizeUVCorrection"+w,"depthCorrection"+w,"penumbraDarkness"+w,"frustumLengths"+w),r&&(e.push("projectionLightTexture"+w),p.push("textureProjectionMatrix"+w)),f&&e.push("iesLightTexture"+w))}function u(w,p,e){let r,I,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(w.uniformsNames){const f=w;r=f.uniformsNames,I=f.uniformBuffersNames,p=f.samplers,e=f.defines,d=f.maxSimultaneousLights||0}else r=w,p||(p=[]);for(let f=0;f<d&&e["LIGHT"+f];f++)P(f,r,p,e["PROJECTEDLIGHTTEXTURE"+f],I,!1,e["IESLIGHTTEXTURE"+f]);e.NUM_MORPH_INFLUENCERS&&(r.push("morphTargetInfluences"),r.push("morphTargetCount")),e.BAKED_VERTEX_ANIMATION_TEXTURE&&(r.push("bakedVertexAnimationSettings"),r.push("bakedVertexAnimationTextureSizeInverted"),r.push("bakedVertexAnimationTime"),p.push("bakedVertexAnimationTexture"))}},11706:(w,p,e)=>{e.d(p,{c:()=>d});var r,I=e(11023);!function(w){w[w.Zero=0]="Zero",w[w.One=1]="One",w[w.MaxViewZ=2]="MaxViewZ"}(r||(r={}));class d{static CreateConfiguration(w){return d._Configurations[w]={defines:{},previousWorldMatrices:{},previousViewProjection:I.b.Zero(),currentViewProjection:I.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},d._Configurations[w]}static DeleteConfiguration(w){delete d._Configurations[w]}static GetConfiguration(w){return d._Configurations[w]}static AddUniformsAndSamplers(w,p){w.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(w,p){for(const e of p)if(e.oe)for(const p of e.oe)p._removeDrawWrapper(w)}static PrepareDefines(w,p,e){if(!e._arePrePassDirty)return;const r=d._Configurations[w];if(!r)return;e.PREPASS=!0,e.PREPASS_COLOR=!1,e.PREPASS_COLOR_INDEX=-1;let I=0;for(let f=0;f<d.GeometryTextureDescriptions.length;f++){const w=d.GeometryTextureDescriptions[f],p=w.define,q=w.defineIndex,E=r.defines[q];void 0!==E?(e[p]=!0,e[q]=E,I++):(e[p]=!1,delete e[q])}e.SCENE_MRT_COUNT=I,e.BONES_VELOCITY_ENABLED=p.useBones&&p.computeBonesUsingShaders&&p.skeleton&&!p.skeleton.isUsingTextureForMatrices&&-1===r.excludedSkinnedMesh.indexOf(p)}static Bind(w,p,e,r,I){const f=d._Configurations[w];if(!f)return;const q=e.iw(),E=q.getEngine();if(f.reverseCulling&&E.setStateCullFaceType(q._mirroredCameraPosition?I.cullBackFaces:!I.cullBackFaces),(void 0!==f.defines.PREPASS_VELOCITY_INDEX||void 0!==f.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(f.previousWorldMatrices[e.uniqueId]||(f.previousWorldMatrices[e.uniqueId]=r.clone()),f.previousViewProjection||(f.previousViewProjection=q.getTransformMatrix().clone(),f.currentViewProjection=q.getTransformMatrix().clone()),f.currentViewProjection.updateFlag!==q.getTransformMatrix().updateFlag?(f.lastUpdateFrameId=E.frameId,f.previousViewProjection.X(f.currentViewProjection),f.currentViewProjection.X(q.getTransformMatrix())):f.lastUpdateFrameId!==E.frameId&&(f.lastUpdateFrameId=E.frameId,f.previousViewProjection.X(f.currentViewProjection)),p.setMatrix("previousWorld",f.previousWorldMatrices[e.uniqueId]),p.setMatrix("previousViewProjection",f.previousViewProjection),f.previousWorldMatrices[e.uniqueId]=r.clone(),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const w=e.skeleton;if(!w.isUsingTextureForMatrices||-1===p.getUniformIndex("boneTextureWidth")){const r=w.getTransformMatrices(e);r&&(f.previousBones[e.uniqueId]||(f.previousBones[e.uniqueId]=r.slice()),p.setMatrices("mPreviousBones",f.previousBones[e.uniqueId]),f.previousBones[e.uniqueId].set(r))}}}}d.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],d._Configurations={}},11657:(w,p,e)=>{e.d(p,{c:()=>s});var r=e(11207),I=e(11213),d=e(11203),f=e(11051),q=e(11118),E=e(11146);const j=new RegExp("^([gimus]+)!");class X{constructor(w){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=w,this._scene=w.iw(),this._engine=this._scene.getEngine()}_addPlugin(w){for(let r=0;r<this._plugins.length;++r)if(this._plugins[r].name===w.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!w.isCompatible(this._material.shaderLanguage))throw`The plugin "${w.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const p=w.getClassName();X._MaterialPluginClassToMainDefine[p]||(X._MaterialPluginClassToMainDefine[p]="MATERIALPLUGIN_"+ ++X._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(w,p)=>this._handlePluginEvent(w,p),this._plugins.push(w),this._plugins.sort(((w,p)=>w.priority-p.priority)),this._codeInjectionPoints={};const e={};e[X._MaterialPluginClassToMainDefine[p]]={type:"boolean",default:!0};for(const r of this._plugins)r.collectDefines(e),this._collectPointNames("vertex",r.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",r.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=e,!0}_activatePlugin(w){-1===this._activePlugins.indexOf(w)&&(this._activePlugins.push(w),this._activePlugins.sort(((w,p)=>w.priority-p.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),w.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(w),this._activePluginsForExtraEvents.sort(((w,p)=>w.priority-p.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(w){for(let p=0;p<this._plugins.length;++p)if(this._plugins[p].name===w)return this._plugins[p];return null}_handlePluginEventIsReadyForSubMesh(w){let p=!0;for(const e of this._activePlugins)p=p&&e.isReadyForSubMesh(w.defines,this._scene,this._engine,w.subMesh);w.isReadyForSubMesh=p}_handlePluginEventPrepareDefinesBeforeAttributes(w){for(const p of this._activePlugins)p.prepareDefinesBeforeAttributes(w.defines,this._scene,w.mesh)}_handlePluginEventPrepareDefines(w){for(const p of this._activePlugins)p.prepareDefines(w.defines,this._scene,w.mesh)}_handlePluginEventHardBindForSubMesh(w){for(const p of this._activePluginsForExtraEvents)p.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,w.subMesh)}_handlePluginEventBindForSubMesh(w){for(const p of this._activePlugins)p.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,w.subMesh)}_handlePluginEventHasRenderTargetTextures(w){let p=!1;for(const e of this._activePluginsForExtraEvents)if(p=e.hasRenderTargetTextures(),p)break;w.hasRenderTargetTextures=p}_handlePluginEventFillRenderTargetTextures(w){for(const p of this._activePluginsForExtraEvents)p.fillRenderTargetTextures(w.renderTargets)}_handlePluginEvent(w,p){switch(w){case 512:{const w=p;for(const p of this._activePlugins)p.getActiveTextures(w.activeTextures);break}case 256:{const w=p;for(const p of this._activePlugins)p.getAnimatables(w.animatables);break}case 1024:{const w=p;let e=!1;for(const p of this._activePlugins)if(e=p.hasTexture(w.texture),e)break;w.hasTexture=e;break}case 2:{const w=p;for(const p of this._plugins)p.dispose(w.forceDisposeTextures);break}case 4:p.defineNames=this._defineNamesFromPlugins;break;case 128:{const w=p;for(const p of this._activePlugins)w.fallbackRank=p.addFallbacks(w.defines,w.fallbacks,w.fallbackRank),p.getAttributes(w.attributes,this._scene,w.mesh);this._uniformList.length>0&&w.uniforms.push(...this._uniformList),this._samplerList.length>0&&w.samplers.push(...this._samplerList),this._uboList.length>0&&w.uniformBuffersNames.push(...this._uboList),w.customCode=this._injectCustomCode(w,w.customCode);break}case 8:{const w=p;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const e=1===this._material.shaderLanguage;for(const p of this._plugins){const r=p.getUniforms(this._material.shaderLanguage);if(r){if(r.ubo)for(const p of r.ubo){if(p.size&&p.type){const r=p.arraySize??0;if(w.ubo.addUniform(p.name,p.size,r),e){let w;switch(p.type){case"mat4":w="mat4x4f";break;case"float":w="f32";break;default:w=`${p.type}f`}this._uboDeclaration+=r>0?`uniform ${p.name}: array<${w}, ${r}>;\n`:`uniform ${p.name}: ${w};\n`}else this._uboDeclaration+=`${p.type} ${p.name}${r>0?`[${r}]`:""};\n`}this._uniformList.push(p.name)}r.vertex&&(this._vertexDeclaration+=r.vertex+"\n"),r.fragment&&(this._fragmentDeclaration+=r.fragment+"\n")}p.getSamplers(this._samplerList),p.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(w,p){if(p)for(const e in p)this._codeInjectionPoints[w]||(this._codeInjectionPoints[w]={}),this._codeInjectionPoints[w][e]=!0}_injectCustomCode(w,p){return(e,r)=>{var I;p&&(r=p(e,r)),this._uboDeclaration&&(r=r.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(r=r.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(r=r.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const d=null===(I=this._codeInjectionPoints)||void 0===I?void 0:I[e];if(!d)return r;let f=null;for(let p in d){let I="";for(const r of this._activePlugins){var X;let d=null===(X=r.getCustomCode(e,this._material.shaderLanguage))||void 0===X?void 0:X[p];if(d){if(r.resolveIncludes){if(null===f){const p=0;f={defines:[],indexParameters:w.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:E.e.GetShadersRepository(p),includesShadersStore:E.e.GetIncludesShadersStore(p),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}f.isFragment="fragment"===e,(0,q.f)(d,f,(w=>d=w))}I+=d+"\n"}}if(I.length>0)if("!"===p.charAt(0)){p=p.substring(1);let w="g";if("!"===p.charAt(0))w="",p=p.substring(1);else{const e=j.exec(p);e&&e.length>=2&&(w=e[1],p=p.substring(w.length+1))}w.indexOf("g")<0&&(w+="g");const e=r,d=new RegExp(p,w);let f=d.exec(e);for(;null!==f;){let w=I;for(let p=0;p<f.length;++p)w=w.replace("$"+p,f[p]);r=r.replace(f[0],w),f=d.exec(e)}}else{const w="#define "+p;r=r.replace(w,"\n"+I+"\n"+w)}}return r}}}X._MaterialPluginClassToMainDefine={},X._MaterialPluginCounter=0,f.d.OnEnginesDisposedObservable.add((()=>{K()}));const k=[];let m=!1,J=null;function K(){k.length=0,m=!1,d.b.OnEventObservable.remove(J),J=null}var y=e(11301),c=e(11038);class s{isCompatible(w){return 0===w}_enable(w){w&&this._pluginManager._activatePlugin(this)}constructor(w,p,e,r){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=w,this.name=p,this.priority=e,this.resolveIncludes=f,w.pluginManager||(w.pluginManager=new X(w),w.ue.add((()=>{w.pluginManager=void 0}))),this._pluginDefineNames=r,this._pluginManager=w.pluginManager,I&&this._pluginManager._addPlugin(this),d&&this._enable(!0),this.markAllDefinesAsDirty=w._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(w,p,e,r){return!0}hardBindForSubMesh(w,p,e,r){}bindForSubMesh(w,p,e,r){}dispose(w){}getCustomCode(w){return null}collectDefines(w){if(this._pluginDefineNames)for(const p of Object.keys(this._pluginDefineNames)){if("_"===p[0])continue;const e=typeof this._pluginDefineNames[p];w[p]={type:"number"===e?"number":"string"===e?"string":"boolean"===e?"boolean":"object",default:this._pluginDefineNames[p]}}}prepareDefinesBeforeAttributes(w,p,e){}prepareDefines(w,p,e){}hasTexture(w){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(w){}getActiveTextures(w){}getAnimatables(w){}addFallbacks(w,p,e){return e}getSamplers(w){}getAttributes(w,p,e){}getUniformBuffersNames(w){}getUniforms(){return{}}copyTo(w){y.e.Clone((()=>w),this)}serialize(){return y.e.Serialize(this)}parse(w,p,e){y.e.Parse((()=>this),w,p,e)}}(0,r.c)([(0,I.J)()],s.prototype,"name",void 0),(0,r.c)([(0,I.J)()],s.prototype,"priority",void 0),(0,r.c)([(0,I.J)()],s.prototype,"resolveIncludes",void 0),(0,r.c)([(0,I.J)()],s.prototype,"registerForExtraEvents",void 0),(0,c.d)("BABYLON.MaterialPluginBase",s)},11404:(w,p,e)=>{e.d(p,{b:()=>f});var r=e(11203),I=e(11304),d=e(11038);class f extends r.b{get Ce(){return this._subMaterials}set Ce(w){this._subMaterials=w,this._hookArray(w)}getChildren(){return this.Ce}constructor(w,p){super(w,p,!0),this._waitingSubMaterialsUniqueIds=[],this.iw().addMultiMaterial(this),this.Ce=[],this._storeEffectOnSubMeshes=!0}_hookArray(w){var p=this;const e=w.push;w.push=function(){for(var r=arguments.length,I=new Array(r),d=0;d<r;d++)I[d]=arguments[d];const f=e.apply(w,I);return p._markAllSubMeshesAsTexturesDirty(),f};const r=w.splice;w.splice=(p,e)=>{const I=r.apply(w,[p,e]);return this._markAllSubMeshesAsTexturesDirty(),I}}getSubMaterial(w){return w<0||w>=this.Ce.length?this.iw().defaultMaterial:this.Ce[w]}getActiveTextures(){return super.getActiveTextures().concat(...this.Ce.map((w=>w?w.getActiveTextures():[])))}hasTexture(w){if(super.hasTexture(w))return!0;for(let e=0;e<this.Ce.length;e++){var p;if(null!==(p=this.Ce[e])&&void 0!==p&&p.hasTexture(w))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(w,p,e){for(let r=0;r<this.Ce.length;r++){const I=this.Ce[r];if(I){if(I._storeEffectOnSubMeshes){if(!I.isReadyForSubMesh(w,p,e))return!1;continue}if(!I.isReady(w))return!1}}return!0}clone(w,p){const e=new f(w,this.iw());for(let r=0;r<this.Ce.length;r++){let I=null;const d=this.Ce[r];I=p&&d?d.clone(w+"-"+d.name):this.Ce[r],e.Ce.push(I)}return e}serialize(){const w={};w.name=this.name,w.id=this.id,w.uniqueId=this.uniqueId,I.b&&(w.tags=I.b.GetTags(this)),w.materialsUniqueIds=[],w.materials=[];for(let p=0;p<this.Ce.length;p++){const e=this.Ce[p];e?(w.materialsUniqueIds.push(e.uniqueId),w.materials.push(e.id)):(w.materialsUniqueIds.push(null),w.materials.push(null))}return w}dispose(w,p,e){const r=this.iw();if(!r)return;if(e)for(let d=0;d<this.Ce.length;d++){const e=this.Ce[d];e&&e.dispose(w,p)}const I=r.multiMaterials.indexOf(this);I>=0&&r.multiMaterials.splice(I,1),super.dispose(w,p)}static ParseMultiMaterial(w,p){const e=new f(w.name,p);if(e.id=w.id,e._loadedUniqueId=w.uniqueId,I.b&&I.b.AddTagsTo(e,w.tags),w.materialsUniqueIds)e._waitingSubMaterialsUniqueIds=w.materialsUniqueIds;else for(const r of w.materials)e.Ce.push(p.getLastMaterialById(r));return e}}(0,d.d)("BABYLON.MultiMaterial",f)},11661:(w,p,e)=>{e.d(p,{e:()=>r});class r{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(w){w.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(w){}bindForSubMesh(w,p,e,r,I){if(p.prePassRenderer&&p.prePassRenderer.enabled&&p.prePassRenderer.currentRTisSceneRT&&(-1!==p.prePassRenderer.getIndex(2)||-1!==p.prePassRenderer.getIndex(11))){this.previousWorldMatrices[e.uniqueId]||(this.previousWorldMatrices[e.uniqueId]=r.clone()),this.previousViewProjection||(this.previousViewProjection=p.getTransformMatrix().clone(),this.currentViewProjection=p.getTransformMatrix().clone());const I=p.getEngine();this.currentViewProjection.updateFlag!==p.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=I.frameId,this.previousViewProjection.X(this.currentViewProjection),this.currentViewProjection.X(p.getTransformMatrix())):this._lastUpdateFrameId!==I.frameId&&(this._lastUpdateFrameId=I.frameId,this.previousViewProjection.X(this.currentViewProjection)),w.setMatrix("previousWorld",this.previousWorldMatrices[e.uniqueId]),w.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[e.uniqueId]=r.clone()}}}},11670:(w,p,e)=>{e.d(p,{b:()=>d});var r=e(11023),I=e(11203);class d extends I.b{constructor(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(w,p,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new r.b,this._storeEffectOnSubMeshes=e}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(w,p){return!!w&&(!this._storeEffectOnSubMeshes||(!w.oe||0===w.oe.length||this.isReadyForSubMesh(w,w.oe[0],p)))}_isReadyForSubMesh(w){const p=w.materialDefines;return!(this.checkReadyOnEveryCall||!w.effect||!p||p._renderId!==this.iw().getRenderId())}bindOnlyWorldMatrix(w){this._activeEffect.setMatrix("world",w)}bindOnlyNormalMatrix(w){this._activeEffect.setMatrix("normalMatrix",w)}bind(w,p){p&&this.bindForSubMesh(w,p,p.oe[0])}_afterBind(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;super._afterBind(w,p,e),this.iw()._cachedEffect=p,e?e._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e._drawWrapper._forceRebindOnNextCall||w.isCachedMaterialInvalid(this,p,r)}dispose(w,p,e){this._activeEffect=void 0,super.dispose(w,p,e)}}},11739:(w,p,e)=>{e.d(p,{c:()=>c});var r=e(11301),I=e(11590),d=e(11023),f=e(11232),q=e(11511),E=e(11038),j=e(11692),X=e(11099),k=e(11670),m=e(11051),J=e(11320),K=e(11310);const y={effect:null,subMesh:null};class c extends k.b{constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(w,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new d.b,this._cachedWorldViewProjectionMatrix=new d.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=e,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","dp","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...r}}get shaderPath(){return this._shaderPath}set shaderPath(w){this._shaderPath=w}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(w){-1===this._options.uniforms.indexOf(w)&&this._options.uniforms.push(w)}setTexture(w,p){return-1===this._options.samplers.indexOf(w)&&this._options.samplers.push(w),this._textures[w]=p,this}removeTexture(w){delete this._textures[w]}setTextureArray(w,p){return-1===this._options.samplers.indexOf(w)&&this._options.samplers.push(w),this._checkUniform(w),this._textureArrays[w]=p,this}setExternalTexture(w,p){return-1===this._options.externalTextures.indexOf(w)&&this._options.externalTextures.push(w),this._externalTextures[w]=p,this}setFloat(w,p){return this._checkUniform(w),this._floats[w]=p,this}setInt(w,p){return this._checkUniform(w),this._ints[w]=p,this}setUInt(w,p){return this._checkUniform(w),this._uints[w]=p,this}setFloats(w,p){return this._checkUniform(w),this._floatsArrays[w]=p,this}setColor3(w,p){return this._checkUniform(w),this._colors3[w]=p,this}setColor3Array(w,p){return this._checkUniform(w),this._colors3Arrays[w]=p.reduce(((w,p)=>(w.push(p.r,p.g,p.b),w)),[]),this}setColor4(w,p){return this._checkUniform(w),this._colors4[w]=p,this}setColor4Array(w,p){return this._checkUniform(w),this._colors4Arrays[w]=p.reduce(((w,p)=>(w.push(p.r,p.g,p.b,p.a),w)),[]),this}setVector2(w,p){return this._checkUniform(w),this._vectors2[w]=p,this}setVector3(w,p){return this._checkUniform(w),this._vectors3[w]=p,this}setVector4(w,p){return this._checkUniform(w),this._vectors4[w]=p,this}setQuaternion(w,p){return this._checkUniform(w),this._quaternions[w]=p,this}setQuaternionArray(w,p){return this._checkUniform(w),this._quaternionsArrays[w]=p.reduce(((w,p)=>(p.toArray(w,w.length),w)),[]),this}setMatrix(w,p){return this._checkUniform(w),this._matrices[w]=p,this}setMatrices(w,p){this._checkUniform(w);const e=new Float32Array(16*p.length);for(let r=0;r<p.length;r++){p[r].copyToArray(e,16*r)}return this._matrixArrays[w]=e,this}setMatrix3x3(w,p){return this._checkUniform(w),this._matrices3x3[w]=p,this}setMatrix2x2(w,p){return this._checkUniform(w),this._matrices2x2[w]=p,this}setArray2(w,p){return this._checkUniform(w),this._vectors2Arrays[w]=p,this}setArray3(w,p){return this._checkUniform(w),this._vectors3Arrays[w]=p,this}setArray4(w,p){return this._checkUniform(w),this._vectors4Arrays[w]=p,this}setUniformBuffer(w,p){return-1===this._options.uniformBuffers.indexOf(w)&&this._options.uniformBuffers.push(w),this._uniformBuffers[w]=p,this}setTextureSampler(w,p){return-1===this._options.samplerObjects.indexOf(w)&&this._options.samplerObjects.push(w),this._textureSamplers[w]=p,this}setStorageBuffer(w,p){return-1===this._options.storageBuffers.indexOf(w)&&this._options.storageBuffers.push(w),this._storageBuffers[w]=p,this}setDefine(w,p){const e=w.trimEnd()+" ",r=this.options.defines.findIndex((p=>p===w||p.startsWith(e)));return r>=0&&this.options.defines.splice(r,1),("boolean"!==typeof p||p)&&this.options.defines.push(e+p),this}isReadyForSubMesh(w,p,e){return this.isReady(w,e,p)}isReady(w,p,e){var r;const d=e&&this._storeEffectOnSubMeshes;if(this.isFrozen){const w=d?e._drawWrapper:this._drawWrapper;if(w.effect&&w._wasPreviouslyReady&&w._wasPreviouslyUsingInstances===p)return!0}const q=this.iw(),E=q.getEngine(),X=[],k=[];let m=null,c=this._shaderPath,s=this._options.uniforms,O=this._options.uniformBuffers,a=this._options.samplers;E.getCaps().multiview&&q.activeCamera&&q.activeCamera.outputRenderTarget&&q.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,X.push("#define MULTIVIEW"),-1!==s.indexOf("viewProjection")&&-1===s.indexOf("viewProjectionR")&&s.push("viewProjectionR"));for(let I=0;I<this._options.defines.length;I++){const w=0===this._options.defines[I].indexOf("#define")?this._options.defines[I]:`#define ${this._options.defines[I]}`;X.push(w)}for(let I=0;I<this._options.attributes.length;I++)k.push(this._options.attributes[I]);if(w&&w.isVerticesDataPresent(f.e.ColorKind)&&(-1===k.indexOf(f.e.ColorKind)&&k.push(f.e.ColorKind),X.push("#define VERTEXCOLOR")),p&&(X.push("#define INSTANCES"),(0,K.Z)(k,this._materialHelperNeedsPreviousMatrices),null!==w&&void 0!==w&&w.hasThinInstances&&(X.push("#define THIN_INSTANCES"),w&&w.isVerticesDataPresent(f.e.ColorInstanceKind)&&(k.push(f.e.ColorInstanceKind),X.push("#define INSTANCESCOLOR")))),w&&w.useBones&&w.computeBonesUsingShaders&&w.skeleton){k.push(f.e.MatricesIndicesKind),k.push(f.e.MatricesWeightsKind),w.numBoneInfluencers>4&&(k.push(f.e.MatricesIndicesExtraKind),k.push(f.e.MatricesWeightsExtraKind));const p=w.skeleton;X.push("#define NUM_BONE_INFLUENCERS "+w.numBoneInfluencers),m=new j.c,m.addCPUSkinningFallback(0,w),p.isUsingTextureForMatrices?(X.push("#define BONETEXTURE"),-1===s.indexOf("boneTextureWidth")&&s.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(X.push("#define BonesPerMesh "+(p.bones.length+1)),-1===s.indexOf("mBones")&&s.push("mBones"))}else X.push("#define NUM_BONE_INFLUENCERS 0");let A=0;const z=w?w.morphTargetManager:null;if(z){const p=-1!==X.indexOf("#define UV1"),e=-1!==X.indexOf("#define UV2"),r=-1!==X.indexOf("#define TANGENT"),I=-1!==X.indexOf("#define NORMAL"),d=-1!==X.indexOf("#define VERTEXCOLOR");A=(0,K.I)(z,X,k,w,!0,I,r,p,e,d),z.isUsingTextureForTargets&&(-1===s.indexOf("morphTargetTextureIndices")&&s.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),A>0&&(s=s.slice(),s.push("morphTargetInfluences"),s.push("morphTargetCount"),s.push("morphTargetTextureInfo"),s.push("morphTargetTextureIndices"))}else X.push("#define NUM_MORPH_INFLUENCERS 0");if(w){const p=w.bakedVertexAnimationManager;p&&p.isEnabled&&(X.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===s.indexOf("bakedVertexAnimationSettings")&&s.push("bakedVertexAnimationSettings"),-1===s.indexOf("bakedVertexAnimationTextureSizeInverted")&&s.push("bakedVertexAnimationTextureSizeInverted"),-1===s.indexOf("bakedVertexAnimationTime")&&s.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,K.v)(k,w,X)}for(const I in this._textures)if(!this._textures[I].isReady())return!1;w&&this.needAlphaTestingForMesh(w)&&X.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,J.b)(s),(0,J.l)(this,q,X)),q.fogEnabled&&null!==w&&void 0!==w&&w.applyFog&&q.fogMode!==I.c.FOGMODE_NONE&&(X.push("#define FOG"),-1===s.indexOf("view")&&s.push("view"),-1===s.indexOf("vFogInfos")&&s.push("vFogInfos"),-1===s.indexOf("vFogColor")&&s.push("vFogColor")),this._useLogarithmicDepth&&(X.push("#define LOGARITHMICDEPTH"),-1===s.indexOf("logarithmicDepthConstant")&&s.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(s=s.slice(),O=O.slice(),a=a.slice(),c=this.customShaderNameResolve(this.name,s,O,a,X,k));const M=d?e._getDrawWrapper(void 0,!0):this._drawWrapper,i=(null===M||void 0===M?void 0:M.effect)??null,t=(null===M||void 0===M?void 0:M.defines)??null,n=X.join("\n");let l=i;return t!==n&&(l=E.createEffect(c,{attributes:k,uniformsNames:s,uniformBuffersNames:O,samplers:a,defines:n,fallbacks:m,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:A},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},E),d?e.setEffect(l,n,this._materialContext):M&&M.setEffect(l,n),this._onEffectCreatedObservable&&(y.effect=l,y.subMesh=e??(null===w||void 0===w?void 0:w.oe[0])??null,this._onEffectCreatedObservable.notifyObservers(y))),M._wasPreviouslyUsingInstances=!!p,!(null===(r=l)||void 0===r||!r.isReady())&&(i!==l&&q.resetCachedMaterial(),M._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(w,p){const e=p??this.getEffect();if(!e)return;const r=this._options.uniforms;-1!==r.indexOf("world")&&e.setMatrix("world",w);const I=this.iw();-1!==r.indexOf("worldView")&&(w.multiplyToRef(I.getViewMatrix(),this._cachedWorldViewMatrix),e.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==r.indexOf("worldViewProjection")&&(w.multiplyToRef(I.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),e.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==r.indexOf("view")&&e.setMatrix("view",I.getViewMatrix())}bindForSubMesh(w,p,e){var r;this.bind(w,p,null===(r=e._drawWrapperOverride)||void 0===r?void 0:r.effect,e)}bind(w,p,e,r){const I=r&&this._storeEffectOnSubMeshes,d=e??(I?r.effect:this.getEffect());if(!d)return;const f=this.iw();this._activeEffect=d,this.bindOnlyWorldMatrix(w,e);const q=this._options.uniformBuffers;let E=!1;if(d&&q&&q.length>0&&f.getEngine().supportsUniformBuffers)for(let k=0;k<q.length;++k){switch(q[k]){case"Mesh":p&&(p.getMeshUniformBuffer().bindToEffect(d,"Mesh"),p.transferToEffect(w));break;case"Scene":(0,K.n)(d,f.getSceneUniformBuffer()),f.finalizeSceneUbo(),E=!0}}const j=p&&I?this._mustRebind(f,d,r,p.visibility):f.getCachedMaterial()!==this;if(d&&j){let w;for(w in E||-1===this._options.uniforms.indexOf("view")||d.setMatrix("view",f.getViewMatrix()),E||-1===this._options.uniforms.indexOf("projection")||d.setMatrix("projection",f.getProjectionMatrix()),E||-1===this._options.uniforms.indexOf("viewProjection")||(d.setMatrix("viewProjection",f.getTransformMatrix()),this._multiview&&d.setMatrix("viewProjectionR",f._transformMatrixR)),f.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&d.setVector3("cameraPosition",f.activeCamera.globalPosition),(0,K.d)(p,d),(0,J.e)(d,this,f),this._useLogarithmicDepth&&(0,K.i)(I?r.materialDefines:d.defines,d,f),p&&(0,K.e)(f,p,d),this._textures)d.setTexture(w,this._textures[w]);for(w in this._textureArrays)d.setTextureArray(w,this._textureArrays[w]);for(w in this._ints)d.setInt(w,this._ints[w]);for(w in this._uints)d.setUInt(w,this._uints[w]);for(w in this._floats)d.setFloat(w,this._floats[w]);for(w in this._floatsArrays)d.setArray(w,this._floatsArrays[w]);for(w in this._colors3)d.setColor3(w,this._colors3[w]);for(w in this._colors3Arrays)d.setArray3(w,this._colors3Arrays[w]);for(w in this._colors4){const p=this._colors4[w];d.setFloat4(w,p.r,p.g,p.b,p.a)}for(w in this._colors4Arrays)d.setArray4(w,this._colors4Arrays[w]);for(w in this._vectors2)d.setVector2(w,this._vectors2[w]);for(w in this._vectors3)d.setVector3(w,this._vectors3[w]);for(w in this._vectors4)d.setVector4(w,this._vectors4[w]);for(w in this._quaternions)d.setQuaternion(w,this._quaternions[w]);for(w in this._matrices)d.setMatrix(w,this._matrices[w]);for(w in this._matrixArrays)d.setMatrices(w,this._matrixArrays[w]);for(w in this._matrices3x3)d.setMatrix3x3(w,this._matrices3x3[w]);for(w in this._matrices2x2)d.setMatrix2x2(w,this._matrices2x2[w]);for(w in this._vectors2Arrays)d.setArray2(w,this._vectors2Arrays[w]);for(w in this._vectors3Arrays)d.setArray3(w,this._vectors3Arrays[w]);for(w in this._vectors4Arrays)d.setArray4(w,this._vectors4Arrays[w]);for(w in this._quaternionsArrays)d.setArray4(w,this._quaternionsArrays[w]);for(w in this._uniformBuffers){const p=this._uniformBuffers[w].getBuffer();p&&d.bindUniformBuffer(p,w)}const e=f.getEngine(),q=e.setExternalTexture;if(q)for(w in this._externalTextures)q.call(e,w,this._externalTextures[w]);const j=e.setTextureSampler;if(j)for(w in this._textureSamplers)j.call(e,w,this._textureSamplers[w]);const X=e.setStorageBuffer;if(X)for(w in this._storageBuffers)X.call(e,w,this._storageBuffers[w])}if(d&&p&&(j||!this.isFrozen)){(0,K.j)(p,d),p.morphTargetManager&&p.morphTargetManager.isUsingTextureForTargets&&p.morphTargetManager._bind(d);const w=p.bakedVertexAnimationManager;if(w&&w.isEnabled){var X;const w=I?r._drawWrapper:this._drawWrapper;null===(X=p.bakedVertexAnimationManager)||void 0===X||X.bind(d,!!w._wasPreviouslyUsingInstances)}}this._afterBind(p,d,r)}getActiveTextures(){const w=super.getActiveTextures();for(const p in this._textures)w.push(this._textures[p]);for(const p in this._textureArrays){const e=this._textureArrays[p];for(let p=0;p<e.length;p++)w.push(e[p])}return w}hasTexture(w){if(super.hasTexture(w))return!0;for(const p in this._textures)if(this._textures[p]===w)return!0;for(const p in this._textureArrays){const e=this._textureArrays[p];for(let p=0;p<e.length;p++)if(e[p]===w)return!0}return!1}clone(w){const p=r.e.Clone((()=>new c(w,this.iw(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);p.name=w,p.id=w,"object"===typeof p._shaderPath&&(p._shaderPath={...p._shaderPath}),this._options={...this._options};const e=Object.keys(this._options);for(const r of e){const w=this._options[r];Array.isArray(w)&&(this._options[r]=w.slice(0))}this.stencil.copyTo(p.stencil);for(const r in this._textures)p.setTexture(r,this._textures[r]);for(const r in this._textureArrays)p.setTextureArray(r,this._textureArrays[r]);for(const r in this._externalTextures)p.setExternalTexture(r,this._externalTextures[r]);for(const r in this._ints)p.setInt(r,this._ints[r]);for(const r in this._uints)p.setUInt(r,this._uints[r]);for(const r in this._floats)p.setFloat(r,this._floats[r]);for(const r in this._floatsArrays)p.setFloats(r,this._floatsArrays[r]);for(const r in this._colors3)p.setColor3(r,this._colors3[r]);for(const r in this._colors3Arrays)p._colors3Arrays[r]=this._colors3Arrays[r];for(const r in this._colors4)p.setColor4(r,this._colors4[r]);for(const r in this._colors4Arrays)p._colors4Arrays[r]=this._colors4Arrays[r];for(const r in this._vectors2)p.setVector2(r,this._vectors2[r]);for(const r in this._vectors3)p.setVector3(r,this._vectors3[r]);for(const r in this._vectors4)p.setVector4(r,this._vectors4[r]);for(const r in this._quaternions)p.setQuaternion(r,this._quaternions[r]);for(const r in this._quaternionsArrays)p._quaternionsArrays[r]=this._quaternionsArrays[r];for(const r in this._matrices)p.setMatrix(r,this._matrices[r]);for(const r in this._matrixArrays)p._matrixArrays[r]=this._matrixArrays[r].slice();for(const r in this._matrices3x3)p.setMatrix3x3(r,this._matrices3x3[r]);for(const r in this._matrices2x2)p.setMatrix2x2(r,this._matrices2x2[r]);for(const r in this._vectors2Arrays)p.setArray2(r,this._vectors2Arrays[r]);for(const r in this._vectors3Arrays)p.setArray3(r,this._vectors3Arrays[r]);for(const r in this._vectors4Arrays)p.setArray4(r,this._vectors4Arrays[r]);for(const r in this._uniformBuffers)p.setUniformBuffer(r,this._uniformBuffers[r]);for(const r in this._textureSamplers)p.setTextureSampler(r,this._textureSamplers[r]);for(const r in this._storageBuffers)p.setStorageBuffer(r,this._storageBuffers[r]);return p}dispose(w,p,e){if(p){let w;for(w in this._textures)this._textures[w].dispose();for(w in this._textureArrays){const p=this._textureArrays[w];for(let w=0;w<p.length;w++)p[w].dispose()}}this._textures={},super.dispose(w,p,e)}serialize(){const w=r.e.Serialize(this);let p;for(p in w.customType="BABYLON.ShaderMaterial",w.uniqueId=this.uniqueId,w.options=this._options,w.shaderPath=this._shaderPath,w.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,w.stencil=this.stencil.serialize(),w.textures={},this._textures)w.textures[p]=this._textures[p].serialize();for(p in w.textureArrays={},this._textureArrays){w.textureArrays[p]=[];const e=this._textureArrays[p];for(let r=0;r<e.length;r++)w.textureArrays[p].push(e[r].serialize())}for(p in w.ints={},this._ints)w.ints[p]=this._ints[p];for(p in w.uints={},this._uints)w.uints[p]=this._uints[p];for(p in w.floats={},this._floats)w.floats[p]=this._floats[p];for(p in w.floatsArrays={},this._floatsArrays)w.floatsArrays[p]=this._floatsArrays[p];for(p in w.colors3={},this._colors3){const e=this._colors3[p];w.colors3[p]=[e.r,e.g,e.b]}for(p in w.colors3Arrays={},this._colors3Arrays)w.colors3Arrays[p]=this._colors3Arrays[p];for(p in w.colors4={},this._colors4){const e=this._colors4[p];w.colors4[p]=[e.r,e.g,e.b,e.a]}for(p in w.colors4Arrays={},this._colors4Arrays)w.colors4Arrays[p]=this._colors4Arrays[p];for(p in w.vectors2={},this._vectors2){const e=this._vectors2[p];w.vectors2[p]=[e.x,e.y]}for(p in w.vectors3={},this._vectors3){const e=this._vectors3[p];w.vectors3[p]=[e.x,e.y,e.z]}for(p in w.vectors4={},this._vectors4){const e=this._vectors4[p];w.vectors4[p]=[e.x,e.y,e.z,e.w]}for(p in w.quaternions={},this._quaternions)w.quaternions[p]=this._quaternions[p].ze();for(p in w.matrices={},this._matrices)w.matrices[p]=this._matrices[p].ze();for(p in w.matrixArray={},this._matrixArrays)w.matrixArray[p]=this._matrixArrays[p];for(p in w.matrices3x3={},this._matrices3x3)w.matrices3x3[p]=this._matrices3x3[p];for(p in w.matrices2x2={},this._matrices2x2)w.matrices2x2[p]=this._matrices2x2[p];for(p in w.vectors2Arrays={},this._vectors2Arrays)w.vectors2Arrays[p]=this._vectors2Arrays[p];for(p in w.vectors3Arrays={},this._vectors3Arrays)w.vectors3Arrays[p]=this._vectors3Arrays[p];for(p in w.vectors4Arrays={},this._vectors4Arrays)w.vectors4Arrays[p]=this._vectors4Arrays[p];for(p in w.quaternionsArrays={},this._quaternionsArrays)w.quaternionsArrays[p]=this._quaternionsArrays[p];return w}static Parse(w,p,e){const I=r.e.Parse((()=>new c(w.name,p,w.shaderPath,w.options,w.storeEffectOnSubMeshes)),w,p,e);let f;for(f in w.stencil&&I.stencil.parse(w.stencil,p,e),w.textures)I.setTexture(f,q.e.Parse(w.textures[f],p,e));for(f in w.textureArrays){const r=w.textureArrays[f],d=[];for(let w=0;w<r.length;w++)d.push(q.e.Parse(r[w],p,e));I.setTextureArray(f,d)}for(f in w.ints)I.setInt(f,w.ints[f]);for(f in w.uints)I.setUInt(f,w.uints[f]);for(f in w.floats)I.setFloat(f,w.floats[f]);for(f in w.floatsArrays)I.setFloats(f,w.floatsArrays[f]);for(f in w.colors3){const p=w.colors3[f];I.setColor3(f,{r:p[0],g:p[1],b:p[2]})}for(f in w.colors3Arrays){const p=w.colors3Arrays[f].reduce(((w,p,e)=>(e%3===0?w.push([p]):w[w.length-1].push(p),w)),[]).map((w=>({r:w[0],g:w[1],b:w[2]})));I.setColor3Array(f,p)}for(f in w.colors4){const p=w.colors4[f];I.setColor4(f,{r:p[0],g:p[1],b:p[2],a:p[3]})}for(f in w.colors4Arrays){const p=w.colors4Arrays[f].reduce(((w,p,e)=>(e%4===0?w.push([p]):w[w.length-1].push(p),w)),[]).map((w=>({r:w[0],g:w[1],b:w[2],a:w[3]})));I.setColor4Array(f,p)}for(f in w.vectors2){const p=w.vectors2[f];I.setVector2(f,{x:p[0],y:p[1]})}for(f in w.vectors3){const p=w.vectors3[f];I.setVector3(f,{x:p[0],y:p[1],z:p[2]})}for(f in w.vectors4){const p=w.vectors4[f];I.setVector4(f,{x:p[0],y:p[1],z:p[2],w:p[3]})}for(f in w.quaternions)I.setQuaternion(f,d.c.Ve(w.quaternions[f]));for(f in w.matrices)I.setMatrix(f,d.b.Ve(w.matrices[f]));for(f in w.matrixArray)I._matrixArrays[f]=new Float32Array(w.matrixArray[f]);for(f in w.matrices3x3)I.setMatrix3x3(f,w.matrices3x3[f]);for(f in w.matrices2x2)I.setMatrix2x2(f,w.matrices2x2[f]);for(f in w.vectors2Arrays)I.setArray2(f,w.vectors2Arrays[f]);for(f in w.vectors3Arrays)I.setArray3(f,w.vectors3Arrays[f]);for(f in w.vectors4Arrays)I.setArray4(f,w.vectors4Arrays[f]);for(f in w.quaternionsArrays)I.setArray4(f,w.quaternionsArrays[f]);return I}static async ParseFromFileAsync(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((I,d)=>{const f=new X.b;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const p=JSON.parse(f.responseText),d=this.Parse(p,e||m.d.LastCreatedScene,r);w&&(d.name=w),I(d)}else d("Unable to load the ShaderMaterial")})),f.open("GET",p),f.send()}))}static async ParseFromSnippetAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((r,I)=>{const d=new X.b;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const I=JSON.parse(JSON.parse(d.responseText).jsonPayload),f=JSON.parse(I.shaderMaterial),q=this.Parse(f,p||m.d.LastCreatedScene,e);q.snippetId=w,r(q)}else I("Unable to load the snippet "+w)})),d.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),d.send()}))}}c.SnippetUrl="https://snippet.babylonjs.com",c.CreateFromSnippetAsync=c.ParseFromSnippetAsync,(0,E.d)("BABYLON.ShaderMaterial",c)},11710:(w,p,e)=>{e.d(p,{c:()=>n});var r=e(11207),I=e(11213),d=e(11376),f=e(11590),q=e(11308),E=e(11232),j=e(11661),X=e(11593),k=e(11203),m=e(11648),J=e(11670),K=e(11511),y=e(11038),c=e(11674),s=e(11692),O=e(11698),a=e(11320),A=e(11310),z=e(11301),M=e(11706);const i={effect:null,subMesh:null};class t extends m.b{constructor(w){super(w),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(w){const p=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const e of p)this[e]=e===w}}class n extends J.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(w){this._attachImageProcessingConfiguration(w),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(w){w!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=w||this.iw().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(w){this.imageProcessingConfiguration.colorCurvesEnabled=w}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(w){this.imageProcessingConfiguration.colorGradingEnabled=w}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(w){this._imageProcessingConfiguration.toneMappingEnabled=w}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(w){this._imageProcessingConfiguration.exposure=w}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(w){this._imageProcessingConfiguration.contrast=w}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(w){this._imageProcessingConfiguration.colorGradingTexture=w}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(w){this._imageProcessingConfiguration.colorCurves=w}get canRenderToMRT(){return!0}constructor(w,p){super(w,p,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||n.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new q.b(0,0,0),this.diffuseColor=new q.b(1,1,1),this.specularColor=new q.b(1,1,1),this.emissiveColor=new q.b(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new d.e(16),this._globalAmbientColor=new q.b(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new O.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new j.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"hr"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===k.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.ie&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==k.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.ie||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(w,p){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const I=p._drawWrapper;if(I.effect&&this.isFrozen&&I._wasPreviouslyReady&&I._wasPreviouslyUsingInstances===r)return!0;p.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),p.materialDefines=new t(this._eventInfo.defineNames));const d=this.iw(),f=p.materialDefines;if(this._isReadyForSubMesh(p))return!0;const q=d.getEngine();f._needNormals=(0,A.L)(d,w,f,!0,this._maxSimultaneousLights,this._disableLighting),(0,A.P)(d,f);const k=this.needAlphaBlendingForMesh(w)&&this.iw().useOrderIndependentTransparency;if((0,A.W)(d,f,this.canRenderToMRT&&!k),(0,A.T)(d,f,k),M.c.PrepareDefines(q.currentRenderPassId,w,f),f._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,f._needUVs=!1;for(let w=1;w<=6;++w)f["MAINUV"+w]=!1;if(d.texturesEnabled){if(f.DIFFUSEDIRECTUV=0,f.BUMPDIRECTUV=0,f.AMBIENTDIRECTUV=0,f.OPACITYDIRECTUV=0,f.EMISSIVEDIRECTUV=0,f.SPECULARDIRECTUV=0,f.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,A.N)(this._diffuseTexture,f,"DIFFUSE")}else f.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,A.N)(this._ambientTexture,f,"AMBIENT")}else f.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,A.N)(this._opacityTexture,f,"OPACITY"),f.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else f.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(f._needNormals=!0,f.REFLECTION=!0,f.ROUGHNESS=this._roughness>0,f.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,f.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===K.e.INVCUBIC_MODE,f.REFLECTIONMAP_3D=this._reflectionTexture.isCube,f.REFLECTIONMAP_OPPOSITEZ=f.REFLECTIONMAP_3D&&this.iw().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,f.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case K.e.EXPLICIT_MODE:f.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case K.e.PLANAR_MODE:f.setReflectionMode("REFLECTIONMAP_PLANAR");break;case K.e.PROJECTION_MODE:f.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case K.e.SKYBOX_MODE:f.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case K.e.SPHERICAL_MODE:f.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case K.e.EQUIRECTANGULAR_MODE:f.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case K.e.FIXED_EQUIRECTANGULAR_MODE:f.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case K.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:f.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case K.e.CUBIC_MODE:case K.e.INVCUBIC_MODE:default:f.setReflectionMode("REFLECTIONMAP_CUBIC")}f.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else f.REFLECTION=!1,f.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,A.N)(this._emissiveTexture,f,"EMISSIVE")}else f.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,A.N)(this._lightmapTexture,f,"LIGHTMAP"),f.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,f.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else f.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,A.N)(this._specularTexture,f,"SPECULAR"),f.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else f.SPECULAR=!1;if(d.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,A.N)(this._bumpTexture,f,"BUMP"),f.PARALLAX=this._useParallax,f.PARALLAX_RHS=d.useRightHandedSystem,f.PARALLAXOCCLUSION=this._useParallaxOcclusion,f.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else f.BUMP=!1,f.PARALLAX=!1,f.PARALLAX_RHS=!1,f.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;f._needUVs=!0,f.REFRACTION=!0,f.REFRACTIONMAP_3D=this._refractionTexture.isCube,f.RGBDREFRACTION=this._refractionTexture.isRGBD,f.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else f.REFRACTION=!1;f.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else f.DIFFUSE=!1,f.AMBIENT=!1,f.OPACITY=!1,f.REFLECTION=!1,f.EMISSIVE=!1,f.LIGHTMAP=!1,f.BUMP=!1,f.REFRACTION=!1;f.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),f.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,f.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,f.SPECULAROVERALPHA=this._useSpecularOverAlpha,f.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,f.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,f.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(w)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=f,this._eventInfo.subMesh=p,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(f._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(f),f.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,f.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(f._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(f.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,f.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,f.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,f.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,f.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,f.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,f._needNormals=!0,f.FRESNEL=!0):f.FRESNEL=!1),f.AREALIGHTUSED)for(let e=0;e<w.lightSources.length;e++)if(!w.lightSources[e]._isReady())return!1;(0,A.O)(w,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(w),f,this._applyDecalMapAfterDetailMap),(0,A.K)(d,q,this,f,r,null,p.getRenderingMesh().hasThinInstances),this._eventInfo.defines=f,this._eventInfo.mesh=w,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,A.J)(w,f,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let m=!1;if(f.isDirty){const r=f._areLightsDisposed;f.markAsProcessed();const I=new s.c;f.REFLECTION&&I.addFallback(0,"REFLECTION"),f.SPECULAR&&I.addFallback(0,"SPECULAR"),f.BUMP&&I.addFallback(0,"BUMP"),f.PARALLAX&&I.addFallback(1,"PARALLAX"),f.PARALLAX_RHS&&I.addFallback(1,"PARALLAX_RHS"),f.PARALLAXOCCLUSION&&I.addFallback(0,"PARALLAXOCCLUSION"),f.SPECULAROVERALPHA&&I.addFallback(0,"SPECULAROVERALPHA"),f.FOG&&I.addFallback(1,"FOG"),f.POINTSIZE&&I.addFallback(0,"POINTSIZE"),f.LOGARITHMICDEPTH&&I.addFallback(0,"LOGARITHMICDEPTH"),(0,A.s)(f,I,this._maxSimultaneousLights),f.SPECULARTERM&&I.addFallback(0,"SPECULARTERM"),f.DIFFUSEFRESNEL&&I.addFallback(1,"DIFFUSEFRESNEL"),f.OPACITYFRESNEL&&I.addFallback(2,"OPACITYFRESNEL"),f.REFLECTIONFRESNEL&&I.addFallback(3,"REFLECTIONFRESNEL"),f.EMISSIVEFRESNEL&&I.addFallback(4,"EMISSIVEFRESNEL"),f.FRESNEL&&I.addFallback(4,"FRESNEL"),f.MULTIVIEW&&I.addFallback(0,"MULTIVIEW");const k=[E.e.PositionKind];f.NORMAL&&k.push(E.e.NormalKind),f.TANGENT&&k.push(E.e.TangentKind);for(let w=1;w<=6;++w)f["UV"+w]&&k.push(`uv${1===w?"":w}`);f.VERTEXCOLOR&&k.push(E.e.ColorKind),(0,A.z)(k,w,f,I),(0,A.C)(k,f),(0,A.E)(k,w,f),(0,A.v)(k,w,f);let J="default";const K=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],y=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],c=["Material","Scene","Mesh"],O={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:f.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=I,this._eventInfo.fallbackRank=0,this._eventInfo.defines=f,this._eventInfo.uniforms=K,this._eventInfo.attributes=k,this._eventInfo.samplers=y,this._eventInfo.uniformBuffersNames=c,this._eventInfo.customCode=void 0,this._eventInfo.mesh=w,this._eventInfo.indexParameters=O,this._callbackPluginEventGeneric(128,this._eventInfo),M.c.AddUniformsAndSamplers(K,y),j.e.AddUniforms(K),j.e.AddSamplers(y),X.e&&(X.e.PrepareUniforms(K,f),X.e.PrepareSamplers(y,f)),(0,A.X)({uniformsNames:K,uniformBuffersNames:c,samplers:y,defines:f,maxSimultaneousLights:this._maxSimultaneousLights}),(0,a.b)(K);const z={};this.customShaderNameResolve&&(J=this.customShaderNameResolve(J,K,c,y,f,k,z));const t=f.toString(),n=p.effect;let l=d.getEngine().createEffect(J,{attributes:k,uniformsNames:K,uniformBuffersNames:c,samplers:y,defines:t,fallbacks:I,onCompiled:this.onCompiled,onError:this.onError,indexParameters:O,processFinalCode:z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:f.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([e.e(20),e.e(51)]).then(e.bind(e,14264)),Promise.all([e.e(18),e.e(52)]).then(e.bind(e,14275))]):await Promise.all([Promise.all([e.e(13),e.e(53)]).then(e.bind(e,14278)),Promise.all([e.e(12),e.e(54)]).then(e.bind(e,14284))]),this._shadersLoaded=!0}},q);if(this._eventInfo.customCode=void 0,l)if(this._onEffectCreatedObservable&&(i.effect=l,i.subMesh=p,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&n&&!l.isReady()){if(l=n,f.markAsUnprocessed(),m=this.isFrozen,r)return f._areLightsDisposed=!0,!1}else d.resetCachedMaterial(),p.setEffect(l,f,this._materialContext)}return!(!p.effect||!p.effect.isReady())&&(f._renderId=d.getRenderId(),I._wasPreviouslyReady=!m,I._wasPreviouslyUsingInstances=r,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const w=this._uniformBuffer;w.addUniform("diffuseLeftColor",4),w.addUniform("diffuseRightColor",4),w.addUniform("opacityParts",4),w.addUniform("reflectionLeftColor",4),w.addUniform("reflectionRightColor",4),w.addUniform("refractionLeftColor",4),w.addUniform("refractionRightColor",4),w.addUniform("emissiveLeftColor",4),w.addUniform("emissiveRightColor",4),w.addUniform("vDiffuseInfos",2),w.addUniform("vAmbientInfos",2),w.addUniform("vOpacityInfos",2),w.addUniform("vReflectionInfos",2),w.addUniform("vReflectionPosition",3),w.addUniform("vReflectionSize",3),w.addUniform("vEmissiveInfos",2),w.addUniform("vLightmapInfos",2),w.addUniform("vSpecularInfos",2),w.addUniform("vBumpInfos",3),w.addUniform("diffuseMatrix",16),w.addUniform("ambientMatrix",16),w.addUniform("opacityMatrix",16),w.addUniform("reflectionMatrix",16),w.addUniform("emissiveMatrix",16),w.addUniform("lightmapMatrix",16),w.addUniform("specularMatrix",16),w.addUniform("bumpMatrix",16),w.addUniform("vTangentSpaceParams",2),w.addUniform("pointSize",1),w.addUniform("alphaCutOff",1),w.addUniform("refractionMatrix",16),w.addUniform("vRefractionInfos",4),w.addUniform("vRefractionPosition",3),w.addUniform("vRefractionSize",3),w.addUniform("vSpecularColor",4),w.addUniform("vEmissiveColor",3),w.addUniform("vDiffuseColor",4),w.addUniform("vAmbientColor",3),w.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(w,p,e){const r=this.iw(),I=e.materialDefines;if(!I)return;const d=e.effect;if(!d)return;this._activeEffect=d,p.getMeshUniformBuffer().bindToEffect(d,"Mesh"),p.transferToEffect(w),this._uniformBuffer.bindToEffect(d,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,p,w,this.isFrozen),M.c.Bind(r.getEngine().currentRenderPassId,this._activeEffect,p,w,this);const E=r.activeCamera;E?this._uniformBuffer.updateFloat4("cameraInfo",E.ge,E.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=e,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),I.OBJECTSPACE_NORMALMAP&&(w.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const j=this._mustRebind(r,d,e,p.visibility);(0,A.d)(p,d);const X=this._uniformBuffer;if(j){if(this.bindViewProjection(d),!X.useUbo||!this.isFrozen||!X.isSync||e._drawWrapper._forceRebindOnNextCall){if(n.FresnelEnabled&&I.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(X.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),X.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&X.updateColor4("opacityParts",new q.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(X.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),X.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(X.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),X.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(X.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),X.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(X.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,A.r)(this._diffuseTexture,X,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(X.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,A.r)(this._ambientTexture,X,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(X.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,A.r)(this._opacityTexture,X,"opacity")),this._hasAlphaChannel()&&X.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled){if(X.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),X.Ze("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const w=this._reflectionTexture;X.updateVector3("vReflectionPosition",w.boundingBoxPosition),X.updateVector3("vReflectionSize",w.boundingBoxSize)}}else X.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(X.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,A.r)(this._emissiveTexture,X,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(X.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,A.r)(this._lightmapTexture,X,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(X.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,A.r)(this._specularTexture,X,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(X.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,A.r)(this._bumpTexture,X,"bump"),r._mirroredCameraPosition?X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){let w=1;if(this._refractionTexture.isCube||(X.Ze("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(w=this._refractionTexture.depth)),X.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,w,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const w=this._refractionTexture;X.updateVector3("vRefractionPosition",w.boundingBoxPosition),X.updateVector3("vRefractionSize",w.boundingBoxSize)}}}this.pointsCloud&&X.updateFloat("pointSize",this.pointSize),X.updateColor4("vSpecularColor",this.specularColor,this.specularPower),X.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:q.b.BlackReadOnly),X.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),X.updateColor3("vAmbientColor",this._globalAmbientColor)}r.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&d.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&d.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&d.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?d.setTexture("reflectionCubeSampler",this._reflectionTexture):d.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&d.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&d.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&d.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&d.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?d.setTexture("refractionCubeSampler",this._refractionTexture):d.setTexture("refraction2DSampler",this._refractionTexture))),this.iw().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(p)&&this.iw().depthPeelingRenderer.bind(d),this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,a.e)(d,this,r),this.bindEyePosition(d)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(j||!this.isFrozen){var k;if(r.lightsEnabled&&!this._disableLighting&&(0,A.f)(r,p,d,I,this._maxSimultaneousLights),(r.fogEnabled&&p.applyFog&&r.fogMode!==f.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||p.receiveShadows||I.PREPASS)&&this.bindView(d),(0,A.e)(r,p,d),I.NUM_MORPH_INFLUENCERS&&(0,A.j)(p,d),I.BAKED_VERTEX_ANIMATION_TEXTURE)null===(k=p.bakedVertexAnimationManager)||void 0===k||k.bind(d,I.INSTANCES);this.useLogarithmicDepth&&(0,A.i)(I,d,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(p,this._activeEffect,e),X.update()}getAnimatables(){const w=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&w.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&w.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&w.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&w.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&w.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&w.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&w.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&w.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&w.push(this._refractionTexture),w}getActiveTextures(){const w=super.getActiveTextures();return this._diffuseTexture&&w.push(this._diffuseTexture),this._ambientTexture&&w.push(this._ambientTexture),this._opacityTexture&&w.push(this._opacityTexture),this._reflectionTexture&&w.push(this._reflectionTexture),this._emissiveTexture&&w.push(this._emissiveTexture),this._specularTexture&&w.push(this._specularTexture),this._bumpTexture&&w.push(this._bumpTexture),this._lightmapTexture&&w.push(this._lightmapTexture),this._refractionTexture&&w.push(this._refractionTexture),w}hasTexture(w){return!!super.hasTexture(w)||(this._diffuseTexture===w||(this._ambientTexture===w||(this._opacityTexture===w||(this._reflectionTexture===w||(this._emissiveTexture===w||(this._specularTexture===w||(this._bumpTexture===w||(this._lightmapTexture===w||this._refractionTexture===w))))))))}dispose(w,p){var e,r,I,d,f,q,E,j,X;p&&(null===(e=this._diffuseTexture)||void 0===e||e.dispose(),null===(r=this._ambientTexture)||void 0===r||r.dispose(),null===(I=this._opacityTexture)||void 0===I||I.dispose(),null===(d=this._reflectionTexture)||void 0===d||d.dispose(),null===(f=this._emissiveTexture)||void 0===f||f.dispose(),null===(q=this._specularTexture)||void 0===q||q.dispose(),null===(E=this._bumpTexture)||void 0===E||E.dispose(),null===(j=this._lightmapTexture)||void 0===j||j.dispose(),null===(X=this._refractionTexture)||void 0===X||X.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(w,p)}clone(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=z.e.Clone((()=>new n(w,this.iw())),this,{cloneTexturesOnlyOnce:p});return r.name=w,r.id=w,this.stencil.copyTo(r.stencil),this._clonePlugins(r,e),r}static Parse(w,p,e){const r=z.e.Parse((()=>new n(w.name,p)),w,p,e);return w.stencil&&r.stencil.parse(w.stencil,p,e),k.b._ParsePlugins(w,r,p,e),r}static get DiffuseTextureEnabled(){return c.d.DiffuseTextureEnabled}static set DiffuseTextureEnabled(w){c.d.DiffuseTextureEnabled=w}static get DetailTextureEnabled(){return c.d.DetailTextureEnabled}static set DetailTextureEnabled(w){c.d.DetailTextureEnabled=w}static get AmbientTextureEnabled(){return c.d.AmbientTextureEnabled}static set AmbientTextureEnabled(w){c.d.AmbientTextureEnabled=w}static get OpacityTextureEnabled(){return c.d.OpacityTextureEnabled}static set OpacityTextureEnabled(w){c.d.OpacityTextureEnabled=w}static get ReflectionTextureEnabled(){return c.d.ReflectionTextureEnabled}static set ReflectionTextureEnabled(w){c.d.ReflectionTextureEnabled=w}static get EmissiveTextureEnabled(){return c.d.EmissiveTextureEnabled}static set EmissiveTextureEnabled(w){c.d.EmissiveTextureEnabled=w}static get SpecularTextureEnabled(){return c.d.SpecularTextureEnabled}static set SpecularTextureEnabled(w){c.d.SpecularTextureEnabled=w}static get BumpTextureEnabled(){return c.d.BumpTextureEnabled}static set BumpTextureEnabled(w){c.d.BumpTextureEnabled=w}static get LightmapTextureEnabled(){return c.d.LightmapTextureEnabled}static set LightmapTextureEnabled(w){c.d.LightmapTextureEnabled=w}static get RefractionTextureEnabled(){return c.d.RefractionTextureEnabled}static set RefractionTextureEnabled(w){c.d.RefractionTextureEnabled=w}static get ColorGradingTextureEnabled(){return c.d.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(w){c.d.ColorGradingTextureEnabled=w}static get FresnelEnabled(){return c.d.FresnelEnabled}static set FresnelEnabled(w){c.d.FresnelEnabled=w}}n.ForceGLSL=!1,(0,r.c)([(0,I.C)("diffuseTexture")],n.prototype,"_diffuseTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"diffuseTexture",void 0),(0,r.c)([(0,I.C)("ambientTexture")],n.prototype,"_ambientTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTexture",void 0),(0,r.c)([(0,I.C)("opacityTexture")],n.prototype,"_opacityTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"opacityTexture",void 0),(0,r.c)([(0,I.C)("reflectionTexture")],n.prototype,"_reflectionTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionTexture",void 0),(0,r.c)([(0,I.C)("emissiveTexture")],n.prototype,"_emissiveTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveTexture",void 0),(0,r.c)([(0,I.C)("specularTexture")],n.prototype,"_specularTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"specularTexture",void 0),(0,r.c)([(0,I.C)("bumpTexture")],n.prototype,"_bumpTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,r.c)([(0,I.C)("lightmapTexture")],n.prototype,"_lightmapTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"lightmapTexture",void 0),(0,r.c)([(0,I.C)("refractionTexture")],n.prototype,"_refractionTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,r.c)([(0,I.j)("ambient")],n.prototype,"ambientColor",void 0),(0,r.c)([(0,I.j)("diffuse")],n.prototype,"diffuseColor",void 0),(0,r.c)([(0,I.j)("specular")],n.prototype,"specularColor",void 0),(0,r.c)([(0,I.j)("emissive")],n.prototype,"emissiveColor",void 0),(0,r.c)([(0,I.J)()],n.prototype,"specularPower",void 0),(0,r.c)([(0,I.J)("useAlphaFromDiffuseTexture")],n.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"useAlphaFromDiffuseTexture",void 0),(0,r.c)([(0,I.J)("useEmissiveAsIllumination")],n.prototype,"_useEmissiveAsIllumination",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useEmissiveAsIllumination",void 0),(0,r.c)([(0,I.J)("linkEmissiveWithDiffuse")],n.prototype,"_linkEmissiveWithDiffuse",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkEmissiveWithDiffuse",void 0),(0,r.c)([(0,I.J)("useSpecularOverAlpha")],n.prototype,"_useSpecularOverAlpha",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useSpecularOverAlpha",void 0),(0,r.c)([(0,I.J)("useReflectionOverAlpha")],n.prototype,"_useReflectionOverAlpha",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useReflectionOverAlpha",void 0),(0,r.c)([(0,I.J)("disableLighting")],n.prototype,"_disableLighting",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsLightsDirty")],n.prototype,"disableLighting",void 0),(0,r.c)([(0,I.J)("useObjectSpaceNormalMap")],n.prototype,"_useObjectSpaceNormalMap",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useObjectSpaceNormalMap",void 0),(0,r.c)([(0,I.J)("useParallax")],n.prototype,"_useParallax",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallax",void 0),(0,r.c)([(0,I.J)("useParallaxOcclusion")],n.prototype,"_useParallaxOcclusion",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallaxOcclusion",void 0),(0,r.c)([(0,I.J)()],n.prototype,"parallaxScaleBias",void 0),(0,r.c)([(0,I.J)("roughness")],n.prototype,"_roughness",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,r.c)([(0,I.J)()],n.prototype,"indexOfRefraction",void 0),(0,r.c)([(0,I.J)()],n.prototype,"invertRefractionY",void 0),(0,r.c)([(0,I.J)()],n.prototype,"alphaCutOff",void 0),(0,r.c)([(0,I.J)("useLightmapAsShadowmap")],n.prototype,"_useLightmapAsShadowmap",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLightmapAsShadowmap",void 0),(0,r.c)([(0,I.l)("diffuseFresnelParameters")],n.prototype,"_diffuseFresnelParameters",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"diffuseFresnelParameters",void 0),(0,r.c)([(0,I.l)("opacityFresnelParameters")],n.prototype,"_opacityFresnelParameters",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],n.prototype,"opacityFresnelParameters",void 0),(0,r.c)([(0,I.l)("reflectionFresnelParameters")],n.prototype,"_reflectionFresnelParameters",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"reflectionFresnelParameters",void 0),(0,r.c)([(0,I.l)("refractionFresnelParameters")],n.prototype,"_refractionFresnelParameters",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"refractionFresnelParameters",void 0),(0,r.c)([(0,I.l)("emissiveFresnelParameters")],n.prototype,"_emissiveFresnelParameters",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"emissiveFresnelParameters",void 0),(0,r.c)([(0,I.J)("useReflectionFresnelFromSpecular")],n.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"useReflectionFresnelFromSpecular",void 0),(0,r.c)([(0,I.J)("useGlossinessFromSpecularMapAlpha")],n.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,r.c)([(0,I.J)("maxSimultaneousLights")],n.prototype,"_maxSimultaneousLights",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsLightsDirty")],n.prototype,"maxSimultaneousLights",void 0),(0,r.c)([(0,I.J)("invertNormalMapX")],n.prototype,"_invertNormalMapX",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapX",void 0),(0,r.c)([(0,I.J)("invertNormalMapY")],n.prototype,"_invertNormalMapY",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapY",void 0),(0,r.c)([(0,I.J)("twoSidedLighting")],n.prototype,"_twoSidedLighting",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"twoSidedLighting",void 0),(0,r.c)([(0,I.J)("applyDecalMapAfterDetailMap")],n.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,r.c)([(0,I.e)("_markAllSubMeshesAsMiscDirty")],n.prototype,"applyDecalMapAfterDetailMap",void 0),(0,y.d)("BABYLON.StandardMaterial",n),f.c.DefaultMaterialFactory=w=>new n("default material",w)},11288:(w,p,e)=>{e.d(p,{d:()=>d});var r=e(11081),I=e(11071);class d{constructor(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=w,this._noUBO=!w.supportsUniformBuffers||I,this._dynamic=e,this._name=r??"no-name",this._data=p||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Ze=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Ze=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(w){let p;if(p=w<=2?w:4,this._uniformLocationPointer%p!==0){const w=this._uniformLocationPointer;this._uniformLocationPointer+=p-this._uniformLocationPointer%p;const e=this._uniformLocationPointer-w;for(let p=0;p<e;p++)this._data.push(0)}}addUniform(w,p){let e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[w]){if(r>0){if(p instanceof Array)throw"addUniform should not be use with Array in UBO: "+w;if(this._fillAlignment(4),this._uniformArraySizes[w]={strideSize:p,arraySize:r},16==p)p*=r;else{p=p*r+(4-p)*r}e=[];for(let w=0;w<p;w++)e.push(0)}else{if(p instanceof Array)e=p,p=e.length;else{e=[];for(let w=0;w<p;w++)e.push(0)}this._fillAlignment(p)}this._uniformSizes[w]=p,this._uniformLocations[w]=this._uniformLocationPointer,this._uniformLocationPointer+=p;for(let w=0;w<p;w++)this._data.push(e[w]);this._needSync=!0}}addMatrix(w,p){this.addUniform(w,Array.prototype.slice.call(p.ze()))}addFloat2(w,p,e){const r=[p,e];this.addUniform(w,r)}addFloat3(w,p,e,r){const I=[p,e,r];this.addUniform(w,I)}addColor3(w,p){const e=[p.r,p.g,p.b];this.addUniform(w,e)}addColor4(w,p,e){const r=[p.r,p.g,p.b,e];this.addUniform(w,r)}addVector3(w,p){const e=[p.x,p.y,p.z];this.addUniform(w,e)}addMatrix3x3(w){this.addUniform(w,12)}addMatrix2x2(w){this.addUniform(w,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const w=[];let p=0;for(const e in this._uniformLocations)if(w.push(e),10===++p)break;return w.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(w,p){for(let e=0;e<w.length;++e)if(w[e]!==p[e])return!1;return!0}_copyBuffer(w,p){for(let e=0;e<w.length;++e)p[e]=w[e]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(d._UpdatedUbosInFrame[this._name]||(d._UpdatedUbosInFrame[this._name]=0),d._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(w,p,e){this._checkNewFrame();let I=this._uniformLocations[w];if(void 0===I){if(this._buffer)return void r.c.Error("Cannot add an uniform after UBO has been created. uniformName="+w);this.addUniform(w,e),I=this._uniformLocations[w]}if(this._buffer||this.create(),this._dynamic)for(let r=0;r<e;r++)this._bufferData[I+r]=p[r];else{let w=!1;for(let r=0;r<e;r++)(16===e&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[I+r]!==Math.fround(p[r]))&&(w=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[I+r]=p[r]);this._needSync=this._needSync||w}}updateUniformArray(w,p,e){this._checkNewFrame();const d=this._uniformLocations[w];if(void 0===d)return void r.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const f=this._uniformArraySizes[w];if(this._dynamic)for(let r=0;r<e;r++)this._bufferData[d+r]=p[r];else{let w=!1,r=0,q=0;for(let E=0;E<e;E++)if(this._bufferData[d+4*q+r]!==I.g.FloatRound(p[E])&&(w=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[d+4*q+r]=p[E]),r++,r===f.strideSize){for(;r<4;r++)this._bufferData[d+4*q+r]=0;r=0,q++}this._needSync=this._needSync||w}}_cacheMatrix(w,p){this._checkNewFrame();const e=this._valueCache[w],r=p.updateFlag;return(void 0===e||e!==r)&&(this._valueCache[w]=r,!0)}_updateMatrix3x3ForUniform(w,p){for(let e=0;e<3;e++)d._TempBuffer[4*e]=p[3*e],d._TempBuffer[4*e+1]=p[3*e+1],d._TempBuffer[4*e+2]=p[3*e+2],d._TempBuffer[4*e+3]=0;this.updateUniform(w,d._TempBuffer,12)}_updateMatrix3x3ForEffect(w,p){this._currentEffect.setMatrix3x3(w,p)}_updateMatrix2x2ForEffect(w,p){this._currentEffect.setMatrix2x2(w,p)}_updateMatrix2x2ForUniform(w,p){for(let e=0;e<2;e++)d._TempBuffer[4*e]=p[2*e],d._TempBuffer[4*e+1]=p[2*e+1],d._TempBuffer[4*e+2]=0,d._TempBuffer[4*e+3]=0;this.updateUniform(w,d._TempBuffer,8)}_updateFloatForEffect(w,p){this._currentEffect.setFloat(w,p)}_updateFloatForUniform(w,p){d._TempBuffer[0]=p,this.updateUniform(w,d._TempBuffer,1)}_updateFloat2ForEffect(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(w+r,p,e)}_updateFloat2ForUniform(w,p,e){d._TempBuffer[0]=p,d._TempBuffer[1]=e,this.updateUniform(w,d._TempBuffer,2)}_updateFloat3ForEffect(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(w+I,p,e,r)}_updateFloat3ForUniform(w,p,e,r){d._TempBuffer[0]=p,d._TempBuffer[1]=e,d._TempBuffer[2]=r,this.updateUniform(w,d._TempBuffer,3)}_updateFloat4ForEffect(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(w+d,p,e,r,I)}_updateFloat4ForUniform(w,p,e,r,I){d._TempBuffer[0]=p,d._TempBuffer[1]=e,d._TempBuffer[2]=r,d._TempBuffer[3]=I,this.updateUniform(w,d._TempBuffer,4)}_updateFloatArrayForEffect(w,p){this._currentEffect.setFloatArray(w,p)}_updateFloatArrayForUniform(w,p){this.updateUniformArray(w,p,p.length)}_updateArrayForEffect(w,p){this._currentEffect.setArray(w,p)}_updateArrayForUniform(w,p){this.updateUniformArray(w,p,p.length)}_updateIntArrayForEffect(w,p){this._currentEffect.setIntArray(w,p)}_updateIntArrayForUniform(w,p){d._TempBufferInt32View.set(p),this.updateUniformArray(w,d._TempBuffer,p.length)}_updateUIntArrayForEffect(w,p){this._currentEffect.setUIntArray(w,p)}_updateUIntArrayForUniform(w,p){d._TempBufferUInt32View.set(p),this.updateUniformArray(w,d._TempBuffer,p.length)}_updateMatrixForEffect(w,p){this._currentEffect.setMatrix(w,p)}_updateMatrixForUniform(w,p){this._cacheMatrix(w,p)&&this.updateUniform(w,p.ze(),16)}_updateMatricesForEffect(w,p){this._currentEffect.setMatrices(w,p)}_updateMatricesForUniform(w,p){this.updateUniform(w,p,p.length)}_updateVector3ForEffect(w,p){this._currentEffect.setVector3(w,p)}_updateVector3ForUniform(w,p){d._TempBuffer[0]=p.x,d._TempBuffer[1]=p.y,d._TempBuffer[2]=p.z,this.updateUniform(w,d._TempBuffer,3)}_updateVector4ForEffect(w,p){this._currentEffect.setVector4(w,p)}_updateVector4ForUniform(w,p){d._TempBuffer[0]=p.x,d._TempBuffer[1]=p.y,d._TempBuffer[2]=p.z,d._TempBuffer[3]=p.w,this.updateUniform(w,d._TempBuffer,4)}_updateColor3ForEffect(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(w+e,p)}_updateColor3ForUniform(w,p){d._TempBuffer[0]=p.r,d._TempBuffer[1]=p.g,d._TempBuffer[2]=p.b,this.updateUniform(w,d._TempBuffer,3)}_updateColor4ForEffect(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(w+r,p,e)}_updateDirectColor4ForEffect(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(w+e,p)}_updateColor4ForUniform(w,p,e){d._TempBuffer[0]=p.r,d._TempBuffer[1]=p.g,d._TempBuffer[2]=p.b,d._TempBuffer[3]=e,this.updateUniform(w,d._TempBuffer,4)}_updateDirectColor4ForUniform(w,p){d._TempBuffer[0]=p.r,d._TempBuffer[1]=p.g,d._TempBuffer[2]=p.b,d._TempBuffer[3]=p.a,this.updateUniform(w,d._TempBuffer,4)}_updateIntForEffect(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(w+e,p)}_updateIntForUniform(w,p){d._TempBufferInt32View[0]=p,this.updateUniform(w,d._TempBuffer,1)}_updateInt2ForEffect(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(w+r,p,e)}_updateInt2ForUniform(w,p,e){d._TempBufferInt32View[0]=p,d._TempBufferInt32View[1]=e,this.updateUniform(w,d._TempBuffer,2)}_updateInt3ForEffect(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(w+I,p,e,r)}_updateInt3ForUniform(w,p,e,r){d._TempBufferInt32View[0]=p,d._TempBufferInt32View[1]=e,d._TempBufferInt32View[2]=r,this.updateUniform(w,d._TempBuffer,3)}_updateInt4ForEffect(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(w+d,p,e,r,I)}_updateInt4ForUniform(w,p,e,r,I){d._TempBufferInt32View[0]=p,d._TempBufferInt32View[1]=e,d._TempBufferInt32View[2]=r,d._TempBufferInt32View[3]=I,this.updateUniform(w,d._TempBuffer,4)}_updateUIntForEffect(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(w+e,p)}_updateUIntForUniform(w,p){d._TempBufferUInt32View[0]=p,this.updateUniform(w,d._TempBuffer,1)}_updateUInt2ForEffect(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(w+r,p,e)}_updateUInt2ForUniform(w,p,e){d._TempBufferUInt32View[0]=p,d._TempBufferUInt32View[1]=e,this.updateUniform(w,d._TempBuffer,2)}_updateUInt3ForEffect(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(w+I,p,e,r)}_updateUInt3ForUniform(w,p,e,r){d._TempBufferUInt32View[0]=p,d._TempBufferUInt32View[1]=e,d._TempBufferUInt32View[2]=r,this.updateUniform(w,d._TempBuffer,3)}_updateUInt4ForEffect(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(w+d,p,e,r,I)}_updateUInt4ForUniform(w,p,e,r,I){d._TempBufferUInt32View[0]=p,d._TempBufferUInt32View[1]=e,d._TempBufferUInt32View[2]=r,d._TempBufferUInt32View[3]=I,this.updateUniform(w,d._TempBuffer,4)}setTexture(w,p){this._currentEffect.setTexture(w,p)}setTextureArray(w,p){this._currentEffect.setTextureArray(w,p)}bindTexture(w,p){this._currentEffect._bindTexture(w,p)}updateUniformDirectly(w,p){this.updateUniform(w,p,p.length),this.update()}bindToEffect(w,p){this._currentEffect=w,this._currentEffectName=p}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(w){if(!this._buffers)return this._buffer===w;for(let p=0;p<this._buffers.length;++p){if(this._buffers[p][0]===w)return this._bufferIndex=p,this._buffer=w,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[p][1]&&this._bufferData.set(this._buffers[p][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const w=this._engine._uniformBuffers,p=w.indexOf(this);if(-1!==p&&(w[p]=w[w.length-1],w.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let e=0;e<this._buffers.length;++e){const w=this._buffers[e][0];this._engine._releaseBuffer(w)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}d._UpdatedUbosInFrame={},d._MAX_UNIFORM_SIZE=256,d._TempBuffer=new Float32Array(d._MAX_UNIFORM_SIZE),d._TempBufferInt32View=new Int32Array(d._TempBuffer.buffer),d._TempBufferUInt32View=new Uint32Array(d._TempBuffer.buffer)},11358:(w,p,e)=>{e.d(p,{b:()=>f,e:()=>r});var r,I,d=e(11023);!function(w){w[w.LOCAL=0]="LOCAL",w[w.WORLD=1]="WORLD",w[w.BONE=2]="BONE"}(r||(r={}));class f{}f.X=new d.k(1,0,0),f.Y=new d.k(0,1,0),f.Z=new d.k(0,0,1),function(w){w[w.X=0]="X",w[w.Y=1]="Y",w[w.Z=2]="Z"}(I||(I={}))},11308:(w,p,e)=>{e.d(p,{b:()=>k,e:()=>m,h:()=>J});var r=e(11030),I=e(11038),d=e(11027),f=e(11063);function q(w){return Math.pow(w,d.k)}function E(w){return w<=.04045?.0773993808*w:Math.pow(.947867299*(w+.055),2.4)}function j(w){return Math.pow(w,d.j)}function X(w){return w<=.0031308?12.92*w:1.055*Math.pow(w,.41666)-.055}class k{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=w,this.g=p,this.b=e}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"pd"}getHashCode(){let w=255*this.r|0;return w=397*w^255*this.g,w=397*w^255*this.b,w}toArray(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w[p]=this.r,w[p+1]=this.g,w[p+2]=this.b,this}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return k.FromArrayToRef(w,p,this),this}toColor4(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new m(this.r,this.g,this.b,w)}ze(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(w){return new k(this.r*w.r,this.g*w.g,this.b*w.b)}multiplyToRef(w,p){return p.r=this.r*w.r,p.g=this.g*w.g,p.b=this.b*w.b,p}multiplyInPlace(w){return this.r*=w.r,this.g*=w.g,this.b*=w.b,this}multiplyByFloats(w,p,e){return new k(this.r*w,this.g*p,this.b*e)}divide(w){throw new ReferenceError("Can not divide a color")}divideToRef(w,p){throw new ReferenceError("Can not divide a color")}divideInPlace(w){throw new ReferenceError("Can not divide a color")}minimizeInPlace(w){return this.minimizeInPlaceFromFloats(w.r,w.g,w.b)}maximizeInPlace(w){return this.maximizeInPlaceFromFloats(w.r,w.g,w.b)}minimizeInPlaceFromFloats(w,p,e){return this.r=Math.min(w,this.r),this.g=Math.min(p,this.g),this.b=Math.min(e,this.b),this}maximizeInPlaceFromFloats(w,p,e){return this.r=Math.max(w,this.r),this.g=Math.max(p,this.g),this.b=Math.max(e,this.b),this}floorToRef(w){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(w){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(w){return w&&this.r===w.r&&this.g===w.g&&this.b===w.b}equalsFloats(w,p,e){return this.equalsToFloats(w,p,e)}equalsToFloats(w,p,e){return this.r===w&&this.g===p&&this.b===e}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return(0,f.WithinEpsilon)(this.r,w.r,p)&&(0,f.WithinEpsilon)(this.g,w.g,p)&&(0,f.WithinEpsilon)(this.b,w.b,p)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(w){throw new ReferenceError("Can not negate a color")}scale(w){return new k(this.r*w,this.g*w,this.b*w)}scaleInPlace(w){return this.r*=w,this.g*=w,this.b*=w,this}scaleToRef(w,p){return p.r=this.r*w,p.g=this.g*w,p.b=this.b*w,p}scaleAndAddToRef(w,p){return p.r+=this.r*w,p.g+=this.g*w,p.b+=this.b*w,p}clampToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;return e.r=(0,f.Clamp)(this.r,w,p),e.g=(0,f.Clamp)(this.g,w,p),e.b=(0,f.Clamp)(this.b,w,p),e}add(w){return new k(this.r+w.r,this.g+w.g,this.b+w.b)}addInPlace(w){return this.r+=w.r,this.g+=w.g,this.b+=w.b,this}addInPlaceFromFloats(w,p,e){return this.r+=w,this.g+=p,this.b+=e,this}addToRef(w,p){return p.r=this.r+w.r,p.g=this.g+w.g,p.b=this.b+w.b,p}Je(w){return new k(this.r-w.r,this.g-w.g,this.b-w.b)}subtractToRef(w,p){return p.r=this.r-w.r,p.g=this.g-w.g,p.b=this.b-w.b,p}zk(w){return this.r-=w.r,this.g-=w.g,this.b-=w.b,this}subtractFromFloats(w,p,e){return new k(this.r-w,this.g-p,this.b-e)}subtractFromFloatsToRef(w,p,e,r){return r.r=this.r-w,r.g=this.g-p,r.b=this.b-e,r}clone(){return new k(this.r,this.g,this.b)}X(w){return this.r=w.r,this.g=w.g,this.b=w.b,this}te(w,p,e){return this.r=w,this.g=p,this.b=e,this}set(w,p,e){return this.te(w,p,e)}Pe(w){return this.r=this.g=this.b=w,this}toHexString(){const w=Math.round(255*this.r),p=Math.round(255*this.g),e=Math.round(255*this.b);return"#"+(0,f.ToHex)(w)+(0,f.ToHex)(p)+(0,f.ToHex)(e)}fromHexString(w){return"#"!==w.substring(0,1)||7!==w.length||(this.r=parseInt(w.substring(1,3),16)/255,this.g=parseInt(w.substring(3,5),16)/255,this.b=parseInt(w.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new k)}toHSVToRef(w){const p=this.r,e=this.g,r=this.b,I=Math.max(p,e,r),d=Math.min(p,e,r);let f=0,q=0;const E=I,j=I-d;return 0!==I&&(q=j/I),I!=d&&(I==p?(f=(e-r)/j,e<r&&(f+=6)):I==e?f=(r-p)/j+2:I==r&&(f=(p-e)/j+4),f*=60),w.r=f,w.g=q,w.b=E,w}toLinearSpace(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new k;return this.toLinearSpaceToRef(p,w),p}toLinearSpaceToRef(w){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(w.r=E(this.r),w.g=E(this.g),w.b=E(this.b)):(w.r=q(this.r),w.g=q(this.g),w.b=q(this.b)),this}toGammaSpace(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new k;return this.toGammaSpaceToRef(p,w),p}toGammaSpaceToRef(w){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(w.r=X(this.r),w.g=X(this.g),w.b=X(this.b)):(w.r=j(this.r),w.g=j(this.g),w.b=j(this.b)),this}static HSVtoRGBToRef(w,p,e,r){const I=e*p,d=w/60,f=I*(1-Math.abs(d%2-1));let q=0,E=0,j=0;d>=0&&d<=1?(q=I,E=f):d>=1&&d<=2?(q=f,E=I):d>=2&&d<=3?(E=I,j=f):d>=3&&d<=4?(E=f,j=I):d>=4&&d<=5?(q=f,j=I):d>=5&&d<=6&&(q=I,j=f);const X=e-I;return r.r=q+X,r.g=E+X,r.b=j+X,r}static FromHSV(w,p,e){const r=new k(0,0,0);return k.HSVtoRGBToRef(w,p,e,r),r}static FromHexString(w){return new k(0,0,0).fromHexString(w)}static Ve(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new k(w[p],w[p+1],w[p+2])}static FromArrayToRef(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;e.r=w[p],e.g=w[p+1],e.b=w[p+2]}static FromInts(w,p,e){return new k(w/255,p/255,e/255)}static Lerp(w,p,e){const r=new k(0,0,0);return k.LerpToRef(w,p,e,r),r}static LerpToRef(w,p,e,r){r.r=w.r+(p.r-w.r)*e,r.g=w.g+(p.g-w.g)*e,r.b=w.b+(p.b-w.b)*e}static Hermite(w,p,e,r,I){const d=I*I,f=I*d,q=2*f-3*d+1,E=-2*f+3*d,j=f-2*d+I,X=f-d,m=w.r*q+e.r*E+p.r*j+r.r*X,J=w.g*q+e.g*E+p.g*j+r.g*X,K=w.b*q+e.b*E+p.b*j+r.b*X;return new k(m,J,K)}static Hermite1stDerivative(w,p,e,r,I){const d=k.Black();return this.Hermite1stDerivativeToRef(w,p,e,r,I,d),d}static Hermite1stDerivativeToRef(w,p,e,r,I,d){const f=I*I;d.r=6*(f-I)*w.r+(3*f-4*I+1)*p.r+6*(-f+I)*e.r+(3*f-2*I)*r.r,d.g=6*(f-I)*w.g+(3*f-4*I+1)*p.g+6*(-f+I)*e.g+(3*f-2*I)*r.g,d.b=6*(f-I)*w.b+(3*f-4*I+1)*p.b+6*(-f+I)*e.b+(3*f-2*I)*r.b}static Red(){return new k(1,0,0)}static Green(){return new k(0,1,0)}static Blue(){return new k(0,0,1)}static Black(){return new k(0,0,0)}static get BlackReadOnly(){return k._BlackReadOnly}static White(){return new k(1,1,1)}static Purple(){return new k(.5,0,.5)}static Magenta(){return new k(1,0,1)}static Yellow(){return new k(1,1,0)}static Gray(){return new k(.5,.5,.5)}static Teal(){return new k(0,1,1)}static Random(){return new k(Math.random(),Math.random(),Math.random())}}k._V8PerformanceHack=new k(.5,.5,.5),k._BlackReadOnly=k.Black(),Object.defineProperties(k.prototype,{dimension:{value:[3]},rank:{value:1}});class m{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=w,this.g=p,this.b=e,this.a=r}ze(){return[this.r,this.g,this.b,this.a]}toArray(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w[p]=this.r,w[p+1]=this.g,w[p+2]=this.b,w[p+3]=this.a,this}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=w[p],this.g=w[p+1],this.b=w[p+2],this.a=w[p+3],this}equals(w){return w&&this.r===w.r&&this.g===w.g&&this.b===w.b&&this.a===w.a}add(w){return new m(this.r+w.r,this.g+w.g,this.b+w.b,this.a+w.a)}addToRef(w,p){return p.r=this.r+w.r,p.g=this.g+w.g,p.b=this.b+w.b,p.a=this.a+w.a,p}addInPlace(w){return this.r+=w.r,this.g+=w.g,this.b+=w.b,this.a+=w.a,this}addInPlaceFromFloats(w,p,e,r){return this.r+=w,this.g+=p,this.b+=e,this.a+=r,this}Je(w){return new m(this.r-w.r,this.g-w.g,this.b-w.b,this.a-w.a)}subtractToRef(w,p){return p.r=this.r-w.r,p.g=this.g-w.g,p.b=this.b-w.b,p.a=this.a-w.a,p}zk(w){return this.r-=w.r,this.g-=w.g,this.b-=w.b,this.a-=w.a,this}subtractFromFloats(w,p,e,r){return new m(this.r-w,this.g-p,this.b-e,this.a-r)}subtractFromFloatsToRef(w,p,e,r,I){return I.r=this.r-w,I.g=this.g-p,I.b=this.b-e,I.a=this.a-r,I}scale(w){return new m(this.r*w,this.g*w,this.b*w,this.a*w)}scaleInPlace(w){return this.r*=w,this.g*=w,this.b*=w,this.a*=w,this}scaleToRef(w,p){return p.r=this.r*w,p.g=this.g*w,p.b=this.b*w,p.a=this.a*w,p}scaleAndAddToRef(w,p){return p.r+=this.r*w,p.g+=this.g*w,p.b+=this.b*w,p.a+=this.a*w,p}clampToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;return e.r=(0,f.Clamp)(this.r,w,p),e.g=(0,f.Clamp)(this.g,w,p),e.b=(0,f.Clamp)(this.b,w,p),e.a=(0,f.Clamp)(this.a,w,p),e}multiply(w){return new m(this.r*w.r,this.g*w.g,this.b*w.b,this.a*w.a)}multiplyToRef(w,p){return p.r=this.r*w.r,p.g=this.g*w.g,p.b=this.b*w.b,p.a=this.a*w.a,p}multiplyInPlace(w){return this.r*=w.r,this.g*=w.g,this.b*=w.b,this.a*=w.a,this}multiplyByFloats(w,p,e,r){return new m(this.r*w,this.g*p,this.b*e,this.a*r)}divide(w){throw new ReferenceError("Can not divide a color")}divideToRef(w,p){throw new ReferenceError("Can not divide a color")}divideInPlace(w){throw new ReferenceError("Can not divide a color")}minimizeInPlace(w){return this.r=Math.min(this.r,w.r),this.g=Math.min(this.g,w.g),this.b=Math.min(this.b,w.b),this.a=Math.min(this.a,w.a),this}maximizeInPlace(w){return this.r=Math.max(this.r,w.r),this.g=Math.max(this.g,w.g),this.b=Math.max(this.b,w.b),this.a=Math.max(this.a,w.a),this}minimizeInPlaceFromFloats(w,p,e,r){return this.r=Math.min(w,this.r),this.g=Math.min(p,this.g),this.b=Math.min(e,this.b),this.a=Math.min(r,this.a),this}maximizeInPlaceFromFloats(w,p,e,r){return this.r=Math.max(w,this.r),this.g=Math.max(p,this.g),this.b=Math.max(e,this.b),this.a=Math.max(r,this.a),this}floorToRef(w){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(w){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(w){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return(0,f.WithinEpsilon)(this.r,w.r,p)&&(0,f.WithinEpsilon)(this.g,w.g,p)&&(0,f.WithinEpsilon)(this.b,w.b,p)&&(0,f.WithinEpsilon)(this.a,w.a,p)}equalsToFloats(w,p,e,r){return this.r===w&&this.g===p&&this.b===e&&this.a===r}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ed"}getHashCode(){let w=255*this.r|0;return w=397*w^255*this.g,w=397*w^255*this.b,w=397*w^255*this.a,w}clone(){return(new m).X(this)}X(w){return this.r=w.r,this.g=w.g,this.b=w.b,this.a=w.a,this}te(w,p,e,r){return this.r=w,this.g=p,this.b=e,this.a=r,this}set(w,p,e,r){return this.te(w,p,e,r)}Pe(w){return this.r=this.g=this.b=this.a=w,this}toHexString(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=Math.round(255*this.r),e=Math.round(255*this.g),r=Math.round(255*this.b);if(w)return"#"+(0,f.ToHex)(p)+(0,f.ToHex)(e)+(0,f.ToHex)(r);const I=Math.round(255*this.a);return"#"+(0,f.ToHex)(p)+(0,f.ToHex)(e)+(0,f.ToHex)(r)+(0,f.ToHex)(I)}fromHexString(w){return"#"!==w.substring(0,1)||9!==w.length&&7!==w.length||(this.r=parseInt(w.substring(1,3),16)/255,this.g=parseInt(w.substring(3,5),16)/255,this.b=parseInt(w.substring(5,7),16)/255,9===w.length&&(this.a=parseInt(w.substring(7,9),16)/255)),this}toLinearSpace(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new m;return this.toLinearSpaceToRef(p,w),p}toLinearSpaceToRef(w){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(w.r=E(this.r),w.g=E(this.g),w.b=E(this.b)):(w.r=q(this.r),w.g=q(this.g),w.b=q(this.b)),w.a=this.a,this}toGammaSpace(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new m;return this.toGammaSpaceToRef(p,w),p}toGammaSpaceToRef(w){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(w.r=X(this.r),w.g=X(this.g),w.b=X(this.b)):(w.r=j(this.r),w.g=j(this.g),w.b=j(this.b)),w.a=this.a,this}static FromHexString(w){return"#"!==w.substring(0,1)||9!==w.length&&7!==w.length?new m(0,0,0,0):new m(0,0,0,1).fromHexString(w)}static Lerp(w,p,e){return m.LerpToRef(w,p,e,new m)}static LerpToRef(w,p,e,r){return r.r=w.r+(p.r-w.r)*e,r.g=w.g+(p.g-w.g)*e,r.b=w.b+(p.b-w.b)*e,r.a=w.a+(p.a-w.a)*e,r}static Hermite(w,p,e,r,I){const d=I*I,f=I*d,q=2*f-3*d+1,E=-2*f+3*d,j=f-2*d+I,X=f-d,k=w.r*q+e.r*E+p.r*j+r.r*X,J=w.g*q+e.g*E+p.g*j+r.g*X,K=w.b*q+e.b*E+p.b*j+r.b*X,y=w.a*q+e.a*E+p.a*j+r.a*X;return new m(k,J,K,y)}static Hermite1stDerivative(w,p,e,r,I){const d=new m;return this.Hermite1stDerivativeToRef(w,p,e,r,I,d),d}static Hermite1stDerivativeToRef(w,p,e,r,I,d){const f=I*I;d.r=6*(f-I)*w.r+(3*f-4*I+1)*p.r+6*(-f+I)*e.r+(3*f-2*I)*r.r,d.g=6*(f-I)*w.g+(3*f-4*I+1)*p.g+6*(-f+I)*e.g+(3*f-2*I)*r.g,d.b=6*(f-I)*w.b+(3*f-4*I+1)*p.b+6*(-f+I)*e.b+(3*f-2*I)*r.b,d.a=6*(f-I)*w.a+(3*f-4*I+1)*p.a+6*(-f+I)*e.a+(3*f-2*I)*r.a}static FromColor3(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new m(w.r,w.g,w.b,p)}static Ve(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new m(w[p],w[p+1],w[p+2],w[p+3])}static FromArrayToRef(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;e.r=w[p],e.g=w[p+1],e.b=w[p+2],e.a=w[p+3]}static FromInts(w,p,e,r){return new m(w/255,p/255,e/255,r/255)}static CheckColors4(w,p){if(w.length===3*p){const p=[];for(let e=0;e<w.length;e+=3){const r=e/3*4;p[r]=w[e],p[r+1]=w[e+1],p[r+2]=w[e+2],p[r+3]=1}return p}return w}}m._V8PerformanceHack=new m(.5,.5,.5,.5),Object.defineProperties(m.prototype,{dimension:{value:[4]},rank:{value:1}});class J{}J.pd=(0,r.d)(3,k.Black),J.ed=(0,r.d)(3,(()=>new m(0,0,0,0))),(0,I.d)("BABYLON.Color3",k),(0,I.d)("BABYLON.Color4",m)},11027:(w,p,e)=>{e.d(p,{c:()=>f,g:()=>d,j:()=>r,k:()=>I});const r=1/2.2,I=2.2,d=(1+Math.sqrt(5))/2,f=.001},11386:(w,p,e)=>{e.d(p,{e:()=>I});var r=e(11292);class I{static GetPlanes(w){const p=[];for(let e=0;e<6;e++)p.push(new r.e(0,0,0,0));return I.GetPlanesToRef(w,p),p}static GetNearPlaneToRef(w,p){const e=w.m;p.dp.x=e[3]+e[2],p.dp.y=e[7]+e[6],p.dp.z=e[11]+e[10],p.d=e[15]+e[14],p.normalize()}static GetFarPlaneToRef(w,p){const e=w.m;p.dp.x=e[3]-e[2],p.dp.y=e[7]-e[6],p.dp.z=e[11]-e[10],p.d=e[15]-e[14],p.normalize()}static GetLeftPlaneToRef(w,p){const e=w.m;p.dp.x=e[3]+e[0],p.dp.y=e[7]+e[4],p.dp.z=e[11]+e[8],p.d=e[15]+e[12],p.normalize()}static GetRightPlaneToRef(w,p){const e=w.m;p.dp.x=e[3]-e[0],p.dp.y=e[7]-e[4],p.dp.z=e[11]-e[8],p.d=e[15]-e[12],p.normalize()}static GetTopPlaneToRef(w,p){const e=w.m;p.dp.x=e[3]-e[1],p.dp.y=e[7]-e[5],p.dp.z=e[11]-e[9],p.d=e[15]-e[13],p.normalize()}static GetBottomPlaneToRef(w,p){const e=w.m;p.dp.x=e[3]+e[1],p.dp.y=e[7]+e[5],p.dp.z=e[11]+e[9],p.d=e[15]+e[13],p.normalize()}static GetPlanesToRef(w,p){I.GetNearPlaneToRef(w,p[0]),I.GetFarPlaneToRef(w,p[1]),I.GetLeftPlaneToRef(w,p[2]),I.GetRightPlaneToRef(w,p[3]),I.GetTopPlaneToRef(w,p[4]),I.GetBottomPlaneToRef(w,p[5])}static IsPointInFrustum(w,p){for(let e=0;e<6;e++)if(p[e].dotCoordinate(w)<0)return!1;return!0}}},11277:(w,p,e)=>{e.d(p,{c:()=>q,d:()=>E});var r=e(11207),I=e(11023),d=e(11213);class f{static extractMinAndMaxIndexed(w,p,e,r,I,d){for(let f=e;f<e+r;f++){const e=3*p[f],r=w[e],q=w[e+1],E=w[e+2];I.minimizeInPlaceFromFloats(r,q,E),d.maximizeInPlaceFromFloats(r,q,E)}}static extractMinAndMax(w,p,e,r,I,d){for(let f=p,q=p*r;f<p+e;f++,q+=r){const p=w[q],e=w[q+1],r=w[q+2];I.minimizeInPlaceFromFloats(p,e,r),d.maximizeInPlaceFromFloats(p,e,r)}}}function q(w,p,e,r){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const q=new I.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new I.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return f.extractMinAndMaxIndexed(w,p,e,r,q,E),d&&(q.x-=q.x*d.x+d.y,q.y-=q.y*d.x+d.y,q.z-=q.z*d.x+d.y,E.x+=E.x*d.x+d.y,E.y+=E.y*d.x+d.y,E.z+=E.z*d.x+d.y),{minimum:q,maximum:E}}function E(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0;const q=new I.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new I.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return d||(d=3),f.extractMinAndMax(w,p,e,d,q,E),r&&(q.x-=q.x*r.x+r.y,q.y-=q.y*r.x+r.y,q.z-=q.z*r.x+r.y,E.x+=E.x*r.x+r.y,E.y+=E.y*r.x+r.y,E.z+=E.z*r.x+r.y),{minimum:q,maximum:E}}(0,r.c)([d.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r,I]=p;return!Array.isArray(r)&&!Array.isArray(I)}))],f,"extractMinAndMaxIndexed",null),(0,r.c)([d.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r]=p;return!Array.isArray(r)}))],f,"extractMinAndMax",null)},11478:(w,p,e)=>{e.d(p,{d:()=>r.b,f:()=>r.c,g:()=>r.d,h:()=>r.k});e(11358),e(11308),e(11027),e(11386),e(11482),e(11292),e(11491);var r=e(11023);e(11378)},11482:(w,p,e)=>{e.d(p,{e:()=>q,h:()=>m,l:()=>X,o:()=>k});var r,I=e(11063),d=e(11023),f=e(11027);!function(w){w[w.CW=0]="CW",w[w.CCW=1]="CCW"}(r||(r={}));class q{static Interpolate(w,p,e,r,I){if(0===w)return 0;const d=1-3*r+3*p,f=3*r-6*p,q=3*p;let E=w;for(let j=0;j<5;j++){const p=E*E;E-=(d*(p*E)+f*p+q*E-w)*(1/(3*d*p+2*f*E+q)),E=Math.min(1,Math.max(0,E))}return 3*Math.pow(1-E,2)*E*e+3*(1-E)*Math.pow(E,2)*I+Math.pow(E,3)}}class E{constructor(w){this._radians=w,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(w,p){const e=p.Je(w),r=Math.atan2(e.y,e.x);return new E(r)}static BetweenTwoVectors(w,p){let e=w.lengthSquared()*p.lengthSquared();if(0===e)return new E(Math.PI/2);e=Math.sqrt(e);let r=w.dot(p)/e;r=(0,I.Clamp)(r,-1,1);const d=Math.acos(r);return new E(d)}static FromRadians(w){return new E(w)}static FromDegrees(w){return new E(w*Math.PI/180)}}class j{constructor(w,p,e){this.startPoint=w,this.midPoint=p,this.endPoint=e;const r=Math.pow(p.x,2)+Math.pow(p.y,2),I=(Math.pow(w.x,2)+Math.pow(w.y,2)-r)/2,f=(r-Math.pow(e.x,2)-Math.pow(e.y,2))/2,q=(w.x-p.x)*(p.y-e.y)-(p.x-e.x)*(w.y-p.y);this.centerPoint=new d.g((I*(p.y-e.y)-f*(w.y-p.y))/q,((w.x-p.x)*f-(p.x-e.x)*I)/q),this.radius=this.centerPoint.Je(this.startPoint).length(),this.startAngle=E.BetweenTwoPoints(this.centerPoint,this.startPoint);const j=this.startAngle.degrees();let X=E.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),k=E.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();X-j>180&&(X-=360),X-j<-180&&(X+=360),k-X>180&&(k-=360),k-X<-180&&(k+=360),this.orientation=X-j<0?0:1,this.angle=E.FromDegrees(0===this.orientation?j-k:k-j)}}class X{constructor(w,p){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new d.g(w,p))}addLineTo(w,p){if(this.closed)return this;const e=new d.g(w,p),r=this._points[this._points.length-1];return this._points.push(e),this._length+=e.Je(r).length(),this}addArcTo(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const f=this._points[this._points.length-1],q=new d.g(w,p),E=new d.g(e,r),X=new j(f,q,E);let k=X.angle.radians()/I;0===X.orientation&&(k*=-1);let m=X.startAngle.radians()+k;for(let d=0;d<I;d++){const w=Math.cos(m)*X.radius+X.centerPoint.x,p=Math.sin(m)*X.radius+X.centerPoint.y;this.addLineTo(w,p),m+=k}return this}addQuadraticCurveTo(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const d=(w,p,e,r)=>(1-w)*(1-w)*p+2*w*(1-w)*e+w*w*r,f=this._points[this._points.length-1];for(let q=0;q<=I;q++){const E=q/I,j=d(E,f.x,w,e),X=d(E,f.y,p,r);this.addLineTo(j,X)}return this}addBezierCurveTo(w,p,e,r,I,d){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const q=(w,p,e,r,I)=>(1-w)*(1-w)*(1-w)*p+3*w*(1-w)*(1-w)*e+3*w*w*(1-w)*r+w*w*w*I,E=this._points[this._points.length-1];for(let j=0;j<=f;j++){const X=j/f,k=q(X,E.x,w,e,I),m=q(X,E.y,p,r,d);this.addLineTo(k,m)}return this}isPointInside(w){let p=!1;const e=this._points.length;for(let r=e-1,I=0;I<e;r=I++){let e=this._points[r],d=this._points[I],f=d.x-e.x,q=d.y-e.y;if(Math.abs(q)>Number.EPSILON){if(q<0&&(e=this._points[I],f=-f,d=this._points[r],q=-q),w.y<e.y||w.y>d.y)continue;if(w.y===e.y&&w.x===e.x)return!0;{const r=q*(w.x-e.x)-f*(w.y-e.y);if(0===r)return!0;if(r<0)continue;p=!p}}else{if(w.y!==e.y)continue;if(d.x<=w.x&&w.x<=e.x||e.x<=w.x&&w.x<=d.x)return!0}}return p}close(){return this.closed=!0,this}length(){let w=this._length;if(this.closed){const p=this._points[this._points.length-1];w+=this._points[0].Je(p).length()}return w}area(){const w=this._points.length;let p=0;for(let e=w-1,r=0;r<w;e=r++)p+=this._points[e].x*this._points[r].y-this._points[r].x*this._points[e].y;return.5*p}getPoints(){return this._points}getPointAtLengthPosition(w){if(w<0||w>1)return d.g.Zero();const p=w*this.length();let e=0;for(let r=0;r<this._points.length;r++){const w=(r+1)%this._points.length,I=this._points[r],f=this._points[w].Je(I),q=f.length()+e;if(p>=e&&p<=q){const w=f.normalize(),r=p-e;return new d.g(I.x+w.x*r,I.y+w.y*r)}e=q}return d.g.Zero()}static StartingAt(w,p){return new X(w,p)}}class k{constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=w,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:d.k.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:d.b.Identity()};for(let I=0;I<w.length;I++)this._curve[I]=w[I].clone();this._raw=e||!1,this._alignTangentsWithPath=r,this._compute(p,r)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(w){return this._updatePointAtData(w).point}getTangentAt(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(w,p),p?d.k.TransformCoordinates(d.k.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(w,p),p?d.k.TransformCoordinates(d.k.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(w,p),p?d.k.TransformCoordinates(d.k.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(w){return this.length()*w}getPreviousPointIndexAt(w){return this._updatePointAtData(w),this._pointAtData.previousPointArrayIndex}getSubPositionAt(w){return this._updatePointAtData(w),this._pointAtData.subPosition}getClosestPositionTo(w){let p=Number.MAX_VALUE,e=0;for(let r=0;r<this._curve.length-1;r++){const I=this._curve[r+0],f=this._curve[r+1].Je(I).normalize(),q=this._distances[r+1]-this._distances[r+0],E=Math.min(Math.max(d.k.Dot(f,w.Je(I).normalize()),0)*d.k.Distance(I,w)/q,1),j=d.k.Distance(I.add(f.scale(E*q)),w);j<p&&(p=j,e=(this._distances[r+0]+q*E)/this.length())}return e}slice(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(w<0&&(w=1- -1*w%1),p<0&&(p=1- -1*p%1),w>p){const e=w;w=p,p=e}const e=this.getCurve(),r=this.getPointAt(w);let I=this.getPreviousPointIndexAt(w);const d=this.getPointAt(p),f=this.getPreviousPointIndexAt(p)+1,q=[];return 0!==w&&(I++,q.push(r)),q.push(...e.slice(I,f)),1===p&&1!==w||q.push(d),new k(q,this.getNormalAt(w),this._raw,this._alignTangentsWithPath)}update(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let r=0;r<w.length;r++)this._curve[r].x=w[r].x,this._curve[r].y=w[r].y,this._curve[r].z=w[r].z;return this._compute(p,e),this}_compute(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._curve.length;if(e<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[e-1]=this._curve[e-1].Je(this._curve[e-2]),this._raw||this._tangents[e-1].normalize();const r=this._tangents[0],I=this._normalVector(r,w);let f,q,E,j,X;this._normals[0]=I,this._raw||this._normals[0].normalize(),this._binormals[0]=d.k.Cross(r,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let k=1;k<e;k++)f=this._getLastNonNullVector(k),k<e-1&&(q=this._getFirstNonNullVector(k),this._tangents[k]=p?q:f.add(q),this._tangents[k].normalize()),this._distances[k]=this._distances[k-1]+this._curve[k].Je(this._curve[k-1]).length(),E=this._tangents[k],X=this._binormals[k-1],this._normals[k]=d.k.Cross(X,E),this._raw||(0===this._normals[k].length()?(j=this._normals[k-1],this._normals[k]=j.clone()):this._normals[k].normalize()),this._binormals[k]=d.k.Cross(E,this._normals[k]),this._raw||this._binormals[k].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(w){let p=1,e=this._curve[w+p].Je(this._curve[w]);for(;0===e.length()&&w+p+1<this._curve.length;)p++,e=this._curve[w+p].Je(this._curve[w]);return e}_getLastNonNullVector(w){let p=1,e=this._curve[w].Je(this._curve[w-p]);for(;0===e.length()&&w>p+1;)p++,e=this._curve[w].Je(this._curve[w-p]);return e}_normalVector(w,p){let e,r=w.length();if(0===r&&(r=1),void 0===p||null===p){let p;p=(0,I.WithinEpsilon)(Math.abs(w.y)/r,1,f.c)?(0,I.WithinEpsilon)(Math.abs(w.x)/r,1,f.c)?(0,I.WithinEpsilon)(Math.abs(w.z)/r,1,f.c)?d.k.Zero():new d.k(0,0,1):new d.k(1,0,0):new d.k(0,-1,0),e=d.k.Cross(w,p)}else e=d.k.Cross(w,p),d.k.CrossToRef(e,w,e);return e.normalize(),e}_updatePointAtData(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===w)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=w;const e=this.getPoints();if(w<=0)return this._setPointAtData(0,0,e[0],0,p);if(w>=1)return this._setPointAtData(1,1,e[e.length-1],e.length-1,p);let r,I=e[0],f=0;const q=w*this.length();for(let E=1;E<e.length;E++){r=e[E];const j=d.k.Distance(I,r);if(f+=j,f===q)return this._setPointAtData(w,1,r,E,p);if(f>q){const e=(f-q)/j,d=I.Je(r),X=r.add(d.scaleInPlace(e));return this._setPointAtData(w,1-e,X,E-1,p)}I=r}return this._pointAtData}_setPointAtData(w,p,e,r,I){return this._pointAtData.point=e,this._pointAtData.position=w,this._pointAtData.subPosition=p,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=I,I&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=d.b.Identity();const w=this._pointAtData.previousPointArrayIndex;if(w!==this._tangents.length-1){const p=w+1,e=this._tangents[w].clone(),r=this._normals[w].clone(),I=this._binormals[w].clone(),f=this._tangents[p].clone(),q=this._normals[p].clone(),E=this._binormals[p].clone(),j=d.c.RotationQuaternionFromAxis(r,I,e),X=d.c.RotationQuaternionFromAxis(q,E,f);d.c.Slerp(j,X,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class m{static CreateQuadraticBezier(w,p,e,r){r=r>2?r:3;const I=[],f=(w,p,e,r)=>(1-w)*(1-w)*p+2*w*(1-w)*e+w*w*r;for(let q=0;q<=r;q++)I.push(new d.k(f(q/r,w.x,p.x,e.x),f(q/r,w.y,p.y,e.y),f(q/r,w.z,p.z,e.z)));return new m(I)}static CreateCubicBezier(w,p,e,r,I){I=I>3?I:4;const f=[],q=(w,p,e,r,I)=>(1-w)*(1-w)*(1-w)*p+3*w*(1-w)*(1-w)*e+3*w*w*(1-w)*r+w*w*w*I;for(let E=0;E<=I;E++)f.push(new d.k(q(E/I,w.x,p.x,e.x,r.x),q(E/I,w.y,p.y,e.y,r.y),q(E/I,w.z,p.z,e.z,r.z)));return new m(f)}static CreateHermiteSpline(w,p,e,r,I){const f=[],q=1/I;for(let E=0;E<=I;E++)f.push(d.k.Hermite(w,p,e,r,E*q));return new m(f)}static CreateCatmullRomSpline(w,p,e){const r=[],I=1/p;let f=0;if(e){const e=w.length;for(let q=0;q<e;q++){f=0;for(let E=0;E<p;E++)r.push(d.k.CatmullRom(w[q%e],w[(q+1)%e],w[(q+2)%e],w[(q+3)%e],f)),f+=I}r.push(r[0])}else{const e=[];e.push(w[0].clone()),Array.prototype.push.apply(e,w),e.push(w[w.length-1].clone());let q=0;for(;q<e.length-3;q++){f=0;for(let w=0;w<p;w++)r.push(d.k.CatmullRom(e[q],e[q+1],e[q+2],e[q+3],f)),f+=I}q--,r.push(d.k.CatmullRom(e[q],e[q+1],e[q+2],e[q+3],f))}return new m(r)}static ArcThru3Points(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=[],E=p.Je(w),j=e.Je(p),X=w.Je(e),k=d.k.Cross(E,j),J=k.length();if(J<Math.pow(10,-8))return new m(q);const K=E.lengthSquared(),y=j.lengthSquared(),c=X.lengthSquared(),s=k.lengthSquared(),O=.5*E.length()*j.length()*X.length()/J,a=-.5*y*d.k.Dot(E,X)/s,A=-.5*c*d.k.Dot(E,j)/s,z=-.5*K*d.k.Dot(j,X)/s,M=w.scale(a).add(p.scale(A)).add(e.scale(z)),i=w.Je(M).normalize(),t=d.k.Cross(k,i).normalize();if(f){const p=2*Math.PI/r;for(let w=0;w<=2*Math.PI;w+=p)q.push(M.add(i.scale(O*Math.cos(w)).add(t.scale(O*Math.sin(w)))));q.push(w)}else{const p=1/r;let f=0,E=d.k.Zero();do{E=M.add(i.scale(O*Math.cos(f)).add(t.scale(O*Math.sin(f)))),q.push(E),f+=p}while(!E.equalsWithEpsilon(e,O*p*1.1));q.push(e),I&&q.push(w)}return new m(q)}constructor(w){this._length=0,this._points=w,this._length=this._computeLength(w)}getPoints(){return this._points}length(){return this._length}continue(w){const p=this._points[this._points.length-1],e=this._points.slice(),r=w.getPoints();for(let I=1;I<r.length;I++)e.push(r[I].Je(r[0]).add(p));return new m(e)}_computeLength(w){let p=0;for(let e=1;e<w.length;e++)p+=w[e].Je(w[e-1]).length();return p}}},11292:(w,p,e)=>{e.d(p,{e:()=>I});var r=e(11023);class I{constructor(w,p,e,I){this.dp=new r.k(w,p,e),this.d=I}ze(){return[this.dp.x,this.dp.y,this.dp.z,this.d]}clone(){return new I(this.dp.x,this.dp.y,this.dp.z,this.d)}getClassName(){return"Plane"}getHashCode(){let w=this.dp.getHashCode();return w=397*w^this.d,w}normalize(){const w=Math.sqrt(this.dp.x*this.dp.x+this.dp.y*this.dp.y+this.dp.z*this.dp.z);let p=0;return 0!==w&&(p=1/w),this.dp.x*=p,this.dp.y*=p,this.dp.z*=p,this.d*=p,this}transform(w){const p=I._TmpMatrix;w.invertToRef(p);const e=p.m,r=this.dp.x,d=this.dp.y,f=this.dp.z,q=this.d,E=r*e[0]+d*e[1]+f*e[2]+q*e[3],j=r*e[4]+d*e[5]+f*e[6]+q*e[7],X=r*e[8]+d*e[9]+f*e[10]+q*e[11],k=r*e[12]+d*e[13]+f*e[14]+q*e[15];return new I(E,j,X,k)}dotCoordinate(w){return this.dp.x*w.x+this.dp.y*w.y+this.dp.z*w.z+this.d}copyFromPoints(w,p,e){const r=p.x-w.x,I=p.y-w.y,d=p.z-w.z,f=e.x-w.x,q=e.y-w.y,E=e.z-w.z,j=I*E-d*q,X=d*f-r*E,k=r*q-I*f,m=Math.sqrt(j*j+X*X+k*k);let J;return J=0!==m?1/m:0,this.dp.x=j*J,this.dp.y=X*J,this.dp.z=k*J,this.d=-(this.dp.x*w.x+this.dp.y*w.y+this.dp.z*w.z),this}isFrontFacingTo(w,p){return r.k.Dot(this.dp,w)<=p}signedDistanceTo(w){return r.k.Dot(w,this.dp)+this.d}static Ve(w){return new I(w[0],w[1],w[2],w[3])}static FromPoints(w,p,e){const r=new I(0,0,0,0);return r.copyFromPoints(w,p,e),r}static FromPositionAndNormal(w,p){const e=new I(0,0,0,0);return this.FromPositionAndNormalToRef(w,p,e)}static FromPositionAndNormalToRef(w,p,e){return e.dp.X(p),e.dp.normalize(),e.d=-w.dot(e.dp),e}static SignedDistanceToPlaneFromPositionAndNormal(w,p,e){const I=-(p.x*w.x+p.y*w.y+p.z*w.z);return r.k.Dot(e,p)+I}}I._TmpMatrix=r.b.Identity()},11063:(w,p,e)=>{function r(w){return parseInt(w.toString().replace(/\W/g,""))}function I(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(w-p)<=e}function d(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return w<p-r||w>e+r}function f(w,p){return w===p?w:Math.random()*(p-w)+w}function q(w,p,e){return w+(p-w)*e}function E(w,p,e){let r=c(p-w,360);return r>180&&(r-=360),w+r*m(e)}function j(w,p,e){let r=0;return r=w!=p?m((e-w)/(p-w)):0,r}function X(w,p,e,r,I){const d=I*I,f=I*d;return w*(2*f-3*d+1)+e*(-2*f+3*d)+p*(f-2*d+I)+r*(f-d)}function k(w,p,e,r,I){const d=I*I;return 6*(d-I)*w+(3*d-4*I+1)*p+6*(-d+I)*e+(3*d-2*I)*r}function m(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(e,Math.max(p,w))}function J(w){return w-=2*Math.PI*Math.floor((w+Math.PI)/(2*Math.PI))}function K(w){const p=w.toString(16);return w<=15?("0"+p).toUpperCase():p.toUpperCase()}function y(w){if(Math.log2)return Math.floor(Math.log2(w));if(w<0)return NaN;if(0===w)return-1/0;let p=0;if(w<1){for(;w<1;)p++,w*=2;p=-p}else if(w>1)for(;w>1;)p++,w=Math.floor(w/2);return p}function c(w,p){return w-Math.floor(w/p)*p}function s(w,p,e){return(w-p)/(e-p)}function O(w,p,e){return w*(e-p)+p}function a(w,p){let e=c(p-w,360);return e>180&&(e-=360),e}function A(w,p){const e=c(w,2*p);return p-Math.abs(e-p)}function z(w,p,e){let r=m(e);return r=-2*r*r*r+3*r*r,p*r+w*(1-r)}function M(w,p,e){let r=0;return r=Math.abs(p-w)<=e?p:w+Math.sign(p-w)*e,r}function i(w,p,e){const r=a(w,p);let I=0;return I=-e<r&&r<e?p:M(w,p=w+r,e),I}function t(w,p,e){return(w-p)/(e-p)}function n(w,p,e){return(e-p)*w+p}function l(w,p){const e=w%p;return 0===e?p:l(p,e)}e.r(p),e.d(p,{Clamp:()=>m,DeltaAngle:()=>a,Denormalize:()=>O,ExtractAsInt:()=>r,Hermite:()=>X,Hermite1stDerivative:()=>k,HighestCommonFactor:()=>l,ILog2:()=>y,InverseLerp:()=>j,Lerp:()=>q,LerpAngle:()=>E,MoveTowards:()=>M,MoveTowardsAngle:()=>i,Normalize:()=>s,NormalizeRadians:()=>J,OutsideRange:()=>d,PercentToRange:()=>n,PingPong:()=>A,RandomRange:()=>f,RangeToPercent:()=>t,Repeat:()=>c,SmoothStep:()=>z,ToHex:()=>K,WithinEpsilon:()=>I})},11491:(w,p,e)=>{e.d(p,{c:()=>r});class r{constructor(w,p){this.width=w,this.height=p}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let w=0|this.width;return w=397*w^this.height,w}X(w){this.width=w.width,this.height=w.height}te(w,p){return this.width=w,this.height=p,this}set(w,p){return this.te(w,p)}multiplyByFloats(w,p){return new r(this.width*w,this.height*p)}clone(){return new r(this.width,this.height)}equals(w){return!!w&&(this.width===w.width&&this.height===w.height)}get surface(){return this.width*this.height}static Zero(){return new r(0,0)}add(w){return new r(this.width+w.width,this.height+w.height)}Je(w){return new r(this.width-w.width,this.height-w.height)}scale(w){return new r(this.width*w,this.height*w)}static Lerp(w,p,e){const I=w.width+(p.width-w.width)*e,d=w.height+(p.height-w.height)*e;return new r(I,d)}}},11023:(w,p,e)=>{e.d(p,{b:()=>O,c:()=>s,d:()=>A,g:()=>K,k:()=>y,o:()=>c});var r=e(11027),I=e(11030),d=e(11038),f=e(11047),q=e(11051),E=e(11063);class j{}function X(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const I=w.ze(),d=p.ze(),f=I[0],q=I[1],E=I[2],j=I[3],X=I[4],k=I[5],m=I[6],J=I[7],K=I[8],y=I[9],c=I[10],s=I[11],O=I[12],a=I[13],A=I[14],z=I[15],M=d[0],i=d[1],t=d[2],n=d[3],l=d[4],N=d[5],U=d[6],v=d[7],R=d[8],V=d[9],b=d[10],h=d[11],P=d[12],u=d[13],Y=d[14],L=d[15];e[r]=f*M+q*l+E*R+j*P,e[r+1]=f*i+q*N+E*V+j*u,e[r+2]=f*t+q*U+E*b+j*Y,e[r+3]=f*n+q*v+E*h+j*L,e[r+4]=X*M+k*l+m*R+J*P,e[r+5]=X*i+k*N+m*V+J*u,e[r+6]=X*t+k*U+m*b+J*Y,e[r+7]=X*n+k*v+m*h+J*L,e[r+8]=K*M+y*l+c*R+s*P,e[r+9]=K*i+y*N+c*V+s*u,e[r+10]=K*t+y*U+c*b+s*Y,e[r+11]=K*n+y*v+c*h+s*L,e[r+12]=O*M+a*l+A*R+z*P,e[r+13]=O*i+a*N+A*V+z*u,e[r+14]=O*t+a*U+A*b+z*Y,e[r+15]=O*n+a*v+A*h+z*L}function k(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=w.ze();p[e]=r[0],p[e+1]=r[1],p[e+2]=r[2],p[e+3]=r[3],p[e+4]=r[4],p[e+5]=r[5],p[e+6]=r[6],p[e+7]=r[7],p[e+8]=r[8],p[e+9]=r[9],p[e+10]=r[10],p[e+11]=r[11],p[e+12]=r[12],p[e+13]=r[13],p[e+14]=r[14],p[e+15]=r[15]}function m(w,p){const e=w.ze(),r=e[0],I=e[1],d=e[2],f=e[3],q=e[4],E=e[5],j=e[6],X=e[7],k=e[8],m=e[9],J=e[10],K=e[11],y=e[12],c=e[13],s=e[14],O=e[15],a=J*O-s*K,A=m*O-c*K,z=m*s-c*J,M=k*O-y*K,i=k*s-J*y,t=k*c-y*m,n=+(E*a-j*A+X*z),l=-(q*a-j*M+X*i),N=+(q*A-E*M+X*t),U=-(q*z-E*i+j*t),v=r*n+I*l+d*N+f*U;if(0===v)return!1;const R=1/v,V=j*O-s*X,b=E*O-c*X,h=E*s-c*j,P=q*O-y*X,u=q*s-y*j,Y=q*c-y*E,L=j*K-J*X,W=E*K-m*X,F=E*J-m*j,H=q*K-k*X,B=q*J-k*j,D=q*m-k*E,T=-(I*a-d*A+f*z),Z=+(r*a-d*M+f*i),G=-(r*A-I*M+f*t),g=+(r*z-I*i+d*t),o=+(I*V-d*b+f*h),C=-(r*V-d*P+f*u),Q=+(r*b-I*P+f*Y),x=-(r*h-I*u+d*Y),S=-(I*L-d*W+f*F),ww=+(r*L-d*H+f*B),pw=-(r*W-I*H+f*D),ew=+(r*F-I*B+d*D);return p[0]=n*R,p[1]=T*R,p[2]=o*R,p[3]=S*R,p[4]=l*R,p[5]=Z*R,p[6]=C*R,p[7]=ww*R,p[8]=N*R,p[9]=G*R,p[10]=Q*R,p[11]=pw*R,p[12]=U*R,p[13]=g*R,p[14]=x*R,p[15]=ew*R,!0}j._UpdateFlagSeed=0;const J=w=>parseInt(w.toString().replace(/\W/g,""));class K{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=w,this.y=p}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let w=J(this.x);return w=397*w^J(this.y),w}toArray(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w[p]=this.x,w[p+1]=this.y,this}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K.FromArrayToRef(w,p,this),this}ze(){return[this.x,this.y]}X(w){return this.x=w.x,this.y=w.y,this}te(w,p){return this.x=w,this.y=p,this}set(w,p){return this.te(w,p)}Pe(w){return this.te(w,w)}add(w){return new K(this.x+w.x,this.y+w.y)}addToRef(w,p){return p.x=this.x+w.x,p.y=this.y+w.y,p}addInPlace(w){return this.x+=w.x,this.y+=w.y,this}addInPlaceFromFloats(w,p){return this.x+=w,this.y+=p,this}addVector3(w){return new K(this.x+w.x,this.y+w.y)}Je(w){return new K(this.x-w.x,this.y-w.y)}subtractToRef(w,p){return p.x=this.x-w.x,p.y=this.y-w.y,p}zk(w){return this.x-=w.x,this.y-=w.y,this}multiplyInPlace(w){return this.x*=w.x,this.y*=w.y,this}multiply(w){return new K(this.x*w.x,this.y*w.y)}multiplyToRef(w,p){return p.x=this.x*w.x,p.y=this.y*w.y,p}multiplyByFloats(w,p){return new K(this.x*w,this.y*p)}divide(w){return new K(this.x/w.x,this.y/w.y)}divideToRef(w,p){return p.x=this.x/w.x,p.y=this.y/w.y,p}divideInPlace(w){return this.x=this.x/w.x,this.y=this.y/w.y,this}minimizeInPlace(w){return this.minimizeInPlaceFromFloats(w.x,w.y)}maximizeInPlace(w){return this.maximizeInPlaceFromFloats(w.x,w.y)}minimizeInPlaceFromFloats(w,p){return this.x=Math.min(w,this.x),this.y=Math.min(p,this.y),this}maximizeInPlaceFromFloats(w,p){return this.x=Math.max(w,this.x),this.y=Math.max(p,this.y),this}subtractFromFloats(w,p){return new K(this.x-w,this.y-p)}subtractFromFloatsToRef(w,p,e){return e.x=this.x-w,e.y=this.y-p,e}negate(){return new K(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(w){return w.x=-this.x,w.y=-this.y,w}scaleInPlace(w){return this.x*=w,this.y*=w,this}scale(w){return new K(this.x*w,this.y*w)}scaleToRef(w,p){return p.x=this.x*w,p.y=this.y*w,p}scaleAndAddToRef(w,p){return p.x+=this.x*w,p.y+=this.y*w,p}equals(w){return w&&this.x===w.x&&this.y===w.y}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return w&&(0,E.WithinEpsilon)(this.x,w.x,p)&&(0,E.WithinEpsilon)(this.y,w.y,p)}equalsToFloats(w,p){return this.x===w&&this.y===p}floor(){return new K(Math.floor(this.x),Math.floor(this.y))}floorToRef(w){return w.x=Math.floor(this.x),w.y=Math.floor(this.y),w}fract(){return new K(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(w){return w.x=this.x-Math.floor(this.x),w.y=this.y-Math.floor(this.y),w}rotate(w){return this.rotateToRef(w,new K)}rotateToRef(w,p){const e=Math.cos(w),r=Math.sin(w);return p.x=e*this.x-r*this.y,p.y=r*this.x+e*this.y,p}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(w){return 0===w||1===w?this:this.scaleInPlace(1/w)}normalizeToNew(){const w=new K;return this.normalizeToRef(w),w}normalizeToRef(w){const p=this.length();return 0===p&&(w.x=this.x,w.y=this.y),this.scaleToRef(1/p,w)}clone(){return new K(this.x,this.y)}dot(w){return this.x*w.x+this.y*w.y}static Zero(){return new K(0,0)}static One(){return new K(1,1)}static Random(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new K((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static RandomToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).te((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static get ZeroReadOnly(){return K._ZeroReadOnly}static Ve(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new K(w[p],w[p+1])}static FromArrayToRef(w,p,e){return e.x=w[p],e.y=w[p+1],e}static FromFloatsToRef(w,p,e){return e.te(w,p),e}static CatmullRom(w,p,e,r,I){const d=I*I,f=I*d,q=.5*(2*p.x+(-w.x+e.x)*I+(2*w.x-5*p.x+4*e.x-r.x)*d+(-w.x+3*p.x-3*e.x+r.x)*f),E=.5*(2*p.y+(-w.y+e.y)*I+(2*w.y-5*p.y+4*e.y-r.y)*d+(-w.y+3*p.y-3*e.y+r.y)*f);return new K(q,E)}static ClampToRef(w,p,e,r){return r.x=(0,E.Clamp)(w.x,p.x,e.x),r.y=(0,E.Clamp)(w.y,p.y,e.y),r}static Clamp(w,p,e){const r=(0,E.Clamp)(w.x,p.x,e.x),I=(0,E.Clamp)(w.y,p.y,e.y);return new K(r,I)}static Hermite(w,p,e,r,I){const d=I*I,f=I*d,q=2*f-3*d+1,E=-2*f+3*d,j=f-2*d+I,X=f-d,k=w.x*q+e.x*E+p.x*j+r.x*X,m=w.y*q+e.y*E+p.y*j+r.y*X;return new K(k,m)}static Hermite1stDerivative(w,p,e,r,I){return this.Hermite1stDerivativeToRef(w,p,e,r,I,new K)}static Hermite1stDerivativeToRef(w,p,e,r,I,d){const f=I*I;return d.x=6*(f-I)*w.x+(3*f-4*I+1)*p.x+6*(-f+I)*e.x+(3*f-2*I)*r.x,d.y=6*(f-I)*w.y+(3*f-4*I+1)*p.y+6*(-f+I)*e.y+(3*f-2*I)*r.y,d}static Lerp(w,p,e){return K.LerpToRef(w,p,e,new K)}static LerpToRef(w,p,e,r){return r.x=w.x+(p.x-w.x)*e,r.y=w.y+(p.y-w.y)*e,r}static Dot(w,p){return w.x*p.x+w.y*p.y}static Normalize(w){return K.NormalizeToRef(w,new K)}static NormalizeToRef(w,p){return w.normalizeToRef(p),p}static Minimize(w,p){const e=w.x<p.x?w.x:p.x,r=w.y<p.y?w.y:p.y;return new K(e,r)}static Maximize(w,p){const e=w.x>p.x?w.x:p.x,r=w.y>p.y?w.y:p.y;return new K(e,r)}static Transform(w,p){return K.TransformToRef(w,p,new K)}static TransformToRef(w,p,e){const r=p.m,I=w.x*r[0]+w.y*r[4]+r[12],d=w.x*r[1]+w.y*r[5]+r[13];return e.x=I,e.y=d,e}static PointInTriangle(w,p,e,r){const I=.5*(-e.y*r.x+p.y*(-e.x+r.x)+p.x*(e.y-r.y)+e.x*r.y),d=I<0?-1:1,f=(p.y*r.x-p.x*r.y+(r.y-p.y)*w.x+(p.x-r.x)*w.y)*d,q=(p.x*e.y-p.y*e.x+(p.y-e.y)*w.x+(e.x-p.x)*w.y)*d;return f>0&&q>0&&f+q<2*I*d}static Distance(w,p){return Math.sqrt(K.DistanceSquared(w,p))}static DistanceSquared(w,p){const e=w.x-p.x,r=w.y-p.y;return e*e+r*r}static Center(w,p){return K.CenterToRef(w,p,new K)}static CenterToRef(w,p,e){return e.te((w.x+p.x)/2,(w.y+p.y)/2)}static DistanceOfPointFromSegment(w,p,e){const r=K.DistanceSquared(p,e);if(0===r)return K.Distance(w,p);const I=e.Je(p),d=Math.max(0,Math.min(1,K.Dot(w.Je(p),I)/r)),f=p.add(I.multiplyByFloats(d,d));return K.Distance(w,f)}}K._V8PerformanceHack=new K(.5,.5),K._ZeroReadOnly=K.Zero(),Object.defineProperties(K.prototype,{dimension:{value:[2]},rank:{value:1}});class y{get x(){return this._x}set x(w){this._x=w,this._isDirty=!0}get y(){return this._y}set y(w){this._y=w,this._isDirty=!0}get z(){return this._z}set z(w){this._z=w,this._isDirty=!0}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=w,this._y=p,this._z=e}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"ne"}getHashCode(){let w=J(this._x);return w=397*w^J(this._y),w=397*w^J(this._z),w}ze(){return[this._x,this._y,this._z]}toArray(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w[p]=this._x,w[p+1]=this._y,w[p+2]=this._z,this}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y.FromArrayToRef(w,p,this),this}toQuaternion(){return s.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(w){return this._x+=w._x,this._y+=w._y,this._z+=w._z,this._isDirty=!0,this}addInPlaceFromFloats(w,p,e){return this._x+=w,this._y+=p,this._z+=e,this._isDirty=!0,this}add(w){return new y(this._x+w._x,this._y+w._y,this._z+w._z)}addToRef(w,p){return p._x=this._x+w._x,p._y=this._y+w._y,p._z=this._z+w._z,p._isDirty=!0,p}zk(w){return this._x-=w._x,this._y-=w._y,this._z-=w._z,this._isDirty=!0,this}Je(w){return new y(this._x-w._x,this._y-w._y,this._z-w._z)}subtractToRef(w,p){return this.subtractFromFloatsToRef(w._x,w._y,w._z,p)}subtractFromFloats(w,p,e){return new y(this._x-w,this._y-p,this._z-e)}subtractFromFloatsToRef(w,p,e,r){return r._x=this._x-w,r._y=this._y-p,r._z=this._z-e,r._isDirty=!0,r}negate(){return new y(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(w){return w._x=-1*this._x,w._y=-1*this._y,w._z=-1*this._z,w._isDirty=!0,w}scaleInPlace(w){return this._x*=w,this._y*=w,this._z*=w,this._isDirty=!0,this}scale(w){return new y(this._x*w,this._y*w,this._z*w)}scaleToRef(w,p){return p._x=this._x*w,p._y=this._y*w,p._z=this._z*w,p._isDirty=!0,p}getNormalToRef(w){const p=this.length();let e=Math.acos(this._y/p);const r=Math.atan2(this._z,this._x);e>Math.PI/2?e-=Math.PI/2:e+=Math.PI/2;const I=p*Math.sin(e)*Math.cos(r),d=p*Math.cos(e),f=p*Math.sin(e)*Math.sin(r);return w.set(I,d,f),w}applyRotationQuaternionToRef(w,p){const e=this._x,r=this._y,I=this._z,d=w._x,f=w._y,q=w._z,E=w._w,j=2*(f*I-q*r),X=2*(q*e-d*I),k=2*(d*r-f*e);return p._x=e+E*j+f*k-q*X,p._y=r+E*X+q*j-d*k,p._z=I+E*k+d*X-f*j,p._isDirty=!0,p}applyRotationQuaternionInPlace(w){return this.applyRotationQuaternionToRef(w,this)}applyRotationQuaternion(w){return this.applyRotationQuaternionToRef(w,new y)}scaleAndAddToRef(w,p){return p._x+=this._x*w,p._y+=this._y*w,p._z+=this._z*w,p._isDirty=!0,p}projectOnPlane(w,p){return this.projectOnPlaneToRef(w,p,new y)}projectOnPlaneToRef(w,p,e){const r=w.dp,I=w.d,d=a.ne[0];this.subtractToRef(p,d),d.normalize();const f=y.Dot(d,r);if(Math.abs(f)<1e-10)e.Pe(1/0);else{const w=-(y.Dot(p,r)+I)/f,q=d.scaleInPlace(w);p.addToRef(q,e)}return e}equals(w){return w&&this._x===w._x&&this._y===w._y&&this._z===w._z}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return w&&(0,E.WithinEpsilon)(this._x,w._x,p)&&(0,E.WithinEpsilon)(this._y,w._y,p)&&(0,E.WithinEpsilon)(this._z,w._z,p)}equalsToFloats(w,p,e){return this._x===w&&this._y===p&&this._z===e}multiplyInPlace(w){return this._x*=w._x,this._y*=w._y,this._z*=w._z,this._isDirty=!0,this}multiply(w){return this.multiplyByFloats(w._x,w._y,w._z)}multiplyToRef(w,p){return p._x=this._x*w._x,p._y=this._y*w._y,p._z=this._z*w._z,p._isDirty=!0,p}multiplyByFloats(w,p,e){return new y(this._x*w,this._y*p,this._z*e)}divide(w){return new y(this._x/w._x,this._y/w._y,this._z/w._z)}divideToRef(w,p){return p._x=this._x/w._x,p._y=this._y/w._y,p._z=this._z/w._z,p._isDirty=!0,p}divideInPlace(w){return this._x=this._x/w._x,this._y=this._y/w._y,this._z=this._z/w._z,this._isDirty=!0,this}minimizeInPlace(w){return this.minimizeInPlaceFromFloats(w._x,w._y,w._z)}maximizeInPlace(w){return this.maximizeInPlaceFromFloats(w._x,w._y,w._z)}minimizeInPlaceFromFloats(w,p,e){return w<this._x&&(this.x=w),p<this._y&&(this.y=p),e<this._z&&(this.z=e),this}maximizeInPlaceFromFloats(w,p,e){return w>this._x&&(this.x=w),p>this._y&&(this.y=p),e>this._z&&(this.z=e),this}isNonUniformWithinEpsilon(w){const p=Math.abs(this._x),e=Math.abs(this._y);if(!(0,E.WithinEpsilon)(p,e,w))return!0;const r=Math.abs(this._z);return!(0,E.WithinEpsilon)(p,r,w)||!(0,E.WithinEpsilon)(e,r,w)}get isNonUniform(){const w=Math.abs(this._x);if(w!==Math.abs(this._y))return!0;return w!==Math.abs(this._z)}floorToRef(w){return w._x=Math.floor(this._x),w._y=Math.floor(this._y),w._z=Math.floor(this._z),w._isDirty=!0,w}floor(){return new y(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(w){return w._x=this._x-Math.floor(this._x),w._y=this._y-Math.floor(this._y),w._z=this._z-Math.floor(this._z),w._isDirty=!0,w}fract(){return new y(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(w){if("xyz"===(w=w.toLowerCase()))return this;const p=a.ne[0].X(this);return this.x=p[w[0]],this.y=p[w[1]],this.z=p[w[2]],this}rotateByQuaternionToRef(w,p){return w.toRotationMatrix(a.Matrix[0]),y.TransformCoordinatesToRef(this,a.Matrix[0],p),p}rotateByQuaternionAroundPointToRef(w,p,e){return this.subtractToRef(p,a.ne[0]),a.ne[0].rotateByQuaternionToRef(w,a.ne[0]),p.addToRef(a.ne[0],e),e}cross(w){return y.CrossToRef(this,w,new y)}normalizeFromLength(w){return 0===w||1===w?this:this.scaleInPlace(1/w)}normalizeToNew(){return this.normalizeToRef(new y)}normalizeToRef(w){const p=this.length();return 0===p||1===p?(w._x=this._x,w._y=this._y,w._z=this._z,w._isDirty=!0,w):this.scaleToRef(1/p,w)}clone(){return new y(this._x,this._y,this._z)}X(w){return this.te(w._x,w._y,w._z)}te(w,p,e){return this._x=w,this._y=p,this._z=e,this._isDirty=!0,this}set(w,p,e){return this.te(w,p,e)}Pe(w){return this._x=this._y=this._z=w,this._isDirty=!0,this}static GetClipFactor(w,p,e,r){const I=y.Dot(w,e);return(I-r)/(I-y.Dot(p,e))}static GetAngleBetweenVectors(w,p,e){const r=w.normalizeToRef(a.ne[1]),I=p.normalizeToRef(a.ne[2]);let d=y.Dot(r,I);d=(0,E.Clamp)(d,-1,1);const f=Math.acos(d),q=a.ne[3];return y.CrossToRef(r,I,q),y.Dot(q,e)>0?isNaN(f)?0:f:isNaN(f)?-Math.PI:-Math.acos(d)}static GetAngleBetweenVectorsOnPlane(w,p,e){a.ne[0].X(w);const r=a.ne[0];a.ne[1].X(p);const I=a.ne[1];a.ne[2].X(e);const d=a.ne[2],f=a.ne[3],q=a.ne[4];r.normalize(),I.normalize(),d.normalize(),y.CrossToRef(d,r,f),y.CrossToRef(f,d,q);const j=Math.atan2(y.Dot(I,f),y.Dot(I,q));return(0,E.NormalizeRadians)(j)}static PitchYawRollToMoveBetweenPointsToRef(w,p,e){const r=A.ne[0];return p.subtractToRef(w,r),e._y=Math.atan2(r.x,r.z)||0,e._x=Math.atan2(Math.sqrt(r.x**2+r.z**2),r.y)||0,e._z=0,e._isDirty=!0,e}static PitchYawRollToMoveBetweenPoints(w,p){const e=y.Zero();return y.PitchYawRollToMoveBetweenPointsToRef(w,p,e)}static SlerpToRef(w,p,e,I){e=(0,E.Clamp)(e,0,1);const d=a.ne[0],f=a.ne[1];d.X(w);const q=d.length();d.normalizeFromLength(q),f.X(p);const j=f.length();f.normalizeFromLength(j);const X=y.Dot(d,f);let k,m;if(X<1-r.c){const w=Math.acos(X),p=1/Math.sin(w);k=Math.sin((1-e)*w)*p,m=Math.sin(e*w)*p}else k=1-e,m=e;return d.scaleInPlace(k),f.scaleInPlace(m),I.X(d).addInPlace(f),I.scaleInPlace((0,E.Lerp)(q,j,e)),I}static SmoothToRef(w,p,e,r,I){return y.SlerpToRef(w,p,0===r?1:e/r,I),I}static Ve(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new y(w[p],w[p+1],w[p+2])}static FromFloatArray(w,p){return y.Ve(w,p)}static FromArrayToRef(w,p,e){return e._x=w[p],e._y=w[p+1],e._z=w[p+2],e._isDirty=!0,e}static FromFloatArrayToRef(w,p,e){return y.FromArrayToRef(w,p,e)}static FromFloatsToRef(w,p,e,r){return r.te(w,p,e),r}static Zero(){return new y(0,0,0)}static One(){return new y(1,1,1)}static Up(){return new y(0,1,0)}static get UpReadOnly(){return y._UpReadOnly}static get DownReadOnly(){return y._DownReadOnly}static get RightReadOnly(){return y._RightReadOnly}static get LeftReadOnly(){return y._LeftReadOnly}static get LeftHandedForwardReadOnly(){return y._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return y._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return y._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return y._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return y._ZeroReadOnly}static get OneReadOnly(){return y._OneReadOnly}static Down(){return new y(0,-1,0)}static Forward(){return new y(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new y(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new y(1,0,0)}static Left(){return new y(-1,0,0)}static Random(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new y((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static RandomToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).te((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static TransformCoordinates(w,p){const e=y.Zero();return y.TransformCoordinatesToRef(w,p,e),e}static TransformCoordinatesToRef(w,p,e){return y.TransformCoordinatesFromFloatsToRef(w._x,w._y,w._z,p,e),e}static TransformCoordinatesFromFloatsToRef(w,p,e,r,I){const d=r.m,f=w*d[0]+p*d[4]+e*d[8]+d[12],q=w*d[1]+p*d[5]+e*d[9]+d[13],E=w*d[2]+p*d[6]+e*d[10]+d[14],j=1/(w*d[3]+p*d[7]+e*d[11]+d[15]);return I._x=f*j,I._y=q*j,I._z=E*j,I._isDirty=!0,I}static TransformNormal(w,p){const e=y.Zero();return y.TransformNormalToRef(w,p,e),e}static TransformNormalToRef(w,p,e){return this.TransformNormalFromFloatsToRef(w._x,w._y,w._z,p,e),e}static TransformNormalFromFloatsToRef(w,p,e,r,I){const d=r.m;return I._x=w*d[0]+p*d[4]+e*d[8],I._y=w*d[1]+p*d[5]+e*d[9],I._z=w*d[2]+p*d[6]+e*d[10],I._isDirty=!0,I}static CatmullRom(w,p,e,r,I){const d=I*I,f=I*d,q=.5*(2*p._x+(-w._x+e._x)*I+(2*w._x-5*p._x+4*e._x-r._x)*d+(-w._x+3*p._x-3*e._x+r._x)*f),E=.5*(2*p._y+(-w._y+e._y)*I+(2*w._y-5*p._y+4*e._y-r._y)*d+(-w._y+3*p._y-3*e._y+r._y)*f),j=.5*(2*p._z+(-w._z+e._z)*I+(2*w._z-5*p._z+4*e._z-r._z)*d+(-w._z+3*p._z-3*e._z+r._z)*f);return new y(q,E,j)}static Clamp(w,p,e){const r=new y;return y.ClampToRef(w,p,e,r),r}static ClampToRef(w,p,e,r){let I=w._x;I=I>e._x?e._x:I,I=I<p._x?p._x:I;let d=w._y;d=d>e._y?e._y:d,d=d<p._y?p._y:d;let f=w._z;return f=f>e._z?e._z:f,f=f<p._z?p._z:f,r.te(I,d,f),r}static CheckExtends(w,p,e){p.minimizeInPlace(w),e.maximizeInPlace(w)}static Hermite(w,p,e,r,I){const d=I*I,f=I*d,q=2*f-3*d+1,E=-2*f+3*d,j=f-2*d+I,X=f-d,k=w._x*q+e._x*E+p._x*j+r._x*X,m=w._y*q+e._y*E+p._y*j+r._y*X,J=w._z*q+e._z*E+p._z*j+r._z*X;return new y(k,m,J)}static Hermite1stDerivative(w,p,e,r,I){const d=new y;return this.Hermite1stDerivativeToRef(w,p,e,r,I,d),d}static Hermite1stDerivativeToRef(w,p,e,r,I,d){const f=I*I;return d._x=6*(f-I)*w._x+(3*f-4*I+1)*p._x+6*(-f+I)*e._x+(3*f-2*I)*r._x,d._y=6*(f-I)*w._y+(3*f-4*I+1)*p._y+6*(-f+I)*e._y+(3*f-2*I)*r._y,d._z=6*(f-I)*w._z+(3*f-4*I+1)*p._z+6*(-f+I)*e._z+(3*f-2*I)*r._z,d._isDirty=!0,d}static Lerp(w,p,e){const r=new y(0,0,0);return y.LerpToRef(w,p,e,r),r}static LerpToRef(w,p,e,r){return r._x=w._x+(p._x-w._x)*e,r._y=w._y+(p._y-w._y)*e,r._z=w._z+(p._z-w._z)*e,r._isDirty=!0,r}static Dot(w,p){return w._x*p._x+w._y*p._y+w._z*p._z}dot(w){return this._x*w._x+this._y*w._y+this._z*w._z}static Cross(w,p){const e=new y;return y.CrossToRef(w,p,e),e}static CrossToRef(w,p,e){const r=w._y*p._z-w._z*p._y,I=w._z*p._x-w._x*p._z,d=w._x*p._y-w._y*p._x;return e.te(r,I,d),e}static Normalize(w){const p=y.Zero();return y.NormalizeToRef(w,p),p}static NormalizeToRef(w,p){return w.normalizeToRef(p),p}static Project(w,p,e,r){const I=new y;return y.ProjectToRef(w,p,e,r,I),I}static ProjectToRef(w,p,e,r,I){var d;const f=r.width,E=r.height,j=r.x,X=r.y,k=a.Matrix[1],m=null===(d=q.d.LastCreatedEngine)||void 0===d?void 0:d.isNDCHalfZRange,J=m?1:.5,K=m?0:.5;O.FromValuesToRef(f/2,0,0,0,0,-E/2,0,0,0,0,J,0,j+f/2,E/2+X,K,1,k);const c=a.Matrix[0];return p.multiplyToRef(e,c),c.multiplyToRef(k,c),y.TransformCoordinatesToRef(w,c,I),I}static Reflect(w,p){return this.ReflectToRef(w,p,new y)}static ReflectToRef(w,p,e){const r=A.ne[0];return r.X(p).scaleInPlace(2*y.Dot(w,p)),e.X(w).zk(r)}static _UnprojectFromInvertedMatrixToRef(w,p,e){y.TransformCoordinatesToRef(w,p,e);const r=p.m,I=w._x*r[3]+w._y*r[7]+w._z*r[11]+r[15];return(0,E.WithinEpsilon)(I,1)&&e.scaleInPlace(1/I),e}static UnprojectFromTransform(w,p,e,r,I){return this.Unproject(w,p,e,r,I,O.IdentityReadOnly)}static Unproject(w,p,e,r,I,d){const f=new y;return y.UnprojectToRef(w,p,e,r,I,d,f),f}static UnprojectToRef(w,p,e,r,I,d,f){return y.UnprojectFloatsToRef(w._x,w._y,w._z,p,e,r,I,d,f),f}static UnprojectFloatsToRef(w,p,e,r,I,d,f,E,j){var X;const k=a.Matrix[0];d.multiplyToRef(f,k),k.multiplyToRef(E,k),k.invert();const m=a.ne[0];return m.x=w/r*2-1,m.y=-(p/I*2-1),null!==(X=q.d.LastCreatedEngine)&&void 0!==X&&X.isNDCHalfZRange?m.z=e:m.z=2*e-1,y._UnprojectFromInvertedMatrixToRef(m,k,j),j}static Minimize(w,p){const e=new y;return e.X(w),e.minimizeInPlace(p),e}static Maximize(w,p){const e=new y;return e.X(w),e.maximizeInPlace(p),e}static Distance(w,p){return Math.sqrt(y.DistanceSquared(w,p))}static DistanceSquared(w,p){const e=w._x-p._x,r=w._y-p._y,I=w._z-p._z;return e*e+r*r+I*I}static ProjectOnTriangleToRef(w,p,e,I,d){const f=a.ne[0],q=a.ne[1],j=a.ne[2],X=a.ne[3],k=a.ne[4];e.subtractToRef(p,f),I.subtractToRef(p,q),I.subtractToRef(e,j);const m=f.length(),J=q.length(),K=j.length();if(m<r.c||J<r.c||K<r.c)return d.X(p),y.Distance(w,p);w.subtractToRef(p,k),y.CrossToRef(f,q,X);const c=X.length();if(c<r.c)return d.X(p),y.Distance(w,p);X.normalizeFromLength(c);let s=k.length();if(s<r.c)return d.X(p),0;k.normalizeFromLength(s);const O=y.Dot(X,k),A=a.ne[5],z=a.ne[6];A.X(X).scaleInPlace(-s*O),z.X(w).addInPlace(A);const M=a.ne[4],i=a.ne[5],t=a.ne[7],n=a.ne[8];M.X(f).scaleInPlace(1/m),n.X(q).scaleInPlace(1/J),M.addInPlace(n).scaleInPlace(-1),i.X(f).scaleInPlace(-1/m),n.X(j).scaleInPlace(1/K),i.addInPlace(n).scaleInPlace(-1),t.X(j).scaleInPlace(-1/K),n.X(q).scaleInPlace(-1/J),t.addInPlace(n).scaleInPlace(-1);const l=a.ne[9];let N;l.X(z).zk(p),y.CrossToRef(M,l,n),N=y.Dot(n,X);const U=N;l.X(z).zk(e),y.CrossToRef(i,l,n),N=y.Dot(n,X);const v=N;l.X(z).zk(I),y.CrossToRef(t,l,n),N=y.Dot(n,X);const R=N,V=a.ne[10];let b,h;U>0&&v<0?(V.X(f),b=p,h=e):v>0&&R<0?(V.X(j),b=e,h=I):(V.X(q).scaleInPlace(-1),b=I,h=p);const P=a.ne[9],u=a.ne[4];b.subtractToRef(z,n),h.subtractToRef(z,P),y.CrossToRef(n,P,u);if(!(y.Dot(u,X)<0))return d.X(z),Math.abs(s*O);const Y=a.ne[5];y.CrossToRef(V,u,Y),Y.normalize();const L=a.ne[9];L.X(b).zk(z);const W=L.length();if(W<r.c)return d.X(b),y.Distance(w,b);L.normalizeFromLength(W);const F=y.Dot(Y,L),H=a.ne[7];H.X(z).addInPlace(Y.scaleInPlace(W*F)),n.X(H).zk(b),s=V.length(),V.normalizeFromLength(s);let B=y.Dot(n,V)/Math.max(s,r.c);return B=(0,E.Clamp)(B,0,1),H.X(b).addInPlace(V.scaleInPlace(B*s)),d.X(H),y.Distance(w,H)}static Center(w,p){return y.CenterToRef(w,p,y.Zero())}static CenterToRef(w,p,e){return e.te((w._x+p._x)/2,(w._y+p._y)/2,(w._z+p._z)/2)}static RotationFromAxis(w,p,e){const r=new y;return y.RotationFromAxisToRef(w,p,e,r),r}static RotationFromAxisToRef(w,p,e,r){const I=a.Quaternion[0];return s.RotationQuaternionFromAxisToRef(w,p,e,I),I.toEulerAnglesToRef(r),r}}y._V8PerformanceHack=new y(.5,.5,.5),y._UpReadOnly=y.Up(),y._DownReadOnly=y.Down(),y._LeftHandedForwardReadOnly=y.Forward(!1),y._RightHandedForwardReadOnly=y.Forward(!0),y._LeftHandedBackwardReadOnly=y.Backward(!1),y._RightHandedBackwardReadOnly=y.Backward(!0),y._RightReadOnly=y.Right(),y._LeftReadOnly=y.Left(),y._ZeroReadOnly=y.Zero(),y._OneReadOnly=y.One(),Object.defineProperties(y.prototype,{dimension:{value:[3]},rank:{value:1}});class c{get x(){return this._x}set x(w){this._x=w,this._isDirty=!0}get y(){return this._y}set y(w){this._y=w,this._isDirty=!0}get z(){return this._z}set z(w){this._z=w,this._isDirty=!0}get w(){return this._w}set w(w){this._w=w,this._isDirty=!0}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=w,this._y=p,this._z=e,this._w=r}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let w=J(this._x);return w=397*w^J(this._y),w=397*w^J(this._z),w=397*w^J(this._w),w}ze(){return[this._x,this._y,this._z,this._w]}toArray(w,p){return void 0===p&&(p=0),w[p]=this._x,w[p+1]=this._y,w[p+2]=this._z,w[p+3]=this._w,this}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return c.FromArrayToRef(w,p,this),this}addInPlace(w){return this.x+=w._x,this.y+=w._y,this.z+=w._z,this.w+=w._w,this}addInPlaceFromFloats(w,p,e,r){return this.x+=w,this.y+=p,this.z+=e,this.w+=r,this}add(w){return new c(this._x+w.x,this._y+w.y,this._z+w.z,this._w+w.w)}addToRef(w,p){return p.x=this._x+w.x,p.y=this._y+w.y,p.z=this._z+w.z,p.w=this._w+w.w,p}zk(w){return this.x-=w.x,this.y-=w.y,this.z-=w.z,this.w-=w.w,this}Je(w){return new c(this._x-w.x,this._y-w.y,this._z-w.z,this._w-w.w)}subtractToRef(w,p){return p.x=this._x-w.x,p.y=this._y-w.y,p.z=this._z-w.z,p.w=this._w-w.w,p}subtractFromFloats(w,p,e,r){return new c(this._x-w,this._y-p,this._z-e,this._w-r)}subtractFromFloatsToRef(w,p,e,r,I){return I.x=this._x-w,I.y=this._y-p,I.z=this._z-e,I.w=this._w-r,I}negate(){return new c(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(w){return w.x=-this._x,w.y=-this._y,w.z=-this._z,w.w=-this._w,w}scaleInPlace(w){return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this}scale(w){return new c(this._x*w,this._y*w,this._z*w,this._w*w)}scaleToRef(w,p){return p.x=this._x*w,p.y=this._y*w,p.z=this._z*w,p.w=this._w*w,p}scaleAndAddToRef(w,p){return p.x+=this._x*w,p.y+=this._y*w,p.z+=this._z*w,p.w+=this._w*w,p}equals(w){return w&&this._x===w.x&&this._y===w.y&&this._z===w.z&&this._w===w.w}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return w&&(0,E.WithinEpsilon)(this._x,w.x,p)&&(0,E.WithinEpsilon)(this._y,w.y,p)&&(0,E.WithinEpsilon)(this._z,w.z,p)&&(0,E.WithinEpsilon)(this._w,w.w,p)}equalsToFloats(w,p,e,r){return this._x===w&&this._y===p&&this._z===e&&this._w===r}multiplyInPlace(w){return this.x*=w.x,this.y*=w.y,this.z*=w.z,this.w*=w.w,this}multiply(w){return new c(this._x*w.x,this._y*w.y,this._z*w.z,this._w*w.w)}multiplyToRef(w,p){return p.x=this._x*w.x,p.y=this._y*w.y,p.z=this._z*w.z,p.w=this._w*w.w,p}multiplyByFloats(w,p,e,r){return new c(this._x*w,this._y*p,this._z*e,this._w*r)}divide(w){return new c(this._x/w.x,this._y/w.y,this._z/w.z,this._w/w.w)}divideToRef(w,p){return p.x=this._x/w.x,p.y=this._y/w.y,p.z=this._z/w.z,p.w=this._w/w.w,p}divideInPlace(w){return this.divideToRef(w,this)}minimizeInPlace(w){return w.x<this._x&&(this.x=w.x),w.y<this._y&&(this.y=w.y),w.z<this._z&&(this.z=w.z),w.w<this._w&&(this.w=w.w),this}maximizeInPlace(w){return w.x>this._x&&(this.x=w.x),w.y>this._y&&(this.y=w.y),w.z>this._z&&(this.z=w.z),w.w>this._w&&(this.w=w.w),this}minimizeInPlaceFromFloats(w,p,e,r){return this.x=Math.min(w,this._x),this.y=Math.min(p,this._y),this.z=Math.min(e,this._z),this.w=Math.min(r,this._w),this}maximizeInPlaceFromFloats(w,p,e,r){return this.x=Math.max(w,this._x),this.y=Math.max(p,this._y),this.z=Math.max(e,this._z),this.w=Math.max(r,this._w),this}floorToRef(w){return w.x=Math.floor(this._x),w.y=Math.floor(this._y),w.z=Math.floor(this._z),w.w=Math.floor(this._w),w}floor(){return new c(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(w){return w.x=this._x-Math.floor(this._x),w.y=this._y-Math.floor(this._y),w.z=this._z-Math.floor(this._z),w.w=this._w-Math.floor(this._w),w}fract(){return new c(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(w){return 0===w||1===w?this:this.scaleInPlace(1/w)}normalizeToNew(){return this.normalizeToRef(new c)}normalizeToRef(w){const p=this.length();return 0===p||1===p?(w.x=this._x,w.y=this._y,w.z=this._z,w.w=this._w,w):this.scaleToRef(1/p,w)}toVector3(){return new y(this._x,this._y,this._z)}clone(){return new c(this._x,this._y,this._z,this._w)}X(w){return this.x=w.x,this.y=w.y,this.z=w.z,this.w=w.w,this}te(w,p,e,r){return this.x=w,this.y=p,this.z=e,this.w=r,this}set(w,p,e,r){return this.te(w,p,e,r)}Pe(w){return this.x=this.y=this.z=this.w=w,this}dot(w){return this._x*w.x+this._y*w.y+this._z*w.z+this._w*w.w}static Ve(w,p){return p||(p=0),new c(w[p],w[p+1],w[p+2],w[p+3])}static FromArrayToRef(w,p,e){return e.x=w[p],e.y=w[p+1],e.z=w[p+2],e.w=w[p+3],e}static FromFloatArrayToRef(w,p,e){return c.FromArrayToRef(w,p,e),e}static FromFloatsToRef(w,p,e,r,I){return I.x=w,I.y=p,I.z=e,I.w=r,I}static Zero(){return new c(0,0,0,0)}static One(){return new c(1,1,1,1)}static Random(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static RandomToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;return e.x=(0,E.RandomRange)(w,p),e.y=(0,E.RandomRange)(w,p),e.z=(0,E.RandomRange)(w,p),e.w=(0,E.RandomRange)(w,p),e}static Clamp(w,p,e){return c.ClampToRef(w,p,e,new c)}static ClampToRef(w,p,e,r){return r.x=(0,E.Clamp)(w.x,p.x,e.x),r.y=(0,E.Clamp)(w.y,p.y,e.y),r.z=(0,E.Clamp)(w.z,p.z,e.z),r.w=(0,E.Clamp)(w.w,p.w,e.w),r}static CheckExtends(w,p,e){p.minimizeInPlace(w),e.maximizeInPlace(w)}static get ZeroReadOnly(){return c._ZeroReadOnly}static Normalize(w){return c.NormalizeToRef(w,new c)}static NormalizeToRef(w,p){return w.normalizeToRef(p),p}static Minimize(w,p){const e=new c;return e.X(w),e.minimizeInPlace(p),e}static Maximize(w,p){const e=new c;return e.X(w),e.maximizeInPlace(p),e}static Distance(w,p){return Math.sqrt(c.DistanceSquared(w,p))}static DistanceSquared(w,p){const e=w.x-p.x,r=w.y-p.y,I=w.z-p.z,d=w.w-p.w;return e*e+r*r+I*I+d*d}static Center(w,p){return c.CenterToRef(w,p,new c)}static CenterToRef(w,p,e){return e.x=(w.x+p.x)/2,e.y=(w.y+p.y)/2,e.z=(w.z+p.z)/2,e.w=(w.w+p.w)/2,e}static TransformCoordinates(w,p){return c.TransformCoordinatesToRef(w,p,new c)}static TransformCoordinatesToRef(w,p,e){return c.TransformCoordinatesFromFloatsToRef(w._x,w._y,w._z,p,e),e}static TransformCoordinatesFromFloatsToRef(w,p,e,r,I){const d=r.m,f=w*d[0]+p*d[4]+e*d[8]+d[12],q=w*d[1]+p*d[5]+e*d[9]+d[13],E=w*d[2]+p*d[6]+e*d[10]+d[14],j=w*d[3]+p*d[7]+e*d[11]+d[15];return I.x=f,I.y=q,I.z=E,I.w=j,I}static TransformNormal(w,p){return c.TransformNormalToRef(w,p,new c)}static TransformNormalToRef(w,p,e){const r=p.m,I=w.x*r[0]+w.y*r[4]+w.z*r[8],d=w.x*r[1]+w.y*r[5]+w.z*r[9],f=w.x*r[2]+w.y*r[6]+w.z*r[10];return e.x=I,e.y=d,e.z=f,e.w=w.w,e}static TransformNormalFromFloatsToRef(w,p,e,r,I,d){const f=I.m;return d.x=w*f[0]+p*f[4]+e*f[8],d.y=w*f[1]+p*f[5]+e*f[9],d.z=w*f[2]+p*f[6]+e*f[10],d.w=r,d}static FromVector3(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(w._x,w._y,w._z,p)}static Dot(w,p){return w.x*p.x+w.y*p.y+w.z*p.z+w.w*p.w}}c._V8PerformanceHack=new c(.5,.5,.5,.5),c._ZeroReadOnly=c.Zero(),Object.defineProperties(c.prototype,{dimension:{value:[4]},rank:{value:1}});class s{get x(){return this._x}set x(w){this._x=w,this._isDirty=!0}get y(){return this._y}set y(w){this._y=w,this._isDirty=!0}get z(){return this._z}set z(w){this._z=w,this._isDirty=!0}get w(){return this._w}set w(w){this._w=w,this._isDirty=!0}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=w,this._y=p,this._z=e,this._w=r}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let w=J(this._x);return w=397*w^J(this._y),w=397*w^J(this._z),w=397*w^J(this._w),w}ze(){return[this._x,this._y,this._z,this._w]}toArray(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w[p]=this._x,w[p+1]=this._y,w[p+2]=this._z,w[p+3]=this._w,this}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s.FromArrayToRef(w,p,this)}equals(w){return w&&this._x===w._x&&this._y===w._y&&this._z===w._z&&this._w===w._w}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return w&&(0,E.WithinEpsilon)(this._x,w._x,p)&&(0,E.WithinEpsilon)(this._y,w._y,p)&&(0,E.WithinEpsilon)(this._z,w._z,p)&&(0,E.WithinEpsilon)(this._w,w._w,p)}isApprox(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return w&&((0,E.WithinEpsilon)(this._x,w._x,p)&&(0,E.WithinEpsilon)(this._y,w._y,p)&&(0,E.WithinEpsilon)(this._z,w._z,p)&&(0,E.WithinEpsilon)(this._w,w._w,p)||(0,E.WithinEpsilon)(this._x,-w._x,p)&&(0,E.WithinEpsilon)(this._y,-w._y,p)&&(0,E.WithinEpsilon)(this._z,-w._z,p)&&(0,E.WithinEpsilon)(this._w,-w._w,p))}clone(){return new s(this._x,this._y,this._z,this._w)}X(w){return this._x=w._x,this._y=w._y,this._z=w._z,this._w=w._w,this._isDirty=!0,this}te(w,p,e,r){return this._x=w,this._y=p,this._z=e,this._w=r,this._isDirty=!0,this}set(w,p,e,r){return this.te(w,p,e,r)}Pe(w){return this.te(w,w,w,w)}add(w){return new s(this._x+w._x,this._y+w._y,this._z+w._z,this._w+w._w)}addInPlace(w){return this._x+=w._x,this._y+=w._y,this._z+=w._z,this._w+=w._w,this._isDirty=!0,this}addToRef(w,p){return p._x=this._x+w._x,p._y=this._y+w._y,p._z=this._z+w._z,p._w=this._w+w._w,p._isDirty=!0,p}addInPlaceFromFloats(w,p,e,r){return this._x+=w,this._y+=p,this._z+=e,this._w+=r,this._isDirty=!0,this}subtractToRef(w,p){return p._x=this._x-w._x,p._y=this._y-w._y,p._z=this._z-w._z,p._w=this._w-w._w,p._isDirty=!0,p}subtractFromFloats(w,p,e,r){return this.subtractFromFloatsToRef(w,p,e,r,new s)}subtractFromFloatsToRef(w,p,e,r,I){return I._x=this._x-w,I._y=this._y-p,I._z=this._z-e,I._w=this._w-r,I._isDirty=!0,I}Je(w){return new s(this._x-w._x,this._y-w._y,this._z-w._z,this._w-w._w)}zk(w){return this._x-=w._x,this._y-=w._y,this._z-=w._z,this._w-=w._w,this._isDirty=!0,this}scale(w){return new s(this._x*w,this._y*w,this._z*w,this._w*w)}scaleToRef(w,p){return p._x=this._x*w,p._y=this._y*w,p._z=this._z*w,p._w=this._w*w,p._isDirty=!0,p}scaleInPlace(w){return this._x*=w,this._y*=w,this._z*=w,this._w*=w,this._isDirty=!0,this}scaleAndAddToRef(w,p){return p._x+=this._x*w,p._y+=this._y*w,p._z+=this._z*w,p._w+=this._w*w,p._isDirty=!0,p}multiply(w){const p=new s(0,0,0,1);return this.multiplyToRef(w,p),p}multiplyToRef(w,p){const e=this._x*w._w+this._y*w._z-this._z*w._y+this._w*w._x,r=-this._x*w._z+this._y*w._w+this._z*w._x+this._w*w._y,I=this._x*w._y-this._y*w._x+this._z*w._w+this._w*w._z,d=-this._x*w._x-this._y*w._y-this._z*w._z+this._w*w._w;return p.te(e,r,I,d),p}multiplyInPlace(w){return this.multiplyToRef(w,this)}multiplyByFloats(w,p,e,r){return this._x*=w,this._y*=p,this._z*=e,this._w*=r,this._isDirty=!0,this}divide(w){throw new ReferenceError("Can not divide a quaternion")}divideToRef(w,p){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(w){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new s)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(w){return w._x=-this._x,w._y=-this._y,w._z=-this._z,w._w=-this._w,w._isDirty=!0,w}equalsToFloats(w,p,e,r){return this._x===w&&this._y===p&&this._z===e&&this._w===r}floorToRef(w){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(w){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(w){return w.te(-this._x,-this._y,-this._z,this._w),w}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new s(-this._x,-this._y,-this._z,this._w)}invert(){const w=this.conjugate(),p=this.lengthSquared();return 0==p||1==p||w.scaleInPlace(1/p),w}invertInPlace(){this.conjugateInPlace();const w=this.lengthSquared();return 0==w||1==w||this.scaleInPlace(1/w),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(w){return 0===w||1===w?this:this.scaleInPlace(1/w)}normalizeToNew(){const w=new s(0,0,0,1);return this.normalizeToRef(w),w}normalizeToRef(w){const p=this.length();return 0===p||1===p?w.te(this._x,this._y,this._z,this._w):this.scaleToRef(1/p,w)}toEulerAngles(){const w=y.Zero();return this.toEulerAnglesToRef(w),w}toEulerAnglesToRef(w){const p=this._z,e=this._x,r=this._y,I=this._w,d=r*p-e*I,f=.4999999;if(d<-f)w._y=2*Math.atan2(r,I),w._x=Math.PI/2,w._z=0,w._isDirty=!0;else if(d>f)w._y=2*Math.atan2(r,I),w._x=-Math.PI/2,w._z=0,w._isDirty=!0;else{const f=I*I,q=p*p,E=e*e,j=r*r;w._z=Math.atan2(2*(e*r+p*I),-q-E+j+f),w._x=Math.asin(-2*d),w._y=Math.atan2(2*(p*e+r*I),q-E-j+f),w._isDirty=!0}return w}toAlphaBetaGammaToRef(w){const p=this._z,e=this._x,r=this._y,I=this._w,d=Math.sqrt(e*e+r*r),f=Math.sqrt(p*p+I*I),q=2*Math.atan2(d,f),E=2*Math.atan2(p,I),j=2*Math.atan2(r,e),X=(E+j)/2,k=(E-j)/2;return w.set(k,q,X),w}toRotationMatrix(w){return O.FromQuaternionToRef(this,w),w}fromRotationMatrix(w){return s.FromRotationMatrixToRef(w,this),this}dot(w){return this._x*w._x+this._y*w._y+this._z*w._z+this._w*w._w}toAxisAngle(){const w=y.Zero();return{axis:w,angle:this.toAxisAngleToRef(w)}}toAxisAngleToRef(w){let p=0;const e=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),r=this._w;return e>0?(p=2*Math.atan2(e,r),w.set(this._x/e,this._y/e,this._z/e)):(p=0,w.set(1,0,0)),p}static FromRotationMatrix(w){const p=new s;return s.FromRotationMatrixToRef(w,p),p}static FromRotationMatrixToRef(w,p){const e=w.m,r=e[0],I=e[4],d=e[8],f=e[1],q=e[5],E=e[9],j=e[2],X=e[6],k=e[10],m=r+q+k;let J;return m>0?(J=.5/Math.sqrt(m+1),p._w=.25/J,p._x=(X-E)*J,p._y=(d-j)*J,p._z=(f-I)*J,p._isDirty=!0):r>q&&r>k?(J=2*Math.sqrt(1+r-q-k),p._w=(X-E)/J,p._x=.25*J,p._y=(I+f)/J,p._z=(d+j)/J,p._isDirty=!0):q>k?(J=2*Math.sqrt(1+q-r-k),p._w=(d-j)/J,p._x=(I+f)/J,p._y=.25*J,p._z=(E+X)/J,p._isDirty=!0):(J=2*Math.sqrt(1+k-r-q),p._w=(f-I)/J,p._x=(d+j)/J,p._y=(E+X)/J,p._z=.25*J,p._isDirty=!0),p}static Dot(w,p){return w._x*p._x+w._y*p._y+w._z*p._z+w._w*p._w}static AreClose(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const r=s.Dot(w,p);return 1-r*r<=e}static SmoothToRef(w,p,e,r,I){let d=0===r?1:e/r;return d=(0,E.Clamp)(d,0,1),s.SlerpToRef(w,p,d,I),I}static Zero(){return new s(0,0,0,0)}static Inverse(w){return new s(-w._x,-w._y,-w._z,w._w)}static InverseToRef(w,p){return p.set(-w._x,-w._y,-w._z,w._w),p}static Identity(){return new s(0,0,0,1)}static IsIdentity(w){return w&&0===w._x&&0===w._y&&0===w._z&&1===w._w}static RotationAxis(w,p){return s.RotationAxisToRef(w,p,new s)}static RotationAxisToRef(w,p,e){e._w=Math.cos(p/2);const r=Math.sin(p/2)/w.length();return e._x=w._x*r,e._y=w._y*r,e._z=w._z*r,e._isDirty=!0,e}static Ve(w,p){return p||(p=0),new s(w[p],w[p+1],w[p+2],w[p+3])}static FromArrayToRef(w,p,e){return e._x=w[p],e._y=w[p+1],e._z=w[p+2],e._w=w[p+3],e._isDirty=!0,e}static FromFloatsToRef(w,p,e,r,I){return I.te(w,p,e,r),I}static FromEulerAngles(w,p,e){const r=new s;return s.RotationYawPitchRollToRef(p,w,e,r),r}static FromEulerAnglesToRef(w,p,e,r){return s.RotationYawPitchRollToRef(p,w,e,r),r}static FromEulerVector(w){const p=new s;return s.RotationYawPitchRollToRef(w._y,w._x,w._z,p),p}static FromEulerVectorToRef(w,p){return s.RotationYawPitchRollToRef(w._y,w._x,w._z,p),p}static FromUnitVectorsToRef(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.c;const d=y.Dot(w,p)+1;return d<I?Math.abs(w.x)>Math.abs(w.z)?e.set(-w.y,w.x,0,0):e.set(0,-w.z,w.y,0):(y.CrossToRef(w,p,A.ne[0]),e.set(A.ne[0].x,A.ne[0].y,A.ne[0].z,d)),e.normalize()}static RotationYawPitchRoll(w,p,e){const r=new s;return s.RotationYawPitchRollToRef(w,p,e,r),r}static RotationYawPitchRollToRef(w,p,e,r){const I=.5*e,d=.5*p,f=.5*w,q=Math.sin(I),E=Math.cos(I),j=Math.sin(d),X=Math.cos(d),k=Math.sin(f),m=Math.cos(f);return r._x=m*j*E+k*X*q,r._y=k*X*E-m*j*q,r._z=m*X*q-k*j*E,r._w=m*X*E+k*j*q,r._isDirty=!0,r}static RotationAlphaBetaGamma(w,p,e){const r=new s;return s.RotationAlphaBetaGammaToRef(w,p,e,r),r}static RotationAlphaBetaGammaToRef(w,p,e,r){const I=.5*(e+w),d=.5*(e-w),f=.5*p;return r._x=Math.cos(d)*Math.sin(f),r._y=Math.sin(d)*Math.sin(f),r._z=Math.sin(I)*Math.cos(f),r._w=Math.cos(I)*Math.cos(f),r._isDirty=!0,r}static RotationQuaternionFromAxis(w,p,e){const r=new s(0,0,0,0);return s.RotationQuaternionFromAxisToRef(w,p,e,r),r}static RotationQuaternionFromAxisToRef(w,p,e,r){const I=a.Matrix[0];return w=w.normalizeToRef(a.ne[0]),p=p.normalizeToRef(a.ne[1]),e=e.normalizeToRef(a.ne[2]),O.FromXYZAxesToRef(w,p,e,I),s.FromRotationMatrixToRef(I,r),r}static FromLookDirectionLH(w,p){const e=new s;return s.FromLookDirectionLHToRef(w,p,e),e}static FromLookDirectionLHToRef(w,p,e){const r=a.Matrix[0];return O.LookDirectionLHToRef(w,p,r),s.FromRotationMatrixToRef(r,e),e}static FromLookDirectionRH(w,p){const e=new s;return s.FromLookDirectionRHToRef(w,p,e),e}static FromLookDirectionRHToRef(w,p,e){const r=a.Matrix[0];return O.LookDirectionRHToRef(w,p,r),s.FromRotationMatrixToRef(r,e)}static Slerp(w,p,e){const r=s.Identity();return s.SlerpToRef(w,p,e,r),r}static SlerpToRef(w,p,e,r){let I,d,f=w._x*p._x+w._y*p._y+w._z*p._z+w._w*p._w,q=!1;if(f<0&&(q=!0,f=-f),f>.999999)d=1-e,I=q?-e:e;else{const w=Math.acos(f),p=1/Math.sin(w);d=Math.sin((1-e)*w)*p,I=q?-Math.sin(e*w)*p:Math.sin(e*w)*p}return r._x=d*w._x+I*p._x,r._y=d*w._y+I*p._y,r._z=d*w._z+I*p._z,r._w=d*w._w+I*p._w,r._isDirty=!0,r}static Hermite(w,p,e,r,I){const d=I*I,f=I*d,q=2*f-3*d+1,E=-2*f+3*d,j=f-2*d+I,X=f-d,k=w._x*q+e._x*E+p._x*j+r._x*X,m=w._y*q+e._y*E+p._y*j+r._y*X,J=w._z*q+e._z*E+p._z*j+r._z*X,K=w._w*q+e._w*E+p._w*j+r._w*X;return new s(k,m,J,K)}static Hermite1stDerivative(w,p,e,r,I){const d=new s;return this.Hermite1stDerivativeToRef(w,p,e,r,I,d),d}static Hermite1stDerivativeToRef(w,p,e,r,I,d){const f=I*I;return d._x=6*(f-I)*w._x+(3*f-4*I+1)*p._x+6*(-f+I)*e._x+(3*f-2*I)*r._x,d._y=6*(f-I)*w._y+(3*f-4*I+1)*p._y+6*(-f+I)*e._y+(3*f-2*I)*r._y,d._z=6*(f-I)*w._z+(3*f-4*I+1)*p._z+6*(-f+I)*e._z+(3*f-2*I)*r._z,d._w=6*(f-I)*w._w+(3*f-4*I+1)*p._w+6*(-f+I)*e._w+(3*f-2*I)*r._w,d._isDirty=!0,d}static Normalize(w){const p=s.Zero();return s.NormalizeToRef(w,p),p}static NormalizeToRef(w,p){return w.normalizeToRef(p),p}static Clamp(w,p,e){const r=new s;return s.ClampToRef(w,p,e,r),r}static ClampToRef(w,p,e,r){return r.te((0,E.Clamp)(w.x,p.x,e.x),(0,E.Clamp)(w.y,p.y,e.y),(0,E.Clamp)(w.z,p.z,e.z),(0,E.Clamp)(w.w,p.w,e.w))}static Random(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new s((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static RandomToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).te((0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p),(0,E.RandomRange)(w,p))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(w,p){return Math.sqrt(s.DistanceSquared(w,p))}static DistanceSquared(w,p){const e=w.x-p.x,r=w.y-p.y,I=w.z-p.z,d=w.w-p.w;return e*e+r*r+I*I+d*d}static Center(w,p){return s.CenterToRef(w,p,s.Zero())}static CenterToRef(w,p,e){return e.te((w.x+p.x)/2,(w.y+p.y)/2,(w.z+p.z)/2,(w.w+p.w)/2)}}s._V8PerformanceHack=new s(.5,.5,.5,.5),Object.defineProperties(s.prototype,{dimension:{value:[4]},rank:{value:1}});class O{static get Use64Bits(){return f.e.MatrixUse64Bits}get m(){return this.gm}markAsUpdated(){this.updateFlag=j._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=w,this._isIdentity3x2=w||e,this._isIdentityDirty=!this._isIdentity&&p,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,f.e.MatrixTrackPrecisionChange&&f.e.MatrixTrackedMatrices.push(this),this.gm=new f.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const w=this.gm;this._isIdentity=1===w[0]&&0===w[1]&&0===w[2]&&0===w[3]&&0===w[4]&&1===w[5]&&0===w[6]&&0===w[7]&&0===w[8]&&0===w[9]&&1===w[10]&&0===w[11]&&0===w[12]&&0===w[13]&&0===w[14]&&1===w[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.gm[0]||1!==this.gm[5]||1!==this.gm[15]||0!==this.gm[1]||0!==this.gm[2]||0!==this.gm[3]||0!==this.gm[4]||0!==this.gm[6]||0!==this.gm[7]||0!==this.gm[8]||0!==this.gm[9]||0!==this.gm[10]||0!==this.gm[11]||0!==this.gm[12]||0!==this.gm[13]||0!==this.gm[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const w=this.gm,p=w[0],e=w[1],r=w[2],I=w[3],d=w[4],f=w[5],q=w[6],E=w[7],j=w[8],X=w[9],k=w[10],m=w[11],J=w[12],K=w[13],y=w[14],c=w[15],s=k*c-y*m,O=X*c-K*m,a=X*y-K*k,A=j*c-J*m,z=j*y-k*J,M=j*K-J*X;return p*+(f*s-q*O+E*a)+e*-(d*s-q*A+E*z)+r*+(d*O-f*A+E*M)+I*-(d*a-f*z+q*M)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!w)return this.gm;const e=this.gm;for(let r=0;r<16;r++)w[p+r]=e[r];return this}ze(){return this.gm}ye(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O.FromArrayToRef(w,p,this)}te(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];return O.FromArrayToRef(p,0,this)}set(){const w=this.gm;for(let p=0;p<16;p++)w[p]=p<0||arguments.length<=p?void 0:arguments[p];return this.markAsUpdated(),this}Pe(w){const p=this.gm;for(let e=0;e<16;e++)p[e]=w;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return O.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(w){const p=new O;return this.addToRef(w,p),p}addToRef(w,p){const e=this.gm,r=p.gm,I=w.m;for(let d=0;d<16;d++)r[d]=e[d]+I[d];return p.markAsUpdated(),p}addToSelf(w){const p=this.gm,e=w.m;return p[0]+=e[0],p[1]+=e[1],p[2]+=e[2],p[3]+=e[3],p[4]+=e[4],p[5]+=e[5],p[6]+=e[6],p[7]+=e[7],p[8]+=e[8],p[9]+=e[9],p[10]+=e[10],p[11]+=e[11],p[12]+=e[12],p[13]+=e[13],p[14]+=e[14],p[15]+=e[15],this.markAsUpdated(),this}addInPlace(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]+=e[r];return this.markAsUpdated(),this}addInPlaceFromFloats(){const w=this.gm;for(let p=0;p<16;p++)w[p]+=p<0||arguments.length<=p?void 0:arguments[p];return this.markAsUpdated(),this}Je(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]-=e[r];return this.markAsUpdated(),this}subtractToRef(w,p){const e=this.gm,r=w.m,I=p.gm;for(let d=0;d<16;d++)I[d]=e[d]-r[d];return p.markAsUpdated(),p}zk(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]-=e[r];return this.markAsUpdated(),this}subtractFromFloats(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];return this.subtractFromFloatsToRef(...p,new O)}subtractFromFloatsToRef(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];const r=p.pop(),I=this.gm,d=r.gm,f=p;for(let q=0;q<16;q++)d[q]=I[q]-f[q];return r.markAsUpdated(),r}invertToRef(w){return!0===this._isIdentity?(O.IdentityToRef(w),w):(m(this,w.ze())?w.markAsUpdated():w.X(this),w)}addAtIndex(w,p){return this.gm[w]+=p,this.markAsUpdated(),this}multiplyAtIndex(w,p){return this.gm[w]*=p,this.markAsUpdated(),this}setTranslationFromFloats(w,p,e){return this.gm[12]=w,this.gm[13]=p,this.gm[14]=e,this.markAsUpdated(),this}addTranslationFromFloats(w,p,e){return this.gm[12]+=w,this.gm[13]+=p,this.gm[14]+=e,this.markAsUpdated(),this}setTranslation(w){return this.setTranslationFromFloats(w._x,w._y,w._z)}getTranslation(){return new y(this.gm[12],this.gm[13],this.gm[14])}getTranslationToRef(w){return w.x=this.gm[12],w.y=this.gm[13],w.z=this.gm[14],w}removeRotationAndScaling(){const w=this.m;return O.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,w[12],w[13],w[14],w[15],this),this._updateIdentityStatus(0===w[12]&&0===w[13]&&0===w[14]&&1===w[15]),this}X(w){w.copyToArray(this.gm);const p=w;return this.updateFlag=p.updateFlag,this._updateIdentityStatus(p._isIdentity,p._isIdentityDirty,p._isIdentity3x2,p._isIdentity3x2Dirty),this}copyToArray(w){return k(this,w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(w){const p=new O;return this.multiplyToRef(w,p),p}multiplyInPlace(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]*=e[r];return this.markAsUpdated(),this}multiplyByFloats(){const w=this.gm;for(let p=0;p<16;p++)w[p]*=p<0||arguments.length<=p?void 0:arguments[p];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];const r=p.pop(),I=this.gm,d=r.gm,f=p;for(let q=0;q<16;q++)d[q]=I[q]*f[q];return r.markAsUpdated(),r}multiplyToRef(w,p){return this._isIdentity?(p.X(w),p):w._isIdentity?(p.X(this),p):(this.multiplyToArray(w,p.gm,0),p.markAsUpdated(),p)}multiplyToArray(w,p,e){return X(this,w,p,e),this}divide(w){return this.divideToRef(w,new O)}divideToRef(w,p){const e=this.gm,r=w.m,I=p.gm;for(let d=0;d<16;d++)I[d]=e[d]/r[d];return p.markAsUpdated(),p}divideInPlace(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]/=e[r];return this.markAsUpdated(),this}minimizeInPlace(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]=Math.min(p[r],e[r]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const w=this.gm;for(let p=0;p<16;p++)w[p]=Math.min(w[p],p<0||arguments.length<=p?void 0:arguments[p]);return this.markAsUpdated(),this}maximizeInPlace(w){const p=this.gm,e=w.m;for(let r=0;r<16;r++)p[r]=Math.min(p[r],e[r]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const w=this.gm;for(let p=0;p<16;p++)w[p]=Math.min(w[p],p<0||arguments.length<=p?void 0:arguments[p]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new O)}negateInPlace(){const w=this.gm;for(let p=0;p<16;p++)w[p]=-w[p];return this.markAsUpdated(),this}negateToRef(w){const p=this.gm,e=w.gm;for(let r=0;r<16;r++)e[r]=-p[r];return w.markAsUpdated(),w}equals(w){const p=w;if(!p)return!1;if((this._isIdentity||p._isIdentity)&&!this._isIdentityDirty&&!p._isIdentityDirty)return this._isIdentity&&p._isIdentity;const e=this.m,r=p.m;return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}equalsWithEpsilon(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.gm,r=w.m;for(let I=0;I<16;I++)if(!(0,E.WithinEpsilon)(e[I],r[I],p))return!1;return!0}equalsToFloats(){const w=this.gm;for(let p=0;p<16;p++)if(w[p]!=(p<0||arguments.length<=p?void 0:arguments[p]))return!1;return!0}floor(){return this.floorToRef(new O)}floorToRef(w){const p=this.gm,e=w.gm;for(let r=0;r<16;r++)e[r]=Math.floor(p[r]);return w.markAsUpdated(),w}fract(){return this.fractToRef(new O)}fractToRef(w){const p=this.gm,e=w.gm;for(let r=0;r<16;r++)e[r]=p[r]-Math.floor(p[r]);return w.markAsUpdated(),w}clone(){const w=new O;return w.X(this),w}getClassName(){return"Matrix"}getHashCode(){let w=J(this.gm[0]);for(let p=1;p<16;p++)w=397*w^J(this.gm[p]);return w}decomposeToTransformNode(w){return w.rotationQuaternion=w.rotationQuaternion||new s,this.decompose(w.Ne,w.rotationQuaternion,w.position)}decompose(w,p,e,r){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return e&&e.Pe(0),w&&w.Pe(1),p&&p.te(0,0,0,1),!0;const d=this.gm;if(e&&e.te(d[12],d[13],d[14]),(w=w||a.ne[0]).x=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),w.y=Math.sqrt(d[4]*d[4]+d[5]*d[5]+d[6]*d[6]),w.z=Math.sqrt(d[8]*d[8]+d[9]*d[9]+d[10]*d[10]),r){const p=(I?r.absoluteScaling.x:r.Ne.x)<0?-1:1,e=(I?r.absoluteScaling.y:r.Ne.y)<0?-1:1,d=(I?r.absoluteScaling.z:r.Ne.z)<0?-1:1;w.x*=p,w.y*=e,w.z*=d}else this.determinant()<=0&&(w.y*=-1);if(0===w._x||0===w._y||0===w._z)return p&&p.te(0,0,0,1),!1;if(p){const e=1/w._x,r=1/w._y,I=1/w._z;O.FromValuesToRef(d[0]*e,d[1]*e,d[2]*e,0,d[4]*r,d[5]*r,d[6]*r,0,d[8]*I,d[9]*I,d[10]*I,0,0,0,0,1,a.Matrix[0]),s.FromRotationMatrixToRef(a.Matrix[0],p)}return!0}getRow(w){if(w<0||w>3)return null;const p=4*w;return new c(this.gm[p+0],this.gm[p+1],this.gm[p+2],this.gm[p+3])}getRowToRef(w,p){if(w>=0&&w<=3){const e=4*w;p.x=this.gm[e+0],p.y=this.gm[e+1],p.z=this.gm[e+2],p.w=this.gm[e+3]}return p}setRow(w,p){return this.setRowFromFloats(w,p.x,p.y,p.z,p.w)}transpose(){const w=new O;return O.TransposeToRef(this,w),w}transposeToRef(w){return O.TransposeToRef(this,w),w}setRowFromFloats(w,p,e,r,I){if(w<0||w>3)return this;const d=4*w;return this.gm[d+0]=p,this.gm[d+1]=e,this.gm[d+2]=r,this.gm[d+3]=I,this.markAsUpdated(),this}scale(w){const p=new O;return this.scaleToRef(w,p),p}scaleToRef(w,p){for(let e=0;e<16;e++)p.gm[e]=this.gm[e]*w;return p.markAsUpdated(),p}scaleAndAddToRef(w,p){for(let e=0;e<16;e++)p.gm[e]+=this.gm[e]*w;return p.markAsUpdated(),p}scaleInPlace(w){const p=this.gm;for(let e=0;e<16;e++)p[e]*=w;return this.markAsUpdated(),this}toNormalMatrix(w){const p=a.Matrix[0];this.invertToRef(p),p.transposeToRef(w);const e=w.gm;return O.FromValuesToRef(e[0],e[1],e[2],0,e[4],e[5],e[6],0,e[8],e[9],e[10],0,0,0,0,1,w),w}getRotationMatrix(){const w=new O;return this.getRotationMatrixToRef(w),w}getRotationMatrixToRef(w){const p=a.ne[0];if(!this.decompose(p))return O.IdentityToRef(w),w;const e=this.gm,r=1/p._x,I=1/p._y,d=1/p._z;return O.FromValuesToRef(e[0]*r,e[1]*r,e[2]*r,0,e[4]*I,e[5]*I,e[6]*I,0,e[8]*d,e[9]*d,e[10]*d,0,0,0,0,1,w),w}toggleModelMatrixHandInPlace(){const w=this.gm;return w[2]*=-1,w[6]*=-1,w[8]*=-1,w[9]*=-1,w[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const w=this.gm;return w[8]*=-1,w[9]*=-1,w[10]*=-1,w[11]*=-1,this.markAsUpdated(),this}static Ve(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=new O;return O.FromArrayToRef(w,p,e),e}static FromArrayToRef(w,p,e){for(let r=0;r<16;r++)e.gm[r]=w[r+p];return e.markAsUpdated(),e}static FromFloat32ArrayToRefScaled(w,p,e,r){return r.gm[0]=w[0+p]*e,r.gm[1]=w[1+p]*e,r.gm[2]=w[2+p]*e,r.gm[3]=w[3+p]*e,r.gm[4]=w[4+p]*e,r.gm[5]=w[5+p]*e,r.gm[6]=w[6+p]*e,r.gm[7]=w[7+p]*e,r.gm[8]=w[8+p]*e,r.gm[9]=w[9+p]*e,r.gm[10]=w[10+p]*e,r.gm[11]=w[11+p]*e,r.gm[12]=w[12+p]*e,r.gm[13]=w[13+p]*e,r.gm[14]=w[14+p]*e,r.gm[15]=w[15+p]*e,r.markAsUpdated(),r}static get IdentityReadOnly(){return O._IdentityReadOnly}static FromValuesToRef(w,p,e,r,I,d,f,q,E,j,X,k,m,J,K,y,c){const s=c.gm;s[0]=w,s[1]=p,s[2]=e,s[3]=r,s[4]=I,s[5]=d,s[6]=f,s[7]=q,s[8]=E,s[9]=j,s[10]=X,s[11]=k,s[12]=m,s[13]=J,s[14]=K,s[15]=y,c.markAsUpdated()}static FromValues(w,p,e,r,I,d,f,q,E,j,X,k,m,J,K,y){const c=new O,s=c.gm;return s[0]=w,s[1]=p,s[2]=e,s[3]=r,s[4]=I,s[5]=d,s[6]=f,s[7]=q,s[8]=E,s[9]=j,s[10]=X,s[11]=k,s[12]=m,s[13]=J,s[14]=K,s[15]=y,c.markAsUpdated(),c}static Compose(w,p,e){const r=new O;return O.ComposeToRef(w,p,e,r),r}static ComposeToRef(w,p,e,r){const I=r.gm,d=p._x,f=p._y,q=p._z,E=p._w,j=d+d,X=f+f,k=q+q,m=d*j,J=d*X,K=d*k,y=f*X,c=f*k,s=q*k,O=E*j,a=E*X,A=E*k,z=w._x,M=w._y,i=w._z;return I[0]=(1-(y+s))*z,I[1]=(J+A)*z,I[2]=(K-a)*z,I[3]=0,I[4]=(J-A)*M,I[5]=(1-(m+s))*M,I[6]=(c+O)*M,I[7]=0,I[8]=(K+a)*i,I[9]=(c-O)*i,I[10]=(1-(m+y))*i,I[11]=0,I[12]=e._x,I[13]=e._y,I[14]=e._z,I[15]=1,r.markAsUpdated(),r}static Identity(){const w=O.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return w._updateIdentityStatus(!0),w}static IdentityToRef(w){return O.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,w),w._updateIdentityStatus(!0),w}static Zero(){const w=O.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return w._updateIdentityStatus(!1),w}static RotationX(w){const p=new O;return O.RotationXToRef(w,p),p}static Invert(w){const p=new O;return w.invertToRef(p),p}static RotationXToRef(w,p){const e=Math.sin(w),r=Math.cos(w);return O.FromValuesToRef(1,0,0,0,0,r,e,0,0,-e,r,0,0,0,0,1,p),p._updateIdentityStatus(1===r&&0===e),p}static RotationY(w){const p=new O;return O.RotationYToRef(w,p),p}static RotationYToRef(w,p){const e=Math.sin(w),r=Math.cos(w);return O.FromValuesToRef(r,0,-e,0,0,1,0,0,e,0,r,0,0,0,0,1,p),p._updateIdentityStatus(1===r&&0===e),p}static RotationZ(w){const p=new O;return O.RotationZToRef(w,p),p}static RotationZToRef(w,p){const e=Math.sin(w),r=Math.cos(w);return O.FromValuesToRef(r,e,0,0,-e,r,0,0,0,0,1,0,0,0,0,1,p),p._updateIdentityStatus(1===r&&0===e),p}static RotationAxis(w,p){const e=new O;return O.RotationAxisToRef(w,p,e),e}static RotationAxisToRef(w,p,e){const r=Math.sin(-p),I=Math.cos(-p),d=1-I;w=w.normalizeToRef(a.ne[0]);const f=e.gm;return f[0]=w._x*w._x*d+I,f[1]=w._x*w._y*d-w._z*r,f[2]=w._x*w._z*d+w._y*r,f[3]=0,f[4]=w._y*w._x*d+w._z*r,f[5]=w._y*w._y*d+I,f[6]=w._y*w._z*d-w._x*r,f[7]=0,f[8]=w._z*w._x*d-w._y*r,f[9]=w._z*w._y*d+w._x*r,f[10]=w._z*w._z*d+I,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,e.markAsUpdated(),e}static RotationAlignToRef(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=y.Dot(p,w),f=e.gm;if(d<-1+r.c)f[0]=-1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=I?1:-1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=I?-1:1,f[11]=0;else{const e=y.Cross(p,w),r=1/(1+d);f[0]=e._x*e._x*r+d,f[1]=e._y*e._x*r-e._z,f[2]=e._z*e._x*r+e._y,f[3]=0,f[4]=e._x*e._y*r+e._z,f[5]=e._y*e._y*r+d,f[6]=e._z*e._y*r-e._x,f[7]=0,f[8]=e._x*e._z*r-e._y,f[9]=e._y*e._z*r+e._x,f[10]=e._z*e._z*r+d,f[11]=0}return f[12]=0,f[13]=0,f[14]=0,f[15]=1,e.markAsUpdated(),e}static RotationYawPitchRoll(w,p,e){const r=new O;return O.RotationYawPitchRollToRef(w,p,e,r),r}static RotationYawPitchRollToRef(w,p,e,r){return s.RotationYawPitchRollToRef(w,p,e,a.Quaternion[0]),a.Quaternion[0].toRotationMatrix(r),r}static Scaling(w,p,e){const r=new O;return O.ScalingToRef(w,p,e,r),r}static ScalingToRef(w,p,e,r){return O.FromValuesToRef(w,0,0,0,0,p,0,0,0,0,e,0,0,0,0,1,r),r._updateIdentityStatus(1===w&&1===p&&1===e),r}static Translation(w,p,e){const r=new O;return O.TranslationToRef(w,p,e,r),r}static TranslationToRef(w,p,e,r){return O.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,w,p,e,1,r),r._updateIdentityStatus(0===w&&0===p&&0===e),r}static Lerp(w,p,e){const r=new O;return O.LerpToRef(w,p,e,r),r}static LerpToRef(w,p,e,r){const I=r.gm,d=w.m,f=p.m;for(let q=0;q<16;q++)I[q]=d[q]*(1-e)+f[q]*e;return r.markAsUpdated(),r}static DecomposeLerp(w,p,e){const r=new O;return O.DecomposeLerpToRef(w,p,e,r),r}static DecomposeLerpToRef(w,p,e,r){const I=a.ne[0],d=a.Quaternion[0],f=a.ne[1];w.decompose(I,d,f);const q=a.ne[2],E=a.Quaternion[1],j=a.ne[3];p.decompose(q,E,j);const X=a.ne[4];y.LerpToRef(I,q,e,X);const k=a.Quaternion[2];s.SlerpToRef(d,E,e,k);const m=a.ne[5];return y.LerpToRef(f,j,e,m),O.ComposeToRef(X,k,m,r),r}static LookAtLH(w,p,e){const r=new O;return O.LookAtLHToRef(w,p,e,r),r}static LookAtLHToRef(w,p,e,r){const I=a.ne[0],d=a.ne[1],f=a.ne[2];p.subtractToRef(w,f),f.normalize(),y.CrossToRef(e,f,I);const q=I.lengthSquared();0===q?I.x=1:I.normalizeFromLength(Math.sqrt(q)),y.CrossToRef(f,I,d),d.normalize();const E=-y.Dot(I,w),j=-y.Dot(d,w),X=-y.Dot(f,w);return O.FromValuesToRef(I._x,d._x,f._x,0,I._y,d._y,f._y,0,I._z,d._z,f._z,0,E,j,X,1,r),r}static LookAtRH(w,p,e){const r=new O;return O.LookAtRHToRef(w,p,e,r),r}static LookAtRHToRef(w,p,e,r){const I=a.ne[0],d=a.ne[1],f=a.ne[2];w.subtractToRef(p,f),f.normalize(),y.CrossToRef(e,f,I);const q=I.lengthSquared();0===q?I.x=1:I.normalizeFromLength(Math.sqrt(q)),y.CrossToRef(f,I,d),d.normalize();const E=-y.Dot(I,w),j=-y.Dot(d,w),X=-y.Dot(f,w);return O.FromValuesToRef(I._x,d._x,f._x,0,I._y,d._y,f._y,0,I._z,d._z,f._z,0,E,j,X,1,r),r}static LookDirectionLH(w,p){const e=new O;return O.LookDirectionLHToRef(w,p,e),e}static LookDirectionLHToRef(w,p,e){const r=a.ne[0];r.X(w),r.scaleInPlace(-1);const I=a.ne[1];return y.CrossToRef(p,r,I),O.FromValuesToRef(I._x,I._y,I._z,0,p._x,p._y,p._z,0,r._x,r._y,r._z,0,0,0,0,1,e),e}static LookDirectionRH(w,p){const e=new O;return O.LookDirectionRHToRef(w,p,e),e}static LookDirectionRHToRef(w,p,e){const r=a.ne[2];return y.CrossToRef(p,w,r),O.FromValuesToRef(r._x,r._y,r._z,0,p._x,p._y,p._z,0,w._x,w._y,w._z,0,0,0,0,1,e),e}static OrthoLH(w,p,e,r,I){const d=new O;return O.OrthoLHToRef(w,p,e,r,d,I),d}static OrthoLHToRef(w,p,e,r,I,d){const f=2/w,q=2/p,E=2/(r-e),j=-(r+e)/(r-e);return O.FromValuesToRef(f,0,0,0,0,q,0,0,0,0,E,0,0,0,j,1,I),d&&I.multiplyToRef(z,I),I._updateIdentityStatus(1===f&&1===q&&1===E&&0===j),I}static OrthoOffCenterLH(w,p,e,r,I,d,f){const q=new O;return O.OrthoOffCenterLHToRef(w,p,e,r,I,d,q,f),q}static OrthoOffCenterLHToRef(w,p,e,r,I,d,f,q){const E=2/(p-w),j=2/(r-e),X=2/(d-I),k=-(d+I)/(d-I),m=(w+p)/(w-p),J=(r+e)/(e-r);return O.FromValuesToRef(E,0,0,0,0,j,0,0,0,0,X,0,m,J,k,1,f),q&&f.multiplyToRef(z,f),f.markAsUpdated(),f}static ObliqueOffCenterLHToRef(w,p,e,r,I,d,f,q,E,j,X){const k=-f*Math.cos(q),m=-f*Math.sin(q);return O.TranslationToRef(0,0,-E,a.Matrix[1]),O.FromValuesToRef(1,0,0,0,0,1,0,0,k,m,1,0,0,0,0,1,a.Matrix[0]),a.Matrix[1].multiplyToRef(a.Matrix[0],a.Matrix[0]),O.TranslationToRef(0,0,E,a.Matrix[1]),a.Matrix[0].multiplyToRef(a.Matrix[1],a.Matrix[0]),O.OrthoOffCenterLHToRef(w,p,e,r,I,d,j,X),a.Matrix[0].multiplyToRef(j,j),j}static OrthoOffCenterRH(w,p,e,r,I,d,f){const q=new O;return O.OrthoOffCenterRHToRef(w,p,e,r,I,d,q,f),q}static OrthoOffCenterRHToRef(w,p,e,r,I,d,f,q){return O.OrthoOffCenterLHToRef(w,p,e,r,I,d,f,q),f.gm[10]*=-1,f}static ObliqueOffCenterRHToRef(w,p,e,r,I,d,f,q,E,j,X){const k=f*Math.cos(q),m=f*Math.sin(q);return O.TranslationToRef(0,0,E,a.Matrix[1]),O.FromValuesToRef(1,0,0,0,0,1,0,0,k,m,1,0,0,0,0,1,a.Matrix[0]),a.Matrix[1].multiplyToRef(a.Matrix[0],a.Matrix[0]),O.TranslationToRef(0,0,-E,a.Matrix[1]),a.Matrix[0].multiplyToRef(a.Matrix[1],a.Matrix[0]),O.OrthoOffCenterRHToRef(w,p,e,r,I,d,j,X),a.Matrix[0].multiplyToRef(j,j),j}static PerspectiveLH(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const f=new O,q=2*e/w,E=2*e/p,j=(r+e)/(r-e),X=-2*r*e/(r-e),k=Math.tan(d);return O.FromValuesToRef(q,0,0,0,0,E,0,k,0,0,j,1,0,0,X,0,f),I&&f.multiplyToRef(z,f),f._updateIdentityStatus(!1),f}static PerspectiveFovLH(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const q=new O;return O.PerspectiveFovLHToRef(w,p,e,r,q,!0,I,d,f),q}static PerspectiveFovLHToRef(w,p,e,r,I){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const j=e,X=r,k=1/Math.tan(.5*w),m=d?k/p:k,J=d?k:k*p,K=E&&0===j?-1:0!==X?(X+j)/(X-j):1,y=E&&0===j?2*X:0!==X?-2*X*j/(X-j):-2*j,c=Math.tan(q);return O.FromValuesToRef(m,0,0,0,0,J,0,c,0,0,K,1,0,0,y,0,I),f&&I.multiplyToRef(z,I),I._updateIdentityStatus(!1),I}static PerspectiveFovReverseLHToRef(w,p,e,r,I){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const E=1/Math.tan(.5*w),j=d?E/p:E,X=d?E:E*p,k=Math.tan(q);return O.FromValuesToRef(j,0,0,0,0,X,0,k,0,0,-e,1,0,0,1,0,I),f&&I.multiplyToRef(z,I),I._updateIdentityStatus(!1),I}static PerspectiveFovRH(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const q=new O;return O.PerspectiveFovRHToRef(w,p,e,r,q,!0,I,d,f),q}static PerspectiveFovRHToRef(w,p,e,r,I){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const j=e,X=r,k=1/Math.tan(.5*w),m=d?k/p:k,J=d?k:k*p,K=E&&0===j?1:0!==X?-(X+j)/(X-j):-1,y=E&&0===j?2*X:0!==X?-2*X*j/(X-j):-2*j,c=Math.tan(q);return O.FromValuesToRef(m,0,0,0,0,J,0,c,0,0,K,-1,0,0,y,0,I),f&&I.multiplyToRef(z,I),I._updateIdentityStatus(!1),I}static PerspectiveFovReverseRHToRef(w,p,e,r,I){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const E=1/Math.tan(.5*w),j=d?E/p:E,X=d?E:E*p,k=Math.tan(q);return O.FromValuesToRef(j,0,0,0,0,X,0,k,0,0,-e,-1,0,0,-1,0,I),f&&I.multiplyToRef(z,I),I._updateIdentityStatus(!1),I}static GetFinalMatrix(w,p,e,r,I,d){const f=w.width,q=w.height,E=w.x,j=w.y,X=O.FromValues(f/2,0,0,0,0,-q/2,0,0,0,0,d-I,0,E+f/2,q/2+j,I,1),k=new O;return p.multiplyToRef(e,k),k.multiplyToRef(r,k),k.multiplyToRef(X,k)}static GetAsMatrix2x2(w){const p=w.m,e=[p[0],p[1],p[4],p[5]];return f.e.MatrixUse64Bits?e:new Float32Array(e)}static GetAsMatrix3x3(w){const p=w.m,e=[p[0],p[1],p[2],p[4],p[5],p[6],p[8],p[9],p[10]];return f.e.MatrixUse64Bits?e:new Float32Array(e)}static Transpose(w){const p=new O;return O.TransposeToRef(w,p),p}static TransposeToRef(w,p){const e=w.m,r=e[0],I=e[4],d=e[8],f=e[12],q=e[1],E=e[5],j=e[9],X=e[13],k=e[2],m=e[6],J=e[10],K=e[14],y=e[3],c=e[7],s=e[11],O=e[15],a=p.gm;return a[0]=r,a[1]=I,a[2]=d,a[3]=f,a[4]=q,a[5]=E,a[6]=j,a[7]=X,a[8]=k,a[9]=m,a[10]=J,a[11]=K,a[12]=y,a[13]=c,a[14]=s,a[15]=O,p.markAsUpdated(),p._updateIdentityStatus(w._isIdentity,w._isIdentityDirty),p}static Reflection(w){const p=new O;return O.ReflectionToRef(w,p),p}static ReflectionToRef(w,p){w.normalize();const e=w.dp.x,r=w.dp.y,I=w.dp.z,d=-2*e,f=-2*r,q=-2*I;return O.FromValuesToRef(d*e+1,f*e,q*e,0,d*r,f*r+1,q*r,0,d*I,f*I,q*I+1,0,d*w.d,f*w.d,q*w.d,1,p),p}static FromXYZAxesToRef(w,p,e,r){return O.FromValuesToRef(w._x,w._y,w._z,0,p._x,p._y,p._z,0,e._x,e._y,e._z,0,0,0,0,1,r),r}static FromQuaternionToRef(w,p){const e=w._x*w._x,r=w._y*w._y,I=w._z*w._z,d=w._x*w._y,f=w._z*w._w,q=w._z*w._x,E=w._y*w._w,j=w._y*w._z,X=w._x*w._w;return p.gm[0]=1-2*(r+I),p.gm[1]=2*(d+f),p.gm[2]=2*(q-E),p.gm[3]=0,p.gm[4]=2*(d-f),p.gm[5]=1-2*(I+e),p.gm[6]=2*(j+X),p.gm[7]=0,p.gm[8]=2*(q+E),p.gm[9]=2*(j-X),p.gm[10]=1-2*(r+e),p.gm[11]=0,p.gm[12]=0,p.gm[13]=0,p.gm[14]=0,p.gm[15]=1,p.markAsUpdated(),p}}O._IdentityReadOnly=O.Identity(),Object.defineProperties(O.prototype,{dimension:{value:[4,4]},rank:{value:2}});class a{}a.ne=(0,I.e)(11,y.Zero),a.Matrix=(0,I.e)(2,O.Identity),a.Quaternion=(0,I.e)(3,s.Zero);class A{}A.Vector2=(0,I.e)(3,K.Zero),A.ne=(0,I.e)(13,y.Zero),A.Vector4=(0,I.e)(3,c.Zero),A.Quaternion=(0,I.e)(3,s.Zero),A.Matrix=(0,I.e)(8,O.Identity),(0,d.d)("BABYLON.Vector2",K),(0,d.d)("BABYLON.Vector3",y),(0,d.d)("BABYLON.Vector4",c),(0,d.d)("BABYLON.Matrix",O);const z=O.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11378:(w,p,e)=>{e.d(p,{d:()=>r});class r{constructor(w,p,e,r){this.x=w,this.y=p,this.width=e,this.height=r}toGlobal(w,p){return new r(this.x*w,this.y*p,this.width*w,this.height*p)}toGlobalToRef(w,p,e){return e.x=this.x*w,e.y=this.y*p,e.width=this.width*w,e.height=this.height*p,this}clone(){return new r(this.x,this.y,this.width,this.height)}}},11475:(w,p,e)=>{e.d(p,{d:()=>j,h:()=>X});var r=e(11023),I=e(11478);const d=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],f=[()=>1,w=>w.y,w=>w.z,w=>w.x,w=>w.x*w.y,w=>w.y*w.z,w=>3*w.z*w.z-1,w=>w.x*w.z,w=>w.x*w.x-w.y*w.y],q=(w,p)=>d[w]*f[w](p),E=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class j{constructor(){this.preScaled=!1,this.l00=r.k.Zero(),this.l1_1=r.k.Zero(),this.l10=r.k.Zero(),this.l11=r.k.Zero(),this.l2_2=r.k.Zero(),this.l2_1=r.k.Zero(),this.l20=r.k.Zero(),this.l21=r.k.Zero(),this.l22=r.k.Zero()}addLight(w,p,e){I.g.ne[0].set(p.r,p.g,p.b);const r=I.g.ne[0],d=I.g.ne[1];r.scaleToRef(e,d),d.scaleToRef(q(0,w),I.g.ne[2]),this.l00.addInPlace(I.g.ne[2]),d.scaleToRef(q(1,w),I.g.ne[2]),this.l1_1.addInPlace(I.g.ne[2]),d.scaleToRef(q(2,w),I.g.ne[2]),this.l10.addInPlace(I.g.ne[2]),d.scaleToRef(q(3,w),I.g.ne[2]),this.l11.addInPlace(I.g.ne[2]),d.scaleToRef(q(4,w),I.g.ne[2]),this.l2_2.addInPlace(I.g.ne[2]),d.scaleToRef(q(5,w),I.g.ne[2]),this.l2_1.addInPlace(I.g.ne[2]),d.scaleToRef(q(6,w),I.g.ne[2]),this.l20.addInPlace(I.g.ne[2]),d.scaleToRef(q(7,w),I.g.ne[2]),this.l21.addInPlace(I.g.ne[2]),d.scaleToRef(q(8,w),I.g.ne[2]),this.l22.addInPlace(I.g.ne[2])}scaleInPlace(w){this.l00.scaleInPlace(w),this.l1_1.scaleInPlace(w),this.l10.scaleInPlace(w),this.l11.scaleInPlace(w),this.l2_2.scaleInPlace(w),this.l2_1.scaleInPlace(w),this.l20.scaleInPlace(w),this.l21.scaleInPlace(w),this.l22.scaleInPlace(w)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(E[0]),this.l1_1.scaleInPlace(E[1]),this.l10.scaleInPlace(E[2]),this.l11.scaleInPlace(E[3]),this.l2_2.scaleInPlace(E[4]),this.l2_1.scaleInPlace(E[5]),this.l20.scaleInPlace(E[6]),this.l21.scaleInPlace(E[7]),this.l22.scaleInPlace(E[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(d[0]),this.l1_1.scaleInPlace(d[1]),this.l10.scaleInPlace(d[2]),this.l11.scaleInPlace(d[3]),this.l2_2.scaleInPlace(d[4]),this.l2_1.scaleInPlace(d[5]),this.l20.scaleInPlace(d[6]),this.l21.scaleInPlace(d[7]),this.l22.scaleInPlace(d[8])}updateFromArray(w){return r.k.FromArrayToRef(w[0],0,this.l00),r.k.FromArrayToRef(w[1],0,this.l1_1),r.k.FromArrayToRef(w[2],0,this.l10),r.k.FromArrayToRef(w[3],0,this.l11),r.k.FromArrayToRef(w[4],0,this.l2_2),r.k.FromArrayToRef(w[5],0,this.l2_1),r.k.FromArrayToRef(w[6],0,this.l20),r.k.FromArrayToRef(w[7],0,this.l21),r.k.FromArrayToRef(w[8],0,this.l22),this}updateFromFloatsArray(w){return r.k.FromFloatsToRef(w[0],w[1],w[2],this.l00),r.k.FromFloatsToRef(w[3],w[4],w[5],this.l1_1),r.k.FromFloatsToRef(w[6],w[7],w[8],this.l10),r.k.FromFloatsToRef(w[9],w[10],w[11],this.l11),r.k.FromFloatsToRef(w[12],w[13],w[14],this.l2_2),r.k.FromFloatsToRef(w[15],w[16],w[17],this.l2_1),r.k.FromFloatsToRef(w[18],w[19],w[20],this.l20),r.k.FromFloatsToRef(w[21],w[22],w[23],this.l21),r.k.FromFloatsToRef(w[24],w[25],w[26],this.l22),this}static Ve(w){return(new j).updateFromArray(w)}static FromPolynomial(w){const p=new j;return p.l00=w.xx.scale(.376127).add(w.yy.scale(.376127)).add(w.zz.scale(.376126)),p.l1_1=w.y.scale(.977204),p.l10=w.z.scale(.977204),p.l11=w.x.scale(.977204),p.l2_2=w.xy.scale(1.16538),p.l2_1=w.yz.scale(1.16538),p.l20=w.zz.scale(1.34567).Je(w.xx.scale(.672834)).Je(w.yy.scale(.672834)),p.l21=w.zx.scale(1.16538),p.l22=w.xx.scale(1.16538).Je(w.yy.scale(1.16538)),p.l1_1.scaleInPlace(-1),p.l11.scaleInPlace(-1),p.l2_1.scaleInPlace(-1),p.l21.scaleInPlace(-1),p.scaleInPlace(Math.PI),p}}class X{constructor(){this.x=r.k.Zero(),this.y=r.k.Zero(),this.z=r.k.Zero(),this.xx=r.k.Zero(),this.yy=r.k.Zero(),this.zz=r.k.Zero(),this.xy=r.k.Zero(),this.yz=r.k.Zero(),this.zx=r.k.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=j.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(w){I.g.ne[0].te(w.r,w.g,w.b);const p=I.g.ne[0];this.xx.addInPlace(p),this.yy.addInPlace(p),this.zz.addInPlace(p)}scaleInPlace(w){this.x.scaleInPlace(w),this.y.scaleInPlace(w),this.z.scaleInPlace(w),this.xx.scaleInPlace(w),this.yy.scaleInPlace(w),this.zz.scaleInPlace(w),this.yz.scaleInPlace(w),this.zx.scaleInPlace(w),this.xy.scaleInPlace(w)}updateFromHarmonics(w){return this._harmonics=w,this.x.X(w.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.X(w.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.X(w.l10),this.z.scaleInPlace(1.02333),this.xx.X(w.l00),I.g.ne[0].X(w.l20).scaleInPlace(.247708),I.g.ne[1].X(w.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).zk(I.g.ne[0]).addInPlace(I.g.ne[1]),this.yy.X(w.l00),this.yy.scaleInPlace(.886277).zk(I.g.ne[0]).zk(I.g.ne[1]),this.zz.X(w.l00),I.g.ne[0].X(w.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(I.g.ne[0]),this.yz.X(w.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.X(w.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.X(w.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(w){return(new X).updateFromHarmonics(w)}static Ve(w){const p=new X;return r.k.FromArrayToRef(w[0],0,p.x),r.k.FromArrayToRef(w[1],0,p.y),r.k.FromArrayToRef(w[2],0,p.z),r.k.FromArrayToRef(w[3],0,p.xx),r.k.FromArrayToRef(w[4],0,p.yy),r.k.FromArrayToRef(w[5],0,p.zz),r.k.FromArrayToRef(w[6],0,p.yz),r.k.FromArrayToRef(w[7],0,p.zx),r.k.FromArrayToRef(w[8],0,p.xy),p}}},11747:(w,p,e)=>{e.d(p,{d:()=>s,g:()=>O});var r=e(11023),I=e(11308),d=e(11370),f=e(11337),q=e(11081),E=e(11232),j=e(11482),X=e(11027),k=e(11051);class m extends r.g{constructor(w,p){super(w.x,w.y),this.index=p}}class J{constructor(){this.elements=[]}add(w){const p=[];for(const e of w){const w=new m(e,this.elements.length);p.push(w),this.elements.push(w)}return p}computeBounds(){const w=new r.g(this.elements[0].x,this.elements[0].y),p=new r.g(this.elements[0].x,this.elements[0].y);for(const e of this.elements)e.x<w.x?w.x=e.x:e.x>p.x&&(p.x=e.x),e.y<w.y?w.y=e.y:e.y>p.y&&(p.y=e.y);return{min:w,max:p,width:p.x-w.x,height:p.y-w.y}}}class K{_addToepoint(w){for(const p of w)this._epoints.push(p.x,p.y)}constructor(w,p,e){let r,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new J,this._outlinepoints=new J,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=I,this._name=w,this._scene=e||k.d.LastCreatedScene,r=p instanceof j.l?p.getPoints():p,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),"undefined"===typeof this.bjsEarcut&&q.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(w){this._points.add(w);const p=new J;return p.add(w),this._holes.push(p),this._eholes.push(this._epoints.length/2),this._addToepoint(w),this}build(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=new d.c(this._name,this._scene),I=this.buildVertexData(p,e);return r.uw(E.e.PositionKind,I.nw,w),r.uw(E.e.NormalKind,I.lw,w),r.uw(E.e.UVKind,I.Uw,w),r.setIndices(I.indices),r}buildVertexData(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const e=new f.b,r=[],I=[],d=[],q=this._points.computeBounds();for(const f of this._points.elements)r.push(0,1,0),I.push(f.x,0,f.y),d.push((f.x-q.min.x)/q.width,(f.y-q.min.y)/q.height);const E=[],j=this.bjsEarcut(this._epoints,this._eholes,2);for(let f=0;f<j.length;f++)E.push(j[f]);if(w>0){const e=I.length/3;for(const p of this._points.elements)r.push(0,-1,0),I.push(p.x,-w,p.y),d.push(1-(p.x-q.min.x)/q.width,1-(p.y-q.min.y)/q.height);const f=E.length;for(let w=0;w<f;w+=3){const p=E[w+0],r=E[w+1],I=E[w+2];E.push(I+e),E.push(r+e),E.push(p+e)}this._addSide(I,r,d,E,q,this._outlinepoints,w,!1,p);for(const j of this._holes)this._addSide(I,r,d,E,q,j,w,!0,p)}return e.indices=E,e.nw=I,e.lw=r,e.Uw=d,e}_addSide(w,p,e,I,d,f,q,E,j){let k=w.length/3,m=0;for(let J=0;J<f.elements.length;J++){const K=f.elements[J],y=f.elements[(J+1)%f.elements.length];w.push(K.x,0,K.y),w.push(K.x,-q,K.y),w.push(y.x,0,y.y),w.push(y.x,-q,y.y);const c=f.elements[(J+f.elements.length-1)%f.elements.length],s=f.elements[(J+2)%f.elements.length];let O=new r.k(-(y.y-K.y),0,y.x-K.x),a=new r.k(-(K.y-c.y),0,K.x-c.x),A=new r.k(-(s.y-y.y),0,s.x-y.x);E||(O=O.scale(-1),a=a.scale(-1),A=A.scale(-1));const z=O.normalizeToNew();let M=a.normalizeToNew(),i=A.normalizeToNew();const t=r.k.Dot(M,z);M=t>j?t<X.c-1?new r.k(K.x,0,K.y).Je(new r.k(y.x,0,y.y)).normalize():a.add(O).normalize():z;const n=r.k.Dot(A,O);i=n>j?n<X.c-1?new r.k(y.x,0,y.y).Je(new r.k(K.x,0,K.y)).normalize():A.add(O).normalize():z,e.push(m/d.width,0),e.push(m/d.width,1),m+=O.length(),e.push(m/d.width,0),e.push(m/d.width,1),p.push(M.x,M.y,M.z),p.push(M.x,M.y,M.z),p.push(i.x,i.y,i.z),p.push(i.x,i.y,i.z),E?(I.push(k),I.push(k+2),I.push(k+1),I.push(k+1),I.push(k+2),I.push(k+3)):(I.push(k),I.push(k+1),I.push(k+2),I.push(k+1),I.push(k+3),I.push(k+2)),k+=4}}}var y=e(11400);function c(w,p,e,d,q,j,X){const k=e||new Array(3),m=d,J=[],K=X||!1;for(let f=0;f<3;f++)void 0===k[f]&&(k[f]=new r.o(0,0,1,1)),m&&void 0===m[f]&&(m[f]=new I.e(1,1,1,1));const c=w.getVerticesData(E.e.PositionKind),s=w.getVerticesData(E.e.NormalKind),O=w.getVerticesData(E.e.UVKind),a=w.Ke(),A=c.length/9;let z=0,M=0,i=0,t=0,n=0;const l=[0];if(K)for(let r=A;r<c.length/3;r+=4)M=c[3*(r+2)]-c[3*r],i=c[3*(r+2)+2]-c[3*r+2],t=Math.sqrt(M*M+i*i),n+=t,l.push(n);let N=0,U=0;for(let r=0;r<s.length;r+=3)Math.abs(s[r+1])<.001&&(U=1),Math.abs(s[r+1]-1)<.001&&(U=0),Math.abs(s[r+1]+1)<.001&&(U=2),N=r/3,1===U?(z=N-A,O[2*N]=z%4<1.5?K?k[U].x+(k[U].z-k[U].x)*l[Math.floor(z/4)]/n:k[U].x:K?k[U].x+(k[U].z-k[U].x)*l[Math.floor(z/4)+1]/n:k[U].z,O[2*N+1]=z%2===0?y.b?1-k[U].w:k[U].w:y.b?1-k[U].y:k[U].y):(O[2*N]=(1-O[2*N])*k[U].x+O[2*N]*k[U].z,O[2*N+1]=(1-O[2*N+1])*k[U].y+O[2*N+1]*k[U].w,y.b&&(O[2*N+1]=1-O[2*N+1])),m&&J.push(m[U].r,m[U].g,m[U].b,m[U].a);f.b._ComputeSides(p,c,a,s,O,q,j);const v=new f.b;if(v.indices=a,v.nw=c,v.lw=s,v.Uw=O,m){const w=p===f.b.DOUBLESIDE?J.concat(J):J;v.Nw=w}return v}function s(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;p.sideOrientation=d.c._GetDefaultSideOrientation(p.sideOrientation);const f=p.shape,q=p.holes||[],E=p.depth||0,j=p.smoothingThreshold||2,X=[];let m=[];for(let d=0;d<f.length;d++)X[d]=new r.g(f[d].x,f[d].z);X[0].equalsWithEpsilon(X[X.length-1],1e-8)&&X.pop();const J=new K(w,X,e||k.d.LastCreatedScene,I);for(let d=0;d<q.length;d++){m=[];for(let w=0;w<q[d].length;w++)m.push(new r.g(q[d][w].x,q[d][w].z));J.addHole(m)}const y=J.build(!1,E,j);y._originalBuilderSideOrientation=p.sideOrientation;return c(y,p.sideOrientation,p.faceUV,p.faceColors,p.frontUVs,p.backUVs,p.wrap).Vw(y,p.updatable),y}function O(w,p){return s(w,p,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}f.b.CreatePolygon=c,d.c.CreatePolygon=function(w,p,e,r,I,d){return s(w,{shape:p,holes:r,updatable:I,sideOrientation:d},e,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},d.c.ExtrudePolygon=function(w,p,e,r,I,d,f){return O(w,{shape:p,holes:I,depth:e,updatable:d,sideOrientation:f},r,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11744:(w,p,e)=>{e.d(p,{d:()=>X,g:()=>k});var r=e(11482),I=e(11023),d=e(11370),f=e(11325),q=e(11747);class E{constructor(w){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=w}moveTo(w,p){this._currentPath=new r.l(w,p),this._tempPaths.push(this._currentPath)}lineTo(w,p){this._currentPath.addLineTo(w,p)}quadraticCurveTo(w,p,e,r){this._currentPath.addQuadraticCurveTo(w,p,e,r,this._resolution)}bezierCurveTo(w,p,e,r,I,d){this._currentPath.addBezierCurveTo(w,p,e,r,I,d,this._resolution)}extractHoles(){for(const w of this._tempPaths)w.area()>0?this._holes.push(w):this._paths.push(w);if(!this._paths.length&&this._holes.length){const w=this._holes;this._holes=this._paths,this._paths=w}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function j(w,p,e,r,I,d){const f=d.glyphs[w]||d.glyphs["?"];if(!f)return null;const q=new E(I);if(f.o){const w=f.o.split(" ");for(let I=0,d=w.length;I<d;){switch(w[I++]){case"m":{const d=parseInt(w[I++])*p+e,f=parseInt(w[I++])*p+r;q.moveTo(d,f);break}case"l":{const d=parseInt(w[I++])*p+e,f=parseInt(w[I++])*p+r;q.lineTo(d,f);break}case"q":{const d=parseInt(w[I++])*p+e,f=parseInt(w[I++])*p+r,E=parseInt(w[I++])*p+e,j=parseInt(w[I++])*p+r;q.quadraticCurveTo(E,j,d,f);break}case"b":{const d=parseInt(w[I++])*p+e,f=parseInt(w[I++])*p+r,E=parseInt(w[I++])*p+e,j=parseInt(w[I++])*p+r,X=parseInt(w[I++])*p+e,k=parseInt(w[I++])*p+r;q.bezierCurveTo(E,j,X,k,d,f);break}}}}return q.extractHoles(),{offsetX:f.ha*p,shapePath:q}}function X(w,p,e,r){const I=Array.from(w),d=p/r.resolution,f=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*d,q=[];let E=0,X=0;for(let k=0;k<I.length;k++){const w=I[k];if("\n"===w)E=0,X-=f;else{const p=j(w,d,E,X,e,r);p&&(E+=p.offsetX,q.push(p.shapePath))}}return q}function k(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const k=X(p,r.size||50,r.resolution||8,e),m=[];let J=0;for(const f of k){if(!f.paths.length)continue;const p=f.holes.slice();for(const e of f.paths){var K,y;const f=[],X=[],k=e.getPoints();for(const w of k)X.push(new I.k(w.x,0,w.y));const c=p.slice();for(const w of c){const r=w.getPoints();let d=!1;for(const w of r)if(e.isPointInside(w)){d=!0;break}if(!d)continue;const q=[];for(const w of r)q.push(new I.k(w.x,0,w.y));f.push(q),p.splice(p.indexOf(w),1)}if(!f.length&&p.length)for(const w of p){const p=w.getPoints(),e=[];for(const w of p)e.push(new I.k(w.x,0,w.y));f.push(e)}const s=(0,q.g)(w,{shape:X,holes:f.length?f:void 0,depth:r.depth||1,faceUV:r.faceUV||(null===(K=r.perLetterFaceUV)||void 0===K?void 0:K.call(r,J)),faceColors:r.faceColors||(null===(y=r.perLetterFaceColors)||void 0===y?void 0:y.call(r,J)),sideOrientation:d.c._GetDefaultSideOrientation(r.sideOrientation||d.c.DOUBLESIDE)},E,j);m.push(s),J++}}const c=d.c.MergeMeshes(m,!0,!0);if(c){const p=c.getBoundingInfo().boundingBox;c.position.x+=-(p.minimumWorld.x+p.maximumWorld.x)/2,c.position.y+=-(p.minimumWorld.y+p.maximumWorld.y)/2,c.position.z+=-(p.minimumWorld.z+p.maximumWorld.z)/2+p.extendSize.z,c.name=w;const e=new f.e("pivot",E);e.rotation.x=-Math.PI/2,c.parent=e,c.bakeCurrentTransformIntoVertices(),c.parent=null,e.dispose()}return c}},11755:(w,p,e)=>{e.d(p,{b:()=>E,f:()=>f,h:()=>q});var r=e(11071),I=e(11760),d=e(11765);function f(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function q(w){return!!(w.wasmUrl&&(w.wasmBinary||w.wasmBinaryUrl)&&"object"===typeof WebAssembly||w.fallbackUrl)}class E{constructor(w){if(w.workerPool)return void(this._workerPoolPromise=Promise.resolve(w.workerPool));const p=w.wasmBinary,e=w.numWorkers??f(),q=e&&"function"===typeof Worker&&"function"===typeof URL,E=q||!w.jsModule,j=w.wasmUrl&&w.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:E?r.g.GetBabylonScriptURL(w.wasmUrl,!0):"",wasmBinaryPromise:p?Promise.resolve(p):r.g.LoadFileAsync(r.g.GetBabylonScriptURL(w.wasmBinaryUrl,!0))}:{url:E?r.g.GetBabylonScriptURL(w.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};q?this._workerPoolPromise=j.wasmBinaryPromise.then((w=>{const p=this._getWorkerContent(),r=URL.createObjectURL(new Blob([p],{type:"application/javascript"}));return new I.d(e,(()=>{const p=new Worker(r);return(0,d.r)(p,w,j.url)}))})):this._modulePromise=j.wasmBinaryPromise.then((async p=>{if(!this._isModuleAvailable()&&!w.jsModule){if(!j.url)throw new Error("Draco codec module is not available");await r.g.LoadBabylonScriptAsync(j.url)}return await this._createModuleAsync(p,w.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((w=>{w.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11765:(w,p,e)=>{function r(w,p,e,r){const I=w;let d=null,f=null,q=null,E=null;const j={},X=p.find((w=>"POSITION"===w.dracoName));if(!X)throw new Error("Position attribute is required for Draco encoding");if(!e){const w=X.data.length/X.size;e=new(w>65535?Uint32Array:Uint16Array)(w);for(let p=0;p<w;p++)e[p]=p}try{d=new I.Encoder,f=new I.MeshBuilder,q=new I.Mesh,f.AddFacesToMesh(q,e.length/3,e);const w=new Map([[Float32Array,(w,p,e,r,I,d)=>w.AddFloatAttribute(p,e,r,I,d)],[Uint32Array,(w,p,e,r,I,d)=>w.AddUInt32Attribute(p,e,r,I,d)],[Uint16Array,(w,p,e,r,I,d)=>w.AddUInt16Attribute(p,e,r,I,d)],[Uint8Array,(w,p,e,r,I,d)=>w.AddUInt8Attribute(p,e,r,I,d)],[Int32Array,(w,p,e,r,I,d)=>w.AddInt32Attribute(p,e,r,I,d)],[Int16Array,(w,p,e,r,I,d)=>w.AddInt16Attribute(p,e,r,I,d)],[Int8Array,(w,p,e,r,I,d)=>w.AddInt8Attribute(p,e,r,I,d)]]);for(const e of p){e.data instanceof Uint8ClampedArray&&(e.data=new Uint8Array(e.data));const p=w.get(e.data.constructor),E=e.data.length/e.size;j[e.kind]=p(f,q,I[e.dracoName],E,e.size,e.data),r.quantizationBits&&r.quantizationBits[e.dracoName]&&d.SetAttributeQuantization(I[e.dracoName],r.quantizationBits[e.dracoName])}r.method&&d.SetEncodingMethod(I[r.method]),void 0!==r.encodeSpeed&&void 0!==r.decodeSpeed&&d.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),E=new I.DracoInt8Array;const X=d.EncodeMeshToDracoBuffer(q,E);if(X<=0)throw new Error("Draco encoding failed.");const k=new Int8Array(X);for(let p=0;p<X;p++)k[p]=E.GetValue(p);return{data:k,attributeIds:j}}finally{q&&I.destroy(q),f&&I.destroy(f),d&&I.destroy(d),E&&I.destroy(E)}}function I(){let w;onmessage=p=>{const e=p.data;switch(e.id){case"init":{e.url&&importScripts(e.url);const p=e.wasmBinary?{wasmBinary:e.wasmBinary}:{};w=DracoEncoderModule(p),postMessage({id:"initDone"});break}case"encodeMesh":if(!w)throw new Error("Draco encoder module is not available");w.then((w=>{const p=r(w,e.attributes,e.indices,e.options);postMessage({id:"encodeMeshDone",encodedMeshData:p},p?[p.data.buffer]:void 0)}))}}}function d(w,p,e,r,I){const d=w;let f=null,q=null,E=null;try{let w;f=new d.Decoder,q=new d.DecoderBuffer,q.Init(p,p.byteLength);const j=f.GetEncodedGeometryType(q);switch(j){case d.TRIANGULAR_MESH:{const p=new d.Mesh;if(w=f.DecodeBufferToMesh(q,p),!w.ok()||0===p.ptr)throw new Error(w.error_msg());const e=3*p.num_faces(),I=4*e,j=d._malloc(I);try{f.GetTrianglesUInt32Array(p,I,j);const w=new Uint32Array(e);w.set(new Uint32Array(d.HEAPF32.buffer,j,e)),r(w)}finally{d._free(j)}E=p;break}case d.POINT_CLOUD:{const p=new d.PointCloud;if(w=f.DecodeBufferToPointCloud(q,p),!w.ok()||!p.ptr)throw new Error(w.error_msg());E=p;break}default:throw new Error(`Invalid geometry type ${j}`)}const X=E.num_points(),k=(w,p,e,r)=>{const f=r.data_type(),q=r.num_components(),E=r.normalized(),j=r.byte_stride(),k=r.byte_offset(),m={[d.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:d.HEAPF32},[d.DT_INT8]:{typedArrayConstructor:Int8Array,heap:d.HEAP8},[d.DT_INT16]:{typedArrayConstructor:Int16Array,heap:d.HEAP16},[d.DT_INT32]:{typedArrayConstructor:Int32Array,heap:d.HEAP32},[d.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:d.HEAPU8},[d.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:d.HEAPU16},[d.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:d.HEAPU32}}[f];if(!m)throw new Error(`Invalid data type ${f}`);const J=X*q,K=J*m.typedArrayConstructor.BYTES_PER_ELEMENT,y=d._malloc(K);try{w.GetAttributeDataArrayForAllPoints(p,r,f,K,y);const d=new m.typedArrayConstructor(m.heap.buffer,y,J);I(e,d.slice(),q,k,j,E)}finally{d._free(y)}};if(e)for(const p in e){const w=e[p],r=f.GetAttributeByUniqueId(E,w);k(f,E,p,r)}else{const w={position:d.POSITION,dp:d.NORMAL,color:d.COLOR,uv:d.TEX_COORD};for(const p in w){const e=f.GetAttributeId(E,w[p]);if(-1!==e){const w=f.GetAttribute(E,e);k(f,E,p,w)}}}return X}finally{E&&d.destroy(E),q&&d.destroy(q),f&&d.destroy(f)}}function f(){let w;onmessage=p=>{const e=p.data;switch(e.id){case"init":{e.url&&importScripts(e.url);const p=e.wasmBinary?{wasmBinary:e.wasmBinary}:{};w=DracoDecoderModule(p),postMessage({id:"initDone"});break}case"decodeMesh":if(!w)throw new Error("Draco decoder module is not available");w.then((w=>{const p=d(w,e.dataView,e.attributes,(w=>{postMessage({id:"indices",data:w},[w.buffer])}),((w,p,e,r,I,d)=>{postMessage({id:"attribute",kind:w,data:p,size:e,byteOffset:r,byteStride:I,normalized:d},[p.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:p})}))}}}async function q(w,p,e){return await new Promise(((r,I)=>{const d=p=>{w.removeEventListener("error",d),w.removeEventListener("message",f),I(p)},f=p=>{"initDone"===p.data.id&&(w.removeEventListener("error",d),w.removeEventListener("message",f),r(w))};if(w.addEventListener("error",d),w.addEventListener("message",f),p){const r=p.slice(0);w.postMessage({id:"init",url:e,wasmBinary:r},[r])}else w.postMessage({id:"init",url:e})}))}e.d(p,{e:()=>d,i:()=>f,k:()=>r,n:()=>I,r:()=>q})},11422:(w,p,e)=>{e.d(p,{c:()=>I});var r=e(11240);class I extends r.e{constructor(w){super(),this._buffer=w}get underlyingResource(){return this._buffer}}},11333:(w,p,e)=>{e.d(p,{b:()=>i});var r=e(11207),I=e(11056),d=e(11023),f=e(11232),q=e(11337),E=e(11325),j=e(11354),X=e(11265),k=e(11288);class m{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new d.k(0,0,0),this._diffPositionForCollisions=new d.k(0,0,0),this._collisionResponse=!0}}var J=e(11094),K=e(11277),y=e(11308),c=e(11027),s=e(11358),O=e(11038),a=e(11213),A=e(11132);class z{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=d.k.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class M{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new z,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new m,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class i extends E.e{static get BILLBOARDMODE_NONE(){return E.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return E.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return E.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return E.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return E.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return E.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(w){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=w}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(w){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=w}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(w){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=w}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(w){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=w}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(w){this._internalAbstractMeshDataInfo._collisionRetryCount=w}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(w){this._internalAbstractMeshDataInfo._morphTargetManager!==w&&(this._internalAbstractMeshDataInfo._morphTargetManager=w,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(w){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==w&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=w,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(w){return!!super._updateNonUniformScalingState(w)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(w){this._internalAbstractMeshDataInfo._rawBoundingInfo=w}set HJ(w){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(w)}set onCollisionPositionChange(w){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(w)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(w){if(this._internalAbstractMeshDataInfo._visibility===w)return;const p=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=w,(1===p&&1!==w||1!==p&&1===w)&&this._markSubMeshesAsDirty((w=>{w.markAsMiscDirty(),w.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(w){this._internalAbstractMeshDataInfo._inheritVisibility=w}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let w=this._parentNode;for(;w;){const p=w.isVisible;if("undefined"!==typeof p)return p;w=w.parent}}return this._isVisible}set isVisible(w){this._isVisible=w}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(w){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=w}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(w){this._internalAbstractMeshDataInfo._renderingGroupId=w}get material(){return this._internalAbstractMeshDataInfo._material}set material(w){this._setMaterial(w)}_setMaterial(w){this._internalAbstractMeshDataInfo._material!==w&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=w,w&&w.meshMap&&(w.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.oe&&(this.resetDrawCache(void 0,null==w),this._unBindEffect()))}getMaterialForRenderPass(w){var p;return null===(p=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===p?void 0:p[w]}setMaterialForRenderPass(w,p){var e;this.resetDrawCache(w),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const r=this._internalAbstractMeshDataInfo._materialForRenderPass[w];null!==r&&void 0!==r&&null!==(e=r.meshMap)&&void 0!==e&&e[this.uniqueId]&&(r.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[w]=p,p&&p.meshMap&&(p.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(w){this._internalAbstractMeshDataInfo._receiveShadows!==w&&(this._internalAbstractMeshDataInfo._receiveShadows=w,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(w){this._internalAbstractMeshDataInfo._hasVertexAlpha!==w&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=w,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(w){this._internalAbstractMeshDataInfo._useVertexColors!==w&&(this._internalAbstractMeshDataInfo._useVertexColors=w,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(w){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==w&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=w,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(w){this._internalAbstractMeshDataInfo._numBoneInfluencers!==w&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=w,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(w){this._internalAbstractMeshDataInfo._applyFog!==w&&(this._internalAbstractMeshDataInfo._applyFog=w,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(w){this._internalAbstractMeshDataInfo._enableDistantPicking=w}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(w){w!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=w,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(w){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(w)?-1:w}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(w){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=w}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(w){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(w)?-1:w}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(w){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=w}get lightSources(){return this._lightSources}set skeleton(w){const p=this._internalAbstractMeshDataInfo._skeleton;p&&p.needInitialSkinMatrix&&p._unregisterMeshWithPoseMatrix(this),w&&w.needInitialSkinMatrix&&w._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=w,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(w){var p;let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(w,e,!1),p=this,this._internalAbstractMeshDataInfo=new M,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Pk=i.uk,this.onCollideObservable=new I.d,this.onCollisionPositionChangeObservable=new I.d,this.onMaterialChangedObservable=new I.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.kj=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=y.b.Red(),this.outlineWidth=.02,this.overlayColor=y.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.kE=!1,this.bw=!1,this.actionManager=null,this.ellipsoid=new d.k(.5,1,.5),this.ellipsoidOffset=new d.k(0,0,0),this.edgesWidth=1,this.edgesColor=new y.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,XE:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new I.d,this._onCollisionPositionChange=function(w,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.subtractToRef(p._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,p._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),p._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>A.d.CollisionsEpsilon&&p.position.addInPlace(p._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r&&p.onCollideObservable.notifyObservers(r),p.onCollisionPositionChangeObservable.notifyObservers(p.position)},e=this.iw(),e.tX(this),this._resyncLightSources(),this._uniformBuffer=new k.d(this.iw().getEngine(),void 0,void 0,w,!this.iw().getEngine().isWebGPU),this._buildUniformLayout(),e.performancePriority){case 2:this.bw=!0;case 1:this.kE=!0,this.kj=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(w){const p=this._uniformBuffer;p.Ze("world",w),p.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),p.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(w){let p="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");p+=", # of submeshes: "+(this.oe?this.oe.length:0);const e=this._internalAbstractMeshDataInfo._skeleton;return e&&(p+=", skeleton: "+e.name),w&&(p+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],p+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.XE?"YES":"NO")),p}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==E.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(p||this.actionManager.isRecursive)){if(!w)return this.actionManager;if(this.actionManager.hasSpecificTrigger(w))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(w,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.oe){for(const w of this.oe)w._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const w of this.iw().lights)w.isEnabled()&&w.canAffectMesh(this)&&this._lightSources.push(w);this._markSubMeshesAsLightDirty()}_resyncLightSource(w){const p=w.isEnabled()&&w.canAffectMesh(this),e=this._lightSources.indexOf(w);let r=!1;if(-1===e){if(!p)return;this._lightSources.push(w)}else{if(p)return;r=!0,this._lightSources.splice(e,1)}this._markSubMeshesAsLightDirty(r)}_unBindEffect(){for(const w of this.oe)w.setEffect(null)}_removeLightSource(w,p){const e=this._lightSources.indexOf(w);-1!==e&&(this._lightSources.splice(e,1),this._markSubMeshesAsLightDirty(p))}_markSubMeshesAsDirty(w){if(this.oe)for(const p of this.oe)for(let e=0;e<p._drawWrappers.length;++e){const r=p._drawWrappers[e];r&&r.defines&&r.defines.markAllAsDirty&&w(r.defines)}}_markSubMeshesAsLightDirty(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((p=>p.markAsLightDirty(w)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((w=>w.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((w=>w.markAsMiscDirty()))}kX(w){return this._currentRenderId=Number.MAX_VALUE,super.kX(w),this._isDirty=!0,this}resetDrawCache(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.oe)for(const e of this.oe)e.resetDrawCache(w,p)}get isBlocked(){return!1}getLOD(w){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Ke(){return null}getVerticesData(w){return null}uw(w,p,e,r){return this}updateVerticesData(w,p,e,r){return this}setIndices(w,p){return this}isVerticesDataPresent(w){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.hw()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(w){return this._boundingInfo=w,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(w,p,e){return this._boundingInfo=new X.b(w,p,e),this._boundingInfo}normalizeToUnitCube(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(w,p,e)}get useBones(){return this.skeleton&&this.iw().skeletonsEnabled&&this.isVerticesDataPresent(f.e.MatricesIndicesKind)&&this.isVerticesDataPresent(f.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(w){}_activate(w,p){return this._renderId=w,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===E.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(w,p,e){return this.position.addInPlace(this.calcMovePOV(w,p,e)),this}calcMovePOV(w,p,e){const r=new d.b;(this.rotationQuaternion?this.rotationQuaternion:d.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(r);const I=d.k.Zero(),f=this.definedFacingForward?-1:1;return d.k.TransformCoordinatesFromFloatsToRef(w*f,p,e*f,r,I),I}rotatePOV(w,p,e){return this.rotation.addInPlace(this.calcRotatePOV(w,p,e)),this}calcRotatePOV(w,p,e){const r=this.definedFacingForward?1:-1;return new d.k(w*r,p,e*r)}Pw(w,p){if(w){const e=(0,K.d)(w,0,this.getTotalVertices(),p);this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new X.b(e.minimum,e.maximum)}if(this.oe)for(let e=0;e<this.oe.length;e++)this.oe[e].refreshBoundingInfo(w);this.hw()}_refreshBoundingInfoDirect(w){if(this._boundingInfo?this._boundingInfo.reConstruct(w.minimum,w.maximum):this._boundingInfo=new X.b(w.minimum,w.maximum),this.oe)for(let p=0;p<this.oe.length;p++)this.oe[p].refreshBoundingInfo(null);this.hw()}static _ApplySkeleton(w,p,e,r,I,q,E){!function(w,p,e,r,I,q,E){const j=d.d.ne[0],X=d.d.Matrix[0],k=d.d.Matrix[1],m=p===f.e.NormalKind?d.k.TransformNormalFromFloatsToRef:d.k.TransformCoordinatesFromFloatsToRef;for(let f=0,J=0;f<w.length;f+=3,J+=4){let p,K;for(X.reset(),p=0;p<4;p++)K=I[J+p],K>0&&(d.b.FromFloat32ArrayToRefScaled(e,Math.floor(16*r[J+p]),K,k),X.addToSelf(k));if(q&&E)for(p=0;p<4;p++)K=E[J+p],K>0&&(d.b.FromFloat32ArrayToRefScaled(e,Math.floor(16*q[J+p]),K,k),X.addToSelf(k));m(w[f],w[f+1],w[f+2],X,j),j.toArray(w,f)}}(w,p,e,r,I,q,E)}_getData(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.e.PositionKind;const r=w.cache,I=w=>{if(r){const p=r._vertexData||(r._vertexData={});return p[w]||this.copyVerticesData(w,p),p[w]}return this.getVerticesData(w)};if(p||(p=I(e)),!p)return null;if(r?(r._outputData?r._outputData.set(p):r._outputData=new Float32Array(p),p=r._outputData):(w.applyMorph&&this.morphTargetManager||w.applySkeleton&&this.skeleton)&&(p=p.slice()),w.applyMorph&&this.morphTargetManager&&function(w,p,e){let r=null;switch(p){case f.e.PositionKind:r=w=>w.getPositions();break;case f.e.NormalKind:r=w=>w.getNormals();break;case f.e.TangentKind:r=w=>w.getTangents();break;case f.e.UVKind:r=w=>w.getUVs();break;case f.e.UV2Kind:r=w=>w.getUV2s();break;case f.e.ColorKind:r=w=>w.getColors();break;default:return}for(let I=0;I<w.length;I++){let p=w[I];for(let d=0;d<e.numTargets;d++){const f=e.getTarget(d),q=f.influence;if(0!==q){const e=r(f);e&&(p+=(e[I]-w[I])*q)}}w[I]=p}}(p,e,this.morphTargetManager),w.applySkeleton&&this.skeleton){const w=I(f.e.MatricesIndicesKind),r=I(f.e.MatricesWeightsKind);if(r&&w){const d=this.numBoneInfluencers>4,q=d?I(f.e.MatricesIndicesExtraKind):null,E=d?I(f.e.MatricesWeightsExtraKind):null,j=this.skeleton.getTransformMatrices(this);i._ApplySkeleton(p,e,j,w,r,q,E)}}if(!1!==w.updatePositionsArray&&e===f.e.PositionKind){const w=this._internalAbstractMeshDataInfo._positions||[],e=w.length;if(w.length=p.length/3,e<w.length)for(let p=e;p<w.length;p++)w[p]=new d.k;for(let r=0,I=0;r<w.length;r++,I+=3)w[r].te(p[I],p[I+1],p[I+2]);this._internalAbstractMeshDataInfo._positions=w}return p}getNormalsData(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:w,applyMorph:p,updatePositionsArray:!1},null,f.e.NormalKind)}sE(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:w,applyMorph:p,updatePositionsArray:!1},e,f.e.PositionKind)}hw(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new X.b(d.k.Zero(),d.k.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(w){if(!this.oe)return this;const p=this.oe.length;for(let e=0;e<p;e++){const r=this.oe[e];(p>1||!r.IsGlobal)&&r.updateBoundingInfo(w)}return this}_afterComputeWorldMatrix(){this.bw||(this._boundingInfoIsDirty=!0)}isInFrustum(w){return this.getBoundingInfo().isInFrustum(w,this.Pk)}isCompletelyInFrustum(w){return this.getBoundingInfo().isCompletelyInFrustum(w)}intersectsMesh(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;const r=this.getBoundingInfo(),I=w.getBoundingInfo();if(r.intersects(I,p))return!0;if(e)for(const d of this.getChildMeshes())if(d.intersectsMesh(w,p,!0))return!0;return!1}intersectsPoint(w){return this.getBoundingInfo().intersectsPoint(w)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(w){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=w}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const e=this.iw().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=e.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,e.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,w,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,p),this}_collideForSubMesh(w,p,e){var r;if(this._generatePointsArray(),!this._positions)return this;if(!w._lastColliderWorldVertices||!w._lastColliderTransformMatrix.equals(p)){w._lastColliderTransformMatrix=p.clone(),w._lastColliderWorldVertices=[],w._trianglePlanes=[];const e=w.verticesStart,r=w.verticesStart+w.verticesCount;for(let I=e;I<r;I++)w._lastColliderWorldVertices.push(d.k.TransformCoordinates(this._positions[I],p))}return e._collide(w._trianglePlanes,w._lastColliderWorldVertices,this.Ke(),w.indexStart,w.indexStart+w.indexCount,w.verticesStart,!!w.Yw(),this,this._shouldConvertRHS(),7===(null===(r=w.Yw())||void 0===r?void 0:r.fillMode)),this}_processCollisionsForSubMeshes(w,p){const e=this._scene.getCollidingSubMeshCandidates(this,w),r=e.length;for(let I=0;I<r;I++){const d=e.data[I];r>1&&!d._checkCollision(w)||this._collideForSubMesh(d,p,w)}return this}_shouldConvertRHS(){return!1}_checkCollision(w){if(!this.getBoundingInfo()._checkCollision(w))return this;const p=d.d.Matrix[0],e=d.d.Matrix[1];return d.b.ScalingToRef(1/w._radius.x,1/w._radius.y,1/w._radius.z,p),this.worldMatrixFromCache.multiplyToRef(p,e),this._processCollisionsForSubMeshes(w,e),this}_generatePointsArray(){return!1}intersects(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=new j.d,E=this.getClassName(),X="InstancedLinesMesh"===E||"LinesMesh"===E||"GreasedLineMesh"===E?this.intersectionThreshold:0,k=this.getBoundingInfo();if(!this.oe)return q;if(!f&&(!w.intersectsSphere(k.boundingSphere,X)||!w.intersectsBox(k.boundingBox,X)))return q;if(r)return q.hit=!f,q.pickedMesh=f?null:this,q.distance=f?0:d.k.Distance(w.origin,k.boundingSphere.center),q.subMeshId=0,q;if(!this._generatePointsArray())return q;let m=null;const J=this._scene.getIntersectingSubMeshCandidates(this,w),K=J.length;let y=!1;for(let d=0;d<K;d++){const w=J.data[d].Yw();if(w&&(7==w.fillMode||0==w.fillMode||1==w.fillMode||2==w.fillMode||4==w.fillMode)){y=!0;break}}if(!y)return q.hit=!0,q.pickedMesh=this,q.distance=d.k.Distance(w.origin,k.boundingSphere.center),q.subMeshId=-1,q;for(let d=0;d<K;d++){const r=J.data[d];if(K>1&&!f&&!r.canIntersects(w))continue;const I=r.intersects(w,this._positions,this.Ke(),p,e);if(I&&(p||!m||I.distance<m.distance)&&(m=I,m.subMeshId=d,p))break}if(m){const p=I??this.getWorldMatrix(),e=d.d.ne[0],r=d.d.ne[1];d.k.TransformCoordinatesToRef(w.origin,p,e),w.direction.scaleToRef(m.distance,r);const f=d.k.TransformNormal(r,p).addInPlace(e);return q.hit=!0,q.distance=d.k.Distance(e,f),q.pickedPoint=f,q.pickedMesh=this,q.bu=m.bu||0,q.bv=m.bv||0,q.subMeshFaceId=m.faceId,q.faceId=m.faceId+J.data[m.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),q.subMeshId=m.subMeshId,q}return q}clone(w,p,e){return null}releaseSubMeshes(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.oe)for(;this.oe.length;)this.oe[0].dispose(w);else this.oe=[];return this}dispose(w){let p,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.iw();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),r.freeActiveMeshes(),r.freeRenderingGroups(),r.renderingManager.maintainStateBetweenFrames&&r.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((w=>w!==this&&w.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),p=0;p<this._intersectionsInProgress.length;p++){const w=this._intersectionsInProgress[p],e=w._intersectionsInProgress.indexOf(this);w._intersectionsInProgress.splice(e,1)}this._intersectionsInProgress.length=0;const I=r.lights;for(const f of I){let w=f.includedOnlyMeshes.indexOf(this);-1!==w&&f.includedOnlyMeshes.splice(w,1),w=f.excludedMeshes.indexOf(this),-1!==w&&f.excludedMeshes.splice(w,1);const p=f.getShadowGenerators();if(p){const e=p.values();for(let p=e.next();!0!==p.done;p=e.next()){const e=p.value.getShadowMap();e&&e.renderList&&(w=e.renderList.indexOf(this),-1!==w&&e.renderList.splice(w,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const d=r.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,d.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),d.wipeCaches(),r.iX(this),this._parentContainer){const w=this._parentContainer.meshes.indexOf(this);w>-1&&this._parentContainer.meshes.splice(w,1),this._parentContainer=null}if(e&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!w)for(p=0;p<r.tm.length;p++)r.tm[p].i===this&&(r.tm[p].dispose(),p--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(w,e)}_initFacetData(){const w=this._internalAbstractMeshDataInfo._facetData;w.facetNormals||(w.facetNormals=[]),w.facetPositions||(w.facetPositions=[]),w.facetPartitioning||(w.facetPartitioning=new Array),w.facetNb=this.Ke().length/3|0,w.partitioningSubdivisions=w.partitioningSubdivisions?w.partitioningSubdivisions:10,w.partitioningBBoxRatio=w.partitioningBBoxRatio?w.partitioningBBoxRatio:1.01;for(let p=0;p<w.facetNb;p++)w.facetNormals[p]=d.k.Zero(),w.facetPositions[p]=d.k.Zero();return w.facetDataEnabled=!0,this}updateFacetData(){const w=this._internalAbstractMeshDataInfo._facetData;w.facetDataEnabled||this._initFacetData();const p=this.getVerticesData(f.e.PositionKind),e=this.Ke(),r=this.getVerticesData(f.e.NormalKind),I=this.getBoundingInfo();if(w.facetDepthSort&&!w.facetDepthSortEnabled){if(w.facetDepthSortEnabled=!0,e instanceof Uint16Array)w.depthSortedIndices=new Uint16Array(e);else if(e instanceof Uint32Array)w.depthSortedIndices=new Uint32Array(e);else{let p=!1;for(let w=0;w<e.length;w++)if(e[w]>65535){p=!0;break}w.depthSortedIndices=p?new Uint32Array(e):new Uint16Array(e)}if(w.facetDepthSortFunction=function(w,p){return p.sqDistance-w.sqDistance},!w.facetDepthSortFrom){const p=this.iw().activeCamera;w.facetDepthSortFrom=p?p.position:d.k.Zero()}w.depthSortedFacets=[];for(let p=0;p<w.facetNb;p++){const e={ind:3*p,sqDistance:0};w.depthSortedFacets.push(e)}w.invertedMatrix=d.b.Identity(),w.facetDepthSortOrigin=d.k.Zero()}w.bbSize.x=I.maximum.x-I.minimum.x>c.c?I.maximum.x-I.minimum.x:c.c,w.bbSize.y=I.maximum.y-I.minimum.y>c.c?I.maximum.y-I.minimum.y:c.c,w.bbSize.z=I.maximum.z-I.minimum.z>c.c?I.maximum.z-I.minimum.z:c.c;let E=w.bbSize.x>w.bbSize.y?w.bbSize.x:w.bbSize.y;if(E=E>w.bbSize.z?E:w.bbSize.z,w.subDiv.max=w.partitioningSubdivisions,w.subDiv.X=Math.floor(w.subDiv.max*w.bbSize.x/E),w.subDiv.Y=Math.floor(w.subDiv.max*w.bbSize.y/E),w.subDiv.Z=Math.floor(w.subDiv.max*w.bbSize.z/E),w.subDiv.X=w.subDiv.X<1?1:w.subDiv.X,w.subDiv.Y=w.subDiv.Y<1?1:w.subDiv.Y,w.subDiv.Z=w.subDiv.Z<1?1:w.subDiv.Z,w.facetParameters.facetNormals=this.getFacetLocalNormals(),w.facetParameters.facetPositions=this.getFacetLocalPositions(),w.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),w.facetParameters.bInfo=I,w.facetParameters.bbSize=w.bbSize,w.facetParameters.subDiv=w.subDiv,w.facetParameters.ratio=this.partitioningBBoxRatio,w.facetParameters.depthSort=w.facetDepthSort,w.facetDepthSort&&w.facetDepthSortEnabled&&(this.ke(!0),this._worldMatrix.invertToRef(w.invertedMatrix),d.k.TransformCoordinatesToRef(w.facetDepthSortFrom,w.invertedMatrix,w.facetDepthSortOrigin),w.facetParameters.distanceTo=w.facetDepthSortOrigin),w.facetParameters.depthSortedFacets=w.depthSortedFacets,r&&q.b.ComputeNormals(p,e,r,w.facetParameters),w.facetDepthSort&&w.facetDepthSortEnabled){w.depthSortedFacets.sort(w.facetDepthSortFunction);const p=w.depthSortedIndices.length/3|0;for(let r=0;r<p;r++){const p=w.depthSortedFacets[r].ind;w.depthSortedIndices[3*r]=e[p],w.depthSortedIndices[3*r+1]=e[p+1],w.depthSortedIndices[3*r+2]=e[p+2]}this.updateIndices(w.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const w=this._internalAbstractMeshDataInfo._facetData;return w.facetNormals||this.updateFacetData(),w.facetNormals}getFacetLocalPositions(){const w=this._internalAbstractMeshDataInfo._facetData;return w.facetPositions||this.updateFacetData(),w.facetPositions}getFacetLocalPartitioning(){const w=this._internalAbstractMeshDataInfo._facetData;return w.facetPartitioning||this.updateFacetData(),w.facetPartitioning}getFacetPosition(w){const p=d.k.Zero();return this.getFacetPositionToRef(w,p),p}getFacetPositionToRef(w,p){const e=this.getFacetLocalPositions()[w],r=this.getWorldMatrix();return d.k.TransformCoordinatesToRef(e,r,p),this}getFacetNormal(w){const p=d.k.Zero();return this.getFacetNormalToRef(w,p),p}getFacetNormalToRef(w,p){const e=this.getFacetLocalNormals()[w];return d.k.TransformNormalToRef(e,this.getWorldMatrix(),p),this}getFacetsAtLocalCoordinates(w,p,e){const r=this.getBoundingInfo(),I=this._internalAbstractMeshDataInfo._facetData,d=Math.floor((w-r.minimum.x*I.partitioningBBoxRatio)*I.subDiv.X*I.partitioningBBoxRatio/I.bbSize.x),f=Math.floor((p-r.minimum.y*I.partitioningBBoxRatio)*I.subDiv.Y*I.partitioningBBoxRatio/I.bbSize.y),q=Math.floor((e-r.minimum.z*I.partitioningBBoxRatio)*I.subDiv.Z*I.partitioningBBoxRatio/I.bbSize.z);return d<0||d>I.subDiv.max||f<0||f>I.subDiv.max||q<0||q>I.subDiv.max?null:I.facetPartitioning[d+I.subDiv.max*f+I.subDiv.max*I.subDiv.max*q]}getClosestFacetAtCoordinates(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const q=this.getWorldMatrix(),E=d.d.Matrix[5];q.invertToRef(E);const j=d.d.ne[8];d.k.TransformCoordinatesFromFloatsToRef(w,p,e,E,j);const X=this.getClosestFacetAtLocalCoordinates(j.x,j.y,j.z,r,I,f);return r&&d.k.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,q,r),X}getClosestFacetAtLocalCoordinates(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=null,q=0,E=0,j=0,X=0,k=0,m=0,J=0,K=0;const y=this.getFacetLocalPositions(),c=this.getFacetLocalNormals(),s=this.getFacetsAtLocalCoordinates(w,p,e);if(!s)return null;let O,a,A,z=Number.MAX_VALUE,M=z;for(let i=0;i<s.length;i++)O=s[i],a=c[O],A=y[O],X=(w-A.x)*a.x+(p-A.y)*a.y+(e-A.z)*a.z,(!I||I&&d&&X>=0||I&&!d&&X<=0)&&(X=a.x*A.x+a.y*A.y+a.z*A.z,k=-(a.x*w+a.y*p+a.z*e-X)/(a.x*a.x+a.y*a.y+a.z*a.z),m=w+a.x*k,J=p+a.y*k,K=e+a.z*k,q=m-w,E=J-p,j=K-e,M=q*q+E*E+j*j,M<z&&(z=M,f=O,r&&(r.x=m,r.y=J,r.z=K)));return f}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const w=this._internalAbstractMeshDataInfo._facetData;return w.facetDataEnabled&&(w.facetDataEnabled=!1,w.facetPositions=[],w.facetNormals=[],w.facetPartitioning=new Array,w.facetParameters={},w.depthSortedIndices=new Uint32Array(0)),this}updateIndices(w,p){return this}createNormals(w){const p=this.getVerticesData(f.e.PositionKind),e=this.Ke();let r;return r=this.isVerticesDataPresent(f.e.NormalKind)?this.getVerticesData(f.e.NormalKind):[],q.b.ComputeNormals(p,e,r,{useRightHandedSystem:this.iw().useRightHandedSystem}),this.uw(f.e.NormalKind,r,w),this}async optimizeIndicesAsync(){const w=this.Ke();if(!w)return this;const{OptimizeIndices:p}=await e.e(35).then(e.bind(e,13674));return p(w),this.setIndices(w,this.getTotalVertices()),this}alignWithNormal(w,p){p||(p=s.b.Y);const e=d.d.ne[0],r=d.d.ne[1];return d.k.CrossToRef(p,w,r),d.k.CrossToRef(w,r,e),this.rotationQuaternion?d.c.RotationQuaternionFromAxisToRef(e,w,r,this.rotationQuaternion):d.k.RotationFromAxisToRef(e,w,r,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,J.c)("EdgesRenderer")}enableEdgesRendering(w,p,e){throw(0,J.c)("EdgesRenderer")}nm(){return this._scene.tm.filter((w=>w.i===this))}}i.OCCLUSION_TYPE_NONE=0,i.OCCLUSION_TYPE_OPTIMISTIC=1,i.OCCLUSION_TYPE_STRICT=2,i.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,i.CULLINGSTRATEGY_STANDARD=0,i.uk=1,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,r.c)([a.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r,I,d,f,q]=p;return!Array.isArray(r)&&!Array.isArray(I)&&!Array.isArray(d)&&!Array.isArray(f)&&!Array.isArray(q)}))],i,"_ApplySkeleton",null),(0,O.d)("BABYLON.AbstractMesh",i)},11772:(w,p,e)=>{e.d(p,{e:()=>r.e});var r=e(11232)},11391:(w,p,e)=>{e.d(p,{d:()=>c});var r=e(11023),I=e(11308),d=e(11337),f=e(11232),q=e(11227),E=e(11397),j=e(11265),X=e(11071),k=e(11304),m=e(11277),J=e(11051),K=e(11400),y=e(11247);class c{get boundingBias(){return this._boundingBias}set boundingBias(w){this._boundingBias?this._boundingBias.X(w):this._boundingBias=w.clone(),this.hw(!0,null)}static CreateGeometryForMesh(w){const p=new c(c.RandomId(),w.iw());return p.Vw(w),p}get meshes(){return this._meshes}constructor(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new r.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new r.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=p||J.d.LastCreatedScene,this._scene&&(this.id=w,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=I,e?this.setAllVerticesData(e,I):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),d&&(this.Vw(d),d.ke(!0)))}get extend(){return this._extend}iw(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let w=0;w<this._meshes.length;w++)if(!this._meshes[w].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const w=new Set;for(const p in this._vertexBuffers)w.add(this._vertexBuffers[p].getWrapperBuffer());w.forEach((w=>{w._rebuild()}))}setAllVerticesData(w,p){w.applyToGeometry(this,p),this._notifyUpdate()}uw(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;e&&Array.isArray(p)&&(p=new Float32Array(p));const I=new f.e(this._engine,p,w,{updatable:e,postponeInternalCreation:0===this._meshes.length,stride:r,label:"Geometry_"+this.id+"_"+w});this.setVerticesBuffer(I)}removeVerticesData(w){this._vertexBuffers[w]&&(this._vertexBuffers[w].dispose(),delete this._vertexBuffers[w]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const I=w.getKind();this._vertexBuffers[I]&&e&&this._vertexBuffers[I].dispose(),w._buffer&&w._buffer._increaseReferences(),this._vertexBuffers[I]=w;const d=this._meshes,q=d.length;if(I===f.e.PositionKind){this._totalVertices=p??w._maxVerticesCount,this._updateExtend(w.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const e=this._extend&&this._extend.minimum||new r.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),I=this._extend&&this._extend.maximum||new r.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let w=0;w<q;w++){const p=d[w];p.buildBoundingInfo(e,I),p._createGlobalSubMesh(p.isUnIndexed),p.ke(!0),p.synchronizeInstances()}}this._notifyUpdate(I)}updateVerticesDataDirectly(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=this.getVertexBuffer(w);I&&(I.updateDirectly(p,e,r),this._notifyUpdate(w))}updateVerticesData(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.getVertexBuffer(w);r&&(r.update(p),w===f.e.PositionKind&&this.hw(e,p),this._notifyUpdate(w))}hw(w,p){if(w&&this._updateExtend(p),this._resetPointsArrayCache(),w){const w=this._meshes;for(const p of w){p.hasBoundingInfo?p.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):p.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const w=p.oe;for(const p of w)p.refreshBoundingInfo()}}}_bind(w,p,e,r){if(!w)return;void 0===p&&(p=this._indexBuffer);const I=this.getVertexBuffers();if(!I)return;if(p!=this._indexBuffer||!this._vertexArrayObjects&&!r)return void this._engine.bindBuffers(I,p,w,e);const d=r||this._vertexArrayObjects,f=this._engine;d[w.key]||(d[w.key]=f.recordVertexArrayObject(I,p,w,e)),f.bindVertexArrayObject(d[w.key],p)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(w,p,e){const r=this.getVertexBuffer(w);return r?r.getFloatData(this._totalVertices,e||p&&1!==this._meshes.length):null}copyVerticesData(w,p){const e=this.getVertexBuffer(w);if(!e)return;p[w]||(p[w]=new Float32Array(this._totalVertices*e.getSize()));const r=e.getData();r&&(0,y.d)(r,e.getSize(),e.type,e.byteOffset,e.byteStride,e.normalized,this._totalVertices,p[w])}isVertexBufferUpdatable(w){const p=this._vertexBuffers[w];return!!p&&p.isUpdatable()}getVertexBuffer(w){return this.isReady()?this._vertexBuffers[w]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(w){return this._vertexBuffers?void 0!==this._vertexBuffers[w]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(w)}getVerticesDataKinds(){const w=[];let p;if(!this._vertexBuffers&&this._delayInfo)for(p in this._delayInfo)w.push(p);else for(p in this._vertexBuffers)w.push(p);return w}updateIndices(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const r=w.length!==this._indices.length;if(e||(this._indices=w.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,w,p),r)for(const w of this._meshes)w._createGlobalSubMesh(!0)}else this.setIndices(w,null,!0)}setIndexBuffer(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=w,this._totalVertices=p,this._totalIndices=e,w.is32Bits=null===r?p>65535:r;for(const I of this._meshes)I._createGlobalSubMesh(!0),I.synchronizeInstances();this._notifyUpdate()}setIndices(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=w,this._indexBufferIsUpdatable=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,e,"Geometry_"+this.id+"_IndexBuffer")),void 0!=p&&(this._totalVertices=p);for(const I of this._meshes)I._createGlobalSubMesh(!r),I.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Ke(w,p){if(!this.isReady())return null;const e=this._indices;return p||w&&1!==this._meshes.length?e.slice():e}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;w&&this._vertexArrayObjects&&this._vertexArrayObjects[w.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[w.key]),delete this._vertexArrayObjects[w.key])}releaseForMesh(w,p){const e=this._meshes,r=e.indexOf(w);-1!==r&&(e.splice(r,1),this._vertexArrayObjects&&w._invalidateInstanceVertexArrayObject(),w._geometry=null,0===e.length&&p&&this.dispose())}Vw(w){if(w._geometry===this)return;const p=w._geometry;p&&p.releaseForMesh(w),this._vertexArrayObjects&&w._invalidateInstanceVertexArrayObject();const e=this._meshes;w._geometry=this,w._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),e.push(w),this.isReady()?this._applyToMesh(w):this._boundingInfo&&w.setBoundingInfo(this._boundingInfo)}_updateExtend(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!w&&(w=this.getVerticesData(f.e.PositionKind),!w))return;this._extend=(0,m.d)(w,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(w){const p=this._meshes.length;for(const e in this._vertexBuffers)1===p&&this._vertexBuffers[e].create(),e===f.e.PositionKind&&(this._extend||this._updateExtend(),w.buildBoundingInfo(this._extend.minimum,this._extend.maximum),w._createGlobalSubMesh(w.isUnIndexed),w.hw());1===p&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),w._syncGeometryWithMorphTargetManager(),w.synchronizeInstances()}_notifyUpdate(w){this.onGeometryUpdated&&this.onGeometryUpdated(this,w),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const p of this._meshes)p._markSubMeshesAsAttributesDirty()}load(w,p){2!==this.delayLoadState&&(this.isReady()?p&&p():(this.delayLoadState=2,this._queueLoad(w,p)))}_queueLoad(w,p){this.delayLoadingFile&&(w.addPendingData(this),w._loadFile(this.delayLoadingFile,(e=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(e),this),this.delayLoadState=1,this._delayInfo=[],w.removePendingData(this);const r=this._meshes,I=r.length;for(let w=0;w<I;w++)this._applyToMesh(r[w]);p&&p()}),void 0,!0))}toLeftHanded(){const w=this.Ke(!1);if(null!=w&&w.length>0){for(let p=0;p<w.length;p+=3){const e=w[p+0];w[p+0]=w[p+2],w[p+2]=e}this.setIndices(w)}const p=this.getVerticesData(f.e.PositionKind,!1);if(null!=p&&p.length>0){for(let w=0;w<p.length;w+=3)p[w+2]=-p[w+2];this.uw(f.e.PositionKind,p,!1)}const e=this.getVerticesData(f.e.NormalKind,!1);if(null!=e&&e.length>0){for(let w=0;w<e.length;w+=3)e[w+2]=-e[w+2];this.uw(f.e.NormalKind,e,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const w=this.getVerticesData(f.e.PositionKind);if(!w||0===w.length)return!1;for(let p=3*this._positionsCache.length,e=this._positionsCache.length;p<w.length;p+=3,++e)this._positionsCache[e]=r.k.Ve(w,p);for(let p=0,e=0;p<w.length;p+=3,++e)this._positionsCache[e].set(w[0+p],w[1+p],w[2+p]);return this._positionsCache.length=w.length/3,this._positions=this._positionsCache,!0}K(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};const w=this._meshes,p=w.length;for(let e=0;e<p;e++)w[e]._invalidateInstanceVertexArrayObject()}}dispose(){const w=this._meshes,p=w.length;let e;for(e=0;e<p;e++)this.releaseForMesh(w[e]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const r in this._vertexBuffers)this._vertexBuffers[r].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const w=this._parentContainer.geometries.indexOf(this);w>-1&&this._parentContainer.geometries.splice(w,1),this._parentContainer=null}this._isDisposed=!0}k(w){const p=new d.b;p.indices=[];const e=this.Ke();if(e)for(let d=0;d<e.length;d++)p.indices.push(e[d]);let r,I=!1,f=!1;for(r in this._vertexBuffers){const w=this.getVerticesData(r);if(w&&(w instanceof Float32Array?p.set(new Float32Array(w),r):p.set(w.slice(0),r),!f)){const w=this.getVertexBuffer(r);w&&(I=w.isUpdatable(),f=!I)}}const q=new c(w,this._scene,p,I);for(r in q.delayLoadState=this.delayLoadState,q.delayLoadingFile=this.delayLoadingFile,q._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)q._delayInfo=q._delayInfo||[],q._delayInfo.push(r);return q._boundingInfo=new j.b(this._extend.minimum,this._extend.maximum),q}serialize(){const w={};return w.id=this.id,w.uniqueId=this.uniqueId,w.updatable=this._updatable,k.b&&k.b.HasTags(this)&&(w.tags=k.b.GetTags(this)),w}_toNumberArray(w){return Array.isArray(w)?w:Array.prototype.slice.call(w)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const w in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,w)&&(this._vertexBuffers[w]._buffer._data=null)}serializeVerticeData(){const w=this.serialize();return this.isVerticesDataPresent(f.e.PositionKind)&&(w.nw=this._toNumberArray(this.getVerticesData(f.e.PositionKind)),this.isVertexBufferUpdatable(f.e.PositionKind)&&(w.positionsUpdatable=!0)),this.isVerticesDataPresent(f.e.NormalKind)&&(w.lw=this._toNumberArray(this.getVerticesData(f.e.NormalKind)),this.isVertexBufferUpdatable(f.e.NormalKind)&&(w.normalsUpdatable=!0)),this.isVerticesDataPresent(f.e.TangentKind)&&(w.tangents=this._toNumberArray(this.getVerticesData(f.e.TangentKind)),this.isVertexBufferUpdatable(f.e.TangentKind)&&(w.tangentsUpdatable=!0)),this.isVerticesDataPresent(f.e.UVKind)&&(w.Uw=this._toNumberArray(this.getVerticesData(f.e.UVKind)),this.isVertexBufferUpdatable(f.e.UVKind)&&(w.uvsUpdatable=!0)),this.isVerticesDataPresent(f.e.UV2Kind)&&(w.uvs2=this._toNumberArray(this.getVerticesData(f.e.UV2Kind)),this.isVertexBufferUpdatable(f.e.UV2Kind)&&(w.uvs2Updatable=!0)),this.isVerticesDataPresent(f.e.UV3Kind)&&(w.uvs3=this._toNumberArray(this.getVerticesData(f.e.UV3Kind)),this.isVertexBufferUpdatable(f.e.UV3Kind)&&(w.uvs3Updatable=!0)),this.isVerticesDataPresent(f.e.UV4Kind)&&(w.uvs4=this._toNumberArray(this.getVerticesData(f.e.UV4Kind)),this.isVertexBufferUpdatable(f.e.UV4Kind)&&(w.uvs4Updatable=!0)),this.isVerticesDataPresent(f.e.UV5Kind)&&(w.uvs5=this._toNumberArray(this.getVerticesData(f.e.UV5Kind)),this.isVertexBufferUpdatable(f.e.UV5Kind)&&(w.uvs5Updatable=!0)),this.isVerticesDataPresent(f.e.UV6Kind)&&(w.uvs6=this._toNumberArray(this.getVerticesData(f.e.UV6Kind)),this.isVertexBufferUpdatable(f.e.UV6Kind)&&(w.uvs6Updatable=!0)),this.isVerticesDataPresent(f.e.ColorKind)&&(w.Nw=this._toNumberArray(this.getVerticesData(f.e.ColorKind)),this.isVertexBufferUpdatable(f.e.ColorKind)&&(w.colorsUpdatable=!0)),this.isVerticesDataPresent(f.e.MatricesIndicesKind)&&(w.matricesIndices=this._toNumberArray(this.getVerticesData(f.e.MatricesIndicesKind)),w.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(f.e.MatricesIndicesKind)&&(w.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(f.e.MatricesWeightsKind)&&(w.matricesWeights=this._toNumberArray(this.getVerticesData(f.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(f.e.MatricesWeightsKind)&&(w.matricesWeightsUpdatable=!0)),w.indices=this._toNumberArray(this.Ke()),w}static ExtractFromMesh(w,p){const e=w._geometry;return e?e.k(p):null}static RandomId(){return X.g.RandomId()}static _GetGeometryByLoadedUniqueId(w,p){for(let e=0;e<p.geometries.length;e++)if(p.geometries[e]._loadedUniqueId===w)return p.geometries[e];return null}static _ImportGeometry(w,p){const e=p.iw(),r=w.geometryUniqueId,d=w.geometryId;if(r||d){const w=r?this._GetGeometryByLoadedUniqueId(r,e):e.getGeometryById(d);w&&w.Vw(p)}else if(w instanceof ArrayBuffer){const e=p._binaryInfo;if(e.positionsAttrDesc&&e.positionsAttrDesc.count>0){const r=new Float32Array(w,e.positionsAttrDesc.offset,e.positionsAttrDesc.count);p.uw(f.e.PositionKind,r,!1)}if(e.normalsAttrDesc&&e.normalsAttrDesc.count>0){const r=new Float32Array(w,e.normalsAttrDesc.offset,e.normalsAttrDesc.count);p.uw(f.e.NormalKind,r,!1)}if(e.tangetsAttrDesc&&e.tangetsAttrDesc.count>0){const r=new Float32Array(w,e.tangetsAttrDesc.offset,e.tangetsAttrDesc.count);p.uw(f.e.TangentKind,r,!1)}if(e.uvsAttrDesc&&e.uvsAttrDesc.count>0){const r=new Float32Array(w,e.uvsAttrDesc.offset,e.uvsAttrDesc.count);if(K.b)for(let w=1;w<r.length;w+=2)r[w]=1-r[w];p.uw(f.e.UVKind,r,!1)}if(e.uvs2AttrDesc&&e.uvs2AttrDesc.count>0){const r=new Float32Array(w,e.uvs2AttrDesc.offset,e.uvs2AttrDesc.count);if(K.b)for(let w=1;w<r.length;w+=2)r[w]=1-r[w];p.uw(f.e.UV2Kind,r,!1)}if(e.uvs3AttrDesc&&e.uvs3AttrDesc.count>0){const r=new Float32Array(w,e.uvs3AttrDesc.offset,e.uvs3AttrDesc.count);if(K.b)for(let w=1;w<r.length;w+=2)r[w]=1-r[w];p.uw(f.e.UV3Kind,r,!1)}if(e.uvs4AttrDesc&&e.uvs4AttrDesc.count>0){const r=new Float32Array(w,e.uvs4AttrDesc.offset,e.uvs4AttrDesc.count);if(K.b)for(let w=1;w<r.length;w+=2)r[w]=1-r[w];p.uw(f.e.UV4Kind,r,!1)}if(e.uvs5AttrDesc&&e.uvs5AttrDesc.count>0){const r=new Float32Array(w,e.uvs5AttrDesc.offset,e.uvs5AttrDesc.count);if(K.b)for(let w=1;w<r.length;w+=2)r[w]=1-r[w];p.uw(f.e.UV5Kind,r,!1)}if(e.uvs6AttrDesc&&e.uvs6AttrDesc.count>0){const r=new Float32Array(w,e.uvs6AttrDesc.offset,e.uvs6AttrDesc.count);if(K.b)for(let w=1;w<r.length;w+=2)r[w]=1-r[w];p.uw(f.e.UV6Kind,r,!1)}if(e.colorsAttrDesc&&e.colorsAttrDesc.count>0){const r=new Float32Array(w,e.colorsAttrDesc.offset,e.colorsAttrDesc.count);p.uw(f.e.ColorKind,r,!1,e.colorsAttrDesc.stride)}if(e.matricesIndicesAttrDesc&&e.matricesIndicesAttrDesc.count>0){const r=new Int32Array(w,e.matricesIndicesAttrDesc.offset,e.matricesIndicesAttrDesc.count),I=[];for(let w=0;w<r.length;w++){const p=r[w];I.push(255&p),I.push((65280&p)>>8),I.push((16711680&p)>>16),I.push(p>>24&255)}p.uw(f.e.MatricesIndicesKind,I,!1)}if(e.matricesIndicesExtraAttrDesc&&e.matricesIndicesExtraAttrDesc.count>0){const r=new Int32Array(w,e.matricesIndicesExtraAttrDesc.offset,e.matricesIndicesExtraAttrDesc.count),I=[];for(let w=0;w<r.length;w++){const p=r[w];I.push(255&p),I.push((65280&p)>>8),I.push((16711680&p)>>16),I.push(p>>24&255)}p.uw(f.e.MatricesIndicesExtraKind,I,!1)}if(e.matricesWeightsAttrDesc&&e.matricesWeightsAttrDesc.count>0){const r=new Float32Array(w,e.matricesWeightsAttrDesc.offset,e.matricesWeightsAttrDesc.count);p.uw(f.e.MatricesWeightsKind,r,!1)}if(e.indicesAttrDesc&&e.indicesAttrDesc.count>0){const r=new Int32Array(w,e.indicesAttrDesc.offset,e.indicesAttrDesc.count);p.setIndices(r,null)}if(e.subMeshesAttrDesc&&e.subMeshesAttrDesc.count>0){const r=new Int32Array(w,e.subMeshesAttrDesc.offset,5*e.subMeshesAttrDesc.count);p.oe=[];for(let w=0;w<e.subMeshesAttrDesc.count;w++){const e=r[5*w+0],I=r[5*w+1],d=r[5*w+2],f=r[5*w+3],E=r[5*w+4];q.b.AddToMesh(e,I,d,f,E,p)}}}else if(w.nw&&w.lw&&w.indices){if(p.uw(f.e.PositionKind,w.nw,w.nw._updatable||w.positionsUpdatable),p.uw(f.e.NormalKind,w.lw,w.lw._updatable||w.normalsUpdatable),w.tangents&&p.uw(f.e.TangentKind,w.tangents,w.tangents._updatable||w.tangentsUpdatable),w.Uw&&p.uw(f.e.UVKind,w.Uw,w.Uw._updatable||w.uvsUpdatable),w.uvs2&&p.uw(f.e.UV2Kind,w.uvs2,w.uvs2._updatable||w.uvs2Updatable),w.uvs3&&p.uw(f.e.UV3Kind,w.uvs3,w.uvs3._updatable||w.uvs3Updatable),w.uvs4&&p.uw(f.e.UV4Kind,w.uvs4,w.uvs4._updatable||w.uvs4Updatable),w.uvs5&&p.uw(f.e.UV5Kind,w.uvs5,w.uvs5._updatable||w.uvs5Updatable),w.uvs6&&p.uw(f.e.UV6Kind,w.uvs6,w.uvs6._updatable||w.uvs6Updatable),w.Nw&&p.uw(f.e.ColorKind,I.e.CheckColors4(w.Nw,w.nw.length/3),w.Nw._updatable),w.matricesIndices)if(w.matricesIndices._isExpanded||w.matricesIndicesExpanded)delete w.matricesIndices._isExpanded,delete w.matricesIndicesExpanded,p.uw(f.e.MatricesIndicesKind,w.matricesIndices,w.matricesIndices._updatable||w.matricesIndicesUpdatable);else{const e=[];for(let p=0;p<w.matricesIndices.length;p++){const r=w.matricesIndices[p];e.push(255&r),e.push((65280&r)>>8),e.push((16711680&r)>>16),e.push(r>>24&255)}p.uw(f.e.MatricesIndicesKind,e,w.matricesIndices._updatable||w.matricesIndicesUpdatable)}if(w.matricesIndicesExtra)if(w.matricesIndicesExtraExpanded||w.matricesIndicesExtra._isExpanded)delete w.matricesIndices._isExpanded,delete w.matricesIndicesExtraExpanded,p.uw(f.e.MatricesIndicesExtraKind,w.matricesIndicesExtra,w.matricesIndicesExtra._updatable||w.matricesIndicesExtraUpdatable);else{const e=[];for(let p=0;p<w.matricesIndicesExtra.length;p++){const r=w.matricesIndicesExtra[p];e.push(255&r),e.push((65280&r)>>8),e.push((16711680&r)>>16),e.push(r>>24&255)}p.uw(f.e.MatricesIndicesExtraKind,e,w.matricesIndicesExtra._updatable||w.matricesIndicesExtraUpdatable)}w.matricesWeights&&(c._CleanMatricesWeights(w,p),p.uw(f.e.MatricesWeightsKind,w.matricesWeights,w.matricesWeights._updatable)),w.matricesWeightsExtra&&p.uw(f.e.MatricesWeightsExtraKind,w.matricesWeightsExtra,w.matricesWeights._updatable),p.setIndices(w.indices,null)}if(w.oe){p.oe=[];for(let e=0;e<w.oe.length;e++){const r=w.oe[e];q.b.AddToMesh(r.materialIndex,r.verticesStart,r.verticesCount,r.indexStart,r.indexCount,p)}}p._shouldGenerateFlatShading&&(p.convertToFlatShadedMesh(),p._shouldGenerateFlatShading=!1),p.ke(!0),e.onMeshImportedObservable.notifyObservers(p)}static _CleanMatricesWeights(w,p){const e=.001;if(!E.d.CleanBoneMatrixWeights)return;let r=0;if(!(w.skeletonId>-1))return;{const e=p.iw().getLastSkeletonById(w.skeletonId);if(!e)return;r=e.bones.length}const I=p.getVerticesData(f.e.MatricesIndicesKind),d=p.getVerticesData(f.e.MatricesIndicesExtraKind),q=w.matricesWeights,j=w.matricesWeightsExtra,X=w.numBoneInfluencer,k=q.length;for(let f=0;f<k;f+=4){let w=0,p=-1;for(let r=0;r<4;r++){const I=q[f+r];w+=I,I<e&&p<0&&(p=r)}if(j)for(let r=0;r<4;r++){const I=j[f+r];w+=I,I<e&&p<0&&(p=r+4)}if((p<0||p>X-1)&&(p=X-1),w>e){const p=1/w;for(let w=0;w<4;w++)q[f+w]*=p;if(j)for(let w=0;w<4;w++)j[f+w]*=p}else p>=4?(j[f+p-4]=1-w,d[f+p-4]=r):(q[f+p]=1-w,I[f+p]=r)}p.uw(f.e.MatricesIndicesKind,I),w.matricesWeightsExtra&&p.uw(f.e.MatricesIndicesExtraKind,d)}static Parse(w,p,e){const I=new c(w.id,p,void 0,w.updatable);return I._loadedUniqueId=w.uniqueId,k.b&&k.b.AddTagsTo(I,w.tags),w.delayLoadingFile?(I.delayLoadState=4,I.delayLoadingFile=e+w.delayLoadingFile,I._boundingInfo=new j.b(r.k.Ve(w.boundingBoxMinimum),r.k.Ve(w.boundingBoxMaximum)),I._delayInfo=[],w.hasUVs&&I._delayInfo.push(f.e.UVKind),w.hasUVs2&&I._delayInfo.push(f.e.UV2Kind),w.hasUVs3&&I._delayInfo.push(f.e.UV3Kind),w.hasUVs4&&I._delayInfo.push(f.e.UV4Kind),w.hasUVs5&&I._delayInfo.push(f.e.UV5Kind),w.hasUVs6&&I._delayInfo.push(f.e.UV6Kind),w.hasColors&&I._delayInfo.push(f.e.ColorKind),w.hasMatricesIndices&&I._delayInfo.push(f.e.MatricesIndicesKind),w.hasMatricesWeights&&I._delayInfo.push(f.e.MatricesWeightsKind),I._delayLoadingFunction=d.b.ImportVertexData):d.b.ImportVertexData(w,I),p.pushGeometry(I,!0),I}}},11365:(w,p,e)=>{e.d(p,{b:()=>m});var r=e(11023),I=e(11081),d=e(11333),f=e(11370),q=e(11086),E=e(11325),j=e(11232),X=e(11071),k=e(11038);f.c._instancedMeshFactory=(w,p)=>{const e=new m(w,p);if(p.instancedBuffers){e.instancedBuffers={};for(const w in p.instancedBuffers)e.instancedBuffers[w]=p.instancedBuffers[w]}return e};class m extends d.b{constructor(w,p){super(w,p.iw()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,p.Fm(this),this._sourceMesh=p,this._unIndexed=p._unIndexed,this.position.X(p.position),this.rotation.X(p.rotation),this.Ne.X(p.Ne),p.rotationQuaternion&&(this.rotationQuaternion=p.rotationQuaternion.clone()),this.animations=p.animations.slice();for(const e of p.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);if(this.infiniteDistance=p.infiniteDistance,this.setPivotMatrix(p.getPivotMatrix()),p.skeleton||p.morphTargetManager||!p.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const w=p.getBoundingInfo();this.buildBoundingInfo(w.minimum,w.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(w){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.receiveShadows)!==w&&X.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(w){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.material)!==w&&X.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(w){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.visibility)!==w&&X.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(w){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.skeleton)!==w&&X.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(w){this._sourceMesh&&w!==this._sourceMesh.renderingGroupId&&I.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get me(){return this._sourceMesh._geometry}createInstance(w){return this._sourceMesh.createInstance(w)}isReady(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(w,!0)}getVerticesData(w,p,e){return this._sourceMesh.getVerticesData(w,p,e)}copyVerticesData(w,p){this._sourceMesh.copyVerticesData(w,p)}uw(w,p,e,r){return this.sourceMesh&&this.sourceMesh.uw(w,p,e,r),this.sourceMesh}updateVerticesData(w,p,e,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(w,p,e,r),this.sourceMesh}setIndices(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(w,p),this.sourceMesh}isVerticesDataPresent(w){return this._sourceMesh.isVerticesDataPresent(w)}Ke(){return this._sourceMesh.Ke()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let w,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;w="object"===typeof p?p:{applySkeleton:p,applyMorph:e};const r=this._sourceMesh.me?this._sourceMesh.me.boundingBias:null;return this.Pw(this._sourceMesh._getData(w,null,j.e.PositionKind),r),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(w,p){if(super._activate(w,p),this._sourceMesh.oe||I.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,w),p){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==E.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new r.b);const w=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,r.d.ne[7].X(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.X(this._currentLOD.ke(!0)),this._currentLOD.position.X(r.d.ne[7]),this._currentLOD._masterMesh=w,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(w){if(!w)return this;const p=this.sourceMesh.getLODLevels();if(p&&0!==p.length){const p=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(w,p.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(w){return this.sourceMesh._preActivateForIntermediateRendering(w)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.oe)for(let w=0;w<this._sourceMesh.oe.length;w++)this._sourceMesh.oe[w].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}hw(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;const r=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(w);if(q.d.DeepCopy(this,r,["name","oe","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","im","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","me"],[]),this.refreshBoundingInfo(),p&&(r.parent=p),!e)for(let I=0;I<this.iw().meshes.length;I++){const w=this.iw().meshes[I];w.parent===this&&w.clone(w.name,r)}return r.ke(!0),this.onClonedObservable.notifyObservers(r),r}dispose(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Wm(this),super.dispose(w,p)}_serializeAsParent(w){super._serializeAsParent(w),w.parentId=this._sourceMesh.uniqueId,w.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const r=this.clone("Clone of "+(this.name||this.id),w||this.parent,!0,p&&p.newSourcedMesh);r&&e&&e(this,r);for(const I of this.getChildTransformNodes(!0))I.instantiateHierarchy(r,p,e);return r}}f.c.prototype.registerInstancedBuffer=function(w,p){var e,r;if(null===(e=this._userInstancedBuffersStorage)||void 0===e||null===(r=e.vertexBuffers[w])||void 0===r||r.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const w of this.instances)w.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[w]=null,this._userInstancedBuffersStorage.strides[w]=p,this._userInstancedBuffersStorage.sizes[w]=32*p,this._userInstancedBuffersStorage.data[w]=new Float32Array(this._userInstancedBuffersStorage.sizes[w]),this._userInstancedBuffersStorage.vertexBuffers[w]=new j.e(this.getEngine(),this._userInstancedBuffersStorage.data[w],w,!0,!1,p,!0);for(const I of this.instances)I.instancedBuffers[w]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},f.c.prototype._processInstancedBuffers=function(w,p){const e=w?w.length:0;for(const r in this.instancedBuffers){let I=this._userInstancedBuffersStorage.sizes[r];const d=this._userInstancedBuffersStorage.strides[r],f=(e+1)*d;for(;I<f;)I*=2;this._userInstancedBuffersStorage.data[r].length!=I&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(I),this._userInstancedBuffersStorage.sizes[r]=I,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));const q=this._userInstancedBuffersStorage.data[r];let E=0;if(p){const w=this.instancedBuffers[r];w.toArray?w.toArray(q,E):w.copyToArray?w.copyToArray(q,E):q[E]=w,E+=d}for(let p=0;p<e;p++){const e=w[p].instancedBuffers[r];e.toArray?e.toArray(q,E):e.copyToArray?e.copyToArray(q,E):q[E]=e,E+=d}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(q,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new j.e(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,d,!0),this._invalidateInstanceVertexArrayObject())}},f.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const w in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[w]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},f.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const w in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[w]&&this._userInstancedBuffersStorage.vertexBuffers[w].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,k.d)("BABYLON.InstancedMesh",m)},11735:(w,p,e)=>{e.d(p,{d:()=>j});var r=e(11308),I=e(11232),d=e(11370),f=e(11365),q=e(11203),E=e(11739);d.c._LinesMeshParser=(w,p)=>j.Parse(w,p);class j extends d.c{_isShaderMaterial(w){return"ShaderMaterial"===w.getClassName()}constructor(w){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0;super(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p,arguments.length>4?arguments[4]:void 0),this.useVertexColor=d,this.useVertexAlpha=f,this.color=new r.b(1,1,1),this.alpha=1,this._shaderLanguage=0,p&&(this.color=p.color.clone(),this.alpha=p.alpha,this.useVertexColor=p.useVertexColor,this.useVertexAlpha=p.useVertexAlpha),this.intersectionThreshold=.1;const X={attributes:[I.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?X.defines.push("#define VERTEXALPHA"):X.needAlphaBlending=!1,this.useVertexColor?(X.defines.push("#define VERTEXCOLOR"),X.attributes.push(I.e.ColorKind)):(X.uniforms.push("color"),this._color4=new r.e),q)this.material=q;else{this.iw().getEngine().isWebGPU&&!j.ForceGLSL&&(this._shaderLanguage=1),X.shaderLanguage=this._shaderLanguage,X.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([e.e(23).then(e.bind(e,14291)),e.e(19).then(e.bind(e,14299))]):await Promise.all([e.e(17).then(e.bind(e,14305)),e.e(16).then(e.bind(e,14313))])},this.material=new E.c("colorShader",this.iw(),"color",X,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(w){this._lineMaterial=w,this._lineMaterial.fillMode=q.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(w){}_bind(w,p){if(!this._geometry)return this;const e=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(p,e):this._geometry._bind(p,e,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:w,g:p,b:e}=this.color;this._color4.set(w,p,e,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(w,p,e){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=this.iw().getEngine();return this._unIndexed?r.drawArraysType(q.b.LineListDrawMode,w.verticesStart,w.verticesCount,e):r.drawElementsType(q.b.LineListDrawMode,w.indexStart,w.indexCount,e),this}dispose(w){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(w)}clone(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;if(p&&void 0===p._addToSceneRootNodes){const e=p;return e.source=this,new j(w,this.iw(),e.parent,e.source,e.doNotCloneChildren)}return new j(w,this.iw(),p,this,e)}createInstance(w){const p=new X(w,this);if(this.instancedBuffers){p.instancedBuffers={};for(const w in this.instancedBuffers)p.instancedBuffers[w]=this.instancedBuffers[w]}return p}serialize(w){super.serialize(w),w.color=this.color.ze(),w.alpha=this.alpha}static Parse(w,p){const e=new j(w.name,p);return e.color=r.b.Ve(w.color),e.alpha=w.alpha,e}}j.ForceGLSL=!1;class X extends f.b{constructor(w,p){super(w,p),this.intersectionThreshold=p.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11370:(w,p,e)=>{e.d(p,{c:()=>b,e:()=>l});var r=e(11056),I=e(11071),d=e(11086),f=e(11304),q=e(11346),E=e(11374),j=e(11023),X=e(11308),k=e(11331),m=e(11232),J=e(11337),K=e(11391),y=e(11333),c=e(11227),s=e(11203),O=e(11404),a=e(11397),A=e(11301),z=e(11081),M=e(11038),i=e(11094),t=e(11408);class n{constructor(w,p){this.distanceOrScreenCoverage=w,this.mesh=p}}class l{}class N{constructor(){this.visibleInstances={},this.batchCache=new U,this.batchCacheReplacementModeInFrozenMode=new U,this.instancesBufferSize=2048}}class U{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class v{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class R{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const V={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class b extends y.b{static _GetDefaultSideOrientation(w){return w||b.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(w){this._internalMeshDataInfo._useLODScreenCoverage=w,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(w){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==w&&(w&&this._internalMeshDataInfo._sourcePositions&&(this.uw(m.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.uw(m.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=w,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new r.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new r.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new r.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new r.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new r.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(w){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(w)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(w){this._internalMeshDataInfo._forcedInstanceCount=w}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(w){this._internalMeshDataInfo._sideOrientation=w,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===w||!this._scene.useRightHandedSystem&&0===w}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(w){this.sideOrientation=w,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(w){this._internalMeshDataInfo._overrideRenderingFillMode=w}get material(){return this._internalAbstractMeshDataInfo._material}set material(w){w&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(w.sideOrientation=null),this._setMaterial(w)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(w){this._unIndexed!==w&&(this._unIndexed=w,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(w){this._instanceDataStorage.manualUpdate=w}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(w){this._instanceDataStorage.previousManualUpdate=w}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(w){this._instanceDataStorage.forceMatrixUpdates=w}_copySource(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=this.iw();if(w._geometry&&w._geometry.Vw(this),d.d.DeepCopy(w,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","me","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","im","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=w,I.useClonedMeshMap&&(w._internalMeshDataInfo.meshMap||(w._internalMeshDataInfo.meshMap={}),w._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=w._originalBuilderSideOrientation,this._creationDataStorage=w._creationDataStorage,w._ranges){const p=w._ranges;for(const w in p)Object.prototype.hasOwnProperty.call(p,w)&&p[w]&&this.createAnimationRange(w,p[w].from,p[w].to)}if(w.metadata&&w.metadata.clone?this.metadata=w.metadata.clone():this.metadata=w.metadata,this._internalMetadata=w._internalMetadata,f.b&&f.b.HasTags(w)&&f.b.AddTagsTo(this,f.b.GetTags(w,!0)),this.yE(w.isEnabled(!1)),this.parent=w.parent,this.setPivotMatrix(w.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+w.id,this.material=w.material,!p){const I=w.getDescendants(!0);for(let w=0;w<I.length;w++){const d=I[w];d._isMesh?(V.parent=this,V.doNotCloneChildren=p,V.clonePhysicsImpostor=e,V.cloneThinInstances=r,d.clone(this.name+"."+d.name,V)):d.clone&&d.clone(this.name+"."+d.name,this)}}if(w.morphTargetManager&&(this.morphTargetManager=w.morphTargetManager),I.getPhysicsEngine){const p=I.getPhysicsEngine();if(e&&p)if(1===p.getPluginVersion()){const e=p.getImpostorForPhysicsObject(w);e&&(this.physicsImpostor=e.clone(this))}else 2===p.getPluginVersion()&&w.physicsBody&&w.physicsBody.clone(this)}for(let d=0;d<I.tm.length;d++){const p=I.tm[d];p.i===w&&p.clone(p.name,this)}if(this.skeleton=w.skeleton,r&&(w._thinInstanceDataStorage.matrixData?(this.Lk("matrix",new Float32Array(w._thinInstanceDataStorage.matrixData),16,!w._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=w._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=w._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=w._thinInstanceDataStorage.matrixBufferSize,w._userThinInstanceBuffersStorage)){const p=w._userThinInstanceBuffersStorage;for(const w in p.data){var q,E;this.Lk(w,new Float32Array(p.data[w]),p.strides[w],!(null!==(q=p.vertexBuffers)&&void 0!==q&&null!==(E=q[w])&&void 0!==E&&E.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[w]=p.sizes[w]}}this.refreshBoundingInfo(!0,!0),this.ke(!0)}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0,f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(w,p),this._internalMeshDataInfo=new R,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new N,this._thinInstanceDataStorage=new v,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=b.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,p=this.iw(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(w,p,e)=>{w&&e&&(this._uniformBuffer?this.transferToEffect(p):e.bindOnlyWorldMatrix(p))};let q=null,E=!1;if(e&&void 0===e._addToSceneRootNodes){const w=e;q=w.parent??null,I=w.source??null,d=w.doNotCloneChildren??!1,f=w.clonePhysicsImpostor??!0,E=w.cloneThinInstances??!1}else q=e;I&&this._copySource(I,d,f,E),null!==q&&(this.parent=q),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=w=>{w.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new r.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),I&&I.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const r=0===this.getTotalVertices()||p&&p.doNotInstantiate&&(!0===p.doNotInstantiate||p.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),w||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r.parent=w||this.parent,r.position=this.position.clone(),r.Ne=this.Ne.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),e&&e(this,r);for(const I of this.getChildTransformNodes(!0))"InstancedMesh"===I.getClassName()&&"Mesh"===r.getClassName()&&I.sourceMesh===this?I.instantiateHierarchy(r,{doNotInstantiate:p&&p.doNotInstantiate||!1,newSourcedMesh:r},e):I.instantiateHierarchy(r,p,e);return r}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(w){let p=super.toString(w);if(p+=", n vertices: "+this.getTotalVertices(),p+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let e=0;e<this.animations.length;e++)p+=", animation[0]: "+this.animations[e].toString(w);if(w)if(this._geometry){const w=this.Ke(),e=this.getVerticesData(m.e.PositionKind);e&&w&&(p+=", flat shading: "+(e.length/3===w.length?"YES":"NO"))}else p+=", flat shading: UNKNOWN";return p}_unBindEffect(){super._unBindEffect();for(const w of this.instances)w._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const w=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((p,e)=>p.distanceOrScreenCoverage<e.distanceOrScreenCoverage?w:p.distanceOrScreenCoverage>e.distanceOrScreenCoverage?-w:0))}addLODLevel(w,p){if(p&&p._masterMesh)return z.c.Warn("You cannot use a mesh as LOD level twice"),this;const e=new n(w,p);return this._internalMeshDataInfo._LODLevels.push(e),p&&(p._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(w){const p=this._internalMeshDataInfo;for(let e=0;e<p._LODLevels.length;e++){const r=p._LODLevels[e];if(r.distanceOrScreenCoverage===w)return r.mesh}return null}removeLODLevel(w){const p=this._internalMeshDataInfo;for(let e=0;e<p._LODLevels.length;e++)p._LODLevels[e].mesh===w&&(p._LODLevels.splice(e,1),w&&(w._masterMesh=null));return this._sortLODLevels(),this}getLOD(w,p){const e=this._internalMeshDataInfo;if(!e._LODLevels||0===e._LODLevels.length)return this;const r=p||this.getBoundingInfo().boundingSphere,I=w.mode===E.d.ORTHOGRAPHIC_CAMERA?w.ge:r.centerWorld.Je(w.globalPosition).length();let d=I,f=1;if(e._useLODScreenCoverage){const p=w.screenArea;let e=r.radiusWorld*w.ge/I;e=e*e*Math.PI,d=e/p,f=-1}if(f*e._LODLevels[e._LODLevels.length-1].distanceOrScreenCoverage>f*d)return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this),this;for(let q=0;q<e._LODLevels.length;q++){const w=e._LODLevels[q];if(f*w.distanceOrScreenCoverage<f*d){if(w.mesh){if(4===w.mesh.delayLoadState)return w.mesh._checkDelayState(),this;if(2===w.mesh.delayLoadState)return this;w.mesh._preActivate(),w.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,w.mesh),w.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this),this}get me(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(w,p,e,r){var I,d;if(!this._geometry)return null;let f=r||null===(I=this._userInstancedBuffersStorage)||void 0===I||null===(d=I.vertexBuffers[w])||void 0===d?void 0:d.getFloatData(this.instances.length+1,e||p&&1!==this._geometry.meshes.length);return f||(f=this._geometry.getVerticesData(w,p,e)),f}copyVerticesData(w,p){this._geometry&&this._geometry.copyVerticesData(w,p)}getVertexBuffer(w,p){var e;return this._geometry?(p||null===(e=this._userInstancedBuffersStorage)||void 0===e?void 0:e.vertexBuffers[w])??this._geometry.getVertexBuffer(w):null}isVerticesDataPresent(w,p){var e;return this._geometry?!p&&void 0!==(null===(e=this._userInstancedBuffersStorage)||void 0===e?void 0:e.vertexBuffers[w])||this._geometry.isVerticesDataPresent(w):!!this._delayInfo&&-1!==this._delayInfo.indexOf(w)}isVertexBufferUpdatable(w,p){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(w);if(!p){var e;const p=null===(e=this._userInstancedBuffersStorage)||void 0===e?void 0:e.vertexBuffers[w];if(p)return p.isUpdatable()}return this._geometry.isVertexBufferUpdatable(w)}getVerticesDataKinds(w){if(!this._geometry){const w=[];if(this._delayInfo)for(const p of this._delayInfo)w.push(p);return w}const p=this._geometry.getVerticesDataKinds();if(!w&&this._userInstancedBuffersStorage)for(const e in this._userInstancedBuffersStorage.vertexBuffers)-1===p.indexOf(e)&&p.push(e);return p}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Ke(w,p){return this._geometry?this._geometry.Ke(w,p):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(w))return!1;if(!this.oe||0===this.oe.length)return!0;if(!w)return!0;const e=this.getEngine(),r=this.iw(),I=p||e.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.ke();const d=this.material||r.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(const m of this.oe){const w=m.Yw();if(w)if(w._storeEffectOnSubMeshes){if(!w.isReadyForSubMesh(this,m,I))return!1}else if(!w.isReady(this,I))return!1}else if(!d.isReady(this,I))return!1;const f=e.currentRenderPassId;for(const m of this.lightSources){const w=m.getShadowGenerators();if(!w)continue;const p=w.values();for(let r=p.next();!0!==r.done;r=p.next()){var q,E,j,X;const w=r.value;if(w&&(null===(q=w.getShadowMap())||void 0===q||!q.renderList||null!==(E=w.getShadowMap())&&void 0!==E&&E.renderList&&-1!==(null===(j=w.getShadowMap())||void 0===j||null===(X=j.renderList)||void 0===X?void 0:X.indexOf(this)))){const p=w.getShadowMap().renderPassIds??[e.currentRenderPassId];for(let r=0;r<p.length;++r){e.currentRenderPassId=p[r];for(const p of this.oe){var k;if(!w.isReady(p,I,(null===(k=p.Yw())||void 0===k?void 0:k.needAlphaBlendingForMesh(this))??!1))return e.currentRenderPassId=f,!1}}e.currentRenderPassId=f}}}for(const m of this._internalMeshDataInfo._LODLevels)if(m.mesh&&!m.mesh.isReady(I))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}GX(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(w){this._instanceDataStorage.overridenInstanceCount=w}_preActivate(){const w=this._internalMeshDataInfo,p=this.iw().getRenderId();return w._preActivateId===p||(w._preActivateId=p,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(w){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=w),this}_registerInstanceForRenderId(w,p){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:p,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[p]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=p,this._instanceDataStorage.visibleInstances[p]=new Array),this._instanceDataStorage.visibleInstances[p].push(w),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.bw||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let w,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;w="object"===typeof p?p:{applySkeleton:p,applyMorph:e};const r=this.me?this.me.boundingBias:null;return this.Pw(this._getData(w,null,m.e.PositionKind),r),this}_createGlobalSubMesh(w){const p=this.getTotalVertices();if(!p||!this.Ke())return null;if(this.oe&&this.oe.length>0){const e=this.Ke();if(!e)return null;const r=e.length;let I=!1;if(w)I=!0;else for(const w of this.oe){if(w.indexStart+w.indexCount>r){I=!0;break}if(w.verticesStart+w.verticesCount>p){I=!0;break}}if(!I)return this.oe[0]}return this.releaseSubMeshes(),new c.b(0,0,p,0,this.getTotalIndices()||p,this)}subdivide(w){if(w<1)return;const p=this.getTotalIndices();let e=p/w|0,r=0;for(;e%3!==0;)e++;this.releaseSubMeshes();for(let I=0;I<w&&!(r>=p);I++)c.b.CreateFromIndices(0,r,I===w-1?p-r:e,this,void 0,!1),r+=e;this.refreshBoundingInfo(),this.synchronizeInstances()}uw(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.uw(w,p,e,r);else{const r=new J.b;r.set(p,w);const I=this.iw();new K.d(K.d.RandomId(),I,r,e,this)}return this}removeVerticesData(w){this._geometry&&this._geometry.removeVerticesData(w)}markVerticesDataAsUpdatable(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this.getVertexBuffer(w);e&&e.isUpdatable()!==p&&this.uw(w,this.getVerticesData(w),p)}setVerticesBuffer(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=K.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(w,null,p),this}updateVerticesData(w,p,e,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(w,p,e,!1)):this._geometry.updateVerticesData(w,p,e),this):this}updateMeshPositions(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this.getVerticesData(m.e.PositionKind);if(!e)return this;if(w(e),this.updateVerticesData(m.e.PositionKind,e,!1,!1),p){const w=this.Ke(),p=this.getVerticesData(m.e.NormalKind);if(!p)return this;J.b.ComputeNormals(e,w,p),this.updateVerticesData(m.e.NormalKind,p,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const w=this._geometry,p=this._geometry.k(K.d.RandomId());return w.releaseForMesh(this,!0),p.Vw(this),this}setIndexBuffer(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=this._geometry;I||(I=new K.d(K.d.RandomId(),this.iw(),void 0,void 0,this)),I.setIndexBuffer(w,p,e,r)}setIndices(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(w,p,e,r);else{const p=new J.b;p.indices=w;const r=this.iw();new K.d(K.d.RandomId(),r,p,e,this)}return this}updateIndices(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(w,p,e),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(w,p,e){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const I=this.iw().getEngine();let d;if(this._unIndexed)if(this._getRenderingFillMode(e)===s.b.WireFrameFillMode)d=w._getLinesIndexBuffer(this.Ke(),I);else d=null;else switch(this._getRenderingFillMode(e)){case s.b.PointFillMode:d=null;break;case s.b.WireFrameFillMode:d=w._getLinesIndexBuffer(this.Ke(),I);break;default:case s.b.TriangleFillMode:d=this._geometry.getIndexBuffer()}return this._bindDirect(p,d,r)}_bindDirect(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(w),e&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(w,p,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(w,p),this):this}_draw(w,p,e){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const r=this.iw().getEngine();return this._unIndexed&&p!==s.b.WireFrameFillMode||p==s.b.PointFillMode?r.drawArraysType(p,w.verticesStart,w.verticesCount,this.forcedInstanceCount||e):p==s.b.WireFrameFillMode?r.drawElementsType(p,0,w._linesIndexCount,this.forcedInstanceCount||e):r.drawElementsType(p,w.indexStart,w.indexCount,this.forcedInstanceCount||e),this}registerBeforeRender(w){return this.onBeforeRenderObservable.add(w),this}unregisterBeforeRender(w){return this.onBeforeRenderObservable.removeCallback(w),this}registerAfterRender(w){return this.onAfterRenderObservable.add(w),this}unregisterAfterRender(w){return this.onAfterRenderObservable.removeCallback(w),this}_getInstancesRenderList(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(p)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[w]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[w]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const e=this.iw(),r=e._isInIntermediateRendering(),I=r?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,d=this._instanceDataStorage.batchCache;if(d.mustReturn=!1,d.renderSelf[w]=p||!I&&this.isEnabled()&&this.isVisible,d.visibleInstances[w]=null,this._instanceDataStorage.visibleInstances&&!p){const p=this._instanceDataStorage.visibleInstances,I=e.getRenderId(),f=r?p.intermediateDefaultRenderId:p.defaultRenderId;d.visibleInstances[w]=p[I],!d.visibleInstances[w]&&f&&(d.visibleInstances[w]=p[f])}return d.hardwareInstancedRendering[w]=!p&&this._instanceDataStorage.hardwareInstancedRendering&&null!==d.visibleInstances[w]&&void 0!==d.visibleInstances[w],this._instanceDataStorage.previousBatch=d,d}_updateInstancedBuffers(w,p,e,r,I,d){const f=p.visibleInstances[w._id],q=f?f.length:0,E=this._instanceDataStorage;let X=E.instancesBuffer,k=E.instancesPreviousBuffer,J=0,K=0;const y=p.renderSelf[w._id],c=!X||e!==E.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!E.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||E.isFrozen&&!c)K=(y?1:0)+q;else{const p=this.getWorldMatrix();if(y&&(this._scene.needsPreviousWorldMatrices&&(E.masterMeshPreviousWorldMatrix?(E.masterMeshPreviousWorldMatrix.copyToArray(E.instancesPreviousData,J),E.masterMeshPreviousWorldMatrix.X(p)):(E.masterMeshPreviousWorldMatrix=p.clone(),E.masterMeshPreviousWorldMatrix.copyToArray(E.instancesPreviousData,J))),p.copyToArray(E.instancesData,J),J+=16,K++),f){var s;if(b.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(s=w.Yw())&&void 0!==s&&s.needAlphaBlendingForMesh(w.getRenderingMesh())){const w=this._scene.activeCamera.globalPosition;for(let p=0;p<f.length;p++){const e=f[p];e._distanceToCamera=j.k.Distance(e.getBoundingInfo().boundingSphere.centerWorld,w)}f.sort(((w,p)=>w._distanceToCamera>p._distanceToCamera?-1:w._distanceToCamera<p._distanceToCamera?1:0))}for(let w=0;w<f.length;w++){const p=f[w],e=p.getWorldMatrix();e.copyToArray(E.instancesData,J),this._scene.needsPreviousWorldMatrices&&(p._previousWorldMatrix?(p._previousWorldMatrix.copyToArray(E.instancesPreviousData,J),p._previousWorldMatrix.X(e)):(p._previousWorldMatrix=e.clone(),p._previousWorldMatrix.copyToArray(E.instancesPreviousData,J))),J+=16,K++}}}c?(X&&X.dispose(),k&&k.dispose(),X=new m.b(r,E.instancesData,!0,16,!1,!0),E.instancesBuffer=X,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=X.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=X.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=X.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=X.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(k=new m.b(r,E.instancesPreviousData,!0,16,!1,!0),E.instancesPreviousBuffer=k,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=k.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=k.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=k.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=k.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(X.updateDirectly(E.instancesData,0,K),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||k.updateDirectly(E.instancesPreviousData,0,K)),this._processInstancedBuffers(f,y),d&&void 0!==I&&(this.iw()._activeIndices.addCount(w.indexCount*K,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(w,d,I),this._draw(w,I,K)),!this._scene.needsPreviousWorldMatrices||c||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||k.updateDirectly(E.instancesData,0,K)}_renderWithInstances(w,p,e,r,I){const d=e.visibleInstances[w._id],f=d?d.length:0,q=this._instanceDataStorage,E=q.instancesBufferSize,j=16*(f+1)*4;for(;q.instancesBufferSize<j;)q.instancesBufferSize*=2;return q.instancesData&&E==q.instancesBufferSize||(q.instancesData=new Float32Array(q.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!q.instancesPreviousData||E!=q.instancesBufferSize)&&(q.instancesPreviousData=new Float32Array(q.instancesBufferSize/4)),this._updateInstancedBuffers(w,e,E,I,p,r),I.unbindInstanceAttributes(),this}_renderWithThinInstances(w,p,e,r){var I;const d=(null===(I=this._thinInstanceDataStorage)||void 0===I?void 0:I.instancesCount)??0;this.iw()._activeIndices.addCount(w.indexCount*d,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(w,e,p),this._draw(w,p,d),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,d):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),r.unbindInstanceAttributes()}_processInstancedBuffers(w,p){}_processRendering(w,p,e,r,I,d,f,q){const E=this.iw(),j=E.getEngine();if(r=this._getRenderingFillMode(r),d&&p.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(p,r,e,j),this;if(d)this._renderWithInstances(p,r,I,e,j);else{j._currentDrawContext&&(j._currentDrawContext.useInstancing=!1);let e=0;I.renderSelf[p._id]&&(f&&f(!1,w.getWorldMatrix(),q),e++,this._draw(p,r,this._instanceDataStorage.overridenInstanceCount));const d=I.visibleInstances[p._id];if(d){const w=d.length;e+=w;for(let e=0;e<w;e++){const w=d[e].getWorldMatrix();f&&f(!0,w,q),this._draw(p,r)}}E._activeIndices.addCount(p.indexCount*e,!1)}return this}_rebuild(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(w&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const p in this._userInstancedBuffersStorage.vertexBuffers){const e=this._userInstancedBuffersStorage.vertexBuffers[p];e&&(w&&e.dispose(),this._userInstancedBuffersStorage.vertexBuffers[p]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(w)}_freeze(){if(this.oe){for(let w=0;w<this.oe.length;w++)this._getInstancesRenderList(w);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(w,p,e,r){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=this._scene.getEngine(),f=d.currentRenderPassId;if(void 0!==w&&(d.currentRenderPassId=w),r)(!I||I&&r.isInFrustum(this._scene._frustumPlanes))&&this.render(r,!!p,e);else for(let q=0;q<this.oe.length;q++){const w=this.oe[q];(!I||I&&w.isInFrustum(this._scene._frustumPlanes))&&this.render(w,!!p,e)}return void 0!==w&&(d.currentRenderPassId=f),this}directRender(){if(!this.oe)return this;for(const w of this.oe)this.render(w,!1);return this}render(w,p,e){var r,I,d;const f=this.iw();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const q=(null===(r=f.activeCameras)||void 0===r?void 0:r.length)??0;if((q>1&&f.activeCamera===f.activeCameras[0]||q<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const E=this._getInstancesRenderList(w._id,!!e);if(E.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const j=f.getEngine();let X=0,k=null;this.ignoreCameraMaxZ&&f.activeCamera&&!f._isInIntermediateRendering()&&(X=f.activeCamera.maxZ,k=f.activeCamera,f.activeCamera.maxZ=0,f.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const m=w.getRenderingMesh(),J=E.hardwareInstancedRendering[w._id]||m.hasThinInstances||!!this._userInstancedBuffersStorage&&!w.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,K=this._instanceDataStorage,y=w.Yw();if(!y)return k&&(k.maxZ=X,f.updateTransformMatrix(!0)),this;if(K.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===y){if(y._storeEffectOnSubMeshes&&(null===(I=w._drawWrapper)||void 0===I||!I._wasPreviouslyReady)||!y._storeEffectOnSubMeshes&&!y._getDrawWrapper()._wasPreviouslyReady)return k&&(k.maxZ=X,f.updateTransformMatrix(!0)),this}else{if(y._storeEffectOnSubMeshes){if(!y.isReadyForSubMesh(this,w,J))return k&&(k.maxZ=X,f.updateTransformMatrix(!0)),this}else if(!y.isReady(this,J))return k&&(k.maxZ=X,f.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=y}let c;p&&j.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),c=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?w._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const O=(null===(d=c)||void 0===d?void 0:d.effect)??null;for(const s of f._beforeRenderingMeshStage)s.action(this,w,E,O);if(!c||!O)return k&&(k.maxZ=X,f.updateTransformMatrix(!0)),this;const a=e||this;let A;if(K.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.ce&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)A=K.sideOrientation;else{const w=a._getWorldMatrixDeterminant();A=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),w<0&&(A=A===s.b.ClockWiseSideOrientation?s.b.CounterClockWiseSideOrientation:s.b.ClockWiseSideOrientation),K.sideOrientation=A}const z=this._internalMeshDataInfo._effectiveMaterial._preBind(c,A);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&j.setDepthWrite(!0);const M=this._internalMeshDataInfo._effectiveMaterial,i=M.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),J||this._bind(w,O,i,!1);const t=a.getWorldMatrix();M._storeEffectOnSubMeshes?M.bindForSubMesh(t,this,w):M.bind(t,this),!M.ce&&M.separateCullingPass&&(j.setState(!0,M.zOffset,!1,!z,M.cullBackFaces,M.stencil,M.zOffsetUnits),this._processRendering(this,w,O,i,E,J,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),j.setState(!0,M.zOffset,!1,z,M.cullBackFaces,M.stencil,M.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(w)),this._processRendering(this,w,O,i,E,J,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const s of f._afterRenderingMeshStage)s.action(this,w,E,O);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),k&&(k.maxZ=X,f.updateTransformMatrix(!0)),2!==f.performancePriority||K.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(m.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(m.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const w=this.getVerticesData(m.e.MatricesWeightsKind),p=w.length;for(let e=0;e<p;e+=4){const p=w[e]+w[e+1]+w[e+2]+w[e+3];if(0===p)w[e]=1;else{const r=1/p;w[e]*=r,w[e+1]*=r,w[e+2]*=r,w[e+3]*=r}}this.uw(m.e.MatricesWeightsKind,w)}_normalizeSkinWeightsAndExtra(){const w=this.getVerticesData(m.e.MatricesWeightsExtraKind),p=this.getVerticesData(m.e.MatricesWeightsKind),e=p.length;for(let r=0;r<e;r+=4){let e=p[r]+p[r+1]+p[r+2]+p[r+3];if(e+=w[r]+w[r+1]+w[r+2]+w[r+3],0===e)p[r]=1;else{const I=1/e;p[r]*=I,p[r+1]*=I,p[r+2]*=I,p[r+3]*=I,w[r]*=I,w[r+1]*=I,w[r+2]*=I,w[r+3]*=I}}this.uw(m.e.MatricesWeightsKind,p),this.uw(m.e.MatricesWeightsKind,w)}validateSkinning(){const w=this.getVerticesData(m.e.MatricesWeightsExtraKind),p=this.getVerticesData(m.e.MatricesWeightsKind);if(null===p||null==this.skeleton)return{skinned:!1,valid:!0,iy:"not skinned"};const e=p.length;let r=0,I=0,d=0,f=0;const q=null===w?4:8,E=[];for(let m=0;m<=q;m++)E[m]=0;for(let m=0;m<e;m+=4){let e=p[m],j=e,X=0===j?0:1;for(let I=1;I<q;I++){const d=I<4?p[m+I]:w[m+I-4];d>e&&r++,0!==d&&X++,j+=d,e=d}if(E[X]++,X>d&&(d=X),0===j)I++;else{const e=1/j;let r=0;for(let I=0;I<q;I++)r+=I<4?Math.abs(p[m+I]-p[m+I]*e):Math.abs(w[m+I-4]-w[m+I-4]*e);r>.001&&f++}}const j=this.skeleton.bones.length,X=this.getVerticesData(m.e.MatricesIndicesKind),k=this.getVerticesData(m.e.MatricesIndicesExtraKind);let J=0;for(let m=0;m<e;m+=4)for(let w=0;w<q;w++){const p=w<4?X[m+w]:k[m+w-4];(p>=j||p<0)&&J++}return{skinned:!0,valid:0===I&&0===f&&0===J,iy:"Number of Weights = "+e/4+"\nMaximum influences = "+d+"\nMissing Weights = "+I+"\nNot Sorted = "+r+"\nNot Normalized = "+f+"\nWeightCounts = ["+E+"]\nNumber of bones = "+j+"\nBad Bone Indices = "+J}}_checkDelayState(){const w=this.iw();return this._geometry?this._geometry.load(w):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(w)),this}_queueLoad(w){w.addPendingData(this);const p=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return I.g.LoadFile(this.delayLoadingFile,(p=>{p instanceof ArrayBuffer?this._delayLoadingFunction(p,this):this._delayLoadingFunction(JSON.parse(p),this);for(const w of this.instances)w.refreshBoundingInfo(),w._syncSubMeshes();this.delayLoadState=1,w.removePendingData(this)}),(()=>{}),w.offlineProvider,p),this}isInFrustum(w){return 2!==this.delayLoadState&&(!!super.isInFrustum(w)&&(this._checkDelayState(),!0))}setMaterialById(w){const p=this.iw().materials;let e;for(e=p.length-1;e>-1;e--)if(p[e].id===w)return this.material=p[e],this;const r=this.iw().multiMaterials;for(e=r.length-1;e>-1;e--)if(r[e].id===w)return this.material=r[e],this;return this}getAnimatables(){const w=[];return this.material&&w.push(this.material),this.skeleton&&w.push(this.skeleton),w}bakeTransformIntoVertices(w){if(!this.isVerticesDataPresent(m.e.PositionKind))return this;const p=this.oe.splice(0);this._resetPointsArrayCache();let e=this.getVerticesData(m.e.PositionKind);const r=j.k.Zero();let I;for(I=0;I<e.length;I+=3)j.k.TransformCoordinatesFromFloatsToRef(e[I],e[I+1],e[I+2],w,r).toArray(e,I);if(this.uw(m.e.PositionKind,e,this.getVertexBuffer(m.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(m.e.NormalKind)){for(e=this.getVerticesData(m.e.NormalKind),I=0;I<e.length;I+=3)j.k.TransformNormalFromFloatsToRef(e[I],e[I+1],e[I+2],w,r).normalize().toArray(e,I);this.uw(m.e.NormalKind,e,this.getVertexBuffer(m.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(m.e.TangentKind)){for(e=this.getVerticesData(m.e.TangentKind),I=0;I<e.length;I+=4)j.k.TransformNormalFromFloatsToRef(e[I],e[I+1],e[I+2],w,r).normalize().toArray(e,I);this.uw(m.e.TangentKind,e,this.getVertexBuffer(m.e.TangentKind).isUpdatable())}return w.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.oe=p,this}bakeCurrentTransformIntoVertices(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.ke(!0)),this.resetLocalMatrix(w),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(p&&void 0===p._addToSceneRootNodes){const e=p;return V.source=this,V.doNotCloneChildren=e.doNotCloneChildren,V.clonePhysicsImpostor=e.clonePhysicsImpostor,V.cloneThinInstances=e.cloneThinInstances,new b(w,this.iw(),V)}return new b(w,this.iw(),p,this,e,r)}dispose(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const e=this._internalMeshDataInfo;if(e._onBeforeDrawObservable&&e._onBeforeDrawObservable.clear(),e._onBeforeBindObservable&&e._onBeforeBindObservable.clear(),e._onBeforeRenderObservable&&e._onBeforeRenderObservable.clear(),e._onAfterRenderObservable&&e._onAfterRenderObservable.clear(),e._onBetweenPassObservable&&e._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(e.meshMap)for(const w in e.meshMap){const p=e.meshMap[w];p&&(p._internalMeshDataInfo._source=null,e.meshMap[w]=void 0)}e._source&&e._source._internalMeshDataInfo.meshMap&&(e._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const w=this.iw().meshes;for(const p of w){const w=p;w._internalMeshDataInfo&&w._internalMeshDataInfo._source&&w._internalMeshDataInfo._source===this&&(w._internalMeshDataInfo._source=null)}}e._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(w,p)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(w,p,e,r,d,f){let q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;const j=this.iw();return I.g.LoadImage(w,(w=>{const I=w.width,E=w.height,j=this.getEngine().createCanvas(I,E).getContext("2d");j.drawImage(w,0,0);const X=j.getImageData(0,0,I,E).data;this.applyDisplacementMapFromBuffer(X,I,E,p,e,d,f,q),r&&r(this)}),E||(()=>{}),j.offlineProvider),this}applyDisplacementMapFromBuffer(w,p,e,r,I,d,f){let q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(m.e.PositionKind)||!this.isVerticesDataPresent(m.e.NormalKind)||!this.isVerticesDataPresent(m.e.UVKind))return z.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const E=this.getVerticesData(m.e.PositionKind,!0,!0),X=this.getVerticesData(m.e.NormalKind),k=this.getVerticesData(m.e.UVKind);let K=j.k.Zero();const y=j.k.Zero(),c=j.g.Zero();d=d||j.g.Zero(),f=f||new j.g(1,1);for(let m=0;m<E.length;m+=3){j.k.FromArrayToRef(E,m,K),j.k.FromArrayToRef(X,m,y),j.g.FromArrayToRef(k,m/3*2,c);const q=4*((Math.abs(c.x*f.x+d.x%1)*(p-1)%p|0)+(Math.abs(c.y*f.y+d.y%1)*(e-1)%e|0)*p),J=.3*(w[q]/255)+.59*(w[q+1]/255)+.11*(w[q+2]/255);y.normalize(),y.scaleInPlace(r+(I-r)*J),K=K.add(y),K.toArray(E,m)}return J.b.ComputeNormals(E,this.Ke(),X),q?(this.uw(m.e.PositionKind,E),this.uw(m.e.NormalKind,X),this.uw(m.e.UVKind,k)):(this.updateVerticesData(m.e.PositionKind,E),this.updateVerticesData(m.e.NormalKind,X)),this}_getFlattenedNormals(w,p){const e=new Float32Array(3*w.length);let r=0;const I=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let d=0;d<w.length;d+=3){const f=j.k.Ve(p,3*w[d]),q=j.k.Ve(p,3*w[d+1]),E=j.k.Ve(p,3*w[d+2]),X=f.Je(q),k=E.Je(q),m=j.k.Normalize(j.k.Cross(X,k));I&&m.scaleInPlace(-1);for(let w=0;w<3;w++)e[r++]=m.x,e[r++]=m.y,e[r++]=m.z}return e}_convertToUnIndexedMesh(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this.getVerticesDataKinds().filter((w=>{var p;return!(null!==(p=this.getVertexBuffer(w))&&void 0!==p&&p.getIsInstanced())})),e=this.Ke(),r={},I=(w,p)=>{const r=new Float32Array(e.length*p);let I=0;for(let d=0;d<e.length;d++)for(let f=0;f<p;f++)r[I++]=w[e[d]*p+f];return r},d=this.getBoundingInfo(),f=this.me?this.oe.slice(0):[];for(const q of p)r[q]=this.getVerticesData(q);for(const q of p){const p=this.getVertexBuffer(q),d=p.getSize();if(w&&q===m.e.NormalKind){const w=this._getFlattenedNormals(e,r[m.e.PositionKind]);this.uw(m.e.NormalKind,w,p.isUpdatable(),d)}else this.uw(q,I(r[q],d),p.isUpdatable(),d)}if(this.morphTargetManager){for(let p=0;p<this.morphTargetManager.numTargets;p++){const r=this.morphTargetManager.getTarget(p),d=r.getPositions();r.setPositions(I(d,3));const f=r.getNormals();f&&r.setNormals(w?this._getFlattenedNormals(e,d):I(f,3));const q=r.getTangents();q&&r.setTangents(I(q,3));const E=r.getUVs();E&&r.setUVs(I(E,2));const j=r.getColors();j&&r.setColors(I(j,4))}this.morphTargetManager.synchronize()}for(let q=0;q<e.length;q++)e[q]=q;this.setIndices(e),this._unIndexed=!0,this.releaseSubMeshes();for(const q of f){const w=q.getBoundingInfo();c.b.AddToMesh(q.materialIndex,q.indexStart,q.indexCount,q.indexStart,q.indexCount,this).setBoundingInfo(w)}return this.setBoundingInfo(d),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=J.b.ExtractFromMesh(this);let e;if(w&&this.isVerticesDataPresent(m.e.NormalKind)&&p.lw){for(e=0;e<p.lw.length;e++)p.lw[e]*=-1;this.uw(m.e.NormalKind,p.lw,this.isVertexBufferUpdatable(m.e.NormalKind))}if(p.indices){let w;for(e=0;e<p.indices.length;e+=3)w=p.indices[e+1],p.indices[e+1]=p.indices[e+2],p.indices[e+2]=w;this.setIndices(p.indices,null,this.isVertexBufferUpdatable(m.e.PositionKind),!0)}return this}increaseVertices(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const p=J.b.ExtractFromMesh(this),e=p.indices&&!Array.isArray(p.indices)&&Array.from?Array.from(p.indices):p.indices,r=p.nw&&!Array.isArray(p.nw)&&Array.from?Array.from(p.nw):p.nw,I=p.Uw&&!Array.isArray(p.Uw)&&Array.from?Array.from(p.Uw):p.Uw,d=p.lw&&!Array.isArray(p.lw)&&Array.from?Array.from(p.lw):p.lw;if(e&&r){p.indices=e,p.nw=r,I&&(p.Uw=I),d&&(p.lw=d);const f=w+1,q=[];for(let w=0;w<f+1;w++)q[w]=[];let E,X;const k=new j.k(0,0,0),J=new j.k(0,0,0),K=new j.g(0,0),y=[],c=[],s=[];let O,a,A,z=r.length;I&&(a=I.length),d&&(A=d.length);for(let w=0;w<e.length;w+=3){c[0]=e[w],c[1]=e[w+1],c[2]=e[w+2];for(let w=0;w<3;w++)if(E=c[w],X=c[(w+1)%3],void 0===s[E]&&void 0===s[X]?(s[E]=[],s[X]=[]):(void 0===s[E]&&(s[E]=[]),void 0===s[X]&&(s[X]=[])),void 0===s[E][X]&&void 0===s[X][E]){s[E][X]=[],k.x=(r[3*X]-r[3*E])/f,k.y=(r[3*X+1]-r[3*E+1])/f,k.z=(r[3*X+2]-r[3*E+2])/f,d&&(J.x=(d[3*X]-d[3*E])/f,J.y=(d[3*X+1]-d[3*E+1])/f,J.z=(d[3*X+2]-d[3*E+2])/f),I&&(K.x=(I[2*X]-I[2*E])/f,K.y=(I[2*X+1]-I[2*E+1])/f),s[E][X].push(E);for(let w=1;w<f;w++)s[E][X].push(r.length/3),r[z++]=r[3*E]+w*k.x,r[z++]=r[3*E+1]+w*k.y,r[z++]=r[3*E+2]+w*k.z,d&&(d[A++]=d[3*E]+w*J.x,d[A++]=d[3*E+1]+w*J.y,d[A++]=d[3*E+2]+w*J.z),I&&(I[a++]=I[2*E]+w*K.x,I[a++]=I[2*E+1]+w*K.y);s[E][X].push(X),s[X][E]=[],O=s[E][X].length;for(let w=0;w<O;w++)s[X][E][w]=s[E][X][O-1-w]}q[0][0]=e[w],q[1][0]=s[e[w]][e[w+1]][1],q[1][1]=s[e[w]][e[w+2]][1];for(let p=2;p<f;p++){q[p][0]=s[e[w]][e[w+1]][p],q[p][p]=s[e[w]][e[w+2]][p],k.x=(r[3*q[p][p]]-r[3*q[p][0]])/p,k.y=(r[3*q[p][p]+1]-r[3*q[p][0]+1])/p,k.z=(r[3*q[p][p]+2]-r[3*q[p][0]+2])/p,d&&(J.x=(d[3*q[p][p]]-d[3*q[p][0]])/p,J.y=(d[3*q[p][p]+1]-d[3*q[p][0]+1])/p,J.z=(d[3*q[p][p]+2]-d[3*q[p][0]+2])/p),I&&(K.x=(I[2*q[p][p]]-I[2*q[p][0]])/p,K.y=(I[2*q[p][p]+1]-I[2*q[p][0]+1])/p);for(let w=1;w<p;w++)q[p][w]=r.length/3,r[z++]=r[3*q[p][0]]+w*k.x,r[z++]=r[3*q[p][0]+1]+w*k.y,r[z++]=r[3*q[p][0]+2]+w*k.z,d&&(d[A++]=d[3*q[p][0]]+w*J.x,d[A++]=d[3*q[p][0]+1]+w*J.y,d[A++]=d[3*q[p][0]+2]+w*J.z),I&&(I[a++]=I[2*q[p][0]]+w*K.x,I[a++]=I[2*q[p][0]+1]+w*K.y)}q[f]=s[e[w+1]][e[w+2]],y.push(q[0][0],q[1][0],q[1][1]);for(let w=1;w<f;w++){let p;for(p=0;p<w;p++)y.push(q[w][p],q[w+1][p],q[w+1][p+1]),y.push(q[w][p],q[w+1][p+1],q[w][p+1]);y.push(q[w][p],q[w+1][p],q[w+1][p+1])}}p.indices=y,p.Vw(this,this.isVertexBufferUpdatable(m.e.PositionKind))}else z.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const w=J.b.ExtractFromMesh(this),p=w.Uw,e=w.indices,r=w.nw,I=w.Nw,d=w.matricesIndices,f=w.matricesWeights,q=w.matricesIndicesExtra,E=w.matricesWeightsExtra;if(void 0===e||void 0===r||null===e||null===r)z.c.Warn("VertexData contains empty entries");else{const j=[],X=[],k=[],K=[],y=[],c=[],s=[],O=[];let a=[],A=0;const z={};let M,i;for(let w=0;w<e.length;w+=3){i=[e[w],e[w+1],e[w+2]],a=[];for(let w=0;w<3;w++){a[w]="";for(let p=0;p<3;p++)Math.abs(r[3*i[w]+p])<1e-8&&(r[3*i[w]+p]=0),a[w]+=r[3*i[w]+p]+"|"}if(a[0]!=a[1]&&a[0]!=a[2]&&a[1]!=a[2])for(let w=0;w<3;w++){if(M=z[a[w]],void 0===M){z[a[w]]=A,M=A++;for(let p=0;p<3;p++)j.push(r[3*i[w]+p]);if(null!==I&&void 0!==I)for(let p=0;p<4;p++)K.push(I[4*i[w]+p]);if(null!==p&&void 0!==p)for(let e=0;e<2;e++)k.push(p[2*i[w]+e]);if(null!==d&&void 0!==d)for(let p=0;p<4;p++)y.push(d[4*i[w]+p]);if(null!==f&&void 0!==f)for(let p=0;p<4;p++)c.push(f[4*i[w]+p]);if(null!==q&&void 0!==q)for(let p=0;p<4;p++)s.push(q[4*i[w]+p]);if(null!==E&&void 0!==E)for(let p=0;p<4;p++)O.push(E[4*i[w]+p])}X.push(M)}}const t=[];J.b.ComputeNormals(j,X,t),w.nw=j,w.indices=X,w.lw=t,null!==p&&void 0!==p&&(w.Uw=k),null!==I&&void 0!==I&&(w.Nw=K),null!==d&&void 0!==d&&(w.matricesIndices=y),null!==f&&void 0!==f&&(w.matricesWeights=c),null!==q&&void 0!==q&&(w.matricesIndicesExtra=s),null!==f&&void 0!==f&&(w.matricesWeightsExtra=O),w.Vw(this,this.isVertexBufferUpdatable(m.e.PositionKind))}}static _instancedMeshFactory(w,p){throw(0,i.c)("InstancedMesh")}static _PhysicsImpostorParser(w,p,e){throw(0,i.c)("PhysicsImpostor")}createInstance(w){const p=b._instancedMeshFactory(w,this);return p.parent=this.parent,p}synchronizeInstances(){for(let w=0;w<this.instances.length;w++){this.instances[w]._syncSubMeshes()}return this}optimizeIndices(w){const p=this.Ke(),e=this.getVerticesData(m.e.PositionKind);if(!e||!p)return this;const r=[];for(let I=0;I<e.length;I+=3)r.push(j.k.Ve(e,I));const d=[];return I.d.SyncAsyncForLoop(r.length,40,(w=>{const p=r.length-1-w,e=r[p];for(let I=0;I<p;++I){const w=r[I];if(e.equals(w)){d[p]=I;break}}}),(()=>{for(let w=0;w<p.length;++w)p[w]=d[p[w]]||p[w];const e=this.oe.slice(0);this.setIndices(p),this.oe=e,w&&w(this)})),this}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.name=this.name,w.id=this.id,w.uniqueId=this.uniqueId,w.type=this.getClassName(),f.b&&f.b.HasTags(this)&&(w.tags=f.b.GetTags(this)),w.position=this.position.ze(),this.rotationQuaternion?w.rotationQuaternion=this.rotationQuaternion.ze():this.rotation&&(w.rotation=this.rotation.ze()),w.Ne=this.Ne.ze(),this._postMultiplyPivotMatrix?w.pivotMatrix=this.getPivotMatrix().ze():w.localMatrix=this.getPivotMatrix().ze(),w.isEnabled=this.isEnabled(!1),w.isVisible=this.isVisible,w.infiniteDistance=this.infiniteDistance,w.pickable=this.kj,w.receiveShadows=this.receiveShadows,w.billboardMode=this.billboardMode,w.visibility=this.visibility,w.kE=this.kE,w.checkCollisions=this.checkCollisions,w.ellipsoid=this.ellipsoid.ze(),w.ellipsoidOffset=this.ellipsoidOffset.ze(),w.bw=this.bw,w.isBlocker=this.isBlocker,w.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(w),w.isUnIndexed=this.isUnIndexed;const p=this._geometry;if(p&&this.oe){w.geometryUniqueId=p.uniqueId,w.geometryId=p.id,w.oe=[];for(let p=0;p<this.oe.length;p++){const e=this.oe[p];w.oe.push({materialIndex:e.materialIndex,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount})}}if(this.material?this.material.doNotSerialize||(w.materialUniqueId=this.material.uniqueId,w.materialId=this.material.id):(this.material=null,w.materialUniqueId=this._scene.defaultMaterial.uniqueId,w.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(w.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(w.skeletonId=this.skeleton.id,w.numBoneInfluencers=this.numBoneInfluencers),this.iw()._getComponent(t.d.NAME_PHYSICSENGINE)){const p=this.getPhysicsImpostor();p&&(w.physicsMass=p.getParam("XI"),w.physicsFriction=p.getParam("friction"),w.physicsRestitution=p.getParam("XI"),w.physicsImpostor=p.type)}this.metadata&&(w.metadata=this.metadata),w.instances=[];for(let e=0;e<this.instances.length;e++){const p=this.instances[e];if(p.doNotSerialize)continue;const r={name:p.name,id:p.id,isEnabled:p.isEnabled(!1),isVisible:p.isVisible,kj:p.kj,checkCollisions:p.checkCollisions,position:p.position.ze(),Ne:p.Ne.ze()};if(p.parent&&p.parent._serializeAsParent(r),p.rotationQuaternion?r.rotationQuaternion=p.rotationQuaternion.ze():p.rotation&&(r.rotation=p.rotation.ze()),this.iw()._getComponent(t.d.NAME_PHYSICSENGINE)){const w=p.getPhysicsImpostor();w&&(r.physicsMass=w.getParam("XI"),r.physicsFriction=w.getParam("friction"),r.physicsRestitution=w.getParam("XI"),r.physicsImpostor=w.type)}p.metadata&&(r.metadata=p.metadata),p.actionManager&&(r.actions=p.actionManager.serialize(p.name)),w.instances.push(r),A.e.AppendSerializedAnimations(p,r),r.ranges=p.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(w.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const p={data:{},sizes:{},strides:{}};for(const w in this._userThinInstanceBuffersStorage.data)p.data[w]=Array.from(this._userThinInstanceBuffersStorage.data[w]),p.sizes[w]=this._userThinInstanceBuffersStorage.sizes[w],p.strides[w]=this._userThinInstanceBuffersStorage.strides[w];w.thinInstances.userThinInstance=p}return A.e.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w.layerMask=this.layerMask,w.alphaIndex=this.alphaIndex,w.hasVertexAlpha=this.hasVertexAlpha,w.overlayAlpha=this.overlayAlpha,w.overlayColor=this.overlayColor.ze(),w.renderOverlay=this.renderOverlay,w.applyFog=this.applyFog,this.actionManager&&(w.actions=this.actionManager.serialize(this.name)),w}_syncGeometryWithMorphTargetManager(){if(!this.me)return;this._markSubMeshesAsAttributesDirty();const w=this._internalAbstractMeshDataInfo._morphTargetManager;if(w&&w.vertexCount){if(w.vertexCount!==this.getTotalVertices())return z.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(w.isUsingTextureForTargets)return;for(let p=0;p<w.numInfluencers;p++){const e=w.getActiveTarget(p),r=e.getPositions();if(!r)return void z.c.Error("Invalid morph target. Target must have positions.");this.me.uw(m.e.PositionKind+p,r,!1,3);const I=e.getNormals();I&&this.me.uw(m.e.NormalKind+p,I,!1,3);const d=e.getTangents();d&&this.me.uw(m.e.TangentKind+p,d,!1,3);const f=e.getUVs();f&&this.me.uw(m.e.UVKind+"_"+p,f,!1,2);const q=e.getUV2s();q&&this.me.uw(m.e.UV2Kind+"_"+p,q,!1,2);const E=e.getColors();E&&this.me.uw(m.e.ColorKind+p,E,!1,4)}}else{let w=0;for(;this.me.isVerticesDataPresent(m.e.PositionKind+w);)this.me.removeVerticesData(m.e.PositionKind+w),this.me.isVerticesDataPresent(m.e.NormalKind+w)&&this.me.removeVerticesData(m.e.NormalKind+w),this.me.isVerticesDataPresent(m.e.TangentKind+w)&&this.me.removeVerticesData(m.e.TangentKind+w),this.me.isVerticesDataPresent(m.e.UVKind+w)&&this.me.removeVerticesData(m.e.UVKind+"_"+w),this.me.isVerticesDataPresent(m.e.UV2Kind+w)&&this.me.removeVerticesData(m.e.UV2Kind+"_"+w),this.me.isVerticesDataPresent(m.e.ColorKind+w)&&this.me.removeVerticesData(m.e.ColorKind+w),w++}}static Parse(w,p,e){let r;if(r=w.type&&"LinesMesh"===w.type?b._LinesMeshParser(w,p):w.type&&"GroundMesh"===w.type?b._GroundMeshParser(w,p):w.type&&"GoldbergMesh"===w.type?b._GoldbergMeshParser(w,p):w.type&&"GreasedLineMesh"===w.type?b._GreasedLineMeshParser(w,p):w.type&&"TrailMesh"===w.type?b._TrailMeshParser(w,p):new b(w.name,p),r.id=w.id,r._waitingParsedUniqueId=w.uniqueId,f.b&&f.b.AddTagsTo(r,w.tags),r.position=j.k.Ve(w.position),void 0!==w.metadata&&(r.metadata=w.metadata),w.rotationQuaternion?r.rotationQuaternion=j.c.Ve(w.rotationQuaternion):w.rotation&&(r.rotation=j.k.Ve(w.rotation)),r.Ne=j.k.Ve(w.Ne),w.localMatrix?r.setPreTransformMatrix(j.b.Ve(w.localMatrix)):w.pivotMatrix&&r.setPivotMatrix(j.b.Ve(w.pivotMatrix)),r.yE(w.isEnabled),r.isVisible=w.isVisible,r.infiniteDistance=w.infiniteDistance,r.kE=!!w.kE,r.showBoundingBox=w.showBoundingBox,r.showSubMeshesBoundingBox=w.showSubMeshesBoundingBox,void 0!==w.applyFog&&(r.applyFog=w.applyFog),void 0!==w.pickable&&(r.kj=w.pickable),void 0!==w.alphaIndex&&(r.alphaIndex=w.alphaIndex),r.receiveShadows=w.receiveShadows,void 0!==w.billboardMode&&(r.billboardMode=w.billboardMode),void 0!==w.visibility&&(r.visibility=w.visibility),r.checkCollisions=w.checkCollisions,r.bw=!!w.bw,w.ellipsoid&&(r.ellipsoid=j.k.Ve(w.ellipsoid)),w.ellipsoidOffset&&(r.ellipsoidOffset=j.k.Ve(w.ellipsoidOffset)),null!=w.overrideMaterialSideOrientation&&(r.sideOrientation=w.overrideMaterialSideOrientation),void 0!==w.sideOrientation&&(r.sideOrientation=w.sideOrientation),void 0!==w.isBlocker&&(r.isBlocker=w.isBlocker),r._shouldGenerateFlatShading=w.useFlatShading,w.XE&&(r._waitingData.XE=w.XE),void 0!==w.parentId&&(r._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(r._waitingParentInstanceIndex=w.parentInstanceIndex),void 0!==w.actions&&(r._waitingData.actions=w.actions),void 0!==w.overlayAlpha&&(r.overlayAlpha=w.overlayAlpha),void 0!==w.overlayColor&&(r.overlayColor=X.b.Ve(w.overlayColor)),void 0!==w.renderOverlay&&(r.renderOverlay=w.renderOverlay),r.isUnIndexed=!!w.isUnIndexed,r.hasVertexAlpha=w.hasVertexAlpha,w.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=e+w.delayLoadingFile,r.buildBoundingInfo(j.k.Ve(w.boundingBoxMinimum),j.k.Ve(w.boundingBoxMaximum)),w._binaryInfo&&(r._binaryInfo=w._binaryInfo),r._delayInfo=[],w.hasUVs&&r._delayInfo.push(m.e.UVKind),w.hasUVs2&&r._delayInfo.push(m.e.UV2Kind),w.hasUVs3&&r._delayInfo.push(m.e.UV3Kind),w.hasUVs4&&r._delayInfo.push(m.e.UV4Kind),w.hasUVs5&&r._delayInfo.push(m.e.UV5Kind),w.hasUVs6&&r._delayInfo.push(m.e.UV6Kind),w.hasColors&&r._delayInfo.push(m.e.ColorKind),w.hasMatricesIndices&&r._delayInfo.push(m.e.MatricesIndicesKind),w.hasMatricesWeights&&r._delayInfo.push(m.e.MatricesWeightsKind),r._delayLoadingFunction=K.d._ImportGeometry,a.d.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):K.d._ImportGeometry(w,r),w.materialUniqueId?r._waitingMaterialId=w.materialUniqueId:w.materialId&&(r._waitingMaterialId=w.materialId),w.morphTargetManagerId>-1&&(r._waitingMorphTargetManagerId=w.morphTargetManagerId),void 0!==w.skeletonId&&null!==w.skeletonId&&(r.skeleton=p.getLastSkeletonById(w.skeletonId),w.numBoneInfluencers&&(r.numBoneInfluencers=w.numBoneInfluencers)),w.animations){for(let p=0;p<w.animations.length;p++){const e=w.animations[p],I=(0,M.c)("BABYLON.Animation");I&&r.animations.push(I.Parse(e))}k.b.ParseAnimationRanges(r,w,p)}if(w.autoAnimate&&p.beginAnimation(r,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),w.layerMask&&!isNaN(w.layerMask)?r.layerMask=Math.abs(parseInt(w.layerMask)):r.layerMask=268435455,w.physicsImpostor&&(r.physicsImpostor=b._PhysicsImpostorParser(p,r,w)),w.lodMeshIds&&(r._waitingData.lods={ids:w.lodMeshIds,distances:w.lodDistances?w.lodDistances:null,coverages:w.lodCoverages?w.lodCoverages:null}),w.instances)for(let I=0;I<w.instances.length;I++){const e=w.instances[I],d=r.createInstance(e.name);if(e.id&&(d.id=e.id),f.b&&(e.tags?f.b.AddTagsTo(d,e.tags):f.b.AddTagsTo(d,w.tags)),d.position=j.k.Ve(e.position),void 0!==e.metadata&&(d.metadata=e.metadata),void 0!==e.parentId&&(d._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(d._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.isEnabled&&null!==e.isEnabled&&d.yE(e.isEnabled),void 0!==e.isVisible&&null!==e.isVisible&&(d.isVisible=e.isVisible),void 0!==e.kj&&null!==e.kj&&(d.kj=e.kj),e.rotationQuaternion?d.rotationQuaternion=j.c.Ve(e.rotationQuaternion):e.rotation&&(d.rotation=j.k.Ve(e.rotation)),d.Ne=j.k.Ve(e.Ne),void 0!=e.checkCollisions&&null!=e.checkCollisions&&(d.checkCollisions=e.checkCollisions),void 0!=e.pickable&&null!=e.pickable&&(d.kj=e.pickable),void 0!=e.showBoundingBox&&null!=e.showBoundingBox&&(d.showBoundingBox=e.showBoundingBox),void 0!=e.showSubMeshesBoundingBox&&null!=e.showSubMeshesBoundingBox&&(d.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox),void 0!=e.alphaIndex&&null!=e.showSubMeshesBoundingBox&&(d.alphaIndex=e.alphaIndex),e.physicsImpostor&&(d.physicsImpostor=b._PhysicsImpostorParser(p,d,e)),void 0!==e.actions&&(d._waitingData.actions=e.actions),e.animations){for(let w=0;w<e.animations.length;w++){const p=e.animations[w],r=(0,M.c)("BABYLON.Animation");r&&d.animations.push(r.Parse(p))}k.b.ParseAnimationRanges(d,e,p),e.autoAnimate&&p.beginAnimation(d,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}}if(w.thinInstances){const p=w.thinInstances;if(r.thinInstanceEnablePicking=!!p.enablePicking,p.matrixData?(r.Lk("matrix",new Float32Array(p.matrixData),16,!1),r._thinInstanceDataStorage.matrixBufferSize=p.matrixBufferSize,r._thinInstanceDataStorage.instancesCount=p.instancesCount):r._thinInstanceDataStorage.matrixBufferSize=p.matrixBufferSize,w.thinInstances.userThinInstance){const p=w.thinInstances.userThinInstance;for(const w in p.data)r.Lk(w,new Float32Array(p.data[w]),p.strides[w],!1),r._userThinInstanceBuffersStorage.sizes[w]=p.sizes[w]}}return r}setPositionsForCPUSkinning(){const w=this._internalMeshDataInfo;if(!w._sourcePositions){const p=this.getVerticesData(m.e.PositionKind);if(!p)return w._sourcePositions;w._sourcePositions=new Float32Array(p),this.isVertexBufferUpdatable(m.e.PositionKind)||this.uw(m.e.PositionKind,p,!0)}return w._sourcePositions}setNormalsForCPUSkinning(){const w=this._internalMeshDataInfo;if(!w._sourceNormals){const p=this.getVerticesData(m.e.NormalKind);if(!p)return w._sourceNormals;w._sourceNormals=new Float32Array(p),this.isVertexBufferUpdatable(m.e.NormalKind)||this.uw(m.e.NormalKind,p,!0)}return w._sourceNormals}applySkeleton(w){if(!this.me)return this;if(this.me._softwareSkinningFrameId==this.iw().getFrameId())return this;if(this.me._softwareSkinningFrameId=this.iw().getFrameId(),!this.isVerticesDataPresent(m.e.PositionKind))return this;if(!this.isVerticesDataPresent(m.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(m.e.MatricesWeightsKind))return this;const p=this.isVerticesDataPresent(m.e.NormalKind),e=this._internalMeshDataInfo;if(!e._sourcePositions){const w=this.oe.slice();this.setPositionsForCPUSkinning(),this.oe=w}p&&!e._sourceNormals&&this.setNormalsForCPUSkinning();let r=this.getVerticesData(m.e.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));let I=this.getVerticesData(m.e.NormalKind);if(p){if(!I)return this;I instanceof Float32Array||(I=new Float32Array(I))}const d=this.getVerticesData(m.e.MatricesIndicesKind),f=this.getVerticesData(m.e.MatricesWeightsKind);if(!f||!d)return this;const q=this.numBoneInfluencers>4,E=q?this.getVerticesData(m.e.MatricesIndicesExtraKind):null,X=q?this.getVerticesData(m.e.MatricesWeightsExtraKind):null,k=w.getTransformMatrices(this),J=j.k.Zero(),K=new j.b,y=new j.b;let c,s=0;for(let m=0;m<r.length;m+=3,s+=4){let w;for(c=0;c<4;c++)w=f[s+c],w>0&&(j.b.FromFloat32ArrayToRefScaled(k,Math.floor(16*d[s+c]),w,y),K.addToSelf(y));if(q)for(c=0;c<4;c++)w=X[s+c],w>0&&(j.b.FromFloat32ArrayToRefScaled(k,Math.floor(16*E[s+c]),w,y),K.addToSelf(y));j.k.TransformCoordinatesFromFloatsToRef(e._sourcePositions[m],e._sourcePositions[m+1],e._sourcePositions[m+2],K,J),J.toArray(r,m),p&&(j.k.TransformNormalFromFloatsToRef(e._sourceNormals[m],e._sourceNormals[m+1],e._sourceNormals[m+2],K,J),J.toArray(I,m)),K.reset()}return this.updateVerticesData(m.e.PositionKind,r),p&&this.updateVerticesData(m.e.NormalKind,I),this}static MinMax(w){let p=null,e=null;for(const r of w){const w=r.getBoundingInfo().boundingBox;p&&e?(p.minimizeInPlace(w.minimumWorld),e.maximizeInPlace(w.maximumWorld)):(p=w.minimumWorld,e=w.maximumWorld)}return p&&e?{min:p,max:e}:{min:j.k.Zero(),max:j.k.Zero()}}static Center(w){const p=w instanceof Array?b.MinMax(w):w;return j.k.Center(p.min,p.max)}static MergeMeshes(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;return(0,q.n)(b._MergeMeshesCoroutine(w,p,e,r,I,d,!1))}static async MergeMeshesAsync(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;return await(0,q.j)(b._MergeMeshesCoroutine(w,p,e,r,I,d,!0),(0,q.e)())}static*_MergeMeshesCoroutine(w){let p,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,I=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;if(0===(w=w.filter(Boolean)).length)return null;if(!r){let e=0;for(p=0;p<w.length;p++)if(e+=w[p].getTotalVertices(),e>=65536)return z.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}f&&(d=!1);const E=new Array,j=new Array,X=new Array,k=w[0].sideOrientation;for(p=0;p<w.length;p++){const e=w[p];if(e.isAnInstance)return z.c.Warn("Cannot merge instance meshes."),null;if(k!==e.sideOrientation)return z.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(d&&X.push(e.getTotalIndices()),f)if(e.material){const w=e.material;if(w instanceof O.b){for(let p=0;p<w.Ce.length;p++)E.indexOf(w.Ce[p])<0&&E.push(w.Ce[p]);for(let p=0;p<e.oe.length;p++)j.push(E.indexOf(w.Ce[e.oe[p].materialIndex])),X.push(e.oe[p].indexCount)}else{E.indexOf(w)<0&&E.push(w);for(let p=0;p<e.oe.length;p++)j.push(E.indexOf(w)),X.push(e.oe[p].indexCount)}}else for(let w=0;w<e.oe.length;w++)j.push(0),X.push(e.oe[w].indexCount)}const m=w[0],K=w=>{const p=w.ke(!0);return{vertexData:J.b.ExtractFromMesh(w,!1,!1),transform:p}},{vertexData:y,transform:s}=K(m);q&&(yield);const a=new Array(w.length-1);for(let J=1;J<w.length;J++)a[J-1]=K(w[J]),q&&(yield);const A=y._mergeCoroutine(s,a,r,q,!e);let M=A.next();for(;!M.done;)q&&(yield),M=A.next();const i=M.value;I||(I=new b(m.name+"_merged",m.iw()));const t=i._applyToCoroutine(I,void 0,q);let n=t.next();for(;!n.done;)q&&(yield),n=t.next();if(I.checkCollisions=m.checkCollisions,I.sideOrientation=m.sideOrientation,e)for(p=0;p<w.length;p++)w[p].dispose();if(d||f){I.releaseSubMeshes(),p=0;let w=0;for(;p<X.length;)c.b.CreateFromIndices(0,w,X[p],I,void 0,!1),w+=X[p],p++;for(const p of I.oe)p.refreshBoundingInfo();I.ke(!0)}if(f){const w=new O.b(m.name+"_merged",m.iw());w.Ce=E;for(let p=0;p<I.oe.length;p++)I.oe[p].materialIndex=j[p];I.material=w}else I.material=m.material;return I}Fm(w){w._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(w)}Wm(w){const p=w._indexInSourceMeshInstanceArray;if(-1!=p){if(p!==this.instances.length-1){const w=this.instances[this.instances.length-1];this.instances[p]=w,w._indexInSourceMeshInstanceArray=p}w._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===s.b.CounterClockWiseSideOrientation}_getRenderingFillMode(w){const p=this.iw();return p.forcePointsCloud?s.b.PointFillMode:p.forceWireframe?s.b.WireFrameFillMode:this.overrideRenderingFillMode??w}setMaterialByID(w){return this.setMaterialById(w)}static CreateRibbon(w,p,e,r,I,d,f,q,E){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(w,p,e,r,I,d){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(w,p,e,r,I){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(w,p,e,r,I,d){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(w,p,e,r){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(w,p,e,r,I,d,f,q,E){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(w,p,e,r,I,d,f){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(w,p,e,r,I,d,f,q,E,j){throw new Error("Import MeshBuilder to populate this function")}static Bj(w,p,e,r,I){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(w,p,e,r,I,d,f,q){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(w,p,e,r,I,d,f){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(w,p,e,r,I,d,f,q){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(w,p,e,r,I,d,f,q,E,j){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(w,p,e,r,I,d,f,q,E,j,X,k){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(w,p,e,r,I,d,f){throw new Error("Import MeshBuilder to populate this function")}static Tj(w,p,e,r,I){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(w,p,e,r,I,d){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(w,p,e,r,I,d,f,q,E){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(w,p,e,r,I,d,f,q,E,j,X){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(w,p,e,r,I,d,f,q,E,j){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(w,p,e){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(w,p,e){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(w,p,e,r,I,d){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(w,p,e){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(w){throw new Error("Import MeshBuilder to populate this function")}}b.FRONTSIDE=J.b.FRONTSIDE,b.BACKSIDE=J.b.BACKSIDE,b.DOUBLESIDE=J.b.DOUBLESIDE,b.DEFAULTSIDE=J.b.DEFAULTSIDE,b.NO_CAP=0,b.CAP_START=1,b.CAP_END=2,b.CAP_ALL=3,b.NO_FLIP=0,b.FLIP_TILE=1,b.ROTATE_TILE=2,b.FLIP_ROW=3,b.ROTATE_ROW=4,b.FLIP_N_ROTATE_TILE=5,b.FLIP_N_ROTATE_ROW=6,b.CENTER=0,b.LEFT=1,b.RIGHT=2,b.TOP=3,b.BOTTOM=4,b.INSTANCEDMESH_SORT_TRANSPARENT=!1,b._GroundMeshParser=(w,p)=>{throw(0,i.c)("GroundMesh")},b._GoldbergMeshParser=(w,p)=>{throw(0,i.c)("GoldbergMesh")},b._LinesMeshParser=(w,p)=>{throw(0,i.c)("LinesMesh")},b._GreasedLineMeshParser=(w,p)=>{throw(0,i.c)("GreasedLineMesh")},b._GreasedLineRibbonMeshParser=(w,p)=>{throw(0,i.c)("GreasedLineRibbonMesh")},b._TrailMeshParser=(w,p)=>{throw(0,i.c)("TrailMesh")},(0,M.d)("BABYLON.Mesh",b)},11337:(w,p,e)=>{e.d(p,{b:()=>K});var r=e(11207),I=e(11023),d=e(11232),f=e(11094),q=e(11308),E=e(11081),j=e(11213),X=e(11346),k=e(11113),m=e(11227);class J{}class K{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,X.f)(this._applyToCoroutine.bind(this)),this.uniqueId=K._UniqueIdGenerator,K._UniqueIdGenerator++}set(w,p){switch(w.length||E.c.Warn(`Setting vertex data kind '${p}' with an empty array`),p){case d.e.PositionKind:this.nw=w;break;case d.e.NormalKind:this.lw=w;break;case d.e.TangentKind:this.tangents=w;break;case d.e.UVKind:this.Uw=w;break;case d.e.UV2Kind:this.uvs2=w;break;case d.e.UV3Kind:this.uvs3=w;break;case d.e.UV4Kind:this.uvs4=w;break;case d.e.UV5Kind:this.uvs5=w;break;case d.e.UV6Kind:this.uvs6=w;break;case d.e.ColorKind:this.Nw=w;break;case d.e.MatricesIndicesKind:this.matricesIndices=w;break;case d.e.MatricesWeightsKind:this.matricesWeights=w;break;case d.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=w;break;case d.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=w}}Vw(w,p){return this._applyTo(w,p,!1),this}applyToGeometry(w,p){return this._applyTo(w,p,!1),this}updateMesh(w){return this._update(w),this}updateGeometry(w){return this._update(w),this}*_applyToCoroutine(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;if(this.nw&&(w.uw(d.e.PositionKind,this.nw,p),e&&(yield)),this.lw&&(w.uw(d.e.NormalKind,this.lw,p),e&&(yield)),this.tangents&&(w.uw(d.e.TangentKind,this.tangents,p),e&&(yield)),this.Uw&&(w.uw(d.e.UVKind,this.Uw,p),e&&(yield)),this.uvs2&&(w.uw(d.e.UV2Kind,this.uvs2,p),e&&(yield)),this.uvs3&&(w.uw(d.e.UV3Kind,this.uvs3,p),e&&(yield)),this.uvs4&&(w.uw(d.e.UV4Kind,this.uvs4,p),e&&(yield)),this.uvs5&&(w.uw(d.e.UV5Kind,this.uvs5,p),e&&(yield)),this.uvs6&&(w.uw(d.e.UV6Kind,this.uvs6,p),e&&(yield)),this.Nw){const r=this.nw&&this.Nw.length===this.nw.length?3:4;w.uw(d.e.ColorKind,this.Nw,p,r),this.hasVertexAlpha&&void 0!==w.hasVertexAlpha&&(w.hasVertexAlpha=!0),e&&(yield)}if(this.matricesIndices&&(w.uw(d.e.MatricesIndicesKind,this.matricesIndices,p),e&&(yield)),this.matricesWeights&&(w.uw(d.e.MatricesWeightsKind,this.matricesWeights,p),e&&(yield)),this.matricesIndicesExtra&&(w.uw(d.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,p),e&&(yield)),this.matricesWeightsExtra&&(w.uw(d.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,p),e&&(yield)),this.indices?(w.setIndices(this.indices,null,p),e&&(yield)):w.setIndices([],null),w.oe&&this.materialInfos&&this.materialInfos.length>1){const p=w;p.oe=[];for(const w of this.materialInfos)new m.b(w.materialIndex,w.verticesStart,w.verticesCount,w.indexStart,w.indexCount,p)}return this}_update(w,p,e){return this.nw&&w.updateVerticesData(d.e.PositionKind,this.nw,p,e),this.lw&&w.updateVerticesData(d.e.NormalKind,this.lw,p,e),this.tangents&&w.updateVerticesData(d.e.TangentKind,this.tangents,p,e),this.Uw&&w.updateVerticesData(d.e.UVKind,this.Uw,p,e),this.uvs2&&w.updateVerticesData(d.e.UV2Kind,this.uvs2,p,e),this.uvs3&&w.updateVerticesData(d.e.UV3Kind,this.uvs3,p,e),this.uvs4&&w.updateVerticesData(d.e.UV4Kind,this.uvs4,p,e),this.uvs5&&w.updateVerticesData(d.e.UV5Kind,this.uvs5,p,e),this.uvs6&&w.updateVerticesData(d.e.UV6Kind,this.uvs6,p,e),this.Nw&&w.updateVerticesData(d.e.ColorKind,this.Nw,p,e),this.matricesIndices&&w.updateVerticesData(d.e.MatricesIndicesKind,this.matricesIndices,p,e),this.matricesWeights&&w.updateVerticesData(d.e.MatricesWeightsKind,this.matricesWeights,p,e),this.matricesIndicesExtra&&w.updateVerticesData(d.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,p,e),this.matricesWeightsExtra&&w.updateVerticesData(d.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,p,e),this.indices&&w.setIndices(this.indices,null),this}static _TransformVector3Coordinates(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.length;const d=I.d.ne[0],f=I.d.ne[1];for(let q=e;q<e+r;q+=3)I.k.FromArrayToRef(w,q,d),I.k.TransformCoordinatesToRef(d,p,f),w[q]=f.x,w[q+1]=f.y,w[q+2]=f.z}static _TransformVector3Normals(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.length;const d=I.d.ne[0],f=I.d.ne[1];for(let q=e;q<e+r;q+=3)I.k.FromArrayToRef(w,q,d),I.k.TransformNormalToRef(d,p,f),w[q]=f.x,w[q+1]=f.y,w[q+2]=f.z}static _TransformVector4Normals(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.length;const d=I.d.Vector4[0],f=I.d.Vector4[1];for(let q=e;q<e+r;q+=4)I.o.FromArrayToRef(w,q,d),I.o.TransformNormalToRef(d,p,f),w[q]=f.x,w[q+1]=f.y,w[q+2]=f.z,w[q+3]=f.w}static _FlipFaces(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.length;for(let r=p;r<p+e;r+=3){const p=w[r+1];w[r+1]=w[r+2],w[r+2]=p}}transform(w){const p=w.determinant()<0;return this.nw&&K._TransformVector3Coordinates(this.nw,w),this.lw&&K._TransformVector3Normals(this.lw,w),this.tangents&&K._TransformVector4Normals(this.tangents,w),p&&this.indices&&K._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const w=[];for(const p of this.materialInfos){const e=new K;if(this.nw&&(e.nw=this.nw.slice(3*p.verticesStart,3*(p.verticesCount+p.verticesStart))),this.lw&&(e.lw=this.lw.slice(3*p.verticesStart,3*(p.verticesCount+p.verticesStart))),this.tangents&&(e.tangents=this.tangents.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.Nw&&(e.Nw=this.Nw.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.Uw&&(e.Uw=this.Uw.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs2&&(e.uvs2=this.uvs2.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs3&&(e.uvs3=this.uvs3.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs4&&(e.uvs4=this.uvs4.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs5&&(e.uvs5=this.uvs5.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs6&&(e.uvs6=this.uvs6.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.matricesIndices&&(e.matricesIndices=this.matricesIndices.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.matricesWeights&&(e.matricesWeights=this.matricesWeights.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.indices){e.indices=[];for(let w=p.indexStart;w<p.indexStart+p.indexCount;w++)e.indices.push(this.indices[w]-p.verticesStart)}const r=new J;r.indexStart=0,r.indexCount=e.indices?e.indices.length:0,r.materialIndex=p.materialIndex,r.verticesStart=0,r.verticesCount=(e.nw?e.nw.length:0)/3,e.materialInfos=[r],w.push(e)}return w}merge(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=Array.isArray(w)?w.map((w=>({vertexData:w}))):[{vertexData:w}];return(0,X.n)(this._mergeCoroutine(void 0,d,p,!1,e,r,I))}*_mergeCoroutine(w,p){var e,r;let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let X=p.map((w=>w.vertexData)),k=this;if(j)for(const d of X)d&&(d._validate(),!this.lw&&d.lw&&(this.lw=new Float32Array(this.nw.length)),!this.tangents&&d.tangents&&(this.tangents=new Float32Array(this.nw.length/3*4)),!this.Uw&&d.Uw&&(this.Uw=new Float32Array(this.nw.length/3*2)),!this.uvs2&&d.uvs2&&(this.uvs2=new Float32Array(this.nw.length/3*2)),!this.uvs3&&d.uvs3&&(this.uvs3=new Float32Array(this.nw.length/3*2)),!this.uvs4&&d.uvs4&&(this.uvs4=new Float32Array(this.nw.length/3*2)),!this.uvs5&&d.uvs5&&(this.uvs5=new Float32Array(this.nw.length/3*2)),!this.uvs6&&d.uvs6&&(this.uvs6=new Float32Array(this.nw.length/3*2)),!this.Nw&&d.Nw&&(this.Nw=new Float32Array(this.nw.length/3*4),this.Nw.fill(1)),!this.matricesIndices&&d.matricesIndices&&(this.matricesIndices=new Float32Array(this.nw.length/3*4)),!this.matricesWeights&&d.matricesWeights&&(this.matricesWeights=new Float32Array(this.nw.length/3*4)),!this.matricesIndicesExtra&&d.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.nw.length/3*4)),!this.matricesWeightsExtra&&d.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.nw.length/3*4)));for(const d of X)if(d)if(j)this.lw&&!d.lw&&(d.lw=new Float32Array(d.nw.length)),this.tangents&&!d.tangents&&(d.tangents=new Float32Array(d.nw.length/3*4)),this.Uw&&!d.Uw&&(d.Uw=new Float32Array(d.nw.length/3*2)),this.uvs2&&!d.uvs2&&(d.uvs2=new Float32Array(d.nw.length/3*2)),this.uvs3&&!d.uvs3&&(d.uvs3=new Float32Array(d.nw.length/3*2)),this.uvs4&&!d.uvs4&&(d.uvs4=new Float32Array(d.nw.length/3*2)),this.uvs5&&!d.uvs5&&(d.uvs5=new Float32Array(d.nw.length/3*2)),this.uvs6&&!d.uvs6&&(d.uvs6=new Float32Array(d.nw.length/3*2)),this.Nw&&!d.Nw&&(d.Nw=new Float32Array(d.nw.length/3*4),d.Nw.fill(1)),this.matricesIndices&&!d.matricesIndices&&(d.matricesIndices=new Float32Array(d.nw.length/3*4)),this.matricesWeights&&!d.matricesWeights&&(d.matricesWeights=new Float32Array(d.nw.length/3*4)),this.matricesIndicesExtra&&!d.matricesIndicesExtra&&(d.matricesIndicesExtra=new Float32Array(d.nw.length/3*4)),this.matricesWeightsExtra&&!d.matricesWeightsExtra&&(d.matricesWeightsExtra=new Float32Array(d.nw.length/3*4));else if(d._validate(),!this.lw!==!d.lw||!this.tangents!==!d.tangents||!this.Uw!==!d.Uw||!this.uvs2!==!d.uvs2||!this.uvs3!==!d.uvs3||!this.uvs4!==!d.uvs4||!this.uvs5!==!d.uvs5||!this.uvs6!==!d.uvs6||!this.Nw!==!d.Nw||!this.matricesIndices!==!d.matricesIndices||!this.matricesWeights!==!d.matricesWeights||!this.matricesIndicesExtra!==!d.matricesIndicesExtra||!this.matricesWeightsExtra!==!d.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(E){let e=0,r=0,I=0;const d=[];let f=null;const q=[];for(const p of this.splitBasedOnMaterialID())q.push({vertexData:p,transform:w});for(const w of p)if(w.vertexData)for(const p of w.vertexData.splitBasedOnMaterialID())q.push({vertexData:p,transform:w.transform});q.sort(((w,p)=>{const e=w.vertexData.materialInfos?w.vertexData.materialInfos[0].materialIndex:0,r=p.vertexData.materialInfos?p.vertexData.materialInfos[0].materialIndex:0;return e>r?1:e===r?0:-1}));for(const w of q){const p=w.vertexData;if(e=p.materialInfos?p.materialInfos[0].materialIndex:0,f&&f.materialIndex===e)f.indexCount+=p.indices.length,f.verticesCount+=p.nw.length/3;else{const w=new J;w.materialIndex=e,w.indexStart=r,w.indexCount=p.indices.length,w.verticesStart=I,w.verticesCount=p.nw.length/3,d.push(w),f=w}r+=p.indices.length,I+=p.nw.length/3}const E=q.splice(0,1)[0];k=E.vertexData,w=E.transform,X=q.map((w=>w.vertexData)),p=q,this.materialInfos=d}const m=X.reduce(((w,p)=>{var e;return w+((null===(e=p.indices)||void 0===e?void 0:e.length)??0)}),(null===(e=k.indices)||void 0===e?void 0:e.length)??0);let y=q||X.some((w=>w.indices===k.indices))?null===(r=k.indices)||void 0===r?void 0:r.slice():k.indices;if(m>0){var c;let e=(null===(c=y)||void 0===c?void 0:c.length)??0;if(y||(y=new Array(m)),y.length!==m){if(Array.isArray(y))y.length=m;else{const w=I||y instanceof Uint32Array?new Uint32Array(m):new Uint16Array(m);w.set(y),y=w}w&&w.determinant()<0&&K._FlipFaces(y,0,e)}let r=k.nw?k.nw.length/3:0;for(const{vertexData:w,transform:I}of p)if(w.indices){for(let p=0;p<w.indices.length;p++)y[e+p]=w.indices[p]+r;I&&I.determinant()<0&&K._FlipFaces(y,e,w.indices.length),r+=w.nw.length/3,e+=w.indices.length,f&&(yield)}}return this.indices=y,this.nw=K._MergeElement(d.e.PositionKind,k.nw,w,p.map((w=>[w.vertexData.nw,w.transform]))),f&&(yield),k.lw&&(this.lw=K._MergeElement(d.e.NormalKind,k.lw,w,p.map((w=>[w.vertexData.lw,w.transform]))),f&&(yield)),k.tangents&&(this.tangents=K._MergeElement(d.e.TangentKind,k.tangents,w,p.map((w=>[w.vertexData.tangents,w.transform]))),f&&(yield)),k.Uw&&(this.Uw=K._MergeElement(d.e.UVKind,k.Uw,w,p.map((w=>[w.vertexData.Uw,w.transform]))),f&&(yield)),k.uvs2&&(this.uvs2=K._MergeElement(d.e.UV2Kind,k.uvs2,w,p.map((w=>[w.vertexData.uvs2,w.transform]))),f&&(yield)),k.uvs3&&(this.uvs3=K._MergeElement(d.e.UV3Kind,k.uvs3,w,p.map((w=>[w.vertexData.uvs3,w.transform]))),f&&(yield)),k.uvs4&&(this.uvs4=K._MergeElement(d.e.UV4Kind,k.uvs4,w,p.map((w=>[w.vertexData.uvs4,w.transform]))),f&&(yield)),k.uvs5&&(this.uvs5=K._MergeElement(d.e.UV5Kind,k.uvs5,w,p.map((w=>[w.vertexData.uvs5,w.transform]))),f&&(yield)),k.uvs6&&(this.uvs6=K._MergeElement(d.e.UV6Kind,k.uvs6,w,p.map((w=>[w.vertexData.uvs6,w.transform]))),f&&(yield)),k.Nw&&(this.Nw=K._MergeElement(d.e.ColorKind,k.Nw,w,p.map((w=>[w.vertexData.Nw,w.transform]))),(void 0!==k.hasVertexAlpha||p.some((w=>void 0!==w.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=k.hasVertexAlpha||p.some((w=>w.vertexData.hasVertexAlpha))),f&&(yield)),k.matricesIndices&&(this.matricesIndices=K._MergeElement(d.e.MatricesIndicesKind,k.matricesIndices,w,p.map((w=>[w.vertexData.matricesIndices,w.transform]))),f&&(yield)),k.matricesWeights&&(this.matricesWeights=K._MergeElement(d.e.MatricesWeightsKind,k.matricesWeights,w,p.map((w=>[w.vertexData.matricesWeights,w.transform]))),f&&(yield)),k.matricesIndicesExtra&&(this.matricesIndicesExtra=K._MergeElement(d.e.MatricesIndicesExtraKind,k.matricesIndicesExtra,w,p.map((w=>[w.vertexData.matricesIndicesExtra,w.transform]))),f&&(yield)),k.matricesWeightsExtra&&(this.matricesWeightsExtra=K._MergeElement(d.e.MatricesWeightsExtraKind,k.matricesWeightsExtra,w,p.map((w=>[w.vertexData.matricesWeightsExtra,w.transform])))),this}static _MergeElement(w,p,e,r){const I=r.filter((w=>null!==w[0]&&void 0!==w[0]));if(!p&&0==I.length)return p;if(!p)return this._MergeElement(w,I[0][0],I[0][1],I.slice(1));const f=I.reduce(((w,p)=>w+p[0].length),p.length),q=w===d.e.PositionKind?K._TransformVector3Coordinates:w===d.e.NormalKind?K._TransformVector3Normals:w===d.e.TangentKind?K._TransformVector4Normals:()=>{};if(p instanceof Float32Array){const w=new Float32Array(f);w.set(p),e&&q(w,e,0,p.length);let r=p.length;for(const[p,e]of I)w.set(p,r),e&&q(w,e,r,p.length),r+=p.length;return w}{const w=new Array(f);for(let e=0;e<p.length;e++)w[e]=p[e];e&&q(w,e,0,p.length);let r=p.length;for(const[p,e]of I){for(let e=0;e<p.length;e++)w[r+e]=p[e];e&&q(w,e,r,p.length),r+=p.length}return w}}_validate(){if(!this.nw)throw new k.l("Positions are required",k.i.MeshInvalidPositionsError);const w=(w,p)=>{const e=d.e.DeduceStride(w);if(p.length%e!==0)throw new Error("The "+w+"s array count must be a multiple of "+e);return p.length/e},p=w(d.e.PositionKind,this.nw),e=(e,r)=>{const I=w(e,r);if(I!==p)throw new Error("The "+e+"s element count ("+I+") does not match the positions count ("+p+")")};this.lw&&e(d.e.NormalKind,this.lw),this.tangents&&e(d.e.TangentKind,this.tangents),this.Uw&&e(d.e.UVKind,this.Uw),this.uvs2&&e(d.e.UV2Kind,this.uvs2),this.uvs3&&e(d.e.UV3Kind,this.uvs3),this.uvs4&&e(d.e.UV4Kind,this.uvs4),this.uvs5&&e(d.e.UV5Kind,this.uvs5),this.uvs6&&e(d.e.UV6Kind,this.uvs6),this.Nw&&e(d.e.ColorKind,this.Nw),this.matricesIndices&&e(d.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&e(d.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&e(d.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&e(d.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const w=this.serialize();return K.Parse(w)}serialize(){const w={};if(this.nw&&(w.nw=Array.from(this.nw)),this.lw&&(w.lw=Array.from(this.lw)),this.tangents&&(w.tangents=Array.from(this.tangents)),this.Uw&&(w.Uw=Array.from(this.Uw)),this.uvs2&&(w.uvs2=Array.from(this.uvs2)),this.uvs3&&(w.uvs3=Array.from(this.uvs3)),this.uvs4&&(w.uvs4=Array.from(this.uvs4)),this.uvs5&&(w.uvs5=Array.from(this.uvs5)),this.uvs6&&(w.uvs6=Array.from(this.uvs6)),this.Nw&&(w.Nw=Array.from(this.Nw),w.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(w.matricesIndices=Array.from(this.matricesIndices),w.matricesIndicesExpanded=!0),this.matricesWeights&&(w.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(w.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),w.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(w.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),w.indices=this.indices?Array.from(this.indices):[],this.materialInfos){w.materialInfos=[];for(const p of this.materialInfos){const e={indexStart:p.indexStart,indexCount:p.indexCount,materialIndex:p.materialIndex,verticesStart:p.verticesStart,verticesCount:p.verticesCount};w.materialInfos.push(e)}}return w}static ExtractFromMesh(w,p,e){return K._ExtractFrom(w,p,e)}static ExtractFromGeometry(w,p,e){return K._ExtractFrom(w,p,e)}static _ExtractFrom(w,p,e){const r=new K;if(w.isVerticesDataPresent(d.e.PositionKind)&&(r.nw=w.getVerticesData(d.e.PositionKind,p,e)),w.isVerticesDataPresent(d.e.NormalKind)&&(r.lw=w.getVerticesData(d.e.NormalKind,p,e)),w.isVerticesDataPresent(d.e.TangentKind)&&(r.tangents=w.getVerticesData(d.e.TangentKind,p,e)),w.isVerticesDataPresent(d.e.UVKind)&&(r.Uw=w.getVerticesData(d.e.UVKind,p,e)),w.isVerticesDataPresent(d.e.UV2Kind)&&(r.uvs2=w.getVerticesData(d.e.UV2Kind,p,e)),w.isVerticesDataPresent(d.e.UV3Kind)&&(r.uvs3=w.getVerticesData(d.e.UV3Kind,p,e)),w.isVerticesDataPresent(d.e.UV4Kind)&&(r.uvs4=w.getVerticesData(d.e.UV4Kind,p,e)),w.isVerticesDataPresent(d.e.UV5Kind)&&(r.uvs5=w.getVerticesData(d.e.UV5Kind,p,e)),w.isVerticesDataPresent(d.e.UV6Kind)&&(r.uvs6=w.getVerticesData(d.e.UV6Kind,p,e)),w.isVerticesDataPresent(d.e.ColorKind)){const I=w.me||w,f=I.getVertexBuffer(d.e.ColorKind),q=I.getVerticesData(d.e.ColorKind,p,e);if(3===f.getSize()){const w=new Float32Array(4*q.length/3);for(let p=0,e=0;p<q.length;p+=3,e+=4)w[e]=q[p],w[e+1]=q[p+1],w[e+2]=q[p+2],w[e+3]=1;r.Nw=w}else{if(4!==f.getSize())throw new Error(`Unexpected number of color components: ${f.getSize()}`);r.Nw=q}}return w.isVerticesDataPresent(d.e.MatricesIndicesKind)&&(r.matricesIndices=w.getVerticesData(d.e.MatricesIndicesKind,p,e)),w.isVerticesDataPresent(d.e.MatricesWeightsKind)&&(r.matricesWeights=w.getVerticesData(d.e.MatricesWeightsKind,p,e)),w.isVerticesDataPresent(d.e.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=w.getVerticesData(d.e.MatricesIndicesExtraKind,p,e)),w.isVerticesDataPresent(d.e.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=w.getVerticesData(d.e.MatricesWeightsExtraKind,p,e)),r.indices=w.Ke(p,e),r}static CreateRibbon(w){throw(0,f.c)("ribbonBuilder")}static CreateBox(w){throw(0,f.c)("boxBuilder")}static CreateTiledBox(w){throw(0,f.c)("tiledBoxBuilder")}static CreateTiledPlane(w){throw(0,f.c)("tiledPlaneBuilder")}static CreateSphere(w){throw(0,f.c)("sphereBuilder")}static CreateCylinder(w){throw(0,f.c)("cylinderBuilder")}static CreateTorus(w){throw(0,f.c)("torusBuilder")}static CreateLineSystem(w){throw(0,f.c)("linesBuilder")}static CreateDashedLines(w){throw(0,f.c)("linesBuilder")}static CreateGround(w){throw(0,f.c)("groundBuilder")}static CreateTiledGround(w){throw(0,f.c)("groundBuilder")}static CreateGroundFromHeightMap(w){throw(0,f.c)("groundBuilder")}static Tj(w){throw(0,f.c)("planeBuilder")}static CreateDisc(w){throw(0,f.c)("discBuilder")}static CreatePolygon(w,p,e,r,I,d,q){throw(0,f.c)("polygonBuilder")}static CreateIcoSphere(w){throw(0,f.c)("icoSphereBuilder")}static CreatePolyhedron(w){throw(0,f.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||I.k.Up();throw(0,f.c)("capsuleBuilder")}static CreateTorusKnot(w){throw(0,f.c)("torusKnotBuilder")}static ComputeNormals(w,p,e,r){let d=0,f=0,q=0,E=0,j=0,X=0,k=0,m=0,J=0,K=0,y=0,c=0,s=0,O=0,a=0,A=0,z=0,M=0,i=0,t=0,n=!1,l=!1,N=!1,U=!1,v=1,R=0,V=null;r&&(n=!!r.facetNormals,l=!!r.facetPositions,N=!!r.facetPartitioning,v=!0===r.useRightHandedSystem?-1:1,R=r.ratio||0,U=!!r.depthSort,V=r.distanceTo,U&&void 0===V&&(V=I.k.Zero()));let b=0,h=0,P=0,u=0;for(N&&r&&r.bbSize&&(b=r.subDiv.X*R/r.bbSize.x,h=r.subDiv.Y*R/r.bbSize.y,P=r.subDiv.Z*R/r.bbSize.z,u=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0),d=0;d<w.length;d++)e[d]=0;const Y=p.length/3|0;for(d=0;d<Y;d++){if(c=3*p[3*d],s=c+1,O=c+2,a=3*p[3*d+1],A=a+1,z=a+2,M=3*p[3*d+2],i=M+1,t=M+2,f=w[c]-w[a],q=w[s]-w[A],E=w[O]-w[z],j=w[M]-w[a],X=w[i]-w[A],k=w[t]-w[z],m=v*(q*k-E*X),J=v*(E*j-f*k),K=v*(f*X-q*j),y=Math.sqrt(m*m+J*J+K*K),y=0===y?1:y,m/=y,J/=y,K/=y,n&&r&&(r.facetNormals[d].x=m,r.facetNormals[d].y=J,r.facetNormals[d].z=K),l&&r&&(r.facetPositions[d].x=(w[c]+w[a]+w[M])/3,r.facetPositions[d].y=(w[s]+w[A]+w[i])/3,r.facetPositions[d].z=(w[O]+w[z]+w[t])/3),N&&r){const p=Math.floor((r.facetPositions[d].x-r.bInfo.minimum.x*R)*b),e=Math.floor((r.facetPositions[d].y-r.bInfo.minimum.y*R)*h),I=Math.floor((r.facetPositions[d].z-r.bInfo.minimum.z*R)*P),f=Math.floor((w[c]-r.bInfo.minimum.x*R)*b),q=Math.floor((w[s]-r.bInfo.minimum.y*R)*h),E=Math.floor((w[O]-r.bInfo.minimum.z*R)*P),j=Math.floor((w[a]-r.bInfo.minimum.x*R)*b),X=Math.floor((w[A]-r.bInfo.minimum.y*R)*h),k=Math.floor((w[z]-r.bInfo.minimum.z*R)*P),m=Math.floor((w[M]-r.bInfo.minimum.x*R)*b),J=Math.floor((w[i]-r.bInfo.minimum.y*R)*h),K=Math.floor((w[t]-r.bInfo.minimum.z*R)*P),y=f+r.subDiv.max*q+u*E,n=j+r.subDiv.max*X+u*k,l=m+r.subDiv.max*J+u*K,N=p+r.subDiv.max*e+u*I;r.facetPartitioning[N]=r.facetPartitioning[N]?r.facetPartitioning[N]:[],r.facetPartitioning[y]=r.facetPartitioning[y]?r.facetPartitioning[y]:[],r.facetPartitioning[n]=r.facetPartitioning[n]?r.facetPartitioning[n]:[],r.facetPartitioning[l]=r.facetPartitioning[l]?r.facetPartitioning[l]:[],r.facetPartitioning[y].push(d),n!=y&&r.facetPartitioning[n].push(d),l!=n&&l!=y&&r.facetPartitioning[l].push(d),N!=y&&N!=n&&N!=l&&r.facetPartitioning[N].push(d)}if(U&&r&&r.facetPositions){const w=r.depthSortedFacets[d];w.ind=3*d,w.sqDistance=I.k.DistanceSquared(r.facetPositions[d],V)}e[c]+=m,e[s]+=J,e[O]+=K,e[a]+=m,e[A]+=J,e[z]+=K,e[M]+=m,e[i]+=J,e[t]+=K}for(d=0;d<e.length/3;d++)m=e[3*d],J=e[3*d+1],K=e[3*d+2],y=Math.sqrt(m*m+J*J+K*K),y=0===y?1:y,m/=y,J/=y,K/=y,e[3*d]=m,e[3*d+1]=J,e[3*d+2]=K}static _ComputeSides(w,p,e,r,d,f,q){const E=e.length,j=r.length;let X,k;switch(w=w||K.DEFAULTSIDE){case K.FRONTSIDE:break;case K.BACKSIDE:for(X=0;X<E;X+=3){const w=e[X];e[X]=e[X+2],e[X+2]=w}for(k=0;k<j;k++)r[k]=-r[k];break;case K.DOUBLESIDE:{const w=p.length,m=w/3;for(let e=0;e<w;e++)p[w+e]=p[e];for(X=0;X<E;X+=3)e[X+E]=e[X+2]+m,e[X+1+E]=e[X+1]+m,e[X+2+E]=e[X]+m;for(k=0;k<j;k++)r[j+k]=-r[k];const J=d.length;let K=0;for(K=0;K<J;K++)d[K+J]=d[K];for(f=f||new I.o(0,0,1,1),q=q||new I.o(0,0,1,1),K=0,X=0;X<J/2;X++)d[K]=f.x+(f.z-f.x)*d[K],d[K+1]=f.y+(f.w-f.y)*d[K+1],d[K+J]=q.x+(q.z-q.x)*d[K+J],d[K+J+1]=q.y+(q.w-q.y)*d[K+J+1],K+=2;break}}}static Parse(w){const p=new K,e=w.nw;e&&p.set(e,d.e.PositionKind);const r=w.lw;r&&p.set(r,d.e.NormalKind);const I=w.tangents;I&&p.set(I,d.e.TangentKind);const f=w.Uw;f&&p.set(f,d.e.UVKind);const E=w.uvs2;E&&p.set(E,d.e.UV2Kind);const j=w.uvs3;j&&p.set(j,d.e.UV3Kind);const X=w.uvs4;X&&p.set(X,d.e.UV4Kind);const k=w.uvs5;k&&p.set(k,d.e.UV5Kind);const m=w.uvs6;m&&p.set(m,d.e.UV6Kind);const y=w.Nw;y&&(p.set(q.e.CheckColors4(y,e.length/3),d.e.ColorKind),void 0!==w.hasVertexAlpha&&(p.hasVertexAlpha=w.hasVertexAlpha));const c=w.matricesIndices;c&&p.set(c,d.e.MatricesIndicesKind);const s=w.matricesWeights;s&&p.set(s,d.e.MatricesWeightsKind);const O=w.indices;O&&(p.indices=O);const a=w.materialInfos;if(a){p.materialInfos=[];for(const w of a){const e=new J;e.indexCount=w.indexCount,e.indexStart=w.indexStart,e.verticesCount=w.verticesCount,e.verticesStart=w.verticesStart,e.materialIndex=w.materialIndex,p.materialInfos.push(e)}}return p}static ImportVertexData(w,p){const e=K.Parse(w);p.setAllVerticesData(e,w.updatable)}}K.FRONTSIDE=0,K.BACKSIDE=1,K.DOUBLESIDE=2,K.DEFAULTSIDE=0,K._UniqueIdGenerator=0,(0,r.c)([j.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r]=p;return!Array.isArray(r)}))],K,"_TransformVector3Coordinates",null),(0,r.c)([j.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r]=p;return!Array.isArray(r)}))],K,"_TransformVector3Normals",null),(0,r.c)([j.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r]=p;return!Array.isArray(r)}))],K,"_TransformVector4Normals",null),(0,r.c)([j.f.filter((function(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];let[r]=p;return!Array.isArray(r)}))],K,"_FlipFaces",null)},11227:(w,p,e)=>{e.d(p,{b:()=>E});var r=e(11232),I=e(11256),d=e(11265),f=e(11277),q=e(11286);class E{get materialDefines(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(w=this._getDrawWrapper())||void 0===w?void 0:w.defines}set materialDefines(w){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=w}_getDrawWrapper(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w=w??this._engine.currentRenderPassId;let e=this._drawWrappers[w];return!e&&p&&(this._drawWrappers[w]=e=new q.b(this._mesh.iw().getEngine())),e}_removeDrawWrapper(w){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(e=this._drawWrappers[w])||void 0===e||e.dispose(p));this._drawWrappers[w]=void 0}get effect(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(w=this._getDrawWrapper())||void 0===w?void 0:w.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(w){this._mainDrawWrapperOverride=w}setEffect(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const I=this._drawWrapper;I.setEffect(w,p,r),void 0!==e&&(I.materialContext=e),w||(I.defines=null,I.materialContext=void 0)}resetDrawCache(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==w)return void this._removeDrawWrapper(w,!0,p);for(const w of this._drawWrappers)null===w||void 0===w||w.dispose(p)}this._drawWrappers=[]}static AddToMesh(w,p,e,r,I,d,f){return new E(w,p,e,r,I,d,f,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(w,p,e,r,I,d,f){let q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],E=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=w,this.verticesStart=p,this.verticesCount=e,this.indexStart=r,this.indexCount=I,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=d,this._renderingMesh=f||d,E&&d.oe.push(this),this._engine=this._mesh.iw().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=d.oe.length-1,q&&(this.refreshBoundingInfo(),d.ke(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(w){return this._boundingInfo=w,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const w=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return w||this._renderingMesh}Yw(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const p=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!p)return w&&this._mesh.iw()._hasDefaultMaterial?this._mesh.iw().defaultMaterial:null;if(this._isMultiMaterial(p)){const w=p.getSubMaterial(this.materialIndex);return this._currentMaterial!==w&&(this._currentMaterial=w,this.resetDrawCache()),w}return p}_isMultiMaterial(w){return void 0!==w.getSubMaterial}refreshBoundingInfo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.me)return this;if(w||(w=this._renderingMesh.getVerticesData(r.e.PositionKind)),!w)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const p=this._renderingMesh.Ke();let e;if(0===this.indexStart&&this.indexCount===p.length){const w=this._renderingMesh.getBoundingInfo();e={minimum:w.minimum.clone(),maximum:w.maximum.clone()}}else e=(0,f.c)(w,p,this.indexStart,this.indexCount,this._renderingMesh.me.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new d.b(e.minimum,e.maximum),this}_checkCollision(w){return this.getBoundingInfo()._checkCollision(w)}updateBoundingInfo(w){let p=this.getBoundingInfo();return p||(this.refreshBoundingInfo(),p=this.getBoundingInfo()),p&&p.update(w),this}isInFrustum(w){const p=this.getBoundingInfo();return!!p&&p.isInFrustum(w,this._mesh.Pk)}isCompletelyInFrustum(w){const p=this.getBoundingInfo();return!!p&&p.isCompletelyInFrustum(w)}render(w){return this._renderingMesh.render(this,w,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(w,p){if(!this._linesIndexBuffer){const e=6*Math.floor(this.indexCount/3),r=this.verticesStart+this.verticesCount>65535?new Uint32Array(e):new Uint16Array(e);let I=0;if(0===w.length)for(let w=this.indexStart;w<this.indexStart+this.indexCount;w+=3)r[I++]=w,r[I++]=w+1,r[I++]=w+1,r[I++]=w+2,r[I++]=w+2,r[I++]=w;else for(let p=this.indexStart;p<this.indexStart+this.indexCount;p+=3)r[I++]=w[p],r[I++]=w[p+1],r[I++]=w[p+1],r[I++]=w[p+2],r[I++]=w[p+2],r[I++]=w[p];this._linesIndexBuffer=p.createIndexBuffer(r),this._linesIndexCount=r.length}return this._linesIndexBuffer}canIntersects(w){const p=this.getBoundingInfo();return!!p&&w.intersectsBox(p.boundingBox)}intersects(w,p,e,r,I){const d=this.Yw();if(!d)return null;let f=3,q=!1;switch(d.fillMode){case 3:case 5:case 6:case 8:return null;case 7:f=1,q=!0}return 4===d.fillMode?e.length?this._intersectLines(w,p,e,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(w,p,e,this._mesh.intersectionThreshold,r):!e.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(w,p,e,r,I):this._intersectTriangles(w,p,e,f,q,r,I)}_intersectLines(w,p,e,r,d){let f=null;for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=2){const E=p[e[q]],j=p[e[q+1]],X=w.intersectionSegment(E,j,r);if(!(X<0)&&((d||!f||X<f.distance)&&(f=new I.c(null,null,X),f.faceId=q/2,d)))break}return f}_intersectUnIndexedLines(w,p,e,r,d){let f=null;for(let q=this.verticesStart;q<this.verticesStart+this.verticesCount;q+=2){const e=p[q],E=p[q+1],j=w.intersectionSegment(e,E,r);if(!(j<0)&&((d||!f||j<f.distance)&&(f=new I.c(null,null,j),f.faceId=q/2,d)))break}return f}_intersectTriangles(w,p,e,r,I,d,f){let q=null,E=-1;for(let j=this.indexStart;j<this.indexStart+this.indexCount-(3-r);j+=r){E++;const r=e[j],X=e[j+1],k=e[j+2];if(I&&4294967295===k){j+=2;continue}const m=p[r],J=p[X],K=p[k];if(!m||!J||!K)continue;if(f&&!f(m,J,K,w,r,X,k))continue;const y=w.intersectsTriangle(m,J,K);if(y){if(y.distance<0)continue;if((d||!q||y.distance<q.distance)&&(q=y,q.faceId=E,d))break}}return q}_intersectUnIndexedTriangles(w,p,e,r,I){let d=null;for(let f=this.verticesStart;f<this.verticesStart+this.verticesCount;f+=3){const e=p[f],q=p[f+1],E=p[f+2];if(I&&!I(e,q,E,w,-1,-1,-1))continue;const j=w.intersectsTriangle(e,q,E);if(j){if(j.distance<0)continue;if((r||!d||j.distance<d.distance)&&(d=j,d.faceId=f/3,r))break}}return d}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(w,p){const e=new E(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,w,p,!1);if(!this.IsGlobal){const w=this.getBoundingInfo();if(!w)return e;e._boundingInfo=new d.b(w.minimum,w.maximum)}return e}dispose(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.iw().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const p=this._mesh.oe.indexOf(this);this._mesh.oe.splice(p,1),this.resetDrawCache(void 0,w)}getClassName(){return"SubMesh"}static CreateFromIndices(w,p,e,r,I){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=Number.MAX_VALUE,q=-Number.MAX_VALUE;const j=(I||r).Ke();for(let E=p;E<p+e;E++){const w=j[E];w<f&&(f=w),w>q&&(q=w)}return new E(w,f,q-f+1,p,e,r,I,d)}}},11752:(w,p,e)=>{var r=e(11370),I=e(11232),d=e(11023),f=e(11081),q=e(11265);r.c.prototype.thinInstanceAdd=function(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.iw().getEngine().getCaps().instancedArrays)return f.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(w)?w.length:1);const e=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(w))for(let r=0;r<w.length;++r)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,w[r],r===w.length-1&&p);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,w,p);return e},r.c.prototype.thinInstanceAddSelf=function(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(d.b.IdentityReadOnly,w)},r.c.prototype.thinInstanceRegisterAttribute=function(w,p){w===I.e.ColorKind&&(w=I.e.ColorInstanceKind),this.removeVerticesData(w),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[w]=p,this._userThinInstanceBuffersStorage.sizes[w]=p*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[w]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[w]),this._userThinInstanceBuffersStorage.vertexBuffers[w]=new I.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[w],w,!0,!1,p,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w])},r.c.prototype.thinInstanceSetMatrixAt=function(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||w>=this._thinInstanceDataStorage.instancesCount)return!1;const r=this._thinInstanceDataStorage.matrixData;return p.copyToArray(r,16*w),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[w]=p),e&&(this.Wk("matrix"),this.bw||this.thinInstanceRefreshBoundingInfo(!1)),!0},r.c.prototype.thinInstanceSetAttributeAt=function(w,p,e){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return w===I.e.ColorKind&&(w=I.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[w]||p>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(w,0),this._userThinInstanceBuffersStorage.data[w].set(e,p*this._userThinInstanceBuffersStorage.strides[w]),r&&this.Wk(w),!0)},Object.defineProperty(r.c.prototype,"xe",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(w){var p;const e=this._thinInstanceDataStorage.matrixData??(null===(p=this.source)||void 0===p?void 0:p._thinInstanceDataStorage.matrixData);w<=(e?e.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=w)},enumerable:!0,configurable:!0}),r.c.prototype._thinInstanceCreateMatrixBuffer=function(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=new I.b(this.getEngine(),p,!e,16,!1,!0);for(let I=0;I<4;I++)this.setVerticesBuffer(r.createVertexBuffer(w+I,4*I,4));return r},r.c.prototype.Lk=function(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var d;if(e=e||16,"matrix"===w)null===(d=this._thinInstanceDataStorage.matrixBuffer)||void 0===d||d.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=p?p.length:32*e,this._thinInstanceDataStorage.matrixData=p,this._thinInstanceDataStorage.worldMatrices=null,null!==p?(this._thinInstanceDataStorage.instancesCount=p.length/e,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",p,r),this.bw||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.bw||this.refreshBoundingInfo());else if("previousMatrix"===w){var f;null===(f=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===f||f.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=p,null!==p&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",p,r))}else{var q;if(w===I.e.ColorKind&&(w=I.e.ColorInstanceKind),null===p)null!==(q=this._userThinInstanceBuffersStorage)&&void 0!==q&&q.data[w]&&(this.removeVerticesData(w),delete this._userThinInstanceBuffersStorage.data[w],delete this._userThinInstanceBuffersStorage.strides[w],delete this._userThinInstanceBuffersStorage.sizes[w],delete this._userThinInstanceBuffersStorage.vertexBuffers[w]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[w]=p,this._userThinInstanceBuffersStorage.strides[w]=e,this._userThinInstanceBuffersStorage.sizes[w]=p.length,this._userThinInstanceBuffersStorage.vertexBuffers[w]=new I.e(this.getEngine(),p,w,!r,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w])}},r.c.prototype.Wk=function(w){var p;if("matrix"===w)this.Zm&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(w),null===(p=this._thinInstanceDataStorage.matrixBuffer)||void 0===p||p.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===w){var e;this.Zm&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(w),null===(e=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===e||e.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var r;w===I.e.ColorKind&&(w=I.e.ColorInstanceKind),null!==(r=this._userThinInstanceBuffersStorage)&&void 0!==r&&r.vertexBuffers[w]&&(this.Zm&&!this._userThinInstanceBuffersStorage.vertexBuffers[w].isUpdatable()&&this._thinInstanceRecreateBuffer(w),this._userThinInstanceBuffersStorage.vertexBuffers[w].updateDirectly(this._userThinInstanceBuffersStorage.data[w],0))}},r.c.prototype.thinInstancePartialBufferUpdate=function(w,p,e){var r;"matrix"===w?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(p,e):(w===I.e.ColorKind&&(w=I.e.ColorInstanceKind),null!==(r=this._userThinInstanceBuffersStorage)&&void 0!==r&&r.vertexBuffers[w]&&this._userThinInstanceBuffersStorage.vertexBuffers[w].updateDirectly(p,e))},r.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const w=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let p=0;p<this._thinInstanceDataStorage.instancesCount;++p)this._thinInstanceDataStorage.worldMatrices[p]=d.b.Ve(w,16*p)}return this._thinInstanceDataStorage.worldMatrices},r.c.prototype.thinInstanceRefreshBoundingInfo=function(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const r=this._thinInstanceDataStorage.boundingVectors;if(w||!this.rawBoundingInfo){r.length=0,this.refreshBoundingInfo(p,e);const w=this.getBoundingInfo();this.rawBoundingInfo=new q.b(w.minimum,w.maximum)}const I=this.getBoundingInfo(),f=this._thinInstanceDataStorage.matrixData;if(0===r.length)for(let d=0;d<I.boundingBox.vectors.length;++d)r.push(I.boundingBox.vectors[d].clone());d.d.ne[0].Pe(Number.POSITIVE_INFINITY),d.d.ne[1].Pe(Number.NEGATIVE_INFINITY);for(let q=0;q<this._thinInstanceDataStorage.instancesCount;++q){d.b.FromArrayToRef(f,16*q,d.d.Matrix[0]);for(let w=0;w<r.length;++w)d.k.TransformCoordinatesToRef(r[w],d.d.Matrix[0],d.d.ne[2]),d.d.ne[0].minimizeInPlace(d.d.ne[2]),d.d.ne[1].maximizeInPlace(d.d.ne[2])}I.reConstruct(d.d.ne[0],d.d.ne[1]),this.hw()},r.c.prototype._thinInstanceRecreateBuffer=function(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var e;if("matrix"===w)null===(e=this._thinInstanceDataStorage.matrixBuffer)||void 0===e||e.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,p);else if("previousMatrix"===w){var r;if(this._scene.needsPreviousWorldMatrices)null===(r=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,p)}else{var d;w===I.e.ColorKind&&(w=I.e.ColorInstanceKind),null===(d=this._userThinInstanceBuffersStorage.vertexBuffers[w])||void 0===d||d.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[w]=new I.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[w],w,!p,!1,this._userThinInstanceBuffersStorage.strides[w],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w])}},r.c.prototype._thinInstanceUpdateBufferSize=function(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;w===I.e.ColorKind&&(w=I.e.ColorInstanceKind);const e="matrix"===w;if(!e&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[w]))return;const r=e?16:this._userThinInstanceBuffersStorage.strides[w],d=e?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[w];let f=e?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[w];const q=(this._thinInstanceDataStorage.instancesCount+p)*r;let E=d;for(;E<q;)E*=2;if(!f||d!=E){if(f){const w=new Float32Array(E);w.set(f,0),f=w}else f=new Float32Array(E);var j,X,k;if(e){if(null===(j=this._thinInstanceDataStorage.matrixBuffer)||void 0===j||j.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",f,!1),this._thinInstanceDataStorage.matrixData=f,this._thinInstanceDataStorage.matrixBufferSize=E,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(X=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===X||X.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",f,!1)}else null===(k=this._userThinInstanceBuffersStorage.vertexBuffers[w])||void 0===k||k.dispose(),this._userThinInstanceBuffersStorage.data[w]=f,this._userThinInstanceBuffersStorage.sizes[w]=E,this._userThinInstanceBuffersStorage.vertexBuffers[w]=new I.e(this.getEngine(),f,w,!0,!1,r,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w])}},r.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},r.c.prototype._disposeThinInstanceSpecificData=function(){var w;null!==(w=this._thinInstanceDataStorage)&&void 0!==w&&w.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11325:(w,p,e)=>{e.d(p,{e:()=>X});var r=e(11207),I=e(11213),d=e(11301),f=e(11056),q=e(11023),E=e(11331),j=e(11038);class X extends E.b{get billboardMode(){return this._billboardMode}set billboardMode(w){this._billboardMode!==w&&(this._billboardMode=w,this._cache.useBillboardPosition=0!==(this._billboardMode&X.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(w){this._infiniteDistance!==w&&(this._infiniteDistance=w)}constructor(w){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new q.k(0,0,1),this._up=new q.k(0,1,0),this._right=new q.k(1,0,0),this._position=q.k.Zero(),this._rotation=q.k.Zero(),this._rotationQuaternion=null,this._scaling=q.k.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=X.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.om=q.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=q.k.Zero(),this._absoluteScaling=q.k.Zero(),this._absoluteRotationQuaternion=q.c.Identity(),this._pivotMatrix=q.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new f.d,this._nonUniformScaling=!1,p&&this.iw().addTransformNode(this)}getClassName(){return"dd"}get position(){return this._position}set position(w){this._position=w,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(w){this._rotation=w,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Ne(){return this._scaling}set Ne(w){this._scaling=w,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(w){this._rotationQuaternion=w,w&&this._rotation.Pe(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return q.k.TransformNormalFromFloatsToRef(0,0,this.iw().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return q.k.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return q.k.TransformNormalFromFloatsToRef(this.iw().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(w){return this._poseMatrix?(this._poseMatrix.X(w),this):(this._poseMatrix=w.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=q.b.Identity()),this._poseMatrix}_isSynchronized(){const w=this._cache;return this._billboardMode===w.billboardMode&&this._billboardMode===X.BILLBOARDMODE_NONE&&(!w.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const w=this._cache;w.localMatrixUpdated=!1,w.billboardMode=-1,w.infiniteDistance=!1,w.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(w){return this.setPivotMatrix(w,!1)}setPivotMatrix(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.X(w),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=p,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=q.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const r=this.clone("Clone of "+(this.name||this.id),w||this.parent,!0);r&&e&&e(this,r);for(const I of this.getChildTransformNodes(!0))I.instantiateHierarchy(r,p,e);return r}XE(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return w?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Pe(0),this._rotationQuaternion=this._rotationQuaternion||q.c.Identity(),w.decompose(this._scaling,this._rotationQuaternion,this._position),this.ke(!0)):(this._worldMatrix=w,this._absolutePosition.te(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.ke(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.ke(!0),this}get im(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.ke(),this._absolutePosition}setAbsolutePosition(w){if(!w)return this;let p,e,r;if(void 0===w.x){if(arguments.length<3)return this;p=arguments[0],e=arguments[1],r=arguments[2]}else p=w.x,e=w.y,r=w.z;if(this.parent){const w=q.d.Matrix[0];this.parent.getWorldMatrix().invertToRef(w),q.k.TransformCoordinatesFromFloatsToRef(p,e,r,w,this.position)}else this.position.x=p,this.position.y=e,this.position.z=r;return this._absolutePosition.X(w),this}setPositionWithLocalVector(w){return this.ke(),this.position=q.k.TransformNormal(w,this.om),this}getPositionExpressedInLocalSpace(){this.ke();const w=q.d.Matrix[0];return this.om.invertToRef(w),q.k.TransformNormal(this.position,w)}locallyTranslate(w){return this.ke(!0),this.position=q.k.TransformCoordinates(w,this.om),this}lookAt(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const d=X._LookAtVectorCache,f=0===I?this.position:this.getAbsolutePosition();if(w.subtractToRef(f,d),this.setDirection(d,p,e,r),1===I&&this.parent)if(this.rotationQuaternion){const w=q.d.Matrix[0];this.rotationQuaternion.toRotationMatrix(w);const p=q.d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(p),p.invert(),w.multiplyToRef(p,w),this.rotationQuaternion.fromRotationMatrix(w)}else{const w=q.d.Quaternion[0];q.c.FromEulerVectorToRef(this.rotation,w);const p=q.d.Matrix[0];w.toRotationMatrix(p);const e=q.d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.invert(),p.multiplyToRef(e,p),w.fromRotationMatrix(p),w.toEulerAnglesToRef(this.rotation)}return this}ej(w){const p=q.k.Zero();return this.getDirectionToRef(w,p),p}getDirectionToRef(w,p){return q.k.TransformNormalToRef(w,this.getWorldMatrix(),p),this}setDirection(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const I=-Math.atan2(w.z,w.x)+Math.PI/2,d=Math.sqrt(w.x*w.x+w.z*w.z),f=-Math.atan2(w.y,d);return this.rotationQuaternion?q.c.RotationYawPitchRollToRef(I+p,f+e,r,this.rotationQuaternion):(this.rotation.x=f+e,this.rotation.y=I+p,this.rotation.z=r),this}setPivotPoint(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.iw().getRenderId()&&this.ke(!0);const e=this.getWorldMatrix();if(1==p){const p=q.d.Matrix[0];e.invertToRef(p),w=q.k.TransformCoordinates(w,p)}return this.setPivotMatrix(q.b.Translation(-w.x,-w.y,-w.z),!0)}getPivotPoint(){const w=q.k.Zero();return this.getPivotPointToRef(w),w}getPivotPointToRef(w){return w.x=-this._pivotMatrix.m[12],w.y=-this._pivotMatrix.m[13],w.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const w=q.k.Zero();return this.getAbsolutePivotPointToRef(w),w}getAbsolutePivotPointToRef(w){return this.getPivotPointToRef(w),q.k.TransformCoordinatesToRef(w,this.getWorldMatrix(),w),this}kX(w){if(this._isDirty)return this;if(this._children)for(const p of this._children)p.kX(w);return super.kX(w)}setParent(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!w&&!this.parent)return this;const r=q.d.Quaternion[0],I=q.d.ne[0],d=q.d.ne[1],f=q.d.Matrix[1];q.b.IdentityToRef(f);const E=q.d.Matrix[0];this.ke(!0);let j=this.rotationQuaternion;return j||(j=X._TmpRotation,q.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,j)),q.b.ComposeToRef(this.Ne,j,this.position,E),this.parent&&E.multiplyToRef(this.parent.ke(!0),E),w&&(w.ke(!0).invertToRef(f),E.multiplyToRef(f,E)),E.decompose(d,r,I,p?this:void 0),this.rotationQuaternion?this.rotationQuaternion.X(r):r.toEulerAnglesToRef(this.rotation),this.Ne.X(d),this.position.X(I),this.parent=w,e&&this.setPivotMatrix(q.b.Identity()),this}addChild(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w.setParent(this,p),this}removeChild(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w.parent!==this||w.setParent(null,p),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(w){return this._nonUniformScaling!==w&&(this._nonUniformScaling=w,!0)}attachToBone(w,p){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=p,this.parent=w,w.getSkeleton().prepare(!0),w.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=w?this._currentParentWhenAttachingToBone:null,this):(w&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(w,p,e){let r;if(w.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Pe(0)),e&&0!==e){if(this.parent){const e=this.parent.getWorldMatrix(),r=q.d.Matrix[0];e.invertToRef(r),w=q.k.TransformNormal(w,r),e.determinant()<0&&(p*=-1)}r=q.c.RotationAxisToRef(w,p,X._RotationAxisCache),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=q.c.RotationAxisToRef(w,p,X._RotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this}rotateAround(w,p,e){p.normalize(),this.rotationQuaternion||(this.rotationQuaternion=q.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Pe(0));const r=q.d.ne[0],I=q.d.ne[1],d=q.d.ne[2],f=q.d.Quaternion[0],E=q.d.Matrix[0],j=q.d.Matrix[1],X=q.d.Matrix[2],k=q.d.Matrix[3];return w.subtractToRef(this.position,r),q.b.TranslationToRef(r.x,r.y,r.z,E),q.b.TranslationToRef(-r.x,-r.y,-r.z,j),q.b.RotationAxisToRef(p,e,X),j.multiplyToRef(X,k),k.multiplyToRef(E,k),k.decompose(I,f,d),this.position.addInPlace(d),f.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(w,p,e){const r=w.scale(p);if(e&&0!==e)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{const w=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(w)}return this}addRotation(w,p,e){let r;this.rotationQuaternion?r=this.rotationQuaternion:(r=q.d.Quaternion[1],q.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));const I=q.d.Quaternion[0];return q.c.RotationYawPitchRollToRef(p,w,e,I),r.multiplyInPlace(I),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==X.BILLBOARDMODE_NONE}ke(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const e=this.iw().getRenderId();if(!this._isDirty&&!w&&(this._currentRenderId===e||this.isSynchronized()))return this._currentRenderId=e,this._worldMatrix;p=p||this.iw().activeCamera,this._updateCache();const r=this._cache;r.pivotMatrixUpdated=!1,r.billboardMode=this.billboardMode,r.infiniteDistance=this.infiniteDistance,r.parent=this._parentNode,this._currentRenderId=e,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const I=this._getEffectiveParent(),d=X._TmpScaling;let f,E=this._position;if(this._infiniteDistance&&!this.parent&&p){const w=p.getWorldMatrix(),e=new q.k(w.m[12],w.m[13],w.m[14]);E=X._TmpTranslation,E.te(this._position.x+e.x,this._position.y+e.y,this._position.z+e.z)}if(d.te(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,f=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(q.c.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.te(0,0,0))}}else f=X._TmpRotation,q.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,f);if(this._usePivotMatrix){const w=q.d.Matrix[1];q.b.ScalingToRef(d.x,d.y,d.z,w);const p=q.d.Matrix[0];f.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(w,q.d.Matrix[4]),q.d.Matrix[4].multiplyToRef(p,this.om),this._postMultiplyPivotMatrix&&this.om.multiplyToRef(this._pivotMatrixInverse,this.om),this.om.addTranslationFromFloats(E.x,E.y,E.z)}else q.b.ComposeToRef(d,f,E,this.om);if(I&&I.getWorldMatrix){if(w&&I.ke(w),this.billboardMode){if(this._transformToBoneReferal){const w=this.parent;w.getSkeleton().prepare(),w.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),q.d.Matrix[7])}else q.d.Matrix[7].X(I.getWorldMatrix());const w=q.d.ne[5],p=q.d.ne[6],e=q.d.Quaternion[0];q.d.Matrix[7].decompose(p,e,w),q.b.ScalingToRef(p.x,p.y,p.z,q.d.Matrix[7]),q.d.Matrix[7].setTranslation(w),X.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(e,w),this.om.setTranslation(w)),this.om.multiplyToRef(q.d.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const w=this.parent;w.getSkeleton().prepare(),this.om.multiplyToRef(w.getFinalMatrix(),q.d.Matrix[6]),q.d.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.om.multiplyToRef(I.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.X(this.om);if(p&&this.billboardMode)if(r.useBillboardPosition){if(r.useBillboardPosition){const w=q.d.ne[0];this._worldMatrix.getTranslationToRef(w);const e=p.globalPosition;this._worldMatrix.invertToRef(q.d.Matrix[1]);const r=q.d.ne[1];q.k.TransformCoordinatesToRef(e,q.d.Matrix[1],r),r.normalize();const I=-Math.atan2(r.z,r.x)+Math.PI/2,d=Math.sqrt(r.x*r.x+r.z*r.z),f=-Math.atan2(r.y,d);if(q.c.RotationYawPitchRollToRef(I,f,0,q.d.Quaternion[0]),(this.billboardMode&X.BILLBOARDMODE_ALL)!==X.BILLBOARDMODE_ALL){const w=q.d.ne[1];q.d.Quaternion[0].toEulerAnglesToRef(w),(this.billboardMode&X.BILLBOARDMODE_X)!==X.BILLBOARDMODE_X&&(w.x=0),(this.billboardMode&X.BILLBOARDMODE_Y)!==X.BILLBOARDMODE_Y&&(w.y=0),(this.billboardMode&X.BILLBOARDMODE_Z)!==X.BILLBOARDMODE_Z&&(w.z=0),q.b.RotationYawPitchRollToRef(w.y,w.x,w.z,q.d.Matrix[0])}else q.b.FromQuaternionToRef(q.d.Quaternion[0],q.d.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(q.d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(q.d.ne[0])}}else{const w=q.d.ne[0];if(this._worldMatrix.getTranslationToRef(w),q.d.Matrix[1].X(p.getViewMatrix()),q.d.Matrix[1].setTranslationFromFloats(0,0,0),q.d.Matrix[1].invertToRef(q.d.Matrix[0]),(this.billboardMode&X.BILLBOARDMODE_ALL)!==X.BILLBOARDMODE_ALL){q.d.Matrix[0].decompose(void 0,q.d.Quaternion[0],void 0);const w=q.d.ne[1];q.d.Quaternion[0].toEulerAnglesToRef(w),(this.billboardMode&X.BILLBOARDMODE_X)!==X.BILLBOARDMODE_X&&(w.x=0),(this.billboardMode&X.BILLBOARDMODE_Y)!==X.BILLBOARDMODE_Y&&(w.y=0),(this.billboardMode&X.BILLBOARDMODE_Z)!==X.BILLBOARDMODE_Z&&(w.z=0),q.b.RotationYawPitchRollToRef(w.y,w.x,w.z,q.d.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(q.d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(q.d.ne[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):I&&I._nonUniformScaling?this._updateNonUniformScalingState(I._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.te(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=q.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.ke(),w){const w=this.getChildren();for(let p=0;p<w.length;++p){const e=w[p];if(e){e.ke();const w=q.d.Matrix[0];e.om.multiplyToRef(this.om,w);const p=q.d.Quaternion[0];w.decompose(e.Ne,p,e.position),e.rotationQuaternion?e.rotationQuaternion.X(p):p.toEulerAnglesToRef(e.rotation)}}}this.Ne.te(1,1,1),this.position.te(0,0,0),this.rotation.te(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=q.c.Identity()),this._worldMatrix=q.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(w){return this.onAfterWorldMatrixUpdateObservable.add(w),this}unregisterAfterWorldMatrixUpdate(w){return this.onAfterWorldMatrixUpdateObservable.removeCallback(w),this}getPositionInCameraSpace(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return w||(w=this.iw().activeCamera),q.k.TransformCoordinates(this.getAbsolutePosition(),w.getViewMatrix())}getDistanceToCamera(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return w||(w=this.iw().activeCamera),this.getAbsolutePosition().Je(w.globalPosition).length()}clone(w,p,e){const r=d.e.Clone((()=>new X(w,this.iw())),this);if(r.name=w,r.id=w,p&&(r.parent=p),!e){const p=this.getDescendants(!0);for(let e=0;e<p.length;e++){const I=p[e];I.clone&&I.clone(w+"."+I.name,r)}}return r}serialize(w){const p=d.e.Serialize(this,w);return p.type=this.getClassName(),p.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(p),p.localMatrix=this.getPivotMatrix().ze(),p.isEnabled=this.isEnabled(),d.e.AppendSerializedAnimations(this,p),p.ranges=this.serializeAnimationRanges(),p}static Parse(w,p,e){const r=d.e.Parse((()=>new X(w.name,p)),w,p,e);if(w.localMatrix?r.setPreTransformMatrix(q.b.Ve(w.localMatrix)):w.pivotMatrix&&r.setPivotMatrix(q.b.Ve(w.pivotMatrix)),r.yE(w.isEnabled),r._waitingParsedUniqueId=w.uniqueId,void 0!==w.parentId&&(r._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(r._waitingParentInstanceIndex=w.parentInstanceIndex),w.animations){for(let p=0;p<w.animations.length;p++){const e=w.animations[p],I=(0,j.c)("BABYLON.Animation");I&&r.animations.push(I.Parse(e))}E.b.ParseAnimationRanges(r,w,p)}return w.autoAnimate&&p.beginAnimation(r,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),r}getChildTransformNodes(w,p){const e=[];return this._getDescendants(e,w,(w=>(!p||p(w))&&w instanceof X)),e}dispose(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.iw().stopAnimation(this),this.iw().removeTransformNode(this),this._parentContainer){const w=this._parentContainer.transformNodes.indexOf(this);w>-1&&this._parentContainer.transformNodes.splice(w,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),w){const w=this.getChildTransformNodes(!0);for(const p of w)p.parent=null,p.ke(!0)}super.dispose(w,p)}normalizeToUnitCube(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,r=null,I=null;p&&(this.rotationQuaternion?(I=this.rotationQuaternion.clone(),this.rotationQuaternion.te(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.te(0,0,0)));const d=this.getHierarchyBoundingVectors(w,e),f=d.max.Je(d.min),q=Math.max(f.x,f.y,f.z);if(0===q)return this;const E=1/q;return this.Ne.scaleInPlace(E),p&&(this.rotationQuaternion&&I?this.rotationQuaternion.X(I):this.rotation&&r&&this.rotation.X(r)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}X.BILLBOARDMODE_NONE=0,X.BILLBOARDMODE_X=1,X.BILLBOARDMODE_Y=2,X.BILLBOARDMODE_Z=4,X.BILLBOARDMODE_ALL=7,X.BILLBOARDMODE_USE_POSITION=128,X.BillboardUseParentOrientation=!1,X._TmpRotation=q.c.Zero(),X._TmpScaling=q.k.Zero(),X._TmpTranslation=q.k.Zero(),X._LookAtVectorCache=new q.k(0,0,0),X._RotationAxisCache=new q.c,(0,r.c)([(0,I.G)("position")],X.prototype,"_position",void 0),(0,r.c)([(0,I.G)("rotation")],X.prototype,"_rotation",void 0),(0,r.c)([(0,I.z)("rotationQuaternion")],X.prototype,"_rotationQuaternion",void 0),(0,r.c)([(0,I.G)("Ne")],X.prototype,"_scaling",void 0),(0,r.c)([(0,I.J)("billboardMode")],X.prototype,"_billboardMode",void 0),(0,r.c)([(0,I.J)()],X.prototype,"scalingDeterminant",void 0),(0,r.c)([(0,I.J)("infiniteDistance")],X.prototype,"_infiniteDistance",void 0),(0,r.c)([(0,I.J)()],X.prototype,"ignoreNonUniformScaling",void 0),(0,r.c)([(0,I.J)()],X.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11690:(w,p,e)=>{e.d(p,{b:()=>j});var r=e(11023),I=e(11063),d=e(11475),f=e(11027),q=e(11308);class E{constructor(w,p,e,r){this.name=w,this.worldAxisForNormal=p,this.worldAxisForFileX=e,this.worldAxisForFileY=r}}class j{static ConvertCubeMapTextureToSphericalPolynomial(w){var p;if(!w.isCube)return null;null===(p=w.iw())||void 0===p||p.getEngine().flushFramebuffer();const e=w.getSize().width,r=w.readPixels(0,void 0,void 0,!1),I=w.readPixels(1,void 0,void 0,!1);let d,f;w.isRenderTarget?(d=w.readPixels(3,void 0,void 0,!1),f=w.readPixels(2,void 0,void 0,!1)):(d=w.readPixels(2,void 0,void 0,!1),f=w.readPixels(3,void 0,void 0,!1));const q=w.readPixels(4,void 0,void 0,!1),E=w.readPixels(5,void 0,void 0,!1),j=w.gammaSpace;let X=0;return 1!=w.textureType&&2!=w.textureType||(X=1),new Promise((w=>{Promise.all([I,r,d,f,q,E]).then((p=>{let[r,I,d,f,q,E]=p;const k={size:e,right:I,left:r,up:d,down:f,front:q,back:E,format:5,type:X,gammaSpace:j};w(this.ConvertCubeMapToSphericalPolynomial(k))}))}))}static _AreaElement(w,p){return Math.atan2(w*p,Math.sqrt(w*w+p*p+1))}static ConvertCubeMapToSphericalPolynomial(w){const p=new d.d;let e=0;const r=2/w.size,E=r,j=.5*r,X=j-1;for(let d=0;d<6;d++){const k=this._FileFaces[d],m=w[k.name];let J=X;const K=5===w.format?4:3;for(let d=0;d<w.size;d++){let y=X;for(let E=0;E<w.size;E++){const X=k.worldAxisForFileX.scale(y).add(k.worldAxisForFileY.scale(J)).add(k.worldAxisForNormal);X.normalize();const c=this._AreaElement(y-j,J-j)-this._AreaElement(y-j,J+j)-this._AreaElement(y+j,J-j)+this._AreaElement(y+j,J+j);let s=m[d*w.size*K+E*K+0],O=m[d*w.size*K+E*K+1],a=m[d*w.size*K+E*K+2];isNaN(s)&&(s=0),isNaN(O)&&(O=0),isNaN(a)&&(a=0),0===w.type&&(s/=255,O/=255,a/=255),w.gammaSpace&&(s=Math.pow((0,I.Clamp)(s),f.k),O=Math.pow((0,I.Clamp)(O),f.k),a=Math.pow((0,I.Clamp)(a),f.k));const A=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const w=Math.max(s,O,a);if(w>A){const p=A/w;s*=p,O*=p,a*=p}}else s=(0,I.Clamp)(s,0,A),O=(0,I.Clamp)(O,0,A),a=(0,I.Clamp)(a,0,A);const z=new q.b(s,O,a);p.addLight(X,z,c),e+=c,y+=r}J+=E}}const k=6*(4*Math.PI)/6/e;return p.scaleInPlace(k),p.convertIncidentRadianceToIrradiance(),p.convertIrradianceToLambertianRadiance(),d.h.FromHarmonics(p)}}j._FileFaces=[new E("right",new r.k(1,0,0),new r.k(0,0,-1),new r.k(0,-1,0)),new E("left",new r.k(-1,0,0),new r.k(0,0,1),new r.k(0,-1,0)),new E("up",new r.k(0,1,0),new r.k(1,0,0),new r.k(0,0,1)),new E("down",new r.k(0,-1,0),new r.k(1,0,0),new r.k(0,0,-1)),new E("front",new r.k(0,0,1),new r.k(1,0,0),new r.k(0,-1,0)),new E("back",new r.k(0,0,-1),new r.k(-1,0,0),new r.k(0,-1,0))],j.MAX_HDRI_VALUE=4096,j.PRESERVE_CLAMPED_COLORS=!1},11030:(w,p,e)=>{function r(w,p){const e=[];for(let r=0;r<w;++r)e.push(p());return e}function I(w,p){return r(w,p)}e.d(p,{d:()=>r,e:()=>I,i:()=>f});const d=["push","splice","pop","shift","unshift"];function f(w,p){const e=d.map((e=>function(w,p,e){const r=w[p];if("function"!==typeof r)return null;const I=function(){const r=w.length,d=I.previous.apply(w,arguments);return e(p,r),d};return r.next=I,I.previous=r,w[p]=I,()=>{const e=I.previous;if(!e)return;const r=I.next;r?(e.next=r,r.previous=e):(e.next=void 0,w[p]=e),I.next=void 0,I.previous=void 0}}(w,e,p)));return()=>{for(const w of e)null===w||void 0===w||w()}}},11573:(w,p,e)=>{e.d(p,{e:()=>f});var r=e(11511),I=e(11577);let d=0;const f=w=>{if(!w.environmentBRDFTexture){const p=w.useDelayedTextureLoading;w.useDelayedTextureLoading=!1;const e=w._blockEntityCollection;w._blockEntityCollection=!1;const f=r.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+d++,w,!0,!1,r.e.BILINEAR_SAMPLINGMODE);w._blockEntityCollection=e;const q=w.getEngine().getLoadedTexturesCache(),E=q.indexOf(f.getInternalTexture());-1!==E&&q.splice(E,1),f.isRGBD=!0,f.wrapU=r.e.CLAMP_ADDRESSMODE,f.wrapV=r.e.CLAMP_ADDRESSMODE,w.environmentBRDFTexture=f,w.useDelayedTextureLoading=p,I.b.ExpandRGBDTexture(f);const j=w.getEngine().onContextRestoredObservable.add((()=>{f.isRGBD=!0;const p=w.onBeforeRenderObservable.add((()=>{f.isReady()&&(w.onBeforeRenderObservable.remove(p),I.b.ExpandRGBDTexture(f))}))}));w.ue.add((()=>{w.getEngine().onContextRestoredObservable.remove(j)}))}return w.environmentBRDFTexture}},11346:(w,p,e)=>{function r(w,p,e){try{const r=w.next();r.done?p(r):r.value?r.value.then((()=>{r.value=void 0,p(r)}),e):p(r)}catch(r){e(r)}}function I(){let w,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(e,I,d)=>{const f=performance.now();void 0===w||f-w>p?(w=f,setTimeout((()=>{r(e,I,d)}),0)):r(e,I,d)}}function d(w,p,e,r,I){const d=()=>{let f;const q=w=>{w.done?e(w.value):void 0===f?f=!0:d()};do{f=void 0,I&&I.aborted?r(new Error("Aborted")):p(w,q,r),void 0===f&&(f=!1)}while(f)};d()}function f(w,p){let e;return d(w,r,(w=>e=w),(w=>{throw w}),p),e}async function q(w,p,e){return await new Promise(((r,I)=>{d(w,p,r,I,e)}))}function E(w,p){return function(){return f(w(...arguments),p)}}e.d(p,{e:()=>I,f:()=>E,j:()=>q,n:()=>f})},11220:(w,p,e)=>{e.d(p,{e:()=>d,i:()=>f});const r={},I={};function d(w){const p=w.getClassName();return I[p]||(I[p]={}),I[p]}function f(w){const p=w.getClassName();if(r[p])return r[p];r[p]={};const e=r[p];let d=w,f=p;for(;f;){const w=I[f];for(const I in w)e[I]=w[I];let p,r=!1;do{if(p=Object.getPrototypeOf(d),!p.getClassName){r=!0;break}if(p.getClassName()!==f)break;d=p}while(p);if(r)break;f=p.getClassName(),d=p}return e}},11213:(w,p,e)=>{e.d(p,{C:()=>q,E:()=>X,G:()=>k,J:()=>f,e:()=>d,f:()=>O,i:()=>J,j:()=>E,k:()=>K,l:()=>j,p:()=>y,t:()=>s,v:()=>m,z:()=>c});var r=e(11220);function I(w,p){return(e,I)=>{const d=(0,r.e)(e);d[I]||(d[I]={type:w,sourceName:p})}}function d(w){return function(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e,r)=>{const I=p||"_"+r;Object.defineProperty(e,r,{get:function(){return this[I]},set:function(p){var r;"function"===typeof(null===(r=this[I])||void 0===r?void 0:r.equals)&&this[I].equals(p)||this[I]!==p&&(this[I]=p,e[w].apply(this))},enumerable:!0,configurable:!0})}}(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function f(w){return I(0,w)}function q(w){return I(1,w)}function E(w){return I(2,w)}function j(w){return I(3,w)}function X(w){return I(4,w)}function k(w){return I(5,w)}function m(w){return I(6,w)}function J(w){return I(7,w)}function K(w){return I(8,w)}function y(w){return I(9,w)}function c(w){return I(10,w)}function s(w){return I(12,w)}function O(w,p,e,r){const I=e.value;e.value=function(){let e=I;if("undefined"!==typeof _native&&_native[p]){const w=_native[p];e=r?function(){return r(...arguments)?w(...arguments):I(...arguments)}:w}return w[p]=e,e(...arguments)}}O.filter=function(w){return(p,e,r)=>O(p,e,r,w)}},11301:(w,p,e)=>{e.d(p,{e:()=>j});var r=e(11094),I=e(11304),d=e(11308),f=e(11023),q=e(11220);const E=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const d=w();I.b&&I.b.HasTags(p)&&I.b.AddTagsTo(d,I.b.GetTags(p,!0));const f=(0,q.i)(d),E={};for(const I in f){const w=f[I],q=p[I],X=w.type;if(void 0!==q&&null!==q&&("uniqueId"!==I||j.AllowLoadingUniqueId))switch(X){case 0:case 6:case 9:case 11:d[I]=q;break;case 1:r.cloneTexturesOnlyOnce&&E[q.uniqueId]?d[I]=E[q.uniqueId]:(d[I]=e||q.isRenderTarget?q:q.clone(),E[q.uniqueId]=d[I]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:d[I]=e?q:q.clone()}}return d};class j{static AppendSerializedAnimations(w,p){if(w.animations){p.animations=[];for(let e=0;e<w.animations.length;e++){const r=w.animations[e];p.animations.push(r.serialize())}}}static Serialize(w,p){p||(p={}),I.b&&(p.tags=I.b.GetTags(w));const e=(0,q.i)(w);for(const r in e){const I=e[r],d=I.sourceName||r,f=I.type,q=w[r];if(void 0!==q&&null!==q&&("uniqueId"!==r||j.AllowLoadingUniqueId))switch(f){case 0:p[d]=q;break;case 1:case 3:case 7:case 9:p[d]=q.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:p[d]=q.ze();break;case 6:case 11:p[d]=q.id}}return p}static ParseProperties(w,p,e,r){r||(r="");const I=(0,q.i)(p);for(const q in I){const E=I[q],X=w[E.sourceName||q],k=E.type;if(void 0!==X&&null!==X&&("uniqueId"!==q||j.AllowLoadingUniqueId)){const w=p;switch(k){case 0:w[q]=X;break;case 1:e&&(w[q]=j._TextureParser(X,e,r));break;case 2:w[q]=d.b.Ve(X);break;case 3:w[q]=j._FresnelParametersParser(X);break;case 4:w[q]=f.g.Ve(X);break;case 5:w[q]=f.k.Ve(X);break;case 6:e&&(w[q]=e.getLastMeshById(X));break;case 7:w[q]=j._ColorCurvesParser(X);break;case 8:w[q]=d.e.Ve(X);break;case 9:w[q]=j._ImageProcessingConfigurationParser(X);break;case 10:w[q]=f.c.Ve(X);break;case 11:e&&(w[q]=e.getCameraById(X));break;case 12:w[q]=f.b.Ve(X)}}}}static Parse(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=w();return I.b&&I.b.AddTagsTo(d,p.tags),j.ParseProperties(p,d,e,r),d}static Clone(w,p){return E(w,p,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(w,p){return E(w,p,!0)}}j.AllowLoadingUniqueId=!1,j._ImageProcessingConfigurationParser=w=>{throw(0,r.c)("ImageProcessingConfiguration")},j._FresnelParametersParser=w=>{throw(0,r.c)("FresnelParameters")},j._ColorCurvesParser=w=>{throw(0,r.c)("ColorCurves")},j._TextureParser=(w,p,e)=>{throw(0,r.c)("Texture")}},11086:(w,p,e)=>{e.d(p,{d:()=>d});var r=e(11081);const I=(w,p,e)=>w?w.getClassName&&"Mesh"===w.getClassName()?null:!w.getClassName||"SubMesh"!==w.getClassName()&&"PhysicsBody"!==w.getClassName()?w.clone?w.clone():Array.isArray(w)?w.slice():e&&"object"===typeof w?{...w}:null:w.clone(p):null;class d{static DeepCopy(w,p,e,d){let f=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const q=function(w){const p=[];do{const e=Object.getOwnPropertyNames(w);for(const w of e)-1===p.indexOf(w)&&p.push(w)}while(w=Object.getPrototypeOf(w));return p}(w);for(const j of q){if("_"===j[0]&&(!d||-1===d.indexOf(j)))continue;if(j.endsWith("Observable"))continue;if(e&&-1!==e.indexOf(j))continue;const q=w[j],X=typeof q;if("function"!==X)try{if("object"===X)if(q instanceof Uint8Array)p[j]=Uint8Array.from(q);else if(q instanceof Array){if(p[j]=[],q.length>0)if("object"==typeof q[0])for(let w=0;w<q.length;w++){const e=I(q[w],p,f);-1===p[j].indexOf(e)&&p[j].push(e)}else p[j]=q.slice(0)}else p[j]=I(q,p,f);else p[j]=q}catch(E){r.c.Warn(E.message)}}}}},11778:(w,p,e)=>{function r(){const w=w=>!!w&&"object"===typeof w;for(var p=arguments.length,e=new Array(p),I=0;I<p;I++)e[I]=arguments[I];return e.reduce(((p,e)=>{const I=Object.keys(e);for(const d of I){const I=p[d],f=e[d];Array.isArray(I)&&Array.isArray(f)?p[d]=I.concat(...f):w(I)&&w(f)?p[d]=r(I,f):p[d]=f}return p}),{})}e.d(p,{c:()=>r})},11094:(w,p,e)=>{e.d(p,{c:()=>I});const r={};function I(w){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!r[w])return r[w]=!0,`${w} needs to be imported before as it contains a side-effect required by your code.`}},11075:(w,p,e)=>{function r(){return"undefined"!==typeof window}function I(){return"undefined"!==typeof navigator}function d(){return"undefined"!==typeof document}function f(w){let p="",e=w.firstChild;for(;e;)3===e.nodeType&&(p+=e.textContent),e=e.nextSibling;return p}e.d(p,{c:()=>f,f:()=>d,h:()=>I,i:()=>r})},11555:(w,p,e)=>{e.r(p),e.d(p,{Dispose:()=>m,DumpData:()=>k,DumpDataAsync:()=>X,DumpFramebuffer:()=>j,DumpTools:()=>J});var r=e(11537),I=e(11071),d=e(11063),f=e(11051);let q,E=null;async function j(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;const q=await e.readPixels(0,0,w,p);k(w,p,new Uint8Array(q.buffer),r,I,d,!0,void 0,f)}async function X(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7?arguments[7]:void 0;return await new Promise((E=>{k(w,p,e,(w=>E(w)),r,I,d,f,q)}))}function k(w,p,j,X){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return E||(E=new Promise(((w,p)=>{let I,d=null;const E={bX:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(e.bind(e,11416)).then((j=>{let{ThinEngine:X}=j;const k=f.d.Instances.length;try{I=new OffscreenCanvas(100,100),d=new X(I,!1,E)}catch(y){var J;k<f.d.Instances.length&&(null===(J=f.d.Instances.pop())||void 0===J||J.dispose()),I=document.createElement("canvas"),d=new X(I,!1,E)}f.d.Instances.pop(),f.d.OnEnginesDisposedObservable.add((w=>{d&&w!==d&&!d.K&&0===f.d.Instances.length&&m()})),d.getCaps().parallelShaderCompile=void 0;const K=new r.e(d);e.e(37).then(e.bind(e,13688)).then((e=>{let{passPixelShader:f}=e;if(!d)return void p("Engine is not defined");const E=new r.g({wE:d,name:f.name,fragmentShader:f.shader,samplerNames:["textureSampler"]});q={canvas:I,wE:d,renderer:K,wrapper:E},w(q)}))})).catch(p)}))),await E})().then((e=>{if(e.wE.setSize(w,p,!0),j instanceof Float32Array){const w=new Uint8Array(j.length);let p=j.length;for(;p--;){const e=j[p];w[p]=Math.round(255*(0,d.Clamp)(e))}j=w}const r=e.wE.createRawTexture(j,w,p,5,!1,!K,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",r),e.renderer.draw(),y?I.g.ToBlob(e.canvas,(w=>{const p=new FileReader;p.onload=w=>{const p=w.target.result;X&&X(p)},p.readAsArrayBuffer(w)}),k,c):I.g.EncodeScreenshotCanvasData(e.canvas,X,k,J,c),r.dispose()}))}function m(){var w;q?(q.wrapper.dispose(),q.renderer.dispose(),q.wE.dispose()):null===(w=E)||void 0===w||w.then((w=>{w.wrapper.dispose(),w.renderer.dispose(),w.wE.dispose()}));E=null,q=null}const J={DumpData:k,DumpDataAsync:X,DumpFramebuffer:j,Dispose:m};I.g.DumpData=k,I.g.DumpDataAsync=X,I.g.DumpFramebuffer=j},11113:(w,p,e)=>{e.d(p,{e:()=>r,i:()=>I,l:()=>d});class r extends Error{}r._setPrototypeOf=Object.setPrototypeOf||((w,p)=>(w.__proto__=p,w));const I={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class d extends r{constructor(w,p,e){super(w),this.errorCode=p,this.innerError=e,this.name="RuntimeError",r._setPrototypeOf(this,d.prototype)}}},11107:(w,p,e)=>{e.d(p,{d:()=>R,f:()=>a,j:()=>l,n:()=>U,s:()=>t,q:()=>c,u:()=>M,x:()=>i,B:()=>n,F:()=>A});var r=e(11099),I=e(11075),d=e(11056);class f{}f.FilesToLoad={};var q=e(11113),E=e(11116),j=e(11118),X=e(11051),k=e(11081),m=e(11127),J=e(11120),K=e(11132);const y=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class c extends q.l{constructor(w,p){super(w,q.i.LoadFileError),this.name="LoadFileError",q.e._setPrototypeOf(this,c.prototype),p instanceof r.b?this.request=p:this.file=p}}class s extends q.l{constructor(w,p){super(w,q.i.RequestFileError),this.request=p,this.name="RequestFileError",q.e._setPrototypeOf(this,s.prototype)}}class O extends q.l{constructor(w,p){super(w,q.i.ReadFileError),this.file=p,this.name="ReadFileError",q.e._setPrototypeOf(this,O.prototype)}}const a={DefaultRetryStrategy:class{static ExponentialBackoff(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(e,r,I)=>0!==r.status||I>=w||-1!==e.indexOf("file:")?-1:Math.pow(2,I)*p}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:w=>w,ScriptBaseUrl:"",ScriptPreprocessUrl:w=>w,CleanUrl:w=>w=w.replace(/#/gm,"%23")},A=(w,p)=>{if((!w||0!==w.indexOf("data:"))&&a.CorsBehavior)if("string"===typeof a.CorsBehavior||a.CorsBehavior instanceof String)p.crossOrigin=a.CorsBehavior;else{const e=a.CorsBehavior(w);e&&(p.crossOrigin=e)}},z={getRequiredSize:null},M=function(w,p,e,I){let d,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",j=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:X.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===k||void 0===k||!k._features.forceBitmapOverHTMLImageElement))return e("LoadImage is only supported in web or BabylonNative environments."),null;let m=!1;w instanceof ArrayBuffer||ArrayBuffer.isView(w)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(d=URL.createObjectURL(new Blob([w],{type:q})),m=!0):d=`data:${q};base64,`+(0,E.m)(w):w instanceof Blob?(d=URL.createObjectURL(w),m=!0):(d=a.CleanUrl(w),d=a.PreprocessUrl(d));const J=p=>{if(e){const r=d||w.toString();e(`Error while trying to load image: ${0===r.indexOf("http")||r.length<=128?r:r.slice(0,128)+"..."}`,p)}};if(null!==k&&void 0!==k&&k._features.forceBitmapOverHTMLImageElement)return t(d,(r=>{k.createImageBitmap(new Blob([r],{type:q}),{premultiplyAlpha:"none",...j}).then((w=>{p(w),m&&URL.revokeObjectURL(d)})).catch((p=>{e&&e("Error while trying to load image: "+w,p)}))}),void 0,I||void 0,!0,((w,p)=>{J(p)})),null;const K=new Image;if(z.getRequiredSize){const p=z.getRequiredSize(w);p.width&&(K.width=p.width),p.height&&(K.height=p.height)}A(d,K);const y=[],c=()=>{for(const w of y)w.target.removeEventListener(w.name,w.handler);y.length=0};y.push({target:K,name:"load",handler:()=>{c(),p(K),m&&K.src&&URL.revokeObjectURL(K.src)}}),y.push({target:K,name:"error",handler:w=>{c(),J(w),m&&K.src&&URL.revokeObjectURL(K.src)}}),y.push({target:document,name:"securitypolicyviolation",handler:w=>{if(w.blockedURI!==K.src||"iy"===w.disposition)return;c();const p=new Error(`CSP violation of policy ${w.effectiveDirective} ${w.blockedURI}. Current policy is ${w.originalPolicy}`);X.d.UseFallbackTexture=!1,J(p),m&&K.src&&URL.revokeObjectURL(K.src),K.src=""}}),(()=>{for(const w of y)w.target.addEventListener(w.name,w.handler)})();const s="blob:"===d.substring(0,5),O="data:"===d.substring(0,5),M=()=>{s||O||!r.b.IsCustomRequestAvailable?K.src=d:t(d,((w,p,e)=>{const r=new Blob([w],{type:!q&&e?e:q}),I=URL.createObjectURL(r);m=!0,K.src=I}),void 0,I||void 0,!0,((w,p)=>{J(p)}))},i=()=>{I&&I.loadImage(d,K)};if(!s&&!O&&I&&I.enableTexturesOffline)I.open(i,M);else{if(-1!==d.indexOf("file:")){const w=decodeURIComponent(d.substring(5).toLowerCase());if(f.FilesToLoad[w]&&"undefined"!==typeof URL){try{let p;try{p=URL.createObjectURL(f.FilesToLoad[w])}catch(n){p=URL.createObjectURL(f.FilesToLoad[w])}K.src=p,m=!0}catch(l){K.src=""}return K}}M()}return K},i=(w,p,e,r,I)=>{const f=new FileReader,q={onCompleteObservable:new d.d,abort:()=>f.abort()};return f.onloadend=()=>q.onCompleteObservable.notifyObservers(q),I&&(f.onerror=()=>{I(new O(`Unable to read ${w.name}`,w))}),f.onload=w=>{p(w.target.result)},e&&(f.onprogress=e),r?f.readAsArrayBuffer(w):f.readAsText(w),q},t=(w,p,e,r,I,E,j)=>{if(w.name)return i(w,p,e,I,E?w=>{E(void 0,w)}:void 0);const X=w;if(-1!==X.indexOf("file:")){let w=decodeURIComponent(X.substring(5).toLowerCase());0===w.indexOf("./")&&(w=w.substring(2));const r=f.FilesToLoad[w];if(r)return i(r,p,e,I,E?w=>E(void 0,new c(w.message,w.file)):void 0)}const{match:J,type:K}=v(X);if(J){const w={onCompleteObservable:new d.d,abort:()=>()=>{}};try{const w=I?R(X):V(X);p(w,void 0,K)}catch(q){E?E(void 0,q):k.c.Error(q.message||"Failed to parse the Data URL")}return m.c.SetImmediate((()=>{w.onCompleteObservable.notifyObservers(w)})),w}return n(X,((w,e)=>{p(w,null===e||void 0===e?void 0:e.responseURL,null===e||void 0===e?void 0:e.getResponseHeader("content-type"))}),e,r,I,E?w=>{E(w.request,new c(w.message,w.request))}:void 0,j)},n=(w,p,e,f,q,E,j)=>{w=a.CleanUrl(w),w=a.PreprocessUrl(w);const X=a.BaseUrl+w;let m=!1;const J={onCompleteObservable:new d.d,abort:()=>m=!0},K=()=>{let w,d=new r.b,f=null;const K=()=>{d&&(e&&d.removeEventListener("progress",e),w&&d.removeEventListener("readystatechange",w),d.removeEventListener("loadend",y))};let y=()=>{K(),J.onCompleteObservable.notifyObservers(J),J.onCompleteObservable.clear(),e=void 0,w=null,y=null,E=void 0,j=void 0,p=void 0};J.abort=()=>{m=!0,y&&y(),d&&d.readyState!==(XMLHttpRequest.DONE||4)&&d.abort(),null!==f&&(clearTimeout(f),f=null),d=null};const c=w=>{const p=w.message||"Unknown error";E&&d?E(new s(p,d)):k.c.Error(p)},O=k=>{if(d){if(d.open("GET",X),j)try{j(d)}catch(J){return void c(J)}q&&(d.responseType="arraybuffer"),e&&d.addEventListener("progress",e),y&&d.addEventListener("loadend",y),w=()=>{if(!m&&d&&d.readyState===(XMLHttpRequest.DONE||4)){if(w&&d.removeEventListener("readystatechange",w),d.status>=200&&d.status<300||0===d.status&&(!(0,I.i)()||N())){const w=q?d.response:d.responseText;if(null!==w){try{p&&p(w,d)}catch(J){c(J)}return}}const e=a.DefaultRetryStrategy;if(e){const w=e(X,d,k);if(-1!==w)return K(),d=new r.b,void(f=setTimeout((()=>O(k+1)),w))}const j=new s("Error status: "+d.status+" "+d.statusText+" - Unable to load "+X,d);E&&E(j)}},d.addEventListener("readystatechange",w),d.send()}};O(0)};if(f&&f.enableSceneOffline){const r=w=>{w&&w.status>400?E&&E(w):K()},I=()=>{f&&f.loadFile(a.BaseUrl+w,(w=>{!m&&p&&p(w),J.onCompleteObservable.notifyObservers(J)}),e?w=>{!m&&e&&e(w)}:void 0,r,q)};f.open(I,r)}else K();return J},l=w=>{const{match:p,type:e}=v(w);if(p)return e||void 0;const r=w.lastIndexOf(".");switch(w.substring(r+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"Ge":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},N=()=>"undefined"!==typeof location&&"file:"===location.protocol,U=w=>y.test(w),v=w=>{const p=y.exec(w);if(null===p||0===p.length)return{match:!1,type:""};return{match:!0,type:p[0].replace("data:","").replace("base64,","")}};function R(w){return(0,E.b)(w.split(",")[1])}const V=w=>(0,E.f)(w.split(",")[1]);let b;K.d._FileToolsLoadImage=M,J.d.loadFile=t,j.m.loadFile=t;((w,p,e,r,I,d,f,q,E,j)=>{b={DecodeBase64UrlToBinary:w,DecodeBase64UrlToString:p,DefaultRetryStrategy:e.DefaultRetryStrategy,BaseUrl:e.BaseUrl,CorsBehavior:e.CorsBehavior,PreprocessUrl:e.PreprocessUrl,IsBase64DataUrl:r,IsFileURL:I,LoadFile:d,LoadImage:f,ReadFile:q,RequestFile:E,SetCorsBehavior:j},Object.defineProperty(b,"DefaultRetryStrategy",{get:function(){return e.DefaultRetryStrategy},set:function(w){e.DefaultRetryStrategy=w}}),Object.defineProperty(b,"BaseUrl",{get:function(){return e.BaseUrl},set:function(w){e.BaseUrl=w}}),Object.defineProperty(b,"PreprocessUrl",{get:function(){return e.PreprocessUrl},set:function(w){e.PreprocessUrl=w}}),Object.defineProperty(b,"CorsBehavior",{get:function(){return e.CorsBehavior},set:function(w){e.CorsBehavior=w}})})(R,V,a,U,N,t,M,i,n,A)},11190:(w,p,e)=>{function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(w=>{const p=16*Math.random()|0;return("x"===w?p:3&p|8).toString(16)}))}e.d(p,{b:()=>r})},11182:(w,p,e)=>{e.d(p,{c:()=>d});var r=e(11081),I=e(11038);class d{static Instantiate(w){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[w])return this.RegisteredExternalClasses[w];const p=(0,I.c)(w);if(p)return p;r.c.Warn(w+" not found, you may have missed an import.");const e=w.split(".");let d=window||this;for(let r=0,I=e.length;r<I;r++)d=d[e[r]];return"function"!==typeof d?null:d}}d.RegisteredExternalClasses={}},11081:(w,p,e)=>{e.d(p,{c:()=>r});class r{static _CheckLimit(w,p){let e=r._LogLimitOutputs[w];return e?e.current++:(e={limit:p,current:1},r._LogLimitOutputs[w]=e),e.current<=e.limit}static _GenerateLimitMessage(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const e=r._LogLimitOutputs[w];if(!e||!r.MessageLimitReached)return;const I=this._Levels[p];e.current===e.limit&&r[I.name](r.MessageLimitReached.replace(/%LIMIT%/g,""+e.limit).replace(/%TYPE%/g,I.name??""))}static _AddLogEntry(w){r._LogCache=w+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(w)}static _FormatMessage(w){const p=w=>w<10?"0"+w:""+w,e=new Date;return"["+p(e.getHours())+":"+p(e.getMinutes())+":"+p(e.getSeconds())+"]: "+w}static _LogDisabled(w,p){}static _LogEnabled(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const I=Array.isArray(p)?p[0]:p;if(void 0!==e&&!r._CheckLimit(I,e))return;const d=r._FormatMessage(I),f=this._Levels[w],q=Array.isArray(p)?p.slice(1):[];f.logFunc&&f.logFunc("BJS - "+d,...q);const E=`<div style='color:${f.color}'>${d}</div><br>`;r._AddLogEntry(E),r._GenerateLimitMessage(I,w)}static get LogCache(){return r._LogCache}static ClearLogCache(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0}static set LogLevels(w){r.Log=r._LogDisabled,r.Warn=r._LogDisabled,r.Error=r._LogDisabled;const p=[r.MessageLogLevel,r.WarningLogLevel,r.ErrorLogLevel];for(const e of p)if((w&e)===e){const w=this._Levels[e];r[w.name]=r._LogEnabled.bind(r,e)}}}r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],r.errorsCount=0,r.Log=r._LogEnabled.bind(r,r.MessageLogLevel),r.Warn=r._LogEnabled.bind(r,r.WarningLogLevel),r.Error=r._LogEnabled.bind(r,r.ErrorLogLevel)},11056:(w,p,e)=>{e.d(p,{d:()=>f});const r="undefined"!==typeof WeakRef;class I{constructor(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.initialize(w,p,e,r)}initialize(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return this.mask=w,this.skipNextObservers=p,this.target=e,this.currentTarget=r,this}}class d{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=w,this.mask=p,this.scope=e,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(w)}}class f{static FromPromise(w,p){const e=new f;return w.then((w=>{e.notifyObservers(w)})).catch((w=>{if(!p)throw w;p.notifyObservers(w)})),e}get observers(){return this._observers}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=p,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new I(0),w&&(this._onObserverAdded=w)}add(w){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!w)return null;const I=new d(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);I.unregisterOnNextCall=e,p?this._observers.unshift(I):this._observers.push(I),this._onObserverAdded&&this._onObserverAdded(I),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(I,this._lastNotifiedValue);const f=r?new WeakRef(this):{deref:()=>this};return I._remove=function(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=f.deref();p&&(w?p.remove(I):p._remove(I))},I}addOnce(w){return this.add(w,void 0,void 0,void 0,!0)}remove(w){if(!w)return!1;w._remove=null;return-1!==this._observers.indexOf(w)&&(this._deferUnregister(w),!0)}removeCallback(w,p){for(let e=0;e<this._observers.length;e++){const r=this._observers[e];if(!r._willBeUnregistered&&(r.callback===w&&(!p||p===r.scope)))return this._deferUnregister(r),!0}return!1}_deferUnregister(w){w._willBeUnregistered||(this._numObserversMarkedAsDeleted++,w.unregisterOnNextCall=!1,w._willBeUnregistered=!0,setTimeout((()=>{this._remove(w)}),0))}_remove(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!w)return!1;const e=this._observers.indexOf(w);return-1!==e&&(p&&this._numObserversMarkedAsDeleted--,this._observers.splice(e,1),!0)}makeObserverTopPriority(w){this._remove(w,!1),this._observers.unshift(w)}makeObserverBottomPriority(w){this._remove(w,!1),this._observers.push(w)}notifyObservers(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=w),!this._observers.length)return!0;const d=this._eventState;d.mask=p,d.target=e,d.currentTarget=r,d.skipNextObservers=!1,d.lastReturnValue=w,d.userInfo=I;for(const f of this._observers)if(!f._willBeUnregistered&&(f.mask&p&&(f.unregisterOnNextCall&&this._deferUnregister(f),f.scope?d.lastReturnValue=f.callback.apply(f.scope,[w,d]):d.lastReturnValue=f.callback(w,d)),d.skipNextObservers))return!1;return!0}notifyObserver(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=p),w._willBeUnregistered)return;const r=this._eventState;r.mask=e,r.skipNextObservers=!1,w.unregisterOnNextCall&&this._deferUnregister(w),w.callback(p,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const w=this._observers.pop();w&&(w._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const w=new f;return w._observers=this._observers.slice(0),w}hasSpecificMask(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const p of this._observers)if(p.mask&w||p.mask===w)return!0;return!1}}},11496:(w,p,e)=>{e.d(p,{d:()=>I});var r=e(11088);class I{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(w,p){I.Enabled&&(this._current+=w,p&&this._fetchResult())}beginMonitoring(){I.Enabled&&(this._startMonitoringTime=r.b.Now)}endMonitoring(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!I.Enabled)return;w&&this.fetchNewFrame();const p=r.b.Now;this._current=p-this._startMonitoringTime,w&&this._fetchResult()}Km(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const w=r.b.Now;w-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=w,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}I.Enabled=!0},11088:(w,p,e)=>{e.d(p,{b:()=>I});var r=e(11075);class I{static get Now(){return(0,r.i)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11577:(w,p,e)=>{e.d(p,{b:()=>d});var r=e(11530),I=e(11502);class d{static ExpandRGBDTexture(w){const p=w._texture;if(!p||!w.isRGBD)return;const I=p.getEngine(),d=I.getCaps(),f=p.isReady;let q=!1;d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(q=!0,p.type=2):d.textureFloatRender&&d.textureFloatLinearFiltering&&(q=!0,p.type=1),q&&(p.isReady=!1,p._isRGBD=!1,p.invertY=!1);const E=async()=>{const d=I.isWebGPU,f=d?1:0;p.isReady=!1,d?await e.e(21).then(e.bind(e,13728)):await e.e(14).then(e.bind(e,13731));const q=new r.b("rgbdDecode","rgbdDecode",null,null,1,null,3,I,!1,void 0,p.type,void 0,null,!1,void 0,f);q.externalTextureSamplerBinding=!0;const E=I.createRenderTargetTexture(p.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:p.samplingMode,type:p.type,format:5});q.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{q.onApply=w=>{w._bindTexture("textureSampler",p),w.setFloat2("scale",1,1)},w.iw().postProcessManager.directRender([q],E,!0),I.restoreDefaultFramebuffer(),I._releaseTexture(p),q&&q.dispose(),E._swapAndDie(p),p.isReady=!0}))}))};q&&(f?E():w.onLoadObservable.addOnce(E))}static async EncodeTextureToRGBD(w,p){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return p.getEngine().isWebGPU?await e.e(22).then(e.bind(e,13745)):await e.e(15).then(e.bind(e,13740)),await(0,I.b)("rgbdEncode",w,p,r,1,5)}}},11376:(w,p,e)=>{e.d(p,{b:()=>I,e:()=>r});class r{constructor(w){this.length=0,this.data=new Array(w),this._id=r._GlobalId++}push(w){this.data[this.length++]=w,this.length>this.data.length&&(this.data.length*=2)}forEach(w){for(let p=0;p<this.length;p++)w(this.data[p])}sort(w){this.data.sort(w)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(let p=0;p<w.length;p++)this.data[this.length++]=(w.data||w)[p]}}indexOf(w){const p=this.data.indexOf(w);return p>=this.length?-1:p}contains(w){return-1!==this.indexOf(w)}}r._GlobalId=0;class I extends r{constructor(){super(...arguments),this._duplicateId=0}push(w){super.push(w),w.__smartArrayFlags||(w.__smartArrayFlags={}),w.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(w){return(!w.__smartArrayFlags||w.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(w),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(let p=0;p<w.length;p++){const e=(w.data||w)[p];this.pushNoDuplicate(e)}}}}},11116:(w,p,e)=>{e.d(p,{b:()=>f,f:()=>d,j:()=>r,m:()=>I});const r=w=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(w);let p="";for(let e=0;e<w.byteLength;e++)p+=String.fromCharCode(w[e]);return p},I=w=>{const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let e,r,I,d,f,q,E,j="",X=0;const k=ArrayBuffer.isView(w)?new Uint8Array(w.buffer,w.byteOffset,w.byteLength):new Uint8Array(w);for(;X<k.length;)e=k[X++],r=X<k.length?k[X++]:Number.NaN,I=X<k.length?k[X++]:Number.NaN,d=e>>2,f=(3&e)<<4|r>>4,q=(15&r)<<2|I>>6,E=63&I,isNaN(r)?q=E=64:isNaN(I)&&(E=64),j+=p.charAt(d)+p.charAt(f)+p.charAt(q)+p.charAt(E);return j},d=w=>atob(w),f=w=>{const p=d(w),e=p.length,r=new Uint8Array(new ArrayBuffer(e));for(let I=0;I<e;I++)r[I]=p.charCodeAt(I);return r.buffer}},11304:(w,p,e)=>{e.d(p,{b:()=>I});class r{static Eval(w,p){return"true"===(w=w.match(/\([^()]*\)/g)?w.replace(/\([^()]*\)/g,(w=>(w=w.slice(1,w.length-1),r._HandleParenthesisContent(w,p)))):r._HandleParenthesisContent(w,p))||"false"!==w&&r.Eval(w,p)}static _HandleParenthesisContent(w,p){let e;p=p||(w=>"true"===w);const I=w.split("||");for(const d in I)if(Object.prototype.hasOwnProperty.call(I,d)){let w=r._SimplifyNegation(I[d].trim());const f=w.split("&&");if(f.length>1)for(let I=0;I<f.length;++I){const d=r._SimplifyNegation(f[I].trim());if(e="true"!==d&&"false"!==d?"!"===d[0]?!p(d.substring(1)):p(d):"true"===d,!e){w="false";break}}if(e||"true"===w){e=!0;break}e="true"!==w&&"false"!==w?"!"===w[0]?!p(w.substring(1)):p(w):"true"===w}return e?"true":"false"}static _SimplifyNegation(w){return"!true"===(w=(w=w.replace(/^[\s!]+/,(w=>(w=w.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?w="false":"!false"===w&&(w="true"),w}}class I{static EnableFor(w){w._tags=w._tags||{},w.hasTags=()=>I.HasTags(w),w.addTags=p=>I.AddTagsTo(w,p),w.removeTags=p=>I.RemoveTagsFrom(w,p),w.matchesTagsQuery=p=>I.MatchesQuery(w,p)}static DisableFor(w){delete w._tags,delete w.hasTags,delete w.addTags,delete w.removeTags,delete w.matchesTagsQuery}static HasTags(w){if(!w._tags)return!1;const p=w._tags;for(const e in p)if(Object.prototype.hasOwnProperty.call(p,e))return!0;return!1}static GetTags(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!w._tags)return null;if(p){const p=[];for(const e in w._tags)Object.prototype.hasOwnProperty.call(w._tags,e)&&!0===w._tags[e]&&p.push(e);return p.join(" ")}return w._tags}static AddTagsTo(w,p){if(!p)return;if("string"!==typeof p)return;const e=p.split(" ");for(const r of e)I._AddTagTo(w,r)}static _AddTagTo(w,p){""!==(p=p.trim())&&"true"!==p&&"false"!==p&&(p.match(/[\s]/)||p.match(/^([!]|([|]|[&]){2})/)||(I.EnableFor(w),w._tags[p]=!0))}static RemoveTagsFrom(w,p){if(!I.HasTags(w))return;const e=p.split(" ");for(const r in e)I._RemoveTagFrom(w,e[r])}static _RemoveTagFrom(w,p){delete w._tags[p]}static MatchesQuery(w,p){return void 0===p||(""===p?I.HasTags(w):r.Eval(p,(p=>I.HasTags(w)&&w._tags[p])))}}},11502:(w,p,e)=>{e.d(p,{b:()=>s,c:()=>z,g:()=>i,i:()=>t,k:()=>A});var r=e(11511),I=e(11517),d=e(11207),f=e(11530),q=e(11132),E=e(11038),j=e(11301),X=e(11537),k=e(11411);class m extends X.g{_gatherImports(w,p){w?(this._webGPUReady=!0,p.push(Promise.all([e.e(36).then(e.bind(e,13682))]))):p.push(Promise.all([e.e(37).then(e.bind(e,13688))])),super._gatherImports(w,p)}constructor(w){super({...arguments.length>2?arguments[2]:void 0,name:w,wE:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||k.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:m.FragmentUrl})}}m.FragmentUrl="pass";class J extends X.g{_gatherImports(w,p){w?(this._webGPUReady=!0,p.push(Promise.all([e.e(43).then(e.bind(e,13722))]))):p.push(Promise.all([e.e(44).then(e.bind(e,13726))])),super._gatherImports(w,p)}constructor(w){super({...arguments.length>2?arguments[2]:void 0,name:w,wE:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||k.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:J.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(w){if(!(w<0||w>5))switch(this._face=w,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}J.FragmentUrl="passCube";var K=e(11213);class y extends f.b{getClassName(){return"PassPostProcess"}constructor(w,p){let e=arguments.length>4?arguments[4]:void 0;const r={size:"number"===typeof p?p:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,wE:e,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...p};super(w,m.FragmentUrl,{effectWrapper:"number"!==typeof p&&p.effectWrapper?void 0:new m(w,e,r),...r})}static _Parse(w,p,e,r){return j.e.Parse((()=>new y(w.name,w.options,p,w.renderTargetSamplingMode,w._engine,w.reusable)),w,e,r)}}(0,E.d)("BABYLON.PassPostProcess",y);class c extends f.b{get face(){return this._effectWrapper.face}set face(w){this._effectWrapper.face=w}getClassName(){return"PassCubePostProcess"}constructor(w,p){let e=arguments.length>4?arguments[4]:void 0;const r={size:"number"===typeof p?p:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,wE:e,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...p};super(w,m.FragmentUrl,{effectWrapper:"number"!==typeof p&&p.effectWrapper?void 0:new J(w,e,r),...r})}static _Parse(w,p,e,r){return j.e.Parse((()=>new c(w.name,w.options,p,w.renderTargetSamplingMode,w._engine,w.reusable)),w,e,r)}}function s(w,p,e,r,I,d,q,E){const j=p.getEngine();return p.isReady=!1,I=I??p.samplingMode,r=r??p.type,d=d??p.format,q=q??p.width,E=E??p.height,-1===r&&(r=0),new Promise((X=>{const k=new f.b("postprocess",w,null,null,1,null,I,j,!1,void 0,r,void 0,null,!1,d);k.externalTextureSamplerBinding=!0;const m=j.createRenderTargetTexture({width:q,height:E},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:I,type:r,format:d});k.onEffectCreatedObservable.addOnce((w=>{w.executeWhenCompiled((()=>{k.onApply=w=>{w._bindTexture("textureSampler",p),w.setFloat2("scale",1,1)},e.postProcessManager.directRender([k],m,!0),j.restoreDefaultFramebuffer(),j._releaseTexture(p),k&&k.dispose(),m._swapAndDie(p),p.type=r,p.format=5,p.isReady=!0,X(p)}))}))}))}let O,a;function A(w){O||(O=new Float32Array(1),a=new Int32Array(O.buffer)),O[0]=w;const p=a[0];let e=p>>16&32768,r=p>>12&2047;const I=p>>23&255;return I<103?e:I>142?(e|=31744,e|=(255==I?0:1)&&8388607&p,e):I<113?(r|=2048,e|=(r>>114-I)+(r>>113-I&1),e):(e|=I-112<<10|r>>1,e+=1&r,e)}function z(w){const p=(32768&w)>>15,e=(31744&w)>>10,r=1023&w;return 0===e?(p?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==e?r?NaN:1/0*(p?-1:1):(p?-1:1)*Math.pow(2,e-15)*(1+r/Math.pow(2,10))}(0,d.c)([(0,K.J)()],c.prototype,"face",null),q.d._RescalePostProcessFactory=w=>new y("rescale",1,null,2,w,!1,0);const M=async(w,p,d,q,E)=>{const j=w.iw(),X=j.getEngine();let k;if(X.isWebGPU?w.isCube?await e.e(40).then(e.bind(e,13711)):await e.e(41).then(e.bind(e,13715)):w.isCube?await e.e(38).then(e.bind(e,13695)):await e.e(39).then(e.bind(e,13703)),w.isCube){const w=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];k=new f.b("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:r.e.NEAREST_NEAREST_MIPNEAREST,wE:X,defines:w[q],shaderLanguage:X.isWebGPU?1:0})}else k=new f.b("lod","lod",{uniforms:["lod","gamma"],samplingMode:r.e.NEAREST_NEAREST_MIPNEAREST,wE:X,shaderLanguage:X.isWebGPU?1:0});await new Promise((w=>{k.onEffectCreatedObservable.addOnce((p=>{p.executeWhenCompiled((()=>{w(0)}))}))}));const m=new I.d("temp",{width:p,height:d},j,!1);k.onApply=function(p){p.setTexture("textureSampler",w),p.setFloat("lod",E),p.setInt("gamma",w.gammaSpace?1:0)};const J=w.getInternalTexture();try{if(m.renderTarget&&J){const e=J.samplingMode;0!==E?w.updateSamplingMode(r.e.NEAREST_NEAREST_MIPNEAREST):w.updateSamplingMode(r.e.NEAREST_NEAREST),j.postProcessManager.directRender([k],m.renderTarget,!0),w.updateSamplingMode(e);const I=await X.readPixels(0,0,p,d),f=new Uint8Array(I.buffer,0,I.byteLength);return X.unBindFramebuffer(m.renderTarget),f}throw Error("Render to texture failed.")}finally{m.dispose(),k.dispose()}};async function i(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!w.isReady()&&w._texture&&await new Promise(((p,e)=>{null!==w._texture?w._texture.onLoadedObservable.addOnce((()=>{p(0)})):e(0)})),await M(w,p,e,r,I)}const t={CreateResizedCopy:function(w,p,e){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const f=w.iw(),q=f.getEngine(),E=new I.d("resized"+w.name,{width:p,height:e},f,!w.noMipmap,!0,w._texture.type,!1,w.samplingMode,!1);E.wrapU=w.wrapU,E.wrapV=w.wrapV,E.uOffset=w.uOffset,E.vOffset=w.vOffset,E.uScale=w.uScale,E.vScale=w.vScale,E.uAng=w.uAng,E.vAng=w.vAng,E.wAng=w.wAng,E.coordinatesIndex=w.coordinatesIndex,E.level=w.level,E.anisotropicFilteringLevel=w.anisotropicFilteringLevel,E._texture.isReady=!1,w.wrapU=r.e.CLAMP_ADDRESSMODE,w.wrapV=r.e.CLAMP_ADDRESSMODE;const j=new y("pass",1,null,d?r.e.BILINEAR_SAMPLINGMODE:r.e.NEAREST_SAMPLINGMODE,q,!1,0);return j.externalTextureSamplerBinding=!0,j.onEffectCreatedObservable.addOnce((p=>{p.executeWhenCompiled((()=>{j.onApply=function(p){p.setTexture("textureSampler",w)};const p=E.renderTarget;p&&(f.postProcessManager.directRender([j],p),q.unBindFramebuffer(p),E.disposeFramebufferObjects(),j.dispose(),E.getInternalTexture().isReady=!0)}))})),E},ApplyPostProcess:s,ToHalfFloat:A,FromHalfFloat:z,GetTextureDataAsync:i}},11127:(w,p,e)=>{e.d(p,{c:()=>I,g:()=>f});let r=[];class I{static SetImmediate(w){0===r.length&&setTimeout((()=>{const w=r;r=[];for(const p of w)p()}),1),r.push(w)}}function d(w,p,e){try{if(w())return p(),!0}catch(r){return null===e||void 0===e||e(r),!0}return!1}const f=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,f=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&d(w,p,e))return null;const q=setInterval((()=>{d(w,p,e)?clearInterval(q):(I-=r,I<0&&(clearInterval(q),null===e||void 0===e||e(new Error("Operation timed out after maximum retries. "+(f||"")),!0)))}),r);return()=>clearInterval(q)}},11194:(w,p,e)=>{function r(w){let p=1;do{p*=2}while(p<w);return p===w}function I(w,p,e){return w*(1-e)+p*e}function d(w){const p=f(w),e=q(w);return p-w>w-e?e:p}function f(w){return w--,w|=w>>1,w|=w>>2,w|=w>>4,w|=w>>8,w|=w>>16,++w}function q(w){return w|=w>>1,w|=w>>2,w|=w>>4,w|=w>>8,(w|=w>>16)-(w>>1)}function E(w,p){let e;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:e=q(w);break;case 2:e=d(w);break;default:e=f(w)}return Math.min(e,p)}e.d(p,{d:()=>q,f:()=>E,i:()=>r,l:()=>I,n:()=>d})},11071:(w,p,e)=>{e.d(p,{d:()=>s,g:()=>c});var r=e(11056),I=e(11075),d=e(11081),f=e(11086),q=e(11088),E=e(11094),j=e(11099),X=e(11051),k=e(11107),m=e(11127),J=e(11182),K=e(11190),y=e(11194);class c{static get BaseUrl(){return k.f.BaseUrl}static set BaseUrl(w){k.f.BaseUrl=w}static get CleanUrl(){return k.f.CleanUrl}static set CleanUrl(w){k.f.CleanUrl=w}static IsAbsoluteUrl(w){return 0===w.indexOf("//")||-1!==w.indexOf("://")&&(-1!==w.indexOf(".")&&(-1!==w.indexOf("/")&&(!(w.indexOf(":")>w.indexOf("/"))&&(w.indexOf("://")<w.indexOf(".")||(0===w.indexOf("data:")||0===w.indexOf("blob:"))))))}static set ScriptBaseUrl(w){k.f.ScriptBaseUrl=w}static get ScriptBaseUrl(){return k.f.ScriptBaseUrl}static set CDNBaseUrl(w){c.ScriptBaseUrl=w,c.AssetBaseUrl=w}static set ScriptPreprocessUrl(w){k.f.ScriptPreprocessUrl=w}static get ScriptPreprocessUrl(){return k.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return k.f.DefaultRetryStrategy}static set DefaultRetryStrategy(w){k.f.DefaultRetryStrategy=w}static get CorsBehavior(){return k.f.CorsBehavior}static set CorsBehavior(w){k.f.CorsBehavior=w}static get UseFallbackTexture(){return X.d.UseFallbackTexture}static set UseFallbackTexture(w){X.d.UseFallbackTexture=w}static get RegisteredExternalClasses(){return J.c.RegisteredExternalClasses}static set RegisteredExternalClasses(w){J.c.RegisteredExternalClasses=w}static get fallbackTexture(){return X.d.FallbackTexture}static set fallbackTexture(w){X.d.FallbackTexture=w}static FetchToRef(w,p,e,r,I,d){const f=4*((Math.abs(w)*e%e|0)+(Math.abs(p)*r%r|0)*e);d.r=I[f]/255,d.g=I[f+1]/255,d.b=I[f+2]/255,d.a=I[f+3]/255}static Mix(w,p,e){return 0}static Instantiate(w){return J.c.Instantiate(w)}static SetImmediate(w){m.c.SetImmediate(w)}static IsExponentOfTwo(w){return!0}static FloatRound(w){return Math.fround(w)}static GetFilename(w){const p=w.lastIndexOf("/");return p<0?w:w.substring(p+1)}static GetFolderPath(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=w.lastIndexOf("/");return e<0?p?w:"":w.substring(0,e+1)}static ToDegrees(w){return 180*w/Math.PI}static ToRadians(w){return w*Math.PI/180}static SmoothAngleChange(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const r=this.ToRadians(w),I=this.ToRadians(p);return this.ToDegrees(Math.atan2((1-e)*Math.sin(I)+e*Math.sin(r),(1-e)*Math.cos(I)+e*Math.cos(r)))}static MakeArray(w,p){return!0===p||void 0!==w&&null!=w?Array.isArray(w)?w:[w]:null}static GetPointerPrefix(w){return(0,I.i)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(w,p){(0,k.F)(w,p)}static SetReferrerPolicyBehavior(w,p){p.referrerPolicy=w}static get PreprocessUrl(){return k.f.PreprocessUrl}static set PreprocessUrl(w){k.f.PreprocessUrl=w}static LoadImage(w,p,e,r,I,d){return(0,k.u)(w,p,e,r,I,d)}static LoadFile(w,p,e,r,I,d){return(0,k.s)(w,p,e,r,I,d)}static async LoadFileAsync(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((e,r)=>{(0,k.s)(w,(w=>{e(w)}),void 0,void 0,p,((w,p)=>{r(p)}))}))}static GetAssetUrl(w){if(!w)return"";if(c.AssetBaseUrl&&w.startsWith(c._DefaultAssetsUrl)){const p="/"===c.AssetBaseUrl[c.AssetBaseUrl.length-1]?c.AssetBaseUrl.substring(0,c.AssetBaseUrl.length-1):c.AssetBaseUrl;return w.replace(c._DefaultAssetsUrl,p)}return w}static GetBabylonScriptURL(w,p){if(!w)return"";if(c.ScriptBaseUrl&&w.startsWith(c._DefaultCdnUrl)){const p="/"===c.ScriptBaseUrl[c.ScriptBaseUrl.length-1]?c.ScriptBaseUrl.substring(0,c.ScriptBaseUrl.length-1):c.ScriptBaseUrl;w=w.replace(c._DefaultCdnUrl,p)}return w=c.ScriptPreprocessUrl(w),p&&(w=c.GetAbsoluteUrl(w)),w}static LoadBabylonScript(w,p,e,r){w=c.GetBabylonScriptURL(w),c.LoadScript(w,p,e)}static async LoadBabylonScriptAsync(w){return w=c.GetBabylonScriptURL(w),await c.LoadScriptAsync(w)}static LoadScript(w,p,e,r){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(w),p&&p()}catch(E){null===e||void 0===e||e(`Unable to load script '${w}' in worker`,E)}return}if(!(0,I.i)())return void(null===e||void 0===e||e(`Cannot load script '${w}' outside of a window or a worker`));const f=document.getElementsByTagName("head")[0],q=document.createElement("script");d?(q.setAttribute("type","module"),q.innerText=w):(q.setAttribute("type","text/javascript"),q.setAttribute("src",w)),r&&(q.id=r),q.onload=()=>{p&&p()},q.onerror=p=>{e&&e(`Unable to load script '${w}'`,p)},f.appendChild(q)}static async LoadScriptAsync(w,p){return await new Promise(((e,r)=>{this.LoadScript(w,(()=>{e()}),((w,p)=>{r(p||new Error(w))}),p)}))}static ReadFileAsDataURL(w,p,e){const I=new FileReader,d={onCompleteObservable:new r.d,abort:()=>I.abort()};return I.onloadend=()=>{d.onCompleteObservable.notifyObservers(d)},I.onload=w=>{p(w.target.result)},I.onprogress=e,I.readAsDataURL(w),d}static ReadFile(w,p,e,r,I){return(0,k.x)(w,p,e,r,I)}static FileAsURL(w){const p=new Blob([w]);return window.URL.createObjectURL(p)}static Format(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return w.toFixed(p)}static DeepCopy(w,p,e,r){f.d.DeepCopy(w,p,e,r)}static IsEmpty(w){for(const p in w)if(Object.prototype.hasOwnProperty.call(w,p))return!1;return!0}static RegisterTopRootEvents(w,p){for(let r=0;r<p.length;r++){const I=p[r];w.addEventListener(I.name,I.handler,!1);try{window.parent&&window.parent.addEventListener(I.name,I.handler,!1)}catch(e){}}}static UnregisterTopRootEvents(w,p){for(let r=0;r<p.length;r++){const I=p[r];w.removeEventListener(I.name,I.handler);try{w.parent&&w.parent.removeEventListener(I.name,I.handler)}catch(e){}}}static async DumpFramebuffer(w,p,e,r){throw(0,E.c)("DumpTools")}static DumpData(w,p,e,r){throw(0,E.c)("DumpTools")}static async DumpDataAsync(w,p,e){throw(0,E.c)("DumpTools")}static _IsOffScreenCanvas(w){return void 0!==w.convertToBlob}static ToBlob(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=arguments.length>3?arguments[3]:void 0;c._IsOffScreenCanvas(w)||w.toBlob||(w.toBlob=function(w,p,e){setTimeout((()=>{const r=atob(this.toDataURL(p,e).split(",")[1]),I=r.length,d=new Uint8Array(I);for(let w=0;w<I;w++)d[w]=r.charCodeAt(w);w(new Blob([d]))}))}),c._IsOffScreenCanvas(w)?w.convertToBlob({type:e,quality:r}).then((w=>p(w))):w.toBlob((function(w){p(w)}),e,r)}static DownloadBlob(w,p){if("download"in document.createElement("a")){if(!p){const w=new Date;p="screenshot_"+((w.getFullYear()+"-"+(w.getMonth()+1)).slice(2)+"-"+w.getDate()+"_"+w.getHours()+"-"+("0"+w.getMinutes()).slice(-2))+".png"}c.Download(w,p)}else if(w&&"undefined"!==typeof URL){const p=URL.createObjectURL(w),e=window.open("");if(!e)return;const r=e.document.createElement("img");r.onload=function(){URL.revokeObjectURL(p)},r.src=p,e.document.body.appendChild(r)}}static EncodeScreenshotCanvasData(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;if("string"!==typeof r&&p){if(p){if(c._IsOffScreenCanvas(w))return void w.convertToBlob({type:e,quality:I}).then((w=>{const e=new FileReader;e.readAsDataURL(w),e.onloadend=()=>{const w=e.result;p(w)}}));const r=w.toDataURL(e,I);p(r)}}else this.ToBlob(w,(function(w){w&&c.DownloadBlob(w,r),p&&p("")}),e,I)}static Download(w,p){if("undefined"===typeof URL)return;const e=window.URL.createObjectURL(w),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=e,r.download=p,r.addEventListener("click",(()=>{r.parentElement&&r.parentElement.removeChild(r)})),r.click(),window.URL.revokeObjectURL(e)}static BackCompatCameraNoPreventDefault(w){return"boolean"===typeof w[0]?w[0]:"boolean"===typeof w[1]&&w[1]}static CreateScreenshot(w,p,e,r){throw(0,E.c)("ScreenshotTools")}static async CreateScreenshotAsync(w,p,e){throw(0,E.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(w,p,e,r){throw(0,E.c)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(w,p,e){throw(0,E.c)("ScreenshotTools")}static RandomId(){return(0,K.b)()}static IsBase64(w){return(0,k.n)(w)}static DecodeBase64(w){return(0,k.d)(w)}static get errorsCount(){return d.c.errorsCount}static Log(w){d.c.Log(w)}static Warn(w){d.c.Warn(w)}static Error(w){d.c.Error(w)}static get LogCache(){return d.c.LogCache}static ClearLogCache(){d.c.ClearLogCache()}static set LogLevels(w){d.c.LogLevels=w}static set PerformanceLogLevel(w){return(w&c.PerformanceUserMarkLogLevel)===c.PerformanceUserMarkLogLevel?(c.StartPerformanceCounter=c._StartUserMark,void(c.EndPerformanceCounter=c._EndUserMark)):(w&c.PerformanceConsoleLogLevel)===c.PerformanceConsoleLogLevel?(c.StartPerformanceCounter=c._StartPerformanceConsole,void(c.EndPerformanceCounter=c._EndPerformanceConsole)):(c.StartPerformanceCounter=c._StartPerformanceCounterDisabled,void(c.EndPerformanceCounter=c._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(w,p){}static _EndPerformanceCounterDisabled(w,p){}static _StartUserMark(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c._Performance){if(!(0,I.i)())return;c._Performance=window.performance}p&&c._Performance.mark&&c._Performance.mark(w+"-Begin")}static _EndUserMark(w){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&c._Performance.mark&&(c._Performance.mark(w+"-End"),c._Performance.measure(w,w+"-Begin",w+"-End"))}static _StartPerformanceConsole(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p&&(c._StartUserMark(w,p),console.time&&console.time(w))}static _EndPerformanceConsole(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p&&(c._EndUserMark(w,p),console.timeEnd(w))}static get Now(){return q.b.Now}static GetClassName(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=null;if(!p&&w.getClassName)e=w.getClassName();else{if(w instanceof Object){e=(p?w:Object.getPrototypeOf(w)).constructor.__bjsclassName__}e||(e=typeof w)}return e}static First(w,p){for(const e of w)if(p(e))return e;return null}static getFullClassName(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=null,r=null;if(!p&&w.getClassName)e=w.getClassName();else{if(w instanceof Object){const I=p?w:Object.getPrototypeOf(w);e=I.constructor.__bjsclassName__,r=I.constructor.__bjsmoduleName__}e||(e=typeof w)}return e?(null!=r?r+".":"")+e:null}static async DelayAsync(w){await new Promise((p=>{setTimeout((()=>{p()}),w)}))}static IsSafari(){return!!(0,I.h)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}c.AssetBaseUrl="",c.UseCustomRequestHeaders=!1,c.CustomRequestHeaders=j.b.CustomRequestHeaders,c.GetDOMTextContent=I.c,c._DefaultCdnUrl="https://cdn.babylonjs.com",c._DefaultAssetsUrl="https://assets.babylonjs.com/core",c.GetAbsoluteUrl="object"===typeof document?w=>{const p=document.createElement("a");return p.href=w,p.href}:"function"===typeof URL&&"object"===typeof location?w=>new URL(w,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},c.NoneLogLevel=d.c.NoneLogLevel,c.MessageLogLevel=d.c.MessageLogLevel,c.WarningLogLevel=d.c.WarningLogLevel,c.ErrorLogLevel=d.c.ErrorLogLevel,c.AllLogLevel=d.c.AllLogLevel,c.IsWindowObjectExist=I.i,c.PerformanceNoneLogLevel=0,c.PerformanceUserMarkLogLevel=1,c.PerformanceConsoleLogLevel=2,c.StartPerformanceCounter=c._StartPerformanceCounterDisabled,c.EndPerformanceCounter=c._EndPerformanceCounterDisabled;class s{constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=w,this.index=r-1,this._done=!1,this._fn=p,this._successCallback=e}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(w,p,e){const r=new s(w,p,e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return r.executeNext(),r}static SyncAsyncForLoop(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return s.Run(Math.ceil(w/p),(r=>{I&&I()?r.breakLoop():setTimeout((()=>{for(let d=0;d<p;++d){const f=r.index*p+d;if(f>=w)break;if(e(f),I&&I()){r.breakLoop();break}}r.executeNext()}),d)}),r)}}c.Mix=y.l,c.IsExponentOfTwo=y.i,X.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11038:(w,p,e)=>{e.d(p,{c:()=>d,d:()=>I});const r={};function I(w,p){r[w]=p}function d(w){return r[w]}},11640:(w,p,e)=>{e.d(p,{c:()=>r});class r{static get UniqueId(){const w=this._UniqueIdCounter;return this._UniqueIdCounter++,w}}r._UniqueIdCounter=1},11099:(w,p,e)=>{e.d(p,{b:()=>r});class r{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(r.CustomRequestHeaders).length>0||r.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const w in r.CustomRequestHeaders){const p=r.CustomRequestHeaders[w];p&&this._xhr.setRequestHeader(w,p)}}_shouldSkipRequestModifications(w){return r.SkipRequestModificationForBabylonCDN&&(w.includes("preview.babylonjs.com")||w.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(w){this._xhr.onprogress=w}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(w){this._xhr.responseType=w}get timeout(){return this._xhr.timeout}set timeout(w){this._xhr.timeout=w}addEventListener(w,p,e){this._xhr.addEventListener(w,p,e)}removeEventListener(w,p,e){this._xhr.removeEventListener(w,p,e)}abort(){this._xhr.abort()}send(w){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(w)}open(w,p){for(const e of r.CustomRequestModifiers){if(this._shouldSkipRequestModifications(p))return;p=e(this._xhr,p)||p}p=(p=p.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=p,this._xhr.open(w,p,!0)}setRequestHeader(w,p){this._xhr.setRequestHeader(w,p)}getResponseHeader(w){return this._xhr.getResponseHeader(w)}}r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array,r.SkipRequestModificationForBabylonCDN=!0},11760:(w,p,e)=>{e.d(p,{d:()=>I});class r{constructor(w){this._pendingActions=new Array,this._workerInfos=w.map((w=>({workerPromise:Promise.resolve(w),idle:!0})))}dispose(){for(const w of this._workerInfos)w.workerPromise.then((w=>{w.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(w){this._executeOnIdleWorker(w)||this._pendingActions.push(w)}_executeOnIdleWorker(w){for(const p of this._workerInfos)if(p.idle)return this._execute(p,w),!0;return!1}_execute(w,p){w.idle=!1,w.workerPromise.then((e=>{p(e,(()=>{const p=this._pendingActions.shift();p?this._execute(w,p):w.idle=!0}))}))}}class I extends r{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I.DefaultOptions;super([]),this._maxWorkers=w,this._createWorkerAsync=p,this._options=e}push(w){if(!this._executeOnIdleWorker(w))if(this._workerInfos.length<this._maxWorkers){const p={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(p),this._execute(p,w)}else this._pendingActions.push(w)}_execute(w,p){w.timeoutId&&(clearTimeout(w.timeoutId),delete w.timeoutId),super._execute(w,((e,r)=>{p(e,(()=>{r(),w.idle&&(w.timeoutId=setTimeout((()=>{w.workerPromise.then((w=>{w.terminate()}));const p=this._workerInfos.indexOf(w);-1!==p&&this._workerInfos.splice(p,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}I.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11723:(w,p,e)=>{e.d(p,{e:()=>X});var r=e(11207),I=e(11056),d=e(11051),f=e(11232),q=e(11213),E=e(11301),j=e(11038);class X{get influence(){return this._influence}set influence(w){if(this._influence===w)return;const p=this._influence;this._influence=w,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===p||0===w)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(w){this._animationPropertiesOverride=w}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=w,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new I.d,this._onDataLayoutChanged=new I.d,this._animationPropertiesOverride=null,this.id=w,this._scene=e||d.d.LastCreatedScene,this.influence=p,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(w){const p=this.hasPositions;this._positions=w,p!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(w){const p=this.hasNormals;this._normals=w,p!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(w){const p=this.hasTangents;this._tangents=w,p!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(w){const p=this.hasUVs;this._uvs=w,p!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(w){const p=this.hasUV2s;this._uv2s=w,p!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(w){const p=this.hasColors;this._colors=w,p!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const w=E.e.Clone((()=>new X(this.name,this.influence,this._scene)),this);return w._positions=this._positions,w._normals=this._normals,w._tangents=this._tangents,w._uvs=this._uvs,w._uv2s=this._uv2s,w._colors=this._colors,w}serialize(){const w={};return w.name=this.name,w.influence=this.influence,w.nw=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(w.id=this.id),this.hasNormals&&(w.lw=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(w.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(w.Uw=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(w.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(w.Nw=Array.prototype.slice.call(this.getColors())),E.e.AppendSerializedAnimations(this,w),w}getClassName(){return"MorphTarget"}static Parse(w,p){const e=new X(w.name,w.influence);if(e.setPositions(w.nw),null!=w.id&&(e.id=w.id),w.lw&&e.setNormals(w.lw),w.tangents&&e.setTangents(w.tangents),w.Uw&&e.setUVs(w.Uw),w.uv2s&&e.setUV2s(w.uv2s),w.Nw&&e.setColors(w.Nw),w.animations){for(let p=0;p<w.animations.length;p++){const r=w.animations[p],I=(0,j.c)("BABYLON.Animation");I&&e.animations.push(I.Parse(r))}w.autoAnimate&&p&&p.beginAnimation(e,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1)}return e}static FromMesh(w,p,e){p||(p=w.name);const r=new X(p,e,w.iw());return r.setPositions(w.getVerticesData(f.e.PositionKind)),w.isVerticesDataPresent(f.e.NormalKind)&&r.setNormals(w.getVerticesData(f.e.NormalKind)),w.isVerticesDataPresent(f.e.TangentKind)&&r.setTangents(w.getVerticesData(f.e.TangentKind)),w.isVerticesDataPresent(f.e.UVKind)&&r.setUVs(w.getVerticesData(f.e.UVKind)),w.isVerticesDataPresent(f.e.UV2Kind)&&r.setUV2s(w.getVerticesData(f.e.UV2Kind)),w.isVerticesDataPresent(f.e.ColorKind)&&r.setColors(w.getVerticesData(f.e.ColorKind)),r}}(0,r.c)([(0,q.J)()],X.prototype,"id",void 0)},11530:(w,p,e)=>{e.d(p,{b:()=>K});var r=e(11207),I=e(11376),d=e(11056),f=e(11023),q=e(11139),E=e(11213),j=e(11301),X=e(11038),k=e(11132),m=e(11194),J=e(11537);k.d.prototype.setTextureFromPostProcess=function(w,p,e){var r;let I=null;p&&(p._forcedOutputTexture?I=p._forcedOutputTexture:p._textures.data[p._currentRenderTextureInd]&&(I=p._textures.data[p._currentRenderTextureInd])),this._bindTexture(w,(null===(r=I)||void 0===r?void 0:r.texture)??null,e)},k.d.prototype.setTextureFromPostProcessOutput=function(w,p,e){var r;this._bindTexture(w,(null===p||void 0===p||null===(r=p._outputTexture)||void 0===r?void 0:r.texture)??null,e)},q.e.prototype.setTextureFromPostProcess=function(w,p){this._engine.setTextureFromPostProcess(this._samplers[w],p,w)},q.e.prototype.setTextureFromPostProcessOutput=function(w,p){this._engine.setTextureFromPostProcessOutput(this._samplers[w],p,w)};class K{static get ForceGLSL(){return J.g.ForceGLSL}static set ForceGLSL(w){J.g.ForceGLSL=w}static RegisterShaderCodeProcessing(w,p){J.g.RegisterShaderCodeProcessing(w,p)}get name(){return this._effectWrapper.name}set name(w){this._effectWrapper.name=w}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(w){this._effectWrapper.alphaMode=w}get samples(){return this._samples}set samples(w){this._samples=Math.min(w,this._engine.getCaps().maxMSAASamples),this._textures.forEach((w=>{w.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(w){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),w&&(this._onActivateObserver=this.onActivateObservable.add(w))}set onSizeChanged(w){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(w)}set onApply(w){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(w)}set onBeforeRender(w){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(w)}set onAfterRender(w){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(w)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(w){this._forcedOutputTexture=w}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.te(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(w,p,e,r,q,E){var j;let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,k=arguments.length>7?arguments[7]:void 0,m=arguments.length>8?arguments[8]:void 0,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,s=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",O=arguments.length>12?arguments[12]:void 0,a=arguments.length>13&&void 0!==arguments[13]&&arguments[13],A=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,z=arguments.length>15?arguments[15]:void 0,M=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.wm=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new I.e(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new f.g(1,1),this._texelSize=f.g.Zero(),this.onActivateObservable=new d.d,this.onSizeChangedObservable=new d.d,this.onApplyObservable=new d.d,this.onBeforeRenderObservable=new d.d,this.onAfterRenderObservable=new d.d,this.ue=new d.d;let i,t=1,n=null;if(e&&!Array.isArray(e)){const w=e;e=w.uniforms??null,r=w.samplers??null,t=w.size??1,E=w.camera??null,X=w.samplingMode??1,k=w.wE,m=w.reusable,y=Array.isArray(w.defines)?w.defines.join("\n"):w.defines??null,c=w.textureType??0,s=w.vertexUrl??"postprocess",O=w.indexParameters,a=w.blockCompilation??!1,A=w.textureFormat??5,z=w.shaderLanguage??0,n=w.uniformBuffers??null,M=w.extraInitializations,i=w.effectWrapper}else q&&(t="number"===typeof q?q:{width:q.width,height:q.height});if(this._useExistingThinPostProcess=!!i,this._effectWrapper=i??new J.g({name:w,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:p,wE:k||(null===(j=E)||void 0===j?void 0:j.iw().getEngine()),uniforms:e,samplers:r,uniformBuffers:n,defines:y,vertexUrl:s,indexParameters:O,blockCompilation:!0,shaderLanguage:z,extraInitializations:void 0}),this.name=w,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=E?(this._camera=E,this._scene=E.iw(),E.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):k&&(this._engine=k,this._engine.postProcesses.push(this)),this._options=t,this.renderTargetSamplingMode=X||1,this._reusable=m||!1,this._textureType=c,this._textureFormat=A,this._shaderLanguage=z||0,this._samplers=r||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=p,this._vertexUrl=s,this._parameters=e||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=n||[],this._indexParameters=O,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const w=[];this._gatherImports(this._engine.isWebGPU&&!K.ForceGLSL,w),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(a,y,M,w)}}_gatherImports(){let w=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?w.push(Promise.all([e.e(42).then(e.bind(e,13719))])):w.push(Promise.all([Promise.resolve().then(e.bind(e,11540))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(w){return this._disposeTextures(),this._shareOutputWithPostProcess=w,this}useOwnOutput(){0==this._textures.length&&(this._textures=new I.e(2)),this._shareOutputWithPostProcess=null}updateEffect(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(w,p,e,r,I,d,f,q),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let I=0;I<this._textureCache.length;I++)if(this._textureCache[I].texture.width===w.width&&this._textureCache[I].texture.height===w.height&&this._textureCache[I].postProcessChannel===e&&this._textureCache[I].texture._generateDepthBuffer===p.generateDepthBuffer&&this._textureCache[I].texture.samples===p.samples)return this._textureCache[I].texture;const r=this._engine.createRenderTargetTexture(w,p);return this._textureCache.push({texture:r,postProcessChannel:e,lastUsedRenderId:-1}),r}_flushTextureCache(){const w=this._renderId;for(let p=this._textureCache.length-1;p>=0;p--)if(w-this._textureCache[p].lastUsedRenderId>100){let w=!1;for(let e=0;e<this._textures.length;e++)if(this._textures.data[e]===this._textureCache[p].texture){w=!0;break}w||(this._textureCache[p].texture.dispose(),this._textureCache.splice(p,1))}}resize(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=w,this.height=p;let d=null;if(e)for(let E=0;E<e._postProcesses.length;E++)if(null!==e._postProcesses[E]){d=e._postProcesses[E];break}const f={width:this.width,height:this.height},q={generateMipMaps:r,generateDepthBuffer:I||d===this,generateStencilBuffer:(I||d===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(f,q,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(f,q,1)),this._texelSize.te(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let w;if(this._shareOutputWithPostProcess)w=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)w=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let p;w=this.inputTexture;for(let e=0;e<this._textureCache.length;e++)if(this._textureCache[e].texture===w){p=this._textureCache[e];break}p&&(p.lastUsedRenderId=this._renderId)}return w}activate(w){var p,e;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;const d=null===w||void 0!==w.cameraRigMode?w||this._camera:null,f=(null===d||void 0===d?void 0:d.iw())??w,q=f.getEngine(),E=q.getCaps().maxTextureSize,j=(r?r.width:this._engine.getRenderWidth(!0))*this._options|0,X=(r?r.height:this._engine.getRenderHeight(!0))*this._options|0;let k=this._options.width||j,J=this._options.height||X;const K=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let y=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const w=q.currentViewport;w&&(k*=w.width,J*=w.height)}(K||this.alwaysForcePOT)&&(this._options.width||(k=q.needPOTTextures?(0,m.f)(k,E,this.scaleMode):k),this._options.height||(J=q.needPOTTextures?(0,m.f)(J,E,this.scaleMode):J)),this.width===k&&this.height===J&&(y=this._getTarget())||this.resize(k,J,d,K,I),this._textures.forEach((w=>{w.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(w,this.samples)})),this._flushTextureCache(),this._renderId++}return y||(y=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.te(j/k,X/J),this._engine.bindFramebuffer(y,0,j,X,this.forceFullscreenViewport)):(this._scaleRatio.te(1,1),this._engine.bindFramebuffer(y,0,void 0,void 0,this.forceFullscreenViewport)),null===(p=(e=this._engine)._debugInsertMarker)||void 0===p||p.call(e,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(d),this.wm&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:f.clearColor,f._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),y}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let w;var p;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),w=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(p=w)||void 0===p?void 0:p.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let w=this._textureCache.length-1;w>=0;w--)this._textureCache[w].texture.dispose();this._textureCache.length=0}setPrePassRenderer(w){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=w.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(w){let p;if(w=w||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(p=this._scene.postProcesses.indexOf(this),-1!==p&&this._scene.postProcesses.splice(p,1)),this._parentContainer){const w=this._parentContainer.postProcesses.indexOf(this);w>-1&&this._parentContainer.postProcesses.splice(w,1),this._parentContainer=null}if(p=this._engine.postProcesses.indexOf(this),-1!==p&&this._engine.postProcesses.splice(p,1),this.ue.notifyObservers(),w){if(w.detachPostProcess(this),p=w._postProcesses.indexOf(this),0===p&&w._postProcesses.length>0){const w=this._camera._getFirstPostProcess();w&&w.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const w=j.e.Serialize(this),p=this.getCamera()||this._scene&&this._scene.activeCamera;return w.customType="BABYLON."+this.getClassName(),w.cameraId=p?p.id:null,w.reusable=this._reusable,w.textureType=this._textureType,w.fragmentUrl=this._fragmentUrl,w.parameters=this._parameters,w.samplers=this._samplers,w.uniformBuffers=this._uniformBuffers,w.options=this._options,w.defines=this._postProcessDefines,w.textureFormat=this._textureFormat,w.vertexUrl=this._vertexUrl,w.indexParameters=this._indexParameters,w}clone(){const w=this.serialize();w._engine=this._engine,w.cameraId=null;const p=K.Parse(w,this._scene,"");return p?(p.onActivateObservable=this.onActivateObservable.clone(),p.onSizeChangedObservable=this.onSizeChangedObservable.clone(),p.onApplyObservable=this.onApplyObservable.clone(),p.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),p.onAfterRenderObservable=this.onAfterRenderObservable.clone(),p._prePassEffectConfiguration=this._prePassEffectConfiguration,p):null}static Parse(w,p,e){const r=(0,X.c)(w.customType);if(!r||!r._Parse)return null;const I=p?p.getCameraById(w.cameraId):null;return r._Parse(w,I,p,e)}static _Parse(w,p,e,r){return j.e.Parse((()=>new K(w.name,w.fragmentUrl,w.parameters,w.samplers,w.options,p,w.renderTargetSamplingMode,w._engine,w.reusable,w.defines,w.textureType,w.vertexUrl,w.indexParameters,!1,w.textureFormat)),w,e,r)}}(0,r.c)([(0,E.J)()],K.prototype,"uniqueId",void 0),(0,r.c)([(0,E.J)()],K.prototype,"name",null),(0,r.c)([(0,E.J)()],K.prototype,"width",void 0),(0,r.c)([(0,E.J)()],K.prototype,"height",void 0),(0,r.c)([(0,E.J)()],K.prototype,"renderTargetSamplingMode",void 0),(0,r.c)([(0,E.k)()],K.prototype,"clearColor",void 0),(0,r.c)([(0,E.J)()],K.prototype,"wm",void 0),(0,r.c)([(0,E.J)()],K.prototype,"forceAutoClearInAlphaMode",void 0),(0,r.c)([(0,E.J)()],K.prototype,"alphaMode",null),(0,r.c)([(0,E.J)()],K.prototype,"alphaConstants",void 0),(0,r.c)([(0,E.J)()],K.prototype,"enablePixelPerfectMode",void 0),(0,r.c)([(0,E.J)()],K.prototype,"forceFullscreenViewport",void 0),(0,r.c)([(0,E.J)()],K.prototype,"scaleMode",void 0),(0,r.c)([(0,E.J)()],K.prototype,"alwaysForcePOT",void 0),(0,r.c)([(0,E.J)("samples")],K.prototype,"_samples",void 0),(0,r.c)([(0,E.J)()],K.prototype,"adaptScaleToCurrentViewport",void 0),(0,X.d)("BABYLON.PostProcess",K)},11519:(w,p,e)=>{e.d(p,{d:()=>d});var r=e(11232),I=e(11056);class d{constructor(w){this._vertexBuffers={},this.onBeforeRenderObservable=new I.d,this._scene=w}_prepareBuffers(){if(this._vertexBuffers[r.e.PositionKind])return;const w=[];w.push(1,1),w.push(-1,1),w.push(-1,-1),w.push(1,-1),this._vertexBuffers[r.e.PositionKind]=new r.e(this._scene.getEngine(),w,r.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const w=[];w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(w)}_rebuild(){const w=this._vertexBuffers[r.e.PositionKind];w&&(w._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.activeCamera;return!!e&&(p=p||e._postProcesses.filter((w=>null!=w)),!(!p||0===p.length||!this._scene.postProcessesEnabled)&&(p[0].activate(e,w,null!==p&&void 0!==p),!0))}directRender(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.length;const q=this._scene.getEngine();for(let j=0;j<f;j++){var E;if(j<w.length-1)w[j+1].activate(this._scene.activeCamera||this._scene,null===p||void 0===p?void 0:p.texture);else p?q.bindFramebuffer(p,r,void 0,void 0,e,I):d||q.restoreDefaultFramebuffer(),null===(E=q._debugInsertMarker)||void 0===E||E.call(q,`post process ${w[j].name} output`);const f=w[j],X=f.apply();X&&(f.onBeforeRenderObservable.notifyObservers(X),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,X),q.drawElementsType(0,0,6),f.onAfterRenderObservable.notifyObservers(X))}q.setDepthBuffer(!0),q.setDepthWrite(!0)}_finalizeFrame(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this._scene.activeCamera;if(!d)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(r=r||d._postProcesses.filter((w=>null!=w))).length||!this._scene.postProcessesEnabled)return;const f=this._scene.getEngine();for(let E=0,j=r.length;E<j;E++){const X=r[E];var q;if(E<j-1)X._outputTexture=r[E+1].activate(d,null===p||void 0===p?void 0:p.texture);else p?(f.bindFramebuffer(p,e,void 0,void 0,I),X._outputTexture=p):(f.restoreDefaultFramebuffer(),X._outputTexture=null),null===(q=f._debugInsertMarker)||void 0===q||q.call(f,`post process ${r[E].name} output`);if(w)break;const k=X.apply();k&&(X.onBeforeRenderObservable.notifyObservers(k),this._prepareBuffers(),f.bindBuffers(this._vertexBuffers,this._indexBuffer,k),f.drawElementsType(0,0,6),X.onAfterRenderObservable.notifyObservers(k))}f.setDepthBuffer(!0),f.setDepthWrite(!0),f.setAlphaMode(0)}dispose(){const w=this._vertexBuffers[r.e.PositionKind];w&&(w.dispose(),this._vertexBuffers[r.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11526:(w,p,e)=>{e.d(p,{b:()=>q});var r=e(11376),I=e(11023);class d{set opaqueSortCompareFn(w){this._opaqueSortCompareFn=w||d.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(w){this._alphaTestSortCompareFn=w||d.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(w){this._transparentSortCompareFn=w||d.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=w,this._opaqueSubMeshes=new r.e(256),this._transparentSubMeshes=new r.e(256),this._alphaTestSubMeshes=new r.e(256),this._depthOnlySubMeshes=new r.e(256),this._particleSystems=new r.e(256),this._spriteManagers=new r.e(256),this._empty=!0,this._edgesRenderers=new r.b(16),this._scene=p,this.opaqueSortCompareFn=e,this.alphaTestSortCompareFn=I,this.transparentSortCompareFn=d}render(w,p,e,r){if(w)return void w(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const I=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(I.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),I.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const d=I.getStencilBuffer();if(I.setStencilBuffer(!1),p&&this._renderSprites(),e&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(I.setStencilBuffer(d),this._scene.useOrderIndependentTransparency){const w=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);w.length&&this._renderTransparent(w)}else this._renderTransparent(this._transparentSubMeshes);I.setAlphaMode(0)}if(I.setStencilBuffer(!1),this._edgesRenderers.length){for(let w=0;w<this._edgesRenderers.length;w++)this._edgesRenderers.data[w].render();I.setAlphaMode(0)}I.setStencilBuffer(d)}_renderOpaqueSorted(w){d._RenderSorted(w,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(w){d._RenderSorted(w,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(w){d._RenderSorted(w,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(w,p,e,r){let f,q=0;const E=e?e.globalPosition:d._ZeroVector;if(r)for(;q<w.length;q++)f=w.data[q],f._alphaIndex=f.getMesh().alphaIndex,f._distanceToCamera=I.k.Distance(f.getBoundingInfo().boundingSphere.centerWorld,E);const j=w.length===w.data.length?w.data:w.data.slice(0,w.length);p&&j.sort(p);const X=j[0].getMesh().iw();for(q=0;q<j.length;q++)if(f=j[q],!X._activeMeshesFrozenButKeepClipping||f.isInFrustum(X._frustumPlanes)){if(r){const w=f.Yw();if(w&&w.needDepthPrePass){const p=w.iw().getEngine();p.setColorWrite(!1),p.setAlphaMode(0),f.render(!1),p.setColorWrite(!0)}}f.render(r)}}static defaultTransparentSortCompare(w,p){return w._alphaIndex>p._alphaIndex?1:w._alphaIndex<p._alphaIndex?-1:d.backToFrontSortCompare(w,p)}static backToFrontSortCompare(w,p){return w._distanceToCamera<p._distanceToCamera?1:w._distanceToCamera>p._distanceToCamera?-1:0}static frontToBackSortCompare(w,p){return w._distanceToCamera<p._distanceToCamera?-1:w._distanceToCamera>p._distanceToCamera?1:0}static PainterSortCompare(w,p){const e=w.getMesh(),r=p.getMesh();return e.material&&r.material?e.material.uniqueId-r.material.uniqueId:e.uniqueId-r.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(w,p,e){void 0===p&&(p=w.getMesh()),void 0===e&&(e=w.Yw()),null!==e&&void 0!==e&&(e.needAlphaBlendingForMesh(p)?this._transparentSubMeshes.push(w):e.needAlphaTestingForMesh(p)?(e.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._alphaTestSubMeshes.push(w)):(e.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._opaqueSubMeshes.push(w)),p._renderingGroup=this,p._edgesRenderer&&p.isEnabled()&&p.isVisible&&p._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(p._edgesRenderer),this._empty=!1)}dispatchSprites(w){this._spriteManagers.push(w),this._empty=!1}dispatchParticles(w){this._particleSystems.push(w),this._empty=!1}_renderParticles(w){if(0===this._particleSystems.length)return;const p=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let e=0;e<this._particleSystems.length;e++){const r=this._particleSystems.data[e];if(0===(p&&p.layerMask&r.layerMask))continue;const I=r.i;I.position&&w&&-1===w.indexOf(I)||this._scene._activeParticles.addCount(r.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const w=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let p=0;p<this._spriteManagers.length;p++){const e=this._spriteManagers.data[p];0!==(w&&w.layerMask&e.layerMask)&&e.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}d._ZeroVector=I.k.Zero();class f{}class q{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(w){w!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=w,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const w of this._scene.meshes)if(w.oe)for(const p of w.oe)p._wasDispatched=!1;if(this._scene.spriteManagers)for(const w of this._scene.spriteManagers)w._wasDispatched=!1;for(const w of this._scene.tm)w._wasDispatched=!1}constructor(w){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new f,this._maintainStateBetweenFrames=!1,this._scene=w;for(let p=q.MIN_RENDERINGGROUPS;p<q.MAX_RENDERINGGROUPS;p++)this._autoClearDepthStencil[p]={wm:!0,depth:!0,stencil:!0}}getRenderingGroup(w){const p=w||0;return this._prepareRenderingGroup(p),this._renderingGroups[p]}_clearDepthStencilBuffer(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,w,p),this._depthStencilBufferAlreadyCleaned=!0)}render(w,p,e,r){const I=this._renderingGroupInfo;if(I.yp=this._scene,I.camera=this._scene.activeCamera,I.renderingManager=this,this._scene.spriteManagers&&r)for(let d=0;d<this._scene.spriteManagers.length;d++){const w=this._scene.spriteManagers[d];this.dispatchSprites(w)}for(let d=q.MIN_RENDERINGGROUPS;d<q.MAX_RENDERINGGROUPS;d++){this._depthStencilBufferAlreadyCleaned=d===q.MIN_RENDERINGGROUPS;const f=this._renderingGroups[d];if(!f||f._empty)continue;const E=1<<d;if(I.renderingGroupId=d,this._scene.onBeforeRenderingGroupObservable.notifyObservers(I,E),q.AUTOCLEAR){const w=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(d):this._autoClearDepthStencil[d];w&&w.wm&&this._clearDepthStencilBuffer(w.depth,w.stencil)}for(const w of this._scene._beforeRenderingGroupDrawStage)w.action(d);f.render(w,r,e,p);for(const w of this._scene._afterRenderingGroupDrawStage)w.action(d);this._scene.onAfterRenderingGroupObservable.notifyObservers(I,E)}}reset(){if(!this.maintainStateBetweenFrames)for(let w=q.MIN_RENDERINGGROUPS;w<q.MAX_RENDERINGGROUPS;w++){const p=this._renderingGroups[w];p&&p.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let w=q.MIN_RENDERINGGROUPS;w<q.MAX_RENDERINGGROUPS;w++){const p=this._renderingGroups[w];p&&p.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let w=q.MIN_RENDERINGGROUPS;w<q.MAX_RENDERINGGROUPS;w++){const p=this._renderingGroups[w];p&&p.dispose()}}_prepareRenderingGroup(w){void 0===this._renderingGroups[w]&&(this._renderingGroups[w]=new d(w,this._scene,this._customOpaqueSortCompareFn[w],this._customAlphaTestSortCompareFn[w],this._customTransparentSortCompareFn[w]))}dispatchSprites(w){this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatchSprites(w))}dispatchParticles(w){this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatchParticles(w))}dispatch(w,p,e){void 0===p&&(p=w.getMesh()),this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(p.renderingGroupId).dispatch(w,p,e))}setRenderingOrder(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[w]=p,this._customAlphaTestSortCompareFn[w]=e,this._customTransparentSortCompareFn[w]=r,this._renderingGroups[w]){const p=this._renderingGroups[w];p.opaqueSortCompareFn=this._customOpaqueSortCompareFn[w],p.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[w],p.transparentSortCompareFn=this._customTransparentSortCompareFn[w]}}setRenderingAutoClearDepthStencil(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[w]={wm:p,depth:e,stencil:r}}getAutoClearDepthStencilSetup(w){return this._autoClearDepthStencil[w]}}q.MAX_RENDERINGGROUPS=4,q.MIN_RENDERINGGROUPS=0,q.AUTOCLEAR=!0},11540:(w,p,e)=>{e.r(p),e.d(p,{postprocessVertexShader:()=>f});var r=e(11146);const I="postprocessVertexShader",d="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";r.e.ShadersStore[I]||(r.e.ShadersStore[I]=d);const f={name:I,shader:d}},11632:(w,p,e)=>{e.d(p,{e:()=>r});class r{}r._IsPickingAvailable=!1},11331:(w,p,e)=>{e.d(p,{b:()=>k});var r=e(11207),I=e(11023),d=e(11213),f=e(11056),q=e(11051),E=e(11094),j=e(11301);class X{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new f.d,this._onClonedObservable=new f.d}}class k{static AddNodeConstructor(w,p){this._NodeConstructors[w]=p}static Construct(w,p,e,r){const I=this._NodeConstructors[w];return I?I(p,e,r):null}set accessibilityTag(w){this._accessibilityTag=w,this.onAccessibilityTagChangedObservable.notifyObservers(w)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(w){this._nodeDataStorage._doNotSerialize=w}K(){return this._nodeDataStorage._isDisposed}set parent(w){if(this._parentNode===w)return;const p=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const p=this._parentNode._children.indexOf(this);-1!==p&&this._parentNode._children.splice(p,1),w||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=w,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),p||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(w){w.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const w=this._scene.rootNodes,p=w.length-1;w[this._nodeDataStorage._sceneRootNodesIndex]=w[p],w[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(w){this._animationPropertiesOverride=w}getClassName(){return"Node"}set onDispose(w){this._onDisposeObserver&&this.ue.remove(this._onDisposeObserver),this._onDisposeObserver=this.ue.add(w)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new X,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new f.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=I.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.ue=new f.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=w,this.id=w,this._scene=p||q.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),e&&this._addToSceneRootNodes()}iw(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(w)||(w.init(),this._scene.isLoading&&!p?this._scene.onDataLoadedObservable.addOnce((()=>{w.attach(this)})):w.attach(this),this._behaviors.push(w)),this}removeBehavior(w){const p=this._behaviors.indexOf(w);return-1===p||(this._behaviors[p].detach(),this._behaviors.splice(p,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(w){for(const p of this._behaviors)if(p.name===w)return p;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.ke(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(w){!w&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(w){return this.parent?this.parent._getActionManagerForTrigger(w,!1):null}_updateCache(w){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}kX(w){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const w of this._children)w._syncParentEnabledState()}yE(w){this._nodeDataStorage._isEnabled!==w&&(this._nodeDataStorage._isEnabled=w,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(w))}isDescendantOf(w){return!!this.parent&&(this.parent===w||this.parent.isDescendantOf(w))}_getDescendants(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;if(this._children)for(let r=0;r<this._children.length;r++){const I=this._children[r];e&&!e(I)||w.push(I),p||I._getDescendants(w,!1,e)}}getDescendants(w,p){const e=[];return this._getDescendants(e,w,p),e}getChildMeshes(w,p){const e=[];return this._getDescendants(e,w,(w=>(!p||p(w))&&void 0!==w.Pk)),e}getChildren(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(p,w)}_setReady(w){w!==this._nodeDataStorage._isReady&&(w?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(w){for(let p=0;p<this.animations.length;p++){const e=this.animations[p];if(e.name===w)return e}return null}createAnimationRange(w,p,e){if(!this._ranges[w]){this._ranges[w]=k._AnimationRangeFactory(w,p,e);for(let r=0,I=this.animations.length;r<I;r++)this.animations[r]&&this.animations[r].createRange(w,p,e)}}deleteAnimationRange(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let e=0,r=this.animations.length;e<r;e++)this.animations[e]&&this.animations[e].deleteRange(w,p);this._ranges[w]=null}getAnimationRange(w){return this._ranges[w]||null}clone(w,p,e){const r=j.e.Clone((()=>new k(w,this.iw())),this);if(p&&(r.parent=p),!e){const p=this.getDescendants(!0);for(let e=0;e<p.length;e++){const I=p[e];I.clone(w+"."+I.name,r)}}return r}getAnimationRanges(){const w=[];let p;for(p in this._ranges)w.push(this._ranges[p]);return w}beginAnimation(w,p,e,r){const I=this.getAnimationRange(w);return I?this._scene.beginAnimation(this,I.from,I.to,p,e,r):null}serializeAnimationRanges(){const w=[];for(const p in this._ranges){const e=this._ranges[p];if(!e)continue;const r={};r.name=p,r.from=e.from,r.to=e.to,w.push(r)}return w}ke(w){return this._worldMatrix||(this._worldMatrix=I.b.Identity()),this._worldMatrix}dispose(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!w){const e=this.getDescendants(!0);for(const r of e)r.dispose(w,p)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.ue.notifyObservers(this),this.ue.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(w,p,e){if(p.ranges)for(let r=0;r<p.ranges.length;r++){const e=p.ranges[r];w.createAnimationRange(e.name,e.from,e.to)}}getHierarchyBoundingVectors(){let w,p,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.iw().incrementRenderId(),this.ke(!0);const d=this;if(d.getBoundingInfo&&d.oe){const e=d.getBoundingInfo();w=e.boundingBox.minimumWorld.clone(),p=e.boundingBox.maximumWorld.clone()}else w=new I.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new I.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const d of e){const e=d;if(e.ke(!0),r&&!r(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const f=e.getBoundingInfo().boundingBox,q=f.minimumWorld,E=f.maximumWorld;I.k.CheckExtends(q,w,p),I.k.CheckExtends(E,w,p)}}return{min:w,max:p}}}k._AnimationRangeFactory=(w,p,e)=>{throw(0,E.c)("AnimationRange")},k._NodeConstructors={},(0,r.c)([(0,d.J)()],k.prototype,"name",void 0),(0,r.c)([(0,d.J)()],k.prototype,"id",void 0),(0,r.c)([(0,d.J)()],k.prototype,"uniqueId",void 0),(0,r.c)([(0,d.J)()],k.prototype,"state",void 0),(0,r.c)([(0,d.J)()],k.prototype,"metadata",void 0)},11590:(w,p,e)=>{e.d(p,{c:()=>ww});var r=e(11071),I=e(11088),d=e(11056),f=e(11376);class q{constructor(){this._count=0,this._data={}}X(w){this.clear(),w.forEach(((w,p)=>this.add(w,p)))}get(w){const p=this._data[w];if(void 0!==p)return p}getOrAddWithFactory(w,p){let e=this.get(w);return void 0!==e||(e=p(w),e&&this.add(w,e)),e}getOrAdd(w,p){const e=this.get(w);return void 0!==e?e:(this.add(w,p),p)}contains(w){return void 0!==this._data[w]}add(w,p){return void 0===this._data[w]&&(this._data[w]=p,++this._count,!0)}set(w,p){return void 0!==this._data[w]&&(this._data[w]=p,!0)}getAndRemove(w){const p=this.get(w);return void 0!==p?(delete this._data[w],--this._count,p):null}remove(w){return!!this.contains(w)&&(delete this._data[w],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(w){for(const p in this._data){w(p,this._data[p])}}first(w){for(const p in this._data){const e=w(p,this._data[p]);if(e)return e}return null}}var E=e(11304),j=e(11023),X=e(11593),k=e(11288),m=e(11354);class J{constructor(w,p,e,r,I,d){this.source=w,this.pointerX=p,this.pointerY=e,this.meshUnderPointer=r,this.sourceEvent=I,this.additionalData=d}static CreateNew(w,p,e){const r=w.iw();return new J(w,r.pointerX,r.pointerY,r.meshUnderPointer||w,p,e)}static CreateNewFromSprite(w,p,e,r){return new J(w,p.pointerX,p.pointerY,p.meshUnderPointer,e,r)}static CreateNewFromScene(w,p){return new J(null,w.pointerX,w.pointerY,w.meshUnderPointer,p)}static CreateNewFromPrimitive(w,p,e,r){return new J(w,p.x,p.y,null,e,r)}}var K=e(11519),y=e(11526),c=e(11408),s=e(11075),O=e(11051),a=e(11094),A=e(11611);class z{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const w in z.Triggers)if(Object.prototype.hasOwnProperty.call(z.Triggers,w))return!0;return!1}static get HasPickTriggers(){for(const w in z.Triggers)if(Object.prototype.hasOwnProperty.call(z.Triggers,w)){const p=parseInt(w);if(p>=1&&p<=7)return!0}return!1}static HasSpecificTrigger(w){for(const p in z.Triggers)if(Object.prototype.hasOwnProperty.call(z.Triggers,p)){if(parseInt(p)===w)return!0}return!1}}z.Triggers={};var M,i,t,n,l,N,U,v=e(11619);!function(w){w[w.Generic=0]="Generic",w[w.Keyboard=1]="Keyboard",w[w.Mouse=2]="Mouse",w[w.Touch=3]="Touch",w[w.DualShock=4]="DualShock",w[w.Xbox=5]="Xbox",w[w.Switch=6]="Switch",w[w.DualSense=7]="DualSense"}(M||(M={})),function(w){w[w.Horizontal=0]="Horizontal",w[w.Vertical=1]="Vertical",w[w.LeftClick=2]="LeftClick",w[w.MiddleClick=3]="MiddleClick",w[w.RightClick=4]="RightClick",w[w.BrowserBack=5]="BrowserBack",w[w.BrowserForward=6]="BrowserForward",w[w.MouseWheelX=7]="MouseWheelX",w[w.MouseWheelY=8]="MouseWheelY",w[w.MouseWheelZ=9]="MouseWheelZ",w[w.Move=12]="Move"}(i||(i={})),function(w){w[w.Horizontal=0]="Horizontal",w[w.Vertical=1]="Vertical",w[w.LeftClick=2]="LeftClick",w[w.MiddleClick=3]="MiddleClick",w[w.RightClick=4]="RightClick",w[w.BrowserBack=5]="BrowserBack",w[w.BrowserForward=6]="BrowserForward",w[w.MouseWheelX=7]="MouseWheelX",w[w.MouseWheelY=8]="MouseWheelY",w[w.MouseWheelZ=9]="MouseWheelZ",w[w.DeltaHorizontal=10]="DeltaHorizontal",w[w.DeltaVertical=11]="DeltaVertical"}(t||(t={})),function(w){w[w.Cross=0]="Cross",w[w.Circle=1]="Circle",w[w.Square=2]="Square",w[w.Triangle=3]="Triangle",w[w.L1=4]="L1",w[w.R1=5]="R1",w[w.L2=6]="L2",w[w.R2=7]="R2",w[w.Share=8]="Share",w[w.Options=9]="Options",w[w.L3=10]="L3",w[w.R3=11]="R3",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.TouchPad=17]="TouchPad",w[w.LStickXAxis=18]="LStickXAxis",w[w.LStickYAxis=19]="LStickYAxis",w[w.RStickXAxis=20]="RStickXAxis",w[w.RStickYAxis=21]="RStickYAxis"}(n||(n={})),function(w){w[w.Cross=0]="Cross",w[w.Circle=1]="Circle",w[w.Square=2]="Square",w[w.Triangle=3]="Triangle",w[w.L1=4]="L1",w[w.R1=5]="R1",w[w.L2=6]="L2",w[w.R2=7]="R2",w[w.Create=8]="Create",w[w.Options=9]="Options",w[w.L3=10]="L3",w[w.R3=11]="R3",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.TouchPad=17]="TouchPad",w[w.LStickXAxis=18]="LStickXAxis",w[w.LStickYAxis=19]="LStickYAxis",w[w.RStickXAxis=20]="RStickXAxis",w[w.RStickYAxis=21]="RStickYAxis"}(l||(l={})),function(w){w[w.A=0]="A",w[w.B=1]="B",w[w.X=2]="X",w[w.Y=3]="Y",w[w.LB=4]="LB",w[w.RB=5]="RB",w[w.LT=6]="LT",w[w.RT=7]="RT",w[w.Back=8]="Back",w[w.Start=9]="Start",w[w.LS=10]="LS",w[w.RS=11]="RS",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.LStickXAxis=17]="LStickXAxis",w[w.LStickYAxis=18]="LStickYAxis",w[w.RStickXAxis=19]="RStickXAxis",w[w.RStickYAxis=20]="RStickYAxis"}(N||(N={})),function(w){w[w.B=0]="B",w[w.A=1]="A",w[w.Y=2]="Y",w[w.X=3]="X",w[w.L=4]="L",w[w.R=5]="R",w[w.ZL=6]="ZL",w[w.ZR=7]="ZR",w[w.Minus=8]="Minus",w[w.Plus=9]="Plus",w[w.LS=10]="LS",w[w.RS=11]="RS",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.Capture=17]="Capture",w[w.LStickXAxis=18]="LStickXAxis",w[w.LStickYAxis=19]="LStickYAxis",w[w.RStickXAxis=20]="RStickXAxis",w[w.RStickYAxis=21]="RStickYAxis"}(U||(U={}));var R=e(11623);class V{static CreateDeviceEvent(w,p,e,r,I,d,f){switch(w){case M.Keyboard:return this._CreateKeyboardEvent(e,r,I,d);case M.Mouse:if(e===i.MouseWheelX||e===i.MouseWheelY||e===i.MouseWheelZ)return this._CreateWheelEvent(w,p,e,r,I,d);case M.Touch:return this._CreatePointerEvent(w,p,e,r,I,d,f);default:throw`Unable to generate event for device ${M[w]}`}}static _CreatePointerEvent(w,p,e,r,I,d,f){const q=this._CreateMouseEvent(w,p,e,r,I,d);w===M.Mouse?(q.deviceType=M.Mouse,q.pointerId=1,q.pointerType="mouse"):(q.deviceType=M.Touch,q.pointerId=f??p,q.pointerType="touch");let E=0;return E+=I.pollInput(w,p,i.LeftClick),E+=2*I.pollInput(w,p,i.RightClick),E+=4*I.pollInput(w,p,i.MiddleClick),q.buttons=E,e===i.Move?q.type="pointermove":e>=i.LeftClick&&e<=i.RightClick&&(q.type=1===r?"pointerdown":"pointerup",q.button=e-2),q}static _CreateWheelEvent(w,p,e,r,I,d){const f=this._CreateMouseEvent(w,p,e,r,I,d);switch(f.pointerId=1,f.type="wheel",f.deltaMode=R.c.DOM_DELTA_PIXEL,f.deltaX=0,f.deltaY=0,f.deltaZ=0,e){case i.MouseWheelX:f.deltaX=r;break;case i.MouseWheelY:f.deltaY=r;break;case i.MouseWheelZ:f.deltaZ=r}return f}static _CreateMouseEvent(w,p,e,r,I,d){const f=this._CreateEvent(d),q=I.pollInput(w,p,i.Horizontal),E=I.pollInput(w,p,i.Vertical);return d?(f.movementX=0,f.movementY=0,f.offsetX=f.movementX-d.getBoundingClientRect().x,f.offsetY=f.movementY-d.getBoundingClientRect().y):(f.movementX=I.pollInput(w,p,10),f.movementY=I.pollInput(w,p,11),f.offsetX=0,f.offsetY=0),this._CheckNonCharacterKeys(f,I),f.clientX=q,f.clientY=E,f.x=q,f.y=E,f.deviceType=w,f.deviceSlot=p,f.inputIndex=e,f}static _CreateKeyboardEvent(w,p,e,r){const I=this._CreateEvent(r);return this._CheckNonCharacterKeys(I,e),I.deviceType=M.Keyboard,I.deviceSlot=0,I.inputIndex=w,I.type=1===p?"keydown":"keyup",I.key=String.fromCharCode(w),I.keyCode=w,I}static _CheckNonCharacterKeys(w,p){const e=p.isDeviceAvailable(M.Keyboard),r=e&&1===p.pollInput(M.Keyboard,0,18),I=e&&1===p.pollInput(M.Keyboard,0,17),d=e&&(1===p.pollInput(M.Keyboard,0,91)||1===p.pollInput(M.Keyboard,0,92)||1===p.pollInput(M.Keyboard,0,93)),f=e&&1===p.pollInput(M.Keyboard,0,16);w.altKey=r,w.ctrlKey=I,w.metaKey=d,w.shiftKey=f}static _CreateEvent(w){const p={preventDefault:()=>{}};return p.target=w,p}}class b{constructor(w,p,e){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(w,p,((w,p,r,I)=>{const d=V.CreateDeviceEvent(w,p,r,I,this);e(w,p,d)})):this._createDummyNativeInput()}pollInput(w,p,e){return this._nativeInput.pollInput(w,p,e)}isDeviceAvailable(w){return w===M.Mouse||w===M.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const h=Object.keys(i).length/2;class P{constructor(w,p,e,I){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=r.g.IsSafari(),this._usingMacOs=(0,s.h)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=w=>{},this._keyboardUpEvent=w=>{},this._keyboardBlurEvent=w=>{},this._pointerMoveEvent=w=>{},this._pointerDownEvent=w=>{},this._pointerUpEvent=w=>{},this._pointerCancelEvent=w=>{},this._pointerCancelTouch=w=>{},this._pointerLeaveEvent=w=>{},this._pointerWheelEvent=w=>{},this._pointerBlurEvent=w=>{},this._pointerMacOsChromeOutEvent=w=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,s.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,s.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=w=>{},this._gamepadDisconnectedEvent=w=>{},this._eventPrefix=r.g.GetPointerPrefix(w),this._engine=w,this._onDeviceConnected=p,this._onDeviceDisconnected=e,this._onInputChanged=I,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(w,p,e){const I=this._inputs[w][p];if(!I)throw`Unable to find device ${M[w]}`;w>=M.DualShock&&w<=M.DualSense&&this._updateDevice(w,p,e);const d=I[e];if(void 0===d)throw`Unable to find input ${e} for device ${M[w]} in slot ${p}`;return e===i.Move&&r.g.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),d}isDeviceAvailable(w){return void 0!==this._inputs[w]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const w=null===this||void 0===this?void 0:this._engine.getInputElement();if(w&&(!this._eventsAttached||this._elementToAttachTo!==w)){if(this._disableEvents(),this._inputs)for(const w of this._inputs)if(w)for(const p in w){const e=w[+p];if(e)for(let w=0;w<e.length;w++)e[w]=0}this._elementToAttachTo=w,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const w=navigator.getGamepads();for(const p of w)p&&this._addGamePad(p)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(M.Mouse,0,0,0)}_addGamePad(w){const p=this._getGamepadDeviceType(w.id),e=w.index;this._gamepads=this._gamepads||new Array(w.index+1),this._registerDevice(p,e,w.buttons.length+w.axes.length),this._gamepads[e]=p}_addPointerDevice(w,p,e,r){this._pointerActive||(this._pointerActive=!0),this._registerDevice(w,p,h);const I=this._inputs[w][p];I[0]=e,I[1]=r}_registerDevice(w,p,e){if(void 0===p)throw`Unable to register device ${M[w]} to undefined slot.`;if(this._inputs[w]||(this._inputs[w]={}),!this._inputs[w][p]){const r=new Array(e);r.fill(0),this._inputs[w][p]=r,this._onDeviceConnected(w,p)}}_unregisterDevice(w,p){this._inputs[w][p]&&(delete this._inputs[w][p],this._onDeviceDisconnected(w,p))}_handleKeyActions(){this._keyboardDownEvent=w=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(M.Keyboard,0,255));const p=this._inputs[M.Keyboard][0];if(p){p[w.keyCode]=1;const e=w;e.inputIndex=w.keyCode,this._usingMacOs&&w.metaKey&&"Meta"!==w.key&&(this._metaKeys.includes(w.keyCode)||this._metaKeys.push(w.keyCode)),this._onInputChanged(M.Keyboard,0,e)}},this._keyboardUpEvent=w=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(M.Keyboard,0,255));const p=this._inputs[M.Keyboard][0];if(p){p[w.keyCode]=0;const e=w;if(e.inputIndex=w.keyCode,this._usingMacOs&&"Meta"===w.key&&this._metaKeys.length>0){for(const w of this._metaKeys){const e=V.CreateDeviceEvent(M.Keyboard,0,w,0,this,this._elementToAttachTo);p[w]=0,this._onInputChanged(M.Keyboard,0,e)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(M.Keyboard,0,e)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const w=this._inputs[M.Keyboard][0];for(let p=0;p<w.length;p++)if(0!==w[p]){w[p]=0;const e=V.CreateDeviceEvent(M.Keyboard,0,p,0,this,this._elementToAttachTo);this._onInputChanged(M.Keyboard,0,e)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,s.h)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let r=0;r<this._maxTouchPoints;r++)this._activeTouchIds[r]=-1;this._pointerMoveEvent=w=>{const p=this._getPointerType(w);let e=p===M.Mouse?0:this._activeTouchIds.indexOf(w.pointerId);if(p===M.Touch&&-1===e){const I=this._activeTouchIds.indexOf(-1);if(!(I>=0))return void r.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);e=I,this._activeTouchIds[I]=w.pointerId,this._onDeviceConnected(p,e)}this._inputs[p]||(this._inputs[p]={}),this._inputs[p][e]||this._addPointerDevice(p,e,w.clientX,w.clientY);const I=this._inputs[p][e];if(I){const r=w;r.inputIndex=i.Move,I[i.Horizontal]=w.clientX,I[i.Vertical]=w.clientY,p===M.Touch&&0===I[i.LeftClick]&&(I[i.LeftClick]=1),void 0===w.pointerId&&(w.pointerId=this._mouseId),this._onInputChanged(p,e,r),this._usingSafari||-1===w.button||(r.inputIndex=w.button+2,I[w.button+2]=I[w.button+2]?0:1,this._onInputChanged(p,e,r))}},this._pointerDownEvent=w=>{const p=this._getPointerType(w);let e=p===M.Mouse?0:w.pointerId;if(p===M.Touch){let p=this._activeTouchIds.indexOf(w.pointerId);if(-1===p&&(p=this._activeTouchIds.indexOf(-1)),!(p>=0))return void r.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);e=p,this._activeTouchIds[p]=w.pointerId}this._inputs[p]||(this._inputs[p]={}),this._inputs[p][e]?p===M.Touch&&this._onDeviceConnected(p,e):this._addPointerDevice(p,e,w.clientX,w.clientY);const I=this._inputs[p][e];if(I){const r=I[i.Horizontal],f=I[i.Vertical];if(p===M.Mouse){if(void 0===w.pointerId&&(w.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(d){}}else if(w.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(w.pointerId)}catch(d){}I[i.Horizontal]=w.clientX,I[i.Vertical]=w.clientY,I[w.button+2]=1;const q=w;q.inputIndex=w.button+2,this._onInputChanged(p,e,q),r===w.clientX&&f===w.clientY||(q.inputIndex=i.Move,this._onInputChanged(p,e,q))}},this._pointerUpEvent=w=>{var p;const e=this._getPointerType(w),r=e===M.Mouse?0:this._activeTouchIds.indexOf(w.pointerId);if(e===M.Touch){if(-1===r)return;this._activeTouchIds[r]=-1}const I=null===(p=this._inputs[e])||void 0===p?void 0:p[r];let d=w.button,f=I&&0!==I[d+2];if(!f&&this._isUsingFirefox&&this._usingMacOs&&I&&(d=2===d?0:2,f=0!==I[d+2]),f){var q,E,j,X;const p=I[i.Horizontal],f=I[i.Vertical];I[i.Horizontal]=w.clientX,I[i.Vertical]=w.clientY,I[d+2]=0;const k=w;void 0===w.pointerId&&(w.pointerId=this._mouseId),p===w.clientX&&f===w.clientY||(k.inputIndex=i.Move,this._onInputChanged(e,r,k)),k.inputIndex=d+2,e===M.Mouse&&this._mouseId>=0&&null!==(q=(E=this._elementToAttachTo).hasPointerCapture)&&void 0!==q&&q.call(E,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):w.pointerId&&null!==(j=(X=this._elementToAttachTo).hasPointerCapture)&&void 0!==j&&j.call(X,w.pointerId)&&this._elementToAttachTo.releasePointerCapture(w.pointerId),this._onInputChanged(e,r,k),e===M.Touch&&this._onDeviceDisconnected(e,r)}},this._pointerCancelTouch=w=>{var p,e;const r=this._activeTouchIds.indexOf(w);if(-1===r)return;null!==(p=(e=this._elementToAttachTo).hasPointerCapture)&&void 0!==p&&p.call(e,w)&&this._elementToAttachTo.releasePointerCapture(w),this._inputs[M.Touch][r][i.LeftClick]=0;const I=V.CreateDeviceEvent(M.Touch,r,i.LeftClick,0,this,this._elementToAttachTo,w);this._onInputChanged(M.Touch,r,I),this._activeTouchIds[r]=-1,this._onDeviceDisconnected(M.Touch,r)},this._pointerCancelEvent=w=>{if("mouse"===w.pointerType){var p,e;const w=this._inputs[M.Mouse][0];this._mouseId>=0&&null!==(p=(e=this._elementToAttachTo).hasPointerCapture)&&void 0!==p&&p.call(e,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let p=i.LeftClick;p<=i.BrowserForward;p++)if(1===w[p]){w[p]=0;const e=V.CreateDeviceEvent(M.Mouse,0,p,0,this,this._elementToAttachTo);this._onInputChanged(M.Mouse,0,e)}}else this._pointerCancelTouch(w.pointerId)},this._pointerLeaveEvent=w=>{"pen"===w.pointerType&&this._pointerCancelTouch(w.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let w=!1;const p=function(){};try{const e=Object.defineProperty({},"passive",{get:function(){w=!0}});this._elementToAttachTo.addEventListener("test",p,e),this._elementToAttachTo.removeEventListener("test",p,e)}catch(e){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(M.Mouse)){var w,p;const e=this._inputs[M.Mouse][0];this._mouseId>=0&&null!==(w=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==w&&w.call(p,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let w=i.LeftClick;w<=i.BrowserForward;w++)if(1===e[w]){e[w]=0;const p=V.CreateDeviceEvent(M.Mouse,0,w,0,this,this._elementToAttachTo);this._onInputChanged(M.Mouse,0,p)}}if(this.isDeviceAvailable(M.Touch)){const w=this._inputs[M.Touch];for(let p=0;p<this._activeTouchIds.length;p++){var e,r,I;const d=this._activeTouchIds[p];if(null!==(e=(r=this._elementToAttachTo).hasPointerCapture)&&void 0!==e&&e.call(r,d)&&this._elementToAttachTo.releasePointerCapture(d),-1!==d&&1===(null===(I=w[p])||void 0===I?void 0:I[i.LeftClick])){w[p][i.LeftClick]=0;const e=V.CreateDeviceEvent(M.Touch,p,i.LeftClick,0,this,this._elementToAttachTo,d);this._onInputChanged(M.Touch,p,e),this._activeTouchIds[p]=-1,this._onDeviceDisconnected(M.Touch,p)}}}},this._pointerWheelEvent=w=>{const p=M.Mouse;this._inputs[p]||(this._inputs[p]=[]),this._inputs[p][0]||(this._pointerActive=!0,this._registerDevice(p,0,h));const e=this._inputs[p][0];if(e){e[i.MouseWheelX]=w.deltaX||0,e[i.MouseWheelY]=w.deltaY||w.wheelDelta||0,e[i.MouseWheelZ]=w.deltaZ||0;const r=w;void 0===w.pointerId&&(w.pointerId=this._mouseId),0!==e[i.MouseWheelX]&&(r.inputIndex=i.MouseWheelX,this._onInputChanged(p,0,r)),0!==e[i.MouseWheelY]&&(r.inputIndex=i.MouseWheelY,this._onInputChanged(p,0,r)),0!==e[i.MouseWheelZ]&&(r.inputIndex=i.MouseWheelZ,this._onInputChanged(p,0,r))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=w=>{w.buttons>1&&this._pointerCancelEvent(w)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!w&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(M.Mouse)){const w=this._inputs[M.Mouse][0];w[i.MouseWheelX]=0,w[i.MouseWheelY]=0,w[i.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=w=>{this._addGamePad(w.gamepad)},this._gamepadDisconnectedEvent=w=>{if(this._gamepads){const p=this._getGamepadDeviceType(w.gamepad.id),e=w.gamepad.index;this._unregisterDevice(p,e),delete this._gamepads[e]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(w,p,e){const r=navigator.getGamepads()[p];if(r&&w===this._gamepads[p]){const I=this._inputs[w][p];e>=r.buttons.length?I[e]=r.axes[e-r.buttons.length].valueOf():I[e]=r.buttons[e].value}}_getGamepadDeviceType(w){return-1!==w.indexOf("054c")?-1!==w.indexOf("0ce6")?M.DualSense:M.DualShock:-1!==w.indexOf("Xbox One")||-1!==w.search("Xbox 360")||-1!==w.search("xinput")?M.Xbox:-1!==w.indexOf("057e")?M.Switch:M.Generic}_getPointerType(w){let p=M.Mouse;return("touch"===w.pointerType||"pen"===w.pointerType||w.touches)&&(p=M.Touch),p}}class u{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=p,this.deviceSlot=e,this.onInputChangedObservable=new d.d,this._deviceInputSystem=w}getInput(w){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,w)}}class Y{constructor(w){this._registeredManagers=new Array,this._refCount=0,this.registerManager=w=>{for(let p=0;p<this._devices.length;p++){const e=this._devices[p];for(const r in e){const e=+r;w._addDevice(new u(this._deviceInputSystem,p,e))}}this._registeredManagers.push(w)},this.unregisterManager=w=>{const p=this._registeredManagers.indexOf(w);p>-1&&this._registeredManagers.splice(p,1)};const p=Object.keys(M).length/2;this._devices=new Array(p);const e=(w,p)=>{this._devices[w]||(this._devices[w]=new Array),this._devices[w][p]||(this._devices[w][p]=p);for(const e of this._registeredManagers){const r=new u(this._deviceInputSystem,w,p);e._addDevice(r)}},r=(w,p)=>{var e;null!==(e=this._devices[w])&&void 0!==e&&e[p]&&delete this._devices[w][p];for(const r of this._registeredManagers)r._removeDevice(w,p)},I=(w,p,e)=>{if(e)for(const r of this._registeredManagers)r._onInputChanged(w,p,e)};"undefined"!==typeof _native?this._deviceInputSystem=new b(e,r,I):this._deviceInputSystem=new P(w,e,r,I)}dispose(){this._deviceInputSystem.dispose()}}class L{getDeviceSource(w,p){if(void 0===p){if(void 0===this._firstDevice[w])return null;p=this._firstDevice[w]}return this._devices[w]&&void 0!==this._devices[w][p]?this._devices[w][p]:null}getDeviceSources(w){return this._devices[w]?this._devices[w].filter((w=>!!w)):[]}constructor(w){const p=Object.keys(M).length/2;this._devices=new Array(p),this._firstDevice=new Array(p),this._engine=w,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new Y(w)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new d.d((w=>{for(const p of this._devices)if(p)for(const e of p)e&&this.onDeviceConnectedObservable.notifyObserver(w,e)})),this.onDeviceDisconnectedObservable=new d.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=w.ue.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.ue.remove(this._onDisposeObserver)}_addDevice(w){this._devices[w.deviceType]||(this._devices[w.deviceType]=[]),this._devices[w.deviceType][w.deviceSlot]||(this._devices[w.deviceType][w.deviceSlot]=w,this._updateFirstDevices(w.deviceType)),this.onDeviceConnectedObservable.notifyObservers(w)}_removeDevice(w,p){var e,r;const I=null===(e=this._devices[w])||void 0===e?void 0:e[p];this.onDeviceDisconnectedObservable.notifyObservers(I),null!==(r=this._devices[w])&&void 0!==r&&r[p]&&delete this._devices[w][p],this._updateFirstDevices(w)}_onInputChanged(w,p,e){var r,I;null===(r=this._devices[w])||void 0===r||null===(I=r[p])||void 0===I||I.onInputChangedObservable.notifyObservers(e)}_updateFirstDevices(w){switch(w){case M.Keyboard:case M.Mouse:this._firstDevice[w]=0;break;case M.Touch:case M.DualSense:case M.DualShock:case M.Xbox:case M.Switch:case M.Generic:{delete this._firstDevice[w];const p=this._devices[w];if(p)for(let e=0;e<p.length;e++)if(p[e]){this._firstDevice[w]=e;break}break}}}}var W=e(11632);class F{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get cI(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(w){this._singleClick=w}set cI(w){this._doubleClick=w}set hasSwiped(w){this._hasSwiped=w}set ignore(w){this._ignore=w}}class H{constructor(w){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new j.g(0,0),this._previousStartingPointerPosition=new j.g(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=w||O.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(w){return this._meshUnderPointerId[w]||null}get unTranslatedPointer(){return new j.g(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(w){this._pointerX=w}get pointerY(){return this._pointerY}set pointerY(w){this._pointerY=w}_updatePointerPosition(w){const p=this._scene.getEngine().getInputElementClientRect();p&&(this._pointerX=w.clientX-p.left,this._pointerY=w.clientY-p.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(w,p){const e=this._scene,r=e.getEngine(),I=r.getInputElement();I&&(I.tabIndex=r.canvasTabIndex,e.doNotHandleCursors||(I.style.cursor=e.defaultCursor)),this._setCursorAndPointerOverMesh(w,p,e);for(const E of e._pointerMoveStage){var d;const e=!(null===(d=w=w||this._pickMove(p))||void 0===d||!d.pickedMesh);w=E.action(this._unTranslatedPointerX,this._unTranslatedPointerY,w,e,I)}const f=p.inputIndex>=i.MouseWheelX&&p.inputIndex<=i.MouseWheelZ?A.c.POINTERWHEEL:A.c.POINTERMOVE;let q;e.onPointerMove&&(w=w||this._pickMove(p),e.onPointerMove(p,w,f)),w?(q=new A.h(f,p,w),this._setRayOnPointerInfo(w,p)):(q=new A.h(f,p,null,this),this._movePointerInfo=q),e.onPointerObservable.hasObservers()&&e.onPointerObservable.notifyObservers(q,f)}_setRayOnPointerInfo(w,p){const e=this._scene;w&&W.e._IsPickingAvailable&&(w.ray||(w.ray=e.createPickingRay(p.offsetX,p.offsetY,j.b.Identity(),e.activeCamera)))}_addCameraPointerObserver(w,p){return this._cameraObserverCount++,this._scene.onPointerObservable.add(w,p)}_removeCameraPointerObserver(w){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(w)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(w,p,e){const r=this._scene,I=new A.d(e,p,this._unTranslatedPointerX,this._unTranslatedPointerY);return w&&(I.originalPickingInfo=w,I.ray=w.ray,"xr-near"===p.pointerType&&w.originMesh&&(I.nearInteractionPickingInfo=w)),r.onPrePointerObservable.notifyObservers(I,e),!!I.skipOnPointerObservable}_pickMove(w){const p=this._scene,e=p.Xe(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerMovePredicate,p.pointerMoveFastCheck,p.cameraToUseForPointers,p.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(e,w,p),e}_setCursorAndPointerOverMesh(w,p,e){const r=e.getEngine().getInputElement();if(null!==w&&void 0!==w&&w.pickedMesh){if(this.setPointerOverMesh(w.pickedMesh,p.pointerId,w,p),!e.doNotHandleCursors&&r&&this._pointerOverMesh){const w=this._pointerOverMesh._getActionManagerForTrigger();w&&w.hasPointerTriggers&&(r.style.cursor=w.hoverCursor||e.hoverCursor)}}else this.setPointerOverMesh(null,p.pointerId,w,p)}simulatePointerMove(w,p){const e=new PointerEvent("pointermove",p);e.inputIndex=i.Move,this._checkPrePointerObservable(w,e,A.c.POINTERMOVE)||this._processPointerMove(w,e)}simulatePointerDown(w,p){const e=new PointerEvent("pointerdown",p);e.inputIndex=e.button+2,this._checkPrePointerObservable(w,e,A.c.POINTERDOWN)||this._processPointerDown(w,e)}_processPointerDown(w,p){var e;const r=this._scene;if(null!==(e=w)&&void 0!==e&&e.pickedMesh){this._pickedDownMesh=w.pickedMesh;const e=w.pickedMesh._getActionManagerForTrigger();if(e){if(e.hasPickTriggers)switch(e.processTrigger(5,new J(w.pickedMesh,r.pointerX,r.pointerY,w.pickedMesh,p,w)),p.button){case 0:e.processTrigger(2,new J(w.pickedMesh,r.pointerX,r.pointerY,w.pickedMesh,p,w));break;case 1:e.processTrigger(4,new J(w.pickedMesh,r.pointerX,r.pointerY,w.pickedMesh,p,w));break;case 2:e.processTrigger(3,new J(w.pickedMesh,r.pointerX,r.pointerY,w.pickedMesh,p,w))}e.hasSpecificTrigger(8)&&window.setTimeout((()=>{const w=r.Xe(this._unTranslatedPointerX,this._unTranslatedPointerY,(w=>w.kj&&w.isVisible&&w.isReady()&&w.actionManager&&w.actionManager.hasSpecificTrigger(8)&&w===this._pickedDownMesh),!1,r.cameraToUseForPointers);null!==w&&void 0!==w&&w.pickedMesh&&e&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>H.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,e.processTrigger(8,J.CreateNew(w.pickedMesh,p)))}),H.LongPressDelay)}}else for(const f of r._pointerDownStage)w=f.action(this._unTranslatedPointerX,this._unTranslatedPointerY,w,p,!1);let I;const d=A.c.POINTERDOWN;w?(r.onPointerDown&&r.onPointerDown(p,w,d),I=new A.h(d,p,w),this._setRayOnPointerInfo(w,p)):I=new A.h(d,p,null,this),r.onPointerObservable.hasObservers()&&r.onPointerObservable.notifyObservers(I,d)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(w,p,e){const r=new PointerEvent("pointerup",p);r.inputIndex=i.Move;const I=new F;e?I.cI=!0:I.singleClick=!0,this._checkPrePointerObservable(w,r,A.c.POINTERUP)||this._processPointerUp(w,r,I)}_processPointerUp(w,p,e){var r;const I=this._scene;if(null!==(r=w)&&void 0!==r&&r.pickedMesh){if(this._pickedUpMesh=w.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(I.onPointerPick&&I.onPointerPick(p,w),e.singleClick&&!e.ignore&&I.onPointerObservable.observers.length>this._cameraObserverCount)){const e=A.c.POINTERPICK,r=new A.h(e,p,w);this._setRayOnPointerInfo(w,p),I.onPointerObservable.notifyObservers(r,e)}const r=w.pickedMesh._getActionManagerForTrigger();if(r&&!e.ignore){r.processTrigger(7,J.CreateNew(w.pickedMesh,p,w)),!e.hasSwiped&&e.singleClick&&r.processTrigger(1,J.CreateNew(w.pickedMesh,p,w));const I=w.pickedMesh._getActionManagerForTrigger(6);e.cI&&I&&I.processTrigger(6,J.CreateNew(w.pickedMesh,p,w))}}else if(!e.ignore)for(const d of I._pointerUpStage)w=d.action(this._unTranslatedPointerX,this._unTranslatedPointerY,w,p,e.cI);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const w=this._pickedDownMesh._getActionManagerForTrigger(16);w&&w.processTrigger(16,J.CreateNew(this._pickedDownMesh,p))}if(!e.ignore){const r=new A.h(A.c.POINTERUP,p,w);if(this._setRayOnPointerInfo(w,p),I.onPointerObservable.notifyObservers(r,A.c.POINTERUP),I.onPointerUp&&I.onPointerUp(p,w,A.c.POINTERUP),!e.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let r=0;if(e.singleClick?r=A.c.POINTERTAP:e.cI&&(r=A.c.POINTERDOUBLETAP),r){const e=new A.h(r,p,w);I.onPointerObservable.hasObservers()&&I.onPointerObservable.hasSpecificMask(r)&&I.onPointerObservable.notifyObservers(e,r)}}}}isPointerCaptured(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[w]}attachControl(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const I=this._scene,d=I.getEngine();r||(r=d.getInputElement()),this._alreadyAttached&&this.Sk(),r&&(this._alreadyAttachedTo=r),this._deviceSourceManager=new L(d),this._initActionManager=w=>{if(!this._meshPickProceed){const p=I.skipPointerUpPicking||0===I._registeredActions&&!this._checkForPicking()&&!I.onPointerUp?null:I.Xe(this._unTranslatedPointerX,this._unTranslatedPointerY,I.pointerUpPredicate,I.pointerUpFastCheck,I.cameraToUseForPointers,I.pointerUpTrianglePredicate);this._currentPickResult=p,p&&(w=p.hit&&p.pickedMesh?p.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return w},this._delayedSimpleClick=(w,p,e)=>{if((Date.now()-this._previousStartingPointerTime>H.DoubleClickDelay&&!this._doubleClickOccured||w!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,p.singleClick=!0,p.ignore=!1,this._delayedClicks[w])){const p=this._delayedClicks[w].evt,e=A.c.POINTERTAP,r=new A.h(e,p,this._currentPickResult);I.onPointerObservable.hasObservers()&&I.onPointerObservable.hasSpecificMask(e)&&I.onPointerObservable.notifyObservers(r,e),this._delayedClicks[w]=null}},this._initClickEvent=(w,p,e,r)=>{const I=new F;this._currentPickResult=null;let d=null,f=w.hasSpecificMask(A.c.POINTERPICK)||p.hasSpecificMask(A.c.POINTERPICK)||w.hasSpecificMask(A.c.POINTERTAP)||p.hasSpecificMask(A.c.POINTERTAP)||w.hasSpecificMask(A.c.POINTERDOUBLETAP)||p.hasSpecificMask(A.c.POINTERDOUBLETAP);!f&&z&&(d=this._initActionManager(d,I),d&&(f=d.hasPickTriggers));let q=!1;if(f=f&&!this._isMultiTouchGesture,f){const f=e.button;if(I.hasSwiped=this._isPointerSwiping(),!I.hasSwiped){let X=!H.ExclusiveDoubleClickMode;if(X||(X=!w.hasSpecificMask(A.c.POINTERDOUBLETAP)&&!p.hasSpecificMask(A.c.POINTERDOUBLETAP),X&&!z.HasSpecificTrigger(6)&&(d=this._initActionManager(d,I),d&&(X=!d.hasSpecificTrigger(6)))),X)(Date.now()-this._previousStartingPointerTime>H.DoubleClickDelay||f!==this._previousButtonPressed)&&(I.singleClick=!0,r(I,this._currentPickResult),q=!0);else{const w={evt:e,clickInfo:I,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,f,I,r),H.DoubleClickDelay)};this._delayedClicks[f]=w}let k=w.hasSpecificMask(A.c.POINTERDOUBLETAP)||p.hasSpecificMask(A.c.POINTERDOUBLETAP);if(!k&&z.HasSpecificTrigger(6)&&(d=this._initActionManager(d,I),d&&(k=d.hasSpecificTrigger(6))),k)if(f===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<H.DoubleClickDelay&&!this._doubleClickOccured){if(I.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=f,H.ExclusiveDoubleClickMode){var E;if(this._delayedClicks[f])clearTimeout(null===(E=this._delayedClicks[f])||void 0===E?void 0:E.timeoutId),this._delayedClicks[f]=null;r(I,this._previousPickResult)}else r(I,this._currentPickResult);else{var j;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,I.cI=!0,I.ignore=!1,H.ExclusiveDoubleClickMode&&this._delayedClicks[f])clearTimeout(null===(j=this._delayedClicks[f])||void 0===j?void 0:j.timeoutId),this._delayedClicks[f]=null;r(I,this._currentPickResult)}q=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=f}}q||r(I,this._currentPickResult)},this._onPointerMove=w=>{if(this._updatePointerPosition(w),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>H.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>H.DragMovementThreshold),d.isPointerLock&&d._verifyPointerLock(),this._checkPrePointerObservable(null,w,w.inputIndex>=i.MouseWheelX&&w.inputIndex<=i.MouseWheelZ?A.c.POINTERWHEEL:A.c.POINTERMOVE))return;if(!I.cameraToUseForPointers&&!I.activeCamera)return;if(I.qm)return void this._processPointerMove(new m.d,w);I.pointerMovePredicate||(I.pointerMovePredicate=w=>w.kj&&w.isVisible&&w.isReady()&&w.isEnabled()&&(w.enablePointerMoveEvents||I.constantlyUpdateMeshUnderPointer||null!==w._getActionManagerForTrigger())&&(!I.cameraToUseForPointers||0!==(I.cameraToUseForPointers.layerMask&w.layerMask)));const p=I._registeredActions>0||I.constantlyUpdateMeshUnderPointer?this._pickMove(w):null;this._processPointerMove(p,w)},this._onPointerDown=w=>{const p=this._activePointerIds.indexOf(-1);if(-1===p?this._activePointerIds.push(w.pointerId):this._activePointerIds[p]=w.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,H.ExclusiveDoubleClickMode)for(let r=0;r<this._delayedClicks.length;r++)if(this._delayedClicks[r])if(w.button===r){var e;clearTimeout(null===(e=this._delayedClicks[r])||void 0===e?void 0:e.timeoutId)}else{const w=this._delayedClicks[r].clickInfo;this._doubleClickOccured=!1,w.singleClick=!0,w.ignore=!1;const p=this._delayedClicks[r].evt,e=A.c.POINTERTAP,d=new A.h(e,p,this._currentPickResult);I.onPointerObservable.hasObservers()&&I.onPointerObservable.hasSpecificMask(e)&&I.onPointerObservable.notifyObservers(d,e),this._delayedClicks[r]=null}if(this._updatePointerPosition(w),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=w.button),I.preventDefaultOnPointerDown&&r&&(w.preventDefault(),r.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,w,A.c.POINTERDOWN))return;if(!I.cameraToUseForPointers&&!I.activeCamera)return;let d;this._pointerCaptures[w.pointerId]=!0,I.pointerDownPredicate||(I.pointerDownPredicate=w=>w.kj&&w.isVisible&&w.isReady()&&w.isEnabled()&&(!I.cameraToUseForPointers||0!==(I.cameraToUseForPointers.layerMask&w.layerMask))),this._pickedDownMesh=null,d=I.skipPointerDownPicking||0===I._registeredActions&&!this._checkForPicking()&&!I.onPointerDown?new m.d:I.Xe(this._unTranslatedPointerX,this._unTranslatedPointerY,I.pointerDownPredicate,I.pointerDownFastCheck,I.cameraToUseForPointers,I.pointerDownTrianglePredicate),this._processPointerDown(d,w)},this._onPointerUp=w=>{const p=this._activePointerIds.indexOf(w.pointerId);-1!==p&&(this._activePointerIds[p]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(w),I.preventDefaultOnPointerUp&&r&&(w.preventDefault(),r.focus()),this._initClickEvent(I.onPrePointerObservable,I.onPointerObservable,w,((p,e)=>{if(I.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!p.ignore)){if(this._checkPrePointerObservable(null,w,A.c.POINTERUP))return this._swipeButtonPressed===w.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===w.buttons&&(this._pointerCaptures[w.pointerId]=!1));p.hasSwiped||(p.singleClick&&I.onPrePointerObservable.hasSpecificMask(A.c.POINTERTAP)&&this._checkPrePointerObservable(null,w,A.c.POINTERTAP)&&(this._skipPointerTap=!0),p.cI&&I.onPrePointerObservable.hasSpecificMask(A.c.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,w,A.c.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[w.pointerId]?(0===w.buttons&&(this._pointerCaptures[w.pointerId]=!1),(I.cameraToUseForPointers||I.activeCamera)&&(I.pointerUpPredicate||(I.pointerUpPredicate=w=>w.kj&&w.isVisible&&w.isReady()&&w.isEnabled()&&(!I.cameraToUseForPointers||0!==(I.cameraToUseForPointers.layerMask&w.layerMask))),!this._meshPickProceed&&(z&&z.HasTriggers||this._checkForPicking()||I.onPointerUp)&&this._initActionManager(null,p),e||(e=this._currentPickResult),this._processPointerUp(e,w,p),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===w.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===w.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=w=>{const p=v.c.KEYDOWN;if(I.onPreKeyboardObservable.hasObservers()){const e=new v.f(p,w);if(I.onPreKeyboardObservable.notifyObservers(e,p),e.skipOnKeyboardObservable)return}if(I.onKeyboardObservable.hasObservers()){const e=new v.i(p,w);I.onKeyboardObservable.notifyObservers(e,p)}I.actionManager&&I.actionManager.processTrigger(14,J.CreateNewFromScene(I,w))},this._onKeyUp=w=>{const p=v.c.KEYUP;if(I.onPreKeyboardObservable.hasObservers()){const e=new v.f(p,w);if(I.onPreKeyboardObservable.notifyObservers(e,p),e.skipOnKeyboardObservable)return}if(I.onKeyboardObservable.hasObservers()){const e=new v.i(p,w);I.onKeyboardObservable.notifyObservers(e,p)}I.actionManager&&I.actionManager.processTrigger(15,J.CreateNewFromScene(I,w))},this._deviceSourceManager.onDeviceConnectedObservable.add((r=>{r.deviceType===M.Mouse?r.onInputChangedObservable.add((I=>{this._originMouseEvent=I,I.inputIndex===i.LeftClick||I.inputIndex===i.MiddleClick||I.inputIndex===i.RightClick||I.inputIndex===i.BrowserBack||I.inputIndex===i.BrowserForward?p&&1===r.getInput(I.inputIndex)?this._onPointerDown(I):w&&0===r.getInput(I.inputIndex)&&this._onPointerUp(I):e&&(I.inputIndex===i.Move?this._onPointerMove(I):I.inputIndex!==i.MouseWheelX&&I.inputIndex!==i.MouseWheelY&&I.inputIndex!==i.MouseWheelZ||this._onPointerMove(I))})):r.deviceType===M.Touch?r.onInputChangedObservable.add((I=>{I.inputIndex===i.LeftClick&&(p&&1===r.getInput(I.inputIndex)?(this._onPointerDown(I),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):w&&0===r.getInput(I.inputIndex)&&(this._onPointerUp(I),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),e&&I.inputIndex===i.Move&&this._onPointerMove(I)})):r.deviceType===M.Keyboard&&r.onInputChangedObservable.add((w=>{"keydown"===w.type?this._onKeyDown(w):"keyup"===w.type&&this._onKeyUp(w)}))})),this._alreadyAttached=!0}Sk(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[p]===w&&(!w||!w._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const I=this._meshUnderPointerId[p];let d;I&&(d=I._getActionManagerForTrigger(10),d&&d.processTrigger(10,new J(I,this._pointerX,this._pointerY,w,r,{pointerId:p}))),w?(this._meshUnderPointerId[p]=w,this._pointerOverMesh=w,d=w._getActionManagerForTrigger(9),d&&d.processTrigger(9,new J(w,this._pointerX,this._pointerY,w,r,{pointerId:p,pickResult:e}))):(delete this._meshUnderPointerId[p],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:w,pointerId:p})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(w){this._pointerOverMesh===w&&(this._pointerOverMesh=null),this._pickedDownMesh===w&&(this._pickedDownMesh=null),this._pickedUpMesh===w&&(this._pickedUpMesh=null);for(const p in this._meshUnderPointerId)this._meshUnderPointerId[p]===w&&delete this._meshUnderPointerId[p]}}H.DragMovementThreshold=10,H.LongPressDelay=500,H.DoubleClickDelay=300,H.ExclusiveDoubleClickMode=!1;var B=e(11496),D=e(11308),T=e(11386),Z=e(11640),G=e(11107),g=e(11317),o=e(11030);class C{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.qm=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var Q,x=e(11081),S=e(11038);!function(w){w[w.BackwardCompatible=0]="BackwardCompatible",w[w.Intermediate=1]="Intermediate",w[w.Aggressive=2]="Aggressive"}(Q||(Q={}));class ww{static DefaultMaterialFactory(w){throw(0,a.c)("hr")}static CollisionCoordinatorFactory(){throw(0,a.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(w){w!==this._clearColor&&(this._clearColor=w,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(w){if(w!==this._performancePriority){switch(this._performancePriority=w,w){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.qm=!1,this.wm=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.qm=!0,this.wm=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.qm=!0,this.wm=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(w)}}set forceWireframe(w){this._forceWireframe!==w&&(this._forceWireframe=w,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(w){this._skipFrustumClipping!==w&&(this._skipFrustumClipping=w)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(w){this._forcePointsCloud!==w&&(this._forcePointsCloud=w,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(w){this._environmentTexture!==w&&(this._environmentTexture=w,this.onEnvironmentTextureChangedObservable.notifyObservers(w),this.markAllMaterialsAsDirty(1))}getNodes(){let w=[];w=w.concat(this.meshes),w=w.concat(this.lights),w=w.concat(this.cameras),w=w.concat(this.transformNodes);for(const p of this.skeletons)w=w.concat(p.bones);return w}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(w){this._animationPropertiesOverride=w}set onDispose(w){this._onDisposeObserver&&this.ue.remove(this._onDisposeObserver),this._onDisposeObserver=this.ue.add(w)}set beforeRender(w){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),w&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(w))}set afterRender(w){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),w&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(w))}set beforeCameraRender(w){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(w)}set afterCameraRender(w){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(w)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(w){this._pointerPickingConfiguration.pointerDownPredicate=w}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(w){this._pointerPickingConfiguration.pointerUpPredicate=w}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(w){this._pointerPickingConfiguration.pointerMovePredicate=w}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(w){this._pointerPickingConfiguration.pointerDownFastCheck=w}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(w){this._pointerPickingConfiguration.pointerUpFastCheck=w}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(w){this._pointerPickingConfiguration.pointerMoveFastCheck=w}get qm(){return this._pointerPickingConfiguration.qm}set qm(w){this._pointerPickingConfiguration.qm=w}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(w){this._pointerPickingConfiguration.skipPointerDownPicking=w}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(w){this._pointerPickingConfiguration.skipPointerUpPicking=w}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return H.DragMovementThreshold}static set DragMovementThreshold(w){H.DragMovementThreshold=w}static get LongPressDelay(){return H.LongPressDelay}static set LongPressDelay(w){H.LongPressDelay=w}static get DoubleClickDelay(){return H.DoubleClickDelay}static set DoubleClickDelay(w){H.DoubleClickDelay=w}static get ExclusiveDoubleClickMode(){return H.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(w){H.ExclusiveDoubleClickMode=w}bindEyePosition(w){var p;let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const I=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(p=this.activeCamera)||void 0===p?void 0:p.globalPosition)??j.k.ZeroReadOnly,d=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return j.d.Vector4[0].set(I.x,I.y,I.z,d?-1:1),w&&(r?w.setFloat3(e,j.d.Vector4[0].x,j.d.Vector4[0].y,j.d.Vector4[0].z):w.setVector4(e,j.d.Vector4[0])),j.d.Vector4[0]}finalizeSceneUbo(){const w=this.getSceneUniformBuffer(),p=this.bindEyePosition(null);return w.updateFloat4("vEyePosition",p.x,p.y,p.z,p.w),w.update(),w}set useRightHandedSystem(w){this._useRightHandedSystem!==w&&(this._useRightHandedSystem=w,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(w){this._currentStepId=w}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(w){this._fogEnabled!==w&&(this._fogEnabled=w,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(w){this._fogMode!==w&&(this._fogMode=w,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(w){this._shadowsEnabled!==w&&(this._shadowsEnabled=w,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(w){this._lightsEnabled!==w&&(this._lightsEnabled=w,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(w){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),w&&(this._unObserveActiveCameras=(0,o.i)(w,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=w}get activeCamera(){return this._activeCamera}set activeCamera(w){w!==this._activeCamera&&(this._activeCamera=w,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return ww.DefaultMaterialFactory!==ww._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.lk||(this.lk=ww.DefaultMaterialFactory(this)),this.lk}set defaultMaterial(w){this.lk=w}set texturesEnabled(w){this._texturesEnabled!==w&&(this._texturesEnabled=w,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(w){if(this._frameGraph)return this._frameGraph=w,void(w||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=w,w&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(w){this._skeletonsEnabled!==w&&(this._skeletonsEnabled=w,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=ww.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const w of this._transientComponents)w.register();this._transientComponents.length=0}}je(w){this._components.push(w),this._transientComponents.push(w);const p=w;p.addFromContainer&&p.serialize&&this._serializableComponents.push(p)}_getComponent(w){for(const p of this._components)if(p.name===w)return p;return null}get uniqueId(){return this._uniqueId}constructor(w,p){this._inputManager=new H(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.wm=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new D.e(.2,.2,.3,1),this.onClearColorChangedObservable=new d.d,this.ambientColor=new D.b(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new d.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.tm=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.fJ=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.ue=new d.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new d.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new d.d,this.onAfterRenderCameraObservable=new d.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new d.d,this.onAfterAnimationsObservable=new d.d,this.onBeforeDrawPhaseObservable=new d.d,this.onAfterDrawPhaseObservable=new d.d,this.onReadyObservable=new d.d,this.onBeforeCameraRenderObservable=new d.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new d.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new d.d,this.onAfterActiveMeshesEvaluationObservable=new d.d,this.onBeforeParticlesRenderingObservable=new d.d,this.onAfterParticlesRenderingObservable=new d.d,this.onDataLoadedObservable=new d.d,this.onNewCameraAddedObservable=new d.d,this.onCameraRemovedObservable=new d.d,this.onNewLightAddedObservable=new d.d,this.onLightRemovedObservable=new d.d,this.onNewGeometryAddedObservable=new d.d,this.onGeometryRemovedObservable=new d.d,this.onNewTransformNodeAddedObservable=new d.d,this.onTransformNodeRemovedObservable=new d.d,this.onNewMeshAddedObservable=new d.d,this.onMeshRemovedObservable=new d.d,this.onNewSkeletonAddedObservable=new d.d,this.onSkeletonRemovedObservable=new d.d,this.onNewMaterialAddedObservable=new d.d,this.onNewMultiMaterialAddedObservable=new d.d,this.onMaterialRemovedObservable=new d.d,this.onMultiMaterialRemovedObservable=new d.d,this.onNewTextureAddedObservable=new d.d,this.onTextureRemovedObservable=new d.d,this.onBeforeRenderTargetsRenderObservable=new d.d,this.onAfterRenderTargetsRenderObservable=new d.d,this.onBeforeStepObservable=new d.d,this.onAfterStepObservable=new d.d,this.onActiveCameraChanged=new d.d,this.onActiveCamerasChanged=new d.d,this.onBeforeRenderingGroupObservable=new d.d,this.onAfterRenderingGroupObservable=new d.d,this.onMeshImportedObservable=new d.d,this.onAnimationFileImportedObservable=new d.d,this.onEnvironmentTextureChangedObservable=new d.d,this.onMeshUnderPointerUpdatedObservable=new d.d,this._registeredForLateAnimationBindings=new f.b(256),this._pointerPickingConfiguration=new C,this.onPrePointerObservable=new d.d,this.onPointerObservable=new d.d,this.onPreKeyboardObservable=new d.d,this.onKeyboardObservable=new d.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=ww.FOGMODE_NONE,this.fogColor=new D.b(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new j.k(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new f.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new B.d,this._activeIndices=new B.d,this._activeParticles=new B.d,this._activeBones=new B.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new f.e(256),this._processedMaterials=new f.e(256),this._renderTargets=new f.b(256),this._materialsRenderTargets=new f.b(256),this._activeParticleSystems=new f.e(256),this._activeSkeletons=new f.b(32),this._softwareSkinnedMeshes=new f.b(32),this._activeAnimatables=new Array,this._transformMatrix=j.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=c.g.Create(),this._beforeClearStage=c.g.Create(),this._beforeRenderTargetClearStage=c.g.Create(),this._gatherRenderTargetsStage=c.g.Create(),this._gatherActiveCameraRenderTargetsStage=c.g.Create(),this._isReadyForMeshStage=c.g.Create(),this._beforeEvaluateActiveMeshStage=c.g.Create(),this._evaluateSubMeshStage=c.g.Create(),this._preActiveMeshStage=c.g.Create(),this._cameraDrawRenderTargetStage=c.g.Create(),this._beforeCameraDrawStage=c.g.Create(),this._beforeRenderTargetDrawStage=c.g.Create(),this._beforeRenderingGroupDrawStage=c.g.Create(),this._beforeRenderingMeshStage=c.g.Create(),this._afterRenderingMeshStage=c.g.Create(),this._afterRenderingGroupDrawStage=c.g.Create(),this._afterCameraDrawStage=c.g.Create(),this._afterCameraPostProcessStage=c.g.Create(),this._afterRenderTargetDrawStage=c.g.Create(),this._afterRenderTargetPostProcessStage=c.g.Create(),this._afterRenderStage=c.g.Create(),this._pointerMoveStage=c.g.Create(),this._pointerDownStage=c.g.Create(),this._pointerUpStage=c.g.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const e={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...p};w=this._engine=w||O.d.LastCreatedEngine,e.virtual?w._virtualScenes.push(this):(O.d._LastCreatedScene=this,w.scenes.push(this)),this._uid=null,this._renderingManager=new y.b(this),K.d&&(this.postProcessManager=new K.d(this)),(0,s.i)()&&this.attachControl(),this._createUbo(),X.e&&(this._imageProcessingConfiguration=new X.e),this.setDefaultCandidateProviders(),e.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=e.useMaterialMeshMap,this.useClonedMeshMap=e.useClonedMeshMap,p&&p.virtual||w.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(w){return this._defaultSubMeshCandidates.data=w.oe,this._defaultSubMeshCandidates.length=w.oe.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=w=>this._getDefaultSubMeshCandidates(w),this.getIntersectingSubMeshCandidates=(w,p)=>this._getDefaultSubMeshCandidates(w),this.getCollidingSubMeshCandidates=(w,p)=>this._getDefaultSubMeshCandidates(w)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(w){this._inputManager.pointerX=w}get pointerY(){return this._inputManager.pointerY}set pointerY(w){this._inputManager.pointerY=w}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==p||this._cachedMaterial!==w||this._cachedVisibility!==e}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(w,p){return this._inputManager.simulatePointerMove(w,p),this}simulatePointerDown(w,p){return this._inputManager.simulatePointerDown(w,p),this}simulatePointerUp(w,p,e){return this._inputManager.simulatePointerUp(w,p,e),this}isPointerCaptured(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(w)}attachControl(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(w,p,e)}Sk(){this._inputManager.Sk()}isReady(){var w,p;let e,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const I=this.getEngine(),d=I.currentRenderPassId;I.currentRenderPassId=(null===(w=this.activeCamera)||void 0===w?void 0:w.renderPassId)??d;let f=!0;for(this._pendingData.length>0&&(f=!1),null===(p=this.prePassRenderer)||void 0===p||p.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&f&&(f=this.depthPeelingRenderer.isReady()),r&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),e=0;e<this.meshes.length;e++){const w=this.meshes[e];if(!w.oe||0===w.oe.length)continue;if(!w.isReady(!0)){f=!1;continue}const p=w.hasThinInstances||"InstancedMesh"===w.getClassName()||"InstancedLinesMesh"===w.getClassName()||I.getCaps().instancedArrays&&w.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(w,p)||(f=!1);if(!r)continue;const d=w.material||this.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(const e of w.oe){const w=e.Yw();w&&w.hasRenderTargetTextures&&null!=w.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(w)&&(this._processedMaterials.push(w),this._materialsRenderTargets.concatWithNoDuplicate(w.getRenderTargetTextures()))}else d.hasRenderTargetTextures&&null!=d.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(d)&&(this._processedMaterials.push(d),this._materialsRenderTargets.concatWithNoDuplicate(d.getRenderTargetTextures()))}if(r)for(e=0;e<this._materialsRenderTargets.length;++e){this._materialsRenderTargets.data[e].isReadyForRendering()||(f=!1)}for(e=0;e<this.geometries.length;e++){2===this.geometries[e].delayLoadState&&(f=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const q of this.activeCameras)q.isReady(!0)||(f=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(f=!1));for(const q of this.tm)q.isReady()||(f=!1);if(this.layers)for(const q of this.layers)q.isReady()||(f=!1);if(this.effectLayers)for(const q of this.effectLayers)q.isLayerReady()||(f=!1);return I.areAllEffectsReady()||(f=!1),I.currentRenderPassId=d,f}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(w){this.onBeforeRenderObservable.add(w)}unregisterBeforeRender(w){this.onBeforeRenderObservable.removeCallback(w)}registerAfterRender(w){this.onAfterRenderObservable.add(w)}unregisterAfterRender(w){this.onAfterRenderObservable.removeCallback(w)}_executeOnceBeforeRender(w){const p=()=>{w(),setTimeout((()=>{this.unregisterBeforeRender(p)}))};this.registerBeforeRender(p)}executeOnceBeforeRender(w,p){void 0!==p?setTimeout((()=>{this._executeOnceBeforeRender(w)}),p):this._executeOnceBeforeRender(w)}addPendingData(w){this._pendingData.push(w)}removePendingData(w){const p=this.isLoading,e=this._pendingData.indexOf(w);-1!==e&&this._pendingData.splice(e,1),p&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(w),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(p)}async whenReadyAsync(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((p=>{this.executeWhenReady((()=>{p()}),w)}))}_checkIsReady(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(w)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(w)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=I.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(w,p,e,r){e||r||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===w.updateFlag&&this._projectionUpdateFlag===p.updateFlag||(this._viewUpdateFlag=w.updateFlag,this._projectionUpdateFlag=p.updateFlag,this._viewMatrix=w,this._projectionMatrix=p,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?T.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=T.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(e,r):this._sceneUbo.useUbo&&(this._sceneUbo.Ze("viewProjection",this._transformMatrix),this._sceneUbo.Ze("view",this._viewMatrix),this._sceneUbo.Ze("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(w){const p=new k.d(this._engine,void 0,!1,w??"yp");return p.addUniform("viewProjection",16),p.addUniform("view",16),p.addUniform("projection",16),p.addUniform("vEyePosition",4),p}setSceneUniformBuffer(w){this._sceneUbo=w,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return Z.c.UniqueId}tX(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(w),w._resyncLightSources(),w.parent||w._addToSceneRootNodes(),r.g.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(w)})),p)){const p=w.getChildMeshes();for(const w of p)this.tX(w)}}iX(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this.meshes.indexOf(w);if(-1!==e&&(this.meshes.splice(e,1),w.parent||w._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(w),this.onMeshRemovedObservable.notifyObservers(w),p){const p=w.getChildMeshes();for(const w of p)this.iX(w)}return e}addTransformNode(w){this._blockEntityCollection||w.iw()===this&&-1!==w._indexInSceneTransformNodesArray||(w._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(w),w.parent||w._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(w))}removeTransformNode(w){const p=w._indexInSceneTransformNodesArray;if(-1!==p){if(p!==this.transformNodes.length-1){const w=this.transformNodes[this.transformNodes.length-1];this.transformNodes[p]=w,w._indexInSceneTransformNodesArray=p}w._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),w.parent||w._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(w),p}removeSkeleton(w){const p=this.skeletons.indexOf(w);return-1!==p&&(this.skeletons.splice(p,1),this.onSkeletonRemovedObservable.notifyObservers(w),this._executeActiveContainerCleanup(this._activeSkeletons)),p}removeMorphTargetManager(w){const p=this.morphTargetManagers.indexOf(w);return-1!==p&&this.morphTargetManagers.splice(p,1),p}removeLight(w){const p=this.lights.indexOf(w);if(-1!==p){for(const p of this.meshes)p._removeLightSource(w,!1);this.lights.splice(p,1),this.sortLightsByPriority(),w.parent||w._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(w),p}removeCamera(w){const p=this.cameras.indexOf(w);if(-1!==p&&(this.cameras.splice(p,1),w.parent||w._removeFromSceneRootNodes()),this.activeCameras){const p=this.activeCameras.indexOf(w);-1!==p&&this.activeCameras.splice(p,1)}return this.activeCamera===w&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(w),p}removeParticleSystem(w){const p=this.tm.indexOf(w);return-1!==p&&(this.tm.splice(p,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),p}removeAnimation(w){const p=this.animations.indexOf(w);return-1!==p&&this.animations.splice(p,1),p}stopAnimation(w,p,e){}removeAnimationGroup(w){const p=this.animationGroups.indexOf(w);return-1!==p&&this.animationGroups.splice(p,1),p}removeMultiMaterial(w){const p=this.multiMaterials.indexOf(w);return-1!==p&&this.multiMaterials.splice(p,1),this.onMultiMaterialRemovedObservable.notifyObservers(w),p}removeMaterial(w){const p=w._indexInSceneMaterialArray;if(-1!==p&&p<this.materials.length){if(p!==this.materials.length-1){const w=this.materials[this.materials.length-1];this.materials[p]=w,w._indexInSceneMaterialArray=p}w._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(w),p}removeActionManager(w){const p=this.actionManagers.indexOf(w);return-1!==p&&this.actionManagers.splice(p,1),p}removeTexture(w){const p=this.textures.indexOf(w);return-1!==p&&this.textures.splice(p,1),this.onTextureRemovedObservable.notifyObservers(w),p}addLight(w){if(!this._blockEntityCollection){this.lights.push(w),this.sortLightsByPriority(),w.parent||w._addToSceneRootNodes();for(const p of this.meshes)-1===p.lightSources.indexOf(w)&&(p.lightSources.push(w),p._resyncLightSources());r.g.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(w)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(g.c.CompareLightsPriority)}addCamera(w){this._blockEntityCollection||(this.cameras.push(w),r.g.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(w)})),w.parent||w._addToSceneRootNodes())}addSkeleton(w){this._blockEntityCollection||(this.skeletons.push(w),r.g.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(w)})))}addParticleSystem(w){this._blockEntityCollection||this.tm.push(w)}addAnimation(w){this._blockEntityCollection||this.animations.push(w)}addAnimationGroup(w){this._blockEntityCollection||this.animationGroups.push(w)}addMultiMaterial(w){this._blockEntityCollection||(this.multiMaterials.push(w),r.g.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(w)})))}addMaterial(w){this._blockEntityCollection||w.iw()===this&&-1!==w._indexInSceneMaterialArray||(w._indexInSceneMaterialArray=this.materials.length,this.materials.push(w),r.g.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(w)})))}addMorphTargetManager(w){this._blockEntityCollection||this.morphTargetManagers.push(w)}addGeometry(w){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[w.uniqueId]=this.geometries.length),this.geometries.push(w))}addActionManager(w){this.actionManagers.push(w)}addTexture(w){this._blockEntityCollection||(this.textures.push(w),this.onNewTextureAddedObservable.notifyObservers(w))}switchActiveCamera(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Sk(),this.activeCamera=w,p&&w.attachControl())}setActiveCameraById(w){const p=this.getCameraById(w);return p?(this.activeCamera=p,p):null}setActiveCameraByName(w){const p=this.getCameraByName(w);return p?(this.activeCamera=p,p):null}getAnimationGroupByName(w){for(let p=0;p<this.animationGroups.length;p++)if(this.animationGroups[p].name===w)return this.animationGroups[p];return null}_getMaterial(w,p){for(let e=0;e<this.materials.length;e++){const w=this.materials[e];if(p(w))return w}if(w)for(let e=0;e<this.multiMaterials.length;e++){const w=this.multiMaterials[e];if(p(w))return w}return null}getMaterialByUniqueID(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(w,p)}getMaterialByUniqueId(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(p,(p=>p.uniqueId===w))}getMaterialById(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(p,(p=>p.id===w))}getMaterialByName(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(p,(p=>p.name===w))}getLastMaterialById(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let e=this.materials.length-1;e>=0;e--)if(this.materials[e].id===w)return this.materials[e];if(p)for(let e=this.multiMaterials.length-1;e>=0;e--)if(this.multiMaterials[e].id===w)return this.multiMaterials[e];return null}getTextureByUniqueId(w){for(let p=0;p<this.textures.length;p++)if(this.textures[p].uniqueId===w)return this.textures[p];return null}getTextureByName(w){for(let p=0;p<this.textures.length;p++)if(this.textures[p].name===w)return this.textures[p];return null}getCameraById(w){for(let p=0;p<this.cameras.length;p++)if(this.cameras[p].id===w)return this.cameras[p];return null}getCameraByUniqueId(w){for(let p=0;p<this.cameras.length;p++)if(this.cameras[p].uniqueId===w)return this.cameras[p];return null}getCameraByName(w){for(let p=0;p<this.cameras.length;p++)if(this.cameras[p].name===w)return this.cameras[p];return null}getBoneById(w){for(let p=0;p<this.skeletons.length;p++){const e=this.skeletons[p];for(let p=0;p<e.bones.length;p++)if(e.bones[p].id===w)return e.bones[p]}return null}getBoneByName(w){for(let p=0;p<this.skeletons.length;p++){const e=this.skeletons[p];for(let p=0;p<e.bones.length;p++)if(e.bones[p].name===w)return e.bones[p]}return null}getLightByName(w){for(let p=0;p<this.lights.length;p++)if(this.lights[p].name===w)return this.lights[p];return null}getLightById(w){for(let p=0;p<this.lights.length;p++)if(this.lights[p].id===w)return this.lights[p];return null}getLightByUniqueId(w){for(let p=0;p<this.lights.length;p++)if(this.lights[p].uniqueId===w)return this.lights[p];return null}getParticleSystemById(w){for(let p=0;p<this.tm.length;p++)if(this.tm[p].id===w)return this.tm[p];return null}getGeometryById(w){for(let p=0;p<this.geometries.length;p++)if(this.geometries[p].id===w)return this.geometries[p];return null}_getGeometryByUniqueId(w){if(this._geometriesByUniqueId){const p=this._geometriesByUniqueId[w];if(void 0!==p)return this.geometries[p]}else for(let p=0;p<this.geometries.length;p++)if(this.geometries[p].uniqueId===w)return this.geometries[p];return null}getFrameGraphByName(w){for(let p=0;p<this.frameGraphs.length;p++)if(this.frameGraphs[p].name===w)return this.frameGraphs[p];return null}pushGeometry(w,p){return!(!p&&this._getGeometryByUniqueId(w.uniqueId))&&(this.addGeometry(w),r.g.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(w)})),!0)}removeGeometry(w){let p;if(this._geometriesByUniqueId){if(p=this._geometriesByUniqueId[w.uniqueId],void 0===p)return!1}else if(p=this.geometries.indexOf(w),p<0)return!1;if(p!==this.geometries.length-1){const w=this.geometries[this.geometries.length-1];w&&(this.geometries[p]=w,this._geometriesByUniqueId&&(this._geometriesByUniqueId[w.uniqueId]=p))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[w.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(w),!0}getGeometries(){return this.geometries}getMeshById(w){for(let p=0;p<this.meshes.length;p++)if(this.meshes[p].id===w)return this.meshes[p];return null}getMeshesById(w){return this.meshes.filter((function(p){return p.id===w}))}getTransformNodeById(w){for(let p=0;p<this.transformNodes.length;p++)if(this.transformNodes[p].id===w)return this.transformNodes[p];return null}getTransformNodeByUniqueId(w){for(let p=0;p<this.transformNodes.length;p++)if(this.transformNodes[p].uniqueId===w)return this.transformNodes[p];return null}getTransformNodesById(w){return this.transformNodes.filter((function(p){return p.id===w}))}getMeshByUniqueId(w){for(let p=0;p<this.meshes.length;p++)if(this.meshes[p].uniqueId===w)return this.meshes[p];return null}getLastMeshById(w){for(let p=this.meshes.length-1;p>=0;p--)if(this.meshes[p].id===w)return this.meshes[p];return null}getLastTransformNodeById(w){for(let p=this.transformNodes.length-1;p>=0;p--)if(this.transformNodes[p].id===w)return this.transformNodes[p];return null}getLastEntryById(w){let p;for(p=this.meshes.length-1;p>=0;p--)if(this.meshes[p].id===w)return this.meshes[p];for(p=this.transformNodes.length-1;p>=0;p--)if(this.transformNodes[p].id===w)return this.transformNodes[p];for(p=this.cameras.length-1;p>=0;p--)if(this.cameras[p].id===w)return this.cameras[p];for(p=this.lights.length-1;p>=0;p--)if(this.lights[p].id===w)return this.lights[p];return null}getNodeById(w){const p=this.getMeshById(w);if(p)return p;const e=this.getTransformNodeById(w);if(e)return e;const r=this.getLightById(w);if(r)return r;const I=this.getCameraById(w);if(I)return I;const d=this.getBoneById(w);return d||null}getNodeByName(w){const p=this.getMeshByName(w);if(p)return p;const e=this.getTransformNodeByName(w);if(e)return e;const r=this.getLightByName(w);if(r)return r;const I=this.getCameraByName(w);if(I)return I;const d=this.getBoneByName(w);return d||null}getMeshByName(w){for(let p=0;p<this.meshes.length;p++)if(this.meshes[p].name===w)return this.meshes[p];return null}getTransformNodeByName(w){for(let p=0;p<this.transformNodes.length;p++)if(this.transformNodes[p].name===w)return this.transformNodes[p];return null}getLastSkeletonById(w){for(let p=this.skeletons.length-1;p>=0;p--)if(this.skeletons[p].id===w)return this.skeletons[p];return null}getSkeletonByUniqueId(w){for(let p=0;p<this.skeletons.length;p++)if(this.skeletons[p].uniqueId===w)return this.skeletons[p];return null}getSkeletonById(w){for(let p=0;p<this.skeletons.length;p++)if(this.skeletons[p].id===w)return this.skeletons[p];return null}getSkeletonByName(w){for(let p=0;p<this.skeletons.length;p++)if(this.skeletons[p].name===w)return this.skeletons[p];return null}getMorphTargetManagerById(w){for(let p=0;p<this.morphTargetManagers.length;p++)if(this.morphTargetManagers[p].uniqueId===w)return this.morphTargetManagers[p];return null}getMorphTargetById(w){for(let p=0;p<this.morphTargetManagers.length;++p){const e=this.morphTargetManagers[p];for(let p=0;p<e.numTargets;++p){const r=e.getTarget(p);if(r.id===w)return r}}return null}getMorphTargetByName(w){for(let p=0;p<this.morphTargetManagers.length;++p){const e=this.morphTargetManagers[p];for(let p=0;p<e.numTargets;++p){const r=e.getTarget(p);if(r.name===w)return r}}return null}getPostProcessByName(w){for(let p=0;p<this.postProcesses.length;++p){const e=this.postProcesses[p];if(e.name===w)return e}return null}isActiveMesh(w){return-1!==this._activeMeshes.indexOf(w)}get uid(){return this._uid||(this._uid=r.g.RandomId()),this._uid}addExternalData(w,p){return this._externalData||(this._externalData=new q),this._externalData.add(w,p)}getExternalData(w){return this._externalData?this._externalData.get(w):null}getOrAddExternalDataWithFactory(w,p){return this._externalData||(this._externalData=new q),this._externalData.getOrAddWithFactory(w,p)}removeExternalData(w){return this._externalData.remove(w)}_evaluateSubMesh(w,p,e,r){if(r||w.isInFrustum(this._frustumPlanes)){for(const r of this._evaluateSubMeshStage)r.action(p,w);const e=w.Yw();null!==e&&void 0!==e&&(e.hasRenderTargetTextures&&null!=e.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(e)&&(this._processedMaterials.push(e),this._materialsRenderTargets.concatWithNoDuplicate(e.getRenderTargetTextures())),this._renderingManager.dispatch(w,p,e))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(w){this._preventFreeActiveMeshesAndRenderingGroups!==w&&(w&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=w)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let w=0;w<this.activeCameras.length;w++){const p=this.activeCameras[w];p&&p._activeMeshes&&p._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let w=0;w<this.textures.length;w++){const p=this.textures[w];p&&p.renderList&&p.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=I,this._skipEvaluateActiveMeshesCompletely=w,r)for(let w=0;w<this._activeMeshes.length;w++)this._activeMeshes.data[w]._freeze();p&&p()}else e&&e("No active camera found")})),this}unfreezeActiveMeshes(){for(let w=0;w<this.meshes.length;w++){const p=this.meshes[w];p._internalAbstractMeshDataInfo&&(p._internalAbstractMeshDataInfo._isActive=!1)}for(let w=0;w<this._activeMeshes.length;w++)this._activeMeshes.data[w]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(w){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>w.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var w;if(this._activeMeshes.length>0)null===(w=this.activeCamera)||void 0===w||w._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const w=this._activeMeshes.length;for(let p=0;p<w;p++){this._activeMeshes.data[p].ke()}}if(this._activeParticleSystems){const w=this._activeParticleSystems.length;for(let p=0;p<w;p++)this._activeParticleSystems.data[p].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const r of this._beforeEvaluateActiveMeshStage)r.action();const p=this.getActiveMeshCandidates(),e=p.length;for(let r=0;r<e;r++){const w=p.data[r];let e=w._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(e?e[1]=-1:(e=[w,-1],w._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,e)),w.isBlocked)continue;if(this._totalVertices.addCount(w.getTotalVertices(),!1),!w.isReady()||!w.isEnabled()||w.Ne.hasAZeroComponent)continue;w.ke(),w.actionManager&&w.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(w);let I=this.customLODSelector?this.customLODSelector(w,this.activeCamera):w.getLOD(this.activeCamera);if(e[0]=I,e[1]=this._frameId,void 0!==I&&null!==I&&(I!==w&&0!==I.billboardMode&&I.ke(),w._preActivate(),w.isVisible&&w.visibility>0&&0!==(w.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||w.kE||w.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(w),this.activeCamera._activeMeshes.push(w),I!==w&&I._activate(this._renderId,!1);for(const p of this._preActiveMeshStage)p.action(w);w._activate(this._renderId,!1)&&(w.isAnInstance?w._internalAbstractMeshDataInfo._actAsRegularMesh&&(I=w):I._internalAbstractMeshDataInfo._onlyForInstances=!1,I._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(w,I)),w._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let w=0;w<this.tm.length;w++){const p=this.tm[w];if(!p.isStarted()||!p.i)continue;const e=p.i;e.position&&!e.isEnabled()||(this._activeParticleSystems.push(p),p.animate(),this._renderingManager.dispatchParticles(p))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(w){this._skeletonsEnabled&&w.skeleton&&(this._activeSkeletons.pushNoDuplicate(w.skeleton)&&(w.skeleton.prepare(),this._activeBones.addCount(w.skeleton.bones.length,!1)),w.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(w)&&this.frameGraph&&w.applySkeleton(w.skeleton))}_activeMesh(w,p){this._prepareSkeleton(p);let e=w.hasInstances||w.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||p.kE;if(p&&p.oe&&p.oe.length>0){const r=this.getActiveSubMeshCandidates(p),I=r.length;e=e||1===I;for(let d=0;d<I;d++){const I=r.data[d];this._evaluateSubMesh(I,p,w,e)}}}updateTransformMatrix(w){const p=this.activeCamera;if(p)if(p._renderingMultiview){const e=p._rigCameras[0],r=p._rigCameras[1];this.setTransformMatrix(e.getViewMatrix(),e.getProjectionMatrix(w),r.getViewMatrix(),r.getProjectionMatrix(w))}else this.setTransformMatrix(p.getViewMatrix(),p.getProjectionMatrix(w))}_bindFrameBuffer(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(w&&w._multiviewTexture?w._multiviewTexture._bindFrameBuffer():w&&w.outputRenderTarget?w.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),p&&this._clearFrameBuffer(w)}_clearFrameBuffer(w){if(w&&w._multiviewTexture);else if(w&&w.outputRenderTarget&&!w._renderingMultiview){const p=w.outputRenderTarget;p.onClearObservable.hasObservers()?p.onClearObservable.notifyObservers(this._engine):p.skipInitialClear||w.isRightCamera||(this.wm&&this._engine.clear(p.clearColor||this._clearColor,!p._cleared,!0,!0),p._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(w,p){var e;let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(w&&w._skipRendering)return;const d=this._engine;if(this._activeCamera=w,!this.activeCamera)throw new Error("Active camera not set");if(d.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&I){let p=!0;w._renderingMultiview&&w.outputRenderTarget&&(p=w.outputRenderTarget.skipInitialClear,this.wm&&(this._defaultFrameBufferCleared=!1,w.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),w._renderingMultiview&&w.outputRenderTarget&&(w.outputRenderTarget.skipInitialClear=p)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let r=0;r<this._softwareSkinnedMeshes.length;r++){const w=this._softwareSkinnedMeshes.data[r];w.applySkeleton(w.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),w.customRenderTargets&&w.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(w.customRenderTargets),p&&p.customRenderTargets&&p.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(p.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const r of this._gatherActiveCameraRenderTargetsStage)r.action(this._renderTargets);let f=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){r.g.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let w=0;w<this._renderTargets.length;w++){const p=this._renderTargets.data[w];if(p._shouldRender()){this._renderId++;const w=p.activeCamera&&p.activeCamera!==this.activeCamera;p.render(w,this.dumpNextRenderTargets),f=!0}}r.g.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const w of this._cameraDrawRenderTargetStage)f=w.action(this.activeCamera)||f;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(e=w.outputRenderTarget)||void 0===e?void 0:e.renderPassId)??w.renderPassId??0,f&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||w._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const r of this._beforeCameraDrawStage)r.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),d.snapshotRendering&&1===d.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const r of this._afterCameraDrawStage)r.action(this.activeCamera);if(this.postProcessManager&&!w._multiviewTexture){const p=w.outputRenderTarget?w.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(w.isIntermediate,p)}for(const r of this._afterCameraPostProcessStage)r.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===w.cameraRigMode||w._renderingMultiview)return w._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(w,void 0,p),void this.onAfterRenderCameraObservable.notifyObservers(w);if(w._useMultiviewToSingleView)this._renderMultiviewToSingleView(w);else{this.onBeforeCameraRenderObservable.notifyObservers(w);for(let p=0;p<w._rigCameras.length;p++)this._renderForCamera(w._rigCameras[p],w)}this._activeCamera=w,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(w)}_checkIntersections(){for(let w=0;w<this._meshesForIntersections.length;w++){const p=this._meshesForIntersections.data[w];if(p.actionManager)for(let w=0;p.actionManager&&w<p.actionManager.actions.length;w++){const e=p.actionManager.actions[w];if(12===e.trigger||13===e.trigger){const w=e.getTriggerParameter(),r=w.mesh?w.mesh:w,I=r.intersectsMesh(p,w.usePreciseIntersection),d=p._intersectionsInProgress.indexOf(r);I&&-1===d?12===e.trigger?(e._executeCurrent(J.CreateNew(p,void 0,r)),p._intersectionsInProgress.push(r)):13===e.trigger&&p._intersectionsInProgress.push(r):!I&&d>-1&&(13===e.trigger&&e._executeCurrent(J.CreateNew(p,void 0,r)),p.actionManager.hasSpecificTrigger(13,(w=>{const p=w.mesh?w.mesh:w;return r===p}))&&13!==e.trigger||p._intersectionsInProgress.splice(d,1))}}}}_advancePhysicsEngineStep(w){}_animate(w){}animate(){if(this._engine.isDeterministicLockStep()){let w=Math.max(ww.MinDeltaTime,Math.min(this._engine.getDeltaTime(),ww.MaxDeltaTime))+this._timeAccumulator;const p=this._engine.getTimeStep(),e=1e3/p/1e3;let r=0;const I=this._engine.getLockstepMaxSteps();let d=Math.floor(w/p);for(d=Math.min(d,I);w>0&&r<d;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=p*e,this._animate(p),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(p),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,r++,w-=p;this._timeAccumulator=w<0?0:w}else{const w=this.useConstantAnimationDeltaTime?16:Math.max(ww.MinDeltaTime,Math.min(this._engine.getDeltaTime(),ww.MaxDeltaTime));this._animationRatio=.06*w,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(w)}}_clear(){(this.autoClearDepthAndStencil||this.wm)&&this._engine.clear(this._clearColor,this.wm||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(w){var p;if(null===w||void 0===w||!w.outputRenderTarget||null!==w&&void 0!==w&&w.isRigCamera||(w.outputRenderTarget._cleared=!1),null!==w&&void 0!==w&&null!==(p=w.rigCameras)&&void 0!==p&&p.length)for(let e=0;e<w.rigCameras.length;++e){const p=w.rigCameras[e].outputRenderTarget;p&&(p._cleared=!1)}}resetDrawCache(w){if(this.meshes)for(const p of this.meshes)p.resetDrawCache(w)}_renderWithFrameGraph(){var w;let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),p)for(const I of this.cameras)if(I.update(),0!==I.cameraRigMode)for(let w=0;w<I._rigCameras.length;w++)I._rigCameras[w].update();this.onBeforeRenderObservable.notifyObservers(this);for(const I of this._beforeClearStage)I.action();const e=this.getActiveMeshCandidates(),r=e.length;for(let I=0;I<r;I++){const w=e.data[I];w.isBlocked||(this._totalVertices.addCount(w.getTotalVertices(),!1),w.isReady()&&w.isEnabled()&&!w.Ne.hasAZeroComponent&&(w.ke(),w.actionManager&&w.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(w)))}if(this.particlesEnabled)for(let I=0;I<this.tm.length;I++){const w=this.tm[I];if(!w.isStarted()||!w.i)continue;const p=w.i;p.position&&!p.isEnabled()||(this._activeParticleSystems.push(w),w.animate())}null===(w=this.frameGraph)||void 0===w||w.execute()}_renderRenderTarget(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,w._shouldRender()){if(this._renderId++,this.activeCamera=p,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),w.render(e,r)}this._intermediateRendering=!1}render(){var w;let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.K){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(w=this.activeCameras)&&void 0!==w&&w.length)for(const w of this.activeCameras)this._checkCameraRenderTarget(w);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),e||this.animate();for(const w of this._beforeCameraUpdateStage)w.action();if(p)if(this.activeCameras&&this.activeCameras.length>0)for(let w=0;w<this.activeCameras.length;w++){const p=this.activeCameras[w];if(p.update(),0!==p.cameraRigMode)for(let w=0;w<p._rigCameras.length;w++)p._rigCameras[w].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let w=0;w<this.activeCamera._rigCameras.length;w++)this.activeCamera._rigCameras[w].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(p,e);else{var I;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const w=null!==(I=this.activeCameras)&&void 0!==I&&I.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){r.g.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let p=0;p<this.customRenderTargets.length;p++){const e=this.customRenderTargets[p],r=e.activeCamera||this.activeCamera;this._renderRenderTarget(e,r,w!==r,this.dumpNextRenderTargets)}r.g.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===w||void 0===w?void 0:w.renderPassId)??0,this.activeCamera=w,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const p of this._beforeClearStage)p.action();this._clearFrameBuffer(this.activeCamera);for(const p of this._gatherRenderTargetsStage)p.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let p=0;p<this.activeCameras.length;p++)this._processSubCameras(this.activeCameras[p],p>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const w of this._afterRenderStage)w.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let w=0;w<this._toBeDisposed.length;w++){const p=this._toBeDisposed[w];p&&p.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let w=0;w<this.materials.length;w++)this.materials[w].freeze()}unfreezeMaterials(){for(let w=0;w<this.materials.length;w++)this.materials[w].unfreeze()}dispose(){if(this.K)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const w of this._activeAnimatables)w.onAnimationEndObservable.clear(),w.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const w=this._activeRequests.slice();for(const I of w)I.abort();this._activeRequests.length=0;try{this.ue.notifyObservers(this)}catch(r){x.c.Error("An error occurred while calling onDisposeObservable!",r)}this.Sk();if(this._engine.getInputElement())for(let I=0;I<this.cameras.length;I++)this.cameras[I].Sk();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.lk&&this.lk.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(w=>w.dispose(!0))),this._disposeList(this.transformNodes,(w=>w.dispose(!0)));const p=this.cameras;this._disposeList(p),this._disposeList(this.tm),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let e=this._engine.scenes.indexOf(this);if(e>-1&&this._engine.scenes.splice(e,1),O.d._LastCreatedScene===this){O.d._LastCreatedScene=null;let w=O.d.Instances.length-1;for(;w>=0;){const p=O.d.Instances[w];if(p.scenes.length>0){O.d._LastCreatedScene=p.scenes[this._engine.scenes.length-1];break}w--}}e=this._engine._virtualScenes.indexOf(this),e>-1&&this._engine._virtualScenes.splice(e,1),this._engine.wipeCaches(!0),this.ue.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(w,p){const e=w.slice(0);p=p??(w=>w.dispose());for(const r of e)p(r);w.length=0}get K(){return this._isDisposed}clearCachedVertexData(){for(let w=0;w<this.meshes.length;w++){const p=this.meshes[w].me;p&&p.clearCachedData()}}cleanCachedTextureBuffer(){for(const w of this.textures){w._buffer&&(w._buffer=null)}}getWorldExtends(w){const p=new j.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new j.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);w=w||(()=>!0);const r=this.meshes.filter(w);for(const I of r){if(I.ke(!0),!I.oe||0===I.oe.length||I.infiniteDistance)continue;const w=I.getBoundingInfo(),r=w.boundingBox.minimumWorld,d=w.boundingBox.maximumWorld;j.k.CheckExtends(r,p,e),j.k.CheckExtends(d,p,e)}return{min:p,max:e}}createPickingRay(w,p,e,r){throw(0,a.c)("Ray")}createPickingRayToRef(w,p,e,r,I){throw(0,a.c)("Ray")}createPickingRayInCameraSpace(w,p,e){throw(0,a.c)("Ray")}createPickingRayInCameraSpaceToRef(w,p,e,r){throw(0,a.c)("Ray")}Xe(w,p,e,r,I,d){const f=(0,a.c)("Ray",!0);return f&&x.c.Warn(f),new m.d}pickWithBoundingInfo(w,p,e,r,I){const d=(0,a.c)("Ray",!0);return d&&x.c.Warn(d),new m.d}pickWithRay(w,p,e,r){throw(0,a.c)("Ray")}multiPick(w,p,e,r,I){throw(0,a.c)("Ray")}multiPickWithRay(w,p,e){throw(0,a.c)("Ray")}setPointerOverMesh(w,p,e){this._inputManager.setPointerOverMesh(w,p,e)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const w of this.geometries)w._rebuild();for(const w of this.meshes)w._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const w of this._components)w.rebuild();for(const w of this.tm)w.rebuild();if(this.spriteManagers)for(const w of this.spriteManagers)w.rebuild()}_rebuildTextures(){for(const w of this.textures)w._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(w,p,e){if(void 0===p)return w;const r=[];for(const I in w){const d=w[I];E.b&&E.b.MatchesQuery(d,p)&&(!e||e(d))&&r.push(d)}return r}getMeshesByTags(w,p){return this._getByTags(this.meshes,w,p)}getCamerasByTags(w,p){return this._getByTags(this.cameras,w,p)}getLightsByTags(w,p){return this._getByTags(this.lights,w,p)}getMaterialByTags(w,p){return this._getByTags(this.materials,w,p).concat(this._getByTags(this.multiMaterials,w,p))}getTransformNodesByTags(w,p){return this._getByTags(this.transformNodes,w,p)}setRenderingOrder(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(w,p,e,r)}setRenderingAutoClearDepthStencil(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(w,p,e,r)}getAutoClearDepthStencilSetup(w){return this._renderingManager.getAutoClearDepthStencilSetup(w)}_forceBlockMaterialDirtyMechanism(w){this._blockMaterialDirtyMechanism=w}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(w){this._blockMaterialDirtyMechanism!==w&&(this._blockMaterialDirtyMechanism=w,w||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(w,p){if(!this._blockMaterialDirtyMechanism)for(const e of this.materials)p&&!p(e)||e.kX(w)}_loadFile(w,p,e,r,I,d,f){const q=(0,G.s)(w,p,e,r?this.offlineProvider:void 0,I,d,f);return this._activeRequests.push(q),q.onCompleteObservable.add((w=>{this._activeRequests.splice(this._activeRequests.indexOf(w),1)})),q}async _loadFileAsync(w,p,e,r,I){return await new Promise(((d,f)=>{this._loadFile(w,(w=>{d(w)}),p,e,r,((w,p)=>{f(p)}),I)}))}_requestFile(w,p,e,r,I,d,f){const q=(0,G.B)(w,p,e,r?this.offlineProvider:void 0,I,d,f);return this._activeRequests.push(q),q.onCompleteObservable.add((w=>{this._activeRequests.splice(this._activeRequests.indexOf(w),1)})),q}async _requestFileAsync(w,p,e,r,I){return await new Promise(((d,f)=>{this._requestFile(w,(w=>{d(w)}),p,e,r,(w=>{f(w)}),I)}))}_readFile(w,p,e,r,I){const d=(0,G.x)(w,p,e,r,I);return this._activeRequests.push(d),d.onCompleteObservable.add((w=>{this._activeRequests.splice(this._activeRequests.indexOf(w),1)})),d}async _readFileAsync(w,p,e){return await new Promise(((r,I)=>{this._readFile(w,(w=>{r(w)}),p,e,(w=>{I(w)}))}))}getPerfCollector(){throw(0,a.c)("performanceViewerSceneExtension")}setActiveCameraByID(w){return this.setActiveCameraById(w)}getMaterialByID(w){return this.getMaterialById(w)}getLastMaterialByID(w){return this.getLastMaterialById(w)}getTextureByUniqueID(w){return this.getTextureByUniqueId(w)}getCameraByID(w){return this.getCameraById(w)}getCameraByUniqueID(w){return this.getCameraByUniqueId(w)}getBoneByID(w){return this.getBoneById(w)}getLightByID(w){return this.getLightById(w)}getLightByUniqueID(w){return this.getLightByUniqueId(w)}getParticleSystemByID(w){return this.getParticleSystemById(w)}getGeometryByID(w){return this.getGeometryById(w)}getMeshByID(w){return this.getMeshById(w)}getMeshByUniqueID(w){return this.getMeshByUniqueId(w)}getLastMeshByID(w){return this.getLastMeshById(w)}getMeshesByID(w){return this.getMeshesById(w)}getTransformNodeByID(w){return this.getTransformNodeById(w)}getTransformNodeByUniqueID(w){return this.getTransformNodeByUniqueId(w)}getTransformNodesByID(w){return this.getTransformNodesById(w)}getNodeByID(w){return this.getNodeById(w)}getLastEntryByID(w){return this.getLastEntryById(w)}getLastSkeletonByID(w){return this.getLastSkeletonById(w)}}ww.FOGMODE_NONE=0,ww.FOGMODE_EXP=1,ww.FOGMODE_EXP2=2,ww.FOGMODE_LINEAR=3,ww.MinDeltaTime=1,ww.MaxDeltaTime=1e3,ww._OriginalDefaultMaterialFactory=ww.DefaultMaterialFactory,(0,S.d)("BABYLON.Scene",ww)},11408:(w,p,e)=>{e.d(p,{d:()=>r,g:()=>I});class r{}r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="fd",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_PREPASSRENDERER="PrePassRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_SUBSURFACE="SubSurface",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Ed",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.NAME_FLUIDRENDERER="FluidRenderer",r.NAME_IBLCDFGENERATOR="iblCDFGenerator",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_PREPASS=0,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_LAYER=2,r.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,r.STEP_BEFORERENDERTARGETDRAW_LAYER=1,r.STEP_BEFORERENDERINGMESH_PREPASS=0,r.STEP_BEFORERENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGMESH_PREPASS=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_BEFORECLEAR_PREPASS=1,r.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_LAYER=1,r.STEP_AFTERCAMERADRAW_PREPASS=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,r.STEP_AFTERCAMERADRAW_LAYER=4,r.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,r.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,r.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0;class I extends Array{constructor(w){super(...w)}static Create(){return Object.create(I.prototype)}registerStep(w,p,e){let r=0,I=Number.MAX_VALUE;for(;r<this.length;r++){if(I=this[r].index,w<I)break}this.splice(r,0,{index:w,component:p,action:e.bind(p)})}clear(){this.length=0}}},11207:(w,p,e)=>{e.d(p,{c:()=>r});function r(w,p,e,r){var I,d=arguments.length,f=d<3?p:null===r?r=Object.getOwnPropertyDescriptor(p,e):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(w,p,e,r);else for(var q=w.length-1;q>=0;q--)(I=w[q])&&(f=(d<3?I(f):d>3?I(p,e,f):I(p,e))||f);return d>3&&f&&Object.defineProperty(p,e,f),f}Object.create;Object.create}}]);