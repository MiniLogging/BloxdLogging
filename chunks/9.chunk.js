/*! For license information please see 96t3hv.9.65aa5b9a.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10802:function(N,q){!function(N){"use strict";var q=function(N,R){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,q){N.__proto__=q}||function(N,q){for(var R in q)Object.prototype.hasOwnProperty.call(q,R)&&(N[R]=q[R])},q(N,R)};function R(N,R){if("function"!==typeof R&&null!==R)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function z(){this.constructor=N}q(N,R),N.prototype=null===R?Object.create(R):(z.prototype=R.prototype,new z)}function z(N,q,R,z){var v,B=arguments.length,F=B<3?q:null===z?z=Object.getOwnPropertyDescriptor(q,R):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)F=Reflect.decorate(N,q,R,z);else for(var S=N.length-1;S>=0;S--)(v=N[S])&&(F=(B<3?v(F):B>3?v(q,R,F):v(q,R))||F);return B>3&&F&&Object.defineProperty(q,R,F),F}function v(N,q,R){if(R||2===arguments.length)for(var z,v=0,B=q.length;v<B;v++)!z&&v in q||(z||(z=Array.prototype.slice.call(q,0,v)),z[v]=q[v]);return N.concat(z||Array.prototype.slice.call(q))}var B,F=255,S=213;N.OPERATION=void 0,(B=N.OPERATION||(N.OPERATION={}))[B.ADD=128]="ADD",B[B.REPLACE=0]="REPLACE",B[B.DELETE=64]="DELETE",B[B.DELETE_AND_ADD=192]="DELETE_AND_ADD",B[B.TOUCH=1]="TOUCH",B[B.CLEAR=10]="CLEAR";var A=function(){function q(N,q,R){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=N,this.setParent(q,R)}return q.prototype.setParent=function(N,q,R){var z=this;if(this.indexes||(this.indexes=this.ref instanceof ZN?this.ref._definition.indexes:{}),this.parent=N,this.parentIndex=R,q)if(this.root=q,this.ref instanceof ZN){var v=this.ref._definition;for(var B in v.schema){var F=this.ref[B];if(F&&F.$changes){var S=v.indexes[B];F.$changes.setParent(this.ref,q,S)}}}else"object"===typeof this.ref&&this.ref.forEach((function(N,q){if(N instanceof ZN){var R=N.$changes,v=z.ref.$changes.indexes[q];R.setParent(z.ref,z.root,v)}}))},q.prototype.operation=function(N){this.changes.set(--this.currentCustomOperation,N)},q.prototype.change=function(q,R){void 0===R&&(R=N.OPERATION.ADD);var z="number"===typeof q?q:this.indexes[q];this.assertValidIndex(z,q);var v=this.changes.get(z);v&&v.op!==N.OPERATION.DELETE&&v.op!==N.OPERATION.TOUCH||this.changes.set(z,{op:v&&v.op===N.OPERATION.DELETE?N.OPERATION.DELETE_AND_ADD:R,index:z}),this.allChanges.add(z),this.changed=!0,this.touchParents()},q.prototype.touch=function(q){var R="number"===typeof q?q:this.indexes[q];this.assertValidIndex(R,q),this.changes.has(R)||this.changes.set(R,{op:N.OPERATION.TOUCH,index:R}),this.allChanges.add(R),this.touchParents()},q.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},q.prototype.getType=function(N){if(this.ref._definition)return(q=this.ref._definition).schema[q.fieldsByIndex[N]];var q,R=(q=this.parent._definition).schema[q.fieldsByIndex[this.parentIndex]];return Object.values(R)[0]},q.prototype.getChildrenFilter=function(){var N=this.parent._definition.childFilters;return N&&N[this.parentIndex]},q.prototype.getValue=function(N){return this.ref.getByIndex(N)},q.prototype.delete=function(q){var R="number"===typeof q?q:this.indexes[q];if(void 0!==R){var z=this.getValue(R);this.changes.set(R,{op:N.OPERATION.DELETE,index:R}),this.allChanges.delete(R),delete this.caches[R],z&&z.$changes&&(z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(q," (").concat(R,")"))},q.prototype.discard=function(q,R){var z=this;void 0===q&&(q=!1),void 0===R&&(R=!1),this.ref instanceof ZN||this.changes.forEach((function(q){if(q.op===N.OPERATION.DELETE){var R=z.ref.getIndex(q.index);delete z.indexes[R]}})),this.changes.clear(),this.changed=q,R&&this.allChanges.clear(),this.currentCustomOperation=0},q.prototype.discardAll=function(){var N=this;this.changes.forEach((function(q){var R=N.getValue(q.index);R&&R.$changes&&R.$changes.discardAll()})),this.discard()},q.prototype.cache=function(N,q){this.caches[N]=q},q.prototype.clone=function(){return new q(this.ref,this.parent,this.root)},q.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},q.prototype.assertValidIndex=function(N,q){if(void 0===N)throw new Error('ChangeTree: missing index for field "'.concat(q,'"'))},q}();function y(N,q,R,z){return N[q]||(N[q]=[]),N[q].push(R),null===z||void 0===z||z.forEach((function(N,q){return R(N,q)})),function(){return t(N[q],N[q].indexOf(R))}}function E(q){var R=this,z="string"!==typeof this.$changes.getType();this.$items.forEach((function(v,B){q.push({refId:R.$changes.refId,op:N.OPERATION.DELETE,field:B,value:void 0,previousValue:v}),z&&R.$changes.root.removeRef(v.$changes.refId)}))}function t(N,q){if(-1===q||q>=N.length)return!1;for(var R=N.length-1,z=q;z<R;z++)N[z]=N[z+1];return N.length=R,!0}var x=function(N,q){var R=N.toString(),z=q.toString();return R<z?-1:R>z?1:0};function e(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,q){return"symbol"===typeof q||isNaN(q)?N[q]:N.at(q)},set:function(N,q,R){if("symbol"===typeof q||isNaN(q))N[q]=R;else{var z=Array.from(N.$items.keys()),v=parseInt(z[q]||q);void 0===R||null===R?N.deleteAt(v):N.setAt(v,R)}return!0},deleteProperty:function(N,q){return"number"===typeof q?N.deleteAt(q):delete N[q],!0}})}var b=function(){function q(){for(var N=[],q=0;q<arguments.length;q++)N[q]=arguments[q];this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,N)}return q.prototype.Zd=function(q,R){return void 0===R&&(R=!0),y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,R?this.$items:void 0)},q.prototype.ab=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return Array.isArray(N)||void 0!==N.array},Object.defineProperty(q.prototype,"length",{get:function(){return this.$items.size},set:function(N){0===N?this.clear():this.splice(N,this.length-N)},enumerable:!1,configurable:!0}),q.prototype.push=function(){for(var N,q=this,R=[],z=0;z<arguments.length;z++)R[z]=arguments[z];return R.forEach((function(R){N=q.$refId++,q.setAt(N,R)})),N},q.prototype.pop=function(){var N=Array.from(this.$indexes.values()).pop();if(void 0!==N){this.$changes.delete(N),this.$indexes.delete(N);var q=this.$items.get(N);return this.$items.delete(N),q}},q.prototype.at=function(N){var q=Array.from(this.$items.keys())[N];return this.$items.get(q)},q.prototype.setAt=function(q,R){var z,v;if(void 0!==R&&null!==R){if(this.$items.get(q)!==R){void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,q);var B=null!==(v=null===(z=this.$changes.indexes[q])||void 0===z?void 0:z.op)&&void 0!==v?v:N.OPERATION.ADD;this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,R),this.$changes.change(q,B)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},q.prototype.deleteAt=function(N){var q=Array.from(this.$items.keys())[N];return void 0!==q&&this.$deleteAt(q)},q.prototype.$deleteAt=function(N){return this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&E.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.concat=function(){for(var N,R=[],z=0;z<arguments.length;z++)R[z]=arguments[z];return new(q.bind.apply(q,v([void 0],(N=Array.from(this.$items.values())).concat.apply(N,R),!1)))},q.prototype.join=function(N){return Array.from(this.$items.values()).join(N)},q.prototype.reverse=function(){var N=this,q=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(R,z){N.setAt(q[z],R)})),this},q.prototype.shift=function(){var N=Array.from(this.$items.keys()).shift();if(void 0!==N){var q=this.$items.get(N);return this.$deleteAt(N),q}},q.prototype.slice=function(N,R){var z=new q;return z.push.apply(z,Array.from(this.$items.values()).slice(N,R)),z},q.prototype.sort=function(N){var q=this;void 0===N&&(N=x);var R=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(N).forEach((function(N,z){q.setAt(R[z],N)})),this},q.prototype.splice=function(N,q){void 0===q&&(q=this.length-N);for(var R=Array.from(this.$items.keys()),z=[],v=N;v<N+q;v++)z.push(this.$items.get(R[v])),this.$deleteAt(R[v]);return z},q.prototype.unshift=function(){for(var N=this,q=[],R=0;R<arguments.length;R++)q[R]=arguments[R];var z=this.length,v=q.length,B=Array.from(this.$items.values());return q.forEach((function(q,R){N.setAt(R,q)})),B.forEach((function(q,R){N.setAt(v+R,q)})),z+v},q.prototype.indexOf=function(N,q){return Array.from(this.$items.values()).indexOf(N,q)},q.prototype.lastIndexOf=function(N,q){return void 0===q&&(q=this.length-1),Array.from(this.$items.values()).lastIndexOf(N,q)},q.prototype.every=function(N,q){return Array.from(this.$items.values()).every(N,q)},q.prototype.some=function(N,q){return Array.from(this.$items.values()).some(N,q)},q.prototype.forEach=function(N,q){Array.from(this.$items.values()).forEach(N,q)},q.prototype.map=function(N,q){return Array.from(this.$items.values()).map(N,q)},q.prototype.filter=function(N,q){return Array.from(this.$items.values()).filter(N,q)},q.prototype.reduce=function(N,q){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},q.prototype.reduceRight=function(N,q){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},q.prototype.find=function(N,q){return Array.from(this.$items.values()).find(N,q)},q.prototype.findIndex=function(N,q){return Array.from(this.$items.values()).findIndex(N,q)},q.prototype.fill=function(N,q,R){throw new Error("ArraySchema#fill() not implemented")},q.prototype.copyWithin=function(N,q,R){throw new Error("ArraySchema#copyWithin() not implemented")},q.prototype.toString=function(){return this.$items.toString()},q.prototype.toLocaleString=function(){return this.$items.toLocaleString()},q.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},q.prototype.includes=function(N,q){return Array.from(this.$items.values()).includes(N,q)},q.prototype.flatMap=function(N,q){throw new Error("ArraySchema#flatMap() is not supported.")},q.prototype.flat=function(N){throw new Error("ArraySchema#flat() is not supported.")},q.prototype.findLast=function(){var N=Array.from(this.$items.values());return N.findLast.apply(N,arguments)},q.prototype.findLastIndex=function(){var N=Array.from(this.$items.values());return N.findLastIndex.apply(N,arguments)},q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){return this.toArray().map((function(N){return"function"===typeof N.toJSON?N.toJSON():N}))},q.prototype.clone=function(N){return N?new(q.bind.apply(q,v([void 0],Array.from(this.$items.values()),!1))):new(q.bind.apply(q,v([void 0],this.map((function(N){return N.$changes?N.clone():N})),!1)))},q}();function f(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,q){return"symbol"!==typeof q&&"undefined"===typeof N[q]?N.get(q):N[q]},set:function(N,q,R){return"symbol"!==typeof q&&-1===q.indexOf("$")&&"Zd"!==q&&"ab"!==q&&"onChange"!==q?N.set(q,R):N[q]=R,!0},deleteProperty:function(N,q){return N.delete(q),!0}})}var D=function(){function q(N){var R=this;if(this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N)if(N instanceof Map||N instanceof q)N.forEach((function(N,q){return R.set(q,N)}));else for(var z in N)this.set(z,N[z])}return q.prototype.Zd=function(q,R){return void 0===R&&(R=!0),y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,R?this.$items:void 0)},q.prototype.ab=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return void 0!==N.map},q.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(q.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.set=function(q,R){if(void 0===R||null===R)throw new Error("MapSchema#set('".concat(q,"', ").concat(R,"): trying to set ").concat(R," value on '").concat(q,"'."));q=q.toString();var z="undefined"!==typeof this.$changes.indexes[q],v=z?this.$changes.indexes[q]:this.$refId++,B=z?N.OPERATION.REPLACE:N.OPERATION.ADD,F=void 0!==R.$changes;if(F&&R.$changes.setParent(this,this.$changes.root,v),z){if(!F&&this.$items.get(q)===R)return;F&&this.$items.get(q)!==R&&(B=N.OPERATION.ADD)}else this.$changes.indexes[q]=v,this.$indexes.set(v,q);return this.$items.set(q,R),this.$changes.change(q,B),this},q.prototype.get=function(N){return this.$items.get(N)},q.prototype.delete=function(N){return this.$changes.delete(N),this.$items.delete(N)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&E.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(N){return this.$items.has(N)},q.prototype.forEach=function(N){this.$items.forEach(N)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toJSON=function(){var N={};return this.forEach((function(q,R){N[R]="function"===typeof q.toJSON?q.toJSON():q})),N},q.prototype.clone=function(N){var R;return N?R=Object.assign(new q,this):(R=new q,this.forEach((function(N,q){N.$changes?R.set(q,N.clone()):R.set(q,N)}))),R},q}(),V={};function H(N,q){V[N]=q}function Y(N){return V[N]}var T=function(){function N(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return N.create=function(q){var R=new N;return R.schema=Object.assign({},q&&q.schema||{}),R.indexes=Object.assign({},q&&q.indexes||{}),R.fieldsByIndex=Object.assign({},q&&q.fieldsByIndex||{}),R.descriptors=Object.assign({},q&&q.descriptors||{}),R.deprecated=Object.assign({},q&&q.deprecated||{}),R},N.prototype.addField=function(N,q){var R=this.getNextFieldIndex();this.fieldsByIndex[R]=N,this.indexes[N]=R,this.schema[N]=Array.isArray(q)?{array:q[0]}:q},N.prototype.hasField=function(N){return void 0!==this.indexes[N]},N.prototype.addFilter=function(N,q){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[N]]=q,this.indexesWithFilters.push(this.indexes[N]),!0},N.prototype.addChildrenFilter=function(N,q){var R=this.indexes[N],z=this.schema[N];if(Y(Object.keys(z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[R]=q,!0;console.warn("@filterChildren: field '".concat(N,"' can't have children. Ignoring filter."))},N.prototype.getChildrenFilter=function(N){return this.childFilters&&this.childFilters[this.indexes[N]]},N.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},N}();function L(N){return N._context&&N._context.useFilters}var X=function(){function N(){this.types={},this.schemas=new Map,this.useFilters=!1}return N.prototype.has=function(N){return this.schemas.has(N)},N.prototype.get=function(N){return this.types[N]},N.prototype.add=function(N,q){void 0===q&&(q=this.schemas.size),N._definition=T.create(N._definition),N._typeid=q,this.types[q]=N,this.schemas.set(N,q)},N.create=function(q){return void 0===q&&(q={}),function(R){return q.context||(q.context=new N),h(R,q)}},N}(),Q=new X;function h(N,q){return void 0===q&&(q={}),function(R,z){var B=q.context||Q,F=R.constructor;if(F._context=B,!N)throw new Error("".concat(F.name,': @type() reference provided for "').concat(z,"\" is undefined. Make sure you don't have any circular dependencies."));B.has(F)||B.add(F);var S=F._definition;if(S.addField(z,N),S.descriptors[z]){if(S.deprecated[z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(z,"' definition on '").concat(F.name,"'.\nCheck @type() annotation"))}catch(V){var A=V.stack.split("\n")[4].trim();throw new Error("".concat(V.message," ").concat(A))}}var y=b.is(N),E=!y&&D.is(N);if("string"!==typeof N&&!ZN.is(N)){var t=Object.values(N)[0];"string"===typeof t||B.has(t)||B.add(t)}if(q.manual)S.descriptors[z]={enumerable:!0,configurable:!0,writable:!0};else{var x="_".concat(z);S.descriptors[x]={enumerable:!1,configurable:!1,writable:!0},S.descriptors[z]={get:function(){return this[x]},set:function(N){N!==this[x]&&(void 0!==N&&null!==N?(!y||N instanceof b||(N=new(b.bind.apply(b,v([void 0],N,!1)))),!E||N instanceof D||(N=new D(N)),void 0===N.$proxy&&(E?N=f(N):y&&(N=e(N))),this.$changes.change(z),N.$changes&&N.$changes.setParent(this,this.$changes.root,this._definition.indexes[z])):this[x]&&this.$changes.delete(z),this[x]=N)},enumerable:!0,configurable:!0}}}}function u(N){return function(q,R){var z=q.constructor;z._definition.addFilter(R,N)&&(z._context.useFilters=!0)}}function w(N){return function(q,R){var z=q.constructor;z._definition.addChildrenFilter(R,N)&&(z._context.useFilters=!0)}}function c(N){return void 0===N&&(N=!0),function(q,R){var z=q.constructor._definition;z.deprecated[R]=!0,N&&(z.descriptors[R]={get:function(){throw new Error("".concat(R," is deprecated."))},set:function(N){},enumerable:!1,configurable:!0})}}function n(N,q,R){for(var z in void 0===R&&(R={}),R.context||(R.context=N._context||R.context||Q),q)h(q[z],R)(N.prototype,z);return N}function G(N){for(var q=0,R=0,z=0,v=N.length;z<v;z++)(q=N.charCodeAt(z))<128?R+=1:q<2048?R+=2:q<55296||q>=57344?R+=3:(z++,R+=4);return R}function s(N,q,R){for(var z=0,v=0,B=R.length;v<B;v++)(z=R.charCodeAt(v))<128?N[q++]=z:z<2048?(N[q++]=192|z>>6,N[q++]=128|63&z):z<55296||z>=57344?(N[q++]=224|z>>12,N[q++]=128|z>>6&63,N[q++]=128|63&z):(v++,z=65536+((1023&z)<<10|1023&R.charCodeAt(v)),N[q++]=240|z>>18,N[q++]=128|z>>12&63,N[q++]=128|z>>6&63,N[q++]=128|63&z)}function Z(N,q){N.push(255&q)}function J(N,q){N.push(255&q)}function M(N,q){N.push(255&q),N.push(q>>8&255)}function m(N,q){N.push(255&q),N.push(q>>8&255)}function g(N,q){N.push(255&q),N.push(q>>8&255),N.push(q>>16&255),N.push(q>>24&255)}function j(N,q){var R=q>>24,z=q>>16,v=q>>8,B=q;N.push(255&B),N.push(255&v),N.push(255&z),N.push(255&R)}function l(N,q){var R=Math.floor(q/Math.pow(2,32));j(N,q>>>0),j(N,R)}function I(N,q){var R=q/Math.pow(2,32)|0;j(N,q>>>0),j(N,R)}function U(N,q){o(N,q)}function O(N,q){C(N,q)}var i=new Int32Array(2),P=new Float32Array(i.buffer),k=new Float64Array(i.buffer);function o(N,q){P[0]=q,g(N,i[0])}function C(N,q){k[0]=q,g(N,i[0]),g(N,i[1])}function K(N,q){return J(N,q?1:0)}function r(N,q){q||(q="");var R=G(q),z=0;if(R<32)N.push(160|R),z=1;else if(R<256)N.push(217),J(N,R),z=2;else if(R<65536)N.push(218),m(N,R),z=3;else{if(!(R<4294967296))throw new Error("String too long");N.push(219),j(N,R),z=5}return s(N,N.length,q),z+R}function a(N,q){return isNaN(q)?a(N,0):isFinite(q)?q!==(0|q)?(N.push(203),C(N,q),9):q>=0?q<128?(J(N,q),1):q<256?(N.push(204),J(N,q),2):q<65536?(N.push(205),m(N,q),3):q<4294967296?(N.push(206),j(N,q),5):(N.push(207),I(N,q),9):q>=-32?(N.push(224|q+32),1):q>=-128?(N.push(208),Z(N,q),2):q>=-32768?(N.push(209),M(N,q),3):q>=-2147483648?(N.push(210),g(N,q),5):(N.push(211),l(N,q),9):a(N,q>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var d=Object.freeze({__proto__:null,utf8Write:s,int8:Z,uint8:J,int16:M,uint16:m,int32:g,uint32:j,int64:l,uint64:I,float32:U,float64:O,writeFloat32:o,writeFloat64:C,boolean:K,string:r,number:a});function p(N,q,R){for(var z="",v=0,B=q,F=q+R;B<F;B++){var S=N[B];0!==(128&S)?192!==(224&S)?224!==(240&S)?240!==(248&S)?console.error("Invalid byte "+S.toString(16)):(v=(7&S)<<18|(63&N[++B])<<12|(63&N[++B])<<6|63&N[++B])>=65536?(v-=65536,z+=String.fromCharCode(55296+(v>>>10),56320+(1023&v))):z+=String.fromCharCode(v):z+=String.fromCharCode((15&S)<<12|(63&N[++B])<<6|63&N[++B]):z+=String.fromCharCode((31&S)<<6|63&N[++B]):z+=String.fromCharCode(S)}return z}function W(N,q){return NN(N,q)<<24>>24}function NN(N,q){return N[q.offset++]}function qN(N,q){return RN(N,q)<<16>>16}function RN(N,q){return N[q.offset++]|N[q.offset++]<<8}function zN(N,q){return N[q.offset++]|N[q.offset++]<<8|N[q.offset++]<<16|N[q.offset++]<<24}function vN(N,q){return zN(N,q)>>>0}function BN(N,q){return xN(N,q)}function FN(N,q){return eN(N,q)}function SN(N,q){var R=vN(N,q);return zN(N,q)*Math.pow(2,32)+R}function AN(N,q){var R=vN(N,q);return vN(N,q)*Math.pow(2,32)+R}var yN=new Int32Array(2),EN=new Float32Array(yN.buffer),tN=new Float64Array(yN.buffer);function xN(N,q){return yN[0]=zN(N,q),EN[0]}function eN(N,q){return yN[0]=zN(N,q),yN[1]=zN(N,q),tN[0]}function bN(N,q){return NN(N,q)>0}function fN(N,q){var R,z=N[q.offset++];z<192?R=31&z:217===z?R=NN(N,q):218===z?R=RN(N,q):219===z&&(R=vN(N,q));var v=p(N,q.offset,R);return q.offset+=R,v}function DN(N,q){var R=N[q.offset];return R<192&&R>160||217===R||218===R||219===R}function VN(N,q){var R=N[q.offset++];return R<128?R:202===R?xN(N,q):203===R?eN(N,q):204===R?NN(N,q):205===R?RN(N,q):206===R?vN(N,q):207===R?AN(N,q):208===R?W(N,q):209===R?qN(N,q):210===R?zN(N,q):211===R?SN(N,q):R>223?-1*(255-R+1):void 0}function HN(N,q){var R=N[q.offset];return R<128||R>=202&&R<=211}function YN(N,q){return N[q.offset]<160}function TN(N,q){return N[q.offset-1]===F&&(N[q.offset]<128||N[q.offset]>=202&&N[q.offset]<=211)}var LN=Object.freeze({__proto__:null,int8:W,uint8:NN,int16:qN,uint16:RN,int32:zN,uint32:vN,float32:BN,float64:FN,int64:SN,uint64:AN,readFloat32:xN,readFloat64:eN,boolean:bN,string:fN,stringCheck:DN,number:VN,numberCheck:HN,arrayCheck:YN,switchStructureCheck:TN}),XN=function(){function q(N){var q=this;this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return q.add(N)}))}return q.prototype.Zd=function(q,R){return void 0===R&&(R=!0),y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,R?this.$items:void 0)},q.prototype.ab=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return void 0!==N.collection},q.prototype.add=function(N){var q=this.$refId++;return void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,q),this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,N),this.$changes.change(q),q},q.prototype.at=function(N){var q=Array.from(this.$items.keys())[N];return this.$items.get(q)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(N){for(var q,R,z=this.$items.entries();(R=z.next())&&!R.done;)if(N===R.value[1]){q=R.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&E.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(N){return Array.from(this.$items.values()).some((function(q){return q===N}))},q.prototype.forEach=function(N){var q=this;this.$items.forEach((function(R,z,v){return N(R,z,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var N=[];return this.forEach((function(q,R){N.push("function"===typeof q.toJSON?q.toJSON():q)})),N},q.prototype.clone=function(N){var R;return N?R=Object.assign(new q,this):(R=new q,this.forEach((function(N){N.$changes?R.add(N.clone()):R.add(N)}))),R},q}(),QN=function(){function q(N){var q=this;this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return q.add(N)}))}return q.prototype.Zd=function(q,R){return void 0===R&&(R=!0),y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,R?this.$items:void 0)},q.prototype.ab=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return void 0!==N.set},q.prototype.add=function(q){var R,z;if(this.has(q))return!1;var v=this.$refId++;void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,v);var B=null!==(z=null===(R=this.$changes.indexes[v])||void 0===R?void 0:R.op)&&void 0!==z?z:N.OPERATION.ADD;return this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,q),this.$changes.change(v,B),v},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(N){for(var q,R,z=this.$items.entries();(R=z.next())&&!R.done;)if(N===R.value[1]){q=R.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&E.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(N){for(var q,R=this.$items.values(),z=!1;(q=R.next())&&!q.done;)if(N===q.value){z=!0;break}return z},q.prototype.forEach=function(N){var q=this;this.$items.forEach((function(R,z,v){return N(R,z,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var N=[];return this.forEach((function(q,R){N.push("function"===typeof q.toJSON?q.toJSON():q)})),N},q.prototype.clone=function(N){var R;return N?R=Object.assign(new q,this):(R=new q,this.forEach((function(N){N.$changes?R.add(N.clone()):R.add(N)}))),R},q}(),hN=function(){function N(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return N.prototype.addRefId=function(N){this.refIds.has(N)||(this.refIds.add(N),this.containerIndexes.set(N,new Set))},N.get=function(q){return void 0===q.$filterState&&(q.$filterState=new N),q.$filterState},N}(),uN=function(){function N(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return N.prototype.getNextUniqueId=function(){return this.nextUniqueId++},N.prototype.addRef=function(N,q,R){void 0===R&&(R=!0),this.refs.set(N,q),R&&(this.refCounts[N]=(this.refCounts[N]||0)+1)},N.prototype.removeRef=function(N){this.refCounts[N]=this.refCounts[N]-1,this.deletedRefs.add(N)},N.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},N.prototype.garbageCollectDeletedRefs=function(){var N=this;this.deletedRefs.forEach((function(q){if(!(N.refCounts[q]>0)){var R=N.refs.get(q);if(R instanceof ZN)for(var z in R._definition.schema)"string"!==typeof R._definition.schema[z]&&R[z]&&R[z].$changes&&N.removeRef(R[z].$changes.refId);else{var v=R.$changes.parent._definition,B=v.schema[v.fieldsByIndex[R.$changes.parentIndex]];"function"===typeof Object.values(B)[0]&&Array.from(R.values()).forEach((function(q){return N.removeRef(q.$changes.refId)}))}N.refs.delete(q),delete N.refCounts[q]}})),this.deletedRefs.clear()},N}(),wN=function(N){function q(){return null!==N&&N.apply(this,arguments)||this}return R(q,N),q}(Error);function cN(N,q,R,z){var v,B=!1;switch(q){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":v="number",isNaN(N)&&console.log('trying to encode "NaN" in '.concat(R.constructor.name,"#").concat(z));break;case"string":v="string",B=!0;break;case"boolean":return}if(typeof N!==v&&(!B||B&&null!==N)){var F="'".concat(JSON.stringify(N),"'").concat(N&&N.constructor&&" (".concat(N.constructor.name,")")||"");throw new wN("a '".concat(v,"' was expected, but ").concat(F," was provided in ").concat(R.constructor.name,"#").concat(z))}}function nN(N,q,R,z){if(!(N instanceof q))throw new wN("a '".concat(q.name,"' was expected, but '").concat(N.constructor.name,"' was provided in ").concat(R.constructor.name,"#").concat(z))}function GN(N,q,R,z,v){cN(R,N,z,v);var B=d[N];if(!B)throw new wN("a '".concat(N,"' was expected, but ").concat(R," was provided in ").concat(z.constructor.name,"#").concat(v));B(q,R)}function sN(N,q,R){return LN[N](q,R)}var ZN=function(){function q(){for(var N=[],q=0;q<arguments.length;q++)N[q]=arguments[q];Object.defineProperties(this,{$changes:{value:new A(this,void 0,new uN),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var R=this._definition.descriptors;R&&Object.defineProperties(this,R),N[0]&&this.assign(N[0])}return q.onError=function(N){console.error(N)},q.is=function(N){return N._definition&&void 0!==N._definition.schema},q.prototype.onChange=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.prototype.ab=function(q){return y(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.assign=function(N){return Object.assign(this,N),this},Object.defineProperty(q.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),q.prototype.setDirty=function(N,q){this.$changes.change(N,q)},q.prototype.listen=function(N,q,R){var z=this;return void 0===R&&(R=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[N]||(this.$callbacks[N]=[]),this.$callbacks[N].push(q),R&&void 0!==this[N]&&q(this[N],void 0),function(){return t(z.$callbacks[N],z.$callbacks[N].indexOf(q))}},q.prototype.decode=function(R,z,v){var B;void 0===z&&(z={offset:0}),void 0===v&&(v=this);var S=[],A=this.$changes.root,y=R.length,E=0;for(A.refs.set(E,this);z.offset<y;){var t=R[z.offset++];if(t!=F){var x=v.$changes,e=void 0!==v._definition,f=e?t>>6<<6:t;if(f!==N.OPERATION.CLEAR){var V=e?t%(f||255):VN(R,z),H=e?v._definition.fieldsByIndex[V]:"",T=x.getType(V),L=void 0,X=void 0,Q=void 0;if(e?X=v["_".concat(H)]:(X=v.getByIndex(V),(f&N.OPERATION.ADD)===N.OPERATION.ADD?(Q=v instanceof D?fN(R,z):V,v.setIndex(V,Q)):Q=v.getIndex(V)),(f&N.OPERATION.DELETE)===N.OPERATION.DELETE&&(f!==N.OPERATION.DELETE_AND_ADD&&v.deleteByIndex(V),X&&X.$changes&&A.removeRef(X.$changes.refId),L=null),void 0!==H){if(f===N.OPERATION.DELETE);else if(q.is(T)){var h=VN(R,z);if(L=A.refs.get(h),f!==N.OPERATION.REPLACE){var u=this.getSchemaType(R,z,T);L||((L=this.createTypeInstance(u)).$changes.refId=h,X&&(L.$callbacks=X.$callbacks,X.$changes.refId&&h!==X.$changes.refId&&A.removeRef(X.$changes.refId))),A.addRef(h,L,L!==X)}}else if("string"===typeof T)L=sN(T,R,z);else{var w=Y(Object.keys(T)[0]),c=VN(R,z),n=A.refs.has(c)?X||A.refs.get(c):new w.constructor;if((L=n.clone(!0)).$changes.refId=c,X&&(L.$callbacks=X.$callbacks,X.$changes.refId&&c!==X.$changes.refId)){A.removeRef(X.$changes.refId);for(var G=X.entries(),s=void 0;(s=G.next())&&!s.done;){var Z=(B=s.value)[0],J=B[1];S.push({refId:c,op:N.OPERATION.DELETE,field:Z,value:void 0,previousValue:J})}}A.addRef(c,L,n!==X)}if(null!==L&&void 0!==L)if(L.$changes&&L.$changes.setParent(x.ref,x.root,V),v instanceof q)v[H]=L;else if(v instanceof D)Z=Q,v.$items.set(Z,L),v.$changes.allChanges.add(V);else if(v instanceof b)v.setAt(V,L);else if(v instanceof XN){var M=v.add(L);v.setIndex(V,M)}else v instanceof QN&&!1!==(M=v.add(L))&&v.setIndex(V,M);X!==L&&S.push({refId:E,op:f,field:H,dynamicIndex:Q,value:L,previousValue:X})}else{console.warn("@colyseus/schema: definition mismatch");for(var m={offset:z.offset};z.offset<y&&(!TN(R,z)||(m.offset=z.offset+1,!A.refs.has(VN(R,m))));)z.offset++}}else v.clear(S)}else{E=VN(R,z);var g=A.refs.get(E);if(!g)throw new Error('"refId" not found: '.concat(E));v=g}}return this._triggerChanges(S),A.garbageCollectDeletedRefs(),S},q.prototype.encode=function(R,z,v){void 0===R&&(R=!1),void 0===z&&(z=[]),void 0===v&&(v=!1);for(var B=this.$changes,S=new WeakSet,A=[B],y=1,E=0;E<y;E++){var t=A[E],x=t.ref,e=x instanceof q;t.ensureRefId(),S.add(t),t!==B&&(t.changed||R)&&(J(z,F),a(z,t.refId));for(var b=R?Array.from(t.allChanges):Array.from(t.changes.values()),f=0,V=b.length;f<V;f++){var H=R?{op:N.OPERATION.ADD,index:b[f]}:b[f],T=H.index,L=e?x._definition.fieldsByIndex&&x._definition.fieldsByIndex[T]:T,X=z.length;if(H.op!==N.OPERATION.TOUCH)if(e)J(z,T|H.op);else{if(J(z,H.op),H.op===N.OPERATION.CLEAR)continue;a(z,T)}if(e||(H.op&N.OPERATION.ADD)!=N.OPERATION.ADD||x instanceof D&&r(z,t.ref.$indexes.get(T)),H.op!==N.OPERATION.DELETE){var Q=t.getType(T),h=t.getValue(T);if(h&&h.$changes&&!S.has(h.$changes)&&(A.push(h.$changes),h.$changes.ensureRefId(),y++),H.op!==N.OPERATION.TOUCH){if(q.is(Q))nN(h,Q,x,L),a(z,h.$changes.refId),(H.op&N.OPERATION.ADD)===N.OPERATION.ADD&&this.tryEncodeTypeId(z,Q,h.constructor);else if("string"===typeof Q)GN(Q,z,h,x,L);else{var u=Y(Object.keys(Q)[0]);nN(x["_".concat(L)],u.constructor,x,L),a(z,h.$changes.refId)}v&&t.cache(T,z.slice(X))}}}R||v||t.discard()}return z},q.prototype.encodeAll=function(N){return this.encode(!0,[],N)},q.prototype.applyFilters=function(R,z){var v,B;void 0===z&&(z=!1);for(var S=this,A=new Set,y=hN.get(R),E=[this.$changes],t=1,x=[],e=function(e){var b=E[e];if(A.has(b.refId))return"continue";var f=b.ref,V=f instanceof q;J(x,F),a(x,b.refId);var H=y.refIds.has(b),Y=z||!H;y.addRefId(b);var T=y.containerIndexes.get(b),L=Y?Array.from(b.allChanges):Array.from(b.changes.values());!z&&V&&f._definition.indexesWithFilters&&f._definition.indexesWithFilters.forEach((function(q){!T.has(q)&&b.allChanges.has(q)&&(Y?L.push(q):L.push({op:N.OPERATION.ADD,index:q}))}));for(var X=0,Q=L.length;X<Q;X++){var h=Y?{op:N.OPERATION.ADD,index:L[X]}:L[X];if(h.op!==N.OPERATION.CLEAR){var u=h.index;if(h.op!==N.OPERATION.DELETE){var w=b.getValue(u),c=b.getType(u);if(V){if((n=f._definition.filters&&f._definition.filters[u])&&!n.call(f,R,w,S)){w&&w.$changes&&A.add(w.$changes.refId);continue}}else{var n,G=b.parent;if((n=b.getChildrenFilter())&&!n.call(G,R,f.$indexes.get(u),w,S)){w&&w.$changes&&A.add(w.$changes.refId);continue}}if(w.$changes&&(E.push(w.$changes),t++),h.op!==N.OPERATION.TOUCH)if(h.op===N.OPERATION.ADD||V)x.push.apply(x,null!==(v=b.caches[u])&&void 0!==v?v:[]),T.add(u);else if(T.has(u))x.push.apply(x,null!==(B=b.caches[u])&&void 0!==B?B:[]);else{if(T.add(u),J(x,N.OPERATION.ADD),a(x,u),f instanceof D){var s=b.ref.$indexes.get(u);r(x,s)}w.$changes?a(x,w.$changes.refId):d[c](x,w)}else w.$changes&&!V&&(J(x,N.OPERATION.ADD),a(x,u),f instanceof D&&(s=b.ref.$indexes.get(u),r(x,s)),a(x,w.$changes.refId))}else V?J(x,h.op|u):(J(x,h.op),a(x,u))}else J(x,h.op)}},b=0;b<t;b++)e(b);return x},q.prototype.clone=function(){var N,q=new this.constructor,R=this._definition.schema;for(var z in R)"object"===typeof this[z]&&"function"===typeof(null===(N=this[z])||void 0===N?void 0:N.clone)?q[z]=this[z].clone():q[z]=this[z];return q},q.prototype.toJSON=function(){var N=this._definition.schema,q=this._definition.deprecated,R={};for(var z in N)q[z]||null===this[z]||"undefined"===typeof this[z]||(R[z]="function"===typeof this[z].toJSON?this[z].toJSON():this["_".concat(z)]);return R},q.prototype.discardAllChanges=function(){this.$changes.discardAll()},q.prototype.getByIndex=function(N){return this[this._definition.fieldsByIndex[N]]},q.prototype.deleteByIndex=function(N){this[this._definition.fieldsByIndex[N]]=void 0},q.prototype.tryEncodeTypeId=function(N,q,R){q._typeid!==R._typeid&&(J(N,S),a(N,R._typeid))},q.prototype.getSchemaType=function(N,q,R){var z;return N[q.offset]===S&&(q.offset++,z=this.constructor._context.get(VN(N,q))),z||R},q.prototype.createTypeInstance=function(N){var q=new N;return q.$changes.root=this.$changes.root,q},q.prototype._triggerChanges=function(R){for(var z,v,B,F,S,A,y,E,t,x=new Set,e=this.$changes.root.refs,b=function(b){var f=R[b],D=f.refId,V=e.get(D),H=V.$callbacks;if((f.op&N.OPERATION.DELETE)===N.OPERATION.DELETE&&f.previousValue instanceof q&&(null===(v=null===(z=f.previousValue.$callbacks)||void 0===z?void 0:z[N.OPERATION.DELETE])||void 0===v||v.forEach((function(N){return N()}))),!H)return"continue";if(V instanceof q){if(!x.has(D))try{null===(B=null===H||void 0===H?void 0:H[N.OPERATION.REPLACE])||void 0===B||B.forEach((function(N){return N()}))}catch(Y){q.onError(Y)}try{H.hasOwnProperty(f.field)&&(null===(F=H[f.field])||void 0===F||F.forEach((function(N){return N(f.value,f.previousValue)})))}catch(Y){q.onError(Y)}}else f.op===N.OPERATION.ADD&&void 0===f.previousValue?null===(S=H[N.OPERATION.ADD])||void 0===S||S.forEach((function(N){var q;return N(f.value,null!==(q=f.dynamicIndex)&&void 0!==q?q:f.field)})):f.op===N.OPERATION.DELETE?void 0!==f.previousValue&&(null===(A=H[N.OPERATION.DELETE])||void 0===A||A.forEach((function(N){var q;return N(f.previousValue,null!==(q=f.dynamicIndex)&&void 0!==q?q:f.field)}))):f.op===N.OPERATION.DELETE_AND_ADD&&(void 0!==f.previousValue&&(null===(y=H[N.OPERATION.DELETE])||void 0===y||y.forEach((function(N){var q;return N(f.previousValue,null!==(q=f.dynamicIndex)&&void 0!==q?q:f.field)}))),null===(E=H[N.OPERATION.ADD])||void 0===E||E.forEach((function(N){var q;return N(f.value,null!==(q=f.dynamicIndex)&&void 0!==q?q:f.field)}))),f.value!==f.previousValue&&(null===(t=H[N.OPERATION.REPLACE])||void 0===t||t.forEach((function(N){var q;return N(f.value,null!==(q=f.dynamicIndex)&&void 0!==q?q:f.field)})));x.add(D)},f=0;f<R.length;f++)b(f)},q._definition=T.create(),q}();function JN(N){for(var q=[N.$changes],R=1,z={},v=z,B=function(N){var R=q[N];R.changes.forEach((function(N){var q=R.ref,z=N.index,B=q._definition?q._definition.fieldsByIndex[z]:q.$indexes.get(z);v[B]=R.getValue(z)}))},F=0;F<R;F++)B(F);return z}var MN={context:new X},mN=function(N){function q(){return null!==N&&N.apply(this,arguments)||this}return R(q,N),z([h("string",MN)],q.prototype,"name",void 0),z([h("string",MN)],q.prototype,"type",void 0),z([h("number",MN)],q.prototype,"referencedType",void 0),q}(ZN),gN=function(N){function q(){var q=null!==N&&N.apply(this,arguments)||this;return q.fields=new b,q}return R(q,N),z([h("number",MN)],q.prototype,"id",void 0),z([h([mN],MN)],q.prototype,"fields",void 0),q}(ZN),jN=function(N){function q(){var q=null!==N&&N.apply(this,arguments)||this;return q.types=new b,q}return R(q,N),q.encode=function(N){var R=N.constructor,z=new q;z.rootType=R._typeid;var v=function(N,q){for(var R in q){var v=new mN;v.name=R;var B=void 0;if("string"===typeof q[R])B=q[R];else{var F=q[R],S=void 0;ZN.is(F)?(B="ref",S=q[R]):"string"===typeof F[B=Object.keys(F)[0]]?B+=":"+F[B]:S=F[B],v.referencedType=S?S._typeid:-1}v.type=B,N.fields.push(v)}z.types.push(N)},B=R._context.types;for(var F in B){var S=new gN;S.id=Number(F),v(S,B[F]._definition.schema)}return z.encodeAll()},q.decode=function(N,z){var v=new X,B=new q;B.decode(N,z);var F=B.types.reduce((function(N,q){var z=function(N){function q(){return null!==N&&N.apply(this,arguments)||this}return R(q,N),q}(ZN),B=q.id;return N[B]=z,v.add(z,B),N}),{});B.types.forEach((function(N){var q=F[N.id];N.fields.forEach((function(N){var R;if(void 0!==N.referencedType){var z=N.type,B=F[N.referencedType];if(!B){var S=N.type.split(":");z=S[0],B=S[1]}"ref"===z?h(B,{context:v})(q.prototype,N.name):h(((R={})[z]=B,R),{context:v})(q.prototype,N.name)}else h(N.type,{context:v})(q.prototype,N.name)}))}));var S=F[B.rootType],A=new S;for(var y in S._definition.schema){var E=S._definition.schema[y];"string"!==typeof E&&(A[y]="function"===typeof E?new E:new(Y(Object.keys(E)[0]).constructor))}return A},z([h([gN],MN)],q.prototype,"types",void 0),z([h("number",MN)],q.prototype,"rootType",void 0),q}(ZN);H("map",{constructor:D}),H("array",{constructor:b}),H("set",{constructor:QN}),H("collection",{constructor:XN}),N.ArraySchema=b,N.CollectionSchema=XN,N.Context=X,N.MapSchema=D,N.Reflection=jN,N.ReflectionField=mN,N.ReflectionType=gN,N.Schema=ZN,N.SchemaDefinition=T,N.SetSchema=QN,N.decode=LN,N.defineTypes=n,N.deprecated=c,N.dumpChanges=JN,N.encode=d,N.filter=u,N.filterChildren=w,N.hasFilter=L,N.registerType=H,N.type=h,Object.defineProperty(N,"__esModule",{value:!0})}(q)},12351:N=>{N.exports=function(N){return null!=N&&null!=N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}},12334:(N,q,R)=>{"use strict";var z=R(12342),v=R(12348),B=R(12351);R.g.__TYPEDARRAY_POOL||(R.g.__TYPEDARRAY_POOL={UINT8:v([32,0]),UINT16:v([32,0]),UINT32:v([32,0]),INT8:v([32,0]),INT16:v([32,0]),INT32:v([32,0]),FLOAT:v([32,0]),DOUBLE:v([32,0]),DATA:v([32,0]),UINT8C:v([32,0]),BUFFER:v([32,0])});var F="undefined"!==typeof Uint8ClampedArray,S=R.g.__TYPEDARRAY_POOL;S.UINT8C||(S.UINT8C=v([32,0])),S.BUFFER||(S.BUFFER=v([32,0]));var A=S.DATA,y=S.BUFFER;function E(N){if(N){var q=N.length||N.byteLength,R=z.log2(q);A[R].push(N)}}function t(N){N=z.nextPow2(N);var q=z.log2(N),R=A[q];return R.length>0?R.pop():new ArrayBuffer(N)}function x(N){return new Uint8Array(t(N),0,N)}function e(N){return new Uint16Array(t(2*N),0,N)}function b(N){return new Uint32Array(t(4*N),0,N)}function f(N){return new Int8Array(t(N),0,N)}function D(N){return new Int16Array(t(2*N),0,N)}function V(N){return new Int32Array(t(4*N),0,N)}function H(N){return new Float32Array(t(4*N),0,N)}function Y(N){return new Float64Array(t(8*N),0,N)}function T(N){return F?new Uint8ClampedArray(t(N),0,N):x(N)}function L(N){return new DataView(t(N),0,N)}q.free=function(N){if(B(N))y[z.log2(N.length)].push(N);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(N)&&(N=N.buffer),!N)return;var q=N.length||N.byteLength,R=0|z.log2(q);A[R].push(N)}},q.freeUint8=q.freeUint16=q.freeUint32=q.freeInt8=q.freeInt16=q.freeInt32=q.freeFloat32=q.freeFloat=q.freeFloat64=q.freeDouble=q.freeUint8Clamped=q.freeDataView=function(N){E(N.buffer)},q.freeArrayBuffer=E,q.freeBuffer=function(N){y[z.log2(N.length)].push(N)},q.malloc=function(N,q){if(void 0===q||"arraybuffer"===q)return t(N);switch(q){case"uint8":return x(N);case"uint16":return e(N);case"uint32":return b(N);case"int8":return f(N);case"int16":return D(N);case"int32":return V(N);case"float":case"float32":return H(N);case"double":case"float64":return Y(N);case"uint8_clamped":return T(N);case"buffer":throw"Buffer not supported";case"data":case"dataview":return L(N);default:return null}return null},q.mallocArrayBuffer=t,q.mallocUint8=x,q.mallocUint16=e,q.mallocUint32=b,q.mallocInt8=f,q.mallocInt16=D,q.mallocInt32=V,q.mallocFloat32=q.mallocFloat=H,q.mallocFloat64=q.mallocDouble=Y,q.mallocUint8Clamped=T,q.mallocDataView=L,q.clearCache=function(){for(var N=0;N<32;++N)S.UINT8[N].length=0,S.UINT16[N].length=0,S.UINT32[N].length=0,S.INT8[N].length=0,S.INT16[N].length=0,S.INT32[N].length=0,S.FLOAT[N].length=0,S.DOUBLE[N].length=0,S.UINT8C[N].length=0,A[N].length=0,y[N].length=0}},12429:(N,q,R)=>{N.exports=v;var z=R(161);function v(N,q){if(!(this instanceof v))return new v(N,q);var R=z.create();z.add(R,N,q),this.base=z.min(z.create(),N,R),this.ah=z.clone(q),this.max=z.max(z.create(),N,R),this.mag=z.length(this.ah)}var B=v.prototype;B.width=function(){return this.ah[0]},B.height=function(){return this.ah[1]},B.depth=function(){return this.ah[2]},B.x0=function(){return this.base[0]},B.y0=function(){return this.base[1]},B.z0=function(){return this.base[2]},B.x1=function(){return this.max[0]},B.y1=function(){return this.max[1]},B.z1=function(){return this.max[2]},B.translate=function(N){return z.add(this.max,this.max,N),z.add(this.base,this.base,N),this},B.setPosition=function(N){return z.add(this.max,N,this.ah),z.i(this.base,N),this},B.expand=function(N){var q=z.create(),R=z.create();return z.max(q,N.max,this.max),z.min(R,N.base,this.base),z.gd(q,q,R),new v(R,q)},B.intersects=function(N){return!(N.base[0]>this.max[0])&&(!(N.base[1]>this.max[1])&&(!(N.base[2]>this.max[2])&&(!(N.max[0]<this.base[0])&&(!(N.max[1]<this.base[1])&&!(N.max[2]<this.base[2])))))},B.touches=function(N){var q=this.union(N);return null!==q&&(0==q.width()||0==q.height()||0==q.depth())},B.union=function(N){if(!this.intersects(N))return null;var q=Math.max(N.base[0],this.base[0]),R=Math.max(N.base[1],this.base[1]),z=Math.max(N.base[2],this.base[2]);return new v([q,R,z],[Math.min(N.max[0],this.max[0])-q,Math.min(N.max[1],this.max[1])-R,Math.min(N.max[2],this.max[2])-z])}},12342:(N,q)=>{"use strict";function R(N){var q=32;return(N&=-N)&&q--,65535&N&&(q-=16),16711935&N&&(q-=8),252645135&N&&(q-=4),858993459&N&&(q-=2),1431655765&N&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(N){return(N>0)-(N<0)},q.abs=function(N){var q=N>>31;return(N^q)-q},q.min=function(N,q){return q^(N^q)&-(N<q)},q.max=function(N,q){return N^(N^q)&-(N<q)},q.isPow2=function(N){return!(N&N-1)&&!!N},q.log2=function(N){var q,R;return q=(N>65535)<<4,q|=R=((N>>>=q)>255)<<3,q|=R=((N>>>=R)>15)<<2,(q|=R=((N>>>=R)>3)<<1)|(N>>>=R)>>1},q.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},q.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},q.countTrailingZeros=R,q.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},q.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},q.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var z=new Array(256);!function(N){for(var q=0;q<256;++q){var R=q,z=q,v=7;for(R>>>=1;R;R>>>=1)z<<=1,z|=1&R,--v;N[q]=z<<v&255}}(z),q.reverse=function(N){return z[255&N]<<24|z[N>>>8&255]<<16|z[N>>>16&255]<<8|z[N>>>24&255]},q.interleave2=function(N,q){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(N,q){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>q&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},q.interleave3=function(N,q,R){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<2},q.deinterleave3=function(N,q){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>q&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},q.nextCombination=function(N){var q=N|N-1;return q+1|(~q&-~q)-1>>>R(N)+1}},12329:(N,q,R)=>{"use strict";N.exports=function(N,q,R){switch(arguments.length){case 1:return z=[],y(v=N,v,E,!0),z;case 2:return"function"===typeof q?y(N,N,q,!0):function(N,q){return z=[],y(N,q,E,!1),z}(N,q);case 3:return y(N,q,R,!1);default:throw new Error("box-intersect: Invalid arguments")}var v};var z,v=R(12334),B=R(12358),F=R(12365);function S(N,q){for(var R=0;R<N;++R)if(!(q[R]<=q[R+N]))return!0;return!1}function A(N,q,R,z){for(var v=0,B=0,F=0,A=N.length;F<A;++F){var y=N[F];if(!S(q,y)){for(var E=0;E<2*q;++E)R[v++]=y[E];z[B++]=F}}return B}function y(N,q,R,z){var S=N.length,y=q.length;if(!(S<=0||y<=0)){var E=N[0].length>>>1;if(!(E<=0)){var t,x=v.mallocDouble(2*E*S),e=v.mallocInt32(S);if((S=A(N,E,x,e))>0){if(1===E&&z)B.init(S),t=B.sweepComplete(E,R,0,S,x,e,0,S,x,e);else{var b=v.mallocDouble(2*E*y),f=v.mallocInt32(y);(y=A(q,E,b,f))>0&&(B.init(S+y),t=1===E?B.sweepBipartite(E,R,0,S,x,e,0,y,b,f):F(E,R,z,S,x,e,y,b,f),v.free(b),v.free(f))}v.free(x),v.free(e)}return t}}}function E(N,q){z.push([N,q])}},12367:(N,q)=>{"use strict";var R="d",z="ax",v="fp",B="es",F="rs",S="re",A="rb",y="bs",E="be",t="bb",x=[R,z,"vv",F,S,A,"ri",y,E,t,"bi"];function e(N){var q="bruteForce"+(N?"Full":"Partial"),z=[],F=x.slice();N||F.splice(3,0,v);var S=["function "+q+"("+F.join()+"){"];function A(q,v){var F=function(N,q,z){var v="bruteForce"+(N?"Red":"Blue")+(q?"Flip":"")+(z?"Full":""),F=["function ",v,"(",x.join(),"){","var ",B,"=2*",R,";"],S="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",A="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return N?F.push(S,"Q",":",A):F.push(A,"Q",":",S),z?F.push("if(y1<x0||x1<y0)continue;"):q?F.push("if(y0<=x0||x1<y0)continue;"):F.push("if(y0<x0||x1<y0)continue;"),F.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),q?F.push("yi,xi"):F.push("xi,yi"),F.push(");if(rv!==void 0)return rv;}}}"),{name:v,code:F.join("")}}(q,v,N);z.push(F.code),S.push("return "+F.name+"("+x.join()+");")}S.push("if(re-rs>be-bs){"),N?(A(!0,!1),S.push("}else{"),A(!1,!1)):(S.push("if(fp){"),A(!0,!0),S.push("}else{"),A(!0,!1),S.push("}}else{if(fp){"),A(!1,!0),S.push("}else{"),A(!1,!1),S.push("}")),S.push("}}return "+q);var y=z.join("")+S.join("");return new Function(y)()}q.partial=e(!1),q.full=e(!0)},12365:(N,q,R)=>{"use strict";N.exports=function(N,q,R,B,E,c,n,G,s){!function(N,q){var R=8*v.log2(q+1)*(N+1)|0,B=v.nextPow2(T*R);X.length<B&&(z.free(X),X=z.mallocInt32(B));var F=v.nextPow2(L*R);Q.length<F&&(z.free(Q),Q=z.mallocDouble(F))}(N,B+n);var Z,J=0,M=2*N;h(J++,0,0,B,0,n,R?16:0,-1/0,1/0),R||h(J++,0,0,n,0,B,1,-1/0,1/0);for(;J>0;){var m=(J-=1)*T,g=X[m],j=X[m+1],l=X[m+2],I=X[m+3],U=X[m+4],O=X[m+5],i=J*L,P=Q[i],k=Q[i+1],o=1&O,C=!!(16&O),K=E,r=c,a=G,d=s;if(o&&(K=G,r=s,a=E,d=c),!(2&O&&j>=(l=D(N,g,j,l,K,r,k)))&&!(4&O&&(j=V(N,g,j,l,K,r,P))>=l)){var p=l-j,W=U-I;if(C){if(N*p*(p+W)<e){if(void 0!==(Z=A.scanComplete(N,g,q,j,l,K,r,I,U,a,d)))return Z;continue}}else{if(N*Math.min(p,W)<t){if(void 0!==(Z=F(N,g,q,o,j,l,K,r,I,U,a,d)))return Z;continue}if(N*p*W<x){if(void 0!==(Z=A.scanBipartite(N,g,q,o,j,l,K,r,I,U,a,d)))return Z;continue}}var NN=b(N,g,j,l,K,r,P,k);if(j<NN)if(N*(NN-j)<t){if(void 0!==(Z=S(N,g+1,q,j,NN,K,r,I,U,a,d)))return Z}else if(g===N-2){if(void 0!==(Z=o?A.sweepBipartite(N,q,I,U,a,d,j,NN,K,r):A.sweepBipartite(N,q,j,NN,K,r,I,U,a,d)))return Z}else h(J++,g+1,j,NN,I,U,o,-1/0,1/0),h(J++,g+1,I,U,j,NN,1^o,-1/0,1/0);if(NN<l){var qN=y(N,g,I,U,a,d),RN=a[M*qN+g],zN=f(N,g,qN,U,a,d,RN);if(zN<U&&h(J++,g,NN,l,zN,U,(4|o)+(C?16:0),RN,k),I<qN&&h(J++,g,NN,l,I,qN,(2|o)+(C?16:0),P,RN),qN+1===zN){if(void 0!==(Z=C?w(N,g,q,NN,l,K,r,qN,a,d[qN]):u(N,g,q,o,NN,l,K,r,qN,a,d[qN])))return Z}else if(qN<zN){var vN;if(C){if(NN<(vN=H(N,g,NN,l,K,r,RN))){var BN=f(N,g,NN,vN,K,r,RN);if(g===N-2){if(NN<BN&&void 0!==(Z=A.sweepComplete(N,q,NN,BN,K,r,qN,zN,a,d)))return Z;if(BN<vN&&void 0!==(Z=A.sweepBipartite(N,q,BN,vN,K,r,qN,zN,a,d)))return Z}else NN<BN&&h(J++,g+1,NN,BN,qN,zN,16,-1/0,1/0),BN<vN&&(h(J++,g+1,BN,vN,qN,zN,0,-1/0,1/0),h(J++,g+1,qN,zN,BN,vN,1,-1/0,1/0))}}else NN<(vN=o?Y(N,g,NN,l,K,r,RN):H(N,g,NN,l,K,r,RN))&&(g===N-2?Z=o?A.sweepBipartite(N,q,qN,zN,a,d,NN,vN,K,r):A.sweepBipartite(N,q,NN,vN,K,r,qN,zN,a,d):(h(J++,g+1,NN,vN,qN,zN,o,-1/0,1/0),h(J++,g+1,qN,zN,NN,vN,1^o,-1/0,1/0)))}}}}};var z=R(12334),v=R(12342),B=R(12367),F=B.partial,S=B.full,A=R(12358),y=R(12373),E=R(12379),t=128,x=1<<22,e=1<<22,b=E("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),f=E("lo===p0",["p0"]),D=E("lo<p0",["p0"]),V=E("hi<=p0",["p0"]),H=E("lo<=p0&&p0<=hi",["p0"]),Y=E("lo<p0&&p0<=hi",["p0"]),T=6,L=2,X=z.mallocInt32(1024),Q=z.mallocDouble(1024);function h(N,q,R,z,v,B,F,S,A){var y=T*N;X[y]=q,X[y+1]=R,X[y+2]=z,X[y+3]=v,X[y+4]=B,X[y+5]=F;var E=L*N;Q[E]=S,Q[E+1]=A}function u(N,q,R,z,v,B,F,S,A,y,E){var t=2*N,x=A*t,e=y[x+q];N:for(var b=v,f=v*t;b<B;++b,f+=t){var D=F[f+q],V=F[f+q+N];if(!(e<D||V<e)&&(!z||e!==D)){for(var H,Y=S[b],T=q+1;T<N;++T){D=F[f+T],V=F[f+T+N];var L=y[x+T],X=y[x+T+N];if(V<L||X<D)continue N}if(void 0!==(H=z?R(E,Y):R(Y,E)))return H}}}function w(N,q,R,z,v,B,F,S,A,y){var E=2*N,t=S*E,x=A[t+q];N:for(var e=z,b=z*E;e<v;++e,b+=E){var f=F[e];if(f!==y){var D=B[b+q],V=B[b+q+N];if(!(x<D||V<x)){for(var H=q+1;H<N;++H){D=B[b+H],V=B[b+H+N];var Y=A[t+H],T=A[t+H+N];if(V<Y||T<D)continue N}var L=R(f,y);if(void 0!==L)return L}}}}},12373:(N,q,R)=>{"use strict";N.exports=function(N,q,R,F,S,A){if(F<=R+1)return R;var y=R,E=F,t=F+R>>>1,x=2*N,e=t,b=S[x*t+q];for(;y<E;){if(E-y<v){B(N,q,y,E,S,A),b=S[x*t+q];break}var f=E-y,D=Math.random()*f+y|0,V=S[x*D+q],H=Math.random()*f+y|0,Y=S[x*H+q],T=Math.random()*f+y|0,L=S[x*T+q];V<=Y?L>=Y?(e=H,b=Y):V>=L?(e=D,b=V):(e=T,b=L):Y>=L?(e=H,b=Y):L>=V?(e=D,b=V):(e=T,b=L);for(var X=x*(E-1),Q=x*e,h=0;h<x;++h,++X,++Q){var u=S[X];S[X]=S[Q],S[Q]=u}var w=A[E-1];A[E-1]=A[e],A[e]=w;for(X=x*(E-1),Q=x*(e=z(N,q,y,E-1,S,A,b)),h=0;h<x;++h,++X,++Q){u=S[X];S[X]=S[Q],S[Q]=u}w=A[E-1];if(A[E-1]=A[e],A[e]=w,t<e){for(E=e-1;y<E&&S[x*(E-1)+q]===b;)E-=1;E+=1}else{if(!(e<t))break;for(y=e+1;y<E&&S[x*y+q]===b;)y+=1}}return z(N,q,R,t,S,A,S[x*t+q])};var z=R(12379)("lo<p0",["p0"]),v=8;function B(N,q,R,z,v,B){for(var F=2*N,S=F*(R+1)+q,A=R+1;A<z;++A,S+=F)for(var y=v[S],E=A,t=F*(A-1);E>R&&v[t+q]>y;--E,t-=F){for(var x=t,e=t+F,b=0;b<F;++b,++x,++e){var f=v[x];v[x]=v[e],v[e]=f}var D=B[E];B[E]=B[E-1],B[E-1]=D}}},12379:N=>{"use strict";N.exports=function(N,R){var z="abcdef".split("").concat(R),v=[];N.indexOf("lo")>=0&&v.push("lo=e[k+n]");N.indexOf("hi")>=0&&v.push("hi=e[k+o]");return z.push(q.replace("_",v.join()).replace("$",N)),Function.apply(void 0,z)};var q="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12363:N=>{"use strict";N.exports=function(N,z){z<=4*q?R(0,z-1,N):y(0,z-1,N)};var q=32;function R(N,q,R){for(var z=2*(N+1),v=N+1;v<=q;++v){for(var B=R[z++],F=R[z++],S=v,A=z-2;S-- >N;){var y=R[A-2],E=R[A-1];if(y<B)break;if(y===B&&E<F)break;R[A]=y,R[A+1]=E,A-=2}R[A]=B,R[A+1]=F}}function z(N,q,R){q*=2;var z=R[N*=2],v=R[N+1];R[N]=R[q],R[N+1]=R[q+1],R[q]=z,R[q+1]=v}function v(N,q,R){q*=2,R[N*=2]=R[q],R[N+1]=R[q+1]}function B(N,q,R,z){q*=2,R*=2;var v=z[N*=2],B=z[N+1];z[N]=z[q],z[N+1]=z[q+1],z[q]=z[R],z[q+1]=z[R+1],z[R]=v,z[R+1]=B}function F(N,q,R,z,v){q*=2,v[N*=2]=v[q],v[q]=R,v[N+1]=v[q+1],v[q+1]=z}function S(N,q,R){q*=2;var z=R[N*=2],v=R[q];return!(z<v)&&(z!==v||R[N+1]>R[q+1])}function A(N,q,R,z){var v=z[N*=2];return v<q||v===q&&z[N+1]<R}function y(N,E,t){var x=(E-N+1)/6|0,e=N+x,b=E-x,f=N+E>>1,D=f-x,V=f+x,H=e,Y=D,T=f,L=V,X=b,Q=N+1,h=E-1,u=0;S(H,Y,t)&&(u=H,H=Y,Y=u),S(L,X,t)&&(u=L,L=X,X=u),S(H,T,t)&&(u=H,H=T,T=u),S(Y,T,t)&&(u=Y,Y=T,T=u),S(H,L,t)&&(u=H,H=L,L=u),S(T,L,t)&&(u=T,T=L,L=u),S(Y,X,t)&&(u=Y,Y=X,X=u),S(Y,T,t)&&(u=Y,Y=T,T=u),S(L,X,t)&&(u=L,L=X,X=u);for(var w=t[2*Y],c=t[2*Y+1],n=t[2*L],G=t[2*L+1],s=2*H,Z=2*T,J=2*X,M=2*e,m=2*f,g=2*b,j=0;j<2;++j){var l=t[s+j],I=t[Z+j],U=t[J+j];t[M+j]=l,t[m+j]=I,t[g+j]=U}v(D,N,t),v(V,E,t);for(var O=Q;O<=h;++O)if(A(O,w,c,t))O!==Q&&z(O,Q,t),++Q;else if(!A(O,n,G,t))for(;;){if(A(h,n,G,t)){A(h,w,c,t)?(B(O,Q,h,t),++Q,--h):(z(O,h,t),--h);break}if(--h<O)break}F(N,Q-1,w,c,t),F(E,h+1,n,G,t),Q-2-N<=q?R(N,Q-2,t):y(N,Q-2,t),E-(h+2)<=q?R(h+2,E,t):y(h+2,E,t),h-Q<=q?R(Q,h,t):y(Q,h,t)}},12358:(N,q,R)=>{"use strict";N.exports={init:function(N){var q=v.nextPow2(N);A.length<q&&(z.free(A),A=z.mallocInt32(q));y.length<q&&(z.free(y),y=z.mallocInt32(q));E.length<q&&(z.free(E),E=z.mallocInt32(q));t.length<q&&(z.free(t),t=z.mallocInt32(q));x.length<q&&(z.free(x),x=z.mallocInt32(q));e.length<q&&(z.free(e),e=z.mallocInt32(q));var R=8*q;b.length<R&&(z.free(b),b=z.mallocDouble(R))},sweepBipartite:function(N,q,R,z,v,S,x,e,V,H){for(var Y=0,T=2*N,L=N-1,X=T-1,Q=R;Q<z;++Q){var h=S[Q],u=T*Q;b[Y++]=v[u+L],b[Y++]=-(h+1),b[Y++]=v[u+X],b[Y++]=h}for(Q=x;Q<e;++Q){h=H[Q]+F;var w=T*Q;b[Y++]=V[w+L],b[Y++]=-h,b[Y++]=V[w+X],b[Y++]=h}var c=Y>>>1;B(b,c);var n=0,G=0;for(Q=0;Q<c;++Q){var s=0|b[2*Q+1];if(s>=F)f(E,t,G--,s=s-F|0);else if(s>=0)f(A,y,n--,s);else if(s<=-F){s=-s-F|0;for(var Z=0;Z<n;++Z){if(void 0!==(J=q(A[Z],s)))return J}D(E,t,G++,s)}else{s=-s-1|0;for(Z=0;Z<G;++Z){var J;if(void 0!==(J=q(s,E[Z])))return J}D(A,y,n++,s)}}},sweepComplete:function(N,q,R,z,v,F,S,V,H,Y){for(var T=0,L=2*N,X=N-1,Q=L-1,h=R;h<z;++h){var u=F[h]+1<<1,w=L*h;b[T++]=v[w+X],b[T++]=-u,b[T++]=v[w+Q],b[T++]=u}for(h=S;h<V;++h){u=Y[h]+1<<1;var c=L*h;b[T++]=H[c+X],b[T++]=1|-u,b[T++]=H[c+Q],b[T++]=1|u}var n=T>>>1;B(b,n);var G=0,s=0,Z=0;for(h=0;h<n;++h){var J=0|b[2*h+1],M=1&J;if(h<n-1&&J>>1===b[2*h+3]>>1&&(M=2,h+=1),J<0){for(var m=-(J>>1)-1,g=0;g<Z;++g){if(void 0!==(j=q(x[g],m)))return j}if(0!==M)for(g=0;g<G;++g){if(void 0!==(j=q(A[g],m)))return j}if(1!==M)for(g=0;g<s;++g){var j;if(void 0!==(j=q(E[g],m)))return j}0===M?D(A,y,G++,m):1===M?D(E,t,s++,m):2===M&&D(x,e,Z++,m)}else{m=(J>>1)-1;0===M?f(A,y,G--,m):1===M?f(E,t,s--,m):2===M&&f(x,e,Z--,m)}}},scanBipartite:function(N,q,R,z,v,S,E,t,x,e,V,H){var Y=0,T=2*N,L=q,X=q+N,Q=1,h=1;z?h=F:Q=F;for(var u=v;u<S;++u){var w=u+Q,c=T*u;b[Y++]=E[c+L],b[Y++]=-w,b[Y++]=E[c+X],b[Y++]=w}for(u=x;u<e;++u){w=u+h;var n=T*u;b[Y++]=V[n+L],b[Y++]=-w}var G=Y>>>1;B(b,G);var s=0;for(u=0;u<G;++u){var Z=0|b[2*u+1];if(Z<0){var J=!1;if((w=-Z)>=F?(J=!z,w-=F):(J=!!z,w-=1),J)D(A,y,s++,w);else{var M=H[w],m=T*w,g=V[m+q+1],j=V[m+q+1+N];N:for(var l=0;l<s;++l){var I=A[l],U=T*I;if(!(j<E[U+q+1]||E[U+q+1+N]<g)){for(var O=q+2;O<N;++O)if(V[m+O+N]<E[U+O]||E[U+O+N]<V[m+O])continue N;var i,P=t[I];if(void 0!==(i=z?R(M,P):R(P,M)))return i}}}}else f(A,y,s--,Z-Q)}},scanComplete:function(N,q,R,z,v,S,y,E,t,x,e){for(var f=0,D=2*N,V=q,H=q+N,Y=z;Y<v;++Y){var T=Y+F,L=D*Y;b[f++]=S[L+V],b[f++]=-T,b[f++]=S[L+H],b[f++]=T}for(Y=E;Y<t;++Y){T=Y+1;var X=D*Y;b[f++]=x[X+V],b[f++]=-T}var Q=f>>>1;B(b,Q);var h=0;for(Y=0;Y<Q;++Y){var u=0|b[2*Y+1];if(u<0){if((T=-u)>=F)A[h++]=T-F;else{var w=e[T-=1],c=D*T,n=x[c+q+1],G=x[c+q+1+N];N:for(var s=0;s<h;++s){var Z=A[s],J=y[Z];if(J===w)break;var M=D*Z;if(!(G<S[M+q+1]||S[M+q+1+N]<n)){for(var m=q+2;m<N;++m)if(x[c+m+N]<S[M+m]||S[M+m+N]<x[c+m])continue N;var g=R(J,w);if(void 0!==g)return g}}}}else{for(T=u-F,s=h-1;s>=0;--s)if(A[s]===T){for(m=s+1;m<h;++m)A[m-1]=A[m];break}--h}}}};var z=R(12334),v=R(12342),B=R(12363),F=1<<28,S=1024,A=z.mallocInt32(S),y=z.mallocInt32(S),E=z.mallocInt32(S),t=z.mallocInt32(S),x=z.mallocInt32(S),e=z.mallocInt32(S),b=z.mallocDouble(8192);function f(N,q,R,z){var v=q[z],B=N[R-1];N[v]=B,q[B]=v}function D(N,q,R,z){N[R]=z,q[z]=R}},12491:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12483:(N,q,R)=>{var z=R(12491),v=R(12500),B=Object.hasOwnProperty,F=Object.create(null);for(var S in z)B.call(z,S)&&(F[z[S]]=S);var A=N.exports={to:{},get:{}};function y(N,q,R){return Math.min(Math.max(q,N),R)}function E(N){var q=Math.round(N).toString(16).toUpperCase();return q.length<2?"0"+q:q}A.get=function(N){var q,R;switch(N.substring(0,3).toLowerCase()){case"hsl":q=A.get.hsl(N),R="hsl";break;case"hwb":q=A.get.hwb(N),R="hwb";break;default:q=A.get.rgb(N),R="rgb"}return q?{model:R,value:q}:null},A.get.rgb=function(N){if(!N)return null;var q,R,v,F=[0,0,0,1];if(q=N.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(v=q[2],q=q[1],R=0;R<3;R++){var S=2*R;F[R]=parseInt(q.slice(S,S+2),16)}v&&(F[3]=parseInt(v,16)/255)}else if(q=N.match(/^#([a-f0-9]{3,4})$/i)){for(v=(q=q[1])[3],R=0;R<3;R++)F[R]=parseInt(q[R]+q[R],16);v&&(F[3]=parseInt(v+v,16)/255)}else if(q=N.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(R=0;R<3;R++)F[R]=parseInt(q[R+1],0);q[4]&&(q[5]?F[3]=.01*parseFloat(q[4]):F[3]=parseFloat(q[4]))}else{if(!(q=N.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(q=N.match(/^(\w+)$/))?"transparent"===q[1]?[0,0,0,0]:B.call(z,q[1])?((F=z[q[1]])[3]=1,F):null:null;for(R=0;R<3;R++)F[R]=Math.round(2.55*parseFloat(q[R+1]));q[4]&&(q[5]?F[3]=.01*parseFloat(q[4]):F[3]=parseFloat(q[4]))}for(R=0;R<3;R++)F[R]=y(F[R],0,255);return F[3]=y(F[3],0,1),F},A.get.hsl=function(N){if(!N)return null;var q=N.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var R=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,y(parseFloat(q[2]),0,100),y(parseFloat(q[3]),0,100),y(isNaN(R)?1:R,0,1)]}return null},A.get.hwb=function(N){if(!N)return null;var q=N.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var R=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,y(parseFloat(q[2]),0,100),y(parseFloat(q[3]),0,100),y(isNaN(R)?1:R,0,1)]}return null},A.to.hex=function(){var N=v(arguments);return"#"+E(N[0])+E(N[1])+E(N[2])+(N[3]<1?E(Math.round(255*N[3])):"")},A.to.rgb=function(){var N=v(arguments);return N.length<4||1===N[3]?"rgb("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+")":"rgba("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+", "+N[3]+")"},A.to.rgb.percent=function(){var N=v(arguments),q=Math.round(N[0]/255*100),R=Math.round(N[1]/255*100),z=Math.round(N[2]/255*100);return N.length<4||1===N[3]?"rgb("+q+"%, "+R+"%, "+z+"%)":"rgba("+q+"%, "+R+"%, "+z+"%, "+N[3]+")"},A.to.hsl=function(){var N=v(arguments);return N.length<4||1===N[3]?"hsl("+N[0]+", "+N[1]+"%, "+N[2]+"%)":"hsla("+N[0]+", "+N[1]+"%, "+N[2]+"%, "+N[3]+")"},A.to.hwb=function(){var N=v(arguments),q="";return N.length>=4&&1!==N[3]&&(q=", "+N[3]),"hwb("+N[0]+", "+N[1]+"%, "+N[2]+"%"+q+")"},A.to.keyword=function(N){return F[N.slice(0,3)]}},12479:(N,q,R)=>{const z=R(12483),v=R(12506),B=["keyword","gray","hex"],F={};for(const e of Object.keys(v))F[[...v[e].labels].sort().join("")]=e;const S={};function A(N,q){if(!(this instanceof A))return new A(N,q);if(q&&q in B&&(q=null),q&&!(q in v))throw new Error("Unknown model: "+q);let R,y;if(null==N)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(N instanceof A)this.model=N.model,this.color=[...N.color],this.valpha=N.valpha;else if("string"===typeof N){const q=z.get(N);if(null===q)throw new Error("Unable to parse color from string: "+N);this.model=q.model,y=v[this.model].channels,this.color=q.value.slice(0,y),this.valpha="number"===typeof q.value[y]?q.value[y]:1}else if(N.length>0){this.model=q||"rgb",y=v[this.model].channels;const R=Array.prototype.slice.call(N,0,y);this.color=x(R,y),this.valpha="number"===typeof N[y]?N[y]:1}else if("number"===typeof N)this.model="rgb",this.color=[N>>16&255,N>>8&255,255&N],this.valpha=1;else{this.valpha=1;const q=Object.keys(N);"alpha"in N&&(q.splice(q.indexOf("alpha"),1),this.valpha="number"===typeof N.alpha?N.alpha:0);const z=q.sort().join("");if(!(z in F))throw new Error("Unable to parse color from object: "+JSON.stringify(N));this.model=F[z];const{labels:B}=v[this.model],S=[];for(R=0;R<B.length;R++)S.push(N[B[R]]);this.color=x(S)}if(S[this.model])for(y=v[this.model].channels,R=0;R<y;R++){const N=S[this.model][R];N&&(this.color[R]=N(this.color[R]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}A.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(N){let q=this.model in z.to?this:this.rgb();q=q.round("number"===typeof N?N:1);const R=1===q.valpha?q.color:[...q.color,this.valpha];return z.to[q.model](R)},percentString(N){const q=this.rgb().round("number"===typeof N?N:1),R=1===q.valpha?q.color:[...q.color,this.valpha];return z.to.rgb.percent(R)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const N={},{channels:q}=v[this.model],{labels:R}=v[this.model];for(let z=0;z<q;z++)N[R[z]]=this.color[z];return 1!==this.valpha&&(N.alpha=this.valpha),N},unitArray(){const N=this.rgb().color;return N[0]/=255,N[1]/=255,N[2]/=255,1!==this.valpha&&N.push(this.valpha),N},unitObject(){const N=this.rgb().object();return N.r/=255,N.g/=255,N.b/=255,1!==this.valpha&&(N.alpha=this.valpha),N},round(N){return N=Math.max(N||0,0),new A([...this.color.map(y(N)),this.valpha],this.model)},alpha(N){return void 0!==N?new A([...this.color,Math.max(0,Math.min(1,N))],this.model):this.valpha},red:E("rgb",0,t(255)),green:E("rgb",1,t(255)),blue:E("rgb",2,t(255)),hue:E(["hsl","hsv","hsl","hwb","hcg"],0,(N=>(N%360+360)%360)),saturationl:E("hsl",1,t(100)),lightness:E("hsl",2,t(100)),saturationv:E("hsv",1,t(100)),value:E("hsv",2,t(100)),chroma:E("hcg",1,t(100)),gray:E("hcg",2,t(100)),white:E("hwb",1,t(100)),wblack:E("hwb",2,t(100)),cyan:E("cmyk",0,t(100)),magenta:E("cmyk",1,t(100)),yellow:E("cmyk",2,t(100)),black:E("cmyk",3,t(100)),x:E("xyz",0,t(95.047)),y:E("xyz",1,t(100)),z:E("xyz",2,t(108.833)),l:E("lab",0,t(100)),a:E("lab",1),b:E("lab",2),keyword(N){return void 0!==N?new A(N):v[this.model].keyword(this.color)},hex(N){return void 0!==N?new A(N):z.to.hex(this.rgb().round().color)},hexa(N){if(void 0!==N)return new A(N);const q=this.rgb().round().color;let R=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===R.length&&(R="0"+R),z.to.hex(q)+R},rgbNumber(){const N=this.rgb().color;return(255&N[0])<<16|(255&N[1])<<8|255&N[2]},luminosity(){const N=this.rgb().color,q=[];for(const[R,z]of N.entries()){const N=z/255;q[R]=N<=.04045?N/12.92:((N+.055)/1.055)**2.4}return.2126*q[0]+.7152*q[1]+.0722*q[2]},contrast(N){const q=this.luminosity(),R=N.luminosity();return q>R?(q+.05)/(R+.05):(R+.05)/(q+.05)},level(N){const q=this.contrast(N);return q>=7?"AAA":q>=4.5?"AA":""},isDark(){const N=this.rgb().color;return(2126*N[0]+7152*N[1]+722*N[2])/1e4<128},isLight(){return!this.isDark()},negate(){const N=this.rgb();for(let q=0;q<3;q++)N.color[q]=255-N.color[q];return N},lighten(N){const q=this.hsl();return q.color[2]+=q.color[2]*N,q},darken(N){const q=this.hsl();return q.color[2]-=q.color[2]*N,q},saturate(N){const q=this.hsl();return q.color[1]+=q.color[1]*N,q},desaturate(N){const q=this.hsl();return q.color[1]-=q.color[1]*N,q},whiten(N){const q=this.hwb();return q.color[1]+=q.color[1]*N,q},blacken(N){const q=this.hwb();return q.color[2]+=q.color[2]*N,q},grayscale(){const N=this.rgb().color,q=.3*N[0]+.59*N[1]+.11*N[2];return A.rgb(q,q,q)},fade(N){return this.alpha(this.valpha-this.valpha*N)},opaquer(N){return this.alpha(this.valpha+this.valpha*N)},rotate(N){const q=this.hsl();let R=q.color[0];return R=(R+N)%360,R=R<0?360+R:R,q.color[0]=R,q},mix(N,q){if(!N||!N.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof N);const R=N.rgb(),z=this.rgb(),v=void 0===q?.5:q,B=2*v-1,F=R.alpha()-z.alpha(),S=((B*F===-1?B:(B+F)/(1+B*F))+1)/2,y=1-S;return A.rgb(S*R.red()+y*z.red(),S*R.green()+y*z.green(),S*R.blue()+y*z.blue(),R.alpha()*v+z.alpha()*(1-v))}};for(const e of Object.keys(v)){if(B.includes(e))continue;const{channels:N}=v[e];A.prototype[e]=function(){if(this.model===e)return new A(this);for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];return q.length>0?new A(q,e):new A([...(z=v[this.model][e].raw(this.color),Array.isArray(z)?z:[z]),this.valpha],e);var z},A[e]=function(){for(var q=arguments.length,R=new Array(q),z=0;z<q;z++)R[z]=arguments[z];let v=R[0];return"number"===typeof v&&(v=x(R,N)),new A(v,e)}}function y(N){return function(q){return function(N,q){return Number(N.toFixed(q))}(q,N)}}function E(N,q,R){N=Array.isArray(N)?N:[N];for(const z of N)(S[z]||(S[z]=[]))[q]=R;return N=N[0],function(z){let v;return void 0!==z?(R&&(z=R(z)),v=this[N](),v.color[q]=z,v):(v=this[N]().color[q],R&&(v=R(v)),v)}}function t(N){return function(q){return Math.max(0,Math.min(N,q))}}function x(N,q){for(let R=0;R<q;R++)"number"!==typeof N[R]&&(N[R]=0);return N}N.exports=A},12512:(N,q,R)=>{const z=R(12517),v={};for(const F of Object.keys(z))v[z[F]]=F;const B={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};N.exports=B;for(const F of Object.keys(B)){if(!("channels"in B[F]))throw new Error("missing channels property: "+F);if(!("labels"in B[F]))throw new Error("missing channel labels property: "+F);if(B[F].labels.length!==B[F].channels)throw new Error("channel and label counts mismatch: "+F);const{channels:N,labels:q}=B[F];delete B[F].channels,delete B[F].labels,Object.defineProperty(B[F],"channels",{value:N}),Object.defineProperty(B[F],"labels",{value:q})}B.rgb.hsl=function(N){const q=N[0]/255,R=N[1]/255,z=N[2]/255,v=Math.min(q,R,z),B=Math.max(q,R,z),F=B-v;let S,A;B===v?S=0:q===B?S=(R-z)/F:R===B?S=2+(z-q)/F:z===B&&(S=4+(q-R)/F),S=Math.min(60*S,360),S<0&&(S+=360);const y=(v+B)/2;return A=B===v?0:y<=.5?F/(B+v):F/(2-B-v),[S,100*A,100*y]},B.rgb.hsv=function(N){let q,R,z,v,B;const F=N[0]/255,S=N[1]/255,A=N[2]/255,y=Math.max(F,S,A),E=y-Math.min(F,S,A),t=function(N){return(y-N)/6/E+.5};return 0===E?(v=0,B=0):(B=E/y,q=t(F),R=t(S),z=t(A),F===y?v=z-R:S===y?v=1/3+q-z:A===y&&(v=2/3+R-q),v<0?v+=1:v>1&&(v-=1)),[360*v,100*B,100*y]},B.rgb.hwb=function(N){const q=N[0],R=N[1];let z=N[2];const v=B.rgb.hsl(N)[0],F=1/255*Math.min(q,Math.min(R,z));return z=1-1/255*Math.max(q,Math.max(R,z)),[v,100*F,100*z]},B.rgb.cmyk=function(N){const q=N[0]/255,R=N[1]/255,z=N[2]/255,v=Math.min(1-q,1-R,1-z);return[100*((1-q-v)/(1-v)||0),100*((1-R-v)/(1-v)||0),100*((1-z-v)/(1-v)||0),100*v]},B.rgb.keyword=function(N){const q=v[N];if(q)return q;let R,B=1/0;for(const v of Object.keys(z)){const q=z[v],A=(S=q,((F=N)[0]-S[0])**2+(F[1]-S[1])**2+(F[2]-S[2])**2);A<B&&(B=A,R=v)}var F,S;return R},B.keyword.rgb=function(N){return z[N]},B.rgb.xyz=function(N){let q=N[0]/255,R=N[1]/255,z=N[2]/255;q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,R=R>.04045?((R+.055)/1.055)**2.4:R/12.92,z=z>.04045?((z+.055)/1.055)**2.4:z/12.92;return[100*(.4124*q+.3576*R+.1805*z),100*(.2126*q+.7152*R+.0722*z),100*(.0193*q+.1192*R+.9505*z)]},B.rgb.lab=function(N){const q=B.rgb.xyz(N);let R=q[0],z=q[1],v=q[2];R/=95.047,z/=100,v/=108.883,R=R>.008856?R**(1/3):7.787*R+16/116,z=z>.008856?z**(1/3):7.787*z+16/116,v=v>.008856?v**(1/3):7.787*v+16/116;return[116*z-16,500*(R-z),200*(z-v)]},B.hsl.rgb=function(N){const q=N[0]/360,R=N[1]/100,z=N[2]/100;let v,B,F;if(0===R)return F=255*z,[F,F,F];v=z<.5?z*(1+R):z+R-z*R;const S=2*z-v,A=[0,0,0];for(let y=0;y<3;y++)B=q+1/3*-(y-1),B<0&&B++,B>1&&B--,F=6*B<1?S+6*(v-S)*B:2*B<1?v:3*B<2?S+(v-S)*(2/3-B)*6:S,A[y]=255*F;return A},B.hsl.hsv=function(N){const q=N[0];let R=N[1]/100,z=N[2]/100,v=R;const B=Math.max(z,.01);z*=2,R*=z<=1?z:2-z,v*=B<=1?B:2-B;return[q,100*(0===z?2*v/(B+v):2*R/(z+R)),100*((z+R)/2)]},B.hsv.rgb=function(N){const q=N[0]/60,R=N[1]/100;let z=N[2]/100;const v=Math.floor(q)%6,B=q-Math.floor(q),F=255*z*(1-R),S=255*z*(1-R*B),A=255*z*(1-R*(1-B));switch(z*=255,v){case 0:return[z,A,F];case 1:return[S,z,F];case 2:return[F,z,A];case 3:return[F,S,z];case 4:return[A,F,z];case 5:return[z,F,S]}},B.hsv.hsl=function(N){const q=N[0],R=N[1]/100,z=N[2]/100,v=Math.max(z,.01);let B,F;F=(2-R)*z;const S=(2-R)*v;return B=R*v,B/=S<=1?S:2-S,B=B||0,F/=2,[q,100*B,100*F]},B.hwb.rgb=function(N){const q=N[0]/360;let R=N[1]/100,z=N[2]/100;const v=R+z;let B;v>1&&(R/=v,z/=v);const F=Math.floor(6*q),S=1-z;B=6*q-F,0!==(1&F)&&(B=1-B);const A=R+B*(S-R);let y,E,t;switch(F){default:case 6:case 0:y=S,E=A,t=R;break;case 1:y=A,E=S,t=R;break;case 2:y=R,E=S,t=A;break;case 3:y=R,E=A,t=S;break;case 4:y=A,E=R,t=S;break;case 5:y=S,E=R,t=A}return[255*y,255*E,255*t]},B.cmyk.rgb=function(N){const q=N[0]/100,R=N[1]/100,z=N[2]/100,v=N[3]/100;return[255*(1-Math.min(1,q*(1-v)+v)),255*(1-Math.min(1,R*(1-v)+v)),255*(1-Math.min(1,z*(1-v)+v))]},B.xyz.rgb=function(N){const q=N[0]/100,R=N[1]/100,z=N[2]/100;let v,B,F;return v=3.2406*q+-1.5372*R+-.4986*z,B=-.9689*q+1.8758*R+.0415*z,F=.0557*q+-.204*R+1.057*z,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,v=Math.min(Math.max(0,v),1),B=Math.min(Math.max(0,B),1),F=Math.min(Math.max(0,F),1),[255*v,255*B,255*F]},B.xyz.lab=function(N){let q=N[0],R=N[1],z=N[2];q/=95.047,R/=100,z/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,R=R>.008856?R**(1/3):7.787*R+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*R-16,500*(q-R),200*(R-z)]},B.lab.xyz=function(N){let q,R,z;R=(N[0]+16)/116,q=N[1]/500+R,z=R-N[2]/200;const v=R**3,B=q**3,F=z**3;return R=v>.008856?v:(R-16/116)/7.787,q=B>.008856?B:(q-16/116)/7.787,z=F>.008856?F:(z-16/116)/7.787,q*=95.047,R*=100,z*=108.883,[q,R,z]},B.lab.lch=function(N){const q=N[0],R=N[1],z=N[2];let v;v=360*Math.atan2(z,R)/2/Math.PI,v<0&&(v+=360);return[q,Math.sqrt(R*R+z*z),v]},B.lch.lab=function(N){const q=N[0],R=N[1],z=N[2]/360*2*Math.PI;return[q,R*Math.cos(z),R*Math.sin(z)]},B.rgb.ansi16=function(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[R,z,v]=N;let F=null===q?B.rgb.hsv(N)[2]:q;if(F=Math.round(F/50),0===F)return 30;let S=30+(Math.round(v/255)<<2|Math.round(z/255)<<1|Math.round(R/255));return 2===F&&(S+=60),S},B.hsv.ansi16=function(N){return B.rgb.ansi16(B.hsv.rgb(N),N[2])},B.rgb.ansi256=function(N){const q=N[0],R=N[1],z=N[2];if(q===R&&R===z)return q<8?16:q>248?231:Math.round((q-8)/247*24)+232;return 16+36*Math.round(q/255*5)+6*Math.round(R/255*5)+Math.round(z/255*5)},B.ansi16.rgb=function(N){let q=N%10;if(0===q||7===q)return N>50&&(q+=3.5),q=q/10.5*255,[q,q,q];const R=.5*(1+~~(N>50));return[(1&q)*R*255,(q>>1&1)*R*255,(q>>2&1)*R*255]},B.ansi256.rgb=function(N){if(N>=232){const q=10*(N-232)+8;return[q,q,q]}let q;N-=16;return[Math.floor(N/36)/5*255,Math.floor((q=N%36)/6)/5*255,q%6/5*255]},B.rgb.hex=function(N){const q=(((255&Math.round(N[0]))<<16)+((255&Math.round(N[1]))<<8)+(255&Math.round(N[2]))).toString(16).toUpperCase();return"000000".substring(q.length)+q},B.hex.rgb=function(N){const q=N.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!q)return[0,0,0];let R=q[0];3===q[0].length&&(R=R.split("").map((N=>N+N)).join(""));const z=parseInt(R,16);return[z>>16&255,z>>8&255,255&z]},B.rgb.hcg=function(N){const q=N[0]/255,R=N[1]/255,z=N[2]/255,v=Math.max(Math.max(q,R),z),B=Math.min(Math.min(q,R),z),F=v-B;let S,A;return S=F<1?B/(1-F):0,A=F<=0?0:v===q?(R-z)/F%6:v===R?2+(z-q)/F:4+(q-R)/F,A/=6,A%=1,[360*A,100*F,100*S]},B.hsl.hcg=function(N){const q=N[1]/100,R=N[2]/100,z=R<.5?2*q*R:2*q*(1-R);let v=0;return z<1&&(v=(R-.5*z)/(1-z)),[N[0],100*z,100*v]},B.hsv.hcg=function(N){const q=N[1]/100,R=N[2]/100,z=q*R;let v=0;return z<1&&(v=(R-z)/(1-z)),[N[0],100*z,100*v]},B.hcg.rgb=function(N){const q=N[0]/360,R=N[1]/100,z=N[2]/100;if(0===R)return[255*z,255*z,255*z];const v=[0,0,0],B=q%1*6,F=B%1,S=1-F;let A=0;switch(Math.floor(B)){case 0:v[0]=1,v[1]=F,v[2]=0;break;case 1:v[0]=S,v[1]=1,v[2]=0;break;case 2:v[0]=0,v[1]=1,v[2]=F;break;case 3:v[0]=0,v[1]=S,v[2]=1;break;case 4:v[0]=F,v[1]=0,v[2]=1;break;default:v[0]=1,v[1]=0,v[2]=S}return A=(1-R)*z,[255*(R*v[0]+A),255*(R*v[1]+A),255*(R*v[2]+A)]},B.hcg.hsv=function(N){const q=N[1]/100,R=q+N[2]/100*(1-q);let z=0;return R>0&&(z=q/R),[N[0],100*z,100*R]},B.hcg.hsl=function(N){const q=N[1]/100,R=N[2]/100*(1-q)+.5*q;let z=0;return R>0&&R<.5?z=q/(2*R):R>=.5&&R<1&&(z=q/(2*(1-R))),[N[0],100*z,100*R]},B.hcg.hwb=function(N){const q=N[1]/100,R=q+N[2]/100*(1-q);return[N[0],100*(R-q),100*(1-R)]},B.hwb.hcg=function(N){const q=N[1]/100,R=1-N[2]/100,z=R-q;let v=0;return z<1&&(v=(R-z)/(1-z)),[N[0],100*z,100*v]},B.apple.rgb=function(N){return[N[0]/65535*255,N[1]/65535*255,N[2]/65535*255]},B.rgb.apple=function(N){return[N[0]/255*65535,N[1]/255*65535,N[2]/255*65535]},B.gray.rgb=function(N){return[N[0]/100*255,N[0]/100*255,N[0]/100*255]},B.gray.hsl=function(N){return[0,0,N[0]]},B.gray.hsv=B.gray.hsl,B.gray.hwb=function(N){return[0,100,N[0]]},B.gray.cmyk=function(N){return[0,0,0,N[0]]},B.gray.lab=function(N){return[N[0],0,0]},B.gray.hex=function(N){const q=255&Math.round(N[0]/100*255),R=((q<<16)+(q<<8)+q).toString(16).toUpperCase();return"000000".substring(R.length)+R},B.rgb.gray=function(N){return[(N[0]+N[1]+N[2])/3/255*100]}},12506:(N,q,R)=>{const z=R(12512),v=R(12520),B={};Object.keys(z).forEach((N=>{B[N]={},Object.defineProperty(B[N],"channels",{value:z[N].channels}),Object.defineProperty(B[N],"labels",{value:z[N].labels});const q=v(N);Object.keys(q).forEach((R=>{const z=q[R];B[N][R]=function(N){const q=function(){for(var q=arguments.length,R=new Array(q),z=0;z<q;z++)R[z]=arguments[z];const v=R[0];if(void 0===v||null===v)return v;v.length>1&&(R=v);const B=N(R);if("object"===typeof B)for(let N=B.length,F=0;F<N;F++)B[F]=Math.round(B[F]);return B};return"conversion"in N&&(q.conversion=N.conversion),q}(z),B[N][R].raw=function(N){const q=function(){for(var q=arguments.length,R=new Array(q),z=0;z<q;z++)R[z]=arguments[z];const v=R[0];return void 0===v||null===v?v:(v.length>1&&(R=v),N(R))};return"conversion"in N&&(q.conversion=N.conversion),q}(z)}))})),N.exports=B},12520:(N,q,R)=>{const z=R(12512);function v(N){const q=function(){const N={},q=Object.keys(z);for(let R=q.length,z=0;z<R;z++)N[q[z]]={distance:-1,parent:null};return N}(),R=[N];for(q[N].distance=0;R.length;){const N=R.pop(),v=Object.keys(z[N]);for(let z=v.length,B=0;B<z;B++){const z=v[B],F=q[z];-1===F.distance&&(F.distance=q[N].distance+1,F.parent=N,R.unshift(z))}}return q}function B(N,q){return function(R){return q(N(R))}}function F(N,q){const R=[q[N].parent,N];let v=z[q[N].parent][N],F=q[N].parent;for(;q[F].parent;)R.unshift(q[F].parent),v=B(z[q[F].parent][F],v),F=q[F].parent;return v.conversion=R,v}N.exports=function(N){const q=v(N),R={},z=Object.keys(q);for(let v=z.length,B=0;B<v;B++){const N=z[B];null!==q[N].parent&&(R[N]=F(N,q))}return R}},12517:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10810:function(N,q,R){"use strict";var z=this&&this.__createBinding||(Object.create?function(N,q,R,z){void 0===z&&(z=R);var v=Object.getOwnPropertyDescriptor(q,R);v&&!("get"in v?!q.__esModule:v.writable||v.configurable)||(v={enumerable:!0,get:function(){return q[R]}}),Object.defineProperty(N,z,v)}:function(N,q,R,z){void 0===z&&(z=R),N[z]=q[R]}),v=this&&this.__setModuleDefault||(Object.create?function(N,q){Object.defineProperty(N,"default",{enumerable:!0,value:q})}:function(N,q){N.default=q}),B=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var q={};if(null!=N)for(var R in N)"default"!==R&&Object.prototype.hasOwnProperty.call(N,R)&&z(q,N,R);return v(q,N),q},F=this&&this.__awaiter||function(N,q,R,z){return new(R||(R=Promise))((function(v,B){function F(N){try{A(z.next(N))}catch(q){B(q)}}function S(N){try{A(z.throw(N))}catch(q){B(q)}}function A(N){var q;N.done?v(N.value):(q=N.value,q instanceof R?q:new R((function(N){N(q)}))).then(F,S)}A((z=z.apply(N,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Auth=q.Platform=void 0;const S=B(R(10732)),A=R(10817),y="colyseus-auth-token";!function(N){N.ios="ios",N.android="android"}(q.Platform||(q.Platform={}));q.Auth=class{constructor(N){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=N.replace("ws","http"),(0,A.getItem)(y,(N=>this.token=N))}get hasToken(){return!!this.token}login(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F(this,void 0,void 0,(function*(){const q=Object.assign({},N);this.hasToken&&(q.token=this.token);const R=yield this.request("post","/auth",q);this.token=R.token,(0,A.setItem)(y,this.token);for(let N in R)this.hasOwnProperty(N)&&(this[N]=R[N]);return this.registerPingService(),this}))}save(){return F(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(N){return F(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:N})}))}acceptFriendRequest(N){return F(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:N})}))}declineFriendRequest(N){return F(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:N})}))}blockUser(N){return F(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:N})}))}unblockUser(N){return F(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:N})}))}request(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return F(this,void 0,void 0,(function*(){v.Accept="application/json",this.hasToken&&(v.Authorization="Bearer "+this.token);const B=[];for(const N in R)B.push(`${N}=${R[N]}`);const F=B.length>0?`?${B.join("&")}`:"",A={headers:v};return z&&(A.body=z),(yield S[N](`${this.endpoint}${q}${F}`,A)).data}))}logout(){this.token=void 0,(0,A.removeItem)(y),this.unregisterPingService()}registerPingService(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),N)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10723:function(N,q,R){"use strict";var z,v=this&&this.__awaiter||function(N,q,R,z){return new(R||(R=Promise))((function(v,B){function F(N){try{A(z.next(N))}catch(q){B(q)}}function S(N){try{A(z.throw(N))}catch(q){B(q)}}function A(N){var q;N.done?v(N.value):(q=N.value,q instanceof R?q:new R((function(N){N(q)}))).then(F,S)}A((z=z.apply(N,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Client=q.MatchMakeError=void 0;const B=R(10732),F=R(10739),S=R(10742);class A extends Error{constructor(N,q){super(N),this.code=q,Object.setPrototypeOf(this,A.prototype)}}q.MatchMakeError=A;const y="undefined"!==typeof window&&"undefined"!==typeof(null===(z=null===window||void 0===window?void 0:window.location)||void 0===z?void 0:z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";q.Client=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;if("string"===typeof N){const q=new URL(N),R="https:"===q.protocol||"wss:"===q.protocol,z=Number(q.port||(R?443:80));this.settings={hostname:q.hostname,pathname:"/"!==q.pathname?q.pathname:"",port:z,secure:R}}else void 0===N.port&&(N.port=N.secure?443:80),void 0===N.pathname&&(N.pathname=""),this.settings=N}joinOrCreate(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",N,q,R)}))}create(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",N,q,R)}))}join(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",N,q,R)}))}joinById(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return v(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",N,q,R)}))}reconnect(N,q){return v(this,void 0,void 0,(function*(){if("string"===typeof N&&"string"===typeof q)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[R,z]=N.split(":");return yield this.createMatchMakeRequest("reconnect",R,{reconnectionToken:z},q)}))}getAvailableRooms(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return v(this,void 0,void 0,(function*(){return(yield(0,B.get)(this.getHttpEndpoint(`${N}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(N,q,R){return v(this,void 0,void 0,(function*(){const z=this.createRoom(N.room.name,q);z.roomId=N.room.roomId,z.sessionId=N.sessionId;const B={sessionId:z.sessionId};N.reconnectionToken&&(B.reconnectionToken=N.reconnectionToken);const S=R||z;return z.connect(this.buildEndpoint(N.room,B),N.devMode&&(()=>v(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${z.roomId}'...`);let R=0;const B=()=>v(this,void 0,void 0,(function*(){R++;try{yield this.consumeSeatReservation(N,q,S),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${z.roomId}'`)}catch(v){R<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${R} out of 8)`),setTimeout(B,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(B,2e3)}))),S),new Promise(((N,q)=>{const R=(N,R)=>q(new F.ServerError(N,R));S.onError.once(R),S.onJoin.once((()=>{S.onError.remove(R),N(S)}))}))}))}createMatchMakeRequest(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;return v(this,void 0,void 0,(function*(){const v=(yield(0,B.post)(this.getHttpEndpoint(`${N}/${q}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(R)})).data;if(v.error)throw new A(v.error,v.code);return"reconnect"===N&&(v.reconnectionToken=R.reconnectionToken),yield this.consumeSeatReservation(v,z,F)}))}createRoom(N,q){return new S.Room(N,q)}buildEndpoint(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const R=[];for(const v in q)q.hasOwnProperty(v)&&R.push(`${v}=${q[v]}`);let z=this.settings.secure?"wss://":"ws://";return N.publicAddress?z+=`${N.publicAddress}`:z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${z}/${N.processId}/${N.roomId}?${R.join("&")}`}getHttpEndpoint(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${N}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10756:(N,q,R)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.Connection=void 0;const z=R(10765);q.Connection=class{constructor(){this.events={},this.transport=new z.WebSocketTransport(this.events)}send(N){this.transport.send(N)}connect(N){this.transport.connect(N)}close(N,q){this.transport.close(N,q)}get isOpen(){return this.transport.isOpen}}},10783:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.utf8Length=q.utf8Read=q.ErrorCode=q.Protocol=void 0,function(N){N[N.HANDSHAKE=9]="HANDSHAKE",N[N.JOIN_ROOM=10]="JOIN_ROOM",N[N.ERROR=11]="ERROR",N[N.LEAVE_ROOM=12]="LEAVE_ROOM",N[N.ROOM_DATA=13]="ROOM_DATA",N[N.ROOM_STATE=14]="ROOM_STATE",N[N.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",N[N.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",N[N.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(q.Protocol||(q.Protocol={})),function(N){N[N.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",N[N.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",N[N.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",N[N.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",N[N.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",N[N.AUTH_FAILED=4215]="AUTH_FAILED",N[N.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(q.ErrorCode||(q.ErrorCode={})),q.utf8Read=function(N,q){const R=N[q++];for(var z="",v=0,B=q,F=q+R;B<F;B++){var S=N[B];if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(v=(7&S)<<18|(63&N[++B])<<12|(63&N[++B])<<6|63&N[++B])>=65536?(v-=65536,z+=String.fromCharCode(55296+(v>>>10),56320+(1023&v))):z+=String.fromCharCode(v)}else z+=String.fromCharCode((15&S)<<12|(63&N[++B])<<6|63&N[++B]);else z+=String.fromCharCode((31&S)<<6|63&N[++B]);else z+=String.fromCharCode(S)}return z},q.utf8Length=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",q=0,R=0;for(let z=0,v=N.length;z<v;z++)q=N.charCodeAt(z),q<128?R+=1:q<2048?R+=2:q<55296||q>=57344?R+=3:(z++,R+=4);return R+1}},10742:function(N,q,R){"use strict";var z=this&&this.__createBinding||(Object.create?function(N,q,R,z){void 0===z&&(z=R);var v=Object.getOwnPropertyDescriptor(q,R);v&&!("get"in v?!q.__esModule:v.writable||v.configurable)||(v={enumerable:!0,get:function(){return q[R]}}),Object.defineProperty(N,z,v)}:function(N,q,R,z){void 0===z&&(z=R),N[z]=q[R]}),v=this&&this.__setModuleDefault||(Object.create?function(N,q){Object.defineProperty(N,"default",{enumerable:!0,value:q})}:function(N,q){N.default=q}),B=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var q={};if(null!=N)for(var R in N)"default"!==R&&Object.prototype.hasOwnProperty.call(N,R)&&z(q,N,R);return v(q,N),q};Object.defineProperty(q,"__esModule",{value:!0}),q.Room=void 0;const F=B(R(10749)),S=R(10756),A=R(10783),y=R(10787),E=R(10794),t=R(10799),x=R(10802),e=R(10739);class b{constructor(N,q){this.onStateChange=(0,t.createSignal)(),this.onError=(0,t.createSignal)(),this.onLeave=(0,t.createSignal)(),this.onJoin=(0,t.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,E.createNanoEvents)(),this.roomId=null,this.name=N,q&&(this.serializer=new((0,y.getSerializer)("schema")),this.rootSchema=q,this.serializer.state=new q),this.onError(((N,q)=>{var R;return null===(R=console.warn)||void 0===R?void 0:R.call(console,`colyseus.js - onError => (${N}) ${q}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const z=new S.Connection;R.connection=z,z.events.onmessage=b.prototype.onMessageCallback.bind(R),z.events.onclose=function(N){var z;if(!R.hasJoined)return null===(z=console.warn)||void 0===z||z.call(console,`Room connection was closed unexpectedly (${N.code}): ${N.reason}`),void R.onError.invoke(N.code,N.reason);N.code===e.CloseCode.DEVMODE_RESTART&&q?q():(R.onLeave.invoke(N.code),R.destroy())},z.events.onerror=function(N){var q;null===(q=console.warn)||void 0===q||q.call(console,`Room, onError (${N.code}): ${N.reason}`),R.onError.invoke(N.code,N.reason)},z.connect(N)}leave(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((q=>{this.onLeave((N=>q(N))),this.connection?N?this.connection.send([A.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(e.CloseCode.CONSENTED)}))}onMessage(N,q){return this.onMessageHandlers.on(this.getMessageHandlerKey(N),q)}send(N,q){const R=[A.Protocol.ROOM_DATA];let z;if("string"===typeof N?x.encode.string(R,N):x.encode.number(R,N),void 0!==q){const N=F.encode(q);z=new Uint8Array(R.length+N.byteLength),z.set(new Uint8Array(R),0),z.set(new Uint8Array(N),R.length)}else z=new Uint8Array(R);this.connection.send(z.buffer)}sendBytes(N,q){const R=[A.Protocol.ROOM_DATA_BYTES];let z;"string"===typeof N?x.encode.string(R,N):x.encode.number(R,N),z=new Uint8Array(R.length+(q.byteLength||q.length)),z.set(new Uint8Array(R),0),z.set(new Uint8Array(q),R.length),this.connection.send(z.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(N){const q=Array.from(new Uint8Array(N.data)),R=q[0];if(R===A.Protocol.JOIN_ROOM){let N=1;const R=(0,A.utf8Read)(q,N);if(N+=(0,A.utf8Length)(R),this.serializerId=(0,A.utf8Read)(q,N),N+=(0,A.utf8Length)(this.serializerId),!this.serializer){const N=(0,y.getSerializer)(this.serializerId);this.serializer=new N}q.length>N&&this.serializer.handshake&&this.serializer.handshake(q,{offset:N}),this.reconnectionToken=`${this.roomId}:${R}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([A.Protocol.JOIN_ROOM])}else if(R===A.Protocol.ERROR){const N={offset:1},R=x.decode.number(q,N),z=x.decode.string(q,N);this.onError.invoke(R,z)}else if(R===A.Protocol.LEAVE_ROOM)this.leave();else if(R===A.Protocol.ROOM_DATA_SCHEMA){const N={offset:1},R=this.serializer.getState().constructor._context.get(x.decode.number(q,N)),z=new R;z.decode(q,N),this.dispatchMessage(R,z)}else if(R===A.Protocol.ROOM_STATE)q.shift(),this.setState(q);else if(R===A.Protocol.ROOM_STATE_PATCH)q.shift(),this.patch(q);else if(R===A.Protocol.ROOM_DATA){const R={offset:1},z=x.decode.stringCheck(q,R)?x.decode.string(q,R):x.decode.number(q,R),v=q.length>R.offset?F.decode(N.data,R.offset):void 0;this.dispatchMessage(z,v)}else if(R===A.Protocol.ROOM_DATA_BYTES){const N={offset:1},R=x.decode.stringCheck(q,N)?x.decode.string(q,N):x.decode.number(q,N);this.dispatchMessage(R,new Uint8Array(q.slice(N.offset)))}}setState(N){this.serializer.setState(N),this.onStateChange.invoke(this.serializer.getState())}patch(N){this.serializer.patch(N),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(N,q){var R;const z=this.getMessageHandlerKey(N);this.onMessageHandlers.events[z]?this.onMessageHandlers.emit(z,q):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",N,q):null===(R=console.warn)||void 0===R||R.call(console,`colyseus.js: onMessage() not registered for type '${N}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(N){switch(typeof N){case"function":return`$${N._typeid}`;case"string":return N;case"number":return`i${N}`;default:throw new Error("invalid message type.")}}}q.Room=b},10817:(N,q)=>{"use strict";let R;function z(){return R||(R="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(N,q){this.cache[N]=q},getItem:function(N){this.cache[N]},removeItem:function(N){delete this.cache[N]}}),R}Object.defineProperty(q,"__esModule",{value:!0}),q.getItem=q.removeItem=q.setItem=void 0,q.setItem=function(N,q){z().setItem(N,q)},q.removeItem=function(N){z().removeItem(N)},q.getItem=function(N,q){const R=z().getItem(N);"undefined"!==typeof Promise&&R instanceof Promise?R.then((N=>q(N))):q(R)}},10794:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createNanoEvents=void 0;q.createNanoEvents=()=>({emit(N){let q=this.events[N]||[];for(var R=arguments.length,z=new Array(R>1?R-1:0),v=1;v<R;v++)z[v-1]=arguments[v];for(let B=0,F=q.length;B<F;B++)q[B](...z)},events:{},on(N,q){var R;return(null===(R=this.events[N])||void 0===R?void 0:R.push(q))||(this.events[N]=[q]),()=>{var R;this.events[N]=null===(R=this.events[N])||void 0===R?void 0:R.filter((N=>q!==N))}}})},10799:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createSignal=q.EventEmitter=void 0;class R{constructor(){this.handlers=[]}register(N){return this.handlers.push(N),this}invoke(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];this.handlers.forEach((N=>N.apply(this,q)))}invokeAsync(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];return Promise.all(this.handlers.map((N=>N.apply(this,q))))}remove(N){const q=this.handlers.indexOf(N);this.handlers[q]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}q.EventEmitter=R,q.createSignal=function(){const N=new R;function q(q){return N.register(q,null===this)}return q.once=q=>{const R=function(){for(var z=arguments.length,v=new Array(z),B=0;B<z;B++)v[B]=arguments[B];q.apply(this,v),N.remove(R)};N.register(R)},q.remove=q=>N.remove(q),q.invoke=function(){return N.invoke(...arguments)},q.invokeAsync=function(){return N.invokeAsync(...arguments)},q.clear=()=>N.clear(),q}},10739:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.ServerError=q.CloseCode=void 0,function(N){N[N.CONSENTED=4e3]="CONSENTED",N[N.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(q.CloseCode||(q.CloseCode={}));class R extends Error{constructor(N,q){super(q),this.name="ServerError",this.code=N}}q.ServerError=R},10712:(N,q,R)=>{"use strict";q.b=void 0,R(10715);var z=R(10723);Object.defineProperty(q,"b",{enumerable:!0,get:function(){return z.Client}});var v=R(10783);var B=R(10742);var F=R(10810);const S=R(10821);const A=R(10823),y=R(10787);(0,y.registerSerializer)("schema",S.SchemaSerializer),(0,y.registerSerializer)("none",A.NoneSerializer)},10715:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=N=>null!==N&&"object"===typeof N&&N.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10749:(N,q)=>{"use strict";function R(N,q){if(this._offset=q,N instanceof ArrayBuffer)this._buffer=N,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(N))throw new Error("Invalid argument");this._buffer=N.buffer,this._view=new DataView(this._buffer,N.byteOffset,N.byteLength)}}Object.defineProperty(q,"__esModule",{value:!0}),q.decode=q.encode=void 0,R.prototype._array=function(N){for(var q=new Array(N),R=0;R<N;R++)q[R]=this._parse();return q},R.prototype._map=function(N){for(var q={},R=0;R<N;R++)q[this._parse()]=this._parse();return q},R.prototype._str=function(N){var q=function(N,q,R){for(var z="",v=0,B=q,F=q+R;B<F;B++){var S=N.getUint8(B);if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(v=(7&S)<<18|(63&N.getUint8(++B))<<12|(63&N.getUint8(++B))<<6|63&N.getUint8(++B))>=65536?(v-=65536,z+=String.fromCharCode(55296+(v>>>10),56320+(1023&v))):z+=String.fromCharCode(v)}else z+=String.fromCharCode((15&S)<<12|(63&N.getUint8(++B))<<6|63&N.getUint8(++B));else z+=String.fromCharCode((31&S)<<6|63&N.getUint8(++B));else z+=String.fromCharCode(S)}return z}(this._view,this._offset,N);return this._offset+=N,q},R.prototype._bin=function(N){var q=this._buffer.slice(this._offset,this._offset+N);return this._offset+=N,q},R.prototype._parse=function(){var N,q=this._view.getUint8(this._offset++),R=0,z=0,v=0,B=0;if(q<192)return q<128?q:q<144?this._map(15&q):q<160?this._array(15&q):this._str(31&q);if(q>223)return-1*(255-q+1);switch(q){case 192:return null;case 194:return!1;case 195:return!0;case 196:return R=this._view.getUint8(this._offset),this._offset+=1,this._bin(R);case 197:return R=this._view.getUint16(this._offset),this._offset+=2,this._bin(R);case 198:return R=this._view.getUint32(this._offset),this._offset+=4,this._bin(R);case 199:if(R=this._view.getUint8(this._offset),z=this._view.getInt8(this._offset+1),this._offset+=2,-1===z){var F=this._view.getUint32(this._offset);return v=this._view.getInt32(this._offset+4),B=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*v+B)+F/1e6)}return[z,this._bin(R)];case 200:return R=this._view.getUint16(this._offset),z=this._view.getInt8(this._offset+2),this._offset+=3,[z,this._bin(R)];case 201:return R=this._view.getUint32(this._offset),z=this._view.getInt8(this._offset+4),this._offset+=5,[z,this._bin(R)];case 202:return N=this._view.getFloat32(this._offset),this._offset+=4,N;case 203:return N=this._view.getFloat64(this._offset),this._offset+=8,N;case 204:return N=this._view.getUint8(this._offset),this._offset+=1,N;case 205:return N=this._view.getUint16(this._offset),this._offset+=2,N;case 206:return N=this._view.getUint32(this._offset),this._offset+=4,N;case 207:return v=this._view.getUint32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,v+B;case 208:return N=this._view.getInt8(this._offset),this._offset+=1,N;case 209:return N=this._view.getInt16(this._offset),this._offset+=2,N;case 210:return N=this._view.getInt32(this._offset),this._offset+=4,N;case 211:return v=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,v+B;case 212:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?void(this._offset+=1):[z,this._bin(1)];case 213:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(2)];case 214:return z=this._view.getInt8(this._offset),this._offset+=1,-1===z?(N=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*N)):[z,this._bin(4)];case 215:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?(v=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(v+B)):-1===z?(v=this._view.getUint32(this._offset),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&v)+B)+(v>>>2)/1e6)):[z,this._bin(8)];case 216:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(16)];case 217:return R=this._view.getUint8(this._offset),this._offset+=1,this._str(R);case 218:return R=this._view.getUint16(this._offset),this._offset+=2,this._str(R);case 219:return R=this._view.getUint32(this._offset),this._offset+=4,this._str(R);case 220:return R=this._view.getUint16(this._offset),this._offset+=2,this._array(R);case 221:return R=this._view.getUint32(this._offset),this._offset+=4,this._array(R);case 222:return R=this._view.getUint16(this._offset),this._offset+=2,this._map(R);case 223:return R=this._view.getUint32(this._offset),this._offset+=4,this._map(R)}throw new Error("Could not parse")},q.decode=function(N){var q=new R(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),z=q._parse();if(q._offset!==N.byteLength)throw new Error(N.byteLength-q._offset+" trailing bytes");return z};function z(N,q,R){for(var z=0,v=0,B=R.length;v<B;v++)(z=R.charCodeAt(v))<128?N.setUint8(q++,z):z<2048?(N.setUint8(q++,192|z>>6),N.setUint8(q++,128|63&z)):z<55296||z>=57344?(N.setUint8(q++,224|z>>12),N.setUint8(q++,128|z>>6&63),N.setUint8(q++,128|63&z)):(v++,z=65536+((1023&z)<<10|1023&R.charCodeAt(v)),N.setUint8(q++,240|z>>18),N.setUint8(q++,128|z>>12&63),N.setUint8(q++,128|z>>6&63),N.setUint8(q++,128|63&z))}function v(N,q,R){var z=typeof R,B=0,F=0,S=0,A=0,y=0,E=0;if("string"===z){if(y=function(N){for(var q=0,R=0,z=0,v=N.length;z<v;z++)(q=N.charCodeAt(z))<128?R+=1:q<2048?R+=2:q<55296||q>=57344?R+=3:(z++,R+=4);return R}(R),y<32)N.push(160|y),E=1;else if(y<256)N.push(217,y),E=2;else if(y<65536)N.push(218,y>>8,y),E=3;else{if(!(y<4294967296))throw new Error("String too long");N.push(219,y>>24,y>>16,y>>8,y),E=5}return q.push({_str:R,_length:y,_offset:N.length}),E+y}if("number"===z)return Math.floor(R)===R&&isFinite(R)?R>=0?R<128?(N.push(R),1):R<256?(N.push(204,R),2):R<65536?(N.push(205,R>>8,R),3):R<4294967296?(N.push(206,R>>24,R>>16,R>>8,R),5):(S=R/Math.pow(2,32)|0,A=R>>>0,N.push(207,S>>24,S>>16,S>>8,S,A>>24,A>>16,A>>8,A),9):R>=-32?(N.push(R),1):R>=-128?(N.push(208,R),2):R>=-32768?(N.push(209,R>>8,R),3):R>=-2147483648?(N.push(210,R>>24,R>>16,R>>8,R),5):(S=Math.floor(R/Math.pow(2,32)),A=R>>>0,N.push(211,S>>24,S>>16,S>>8,S,A>>24,A>>16,A>>8,A),9):(N.push(203),q.push({_float:R,_length:8,_offset:N.length}),9);if("object"===z){if(null===R)return N.push(192),1;if(Array.isArray(R)){if((y=R.length)<16)N.push(144|y),E=1;else if(y<65536)N.push(220,y>>8,y),E=3;else{if(!(y<4294967296))throw new Error("Array too large");N.push(221,y>>24,y>>16,y>>8,y),E=5}for(B=0;B<y;B++)E+=v(N,q,R[B]);return E}if(R instanceof Date){var t=R.getTime(),x=Math.floor(t/1e3),e=1e6*(t-1e3*x);return x>=0&&e>=0&&x<=17179869183?0===e&&x<=4294967295?(N.push(214,255,x>>24,x>>16,x>>8,x),6):(S=x/4294967296,A=4294967295&x,N.push(215,255,e>>22,e>>14,e>>6,S,A>>24,A>>16,A>>8,A),10):(S=Math.floor(x/4294967296),A=x>>>0,N.push(199,12,255,e>>24,e>>16,e>>8,e,S>>24,S>>16,S>>8,S,A>>24,A>>16,A>>8,A),15)}if(R instanceof ArrayBuffer){if((y=R.byteLength)<256)N.push(196,y),E=2;else if(y<65536)N.push(197,y>>8,y),E=3;else{if(!(y<4294967296))throw new Error("Buffer too large");N.push(198,y>>24,y>>16,y>>8,y),E=5}return q.push({_bin:R,_length:y,_offset:N.length}),E+y}if("function"===typeof R.toJSON)return v(N,q,R.toJSON());var b=[],f="",D=Object.keys(R);for(B=0,F=D.length;B<F;B++)void 0!==R[f=D[B]]&&"function"!==typeof R[f]&&b.push(f);if((y=b.length)<16)N.push(128|y),E=1;else if(y<65536)N.push(222,y>>8,y),E=3;else{if(!(y<4294967296))throw new Error("Object too large");N.push(223,y>>24,y>>16,y>>8,y),E=5}for(B=0;B<y;B++)E+=v(N,q,f=b[B]),E+=v(N,q,R[f]);return E}if("boolean"===z)return N.push(R?195:194),1;if("undefined"===z)return N.push(192),1;if("function"===typeof R.toJSON)return v(N,q,R.toJSON());throw new Error("Could not encode")}q.encode=function(N){var q=[],R=[],B=v(q,R,N),F=new ArrayBuffer(B),S=new DataView(F),A=0,y=0,E=-1;R.length>0&&(E=R[0]._offset);for(var t,x=0,e=0,b=0,f=q.length;b<f;b++)if(S.setUint8(y+b,q[b]),b+1===E){if(x=(t=R[A])._length,e=y+E,t._bin)for(var D=new Uint8Array(t._bin),V=0;V<x;V++)S.setUint8(e+V,D[V]);else t._str?z(S,e,t._str):void 0!==t._float&&S.setFloat64(e,t._float);y+=x,R[++A]&&(E=R[A]._offset)}return F}},10823:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.NoneSerializer=void 0;q.NoneSerializer=class{setState(N){}getState(){return null}patch(N){}teardown(){}handshake(N){}}},10821:(N,q,R)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.SchemaSerializer=void 0;const z=R(10802);q.SchemaSerializer=class{setState(N){return this.state.decode(N)}getState(){return this.state}patch(N){return this.state.decode(N)}teardown(){var N,q;null===(q=null===(N=this.state)||void 0===N?void 0:N.$changes)||void 0===q||q.root.clearRefs()}handshake(N,q){if(this.state){(new z.Reflection).decode(N,q)}else this.state=z.Reflection.decode(N,q)}}},10787:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.getSerializer=q.registerSerializer=void 0;const R={};q.registerSerializer=function(N,q){R[N]=q},q.getSerializer=function(N){const q=R[N];if(!q)throw new Error("missing serializer: "+N);return q}},10765:function(N,q,R){"use strict";var z=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(q,"__esModule",{value:!0}),q.WebSocketTransport=void 0;const v=z(R(10774)),B=globalThis.WebSocket||v.default;q.WebSocketTransport=class{constructor(N){this.events=N}send(N){N instanceof ArrayBuffer?this.ws.send(N):Array.isArray(N)&&this.ws.send(new Uint8Array(N).buffer)}connect(N){this.ws=new B(N,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(N,q){this.ws.close(N,q)}get isOpen(){return this.ws.readyState===B.OPEN}}},10774:N=>{"use strict";N.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12348:N=>{"use strict";function q(N,R,z){var v=0|N[z];if(v<=0)return[];var B,F=new Array(v);if(z===N.length-1)for(B=0;B<v;++B)F[B]=R;else for(B=0;B<v;++B)F[B]=q(N,R,z+1);return F}N.exports=function(N,R){switch("undefined"===typeof R&&(R=0),typeof N){case"number":if(N>0)return function(N,q){var R,z;for(R=new Array(N),z=0;z<N;++z)R[z]=q;return R}(0|N,R);break;case"object":if("number"===typeof N.length)return q(N,R,0)}return[]}},12304:(N,q,R)=>{N.exports=function(){var N=this;this.components={},this.comps=this.components;var q=this.components,R=1,v={},B=[],F=[],S={timeout:!1,removals:[],multiComps:[]};function A(N,R){var z=q[R],B=v[R],F=B.hash[N];F&&(B.remove(N),z.ab&&(z.multi?(F.forEach((q=>{q&&z.ab(N,q)})),F.length=0):z.ab(N,F)),S.removals.push(B),y())}function y(){S.timeout||(S.timeout=!0,setTimeout(E,1))}function E(){S.timeout=!1,t()}function t(){S.multiComps.length&&function(N){for(var q=0;q<N.length;q++){var{entID:R,data:z}=N[q],v=z.hash[R];if(v){for(var B=0;B<v.length;B++)v[B]||(v.splice(B,1),B--);0===v.length&&(z.remove(R),S.removals.push(z))}}N.length=0}(S.multiComps),S.removals.length&&function(N){for(var q=0;q<N.length;q++){N[q].flush()}N.length=0}(S.removals)}this.Ci=v,this._systems=B,this._renderSystems=F,this.eh=function(q){var z=R++;return Array.isArray(q)&&q.forEach((q=>N.rf(z,q))),z},this.deleteEntity=function(q){return Object.keys(v).forEach((N=>{v[N].hash[q]&&A(q,N)})),N},this.Hh=function(N){if(!N)throw new Error("Missing component definition");var R=N.name;if(!R)throw new Error("Component definition must have a name property.");if("string"!==typeof R)throw new Error("Component name must be a string.");if(""===R)throw new Error("Component name must be a non-empty string.");if(v[R])throw new Error(`Component ${R} already exists.`);var S={};return S.name=R,S.multi=!!N.multi,S.order=isNaN(N.order)?99:N.order,S.stateConstructor=N.stateConstructor||null,S.state=N.state||{},S.Zd=N.Zd||null,S.ab=N.ab||null,S.system=N.system||null,S.ge=N.ge||null,q[R]=S,v[R]=new z,v[R]._pendingMultiCleanup=!1,v[R]._multiCleanupIDs=S.multi?[]:null,S.system&&(B.push(R),B.sort(((N,R)=>q[N].order-q[R].order))),S.ge&&(F.push(R),F.sort(((N,R)=>q[N].order-q[R].order))),R},this.overwriteComponent=function(N,R){var z=q[N];if(!z)throw new Error(`Unknown component: ${N}`);if(!R)throw new Error("Missing component definition");if(z.name!==R.name)throw new Error("Overwriting component must use the same name property.");var S={};S.name=N,S.multi=!!R.multi,S.order=isNaN(R.order)?99:R.order,S.state=R.state||{},S.Zd=R.Zd||null,S.ab=R.ab||null,S.system=R.system||null,S.ge=R.ge||null,q[N]=S,v[N]._pendingMultiCleanup=!1,v[N]._multiCleanupIDs=S.multi?[]:null;var A=B.indexOf(N);S.system&&A<0&&B.push(N),!S.system&&A>=0&&B.splice(A,1),B.sort(((N,R)=>q[N].order-q[R].order));var y=F.indexOf(N);S.ge&&y<0&&F.push(N),!S.ge&&y>=0&&F.splice(y,1),F.sort(((N,R)=>q[N].order-q[R].order));var E=S.state;return this.Dg(N).forEach((N=>{for(var q in E)q in N||(N[q]=E[q]);S.Zd&&S.Zd(N.ee,N)})),N},this.deleteComponent=function(R){var z=v[R];if(!z)throw new Error(`Unknown component: ${R}`);z.flush(),z.list.forEach((N=>{N&&A(N.ee||N[0].ee,R)}));var S=B.indexOf(R),y=F.indexOf(R);return S>-1&&B.splice(S,1),y>-1&&F.splice(y,1),v[R].dispose(),delete v[R],delete q[R],N},this.rf=function(N,R,z){var B,F=q[R],S=v[R];if(!S)throw new Error(`Unknown component: ${R}.`);if(S.hash[N]&&!F.multi)throw new Error(`Entity ${N} already has component: ${R}.`);if(F.stateConstructor){if(!(B=new F.stateConstructor).hasOwnProperty("ee"))throw new Error(`Component ${F.name} stateConstructor type does not have property __id`)}else B=Object.assign({},{ee:N},F.state,z);if(B.ee=N,F.multi){var A=S.hash[N];A||(A=[],S.add(N,A)),A.push(B)}else S.add(N,B);return F.Zd&&F.Zd(N,B),this},this.Df=function(N,q){var R=v[q];if(!R)throw new Error(`Unknown component: ${q}.`);return!!R.hash[N]},this.vf=function(q,R){if(!v[R])throw new Error(`Unknown component: ${R}.`);return A(q,R),N},this.getState=function(N,q){var R=v[q];if(!R)throw new Error(`Unknown component: ${q}.`);return R.hash[N]},this.Dg=function(N){var q=v[N];if(!q)throw new Error(`Unknown component: ${N}.`);return t(),q.list},this.xk=function(N){if(!v[N])throw new Error(`Unknown component: ${N}.`);var q=v[N].hash;return N=>q[N]},this.Ak=function(N){if(!v[N])throw new Error(`Unknown component: ${N}.`);var q=v[N].hash;return N=>!!q[N]},this.Td=function(R){t();for(var z=0;z<B.length;z++){var F=B[z],S=q[F],A=v[F];S.system(R,A.list),t()}return N},this.render=function(R){t();for(var z=0;z<F.length;z++){var B=F[z],S=q[B],A=v[B];S.ge(R,A.list),t()}return N},this.removeMultiComponent=function(R,z,B){var F=q[z],A=v[z];if(!A)throw new Error(`Unknown component: ${z}.`);if(!F.multi)throw new Error("removeMultiComponent called on non-multi component");return function(N,q,R,z){var v=R.hash[N];if(v){var B=v[z];B&&(v[z]=null,q.ab&&q.ab(N,B),S.multiComps.push({entID:N,data:R}),y())}}(R,F,A,B),N}};var z=R(12313)},12313:N=>{function q(N,q){var R=N._map[q];if(delete N.hash[q],delete N._map[q],R===N.list.length-1)N.list.pop();else{var z=N.list.pop();if(N.list[R]=z,null===z||null===z[0]){var v=N.list.length;for(var B in N._map)if(N._map[B]===v)return void(N._map[B]=R)}else{var F=z.ee||z[0].ee;N._map[F]=R}}}N.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(N,q){if("number"===typeof this._map[N]){var R=this._map[N];this.hash[N]=q,this.list[R]=q}else this._map[N]=this.list.length,this.hash[N]=q,this.list.push(q)}remove(N){var q=this._map[N];this.hash[N]=null,this.list[q]=null,this._pendingRemovals.push(N)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var N=0;N<this._pendingRemovals.length;N++){var R=this._pendingRemovals[N];null===this.hash[R]&&q(this,R)}this._pendingRemovals.length=0}}},12588:N=>{"use strict";N.exports=function(N,q,R,z,v,B){var F=+q[0],S=+q[1],A=+q[2],y=+R[0],E=+R[1],t=+R[2],x=Math.sqrt(y*y+E*E+t*t);if(0===x)throw new Error("Can't raycast along a zero vector");return function(N,q,R,z,v,B,F,S,A,y){for(var E=0,t=Math.floor,x=0|t(q),e=0|t(R),b=0|t(z),f=v>0?1:-1,D=B>0?1:-1,V=F>0?1:-1,H=Math.abs(1/v),Y=Math.abs(1/B),T=Math.abs(1/F),L=H<1/0?H*(f>0?x+1-q:q-x):1/0,X=Y<1/0?Y*(D>0?e+1-R:R-e):1/0,Q=T<1/0?T*(V>0?b+1-z:z-b):1/0,h=-1;E<=S;){var u=N(x,e,b);if(u)return A&&(A[0]=q+E*v,A[1]=R+E*B,A[2]=z+E*F),y&&(y[0]=y[1]=y[2]=0,0===h&&(y[0]=-f),1===h&&(y[1]=-D),2===h&&(y[2]=-V)),u;L<X?L<Q?(x+=f,E=L,L+=H,h=0):(b+=V,E=Q,Q+=T,h=2):X<Q?(e+=D,E=X,X+=Y,h=1):(b+=V,E=Q,Q+=T,h=2)}return A&&(A[0]=q+E*v,A[1]=R+E*B,A[2]=z+E*F),y&&(y[0]=y[1]=y[2]=0),0}(N,F,S,A,y/=x,E/=x,t/=x,z="undefined"===typeof z?64:+z,v,B)}},12623:(N,q,R)=>{"use strict";R.d(q,{d:()=>B});var z=R(732);function v(){this.vj=!1,this.stopPropagation=!1,this.wj=!1,this.disabled=!1}class B{constructor(N,q){this.version="0.7.0";var R=Object.assign({},new v,q||{});this.element=N||document,this.vj=!!R.vj,this.stopPropagation=!!R.stopPropagation,this.wj=!!R.wj,this.disabled=!!R.disabled,this.filterEvents=(N,q)=>!0,this.down=new z.EventEmitter,this.up=new z.EventEmitter,this.state={},this.xg={dx:0,dy:0,nk:0,wg:0,pk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?S(this):document.addEventListener("DOMContentLoaded",(N=>{S(this)}),{once:!0})}bind(N){for(var q=arguments.length,R=new Array(q>1?q-1:0),z=1;z<q;z++)R[z-1]=arguments[z];R.forEach((q=>{var R=this._keyBindmap[q]||[];R.includes(N)||(R.push(N),this._keyBindmap[q]=R)})),this.state[N]=!!this.state[N],this.pressCount[N]=this.pressCount[N]||0,this.releaseCount[N]=this.releaseCount[N]||0}unbind(N){for(var q in this._keyBindmap){var R=this._keyBindmap[q],z=R.indexOf(N);z>-1&&R.splice(z,1)}}getBindings(){var N={};for(var q in this._keyBindmap){this._keyBindmap[q].forEach((R=>{N[R]=N[R]||[],N[R].push(q)}))}return N}Td(){F(this.xg),F(this.pressCount),F(this.releaseCount)}}function F(N){for(var q in N)N[q]=0}function S(N){window.addEventListener("keydown",b.bind(null,N,!0),!1),window.addEventListener("keyup",b.bind(null,N,!1),!1);var q={passive:!0};N.element.addEventListener("touchstart",t.bind(void 0,N),{passive:!1}),N.element.addEventListener("touchend",e.bind(void 0,N),q),N.element.addEventListener("mousedown",f.bind(null,N,!0),q),window.document.addEventListener("mouseup",f.bind(null,N,!1),q),N.element.addEventListener("touchmove",D.bind(null,N),q),N.element.addEventListener("mousemove",D.bind(null,N),q),window.PointerEvent,N.element.addEventListener("wheel",V.bind(null,N),q),N.element.addEventListener("contextmenu",H.bind(null,N),!1),window.addEventListener("blur",Y.bind(null,N),!1)}var A=0,y=0,E=null;function t(N,q){q.preventDefault(),x(q)}function x(N){let q=!1;for(let R=0;R<N.touches.length;++R)if(N.touches[R].identifier===E){q=!0;break}if(!q){const q=N.changedTouches[0];A=q.clientX,y=q.clientY,E=q.identifier}}function e(N,q){for(var R=q.changedTouches,z=0;z<R.length;++z)R[z].identifier===E&&(E=null)}function b(N,q,R){T(R.code,q,N,R)}function f(N,q,R){if("pointerId"in R)if(q){if(null!==N._touches.currID)return;N._touches.currID=R.pointerId}else{if(N._touches.currID!==R.pointerId)return;N._touches.currID=null}return T("Mouse"+("button"in R?R.button+1:1),q,N,R),!1}function D(N,q){var R=q.movementX||q.mozMovementX||0,z=q.movementY||q.mozMovementY||0;if(q.touches&&0===(R|z)){var v=function(N){x(N);for(let q=0;q<N.changedTouches.length;++q)if(N.changedTouches[q].identifier==E){const R=N.changedTouches[q],z=[R.clientX-A,R.clientY-y];return A=R.clientX,y=R.clientY,z}return console.error(`Did not find touch id ${E}`),[0,0]}(q);R=v[0],z=v[1]}N.xg.dx+=R,N.xg.dy+=z}function V(N,q){var R=1;switch(q.deltaMode){case 0:R=1;break;case 1:R=12;break;case 2:R=N.element.clientHeight||window.innerHeight}N.xg.nk+=(q.deltaX||0)*R,N.xg.wg+=(q.deltaY||0)*R,N.xg.pk+=(q.deltaZ||0)*R}function H(N,q){if(!N.wj)return q.preventDefault(),!1}function Y(N){for(var q in N._keyStates)N._keyStates[q]&&(/^Mouse\d/.test(q)||T(q,!1,N,{code:q,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function T(N,q,R,z){var v=R._keyBindmap[N];v&&(L(R._keyStates[N],q)&&(R._keyStates[N]=q,v.forEach((N=>{(!R.filterEvents||R.filterEvents(z,N))&&function(N,q,R,z){var v=q?R.pressCount:R.releaseCount;v[N]=(v[N]||0)+1;var B=R._bindPressCount[N]||0;(B+=q?1:-1)<0&&(B=0);R._bindPressCount[N]=B;var F=R.state[N];if(L(F,B)){R.state[N]=B>0;var S=q?R.down:R.up;R.disabled||S.emit(N,z)}}(N,q,R,z)}))),"button"in z||(R.vj&&!z.defaultPrevented&&z.preventDefault(),R.stopPropagation&&z.stopPropagation()))}function L(N,q){return N?!q:q}},10875:N=>{"use strict";N.exports=function(N){for(var q=new Array(N),R=0;R<N;++R)q[R]=R;return q}},10878:N=>{function q(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(q(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&q(N.slice(0,0))}(N)||!!N._isBuffer)}},12596:(N,q,R)=>{"use strict";R.d(q,{e:()=>z});class z{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this._h=!1,this.ai=!1,this.Zh=30,this.$h=0,this.ii=!1,this.fullscreen=!1,this.ci=function(N){},this.di=function(){},this.gi=function(){},this.bb=function(){},this.ei=function(N){},this.onFullscreenChanged=function(N){},y((()=>{!function(N,q){N._nowObject=performance||Date,N._lastTick=0,N._renderAccum=0,N._rt=0,N._frameCB=S.bind(null,N),requestAnimationFrame(N._frameCB),q>0&&(N._intervalCB=F.bind(null,N),N._interval=setInterval(N._intervalCB,Math.max(q,1e3/N.Zh/2)))}(this,q),function(N,q){if(!q)return;var R=!1,z=!1;document.addEventListener("pointerlockchange",(z=>{R=document.pointerLockElement===q,N.ei(R)})),document.addEventListener("fullscreenchange",(R=>{z=document.fullscreenElement===q,N.onFullscreenChanged(z)})),Object.defineProperty(N,"ii",{get:()=>R,set:N=>{N&&!R?A(q):R&&!N&&function(N){N.exitPointerLock&&N.exitPointerLock()}(document)}}),Object.defineProperty(N,"fullscreen",{get:()=>z,set:N=>{N&&!z?q.requestFullscreen():z&&!N&&document.exitFullscreen()}}),q.addEventListener("click",(v=>{N._h&&!R&&A(q),N.ai&&!z&&q.requestFullscreen()}));var v=()=>N.bb();if(window.ResizeObserver){new ResizeObserver(v).observe(q)}else window.addEventListener("resize",v)}(this,N),this.gi()}))}}var v=3,B=20;function F(N){for(var q=1e3/N.Zh,R=N._nowObject.now()+B,z=0;N._nowObject.now()>=N._lastTick+q&&N._nowObject.now()<R&&++z<=v;)N.ci(q),N._lastTick+=q;var F=5*(q+5),S=N._nowObject.now();if(S-N._lastTick>F)for(;S>=N._lastTick+q;)N._lastTick+=q}function S(N){requestAnimationFrame(N._frameCB),F(N);var q=N._nowObject.now(),R=q-N._rt;if(N._rt=q,N.$h>0){N._renderAccum+=R;var z=1e3/N.$h;if(N._renderAccum<z)return;N._renderAccum=Math.min(N._renderAccum-z,z)}var v=1e3/N.Zh,B=(q-N._lastTick)/v;N.di(R,B,v)}function A(N){N.requestPointerLock&&N.requestPointerLock()}var y=N=>{if("loading"===document.readyState){var q=()=>{document.removeEventListener("readystatechange",q),N()};document.addEventListener("readystatechange",q)}else setTimeout(N,1)}},10872:(N,q,R)=>{var z=R(10875),v=R(10878),B="undefined"!==typeof Float64Array;function F(N,q){return N[0]-q[0]}function S(){var N,q=this.stride,R=new Array(q.length);for(N=0;N<R.length;++N)R[N]=[Math.abs(q[N]),N];R.sort(F);var z=new Array(R.length);for(N=0;N<z.length;++N)z[N]=R[N][1];return z}function A(N,q){var R=["View",q,"d",N].join("");q<0&&(R="View_Nil"+N);var v="generic"===N;if(-1===q){var B="function "+R+"(a){this.data=a;};var proto="+R+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+R+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+R+"(a){return new "+R+"(a);}";return new Function(B)()}if(0===q){B="function "+R+"(a,d) {this.data = a;this.offset = d};var proto="+R+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+R+"_copy() {return new "+R+"(this.data,this.offset)};proto.pick=function "+R+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+R+"_get(){return "+(v?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+R+"_set(v){return "+(v?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+R+"(a,b,c,d){return new "+R+"(a,d)}";return new Function("TrivialArray",B)(y[N][0])}B=["'use strict'"];var F=z(q),A=F.map((function(N){return"i"+N})),E="this.offset+"+F.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),t=F.map((function(N){return"b"+N})).join(","),x=F.map((function(N){return"c"+N})).join(",");B.push("function "+R+"(a,"+t+","+x+",d){this.data=a","this.shape=["+t+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+R+".prototype","proto.dtype='"+N+"'","proto.dimension="+q),B.push("Object.defineProperty(proto,'size',{get:function "+R+"_size(){return "+F.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===q?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),q<4?(B.push("function "+R+"_order(){"),2===q?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===q&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+R+"_set("+A.join(",")+",v){"),v?B.push("return this.data.set("+E+",v)}"):B.push("return this.data["+E+"]=v}"),B.push("proto.get=function "+R+"_get("+A.join(",")+"){"),v?B.push("return this.data.get("+E+")}"):B.push("return this.data["+E+"]}"),B.push("proto.index=function "+R+"_index(",A.join(),"){return "+E+"}"),B.push("proto.hi=function "+R+"_hi("+A.join(",")+"){return new "+R+"(this.data,"+F.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+F.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var e=F.map((function(N){return"a"+N+"=this.shape["+N+"]"})),b=F.map((function(N){return"c"+N+"=this.stride["+N+"]"}));B.push("proto.lo=function "+R+"_lo("+A.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+b.join(","));for(var f=0;f<q;++f)B.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");B.push("return new "+R+"(this.data,"+F.map((function(N){return"a"+N})).join(",")+","+F.map((function(N){return"c"+N})).join(",")+",b)}"),B.push("proto.step=function "+R+"_step("+A.join(",")+"){var "+F.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+F.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<q;++f)B.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");B.push("return new "+R+"(this.data,"+F.map((function(N){return"a"+N})).join(",")+","+F.map((function(N){return"b"+N})).join(",")+",c)}");var D=new Array(q),V=new Array(q);for(f=0;f<q;++f)D[f]="a[i"+f+"]",V[f]="b[i"+f+"]";B.push("proto.transpose=function "+R+"_transpose("+A+"){"+A.map((function(N,q){return N+"=("+N+"===undefined?"+q+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+R+"(this.data,"+D.join(",")+","+V.join(",")+",this.offset)}"),B.push("proto.pick=function "+R+"_pick("+A+"){var a=[],b=[],c=this.offset");for(f=0;f<q;++f)B.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+R+"(data,shape,stride,offset){return new "+R+"(data,"+F.map((function(N){return"shape["+N+"]"})).join(",")+","+F.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(y[N],S)}var y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,q,R,z){if(void 0===N)return(0,y.array[0])([]);"number"===typeof N&&(N=[N]),void 0===q&&(q=[N.length]);var F=q.length;if(void 0===R){R=new Array(F);for(var S=F-1,E=1;S>=0;--S)R[S]=E,E*=q[S]}if(void 0===z){z=0;for(S=0;S<F;++S)R[S]<0&&(z-=(q[S]-1)*R[S])}for(var t=function(N){if(v(N))return"buffer";if(B)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),x=y[t];x.length<=F+1;)x.push(A(t,x.length-1));return(0,x[F+1])(N,q,R,z)}},10836:N=>{var q;self,q=()=>(()=>{"use strict";var N={d:(q,R)=>{for(var z in R)N.o(R,z)&&!N.o(q,z)&&Object.defineProperty(q,z,{enumerable:!0,get:R[z]})},o:(N,q)=>Object.prototype.hasOwnProperty.call(N,q)},q={};N.d(q,{default:()=>J});var R,z=function(N,q){var R=q.x-N.x,z=q.y-N.y;return Math.sqrt(R*R+z*z)},v=function(N){return N*(Math.PI/180)},B=new Map,F=function(N){B.has(N)&&clearTimeout(B.get(N)),B.set(N,setTimeout(N,100))},S=function(N,q,R){for(var z,v=q.split(/[ ,]+/g),B=0;B<v.length;B+=1)z=v[B],N.addEventListener?N.addEventListener(z,R,!1):N.attachEvent&&N.attachEvent(z,R)},A=function(N,q,R){for(var z,v=q.split(/[ ,]+/g),B=0;B<v.length;B+=1)z=v[B],N.removeEventListener?N.removeEventListener(z,R):N.detachEvent&&N.detachEvent(z,R)},y=function(N){return N.preventDefault(),N.type.match(/^touch/)?N.changedTouches:N},E=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},t=function(N,q){q.top||q.right||q.bottom||q.left?(N.style.top=q.top,N.style.right=q.right,N.style.bottom=q.bottom,N.style.left=q.left):(N.style.left=q.x+"px",N.style.top=q.y+"px")},x=function(N,q,R){var z=e(N);for(var v in z)if(z.hasOwnProperty(v))if("string"==typeof q)z[v]=q+" "+R;else{for(var B="",F=0,S=q.length;F<S;F+=1)B+=q[F]+" "+R+", ";z[v]=B.slice(0,-2)}return z},e=function(N){var q={};return q[N]="",["webkit","Moz","o"].forEach((function(R){q[R+N.charAt(0).toUpperCase()+N.slice(1)]=""})),q},b=function(N,q){for(var R in q)q.hasOwnProperty(R)&&(N[R]=q[R]);return N},f=function(N,q){if(N.length)for(var R=0,z=N.length;R<z;R+=1)q(N[R]);else q(N)},D="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,V=window.matchMedia("(any-hover: none)").matches,H=!!("ontouchstart"in window),Y=!!window.PointerEvent,T=!!window.MSPointerEvent,L={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},X={start:"mousedown",move:"mousemove",end:"mouseup"},Q={};function h(){}D&&!V?R=L:Y?R={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:T?R={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:H?(R=L,Q=X):R=X,h.prototype.on=function(N,q){var R,z=this,v=N.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var B=0;B<v.length;B+=1)R=v[B],z._handlers_[R]=z._handlers_[R]||[],z._handlers_[R].push(q);return z},h.prototype.off=function(N,q){var R=this;return R._handlers_=R._handlers_||{},void 0===N?R._handlers_={}:void 0===q?R._handlers_[N]=null:R._handlers_[N]&&R._handlers_[N].indexOf(q)>=0&&R._handlers_[N].splice(R._handlers_[N].indexOf(q),1),R},h.prototype.trigger=function(N,q){var R,z=this,v=N.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var B=0;B<v.length;B+=1)R=v[B],z._handlers_[R]&&z._handlers_[R].length&&z._handlers_[R].forEach((function(N){N.call(z,{type:R,target:z},q)}))},h.prototype.config=function(N){var q=this;q.options=q.defaults||{},N&&(q.options=function(N,q){var R={};for(var z in N)N.hasOwnProperty(z)&&q.hasOwnProperty(z)?R[z]=q[z]:N.hasOwnProperty(z)&&(R[z]=N[z]);return R}(q.options,N))},h.prototype.bindEvt=function(N,q){var z=this;return z._domHandlers_=z._domHandlers_||{},z._domHandlers_[q]=function(){"function"==typeof z["on"+q]?z["on"+q].apply(z,arguments):console.warn('[WARNING] : Missing "on'+q+'" handler.')},S(N,R[q],z._domHandlers_[q]),Q[q]&&S(N,Q[q],z._domHandlers_[q]),z},h.prototype.unbindEvt=function(N,q){var z=this;return z._domHandlers_=z._domHandlers_||{},A(N,R[q],z._domHandlers_[q]),Q[q]&&A(N,Q[q],z._domHandlers_[q]),delete z._domHandlers_[q],this};const u=h;function w(N,q){return this.identifier=q.identifier,this.position=q.position,this.frontPosition=q.frontPosition,this.collection=N,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(q),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=w.id,w.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}w.prototype=new u,w.constructor=w,w.id=0,w.prototype.buildEl=function(N){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},w.prototype.stylize=function(){if(this.options.dataOnly)return this;var N=this.options.fadeTime+"ms",q=function(){var N=e("borderRadius");for(var q in N)N.hasOwnProperty(q)&&(N[q]="50%");return N}(),R=x("transition","opacity",N),z={};return z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},b(z.el,R),"circle"===this.options.shape&&b(z.back,q),b(z.front,q),this.applyStyles(z),this},w.prototype.applyStyles=function(N){for(var q in this.ui)if(this.ui.hasOwnProperty(q))for(var R in N[q])this.ui[q].style[R]=N[q][R];return this},w.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},w.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},w.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},w.prototype.show=function(N){var q=this;return q.options.dataOnly||(clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.addToDom(),q.restCallback(),setTimeout((function(){q.ui.el.style.opacity=1}),0),q.showTimeout=setTimeout((function(){q.trigger("shown",q.instance),"function"==typeof N&&N.call(this)}),q.options.fadeTime)),q},w.prototype.hide=function(N){var q=this;if(q.options.dataOnly)return q;if(q.ui.el.style.opacity=q.options.restOpacity,clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.removeTimeout=setTimeout((function(){var R="dynamic"===q.options.mode?"none":"block";q.ui.el.style.display=R,"function"==typeof N&&N.call(q),q.trigger("hidden",q.instance)}),q.options.fadeTime),q.options.restJoystick){var R=q.options.restJoystick,z={};z.x=!0===R||!1!==R.x?0:q.instance.frontPosition.x,z.y=!0===R||!1!==R.y?0:q.instance.frontPosition.y,q.setPosition(N,z)}return q},w.prototype.setPosition=function(N,q){var R=this;R.frontPosition={x:q.x,y:q.y};var z=R.options.fadeTime+"ms",v={};v.front=x("transition",["transform"],z);var B={front:{}};B.front={transform:"translate("+R.frontPosition.x+"px,"+R.frontPosition.y+"px)"},R.applyStyles(v),R.applyStyles(B),R.restTimeout=setTimeout((function(){"function"==typeof N&&N.call(R),R.restCallback()}),R.options.fadeTime)},w.prototype.restCallback=function(){var N=this,q={};q.front=x("transition","none",""),N.applyStyles(q),N.trigger("rested",N.instance)},w.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},w.prototype.computeDirection=function(N){var q,R,z,v=N.angle.radian,B=Math.PI/4,F=Math.PI/2;if(v>B&&v<3*B&&!N.lockX?q="up":v>-B&&v<=B&&!N.lockY?q="left":v>3*-B&&v<=-B&&!N.lockX?q="down":N.lockY||(q="right"),N.lockY||(R=v>-F&&v<F?"left":"right"),N.lockX||(z=v>0?"up":"down"),N.force>this.options.threshold){var S,A={};for(S in this.direction)this.direction.hasOwnProperty(S)&&(A[S]=this.direction[S]);var y={};for(S in this.direction={x:R,y:z,angle:q},N.direction=this.direction,A)A[S]===this.direction[S]&&(y[S]=!0);if(y.x&&y.y&&y.angle)return N;y.x&&y.y||this.trigger("plain",N),y.x||this.trigger("plain:"+R,N),y.y||this.trigger("plain:"+z,N),y.angle||this.trigger("dir dir:"+q,N)}else this.resetDirection();return N};const c=w;function n(N,q){var R=this;R.nipples=[],R.idles=[],R.actives=[],R.ids=[],R.pressureIntervals={},R.manager=N,R.id=n.id,n.id+=1,R.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},R.config(q),"static"!==R.options.mode&&"semi"!==R.options.mode||(R.options.multitouch=!1),R.options.multitouch||(R.options.maxNumberOfNipples=1);var z=getComputedStyle(R.options.zone.parentElement);return z&&"flex"===z.display&&(R.parentIsFlex=!0),R.updateBox(),R.prepareNipples(),R.xj(),R.begin(),R.nipples}n.prototype=new u,n.constructor=n,n.id=0,n.prototype.prepareNipples=function(){var N=this,q=N.nipples;q.on=N.on.bind(N),q.off=N.off.bind(N),q.options=N.options,q.destroy=N.destroy.bind(N),q.ids=N.ids,q.id=N.id,q.processOnMove=N.processOnMove.bind(N),q.processOnEnd=N.processOnEnd.bind(N),q.get=function(N){if(void 0===N)return q[0];for(var R=0,z=q.length;R<z;R+=1)if(q[R].identifier===N)return q[R];return!1}},n.prototype.xj=function(){var N=this;N.bindEvt(N.options.zone,"start"),N.options.zone.style.touchAction="none",N.options.zone.style.msTouchAction="none"},n.prototype.begin=function(){var N=this,q=N.options;if("static"===q.mode){var R=N.createNipple(q.position,N.manager.getIdentifier());R.add(),N.idles.push(R)}},n.prototype.createNipple=function(N,q){var R=this,z=R.manager.scroll,v={},B=R.options,F=R.parentIsFlex?z.x:z.x+R.box.left,S=R.parentIsFlex?z.y:z.y+R.box.top;if(N.x&&N.y)v={x:N.x-F,y:N.y-S};else if(N.top||N.right||N.bottom||N.left){var A=document.createElement("DIV");A.style.display="hidden",A.style.top=N.top,A.style.right=N.right,A.style.bottom=N.bottom,A.style.left=N.left,A.style.position="absolute",B.zone.appendChild(A);var y=A.getBoundingClientRect();B.zone.removeChild(A),v=N,N={x:y.left+z.x,y:y.top+z.y}}var E=new c(R,{color:B.color,size:B.size,threshold:B.threshold,fadeTime:B.fadeTime,dataOnly:B.dataOnly,restJoystick:B.restJoystick,restOpacity:B.restOpacity,mode:B.mode,identifier:q,position:N,zone:B.zone,frontPosition:{x:0,y:0},shape:B.shape});return B.dataOnly||(t(E.ui.el,v),t(E.ui.front,E.frontPosition)),R.nipples.push(E),R.trigger("added "+E.identifier+":added",E),R.manager.trigger("added "+E.identifier+":added",E),R.bindNipple(E),E},n.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},n.prototype.bindNipple=function(N){var q,R=this,z=function(N,z){q=N.type+" "+z.id+":"+N.type,R.trigger(q,z)};N.on("destroyed",R.onDestroyed.bind(R)),N.on("shown hidden rested dir plain",z),N.on("dir:up dir:right dir:down dir:left",z),N.on("plain:up plain:right plain:down plain:left",z)},n.prototype.pressureFn=function(N,q,R){var z=this,v=0;clearInterval(z.pressureIntervals[R]),z.pressureIntervals[R]=setInterval(function(){var R=N.force||N.pressure||N.webkitForce||0;R!==v&&(q.trigger("pressure",R),z.trigger("pressure "+q.identifier+":pressure",R),v=R)}.bind(z),100)},n.prototype.onstart=function(N){var q=this,R=q.options,z=N;return N=y(N),q.updateBox(),f(N,(function(v){q.actives.length<R.maxNumberOfNipples?q.processOnStart(v):z.type.match(/^touch/)&&(Object.keys(q.manager.ids).forEach((function(R){if(Object.values(z.touches).findIndex((function(N){return N.identifier===R}))<0){var v=[N[0]];v.identifier=R,q.processOnEnd(v)}})),q.actives.length<R.maxNumberOfNipples&&q.processOnStart(v))})),q.manager.bindDocument(),!1},n.prototype.processOnStart=function(N){var q,R=this,v=R.options,B=R.manager.getIdentifier(N),F=N.force||N.pressure||N.webkitForce||0,S={x:N.pageX,y:N.pageY},A=R.getOrCreate(B,S);A.identifier!==B&&R.manager.removeIdentifier(A.identifier),A.identifier=B;var y=function(q){q.trigger("start",q),R.trigger("start "+q.id+":start",q),q.show(),F>0&&R.pressureFn(N,q,q.identifier),R.processOnMove(N)};if((q=R.idles.indexOf(A))>=0&&R.idles.splice(q,1),R.actives.push(A),R.ids.push(A.identifier),"semi"!==v.mode)y(A);else{if(!(z(S,A.position)<=v.catchDistance))return A.destroy(),void R.processOnStart(N);y(A)}return A},n.prototype.getOrCreate=function(N,q){var R,z=this,v=z.options;return/(semi|static)/.test(v.mode)?(R=z.idles[0])?(z.idles.splice(0,1),R):"semi"===v.mode?z.createNipple(q,N):(console.warn("Coudln't find the needed nipple."),!1):R=z.createNipple(q,N)},n.prototype.processOnMove=function(N){var q=this,R=q.options,B=q.manager.getIdentifier(N),F=q.nipples.get(B),S=q.manager.scroll;if(function(N){return isNaN(N.buttons)?0!==N.pressure:0!==N.buttons}(N)){if(!F)return console.error("Found zombie joystick with ID "+B),void q.manager.removeIdentifier(B);if(R.dynamicPage){var A=F.el.getBoundingClientRect();F.position={x:S.x+A.left,y:S.y+A.top}}F.identifier=B;var y=F.options.size/2,E={x:N.pageX,y:N.pageY};R.lockX&&(E.y=F.position.y),R.lockY&&(E.x=F.position.x);var t,x,e,b,f,D,V,H,Y,T,L=z(E,F.position),X=(t=E,e=(x=F.position).x-t.x,b=x.y-t.y,function(N){return N*(180/Math.PI)}(Math.atan2(b,e))),Q=v(X),h=L/y,u={distance:L,position:E};if("circle"===F.options.shape?(f=Math.min(L,y),V=F.position,H=f,T={x:0,y:0},Y=v(Y=X),T.x=V.x-H*Math.cos(Y),T.y=V.y-H*Math.sin(Y),D=T):(D=function(N,q,R){return{x:Math.min(Math.max(N.x,q.x-R),q.x+R),y:Math.min(Math.max(N.y,q.y-R),q.y+R)}}(E,F.position,y),f=z(D,F.position)),R.follow){if(L>y){var w=E.x-D.x,c=E.y-D.y;F.position.x+=w,F.position.y+=c,F.el.style.top=F.position.y-(q.box.top+S.y)+"px",F.el.style.left=F.position.x-(q.box.left+S.x)+"px",L=z(E,F.position)}}else E=D,L=f;var n=E.x-F.position.x,G=E.y-F.position.y;F.frontPosition={x:n,y:G},R.dataOnly||(F.ui.front.style.transform="translate("+n+"px,"+G+"px)");var s={identifier:F.identifier,position:E,force:h,pressure:N.force||N.pressure||N.webkitForce||0,distance:L,angle:{radian:Q,degree:X},vector:{x:n/y,y:-G/y},raw:u,instance:F,lockX:R.lockX,lockY:R.lockY};(s=F.computeDirection(s)).angle={radian:v(180-X),degree:180-X},F.trigger("move",s),q.trigger("move "+F.id+":move",s)}else this.processOnEnd(N)},n.prototype.processOnEnd=function(N){var q=this,R=q.options,z=q.manager.getIdentifier(N),v=q.nipples.get(z),B=q.manager.removeIdentifier(v.identifier);v&&(R.dataOnly||v.hide((function(){"dynamic"===R.mode&&(v.trigger("removed",v),q.trigger("removed "+v.id+":removed",v),q.manager.trigger("removed "+v.id+":removed",v),v.destroy())})),clearInterval(q.pressureIntervals[v.identifier]),v.resetDirection(),v.trigger("end",v),q.trigger("end "+v.id+":end",v),q.ids.indexOf(v.identifier)>=0&&q.ids.splice(q.ids.indexOf(v.identifier),1),q.actives.indexOf(v)>=0&&q.actives.splice(q.actives.indexOf(v),1),/(semi|static)/.test(R.mode)?q.idles.push(v):q.nipples.indexOf(v)>=0&&q.nipples.splice(q.nipples.indexOf(v),1),q.manager.unbindDocument(),/(semi|static)/.test(R.mode)&&(q.manager.ids[B.id]=B.identifier))},n.prototype.onDestroyed=function(N,q){var R=this;R.nipples.indexOf(q)>=0&&R.nipples.splice(R.nipples.indexOf(q),1),R.actives.indexOf(q)>=0&&R.actives.splice(R.actives.indexOf(q),1),R.idles.indexOf(q)>=0&&R.idles.splice(R.idles.indexOf(q),1),R.ids.indexOf(q.identifier)>=0&&R.ids.splice(R.ids.indexOf(q.identifier),1),R.manager.removeIdentifier(q.identifier),R.manager.unbindDocument()},n.prototype.destroy=function(){var N=this;for(var q in N.unbindEvt(N.options.zone,"start"),N.nipples.forEach((function(N){N.destroy()})),N.pressureIntervals)N.pressureIntervals.hasOwnProperty(q)&&clearInterval(N.pressureIntervals[q]);N.trigger("destroyed",N.nipples),N.manager.unbindDocument(),N.off()};const G=n;function s(N){var q=this;q.ids={},q.index=0,q.collections=[],q.scroll=E(),q.config(N),q.prepareCollections();var R=function(){var N;q.collections.forEach((function(R){R.forEach((function(R){N=R.el.getBoundingClientRect(),R.position={x:q.scroll.x+N.left,y:q.scroll.y+N.top}}))}))};S(window,"resize",(function(){F(R)}));var z=function(){q.scroll=E()};return S(window,"scroll",(function(){F(z)})),q.collections}s.prototype=new u,s.constructor=s,s.prototype.prepareCollections=function(){var N=this;N.collections.create=N.create.bind(N),N.collections.on=N.on.bind(N),N.collections.off=N.off.bind(N),N.collections.destroy=N.destroy.bind(N),N.collections.get=function(q){var R;return N.collections.every((function(N){return!(R=N.get(q))})),R}},s.prototype.create=function(N){return this.createCollection(N)},s.prototype.createCollection=function(N){var q=this,R=new G(q,N);return q.bindCollection(R),q.collections.push(R),R},s.prototype.bindCollection=function(N){var q,R=this,z=function(N,z){q=N.type+" "+z.id+":"+N.type,R.trigger(q,z)};N.on("destroyed",R.onDestroyed.bind(R)),N.on("shown hidden rested dir plain",z),N.on("dir:up dir:right dir:down dir:left",z),N.on("plain:up plain:right plain:down plain:left",z)},s.prototype.bindDocument=function(){var N=this;N.binded||(N.bindEvt(document,"move").bindEvt(document,"end"),N.binded=!0)},s.prototype.unbindDocument=function(N){var q=this;Object.keys(q.ids).length&&!0!==N||(q.unbindEvt(document,"move").unbindEvt(document,"end"),q.binded=!1)},s.prototype.getIdentifier=function(N){var q;return N?void 0===(q=void 0===N.identifier?N.pointerId:N.identifier)&&(q=this.latest||0):q=this.index,void 0===this.ids[q]&&(this.ids[q]=this.index,this.index+=1),this.latest=q,this.ids[q]},s.prototype.removeIdentifier=function(N){var q={};for(var R in this.ids)if(this.ids[R]===N){q.id=R,q.identifier=this.ids[R],delete this.ids[R];break}return q},s.prototype.onmove=function(N){return this.onAny("move",N),!1},s.prototype.onend=function(N){return this.onAny("end",N),!1},s.prototype.oncancel=function(N){return this.onAny("end",N),!1},s.prototype.onAny=function(N,q){var R,z=this,v="processOn"+N.charAt(0).toUpperCase()+N.slice(1);q=y(q);var B=function(N,q,R){R.ids.indexOf(q)>=0&&(R[v](N),N._found_=!0)};return f(q,(function(N){R=z.getIdentifier(N),f(z.collections,B.bind(null,N,R)),N._found_||z.removeIdentifier(R)})),!1},s.prototype.destroy=function(){var N=this;N.unbindDocument(!0),N.ids={},N.index=0,N.collections.forEach((function(N){N.destroy()})),N.off()},s.prototype.onDestroyed=function(N,q){var R=this;if(R.collections.indexOf(q)<0)return!1;R.collections.splice(R.collections.indexOf(q),1)};var Z=new s;const J={create:function(N){return Z.create(N)},factory:Z};return q.default})(),N.exports=q()},11027:(N,q,R)=>{"use strict";const{Deflate:z,deflate:v,deflateRaw:B,gzip:F}=R(11034),{Inflate:S,inflate:A,inflateRaw:y,ungzip:E}=R(11085),t=R(11067);N.exports.Deflate=z,N.exports.deflate=v,N.exports.deflateRaw=B,N.exports.gzip=F,N.exports.Inflate=S,N.exports.inflate=A,N.exports.inflateRaw=y,N.exports.ungzip=E,N.exports.constants=t},11034:(N,q,R)=>{"use strict";const z=R(11042),v=R(11069),B=R(11078),F=R(11064),S=R(11082),A=Object.prototype.toString,{Z_NO_FLUSH:y,Z_SYNC_FLUSH:E,Z_FULL_FLUSH:t,Z_FINISH:x,Z_OK:e,Z_STREAM_END:b,Z_DEFAULT_COMPRESSION:f,Z_DEFAULT_STRATEGY:D,Z_DEFLATED:V}=R(11067);function H(N){this.options=v.assign({level:f,method:V,Ja:16384,windowBits:15,memLevel:8,strategy:D},N||{});let q=this.options;q.raw&&q.windowBits>0?q.windowBits=-q.windowBits:q.gzip&&q.windowBits>0&&q.windowBits<16&&(q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let R=z.deflateInit2(this.strm,q.level,q.method,q.windowBits,q.memLevel,q.strategy);if(R!==e)throw new Error(F[R]);if(q.header&&z.deflateSetHeader(this.strm,q.header),q.dictionary){let N;if(N="string"===typeof q.dictionary?B.string2buf(q.dictionary):"[object ArrayBuffer]"===A.call(q.dictionary)?new Uint8Array(q.dictionary):q.dictionary,R=z.deflateSetDictionary(this.strm,N),R!==e)throw new Error(F[R]);this._dict_set=!0}}function Y(N,q){const R=new H(q);if(R.push(N,!0),R.err)throw R.msg||F[R.err];return R.result}H.prototype.push=function(N,q){const R=this.strm,v=this.options.Ja;let F,S;if(this.ended)return!1;for(S=q===~~q?q:!0===q?x:y,"string"===typeof N?R.input=B.string2buf(N):"[object ArrayBuffer]"===A.call(N)?R.input=new Uint8Array(N):R.input=N,R.next_in=0,R.avail_in=R.input.length;;)if(0===R.avail_out&&(R.output=new Uint8Array(v),R.next_out=0,R.avail_out=v),(S===E||S===t)&&R.avail_out<=6)this.onData(R.output.subarray(0,R.next_out)),R.avail_out=0;else{if(F=z.deflate(R,S),F===b)return R.next_out>0&&this.onData(R.output.subarray(0,R.next_out)),F=z.deflateEnd(this.strm),this.onEnd(F),this.ended=!0,F===e;if(0!==R.avail_out){if(S>0&&R.next_out>0)this.onData(R.output.subarray(0,R.next_out)),R.avail_out=0;else if(0===R.avail_in)break}else this.onData(R.output)}return!0},H.prototype.onData=function(N){this.chunks.push(N)},H.prototype.onEnd=function(N){N===e&&(this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},N.exports.Deflate=H,N.exports.deflate=Y,N.exports.deflateRaw=function(N,q){return(q=q||{}).raw=!0,Y(N,q)},N.exports.gzip=function(N,q){return(q=q||{}).gzip=!0,Y(N,q)},N.exports.constants=R(11067)},11085:(N,q,R)=>{"use strict";const z=R(11092),v=R(11069),B=R(11078),F=R(11064),S=R(11082),A=R(11116),y=Object.prototype.toString,{Z_NO_FLUSH:E,Z_FINISH:t,Z_OK:x,Z_STREAM_END:e,Z_NEED_DICT:b,Z_STREAM_ERROR:f,Z_DATA_ERROR:D,Z_MEM_ERROR:V}=R(11067);function H(N){this.options=v.assign({Ja:65536,windowBits:15,to:""},N||{});const q=this.options;q.raw&&q.windowBits>=0&&q.windowBits<16&&(q.windowBits=-q.windowBits,0===q.windowBits&&(q.windowBits=-15)),!(q.windowBits>=0&&q.windowBits<16)||N&&N.windowBits||(q.windowBits+=32),q.windowBits>15&&q.windowBits<48&&0===(15&q.windowBits)&&(q.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let R=z.inflateInit2(this.strm,q.windowBits);if(R!==x)throw new Error(F[R]);if(this.header=new A,z.inflateGetHeader(this.strm,this.header),q.dictionary&&("string"===typeof q.dictionary?q.dictionary=B.string2buf(q.dictionary):"[object ArrayBuffer]"===y.call(q.dictionary)&&(q.dictionary=new Uint8Array(q.dictionary)),q.raw&&(R=z.inflateSetDictionary(this.strm,q.dictionary),R!==x)))throw new Error(F[R])}function Y(N,q){const R=new H(q);if(R.push(N),R.err)throw R.msg||F[R.err];return R.result}H.prototype.push=function(N,q){const R=this.strm,v=this.options.Ja,F=this.options.dictionary;let S,A,H;if(this.ended)return!1;for(A=q===~~q?q:!0===q?t:E,"[object ArrayBuffer]"===y.call(N)?R.input=new Uint8Array(N):R.input=N,R.next_in=0,R.avail_in=R.input.length;;){for(0===R.avail_out&&(R.output=new Uint8Array(v),R.next_out=0,R.avail_out=v),S=z.inflate(R,A),S===b&&F&&(S=z.inflateSetDictionary(R,F),S===x?S=z.inflate(R,A):S===D&&(S=b));R.avail_in>0&&S===e&&R.state.wrap>0&&0!==N[R.next_in];)z.inflateReset(R),S=z.inflate(R,A);switch(S){case f:case D:case b:case V:return this.onEnd(S),this.ended=!0,!1}if(H=R.avail_out,R.next_out&&(0===R.avail_out||S===e))if("string"===this.options.to){let N=B.utf8border(R.output,R.next_out),q=R.next_out-N,z=B.buf2string(R.output,N);R.next_out=q,R.avail_out=v-q,q&&R.output.set(R.output.subarray(N,N+q),0),this.onData(z)}else this.onData(R.output.length===R.next_out?R.output:R.output.subarray(0,R.next_out));if(S!==x||0!==H){if(S===e)return S=z.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,!0;if(0===R.avail_in)break}}return!0},H.prototype.onData=function(N){this.chunks.push(N)},H.prototype.onEnd=function(N){N===x&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},N.exports.Inflate=H,N.exports.inflate=Y,N.exports.inflateRaw=function(N,q){return(q=q||{}).raw=!0,Y(N,q)},N.exports.ungzip=Y,N.exports.constants=R(11067)},11069:N=>{"use strict";const q=(N,q)=>Object.prototype.hasOwnProperty.call(N,q);N.exports.assign=function(N){const R=Array.prototype.slice.call(arguments,1);for(;R.length;){const z=R.shift();if(z){if("object"!==typeof z)throw new TypeError(z+"must be non-object");for(const R in z)q(z,R)&&(N[R]=z[R])}}return N},N.exports.flattenChunks=N=>{let q=0;for(let z=0,v=N.length;z<v;z++)q+=N[z].length;const R=new Uint8Array(q);for(let z=0,v=0,B=N.length;z<B;z++){let q=N[z];R.set(q,v),v+=q.length}return R}},11078:N=>{"use strict";let q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(z){q=!1}const R=new Uint8Array(256);for(let v=0;v<256;v++)R[v]=v>=252?6:v>=248?5:v>=240?4:v>=224?3:v>=192?2:1;R[254]=R[254]=1,N.exports.string2buf=N=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(N);let q,R,z,v,B,F=N.length,S=0;for(v=0;v<F;v++)R=N.charCodeAt(v),55296===(64512&R)&&v+1<F&&(z=N.charCodeAt(v+1),56320===(64512&z)&&(R=65536+(R-55296<<10)+(z-56320),v++)),S+=R<128?1:R<2048?2:R<65536?3:4;for(q=new Uint8Array(S),B=0,v=0;B<S;v++)R=N.charCodeAt(v),55296===(64512&R)&&v+1<F&&(z=N.charCodeAt(v+1),56320===(64512&z)&&(R=65536+(R-55296<<10)+(z-56320),v++)),R<128?q[B++]=R:R<2048?(q[B++]=192|R>>>6,q[B++]=128|63&R):R<65536?(q[B++]=224|R>>>12,q[B++]=128|R>>>6&63,q[B++]=128|63&R):(q[B++]=240|R>>>18,q[B++]=128|R>>>12&63,q[B++]=128|R>>>6&63,q[B++]=128|63&R);return q};N.exports.buf2string=(N,z)=>{const v=z||N.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(N.subarray(0,z));let B,F;const S=new Array(2*v);for(F=0,B=0;B<v;){let q=N[B++];if(q<128){S[F++]=q;continue}let z=R[q];if(z>4)S[F++]=65533,B+=z-1;else{for(q&=2===z?31:3===z?15:7;z>1&&B<v;)q=q<<6|63&N[B++],z--;z>1?S[F++]=65533:q<65536?S[F++]=q:(q-=65536,S[F++]=55296|q>>10&1023,S[F++]=56320|1023&q)}}return((N,R)=>{if(R<65534&&N.subarray&&q)return String.fromCharCode.apply(null,N.length===R?N:N.subarray(0,R));let z="";for(let q=0;q<R;q++)z+=String.fromCharCode(N[q]);return z})(S,F)},N.exports.utf8border=(N,q)=>{(q=q||N.length)>N.length&&(q=N.length);let z=q-1;for(;z>=0&&128===(192&N[z]);)z--;return z<0||0===z?q:z+R[N[z]]>q?z:q}},11053:N=>{"use strict";N.exports=(N,q,R,z)=>{let v=65535&N,B=N>>>16&65535,F=0;for(;0!==R;){F=R>2e3?2e3:R,R-=F;do{v=v+q[z++]|0,B=B+v|0}while(--F);v%=65521,B%=65521}return v|B<<16}},11067:N=>{"use strict";N.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11057:N=>{"use strict";const q=new Uint32Array((()=>{let N,q=[];for(var R=0;R<256;R++){N=R;for(var z=0;z<8;z++)N=1&N?3988292384^N>>>1:N>>>1;q[R]=N}return q})());N.exports=(N,R,z,v)=>{const B=q,F=v+z;N^=-1;for(let q=v;q<F;q++)N=N>>>8^B[255&(N^R[q])];return~N}},11042:(N,q,R)=>{"use strict";const{_tr_init:z,_tr_stored_block:v,_tr_flush_block:B,_tr_tally:F,_tr_align:S}=R(11045),A=R(11053),y=R(11057),E=R(11064),{Z_NO_FLUSH:t,Z_PARTIAL_FLUSH:x,Z_FULL_FLUSH:e,Z_FINISH:b,Z_BLOCK:f,Z_OK:D,Z_STREAM_END:V,Z_STREAM_ERROR:H,Z_DATA_ERROR:Y,Z_BUF_ERROR:T,Z_DEFAULT_COMPRESSION:L,Z_FILTERED:X,Z_HUFFMAN_ONLY:Q,Z_RLE:h,Z_FIXED:u,Z_DEFAULT_STRATEGY:w,Z_UNKNOWN:c,Z_DEFLATED:n}=R(11067),G=258,s=262,Z=103,J=113,M=666,m=(N,q)=>(N.msg=E[q],q),g=N=>(N<<1)-(N>4?9:0),j=N=>{let q=N.length;for(;--q>=0;)N[q]=0};let l=(N,q,R)=>(q<<N.hash_shift^R)&N.hash_mask;const I=N=>{const q=N.state;let R=q.pending;R>N.avail_out&&(R=N.avail_out),0!==R&&(N.output.set(q.pending_buf.subarray(q.pending_out,q.pending_out+R),N.next_out),N.next_out+=R,q.pending_out+=R,N.total_out+=R,N.avail_out-=R,q.pending-=R,0===q.pending&&(q.pending_out=0))},U=(N,q)=>{B(N,N.block_start>=0?N.block_start:-1,N.strstart-N.block_start,q),N.block_start=N.strstart,I(N.strm)},O=(N,q)=>{N.pending_buf[N.pending++]=q},i=(N,q)=>{N.pending_buf[N.pending++]=q>>>8&255,N.pending_buf[N.pending++]=255&q},P=(N,q,R,z)=>{let v=N.avail_in;return v>z&&(v=z),0===v?0:(N.avail_in-=v,q.set(N.input.subarray(N.next_in,N.next_in+v),R),1===N.state.wrap?N.adler=A(N.adler,q,v,R):2===N.state.wrap&&(N.adler=y(N.adler,q,v,R)),N.next_in+=v,N.total_in+=v,v)},k=(N,q)=>{let R,z,v=N.max_chain_length,B=N.strstart,F=N.prev_length,S=N.nice_match;const A=N.strstart>N.w_size-s?N.strstart-(N.w_size-s):0,y=N.window,E=N.w_mask,t=N.prev,x=N.strstart+G;let e=y[B+F-1],b=y[B+F];N.prev_length>=N.good_match&&(v>>=2),S>N.lookahead&&(S=N.lookahead);do{if(R=q,y[R+F]===b&&y[R+F-1]===e&&y[R]===y[B]&&y[++R]===y[B+1]){B+=2,R++;do{}while(y[++B]===y[++R]&&y[++B]===y[++R]&&y[++B]===y[++R]&&y[++B]===y[++R]&&y[++B]===y[++R]&&y[++B]===y[++R]&&y[++B]===y[++R]&&y[++B]===y[++R]&&B<x);if(z=G-(x-B),B=x-G,z>F){if(N.match_start=q,F=z,z>=S)break;e=y[B+F-1],b=y[B+F]}}}while((q=t[q&E])>A&&0!==--v);return F<=N.lookahead?F:N.lookahead},o=N=>{const q=N.w_size;let R,z,v,B,F;do{if(B=N.window_size-N.lookahead-N.strstart,N.strstart>=q+(q-s)){N.window.set(N.window.subarray(q,q+q),0),N.match_start-=q,N.strstart-=q,N.block_start-=q,z=N.hash_size,R=z;do{v=N.head[--R],N.head[R]=v>=q?v-q:0}while(--z);z=q,R=z;do{v=N.prev[--R],N.prev[R]=v>=q?v-q:0}while(--z);B+=q}if(0===N.strm.avail_in)break;if(z=P(N.strm,N.window,N.strstart+N.lookahead,B),N.lookahead+=z,N.lookahead+N.insert>=3)for(F=N.strstart-N.insert,N.ins_h=N.window[F],N.ins_h=l(N,N.ins_h,N.window[F+1]);N.insert&&(N.ins_h=l(N,N.ins_h,N.window[F+3-1]),N.prev[F&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=F,F++,N.insert--,!(N.lookahead+N.insert<3)););}while(N.lookahead<s&&0!==N.strm.avail_in)},C=(N,q)=>{let R,z;for(;;){if(N.lookahead<s){if(o(N),N.lookahead<s&&q===t)return 1;if(0===N.lookahead)break}if(R=0,N.lookahead>=3&&(N.ins_h=l(N,N.ins_h,N.window[N.strstart+3-1]),R=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),0!==R&&N.strstart-R<=N.w_size-s&&(N.match_length=k(N,R)),N.match_length>=3)if(z=F(N,N.strstart-N.match_start,N.match_length-3),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=3){N.match_length--;do{N.strstart++,N.ins_h=l(N,N.ins_h,N.window[N.strstart+3-1]),R=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart}while(0!==--N.match_length);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=l(N,N.ins_h,N.window[N.strstart+1]);else z=F(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(z&&(U(N,!1),0===N.strm.avail_out))return 1}return N.insert=N.strstart<2?N.strstart:2,q===b?(U(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(U(N,!1),0===N.strm.avail_out)?1:2},K=(N,q)=>{let R,z,v;for(;;){if(N.lookahead<s){if(o(N),N.lookahead<s&&q===t)return 1;if(0===N.lookahead)break}if(R=0,N.lookahead>=3&&(N.ins_h=l(N,N.ins_h,N.window[N.strstart+3-1]),R=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=2,0!==R&&N.prev_length<N.max_lazy_match&&N.strstart-R<=N.w_size-s&&(N.match_length=k(N,R),N.match_length<=5&&(N.strategy===X||3===N.match_length&&N.strstart-N.match_start>4096)&&(N.match_length=2)),N.prev_length>=3&&N.match_length<=N.prev_length){v=N.strstart+N.lookahead-3,z=F(N,N.strstart-1-N.prev_match,N.prev_length-3),N.lookahead-=N.prev_length-1,N.prev_length-=2;do{++N.strstart<=v&&(N.ins_h=l(N,N.ins_h,N.window[N.strstart+3-1]),R=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart)}while(0!==--N.prev_length);if(N.match_available=0,N.match_length=2,N.strstart++,z&&(U(N,!1),0===N.strm.avail_out))return 1}else if(N.match_available){if(z=F(N,0,N.window[N.strstart-1]),z&&U(N,!1),N.strstart++,N.lookahead--,0===N.strm.avail_out)return 1}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(z=F(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<2?N.strstart:2,q===b?(U(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(U(N,!1),0===N.strm.avail_out)?1:2};function r(N,q,R,z,v){this.good_length=N,this.max_lazy=q,this.nice_length=R,this.max_chain=z,this.func=v}const a=[new r(0,0,0,0,((N,q)=>{let R=65535;for(R>N.pending_buf_size-5&&(R=N.pending_buf_size-5);;){if(N.lookahead<=1){if(o(N),0===N.lookahead&&q===t)return 1;if(0===N.lookahead)break}N.strstart+=N.lookahead,N.lookahead=0;const z=N.block_start+R;if((0===N.strstart||N.strstart>=z)&&(N.lookahead=N.strstart-z,N.strstart=z,U(N,!1),0===N.strm.avail_out))return 1;if(N.strstart-N.block_start>=N.w_size-s&&(U(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,q===b?(U(N,!0),0===N.strm.avail_out?3:4):(N.strstart>N.block_start&&(U(N,!1),N.strm.avail_out),1)})),new r(4,4,8,4,C),new r(4,5,16,8,C),new r(4,6,32,32,C),new r(4,4,16,16,K),new r(8,16,32,32,K),new r(8,16,128,128,K),new r(8,32,128,256,K),new r(32,128,258,1024,K),new r(32,258,258,4096,K)];function d(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=n,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),j(this.dyn_ltree),j(this.dyn_dtree),j(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),j(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),j(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const p=N=>{if(!N||!N.state)return m(N,H);N.total_in=N.total_out=0,N.data_type=c;const q=N.state;return q.pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?42:J,N.adler=2===q.wrap?0:1,q.last_flush=t,z(q),D},W=N=>{const q=p(N);var R;return q===D&&((R=N.state).window_size=2*R.w_size,j(R.head),R.max_lazy_match=a[R.level].max_lazy,R.good_match=a[R.level].good_length,R.nice_match=a[R.level].nice_length,R.max_chain_length=a[R.level].max_chain,R.strstart=0,R.block_start=0,R.lookahead=0,R.insert=0,R.match_length=R.prev_length=2,R.match_available=0,R.ins_h=0),q},NN=(N,q,R,z,v,B)=>{if(!N)return H;let F=1;if(q===L&&(q=6),z<0?(F=0,z=-z):z>15&&(F=2,z-=16),v<1||v>9||R!==n||z<8||z>15||q<0||q>9||B<0||B>u)return m(N,H);8===z&&(z=9);const S=new d;return N.state=S,S.strm=N,S.wrap=F,S.gzhead=null,S.w_bits=z,S.w_size=1<<S.w_bits,S.w_mask=S.w_size-1,S.hash_bits=v+7,S.hash_size=1<<S.hash_bits,S.hash_mask=S.hash_size-1,S.hash_shift=~~((S.hash_bits+3-1)/3),S.window=new Uint8Array(2*S.w_size),S.head=new Uint16Array(S.hash_size),S.prev=new Uint16Array(S.w_size),S.lit_bufsize=1<<v+6,S.pending_buf_size=4*S.lit_bufsize,S.pending_buf=new Uint8Array(S.pending_buf_size),S.d_buf=1*S.lit_bufsize,S.l_buf=3*S.lit_bufsize,S.level=q,S.strategy=B,S.method=R,W(N)};N.exports.deflateInit=(N,q)=>NN(N,q,n,15,8,w),N.exports.deflateInit2=NN,N.exports.deflateReset=W,N.exports.deflateResetKeep=p,N.exports.deflateSetHeader=(N,q)=>N&&N.state?2!==N.state.wrap?H:(N.state.gzhead=q,D):H,N.exports.deflate=(N,q)=>{let R,z;if(!N||!N.state||q>f||q<0)return N?m(N,H):H;const B=N.state;if(!N.output||!N.input&&0!==N.avail_in||B.status===M&&q!==b)return m(N,0===N.avail_out?T:H);B.strm=N;const A=B.last_flush;if(B.last_flush=q,42===B.status)if(2===B.wrap)N.adler=0,O(B,31),O(B,139),O(B,8),B.gzhead?(O(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),O(B,255&B.gzhead.time),O(B,B.gzhead.time>>8&255),O(B,B.gzhead.time>>16&255),O(B,B.gzhead.time>>24&255),O(B,9===B.level?2:B.strategy>=Q||B.level<2?4:0),O(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(O(B,255&B.gzhead.extra.length),O(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(N.adler=y(N.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(O(B,0),O(B,0),O(B,0),O(B,0),O(B,0),O(B,9===B.level?2:B.strategy>=Q||B.level<2?4:0),O(B,3),B.status=J);else{let q=n+(B.w_bits-8<<4)<<8,R=-1;R=B.strategy>=Q||B.level<2?0:B.level<6?1:6===B.level?2:3,q|=R<<6,0!==B.strstart&&(q|=32),q+=31-q%31,B.status=J,i(B,q),0!==B.strstart&&(i(B,N.adler>>>16),i(B,65535&N.adler)),N.adler=1}if(69===B.status)if(B.gzhead.extra){for(R=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>R&&(N.adler=y(N.adler,B.pending_buf,B.pending-R,R)),I(N),R=B.pending,B.pending!==B.pending_buf_size));)O(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>R&&(N.adler=y(N.adler,B.pending_buf,B.pending-R,R)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(73===B.status)if(B.gzhead.name){R=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>R&&(N.adler=y(N.adler,B.pending_buf,B.pending-R,R)),I(N),R=B.pending,B.pending===B.pending_buf_size)){z=1;break}z=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,O(B,z)}while(0!==z);B.gzhead.hcrc&&B.pending>R&&(N.adler=y(N.adler,B.pending_buf,B.pending-R,R)),0===z&&(B.gzindex=0,B.status=91)}else B.status=91;if(91===B.status)if(B.gzhead.comment){R=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>R&&(N.adler=y(N.adler,B.pending_buf,B.pending-R,R)),I(N),R=B.pending,B.pending===B.pending_buf_size)){z=1;break}z=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,O(B,z)}while(0!==z);B.gzhead.hcrc&&B.pending>R&&(N.adler=y(N.adler,B.pending_buf,B.pending-R,R)),0===z&&(B.status=Z)}else B.status=Z;if(B.status===Z&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&I(N),B.pending+2<=B.pending_buf_size&&(O(B,255&N.adler),O(B,N.adler>>8&255),N.adler=0,B.status=J)):B.status=J),0!==B.pending){if(I(N),0===N.avail_out)return B.last_flush=-1,D}else if(0===N.avail_in&&g(q)<=g(A)&&q!==b)return m(N,T);if(B.status===M&&0!==N.avail_in)return m(N,T);if(0!==N.avail_in||0!==B.lookahead||q!==t&&B.status!==M){let R=B.strategy===Q?((N,q)=>{let R;for(;;){if(0===N.lookahead&&(o(N),0===N.lookahead)){if(q===t)return 1;break}if(N.match_length=0,R=F(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,R&&(U(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,q===b?(U(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(U(N,!1),0===N.strm.avail_out)?1:2})(B,q):B.strategy===h?((N,q)=>{let R,z,v,B;const S=N.window;for(;;){if(N.lookahead<=G){if(o(N),N.lookahead<=G&&q===t)return 1;if(0===N.lookahead)break}if(N.match_length=0,N.lookahead>=3&&N.strstart>0&&(v=N.strstart-1,z=S[v],z===S[++v]&&z===S[++v]&&z===S[++v])){B=N.strstart+G;do{}while(z===S[++v]&&z===S[++v]&&z===S[++v]&&z===S[++v]&&z===S[++v]&&z===S[++v]&&z===S[++v]&&z===S[++v]&&v<B);N.match_length=G-(B-v),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=3?(R=F(N,1,N.match_length-3),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(R=F(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),R&&(U(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,q===b?(U(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(U(N,!1),0===N.strm.avail_out)?1:2})(B,q):a[B.level].func(B,q);if(3!==R&&4!==R||(B.status=M),1===R||3===R)return 0===N.avail_out&&(B.last_flush=-1),D;if(2===R&&(q===x?S(B):q!==f&&(v(B,0,0,!1),q===e&&(j(B.head),0===B.lookahead&&(B.strstart=0,B.block_start=0,B.insert=0))),I(N),0===N.avail_out))return B.last_flush=-1,D}return q!==b?D:B.wrap<=0?V:(2===B.wrap?(O(B,255&N.adler),O(B,N.adler>>8&255),O(B,N.adler>>16&255),O(B,N.adler>>24&255),O(B,255&N.total_in),O(B,N.total_in>>8&255),O(B,N.total_in>>16&255),O(B,N.total_in>>24&255)):(i(B,N.adler>>>16),i(B,65535&N.adler)),I(N),B.wrap>0&&(B.wrap=-B.wrap),0!==B.pending?D:V)},N.exports.deflateEnd=N=>{if(!N||!N.state)return H;const q=N.state.status;return 42!==q&&69!==q&&73!==q&&91!==q&&q!==Z&&q!==J&&q!==M?m(N,H):(N.state=null,q===J?m(N,Y):D)},N.exports.deflateSetDictionary=(N,q)=>{let R=q.length;if(!N||!N.state)return H;const z=N.state,v=z.wrap;if(2===v||1===v&&42!==z.status||z.lookahead)return H;if(1===v&&(N.adler=A(N.adler,q,R,0)),z.wrap=0,R>=z.w_size){0===v&&(j(z.head),z.strstart=0,z.block_start=0,z.insert=0);let N=new Uint8Array(z.w_size);N.set(q.subarray(R-z.w_size,R),0),q=N,R=z.w_size}const B=N.avail_in,F=N.next_in,S=N.input;for(N.avail_in=R,N.next_in=0,N.input=q,o(z);z.lookahead>=3;){let N=z.strstart,q=z.lookahead-2;do{z.ins_h=l(z,z.ins_h,z.window[N+3-1]),z.prev[N&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=N,N++}while(--q);z.strstart=N,z.lookahead=2,o(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=2,z.match_available=0,N.next_in=F,N.input=S,N.avail_in=B,z.wrap=v,D},N.exports.deflateInfo="pako deflate (from Nodeca project)"},11116:N=>{"use strict";N.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11099:N=>{"use strict";N.exports=function(N,q){let R,z,v,B,F,S,A,y,E,t,x,e,b,f,D,V,H,Y,T,L,X,Q,h,u;const w=N.state;R=N.next_in,h=N.input,z=R+(N.avail_in-5),v=N.next_out,u=N.output,B=v-(q-N.avail_out),F=v+(N.avail_out-257),S=w.dmax,A=w.wsize,y=w.whave,E=w.wnext,t=w.window,x=w.hold,e=w.bits,b=w.lencode,f=w.distcode,D=(1<<w.lenbits)-1,V=(1<<w.distbits)-1;N:do{e<15&&(x+=h[R++]<<e,e+=8,x+=h[R++]<<e,e+=8),H=b[x&D];q:for(;;){if(Y=H>>>24,x>>>=Y,e-=Y,Y=H>>>16&255,0===Y)u[v++]=65535&H;else{if(!(16&Y)){if(0===(64&Y)){H=b[(65535&H)+(x&(1<<Y)-1)];continue q}if(32&Y){w.mode=12;break N}N.msg="invalid literal/length code",w.mode=30;break N}T=65535&H,Y&=15,Y&&(e<Y&&(x+=h[R++]<<e,e+=8),T+=x&(1<<Y)-1,x>>>=Y,e-=Y),e<15&&(x+=h[R++]<<e,e+=8,x+=h[R++]<<e,e+=8),H=f[x&V];R:for(;;){if(Y=H>>>24,x>>>=Y,e-=Y,Y=H>>>16&255,!(16&Y)){if(0===(64&Y)){H=f[(65535&H)+(x&(1<<Y)-1)];continue R}N.msg="invalid distance code",w.mode=30;break N}if(L=65535&H,Y&=15,e<Y&&(x+=h[R++]<<e,e+=8,e<Y&&(x+=h[R++]<<e,e+=8)),L+=x&(1<<Y)-1,L>S){N.msg="invalid distance too far back",w.mode=30;break N}if(x>>>=Y,e-=Y,Y=v-B,L>Y){if(Y=L-Y,Y>y&&w.sane){N.msg="invalid distance too far back",w.mode=30;break N}if(X=0,Q=t,0===E){if(X+=A-Y,Y<T){T-=Y;do{u[v++]=t[X++]}while(--Y);X=v-L,Q=u}}else if(E<Y){if(X+=A+E-Y,Y-=E,Y<T){T-=Y;do{u[v++]=t[X++]}while(--Y);if(X=0,E<T){Y=E,T-=Y;do{u[v++]=t[X++]}while(--Y);X=v-L,Q=u}}}else if(X+=E-Y,Y<T){T-=Y;do{u[v++]=t[X++]}while(--Y);X=v-L,Q=u}for(;T>2;)u[v++]=Q[X++],u[v++]=Q[X++],u[v++]=Q[X++],T-=3;T&&(u[v++]=Q[X++],T>1&&(u[v++]=Q[X++]))}else{X=v-L;do{u[v++]=u[X++],u[v++]=u[X++],u[v++]=u[X++],T-=3}while(T>2);T&&(u[v++]=u[X++],T>1&&(u[v++]=u[X++]))}break}}break}}while(R<z&&v<F);T=e>>3,R-=T,e-=T<<3,x&=(1<<e)-1,N.next_in=R,N.next_out=v,N.avail_in=R<z?z-R+5:5-(R-z),N.avail_out=v<F?F-v+257:257-(v-F),w.hold=x,w.bits=e}},11092:(N,q,R)=>{"use strict";const z=R(11053),v=R(11057),B=R(11099),F=R(11107),{Z_FINISH:S,Z_BLOCK:A,Z_TREES:y,Z_OK:E,Z_STREAM_END:t,Z_NEED_DICT:x,Z_STREAM_ERROR:e,Z_DATA_ERROR:b,Z_MEM_ERROR:f,Z_BUF_ERROR:D,Z_DEFLATED:V}=R(11067),H=12,Y=30,T=N=>(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24);function L(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X=N=>{if(!N||!N.state)return e;const q=N.state;return N.total_in=N.total_out=q.total=0,N.msg="",q.wrap&&(N.adler=1&q.wrap),q.mode=1,q.last=0,q.havedict=0,q.dmax=32768,q.head=null,q.hold=0,q.bits=0,q.lencode=q.lendyn=new Int32Array(852),q.distcode=q.distdyn=new Int32Array(592),q.sane=1,q.back=-1,E},Q=N=>{if(!N||!N.state)return e;const q=N.state;return q.wsize=0,q.whave=0,q.wnext=0,X(N)},h=(N,q)=>{let R;if(!N||!N.state)return e;const z=N.state;return q<0?(R=0,q=-q):(R=1+(q>>4),q<48&&(q&=15)),q&&(q<8||q>15)?e:(null!==z.window&&z.wbits!==q&&(z.window=null),z.wrap=R,z.wbits=q,Q(N))},u=(N,q)=>{if(!N)return e;const R=new L;N.state=R,R.window=null;const z=h(N,q);return z!==E&&(N.state=null),z};let w,c,n=!0;const G=N=>{if(n){w=new Int32Array(512),c=new Int32Array(32);let q=0;for(;q<144;)N.lens[q++]=8;for(;q<256;)N.lens[q++]=9;for(;q<280;)N.lens[q++]=7;for(;q<288;)N.lens[q++]=8;for(F(1,N.lens,0,288,w,0,N.work,{bits:9}),q=0;q<32;)N.lens[q++]=5;F(2,N.lens,0,32,c,0,N.work,{bits:5}),n=!1}N.lencode=w,N.lenbits=9,N.distcode=c,N.distbits=5},s=(N,q,R,z)=>{let v;const B=N.state;return null===B.window&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new Uint8Array(B.wsize)),z>=B.wsize?(B.window.set(q.subarray(R-B.wsize,R),0),B.wnext=0,B.whave=B.wsize):(v=B.wsize-B.wnext,v>z&&(v=z),B.window.set(q.subarray(R-z,R-z+v),B.wnext),(z-=v)?(B.window.set(q.subarray(R-z,R),0),B.wnext=z,B.whave=B.wsize):(B.wnext+=v,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=v))),0};N.exports.inflateReset=Q,N.exports.inflateReset2=h,N.exports.inflateResetKeep=X,N.exports.inflateInit=N=>u(N,15),N.exports.inflateInit2=u,N.exports.inflate=(N,q)=>{let R,L,X,Q,h,u,w,c,n,Z,J,M,m,g,j,l,I,U,O,i,P,k,o=0;const C=new Uint8Array(4);let K,r;const a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!N||!N.state||!N.output||!N.input&&0!==N.avail_in)return e;R=N.state,R.mode===H&&(R.mode=13),h=N.next_out,X=N.output,w=N.avail_out,Q=N.next_in,L=N.input,u=N.avail_in,c=R.hold,n=R.bits,Z=u,J=w,k=E;N:for(;;)switch(R.mode){case 1:if(0===R.wrap){R.mode=13;break}for(;n<16;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(2&R.wrap&&35615===c){R.check=0,C[0]=255&c,C[1]=c>>>8&255,R.check=v(R.check,C,2,0),c=0,n=0,R.mode=2;break}if(R.flags=0,R.head&&(R.head.done=!1),!(1&R.wrap)||(((255&c)<<8)+(c>>8))%31){N.msg="incorrect header check",R.mode=Y;break}if((15&c)!==V){N.msg="unknown compression method",R.mode=Y;break}if(c>>>=4,n-=4,P=8+(15&c),0===R.wbits)R.wbits=P;else if(P>R.wbits){N.msg="invalid window size",R.mode=Y;break}R.dmax=1<<R.wbits,N.adler=R.check=1,R.mode=512&c?10:H,c=0,n=0;break;case 2:for(;n<16;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(R.flags=c,(255&R.flags)!==V){N.msg="unknown compression method",R.mode=Y;break}if(57344&R.flags){N.msg="unknown header flags set",R.mode=Y;break}R.head&&(R.head.text=c>>8&1),512&R.flags&&(C[0]=255&c,C[1]=c>>>8&255,R.check=v(R.check,C,2,0)),c=0,n=0,R.mode=3;case 3:for(;n<32;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}R.head&&(R.head.time=c),512&R.flags&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,R.check=v(R.check,C,4,0)),c=0,n=0,R.mode=4;case 4:for(;n<16;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}R.head&&(R.head.xflags=255&c,R.head.os=c>>8),512&R.flags&&(C[0]=255&c,C[1]=c>>>8&255,R.check=v(R.check,C,2,0)),c=0,n=0,R.mode=5;case 5:if(1024&R.flags){for(;n<16;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}R.length=c,R.head&&(R.head.extra_len=c),512&R.flags&&(C[0]=255&c,C[1]=c>>>8&255,R.check=v(R.check,C,2,0)),c=0,n=0}else R.head&&(R.head.extra=null);R.mode=6;case 6:if(1024&R.flags&&(M=R.length,M>u&&(M=u),M&&(R.head&&(P=R.head.extra_len-R.length,R.head.extra||(R.head.extra=new Uint8Array(R.head.extra_len)),R.head.extra.set(L.subarray(Q,Q+M),P)),512&R.flags&&(R.check=v(R.check,L,M,Q)),u-=M,Q+=M,R.length-=M),R.length))break N;R.length=0,R.mode=7;case 7:if(2048&R.flags){if(0===u)break N;M=0;do{P=L[Q+M++],R.head&&P&&R.length<65536&&(R.head.name+=String.fromCharCode(P))}while(P&&M<u);if(512&R.flags&&(R.check=v(R.check,L,M,Q)),u-=M,Q+=M,P)break N}else R.head&&(R.head.name=null);R.length=0,R.mode=8;case 8:if(4096&R.flags){if(0===u)break N;M=0;do{P=L[Q+M++],R.head&&P&&R.length<65536&&(R.head.comment+=String.fromCharCode(P))}while(P&&M<u);if(512&R.flags&&(R.check=v(R.check,L,M,Q)),u-=M,Q+=M,P)break N}else R.head&&(R.head.comment=null);R.mode=9;case 9:if(512&R.flags){for(;n<16;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(c!==(65535&R.check)){N.msg="header crc mismatch",R.mode=Y;break}c=0,n=0}R.head&&(R.head.hcrc=R.flags>>9&1,R.head.done=!0),N.adler=R.check=0,R.mode=H;break;case 10:for(;n<32;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}N.adler=R.check=T(c),c=0,n=0,R.mode=11;case 11:if(0===R.havedict)return N.next_out=h,N.avail_out=w,N.next_in=Q,N.avail_in=u,R.hold=c,R.bits=n,x;N.adler=R.check=1,R.mode=H;case H:if(q===A||q===y)break N;case 13:if(R.last){c>>>=7&n,n-=7&n,R.mode=27;break}for(;n<3;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}switch(R.last=1&c,c>>>=1,n-=1,3&c){case 0:R.mode=14;break;case 1:if(G(R),R.mode=20,q===y){c>>>=2,n-=2;break N}break;case 2:R.mode=17;break;case 3:N.msg="invalid block type",R.mode=Y}c>>>=2,n-=2;break;case 14:for(c>>>=7&n,n-=7&n;n<32;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if((65535&c)!==(c>>>16^65535)){N.msg="invalid stored block lengths",R.mode=Y;break}if(R.length=65535&c,c=0,n=0,R.mode=15,q===y)break N;case 15:R.mode=16;case 16:if(M=R.length,M){if(M>u&&(M=u),M>w&&(M=w),0===M)break N;X.set(L.subarray(Q,Q+M),h),u-=M,Q+=M,w-=M,h+=M,R.length-=M;break}R.mode=H;break;case 17:for(;n<14;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(R.nlen=257+(31&c),c>>>=5,n-=5,R.ndist=1+(31&c),c>>>=5,n-=5,R.ncode=4+(15&c),c>>>=4,n-=4,R.nlen>286||R.ndist>30){N.msg="too many length or distance symbols",R.mode=Y;break}R.have=0,R.mode=18;case 18:for(;R.have<R.ncode;){for(;n<3;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}R.lens[a[R.have++]]=7&c,c>>>=3,n-=3}for(;R.have<19;)R.lens[a[R.have++]]=0;if(R.lencode=R.lendyn,R.lenbits=7,K={bits:R.lenbits},k=F(0,R.lens,0,19,R.lencode,0,R.work,K),R.lenbits=K.bits,k){N.msg="invalid code lengths set",R.mode=Y;break}R.have=0,R.mode=19;case 19:for(;R.have<R.nlen+R.ndist;){for(;o=R.lencode[c&(1<<R.lenbits)-1],j=o>>>24,l=o>>>16&255,I=65535&o,!(j<=n);){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(I<16)c>>>=j,n-=j,R.lens[R.have++]=I;else{if(16===I){for(r=j+2;n<r;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(c>>>=j,n-=j,0===R.have){N.msg="invalid bit length repeat",R.mode=Y;break}P=R.lens[R.have-1],M=3+(3&c),c>>>=2,n-=2}else if(17===I){for(r=j+3;n<r;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}c>>>=j,n-=j,P=0,M=3+(7&c),c>>>=3,n-=3}else{for(r=j+7;n<r;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}c>>>=j,n-=j,P=0,M=11+(127&c),c>>>=7,n-=7}if(R.have+M>R.nlen+R.ndist){N.msg="invalid bit length repeat",R.mode=Y;break}for(;M--;)R.lens[R.have++]=P}}if(R.mode===Y)break;if(0===R.lens[256]){N.msg="invalid code -- missing end-of-block",R.mode=Y;break}if(R.lenbits=9,K={bits:R.lenbits},k=F(1,R.lens,0,R.nlen,R.lencode,0,R.work,K),R.lenbits=K.bits,k){N.msg="invalid literal/lengths set",R.mode=Y;break}if(R.distbits=6,R.distcode=R.distdyn,K={bits:R.distbits},k=F(2,R.lens,R.nlen,R.ndist,R.distcode,0,R.work,K),R.distbits=K.bits,k){N.msg="invalid distances set",R.mode=Y;break}if(R.mode=20,q===y)break N;case 20:R.mode=21;case 21:if(u>=6&&w>=258){N.next_out=h,N.avail_out=w,N.next_in=Q,N.avail_in=u,R.hold=c,R.bits=n,B(N,J),h=N.next_out,X=N.output,w=N.avail_out,Q=N.next_in,L=N.input,u=N.avail_in,c=R.hold,n=R.bits,R.mode===H&&(R.back=-1);break}for(R.back=0;o=R.lencode[c&(1<<R.lenbits)-1],j=o>>>24,l=o>>>16&255,I=65535&o,!(j<=n);){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(l&&0===(240&l)){for(U=j,O=l,i=I;o=R.lencode[i+((c&(1<<U+O)-1)>>U)],j=o>>>24,l=o>>>16&255,I=65535&o,!(U+j<=n);){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}c>>>=U,n-=U,R.back+=U}if(c>>>=j,n-=j,R.back+=j,R.length=I,0===l){R.mode=26;break}if(32&l){R.back=-1,R.mode=H;break}if(64&l){N.msg="invalid literal/length code",R.mode=Y;break}R.extra=15&l,R.mode=22;case 22:if(R.extra){for(r=R.extra;n<r;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}R.length+=c&(1<<R.extra)-1,c>>>=R.extra,n-=R.extra,R.back+=R.extra}R.was=R.length,R.mode=23;case 23:for(;o=R.distcode[c&(1<<R.distbits)-1],j=o>>>24,l=o>>>16&255,I=65535&o,!(j<=n);){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(0===(240&l)){for(U=j,O=l,i=I;o=R.distcode[i+((c&(1<<U+O)-1)>>U)],j=o>>>24,l=o>>>16&255,I=65535&o,!(U+j<=n);){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}c>>>=U,n-=U,R.back+=U}if(c>>>=j,n-=j,R.back+=j,64&l){N.msg="invalid distance code",R.mode=Y;break}R.offset=I,R.extra=15&l,R.mode=24;case 24:if(R.extra){for(r=R.extra;n<r;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}R.offset+=c&(1<<R.extra)-1,c>>>=R.extra,n-=R.extra,R.back+=R.extra}if(R.offset>R.dmax){N.msg="invalid distance too far back",R.mode=Y;break}R.mode=25;case 25:if(0===w)break N;if(M=J-w,R.offset>M){if(M=R.offset-M,M>R.whave&&R.sane){N.msg="invalid distance too far back",R.mode=Y;break}M>R.wnext?(M-=R.wnext,m=R.wsize-M):m=R.wnext-M,M>R.length&&(M=R.length),g=R.window}else g=X,m=h-R.offset,M=R.length;M>w&&(M=w),w-=M,R.length-=M;do{X[h++]=g[m++]}while(--M);0===R.length&&(R.mode=21);break;case 26:if(0===w)break N;X[h++]=R.length,w--,R.mode=21;break;case 27:if(R.wrap){for(;n<32;){if(0===u)break N;u--,c|=L[Q++]<<n,n+=8}if(J-=w,N.total_out+=J,R.total+=J,J&&(N.adler=R.check=R.flags?v(R.check,X,J,h-J):z(R.check,X,J,h-J)),J=w,(R.flags?c:T(c))!==R.check){N.msg="incorrect data check",R.mode=Y;break}c=0,n=0}R.mode=28;case 28:if(R.wrap&&R.flags){for(;n<32;){if(0===u)break N;u--,c+=L[Q++]<<n,n+=8}if(c!==(4294967295&R.total)){N.msg="incorrect length check",R.mode=Y;break}c=0,n=0}R.mode=29;case 29:k=t;break N;case Y:k=b;break N;case 31:return f;default:return e}return N.next_out=h,N.avail_out=w,N.next_in=Q,N.avail_in=u,R.hold=c,R.bits=n,(R.wsize||J!==N.avail_out&&R.mode<Y&&(R.mode<27||q!==S))&&s(N,N.output,N.next_out,J-N.avail_out)?(R.mode=31,f):(Z-=N.avail_in,J-=N.avail_out,N.total_in+=Z,N.total_out+=J,R.total+=J,R.wrap&&J&&(N.adler=R.check=R.flags?v(R.check,X,J,N.next_out-J):z(R.check,X,J,N.next_out-J)),N.data_type=R.bits+(R.last?64:0)+(R.mode===H?128:0)+(20===R.mode||15===R.mode?256:0),(0===Z&&0===J||q===S)&&k===E&&(k=D),k)},N.exports.inflateEnd=N=>{if(!N||!N.state)return e;let q=N.state;return q.window&&(q.window=null),N.state=null,E},N.exports.inflateGetHeader=(N,q)=>{if(!N||!N.state)return e;const R=N.state;return 0===(2&R.wrap)?e:(R.head=q,q.done=!1,E)},N.exports.inflateSetDictionary=(N,q)=>{const R=q.length;let v,B,F;return N&&N.state?(v=N.state,0!==v.wrap&&11!==v.mode?e:11===v.mode&&(B=1,B=z(B,q,R,0),B!==v.check)?b:(F=s(N,q,R,R),F?(v.mode=31,f):(v.havedict=1,E))):e},N.exports.inflateInfo="pako inflate (from Nodeca project)"},11107:N=>{"use strict";const q=15,R=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),v=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),B=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);N.exports=(N,F,S,A,y,E,t,x)=>{const e=x.bits;let b,f,D,V,H,Y,T=0,L=0,X=0,Q=0,h=0,u=0,w=0,c=0,n=0,G=0,s=null,Z=0;const J=new Uint16Array(16),M=new Uint16Array(16);let m,g,j,l=null,I=0;for(T=0;T<=q;T++)J[T]=0;for(L=0;L<A;L++)J[F[S+L]]++;for(h=e,Q=q;Q>=1&&0===J[Q];Q--);if(h>Q&&(h=Q),0===Q)return y[E++]=20971520,y[E++]=20971520,x.bits=1,0;for(X=1;X<Q&&0===J[X];X++);for(h<X&&(h=X),c=1,T=1;T<=q;T++)if(c<<=1,c-=J[T],c<0)return-1;if(c>0&&(0===N||1!==Q))return-1;for(M[1]=0,T=1;T<q;T++)M[T+1]=M[T]+J[T];for(L=0;L<A;L++)0!==F[S+L]&&(t[M[F[S+L]]++]=L);if(0===N?(s=l=t,Y=19):1===N?(s=R,Z-=257,l=z,I-=257,Y=256):(s=v,l=B,Y=-1),G=0,L=0,T=X,H=E,u=h,w=0,D=-1,n=1<<h,V=n-1,1===N&&n>852||2===N&&n>592)return 1;for(;;){m=T-w,t[L]<Y?(g=0,j=t[L]):t[L]>Y?(g=l[I+t[L]],j=s[Z+t[L]]):(g=96,j=0),b=1<<T-w,f=1<<u,X=f;do{f-=b,y[H+(G>>w)+f]=m<<24|g<<16|j}while(0!==f);for(b=1<<T-1;G&b;)b>>=1;if(0!==b?(G&=b-1,G+=b):G=0,L++,0===--J[T]){if(T===Q)break;T=F[S+t[L]]}if(T>h&&(G&V)!==D){for(0===w&&(w=h),H+=X,u=T-w,c=1<<u;u+w<Q&&(c-=J[u+w],!(c<=0));)u++,c<<=1;if(n+=1<<u,1===N&&n>852||2===N&&n>592)return 1;D=G&V,y[D]=h<<24|u<<16|H-E}}return 0!==G&&(y[H+G]=T-w<<24|64<<16),x.bits=h,0}},11064:N=>{"use strict";N.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11045:N=>{"use strict";function q(N){let q=N.length;for(;--q>=0;)N[q]=0}const R=256,z=286,v=30,B=15,F=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),S=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),A=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E=new Array(576);q(E);const t=new Array(60);q(t);const x=new Array(512);q(x);const e=new Array(256);q(e);const b=new Array(29);q(b);const f=new Array(v);function D(N,q,R,z,v){this.static_tree=N,this.extra_bits=q,this.extra_base=R,this.elems=z,this.max_length=v,this.has_stree=N&&N.length}let V,H,Y;function T(N,q){this.dyn_tree=N,this.max_code=0,this.stat_desc=q}q(f);const L=N=>N<256?x[N]:x[256+(N>>>7)],X=(N,q)=>{N.pending_buf[N.pending++]=255&q,N.pending_buf[N.pending++]=q>>>8&255},Q=(N,q,R)=>{N.bi_valid>16-R?(N.bi_buf|=q<<N.bi_valid&65535,X(N,N.bi_buf),N.bi_buf=q>>16-N.bi_valid,N.bi_valid+=R-16):(N.bi_buf|=q<<N.bi_valid&65535,N.bi_valid+=R)},h=(N,q,R)=>{Q(N,R[2*q],R[2*q+1])},u=(N,q)=>{let R=0;do{R|=1&N,N>>>=1,R<<=1}while(--q>0);return R>>>1},w=(N,q,R)=>{const z=new Array(16);let v,F,S=0;for(v=1;v<=B;v++)z[v]=S=S+R[v-1]<<1;for(F=0;F<=q;F++){let q=N[2*F+1];0!==q&&(N[2*F]=u(z[q]++,q))}},c=N=>{let q;for(q=0;q<z;q++)N.dyn_ltree[2*q]=0;for(q=0;q<v;q++)N.dyn_dtree[2*q]=0;for(q=0;q<19;q++)N.bl_tree[2*q]=0;N.dyn_ltree[512]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0},n=N=>{N.bi_valid>8?X(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0},G=(N,q,R,z)=>{const v=2*q,B=2*R;return N[v]<N[B]||N[v]===N[B]&&z[q]<=z[R]},s=(N,q,R)=>{const z=N.heap[R];let v=R<<1;for(;v<=N.heap_len&&(v<N.heap_len&&G(q,N.heap[v+1],N.heap[v],N.depth)&&v++,!G(q,z,N.heap[v],N.depth));)N.heap[R]=N.heap[v],R=v,v<<=1;N.heap[R]=z},Z=(N,q,z)=>{let v,B,A,y,E=0;if(0!==N.last_lit)do{v=N.pending_buf[N.d_buf+2*E]<<8|N.pending_buf[N.d_buf+2*E+1],B=N.pending_buf[N.l_buf+E],E++,0===v?h(N,B,q):(A=e[B],h(N,A+R+1,q),y=F[A],0!==y&&(B-=b[A],Q(N,B,y)),v--,A=L(v),h(N,A,z),y=S[A],0!==y&&(v-=f[A],Q(N,v,y)))}while(E<N.last_lit);h(N,256,q)},J=(N,q)=>{const R=q.dyn_tree,z=q.stat_desc.static_tree,v=q.stat_desc.has_stree,F=q.stat_desc.elems;let S,A,y,E=-1;for(N.heap_len=0,N.heap_max=573,S=0;S<F;S++)0!==R[2*S]?(N.heap[++N.heap_len]=E=S,N.depth[S]=0):R[2*S+1]=0;for(;N.heap_len<2;)y=N.heap[++N.heap_len]=E<2?++E:0,R[2*y]=1,N.depth[y]=0,N.opt_len--,v&&(N.static_len-=z[2*y+1]);for(q.max_code=E,S=N.heap_len>>1;S>=1;S--)s(N,R,S);y=F;do{S=N.heap[1],N.heap[1]=N.heap[N.heap_len--],s(N,R,1),A=N.heap[1],N.heap[--N.heap_max]=S,N.heap[--N.heap_max]=A,R[2*y]=R[2*S]+R[2*A],N.depth[y]=(N.depth[S]>=N.depth[A]?N.depth[S]:N.depth[A])+1,R[2*S+1]=R[2*A+1]=y,N.heap[1]=y++,s(N,R,1)}while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],((N,q)=>{const R=q.dyn_tree,z=q.max_code,v=q.stat_desc.static_tree,F=q.stat_desc.has_stree,S=q.stat_desc.extra_bits,A=q.stat_desc.extra_base,y=q.stat_desc.max_length;let E,t,x,e,b,f,D=0;for(e=0;e<=B;e++)N.bl_count[e]=0;for(R[2*N.heap[N.heap_max]+1]=0,E=N.heap_max+1;E<573;E++)t=N.heap[E],e=R[2*R[2*t+1]+1]+1,e>y&&(e=y,D++),R[2*t+1]=e,t>z||(N.bl_count[e]++,b=0,t>=A&&(b=S[t-A]),f=R[2*t],N.opt_len+=f*(e+b),F&&(N.static_len+=f*(v[2*t+1]+b)));if(0!==D){do{for(e=y-1;0===N.bl_count[e];)e--;N.bl_count[e]--,N.bl_count[e+1]+=2,N.bl_count[y]--,D-=2}while(D>0);for(e=y;0!==e;e--)for(t=N.bl_count[e];0!==t;)x=N.heap[--E],x>z||(R[2*x+1]!==e&&(N.opt_len+=(e-R[2*x+1])*R[2*x],R[2*x+1]=e),t--)}})(N,q),w(R,E,N.bl_count)},M=(N,q,R)=>{let z,v,B=-1,F=q[1],S=0,A=7,y=4;for(0===F&&(A=138,y=3),q[2*(R+1)+1]=65535,z=0;z<=R;z++)v=F,F=q[2*(z+1)+1],++S<A&&v===F||(S<y?N.bl_tree[2*v]+=S:0!==v?(v!==B&&N.bl_tree[2*v]++,N.bl_tree[32]++):S<=10?N.bl_tree[34]++:N.bl_tree[36]++,S=0,B=v,0===F?(A=138,y=3):v===F?(A=6,y=3):(A=7,y=4))},m=(N,q,R)=>{let z,v,B=-1,F=q[1],S=0,A=7,y=4;for(0===F&&(A=138,y=3),z=0;z<=R;z++)if(v=F,F=q[2*(z+1)+1],!(++S<A&&v===F)){if(S<y)do{h(N,v,N.bl_tree)}while(0!==--S);else 0!==v?(v!==B&&(h(N,v,N.bl_tree),S--),h(N,16,N.bl_tree),Q(N,S-3,2)):S<=10?(h(N,17,N.bl_tree),Q(N,S-3,3)):(h(N,18,N.bl_tree),Q(N,S-11,7));S=0,B=v,0===F?(A=138,y=3):v===F?(A=6,y=3):(A=7,y=4)}};let g=!1;const j=(N,q,R,z)=>{Q(N,0+(z?1:0),3),((N,q,R,z)=>{n(N),z&&(X(N,R),X(N,~R)),N.pending_buf.set(N.window.subarray(q,q+R),N.pending),N.pending+=R})(N,q,R,!0)};N.exports._tr_init=N=>{g||((()=>{let N,q,R,y,T;const L=new Array(16);for(R=0,y=0;y<28;y++)for(b[y]=R,N=0;N<1<<F[y];N++)e[R++]=y;for(e[R-1]=y,T=0,y=0;y<16;y++)for(f[y]=T,N=0;N<1<<S[y];N++)x[T++]=y;for(T>>=7;y<v;y++)for(f[y]=T<<7,N=0;N<1<<S[y]-7;N++)x[256+T++]=y;for(q=0;q<=B;q++)L[q]=0;for(N=0;N<=143;)E[2*N+1]=8,N++,L[8]++;for(;N<=255;)E[2*N+1]=9,N++,L[9]++;for(;N<=279;)E[2*N+1]=7,N++,L[7]++;for(;N<=287;)E[2*N+1]=8,N++,L[8]++;for(w(E,287,L),N=0;N<v;N++)t[2*N+1]=5,t[2*N]=u(N,5);V=new D(E,F,257,z,B),H=new D(t,S,0,v,B),Y=new D(new Array(0),A,0,19,7)})(),g=!0),N.l_desc=new T(N.dyn_ltree,V),N.d_desc=new T(N.dyn_dtree,H),N.bl_desc=new T(N.bl_tree,Y),N.bi_buf=0,N.bi_valid=0,c(N)},N.exports._tr_stored_block=j,N.exports._tr_flush_block=(N,q,z,v)=>{let B,F,S=0;N.level>0?(2===N.strm.data_type&&(N.strm.data_type=(N=>{let q,z=4093624447;for(q=0;q<=31;q++,z>>>=1)if(1&z&&0!==N.dyn_ltree[2*q])return 0;if(0!==N.dyn_ltree[18]||0!==N.dyn_ltree[20]||0!==N.dyn_ltree[26])return 1;for(q=32;q<R;q++)if(0!==N.dyn_ltree[2*q])return 1;return 0})(N)),J(N,N.l_desc),J(N,N.d_desc),S=(N=>{let q;for(M(N,N.dyn_ltree,N.l_desc.max_code),M(N,N.dyn_dtree,N.d_desc.max_code),J(N,N.bl_desc),q=18;q>=3&&0===N.bl_tree[2*y[q]+1];q--);return N.opt_len+=3*(q+1)+5+5+4,q})(N),B=N.opt_len+3+7>>>3,F=N.static_len+3+7>>>3,F<=B&&(B=F)):B=F=z+5,z+4<=B&&-1!==q?j(N,q,z,v):4===N.strategy||F===B?(Q(N,2+(v?1:0),3),Z(N,E,t)):(Q(N,4+(v?1:0),3),((N,q,R,z)=>{let v;for(Q(N,q-257,5),Q(N,R-1,5),Q(N,z-4,4),v=0;v<z;v++)Q(N,N.bl_tree[2*y[v]+1],3);m(N,N.dyn_ltree,q-1),m(N,N.dyn_dtree,R-1)})(N,N.l_desc.max_code+1,N.d_desc.max_code+1,S+1),Z(N,N.dyn_ltree,N.dyn_dtree)),c(N),v&&n(N)},N.exports._tr_tally=(N,q,z)=>(N.pending_buf[N.d_buf+2*N.last_lit]=q>>>8&255,N.pending_buf[N.d_buf+2*N.last_lit+1]=255&q,N.pending_buf[N.l_buf+N.last_lit]=255&z,N.last_lit++,0===q?N.dyn_ltree[2*z]++:(N.matches++,q--,N.dyn_ltree[2*(e[z]+R+1)]++,N.dyn_dtree[2*L(q)]++),N.last_lit===N.lit_bufsize-1),N.exports._tr_align=N=>{Q(N,2,3),h(N,256,E),(N=>{16===N.bi_valid?(X(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)})(N)}},11082:N=>{"use strict";N.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12042:N=>{function q(N,q,R){for(var z=N.length,v=-1/0,B=1/0,F=0;F<z;F++){var S=(R[0][F]-N[F])/q[F],A=(R[1][F]-N[F])/q[F];if(S>A){var y=S;S=A,A=y}if(A<v||S>B)return 1/0;S>v&&(v=S),A<B&&(B=A)}return v>B?1/0:v}N.exports=function(N,R,z,v){var B=q(R,z,v);if(B===1/0)N=null;else{N=N||[];for(var F=0;F<R.length;F++)N[F]=R[F]+z[F]*B}return N},N.exports.distance=q},12541:(N,q,R)=>{"use strict";R.d(q,{e:()=>F});var z=R(34);const v=z.useLayoutEffect;const B=function(N){var q=(0,z.useRef)(N);return v((function(){q.current=N})),q};var F=function(N){var q=B(N);(0,z.fb)((function(){var N=function(N){var R;if(null!=q.current&&(R=q.current(N)),N.defaultPrevented&&(N.returnValue=""),"string"===typeof R)return N.returnValue=R,R};return window.addEventListener("beforeunload",N),function(){window.removeEventListener("beforeunload",N)}}),[])}},12500:(N,q,R)=>{"use strict";var z=R(12504),v=Array.prototype.concat,B=Array.prototype.slice,F=N.exports=function(N){for(var q=[],R=0,F=N.length;R<F;R++){var S=N[R];z(S)?q=v.call(q,B.call(S)):q.push(S)}return q};F.wrap=function(N){return function(){return N(F(arguments))}}},12504:N=>{N.exports=function(N){return!(!N||"string"===typeof N)&&(N instanceof Array||Array.isArray(N)||N.length>=0&&(N.splice instanceof Function||Object.getOwnPropertyDescriptor(N,N.length-1)&&"String"!==N.constructor.name))}},12437:N=>{"use strict";var q=[],R=[],z=[],v=[],B=[],F=[],S=[],A=[],y=[],E=[],t=[],x=[];N.exports=function(N,e,b,f,D,V){for(var H=S,Y=y,T=E,L=x,X=0;X<3;X++)H[X]=+b[X],T[X]=+e.max[X],Y[X]=+e.base[X];V||(V=1e-10);var Q=function(N,S,y,E,x,e){var b=q,f=R,D=z,V=v,H=B,Y=F,T=A,L=Math.floor,X=0,Q=0,h=0,u=0,w=0;if(c(),0===h)return 0;for(u=s();Q<=h;){if(n(u)&&G())return X;u=s()}for(X+=h,w=0;w<3;w++)E[w]+=y[w],x[w]+=y[w];return X;function c(){if(Q=0,0!==(h=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])))for(var N=0;N<3;N++){var q=y[N]>=0;V[N]=q?1:-1;var R=q?x[N]:E[N];b[N]=q?E[N]:x[N],f[N]=Z(R,V[N]),D[N]=J(b[N],V[N]),T[N]=y[N]/h,H[N]=Math.abs(1/T[N]);var z=q?f[N]+1-R:R-f[N];Y[N]=H[N]<1/0?H[N]*z:1/0}}function n(q){for(var R=V[0],z=0===q?f[0]:D[0],v=f[0]+R,B=V[1],F=1===q?f[1]:D[1],S=f[1]+B,A=V[2],y=2===q?f[2]:D[2],E=f[2]+A,t=z;t!=v;t+=R)for(var x=F;x!=S;x+=B)for(var e=y;e!=E;e+=A)if(N(t,x,e))return!0;return!1}function G(){X+=Q;var N=V[u],q=Q/h,R=t;for(w=0;w<3;w++){var z=y[w]*q;E[w]+=z,x[w]+=z,R[w]=y[w]-z}if(N>0?x[u]=Math.round(x[u]):E[u]=Math.round(E[u]),S(X,u,N,R))return!0;for(w=0;w<3;w++)y[w]=R[w];return c(),0===h}function s(){var N=Y[0]<Y[1]?Y[0]<Y[2]?0:2:Y[1]<Y[2]?1:2,q=Y[N]-Q;for(Q=Y[N],f[N]+=V[N],Y[N]+=H[N],w=0;w<3;w++)b[w]+=q*T[w],D[w]=J(b[w],V[w]);return N}function Z(N,q){return L(N-q*e)}function J(N,q){return L(N+q*e)}}(N,f,H,Y,T,V);if(!D){for(X=0;X<3;X++)L[X]=b[X]>0?T[X]-e.max[X]:Y[X]-e.base[X];e.translate(L)}return Q}},10856:(N,q,R)=>{var z=R(10863);function v(N){for(var q,R,v=0,B=N.length,F=0;F<N.length;){for(q=N[F],R=0;F<B&&N[F]===q;)++F,++R;v+=z.log2(R)/7|0,v+=z.log2(q>>>0)/7|0,v+=2}return v}q.size=v,q.encode=function(N,q){q||(q=new Uint8Array(v(N)));for(var R,z,B=0,F=q.length,S=0;S<N.length;){for(R=N[S],z=0;S<N.length&&N[S]===R;)++S,++z;for(;B<F&&z>=128;)q[B++]=128+(127&z),z>>>=7;if(B>=F)throw new Error("RLE buffer overflow");for(q[B++]=z,R>>>=0;B<F&&R>=128;)q[B++]=128+(127&R),R>>>=7;if(B>=F)throw new Error("RLE buffer overflow");q[B++]=R}return q},q.decode=function(N,q){for(var R,z,v,B,F=q.length,S=N.length,A=0,y=0;y<S;){for(R=0,z=0;y<S&&N[y]>=128;)R+=(127&N[y++])<<z,z+=7;if(R+=N[y++]<<z,y>=S)throw new Error("RLE buffer underrun");if(A+R>F)throw new Error("Chunk buffer overflow");for(v=0,z=0;y<S&&N[y]>=128;)v+=(127&N[y++])<<z,z+=7;if(y>=S)throw new Error("RLE buffer underrun");for(v+=N[y++]<<z,B=0;B<R;++B)q[A++]=v}return q}},10863:(N,q)=>{"use strict";function R(N){var q=32;return(N&=-N)&&q--,65535&N&&(q-=16),16711935&N&&(q-=8),252645135&N&&(q-=4),858993459&N&&(q-=2),1431655765&N&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(N){return(N>0)-(N<0)},q.abs=function(N){var q=N>>31;return(N^q)-q},q.min=function(N,q){return q^(N^q)&-(N<q)},q.max=function(N,q){return N^(N^q)&-(N<q)},q.isPow2=function(N){return!(N&N-1)&&!!N},q.log2=function(N){var q,R;return q=(N>65535)<<4,q|=R=((N>>>=q)>255)<<3,q|=R=((N>>>=R)>15)<<2,(q|=R=((N>>>=R)>3)<<1)|(N>>>=R)>>1},q.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},q.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},q.countTrailingZeros=R,q.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},q.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},q.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var z=new Array(256);!function(N){for(var q=0;q<256;++q){var R=q,z=q,v=7;for(R>>>=1;R;R>>>=1)z<<=1,z|=1&R,--v;N[q]=z<<v&255}}(z),q.reverse=function(N){return z[255&N]<<24|z[N>>>8&255]<<16|z[N>>>16&255]<<8|z[N>>>24&255]},q.interleave2=function(N,q){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(N,q){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>q&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},q.interleave3=function(N,q,R){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<2},q.deinterleave3=function(N,q){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>q&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},q.nextCombination=function(N){var q=N|N-1;return q+1|(~q&-~q)-1>>>R(N)+1}},12629:(N,q,R)=>{"use strict";R.d(q,{d:()=>t});var z=R(12429),v=R(161);class B{constructor(N,q,R,B,F,S,A){this.Cg=new z(N.base,N.ah),this.mass=q,this.friction=R,this.restitution=B,this.ld=F,this.Ik=S,this.md=!!A,this._g=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ul=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.ag=v.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=v.create(),this._impulses=v.create(),this._sleepFrameCount=10}loadFromCopy(N){v.i(this.Cg.base,N.Cg.base),v.i(this.Cg.ah,N.Cg.ah),v.i(this.Cg.max,N.Cg.max),this.Cg.mag=N.Cg.mag,this.mass=N.mass,this.friction=N.friction,this.restitution=N.restitution,this.ld=N.ld,this.Ik=N.Ik,this.md=N.md,this._g=N._g,this.fluidDrag=N.fluidDrag,this.ul=N.ul,this.preventFallOffEdge=N.preventFallOffEdge,this.rolledBackLastTick=N.rolledBackLastTick,v.i(this.ag,N.ag),v.i(this.resting,N.resting),this.inFluid=N.inFluid,this._ratioInFluid=N._ratioInFluid,v.i(this._forces,N._forces),v.i(this._impulses,N._impulses),this._sleepFrameCount=N._sleepFrameCount}setPosition(N){F(N),v.gd(N,N,this.Cg.base),this.Cg.translate(N),this.dg()}cb(){return v.clone(this.Cg.base)}applyForce(N){F(N),v.add(this._forces,this._forces,N),this.dg()}applyImpulse(N){F(N),v.add(this._impulses,this._impulses,N),this.dg()}dg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var F=N=>{};var S=R(12429),A=R(161),y=R(12437);function E(){this._g=.1,this.fluidDrag=.4,this.wd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function t(N,q,R){N=Object.assign(new E,N),this.gravity=N.gravity||[0,-10,0],this._g=N._g||.1,this.wd=N.wd||2,this.fluidDrag=N.fluidDrag||.4,this.minBounceImpulse=N.minBounceImpulse,this.bodies=[],this.dk=N.dk,this.testSolid=q,this.testFluid=R}t.prototype.Pk=function(N,q,R,z,v,F){N=N||new S([0,0,0],[1,1,1]),"undefined"==typeof q&&(q=1),"undefined"==typeof R&&(R=1),"undefined"==typeof z&&(z=0),"undefined"==typeof v&&(v=1);var A=new B(N,q,R,z,v,F);return this.bodies.push(A),A},t.prototype.Qk=function(N){var q=this.bodies.indexOf(N);q<0||(this.bodies.splice(q,1),N.Cg=N.Ik=null)};var x=A.create(),e=A.create(),b=A.create(),f=A.create(),D=A.create(),V=A.create(),H=A.create(),Y=new S([0,0,0],[1,1,1]),T=new B(Y,1,1,0,1,(()=>{}),!1);function L(N,q,R){return q=R,q*=1-(1-N.ratioInFluid)**2}t.prototype.Td=function(N){N/=1e3;var q=l(0,A.squaredLength(this.gravity));this.bodies.forEach((R=>function(N,q,R,z){A.i(D,q.resting),N.dk&&T.loadFromCopy(q);if(q.mass<=0)return A.set(q.ag,0,0,0),A.set(q._forces,0,0,0),void A.set(q._impulses,0,0,0);var v=z||0===q.ld;if(function(N,q,R,z){if(q._sleepFrameCount>0)return!1;if(z)return!0;var v=!1,B=.5*R*R*q.ld;return A.scale(j,N.gravity,B),y(N.testSolid,q.Cg,j,(function(){return v=!0,!0}),!0),v}(N,q,R,v))return;q._sleepFrameCount--,function(N,q){var R=q.Cg,z=Math.floor(R.base[0]),v=Math.floor(R.base[2]),B=Math.floor(R.base[1]),F=Math.floor(R.max[1]);if(!N.testFluid(z,B,v))return q.inFluid=!1,void(q.ratioInFluid=0);var S=1,y=B+1;for(;y<=F&&N.testFluid(z,y,v);)S++,y++;var E=(B+S-R.base[1])/R.ah[1];E>1&&(E=1);var t=R.ah[0]*R.ah[1]*R.ah[2]*E,x=Q;A.scale(x,N.gravity,-N.wd*t*q.ld),q.applyForce(x),q.inFluid=!0,q.ratioInFluid=E}(N,q),U(q._forces),U(q._impulses),U(q.ag),U(q.resting),A.scale(x,q._forces,1/q.mass),A.Gd(x,x,N.gravity,q.ld),A.scale(e,q._impulses,1/q.mass),A.Gd(e,e,x,R),A.add(q.ag,q.ag,e),q.friction&&(h(N,0,q,e,R),h(N,1,q,e,R),h(N,2,q,e,R));var B=q.fluidDrag>=0?q.fluidDrag:N.fluidDrag,F=q._g>=0?q._g:N._g,S=F,E=F;q.inFluid&&(S=L(q,S,q.fluidDragHoriz>=0?q.fluidDragHoriz:B),E=L(q,E,q.fluidDragVert>=0?q.fluidDragVert:B));S=Math.max(1-S*R/q.mass,0),E=Math.max(1-E*R/q.mass,0),A.set(X,S,E,S),A.multiply(q.ag,q.ag,X),A.scale(b,q.ag,R),A.set(q._forces,0,0,0),A.set(q._impulses,0,0,0),q.md&&I(c,q.Cg);A.i(V,b),A.set(H,0,0,0),q.preventFallOffEdge&&function(N,q,R,z){if(!q.resting[1]||R[1]>0)return;var v=M;I(v,q.Cg);for(var B=0;B<3;B+=2){A.set(J,0,0,0),J[B]=R[B];var F=!0;(F=(F=(F=(F=F&&!g(N,v.base[0]+J[0]+1e-5,v.base[1],v.base[2]+J[2]+1e-5))&&!g(N,v.max[0]+J[0]-1e-5,v.base[1],v.base[2]+J[2]+1e-5))&&!g(N,v.base[0]+J[0]+1e-5,v.base[1],v.max[2]+J[2]-1e-5))&&!g(N,v.max[0]+J[0]-1e-5,v.base[1],v.max[2]+J[2]-1e-5))?(z[B]=R[B]>0?1:-1,R[B]=0):0===B&&(A.set(m,R[0],0,0),w(N,v,m,z,q.slideOnCollision))}}(N,q,b,H);w(N,q.Cg,b,q.resting,q.slideOnCollision),q.md&&function(N,q,R,z){if(q.resting[1]>=0&&!q.inFluid)return;var v=0!==q.resting[0],B=0!==q.resting[2];if(!v&&!B)return;var F=Math.abs(z[0]/z[2]),S=4;if(!v&&F>S)return;if(!B&&F<1/S)return;A.add(G,R.base,z);var E=N.testSolid;y(E,R,z,(function(N,q,R,z){if(1!==q)return!0;z[q]=0}));var t=R.base[1],x=q.inFluid?1.951:1.001,e=Math.floor(t+x)-t;A.set(s,0,e,0);var b=!1;if(y(E,R,s,(function(N,q,R,z){return b=!0,!0})),b)return;A.gd(Z,G,R.base),Z[1]=0,w(N,R,Z,n,!0);var f=l(R.base[0],G[0]),D=l(R.base[2],G[2]);if(v&&!f&&(!D||!B))return;if(B&&(!f||!v)&&!D)return;var V=!0;if(V=V&&!g(N,R.base[0]+1e-5,R.base[1],R.base[2]+1e-5),V=V&&!g(N,R.max[0]-1e-5,R.base[1],R.base[2]+1e-5),V=V&&!g(N,R.base[0]+1e-5,R.base[1],R.max[2]-1e-5),V=V&&!g(N,R.max[0]-1e-5,R.base[1],R.max[2]-1e-5),V)return;I(q.Cg,R),q.resting[0]=n[0],q.resting[2]=n[2],q.ul&&q.ul()}(N,q,c,V);for(var t=0;t<3;++t)q.resting[t]=q.resting[t]||H[t],f[t]=0,q.resting[t]&&(D[t]||(f[t]=-q.ag[t]),q.ag[t]=0);var Y=A.length(f);Y>.001&&(A.scale(f,f,q.mass),q.Ik&&q.Ik(f),q.restitution>0&&Y>N.minBounceImpulse&&(A.scale(f,f,q.restitution),q.applyImpulse(f)));var u=A.squaredLength(q.ag);u>1e-5&&q.dg();N.dk&&N.dk(q)?(q.loadFromCopy(T),q.rolledBackLastTick=!0):q.rolledBackLastTick=!1}(this,R,N,q)))};var X=A.create([0,0,0]);var Q=A.create();function h(N,q,R,z,v){var B=R.resting[q],F=z[q];if(!R.alwaysApplyHorizFriction||1!==q){if(0===B)return;if(B*F<=0)return}A.i(u,R.ag),u[q]=0;var S=A.length(u);if(!l(S,0)){var y=Math.abs(R.friction*N.gravity[q]*v),E=S>y?(S-y)/S:0;R.ag[(q+1)%3]*=E,R.ag[(q+2)%3]*=E}}var u=A.create();function w(N,q,R,z,v){return A.set(z,0,0,0),y(N.testSolid,q,R,(function(N,q,R,B){z[q]=R,B[q]=0,v||(B[0]=0,B[1]=0,B[2]=0)}))}var c=new S([],[]),n=A.create(),G=A.create(),s=A.create(),Z=A.create();var J=A.create(),M=new S([],[]),m=A.create();function g(N,q,R,z){return N.testSolid(Math.floor(q),Math.floor(R-1),Math.floor(z))}var j=A.create();function l(N,q){return Math.abs(N-q)<1e-5}function I(N,q){for(var R=0;R<3;R++)N.base[R]=q.base[R],N.max[R]=q.max[R],N.ah[R]=q.ah[R]}var U=function(N){}},11022:N=>{"use strict";N.exports=function(N,q,R,z){var v=self||window;try{try{var B;try{B=new v.Blob([N])}catch(y){(B=new(v.BlobBuilder||v.WebKitBlobBuilder||v.MozBlobBuilder||v.MSBlobBuilder)).append(N),B=B.getBlob()}var F=v.URL||v.webkitURL,S=F.createObjectURL(B),A=new v[q](S,R);return F.revokeObjectURL(S),A}catch(y){return new v[q]("data:application/javascript,".concat(encodeURIComponent(N)),R)}}catch(y){if(!z)throw Error("Inline worker is not supported");return new v[q](z,R)}}},12023:(N,q,R)=>{"use strict";function z(N,q,R,z,v){var B={};return Object.keys(z).forEach((function(N){B[N]=z[N]})),B.enumerable=!!B.enumerable,B.configurable=!!B.configurable,("value"in B||B.initializer)&&(B.writable=!0),B=R.slice().reverse().reduce((function(R,z){return z(N,q,R)||R}),B),v&&void 0!==B.initializer&&(B.value=B.initializer?B.initializer.call(v):void 0,B.initializer=void 0),void 0===B.initializer&&(Object.defineProperty(N,q,B),B=null),B}R.d(q,{c:()=>z})},12021:(N,q,R)=>{"use strict";function z(N,q,R,z){R&&Object.defineProperty(N,q,{enumerable:R.enumerable,configurable:R.configurable,writable:R.writable,value:R.initializer?R.initializer.call(z):void 0})}R.d(q,{e:()=>z})},12075:(N,q,R)=>{"use strict";R.d(q,{c:()=>Y,g:()=>D,h:()=>V,k:()=>x,m:()=>f,n:()=>b,p:()=>e});var z=R(11181),v=R(11213),B=R(11197),F=R(11002),S=R(12083),A=R(11454),y=R(11411),E=R(10931),t=R(11221);const x=Object.freeze(new z.g(0,0,0,0)),e=Object.freeze(z.m.Zero()),b=Object.freeze(z.l.Zero()),f=Object.freeze(y.d.Zero()),D=Object.freeze(v.c.Black()),V=Object.freeze(new v.g(0,0,0,0)),H={key:0,repeatCount:0,loopMode:2};class Y{static _PrepareAnimation(N,q,R,B,F,S,A,E){let t;if(!isNaN(parseFloat(F))&&isFinite(F)?t=Y.ANIMATIONTYPE_FLOAT:F instanceof z.g?t=Y.ANIMATIONTYPE_QUATERNION:F instanceof z.m?t=Y.ANIMATIONTYPE_VECTOR3:F instanceof z.l?t=Y.ANIMATIONTYPE_VECTOR2:F instanceof v.c?t=Y.ANIMATIONTYPE_COLOR3:F instanceof v.g?t=Y.ANIMATIONTYPE_COLOR4:F instanceof y.d&&(t=Y.ANIMATIONTYPE_SIZE),void 0==t)return null;const x=new Y(N,q,R,t,A),e=[{frame:0,value:F},{frame:B,value:S}];return x.setKeys(e),void 0!==E&&x.setEasingFunction(E),x}static CreateAnimation(N,q,R,z){const v=new Y(N+"Animation",N,R,q,Y.ANIMATIONLOOPMODE_CONSTANT);return v.setEasingFunction(z),v}static CreateAndStartAnimation(N,q,R,z,v,B,F,S,A,y,E){const t=Y._PrepareAnimation(N,R,z,v,B,F,S,A);return t?(q.va&&(E=q.va()),E?E.beginDirectAnimation(q,[t],0,v,1===t.loopMode,1,y):null):null}static CreateAndStartHierarchyAnimation(N,q,R,z,v,B,F,S,A,y,E){const t=Y._PrepareAnimation(N,z,v,B,F,S,A,y);if(!t)return null;return q.va().beginDirectHierarchyAnimation(q,R,[t],0,B,1===t.loopMode,1,E)}static CreateMergeAndStartAnimation(N,q,R,z,v,B,F,S,A,y){const E=Y._PrepareAnimation(N,R,z,v,B,F,S,A);return E?(q.animations.push(E),q.va().beginAnimation(q,0,v,1===E.loopMode,1,y)):null}static MakeAnimationAdditive(N,q,R){let v;v="object"===typeof q?q:{referenceFrame:q??0,range:R,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let B=N;if(v.cloneOriginalAnimation&&(B=N.clone(),B.name=v.clonedAnimationName||B.name),!B._keys.length)return B;const F=v.referenceFrame&&v.referenceFrame>=0?v.referenceFrame:0;let S=0;const A=B._keys[0];let y=B._keys.length-1;const E=B._keys[y],t={referenceValue:A.value,referencePosition:z.k.o[0],referenceQuaternion:z.k.Quaternion[0],referenceScaling:z.k.o[1],keyPosition:z.k.o[2],keyQuaternion:z.k.Quaternion[1],keyScaling:z.k.o[3]};let x=A.frame,e=E.frame;if(v.range){const N=B.getRange(v.range);N&&(x=N.from,e=N.to)}else x=v.fromFrame??x,e=v.toFrame??e;if(x!==A.frame&&(S=B.createKeyForFrame(x)),e!==E.frame&&(y=B.createKeyForFrame(e)),1===B._keys.length){const N=B._getKeyValue(B._keys[0]);t.referenceValue=N.clone?N.clone():N}else if(F<=A.frame){const N=B._getKeyValue(A.value);t.referenceValue=N.clone?N.clone():N}else if(F>=E.frame){const N=B._getKeyValue(E.value);t.referenceValue=N.clone?N.clone():N}else{H.key=0;const N=B._interpolate(F,H);t.referenceValue=N.clone?N.clone():N}B.dataType===Y.ANIMATIONTYPE_QUATERNION?t.referenceValue.normalize().conjugateInPlace():B.dataType===Y.ANIMATIONTYPE_MATRIX&&(t.referenceValue.decompose(t.referenceScaling,t.referenceQuaternion,t.referencePosition),t.referenceQuaternion.normalize().conjugateInPlace());let b=Number.MAX_VALUE;const f=v.clipKeys?[]:null;for(let D=S;D<=y;D++){let N=B._keys[D];if((f||v.cloneOriginalAnimation)&&(N={frame:N.frame,value:N.value.clone?N.value.clone():N.value,inTangent:N.inTangent,outTangent:N.outTangent,interpolation:N.interpolation,lockedTangent:N.lockedTangent},f&&(b===Number.MAX_VALUE&&(b=N.frame),N.frame-=b,f.push(N))),!D||B.dataType===Y.ANIMATIONTYPE_FLOAT||N.value!==A.value)switch(B.dataType){case Y.ANIMATIONTYPE_MATRIX:N.value.decompose(t.keyScaling,t.keyQuaternion,t.keyPosition),t.keyPosition.pi(t.referencePosition),t.keyScaling.divideInPlace(t.referenceScaling),t.referenceQuaternion.multiplyToRef(t.keyQuaternion,t.keyQuaternion),z.d.ComposeToRef(t.keyScaling,t.keyQuaternion,t.keyPosition,N.value);break;case Y.ANIMATIONTYPE_QUATERNION:t.referenceValue.multiplyToRef(N.value,N.value);break;case Y.ANIMATIONTYPE_VECTOR2:case Y.ANIMATIONTYPE_VECTOR3:case Y.ANIMATIONTYPE_COLOR3:case Y.ANIMATIONTYPE_COLOR4:N.value.subtractToRef(t.referenceValue,N.value);break;case Y.ANIMATIONTYPE_SIZE:N.value.width-=t.referenceValue.width,N.value.height-=t.referenceValue.height;break;default:N.value-=t.referenceValue}}return f&&B.setKeys(f,!0),B}static TransitionTo(N,q,R,z,v,B,F){let S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(F<=0)return R[N]=q,S&&S(),null;const A=v*(F/1e3);B.setKeys([{frame:0,value:R[N].clone?R[N].clone():R[N]},{frame:A,value:q}]),R.animations||(R.animations=[]),R.animations.push(B);const y=z.beginAnimation(R,0,A,!1);return y.onAnimationEnd=S,y}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const N of this._runtimeAnimations)if(!N.isStopped())return!0;return!1}constructor(N,q,R,z,v,B){this.name=N,this.targetProperty=q,this.framePerSecond=R,this.dataType=z,this.loopMode=v,this.enableBlending=B,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=q.split("."),this.dataType=z,this.loopMode=void 0===v?Y.ANIMATIONLOOPMODE_CYCLE:v,this.uniqueId=Y._UniqueIdGenerator++}toString(N){let q="Name: "+this.name+", property: "+this.targetProperty;if(q+=", datatype: "+["Float","o","Quaternion","Matrix","hb","Vector2"][this.dataType],q+=", nKeys: "+(this._keys?this._keys.length:"none"),q+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),N){q+=", Ranges: {";let N=!0;for(const R in this._ranges)N&&(q+=", ",N=!1),q+=R;q+="}"}return q}addEvent(N){this._events.push(N),this._events.sort(((N,q)=>N.frame-q.frame))}removeEvents(N){for(let q=0;q<this._events.length;q++)this._events[q].frame===N&&(this._events.splice(q,1),q--)}getEvents(){return this._events}createRange(N,q,R){this._ranges[N]||(this._ranges[N]=new S.c(N,q,R))}deleteRange(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=this._ranges[N];if(R){if(q){const N=R.from,q=R.to;for(let R=this._keys.length-1;R>=0;R--)this._keys[R].frame>=N&&this._keys[R].frame<=q&&this._keys.splice(R,1)}this._ranges[N]=null}}getRange(N){return this._ranges[N]}getKeys(){return this._keys}getHighestFrame(){let N=0;for(let q=0,R=this._keys.length;q<R;q++)N<this._keys[q].frame&&(N=this._keys[q].frame);return N}getEasingFunction(){return this._easingFunction}setEasingFunction(N){this._easingFunction=N}floatInterpolateFunction(N,q,R){return(0,B.m)(N,q,R)}floatInterpolateFunctionWithTangents(N,q,R,z,v){return(0,B.g)(N,q,R,z,v)}quaternionInterpolateFunction(N,q,R){return z.g.Slerp(N,q,R)}quaternionInterpolateFunctionWithTangents(N,q,R,v,B){return z.g.Hermite(N,q,R,v,B).normalize()}vector3InterpolateFunction(N,q,R){return z.m.Lerp(N,q,R)}vector3InterpolateFunctionWithTangents(N,q,R,v,B){return z.m.Hermite(N,q,R,v,B)}vector2InterpolateFunction(N,q,R){return z.l.Lerp(N,q,R)}vector2InterpolateFunctionWithTangents(N,q,R,v,B){return z.l.Hermite(N,q,R,v,B)}sizeInterpolateFunction(N,q,R){return y.d.Lerp(N,q,R)}color3InterpolateFunction(N,q,R){return v.c.Lerp(N,q,R)}color3InterpolateFunctionWithTangents(N,q,R,z,B){return v.c.Hermite(N,q,R,z,B)}color4InterpolateFunction(N,q,R){return v.g.Lerp(N,q,R)}color4InterpolateFunctionWithTangents(N,q,R,z,B){return v.g.Hermite(N,q,R,z,B)}_getKeyValue(N){return"function"===typeof N?N():N}evaluate(N){return H.key=0,this._interpolate(N,H)}_interpolate(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(q.loopMode===Y.ANIMATIONLOOPMODE_CONSTANT&&q.repeatCount>0)return q.highLimitValue.clone?q.highLimitValue.clone():q.highLimitValue;const z=this._keys,v=z.length;let B=q.key;for(;B>=0&&N<z[B].frame;)--B;for(;B+1<=v-1&&N>=z[B+1].frame;)++B;if(q.key=B,B<0)return R?void 0:this._getKeyValue(z[0].value);if(B+1>v-1)return R?void 0:this._getKeyValue(z[v-1].value);const F=z[B],S=z[B+1];if(R&&(N===F.frame||N===S.frame))return;const A=this._getKeyValue(F.value),y=this._getKeyValue(S.value);if(1===F.interpolation)return S.frame>N?A:y;const E=void 0!==F.outTangent&&void 0!==S.inTangent,t=S.frame-F.frame;let H=(N-F.frame)/t;const T=F.easingFunction||this.getEasingFunction();switch(null!==T&&(H=T.ease(H)),this.dataType){case Y.ANIMATIONTYPE_FLOAT:{const N=E?this.floatInterpolateFunctionWithTangents(A,F.outTangent*t,y,S.inTangent*t,H):this.floatInterpolateFunction(A,y,H);switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return N;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(q.offsetValue??0)*q.repeatCount+N}break}case Y.ANIMATIONTYPE_QUATERNION:{const N=E?this.quaternionInterpolateFunctionWithTangents(A,F.outTangent.scale(t),y,S.inTangent.scale(t),H):this.quaternionInterpolateFunction(A,y,H);switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return N;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.addInPlace((q.offsetValue||x).scale(q.repeatCount))}return N}case Y.ANIMATIONTYPE_VECTOR3:{const N=E?this.vector3InterpolateFunctionWithTangents(A,F.outTangent.scale(t),y,S.inTangent.scale(t),H):this.vector3InterpolateFunction(A,y,H);switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return N;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((q.offsetValue||e).scale(q.repeatCount))}break}case Y.ANIMATIONTYPE_VECTOR2:{const N=E?this.vector2InterpolateFunctionWithTangents(A,F.outTangent.scale(t),y,S.inTangent.scale(t),H):this.vector2InterpolateFunction(A,y,H);switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return N;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((q.offsetValue||b).scale(q.repeatCount))}break}case Y.ANIMATIONTYPE_SIZE:switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(A,y,H);case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(A,y,H).add((q.offsetValue||f).scale(q.repeatCount))}break;case Y.ANIMATIONTYPE_COLOR3:{const N=E?this.color3InterpolateFunctionWithTangents(A,F.outTangent.scale(t),y,S.inTangent.scale(t),H):this.color3InterpolateFunction(A,y,H);switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return N;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((q.offsetValue||D).scale(q.repeatCount))}break}case Y.ANIMATIONTYPE_COLOR4:{const N=E?this.color4InterpolateFunctionWithTangents(A,F.outTangent.scale(t),y,S.inTangent.scale(t),H):this.color4InterpolateFunction(A,y,H);switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return N;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((q.offsetValue||V).scale(q.repeatCount))}break}case Y.ANIMATIONTYPE_MATRIX:switch(q.loopMode){case Y.ANIMATIONLOOPMODE_CYCLE:case Y.ANIMATIONLOOPMODE_CONSTANT:case Y.ANIMATIONLOOPMODE_YOYO:return Y.AllowMatricesInterpolation?this.matrixInterpolateFunction(A,y,H,q.workValue):A;case Y.ANIMATIONLOOPMODE_RELATIVE:case Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A}}return 0}matrixInterpolateFunction(N,q,R,v){return Y.AllowMatrixDecomposeForInterpolation?v?(z.d.DecomposeLerpToRef(N,q,R,v),v):z.d.DecomposeLerp(N,q,R):v?(z.d.LerpToRef(N,q,R,v),v):z.d.Lerp(N,q,R)}clone(){const N=new Y(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(N.enableBlending=this.enableBlending,N.blendingSpeed=this.blendingSpeed,this._keys&&N.setKeys(this._keys),this._ranges){N._ranges={};for(const q in this._ranges){const R=this._ranges[q];R&&(N._ranges[q]=R.clone())}}return N}setKeys(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=q?N:N.slice(0)}createKeyForFrame(N){H.key=0;const q=this._interpolate(N,H,!0);if(!q)return this._keys[H.key].frame===N?H.key:H.key+1;const R={frame:N,value:q.clone?q.clone():q};return this._keys.splice(H.key+1,0,R),H.key+1}serialize(){const N={};N.name=this.name,N.property=this.targetProperty,N.framePerSecond=this.framePerSecond,N.dataType=this.dataType,N.loopBehavior=this.loopMode,N.enableBlending=this.enableBlending,N.blendingSpeed=this.blendingSpeed;const q=this.dataType;N.keys=[];const R=this.getKeys();for(let z=0;z<R.length;z++){const v=R[z],B={};switch(B.frame=v.frame,q){case Y.ANIMATIONTYPE_FLOAT:B.values=[v.value],void 0!==v.inTangent&&B.values.push(v.inTangent),void 0!==v.outTangent&&(void 0===v.inTangent&&B.values.push(void 0),B.values.push(v.outTangent)),void 0!==v.interpolation&&(void 0===v.inTangent&&B.values.push(void 0),void 0===v.outTangent&&B.values.push(void 0),B.values.push(v.interpolation));break;case Y.ANIMATIONTYPE_QUATERNION:case Y.ANIMATIONTYPE_MATRIX:case Y.ANIMATIONTYPE_VECTOR3:case Y.ANIMATIONTYPE_COLOR3:case Y.ANIMATIONTYPE_COLOR4:B.values=v.value.ij(),void 0!=v.inTangent&&B.values.push(v.inTangent.ij()),void 0!=v.outTangent&&(void 0===v.inTangent&&B.values.push(void 0),B.values.push(v.outTangent.ij())),void 0!==v.interpolation&&(void 0===v.inTangent&&B.values.push(void 0),void 0===v.outTangent&&B.values.push(void 0),B.values.push(v.interpolation))}N.keys.push(B)}N.ranges=[];for(const z in this._ranges){const q=this._ranges[z];if(!q)continue;const R={};R.name=z,R.from=q.from,R.to=q.to,N.ranges.push(R)}return N}static _UniversalLerp(N,q,R){const z=N.constructor;return z.Lerp?z.Lerp(N,q,R):z.Slerp?z.Slerp(N,q,R):N.toFixed?N*(1-R)+R*q:q}static Parse(N){const q=new Y(N.name,N.property,N.framePerSecond,N.dataType,N.loopBehavior),R=N.dataType,B=[];let F,S;for(N.enableBlending&&(q.enableBlending=N.enableBlending),N.blendingSpeed&&(q.blendingSpeed=N.blendingSpeed),S=0;S<N.keys.length;S++){const q=N.keys[S];let A,y,E;switch(R){case Y.ANIMATIONTYPE_FLOAT:F=q.values[0],q.values.length>=2&&(A=q.values[1]),q.values.length>=3&&(y=q.values[2]),q.values.length>=4&&(E=q.values[3]);break;case Y.ANIMATIONTYPE_QUATERNION:if(F=z.g.Zg(q.values),q.values.length>=8){const N=z.g.Zg(q.values.slice(4,8));N.equals(z.g.Zero())||(A=N)}if(q.values.length>=12){const N=z.g.Zg(q.values.slice(8,12));N.equals(z.g.Zero())||(y=N)}q.values.length>=13&&(E=q.values[12]);break;case Y.ANIMATIONTYPE_MATRIX:F=z.d.Zg(q.values),q.values.length>=17&&(E=q.values[16]);break;case Y.ANIMATIONTYPE_COLOR3:F=v.c.Zg(q.values),q.values[3]&&(A=v.c.Zg(q.values[3])),q.values[4]&&(y=v.c.Zg(q.values[4])),q.values[5]&&(E=q.values[5]);break;case Y.ANIMATIONTYPE_COLOR4:F=v.g.Zg(q.values),q.values[4]&&(A=v.g.Zg(q.values[4])),q.values[5]&&(y=v.g.Zg(q.values[5])),q.values[6]&&(E=v.g.Zg(q.values[6]));break;case Y.ANIMATIONTYPE_VECTOR3:default:F=z.m.Zg(q.values),q.values[3]&&(A=z.m.Zg(q.values[3])),q.values[4]&&(y=z.m.Zg(q.values[4])),q.values[5]&&(E=q.values[5])}const t={};t.frame=q.frame,t.value=F,void 0!=A&&(t.inTangent=A),void 0!=y&&(t.outTangent=y),void 0!=E&&(t.interpolation=E),B.push(t)}if(q.setKeys(B),N.ranges)for(S=0;S<N.ranges.length;S++)F=N.ranges[S],q.createRange(F.name,F.from,F.to);return q}static AppendSerializedAnimations(N,q){t.e.AppendSerializedAnimations(N,q)}static ParseFromFileAsync(N,q){return new Promise(((R,z)=>{const v=new E.b;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){let q=JSON.parse(v.responseText);if(q.animations&&(q=q.animations),q.length){const N=[];for(const R of q)N.push(this.Parse(R));R(N)}else{const z=this.Parse(q);N&&(z.name=N),R(z)}}else z("Unable to load the animation")})),v.open("GET",q),v.send()}))}static ParseFromSnippetAsync(N){return new Promise(((q,R)=>{const z=new E.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const R=JSON.parse(JSON.parse(z.responseText).jsonPayload);if(R.animations){const z=JSON.parse(R.animations),v=[];for(const q of z.animations){const R=this.Parse(q);R.snippetId=N,v.push(R)}q(v)}else{const z=JSON.parse(R.animation),v=this.Parse(z);v.snippetId=N,q(v)}}else R("Unable to load the snippet "+N)})),z.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),z.send()}))}}Y._UniqueIdGenerator=0,Y.AllowMatricesInterpolation=!1,Y.AllowMatrixDecomposeForInterpolation=!0,Y.SnippetUrl="https://snippet.babylonjs.com",Y.ANIMATIONTYPE_FLOAT=0,Y.ANIMATIONTYPE_VECTOR3=1,Y.ANIMATIONTYPE_QUATERNION=2,Y.ANIMATIONTYPE_MATRIX=3,Y.ANIMATIONTYPE_COLOR3=4,Y.ANIMATIONTYPE_COLOR4=7,Y.ANIMATIONTYPE_VECTOR2=5,Y.ANIMATIONTYPE_SIZE=6,Y.ANIMATIONLOOPMODE_RELATIVE=0,Y.ANIMATIONLOOPMODE_CYCLE=1,Y.ANIMATIONLOOPMODE_CONSTANT=2,Y.ANIMATIONLOOPMODE_YOYO=4,Y.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,Y.CreateFromSnippetAsync=Y.ParseFromSnippetAsync,(0,F.f)("BABYLON.Animation",Y),A.c._AnimationRangeFactory=(N,q,R)=>new S.c(N,q,R)},12083:(N,q,R)=>{"use strict";R.d(q,{c:()=>z});class z{constructor(N,q,R){this.name=N,this.from=q,this.to=R}clone(){return new z(this.name,this.from,this.to)}}},11738:(N,q,R)=>{"use strict";var z=R(10893),v=R(10907),B=R(10957),F=R(10900);B.d.AudioEngineFactory=(N,q,R)=>new S(N,q,R);class S{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new z.d,this.onAudioLockedObservable=new z.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,F.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const v=document.createElement("audio");this._hostElement=N,this._audioContext=q,this._audioDestination=R;try{v&&v.canPlayType&&(v.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||v.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(B){}try{v&&v.canPlayType&&v.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(B){}}lock(){this._triggerSuspendedState()}unlock(){var N,q;if("running"===(null===(N=this._audioContext)||void 0===N?void 0:N.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(q=this._audioContext)||void 0===q||q.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var N;null===(N=this._audioContext)||void 0===N||N.addEventListener("statechange",(()=>{var N;this.unlocked&&"running"!==(null===(N=this._audioContext)||void 0===N?void 0:N.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var N;return null!==(N=this._audioContext)&&void 0!==N&&N.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(N){this.canUseWebAudio=!1,v.c.Error("Web Audio: "+N.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const N=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",q=document.createElement("style");q.appendChild(document.createTextNode(N)),document.getElementsByTagName("head")[0].appendChild(q),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(N){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=N)}connectToAnalyser(N){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=N,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12067:(N,q,R)=>{"use strict";R.d(q,{e:()=>F});var z=R(11181),v=R(11190),B=R(11454);class F extends B.c{get _matrix(){return this._compose(),this.Qj}set _matrix(N){(N.updateFlag!==this.Qj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Qj.p(N),this._markAsDirtyAndDecompose())}constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(N,q.va(),!1),this.name=N,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=q,this.Qj=(null===v||void 0===v?void 0:v.clone())??z.d.Identity(),this._restMatrix=B??this.Qj.clone(),this._bindMatrix=F??this.Qj.clone(),this._index=S,this._absoluteMatrix=new z.d,this._absoluteBindMatrix=new z.d,this._absoluteInverseBindMatrix=new z.d,this._finalMatrix=new z.d,q.bones.push(this),this.setParent(R,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(N){this.setParent(N)}setParent(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==N){if(this.parent){const N=this.parent.children.indexOf(this);-1!==N&&this.parent.children.splice(N,1)}this._parentNode=N,this.parent&&this.parent.children.push(this),q&&this._updateAbsoluteBindMatrices(),this.Lg()}}getLocalMatrix(){return this._compose(),this.Qj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(N){this._restMatrix.p(N)}setRestPose(N){this.setRestMatrix(N)}getBindPose(){return this.getBindMatrix()}setBindMatrix(N){this.Hj(N)}setBindPose(N){this.setBindMatrix(N)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const N=z.k.o[0],q=z.k.Quaternion[0],R=z.k.o[1];this.getRestMatrix().decompose(N,q,R),this._linkedTransformNode.position.p(R),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??z.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(q),this._linkedTransformNode.re.p(N)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(N){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=N,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ne}set position(N){this._decompose(),this.ne.p(N),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(N){this.setRotation(N)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(N){this.setRotationQuaternion(N)}get re(){return this.getScale()}set re(N){this.setScale(N)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=z.m.Zero(),this._localRotation=z.g.Zero(),this.ne=z.m.Zero()),this.Qj.decompose(this._localScaling,this._localRotation,this.ne))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,z.d.ComposeToRef(this._localScaling,this._localRotation,this.ne,this.Qj)):this._needToCompose=!1)}Hj(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(N),q&&this._updateAbsoluteBindMatrices(),R?this._matrix=N:this.Lg()}_updateAbsoluteBindMatrices(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N||(N=this._bindMatrix),this.parent?N.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(N),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),q)for(let R=0;R<this.children.length;R++)this.children[R]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Lg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Lg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Lg(),this._needToDecompose=!0}_updatePosition(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=this.getLocalMatrix();if(0==q)v?(B.addAtIndex(12,N.x),B.addAtIndex(13,N.y),B.addAtIndex(14,N.z)):B.setTranslationFromFloats(N.x,N.y,N.z);else{let q=null;R&&(q=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=F._TmpMats[0],A=F._TmpVecs[0];this.parent?R&&q?(S.p(this.parent.getAbsoluteMatrix()),S.multiplyToRef(q,S)):S.p(this.parent.getAbsoluteMatrix()):z.d.IdentityToRef(S),v&&S.setTranslationFromFloats(0,0,0),S.invert(),z.m.TransformCoordinatesToRef(N,S,A),v?(B.addAtIndex(12,A.x),B.addAtIndex(13,A.y),B.addAtIndex(14,A.z)):B.setTranslationFromFloats(A.x,A.y,A.z)}this._markAsDirtyAndDecompose()}translate(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,q,R,!0)}setPosition(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,q,R,!1)}setAbsolutePosition(N,q){this.setPosition(N,1,q)}scale(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=this.getLocalMatrix(),S=F._TmpMats[0];z.d.ScalingToRef(N,q,R,S),S.multiplyToRef(B,B),S.invert();for(const z of this.children){const v=z.getLocalMatrix();v.multiplyToRef(S,v),v.multiplyAtIndex(12,N),v.multiplyAtIndex(13,q),v.multiplyAtIndex(14,R),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),v)for(const z of this.children)z.scale(N,q,R,v)}setScale(N){this._decompose(),this._localScaling.p(N),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(N){this._decompose(),N.p(this._localScaling)}setYawPitchRoll(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0;if(0===v){const S=F._TmpQuat;return z.g.RotationYawPitchRollToRef(N,q,R,S),void this.setRotationQuaternion(S,v,B)}const S=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,B))return;const A=F._TmpMats[1];z.d.RotationYawPitchRollToRef(N,q,R,A),S.multiplyToRef(A,A),this._rotateWithMatrix(A,v,B)}rotate(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3?arguments[3]:void 0;const B=F._TmpMats[0];B.setTranslationFromFloats(0,0,0),z.d.RotationAxisToRef(N,q,B),this._rotateWithMatrix(B,R,v)}setAxisAngle(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3?arguments[3]:void 0;if(0===R){const B=F._TmpQuat;return z.g.RotationAxisToRef(N,q,B),void this.setRotationQuaternion(B,R,v)}const B=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,v))return;const S=F._TmpMats[1];z.d.RotationAxisToRef(N,q,S),B.multiplyToRef(S,S),this._rotateWithMatrix(S,R,v)}setRotation(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(N.y,N.x,N.z,q,R)}setRotationQuaternion(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;if(0===q)return this._decompose(),this._localRotation.p(N),void this._markAsDirtyAndCompose();const v=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(v,R))return;const B=F._TmpMats[1];z.d.FromQuaternionToRef(N,B),v.multiplyToRef(B,B),this._rotateWithMatrix(B,q,R)}setRotationMatrix(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;if(0===q){const v=F._TmpQuat;return z.g.FromRotationMatrixToRef(N,v),void this.setRotationQuaternion(v,q,R)}const v=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(v,R))return;const B=F._TmpMats[1];B.p(N),v.multiplyToRef(N,B),this._rotateWithMatrix(B,q,R)}_rotateWithMatrix(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;const z=this.getLocalMatrix(),v=z.m[12],B=z.m[13],S=z.m[14],A=this.getParent(),y=F._TmpMats[3],E=F._TmpMats[4];A&&1==q?(R?(y.p(R.getWorldMatrix()),A.getAbsoluteMatrix().multiplyToRef(y,y)):y.p(A.getAbsoluteMatrix()),E.p(y),E.invert(),z.multiplyToRef(y,z),z.multiplyToRef(N,z),z.multiplyToRef(E,z)):1==q&&R?(y.p(R.getWorldMatrix()),E.p(y),E.invert(),z.multiplyToRef(y,z),z.multiplyToRef(N,z),z.multiplyToRef(E,z)):z.multiplyToRef(N,z),z.setTranslationFromFloats(v,B,S),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(N,q){const R=F._TmpMats[2];return N.p(this.getAbsoluteMatrix()),q?(N.multiplyToRef(q.getWorldMatrix(),N),z.d.ScalingToRef(q.re.x,q.re.y,q.re.z,R)):z.d.IdentityToRef(R),N.invert(),!isNaN(N.m[0])&&(R.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyToRef(R,N),!0)}cb(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=z.m.Zero();return this.getPositionToRef(N,q,R),R}getPositionToRef(){let N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const N=this.getLocalMatrix();q.x=N.m[12],q.y=N.m[13],q.z=N.m[14]}else{let R=null;N&&(R=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let z=F._TmpMats[0];N&&R?(z.p(this.getAbsoluteMatrix()),z.multiplyToRef(R,z)):z=this.getAbsoluteMatrix(),q.x=z.m[12],q.y=z.m[13],q.z=z.m[14]}}getAbsolutePosition(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=z.m.Zero();return this.getPositionToRef(1,N,q),q}getAbsolutePositionToRef(N,q){this.getPositionToRef(1,N,q)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Qj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Qj);const N=this._skeleton.getPoseMatrix();N&&this._absoluteMatrix.multiplyToRef(N,this._absoluteMatrix)}const N=this.children,q=N.length;for(let R=0;R<q;R++)N[R].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}hf(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=z.m.Zero();return this.getDirectionToRef(N,q,R),R}getDirectionToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,v=null;q&&(v=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=F._TmpMats[0];B.p(this.getAbsoluteMatrix()),q&&v&&B.multiplyToRef(v,B),z.m.TransformNormalToRef(N,B,R),R.normalize()}getRotation(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=z.m.Zero();return this.getRotationToRef(N,q,R),R}getRotationToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;const z=F._TmpQuat;this.getRotationQuaternionToRef(N,q,z),z.toEulerAnglesToRef(R)}getRotationQuaternion(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=z.g.Identity();return this.getRotationQuaternionToRef(N,q,R),R}getRotationQuaternionToRef(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),q.p(this._localRotation);else{const R=F._TmpMats[0],z=this.getAbsoluteMatrix();N?z.multiplyToRef(N.getWorldMatrix(),R):R.p(z),R.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyAtIndex(1,this._scalingDeterminant),R.multiplyAtIndex(2,this._scalingDeterminant),R.decompose(void 0,q,void 0)}}getRotationMatrix(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0;const R=z.d.Identity();return this.getRotationMatrixToRef(N,q,R),R}getRotationMatrixToRef(){let N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(q);else{const R=F._TmpMats[0],z=this.getAbsoluteMatrix();N?z.multiplyToRef(N.getWorldMatrix(),R):R.p(z),R.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyAtIndex(1,this._scalingDeterminant),R.multiplyAtIndex(2,this._scalingDeterminant),R.getRotationMatrixToRef(q)}}getAbsolutePositionFromLocal(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=z.m.Zero();return this.getAbsolutePositionFromLocalToRef(N,q,R),R}getAbsolutePositionFromLocalToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,v=null;q&&(v=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=F._TmpMats[0];B.p(this.getAbsoluteMatrix()),q&&v&&B.multiplyToRef(v,B),z.m.TransformCoordinatesToRef(N,B,R)}getLocalPositionFromAbsolute(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=z.m.Zero();return this.getLocalPositionFromAbsoluteToRef(N,q,R),R}getLocalPositionFromAbsoluteToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,v=null;q&&(v=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=F._TmpMats[0];B.p(this.getAbsoluteMatrix()),q&&v&&B.multiplyToRef(v,B),B.invert(),z.m.TransformCoordinatesToRef(N,B,R)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}F._TmpVecs=(0,v.d)(2,z.m.Zero),F._TmpQuat=z.g.Identity(),F._TmpMats=(0,v.d)(5,z.d.Identity)},11251:(N,q,R)=>{"use strict";R.d(q,{e:()=>B,h:()=>F});var z=R(11258),v=R(10907);class B{get u(){return this._isDisposed}constructor(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7?arguments[7]:void 0,y=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,N&&N.va?this._engine=N.va().getEngine():this._engine=N,this._updatable=R,this._instanced=F,this._divisor=A||1,this._label=y,q instanceof z.c?(this._data=null,this._buffer=q):(this._data=q,this._buffer=null),this.byteStride=S?v:v*Float32Array.BYTES_PER_ELEMENT,B||this.create()}createVertexBuffer(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6?arguments[6]:void 0;const A=B?q:q*Float32Array.BYTES_PER_ELEMENT,y=z?B?z:z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new F(this._engine,this,N,this._updatable,!0,y,void 0===v?this._instanced:v,A,R,void 0,void 0,!0,this._divisor||S)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!N&&this._buffer||(N=N||this._data,N&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,N),this._data=N):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(N,this._label),this._data=N):this._buffer=this._engine.createVertexBuffer(N,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.rb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.rb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.rb,void 0,this._label));v.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(N){this.create(N)}updateDirectly(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,N,z?q:q*Float32Array.BYTES_PER_ELEMENT,R?R*this.byteStride:void 0),this._data=0===q&&void 0===R?N:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class F{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(N){const q=0!=N;this._instanceDivisor=N,q!==this._instanced&&(this._instanced=q,this._computeHashCode())}get _maxVerticesCount(){const N=this.getData();return N?Array.isArray(N)?N.length/(this.byteStride/4)-this.byteOffset/4:(N.byteLength-this.byteOffset)/this.byteStride:0}constructor(N,q,R,z,v,S,A,y,E,t){let x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],e=arguments.length>11&&void 0!==arguments[11]&&arguments[11],b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,f=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let D=!1;if(this.Dd=N,"object"===typeof z&&null!==z?(D=z.updatable??!1,v=z.postponeInternalCreation,S=z.stride,A=z.instanced,y=z.offset,E=z.size,t=z.type,x=z.normalized??!1,e=z.useBytes??!1,b=z.divisor??1,f=z.takeBufferOwnership??!1,this._label=z.label):D=!!z,q instanceof B?(this._buffer=q,this._ownsBuffer=f):(this._buffer=new B(N,q,D,S,v,A,e,b,this._label),this._ownsBuffer=!0),this.uniqueId=F._Counter++,this._kind=R,void 0===t){const N=this.getData();this.type=N?F.GetDataType(N):F.FLOAT}else this.type=t;const V=F.GetTypeByteLength(this.type);e?(this._size=E||(S?S/V:F.DeduceStride(R)),this.byteStride=S||this._buffer.byteStride||this._size*V,this.byteOffset=y||0):(this._size=E||S||F.DeduceStride(R),this.byteStride=S?S*V:this._buffer.byteStride||this._size*V,this.byteOffset=(y||0)*V),this.normalized=x,this._instanced=void 0!==A&&A,this._instanceDivisor=A?b:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var N;null===(N=this._buffer)||void 0===N||N._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(N,q){const R=this.getData();return R?F.GetFloatData(R,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,N,q):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/F.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/F.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*F.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(N){this._buffer.create(N),this._alignBuffer()}update(N){this._buffer.update(N),this._alignBuffer()}updateDirectly(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(N,q,void 0,R),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(N,q){F.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,N,this.normalized,q)}_alignBuffer(){}static DeduceStride(N){switch(N){case F.UVKind:case F.UV2Kind:case F.UV3Kind:case F.UV4Kind:case F.UV5Kind:case F.UV6Kind:return 2;case F.NormalKind:case F.PositionKind:return 3;case F.ColorKind:case F.ColorInstanceKind:case F.MatricesIndicesKind:case F.MatricesIndicesExtraKind:case F.MatricesWeightsKind:case F.MatricesWeightsExtraKind:case F.TangentKind:return 4;default:throw new Error("Invalid kind '"+N+"'")}}static GetDataType(N){return N instanceof Int8Array?F.BYTE:N instanceof Uint8Array?F.UNSIGNED_BYTE:N instanceof Int16Array?F.SHORT:N instanceof Uint16Array?F.UNSIGNED_SHORT:N instanceof Int32Array?F.INT:N instanceof Uint32Array?F.UNSIGNED_INT:F.FLOAT}static GetTypeByteLength(N){switch(N){case F.BYTE:case F.UNSIGNED_BYTE:return 1;case F.SHORT:case F.UNSIGNED_SHORT:return 2;case F.INT:case F.UNSIGNED_INT:case F.FLOAT:return 4;default:throw new Error(`Invalid type '${N}'`)}}static ForEach(N,q,R,z,v,B,S,A){if(N instanceof Array){let v=q/4;const F=R/4;for(let q=0;q<B;q+=z){for(let R=0;R<z;R++)A(N[v+R],q+R);v+=F}}else{const y=N instanceof ArrayBuffer?new DataView(N):new DataView(N.buffer,N.byteOffset,N.byteLength),E=F.GetTypeByteLength(v);for(let N=0;N<B;N+=z){let B=q;for(let q=0;q<z;q++){A(F._GetFloatValue(y,v,B,S),N+q),B+=E}q+=R}}}static _GetFloatValue(N,q,R,z){switch(q){case F.BYTE:{let q=N.getInt8(R);return z&&(q=Math.max(q/127,-1)),q}case F.UNSIGNED_BYTE:{let q=N.getUint8(R);return z&&(q/=255),q}case F.SHORT:{let q=N.getInt16(R,!0);return z&&(q=Math.max(q/32767,-1)),q}case F.UNSIGNED_SHORT:{let q=N.getUint16(R,!0);return z&&(q/=65535),q}case F.INT:return N.getInt32(R,!0);case F.UNSIGNED_INT:return N.getUint32(R,!0);case F.FLOAT:return N.getFloat32(R,!0);default:throw new Error(`Invalid component type ${q}`)}}static GetFloatData(N,q,R,z,B,S,A,y){const E=q*F.GetTypeByteLength(R),t=A*q;if(R!==F.FLOAT||B!==E){const v=new Float32Array(t);return F.ForEach(N,z,B,q,R,t,S,((N,q)=>v[q]=N)),v}if(!(N instanceof Array||N instanceof Float32Array)||0!==z||N.length!==t){if(N instanceof Array){const q=z/4;return N.slice(q,q+t)}if(N instanceof ArrayBuffer)return new Float32Array(N,z,t);{const q=N.byteOffset+z;if(0!==(3&q)&&(v.c.Warn("Float array must be aligned to 4-bytes border"),y=!0),y){const R=new Uint8Array(t*Float32Array.BYTES_PER_ELEMENT),z=new Uint8Array(N.buffer,q,R.length);return R.set(z),new Float32Array(R.buffer)}return new Float32Array(N.buffer,q,t)}}return y?N.slice():N}}F._Counter=0,F.BYTE=5120,F.UNSIGNED_BYTE=5121,F.SHORT=5122,F.UNSIGNED_SHORT=5123,F.INT=5124,F.UNSIGNED_INT=5125,F.FLOAT=5126,F.PositionKind="position",F.NormalKind="normal",F.TangentKind="tangent",F.UVKind="uv",F.UV2Kind="uv2",F.UV3Kind="uv3",F.UV4Kind="uv4",F.UV5Kind="uv5",F.UV6Kind="uv6",F.ColorKind="color",F.ColorInstanceKind="instanceColor",F.MatricesIndicesKind="matricesIndices",F.MatricesWeightsKind="matricesWeights",F.MatricesIndicesExtraKind="matricesIndicesExtra",F.MatricesWeightsExtraKind="matricesWeightsExtra"},11258:(N,q,R)=>{"use strict";R.d(q,{c:()=>z});class z{get underlyingResource(){return null}constructor(){this.references=0,this.rb=0,this.is32Bits=!1,this.uniqueId=z._Counter++}}z._Counter=0},12528:(N,q,R)=>{"use strict";R.d(q,{b:()=>Z});var z=R(11147),v=R(11151),B=R(10893),F=R(11181),S=R(11454),A=R(11445),y=R(11286),E=R(10919),t=R(11186);class x{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(N){this._idleRotationSpeed=N}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(N){this._idleRotationWaitTime=N}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(N){this._idleRotationSpinupTime=N}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(N){this._attachedCamera=N;const q=this._attachedCamera.va();this._onPrePointerObservableObserver=q.onPrePointerObservable.add((N=>{N.type!==y.e.POINTERDOWN?N.type===y.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const N=E.d.Now;let q=0;null!=this._lastFrameTime&&(q=N-this._lastFrameTime),this._lastFrameTime=N,this._applyUserInteraction();const R=N-this._lastInteractionTime-this._idleRotationWaitTime,z=Math.max(Math.min(R/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(q/1e3))}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.va();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(N){this._lastInteractionTime=N??E.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<t.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let N=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(N=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?N:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=E.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}R(11693);class e{constructor(){this._easingMode=e.EASINGMODE_EASEIN}setEasingMode(N){const q=Math.min(Math.max(N,0),2);this._easingMode=q}getEasingMode(){return this._easingMode}easeInCore(N){throw new Error("You must implement this method")}ease(N){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(N);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-N)}return N>=.5?.5*(1-this.easeInCore(2*(1-N)))+.5:.5*this.easeInCore(2*N)}}e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2;var b=R(12075);class f{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(N){if(this._autoTransitionRange===N)return;this._autoTransitionRange=N;const q=this._attachedCamera;q&&(N?this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((N=>{if(N&&(N.Oj(!0),N.getBoundingInfo)){const q=N.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*q,this.upperRadiusTransitionRange=.05*q}})):this._onMeshTargetChangedObserver&&q.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(N){this._attachedCamera=N,this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(N){return!!this._attachedCamera&&(this._attachedCamera.radius===N&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(N){if(!this._attachedCamera)return;this._radiusBounceTransition||(f.EasingFunction.setEasingMode(f.EasingMode),this._radiusBounceTransition=b.c.CreateAnimation("radius",b.c.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const q=b.c.TransitionTo("radius",this._attachedCamera.radius+N,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));q&&this._animatables.push(q)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}f.EasingFunction=new class extends e{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=N}easeInCore(N){const q=Math.max(0,this.amplitude);return Math.pow(N,3)-N*q*Math.sin(3.141592653589793*N)}}(.3),f.EasingMode=e.EASINGMODE_EASEOUT;class D{constructor(){this.onTargetFramingAnimationEndObservable=new B.d,this._mode=D.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(N){this._mode=N}get mode(){return this._mode}set radiusScale(N){this._radiusScale=N}get radiusScale(){return this._radiusScale}set positionScale(N){this._positionScale=N}get positionScale(){return this._positionScale}set defaultElevation(N){this._defaultElevation=N}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(N){this._elevationReturnTime=N}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(N){this._elevationReturnWaitTime=N}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(N){this._framingTime=N}get framingTime(){return this._framingTime}init(){}attach(N){this._attachedCamera=N;const q=this._attachedCamera.va();D.EasingFunction.setEasingMode(D.EasingMode),this._onPrePointerObservableObserver=q.onPrePointerObservable.add((N=>{N.type!==y.e.POINTERDOWN?N.type===y.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((N=>{N&&N.getBoundingInfo&&this.zoomOnMesh(N,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.va();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.Oj(!0);const z=N.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(z.minimumWorld,z.maximumWorld,q,R)}zoomOnMeshHierarchy(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.Oj(!0);const z=N.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(z.min,z.max,q,R)}zoomOnMeshesHierarchy(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new F.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let B=0;B<N.length;B++){const q=N[B].getHierarchyBoundingVectors(!0);F.m.CheckExtends(q.min,z,v),F.m.CheckExtends(q.max,z,v)}this.zoomOnBoundingInfo(z,v,q,R)}zoomOnBoundingInfo(N,q){let R,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const B=N.y,S=B+(q.y-B)*this._positionScale,A=q.gd(N).scale(.5);if(z)R=new F.m(0,S,0);else{const q=N.add(A);R=new F.m(q.x,S,q.z)}this._vectorTransition||(this._vectorTransition=b.c.CreateAnimation("target",b.c.ANIMATIONTYPE_VECTOR3,60,D.EasingFunction)),this._betaIsAnimating=!0;let y=b.c.TransitionTo("target",R,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);y&&this._animatables.push(y);let E=0;if(this._mode===D.FitFrustumSidesMode){const R=this._calculateLowerRadiusFromModelBoundingSphere(N,q);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=A.length()+this._attachedCamera.Wi),E=R}else this._mode===D.IgnoreBoundsSizeMode&&(E=this._calculateLowerRadiusFromModelBoundingSphere(N,q),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Wi));if(this.autoCorrectCameraLimitsAndSensibility){const R=q.gd(N).length();this._attachedCamera.panningSensibility=5e3/R,this._attachedCamera.wheelPrecision=100/E}return this._radiusTransition||(this._radiusTransition=b.c.CreateAnimation("radius",b.c.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),y=b.c.TransitionTo("radius",E,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),v&&v(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),y&&this._animatables.push(y),!0}_calculateLowerRadiusFromModelBoundingSphere(N,q){const R=this._attachedCamera;if(!R)return 0;let z=R._calculateLowerRadiusFromModelBoundingSphere(N,q,this._radiusScale);return R.lowerRadiusLimit&&this._mode===D.IgnoreBoundsSizeMode&&(z=z<R.lowerRadiusLimit?R.lowerRadiusLimit:z),R.upperRadiusLimit&&(z=z>R.upperRadiusLimit?R.upperRadiusLimit:z),z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const N=E.d.Now-this._lastInteractionTime,q=.5*Math.PI-this._defaultElevation,R=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>R&&N>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=b.c.CreateAnimation("beta",b.c.ANIMATIONTYPE_FLOAT,60,D.EasingFunction));const N=b.c.TransitionTo("beta",q,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));N&&this._animatables.push(N)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=E.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}D.EasingFunction=new class extends e{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=N}easeInCore(N){return this.exponent<=0?N:(Math.exp(this.exponent*N)-1)/(Math.exp(this.exponent)-1)}},D.EasingMode=e.EASINGMODE_EASEINOUT,D.IgnoreBoundsSizeMode=0,D.FitFrustumSidesMode=1;var V=R(11452),H=R(12059),Y=R(12064),T=R(10888);class L{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(N){N=T.f.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),R=q.getInputElement();let z=0,v=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=B=>{var F,S;const A=B.event,E="touch"===A.pointerType;if(B.type!==y.e.POINTERMOVE&&-1===this.buttons.indexOf(A.button))return;const t=A.target;if(this._altKey=A.altKey,this._ctrlKey=A.ctrlKey,this._metaKey=A.metaKey,this._shiftKey=A.shiftKey,this._buttonsPressed=A.buttons,q.isPointerLock){const N=A.movementX,q=A.movementY;this.onTouch(null,N,q),this._pointA=null,this._pointB=null}else{if(B.type!==y.e.POINTERDOWN&&B.type!==y.e.POINTERDOUBLETAP&&E&&(null===(F=this._pointA)||void 0===F?void 0:F.pointerId)!==A.pointerId&&(null===(S=this._pointB)||void 0===S?void 0:S.pointerId)!==A.pointerId)return;if(B.type!==y.e.POINTERDOWN||-1!==this._currentActiveButton&&!E)if(B.type===y.e.POINTERDOUBLETAP)this.onDoubleTap(A.pointerType);else if(B.type!==y.e.POINTERUP||this._currentActiveButton!==A.button&&!E){if(B.type===y.e.POINTERMOVE)if(N||A.preventDefault(),this._pointA&&null===this._pointB){const N=A.clientX-this._pointA.x,q=A.clientY-this._pointA.y;this._pointA.x=A.clientX,this._pointA.y=A.clientY,this.onTouch(this._pointA,N,q)}else if(this._pointA&&this._pointB){const N=this._pointA.pointerId===A.pointerId?this._pointA:this._pointB;N.x=A.clientX,N.y=A.clientY;const q=this._pointA.x-this._pointB.x,R=this._pointA.y-this._pointB.y,F=q*q+R*R,S={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:A.pointerId,type:B.type};this.onMultiTouch(this._pointA,this._pointB,z,F,v,S),v=S,z=F}}else{try{null===t||void 0===t||t.releasePointerCapture(A.pointerId)}catch(x){}E||(this._pointB=null),q._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==A.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==A.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==z||v)&&(this.onMultiTouch(this._pointA,this._pointB,z,0,v,null),z=0,v=null),this._currentActiveButton=-1,this.onButtonUp(A),N||A.preventDefault()}else{try{null===t||void 0===t||t.setPointerCapture(A.pointerId)}catch(x){}if(null===this._pointA)this._pointA={x:A.clientX,y:A.clientY,pointerId:A.pointerId,type:A.pointerType};else{if(null!==this._pointB)return;this._pointB={x:A.clientX,y:A.clientY,pointerId:A.pointerId,type:A.pointerType}}-1!==this._currentActiveButton||E||(this._currentActiveButton=A.button),this.onButtonDown(A),N||(A.preventDefault(),R&&R.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE|y.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,z=0,v=null,this.onLostFocus()},this._contextMenuBind=N=>this.onContextMenu(N),R&&R.addEventListener("contextmenu",this._contextMenuBind,!1);const B=this.camera.va().getEngine().getHostWindow();B&&T.f.RegisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}Si(){if(this._onLostFocus){const N=this.camera.va().getEngine().getHostWindow();N&&T.f.UnregisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const N=this.camera.va().getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(N){}onTouch(N,q,R){}onMultiTouch(N,q,R,z,v,B){}onContextMenu(N){N.preventDefault()}onButtonDown(N){}onButtonUp(N){}onLostFocus(){}}(0,z.c)([(0,v.D)()],L.prototype,"buttons",void 0);class X extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(N,q){if(0!==this.panningSensibility&&N&&q){const R=q.x-N.x,z=q.y-N.y;this.camera.inertialPanningX+=-R/this.panningSensibility,this.camera.inertialPanningY+=z/this.panningSensibility}}_computePinchZoom(N,q){const R=this.camera.radius||X.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=R*Math.sqrt(N)/Math.sqrt(q):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(q-N)*R*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(q-N)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(N,q,R){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-q/this.panningSensibility,this.camera.inertialPanningY+=R/this.panningSensibility):(this.camera.inertialAlphaOffset-=q/this.angularSensibilityX,this.camera.inertialBetaOffset-=R/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(N,q,R,z,v,B){0===R&&null===v||0===z&&null===B||(this.multiTouchPanAndZoom?(this._computePinchZoom(R,z),this._computeMultiTouchPanning(v,B)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(z)-Math.sqrt(R))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(R,z),this._isPinching=!0):this._computeMultiTouchPanning(v,B)):this.multiTouchPanning?this._computeMultiTouchPanning(v,B):this.pinchZoom&&this._computePinchZoom(R,z))}onButtonDown(N){this._isPanClick=N.button===this.camera._panningMouseButton}onButtonUp(N){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}X.MinimumRadiusForPinch=.001,(0,z.c)([(0,v.D)()],X.prototype,"buttons",void 0),(0,z.c)([(0,v.D)()],X.prototype,"angularSensibilityX",void 0),(0,z.c)([(0,v.D)()],X.prototype,"angularSensibilityY",void 0),(0,z.c)([(0,v.D)()],X.prototype,"pinchPrecision",void 0),(0,z.c)([(0,v.D)()],X.prototype,"pinchDeltaPercentage",void 0),(0,z.c)([(0,v.D)()],X.prototype,"useNaturalPinchZoom",void 0),(0,z.c)([(0,v.D)()],X.prototype,"pinchZoom",void 0),(0,z.c)([(0,v.D)()],X.prototype,"panningSensibility",void 0),(0,z.c)([(0,v.D)()],X.prototype,"multiTouchPanning",void 0),(0,z.c)([(0,v.D)()],X.prototype,"multiTouchPanAndZoom",void 0),Y.c.ArcRotateCameraPointersInput=X;var Q=R(11289);class h{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(N){N=T.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const R=q.event;if(!R.metaKey)if(q.type===Q.c.KEYDOWN){if(this._ctrlPressed=R.ctrlKey,this._altPressed=R.altKey,-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysReset.indexOf(R.keyCode)){-1===this._keys.indexOf(R.keyCode)&&this._keys.push(R.keyCode),R.preventDefault&&(N||R.preventDefault())}}else if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysReset.indexOf(R.keyCode)){const q=this._keys.indexOf(R.keyCode);q>=0&&this._keys.splice(q,1),R.preventDefault&&(N||R.preventDefault())}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let q=0;q<this._keys.length;q++){const R=this._keys[q];-1!==this.keysLeft.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX-=1/this.panningSensibility:N.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset+=1/this.zoomingSensibility:N.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX+=1/this.panningSensibility:N.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset-=1/this.zoomingSensibility:N.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(R)&&N.useInputToRestoreState&&N.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,z.c)([(0,v.D)()],h.prototype,"keysUp",void 0),(0,z.c)([(0,v.D)()],h.prototype,"keysDown",void 0),(0,z.c)([(0,v.D)()],h.prototype,"keysLeft",void 0),(0,z.c)([(0,v.D)()],h.prototype,"keysRight",void 0),(0,z.c)([(0,v.D)()],h.prototype,"keysReset",void 0),(0,z.c)([(0,v.D)()],h.prototype,"panningSensibility",void 0),(0,z.c)([(0,v.D)()],h.prototype,"zoomingSensibility",void 0),(0,z.c)([(0,v.D)()],h.prototype,"useAltToZoom",void 0),(0,z.c)([(0,v.D)()],h.prototype,"angularSpeed",void 0),Y.c.ArcRotateCameraKeyboardMoveInput=h;var u=R(11313),w=R(11296),c=R(11197);class n{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new F.m(0,0,0),this._globalOffset=new F.m(0,0,0),this._inertialPanning=F.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(N,q){let R=0;const z=.01*N*this.wheelDeltaPercentage*q;return R=N>0?z/(1+this.wheelDeltaPercentage):z*(1+this.wheelDeltaPercentage),R}attachControl(N){N=T.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==y.e.POINTERWHEEL)return;const R=q.event;let z=0;const v=R.deltaMode===w.e.DOM_DELTA_LINE?40:1,B=-R.deltaY*v;if(this.customComputeDeltaFromMouseWheel)z=this.customComputeDeltaFromMouseWheel(B,this,R);else if(this.wheelDeltaPercentage){if(z=this._computeDeltaFromMouseWheelLegacyEvent(B,this.camera.radius),z>0){let N=this.camera.radius,q=this.camera.inertialRadiusOffset+z;for(let R=0;R<20&&Math.abs(q)>.001;R++)N-=q,q*=this.camera.inertia;N=(0,c.c)(N,0,Number.MAX_VALUE),z=this._computeDeltaFromMouseWheelLegacyEvent(B,N)}}else z=B/(40*this.wheelPrecision);z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(z)):this.camera.inertialRadiusOffset+=z),R.preventDefault&&(N||R.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,y.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.oe(0)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const N=this.camera;0+N.inertialAlphaOffset+N.inertialBetaOffset+N.inertialRadiusOffset&&(this._updateHitPlane(),N.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(N.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const N=this.camera,q=N.target.gd(N.position);this._hitPlane=u.e.FromPositionAndNormal(N.target,q)}_getPosition(){const N=this.camera,q=N.va(),R=q.createPickingRay(q.pointerX,q.pointerY,F.d.Identity(),N,!1);0===N.targetScreenOffset.x&&0===N.targetScreenOffset.y||(this._viewOffset.set(N.targetScreenOffset.x,N.targetScreenOffset.y,0),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),this._globalOffset=F.m.TransformNormal(this._viewOffset,N._cameraTransformMatrix),R.origin.addInPlace(this._globalOffset));let z=0;return this._hitPlane&&(z=R.intersectsPlane(this._hitPlane)??0),R.origin.addInPlace(R.direction.scaleInPlace(z))}_zoomToMouse(N){const q=this.camera,R=1-q.inertia;if(q.lowerRadiusLimit){const z=q.lowerRadiusLimit??0;q.radius-(q.inertialRadiusOffset+N)/R<z&&(N=(q.radius-z)*R-q.inertialRadiusOffset)}if(q.upperRadiusLimit){const z=q.upperRadiusLimit??0;q.radius-(q.inertialRadiusOffset+N)/R>z&&(N=(q.radius-z)*R-q.inertialRadiusOffset)}const z=N/R/q.radius,v=this._getPosition(),B=F.k.o[6];v.subtractToRef(q.target,B),B.scaleInPlace(z),B.scaleInPlace(R),this._inertialPanning.addInPlace(B),q.inertialRadiusOffset+=N}_zeroIfClose(N){Math.abs(N.x)<t.d&&(N.x=0),Math.abs(N.y)<t.d&&(N.y=0),Math.abs(N.z)<t.d&&(N.z=0)}}(0,z.c)([(0,v.D)()],n.prototype,"wheelPrecision",void 0),(0,z.c)([(0,v.D)()],n.prototype,"zoomToMouseLocation",void 0),(0,z.c)([(0,v.D)()],n.prototype,"wheelDeltaPercentage",void 0),Y.c.ArcRotateCameraMouseWheelInput=n;class G extends Y.d{constructor(N){super(N)}addMouseWheel(){return this.add(new n),this}addPointers(){return this.add(new X),this}addKeyboard(){return this.add(new h),this}}var s=R(11002);S.c.AddNodeConstructor("ArcRotateCamera",((N,q)=>()=>new Z(N,0,0,1,F.m.Zero(),q)));class Z extends H.e{get target(){return this._target}set target(N){this.setTarget(N)}get targetHost(){return this._targetHost}set targetHost(N){N&&this.setTarget(N)}getTarget(){return this.target}get position(){return this._position}set position(N){this.setPosition(N)}set upVector(N){this._upToYMatrix||(this._yToUpMatrix=new F.d,this._upToYMatrix=new F.d,this._upVector=F.m.Zero()),N.normalize(),this._upVector.p(N),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){F.d.RotationAlignToRef(F.m.UpReadOnly,this._upVector,this._yToUpMatrix),F.d.RotationAlignToRef(this._upVector,F.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityX:0}set angularSensibilityX(N){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityX=N)}get angularSensibilityY(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityY:0}set angularSensibilityY(N){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityY=N)}get pinchPrecision(){const N=this.inputs.attached.pointers;return N?N.pinchPrecision:0}set pinchPrecision(N){const q=this.inputs.attached.pointers;q&&(q.pinchPrecision=N)}get pinchDeltaPercentage(){const N=this.inputs.attached.pointers;return N?N.pinchDeltaPercentage:0}set pinchDeltaPercentage(N){const q=this.inputs.attached.pointers;q&&(q.pinchDeltaPercentage=N)}get useNaturalPinchZoom(){const N=this.inputs.attached.pointers;return!!N&&N.useNaturalPinchZoom}set useNaturalPinchZoom(N){const q=this.inputs.attached.pointers;q&&(q.useNaturalPinchZoom=N)}get panningSensibility(){const N=this.inputs.attached.pointers;return N?N.panningSensibility:0}set panningSensibility(N){const q=this.inputs.attached.pointers;q&&(q.panningSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const q=this.inputs.attached.keyboard;q&&(q.keysUp=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const q=this.inputs.attached.keyboard;q&&(q.keysDown=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const q=this.inputs.attached.keyboard;q&&(q.keysRight=N)}get wheelPrecision(){const N=this.inputs.attached.mousewheel;return N?N.wheelPrecision:0}set wheelPrecision(N){const q=this.inputs.attached.mousewheel;q&&(q.wheelPrecision=N)}get zoomToMouseLocation(){const N=this.inputs.attached.mousewheel;return!!N&&N.zoomToMouseLocation}set zoomToMouseLocation(N){const q=this.inputs.attached.mousewheel;q&&(q.zoomToMouseLocation=N)}get wheelDeltaPercentage(){const N=this.inputs.attached.mousewheel;return N?N.wheelDeltaPercentage:0}set wheelDeltaPercentage(N){const q=this.inputs.attached.mousewheel;q&&(q.wheelDeltaPercentage=N)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(N){N!==this.useBouncingBehavior&&(N?(this._bouncingBehavior=new f,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(N){N!==this.useFramingBehavior&&(N?(this._framingBehavior=new D,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(N){N!==this.useAutoRotationBehavior&&(N?(this._autoRotationBehavior=new x,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(N,q,R,z,v,S){var A;let y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(N,F.m.Zero(),S,y),A=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=F.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=F.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new F.d,this.panningAxis=new F.m(1,1,0),this._transformedDirection=new F.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new B.d,this.checkCollisions=!1,this.collisionRadius=new F.m(.5,.5,.5),this._previousPosition=F.m.Zero(),this._collisionVelocity=F.m.Zero(),this._newPosition=F.m.Zero(),this._computationVector=F.m.Zero(),this._onCollisionPositionChange=function(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R?(A.setPosition(q),A.Ik&&A.Ik(R)):A._previousPosition.p(A._position);const z=Math.cos(A.alpha),v=Math.sin(A.alpha),B=Math.cos(A.beta);let F=Math.sin(A.beta);0===F&&(F=1e-4);const S=A._getTargetPosition();A._computationVector.qe(A.radius*z*F,A.radius*B,A.radius*v*F),S.addToRef(A._computationVector,A._newPosition),A._position.p(A._newPosition);let y=A.upVector;A.allowUpsideDown&&A.beta<0&&(y=y.clone(),y=y.negate()),A._computeViewMatrix(A._position,S,y),A._viewMatrix.addAtIndex(12,A.targetScreenOffset.x),A._viewMatrix.addAtIndex(13,A.targetScreenOffset.y),A._collisionTriggered=!1},this._target=F.m.Zero(),v&&this.setTarget(v),this.alpha=q,this.beta=R,this.radius=z,this.getViewMatrix(),this.inputs=new G(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=F.l.Zero()}_updateCache(N){N||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const N=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?N.addToRef(this._targetBoundingCenter,this._target):this._target.p(N)}const N=this._getLockedTargetPosition();return N||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>t.d&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const v=arguments;q=T.f.BackCompatCameraNoPreventDefault(v),this._useCtrlForPanning=R,this._panningMouseButton=z,"boolean"===typeof v[0]&&(v.length>1&&(this._useCtrlForPanning=v[1]),v.length>2&&(this._panningMouseButton=v[2])),this.inputs.attachElement(q),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Si(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const N=this._scene.getEngine().getDeltaTime()/1e3,q=1-Math.pow(2,-N/this.restoreStateInterpolationFactor);this.setTarget(F.m.Lerp(this.getTarget(),this._storedTarget,q)),F.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,F.k.Quaternion[0]),F.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,F.k.Quaternion[1]),F.g.SlerpToRef(F.k.Quaternion[1],F.k.Quaternion[0],q,F.k.Quaternion[2]),F.k.Quaternion[2].normalize(),F.k.Quaternion[2].toAlphaBetaGammaToRef(F.k.o[0]),this.alpha=F.k.o[0].x,this.beta=F.k.o[0].y,this.radius+=(this._storedRadius-this.radius)*q,F.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,q,this.targetScreenOffset),(F.m.DistanceSquared(this.getTarget(),this._storedTarget)<t.d&&F.k.Quaternion[2].equalsWithEpsilon(F.k.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<t.d&&F.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<t.d||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const N=this.invertRotation?-1:1,q=this._calculateHandednessMultiplier();let R=this.inertialAlphaOffset*q;this.beta<0&&(R*=-1),this.alpha+=R*N,this.beta+=this.inertialBetaOffset*N,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<t.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<t.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*t.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const N=new F.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),N.multiplyInPlace(this.panningAxis),F.m.TransformNormalToRef(N,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const N=this.upVector,q=F.m.CrossToRef(this._transformedDirection,N,this._transformedDirection);F.m.CrossToRef(N,q,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);F.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const N=F.k.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.transposeToRef(N),F.m.TransformCoordinatesToRef(this._transformedDirection,N,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*t.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*t.d&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const N=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const q=Math.round((N-this.alpha)/(2*Math.PI));this.alpha+=2*q*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(N){this._position.equals(N)||(this._position.p(N),this.rebuildAnglesAndRadius())}setTarget(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(z=this.overrideCloneAlphaBetaRadius??z,N.Oj)q&&N.getBoundingInfo?this._targetBoundingCenter=N.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,N.Oj(),this._targetHost=N,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const q=N,z=this._getTargetPosition();if(z&&!R&&z.equals(q))return;this._targetHost=null,this._target=q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const N=Math.cos(this.alpha),q=Math.sin(this.alpha),R=Math.cos(this.beta);let z=Math.sin(this.beta);0===z&&(z=1e-4),0===this.radius&&(this.radius=1e-4);const v=this._getTargetPosition();if(this._computationVector.qe(this.radius*N*z,this.radius*R,this.radius*q*z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),v.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const N=this.va().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,N.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let N=this.upVector;this.allowUpsideDown&&z<0&&(N=N.negate()),this._computeViewMatrix(this._position,v,N),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=v,this._viewMatrix}zoomOn(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N||this.va().meshes;const R=A.b.MinMax(N);let z=this._calculateLowerRadiusFromModelBoundingSphere(R.min,R.max);z=Math.max(Math.min(z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=z*this.zoomOnFactor,this.focusOn({min:R.min,max:R.max,distance:z},q)}focusOn(N){let q,R,z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===N.min){const z=N||this.va().meshes;q=A.b.MinMax(z),R=F.m.Distance(q.min,q.max)}else{q=N,R=N.distance}this._target=A.b.Center(q),z||(this.maxZ=2*R)}createRigCamera(N,q){let R=0;switch(this.cameraRigMode){case V.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.e.RIG_MODE_VR:R=this._cameraRigParams.stereoHalfAngle*(0===q?1:-1);break;case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:R=this._cameraRigParams.stereoHalfAngle*(0===q?-1:1)}const z=new Z(N,this.alpha+R,this.beta,this.radius,this._target,this.va());return z._cameraRigParams={},z.isRigCamera=!0,z.rigParent=this,z.upVector=this.upVector,z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoBottom=this.orthoBottom,z.orthoTop=this.orthoTop,z}_updateRigCameras(){const N=this._rigCameras[0],q=this._rigCameras[1];switch(N.beta=q.beta=this.beta,this.cameraRigMode){case V.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.e.RIG_MODE_VR:N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const z=F.m.Distance(N,q),v=this.va().getEngine().getAspectRatio(this),B=Math.tan(this.fov/2),S=B*v,A=.5*z*R,y=A*Math.sqrt(1+1/(S*S)),E=A*Math.sqrt(1+1/(B*B));return Math.max(y,E)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,z.c)([(0,v.D)()],Z.prototype,"alpha",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"beta",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"radius",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,z.c)([(0,v.C)("target")],Z.prototype,"_target",void 0),(0,z.c)([(0,v.s)("targetHost")],Z.prototype,"_targetHost",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"inertialAlphaOffset",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"inertialBetaOffset",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"inertialRadiusOffset",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"lowerAlphaLimit",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"upperAlphaLimit",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"lowerBetaLimit",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"upperBetaLimit",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"lowerRadiusLimit",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"upperRadiusLimit",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"inertialPanningX",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"inertialPanningY",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"pinchToPanMaxDistance",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"panningDistanceLimit",void 0),(0,z.c)([(0,v.C)()],Z.prototype,"panningOriginTarget",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"panningInertia",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"zoomToMouseLocation",null),(0,z.c)([(0,v.D)()],Z.prototype,"zoomOnFactor",void 0),(0,z.c)([(0,v.A)()],Z.prototype,"targetScreenOffset",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"allowUpsideDown",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"useInputToRestoreState",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"restoreStateInterpolationFactor",void 0),(0,s.f)("BABYLON.ArcRotateCamera",Z)},11452:(N,q,R)=>{"use strict";R.d(q,{e:()=>D});var z=R(11147),v=R(11151),B=R(11167),F=R(10888),S=R(10893),A=R(11181),y=R(11454),E=R(10907),t=R(11002),x=R(10923),e=R(11463),b=R(11306),f=R(11221);class D extends y.c{get position(){return this._position}set position(N){this._position=N}set upVector(N){this._upVector=N}get upVector(){return this._upVector}get screenArea(){let N=0,q=0;if(this.mode===D.PERSPECTIVE_CAMERA)this.fovMode===D.FOVMODE_VERTICAL_FIXED?(q=2*this.Wi*Math.tan(this.fov/2),N=this.getEngine().getAspectRatio(this)*q):(N=2*this.Wi*Math.tan(this.fov/2),q=N/this.getEngine().getAspectRatio(this));else{const R=this.getEngine().getRenderWidth()/2,z=this.getEngine().getRenderHeight()/2;N=(this.orthoRight??R)-(this.orthoLeft??-R),q=(this.orthoTop??z)-(this.orthoBottom??-z)}return N*q}set orthoLeft(N){this._orthoLeft=N;for(const q of this._rigCameras)q.orthoLeft=N}get orthoLeft(){return this._orthoLeft}set orthoRight(N){this._orthoRight=N;for(const q of this._rigCameras)q.orthoRight=N}get orthoRight(){return this._orthoRight}set orthoBottom(N){this._orthoBottom=N;for(const q of this._rigCameras)q.orthoBottom=N}get orthoBottom(){return this._orthoBottom}set orthoTop(N){this._orthoTop=N;for(const q of this._rigCameras)q.orthoTop=N}get orthoTop(){return this._orthoTop}set mode(N){this._mode=N;for(const q of this._rigCameras)q.mode=N}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(N,q,R){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(N,R,!1),this._position=A.m.Zero(),this._upVector=A.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Wi=1,this.maxZ=1e4,this.inertia=.9,this._mode=D.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new e.d(0,0,1,1),this.layerMask=268435455,this.fovMode=D.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=D.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new S.d,this.onProjectionMatrixChangedObservable=new S.d,this.onAfterCheckInputsObservable=new S.d,this.onRestoreStateObservable=new S.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new A.d,this._postProcesses=new Array,this._activeMeshes=new B.h(256),this._globalPosition=A.m.Zero(),this._computedViewMatrix=A.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=A.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=A.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),z&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=q,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${N}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Bh"}toString(N){let q="Name: "+this.name;if(q+=", type: "+this.getClassName(),this.animations)for(let R=0;R<this.animations.length;R++)q+=", animation[0]: "+this.animations[R].toString(N);return q}applyVerticalCorrection(){const N=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-N.x:N.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(N){return-1!==this._activeMeshes.indexOf(N)}isReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(N)for(const q of this._postProcesses)if(q&&!q.isReady())return!1;return super.isReady(N)}_initCache(){super._initCache(),this._cache.position=new A.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new A.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Wi=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(N){N||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let N=this._cache.mode===this.mode&&this._cache.Wi===this.Wi&&this._cache.maxZ===this.maxZ;if(!N)return!1;const q=this.getEngine();return this.mode===D.PERSPECTIVE_CAMERA?N=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===q.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(N=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===q.getRenderWidth()&&this._cache.renderHeight===q.getRenderHeight(),this.oblique&&(N=N&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),N}attachControl(N,q){}Si(N){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==D.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let N=0;N<this._postProcesses.length;N++)if(null!==this._postProcesses[N])return this._postProcesses[N];return null}_cascadePostProcessesToRigCams(){const N=this._getFirstPostProcess();N&&N.markTextureDirty();for(let q=0,R=this._rigCameras.length;q<R;q++){const N=this._rigCameras[q],R=N._rigPostProcess;if(R){"pass"===R.getEffectName()&&(N.isIntermediate=0===this._postProcesses.length),N._postProcesses=this._postProcesses.slice(0).concat(R),R.markTextureDirty()}else N._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!N.isReusable()&&this._postProcesses.indexOf(N)>-1?(E.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==q||q<0?this._postProcesses.push(N):null===this._postProcesses[q]?this._postProcesses[q]=N:this._postProcesses.splice(q,0,N),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Lg(),this._postProcesses.indexOf(N))}detachPostProcess(N){const q=this._postProcesses.indexOf(N);-1!==q&&(this._postProcesses[q]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Lg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return A.d.Identity()}getViewMatrix(N){return!N&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(N){this._doNotComputeProjectionMatrix=!0,void 0!==N&&(this._projectionMatrix=N)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(N){if(this._doNotComputeProjectionMatrix||!N&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Wi=this.Wi,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const q=this.getEngine(),R=this.va(),z=q.useReverseDepthBuffer;if(this.mode===D.PERSPECTIVE_CAMERA){let N;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=q.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Wi<=0&&(this.Wi=.1),N=R.useRightHandedSystem?A.d.PerspectiveFovRHToRef:A.d.PerspectiveFovLHToRef,N(this.fov,q.getAspectRatio(this),z?this.maxZ:this.Wi,z?this.Wi:this.maxZ,this._projectionMatrix,this.fovMode===D.FOVMODE_VERTICAL_FIXED,q.isNDCHalfZRange,this.projectionPlaneTilt,z)}else{var v,B,F;const N=q.getRenderWidth()/2,S=q.getRenderHeight()/2;R.useRightHandedSystem?this.oblique?A.d.ObliqueOffCenterRHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-S,this.orthoTop??S,z?this.maxZ:this.Wi,z?this.Wi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,q.isNDCHalfZRange):A.d.OrthoOffCenterRHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-S,this.orthoTop??S,z?this.maxZ:this.Wi,z?this.Wi:this.maxZ,this._projectionMatrix,q.isNDCHalfZRange):this.oblique?A.d.ObliqueOffCenterLHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-S,this.orthoTop??S,z?this.maxZ:this.Wi,z?this.Wi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,q.isNDCHalfZRange):A.d.OrthoOffCenterLHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-S,this.orthoTop??S,z?this.maxZ:this.Wi,z?this.Wi:this.maxZ,this._projectionMatrix,q.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(v=this.oblique)||void 0===v?void 0:v.angle,this._cache.obliqueLength=null===(B=this.oblique)||void 0===B?void 0:B.length,this._cache.obliqueOffset=null===(F=this.oblique)||void 0===F?void 0:F.offset,this._cache.renderWidth=q.getRenderWidth(),this._cache.renderHeight=q.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(N){return(this.radius||(this.target?A.m.Distance(this.position,this.target):this.position.length()))+N}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?b.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=b.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),q&&this.rigCameras.length>0){let q=!1;return this.rigCameras.forEach((R=>{R._updateFrustumPlanes(),q=q||N.isInFrustum(R._frustumPlanes)})),q}return N.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(N){return this._updateFrustumPlanes(),N.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,x.b)("Ray")}getForwardRayToRef(N){throw(0,x.b)("Ray")}dispose(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const N=this._rigCameras.pop();N&&N.dispose()}if(this._parentContainer){const N=this._parentContainer.cameras.indexOf(this);N>-1&&this._parentContainer.cameras.splice(N,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==D.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let N=this._postProcesses.length;for(;--N>=0;){const q=this._postProcesses[N];q&&q.dispose(this)}}let R=this.customRenderTargets.length;for(;--R>=0;)this.customRenderTargets[R].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(N,q)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(N,q){if(this.cameraRigMode!==N){for(;this._rigCameras.length>0;){const N=this._rigCameras.pop();N&&N.dispose()}if(this.cameraRigMode=N,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=q.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=F.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==D.RIG_MODE_NONE){const N=this.createRigCamera(this.name+"_L",0);N&&(N._isLeftCamera=!0);const q=this.createRigCamera(this.name+"_R",1);q&&(q._isRightCamera=!0),N&&q&&(this._rigCameras.push(N),this._rigCameras.push(q))}this._setRigMode(q),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(N){}_getVRProjectionMatrix(){return A.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Wi,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(N,q){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[N]=q,"interaxialDistance"===N&&(this._cameraRigParams.stereoHalfAngle=F.f.ToRadians(q/.0637))}createRigCamera(N,q){return null}_updateRigCameras(){for(let N=0;N<this._rigCameras.length;N++)this._rigCameras[N].Wi=this.Wi,this._rigCameras[N].maxZ=this.maxZ,this._rigCameras[N].fov=this.fov,this._rigCameras[N].upVector.p(this.upVector);this.cameraRigMode===D.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const N=f.e.Serialize(this);return N.uniqueId=this.uniqueId,N.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(N),this.inputs&&this.inputs.serialize(N),f.e.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N.isEnabled=this.isEnabled(),N}clone(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=f.e.Clone(D.GetConstructorFromName(this.getClassName(),N,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return R.name=N,R.parent=q,this.onClonedObservable.notifyObservers(R),R}hf(N){const q=A.m.Zero();return this.getDirectionToRef(N,q),q}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(N,q){A.m.TransformNormalToRef(N,this.getWorldMatrix(),q)}static GetConstructorFromName(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const B=y.c.Construct(N,q,R,{interaxial_distance:z,isStereoscopicSideBySide:v});return B||(()=>D._CreateDefaultParsedCamera(q,R))}Oj(){return this.getWorldMatrix()}static Parse(N,q){const R=N.type,z=D.GetConstructorFromName(R,N.name,q,N.interaxial_distance,N.isStereoscopicSideBySide),v=f.e.Parse(z,N,q);if(void 0!==N.parentId&&(v._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(v._waitingParentInstanceIndex=N.parentInstanceIndex),v.inputs&&(v.inputs.parse(N),v._setupInputs()),N.upVector&&(v.upVector=A.m.Zg(N.upVector)),v.setPosition&&(v.position.qe(0,0,0),v.setPosition(A.m.Zg(N.position))),N.target&&v.setTarget&&v.setTarget(A.m.Zg(N.target)),N.cameraRigMode){const q=N.interaxial_distance?{interaxialDistance:N.interaxial_distance}:{};v.setCameraRigMode(N.cameraRigMode,q)}if(N.animations){for(let q=0;q<N.animations.length;q++){const R=N.animations[q],z=(0,t.c)("BABYLON.Animation");z&&v.animations.push(z.Parse(R))}y.c.ParseAnimationRanges(v,N,q)}return N.autoAnimate&&q.beginAnimation(v,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),void 0!==N.isEnabled&&v.Vb(N.isEnabled),v}_calculateHandednessMultiplier(){let N=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(N*=-1),N}}D._CreateDefaultParsedCamera=(N,q)=>{throw(0,x.b)("UniversalCamera")},D.PERSPECTIVE_CAMERA=0,D.ORTHOGRAPHIC_CAMERA=1,D.FOVMODE_VERTICAL_FIXED=0,D.FOVMODE_HORIZONTAL_FIXED=1,D.RIG_MODE_NONE=0,D.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,D.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,D.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,D.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,D.RIG_MODE_STEREOSCOPIC_INTERLACED=14,D.RIG_MODE_VR=20,D.RIG_MODE_CUSTOM=22,D.ForceAttachControlToAlwaysPreventDefault=!1,(0,z.c)([(0,v.C)("position")],D.prototype,"_position",void 0),(0,z.c)([(0,v.C)("upVector")],D.prototype,"_upVector",void 0),(0,z.c)([(0,v.D)()],D.prototype,"orthoLeft",null),(0,z.c)([(0,v.D)()],D.prototype,"orthoRight",null),(0,z.c)([(0,v.D)()],D.prototype,"orthoBottom",null),(0,z.c)([(0,v.D)()],D.prototype,"orthoTop",null),(0,z.c)([(0,v.D)()],D.prototype,"fov",void 0),(0,z.c)([(0,v.D)()],D.prototype,"projectionPlaneTilt",void 0),(0,z.c)([(0,v.D)()],D.prototype,"Wi",void 0),(0,z.c)([(0,v.D)()],D.prototype,"maxZ",void 0),(0,z.c)([(0,v.D)()],D.prototype,"inertia",void 0),(0,z.c)([(0,v.D)()],D.prototype,"mode",null),(0,z.c)([(0,v.D)()],D.prototype,"layerMask",void 0),(0,z.c)([(0,v.D)()],D.prototype,"fovMode",void 0),(0,z.c)([(0,v.D)()],D.prototype,"cameraRigMode",void 0),(0,z.c)([(0,v.D)()],D.prototype,"interaxialDistance",void 0),(0,z.c)([(0,v.D)()],D.prototype,"isStereoscopicSideBySide",void 0)},12064:(N,q,R)=>{"use strict";R.d(q,{c:()=>F,d:()=>S});var z=R(10907),v=R(11221),B=R(11452),F={};class S{constructor(N){this.attachedToElement=!1,this.attached={},this.camera=N,this.checkInputs=()=>{}}add(N){const q=N.getSimpleName();this.attached[q]?z.c.Warn("camera input of type "+q+" already exists on camera"):(this.attached[q]=N,N.camera=this.camera,N.checkInputs&&(this.checkInputs=this._addCheckInputs(N.checkInputs.bind(N))),this.attachedToElement&&N.attachControl(this.noPreventDefault))}remove(N){for(const q in this.attached){const R=this.attached[q];if(R===N)return R.Si(),R.camera=null,delete this.attached[q],void this.rebuildInputCheck()}}removeByType(N){for(const q in this.attached){const R=this.attached[q];R.getClassName()===N&&(R.Si(),R.camera=null,delete this.attached[q],this.rebuildInputCheck())}}_addCheckInputs(N){const q=this.checkInputs;return()=>{q(),N()}}attachInput(N){this.attachedToElement&&N.attachControl(this.noPreventDefault)}attachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){N=!B.e.ForceAttachControlToAlwaysPreventDefault&&N,this.attachedToElement=!0,this.noPreventDefault=N;for(const q in this.attached)this.attached[q].attachControl(N)}}detachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const q in this.attached)this.attached[q].Si(),N&&(this.attached[q].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const N in this.attached){const q=this.attached[N];q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(N){const q={};for(const R in this.attached){const N=this.attached[R],z=v.e.Serialize(N);q[N.getClassName()]=z}N.inputsmgr=q}parse(N){const q=N.inputsmgr;if(q){this.clear();for(const N in q){const R=F[N];if(R){const z=q[N],B=v.e.Parse((()=>new R),z,null);this.add(B)}}}else for(const R in this.attached){const q=F[this.attached[R].getClassName()];if(q){const z=v.e.Parse((()=>new q),N,null);this.remove(this.attached[R]),this.add(z)}}}}},12055:(N,q,R)=>{"use strict";R.d(q,{e:()=>X});var z=R(11147),v=R(11151),B=R(11181),F=R(12059),S=R(12064),A=R(11289),y=R(10888);class E{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(N){N=y.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const R=q.event;if(!R.metaKey)if(q.type===A.c.KEYDOWN){if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysUpward.indexOf(R.keyCode)||-1!==this.keysDownward.indexOf(R.keyCode)||-1!==this.keysRotateLeft.indexOf(R.keyCode)||-1!==this.keysRotateRight.indexOf(R.keyCode)||-1!==this.keysRotateUp.indexOf(R.keyCode)||-1!==this.keysRotateDown.indexOf(R.keyCode)){-1===this._keys.indexOf(R.keyCode)&&this._keys.push(R.keyCode),N||R.preventDefault()}}else if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysUpward.indexOf(R.keyCode)||-1!==this.keysDownward.indexOf(R.keyCode)||-1!==this.keysRotateLeft.indexOf(R.keyCode)||-1!==this.keysRotateRight.indexOf(R.keyCode)||-1!==this.keysRotateUp.indexOf(R.keyCode)||-1!==this.keysRotateDown.indexOf(R.keyCode)){const q=this._keys.indexOf(R.keyCode);q>=0&&this._keys.splice(q,1),N||R.preventDefault()}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let q=0;q<this._keys.length;q++){const R=this._keys[q],z=N._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(R)?N._localDirection.qe(-z,0,0):-1!==this.keysUp.indexOf(R)?N._localDirection.qe(0,0,z):-1!==this.keysRight.indexOf(R)?N._localDirection.qe(z,0,0):-1!==this.keysDown.indexOf(R)?N._localDirection.qe(0,0,-z):-1!==this.keysUpward.indexOf(R)?N._localDirection.qe(0,z,0):-1!==this.keysDownward.indexOf(R)?N._localDirection.qe(0,-z,0):-1!==this.keysRotateLeft.indexOf(R)?(N._localDirection.qe(0,0,0),N.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(R)?(N._localDirection.qe(0,0,0),N.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(R)?(N._localDirection.qe(0,0,0),N.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(R)&&(N._localDirection.qe(0,0,0),N.cameraRotation.x+=this._getLocalRotation()),N.va().useRightHandedSystem&&(N._localDirection.z*=-1),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),B.m.TransformNormalToRef(N._localDirection,N._cameraTransformMatrix,N._transformedDirection),N.cameraDirection.addInPlace(N._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const N=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*N}}(0,z.c)([(0,v.D)()],E.prototype,"keysUp",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysUpward",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysDown",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysDownward",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysLeft",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysRight",void 0),(0,z.c)([(0,v.D)()],E.prototype,"rotationSpeed",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysRotateLeft",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysRotateRight",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysRotateUp",void 0),(0,z.c)([(0,v.D)()],E.prototype,"keysRotateDown",void 0),S.c.FreeCameraKeyboardMoveInput=E;var t=R(10893),x=R(11286);class e{constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=N,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new t.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(N){N=y.f.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),R=q.getInputElement();this._pointerInput||(this._pointerInput=z=>{const v=z.event,B="touch"===v.pointerType;if(!this.touchEnabled&&B)return;if(z.type!==x.e.POINTERMOVE&&-1===this.buttons.indexOf(v.button))return;const F=v.target;if(z.type===x.e.POINTERDOWN){if(B&&-1!==this._activePointerId||!B&&-1!==this._currentActiveButton)return;this._activePointerId=v.pointerId;try{null===F||void 0===F||F.setPointerCapture(v.pointerId)}catch(S){}-1===this._currentActiveButton&&(this._currentActiveButton=v.button),this._previousPosition={x:v.clientX,y:v.clientY},N||(v.preventDefault(),R&&R.focus()),q.isPointerLock&&this._onMouseMove&&this._onMouseMove(z.event)}else if(z.type===x.e.POINTERUP){if(B&&this._activePointerId!==v.pointerId||!B&&this._currentActiveButton!==v.button)return;try{null===F||void 0===F||F.releasePointerCapture(v.pointerId)}catch(S){}this._currentActiveButton=-1,this._previousPosition=null,N||v.preventDefault(),this._activePointerId=-1}else if(z.type===x.e.POINTERMOVE&&(this._activePointerId===v.pointerId||!B))if(q.isPointerLock&&this._onMouseMove)this._onMouseMove(z.event);else if(this._previousPosition){const q=this.camera._calculateHandednessMultiplier(),R=(v.clientX-this._previousPosition.x)*q,z=v.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=R/this.angularSensibility,this.camera.cameraRotation.x+=z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:R,offsetY:z}),this._previousPosition={x:v.clientX,y:v.clientY},N||v.preventDefault()}}),this._onMouseMove=R=>{if(!q.isPointerLock)return;const z=this.camera._calculateHandednessMultiplier(),v=R.movementX*z;this.camera.cameraRotation.y+=v/this.angularSensibility;const B=R.movementY;this.camera.cameraRotation.x+=B/this.angularSensibility,this._previousPosition=null,N||R.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,x.e.POINTERDOWN|x.e.POINTERUP|x.e.POINTERMOVE),R&&(this._contextMenuBind=N=>this.onContextMenu(N),R.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(N){N.preventDefault()}Si(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,z.c)([(0,v.D)()],e.prototype,"buttons",void 0),(0,z.c)([(0,v.D)()],e.prototype,"angularSensibility",void 0),S.c.FreeCameraMouseInput=e;var b,f=R(11296);class D{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new t.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(N){N=y.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==x.e.POINTERWHEEL)return;const R=q.event,z=R.deltaMode===f.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*z*R.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*z*R.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*z*R.deltaZ/this._normalize,R.preventDefault&&(N||R.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,x.e.POINTERWHEEL)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,z.c)([(0,v.D)()],D.prototype,"wheelPrecisionX",void 0),(0,z.c)([(0,v.D)()],D.prototype,"wheelPrecisionY",void 0),(0,z.c)([(0,v.D)()],D.prototype,"wheelPrecisionZ",void 0),function(N){N[N.MoveRelative=0]="MoveRelative",N[N.RotateRelative=1]="RotateRelative",N[N.MoveScene=2]="MoveScene"}(b||(b={}));class V extends D{constructor(){super(...arguments),this._moveRelative=B.m.Zero(),this._rotateRelative=B.m.Zero(),this._moveScene=B.m.Zero(),this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(N){null===N&&this._wheelXAction!==b.MoveRelative||(this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=N)}get wheelXMoveRelative(){return this._wheelXAction!==b.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(N){null===N&&this._wheelYAction!==b.MoveRelative||(this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=N)}get wheelYMoveRelative(){return this._wheelYAction!==b.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(N){null===N&&this._wheelZAction!==b.MoveRelative||(this._wheelZAction=b.MoveRelative,this._wheelZActionCoordinate=N)}get wheelZMoveRelative(){return this._wheelZAction!==b.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(N){null===N&&this._wheelXAction!==b.RotateRelative||(this._wheelXAction=b.RotateRelative,this._wheelXActionCoordinate=N)}get wheelXRotateRelative(){return this._wheelXAction!==b.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(N){null===N&&this._wheelYAction!==b.RotateRelative||(this._wheelYAction=b.RotateRelative,this._wheelYActionCoordinate=N)}get wheelYRotateRelative(){return this._wheelYAction!==b.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(N){null===N&&this._wheelZAction!==b.RotateRelative||(this._wheelZAction=b.RotateRelative,this._wheelZActionCoordinate=N)}get wheelZRotateRelative(){return this._wheelZAction!==b.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(N){null===N&&this._wheelXAction!==b.MoveScene||(this._wheelXAction=b.MoveScene,this._wheelXActionCoordinate=N)}get wheelXMoveScene(){return this._wheelXAction!==b.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(N){null===N&&this._wheelYAction!==b.MoveScene||(this._wheelYAction=b.MoveScene,this._wheelYActionCoordinate=N)}get wheelYMoveScene(){return this._wheelYAction!==b.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(N){null===N&&this._wheelZAction!==b.MoveScene||(this._wheelZAction=b.MoveScene,this._wheelZActionCoordinate=N)}get wheelZMoveScene(){return this._wheelZAction!==b.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.oe(0),this._rotateRelative.oe(0),this._moveScene.oe(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const N=B.d.Zero();this.camera.getViewMatrix().invertToRef(N);const q=B.m.Zero();B.m.TransformNormalToRef(this._moveRelative,N,q),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(q),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(N,q,R){if(0===N)return;if(null===q||null===R)return;let z=null;switch(q){case b.MoveRelative:z=this._moveRelative;break;case b.RotateRelative:z=this._rotateRelative;break;case b.MoveScene:z=this._moveScene}switch(R){case 0:z.set(N,0,0);break;case 1:z.set(0,N,0);break;case 2:z.set(0,0,N)}}}(0,z.c)([(0,v.D)()],V.prototype,"wheelXMoveRelative",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelYMoveRelative",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelZMoveRelative",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelXRotateRelative",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelYRotateRelative",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelZRotateRelative",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelXMoveScene",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelYMoveScene",null),(0,z.c)([(0,v.D)()],V.prototype,"wheelZMoveScene",null),S.c.FreeCameraMouseWheelInput=V;class H{constructor(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=N,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=y.f.IsSafari()}attachControl(N){N=y.f.BackCompatCameraNoPreventDefault(arguments);let q=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=R=>{const z=R.event,v="mouse"===z.pointerType||this._isSafari&&"undefined"===typeof z.pointerType;if(this.allowMouse||!v)if(R.type===x.e.POINTERDOWN){if(N||z.preventDefault(),this._pointerPressed.push(z.pointerId),1!==this._pointerPressed.length)return;q={x:z.clientX,y:z.clientY}}else if(R.type===x.e.POINTERUP){N||z.preventDefault();const R=this._pointerPressed.indexOf(z.pointerId);if(-1===R)return;if(this._pointerPressed.splice(R,1),0!=R)return;q=null,this._offsetX=null,this._offsetY=null}else if(R.type===x.e.POINTERMOVE){if(N||z.preventDefault(),!q)return;if(0!=this._pointerPressed.indexOf(z.pointerId))return;this._offsetX=z.clientX-q.x,this._offsetY=-(z.clientY-q.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,x.e.POINTERDOWN|x.e.POINTERUP|x.e.POINTERMOVE),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.addEventListener("blur",this._onLostFocus)}}Si(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const N=this.camera,q=N._calculateHandednessMultiplier();N.cameraRotation.y=q*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)N.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const q=N._computeLocalCameraSpeed(),R=new B.m(0,0,0!==this.touchMoveSensibility?q*this._offsetY/this.touchMoveSensibility:0);B.d.RotationYawPitchRollToRef(N.rotation.y,N.rotation.x,0,N._cameraRotationMatrix),N.cameraDirection.addInPlace(B.m.TransformCoordinates(R,N._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,z.c)([(0,v.D)()],H.prototype,"touchAngularSensibility",void 0),(0,z.c)([(0,v.D)()],H.prototype,"touchMoveSensibility",void 0),S.c.FreeCameraTouchInput=H;class Y extends S.d{constructor(N){super(N),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new E),this}addMouse(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new e(N),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new V,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new H),this}clear(){super.clear(),this._mouseInput=null}}var T=R(11002),L=R(10957);class X extends F.e{get angularSensibility(){const N=this.inputs.attached.mouse;return N?N.angularSensibility:0}set angularSensibility(N){const q=this.inputs.attached.mouse;q&&(q.angularSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const q=this.inputs.attached.keyboard;q&&(q.keysUp=N)}get keysUpward(){const N=this.inputs.attached.keyboard;return N?N.keysUpward:[]}set keysUpward(N){const q=this.inputs.attached.keyboard;q&&(q.keysUpward=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const q=this.inputs.attached.keyboard;q&&(q.keysDown=N)}get keysDownward(){const N=this.inputs.attached.keyboard;return N?N.keysDownward:[]}set keysDownward(N){const q=this.inputs.attached.keyboard;q&&(q.keysDownward=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const q=this.inputs.attached.keyboard;q&&(q.keysRight=N)}get keysRotateLeft(){const N=this.inputs.attached.keyboard;return N?N.keysRotateLeft:[]}set keysRotateLeft(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateLeft=N)}get keysRotateRight(){const N=this.inputs.attached.keyboard;return N?N.keysRotateRight:[]}set keysRotateRight(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateRight=N)}get keysRotateUp(){const N=this.inputs.attached.keyboard;return N?N.keysRotateUp:[]}set keysRotateUp(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateUp=N)}get keysRotateDown(){const N=this.inputs.attached.keyboard;return N?N.keysRotateDown:[]}set keysRotateDown(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateDown=N)}constructor(N,q,R){var z;super(N,q,R,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),z=this,this.ellipsoid=new B.m(.5,1,.5),this.ellipsoidOffset=new B.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=B.m.Zero(),this._diffPosition=B.m.Zero(),this._newPosition=B.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z._newPosition.p(q),z._newPosition.subtractToRef(z._oldPosition,z._diffPosition),z._diffPosition.length()>L.d.CollisionsEpsilon&&(z.position.addToRef(z._diffPosition,z._deferredPositionUpdate),z._deferOnly?z._deferredUpdated=!0:z.position.p(z._deferredPositionUpdate),z.Ik&&R&&z.Ik(R))},this.inputs=new Y(this),this.inputs.addKeyboard().addMouse()}attachControl(N,q){q=y.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(q)}Si(){this.inputs.detachElement(),this.cameraDirection=new B.m(0,0,0),this.cameraRotation=new B.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(N){this._collisionMask=isNaN(N)?-1:N}_collideWithWorld(N){let q;q=this.parent?B.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,q.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const R=this.va().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let z=N;this.applyGravity&&(z=N.add(this.va().gravity)),R.getNewPosition(this._oldPosition,z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=B.m.Zero(),this._transformedDirection=B.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(N){this._needMoveForGravity=N}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,z.c)([(0,v.C)()],X.prototype,"ellipsoid",void 0),(0,z.c)([(0,v.C)()],X.prototype,"ellipsoidOffset",void 0),(0,z.c)([(0,v.D)()],X.prototype,"checkCollisions",void 0),(0,z.c)([(0,v.D)()],X.prototype,"applyGravity",void 0),(0,T.f)("BABYLON.FreeCamera",X)},12059:(N,q,R)=>{"use strict";R.d(q,{e:()=>y});var z=R(11147),v=R(11151),B=R(11452),F=R(11181),S=R(11186),A=R(11495);R(11454).c.AddNodeConstructor("TargetCamera",((N,q)=>()=>new y(N,F.m.Zero(),q)));class y extends B.e{constructor(N,q,R){super(N,q,R,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=F.m.Zero(),this._tmpTargetVector=F.m.Zero(),this.cameraDirection=new F.m(0,0,0),this.cameraRotation=new F.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new F.g,this.rotation=new F.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=F.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=F.d.Zero(),this._camMatrix=F.d.Zero(),this._cameraTransformMatrix=F.d.Zero(),this._cameraRotationMatrix=F.d.Zero(),this._referencePoint=new F.m(0,0,1),this._transformedReferencePoint=F.m.Zero(),this._deferredPositionUpdate=new F.m,this._deferredRotationQuaternionUpdate=new F.g,this._deferredRotationUpdate=new F.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=F.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(N){this.getWorldMatrix();const q=this.getTarget().gd(this.position);return q.normalize(),q.scaleInPlace(N),this.globalPosition.add(q)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const N=this.lockedTarget;N.Oj().getTranslationToRef(N.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.qe(0,0,0),this.cameraRotation.qe(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new F.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(N){N||super._updateCache();const q=this._getLockedTargetPosition();q?this._cache.lockedTarget?this._cache.lockedTarget.p(q):this._cache.lockedTarget=q.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const N=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(N):!N)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const N=this.getEngine();return this.speed*Math.sqrt(N.getDeltaTime()/(100*N.getFps()))}setTarget(N){this.upVector.normalize(),this._initialFocalDistance=N.gd(this.position).length(),this.position.z===N.z&&(this.position.z+=S.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),F.d.LookAtLHToRef(this.position,N,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const q=N.gd(this.position);q.x>=0?this.rotation.y=-Math.atan(q.z/q.x)+Math.PI/2:this.rotation.y=-Math.atan(q.z/q.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&F.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(N){this.setTarget(N)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(F.k.Matrix[0]),F.m.TransformNormalToRef(this.cameraDirection,F.k.Matrix[0],F.k.o[0]),this._deferredPositionUpdate.addInPlace(F.k.o[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const N=this.invertRotation?-this.inverseRotationSpeed:1,q=this._decideIfNeedsToMove(),R=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),q&&this._updatePosition(),R){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*N,this._deferredRotationUpdate.y+=this.cameraRotation.y*N,!this.noRotationConstraint){const N=1.570796;this._deferredRotationUpdate.x>N&&(this._deferredRotationUpdate.x=N),this._deferredRotationUpdate.x<-N&&(this._deferredRotationUpdate.x=-N)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(F.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}q&&(Math.abs(this.cameraDirection.x)<this.speed*S.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*S.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*S.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),R&&(Math.abs(this.cameraRotation.x)<this.speed*S.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*S.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):F.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return F.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),F.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?A.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(F.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),A.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(N,q,R){if(this.ignoreParentScaling){if(this.parent){const z=this.parent.getWorldMatrix();F.m.TransformCoordinatesToRef(N,z,this._globalPosition),F.m.TransformCoordinatesToRef(q,z,this._tmpTargetVector),F.m.TransformNormalToRef(R,z,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(N),this._tmpTargetVector.p(q),this._tmpUpVector.p(R);this.va().useRightHandedSystem?F.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):F.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?F.d.LookAtRHToRef(N,q,R,this._viewMatrix):F.d.LookAtLHToRef(N,q,R,this._viewMatrix),this.parent){const N=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(N,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(N)}createRigCamera(N,q){if(this.cameraRigMode!==B.e.RIG_MODE_NONE){const q=new y(N,this.position.clone(),this.va());return q.isRigCamera=!0,q.rigParent=this,this.cameraRigMode===B.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new F.g),q._cameraRigParams={},q.rotationQuaternion=new F.g),q.mode=this.mode,q.orthoLeft=this.orthoLeft,q.orthoRight=this.orthoRight,q.orthoTop=this.orthoTop,q.orthoBottom=this.orthoBottom,q}return null}_updateRigCameras(){const N=this._rigCameras[0],q=this._rigCameras[1];switch(this.Oj(),this.cameraRigMode){case B.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case B.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const R=this.cameraRigMode===B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,z=this.cameraRigMode===B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*R,N),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*z,q);break}case B.e.RIG_MODE_VR:N.rotationQuaternion?(N.rotationQuaternion.p(this.rotationQuaternion),q.rotationQuaternion.p(this.rotationQuaternion)):(N.rotation.p(this.rotation),q.rotation.p(this.rotation)),N.position.p(this.position),q.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(N,q){this.getTarget().subtractToRef(this.position,y._TargetFocalPoint),y._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const R=y._TargetFocalPoint.addInPlace(this.position);F.d.TranslationToRef(-R.x,-R.y,-R.z,y._TargetTransformMatrix),y._TargetTransformMatrix.multiplyToRef(F.d.RotationAxis(q.upVector,N),y._RigCamTransformMatrix),F.d.TranslationToRef(R.x,R.y,R.z,y._TargetTransformMatrix),y._RigCamTransformMatrix.multiplyToRef(y._TargetTransformMatrix,y._RigCamTransformMatrix),F.m.TransformCoordinatesToRef(this.position,y._RigCamTransformMatrix,q.position),q.setTarget(R)}getClassName(){return"TargetCamera"}}y._RigCamTransformMatrix=new F.d,y._TargetTransformMatrix=new F.d,y._TargetFocalPoint=new F.m,(0,z.c)([(0,v.C)()],y.prototype,"rotation",void 0),(0,z.c)([(0,v.D)()],y.prototype,"speed",void 0),(0,z.c)([(0,v.s)("lockedTargetId")],y.prototype,"lockedTarget",void 0)},11338:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{constructor(N,q,R){this.bu=N,this.bv=q,this.distance=R,this.faceId=0,this.subMeshId=0}}},11242:(N,q,R)=>{"use strict";R.d(q,{b:()=>B});var z=R(11181),v=R(11251);class B{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var N;let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||R&&!this.pickedMesh.isVerticesDataPresent(v.h.NormalKind))return null;let B,F=this.pickedMesh.gg();0===(null===(N=F)||void 0===N?void 0:N.length)&&(F=null);const S=z.k.o[0],A=z.k.o[1],y=z.k.o[2];if(R){const N=this.pickedMesh.getVerticesData(v.h.NormalKind);let q=F?z.m.FromArrayToRef(N,3*F[3*this.faceId],S):S.qe(N[3*this.faceId*3],N[3*this.faceId*3+1],N[3*this.faceId*3+2]),R=F?z.m.FromArrayToRef(N,3*F[3*this.faceId+1],A):A.qe(N[3*(3*this.faceId+1)],N[3*(3*this.faceId+1)+1],N[3*(3*this.faceId+1)+2]),E=F?z.m.FromArrayToRef(N,3*F[3*this.faceId+2],y):y.qe(N[3*(3*this.faceId+2)],N[3*(3*this.faceId+2)+1],N[3*(3*this.faceId+2)+2]);q=q.scale(this.bu),R=R.scale(this.bv),E=E.scale(1-this.bu-this.bv),B=new z.m(q.x+R.x+E.x,q.y+R.y+E.y,q.z+R.z+E.z)}else{const N=this.pickedMesh.getVerticesData(v.h.PositionKind),q=F?z.m.FromArrayToRef(N,3*F[3*this.faceId],S):S.qe(N[3*this.faceId*3],N[3*this.faceId*3+1],N[3*this.faceId*3+2]),R=F?z.m.FromArrayToRef(N,3*F[3*this.faceId+1],A):A.qe(N[3*(3*this.faceId+1)],N[3*(3*this.faceId+1)+1],N[3*(3*this.faceId+1)+2]),E=F?z.m.FromArrayToRef(N,3*F[3*this.faceId+2],y):y.qe(N[3*(3*this.faceId+2)],N[3*(3*this.faceId+2)+1],N[3*(3*this.faceId+2)+2]),t=q.gd(R),x=E.gd(R);B=z.m.Cross(t,x)}const E=(N,q)=>{let R=N.getWorldMatrix();N.nonUniformScaling&&(z.k.Matrix[0].p(R),R=z.k.Matrix[0],R.setTranslationFromFloats(0,0,0),R.invert(),R.transposeToRef(z.k.Matrix[1]),R=z.k.Matrix[1]),z.m.TransformNormalToRef(q,R,q)};if(q&&E(this.pickedMesh,B),this.ray){const N=z.k.o[0].p(B);q||E(this.pickedMesh,N),z.m.Dot(N,this.ray.direction)>0&&B.negateInPlace()}return B.normalize(),B}getTextureCoordinates(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.h.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(N))return null;const q=this.pickedMesh.gg();if(!q)return null;const R=this.pickedMesh.getVerticesData(N);if(!R)return null;let B=z.l.Zg(R,2*q[3*this.faceId]),F=z.l.Zg(R,2*q[3*this.faceId+1]),S=z.l.Zg(R,2*q[3*this.faceId+2]);return B=B.scale(this.bu),F=F.scale(this.bv),S=S.scale(1-this.bu-this.bv),new z.l(B.x+F.x+S.x,B.y+F.y+S.y)}}},11414:(N,q,R)=>{"use strict";R.d(q,{b:()=>z});let z=!1},12600:(N,q,R)=>{"use strict";R.d(q,{e:()=>B});var z=R(11167),v=R(12602);class B{constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=R,this.mi=[],this._maxBlockCapacity=q||64,this._selectionContent=new z.e(1024),this._creationFunc=N}update(N,q,R){v.c._CreateBlocks(N,q,R,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}li(N){for(let q=0;q<this.Gh.length;q++){this.Gh[q].addEntry(N)}}Ud(N){for(let q=0;q<this.Gh.length;q++){this.Gh[q].removeEntry(N)}}select(N,q){this._selectionContent.reset();for(let R=0;R<this.Gh.length;R++){this.Gh[R].select(N,this._selectionContent,q)}return q?this._selectionContent.concat(this.mi):this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}intersects(N,q,R){this._selectionContent.reset();for(let z=0;z<this.Gh.length;z++){this.Gh[z].intersects(N,q,this._selectionContent,R)}return R?this._selectionContent.concat(this.mi):this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}intersectsRay(N){this._selectionContent.reset();for(let q=0;q<this.Gh.length;q++){this.Gh[q].intersectsRay(N,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}}B.CreationFuncForMeshes=(N,q)=>{const R=N.getBoundingInfo();!N.isBlocked&&R.boundingBox.intersectsMinMax(q.qi,q.ri)&&q.entries.push(N)},B.CreationFuncForSubMeshes=(N,q)=>{N.getBoundingInfo().boundingBox.intersectsMinMax(q.qi,q.ri)&&q.entries.push(N)}},12602:(N,q,R)=>{"use strict";R.d(q,{c:()=>B});var z=R(11181),v=R(11350);class B{constructor(N,q,R,z,v,B){this.entries=[],this.si=new Array,this._capacity=R,this._depth=z,this._maxDepth=v,this._creationFunc=B,this._minPoint=N,this._maxPoint=q,this.si.push(N.clone()),this.si.push(q.clone()),this.si.push(N.clone()),this.si[2].x=q.x,this.si.push(N.clone()),this.si[3].y=q.y,this.si.push(N.clone()),this.si[4].z=q.z,this.si.push(q.clone()),this.si[5].z=N.z,this.si.push(q.clone()),this.si[6].x=N.x,this.si.push(q.clone()),this.si[7].y=N.y}get rb(){return this._capacity}get qi(){return this._minPoint}get ri(){return this._maxPoint}addEntry(N){if(this.Gh)for(let q=0;q<this.Gh.length;q++){this.Gh[q].addEntry(N)}else this._creationFunc(N,this),this.entries.length>this.rb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(N){if(this.Gh){for(let q=0;q<this.Gh.length;q++){this.Gh[q].removeEntry(N)}return}const q=this.entries.indexOf(N);q>-1&&this.entries.splice(q,1)}addEntries(N){for(let q=0;q<N.length;q++){const R=N[q];this.addEntry(R)}}select(N,q,R){if(v.b.IsInFrustum(this.si,N)){if(this.Gh){for(let z=0;z<this.Gh.length;z++){this.Gh[z].select(N,q,R)}return}R?q.concat(this.entries):q.concatWithNoDuplicate(this.entries)}}intersects(N,q,R,z){if(v.b.IntersectsSphere(this._minPoint,this._maxPoint,N,q)){if(this.Gh){for(let v=0;v<this.Gh.length;v++){this.Gh[v].intersects(N,q,R,z)}return}z?R.concat(this.entries):R.concatWithNoDuplicate(this.entries)}}intersectsRay(N,q){if(N.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Gh){for(let R=0;R<this.Gh.length;R++){this.Gh[R].intersectsRay(N,q)}return}q.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){B._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(N,q,R,v,F,S,A,y){A.Gh=new Array;const E=new z.m((q.x-N.x)/2,(q.y-N.y)/2,(q.z-N.z)/2);for(let z=0;z<2;z++)for(let q=0;q<2;q++)for(let t=0;t<2;t++){const x=N.add(E.multiplyByFloats(z,q,t)),e=N.add(E.multiplyByFloats(z+1,q+1,t+1)),b=new B(x,e,v,F+1,S,y);b.addEntries(R),A.Gh.push(b)}}}},12609:(N,q,R)=>{"use strict";R.d(q,{c:()=>E});var z=R(11172),v=R(11181),B=R(11481),F=R(11831),S=R(11282),A=R(12600),y=R(10933);z.b.prototype.createOrUpdateSelectionOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,R=this._getComponent(S.c.NAME_OCTREE);R||(R=new E(this),this.gb(R)),this.ji||(this.ji=new A.e(A.e.CreationFuncForMeshes,N,q));const z=this.getWorldExtends();return this.ji.update(z.min,z.max,this.meshes),this.ji},Object.defineProperty(z.b.prototype,"selectionOctree",{get:function(){return this.ji},enumerable:!0,configurable:!0}),B.e.prototype.createOrUpdateSubmeshesOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const R=this.va();let z=R._getComponent(S.c.NAME_OCTREE);z||(z=new E(R),R.gb(z)),this._submeshesOctree||(this._submeshesOctree=new A.e(A.e.CreationFuncForSubMeshes,N,q)),this.Oj(!0);const v=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(v.minimumWorld,v.maximumWorld,this.lg),this._submeshesOctree};class E{constructor(N){this.name=S.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new F.c(v.m.Zero(),new v.m(1,1,1)),(N=N||y.b.LastCreatedScene)&&(this.Xd=N,this.Xd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Xd.getActiveSubMeshCandidates=N=>this.getActiveSubMeshCandidates(N),this.Xd.getCollidingSubMeshCandidates=(N,q)=>this.getCollidingSubMeshCandidates(N,q),this.Xd.getIntersectingSubMeshCandidates=(N,q)=>this.getIntersectingSubMeshCandidates(N,q))}register(){this.Xd.onMeshRemovedObservable.add((N=>{const q=this.Xd.selectionOctree;if(void 0!==q&&null!==q){const R=q.mi.indexOf(N);-1!==R&&q.mi.splice(R,1)}})),this.Xd.onMeshImportedObservable.add((N=>{const q=this.Xd.selectionOctree;void 0!==q&&null!==q&&q.li(N)}))}getActiveMeshCandidates(){var N;return(null===(N=this.Xd.ji)||void 0===N?void 0:N.select(this.Xd.frustumPlanes))||this.Xd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(N){if(N._submeshesOctree&&N.useOctreeForRenderingSelection){return N._submeshesOctree.select(this.Xd.frustumPlanes)}return this.Xd._getDefaultSubMeshCandidates(N)}getIntersectingSubMeshCandidates(N,q){if(N._submeshesOctree&&N.useOctreeForPicking){F.c.TransformToRef(q,N.getWorldMatrix(),this._tempRay);return N._submeshesOctree.intersectsRay(this._tempRay)}return this.Xd._getDefaultSubMeshCandidates(N)}getCollidingSubMeshCandidates(N,q){if(N._submeshesOctree&&N.useOctreeForCollisions){const R=q._velocityWorldLength+Math.max(q._radius.x,q._radius.y,q._radius.z);return N._submeshesOctree.intersects(q._basePointWorld,R)}return this.Xd._getDefaultSubMeshCandidates(N)}rebuild(){}dispose(){}}},11350:(N,q,R)=>{"use strict";R.d(q,{b:()=>F});var z=R(11190),v=R(11181),B=R(11186);class F{constructor(N,q,R){this.vectors=(0,z.d)(8,v.m.Zero),this.center=v.m.Zero(),this.centerWorld=v.m.Zero(),this.extendSize=v.m.Zero(),this.extendSizeWorld=v.m.Zero(),this.directions=(0,z.d)(3,v.m.Zero),this.vectorsWorld=(0,z.d)(8,v.m.Zero),this.minimumWorld=v.m.Zero(),this.maximumWorld=v.m.Zero(),this.minimum=v.m.Zero(),this.maximum=v.m.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(N,q,R)}reConstruct(N,q,R){const z=N.x,B=N.y,F=N.z,S=q.x,A=q.y,y=q.z,E=this.vectors;this.minimum.qe(z,B,F),this.maximum.qe(S,A,y),E[0].qe(z,B,F),E[1].qe(S,A,y),E[2].qe(S,B,F),E[3].qe(z,A,F),E[4].qe(z,B,y),E[5].qe(S,A,F),E[6].qe(z,A,y),E[7].qe(S,B,y),q.addToRef(N,this.center).scaleInPlace(.5),q.subtractToRef(N,this.extendSize).scaleInPlace(.5),this._worldMatrix=R||v.d.IdentityReadOnly,this._update(this._worldMatrix)}scale(N){const q=F._TmpVector3,R=this.maximum.subtractToRef(this.minimum,q[0]),z=R.length();R.normalizeFromLength(z);const v=z*N,B=R.scaleInPlace(.5*v),S=this.center.subtractToRef(B,q[1]),A=this.center.addToRef(B,q[2]);return this.reConstruct(S,A,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(N){const q=this.minimumWorld,R=this.maximumWorld,z=this.directions,B=this.vectorsWorld,F=this.vectors;if(N.isIdentity()){q.p(this.minimum),R.p(this.maximum);for(let N=0;N<8;++N)B[N].p(F[N]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{q.oe(Number.MAX_VALUE),R.oe(-Number.MAX_VALUE);for(let z=0;z<8;++z){const S=B[z];v.m.TransformCoordinatesToRef(F[z],N,S),q.minimizeInPlace(S),R.maximizeInPlace(S)}R.subtractToRef(q,this.extendSizeWorld).scaleInPlace(.5),R.addToRef(q,this.centerWorld).scaleInPlace(.5)}v.m.FromArrayToRef(N.m,0,z[0]),v.m.FromArrayToRef(N.m,4,z[1]),v.m.FromArrayToRef(N.m,8,z[2]),this._worldMatrix=N}isInFrustum(N){return F.IsInFrustum(this.vectorsWorld,N)}isCompletelyInFrustum(N){return F.IsCompletelyInFrustum(this.vectorsWorld,N)}intersectsPoint(N){const q=this.minimumWorld,R=this.maximumWorld,z=q.x,v=q.y,F=q.z,S=R.x,A=R.y,y=R.z,E=N.x,t=N.y,x=N.z,e=-B.d;return!(S-E<e||e>E-z)&&(!(A-t<e||e>t-v)&&!(y-x<e||e>x-F))}intersectsSphere(N){return F.IntersectsSphere(this.minimumWorld,this.maximumWorld,N.centerWorld,N.radiusWorld)}intersectsMinMax(N,q){const R=this.minimumWorld,z=this.maximumWorld,v=R.x,B=R.y,F=R.z,S=z.x,A=z.y,y=z.z,E=N.x,t=N.y,x=N.z,e=q.x,b=q.y,f=q.z;return!(S<E||v>e)&&(!(A<t||B>b)&&!(y<x||F>f))}dispose(){var N,q;null===(N=this._drawWrapperFront)||void 0===N||N.dispose(),null===(q=this._drawWrapperBack)||void 0===q||q.dispose()}static Intersects(N,q){return N.intersectsMinMax(q.minimumWorld,q.maximumWorld)}static IntersectsSphere(N,q,R,z){const B=F._TmpVector3[0];v.m.ClampToRef(R,N,q,B);return v.m.DistanceSquared(R,B)<=z*z}static IsCompletelyInFrustum(N,q){for(let R=0;R<6;++R){const z=q[R];for(let q=0;q<8;++q)if(z.dotCoordinate(N[q])<0)return!1}return!0}static IsInFrustum(N,q){for(let R=0;R<6;++R){let z=!0;const v=q[R];for(let q=0;q<8;++q)if(v.dotCoordinate(N[q])>=0){z=!1;break}if(z)return!1}return!0}}F._TmpVector3=(0,z.d)(3,v.m.Zero)},11344:(N,q,R)=>{"use strict";R.d(q,{e:()=>t});var z=R(11190),v=R(11181),B=R(11350),F=R(11356);const S={min:0,max:0},A={min:0,max:0},y=(N,q,R)=>{const z=v.m.Dot(q.centerWorld,N),B=Math.abs(v.m.Dot(q.directions[0],N))*q.extendSize.x+Math.abs(v.m.Dot(q.directions[1],N))*q.extendSize.y+Math.abs(v.m.Dot(q.directions[2],N))*q.extendSize.z;R.min=z-B,R.max=z+B},E=(N,q,R)=>(y(N,q,S),y(N,R,A),!(S.min>A.max||A.min>S.max));class t{constructor(N,q,R){this._isLocked=!1,this.boundingBox=new B.b(N,q,R),this.boundingSphere=new F.e(N,q,R)}reConstruct(N,q,R){this.boundingBox.reConstruct(N,q,R),this.boundingSphere.reConstruct(N,q,R)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(N){this._isLocked=N}update(N){this._isLocked||(this.boundingBox._update(N),this.boundingSphere._update(N))}centerOn(N,q){const R=t._TmpVector3[0].p(N).pi(q),z=t._TmpVector3[1].p(N).addInPlace(q);return this.boundingBox.reConstruct(R,z,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(R,z,this.boundingBox.getWorldMatrix()),this}encapsulate(N){const q=v.m.Minimize(this.minimum,N),R=v.m.Maximize(this.maximum,N);return this.reConstruct(q,R,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(N){const q=v.k.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(q);const R=v.k.o[0];return v.m.TransformCoordinatesToRef(N.boundingBox.minimumWorld,q,R),this.encapsulate(R),v.m.TransformCoordinatesToRef(N.boundingBox.maximumWorld,q,R),this.encapsulate(R),this}scale(N){return this.boundingBox.scale(N),this.boundingSphere.scale(N),this}isInFrustum(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===q||3===q)&&this.boundingSphere.isCenterInFrustum(N))return!0;if(!this.boundingSphere.isInFrustum(N))return!1;return!(1!==q&&3!==q)||this.boundingBox.isInFrustum(N)}get diagonalLength(){const N=this.boundingBox;return N.maximumWorld.subtractToRef(N.minimumWorld,t._TmpVector3[0]).length()}isCompletelyInFrustum(N){return this.boundingBox.isCompletelyInFrustum(N)}_checkCollision(N){return N._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(N){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(N)&&!!this.boundingBox.intersectsPoint(N))}intersects(N,q){if(!F.e.Intersects(this.boundingSphere,N.boundingSphere))return!1;if(!B.b.Intersects(this.boundingBox,N.boundingBox))return!1;if(!q)return!0;const R=this.boundingBox,z=N.boundingBox;return!!E(R.directions[0],R,z)&&(!!E(R.directions[1],R,z)&&(!!E(R.directions[2],R,z)&&(!!E(z.directions[0],R,z)&&(!!E(z.directions[1],R,z)&&(!!E(z.directions[2],R,z)&&(!!E(v.m.Cross(R.directions[0],z.directions[0]),R,z)&&(!!E(v.m.Cross(R.directions[0],z.directions[1]),R,z)&&(!!E(v.m.Cross(R.directions[0],z.directions[2]),R,z)&&(!!E(v.m.Cross(R.directions[1],z.directions[0]),R,z)&&(!!E(v.m.Cross(R.directions[1],z.directions[1]),R,z)&&(!!E(v.m.Cross(R.directions[1],z.directions[2]),R,z)&&(!!E(v.m.Cross(R.directions[2],z.directions[0]),R,z)&&(!!E(v.m.Cross(R.directions[2],z.directions[1]),R,z)&&!!E(v.m.Cross(R.directions[2],z.directions[2]),R,z))))))))))))))}}t._TmpVector3=(0,z.d)(2,v.m.Zero)},11356:(N,q,R)=>{"use strict";R.d(q,{e:()=>B});var z=R(11190),v=R(11181);class B{constructor(N,q,R){this.center=v.m.Zero(),this.centerWorld=v.m.Zero(),this.minimum=v.m.Zero(),this.maximum=v.m.Zero(),this.reConstruct(N,q,R)}reConstruct(N,q,R){this.minimum.p(N),this.maximum.p(q);const z=v.m.Distance(N,q);q.addToRef(N,this.center).scaleInPlace(.5),this.radius=.5*z,this._update(R||v.d.IdentityReadOnly)}scale(N){const q=this.radius*N,R=B._TmpVector3,z=R[0].oe(q),v=this.center.subtractToRef(z,R[1]),F=this.center.addToRef(z,R[2]);return this.reConstruct(v,F,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(N){if(N.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{v.m.TransformCoordinatesToRef(this.center,N,this.centerWorld);const q=B._TmpVector3[0];v.m.TransformNormalFromFloatsToRef(1,1,1,N,q),this.radiusWorld=Math.max(Math.abs(q.x),Math.abs(q.y),Math.abs(q.z))*this.radius}}isInFrustum(N){const q=this.centerWorld,R=this.radiusWorld;for(let z=0;z<6;z++)if(N[z].dotCoordinate(q)<=-R)return!1;return!0}isCenterInFrustum(N){const q=this.centerWorld;for(let R=0;R<6;R++)if(N[R].dotCoordinate(q)<0)return!1;return!0}intersectsPoint(N){const q=v.m.DistanceSquared(this.centerWorld,N);return!(this.radiusWorld*this.radiusWorld<q)}static Intersects(N,q){const R=v.m.DistanceSquared(N.centerWorld,q.centerWorld),z=N.radiusWorld+q.radiusWorld;return!(z*z<R)}static CreateFromCenterAndRadius(N,q,R){this._TmpVector3[0].p(N),this._TmpVector3[1].qe(0,0,q),this._TmpVector3[2].p(N),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].pi(this._TmpVector3[1]);const z=new B(this._TmpVector3[0],this._TmpVector3[2]);return z._worldMatrix=R||v.d.Identity(),z}}B._TmpVector3=(0,z.d)(3,v.m.Zero)},11831:(N,q,R)=>{"use strict";R.d(q,{c:()=>e});var z=R(11172),v=R(11452),B=R(11186),F=R(11181),S=R(11190),A=R(11338),y=R(11242),E=R(10933),t=R(11301);const x={internalPickerForMesh:void 0};class e{constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.d;this.origin=N,this.direction=q,this.length=R,this.epsilon=z}clone(){return new e(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=e._TmpVector3[0].qe(N.x-R,N.y-R,N.z-R),v=e._TmpVector3[1].qe(q.x+R,q.y+R,q.z+R);let B,F,S,A,y=0,E=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<z.x||this.origin.x>v.x)return!1}else if(B=1/this.direction.x,F=(z.x-this.origin.x)*B,S=(v.x-this.origin.x)*B,S===-1/0&&(S=1/0),F>S&&(A=F,F=S,S=A),y=Math.max(F,y),E=Math.min(S,E),y>E)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<z.y||this.origin.y>v.y)return!1}else if(B=1/this.direction.y,F=(z.y-this.origin.y)*B,S=(v.y-this.origin.y)*B,S===-1/0&&(S=1/0),F>S&&(A=F,F=S,S=A),y=Math.max(F,y),E=Math.min(S,E),y>E)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<z.z||this.origin.z>v.z)return!1}else if(B=1/this.direction.z,F=(z.z-this.origin.z)*B,S=(v.z-this.origin.z)*B,S===-1/0&&(S=1/0),F>S&&(A=F,F=S,S=A),y=Math.max(F,y),E=Math.min(S,E),y>E)return!1;return!0}intersectsBox(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(N.minimum,N.maximum,q)}intersectsSphere(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=N.center.x-this.origin.x,z=N.center.y-this.origin.y,v=N.center.z-this.origin.z,B=R*R+z*z+v*v,F=N.radius+q,S=F*F;if(B<=S)return!0;const A=R*this.direction.x+z*this.direction.y+v*this.direction.z;if(A<0)return!1;return B-A*A<=S}intersectsTriangle(N,q,R){const z=e._TmpVector3[0],v=e._TmpVector3[1],B=e._TmpVector3[2],S=e._TmpVector3[3],y=e._TmpVector3[4];q.subtractToRef(N,z),R.subtractToRef(N,v),F.m.CrossToRef(this.direction,v,B);const E=F.m.Dot(z,B);if(0===E)return null;const t=1/E;this.origin.subtractToRef(N,S);const x=F.m.Dot(S,B)*t;if(x<-this.epsilon||x>1+this.epsilon)return null;F.m.CrossToRef(S,z,y);const b=F.m.Dot(this.direction,y)*t;if(b<-this.epsilon||x+b>1+this.epsilon)return null;const f=F.m.Dot(v,y)*t;return f>this.length?null:new A.d(1-x-b,x,f)}intersectsPlane(N){let q;const R=F.m.Dot(N.k,this.direction);if(Math.abs(R)<9.99999997475243e-7)return null;{const z=F.m.Dot(N.k,this.origin);return q=(-N.d-z)/R,q<0?q<-9.99999997475243e-7?null:0:q}}intersectsAxis(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(N){case"y":{const N=(this.origin.y-q)/this.direction.y;return N>0?null:new F.m(this.origin.x+this.direction.x*-N,q,this.origin.z+this.direction.z*-N)}case"x":{const N=(this.origin.x-q)/this.direction.x;return N>0?null:new F.m(q,this.origin.y+this.direction.y*-N,this.origin.z+this.direction.z*-N)}case"z":{const N=(this.origin.z-q)/this.direction.z;return N>0?null:new F.m(this.origin.x+this.direction.x*-N,this.origin.y+this.direction.y*-N,q)}default:return null}}intersectsMesh(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=F.k.Matrix[0];return N.getWorldMatrix().invertToRef(S),this._tmpRay?e.TransformToRef(this,S,this._tmpRay):this._tmpRay=e.Transform(this,S),N.intersects(this._tmpRay,q,R,z,v,B)}intersectsMeshes(N,q,R){R?R.length=0:R=[];for(let z=0;z<N.length;z++){const v=this.intersectsMesh(N[z],q);v.hit&&R.push(v)}return R.sort(this._comparePickingInfo),R}_comparePickingInfo(N,q){return N.distance<q.distance?-1:N.distance>q.distance?1:0}intersectionSegment(N,q,R){const z=this.origin,v=F.k.o[0],B=F.k.o[1],S=F.k.o[2],A=F.k.o[3];q.subtractToRef(N,v),this.direction.scaleToRef(e._Rayl,S),z.addToRef(S,B),N.subtractToRef(z,A);const y=F.m.Dot(v,v),E=F.m.Dot(v,S),t=F.m.Dot(S,S),x=F.m.Dot(v,A),b=F.m.Dot(S,A),f=y*t-E*E;let D,V,H=f,Y=f;f<e._Smallnum?(D=0,H=1,V=b,Y=t):(D=E*b-t*x,V=y*b-E*x,D<0?(D=0,V=b,Y=t):D>H&&(D=H,V=b+E,Y=t)),V<0?(V=0,-x<0?D=0:-x>y?D=H:(D=-x,H=y)):V>Y&&(V=Y,-x+E<0?D=0:-x+E>y?D=H:(D=-x+E,H=y));const T=Math.abs(D)<e._Smallnum?0:D/H,L=Math.abs(V)<e._Smallnum?0:V/Y,X=F.k.o[4];S.scaleToRef(L,X);const Q=F.k.o[5];v.scaleToRef(T,Q),Q.addInPlace(A);const h=F.k.o[6];Q.subtractToRef(X,h);return L>0&&L<=this.length&&h.lengthSquared()<R*R?Q.length():-1}update(N,q,R,z,v,B,S){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){e._RayDistant||(e._RayDistant=e.Zero()),e._RayDistant.unprojectRayToRef(N,q,R,z,F.d.IdentityReadOnly,B,S);const A=F.k.Matrix[0];v.invertToRef(A),e.TransformToRef(e._RayDistant,A,this)}else this.unprojectRayToRef(N,q,R,z,v,B,S);return this}static Zero(){return new e(F.m.Zero(),F.m.Zero())}static CreateNew(N,q,R,z,v,B,F){return e.Zero().update(N,q,R,z,v,B,F)}static CreateNewFromTo(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.d.IdentityReadOnly;const z=new e(new F.m(0,0,0),new F.m(0,0,0));return e.CreateFromToToRef(N,q,z,R)}static CreateFromToToRef(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.d.IdentityReadOnly;R.origin.p(N);const v=q.subtractToRef(N,R.direction),B=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);return R.length=B,R.direction.normalize(),e.TransformToRef(R,z,R)}static Transform(N,q){const R=new e(new F.m(0,0,0),new F.m(0,0,0));return e.TransformToRef(N,q,R),R}static TransformToRef(N,q,R){F.m.TransformCoordinatesToRef(N.origin,q,R.origin),F.m.TransformNormalToRef(N.direction,q,R.direction),R.length=N.length,R.epsilon=N.epsilon;const z=R.direction,v=z.length();if(0!==v&&1!==v){const N=1/v;z.x*=N,z.y*=N,z.z*=N,R.length*=v}return R}unprojectRayToRef(N,q,R,z,v,B,S){const A=F.k.Matrix[0];v.multiplyToRef(B,A),A.multiplyToRef(S,A),A.invert();const y=E.b.LastCreatedEngine,t=F.k.o[0];t.x=N/R*2-1,t.y=-(q/z*2-1),t.z=null!==y&&void 0!==y&&y.useReverseDepthBuffer?1:null!==y&&void 0!==y&&y.isNDCHalfZRange?0:-1;const x=F.k.o[1].qe(t.x,t.y,1-1e-8),e=F.k.o[2],b=F.k.o[3];F.m._UnprojectFromInvertedMatrixToRef(t,A,e),F.m._UnprojectFromInvertedMatrixToRef(x,A,b),this.origin.p(e),b.subtractToRef(e,this.direction),this.direction.normalize()}}function b(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=e.Zero();return f(N,q,R,z,F,v,B),F}function f(N,q,R,z,v,B){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const y=N.getEngine();if(!B&&!(B=N.activeCamera))return N;const E=B.viewport,t=y.getRenderHeight(),{x:x,y:e,width:b,height:f}=E.toGlobal(y.getRenderWidth(),t),D=1/y.getHardwareScalingLevel();return q=q*D-x,R=R*D-(t-e-f),v.update(q,R,b,f,z||F.d.IdentityReadOnly,S?F.d.IdentityReadOnly:B.getViewMatrix(),B.getProjectionMatrix(),A),N}function D(N,q,R,z,v){if(!y.b)return N;const B=N.getEngine();if(!v&&!(v=N.activeCamera))throw new Error("Active camera not set");const S=v.viewport,A=B.getRenderHeight(),{x:E,y:t,width:x,height:e}=S.toGlobal(B.getRenderWidth(),A),b=F.d.Identity(),f=1/B.getHardwareScalingLevel();return q=q*f-E,R=R*f-(A-t-e),z.update(q,R,x,e,b,b,v.getProjectionMatrix()),N}function V(N,q,R,z,v,B,F,S){const A=q(z,R.enableDistantPicking),y=R.intersects(A,v,F,B,z,S);return y&&y.hit?!v&&null!=N&&y.distance>=N.distance?null:y:null}function H(N,q,R,z,v,B){let S=null;const A=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),E=N.cameraToUseForPointers||N.activeCamera,t=x.internalPickerForMesh||V;for(let y=0;y<N.meshes.length;y++){const x=N.meshes[y];if(R){if(!R(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.Ub)continue;const e=A&&x.isWorldMatrixCameraDependent(),b=x.Oj(e,E);if(x.hasThinInstances&&x.thinInstanceEnablePicking){const N=t(S,q,x,b,!0,!0,B);if(N){if(v)return N;const A=F.k.Matrix[1],y=x.thinInstanceGetWorldMatrices();for(let N=0;N<y.length;N++){if(R&&!R(x,N))continue;y[N].multiplyToRef(b,A);const F=t(S,q,x,A,z,v,B,!0);if(F&&(S=F,S.thinInstanceIndex=N,z))return S}}}else{const N=t(S,q,x,b,z,v,B);if(N&&(S=N,z))return S}}return S||new y.b}function Y(N,q,R,z){if(!y.b)return null;const v=[],B=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),S=N.cameraToUseForPointers||N.activeCamera,A=x.internalPickerForMesh||V;for(let y=0;y<N.meshes.length;y++){const E=N.meshes[y];if(R){if(!R(E,-1))continue}else if(!E.isEnabled()||!E.isVisible||!E.Ub)continue;const t=B&&E.isWorldMatrixCameraDependent(),x=E.Oj(t,S);if(E.hasThinInstances&&E.thinInstanceEnablePicking){if(A(null,q,E,x,!0,!0,z)){const N=F.k.Matrix[1],B=E.thinInstanceGetWorldMatrices();for(let F=0;F<B.length;F++){if(R&&!R(E,F))continue;B[F].multiplyToRef(x,N);const S=A(null,q,E,N,!1,!1,z,!0);S&&(S.thinInstanceIndex=F,v.push(S))}}}else{const N=A(null,q,E,x,!1,!1,z);N&&v.push(N)}}return v}function T(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0;z||(z=N.getWorldMatrix()),q.length=R,v?q.origin.p(v):q.origin.p(N.position);const B=F.k.o[2];B.set(0,0,N._scene.useRightHandedSystem?-1:1);const S=F.k.o[3];return F.m.TransformNormalToRef(B,z,S),F.m.NormalizeToRef(S,q.direction),q}var L,X;e._TmpVector3=(0,S.d)(6,F.m.Zero),e._RayDistant=e.Zero(),e._Smallnum=1e-8,e._Rayl=1e9,L=z.b,(X=v.e)&&(X.prototype.getForwardRay=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;return T(this,new e(F.m.Zero(),F.m.Zero(),N),N,q,R)},X.prototype.getForwardRayToRef=function(N){return T(this,N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),L&&(t.b._IsPickingAvailable=!0,L.prototype.createPickingRay=function(N,q,R,z){return b(this,N,q,R,z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),z.b.prototype.createPickingRayToRef=function(N,q,R,z,v){return f(this,N,q,R,z,v,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},z.b.prototype.createPickingRayInCameraSpace=function(N,q,R){return function(N,q,R,z){const v=e.Zero();return D(N,q,R,v,z),v}(this,N,q,R)},z.b.prototype.createPickingRayInCameraSpaceToRef=function(N,q,R,z){return D(this,N,q,R,z)},z.b.prototype.pickWithBoundingInfo=function(N,q,R,z,v){return function(N,q,R,z,v,B){if(!y.b)return null;const S=H(N,(z=>(N._tempPickingRay||(N._tempPickingRay=e.Zero()),f(N,q,R,z,N._tempPickingRay,B||null),N._tempPickingRay)),z,v,!0);return S&&(S.ray=b(N,q,R,F.d.Identity(),B||null)),S}(this,N,q,R,z,v)},z.b.prototype.fd=function(N,q,R,z,v,B){return function(N,q,R,z,v,B,S){const A=H(N,((z,v)=>(N._tempPickingRay||(N._tempPickingRay=e.Zero()),f(N,q,R,z,N._tempPickingRay,B||null,!1,v),N._tempPickingRay)),z,v,!1,S);return A&&(A.ray=b(N,q,R,F.d.Identity(),B||null)),A}(this,N,q,R,z,v,B)},z.b.prototype.pickWithRay=function(N,q,R,z){return function(N,q,R,z,v){const B=H(N,(R=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=F.d.Identity()),R.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=e.Zero()),e.TransformToRef(q,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),R,z,!1,v);return B&&(B.ray=q),B}(this,N,q,R,z)},z.b.prototype.multiPick=function(N,q,R,z,v){return function(N,q,R,z,v,B){return Y(N,(z=>b(N,q,R,z,v||null)),z,B)}(this,N,q,R,z,v)},z.b.prototype.multiPickWithRay=function(N,q,R){return function(N,q,R,z){return Y(N,(R=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=F.d.Identity()),R.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=e.Zero()),e.TransformToRef(q,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),R,z)}(this,N,q,R)}},11732:(N,q,R)=>{"use strict";var z=R(10985),v=R(10907),B=R(10938),F=R(11007),S=R(10957),A=R(10991);S.d.prototype._partialLoadFile=function(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(N,(N=>{R[q]=N,R._internalCount++,6===R._internalCount&&z(R)}),void 0,void 0,!0,((N,q)=>{v&&N&&v(N.status+" "+N.statusText,q)}))},S.d.prototype._cascadeLoadFiles=function(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const v=[];v._internalCount=0;for(let B=0;B<6;B++)this._partialLoadFile(R[B],B,v,q,z)},S.d.prototype._cascadeLoadImgs=function(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5?arguments[5]:void 0;const F=[];F._internalCount=0;for(let S=0;S<6;S++)this._partialLoadImg(z[S],S,F,N,q,R,v,B)},S.d.prototype._partialLoadImg=function(N,q,R,z,v,S){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7?arguments[7]:void 0;const E=(0,F.e)();(0,B.q)(N,(N=>{R[q]=N,R._internalCount++,z&&z.removePendingData(E),6===R._internalCount&&S&&S(v,R)}),((N,q)=>{z&&z.removePendingData(E),A&&A(N,q)}),z?z.offlineProvider:null,y),z&&z.addPendingData(E)},S.d.prototype.createCubeTextureBase=function(N,q,R,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6?arguments[6]:void 0,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,D=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,V=arguments.length>14&&void 0!==arguments[14]&&arguments[14],H=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const Y=b||new z.c(this,7);Y.isCube=!0,Y.url=N,Y.generateMipMaps=!B,Y._lodGenerationScale=x,Y._lodGenerationOffset=e,Y._useSRGBBuffer=!!V&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!B),Y!==b&&(Y.label=N.substring(0,60)),this._doNotHandleContextLost||(Y._extension=E,Y._files=R,Y._buffer=H);const T=N;this._transformTextureUrl&&!b&&(N=this._transformTextureUrl(N));const L=N.split("?")[0],X=L.lastIndexOf("."),Q=E||(X>-1?L.substring(X).toLowerCase():""),h=(0,A.d)(Q),u=(z,A)=>{N===T?S&&z&&S(z.status+" "+z.statusText,A):(v.c.Warn(`Failed to load ${N}, falling back to the ${T}`),this.createCubeTextureBase(T,q,R,!!B,F,S,y,E,t,x,e,Y,f,D,V,H))};if(h)h.then((z=>{const B=N=>{f&&f(Y,N),z.loadCubeData(N,Y,t,F,S)};H?B(H):R&&6===R.length?z.supportCascades?this._cascadeLoadFiles(q,(N=>B(N.map((N=>new Uint8Array(N))))),R,S):S?S("Textures type does not support cascades."):v.c.Warn("Texture loader does not support cascades."):this._loadFile(N,(N=>B(new Uint8Array(N))),void 0,void 0,!0,u)}));else{if(!R||0===R.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(q,Y,((N,q)=>{D&&D(N,q)}),R,S)}return this._internalTexturesCache.push(Y),Y}},11673:(N,q,R)=>{"use strict";R(10957).d.prototype.createDepthStencilTexture=function(N,q,R){if(q.isCube){const R=N.width||N;return this._createDepthStencilCubeTexture(R,q)}return this._createDepthStencilTexture(N,q,R)}},11646:(N,q,R)=>{"use strict";R(11614).ThinEngine.prototype.setAlphaMode=function(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==N){switch(N){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}q||(this.depthCullingState.depthMask=0===N),this._alphaMode=N}else if(!q){const q=0===N;this.depthCullingState.depthMask!==q&&(this.depthCullingState.depthMask=q)}}},11611:(N,q,R)=>{"use strict";var z=R(11614);z.ThinEngine.prototype.updateDynamicIndexBuffer=function(N,q){let R;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(N),R=N.is32Bits?q instanceof Uint32Array?q:new Uint32Array(q):q instanceof Uint16Array?q:new Uint16Array(q),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,R,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},z.ThinEngine.prototype.updateDynamicVertexBuffer=function(N,q,R,z){this.bindArrayBuffer(N),void 0===R&&(R=0);const v=q.byteLength||q.length;void 0===z||z>=v&&0===R?q instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,R,new Float32Array(q)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,R,q):q instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(q).subarray(R,R+z)):(q=q instanceof ArrayBuffer?new Uint8Array(q,R,z):new Uint8Array(q.buffer,q.byteOffset+R,z),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,q)),this._resetVertexBufferBinding()}},11660:(N,q,R)=>{"use strict";var z=R(10985),v=R(10907),B=R(11614),F=R(11668);class S extends F.e{constructor(N,q,R,z,v){super(N,q,R,z),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=v}_cloneRenderTargetWrapper(){let N=null;return this._colorTextureArray&&this._depthStencilTextureArray?(N=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),N.texture.isReady=!0):N=super._cloneRenderTargetWrapper(),N}_swapRenderTargetWrapper(N){super._swapRenderTargetWrapper(N),N._framebuffer=this._framebuffer,N._depthStencilBuffer=this._depthStencilBuffer,N._MSAAFramebuffer=this._MSAAFramebuffer,N._colorTextureArray=this._colorTextureArray,N._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,B=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const N=this._engine,q=N._currentFramebuffer,R=this._context;N._bindUnboundFramebuffer(this._framebuffer),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_STENCIL_ATTACHMENT,R.RENDERBUFFER,null),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.RENDERBUFFER,null),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.STENCIL_ATTACHMENT,R.RENDERBUFFER,null),N._bindUnboundFramebuffer(q),R.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(N,q,R,z,v,B)}shareDepth(N){super.shareDepth(N);const q=this._context,R=this._depthStencilBuffer,z=N._MSAAFramebuffer||N._framebuffer,v=this._engine;N._depthStencilBuffer&&N._depthStencilBuffer!==R&&q.deleteRenderbuffer(N._depthStencilBuffer),N._depthStencilBuffer=R;const B=N._generateStencilBuffer?q.DEPTH_STENCIL_ATTACHMENT:q.DEPTH_ATTACHMENT;v._bindUnboundFramebuffer(z),q.framebufferRenderbuffer(q.FRAMEBUFFER,B,q.RENDERBUFFER,R),v._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!N._hardwareTexture)return;const v=this._framebuffer,B=this._engine,F=B._currentFramebuffer;if(B._bindUnboundFramebuffer(v),B.webGLVersion>1){const v=this._context,B=v["COLOR_ATTACHMENT"+q];var S;if(N.is2DArray||N.is3D)R=R??(null===(S=this.layerIndices)||void 0===S?void 0:S[q])??0,v.framebufferTextureLayer(v.FRAMEBUFFER,B,N._hardwareTexture.underlyingResource,z,R);else if(N.isCube){var A;R=R??(null===(A=this.faceIndices)||void 0===A?void 0:A[q])??0,v.framebufferTexture2D(v.FRAMEBUFFER,B,v.TEXTURE_CUBE_MAP_POSITIVE_X+R,N._hardwareTexture.underlyingResource,z)}else v.framebufferTexture2D(v.FRAMEBUFFER,B,v.TEXTURE_2D,N._hardwareTexture.underlyingResource,z)}else{const v=this._context,B=v["COLOR_ATTACHMENT"+q+"_WEBGL"],F=void 0!==R?v.TEXTURE_CUBE_MAP_POSITIVE_X+R:v.TEXTURE_2D;v.framebufferTexture2D(v.FRAMEBUFFER,B,F,N._hardwareTexture.underlyingResource,z)}B._bindUnboundFramebuffer(F)}setTexture(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(N,q,R),this._bindTextureRenderTarget(N,q)}setLayerAndFaceIndices(N,q){var R;if(super.setLayerAndFaceIndices(N,q),!this.textures||!this.layerIndices||!this.faceIndices)return;const z=(null===(R=this._attachments)||void 0===R?void 0:R.length)??this.textures.length;for(let v=0;v<z;v++){const N=this.textures[v];N&&(N.is2DArray||N.is3D?this._bindTextureRenderTarget(N,v,this.layerIndices[v]):N.isCube?this._bindTextureRenderTarget(N,v,this.faceIndices[v]):this._bindTextureRenderTarget(N,v))}}setLayerAndFaceIndex(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(N,q,R),!this.textures||!this.layerIndices||!this.faceIndices)return;const z=this.textures[N];z.is2DArray||z.is3D?this._bindTextureRenderTarget(this.textures[N],N,this.layerIndices[N]):z.isCube&&this._bindTextureRenderTarget(this.textures[N],N,this.faceIndices[N])}dispose(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const q=this._context;N||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(q.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(q.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(q.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(N)}}R(11673);B.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(N,q,R){const z=new S(N,q,R,this,this._gl);return this._renderTargetWrapperCache.push(z),z},B.ThinEngine.prototype.createRenderTargetTexture=function(N,q){const R=this._createHardwareRenderTargetWrapper(!1,!1,N);let z,v,B=!0,F=!1,S=!1,A=1;void 0!==q&&"object"===typeof q&&(B=q.generateDepthBuffer??!0,F=!!q.generateStencilBuffer,S=!!q.noColorAttachment,z=q.colorAttachment,A=q.samples??1,v=q.label);const y=z||(S?null:this._createInternalTexture(N,q,!0,5)),E=N.width||N,t=N.height||N,x=this._currentFramebuffer,e=this._gl,b=e.createFramebuffer();if(this._bindUnboundFramebuffer(b),R._depthStencilBuffer=this._setupFramebufferDepthAttachments(F,B,E,t),!y||y.is2DArray||y.is3D||e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,y._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(x),R.label=v??"RenderTargetWrapper",R._framebuffer=b,R._generateDepthBuffer=B,R._generateStencilBuffer=F,R.setTextures(y),z){if(R._samples=z.samples,z.samples>1){const N=z._hardwareTexture.getMSAARenderBuffer(0);R._MSAAFramebuffer=e.createFramebuffer(),this._bindUnboundFramebuffer(R._MSAAFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,N),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(R,A);return R},B.ThinEngine.prototype._createDepthStencilTexture=function(N,q,R){const B=this._gl,F=N.layers||0,S=N.depth||0;let A=B.TEXTURE_2D;0!==F?A=B.TEXTURE_2D_ARRAY:0!==S&&(A=B.TEXTURE_3D);const y=new z.c(this,12);if(y.label=q.label,!this._caps.depthTextureExtension)return v.c.Error("Depth texture is not supported by your browser or hardware."),y;const E={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...q};if(this._bindTextureDirectly(A,y,!0),this._setupDepthStencilTexture(y,N,0!==E.comparisonFunction&&E.bilinearFiltering,E.comparisonFunction,E.samples),void 0!==E.depthTextureFormat){if(15!==E.depthTextureFormat&&16!==E.depthTextureFormat&&17!==E.depthTextureFormat&&13!==E.depthTextureFormat&&14!==E.depthTextureFormat&&18!==E.depthTextureFormat)return v.c.Error(`Depth texture ${E.depthTextureFormat} format is not supported.`),y;y.format=E.depthTextureFormat}else y.format=E.generateStencil?13:16;const t=17===y.format||13===y.format||18===y.format;let x=B.UNSIGNED_INT;15===y.format?x=B.UNSIGNED_SHORT:17===y.format||13===y.format?x=B.UNSIGNED_INT_24_8:14===y.format?x=B.FLOAT:18===y.format&&(x=B.FLOAT_32_UNSIGNED_INT_24_8_REV);const e=t?B.DEPTH_STENCIL:B.DEPTH_COMPONENT,b=this._getInternalFormatFromDepthTextureFormat(y.format,!0,t);return y.is2DArray?B.texImage3D(A,0,b,y.width,y.height,F,0,e,x,null):y.is3D?B.texImage3D(A,0,b,y.width,y.height,S,0,e,x,null):B.texImage2D(A,0,b,y.width,y.height,0,e,x,null),this._bindTextureDirectly(A,null),this._internalTexturesCache.push(y),R._depthStencilBuffer&&(B.deleteRenderbuffer(R._depthStencilBuffer),R._depthStencilBuffer=null),this._bindUnboundFramebuffer(R._MSAAFramebuffer??R._framebuffer),R._generateStencilBuffer=t,R._depthStencilTextureWithStencil=t,R._depthStencilBuffer=this._setupFramebufferDepthAttachments(R._generateStencilBuffer,R._generateDepthBuffer,R.width,R.height,R.samples,y.format),this._bindUnboundFramebuffer(null),y},B.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(N,q){var R;if(this.webGLVersion<2||!N)return 1;if(N.samples===q)return q;const z=this._gl;q=Math.min(q,this.getCaps().maxMSAASamples),N._depthStencilBuffer&&(z.deleteRenderbuffer(N._depthStencilBuffer),N._depthStencilBuffer=null),N._MSAAFramebuffer&&(z.deleteFramebuffer(N._MSAAFramebuffer),N._MSAAFramebuffer=null);const v=null===(R=N.texture)||void 0===R?void 0:R._hardwareTexture;if(null===v||void 0===v||v.releaseMSAARenderBuffers(),N.texture&&q>1&&"function"===typeof z.renderbufferStorageMultisample){const R=z.createFramebuffer();if(!R)throw new Error("Unable to create multi sampled framebuffer");N._MSAAFramebuffer=R,this._bindUnboundFramebuffer(N._MSAAFramebuffer);const B=this._createRenderBuffer(N.texture.width,N.texture.height,q,-1,this._getRGBABufferInternalSizedFormat(N.texture.type,N.texture.format,N.texture._useSRGBBuffer),z.COLOR_ATTACHMENT0,!1);if(!B)throw new Error("Unable to create multi sampled framebuffer");null===v||void 0===v||v.addMSAARenderBuffer(B)}this._bindUnboundFramebuffer(N._MSAAFramebuffer??N._framebuffer),N.texture&&(N.texture.samples=q),N._samples=q;const B=N._depthStencilTexture?N._depthStencilTexture.format:void 0;return N._depthStencilBuffer=this._setupFramebufferDepthAttachments(N._generateStencilBuffer,N._generateDepthBuffer,N.width,N.height,q,B),this._bindUnboundFramebuffer(null),q},B.ThinEngine.prototype._setupDepthStencilTexture=function(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const B=q.width??q,F=q.height??q,S=q.layers||0,A=q.depth||0;N.baseWidth=B,N.baseHeight=F,N.width=B,N.height=F,N.is2DArray=S>0,N.depth=S||A,N.isReady=!0,N.samples=v,N.generateMipMaps=!1,N.samplingMode=R?2:1,N.type=0,N._comparisonFunction=z;const y=this._gl,E=this._getTextureTarget(N),t=this._getSamplingParameters(N.samplingMode,!1);y.texParameteri(E,y.TEXTURE_MAG_FILTER,t.mag),y.texParameteri(E,y.TEXTURE_MIN_FILTER,t.min),y.texParameteri(E,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(E,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===z?(y.texParameteri(E,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(E,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(E,y.TEXTURE_COMPARE_FUNC,z),y.texParameteri(E,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)))}},10949:(N,q,R)=>{"use strict";R.d(q,{b:()=>h,c:()=>X,e:()=>Q,f:()=>Z,g:()=>J});class z{constructor(){this.children=[]}isValid(N){return!0}process(N,q){let R="";if(this.line){let y=this.line;const E=q.processor;if(E){var z,v,B,F,S,A;E.lineProcessor&&(y=E.lineProcessor(y,q.isFragment,q.processingContext));const R=(null===(z=q.processor)||void 0===z?void 0:z.attributeKeywordName)??"attribute",t=q.isFragment&&null!==(v=q.processor)&&void 0!==v&&v.varyingFragmentKeywordName?null===(B=q.processor)||void 0===B?void 0:B.varyingFragmentKeywordName:!q.isFragment&&null!==(F=q.processor)&&void 0!==F&&F.varyingVertexKeywordName?null===(S=q.processor)||void 0===S?void 0:S.varyingVertexKeywordName:"varying";if(!q.isFragment&&E.attributeProcessor&&this.line.startsWith(R))y=E.attributeProcessor(this.line,N,q.processingContext);else if(E.varyingProcessor&&(null!==(A=E.varyingCheck)&&void 0!==A&&A.call(E,this.line,q.isFragment)||!E.varyingCheck&&this.line.startsWith(t)))y=E.varyingProcessor(this.line,q.isFragment,N,q.processingContext);else if(E.uniformProcessor&&E.uniformRegexp&&E.uniformRegexp.test(this.line))q.lookForClosingBracketForUniformBuffer||(y=E.uniformProcessor(this.line,q.isFragment,N,q.processingContext));else if(E.uniformBufferProcessor&&E.uniformBufferRegexp&&E.uniformBufferRegexp.test(this.line))q.lookForClosingBracketForUniformBuffer||(y=E.uniformBufferProcessor(this.line,q.isFragment,q.processingContext),q.lookForClosingBracketForUniformBuffer=!0);else if(E.textureProcessor&&E.textureRegexp&&E.textureRegexp.test(this.line))y=E.textureProcessor(this.line,q.isFragment,N,q.processingContext);else if((E.uniformProcessor||E.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!q.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?E.uniformProcessor&&(y=E.uniformProcessor(this.line,q.isFragment,N,q.processingContext)):E.uniformBufferProcessor&&(y=E.uniformBufferProcessor(this.line,q.isFragment,q.processingContext),q.lookForClosingBracketForUniformBuffer=!0)}q.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(q.lookForClosingBracketForUniformBuffer=!1,E.endOfUniformBufferProcessor&&(y=E.endOfUniformBufferProcessor(this.line,q.isFragment,q.processingContext)))}R+=y+"\n"}return this.children.forEach((z=>{R+=z.process(N,q)})),this.additionalDefineKey&&(N[this.additionalDefineKey]=this.additionalDefineValue||"true"),R}}class v{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(N){this._lines.length=0;for(const q of N){if(!q||"\r"===q)continue;if("#"===q[0]){this._lines.push(q);continue}const N=q.trim();if(!N)continue;if(N.startsWith("//")){this._lines.push(q);continue}const R=N.indexOf(";");if(-1===R)this._lines.push(N);else if(R===N.length-1)N.length>1&&this._lines.push(N);else{const N=q.split(";");for(let q=0;q<N.length;q++){let R=N[q];R&&(R=R.trim(),R&&this._lines.push(R+(q!==N.length-1?";":"")))}}}}}class B extends z{process(N,q){for(let R=0;R<this.children.length;R++){const z=this.children[R];if(z.isValid(N))return z.process(N,q)}return""}}class F extends z{isValid(N){return this.testExpression.isTrue(N)}}class S{isTrue(N){return!0}static postfixToInfix(N){const q=[];for(const R of N)if(void 0===S._OperatorPriority[R])q.push(R);else{const N=q[q.length-1],z=q[q.length-2];q.length-=2,q.push(`(${z}${R}${N})`)}return q[q.length-1]}static infixToPostfix(N){const q=S._InfixToPostfixCache.get(N);if(q)return q.accessTime=Date.now(),q.result;if(!N.includes("&&")&&!N.includes("||")&&!N.includes(")")&&!N.includes("("))return[N];const R=[];let z=-1;const v=()=>{E=E.trim(),""!==E&&(R.push(E),E="")},B=N=>{z<S._Stack.length-1&&(S._Stack[++z]=N)},F=()=>S._Stack[z],A=()=>-1===z?"!!INVALID EXPRESSION!!":S._Stack[z--];let y=0,E="";for(;y<N.length;){const q=N.charAt(y),t=y<N.length-1?N.substring(y,2+y):"";if("("===q)E="",B(q);else if(")"===q){for(v();-1!==z&&"("!==F();)R.push(A());A()}else if(S._OperatorPriority[t]>1){for(v();-1!==z&&S._OperatorPriority[F()]>=S._OperatorPriority[t];)R.push(A());B(t),y++}else E+=q;y++}for(v();-1!==z;)"("===F()?A():R.push(A());return S._InfixToPostfixCache.size>=S.InfixToPostfixCacheLimitSize&&S.ClearCache(),S._InfixToPostfixCache.set(N,{result:R,accessTime:Date.now()}),R}static ClearCache(){const N=Array.from(S._InfixToPostfixCache.entries()).sort(((N,q)=>N[1].accessTime-q[1].accessTime));for(let q=0;q<S.InfixToPostfixCacheCleanupSize;q++)S._InfixToPostfixCache.delete(N[q][0])}}S.InfixToPostfixCacheLimitSize=5e4,S.InfixToPostfixCacheCleanupSize=25e3,S._InfixToPostfixCache=new Map,S._OperatorPriority={")":0,"(":1,"||":2,"&&":3},S._Stack=["","","","","","","","","","","","","","","","","","","",""];class A extends S{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=N,this.not=q}isTrue(N){let q=void 0!==N[this.define];return this.not&&(q=!q),q}}class y extends S{isTrue(N){return this.leftOperand.isTrue(N)||this.rightOperand.isTrue(N)}}class E extends S{isTrue(N){return this.leftOperand.isTrue(N)&&this.rightOperand.isTrue(N)}}class t extends S{constructor(N,q,R){super(),this.define=N,this.operand=q,this.testValue=R}isTrue(N){let q=N[this.define];void 0===q&&(q=this.define);let R=!1;const z=parseInt(q),v=parseInt(this.testValue);switch(this.operand){case">":R=z>v;break;case"<":R=z<v;break;case"<=":R=z<=v;break;case">=":R=z>=v;break;case"==":R=z===v;break;case"!=":R=z!==v}return R}}var x=R(10923),e=R(10951);const b=/defined\s*?\((.+?)\)/g,f=/defined\s*?\[(.+?)\]/g,D=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,V=/__decl__/,H=/light\{X\}.(\w*)/g,Y=/\{X\}/g,T=[],L=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function X(N){N.processor&&N.processor.initializeShaders&&N.processor.initializeShaders(N.processingContext)}function Q(N,q,R,z){var v;null!==(v=q.processor)&&void 0!==v&&v.preProcessShaderCode&&(N=q.processor.preProcessShaderCode(N,q.isFragment)),Z(N,q,(N=>{q.processCodeAfterIncludes&&(N=q.processCodeAfterIncludes(q.isFragment?"fragment":"vertex",N,q.defines));const v=function(N,q,R){let z=function(N,q){var R;if(null!==(R=q.processor)&&void 0!==R&&R.noPrecision)return N;const z=q.shouldUseHighPrecisionShader;-1===N.indexOf("precision highp float")?N=z?"precision highp float;\n"+N:"precision mediump float;\n"+N:z||(N=N.replace("precision highp float","precision mediump float"));return N}(N,q);if(!q.processor)return z;if(0===q.processor.shaderLanguage&&-1!==z.indexOf("#version 3")&&(z=z.replace("#version 300 es",""),!q.processor.parseGLES3))return z;const v=q.defines,B=s(q,R);q.processor.preProcessor&&(z=q.processor.preProcessor(z,v,B,q.isFragment,q.processingContext));z=G(z,B,q),q.processor.postProcessor&&(z=q.processor.postProcessor(z,v,q.isFragment,q.processingContext,R?{drawBuffersExtensionDisabled:!R.getCaps().drawBuffersExtension}:{}));null!==R&&void 0!==R&&R._features.needShaderCodeInlining&&(z=R.inlineShaderCode(z));return z}(N,q,z);R(v,N)}))}function h(N,q,R){return R.processor&&R.processor.finalizeShaders?R.processor.finalizeShaders(N,q,R.processingContext):{vertexCode:N,fragmentCode:q}}function u(N){const q=/defined\((.+)\)/.exec(N);if(q&&q.length)return new A(q[1].trim(),"!"===N[0]);const R=["==","!=",">=","<=","<",">"];let z="",v=0;for(z of R)if(v=N.indexOf(z),v>-1)break;if(-1===v)return new A(N);const B=N.substring(0,v).trim(),F=N.substring(v+z.length).trim();return new t(B,z,F)}function w(N,q){const R=new F,z=N.substring(0,q);let v=N.substring(q);return v=v.substring(0,(v.indexOf("//")+1||v.length+1)-1).trim(),R.testExpression="#ifdef"===z?new A(v):"#ifndef"===z?new A(v,!0):function(N){N=N.replace(b,"defined[$1]");const q=S.infixToPostfix(N),R=[];for(const v of q)if("||"!==v&&"&&"!==v)R.push(v);else if(R.length>=2){let N=R[R.length-1],q=R[R.length-2];R.length-=2;const z="&&"==v?new E:new y;"string"===typeof N&&(N=N.replace(f,"defined($1)")),"string"===typeof q&&(q=q.replace(f,"defined($1)")),z.leftOperand="string"===typeof q?u(q):q,z.rightOperand="string"===typeof N?u(N):N,R.push(z)}let z=R[R.length-1];return"string"===typeof z&&(z=z.replace(f,"defined($1)")),"string"===typeof z?u(z):z}(v),R}function c(N,q,R){let v=N.currentLine;for(;n(N,R);){v=N.currentLine;const B=v.substring(0,5).toLowerCase();if("#else"===B){const R=new z;return q.children.push(R),void n(N,R)}if("#elif"===B){const N=w(v,5);q.children.push(N),R=N}}}function n(N,q){for(;N.canRead;){N.lineIndex++;const R=N.currentLine;if(R.indexOf("#")>=0){const z=L.exec(R);if(z&&z.length){switch(z[0]){case"#ifdef":{const z=new B;q.children.push(z);const v=w(R,6);z.children.push(v),c(N,z,v);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const z=new B;q.children.push(z);const v=w(R,7);z.children.push(v),c(N,z,v);break}case"#if":{const z=new B,v=w(R,3);q.children.push(z),z.children.push(v),c(N,z,v);break}}continue}}const v=new z;if(v.line=R,q.children.push(v),"#"===R[0]&&"d"===R[1]){const N=R.replace(";","").split(" ");v.additionalDefineKey=N[1],3===N.length&&(v.additionalDefineValue=N[2])}}return!1}function G(N,q,R){const B=new z,F=new v;return F.lineIndex=-1,F.lines=N.split("\n"),n(F,B),B.process(q,R)}function s(N,q){var R;const z=N.defines,v={};for(const B of z){const N=B.replace("#define","").replace(";","").trim().split(" ");v[N[0]]=N.length>1?N[1]:""}return 0===(null===(R=N.processor)||void 0===R?void 0:R.shaderLanguage)&&(v.GL_ES="true"),v.__VERSION__=N.version,v[N.platformName]="true",(0,e.i)(v,null===q||void 0===q?void 0:q.isNDCHalfZRange,null===q||void 0===q?void 0:q.useReverseDepthBuffer,null===q||void 0===q?void 0:q.useExactSrgbConversions),v}function Z(N,q,R){let z;for(T.length=0;null!==(z=D.exec(N));)T.push(z);let v=String(N),B=[N],F=!1;for(const S of T){let N=S[1];if(-1!==N.indexOf("__decl__")&&(N=N.replace(V,""),q.supportsUniformBuffers&&(N=N.replace("Vertex","Ubo").replace("Fragment","Ubo")),N+="Declaration"),!q.includesShadersStore[N]){const z=q.shadersRepository+"ShadersInclude/"+N+".fx";return void J.loadFile(z,(z=>{q.includesShadersStore[N]=z,Z(B.join(""),q,R)}))}{let R=q.includesShadersStore[N];if(S[2]){const N=S[3].split(",");for(let q=0;q<N.length;q+=2){const z=new RegExp(N[q],"g"),v=N[q+1];R=R.replace(z,v)}}if(S[4]){const N=S[5];if(-1!==N.indexOf("..")){const z=N.split(".."),v=parseInt(z[0]);let B=parseInt(z[1]),F=R.slice(0);R="",isNaN(B)&&(B=q.indexParameters[z[1]]);for(let N=v;N<B;N++)q.supportsUniformBuffers||(F=F.replace(H,((N,q)=>q+"{X}"))),R+=F.replace(Y,N.toString())+"\n"}else q.supportsUniformBuffers||(R=R.replace(H,((N,q)=>q+"{X}"))),R=R.replace(Y,N)}const z=[];for(const N of B){const q=N.split(S[0]);for(let N=0;N<q.length-1;N++)z.push(q[N]),z.push(R);z.push(q[q.length-1])}B=z,F=F||R.indexOf("#include<")>=0||R.indexOf("#include <")>=0}}T.length=0,v=B.join(""),F?Z(v.toString(),q,R):R(v)}const J={loadFile:(N,q,R,z,v,B)=>{throw(0,x.b)("FileTools")}}},11634:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{get underlyingResource(){return this._webGLTexture}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=q,!N&&(N=q.createTexture(),!N))throw new Error("Unable to create webGL texture");this.set(N)}setUsage(){}set(N){this._webGLTexture=N}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(N){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(N)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const N of this._MSAARenderBuffers)this._context.deleteRenderbuffer(N);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._MSAARenderBuffers)||void 0===N?void 0:N[q])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10951:(N,q,R)=>{"use strict";R.d(q,{e:()=>v,f:()=>B,i:()=>S,m:()=>F,p:()=>A});var z=R(10923);R(10900);const v={};function B(N,q){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(q?q+"\n":"")+N}function F(N,q,R,B,F,S,A){const y=A||v.loadFile;if(y){return y(N,q,R,B,F,S)}throw(0,z.b)("FileTools")}function S(N,q,R,z){if(N)return q?N.IS_NDC_HALF_ZRANGE="":delete N.IS_NDC_HALF_ZRANGE,R?N.USE_REVERSE_DEPTHBUFFER="":delete N.USE_REVERSE_DEPTHBUFFER,void(z?N.USE_EXACT_SRGB_CONVERSIONS="":delete N.USE_EXACT_SRGB_CONVERSIONS);{let N="";return q&&(N+="#define IS_NDC_HALF_ZRANGE"),R&&(N&&(N+="\n"),N+="#define USE_REVERSE_DEPTHBUFFER"),z&&(N&&(N+="\n"),N+="#define USE_EXACT_SRGB_CONVERSIONS"),N}}function A(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;switch(N){case 3:{const N=(ArrayBuffer,new Int8Array(q));return z&&N.set(new Int8Array(z)),N}case 0:{const N=(ArrayBuffer,new Uint8Array(q));return z&&N.set(new Uint8Array(z)),N}case 4:{const N=q instanceof ArrayBuffer?new Int16Array(q):new Int16Array(R?q/2:q);return z&&N.set(new Int16Array(z)),N}case 5:case 8:case 9:case 10:case 2:{const N=q instanceof ArrayBuffer?new Uint16Array(q):new Uint16Array(R?q/2:q);return z&&N.set(new Uint16Array(z)),N}case 6:{const N=q instanceof ArrayBuffer?new Int32Array(q):new Int32Array(R?q/4:q);return z&&N.set(new Int32Array(z)),N}case 7:case 11:case 12:case 13:case 14:case 15:{const N=q instanceof ArrayBuffer?new Uint32Array(q):new Uint32Array(R?q/4:q);return z&&N.set(new Uint32Array(z)),N}case 1:{const N=q instanceof ArrayBuffer?new Float32Array(q):new Float32Array(R?q/4:q);return z&&N.set(new Float32Array(z)),N}}const v=(ArrayBuffer,new Uint8Array(q));return z&&v.set(new Uint8Array(z)),v}},10957:(N,q,R)=>{"use strict";R.d(q,{d:()=>Y});var z=R(10933),v=R(10907),B=R(10964),F=R(10977),S=R(10919);class A{constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,N&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(N){this._zOffset!==N&&(this._zOffset=N,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(N){this._zOffsetUnits!==N&&(this._zOffsetUnits=N,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(N){this._cullFace!==N&&(this._cullFace=N,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(N){this._cull!==N&&(this._cull=N,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(N){this._depthFunc!==N&&(this._depthFunc=N,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(N){this._depthMask!==N&&(this._depthMask=N,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(N){this._depthTest!==N&&(this._depthTest=N,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(N){this._frontFace!==N&&(this._frontFace=N,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(N){this.isDirty&&(this._isCullDirty&&(this.cull?N.enable(N.CULL_FACE):N.disable(N.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(N.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(N.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?N.enable(N.DEPTH_TEST):N.disable(N.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(N.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(N.enable(N.POLYGON_OFFSET_FILL),N.polygonOffset(this.zOffset,this.zOffsetUnits)):N.disable(N.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(N.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class y{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(N){this._func!==N&&(this._func=N,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(N){this._funcRef!==N&&(this._funcRef=N,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(N){this._funcMask!==N&&(this._funcMask=N,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(N){this._opStencilFail!==N&&(this._opStencilFail=N,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(N){this._opDepthFail!==N&&(this._opDepthFail=N,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(N){this._opStencilDepthPass!==N&&(this._opStencilDepthPass=N,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(N){this._mask!==N&&(this._mask=N,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(N){this._enabled!==N&&(this._enabled=N,this._isStencilTestDirty=!0)}constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,N&&this.reset()}reset(){var N;this.stencilMaterial=void 0,null===(N=this.stencilGlobal)||void 0===N||N.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(N){var q;if(!N)return;const R=!this.useStencilGlobalOnly&&!(null===(q=this.stencilMaterial)||void 0===q||!q.enabled);this.enabled=R?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=R?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=R?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=R?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=R?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=R?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=R?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=R?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?N.enable(N.STENCIL_TEST):N.disable(N.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(N.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(N.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(N.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class E{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=E.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=E.KEEP,this.opDepthFail=E.KEEP,this.opStencilDepthPass=E.REPLACE}get stencilFunc(){return this.func}set stencilFunc(N){this.func=N}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(N){this.funcRef=N}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(N){this.funcMask=N}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(N){this.opStencilFail=N}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(N){this.opDepthFail=N}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(N){this.opStencilDepthPass=N}get stencilMask(){return this.mask}set stencilMask(N){this.mask=N}get stencilTest(){return this.enabled}set stencilTest(N){this.enabled=N}}E.ALWAYS=519,E.KEEP=7680,E.REPLACE=7681;class t{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(N){this._alphaBlend!==N&&(this._alphaBlend=N,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(N,q,R,z){this._blendConstants[0]===N&&this._blendConstants[1]===q&&this._blendConstants[2]===R&&this._blendConstants[3]===z||(this._blendConstants[0]=N,this._blendConstants[1]=q,this._blendConstants[2]=R,this._blendConstants[3]=z,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(N,q,R,z){this._blendFunctionParameters[0]===N&&this._blendFunctionParameters[1]===q&&this._blendFunctionParameters[2]===R&&this._blendFunctionParameters[3]===z||(this._blendFunctionParameters[0]=N,this._blendFunctionParameters[1]=q,this._blendFunctionParameters[2]=R,this._blendFunctionParameters[3]=z,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(N,q){this._blendEquationParameters[0]===N&&this._blendEquationParameters[1]===q||(this._blendEquationParameters[0]=N,this._blendEquationParameters[1]=q,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(N){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?N.enable(N.BLEND):N.disable(N.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(N.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(N.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(N.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var x=R(10923),e=R(10985),b=R(10900),f=R(10893),D=R(10951),V=R(10991);function H(N,q){if((0,b.l)()){const{requestAnimationFrame:R}=q||window;if("function"===typeof R)return R(N)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(N);return setTimeout(N,16)}class Y{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(N){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(N){N!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=N,this._depthCullingState.depthFunc=N?518:515)}setColorWrite(N){N!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=N)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(N){if(N)return this.isNDCHalfZRange?N.IS_NDC_HALF_ZRANGE="":delete N.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?N.USE_REVERSE_DEPTHBUFFER="":delete N.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?N.USE_EXACT_SRGB_CONVERSIONS="":delete N.USE_EXACT_SRGB_CONVERSIONS);{let N="";return this.isNDCHalfZRange&&(N+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(N&&(N+="\n"),N+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(N&&(N+="\n"),N+="#define USE_EXACT_SRGB_CONVERSIONS"),N}}_rebuildInternalTextures(){const N=this._internalTexturesCache.slice();for(const q of N)q._rebuild()}_rebuildRenderTargetWrappers(){const N=this._renderTargetWrapperCache.slice();for(const q of N)q._rebuild()}_rebuildEffects(){for(const N in this._compiledEffects){const q=this._compiledEffects[N];q._pipelineContext=null,q._prepareEffect()}B.d.ResetCache()}_rebuildGraphicsResources(){var N;this.wipeCaches(!0),this._rebuildEffects(),null===(N=this._rebuildComputeEffects)||void 0===N||N.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){v.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(N){setTimeout((async()=>{this._clearEmptyResources();const q=this._depthCullingState.depthTest,R=this._depthCullingState.depthFunc,z=this._depthCullingState.depthMask,v=this._stencilState.stencilTest;await N(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=q,this._depthCullingState.depthFunc=R,this._depthCullingState.depthMask=z,this._stencilState.stencilTest=v,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(N){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(N){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const N=new Uint8Array(4),q=[N,N,N,N,N,N];this._emptyCubeTexture=this.createRawCubeTexture(q,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(N){if(!N)return this._activeRenderLoops.length=0,void this._cancelFrame();const q=this._activeRenderLoops.indexOf(N);q>=0&&(this._activeRenderLoops.splice(q,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const N=this._frameHandler;if(this._frameHandler=0,(0,b.l)()){const{cancelAnimationFrame:q}=this.getHostWindow()||window;if("function"===typeof q)return q(N)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(N);return clearTimeout(N)}}ej(){this.onBeginFrameObservable.notifyObservers(this)}fj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let N=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(N=!1),N&&(this.ej(),this._renderViews()||this._renderFrame(),this.fj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let N=0;N<this._activeRenderLoops.length;N++){(0,this._activeRenderLoops[N])()}}_renderViews(){return!1}_queueNewFrame(N,q){return H(N,q)}runRenderLoop(N){-1===this._activeRenderLoops.indexOf(N)&&(this._activeRenderLoops.push(N),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(N){this._depthCullingState.depthTest=N}setZOffset(N){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-N:N}getZOffset(){const N=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-N:N}setZOffsetUnits(N){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-N:N}getZOffsetUnits(){const N=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-N:N}getHostWindow(){return(0,b.l)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(N){this._compatibilityMode=!0}_rebuildTextures(){for(const N of this.scenes)N._rebuildTextures();for(const N of this._virtualScenes)N._rebuildTextures()}_releaseRenderTargetWrapper(N){const q=this._renderTargetWrapperCache.indexOf(N);-1!==q&&this._renderTargetWrapperCache.splice(q,1)}get currentViewport(){return this._cachedViewport}setViewport(N,q,R){const z=q||this.getRenderWidth(),v=R||this.getRenderHeight(),B=N.x||0,F=N.y||0;this._cachedViewport=N,this._viewport(B*z,F*v,z*N.width,v*N.height)}createCanvasImage(){return document.createElement("img")}get description(){let N=this.name+this.version;return this._caps.parallelShaderCompile&&(N+=" - Parallel shader compilation"),N}_createTextureBase(N,q,R,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,D=arguments.length>13?arguments[13]:void 0,H=arguments.length>14?arguments[14]:void 0,T=arguments.length>15?arguments[15]:void 0;const L="data:"===(N=N||"").substr(0,5),X="blob:"===N.substr(0,5),Q=L&&-1!==N.indexOf(";base64,"),h=x||new e.c(this,1);h!==x&&(h.label=N.substring(0,60));const u=N;!this._transformTextureUrl||Q||x||t||(N=this._transformTextureUrl(N)),u!==N&&(h._originalUrl=u);const w=N.lastIndexOf(".");let c=f||(w>-1?N.substring(w).toLowerCase():"");c.indexOf("?")>-1&&(c=c.split("?")[0]);const n=(0,V.d)(c,D);B&&B.addPendingData(h),h.url=N,h.generateMipMaps=!q,h.samplingMode=F,h.invertY=R,h._useSRGBBuffer=this._getUseSRGBBuffer(!!T,q),this._doNotHandleContextLost||(h._buffer=t);let G=null;S&&!x&&(G=h.onLoadedObservable.add(S)),x||this._internalTexturesCache.push(h);const s=(R,x)=>{B&&B.removePendingData(h),N===u?(G&&h.onLoadedObservable.remove(G),z.b.UseFallbackTexture&&N!==z.b.FallbackTexture&&this._createTextureBase(z.b.FallbackTexture,q,h.invertY,B,F,null,A,y,E,t,h),R=(R||"Unknown error")+(z.b.UseFallbackTexture?" - Fallback texture was used":""),h.onErrorObservable.notifyObservers({message:R,exception:x}),A&&A(R,x)):(v.c.Warn(`Failed to load ${N}, falling back to ${u}`),this._createTextureBase(u,q,h.invertY,B,F,S,A,y,E,t,h,b,f,D,H,T))};if(n){const q=async N=>{(await n).loadData(N,h,((N,q,R,z,v,S)=>{S?s("TextureLoader failed to load data"):y(h,c,B,{width:N,height:q},h.invertY,!R,z,(()=>(v(),!1)),F)}),H)};t?t instanceof ArrayBuffer?q(new Uint8Array(t)):ArrayBuffer.isView(t)?q(t):A&&A("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(N,(N=>q(new Uint8Array(N))),void 0,B?B.offlineProvider:void 0,!0,((N,q)=>{s("Unable to load "+(N&&N.responseURL,q))}))}else{const R=N=>{X&&!this._doNotHandleContextLost&&(h._buffer=N),y(h,c,B,N,h.invertY,q,!1,E,F)};!L||Q?t&&("string"===typeof t.decoding||t.close)?R(t):Y._FileToolsLoadImage(N||"",R,s,B?B.offlineProvider:null,D,h.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof t||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof Blob?Y._FileToolsLoadImage(t,R,s,B?B.offlineProvider:null,D,h.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):t&&R(t)}return h}_rebuildBuffers(){for(const N of this._uniformBuffers)N._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,b.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const N in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,N)&&(this._boundTexturesCache[N]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(N){this._name=N}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(N){this._hardwareScalingLevel=N,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(N){this._doNotHandleContextLost=N}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(N,q,R){var v,B;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new A,this._stencilStateComposer=new y,this._stencilState=new E,this._alphaState=new t,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new f.d,this.onCanvasFocusObservable=new f.d,this.onNewSceneAddedObservable=new f.d,this.onResizeObservable=new f.d,this.onCanvasPointerOutObservable=new f.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new f.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new f.d,this.onAfterShaderCompilationObservable=new f.d,this.onBeginFrameObservable=new f.d,this.onEndFrameObservable=new f.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new f.d,this.onContextRestoredObservable=new f.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.jj=new f.d,z.b.Instances.push(this),this.startTime=S.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,F.d.SetMatrixPrecision(!!q.useHighPrecisionMatrix),(0,b.j)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=R??!1,q.antialias=N??q.antialias,q.deterministicLockstep=q.deterministicLockstep??!1,q.lockstepMaxSteps=q.lockstepMaxSteps??4,q.timeStep=q.timeStep??1/60,q.audioEngine=q.audioEngine??!0,q.stencil=q.stencil??!0,this._audioContext=(null===(v=q.audioEngineOptions)||void 0===v?void 0:v.audioContext)??null,this._audioDestination=(null===(B=q.audioEngineOptions)||void 0===B?void 0:B.audioDestination)??null,this.premultipliedAlpha=q.premultipliedAlpha??!0,this._doNotHandleContextLost=!!q.doNotHandleContextLost,this._isStencilEnable=!!q.stencil,this.useExactSrgbConversions=q.useExactSrgbConversions??!1;const x=(0,b.l)()&&window.devicePixelRatio||1,e=q.limitDeviceRatio||x;R=R||q.adaptToDeviceRatio||!1,this._hardwareScalingLevel=R?1/Math.min(e,x):1,this._lastDevicePixelRatio=x,this._creationOptions=q}resize(){let N,q,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const N=(0,b.l)()&&window.devicePixelRatio||1,q=this._lastDevicePixelRatio/N;this._lastDevicePixelRatio=N,this._hardwareScalingLevel*=q}if((0,b.l)()&&(0,b.f)())if(this._renderingCanvas){const R=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};N=this._renderingCanvas.clientWidth||R.width||this._renderingCanvas.width||100,q=this._renderingCanvas.clientHeight||R.height||this._renderingCanvas.height||100}else N=window.innerWidth,q=window.innerHeight;else N=this._renderingCanvas?this._renderingCanvas.width:100,q=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(N/this._hardwareScalingLevel,q/this._hardwareScalingLevel,R)}setSize(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(N|=0,q|=0,!R&&this._renderingCanvas.width===N&&this._renderingCanvas.height===q)return!1;if(this._renderingCanvas.width=N,this._renderingCanvas.height=q,this.scenes){for(let N=0;N<this.scenes.length;N++){const q=this.scenes[N];for(let N=0;N<q.cameras.length;N++){q.cameras[N]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(N,q,R,z,v,B,F,S,A,y,E){throw(0,x.b)("engine.rawTexture")}createRawCubeTexture(N,q,R,z,v,B,F,S){throw(0,x.b)("engine.rawTexture")}createRawTexture3D(N,q,R,z,v,B,F,S,A,y,E){throw(0,x.b)("engine.rawTexture")}createRawTexture2DArray(N,q,R,z,v,B,F,S,A,y,E){throw(0,x.b)("engine.rawTexture")}_sharedInit(N){this._renderingCanvas=N}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const N=navigator.userAgent;this.hostInformation.isMobile=-1!==N.indexOf("Mobile")||-1!==N.indexOf("Mac")&&(0,b.f)()&&"ontouchend"in document},this._checkForMobile(),(0,b.l)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(N){return document.createElement("video")}_reportDrawCall(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(N=this._drawCalls)||void 0===N||N.addCount(q,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(N,q){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(N,q){return createImageBitmap(N,q)}resizeImageBitmap(N,q,R){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(N){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(N,q){if("undefined"===typeof document)return new OffscreenCanvas(N,q);const R=document.createElement("canvas");return R.width=N,R.height=q,R}createCanvas(N,q){return Y._CreateCanvas(N,q)}static _FileToolsLoadImage(N,q,R,z,v,B){throw(0,x.b)("FileTools")}_loadFile(N,q,R,z,v,B){const F=(0,D.m)(N,q,R,z,v,B);return this._activeRequests.push(F),F.onCompleteObservable.add((()=>{const N=this._activeRequests.indexOf(F);-1!==N&&this._activeRequests.splice(N,1)})),F}static _FileToolsLoadFile(N,q,R,z,v,B){if(D.e.loadFile)return D.e.loadFile(N,q,R,z,v,B);throw(0,x.b)("FileTools")}dispose(){var N;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(N=this.releaseComputeEffects)||void 0===N||N.call(this),B.d.ResetCache();for(const R of this._activeRequests)R.abort();this._boundRenderFunction=null,this.jj.notifyObservers(this),this.jj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,b.l)()&&window.removeEventListener("resize",this._checkForMobile);const q=z.b.Instances.indexOf(this);q>=0&&z.b.Instances.splice(q,1),z.b.Instances.length||(z.b.OnEnginesDisposedObservable.notifyObservers(this),z.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(N){throw(0,x.b)("LoadingScreen")}static MarkAllMaterialsAsDirty(N,q){for(let R=0;R<z.b.Instances.length;R++){const v=z.b.Instances[R];for(let R=0;R<v.scenes.length;R++)v.scenes[R].markAllMaterialsAsDirty(N,q)}}}Y._RenderPassIdCounter=0,Y._RescalePostProcessFactory=null,Y.CollisionsEpsilon=.001,Y.QueueNewFrame=H},11652:(N,q,R)=>{"use strict";R.d(q,{e:()=>h});var z=R(10985),v=R(10933),B=R(11614),F=R(10919);class S{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new A(N)}sampleFrame(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const q=N-this._lastFrameTimeMs;this._rollingFrameTime.add(q)}this._lastFrameTimeMs=N}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const N=this._rollingFrameTime.history(0);return 0===N?0:1e3/N}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class A{constructor(N){this._samples=new Array(N),this.reset()}add(N){let q;if(this.isSaturated()){const N=this._samples[this._pos];q=N-this.average,this.average-=q/(this._sampleCount-1),this._m2-=q*(N-this.average)}else this._sampleCount++;q=N-this.average,this.average+=q/this._sampleCount,this._m2+=q*(N-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=N,this._pos++,this._pos%=this._samples.length}history(N){if(N>=this._sampleCount||N>=this._samples.length)return 0;const q=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(q-N)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(N){const q=this._samples.length;return(N%q+q)%q}}var y=R(11630),E=R(10907),t=R(11634),x=(R(11646),R(11013));function e(N,q,R,z){let v,B=1;1===z?v=new Float32Array(q*R*4):2===z?(v=new Uint16Array(q*R*4),B=15360):v=7===z?new Uint32Array(q*R*4):new Uint8Array(q*R*4);for(let F=0;F<q;F++)for(let z=0;z<R;z++){const R=3*(z*q+F),S=4*(z*q+F);v[S+0]=N[R+0],v[S+1]=N[R+1],v[S+2]=N[R+2],v[S+3]=B}return v}function b(N){return function(q,R,v,B,F,S,A,y){let E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const x=N?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,e=N?10:11,b=new z.c(this,e);b.baseWidth=R,b.baseHeight=v,b.baseDepth=B,b.width=R,b.height=v,b.depth=B,b.format=F,b.type=t,b.generateMipMaps=S,b.samplingMode=y,N?b.is3D=!0:b.is2DArray=!0,this._doNotHandleContextLost||(b._bufferView=q),N?this.updateRawTexture3D(b,q,F,A,E,t):this.updateRawTexture2DArray(b,q,F,A,E,t),this._bindTextureDirectly(x,b,!0);const f=this._getSamplingParameters(y,S);return this._gl.texParameteri(x,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(x,this._gl.TEXTURE_MIN_FILTER,f.min),S&&this._gl.generateMipmap(x),this._bindTextureDirectly(x,null),this._internalTexturesCache.push(b),b}}function f(N){return function(q,R,z,v){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const S=N?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,A=this._getWebGLTextureType(F),y=this._getInternalFormat(z),E=this._getRGBABufferInternalSizedFormat(F,z);this._bindTextureDirectly(S,q,!0),this._unpackFlipY(void 0===v||!!v),this._doNotHandleContextLost||(q._bufferView=R,q.format=z,q.invertY=v,q._compression=B),q.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),B&&R?this._gl.compressedTexImage3D(S,0,this.getCaps().s3tc[B],q.width,q.height,q.depth,0,R):this._gl.texImage3D(S,0,E,q.width,q.height,q.depth,0,y,A,R),q.generateMipMaps&&this._gl.generateMipmap(S),this._bindTextureDirectly(S,null),q.isReady=!0}}B.ThinEngine.prototype.updateRawTexture=function(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!N)return;const S=this._getRGBABufferInternalSizedFormat(B,R,F),A=this._getInternalFormat(R),y=this._getWebGLTextureType(B);this._bindTextureDirectly(this._gl.TEXTURE_2D,N,!0),this._unpackFlipY(void 0===z||!!z),this._doNotHandleContextLost||(N._bufferView=q,N.format=R,N.type=B,N.invertY=z,N._compression=v),N.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),v&&q?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[v],N.width,N.height,0,q):this._gl.texImage2D(this._gl.TEXTURE_2D,0,S,N.width,N.height,0,A,y,q),N.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),N.isReady=!0},B.ThinEngine.prototype.createRawTexture=function(N,q,R,v,B,F,S){let A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,E=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const t=new z.c(this,3);t.baseWidth=q,t.baseHeight=R,t.width=q,t.height=R,t.format=v,t.generateMipMaps=B,t.samplingMode=S,t.invertY=F,t._compression=A,t.type=y,t._useSRGBBuffer=this._getUseSRGBBuffer(E,!B),this._doNotHandleContextLost||(t._bufferView=N),this.updateRawTexture(t,N,v,F,A,y,t._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0);const x=this._getSamplingParameters(S,B);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,x.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,x.min),B&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(t),t},B.ThinEngine.prototype.createRawCubeTexture=function(N,q,R,v,B,F,S){let A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const y=this._gl,t=new z.c(this,8);t.isCube=!0,t.format=R,t.type=v,this._doNotHandleContextLost||(t._bufferViewArray=N);const e=this._getWebGLTextureType(v);let b=this._getInternalFormat(R);b===y.RGB&&(b=y.RGBA),e!==y.FLOAT||this._caps.textureFloatLinearFiltering?e!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?e!==y.FLOAT||this._caps.textureFloatRender?e!==y.HALF_FLOAT||this._caps.colorBufferFloat||(B=!1,E.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(B=!1,E.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(B=!1,S=1,E.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(B=!1,S=1,E.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const f=q,D=f;t.width=f,t.height=D,t.invertY=F,t._compression=A;if(!this.needPOTTextures||(0,x.j)(t.width)&&(0,x.j)(t.height)||(B=!1),N)this.updateRawCubeTexture(t,N,R,v,F,A);else{const N=this._getRGBABufferInternalSizedFormat(v),q=0;this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,t,!0);for(let R=0;R<6;R++)A?y.compressedTexImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+R,q,this.getCaps().s3tc[A],t.width,t.height,0,void 0):y.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+R,q,N,t.width,t.height,0,b,e,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),N&&B&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const V=this._getSamplingParameters(S,B);return y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_MAG_FILTER,V.mag),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_MIN_FILTER,V.min),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,null),t.generateMipMaps=B,t.samplingMode=S,t.isReady=!0,t},B.ThinEngine.prototype.updateRawCubeTexture=function(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;N._bufferViewArray=q,N.format=R,N.type=z,N.invertY=v,N._compression=B;const S=this._gl,A=this._getWebGLTextureType(z);let y=this._getInternalFormat(R);const E=this._getRGBABufferInternalSizedFormat(z);let t=!1;y===S.RGB&&(y=S.RGBA,t=!0),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,N,!0),this._unpackFlipY(void 0===v||!!v),N.width%4!==0&&S.pixelStorei(S.UNPACK_ALIGNMENT,1);for(let x=0;x<6;x++){let R=q[x];B?S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+x,F,this.getCaps().s3tc[B],N.width,N.height,0,R):(t&&(R=e(R,N.width,N.height,z)),S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+x,F,E,N.width,N.height,0,y,A,R))}(!this.needPOTTextures||(0,x.j)(N.width)&&(0,x.j)(N.height))&&N.generateMipMaps&&0===F&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),N.isReady=!0},B.ThinEngine.prototype.createRawCubeTextureFromUrl=function(N,q,R,z,v,B,F,S){let A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,t=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const x=this._gl,b=this.createRawCubeTexture(null,R,z,v,!B,t,E,null);null===q||void 0===q||q.addPendingData(b),b.url=N,b.isReady=!1,this._internalTexturesCache.push(b);const f=N=>{const R=b.width,B=F(N);if(B){if(S){const N=this._getWebGLTextureType(v);let q=this._getInternalFormat(z);const F=this._getRGBABufferInternalSizedFormat(v);let A=!1;q===x.RGB&&(q=x.RGBA,A=!0),this._bindTextureDirectly(x.TEXTURE_CUBE_MAP,b,!0),this._unpackFlipY(!1);const y=S(B);for(let z=0;z<y.length;z++){const B=R>>z;for(let R=0;R<6;R++){let S=y[z][R];A&&(S=e(S,B,B,v)),x.texImage2D(R,z,F,B,B,0,q,N,S)}}this._bindTextureDirectly(x.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(b,B,z,v,t);b.isReady=!0,null===q||void 0===q||q.removePendingData(b),b.onLoadedObservable.notifyObservers(b),b.onLoadedObservable.clear(),A&&A()}};return this._loadFile(N,(N=>{f(N)}),void 0,null===q||void 0===q?void 0:q.offlineProvider,!0,((N,R)=>{null===q||void 0===q||q.removePendingData(b),y&&N&&y(N.status+" "+N.statusText,R)})),b},B.ThinEngine.prototype.createRawTexture2DArray=b(!1),B.ThinEngine.prototype.createRawTexture3D=b(!0),B.ThinEngine.prototype.updateRawTexture2DArray=f(!1),B.ThinEngine.prototype.updateRawTexture3D=f(!0);var D=R(10951);B.ThinEngine.prototype._readTexturePixelsSync=function(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const E=this._gl;if(!E)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const N=E.createFramebuffer();if(!N)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=N}var t,x;(E.bindFramebuffer(E.FRAMEBUFFER,this._dummyFramebuffer),z>-1)?E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+z,null===(t=N._hardwareTexture)||void 0===t?void 0:t.underlyingResource,v):E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,null===(x=N._hardwareTexture)||void 0===x?void 0:x.underlyingResource,v);let e=void 0!==N.type?this._getWebGLTextureType(N.type):E.UNSIGNED_BYTE;if(S)B||(B=(0,D.p)(N.type,4*q*R));else if(e===E.UNSIGNED_BYTE)B||(B=new Uint8Array(4*q*R)),e=E.UNSIGNED_BYTE;else B||(B=new Float32Array(4*q*R)),e=E.FLOAT;return F&&this.flushFramebuffer(),E.readPixels(A,y,q,R,E.RGBA,e,B),E.bindFramebuffer(E.FRAMEBUFFER,this._currentFramebuffer),B},B.ThinEngine.prototype._readTexturePixels=function(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(N,q,R,z,v,B,F,S,A,y))};R(11611);B.ThinEngine.prototype._createDepthStencilCubeTexture=function(N,q){const R=new z.c(this,12);if(R.isCube=!0,1===this.webGLVersion)return E.c.Error("Depth cube texture is not supported by WebGL 1."),R;const v={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...q},B=this._gl;this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,R,!0),this._setupDepthStencilTexture(R,N,v.bilinearFiltering,v.comparisonFunction);for(let z=0;z<6;z++)v.generateStencil?B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,B.DEPTH24_STENCIL8,N,N,0,B.DEPTH_STENCIL,B.UNSIGNED_INT_24_8,null):B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,B.DEPTH_COMPONENT24,N,N,0,B.DEPTH_COMPONENT,B.UNSIGNED_INT,null);return this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(R),R},B.ThinEngine.prototype._setCubeMapTextureParams=function(N,q,R){const z=this._gl;z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,q?z.LINEAR_MIPMAP_LINEAR:z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),N.samplingMode=q?3:2,q&&this.getCaps().textureMaxLevel&&void 0!==R&&R>0&&(z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAX_LEVEL,R),N._maxLodLevel=R),this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null)},B.ThinEngine.prototype.createCubeTexture=function(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>13&&void 0!==arguments[13]&&arguments[13],f=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const D=this._gl;return this.createCubeTextureBase(N,q,R,!!z,v,B,F,S,A,y,t,e,(N=>this._bindTextureDirectly(D.TEXTURE_CUBE_MAP,N,!0)),((N,q)=>{const R=this.needPOTTextures?(0,x.f)(q[0].width,this._caps.maxCubemapTextureSize):q[0].width,B=R,S=[D.TEXTURE_CUBE_MAP_POSITIVE_X,D.TEXTURE_CUBE_MAP_POSITIVE_Y,D.TEXTURE_CUBE_MAP_POSITIVE_Z,D.TEXTURE_CUBE_MAP_NEGATIVE_X,D.TEXTURE_CUBE_MAP_NEGATIVE_Y,D.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(D.TEXTURE_CUBE_MAP,N,!0),this._unpackFlipY(!1);const A=F?this._getInternalFormat(F,N._useSRGBBuffer):N._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:D.RGBA;let y=F?this._getInternalFormat(F):D.RGBA;N._useSRGBBuffer&&1===this.webGLVersion&&(y=A);for(let z=0;z<S.length;z++)if(q[z].width!==R||q[z].height!==B){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void E.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=R,this._workingCanvas.height=B,this._workingContext.drawImage(q[z],0,0,q[z].width,q[z].height,0,0,R,B),D.texImage2D(S[z],0,A,y,D.UNSIGNED_BYTE,this._workingCanvas)}else D.texImage2D(S[z],0,A,y,D.UNSIGNED_BYTE,q[z]);z||D.generateMipmap(D.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(N,!z),N.width=R,N.height=B,N.isReady=!0,F&&(N.format=F),N.onLoadedObservable.notifyObservers(N),N.onLoadedObservable.clear(),v&&v()}),!!b,f)},B.ThinEngine.prototype.generateMipMapsForCubemap=function(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N.generateMipMaps){const R=this._gl;this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,N,!0),R.generateMipmap(R.TEXTURE_CUBE_MAP),q&&this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,null)}};R(11660);B.ThinEngine.prototype.setDepthStencilTexture=function(N,q,R,z){void 0!==N&&(q&&(this._boundUniforms[N]=q),R&&R.depthStencilTexture?this._setTexture(N,R,!1,!0,z):this._setTexture(N,null,void 0,void 0,z))},B.ThinEngine.prototype.createRenderTargetCubeTexture=function(N,q){const R=this._createHardwareRenderTargetWrapper(!1,!0,N),v={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...q};v.generateStencilBuffer=v.generateDepthBuffer&&v.generateStencilBuffer,(1!==v.type||this._caps.textureFloatLinearFiltering)&&(2!==v.type||this._caps.textureHalfFloatLinearFiltering)||(v.samplingMode=1);const B=this._gl,F=new z.c(this,5);this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,F,!0);const S=this._getSamplingParameters(v.samplingMode,v.generateMipMaps);1!==v.type||this._caps.textureFloat||(v.type=0,E.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,S.mag),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,S.min),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);for(let z=0;z<6;z++)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,this._getRGBABufferInternalSizedFormat(v.type,v.format),N,N,0,this._getInternalFormat(v.format),this._getWebGLTextureType(v.type),null);const A=B.createFramebuffer();return this._bindUnboundFramebuffer(A),R._depthStencilBuffer=this._setupFramebufferDepthAttachments(v.generateStencilBuffer,v.generateDepthBuffer,N,N),v.generateMipMaps&&B.generateMipmap(B.TEXTURE_CUBE_MAP),this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),R._framebuffer=A,R._generateDepthBuffer=v.generateDepthBuffer,R._generateStencilBuffer=v.generateStencilBuffer,F.width=N,F.height=N,F.isReady=!0,F.isCube=!0,F.samples=1,F.generateMipMaps=v.generateMipMaps,F.samplingMode=v.samplingMode,F.type=v.type,F.format=v.format,this._internalTexturesCache.push(F),R.setTextures(F),R};var V=R(11680),H=R(11407),Y=R(11699);B.ThinEngine.prototype.createPrefilteredCubeTexture=function(N,q,R,v){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(N,q,null,!1,(N=>{if(!N)return void(B&&B(null));const F=N.texture;if(y?N.info.sphericalPolynomial&&(F._sphericalPolynomial=N.info.sphericalPolynomial):F._sphericalPolynomial=new V.d,F._source=9,this.getCaps().textureLOD)return void(B&&B(F));const S=this._gl,A=N.width;if(!A)return;const t=[];for(let B=0;B<3;B++){const y=1-B/2,x=v,e=Math.log2(A)*R+v,b=x+(e-x)*y,f=Math.round(Math.min(Math.max(b,0),e)),D=new z.c(this,2);if(D.type=F.type,D.format=F.format,D.width=Math.pow(2,Math.max(Math.log2(A)-f,0)),D.height=D.width,D.isCube=!0,D._cachedWrapU=0,D._cachedWrapV=0,this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,D,!0),D.samplingMode=2,S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),N.isDDS){const q=N.info,R=N.data;this._unpackFlipY(q.isCompressed),Y.b.UploadDDSLevels(this,D,R,q,!0,6,f)}else E.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null);const V=new H.c(q);V._isCube=!0,V._texture=D,D.isReady=!0,t.push(V)}F._lodTextureHigh=t[2],F._lodTextureMid=t[1],F._lodTextureLow=t[0],B&&B(F)}),F,S,A,y,R,v)},B.ThinEngine.prototype.createUniformBuffer=function(N,q){const R=this._gl.createBuffer();if(!R)throw new Error("Unable to create uniform buffer");const z=new y.c(R);return this.bindUniformBuffer(z),N instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,N,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(N),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),z.references=1,z},B.ThinEngine.prototype.createDynamicUniformBuffer=function(N,q){const R=this._gl.createBuffer();if(!R)throw new Error("Unable to create dynamic uniform buffer");const z=new y.c(R);return this.bindUniformBuffer(z),N instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,N,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(N),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),z.references=1,z},B.ThinEngine.prototype.updateUniformBuffer=function(N,q,R,z){this.bindUniformBuffer(N),void 0===R&&(R=0),void 0===z?q instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,R,q):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,R,new Float32Array(q)):q instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,q.subarray(R,R+z)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(q).subarray(R,R+z)),this.bindUniformBuffer(null)},B.ThinEngine.prototype.bindUniformBuffer=function(N){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,N?N.underlyingResource:null)},B.ThinEngine.prototype.bindUniformBufferBase=function(N,q,R){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,q,N?N.underlyingResource:null)},B.ThinEngine.prototype.bindUniformBlock=function(N,q,R){const z=N.program,v=this._gl.getUniformBlockIndex(z,q);4294967295!==v&&this._gl.uniformBlockBinding(z,v,R)};var T=R(10900),L=R(10957);L.d.prototype.displayLoadingUI=function(){if(!(0,T.l)())return;const N=this.loadingScreen;N&&N.displayLoadingUI()},L.d.prototype.hideLoadingUI=function(){if(!(0,T.l)())return;const N=this._loadingScreen;N&&N.hideLoadingUI()},Object.defineProperty(L.d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=L.d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(N){this._loadingScreen=N},enumerable:!0,configurable:!0}),Object.defineProperty(L.d.prototype,"loadingUIText",{set:function(N){this.loadingScreen.loadingUIText=N},enumerable:!0,configurable:!0}),Object.defineProperty(L.d.prototype,"loadingUIBackgroundColor",{set:function(N){this.loadingScreen.loadingUIBackgroundColor=N},enumerable:!0,configurable:!0}),L.d.prototype.getInputElement=function(){return this._renderingCanvas},L.d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},L.d.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},L.d.prototype.getAspectRatio=function(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=N.viewport;return this.getRenderWidth(q)*R.width/(this.getRenderHeight(q)*R.height)},L.d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},L.d.prototype._verifyPointerLock=function(){var N;null===(N=this._onPointerLockChange)||void 0===N||N.call(this)},L.d.prototype.setAlphaEquation=function(N){if(this._alphaEquation!==N){switch(N){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=N}},L.d.prototype.getInputElement=function(){return this._renderingCanvas},L.d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},L.d.prototype.setDepthFunction=function(N){this._depthCullingState.depthFunc=N},L.d.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},L.d.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},L.d.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},L.d.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},L.d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},L.d.prototype.setDepthWrite=function(N){this._depthCullingState.depthMask=N},L.d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},L.d.prototype.setStencilBuffer=function(N){this._stencilState.stencilTest=N},L.d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},L.d.prototype.setStencilMask=function(N){this._stencilState.stencilMask=N},L.d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},L.d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},L.d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},L.d.prototype.setStencilFunction=function(N){this._stencilState.stencilFunc=N},L.d.prototype.setStencilFunctionReference=function(N){this._stencilState.stencilFuncRef=N},L.d.prototype.setStencilFunctionMask=function(N){this._stencilState.stencilFuncMask=N},L.d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},L.d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},L.d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},L.d.prototype.setStencilOperationFail=function(N){this._stencilState.stencilOpStencilFail=N},L.d.prototype.setStencilOperationDepthFail=function(N){this._stencilState.stencilOpDepthFail=N},L.d.prototype.setStencilOperationPass=function(N){this._stencilState.stencilOpStencilDepthPass=N},L.d.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},L.d.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},L.d.prototype.setAlphaConstants=function(N,q,R,z){this._alphaState.setAlphaBlendConstants(N,q,R,z)},L.d.prototype.getAlphaMode=function(){return this._alphaMode},L.d.prototype.getAlphaEquation=function(){return this._alphaEquation},L.d.prototype.getRenderPassNames=function(){return this._renderPassNames},L.d.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},L.d.prototype.createRenderPassId=function(N){const q=++L.d._RenderPassIdCounter;return this._renderPassNames[q]=N??"NONAME",q},L.d.prototype.releaseRenderPassId=function(N){this._renderPassNames[N]=void 0;for(let q=0;q<this.scenes.length;++q){const R=this.scenes[q];for(let q=0;q<R.meshes.length;++q){const z=R.meshes[q];if(z.lg)for(let q=0;q<z.lg.length;++q){z.lg[q]._removeDrawWrapper(N)}}}};R(11673);function X(N){if(N.requestPointerLock){const q=N.requestPointerLock();q instanceof Promise?q.then((()=>{N.focus()})).catch((()=>{})):N.focus()}}var Q=R(11019);R(11738);class h extends B.ThinEngine{static get NpmPackage(){return L.d.NpmPackage}static get Version(){return L.d.Version}static get Instances(){return v.b.Instances}static get LastCreatedEngine(){return v.b.LastCreatedEngine}static get LastCreatedScene(){return v.b.LastCreatedScene}static DefaultLoadingScreenFactory(N){return L.d.DefaultLoadingScreenFactory(N)}get _supportsHardwareTextureRescaling(){return!!h._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(N,q,R){if(super(N,q,R,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new S,this._drawCalls=new Q.c,N&&(this._features.supportRenderPasses=!0,R=this._creationOptions,N.getContext)){const q=N;this._sharedInit(q)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(N){super._sharedInit(N),function(N,q,R){N._onCanvasFocus=()=>{N.onCanvasFocusObservable.notifyObservers(N)},N._onCanvasBlur=()=>{N.onCanvasBlurObservable.notifyObservers(N)},N._onCanvasContextMenu=q=>{N.disableContextMenu&&q.preventDefault()},q.addEventListener("focus",N._onCanvasFocus),q.addEventListener("blur",N._onCanvasBlur),q.addEventListener("contextmenu",N._onCanvasContextMenu),N._onBlur=()=>{N.disablePerformanceMonitorInBackground&&N.performanceMonitor.disable(),N._windowIsBackground=!0},N._onFocus=()=>{N.disablePerformanceMonitorInBackground&&N.performanceMonitor.enable(),N._windowIsBackground=!1},N._onCanvasPointerOut=R=>{document.elementFromPoint(R.clientX,R.clientY)!==q&&N.onCanvasPointerOutObservable.notifyObservers(R)};const z=N.getHostWindow();z&&"function"===typeof z.addEventListener&&(z.addEventListener("blur",N._onBlur),z.addEventListener("focus",N._onFocus)),q.addEventListener("pointerout",N._onCanvasPointerOut),R.doNotHandleTouchAction||function(N){N&&N.setAttribute&&(N.setAttribute("touch-action","none"),N.style.touchAction="none",N.style.webkitTapHighlightColor="transparent")}(q),!L.d.audioEngine&&R.audioEngine&&L.d.AudioEngineFactory&&(L.d.audioEngine=L.d.AudioEngineFactory(N.getRenderingCanvas(),N.getAudioContext(),N.getAudioDestination())),(0,T.f)()&&(N._onFullscreenChange=()=>{N.isFullscreen=!!document.fullscreenElement,N.isFullscreen&&N._pointerLockRequested&&q&&X(q)},document.addEventListener("fullscreenchange",N._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",N._onFullscreenChange,!1),N._onPointerLockChange=()=>{N.isPointerLock=document.pointerLockElement===q},document.addEventListener("pointerlockchange",N._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",N._onPointerLockChange,!1)),N.enableOfflineSupport=void 0!==L.d.OfflineProviderFactory,N._deterministicLockstep=!!R.deterministicLockstep,N._lockstepMaxSteps=R.lockstepMaxSteps||0,N._timeStep=R.timeStep||1/60}(this,N,this._creationOptions)}resizeImageBitmap(N,q,R){return function(N,q,R,z){const v=N.createCanvas(R,z).getContext("2d");if(!v)throw new Error("Unable to get 2d context for resizeImageBitmap");return v.drawImage(q,0,0),v.getImageData(0,0,R,z).data}(this,N,q,R)}_createImageBitmapFromSource(N,q){return function(N,q,R){return new Promise(((z,v)=>{const B=new Image;B.onload=()=>{B.decode().then((()=>{N.createImageBitmap(B,R).then((N=>{z(N)}))}))},B.onerror=()=>{v(`Error loading image ${B.src}`)},B.src=q}))}(this,N,q)}switchFullscreen(N){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(N)}enterFullscreen(N){this.isFullscreen||(this._pointerLockRequested=N,this._renderingCanvas&&function(N){const q=N.requestFullscreen||N.webkitRequestFullscreen;q&&q.call(N)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const N=document;document.exitFullscreen?document.exitFullscreen():N.webkitCancelFullScreen&&N.webkitCancelFullScreen()}()}setDitheringState(N){N?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(N){N?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(N,q,R,z){const v=this._cachedViewport;return this._cachedViewport=null,this._viewport(N,q,R,z),v}scissorClear(N,q,R,z,v){this.enableScissor(N,q,R,z),this.clear(v,!0,!0,!0),this.disableScissor()}enableScissor(N,q,R,z){const v=this._gl;v.enable(v.SCISSOR_TEST),v.scissor(N,q,R,z)}disableScissor(){const N=this._gl;N.disable(N.SCISSOR_TEST)}_loadFileAsync(N,q,R){return new Promise(((z,v)=>{this._loadFile(N,(N=>{z(N)}),void 0,q,R,((N,q)=>{v(q)}))}))}getVertexShaderSource(N){const q=this._gl.getAttachedShaders(N);return q?this._gl.getShaderSource(q[0]):null}getFragmentShaderSource(N){const q=this._gl.getAttachedShaders(N);return q?this._gl.getShaderSource(q[1]):null}set framebufferDimensionsObject(N){this._framebufferDimensionsObject=N,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const N of this.scenes)N.resetCachedMaterial(),N._rebuildGeometries();for(const N of this._virtualScenes)N.resetCachedMaterial(),N._rebuildGeometries();super._rebuildBuffers()}getFontOffset(N){return function(N){const q=document.createElement("span");q.textContent="Hg",q.style.font=N;const R=document.createElement("div");R.style.display="inline-block",R.style.width="1px",R.style.height="0px",R.style.verticalAlign="bottom";const z=document.createElement("div");z.style.whiteSpace="nowrap",z.appendChild(q),z.appendChild(R),document.body.appendChild(z);let v=0,B=0;try{B=R.getBoundingClientRect().top-q.getBoundingClientRect().top,R.style.verticalAlign="baseline",v=R.getBoundingClientRect().top-q.getBoundingClientRect().top}finally{document.body.removeChild(z)}return{ascent:v,height:B,descent:B-v}}(N)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:N}=this.customAnimationFrameRequester;N&&N(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let N=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(N=!1),N&&(this.ej(),this._renderViews()||this._renderFrame(),this.fj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&X(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}ej(){this._measureFps(),super.ej()}_deletePipelineContext(N){const q=N;q&&q.program&&q.transformFeedback&&(this.deleteTransformFeedback(q.transformFeedback),q.transformFeedback=null),super._deletePipelineContext(N)}createShaderProgram(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;v=v||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const F=super.createShaderProgram(N,q,R,z,v,B);return this.onAfterShaderCompilationObservable.notifyObservers(this),F}_createShaderProgram(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const B=z.createProgram();if(N.program=B,!B)throw new Error("Unable to create program");if(z.attachShader(B,q),z.attachShader(B,R),this.webGLVersion>1&&v){const q=this.createTransformFeedback();this.bindTransformFeedback(q),this.setTranformFeedbackVaryings(B,v),N.transformFeedback=q}return z.linkProgram(B),this.webGLVersion>1&&v&&this.bindTransformFeedback(null),N.context=z,N.vertexShader=q,N.fragmentShader=R,N.isParallelCompiled||this._finalizePipelineContext(N),B}_releaseTexture(N){super._releaseTexture(N)}_releaseRenderTargetWrapper(N){super._releaseRenderTargetWrapper(N),this.scenes.forEach((q=>{q.postProcesses.forEach((q=>{q._outputTexture===N&&(q._outputTexture=null)})),q.cameras.forEach((q=>{q._postProcesses.forEach((q=>{q&&q._outputTexture===N&&(q._outputTexture=null)}))}))}))}_rescaleTexture(N,q,R,z,v){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const B=this.createRenderTargetTexture({width:q.width,height:q.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&h._RescalePostProcessFactory&&(this._rescalePostProcess=h._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const F=()=>{this._rescalePostProcess.onApply=function(q){q._bindTexture("textureSampler",N)};let F=R;F||(F=this.scenes[this.scenes.length-1]),F.postProcessManager.directRender([this._rescalePostProcess],B,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,z,0,0,q.width,q.height,0),this.unBindFramebuffer(B),B.dispose(),v&&v()},S=this._rescalePostProcess.getEffect();S?S.executeWhenCompiled(F):this._rescalePostProcess.onEffectCreatedObservable.addOnce((N=>{N.executeWhenCompiled(F)}))}}wrapWebGLTexture(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const F=new t.d(N,this._gl),S=new z.c(this,0,!0);return S._hardwareTexture=F,S.baseWidth=v,S.baseHeight=B,S.width=v,S.height=B,S.isReady=!0,S.useMipMaps=q,this.updateTextureSamplingMode(R,S),S}_uploadImageToTexture(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const v=this._gl,B=this._getWebGLTextureType(N.type),F=this._getInternalFormat(N.format),S=this._getRGBABufferInternalSizedFormat(N.type,F),A=N.isCube?v.TEXTURE_CUBE_MAP:v.TEXTURE_2D;this._bindTextureDirectly(A,N,!0),this._unpackFlipY(N.invertY);let y=v.TEXTURE_2D;N.isCube&&(y=v.TEXTURE_CUBE_MAP_POSITIVE_X+R),v.texImage2D(y,z,S,F,B,q),this._bindTextureDirectly(A,null,!0)}updateTextureComparisonFunction(N,q){if(1===this.webGLVersion)return void E.c.Error("WebGL 1 does not support texture comparison.");const R=this._gl;N.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,N,!0),0===q?(R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_FUNC,515),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_FUNC,q),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,N,!0),0===q?(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_FUNC,515),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_FUNC,q),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),N._comparisonFunction=q}createInstancesBuffer(N){const q=this._gl.createBuffer();if(!q)throw new Error("Unable to create instance buffer");const R=new y.c(q);return R.rb=N,this.bindArrayBuffer(R),this._gl.bufferData(this._gl.ARRAY_BUFFER,N,this._gl.DYNAMIC_DRAW),R.references=1,R}deleteInstancesBuffer(N){this._gl.deleteBuffer(N)}_clientWaitAsync(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const z=this._gl;return new Promise(((v,B)=>{const F=()=>{const S=z.clientWaitSync(N,q,0);S!=z.WAIT_FAILED?S!=z.TIMEOUT_EXPIRED?v():setTimeout(F,R):B()};F()}))}_readPixelsAsync(N,q,R,z,v,B,F){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const S=this._gl,A=S.createBuffer();S.bindBuffer(S.PIXEL_PACK_BUFFER,A),S.bufferData(S.PIXEL_PACK_BUFFER,F.byteLength,S.STREAM_READ),S.readPixels(N,q,R,z,v,B,0),S.bindBuffer(S.PIXEL_PACK_BUFFER,null);const y=S.fenceSync(S.SYNC_GPU_COMMANDS_COMPLETE,0);return y?(S.flush(),this._clientWaitAsync(y,0,10).then((()=>(S.deleteSync(y),S.bindBuffer(S.PIXEL_PACK_BUFFER,A),S.getBufferSubData(S.PIXEL_PACK_BUFFER,0,F),S.bindBuffer(S.PIXEL_PACK_BUFFER,null),S.deleteBuffer(A),F)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(N,q){1===v.b.Instances.length&&L.d.audioEngine&&(L.d.audioEngine.dispose(),L.d.audioEngine=null);const R=N.getHostWindow();R&&"function"===typeof R.removeEventListener&&(R.removeEventListener("blur",N._onBlur),R.removeEventListener("focus",N._onFocus)),q&&(q.removeEventListener("focus",N._onCanvasFocus),q.removeEventListener("blur",N._onCanvasBlur),q.removeEventListener("pointerout",N._onCanvasPointerOut),q.removeEventListener("contextmenu",N._onCanvasContextMenu)),(0,T.f)()&&(document.removeEventListener("fullscreenchange",N._onFullscreenChange),document.removeEventListener("mozfullscreenchange",N._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",N._onFullscreenChange),document.removeEventListener("msfullscreenchange",N._onFullscreenChange),document.removeEventListener("pointerlockchange",N._onPointerLockChange),document.removeEventListener("mspointerlockchange",N._onPointerLockChange),document.removeEventListener("mozpointerlockchange",N._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",N._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}h.ALPHA_DISABLE=0,h.ALPHA_ADD=1,h.ALPHA_COMBINE=2,h.ALPHA_SUBTRACT=3,h.ALPHA_MULTIPLY=4,h.ALPHA_MAXIMIZED=5,h.ALPHA_ONEONE=6,h.ALPHA_PREMULTIPLIED=7,h.ALPHA_PREMULTIPLIED_PORTERDUFF=8,h.ALPHA_INTERPOLATE=9,h.ALPHA_SCREENMODE=10,h.DELAYLOADSTATE_NONE=0,h.DELAYLOADSTATE_LOADED=1,h.DELAYLOADSTATE_LOADING=2,h.DELAYLOADSTATE_NOTLOADED=4,h.NEVER=512,h.ALWAYS=519,h.LESS=513,h.EQUAL=514,h.LEQUAL=515,h.GREATER=516,h.GEQUAL=518,h.NOTEQUAL=517,h.KEEP=7680,h.REPLACE=7681,h.INCR=7682,h.DECR=7683,h.INVERT=5386,h.INCR_WRAP=34055,h.DECR_WRAP=34056,h.TEXTURE_CLAMP_ADDRESSMODE=0,h.TEXTURE_WRAP_ADDRESSMODE=1,h.TEXTURE_MIRROR_ADDRESSMODE=2,h.TEXTUREFORMAT_ALPHA=0,h.TEXTUREFORMAT_LUMINANCE=1,h.TEXTUREFORMAT_LUMINANCE_ALPHA=2,h.TEXTUREFORMAT_RGB=4,h.TEXTUREFORMAT_RGBA=5,h.TEXTUREFORMAT_RED=6,h.TEXTUREFORMAT_R=6,h.TEXTUREFORMAT_RG=7,h.TEXTUREFORMAT_RED_INTEGER=8,h.TEXTUREFORMAT_R_INTEGER=8,h.TEXTUREFORMAT_RG_INTEGER=9,h.TEXTUREFORMAT_RGB_INTEGER=10,h.TEXTUREFORMAT_RGBA_INTEGER=11,h.TEXTURETYPE_UNSIGNED_BYTE=0,h.TEXTURETYPE_UNSIGNED_INT=0,h.TEXTURETYPE_FLOAT=1,h.TEXTURETYPE_HALF_FLOAT=2,h.TEXTURETYPE_BYTE=3,h.TEXTURETYPE_SHORT=4,h.TEXTURETYPE_UNSIGNED_SHORT=5,h.TEXTURETYPE_INT=6,h.TEXTURETYPE_UNSIGNED_INTEGER=7,h.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,h.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,h.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,h.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,h.TEXTURETYPE_UNSIGNED_INT_24_8=12,h.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,h.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,h.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,h.TEXTURE_NEAREST_SAMPLINGMODE=1,h.TEXTURE_BILINEAR_SAMPLINGMODE=2,h.TEXTURE_TRILINEAR_SAMPLINGMODE=3,h.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,h.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,h.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,h.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,h.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,h.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,h.TEXTURE_NEAREST_LINEAR=7,h.TEXTURE_NEAREST_NEAREST=1,h.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,h.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,h.TEXTURE_LINEAR_LINEAR=2,h.TEXTURE_LINEAR_NEAREST=12,h.TEXTURE_EXPLICIT_MODE=0,h.TEXTURE_SPHERICAL_MODE=1,h.TEXTURE_PLANAR_MODE=2,h.TEXTURE_CUBIC_MODE=3,h.TEXTURE_PROJECTION_MODE=4,h.TEXTURE_SKYBOX_MODE=5,h.TEXTURE_INVCUBIC_MODE=6,h.TEXTURE_EQUIRECTANGULAR_MODE=7,h.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,h.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,h.SCALEMODE_FLOOR=1,h.SCALEMODE_NEAREST=2,h.SCALEMODE_CEILING=3},10933:(N,q,R)=>{"use strict";R.d(q,{b:()=>v});var z=R(10893);class v{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}v.Instances=[],v.OnEnginesDisposedObservable=new z.d,v._LastCreatedScene=null,v.UseFallbackTexture=!0,v.FallbackTexture=""},12616:(N,q,R)=>{"use strict";R(10907);var z=R(11652);R(10985),R(11258),R(10977),R(11668),R(11622);z.e},10977:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{static SetMatrixPrecision(N){if(z.MatrixTrackPrecisionChange=!1,N&&!z.MatrixUse64Bits&&z.MatrixTrackedMatrices)for(let q=0;q<z.MatrixTrackedMatrices.length;++q){const N=z.MatrixTrackedMatrices[q],R=N.Pj;N.Pj=new Array(16);for(let q=0;q<16;++q)N.Pj[q]=R[q]}z.MatrixUse64Bits=N,z.MatrixCurrentType=z.MatrixUse64Bits?Array:Float32Array,z.MatrixTrackedMatrices=null}}z.MatrixUse64Bits=!1,z.MatrixTrackPrecisionChange=!0,z.MatrixCurrentType=Float32Array,z.MatrixTrackedMatrices=[]},11668:(N,q,R)=>{"use strict";R.d(q,{e:()=>z});class z{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var N;return(null===(N=this._textures)||void 0===N?void 0:N[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(N){var q,R;if(!this._textures)return-1;const z=this._textures[N],v=(null===(q=this._layerIndices)||void 0===q?void 0:q[N])??0,B=(null===(R=this._faceIndices)||void 0===R?void 0:R[N])??0;return z.isCube?6*v+B:z.is3D?0:v}get samples(){return this._samples}setSamples(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===N&&!R)return N;const z=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,N,q):this._engine.updateRenderTargetTextureSampleCount(this,N);return this._samples=N,z}constructor(N,q,R,z,v){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=N,this._isCube=q,this._size=R,this._engine=z,this._depthStencilTexture=null,this.label=v}setTextures(N){Array.isArray(N)?this._textures=N:this._textures=N?[N]:null}setTexture(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[q]!==N&&(this._textures[q]&&R&&this._textures[q].dispose(),this._textures[q]=N)}setLayerAndFaceIndices(N,q){this._layerIndices=N,this._faceIndices=q}setLayerAndFaceIndex(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==q&&q>=0&&(this._layerIndices[N]=q),void 0!==R&&R>=0&&(this._faceIndices[N]=R)}createDepthStencilTexture(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,F=arguments.length>5?arguments[5]:void 0;return null===(N=this._depthStencilTexture)||void 0===N||N.dispose(),this._depthStencilTextureWithStencil=z,this._depthStencilTextureLabel=F,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:R,comparisonFunction:q,generateStencil:z,isCube:this._isCube,samples:v,depthTextureFormat:B,label:F},this),this._depthStencilTexture}_shareDepth(N){this.shareDepth(N)}shareDepth(N){this._depthStencilTexture&&(N._depthStencilTexture&&N._depthStencilTexture.dispose(),N._depthStencilTexture=this._depthStencilTexture,N._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(N){this.texture&&this.texture._swapAndDie(N),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let N=null;if(this._isMulti){const q=this.textures;if(q&&q.length>0){let R=!1,z=q.length,v=-1;const B=q[q.length-1]._source;14!==B&&12!==B||(R=!0,v=q[q.length-1].format,z--);const F=[],S=[],A=[],y=[],E=[],t=[],x=[],e={};for(let N=0;N<z;++N){const R=q[N];F.push(R.samplingMode),S.push(R.type),A.push(R.format);void 0!==e[R.uniqueId]?(y.push(-1),x.push(0)):(e[R.uniqueId]=N,R.is2DArray?(y.push(35866),x.push(R.depth)):R.isCube?(y.push(34067),x.push(0)):R.is3D?(y.push(32879),x.push(R.depth)):(y.push(3553),x.push(0))),this._faceIndices&&E.push(this._faceIndices[N]??0),this._layerIndices&&t.push(this._layerIndices[N]??0)}const b={samplingModes:F,generateMipMaps:q[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:R,depthTextureFormat:v,types:S,formats:A,textureCount:z,targetTypes:y,faceIndex:E,layerIndex:t,layerCounts:x,label:this.label},f={width:this.width,height:this.height,depth:this.depth};N=this._engine.createMultipleRenderTarget(f,b);for(let D=0;D<z;++D){if(-1!==y[D])continue;const R=e[q[D].uniqueId];N.setTexture(N.textures[R],D)}}}else{var q,R,z,v;const F={};if(F.generateDepthBuffer=this._generateDepthBuffer,F.generateMipMaps=(null===(q=this.texture)||void 0===q?void 0:q.generateMipMaps)??!1,F.generateStencilBuffer=this._generateStencilBuffer,F.samplingMode=null===(R=this.texture)||void 0===R?void 0:R.samplingMode,F.type=null===(z=this.texture)||void 0===z?void 0:z.type,F.format=null===(v=this.texture)||void 0===v?void 0:v.format,F.noColorAttachment=!this._textures,F.label=this.label,this.isCube)N=this._engine.createRenderTargetCubeTexture(this.width,F);else{var B;const q={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(B=this.texture)||void 0===B?void 0:B.depth:void 0};N=this._engine.createRenderTargetTexture(q,F)}N.texture&&(N.texture.isReady=!0)}return N}_swapRenderTargetWrapper(N){if(this._textures&&N._textures)for(let q=0;q<this._textures.length;++q)this._textures[q]._swapAndDie(N._textures[q],!1),N._textures[q].isReady=!0;this._depthStencilTexture&&N._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(N._depthStencilTexture),N._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const N=this._cloneRenderTargetWrapper();if(N){if(this._depthStencilTexture){const q=this._depthStencilTexture.samplingMode,R=this._depthStencilTexture.format,z=2===q||3===q||11===q;N.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,z,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,R,this._depthStencilTextureLabel)}this.samples>1&&N.setSamples(this.samples),N._swapRenderTargetWrapper(this),N.dispose()}}releaseTextures(){if(this._textures)for(let q=0;q<(null===(N=this._textures)||void 0===N?void 0:N.length);++q){var N;this._textures[q].dispose()}this._textures=null}dispose(){var N;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(N=this._depthStencilTexture)||void 0===N||N.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10966:(N,q,R)=>{"use strict";R.d(q,{e:()=>z});class z{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.ShadersRepository:z.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.ShadersStore:z.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.IncludesShadersStore:z.IncludesShadersStoreWGSL}}z.ShadersRepository="src/Shaders/",z.ShadersStore={},z.IncludesShadersStore={},z.ShadersRepositoryWGSL="src/ShadersWGSL/",z.ShadersStoreWGSL={},z.IncludesShadersStoreWGSL={}},10974:(N,q,R)=>{"use strict";R.d(q,{b:()=>x,e:()=>H,g:()=>e,h:()=>b,i:()=>V,j:()=>t,l:()=>y,p:()=>E,t:()=>A,v:()=>S});class z{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Dd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(N){N&&this.program&&N(this.program)}setEngine(N){this.Dd=N}_fillEffectInformation(N,q,R,z,v,B,F,S){const A=this.Dd;if(A.supportsUniformBuffers)for(const E in q)N.bindUniformBlock(E,q[E]);let y;for(this.Dd.getUniforms(this,R).forEach(((N,q)=>{z[R[q]]=N})),this._uniforms=z,y=0;y<v.length;y++){null==N.getUniform(v[y])&&(v.splice(y,1),y--)}v.forEach(((N,q)=>{B[N]=q}));for(const E of A.getAttributes(this,F))S.push(E)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(N,q){const R=this._valueCache[N],z=q.updateFlag;return(void 0===R||R!==z)&&(this._valueCache[N]=z,!0)}_cacheFloat2(N,q,R){let z=this._valueCache[N];if(!z||2!==z.length)return z=[q,R],this._valueCache[N]=z,!0;let v=!1;return z[0]!==q&&(z[0]=q,v=!0),z[1]!==R&&(z[1]=R,v=!0),v}_cacheFloat3(N,q,R,z){let v=this._valueCache[N];if(!v||3!==v.length)return v=[q,R,z],this._valueCache[N]=v,!0;let B=!1;return v[0]!==q&&(v[0]=q,B=!0),v[1]!==R&&(v[1]=R,B=!0),v[2]!==z&&(v[2]=z,B=!0),B}_cacheFloat4(N,q,R,z,v){let B=this._valueCache[N];if(!B||4!==B.length)return B=[q,R,z,v],this._valueCache[N]=B,!0;let F=!1;return B[0]!==q&&(B[0]=q,F=!0),B[1]!==R&&(B[1]=R,F=!0),B[2]!==z&&(B[2]=z,F=!0),B[3]!==v&&(B[3]=v,F=!0),F}setInt(N,q){const R=this._valueCache[N];void 0!==R&&R===q||this.Dd.setInt(this._uniforms[N],q)&&(this._valueCache[N]=q)}setInt2(N,q,R){this._cacheFloat2(N,q,R)&&(this.Dd.setInt2(this._uniforms[N],q,R)||(this._valueCache[N]=null))}setInt3(N,q,R,z){this._cacheFloat3(N,q,R,z)&&(this.Dd.setInt3(this._uniforms[N],q,R,z)||(this._valueCache[N]=null))}setInt4(N,q,R,z,v){this._cacheFloat4(N,q,R,z,v)&&(this.Dd.setInt4(this._uniforms[N],q,R,z,v)||(this._valueCache[N]=null))}setIntArray(N,q){this._valueCache[N]=null,this.Dd.setIntArray(this._uniforms[N],q)}setIntArray2(N,q){this._valueCache[N]=null,this.Dd.setIntArray2(this._uniforms[N],q)}setIntArray3(N,q){this._valueCache[N]=null,this.Dd.setIntArray3(this._uniforms[N],q)}setIntArray4(N,q){this._valueCache[N]=null,this.Dd.setIntArray4(this._uniforms[N],q)}setUInt(N,q){const R=this._valueCache[N];void 0!==R&&R===q||this.Dd.setUInt(this._uniforms[N],q)&&(this._valueCache[N]=q)}setUInt2(N,q,R){this._cacheFloat2(N,q,R)&&(this.Dd.setUInt2(this._uniforms[N],q,R)||(this._valueCache[N]=null))}setUInt3(N,q,R,z){this._cacheFloat3(N,q,R,z)&&(this.Dd.setUInt3(this._uniforms[N],q,R,z)||(this._valueCache[N]=null))}setUInt4(N,q,R,z,v){this._cacheFloat4(N,q,R,z,v)&&(this.Dd.setUInt4(this._uniforms[N],q,R,z,v)||(this._valueCache[N]=null))}setUIntArray(N,q){this._valueCache[N]=null,this.Dd.setUIntArray(this._uniforms[N],q)}setUIntArray2(N,q){this._valueCache[N]=null,this.Dd.setUIntArray2(this._uniforms[N],q)}setUIntArray3(N,q){this._valueCache[N]=null,this.Dd.setUIntArray3(this._uniforms[N],q)}setUIntArray4(N,q){this._valueCache[N]=null,this.Dd.setUIntArray4(this._uniforms[N],q)}setArray(N,q){this._valueCache[N]=null,this.Dd.setArray(this._uniforms[N],q)}setArray2(N,q){this._valueCache[N]=null,this.Dd.setArray2(this._uniforms[N],q)}setArray3(N,q){this._valueCache[N]=null,this.Dd.setArray3(this._uniforms[N],q)}setArray4(N,q){this._valueCache[N]=null,this.Dd.setArray4(this._uniforms[N],q)}setMatrices(N,q){q&&(this._valueCache[N]=null,this.Dd.setMatrices(this._uniforms[N],q))}setMatrix(N,q){this._cacheMatrix(N,q)&&(this.Dd.setMatrices(this._uniforms[N],q.ij())||(this._valueCache[N]=null))}setMatrix3x3(N,q){this._valueCache[N]=null,this.Dd.setMatrix3x3(this._uniforms[N],q)}setMatrix2x2(N,q){this._valueCache[N]=null,this.Dd.setMatrix2x2(this._uniforms[N],q)}setFloat(N,q){const R=this._valueCache[N];void 0!==R&&R===q||this.Dd.setFloat(this._uniforms[N],q)&&(this._valueCache[N]=q)}setVector2(N,q){this._cacheFloat2(N,q.x,q.y)&&(this.Dd.setFloat2(this._uniforms[N],q.x,q.y)||(this._valueCache[N]=null))}setFloat2(N,q,R){this._cacheFloat2(N,q,R)&&(this.Dd.setFloat2(this._uniforms[N],q,R)||(this._valueCache[N]=null))}setVector3(N,q){this._cacheFloat3(N,q.x,q.y,q.z)&&(this.Dd.setFloat3(this._uniforms[N],q.x,q.y,q.z)||(this._valueCache[N]=null))}setFloat3(N,q,R,z){this._cacheFloat3(N,q,R,z)&&(this.Dd.setFloat3(this._uniforms[N],q,R,z)||(this._valueCache[N]=null))}setVector4(N,q){this._cacheFloat4(N,q.x,q.y,q.z,q.w)&&(this.Dd.setFloat4(this._uniforms[N],q.x,q.y,q.z,q.w)||(this._valueCache[N]=null))}setQuaternion(N,q){this._cacheFloat4(N,q.x,q.y,q.z,q.w)&&(this.Dd.setFloat4(this._uniforms[N],q.x,q.y,q.z,q.w)||(this._valueCache[N]=null))}setFloat4(N,q,R,z,v){this._cacheFloat4(N,q,R,z,v)&&(this.Dd.setFloat4(this._uniforms[N],q,R,z,v)||(this._valueCache[N]=null))}setColor3(N,q){this._cacheFloat3(N,q.r,q.g,q.b)&&(this.Dd.setFloat3(this._uniforms[N],q.r,q.g,q.b)||(this._valueCache[N]=null))}setColor4(N,q,R){this._cacheFloat4(N,q.r,q.g,q.b,R)&&(this.Dd.setFloat4(this._uniforms[N],q.r,q.g,q.b,R)||(this._valueCache[N]=null))}setDirectColor4(N,q){this._cacheFloat4(N,q.r,q.g,q.b,q.a)&&(this.Dd.setFloat4(this._uniforms[N],q.r,q.g,q.b,q.a)||(this._valueCache[N]=null))}_getVertexShaderCode(){return this.vertexShader?this.Dd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Dd._getShaderSource(this.fragmentShader):null}}var v=R(10951);const B=new WeakMap,F={_webGLVersion:2,cachedPipelines:{}};function S(N){let q=B.get(N);if(!q){if(!N)return F;q={_webGLVersion:N.TEXTURE_BINDING_3D?2:1,_context:N,cachedPipelines:{}},B.set(N,q)}return q}function A(N){B.delete(N)}function y(N,q,R,z,v,B){const F=S(z);B||(B=F._createShaderProgramInjection??x);return B(N,D(q,"vertex",z,F._contextWasLost),D(R,"fragment",z,F._contextWasLost),z,v,F.validateShaderPrograms)}function E(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0;const A=S(v);F||(F=A._createShaderProgramInjection??x);const y=A._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return F(N,f(q,"vertex",z,y,v,A._contextWasLost),f(R,"fragment",z,y,v,A._contextWasLost),v,B,A.validateShaderPrograms)}function t(N,q){const R=new z,v=S(N);return v.parallelShaderCompile&&(R.isParallelCompiled=!0),R.context=v._context,R}function x(N,q,R,z){let v=arguments.length>5?arguments[5]:void 0;const B=z.createProgram();if(N.program=B,!B)throw new Error("Unable to create program");return z.attachShader(B,q),z.attachShader(B,R),z.linkProgram(B),N.context=z,N.vertexShader=q,N.fragmentShader=R,N.isParallelCompiled||e(N,z,v),B}function e(N,q,R){const z=N.context,v=N.vertexShader,B=N.fragmentShader,F=N.program;if(!z.getProgramParameter(F,z.LINK_STATUS)){if(!q.getShaderParameter(v,q.COMPILE_STATUS)){const R=q.getShaderInfoLog(v);if(R)throw N.vertexCompilationError=R,new Error("VERTEX SHADER "+R)}if(!q.getShaderParameter(B,q.COMPILE_STATUS)){const R=q.getShaderInfoLog(B);if(R)throw N.fragmentCompilationError=R,new Error("FRAGMENT SHADER "+R)}const R=z.getProgramInfoLog(F);if(R)throw N.programLinkError=R,new Error(R)}if(R){z.validateProgram(F);if(!z.getProgramParameter(F,z.VALIDATE_STATUS)){const q=z.getProgramInfoLog(F);if(q)throw N.programValidationError=q,new Error(q)}}z.deleteShader(v),z.deleteShader(B),N.vertexShader=void 0,N.fragmentShader=void 0,N.onCompiled&&(N.onCompiled(),N.onCompiled=void 0)}function b(N,q,R,z,v,B,F,A,t){let x=arguments.length>10?arguments[10]:void 0,e=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0;const f=S(N.context);e||(e=f.createRawShaderProgramInjection??y),b||(b=f.createShaderProgramInjection??E);const D=N;D.program=z?e(D,q,R,D.context,t):b(D,q,R,A,D.context,t),D.program.__SPECTOR_rebuildProgram=F,x()}function f(N,q,R,z,B,F){return D((0,v.f)(N,R,z),q,B,F)}function D(N,q,R,z){const v=R.createShader("vertex"===q?R.VERTEX_SHADER:R.FRAGMENT_SHADER);if(!v){let N=R.NO_ERROR,v=R.NO_ERROR;for(;(v=R.getError())!==R.NO_ERROR;)N=v;throw new Error(`Something went wrong while creating a gl ${q} shader object. gl error=${N}, gl isContextLost=${R.isContextLost()}, _contextWasLost=${z}`)}return R.shaderSource(v,N),R.compileShader(v),v}function V(N,q){q.useProgram(N)}function H(N,q){const R=N;if(!R.isParallelCompiled)return void q(N);const z=R.onCompiled;R.onCompiled=()=>{null===z||void 0===z||z(),q(N)}}},11614:(N,q,R)=>{"use strict";R.r(q),R.d(q,{ThinEngine:()=>Y});var z=R(10974),v=R(11622),B=R(10907),F=R(10900);class S{constructor(){this.shaderLanguage=0}postProcessor(N,q,R,z,v){if(v.drawBuffersExtensionDisabled){const q=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;N=N.replace(q,"")}return N}}const A=/(flat\s)?\s*varying\s*.*/;class y{constructor(){this.shaderLanguage=0}attributeProcessor(N){return N.replace("attribute","in")}varyingCheck(N,q){return A.test(N)}varyingProcessor(N,q){return N.replace("varying",q?"in":"out")}postProcessor(N,q,R){const z=-1!==N.search(/#extension.+GL_EXT_draw_buffers.+require/);if(N=(N=N.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),R){const q=-1!==N.search(/layout *\(location *= *0\) *out/g);N=(N=(N=(N=(N=(N=(N=N.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(z||q?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==q.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+N}return N}}var E=R(11630),t=R(11013),x=R(10957),e=R(11634),b=R(10985),f=R(10964),D=R(10951),V=R(10968);class H{}class Y extends x.d{get name(){return this._name}set name(N){this._name=N}get version(){return this._webGLVersion}static get ShadersRepository(){return f.d.ShadersRepository}static set ShadersRepository(N){f.d.ShadersRepository=N}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(N){this._framebufferDimensionsObject=N}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(N,q,R,v){if(R=R||{},super(q??R.antialias,R,v),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!N)return;let F=null;if(N.getContext){if(F=N,this._renderingCanvas=F,void 0===R.Ah&&(R.Ah=!1),void 0===R.xrCompatible&&(R.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const N=navigator.userAgent;for(const q of Y.ExceptionList){const z=q.key,v=q.targets;if(new RegExp(z).test(N)){if(q.capture&&q.captureConstraint){const R=q.capture,z=q.captureConstraint,v=new RegExp(R).exec(N);if(v&&v.length>0){if(parseInt(v[v.length-1])>=z)continue}}for(const N of v)switch(N){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":R.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=N=>{N.preventDefault(),this._contextWasLost=!0,B.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},F.addEventListener("webglcontextlost",this._onContextLost,!1),F.addEventListener("webglcontextrestored",this._onContextRestored,!1),R.powerPreference=R.powerPreference||"high-performance"),this._badDesktopOS&&(R.xrCompatible=!1),!R.disableWebGL2Support)try{this._gl=F.getContext("webgl2",R)||F.getContext("experimental-webgl2",R),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(t){}if(!this._gl){if(!F)throw new Error("The provided canvas is null or undefined.");try{this._gl=F.getContext("webgl",R)||F.getContext("experimental-webgl",R)}catch(t){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=N,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const q=this._gl.getContextAttributes();q&&(R.stencil=q.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==R.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=R.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let z=0;z<this._caps.maxVertexAttribs;z++)this._currentBufferPointers[z]=new H;this._shaderProcessor=this.webGLVersion>1?new y:new S;const A=`Babylon.js v${Y.Version}`;B.c.Log(A+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",A);const E=(0,z.v)(this._gl);E.validateShaderPrograms=this.validateShaderPrograms,E.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(N){return null}areAllEffectsReady(){for(const N in this._compiledEffects){if(!this._compiledEffects[N].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const N=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=N&&(this._glRenderer=this._gl.getParameter(N.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(N.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const N=this._gl.getExtension("WEBGL_draw_buffers");if(null!==N){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=N.drawBuffersWEBGL.bind(N),this._caps.maxDrawBuffers=this._gl.getParameter(N.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let q=0;q<16;q++)this._gl["COLOR_ATTACHMENT"+q+"_WEBGL"]=N["COLOR_ATTACHMENT"+q+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const N=this._gl.getExtension("WEBGL_depth_texture");null!=N&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=N.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const N=this._gl.getExtension("OES_vertex_array_object");null!=N&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=N.createVertexArrayOES.bind(N),this._gl.bindVertexArray=N.bindVertexArrayOES.bind(N),this._gl.deleteVertexArray=N.deleteVertexArrayOES.bind(N))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const N=this._gl.getExtension("ANGLE_instanced_arrays");null!=N?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=N.drawArraysInstancedANGLE.bind(N),this._gl.drawElementsInstanced=N.drawElementsInstancedANGLE.bind(N),this._gl.vertexAttribDivisor=N.vertexAttribDivisorANGLE.bind(N)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const N=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),q=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);N&&q&&(this._caps.highPrecisionShaderSupported=0!==N.precision&&0!==q.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const N=this._gl.getExtension("EXT_blend_minmax");null!=N&&(this._caps.blendMinMax=!0,this._gl.MAX=N.MAX_EXT,this._gl.MIN=N.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const N=this._gl.getExtension("EXT_sRGB");null!=N&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:N.SRGB_EXT,SRGB8:N.SRGB_ALPHA_EXT,SRGB8_ALPHA8:N.SRGB_ALPHA_EXT})}if(this._creationOptions){const N=this._creationOptions.forceSRGBBufferSupportState;void 0!==N&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&N)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let q=0;q<this._maxSimultaneousTextures;q++)this._nextFreeTextureSlots.push(q);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const N=this._workingCanvas.getContext("2d");N&&(this._workingContext=N)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const N=this.getGlInfo();return N&&N.renderer?N.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const v=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=v;let B=0;if(q&&N){let q=!0;if(this._currentRenderTarget){var F;const R=null===(F=this._currentRenderTarget.texture)||void 0===F?void 0:F.format;if(8===R||9===R||10===R||11===R){var S;const R=null===(S=this._currentRenderTarget.texture)||void 0===S?void 0:S.type;7===R||5===R?(Y._TempClearColorUint32[0]=255*N.r,Y._TempClearColorUint32[1]=255*N.g,Y._TempClearColorUint32[2]=255*N.b,Y._TempClearColorUint32[3]=255*N.a,this._gl.clearBufferuiv(this._gl.COLOR,0,Y._TempClearColorUint32),q=!1):(Y._TempClearColorInt32[0]=255*N.r,Y._TempClearColorInt32[1]=255*N.g,Y._TempClearColorInt32[2]=255*N.b,Y._TempClearColorInt32[3]=255*N.a,this._gl.clearBufferiv(this._gl.COLOR,0,Y._TempClearColorInt32),q=!1)}}q&&(this._gl.clearColor(N.r,N.g,N.b,void 0!==N.a?N.a:1),B|=this._gl.COLOR_BUFFER_BIT)}R&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),B|=this._gl.DEPTH_BUFFER_BIT),z&&(this._gl.clearStencil(0),B|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(B)}_viewport(N,q,R,z){N===this._viewportCached.x&&q===this._viewportCached.y&&R===this._viewportCached.z&&z===this._viewportCached.w||(this._viewportCached.x=N,this._viewportCached.y=q,this._viewportCached.z=R,this._viewportCached.w=z,this._gl.viewport(N,q,R,z))}fj(){super.fj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const A=N;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=N,this._bindUnboundFramebuffer(A._framebuffer);const y=this._gl;var E;if(!N.isMulti)if(N.is2DArray||N.is3D)y.framebufferTextureLayer(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,null===(E=N.texture._hardwareTexture)||void 0===E?void 0:E.underlyingResource,F,S),A._currentLOD=F;else if(N.isCube){var t;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+q,null===(t=N.texture._hardwareTexture)||void 0===t?void 0:t.underlyingResource,F)}else if(A._currentLOD!==F){var x;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,null===(x=N.texture._hardwareTexture)||void 0===x?void 0:x.underlyingResource,F),A._currentLOD=F}const e=N._depthStencilTexture;if(e){N.is3D&&(N.texture.width===e.width&&N.texture.height===e.height&&N.texture.depth===e.depth||B.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const R=N._depthStencilTextureWithStencil?y.DEPTH_STENCIL_ATTACHMENT:y.DEPTH_ATTACHMENT;var b;if(N.is2DArray||N.is3D)y.framebufferTextureLayer(y.FRAMEBUFFER,R,null===(b=e._hardwareTexture)||void 0===b?void 0:b.underlyingResource,F,S);else if(N.isCube){var f;y.framebufferTexture2D(y.FRAMEBUFFER,R,y.TEXTURE_CUBE_MAP_POSITIVE_X+q,null===(f=e._hardwareTexture)||void 0===f?void 0:f.underlyingResource,F)}else{var D;y.framebufferTexture2D(y.FRAMEBUFFER,R,y.TEXTURE_2D,null===(D=e._hardwareTexture)||void 0===D?void 0:D.underlyingResource,F)}}A._MSAAFramebuffer&&this._bindUnboundFramebuffer(A._MSAAFramebuffer),this._cachedViewport&&!v?this.setViewport(this._cachedViewport,R,z):(R||(R=N.width,F&&(R/=Math.pow(2,F))),z||(z=N.height,F&&(z/=Math.pow(2,F))),this._viewport(0,0,R,z)),this.wipeCaches()}setState(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==N||R)&&(this._depthCullingState.cull=N);const S=this.cullBackFaces??v??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==S||R)&&(this._depthCullingState.cullFace=S),this.setZOffset(q),this.setZOffsetUnits(F);const A=z?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==A||R)&&(this._depthCullingState.frontFace=A),this._stencilStateComposer.stencilMaterial=B}_bindUnboundFramebuffer(N){this._currentFramebuffer!==N&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,N),this._currentFramebuffer=N)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(N){const q=this._getTextureTarget(N);this._bindTextureDirectly(q,N,!0),this._gl.generateMipmap(q),this._bindTextureDirectly(q,null)}unBindFramebuffer(N){var q;let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2?arguments[2]:void 0;const v=N;this._currentRenderTarget=null;const B=this._gl;if(v._MSAAFramebuffer){if(N.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(N,R,z);B.bindFramebuffer(B.READ_FRAMEBUFFER,v._MSAAFramebuffer),B.bindFramebuffer(B.DRAW_FRAMEBUFFER,v._framebuffer),B.blitFramebuffer(0,0,N.width,N.height,0,0,N.width,N.height,B.COLOR_BUFFER_BIT,B.NEAREST)}null===(q=N.texture)||void 0===q||!q.generateMipMaps||R||N.isCube||this.generateMipmaps(N.texture),z&&(v._MSAAFramebuffer&&this._bindUnboundFramebuffer(v._framebuffer),z()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(N,q,R){return this._createVertexBuffer(N,this._gl.STATIC_DRAW)}_createVertexBuffer(N,q){const R=this._gl.createBuffer();if(!R)throw new Error("Unable to create vertex buffer");const z=new E.c(R);return this.bindArrayBuffer(z),"number"!==typeof N?N instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(N),q),z.rb=4*N.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,N,q),z.rb=N.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(N),q),z.rb=N),this._resetVertexBufferBinding(),z.references=1,z}createDynamicVertexBuffer(N,q){return this._createVertexBuffer(N,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(N,q,R){const z=this._gl.createBuffer(),v=new E.c(z);if(!z)throw new Error("Unable to create index buffer");this.bindIndexBuffer(v);const B=this._normalizeIndexData(N);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,B,q?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),v.references=1,v.is32Bits=4===B.BYTES_PER_ELEMENT,v}_normalizeIndexData(N){if(2===N.BYTES_PER_ELEMENT)return N;if(this._caps.uintIndices){if(N instanceof Uint32Array)return N;for(let q=0;q<N.length;q++)if(N[q]>=65535)return new Uint32Array(N);return new Uint16Array(N)}return new Uint16Array(N)}bindArrayBuffer(N){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(N,this._gl.ARRAY_BUFFER)}bindUniformBlock(N,q,R){const z=N.program,v=this._gl.getUniformBlockIndex(z,q);this._gl.uniformBlockBinding(z,v,R)}bindIndexBuffer(N){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(N,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(N,q){(this._vaoRecordInProgress||this._currentBoundBuffer[q]!==N)&&(this._gl.bindBuffer(q,N?N.underlyingResource:null),this._currentBoundBuffer[q]=N)}updateArrayBuffer(N){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,N)}_vertexAttribPointer(N,q,R,z,v,B,F){const S=this._currentBufferPointers[q];if(!S)return;let A=!1;S.active?(S.buffer!==N&&(S.buffer=N,A=!0),S.size!==R&&(S.size=R,A=!0),S.type!==z&&(S.type=z,A=!0),S.normalized!==v&&(S.normalized=v,A=!0),S.stride!==B&&(S.stride=B,A=!0),S.offset!==F&&(S.offset=F,A=!0)):(A=!0,S.active=!0,S.index=q,S.size=R,S.type=z,S.normalized=v,S.stride=B,S.offset=F,S.buffer=N),(A||this._vaoRecordInProgress)&&(this.bindArrayBuffer(N),z===this._gl.UNSIGNED_INT||z===this._gl.INT?this._gl.vertexAttribIPointer(q,R,z,B,F):this._gl.vertexAttribPointer(q,R,z,v,B,F))}_bindIndexBufferWithCache(N){null!=N&&this._cachedIndexBuffer!==N&&(this._cachedIndexBuffer=N,this.bindIndexBuffer(N),this._uintIndicesCurrentlySet=N.is32Bits)}_bindVertexBuffersAttributes(N,q,R){const z=q.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let v=0;v<z.length;v++){const B=q.getAttributeLocation(v);if(B>=0){const q=z[v];let F=null;if(R&&(F=R[q]),F||(F=N[q]),!F)continue;this._gl.enableVertexAttribArray(B),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[B]=!0);const S=F.getBuffer();S&&(this._vertexAttribPointer(S,B,F.getSize(),F.type,F.normalized,F.byteStride,F.byteOffset),F.getIsInstanced()&&(this._gl.vertexAttribDivisor(B,F.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(B),this._currentInstanceBuffers.push(S))))}}}recordVertexArrayObject(N,q,R,z){const v=this._gl.createVertexArray();if(!v)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(v),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(N,R,z),this.bindIndexBuffer(q),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),v}bindVertexArrayObject(N,q){this._cachedVertexArrayObject!==N&&(this._cachedVertexArrayObject=N,this._gl.bindVertexArray(N),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=q&&q.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(N,q,R,z,v){if(this._cachedVertexBuffers!==N||this._cachedEffectForVertexBuffers!==v){this._cachedVertexBuffers=N,this._cachedEffectForVertexBuffers=v;const q=v.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let B=0;for(let F=0;F<q;F++)if(F<R.length){const q=v.getAttributeLocation(F);q>=0&&(this._gl.enableVertexAttribArray(q),this._vertexAttribArraysEnabled[q]=!0,this._vertexAttribPointer(N,q,R[F],this._gl.FLOAT,!1,z,B)),B+=4*R[F]}}this._bindIndexBufferWithCache(q)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(N,q,R,z){this._cachedVertexBuffers===N&&this._cachedEffectForVertexBuffers===R||(this._cachedVertexBuffers=N,this._cachedEffectForVertexBuffers=R,this._bindVertexBuffersAttributes(N,R,z)),this._bindIndexBufferWithCache(q)}unbindInstanceAttributes(){let N;for(let q=0,R=this._currentInstanceLocations.length;q<R;q++){const R=this._currentInstanceBuffers[q];N!=R&&R.references&&(N=R,this.bindArrayBuffer(R));const z=this._currentInstanceLocations[q];this._gl.vertexAttribDivisor(z,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(N){this._gl.deleteVertexArray(N)}_releaseBuffer(N){return N.references--,0===N.references&&(this._deleteBuffer(N),!0)}_deleteBuffer(N){this._gl.deleteBuffer(N.underlyingResource)}updateAndBindInstancesBuffer(N,q,R){if(this.bindArrayBuffer(N),q&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,q),void 0!==R[0].index)this.bindInstancesBuffer(N,R,!0);else for(let z=0;z<4;z++){const q=R[z];this._vertexAttribArraysEnabled[q]||(this._gl.enableVertexAttribArray(q),this._vertexAttribArraysEnabled[q]=!0),this._vertexAttribPointer(N,q,4,this._gl.FLOAT,!1,64,16*z),this._gl.vertexAttribDivisor(q,1),this._currentInstanceLocations.push(q),this._currentInstanceBuffers.push(N)}}bindInstancesBuffer(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(N);let z=0;if(R)for(let v=0;v<q.length;v++){z+=4*q[v].attributeSize}for(let v=0;v<q.length;v++){const R=q[v];void 0===R.index&&(R.index=this._currentEffect.getAttributeLocationByName(R.attributeName)),R.index<0||(this._vertexAttribArraysEnabled[R.index]||(this._gl.enableVertexAttribArray(R.index),this._vertexAttribArraysEnabled[R.index]=!0),this._vertexAttribPointer(N,R.index,R.attributeSize,R.attributeType||this._gl.FLOAT,R.normalized||!1,z,R.offset),this._gl.vertexAttribDivisor(R.index,void 0===R.divisor?1:R.divisor),this._currentInstanceLocations.push(R.index),this._currentInstanceBuffers.push(N))}}disableInstanceAttributeByName(N){if(!this._currentEffect)return;const q=this._currentEffect.getAttributeLocationByName(N);this.disableInstanceAttribute(q)}disableInstanceAttribute(N){let q,R=!1;for(;-1!==(q=this._currentInstanceLocations.indexOf(N));)this._currentInstanceLocations.splice(q,1),this._currentInstanceBuffers.splice(q,1),R=!0,q=this._currentInstanceLocations.indexOf(N);R&&(this._gl.vertexAttribDivisor(N,0),this.disableAttributeByIndex(N))}disableAttributeByIndex(N){this._gl.disableVertexAttribArray(N),this._vertexAttribArraysEnabled[N]=!1,this._currentBufferPointers[N].active=!1}draw(N,q,R,z){this.drawElementsType(N?0:1,q,R,z)}drawPointClouds(N,q,R){this.drawArraysType(2,N,q,R)}drawUnIndexed(N,q,R,z){this.drawArraysType(N?0:1,q,R,z)}drawElementsType(N,q,R,z){this.applyStates(),this._reportDrawCall();const v=this._drawMode(N),B=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,F=this._uintIndicesCurrentlySet?4:2;z?this._gl.drawElementsInstanced(v,R,B,q*F,z):this._gl.drawElements(v,R,B,q*F)}drawArraysType(N,q,R,z){this.applyStates(),this._reportDrawCall();const v=this._drawMode(N);z?this._gl.drawArraysInstanced(v,q,R,z):this._gl.drawArrays(v,q,R)}_drawMode(N){switch(N){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(N){this._compiledEffects[N._key]&&delete this._compiledEffects[N._key];const q=N.getPipelineContext();q&&this._deletePipelineContext(q)}_deletePipelineContext(N){const q=N;q&&q.program&&(q.program.__SPECTOR_rebuildProgram=null,(0,V.m)(q),this._gl.deleteProgram(q.program))}_getGlobalDefines(N){return(0,D.i)(N,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(N,q,R,v,B,F,S,A,y){let E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,t=arguments.length>10?arguments[10]:void 0;const x="string"===typeof N?N:N.vertexToken||N.vertexSource||N.vertexElement||N.vertex,e="string"===typeof N?N:N.fragmentToken||N.fragmentSource||N.fragmentElement||N.fragment,b=this._getGlobalDefines();let D=B??q.defines??"";b&&(D+=b);const V=x+"+"+e+"@"+D;if(this._compiledEffects[V]){const N=this._compiledEffects[V];return S&&N.isReady()&&S(N),N._refCount++,N}this._gl&&(0,z.v)(this._gl);const H=new f.d(N,q,R,v,this,B,F,S,A,y,V,q.shaderLanguage??E,q.extraInitializationsAsync??t);return this._compiledEffects[V]=H,H}_getShaderSource(N){return this._gl.getShaderSource(N)}createRawShaderProgram(N,q,R,v){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=(0,z.v)(this._gl);return F._contextWasLost=this._contextWasLost,F.validateShaderPrograms=this.validateShaderPrograms,(0,z.l)(N,q,R,v||this._gl,B)}createShaderProgram(N,q,R,v,B){let F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const S=(0,z.v)(this._gl);return S._contextWasLost=this._contextWasLost,S.validateShaderPrograms=this.validateShaderPrograms,(0,z.p)(N,q,R,v,B||this._gl,F)}inlineShaderCode(N){return N}createPipelineContext(N){if(this._gl){(0,z.v)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const q=(0,z.j)(this._gl,N);return q.Dd=this,q}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(N){return(0,z.g)(N,this._gl,this.validateShaderPrograms)}_preparePipelineContext(N,q,R,v,B,F,S,A,y,E,t){const x=(0,z.v)(this._gl);return x._contextWasLost=this._contextWasLost,x.validateShaderPrograms=this.validateShaderPrograms,x._createShaderProgramInjection=this._createShaderProgram.bind(this),x.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),x.createShaderProgramInjection=this.createShaderProgram.bind(this),x.loadFileInjection=this._loadFile.bind(this),(0,z.h)(N,q,R,v,B,F,S,A,y,E,t)}_createShaderProgram(N,q,R,v){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,z.b)(N,q,R,v,B)}_isRenderingStateCompiled(N){const q=N;return!this._isDisposed&&!q._isDisposed&&(!!this._gl.getProgramParameter(q.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(q),!0))}_executeWhenRenderingStateIsCompiled(N,q){(0,z.e)(N,q)}getUniforms(N,q){const R=new Array,z=N;for(let v=0;v<q.length;v++)R.push(this._gl.getUniformLocation(z.program,q[v]));return R}getAttributes(N,q){const R=[],z=N;for(let B=0;B<q.length;B++)try{R.push(this._gl.getAttribLocation(z.program,q[B]))}catch(v){R.push(-1)}return R}enableEffect(N){(N=null!==N&&(0,v.b)(N)?N.effect:N)&&N!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(N),this._currentEffect=N,N.onBind&&N.onBind(N),N._onBindObservable&&N._onBindObservable.notifyObservers(N))}setInt(N,q){return!!N&&(this._gl.uniform1i(N,q),!0)}setInt2(N,q,R){return!!N&&(this._gl.uniform2i(N,q,R),!0)}setInt3(N,q,R,z){return!!N&&(this._gl.uniform3i(N,q,R,z),!0)}setInt4(N,q,R,z,v){return!!N&&(this._gl.uniform4i(N,q,R,z,v),!0)}setIntArray(N,q){return!!N&&(this._gl.uniform1iv(N,q),!0)}setIntArray2(N,q){return!(!N||q.length%2!==0)&&(this._gl.uniform2iv(N,q),!0)}setIntArray3(N,q){return!(!N||q.length%3!==0)&&(this._gl.uniform3iv(N,q),!0)}setIntArray4(N,q){return!(!N||q.length%4!==0)&&(this._gl.uniform4iv(N,q),!0)}setUInt(N,q){return!!N&&(this._gl.uniform1ui(N,q),!0)}setUInt2(N,q,R){return!!N&&(this._gl.uniform2ui(N,q,R),!0)}setUInt3(N,q,R,z){return!!N&&(this._gl.uniform3ui(N,q,R,z),!0)}setUInt4(N,q,R,z,v){return!!N&&(this._gl.uniform4ui(N,q,R,z,v),!0)}setUIntArray(N,q){return!!N&&(this._gl.uniform1uiv(N,q),!0)}setUIntArray2(N,q){return!(!N||q.length%2!==0)&&(this._gl.uniform2uiv(N,q),!0)}setUIntArray3(N,q){return!(!N||q.length%3!==0)&&(this._gl.uniform3uiv(N,q),!0)}setUIntArray4(N,q){return!(!N||q.length%4!==0)&&(this._gl.uniform4uiv(N,q),!0)}setArray(N,q){return!!N&&(!(q.length<1)&&(this._gl.uniform1fv(N,q),!0))}setArray2(N,q){return!(!N||q.length%2!==0)&&(this._gl.uniform2fv(N,q),!0)}setArray3(N,q){return!(!N||q.length%3!==0)&&(this._gl.uniform3fv(N,q),!0)}setArray4(N,q){return!(!N||q.length%4!==0)&&(this._gl.uniform4fv(N,q),!0)}setMatrices(N,q){return!!N&&(this._gl.uniformMatrix4fv(N,!1,q),!0)}setMatrix3x3(N,q){return!!N&&(this._gl.uniformMatrix3fv(N,!1,q),!0)}setMatrix2x2(N,q){return!!N&&(this._gl.uniformMatrix2fv(N,!1,q),!0)}setFloat(N,q){return!!N&&(this._gl.uniform1f(N,q),!0)}setFloat2(N,q,R){return!!N&&(this._gl.uniform2f(N,q,R),!0)}setFloat3(N,q,R,z){return!!N&&(this._gl.uniform3f(N,q,R,z),!0)}setFloat4(N,q,R,z,v){return!!N&&(this._gl.uniform4f(N,q,R,z,v),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const N=this._colorWrite;this._gl.colorMask(N,N,N,N)}}wipeCaches(N){this.preventCacheWipeBetweenFrames&&!N||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),N&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(N,q){const R=this._gl;let z=R.NEAREST,v=R.NEAREST;switch(N){case 11:z=R.LINEAR,v=q?R.LINEAR_MIPMAP_NEAREST:R.LINEAR;break;case 3:z=R.LINEAR,v=q?R.LINEAR_MIPMAP_LINEAR:R.LINEAR;break;case 8:z=R.NEAREST,v=q?R.NEAREST_MIPMAP_LINEAR:R.NEAREST;break;case 4:z=R.NEAREST,v=q?R.NEAREST_MIPMAP_NEAREST:R.NEAREST;break;case 5:z=R.NEAREST,v=q?R.LINEAR_MIPMAP_NEAREST:R.LINEAR;break;case 6:z=R.NEAREST,v=q?R.LINEAR_MIPMAP_LINEAR:R.LINEAR;break;case 7:z=R.NEAREST,v=R.LINEAR;break;case 1:z=R.NEAREST,v=R.NEAREST;break;case 9:z=R.LINEAR,v=q?R.NEAREST_MIPMAP_NEAREST:R.NEAREST;break;case 10:z=R.LINEAR,v=q?R.NEAREST_MIPMAP_LINEAR:R.NEAREST;break;case 2:z=R.LINEAR,v=R.LINEAR;break;case 12:z=R.LINEAR,v=R.NEAREST}return{min:v,mag:z}}_createTexture(){const N=this._gl.createTexture();if(!N)throw new Error("Unable to create texture");return N}_createHardwareTexture(){return new e.d(this._createTexture(),this._gl)}_createInternalTexture(N,q){let R,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=!1,F=0,S=3,A=5,y=!1,E=1;void 0!==q&&"object"===typeof q?(v=!!q.generateMipMaps,F=void 0===q.type?0:q.type,S=void 0===q.samplingMode?3:q.samplingMode,A=void 0===q.format?5:q.format,y=void 0!==q.useSRGBBuffer&&q.useSRGBBuffer,E=q.samples??1,R=q.label):v=!!q,y&&(y=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==F||this._caps.textureFloatLinearFiltering)&&(2!==F||this._caps.textureHalfFloatLinearFiltering)||(S=1),1!==F||this._caps.textureFloat||(F=0,B.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const t=this._gl,x=new b.c(this,z),e=N.width||N,f=N.height||N,D=N.depth||0,V=N.layers||0,H=this._getSamplingParameters(S,v),Y=0!==V?t.TEXTURE_2D_ARRAY:0!==D?t.TEXTURE_3D:t.TEXTURE_2D,T=this._getRGBABufferInternalSizedFormat(F,A,y),L=this._getInternalFormat(A),X=this._getWebGLTextureType(F);return this._bindTextureDirectly(Y,x),0!==V?(x.is2DArray=!0,t.texImage3D(Y,0,T,e,f,V,0,L,X,null)):0!==D?(x.is3D=!0,t.texImage3D(Y,0,T,e,f,D,0,L,X,null)):t.texImage2D(Y,0,T,e,f,0,L,X,null),t.texParameteri(Y,t.TEXTURE_MAG_FILTER,H.mag),t.texParameteri(Y,t.TEXTURE_MIN_FILTER,H.min),t.texParameteri(Y,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(Y,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),v&&this._gl.generateMipmap(Y),this._bindTextureDirectly(Y,null),x._useSRGBBuffer=y,x.baseWidth=e,x.baseHeight=f,x.width=e,x.height=f,x.depth=V,x.isReady=!0,x.samples=E,x.generateMipMaps=v,x.samplingMode=S,x.type=F,x.format=A,x.label=R,this._internalTexturesCache.push(x),x}_getUseSRGBBuffer(N,q){return N&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||q)}createTexture(N,q,R,z){var v=this;let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,x=arguments.length>11?arguments[11]:void 0,e=arguments.length>12?arguments[12]:void 0,f=arguments.length>13?arguments[13]:void 0,D=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(N,q,R,z,B,F,S,(function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];return v._prepareWebGLTexture(...q,E)}),((N,q,R,v,B,F)=>{const S=this._gl,A=R.width===N&&R.height===q;B._creationFlags=f??0;const y=this._getTexImageParametersForCreateTexture(B.format,B._useSRGBBuffer);if(A)return S.texImage2D(S.TEXTURE_2D,0,y.internalFormat,y.format,y.type,R),!1;const E=this._caps.maxTextureSize;if(R.width>E||R.height>E||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=N,this._workingCanvas.height=q,this._workingContext.drawImage(R,0,0,R.width,R.height,0,0,N,q),S.texImage2D(S.TEXTURE_2D,0,y.internalFormat,y.format,y.type,this._workingCanvas),B.width=N,B.height=q,!1);{const N=new b.c(this,2);this._bindTextureDirectly(S.TEXTURE_2D,N,!0),S.texImage2D(S.TEXTURE_2D,0,y.internalFormat,y.format,y.type,R),this._rescaleTexture(N,B,z,y.format,(()=>{this._releaseTexture(N),this._bindTextureDirectly(S.TEXTURE_2D,B,!0),F()}))}return!0}),A,y,E,t,x,e,D)}_getTexImageParametersForCreateTexture(N,q){let R,z;return 1===this.webGLVersion?(R=this._getInternalFormat(N,q),z=R):(R=this._getInternalFormat(N,!1),z=this._getRGBABufferInternalSizedFormat(0,N,q)),{internalFormat:z,format:R,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(N,q,R,z,v){}_unpackFlipY(N){this._unpackFlipYCached!==N&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,N?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=N))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(N){return N.isCube?this._gl.TEXTURE_CUBE_MAP:N.is3D?this._gl.TEXTURE_3D:N.is2DArray||N.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this._getTextureTarget(q),v=this._getSamplingParameters(N,q.useMipMaps||R);this._setTextureParameterInteger(z,this._gl.TEXTURE_MAG_FILTER,v.mag,q),this._setTextureParameterInteger(z,this._gl.TEXTURE_MIN_FILTER,v.min),R&&(q.generateMipMaps=!0,this._gl.generateMipmap(z)),this._bindTextureDirectly(z,null),q.samplingMode=N}updateTextureDimensions(N,q,R){}updateTextureWrappingMode(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const v=this._getTextureTarget(N);null!==q&&(this._setTextureParameterInteger(v,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(q),N),N._cachedWrapU=q),null!==R&&(this._setTextureParameterInteger(v,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(R),N),N._cachedWrapV=R),(N.is2DArray||N.is3D)&&null!==z&&(this._setTextureParameterInteger(v,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(z),N),N._cachedWrapR=z),this._bindTextureDirectly(v,null)}_uploadCompressedDataToTextureDirectly(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const S=this._gl;let A=S.TEXTURE_2D;if(N.isCube&&(A=S.TEXTURE_CUBE_MAP_POSITIVE_X+B),N._useSRGBBuffer)switch(q){case 37492:case 36196:this._caps.etc2?q=S.COMPRESSED_SRGB8_ETC2:N._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?q=S.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:N._useSRGBBuffer=!1;break;case 36492:q=S.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:q=S.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?q=S.COMPRESSED_SRGB_S3TC_DXT1_EXT:N._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?q=S.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:N._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?q=S.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:N._useSRGBBuffer=!1;break;default:N._useSRGBBuffer=!1}this._gl.compressedTexImage2D(A,F,q,R,z,0,v)}_uploadDataToTextureDirectly(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=this._gl,S=this._getWebGLTextureType(N.type),A=this._getInternalFormat(N.format),y=void 0===v?this._getRGBABufferInternalSizedFormat(N.type,N.format,N._useSRGBBuffer):this._getInternalFormat(v,N._useSRGBBuffer);this._unpackFlipY(N.invertY);let E=F.TEXTURE_2D;N.isCube&&(E=F.TEXTURE_CUBE_MAP_POSITIVE_X+R);const t=Math.round(Math.log(N.width)*Math.LOG2E),x=Math.round(Math.log(N.height)*Math.LOG2E),e=B?N.width:Math.pow(2,Math.max(t-z,0)),b=B?N.height:Math.pow(2,Math.max(x-z,0));F.texImage2D(E,z,y,e,b,0,A,S,q)}updateTextureData(N,q,R,z,v,B){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const y=this._gl,E=this._getWebGLTextureType(N.type),t=this._getInternalFormat(N.format);this._unpackFlipY(N.invertY);let x=y.TEXTURE_2D,e=y.TEXTURE_2D;N.isCube&&(e=y.TEXTURE_CUBE_MAP_POSITIVE_X+F,x=y.TEXTURE_CUBE_MAP),this._bindTextureDirectly(x,N,!0),y.texSubImage2D(e,S,R,z,v,B,t,E,q),A&&this._gl.generateMipmap(e),this._bindTextureDirectly(x,null)}_uploadArrayBufferViewToTexture(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const v=this._gl,B=N.isCube?v.TEXTURE_CUBE_MAP:v.TEXTURE_2D;this._bindTextureDirectly(B,N,!0),this._uploadDataToTextureDirectly(N,q,R,z),this._bindTextureDirectly(B,null,!0)}_prepareWebGLTextureContinuation(N,q,R,z,v){const B=this._gl;if(!B)return;const F=this._getSamplingParameters(v,!R);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,F.mag),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,F.min),R||z||B.generateMipmap(B.TEXTURE_2D),this._bindTextureDirectly(B.TEXTURE_2D,null),q&&q.removePendingData(N),N.onLoadedObservable.notifyObservers(N),N.onLoadedObservable.clear()}_prepareWebGLTexture(N,q,R,z,v,B,F,S,A,y){const E=this.getCaps().maxTextureSize,x=Math.min(E,this.needPOTTextures?(0,t.f)(z.width,E):z.width),e=Math.min(E,this.needPOTTextures?(0,t.f)(z.height,E):z.height),b=this._gl;b&&(N._hardwareTexture?(this._bindTextureDirectly(b.TEXTURE_2D,N,!0),this._unpackFlipY(void 0===v||!!v),N.baseWidth=z.width,N.baseHeight=z.height,N.width=x,N.height=e,N.isReady=!0,N.type=-1!==N.type?N.type:0,N.format=-1!==N.format?N.format:y??(".jpg"!==q||N._useSRGBBuffer?5:4),S(x,e,z,q,N,(()=>{this._prepareWebGLTextureContinuation(N,R,B,F,A)}))||this._prepareWebGLTextureContinuation(N,R,B,F,A)):R&&R.removePendingData(N))}_getInternalFormatFromDepthTextureFormat(N,q,R){const z=this._gl;if(!q)return z.STENCIL_INDEX8;let v=R?z.DEPTH_STENCIL:z.DEPTH_COMPONENT;return this.webGLVersion>1?15===N?v=z.DEPTH_COMPONENT16:16===N?v=z.DEPTH_COMPONENT24:17===N||13===N?v=R?z.DEPTH24_STENCIL8:z.DEPTH_COMPONENT24:14===N?v=z.DEPTH_COMPONENT32F:18===N&&(v=R?z.DEPTH32F_STENCIL8:z.DEPTH_COMPONENT32F):v=z.DEPTH_COMPONENT16,v}_setupFramebufferDepthAttachments(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,B=arguments.length>5?arguments[5]:void 0;const F=this._gl;B=B??(N?13:14);const S=this._getInternalFormatFromDepthTextureFormat(B,q,N);return N&&q?this._createRenderBuffer(R,z,v,F.DEPTH_STENCIL,S,F.DEPTH_STENCIL_ATTACHMENT):q?this._createRenderBuffer(R,z,v,S,S,F.DEPTH_ATTACHMENT):N?this._createRenderBuffer(R,z,v,S,S,F.STENCIL_ATTACHMENT):null}_createRenderBuffer(N,q,R,z,v,B){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const S=this._gl.createRenderbuffer();return this._updateRenderBuffer(S,N,q,R,z,v,B,F)}_updateRenderBuffer(N,q,R,z,v,B,F){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const A=this._gl;return A.bindRenderbuffer(A.RENDERBUFFER,N),z>1&&A.renderbufferStorageMultisample?A.renderbufferStorageMultisample(A.RENDERBUFFER,z,B,q,R):A.renderbufferStorage(A.RENDERBUFFER,v,q,R),A.framebufferRenderbuffer(A.FRAMEBUFFER,F,A.RENDERBUFFER,N),S&&A.bindRenderbuffer(A.RENDERBUFFER,null),N}_releaseTexture(N){this._deleteTexture(N._hardwareTexture),this.unbindAllTextures();const q=this._internalTexturesCache.indexOf(N);-1!==q&&this._internalTexturesCache.splice(q,1),N._lodTextureHigh&&N._lodTextureHigh.dispose(),N._lodTextureMid&&N._lodTextureMid.dispose(),N._lodTextureLow&&N._lodTextureLow.dispose(),N._irradianceTexture&&N._irradianceTexture.dispose()}_deleteTexture(N){null===N||void 0===N||N.release()}_setProgram(N){this._currentProgram!==N&&((0,z.i)(N,this._gl),this._currentProgram=N)}bindSamplers(N){const q=N.getPipelineContext();this._setProgram(q.program);const R=N.getSamplers();for(let z=0;z<R.length;z++){const q=N.getUniform(R[z]);q&&(this._boundUniforms[z]=q)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=!1;const F=q&&q._associatedChannel>-1;R&&F&&(this._activeChannel=q._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==q||z){if(this._activateCurrentTexture(),q&&q.isMultiview)throw B.c.Error(["_bindTextureDirectly called with a multiview texture!",N,q]),"_bindTextureDirectly called with a multiview texture!";var S;this._gl.bindTexture(N,(null===q||void 0===q||null===(S=q._hardwareTexture)||void 0===S?void 0:S.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=q,q&&(q._associatedChannel=this._activeChannel)}else R&&(v=!0,this._activateCurrentTexture());return F&&!R&&this._bindSamplerUniformToChannel(q._associatedChannel,this._activeChannel),v}_bindTexture(N,q,R){if(void 0===N)return;q&&(q._associatedChannel=N),this._activeChannel=N;const z=q?this._getTextureTarget(q):this._gl.TEXTURE_2D;this._bindTextureDirectly(z,q)}unbindAllTextures(){for(let N=0;N<this._maxSimultaneousTextures;N++)this._activeChannel=N,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(N,q,R,z){void 0!==N&&(q&&(this._boundUniforms[N]=q),this._setTexture(N,R))}_bindSamplerUniformToChannel(N,q){const R=this._boundUniforms[N];R&&R._currentState!==q&&(this._gl.uniform1i(R,q),R._currentState=q)}_getTextureWrapMode(N){switch(N){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(N,q){let R,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!q)return null!=this._boundTexturesCache[N]&&(this._activeChannel=N,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(q.video){this._activeChannel=N;const R=q.getInternalTexture();R&&(R._associatedChannel=N),q.update()}else if(4===q.delayLoadState)return q.delayLoad(),!1;R=v?q.depthStencilTexture:q.isReady()?q.getInternalTexture():q.isCube?this.emptyCubeTexture:q.is3D?this.emptyTexture3D:q.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!z&&R&&(R._associatedChannel=N);let B=!0;this._boundTexturesCache[N]===R&&(z||this._bindSamplerUniformToChannel(R._associatedChannel,N),B=!1),this._activeChannel=N;const F=this._getTextureTarget(R);if(B&&this._bindTextureDirectly(F,R,z),R&&!R.isMultiview){if(R.isCube&&R._cachedCoordinatesMode!==q.coordinatesMode){R._cachedCoordinatesMode=q.coordinatesMode;const N=3!==q.coordinatesMode&&5!==q.coordinatesMode?1:0;q.wrapU=N,q.wrapV=N}R._cachedWrapU!==q.wrapU&&(R._cachedWrapU=q.wrapU,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(q.wrapU),R)),R._cachedWrapV!==q.wrapV&&(R._cachedWrapV=q.wrapV,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(q.wrapV),R)),R.is3D&&R._cachedWrapR!==q.wrapR&&(R._cachedWrapR=q.wrapR,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(q.wrapR),R)),this._setAnisotropicLevel(F,R,q.anisotropicFilteringLevel)}return!0}setTextureArray(N,q,R,z){if(void 0!==N&&q){this._textureUnits&&this._textureUnits.length===R.length||(this._textureUnits=new Int32Array(R.length));for(let q=0;q<R.length;q++){const z=R[q].getInternalTexture();z?(this._textureUnits[q]=N+q,z._associatedChannel=N+q):this._textureUnits[q]=-1}this._gl.uniform1iv(q,this._textureUnits);for(let N=0;N<R.length;N++)this._setTexture(this._textureUnits[N],R[N],!0)}}_setAnisotropicLevel(N,q,R){const z=this._caps.textureAnisotropicFilterExtension;11!==q.samplingMode&&3!==q.samplingMode&&2!==q.samplingMode&&(R=1),z&&q._cachedAnisotropicFilteringLevel!==R&&(this._setTextureParameterFloat(N,z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R,this._caps.maxAnisotropy),q),q._cachedAnisotropicFilteringLevel=R)}_setTextureParameterFloat(N,q,R,z){this._bindTextureDirectly(N,z,!0,!0),this._gl.texParameterf(N,q,R)}_setTextureParameterInteger(N,q,R,z){z&&this._bindTextureDirectly(N,z,!0,!0),this._gl.texParameteri(N,q,R)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let N=0;N<this._caps.maxVertexAttribs;N++)this.disableAttributeByIndex(N)}else for(let N=0,q=this._vertexAttribArraysEnabled.length;N<q;N++)N>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[N]||this.disableAttributeByIndex(N)}releaseEffects(){const N=Object.keys(this._compiledEffects);for(const q of N){this._compiledEffects[q].dispose()}this._compiledEffects={}}dispose(){var N;((0,F.l)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(N=this._gl.getExtension("WEBGL_lose_context"))||void 0===N||N.loseContext());(0,z.t)(this._gl)}attachContextLostEvent(N){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",N,!1)}attachContextRestoredEvent(N){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",N,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(N){const q=this._gl;for(;q.getError()!==q.NO_ERROR;);let R=!0;const z=q.createTexture();q.bindTexture(q.TEXTURE_2D,z),q.texImage2D(q.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(N),1,1,0,q.RGBA,this._getWebGLTextureType(N),null),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.NEAREST);const v=q.createFramebuffer();q.bindFramebuffer(q.FRAMEBUFFER,v),q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,z,0);const B=q.checkFramebufferStatus(q.FRAMEBUFFER);if(R=R&&B===q.FRAMEBUFFER_COMPLETE,R=R&&q.getError()===q.NO_ERROR,R&&(q.clear(q.COLOR_BUFFER_BIT),R=R&&q.getError()===q.NO_ERROR),R){q.bindFramebuffer(q.FRAMEBUFFER,null);const N=q.RGBA,z=q.UNSIGNED_BYTE,v=new Uint8Array(4);q.readPixels(0,0,1,1,N,z,v),R=R&&q.getError()===q.NO_ERROR}for(q.deleteTexture(z),q.deleteFramebuffer(v),q.bindFramebuffer(q.FRAMEBUFFER,null);!R&&q.getError()!==q.NO_ERROR;);return R}_getWebGLTextureType(N){if(1===this._webGLVersion){switch(N){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(N){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=q?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(N){case 0:R=this._gl.ALPHA;break;case 1:R=this._gl.LUMINANCE;break;case 2:R=this._gl.LUMINANCE_ALPHA;break;case 6:R=this._gl.RED;break;case 7:R=this._gl.RG;break;case 4:R=q?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:R=q?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(N){case 8:R=this._gl.RED_INTEGER;break;case 9:R=this._gl.RG_INTEGER;break;case 10:R=this._gl.RGB_INTEGER;break;case 11:R=this._gl.RGBA_INTEGER}return R}_getRGBABufferInternalSizedFormat(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==q)switch(q){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return R?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(N){case 3:switch(q){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(q){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return R?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return R?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(q){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(q){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(q){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(q){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(q){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(q){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(q){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return R?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(N,q,R,z){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const F=v?4:3,S=v?this._gl.RGBA:this._gl.RGB,A=new Uint8Array(z*R*F);return B&&this.flushFramebuffer(),this._gl.readPixels(N,q,R,z,S,this._gl.UNSIGNED_BYTE,A),Promise.resolve(A)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const N=x.d._CreateCanvas(1,1),q=N.getContext("webgl")||N.getContext("experimental-webgl");this._IsSupported=null!=q&&!!window.WebGLRenderingContext}catch(N){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const N=x.d._CreateCanvas(1,1),q=N.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||N.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!q}catch(N){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}Y._TempClearColorUint32=new Uint32Array(4),Y._TempClearColorInt32=new Int32Array(4),Y.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],Y._ConcatenateShader=D.f,Y._IsSupported=null,Y._HasMajorPerformanceCaveat=null},11296:(N,q,R)=>{"use strict";var z;R.d(q,{e:()=>v}),function(N){N[N.PointerMove=0]="PointerMove",N[N.PointerDown=1]="PointerDown",N[N.PointerUp=2]="PointerUp"}(z||(z={}));class v{}v.DOM_DELTA_PIXEL=0,v.DOM_DELTA_LINE=1,v.DOM_DELTA_PAGE=2},11289:(N,q,R)=>{"use strict";R.d(q,{c:()=>z,f:()=>B,h:()=>v});class z{}z.KEYDOWN=1,z.KEYUP=2;class v{constructor(N,q){this.type=N,this.event=q}}class B extends v{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(N){this.skipOnKeyboardObservable=N}constructor(N,q){super(N,q),this.type=N,this.event=q,this.skipOnKeyboardObservable=!1}}},11286:(N,q,R)=>{"use strict";R.d(q,{e:()=>v,f:()=>F,g:()=>S});var z=R(11181);class v{}v.POINTERDOWN=1,v.POINTERUP=2,v.POINTERMOVE=4,v.POINTERWHEEL=8,v.POINTERPICK=16,v.POINTERTAP=32,v.POINTERDOUBLETAP=64;class B{constructor(N,q){this.type=N,this.event=q}}class F extends B{constructor(N,q,R,v){super(N,q),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new z.l(R,v)}}class S extends B{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(N,q),this._pickInfo=R,this._inputManager=z}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10884:(N,q,R)=>{"use strict";R.r(q),R.d(q,{SceneInstrumentation:()=>B});var z=R(10888),v=R(11019);class B{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(N){N!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=N,N?(this._onBeforeActiveMeshesEvaluationObserver=this.Xd.onBeforeActiveMeshesEvaluationObservable.add((()=>{z.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Xd.onAfterActiveMeshesEvaluationObservable.add((()=>{z.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Xd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Xd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(N){N!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=N,N?(this._onBeforeRenderTargetsRenderObserver=this.Xd.onBeforeRenderTargetsRenderObservable.add((()=>{z.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Xd.onAfterRenderTargetsRenderObservable.add((()=>{z.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Xd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Xd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(N){N!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=N,N?(this._onBeforeParticlesRenderingObserver=this.Xd.onBeforeParticlesRenderingObservable.add((()=>{z.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Xd.onAfterParticlesRenderingObservable.add((()=>{z.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Xd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Xd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(N){N!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=N,this.Xd.spriteManagers&&(N?(this._onBeforeSpritesRenderingObserver=this.Xd.onBeforeSpritesRenderingObservable.add((()=>{z.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Xd.onAfterSpritesRenderingObservable.add((()=>{z.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Xd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Xd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(N){N!==this._capturePhysicsTime&&this.Xd.onBeforePhysicsObservable&&(this._capturePhysicsTime=N,N?(this._onBeforePhysicsObserver=this.Xd.onBeforePhysicsObservable.add((()=>{z.f.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Xd.onAfterPhysicsObservable.add((()=>{z.f.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.Xd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Xd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(N){N!==this._captureAnimationsTime&&(this._captureAnimationsTime=N,N?this._onAfterAnimationsObserver=this.Xd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Xd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(N){this._captureFrameTime=N}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(N){this._captureInterFrameTime=N}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(N){N!==this._captureRenderTime&&(this._captureRenderTime=N,N?(this._onBeforeDrawPhaseObserver=this.Xd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),z.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Xd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),z.f.EndPerformanceCounter("Main render")}))):(this.Xd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Xd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(N){N!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=N,N?(this._onBeforeCameraRenderObserver=this.Xd.onBeforeCameraRenderObservable.add((N=>{this._cameraRenderTime.beginMonitoring(),z.f.StartPerformanceCounter(`Rendering camera ${N.name}`)})),this._onAfterCameraRenderObserver=this.Xd.onAfterCameraRenderObservable.add((N=>{this._cameraRenderTime.endMonitoring(!1),z.f.EndPerformanceCounter(`Rendering camera ${N.name}`)}))):(this.Xd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Xd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Xd.getEngine()._drawCalls}constructor(N){this.Xd=N,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new v.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new v.c,this._captureFrameTime=!1,this._frameTime=new v.c,this._captureRenderTime=!1,this._renderTime=new v.c,this._captureInterFrameTime=!1,this._interFrameTime=new v.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new v.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new v.c,this._capturePhysicsTime=!1,this._physicsTime=new v.c,this._captureAnimationsTime=!1,this._animationsTime=new v.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new v.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=N.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(z.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Xd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=N.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(z.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fj(),this._captureParticlesRenderTime&&this._particlesRenderTime.fj(),this._captureSpritesRenderTime&&this._spritesRenderTime.fj(),this._captureRenderTime&&this._renderTime.fj(),this._captureCameraRenderTime&&this._cameraRenderTime.fj()}))}dispose(){this.Xd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Xd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Xd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Xd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Xd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Xd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Xd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Xd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Xd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Xd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Xd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Xd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Xd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Xd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Xd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Xd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Xd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Xd=null}}},12177:(N,q,R)=>{"use strict";R.d(q,{e:()=>E});var z=R(11147),v=R(11151),B=R(11181),F=R(11454),S=R(12127),A=R(12183),y=R(11002);F.c.AddNodeConstructor("Light_Type_1",((N,q)=>()=>new E(N,B.m.Zero(),q)));class E extends A.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(N){this._shadowFrustumSize=N,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(N){this._shadowOrthoScale=N,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(N){this._orthoLeft=N}get orthoRight(){return this._orthoRight}set orthoRight(N){this._orthoRight=N}get orthoTop(){return this._orthoTop}set orthoTop(N){this._orthoTop=N}get orthoBottom(){return this._orthoBottom}set orthoBottom(N){this._orthoBottom=N}constructor(N,q,R){super(N,R),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=q.scale(-1),this.direction=q}getClassName(){return"kb"}getTypeID(){return S.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(N,q,R){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(N):this._setDefaultAutoExtendShadowProjectionMatrix(N,q,R)}_setDefaultFixedFrustumShadowProjectionMatrix(N){const q=this.va().activeCamera;q&&B.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:q.Wi,void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,N,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(N,q,R){const z=this.va().activeCamera;if(!z)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const N=B.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let z=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let F=0;F<R.length;F++){const S=R[F];if(!S)continue;const A=S.getBoundingInfo().boundingBox;for(let R=0;R<A.vectorsWorld.length;R++)B.m.TransformCoordinatesToRef(A.vectorsWorld[R],q,N),N.x<this._orthoLeft&&(this._orthoLeft=N.x),N.y<this._orthoBottom&&(this._orthoBottom=N.y),N.x>this._orthoRight&&(this._orthoRight=N.x),N.y>this._orthoTop&&(this._orthoTop=N.y),this.autoCalcShadowZBounds&&(N.z<z&&(z=N.z),N.z>v&&(v=N.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=z,this._shadowMaxZ=v)}const v=this._orthoRight-this._orthoLeft,F=this._orthoTop-this._orthoBottom,S=void 0!==this.shadowMinZ?this.shadowMinZ:z.Wi,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,y=this.va().getEngine().useReverseDepthBuffer;B.d.OrthoOffCenterLHToRef(this._orthoLeft-v*this.shadowOrthoScale,this._orthoRight+v*this.shadowOrthoScale,this._orthoBottom-F*this.shadowOrthoScale,this._orthoTop+F*this.shadowOrthoScale,y?A:S,y?S:A,N,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,q){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,q),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,q),this)}transferToNodeMaterialEffect(N,q){return this.computeTransformedInformation()?(N.setFloat3(q,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(N.setFloat3(q,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(N){const q=this._scene.getEngine();return!q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}getDepthMaxZ(N){const q=this._scene.getEngine();return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}prepareLightSpecificDefines(N,q){N["DIRLIGHT"+q]=!0}}(0,z.c)([(0,v.D)()],E.prototype,"shadowFrustumSize",null),(0,z.c)([(0,v.D)()],E.prototype,"shadowOrthoScale",null),(0,z.c)([(0,v.D)()],E.prototype,"autoUpdateExtends",void 0),(0,z.c)([(0,v.D)()],E.prototype,"autoCalcShadowZBounds",void 0),(0,z.c)([(0,v.D)("orthoLeft")],E.prototype,"_orthoLeft",void 0),(0,z.c)([(0,v.D)("orthoRight")],E.prototype,"_orthoRight",void 0),(0,z.c)([(0,v.D)("orthoTop")],E.prototype,"_orthoTop",void 0),(0,z.c)([(0,v.D)("orthoBottom")],E.prototype,"_orthoBottom",void 0),(0,y.f)("BABYLON.DirectionalLight",E)},12536:(N,q,R)=>{"use strict";R.d(q,{b:()=>E});var z=R(11147),v=R(11151),B=R(11181),F=R(11213),S=R(11454),A=R(12127),y=R(11002);S.c.AddNodeConstructor("Light_Type_3",((N,q)=>()=>new E(N,B.m.Zero(),q)));class E extends A.e{constructor(N,q,R){super(N,R),this.groundColor=new F.c(0,0,0),this.direction=q||B.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(N){return this.direction=B.m.Normalize(N.gd(B.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(N,q){const R=B.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",R.x,R.y,R.z,0,q),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.$i),q),this}transferToNodeMaterialEffect(N,q){const R=B.m.Normalize(this.direction);return N.setFloat3(q,R.x,R.y,R.z),this}Oj(){return this._worldMatrix||(this._worldMatrix=B.d.Identity()),this._worldMatrix}getTypeID(){return A.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(N,q){N["HEMILIGHT"+q]=!0}}(0,z.c)([(0,v.j)()],E.prototype,"groundColor",void 0),(0,z.c)([(0,v.C)()],E.prototype,"direction",void 0),(0,y.f)("BABYLON.HemisphericLight",E)},12127:(N,q,R)=>{"use strict";R.d(q,{e:()=>x});var z=R(11147),v=R(11151),B=R(11181),F=R(11213),S=R(11454),A=R(11238),y=R(11002),E=R(11318),t=R(11221);class x extends S.c{get range(){return this._range}set range(N){this._range=N,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(N){this._intensityMode=N,this._computePhotometricScale()}get radius(){return this._radius}set radius(N){this._radius=N,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(N){this._shadowEnabled!==N&&(this._shadowEnabled=N,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(N){this._includedOnlyMeshes=N,this._hookArrayForIncludedOnly(N)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(N){this._excludedMeshes=N,this._hookArrayForExcluded(N)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(N){this._excludeWithLayerMask=N,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(N){this._includeOnlyWithLayerMask=N,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(N){this._lightmapMode!==N&&(this._lightmapMode=N,this._markMeshesAsLightDirty())}getViewMatrix(N){return null}getProjectionMatrix(N,q){return null}constructor(N,q){super(N,q,!1),this.Ch=new F.c(1,1,1),this.Dh=new F.c(1,1,1),this.falloffType=x.FALLOFF_DEFAULT,this.$i=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=x.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new A.b(this.va().getEngine(),void 0,void 0,N),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(N,q){return this}_bindLight(N,q,R,z){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const B=N.toString();let S=!1;if(this._uniformBuffer.bindToEffect(R,"Light"+B),this._renderId!==q.getRenderId()||this._lastUseSpecular!==z||!this._uniformBuffer.useUbo){this._renderId=q.getRenderId(),this._lastUseSpecular=z;const N=this.getScaledIntensity();this.transferToEffect(R,B),this.Ch.scaleToRef(N,F.h.hb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",F.h.hb[0],this.range,B),z&&(this.Dh.scaleToRef(N,F.h.hb[1]),this._uniformBuffer.updateColor4("vLightSpecular",F.h.hb[1],this.radius,B)),S=!0}if(this.transferTexturesToEffect(R,B),q.shadowsEnabled&&this.shadowEnabled&&v){const N=this.getShadowGenerator(q.activeCamera)??this.getShadowGenerator();N&&(N.bindShadowLight(B,R),S=!0)}S?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(N){let q="Name: "+this.name;if(q+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let R=0;R<this.animations.length;R++)q+=", animation[0]: "+this.animations[R].toString(N);return q}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Vb(N){super.Vb(N),this._resyncMeshes()}getShadowGenerator(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(N)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return B.m.Zero()}canAffectMesh(N){return!N||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(N))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(N))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&N.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&N.layerMask)))}dispose(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const N=this._shadowGenerators.values();for(let q=N.next();!0!==q.done;q=N.next()){q.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const N=this._parentContainer.lights.indexOf(this);N>-1&&this._parentContainer.lights.splice(N,1),this._parentContainer=null}for(const R of this.va().meshes)R._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(N,q)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.$i}clone(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=x.GetConstructorFromName(this.getTypeID(),N,this.va());if(!R)return null;const z=t.e.Clone(R,this);return N&&(z.name=N),q&&(z.parent=q),z.Vb(this.isEnabled()),this.onClonedObservable.notifyObservers(z),z}serialize(){const N=t.e.Serialize(this);return N.uniqueId=this.uniqueId,N.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(N),this.excludedMeshes.length>0&&(N.excludedMeshesIds=[],this.excludedMeshes.forEach((q=>{N.excludedMeshesIds.push(q.id)}))),this.includedOnlyMeshes.length>0&&(N.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((q=>{N.includedOnlyMeshesIds.push(q.id)}))),t.e.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N.isEnabled=this.isEnabled(),N}static GetConstructorFromName(N,q,R){const z=S.c.Construct("Light_Type_"+N,q,R);return z||null}static Parse(N,q){const R=x.GetConstructorFromName(N.type,N.name,q);if(!R)return null;const z=t.e.Parse(R,N,q);if(N.excludedMeshesIds&&(z._excludedMeshesIds=N.excludedMeshesIds),N.includedOnlyMeshesIds&&(z._includedOnlyMeshesIds=N.includedOnlyMeshesIds),void 0!==N.parentId&&(z._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(z._waitingParentInstanceIndex=N.parentInstanceIndex),void 0!==N.falloffType&&(z.falloffType=N.falloffType),void 0!==N.lightmapMode&&(z.lightmapMode=N.lightmapMode),N.animations){for(let q=0;q<N.animations.length;q++){const R=N.animations[q],v=(0,y.c)("BABYLON.Animation");v&&z.animations.push(v.Parse(R))}S.c.ParseAnimationRanges(z,N,q)}return N.autoAnimate&&q.beginAnimation(z,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),void 0!==N.isEnabled&&z.Vb(N.isEnabled),z}_hookArrayForExcluded(N){var q=this;const R=N.push;N.push=function(){for(var z=arguments.length,v=new Array(z),B=0;B<z;B++)v[B]=arguments[B];const F=R.apply(N,v);for(const N of v)N._resyncLightSource(q);return F};const z=N.splice;N.splice=(q,R)=>{const v=z.apply(N,[q,R]);for(const N of v)N._resyncLightSource(this);return v};for(const v of N)v._resyncLightSource(this)}_hookArrayForIncludedOnly(N){var q=this;const R=N.push;N.push=function(){for(var z=arguments.length,v=new Array(z),B=0;B<z;B++)v[B]=arguments[B];const F=R.apply(N,v);return q._resyncMeshes(),F};const z=N.splice;N.splice=(q,R)=>{const v=z.apply(N,[q,R]);return this._resyncMeshes(),v},this._resyncMeshes()}_resyncMeshes(){for(const N of this.va().meshes)N._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const N of this.va().meshes)-1!==N.lightSources.indexOf(this)&&N._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let N=0;const q=this.getTypeID();let R=this.intensityMode;switch(R===x.INTENSITYMODE_AUTOMATIC&&(R=q===x.LIGHTTYPEID_DIRECTIONALLIGHT?x.INTENSITYMODE_ILLUMINANCE:x.INTENSITYMODE_LUMINOUSINTENSITY),q){case x.LIGHTTYPEID_POINTLIGHT:case x.LIGHTTYPEID_SPOTLIGHT:switch(R){case x.INTENSITYMODE_LUMINOUSPOWER:N=1/(4*Math.PI);break;case x.INTENSITYMODE_LUMINOUSINTENSITY:N=1;break;case x.INTENSITYMODE_LUMINANCE:N=this.radius*this.radius}break;case x.LIGHTTYPEID_DIRECTIONALLIGHT:switch(R){case x.INTENSITYMODE_ILLUMINANCE:N=1;break;case x.INTENSITYMODE_LUMINANCE:{let q=this.radius;q=Math.max(q,.001);N=2*Math.PI*(1-Math.cos(q));break}}break;case x.LIGHTTYPEID_HEMISPHERICLIGHT:N=1}return N}_reorderLightsInScene(){const N=this.va();0!=this._renderPriority&&(N.requireLightSorting=!0),this.va().sortLightsByPriority()}}x.FALLOFF_DEFAULT=E.d.FALLOFF_DEFAULT,x.FALLOFF_PHYSICAL=E.d.FALLOFF_PHYSICAL,x.FALLOFF_GLTF=E.d.FALLOFF_GLTF,x.FALLOFF_STANDARD=E.d.FALLOFF_STANDARD,x.LIGHTMAP_DEFAULT=E.d.LIGHTMAP_DEFAULT,x.LIGHTMAP_SPECULAR=E.d.LIGHTMAP_SPECULAR,x.LIGHTMAP_SHADOWSONLY=E.d.LIGHTMAP_SHADOWSONLY,x.INTENSITYMODE_AUTOMATIC=E.d.INTENSITYMODE_AUTOMATIC,x.INTENSITYMODE_LUMINOUSPOWER=E.d.INTENSITYMODE_LUMINOUSPOWER,x.INTENSITYMODE_LUMINOUSINTENSITY=E.d.INTENSITYMODE_LUMINOUSINTENSITY,x.INTENSITYMODE_ILLUMINANCE=E.d.INTENSITYMODE_ILLUMINANCE,x.INTENSITYMODE_LUMINANCE=E.d.INTENSITYMODE_LUMINANCE,x.LIGHTTYPEID_POINTLIGHT=E.d.LIGHTTYPEID_POINTLIGHT,x.LIGHTTYPEID_DIRECTIONALLIGHT=E.d.LIGHTTYPEID_DIRECTIONALLIGHT,x.LIGHTTYPEID_SPOTLIGHT=E.d.LIGHTTYPEID_SPOTLIGHT,x.LIGHTTYPEID_HEMISPHERICLIGHT=E.d.LIGHTTYPEID_HEMISPHERICLIGHT,(0,z.c)([(0,v.j)()],x.prototype,"diffuse",void 0),(0,z.c)([(0,v.j)()],x.prototype,"specular",void 0),(0,z.c)([(0,v.D)()],x.prototype,"falloffType",void 0),(0,z.c)([(0,v.D)()],x.prototype,"intensity",void 0),(0,z.c)([(0,v.D)()],x.prototype,"range",null),(0,z.c)([(0,v.D)()],x.prototype,"intensityMode",null),(0,z.c)([(0,v.D)()],x.prototype,"radius",null),(0,z.c)([(0,v.D)()],x.prototype,"_renderPriority",void 0),(0,z.c)([(0,v.e)("_reorderLightsInScene")],x.prototype,"renderPriority",void 0),(0,z.c)([(0,v.D)("shadowEnabled")],x.prototype,"_shadowEnabled",void 0),(0,z.c)([(0,v.D)("excludeWithLayerMask")],x.prototype,"_excludeWithLayerMask",void 0),(0,z.c)([(0,v.D)("includeOnlyWithLayerMask")],x.prototype,"_includeOnlyWithLayerMask",void 0),(0,z.c)([(0,v.D)("lightmapMode")],x.prototype,"_lightmapMode",void 0)},11318:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{static CompareLightsPriority(N,q){return N.shadowEnabled!==q.shadowEnabled?(q.shadowEnabled?1:0)-(N.shadowEnabled?1:0):q.renderPriority-N.renderPriority}}z.FALLOFF_DEFAULT=0,z.FALLOFF_PHYSICAL=1,z.FALLOFF_GLTF=2,z.FALLOFF_STANDARD=3,z.LIGHTMAP_DEFAULT=0,z.LIGHTMAP_SPECULAR=1,z.LIGHTMAP_SHADOWSONLY=2,z.INTENSITYMODE_AUTOMATIC=0,z.INTENSITYMODE_LUMINOUSPOWER=1,z.INTENSITYMODE_LUMINOUSINTENSITY=2,z.INTENSITYMODE_ILLUMINANCE=3,z.INTENSITYMODE_LUMINANCE=4,z.LIGHTTYPEID_POINTLIGHT=0,z.LIGHTTYPEID_DIRECTIONALLIGHT=1,z.LIGHTTYPEID_SPOTLIGHT=2,z.LIGHTTYPEID_HEMISPHERICLIGHT=3},12183:(N,q,R)=>{"use strict";R.d(q,{d:()=>A});var z=R(11147),v=R(11151),B=R(11181),F=R(12127),S=R(11495);class A extends F.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=B.d.Identity(),this._projectionMatrix=B.d.Identity()}_setPosition(N){this._position=N}get position(){return this._position}set position(N){this._setPosition(N)}_setDirection(N){this._direction=N}get direction(){return this._direction}set direction(N){this._setDirection(N)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(N){this._shadowMinZ=N,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(N){this._shadowMaxZ=N,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=B.m.Zero()),B.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=B.m.Zero()),B.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(N){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(N){return this.direction=B.m.Normalize(N.gd(this.position)),this.direction}getRotation(){this.direction.normalize();const N=B.m.Cross(this.direction,S.b.Y),q=B.m.Cross(N,this.direction);return B.m.RotationFromAxis(N,q,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=B.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Oj(N){return!N&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=B.d.Identity()),B.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(N){return void 0!==this.shadowMinZ?this.shadowMinZ:N.Wi}getDepthMaxZ(N){return void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ}setShadowProjectionMatrix(N,q,R){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(q,R,N):this._setDefaultShadowProjectionMatrix(N,q,R),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(N){const q=B.k.o[0];let R=this.position;this.computeTransformedInformation()&&(R=this.transformedPosition),B.m.NormalizeToRef(this.getShadowDirection(N),q),1===Math.abs(B.m.Dot(q,B.m.Up()))&&(q.z=1e-13);const z=B.k.o[1];return R.addToRef(q,z),B.d.LookAtLHToRef(R,z,B.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(N,q){return this.setShadowProjectionMatrix(this._projectionMatrix,N??this._viewMatrix,q??[]),this._projectionMatrix}}(0,z.c)([(0,v.C)()],A.prototype,"position",null),(0,z.c)([(0,v.C)()],A.prototype,"direction",null),(0,z.c)([(0,v.D)()],A.prototype,"shadowMinZ",null),(0,z.c)([(0,v.D)()],A.prototype,"shadowMaxZ",null)},11819:(N,q,R)=>{"use strict";R.d(q,{e:()=>F,g:()=>B,j:()=>S});const z={},v={};function B(N,q){z[N]=q}function F(N,q){v[N]=q}function S(N){return v[N]?v[N]:null}},11561:(N,q,R)=>{"use strict";R.d(q,{e:()=>J,f:()=>X});var z,v=R(10888),B=R(10893),F=R(11172),S=R(10933),A=R(10907),y=R(11477),E=R(10938),t=R(10942),x=R(11007),e=R(10957);!function(N){N[N.Clean=0]="Clean",N[N.Stop=1]="Stop",N[N.Sync=2]="Sync",N[N.NoSync=3]="NoSync"}(z||(z={}));const b=new B.d,f={};let D=!1;function V(){return f[".babylon"]}function H(N){const q=f[N];return q||(A.c.Warn("Unable to find a plugin to load "+N+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),V())}function Y(N,q,R){let z="Unable to load from "+(N.rawData?"binary data":N.url);return q?z+=`: ${q}`:R&&(z+=`: ${R}`),z}function T(N,q,R,z,v,B,F,S,A){var y;const t="data:"===(x=N.url).substring(0,5)?x.substring(5):null;var x;if(N.rawData&&!F)throw"When using ArrayBufferView to load data the file extension must be provided.";const D=F?H(F):t?function(N){for(const q in f){const R=f[q].plugin;if(R.canDirectLoad&&R.canDirectLoad(N))return f[q]}return V()}(N.url):function(N){const q=N.indexOf("?");-1!==q&&(N=N.substring(0,q));const R=N.lastIndexOf(".");return H(N.substring(R,N.length).toLowerCase())}(N.url);if(!D)throw new Error(`No plugin or fallback for ${F??N.url}`);if(!1===(null===A||void 0===A||null===(y=A[D.plugin.name])||void 0===y?void 0:y.enabled))throw new Error(`The '${D.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(N.rawData&&!D.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(N=>{if(D.plugin.createPlugin){const q=D.plugin.createPlugin(A??{});return q instanceof Promise?(q.then(N).catch((N=>{v("Error instantiating plugin.",N)})),null):(N(q),q)}return N(D.plugin),D.plugin})((A=>{var y;if(!A)throw`The loader plugin corresponding to the '${F}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(b.notifyObservers(A),t&&(A.canDirectLoad&&A.canDirectLoad(N.url)||!(0,E.i)(N.url))){if(A.directLoad){const N=A.directLoad(q,t);N instanceof Promise?N.then((N=>{R(A,N)})).catch((N=>{v("Error in directLoad of _loadData: "+N,N)})):R(A,N)}else R(A,t);return}const x=D.isBinary,f=(N,z)=>{q.u?v("Scene has been disposed"):R(A,N,z)};let V=null,H=!1;null===(y=A.jj)||void 0===y||y.add((()=>{H=!0,V&&(V.abort(),V=null),B()}));const Y=()=>{if(H)return;const R=(N,q)=>{v(null===N||void 0===N?void 0:N.statusText,q)};if(!A.loadFile&&N.rawData)throw"Plugin does not support loading ArrayBufferView.";V=A.loadFile?A.loadFile(q,N.rawData||N.file||N.url,N.rootUrl,f,z,x,R,S):q._loadFile(N.file||N.url,f,z,!0,x,R)},T=q.getEngine();let L=T.enableOfflineSupport;if(L){let R=!1;for(const z of q.disableOfflineSupportExceptionRules)if(z.test(N.url)){R=!0;break}L=!R}L&&e.d.OfflineProviderFactory?q.offlineProvider=e.d.OfflineProviderFactory(N.url,Y,T.disableManifestCheck):Y()}))}function L(N,q){let R,z,B=null,F=null;if(q)if(q.name)R=`file:${q.name}`,z=q.name,B=q;else if(ArrayBuffer.isView(q))R="",z=(0,x.e)(),F=q;else if(q.startsWith("data:"))R=q,z="";else if(N){const B=q;if("/"===B.substring(0,1))return v.f.Error("Wrong sceneFilename parameter"),null;R=N+B,z=B}else R=q,z=v.f.GetFilename(q),N=v.f.GetFolderPath(q);else R=N,z=v.f.GetFilename(N),N=v.f.GetFolderPath(N);return{url:R,rootUrl:N,name:z,file:B,rawData:F}}function X(N){if("string"===typeof N.extensions){const q=N.extensions;f[q.toLowerCase()]={plugin:N,isBinary:!1}}else{const q=N.extensions;Object.keys(q).forEach((R=>{f[R.toLowerCase()]={plugin:N,isBinary:q[R].isBinary}}))}}function Q(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.b.LastCreatedScene,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!z)return A.c.Error("No scene available to import mesh to"),null;const e=L(q,R);if(!e)return null;const b={};z.addPendingData(b);const f=()=>{z.removePendingData(b)},D=(N,q)=>{const R=Y(e,N,q);F?F(z,R,new t.i(R,t.e.SceneLoaderError,q)):A.c.Error(R),f()},V=B?N=>{try{B(N)}catch(q){D("Error in onProgress callback: "+q,q)}}:void 0,H=(N,q,R,B,F,S,A,y)=>{if(z.importedMeshesFiles.push(e.url),v)try{v(N,q,R,B,F,S,A,y)}catch(E){D("Error in onSuccess callback: "+E,E)}z.removePendingData(b)};return T(e,z,((q,R,v)=>{if(q.rewriteRootURL&&(e.rootUrl=q.rewriteRootURL(e.rootUrl,v)),q.importMesh){const v=[],B=[],F=[];if(!q.importMesh(N,z,R,e.rootUrl,v,B,F,D))return;z.loadingPluginName=q.name,H(v,B,F,[],[],[],[],[])}else{q.importMeshAsync(N,z,R,e.rootUrl,V,e.name).then((N=>{z.loadingPluginName=q.name,H(N.meshes,N.qj,N.skeletons,N.animationGroups,N.transformNodes,N.geometries,N.lights,N.spriteManagers)})).catch((N=>{D(N.message,N)}))}}),V,D,f,y,E,x)}function h(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedEngine,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return R?w(N,q,new F.b(R),z,B,A,y,E,t):(v.f.Error("No engine available"),null)}function u(N,q,R,z,v,B,F){return new Promise(((S,A)=>{h(N,q,R,(N=>{S(N)}),z,((N,q,R)=>{A(R||new Error(q))}),v,B,F)}))}function w(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!R)return A.c.Error("No scene available to append to"),null;const e=L(N,q);if(!e)return null;const b={};R.addPendingData(b);const f=()=>{R.removePendingData(b)};y.c.ShowLoadingScreen&&!D&&(D=!0,R.getEngine().displayLoadingUI(),R.executeWhenReady((()=>{R.getEngine().hideLoadingUI(),D=!1})));const V=(N,q)=>{const z=Y(e,N,q);B?B(R,z,new t.i(z,t.e.SceneLoaderError,q)):A.c.Error(z),f()},H=v?N=>{try{v(N)}catch(q){V("Error in onProgress callback",q)}}:void 0,X=()=>{if(z)try{z(R)}catch(N){V("Error in onSuccess callback",N)}R.removePendingData(b)};return T(e,R,((N,q)=>{if(N.load){if(!N.load(R,q,e.rootUrl,V))return;R.loadingPluginName=N.name,X()}else{N.loadAsync(R,q,e.rootUrl,H,e.name).then((()=>{R.loadingPluginName=N.name,X()})).catch((N=>{V(N.message,N)}))}}),H,V,f,F,E,x)}function c(N,q,R,z,v,B,F){return new Promise(((S,A)=>{w(N,q,R,(N=>{S(N)}),z,((N,q,R)=>{A(R||new Error(q))}),v,B,F)}))}function n(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!R)return A.c.Error("No scene available to load asset container to"),null;const x=L(N,q);if(!x)return null;const e={};R.addPendingData(e);const b=()=>{R.removePendingData(e)},f=(N,q)=>{const z=Y(x,N,q);B?B(R,z,new t.i(z,t.e.SceneLoaderError,q)):A.c.Error(z),b()},D=v?N=>{try{v(N)}catch(q){f("Error in onProgress callback",q)}}:void 0,V=N=>{if(z)try{z(N)}catch(q){f("Error in onSuccess callback",q)}R.removePendingData(e)};return T(x,R,((N,q)=>{if(N.loadAssetContainer){const z=N.loadAssetContainer(R,q,x.rootUrl,f);if(!z)return;z.populateRootNodes(),R.loadingPluginName=N.name,V(z)}else if(N.loadAssetContainerAsync){N.loadAssetContainerAsync(R,q,x.rootUrl,D,x.name).then((q=>{q.populateRootNodes(),R.loadingPluginName=N.name,V(q)})).catch((N=>{f(N.message,N)}))}else f("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),D,f,b,F,y,E)}function G(N,q,R,z,v,B,F){return new Promise(((S,A)=>{n(N,q,R,(N=>{S(N)}),z,((N,q,R)=>{A(R||new Error(q))}),v,B,F)}))}function s(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.b.LastCreatedScene,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!R)return void A.c.Error("No scene available to load animations to");if(z){for(const N of R.animatables)N.reset();R.stopAllAnimations(),R.animationGroups.slice().forEach((N=>{N.dispose()}));R.getNodes().forEach((N=>{N.animations&&(N.animations=[])}))}else switch(v){case 0:R.animationGroups.slice().forEach((N=>{N.dispose()}));break;case 1:R.animationGroups.forEach((N=>{N.stop()}));break;case 2:R.animationGroups.forEach((N=>{N.reset(),N.restart()}));break;case 3:break;default:return void A.c.Error("Unknown animation group loading mode value '"+v+"'")}const b=R.animatables.length;n(N,q,R,(N=>{N.mergeAnimationsTo(R,R.animatables.slice(b),B),N.dispose(),R.onAnimationFileImportedObservable.notifyObservers(R),F&&F(R)}),y,E,t,x,e)}function Z(N,q,R,z,v,B,F,S,A,y){return new Promise(((E,t)=>{s(N,q,R,z,v,B,(N=>{E(N)}),F,((N,q,R)=>{t(R||new Error(q))}),S,A,y)}))}class J{static get ForceFullSceneLoadingForIncremental(){return y.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){y.c.ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return y.c.ShowLoadingScreen}static set ShowLoadingScreen(N){y.c.ShowLoadingScreen=N}static get loggingLevel(){return y.c.loggingLevel}static set loggingLevel(N){y.c.loggingLevel=N}static get CleanBoneMatrixWeights(){return y.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){y.c.CleanBoneMatrixWeights=N}static GetDefaultPlugin(){return V()}static GetPluginForExtension(N){var q;return null===(q=H(N))||void 0===q?void 0:q.plugin}static IsPluginForExtensionAvailable(N){return function(N){return!!f[N]}(N)}static RegisterPlugin(N){X(N)}static ImportMesh(N,q,R,z,v,B,F,S,A){return Q(N,q,R,z,v,B,F,S,A)}static ImportMeshAsync(N,q,R,z,v,B,F){return function(N,q,R,z,v,B,F,S){return new Promise(((A,y)=>{Q(N,q,R,z,((N,q,R,z,v,B,F,S)=>{A({meshes:N,qj:q,skeletons:R,animationGroups:z,transformNodes:v,geometries:B,lights:F,spriteManagers:S})}),v,((N,q,R)=>{y(R||new Error(q))}),B,F,S)}))}(N,q,R,z,v,B,F)}static Load(N,q,R,z,v,B,F,S){return h(N,q,R,z,v,B,F,S)}static LoadAsync(N,q,R,z,v,B){return u(N,q,R,z,v,B)}static Append(N,q,R,z,v,B,F,S){return w(N,q,R,z,v,B,F,S)}static AppendAsync(N,q,R,z,v,B){return c(N,q,R,z,v,B)}static LoadAssetContainer(N,q,R,z,v,B,F,S){return n(N,q,R,z,v,B,F,S)}static LoadAssetContainerAsync(N,q,R,z,v,B){return G(N,q,R,z,v,B)}static ImportAnimations(N,q,R,z,v,B,F,S,A,y,E){s(N,q,R,z,v,B,F,S,A,y,E)}static ImportAnimationsAsync(N,q,R,z,v,B,F,S,A,y,E){return Z(N,q,R,z,v,B,S,y,E)}}J.NO_LOGGING=0,J.MINIMAL_LOGGING=1,J.SUMMARY_LOGGING=2,J.DETAILED_LOGGING=3,J.OnPluginActivatedObservable=b},11477:(N,q,R)=>{"use strict";R.d(q,{c:()=>z});class z{static get ForceFullSceneLoadingForIncremental(){return z._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){z._ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return z._ShowLoadingScreen}static set ShowLoadingScreen(N){z._ShowLoadingScreen=N}static get loggingLevel(){return z._LoggingLevel}static set loggingLevel(N){z._LoggingLevel=N}static get CleanBoneMatrixWeights(){return z._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){z._CleanBoneMatrixWeights=N}}z._ForceFullSceneLoadingForIncremental=!1,z._ShowLoadingScreen=!0,z._CleanBoneMatrixWeights=!1,z._LoggingLevel=0},12102:(N,q,R)=>{"use strict";R.d(q,{b:()=>U});var z=R(11147),v=R(11151),B=R(10907),F=R(11167),S=R(12090),A=R(11172),y=R(11181),E=R(11251),t=R(11391),x=R(11436);class e extends t.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class b extends x.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRBRDF",90,new e,q),this._useEnergyConservation=b.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=b.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=b.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=b.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=b.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=b.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=b.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=b.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=N._dirtyCallbacks[16],this._enable(!0)}prepareDefines(N){N.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,N.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,N.SPHERICAL_HARMONICS=this._useSphericalHarmonics,N.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}b.DEFAULT_USE_ENERGY_CONSERVATION=!0,b.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,b.DEFAULT_USE_SPHERICAL_HARMONICS=!0,b.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useEnergyConservation",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useSphericalHarmonics",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var f=R(11326),D=R(11213),V=R(11206),H=R(11332),Y=R(11393),T=R(11402),L=R(11418),X=(R(12111),R(11421)),Q=R(11379);class h extends t.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class u extends x.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRClearCoat",100,new h,q),this._isEnabled=!1,this.isEnabled=!1,this.$i=1,this.roughness=0,this._indexOfRefraction=u._DefaultIndexOfRefraction,this.indexOfRefraction=u._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=D.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,q,R){if(!this._isEnabled)return!0;const z=this._material._disableBumpMap;if(N._areTexturesDirty&&q.texturesEnabled){if(this._texture&&L.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(R.getCaps().standardDerivatives&&this._bumpTexture&&L.d.ClearCoatBumpTextureEnabled&&!z&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&L.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,q){this._isEnabled?(N.CLEARCOAT=!0,N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,N.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,N._areTexturesDirty&&q.texturesEnabled&&(this._texture&&L.d.ClearCoatTextureEnabled?(0,Q.J)(this._texture,N,"CLEARCOAT_TEXTURE"):N.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&L.d.ClearCoatTextureEnabled?(0,Q.J)(this._textureRoughness,N,"CLEARCOAT_TEXTURE_ROUGHNESS"):N.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&L.d.ClearCoatBumpTextureEnabled?(0,Q.J)(this._bumpTexture,N,"CLEARCOAT_BUMP"):N.CLEARCOAT_BUMP=!1,N.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===u._DefaultIndexOfRefraction,this._isTintEnabled?(N.CLEARCOAT_TINT=!0,this._tintTexture&&L.d.ClearCoatTintTextureEnabled?((0,Q.J)(this._tintTexture,N,"CLEARCOAT_TINT_TEXTURE"),N.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):N.CLEARCOAT_TINT_TEXTURE=!1):(N.CLEARCOAT_TINT=!1,N.CLEARCOAT_TINT_TEXTURE=!1))):(N.CLEARCOAT=!1,N.CLEARCOAT_TEXTURE=!1,N.CLEARCOAT_TEXTURE_ROUGHNESS=!1,N.CLEARCOAT_BUMP=!1,N.CLEARCOAT_TINT=!1,N.CLEARCOAT_TINT_TEXTURE=!1,N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,N.CLEARCOAT_DEFAULTIOR=!1,N.CLEARCOAT_TEXTUREDIRECTUV=0,N.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,N.CLEARCOAT_BUMPDIRECTUV=0,N.CLEARCOAT_REMAP_F0=!1,N.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,N.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(N,q,R,z){if(!this._isEnabled)return;const v=z.materialDefines,B=this._material.isFrozen,F=this._material._disableBumpMap,S=this._material._invertNormalMapX,A=this._material._invertNormalMapY;if(!N.useUbo||!B||!N.isSync){var y,E,t,x;if((this._texture||this._textureRoughness)&&L.d.ClearCoatTextureEnabled)N.updateFloat4("vClearCoatInfos",(null===(y=this._texture)||void 0===y?void 0:y.coordinatesIndex)??0,(null===(E=this._texture)||void 0===E?void 0:E.level)??0,(null===(t=this._textureRoughness)||void 0===t?void 0:t.coordinatesIndex)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.level)??0),this._texture&&(0,Q.p)(this._texture,N,"clearCoat"),this._textureRoughness&&!v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,Q.p)(this._textureRoughness,N,"clearCoatRoughness");this._bumpTexture&&R.getCaps().standardDerivatives&&L.d.ClearCoatTextureEnabled&&!F&&(N.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,Q.p)(this._bumpTexture,N,"clearCoatBump"),q._mirroredCameraPosition?N.updateFloat2("vClearCoatTangentSpaceParams",S?1:-1,A?1:-1):N.updateFloat2("vClearCoatTangentSpaceParams",S?-1:1,A?-1:1)),this._tintTexture&&L.d.ClearCoatTintTextureEnabled&&(N.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,Q.p)(this._tintTexture,N,"clearCoatTint")),N.updateFloat2("vClearCoatParams",this.$i,this.roughness);const z=1-this._indexOfRefraction,B=1+this._indexOfRefraction,e=Math.pow(-z/B,2),b=1/this._indexOfRefraction;N.updateFloat4("vClearCoatRefractionParams",e,b,z,B),this._isTintEnabled&&(N.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),N.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}q.texturesEnabled&&(this._texture&&L.d.ClearCoatTextureEnabled&&N.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.d.ClearCoatTextureEnabled&&N.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&R.getCaps().standardDerivatives&&L.d.ClearCoatBumpTextureEnabled&&!F&&N.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&L.d.ClearCoatTintTextureEnabled&&N.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(N){return this._texture===N||(this._textureRoughness===N||(this._bumpTexture===N||this._tintTexture===N))}getActiveTextures(N){this._texture&&N.push(this._texture),this._textureRoughness&&N.push(this._textureRoughness),this._bumpTexture&&N.push(this._bumpTexture),this._tintTexture&&N.push(this._tintTexture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&N.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&N.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&N.push(this._tintTexture)}dispose(N){var q,R,z,v;N&&(null===(q=this._texture)||void 0===q||q.dispose(),null===(R=this._textureRoughness)||void 0===R||R.dispose(),null===(z=this._bumpTexture)||void 0===z||z.dispose(),null===(v=this._tintTexture)||void 0===v||v.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(N,q,R){return N.CLEARCOAT_BUMP&&q.addFallback(R++,"CLEARCOAT_BUMP"),N.CLEARCOAT_TINT&&q.addFallback(R++,"CLEARCOAT_TINT"),N.CLEARCOAT&&q.addFallback(R++,"CLEARCOAT"),R}getSamplers(N){N.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}u._DefaultIndexOfRefraction=1.5,(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isEnabled",void 0),(0,z.c)([(0,v.D)()],u.prototype,"intensity",void 0),(0,z.c)([(0,v.D)()],u.prototype,"roughness",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"indexOfRefraction",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"texture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMainTexture",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"textureRoughness",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"remapF0OnInterfaceChange",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"bumpTexture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isTintEnabled",void 0),(0,z.c)([(0,v.j)()],u.prototype,"tintColor",void 0),(0,z.c)([(0,v.D)()],u.prototype,"tintColorAtDistance",void 0),(0,z.c)([(0,v.D)()],u.prototype,"tintThickness",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"tintTexture",void 0);class w extends t.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class c extends x.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRIridescence",110,new w,q),this._isEnabled=!1,this.isEnabled=!1,this.$i=1,this.minimumThickness=c._DefaultMinimumThickness,this.maximumThickness=c._DefaultMaximumThickness,this.indexOfRefraction=c._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,q){if(!this._isEnabled)return!0;if(N._areTexturesDirty&&q.texturesEnabled){if(this._texture&&L.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&L.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,q){this._isEnabled?(N.IRIDESCENCE=!0,N._areTexturesDirty&&q.texturesEnabled&&(this._texture&&L.d.IridescenceTextureEnabled?(0,Q.J)(this._texture,N,"IRIDESCENCE_TEXTURE"):N.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&L.d.IridescenceTextureEnabled?(0,Q.J)(this._thicknessTexture,N,"IRIDESCENCE_THICKNESS_TEXTURE"):N.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(N.IRIDESCENCE=!1,N.IRIDESCENCE_TEXTURE=!1,N.IRIDESCENCE_THICKNESS_TEXTURE=!1,N.IRIDESCENCE_TEXTUREDIRECTUV=0,N.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(N,q){if(!this._isEnabled)return;const R=this._material.isFrozen;if(!N.useUbo||!R||!N.isSync){var z,v,B,F;if((this._texture||this._thicknessTexture)&&L.d.IridescenceTextureEnabled)N.updateFloat4("vIridescenceInfos",(null===(z=this._texture)||void 0===z?void 0:z.coordinatesIndex)??0,(null===(v=this._texture)||void 0===v?void 0:v.level)??0,(null===(B=this._thicknessTexture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(F=this._thicknessTexture)||void 0===F?void 0:F.level)??0),this._texture&&(0,Q.p)(this._texture,N,"iridescence"),this._thicknessTexture&&(0,Q.p)(this._thicknessTexture,N,"iridescenceThickness");N.updateFloat4("vIridescenceParams",this.$i,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}q.texturesEnabled&&(this._texture&&L.d.IridescenceTextureEnabled&&N.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&L.d.IridescenceTextureEnabled&&N.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(N){return this._texture===N||this._thicknessTexture===N}getActiveTextures(N){this._texture&&N.push(this._texture),this._thicknessTexture&&N.push(this._thicknessTexture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&N.push(this._thicknessTexture)}dispose(N){var q,R;N&&(null===(q=this._texture)||void 0===q||q.dispose(),null===(R=this._thicknessTexture)||void 0===R||R.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(N,q,R){return N.IRIDESCENCE&&q.addFallback(R++,"IRIDESCENCE"),R}getSamplers(N){N.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}c._DefaultMinimumThickness=100,c._DefaultMaximumThickness=400,c._DefaultIndexOfRefraction=1.3,(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,z.c)([(0,v.D)()],c.prototype,"intensity",void 0),(0,z.c)([(0,v.D)()],c.prototype,"minimumThickness",void 0),(0,z.c)([(0,v.D)()],c.prototype,"maximumThickness",void 0),(0,z.c)([(0,v.D)()],c.prototype,"indexOfRefraction",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"thicknessTexture",void 0);class n extends t.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class G extends x.d{set angle(N){this.direction.x=Math.cos(N),this.direction.y=Math.sin(N)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRAnisotropic",110,new n,q),this._isEnabled=!1,this.isEnabled=!1,this.$i=1,this.direction=new y.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=N._dirtyCallbacks[16]}isReadyForSubMesh(N,q){return!this._isEnabled||!(N._areTexturesDirty&&q.texturesEnabled&&this._texture&&L.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(N,q,R){this._isEnabled?(N.ANISOTROPIC=this._isEnabled,this._isEnabled&&!R.isVerticesDataPresent(E.h.TangentKind)&&(N._needUVs=!0,N.MAINUV1=!0),N._areTexturesDirty&&q.texturesEnabled&&(this._texture&&L.d.AnisotropicTextureEnabled?(0,Q.J)(this._texture,N,"ANISOTROPIC_TEXTURE"):N.ANISOTROPIC_TEXTURE=!1),N._areMiscDirty&&(N.ANISOTROPIC_LEGACY=this._legacy)):(N.ANISOTROPIC=!1,N.ANISOTROPIC_TEXTURE=!1,N.ANISOTROPIC_TEXTUREDIRECTUV=0,N.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(N,q){if(!this._isEnabled)return;const R=this._material.isFrozen;N.useUbo&&R&&N.isSync||(this._texture&&L.d.AnisotropicTextureEnabled&&(N.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,Q.p)(this._texture,N,"anisotropy")),N.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.$i)),q.texturesEnabled&&this._texture&&L.d.AnisotropicTextureEnabled&&N.setTexture("anisotropySampler",this._texture)}hasTexture(N){return this._texture===N}getActiveTextures(N){this._texture&&N.push(this._texture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture)}dispose(N){N&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(N,q,R){return N.ANISOTROPIC&&q.addFallback(R++,"ANISOTROPIC"),R}getSamplers(N){N.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(N,q,R){super.parse(N,q,R),void 0===N.legacy&&(this.legacy=!0)}}(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,z.c)([(0,v.D)()],G.prototype,"intensity",void 0),(0,z.c)([(0,v.A)()],G.prototype,"direction",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"legacy",void 0);class s extends t.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class Z extends x.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"Sheen",120,new s,q),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.$i=1,this.color=D.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,q){if(!this._isEnabled)return!0;if(N._areTexturesDirty&&q.texturesEnabled){if(this._texture&&L.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,q){this._isEnabled?(N.SHEEN=!0,N.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,N.SHEEN_ROUGHNESS=null!==this._roughness,N.SHEEN_ALBEDOSCALING=this._albedoScaling,N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,N._areTexturesDirty&&q.texturesEnabled&&(this._texture&&L.d.SheenTextureEnabled?((0,Q.J)(this._texture,N,"SHEEN_TEXTURE"),N.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):N.SHEEN_TEXTURE=!1,this._textureRoughness&&L.d.SheenTextureEnabled?(0,Q.J)(this._textureRoughness,N,"SHEEN_TEXTURE_ROUGHNESS"):N.SHEEN_TEXTURE_ROUGHNESS=!1)):(N.SHEEN=!1,N.SHEEN_TEXTURE=!1,N.SHEEN_TEXTURE_ROUGHNESS=!1,N.SHEEN_LINKWITHALBEDO=!1,N.SHEEN_ROUGHNESS=!1,N.SHEEN_ALBEDOSCALING=!1,N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,N.SHEEN_GAMMATEXTURE=!1,N.SHEEN_TEXTUREDIRECTUV=0,N.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(N,q,R,z){if(!this._isEnabled)return;const v=z.materialDefines,B=this._material.isFrozen;if(!N.useUbo||!B||!N.isSync){var F,S,A,y;if((this._texture||this._textureRoughness)&&L.d.SheenTextureEnabled)N.updateFloat4("vSheenInfos",(null===(F=this._texture)||void 0===F?void 0:F.coordinatesIndex)??0,(null===(S=this._texture)||void 0===S?void 0:S.level)??0,(null===(A=this._textureRoughness)||void 0===A?void 0:A.coordinatesIndex)??0,(null===(y=this._textureRoughness)||void 0===y?void 0:y.level)??0),this._texture&&(0,Q.p)(this._texture,N,"sheen"),this._textureRoughness&&!v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,Q.p)(this._textureRoughness,N,"sheenRoughness");N.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.$i),null!==this._roughness&&N.updateFloat("vSheenRoughness",this._roughness)}q.texturesEnabled&&(this._texture&&L.d.SheenTextureEnabled&&N.setTexture("sheenSampler",this._texture),this._textureRoughness&&!v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.d.SheenTextureEnabled&&N.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(N){return this._texture===N||this._textureRoughness===N}getActiveTextures(N){this._texture&&N.push(this._texture),this._textureRoughness&&N.push(this._textureRoughness)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&N.push(this._textureRoughness)}dispose(N){var q,R;N&&(null===(q=this._texture)||void 0===q||q.dispose(),null===(R=this._textureRoughness)||void 0===R||R.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(N,q,R){return N.SHEEN&&q.addFallback(R++,"SHEEN"),R}getSamplers(N){N.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"linkSheenWithAlbedo",void 0),(0,z.c)([(0,v.D)()],Z.prototype,"intensity",void 0),(0,z.c)([(0,v.j)()],Z.prototype,"color",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRoughnessFromMainTexture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"roughness",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"textureRoughness",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"albedoScaling",void 0);class J extends t.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class M extends x.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(N){this._scene.enableSubSurfaceForPrePass()&&N&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(N))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(N){this._volumeIndexOfRefraction=N>=1?N:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRSubSurface",130,new J,q),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=D.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=D.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=N.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=N._dirtyCallbacks[32]}isReadyForSubMesh(N,q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(N._areTexturesDirty&&q.texturesEnabled){if(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const N=this._getRefractionTexture(q);if(N&&L.d.RefractionTextureEnabled&&!N.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return N.SUBSURFACE=!1,N.SS_DISPERSION=!1,N.SS_TRANSLUCENCY=!1,N.SS_SCATTERING=!1,N.SS_REFRACTION=!1,N.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_THICKNESSANDMASK_TEXTURE=!1,N.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,N.SS_HAS_THICKNESS=!1,N.SS_REFRACTIONINTENSITY_TEXTURE=!1,N.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,N.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,N.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,N.SS_REFRACTIONMAP_3D=!1,N.SS_REFRACTIONMAP_OPPOSITEZ=!1,N.SS_LODINREFRACTIONALPHA=!1,N.SS_GAMMAREFRACTION=!1,N.SS_RGBDREFRACTION=!1,N.SS_LINEARSPECULARREFRACTION=!1,N.SS_LINKREFRACTIONTOTRANSPARENCY=!1,N.SS_ALBEDOFORREFRACTIONTINT=!1,N.SS_ALBEDOFORTRANSLUCENCYTINT=!1,N.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,N.SS_USE_THICKNESS_AS_DEPTH=!1,N.SS_USE_GLTF_TEXTURES=!1,N.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(N.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(N._areTexturesDirty){if(N.SUBSURFACE=!0,N.SS_DISPERSION=this._isDispersionEnabled,N.SS_TRANSLUCENCY=this._isTranslucencyEnabled,N.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_SCATTERING=this._isScatteringEnabled,N.SS_THICKNESSANDMASK_TEXTURE=!1,N.SS_REFRACTIONINTENSITY_TEXTURE=!1,N.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,N.SS_HAS_THICKNESS=!1,N.SS_USE_GLTF_TEXTURES=!1,N.SS_REFRACTION=!1,N.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_REFRACTIONMAP_3D=!1,N.SS_GAMMAREFRACTION=!1,N.SS_RGBDREFRACTION=!1,N.SS_LINEARSPECULARREFRACTION=!1,N.SS_REFRACTIONMAP_OPPOSITEZ=!1,N.SS_LODINREFRACTIONALPHA=!1,N.SS_LINKREFRACTIONTOTRANSPARENCY=!1,N.SS_ALBEDOFORREFRACTIONTINT=!1,N.SS_ALBEDOFORTRANSLUCENCYTINT=!1,N.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,N.SS_USE_THICKNESS_AS_DEPTH=!1,N.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,N._areTexturesDirty&&q.texturesEnabled&&(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&(0,Q.J)(this._thicknessTexture,N,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&L.d.RefractionIntensityTextureEnabled&&(0,Q.J)(this._refractionIntensityTexture,N,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&(0,Q.J)(this._translucencyIntensityTexture,N,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&(0,Q.J)(this._translucencyColorTexture,N,"SS_TRANSLUCENCYCOLOR_TEXTURE")),N.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,N.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,N.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,N.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&q.texturesEnabled){const R=this._getRefractionTexture(q);R&&L.d.RefractionTextureEnabled&&(N.SS_REFRACTION=!0,N.SS_REFRACTIONMAP_3D=R.isCube,N.SS_GAMMAREFRACTION=R.gammaSpace,N.SS_RGBDREFRACTION=R.isRGBD,N.SS_LINEARSPECULARREFRACTION=R.linearSpecularLOD,N.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&R.isCube?!R.invertZ:R.invertZ,N.SS_LODINREFRACTIONALPHA=R.lodLevelInAlpha,N.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,N.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,N.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=R.isCube&&R.boundingBoxSize,N.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(N.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(N,q,R,z){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)N.updateFloat2("vThicknessParam",0,0);else{z.getRenderingMesh().getWorldMatrix().decompose(y.k.o[0]);const q=Math.max(Math.abs(y.k.o[0].x),Math.abs(y.k.o[0].y),Math.abs(y.k.o[0].z));N.updateFloat2("vThicknessParam",this.minimumThickness*q,(this.maximumThickness-this.minimumThickness)*q)}}bindForSubMesh(N,q,R,z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const v=z.materialDefines,B=this._material.isFrozen,F=this._material.realTimeFiltering,S=v.LODBASEDMICROSFURACE,A=this._getRefractionTexture(q);if(!N.useUbo||!B||!N.isSync){if(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&(N.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,Q.p)(this._thicknessTexture,N,"thickness")),this._refractionIntensityTexture&&L.d.RefractionIntensityTextureEnabled&&v.SS_REFRACTIONINTENSITY_TEXTURE&&(N.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,Q.p)(this._refractionIntensityTexture,N,"refractionIntensity")),this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&v.SS_TRANSLUCENCYCOLOR_TEXTURE&&(N.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,Q.p)(this._translucencyColorTexture,N,"translucencyColor")),this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&v.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(N.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,Q.p)(this._translucencyIntensityTexture,N,"translucencyIntensity")),A&&L.d.RefractionTextureEnabled){N.Hj("refractionMatrix",A.getRefractionTextureMatrix());let q=1;A.isCube||A.depth&&(q=A.depth);const R=A.getSize().width,z=this.volumeIndexOfRefraction;if(N.updateFloat4("vRefractionInfos",A.level,1/z,q,this._invertRefractionY?-1:1),N.updateFloat4("vRefractionMicrosurfaceInfos",R,A.lodGenerationScale,A.lodGenerationOffset,1/this.indexOfRefraction),F&&N.updateFloat2("vRefractionFilteringInfo",R,Math.log2(R)),A.boundingBoxSize){const q=A;N.updateVector3("vRefractionPosition",q.boundingBoxPosition),N.updateVector3("vRefractionSize",q.boundingBoxSize)}}this._isScatteringEnabled&&N.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),N.updateColor3("vDiffusionDistance",this.diffusionDistance),N.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),N.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),N.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),N.updateFloat("dispersion",this.dispersion)}q.texturesEnabled&&(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&N.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&L.d.RefractionIntensityTextureEnabled&&v.SS_REFRACTIONINTENSITY_TEXTURE&&N.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&v.SS_TRANSLUCENCYINTENSITY_TEXTURE&&N.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&v.SS_TRANSLUCENCYCOLOR_TEXTURE&&N.setTexture("translucencyColorSampler",this._translucencyColorTexture),A&&L.d.RefractionTextureEnabled&&(S?N.setTexture("refractionSampler",A):(N.setTexture("refractionSampler",A._lodTextureMid||A),N.setTexture("refractionSamplerLow",A._lodTextureLow||A),N.setTexture("refractionSamplerHigh",A._lodTextureHigh||A))))}_getRefractionTexture(N){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?N.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(N){L.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&N.push(this._refractionTexture)}hasTexture(N){return this._thicknessTexture===N||(this._refractionTexture===N||(this._refractionIntensityTexture===N||(this._translucencyIntensityTexture===N||this._translucencyColorTexture===N)))}hasRenderTargetTextures(){return!!(L.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(N){this._thicknessTexture&&N.push(this._thicknessTexture),this._refractionTexture&&N.push(this._refractionTexture),this._translucencyColorTexture&&N.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&N.push(this._translucencyIntensityTexture)}getAnimatables(N){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&N.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&N.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&N.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&N.push(this._translucencyIntensityTexture)}dispose(N){N&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(N,q,R){return N.SS_SCATTERING&&q.addFallback(R++,"SS_SCATTERING"),N.SS_TRANSLUCENCY&&q.addFallback(R++,"SS_TRANSLUCENCY"),R}getSamplers(N){N.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isRefractionEnabled",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTranslucencyEnabled",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isDispersionEnabled",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markScenePrePassDirty")],M.prototype,"isScatteringEnabled",void 0),(0,z.c)([(0,v.D)()],M.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,z.c)([(0,v.D)()],M.prototype,"refractionIntensity",void 0),(0,z.c)([(0,v.D)()],M.prototype,"translucencyIntensity",void 0),(0,z.c)([(0,v.D)()],M.prototype,"useAlbedoToTintRefraction",void 0),(0,z.c)([(0,v.D)()],M.prototype,"useAlbedoToTintTranslucency",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"thicknessTexture",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,z.c)([(0,v.D)()],M.prototype,"_volumeIndexOfRefraction",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"volumeIndexOfRefraction",null),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertRefractionY",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkRefractionWithTransparency",void 0),(0,z.c)([(0,v.D)()],M.prototype,"minimumThickness",void 0),(0,z.c)([(0,v.D)()],M.prototype,"maximumThickness",void 0),(0,z.c)([(0,v.D)()],M.prototype,"useThicknessAsDepth",void 0),(0,z.c)([(0,v.j)()],M.prototype,"tintColor",void 0),(0,z.c)([(0,v.D)()],M.prototype,"tintColorAtDistance",void 0),(0,z.c)([(0,v.D)()],M.prototype,"dispersion",void 0),(0,z.c)([(0,v.j)()],M.prototype,"diffusionDistance",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMaskFromThicknessTexture",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionIntensityTexture",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyIntensityTexture",void 0),(0,z.c)([(0,v.j)()],M.prototype,"translucencyColor",void 0),(0,z.c)([(0,v.x)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyColorTexture",void 0),(0,z.c)([(0,v.D)(),(0,v.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGltfStyleTextures",void 0);var m=R(11429),g=R(11386),j=R(11438);const l={effect:null,subMesh:null};class I extends t.c{constructor(N){super(N),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class U extends Y.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(N){this._realTimeFiltering=N,this.Lg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(N){this._realTimeFilteringQuality=N,this.Lg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=N||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(N,q){super(N,q,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||U.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new y.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=U.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=D.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new D.c(0,0,0),this._albedoColor=new D.c(1,1,1),this._reflectivityColor=new D.c(1,1,1),this._reflectionColor=new D.c(1,1,1),this._emissiveColor=new D.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=U.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new F.h(16),this._globalAmbientColor=new D.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new b(this),this.clearCoat=new u(this),this.iridescence=new c(this),this.anisotropy=new G(this),this.sheen=new Z(this),this.subSurface=new M(this),this.detailMap=new m.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,S.b)(this.va()),this.prePassConfiguration=new f.d}get hasRenderTargetTextures(){return!!(L.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var N;return this._transparencyMode===U.PBRMATERIAL_OPAQUE||this._transparencyMode===U.PBRMATERIAL_ALPHATEST||(null===(N=this.subSurface)||void 0===N?void 0:N.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var N;return!!this._forceAlphaTest||(null===(N=this.subSurface)||void 0===N||!N.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===U.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Fe&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==U.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Fe||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(N,q,R){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const z=q._drawWrapper;if(z.effect&&this.isFrozen&&z._wasPreviouslyReady&&z._wasPreviouslyUsingInstances===R)return!0;q.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),q.materialDefines=new I(this._eventInfo.defineNames));const v=q.materialDefines;if(this._isReadyForSubMesh(q))return!0;const F=this.va(),S=F.getEngine();if(v._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,F.texturesEnabled)){if(this._albedoTexture&&L.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&L.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&L.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const N=this._getReflectionTexture();if(N&&L.d.ReflectionTextureEnabled){if(!N.isReadyOrNotBlocking())return!1;var A;if(N.irradianceTexture){if(!N.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!N.sphericalPolynomial&&null!==(A=N.getInternalTexture())&&void 0!==A&&A._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&L.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&L.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(L.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(S.getCaps().standardDerivatives&&this._bumpTexture&&L.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&L.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=v,this._eventInfo.subMesh=q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(v._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;S.getCaps().standardDerivatives||N.isVerticesDataPresent(E.h.NormalKind)||(N.createNormals(!0),B.c.Warn("PBRMaterial: Normals have been created for the mesh: "+N.name));const y=q.effect,t=v._areLightsDisposed;let x=this._prepareEffect(N,v,this.onCompiled,this.onError,R,null,q.getRenderingMesh().hasThinInstances),e=!1;if(x)if(this._onEffectCreatedObservable&&(l.effect=x,l.subMesh=q,this._onEffectCreatedObservable.notifyObservers(l)),this.allowShaderHotSwapping&&y&&!x.isReady()){if(x=y,v.markAsUnprocessed(),e=this.isFrozen,t)return v._areLightsDisposed=!0,!1}else F.resetCachedMaterial(),q.setEffect(x,v,this._materialContext);return!(!q.effect||!q.effect.isReady())&&(v._renderId=F.getRenderId(),z._wasPreviouslyReady=!e,z._wasPreviouslyUsingInstances=!!R,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(N,q){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(N,q,B,F,S),!q.isDirty)return null;q.markAsProcessed();const A=this.va().getEngine(),y=new X.e;let t=0;q.USESPHERICALINVERTEX&&y.addFallback(t++,"USESPHERICALINVERTEX"),q.FOG&&y.addFallback(t,"FOG"),q.SPECULARAA&&y.addFallback(t,"SPECULARAA"),q.POINTSIZE&&y.addFallback(t,"POINTSIZE"),q.LOGARITHMICDEPTH&&y.addFallback(t,"LOGARITHMICDEPTH"),q.PARALLAX&&y.addFallback(t,"PARALLAX"),q.PARALLAX_RHS&&y.addFallback(t,"PARALLAX_RHS"),q.PARALLAXOCCLUSION&&y.addFallback(t++,"PARALLAXOCCLUSION"),q.ENVIRONMENTBRDF&&y.addFallback(t++,"ENVIRONMENTBRDF"),q.TANGENT&&y.addFallback(t++,"TANGENT"),q.BUMP&&y.addFallback(t++,"BUMP"),t=(0,Q.t)(q,y,this._maxSimultaneousLights,t++),q.SPECULARTERM&&y.addFallback(t++,"SPECULARTERM"),q.USESPHERICALFROMREFLECTIONMAP&&y.addFallback(t++,"USESPHERICALFROMREFLECTIONMAP"),q.USEIRRADIANCEMAP&&y.addFallback(t++,"USEIRRADIANCEMAP"),q.LIGHTMAP&&y.addFallback(t++,"LIGHTMAP"),q.NORMAL&&y.addFallback(t++,"NORMAL"),q.AMBIENT&&y.addFallback(t++,"AMBIENT"),q.EMISSIVE&&y.addFallback(t++,"EMISSIVE"),q.VERTEXCOLOR&&y.addFallback(t++,"VERTEXCOLOR"),q.MORPHTARGETS&&y.addFallback(t++,"MORPHTARGETS"),q.MULTIVIEW&&y.addFallback(0,"MULTIVIEW");const x=[E.h.PositionKind];q.NORMAL&&x.push(E.h.NormalKind),q.TANGENT&&x.push(E.h.TangentKind);for(let R=1;R<=6;++R)q["UV"+R]&&x.push(`uv${1===R?"":R}`);q.VERTEXCOLOR&&x.push(E.h.ColorKind),(0,Q.w)(x,N,q,y),(0,Q.x)(x,q),(0,Q.z)(x,N,q),(0,Q.u)(x,N,q);let e="pbr";const b=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],D=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],H=["Material","Scene","Mesh"],Y={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:q.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=y,this._eventInfo.fallbackRank=t,this._eventInfo.defines=q,this._eventInfo.uniforms=b,this._eventInfo.attributes=x,this._eventInfo.samplers=D,this._eventInfo.uniformBuffersNames=H,this._eventInfo.customCode=void 0,this._eventInfo.mesh=N,this._eventInfo.indexParameters=Y,this._callbackPluginEventGeneric(128,this._eventInfo),j.d.AddUniformsAndSamplers(b,D),f.d.AddUniforms(b),f.d.AddSamplers(D),(0,g.c)(b),V.c&&(V.c.PrepareUniforms(b,q),V.c.PrepareSamplers(D,q)),(0,Q.W)({uniformsNames:b,uniformBuffersNames:H,samplers:D,defines:q,maxSimultaneousLights:this._maxSimultaneousLights});const T={};this.customShaderNameResolve&&(e=this.customShaderNameResolve(e,b,H,D,q,x,T));const L=q.toString(),h=A.createEffect(e,{attributes:x,uniformsNames:b,uniformBuffersNames:H,samplers:D,defines:L,fallbacks:y,onCompiled:z,onError:v,indexParameters:Y,processFinalCode:T.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:q.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([R.e(21),R.e(43)]).then(R.bind(R,13406)),Promise.all([R.e(22),R.e(44)]).then(R.bind(R,13424))]):await Promise.all([Promise.all([R.e(25),R.e(45)]).then(R.bind(R,13426)),Promise.all([R.e(27),R.e(46)]).then(R.bind(R,13437))]),this._shadersLoaded=!0}},A);return this._eventInfo.customCode=void 0,h}_prepareDefines(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=this.va(),F=B.getEngine();(0,Q.G)(B,N,q,!0,this._maxSimultaneousLights,this._disableLighting),q._needNormals=!0,(0,Q.O)(B,q);const S=this.needAlphaBlendingForMesh(N)&&this.va().useOrderIndependentTransparency;if((0,Q.U)(B,q,this.canRenderToMRT&&!S),(0,Q.S)(B,q,S),j.d.PrepareDefines(F.currentRenderPassId,N,q),q.METALLICWORKFLOW=this.isMetallicWorkflow(),q._areTexturesDirty){q._needUVs=!1;for(let N=1;N<=6;++N)q["MAINUV"+N]=!1;if(B.texturesEnabled){q.ALBEDODIRECTUV=0,q.AMBIENTDIRECTUV=0,q.OPACITYDIRECTUV=0,q.EMISSIVEDIRECTUV=0,q.REFLECTIVITYDIRECTUV=0,q.MICROSURFACEMAPDIRECTUV=0,q.METALLIC_REFLECTANCEDIRECTUV=0,q.REFLECTANCEDIRECTUV=0,q.BUMPDIRECTUV=0,q.LIGHTMAPDIRECTUV=0,F.getCaps().textureLOD&&(q.LODBASEDMICROSFURACE=!0),this._albedoTexture&&L.d.DiffuseTextureEnabled?((0,Q.J)(this._albedoTexture,q,"ALBEDO"),q.GAMMAALBEDO=this._albedoTexture.gammaSpace):q.ALBEDO=!1,this._ambientTexture&&L.d.AmbientTextureEnabled?((0,Q.J)(this._ambientTexture,q,"AMBIENT"),q.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):q.AMBIENT=!1,this._opacityTexture&&L.d.OpacityTextureEnabled?((0,Q.J)(this._opacityTexture,q,"OPACITY"),q.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):q.OPACITY=!1;const N=this._getReflectionTexture();if(N&&L.d.ReflectionTextureEnabled){switch(q.REFLECTION=!0,q.GAMMAREFLECTION=N.gammaSpace,q.RGBDREFLECTION=N.isRGBD,q.LODINREFLECTIONALPHA=N.lodLevelInAlpha,q.LINEARSPECULARREFLECTION=N.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(q.NUM_SAMPLES=""+this.realTimeFilteringQuality,F._features.needTypeSuffixInShaderConstants&&(q.NUM_SAMPLES=q.NUM_SAMPLES+"u"),q.REALTIME_FILTERING=!0):q.REALTIME_FILTERING=!1,q.INVERTCUBICMAP=N.coordinatesMode===T.c.INVCUBIC_MODE,q.REFLECTIONMAP_3D=N.isCube,q.REFLECTIONMAP_OPPOSITEZ=q.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!N.invertZ:N.invertZ,q.REFLECTIONMAP_CUBIC=!1,q.REFLECTIONMAP_EXPLICIT=!1,q.REFLECTIONMAP_PLANAR=!1,q.REFLECTIONMAP_PROJECTION=!1,q.REFLECTIONMAP_SKYBOX=!1,q.REFLECTIONMAP_SPHERICAL=!1,q.REFLECTIONMAP_EQUIRECTANGULAR=!1,q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,N.coordinatesMode){case T.c.EXPLICIT_MODE:q.REFLECTIONMAP_EXPLICIT=!0;break;case T.c.PLANAR_MODE:q.REFLECTIONMAP_PLANAR=!0;break;case T.c.PROJECTION_MODE:q.REFLECTIONMAP_PROJECTION=!0;break;case T.c.SKYBOX_MODE:q.REFLECTIONMAP_SKYBOX=!0;break;case T.c.SPHERICAL_MODE:q.REFLECTIONMAP_SPHERICAL=!0;break;case T.c.EQUIRECTANGULAR_MODE:q.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case T.c.FIXED_EQUIRECTANGULAR_MODE:q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case T.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case T.c.CUBIC_MODE:case T.c.INVCUBIC_MODE:default:q.REFLECTIONMAP_CUBIC=!0,q.USE_LOCAL_REFLECTIONMAP_CUBIC=!!N.boundingBoxSize}N.coordinatesMode!==T.c.SKYBOX_MODE&&(N.irradianceTexture?(q.USEIRRADIANCEMAP=!0,q.USESPHERICALFROMREFLECTIONMAP=!1):N.isCube&&(q.USESPHERICALFROMREFLECTIONMAP=!0,q.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||F.getCaps().maxVaryingVectors<=8?q.USESPHERICALINVERTEX=!1:q.USESPHERICALINVERTEX=!0))}else q.REFLECTION=!1,q.REFLECTIONMAP_3D=!1,q.REFLECTIONMAP_SPHERICAL=!1,q.REFLECTIONMAP_PLANAR=!1,q.REFLECTIONMAP_CUBIC=!1,q.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,q.REFLECTIONMAP_PROJECTION=!1,q.REFLECTIONMAP_SKYBOX=!1,q.REFLECTIONMAP_EXPLICIT=!1,q.REFLECTIONMAP_EQUIRECTANGULAR=!1,q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,q.INVERTCUBICMAP=!1,q.USESPHERICALFROMREFLECTIONMAP=!1,q.USEIRRADIANCEMAP=!1,q.USESPHERICALINVERTEX=!1,q.REFLECTIONMAP_OPPOSITEZ=!1,q.LODINREFLECTIONALPHA=!1,q.GAMMAREFLECTION=!1,q.RGBDREFLECTION=!1,q.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&L.d.LightmapTextureEnabled?((0,Q.J)(this._lightmapTexture,q,"LIGHTMAP"),q.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,q.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,q.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):q.LIGHTMAP=!1,this._emissiveTexture&&L.d.EmissiveTextureEnabled?((0,Q.J)(this._emissiveTexture,q,"EMISSIVE"),q.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):q.EMISSIVE=!1,L.d.SpecularTextureEnabled?(this._metallicTexture?((0,Q.J)(this._metallicTexture,q,"REFLECTIVITY"),q.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,q.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,q.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,q.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,q.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,Q.J)(this._reflectivityTexture,q,"REFLECTIVITY"),q.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,q.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,q.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):q.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(q.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,Q.J)(this._metallicReflectanceTexture,q,"METALLIC_REFLECTANCE"),q.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):q.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,Q.J)(this._reflectanceTexture,q,"REFLECTANCE"),q.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):q.REFLECTANCE=!1):(q.METALLIC_REFLECTANCE=!1,q.REFLECTANCE=!1),this._microSurfaceTexture?(0,Q.J)(this._microSurfaceTexture,q,"MICROSURFACEMAP"):q.MICROSURFACEMAP=!1):(q.REFLECTIVITY=!1,q.MICROSURFACEMAP=!1),F.getCaps().standardDerivatives&&this._bumpTexture&&L.d.BumpTextureEnabled&&!this._disableBumpMap?((0,Q.J)(this._bumpTexture,q,"BUMP"),this._useParallax&&this._albedoTexture&&L.d.DiffuseTextureEnabled?(q.PARALLAX=!0,q.PARALLAX_RHS=B.useRightHandedSystem,q.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):q.PARALLAX=!1,q.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(q.BUMP=!1,q.PARALLAX=!1,q.PARALLAX_RHS=!1,q.PARALLAXOCCLUSION=!1,q.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&L.d.ReflectionTextureEnabled?(q.ENVIRONMENTBRDF=!0,q.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(q.ENVIRONMENTBRDF=!1,q.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?q.ALPHAFROMALBEDO=!0:q.ALPHAFROMALBEDO=!1}q.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===U.LIGHTFALLOFF_STANDARD?(q.USEPHYSICALLIGHTFALLOFF=!1,q.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===U.LIGHTFALLOFF_GLTF?(q.USEPHYSICALLIGHTFALLOFF=!1,q.USEGLTFLIGHTFALLOFF=!0):(q.USEPHYSICALLIGHTFALLOFF=!0,q.USEGLTFLIGHTFALLOFF=!1),q.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.hh&&this._twoSidedLighting?q.TWOSIDEDLIGHTING=!0:q.TWOSIDEDLIGHTING=!1,q.SPECULARAA=F.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(q._areTexturesDirty||q._areMiscDirty)&&(q.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,q.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,q.ALPHABLEND=this.needAlphaBlendingForMesh(N),q.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,q.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),q._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(q),q.FORCENORMALFORWARD=this._forceNormalForward,q.RADIANCEOCCLUSION=this._useRadianceOcclusion,q.HORIZONOCCLUSION=this._useHorizonOcclusion,q._areMiscDirty&&((0,Q.K)(N,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(N)||this._forceAlphaTest,q,this._applyDecalMapAfterDetailMap),q.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!N.isVerticesDataPresent(E.h.NormalKind),q.DEBUGMODE=this._debugMode),(0,Q.E)(B,F,this,q,!!R,z,v),this._eventInfo.defines=q,this._eventInfo.mesh=N,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,Q.D)(N,q,!0,!0,!0,this._transparencyMode!==U.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(N,q,R){const z={clipPlane:!1,useInstances:!1,...R};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const R=new I(this._eventInfo.defineNames),v=this._prepareEffect(N,R,void 0,void 0,z.useInstances,z.clipPlane,N.hasThinInstances);this._onEffectCreatedObservable&&(l.effect=v,l.subMesh=null,this._onEffectCreatedObservable.notifyObservers(l)),v.isReady()?q&&q(this):v.onCompileObservable.add((()=>{q&&q(this)}))})()}buildUniformLayout(){const N=this._uniformBuffer;N.addUniform("vAlbedoInfos",2),N.addUniform("vAmbientInfos",4),N.addUniform("vOpacityInfos",2),N.addUniform("vEmissiveInfos",2),N.addUniform("vLightmapInfos",2),N.addUniform("vReflectivityInfos",3),N.addUniform("vMicroSurfaceSamplerInfos",2),N.addUniform("vReflectionInfos",2),N.addUniform("vReflectionFilteringInfo",2),N.addUniform("vReflectionPosition",3),N.addUniform("vReflectionSize",3),N.addUniform("vBumpInfos",3),N.addUniform("albedoMatrix",16),N.addUniform("ambientMatrix",16),N.addUniform("opacityMatrix",16),N.addUniform("emissiveMatrix",16),N.addUniform("lightmapMatrix",16),N.addUniform("reflectivityMatrix",16),N.addUniform("microSurfaceSamplerMatrix",16),N.addUniform("bumpMatrix",16),N.addUniform("vTangentSpaceParams",2),N.addUniform("reflectionMatrix",16),N.addUniform("vReflectionColor",3),N.addUniform("vAlbedoColor",4),N.addUniform("vLightingIntensity",4),N.addUniform("vReflectionMicrosurfaceInfos",3),N.addUniform("pointSize",1),N.addUniform("vReflectivityColor",4),N.addUniform("vEmissiveColor",3),N.addUniform("vAmbientColor",3),N.addUniform("vDebugMode",2),N.addUniform("vMetallicReflectanceFactors",4),N.addUniform("vMetallicReflectanceInfos",2),N.addUniform("metallicReflectanceMatrix",16),N.addUniform("vReflectanceInfos",2),N.addUniform("reflectanceMatrix",16),N.addUniform("vSphericalL00",3),N.addUniform("vSphericalL1_1",3),N.addUniform("vSphericalL10",3),N.addUniform("vSphericalL11",3),N.addUniform("vSphericalL2_2",3),N.addUniform("vSphericalL2_1",3),N.addUniform("vSphericalL20",3),N.addUniform("vSphericalL21",3),N.addUniform("vSphericalL22",3),N.addUniform("vSphericalX",3),N.addUniform("vSphericalY",3),N.addUniform("vSphericalZ",3),N.addUniform("vSphericalXX_ZZ",3),N.addUniform("vSphericalYY_ZZ",3),N.addUniform("vSphericalZZ",3),N.addUniform("vSphericalXY",3),N.addUniform("vSphericalYZ",3),N.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(N,q,R){const z=this.va(),v=R.materialDefines;if(!v)return;const B=R.effect;if(!B)return;this._activeEffect=B,q.getMeshUniformBuffer().bindToEffect(B,"Mesh"),q.transferToEffect(N);const F=z.getEngine();this._uniformBuffer.bindToEffect(B,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,z,q,N,this.isFrozen),j.d.Bind(F.currentRenderPassId,this._activeEffect,q,N),this._eventInfo.subMesh=R,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),v.OBJECTSPACE_NORMALMAP&&(N.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(z,B,R,q.visibility);(0,Q.b)(q,this._activeEffect,this.prePassConfiguration);let y=null;const E=this._uniformBuffer;if(S){if(this.bindViewProjection(B),y=this._getReflectionTexture(),!E.useUbo||!this.isFrozen||!E.isSync||R._drawWrapper._forceRebindOnNextCall){var t;if(z.texturesEnabled){if(this._albedoTexture&&L.d.DiffuseTextureEnabled&&(E.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,Q.p)(this._albedoTexture,E,"albedo")),this._ambientTexture&&L.d.AmbientTextureEnabled&&(E.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,Q.p)(this._ambientTexture,E,"ambient")),this._opacityTexture&&L.d.OpacityTextureEnabled&&(E.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,Q.p)(this._opacityTexture,E,"opacity")),y&&L.d.ReflectionTextureEnabled){if(E.Hj("reflectionMatrix",y.getReflectionTextureMatrix()),E.updateFloat2("vReflectionInfos",y.level,0),y.boundingBoxSize){const N=y;E.updateVector3("vReflectionPosition",N.boundingBoxPosition),E.updateVector3("vReflectionSize",N.boundingBoxSize)}if(this.realTimeFiltering){const N=y.getSize().width;E.updateFloat2("vReflectionFilteringInfo",N,Math.log2(N))}if(!v.USEIRRADIANCEMAP){const N=y.sphericalPolynomial;if(v.USESPHERICALFROMREFLECTIONMAP&&N)if(v.SPHERICAL_HARMONICS){const q=N.preScaledHarmonics;E.updateVector3("vSphericalL00",q.l00),E.updateVector3("vSphericalL1_1",q.l1_1),E.updateVector3("vSphericalL10",q.l10),E.updateVector3("vSphericalL11",q.l11),E.updateVector3("vSphericalL2_2",q.l2_2),E.updateVector3("vSphericalL2_1",q.l2_1),E.updateVector3("vSphericalL20",q.l20),E.updateVector3("vSphericalL21",q.l21),E.updateVector3("vSphericalL22",q.l22)}else E.updateFloat3("vSphericalX",N.x.x,N.x.y,N.x.z),E.updateFloat3("vSphericalY",N.y.x,N.y.y,N.y.z),E.updateFloat3("vSphericalZ",N.z.x,N.z.y,N.z.z),E.updateFloat3("vSphericalXX_ZZ",N.xx.x-N.zz.x,N.xx.y-N.zz.y,N.xx.z-N.zz.z),E.updateFloat3("vSphericalYY_ZZ",N.yy.x-N.zz.x,N.yy.y-N.zz.y,N.yy.z-N.zz.z),E.updateFloat3("vSphericalZZ",N.zz.x,N.zz.y,N.zz.z),E.updateFloat3("vSphericalXY",N.xy.x,N.xy.y,N.xy.z),E.updateFloat3("vSphericalYZ",N.yz.x,N.yz.y,N.yz.z),E.updateFloat3("vSphericalZX",N.zx.x,N.zx.y,N.zx.z)}E.updateFloat3("vReflectionMicrosurfaceInfos",y.getSize().width,y.lodGenerationScale,y.lodGenerationOffset)}this._emissiveTexture&&L.d.EmissiveTextureEnabled&&(E.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,Q.p)(this._emissiveTexture,E,"emissive")),this._lightmapTexture&&L.d.LightmapTextureEnabled&&(E.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,Q.p)(this._lightmapTexture,E,"lightmap")),L.d.SpecularTextureEnabled&&(this._metallicTexture?(E.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,Q.p)(this._metallicTexture,E,"reflectivity")):this._reflectivityTexture&&(E.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,Q.p)(this._reflectivityTexture,E,"reflectivity")),this._metallicReflectanceTexture&&(E.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,Q.p)(this._metallicReflectanceTexture,E,"metallicReflectance")),this._reflectanceTexture&&v.REFLECTANCE&&(E.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,Q.p)(this._reflectanceTexture,E,"reflectance")),this._microSurfaceTexture&&(E.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,Q.p)(this._microSurfaceTexture,E,"microSurfaceSampler"))),this._bumpTexture&&F.getCaps().standardDerivatives&&L.d.BumpTextureEnabled&&!this._disableBumpMap&&(E.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,Q.p)(this._bumpTexture,E,"bump"),z._mirroredCameraPosition?E.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):E.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&E.updateFloat("pointSize",this.pointSize),v.METALLICWORKFLOW){var x;D.h.hb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,D.h.hb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,E.updateColor4("vReflectivityColor",D.h.hb[0],1);const N=(null===(x=this.subSurface)||void 0===x?void 0:x._indexOfRefraction)??1.5,q=1,R=Math.pow((N-q)/(N+q),2);this._metallicReflectanceColor.scaleToRef(R*this._metallicF0Factor,D.h.hb[0]);const z=this._metallicF0Factor;E.updateColor4("vMetallicReflectanceFactors",D.h.hb[0],z)}else E.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);E.updateColor3("vEmissiveColor",L.d.EmissiveTextureEnabled?this._emissiveColor:D.c.BlackReadOnly),E.updateColor3("vReflectionColor",this._reflectionColor),!v.SS_REFRACTION&&null!==(t=this.subSurface)&&void 0!==t&&t._linkRefractionWithTransparency?E.updateColor4("vAlbedoColor",this._albedoColor,1):E.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*z.environmentIntensity,this._lightingInfos.w=this._specularIntensity,E.updateVector4("vLightingIntensity",this._lightingInfos),z.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),E.updateColor3("vAmbientColor",this._globalAmbientColor),E.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}z.texturesEnabled&&(this._albedoTexture&&L.d.DiffuseTextureEnabled&&E.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&L.d.AmbientTextureEnabled&&E.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.d.OpacityTextureEnabled&&E.setTexture("opacitySampler",this._opacityTexture),y&&L.d.ReflectionTextureEnabled&&(v.LODBASEDMICROSFURACE?E.setTexture("reflectionSampler",y):(E.setTexture("reflectionSampler",y._lodTextureMid||y),E.setTexture("reflectionSamplerLow",y._lodTextureLow||y),E.setTexture("reflectionSamplerHigh",y._lodTextureHigh||y)),v.USEIRRADIANCEMAP&&E.setTexture("irradianceSampler",y.irradianceTexture)),v.ENVIRONMENTBRDF&&E.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&L.d.EmissiveTextureEnabled&&E.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.d.LightmapTextureEnabled&&E.setTexture("lightmapSampler",this._lightmapTexture),L.d.SpecularTextureEnabled&&(this._metallicTexture?E.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&E.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&E.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&v.REFLECTANCE&&E.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&E.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&F.getCaps().standardDerivatives&&L.d.BumpTextureEnabled&&!this._disableBumpMap&&E.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(q)&&this.va().depthPeelingRenderer.bind(B),this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,g.e)(this._activeEffect,this,z),this.bindEyePosition(B)}else z.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var e;if(z.lightsEnabled&&!this._disableLighting&&(0,Q.e)(z,q,this._activeEffect,v,this._maxSimultaneousLights),(z.fogEnabled&&q.applyFog&&z.fogMode!==A.b.FOGMODE_NONE||y||this.subSurface.refractionTexture||q.receiveShadows||v.PREPASS)&&this.bindView(B),(0,Q.c)(z,q,this._activeEffect,!0),v.NUM_MORPH_INFLUENCERS&&(0,Q.j)(q,this._activeEffect),v.BAKED_VERTEX_ANIMATION_TEXTURE)null===(e=q.bakedVertexAnimationManager)||void 0===e||e.bind(B,v.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,Q.i)(v,this._activeEffect,z)}this._afterBind(q,this._activeEffect,R),E.update()}getAnimatables(){const N=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&N.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&N.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&N.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&N.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&N.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?N.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&N.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&N.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&N.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&N.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&N.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&N.push(this._microSurfaceTexture),N}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const N=super.getActiveTextures();return this._albedoTexture&&N.push(this._albedoTexture),this._ambientTexture&&N.push(this._ambientTexture),this._opacityTexture&&N.push(this._opacityTexture),this._reflectionTexture&&N.push(this._reflectionTexture),this._emissiveTexture&&N.push(this._emissiveTexture),this._reflectivityTexture&&N.push(this._reflectivityTexture),this._metallicTexture&&N.push(this._metallicTexture),this._metallicReflectanceTexture&&N.push(this._metallicReflectanceTexture),this._reflectanceTexture&&N.push(this._reflectanceTexture),this._microSurfaceTexture&&N.push(this._microSurfaceTexture),this._bumpTexture&&N.push(this._bumpTexture),this._lightmapTexture&&N.push(this._lightmapTexture),N}hasTexture(N){return!!super.hasTexture(N)||(this._albedoTexture===N||(this._ambientTexture===N||(this._opacityTexture===N||(this._reflectionTexture===N||(this._emissiveTexture===N||(this._reflectivityTexture===N||(this._metallicTexture===N||(this._metallicReflectanceTexture===N||(this._reflectanceTexture===N||(this._microSurfaceTexture===N||(this._bumpTexture===N||this._lightmapTexture===N)))))))))))}setPrePassRenderer(){var N;if(null===(N=this.subSurface)||void 0===N||!N.isScatteringEnabled)return!1;const q=this.va().enableSubSurfaceForPrePass();return q&&(q.enabled=!0),!0}dispose(N,q){var R,z,v,B,F,S,A,y,E,t,x,e;(this._breakShaderLoadedCheck=!0,q)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(R=this._albedoTexture)||void 0===R||R.dispose(),null===(z=this._ambientTexture)||void 0===z||z.dispose(),null===(v=this._opacityTexture)||void 0===v||v.dispose(),null===(B=this._reflectionTexture)||void 0===B||B.dispose(),null===(F=this._emissiveTexture)||void 0===F||F.dispose(),null===(S=this._metallicTexture)||void 0===S||S.dispose(),null===(A=this._reflectivityTexture)||void 0===A||A.dispose(),null===(y=this._bumpTexture)||void 0===y||y.dispose(),null===(E=this._lightmapTexture)||void 0===E||E.dispose(),null===(t=this._metallicReflectanceTexture)||void 0===t||t.dispose(),null===(x=this._reflectanceTexture)||void 0===x||x.dispose(),null===(e=this._microSurfaceTexture)||void 0===e||e.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(N,q)}}U.PBRMATERIAL_OPAQUE=H.d.MATERIAL_OPAQUE,U.PBRMATERIAL_ALPHATEST=H.d.MATERIAL_ALPHATEST,U.PBRMATERIAL_ALPHABLEND=H.d.MATERIAL_ALPHABLEND,U.PBRMATERIAL_ALPHATESTANDBLEND=H.d.MATERIAL_ALPHATESTANDBLEND,U.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,U.LIGHTFALLOFF_PHYSICAL=0,U.LIGHTFALLOFF_GLTF=1,U.LIGHTFALLOFF_STANDARD=2,U.ForceGLSL=!1,(0,z.c)([(0,v.o)()],U.prototype,"_imageProcessingConfiguration",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsMiscDirty")],U.prototype,"debugMode",void 0)},10991:(N,q,R)=>{"use strict";R.d(q,{d:()=>F});var z=R(10907);const v=new Map;function B(N,q){(function(N){return v.delete(N)})(N)&&z.c.Warn(`Extension with the name '${name}' already exists`),v.set(N,q)}function F(N,q){"image/ktx"!==q&&"image/ktx2"!==q||(N=".ktx"),v.has(N)||(N.endsWith(".dds")&&B(".dds",(()=>R.e(12).then(R.bind(R,12817)).then((N=>new N._DDSTextureLoader)))),N.endsWith(".basis")&&B(".basis",(()=>R.e(13).then(R.bind(R,12823)).then((N=>new N._BasisTextureLoader)))),N.endsWith(".env")&&B(".env",(()=>R.e(14).then(R.bind(R,12825)).then((N=>new N._ENVTextureLoader)))),N.endsWith(".hdr")&&B(".hdr",(()=>R.e(15).then(R.bind(R,12832)).then((N=>new N._HDRTextureLoader)))),(N.endsWith(".ktx")||N.endsWith(".ktx2"))&&(B(".ktx",(()=>R.e(16).then(R.bind(R,12840)).then((N=>new N._KTXTextureLoader)))),B(".ktx2",(()=>R.e(16).then(R.bind(R,12840)).then((N=>new N._KTXTextureLoader))))),N.endsWith(".tga")&&B(".tga",(()=>R.e(17).then(R.bind(R,12847)).then((N=>new N._TGATextureLoader)))),N.endsWith(".exr")&&B(".exr",(()=>R.e(18).then(R.bind(R,12853)).then((N=>new N._ExrTextureLoader)))));const z=v.get(N);return z?Promise.resolve(z(q)):null}},11407:(N,q,R)=>{"use strict";R.d(q,{c:()=>x});var z=R(11147),v=R(11151),B=R(10893),F=R(11181),S=R(10933),A=R(11007),y=(R(10938),R(11411));class E{get wrapU(){return this._wrapU}set wrapU(N){this._wrapU=N}get wrapV(){return this._wrapV}set wrapV(N){this._wrapV=N}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(N){this._texture&&(this._texture.isCube=N)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(N){this._texture&&(this._texture.is3D=N)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(N){this._texture&&(this._texture.is2DArray=N)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(N){return void 0!==(null===N||void 0===N?void 0:N.shareDepth)}constructor(N){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=y.d.Zero(),this._cachedBaseSize=y.d.Zero(),this._initialSamplingMode=2,this._texture=E._IsRenderTargetWrapper(N)?N.texture:N,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(N){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(N,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var t=R(11221);class x extends E{set Fe(N){this._hasAlpha!==N&&(this._hasAlpha=N,this._scene&&this._scene.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))))}get Fe(){return this._hasAlpha}set getAlphaFromRGB(N){this._getAlphaFromRGB!==N&&(this._getAlphaFromRGB=N,this._scene&&this._scene.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(N){this._coordinatesIndex!==N&&(this._coordinatesIndex=N,this._scene&&this._scene.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(N){this._coordinatesMode!==N&&(this._coordinatesMode=N,this._scene&&this._scene.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(N){this._wrapU=N}get wrapV(){return this._wrapV}set wrapV(N){this._wrapV=N}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(N){this._texture?this._texture.isCube=N:this._isCube=N}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(N){this._texture&&(this._texture.is3D=N)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(N){this._texture&&(this._texture.is2DArray=N)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(N){var q;if(this._texture){if(this._texture._gammaSpace===N)return;this._texture._gammaSpace=N}else{if(this._gammaSpace===N)return;this._gammaSpace=N}null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(N){var q;N!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=N),null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(N){this._texture&&(this._texture._lodGenerationOffset=N)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(N){this._texture&&(this._texture._lodGenerationScale=N)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(N){this._texture&&(this._texture._linearSpecularLOD=N)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(N){this._texture&&(this._texture._irradianceTexture=N)}get uid(){return this._uid||(this._uid=(0,A.e)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(N){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(N)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=x.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.jj=new B.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,N?x._IsScene(N)?this._scene=N:this._engine=N:this._scene=S.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=q,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return F.d.IdentityReadOnly}getReflectionTextureMatrix(){return F.d.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(N){}get canRescale(){return!1}_getFromCache(N,q,R,z,v,B){const F=this._getEngine();if(!F)return null;const S=F._getUseSRGBBuffer(!!v,q),A=F.getLoadedTexturesCache();for(let y=0;y<A.length;y++){const F=A[y];if((void 0===v||S===F._useSRGBBuffer)&&(void 0===z||z===F.invertY)&&F.url===N&&F.generateMipMaps===!q&&(!R||R===F.samplingMode)&&(void 0===B||B===F.isCube))return F.incrementReferences(),F}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const N=this.va();N&&N.markAllMaterialsAsDirty(1)}readPixels(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const y=this._getEngine();if(!y)return null;const E=this.getSize();let t=E.width,x=E.height;0!==q&&(t/=Math.pow(2,q),x/=Math.pow(2,q),t=Math.round(t),x=Math.round(x)),S=Math.min(t,S),A=Math.min(x,A);try{return this._texture.isCube?y._readTexturePixels(this._texture,S,A,N,q,R,z,v,B,F):y._readTexturePixels(this._texture,S,A,-1,q,R,z,v,B,F)}catch(e){return null}}_readPixelsSync(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const B=this.getSize();let F=B.width,S=B.height;const A=this._getEngine();if(!A)return null;0!=q&&(F/=Math.pow(2,q),S/=Math.pow(2,q),F=Math.round(F),S=Math.round(S));try{return this._texture.isCube?A._readTexturePixelsSync(this._texture,F,S,N,q,R,z,v):A._readTexturePixelsSync(this._texture,F,S,-1,q,R,z,v)}catch(y){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const N=this._scene.textures.indexOf(this);if(N>=0&&this._scene.textures.splice(N,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const N=this._parentContainer.textures.indexOf(this);N>-1&&this._parentContainer.textures.splice(N,1),this._parentContainer=null}}this.jj.notifyObservers(this),this.jj.clear(),this.metadata=null,super.dispose()}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!N)return null;const q=t.e.Serialize(this);return t.e.AppendSerializedAnimations(this,q),q}static WhenAllReady(N,q){let R=N.length;if(0!==R)for(let z=0;z<N.length;z++){const v=N[z];if(v.isReady())0===--R&&q();else{const N=v.onLoadObservable;N?N.addOnce((()=>{0===--R&&q()})):0===--R&&q()}}else q()}static _IsScene(N){return"Scene"===N.getClassName()}}x.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,z.c)([(0,v.D)()],x.prototype,"uniqueId",void 0),(0,z.c)([(0,v.D)()],x.prototype,"name",void 0),(0,z.c)([(0,v.D)()],x.prototype,"metadata",void 0),(0,z.c)([(0,v.D)("Fe")],x.prototype,"_hasAlpha",void 0),(0,z.c)([(0,v.D)("getAlphaFromRGB")],x.prototype,"_getAlphaFromRGB",void 0),(0,z.c)([(0,v.D)()],x.prototype,"level",void 0),(0,z.c)([(0,v.D)("coordinatesIndex")],x.prototype,"_coordinatesIndex",void 0),(0,z.c)([(0,v.D)()],x.prototype,"optimizeUVAllocation",void 0),(0,z.c)([(0,v.D)("coordinatesMode")],x.prototype,"_coordinatesMode",void 0),(0,z.c)([(0,v.D)()],x.prototype,"wrapU",null),(0,z.c)([(0,v.D)()],x.prototype,"wrapV",null),(0,z.c)([(0,v.D)()],x.prototype,"wrapR",void 0),(0,z.c)([(0,v.D)()],x.prototype,"anisotropicFilteringLevel",void 0),(0,z.c)([(0,v.D)()],x.prototype,"isCube",null),(0,z.c)([(0,v.D)()],x.prototype,"is3D",null),(0,z.c)([(0,v.D)()],x.prototype,"is2DArray",null),(0,z.c)([(0,v.D)()],x.prototype,"gammaSpace",null),(0,z.c)([(0,v.D)()],x.prototype,"invertZ",void 0),(0,z.c)([(0,v.D)()],x.prototype,"lodLevelInAlpha",void 0),(0,z.c)([(0,v.D)()],x.prototype,"lodGenerationOffset",null),(0,z.c)([(0,v.D)()],x.prototype,"lodGenerationScale",null),(0,z.c)([(0,v.D)()],x.prototype,"linearSpecularLOD",null),(0,z.c)([(0,v.x)()],x.prototype,"irradianceTexture",null),(0,z.c)([(0,v.D)()],x.prototype,"isRenderTarget",void 0)},12111:(N,q,R)=>{"use strict";var z=R(11702),v=R(11407);v.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(v.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=z.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((N=>{this._texture._sphericalPolynomial=N,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(N){this._texture&&(this._texture._sphericalPolynomial=N)},enumerable:!0,configurable:!0})},12157:(N,q,R)=>{"use strict";R.d(q,{b:()=>x});var z=R(11147),v=R(11151),B=R(10888),F=R(11181),S=R(11407),A=R(11402),y=R(11002),E=R(10893),t=R(11221);R(11732);class x extends S.c{set boundingBoxSize(N){if(this._boundingBoxSize&&this._boundingBoxSize.equals(N))return;this._boundingBoxSize=N;const q=this.va();q&&q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(N){this._rotationY=N,this.setReflectionTextureMatrix(F.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(N,q,R){let z="";return N.forEach((N=>z+=N)),new x(z,q,null,R,N)}static CreateFromPrefilteredData(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const v=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const B=new x(N,q,null,!1,null,null,null,void 0,!0,R,z);return q.useDelayedTextureLoading=v,B}constructor(N,q){var R;let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]&&arguments[10],f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,D=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,V=arguments.length>13?arguments[13]:void 0,H=arguments.length>14?arguments[14]:void 0;super(q),this.onLoadObservable=new E.d,this.boundingBoxPosition=F.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new F.d,this._buffer=null,this.name=N,this.url=N,this._noMipmap=v,this.Fe=!1,this.isCube=!0,this._textureMatrix=F.d.Identity(),this.coordinatesMode=A.c.CUBIC_MODE;let Y=null,T=null;null===z||Array.isArray(z)?(this._noMipmap=v,this._format=t,this._createPolynomials=b,Y=z,this._loaderOptions=V,this._useSRGBBuffer=H,this._lodScale=f,this._lodOffset=D):(Y=z.extensions??null,this._noMipmap=z.noMipmap??!1,B=z.files??null,T=z.buffer??null,this._format=z.format??5,x=z.prefiltered??!1,e=z.forcedExtension??null,this._createPolynomials=z.createPolynomials??!1,this._lodScale=z.lodScale??.8,this._lodOffset=z.lodOffset??0,this._loaderOptions=z.loaderOptions,this._useSRGBBuffer=z.useSRGBBuffer,S=z.X??null,y=z.onError??null),(N||B)&&this.updateURL(N,e,S,x,y,Y,null===(R=this.va())||void 0===R?void 0:R.useDelayedTextureLoading,B,T)}getClassName(){return"CubeTexture"}updateURL(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=N),this.url=N,q&&(this._forcedExtension=q);const y=N.lastIndexOf("."),E=q||(y>-1?N.substring(y).toLowerCase():""),t=0===E.indexOf(".dds"),x=0===E.indexOf(".env"),e=0===E.indexOf(".basis");if(x?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=z,z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),S)this._files=S;else if(e||x||t||B||(B=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,B){for(let q=0;q<B.length;q++)this._files.push(N+B[q]);this._extensions=B}this._buffer=A,F?(this.delayLoadState=4,this._delayedOnLoad=R,this._delayedOnError=v):this._loadTexture(R,v)}delayLoad(N){4===this.delayLoadState&&(N&&(this._forcedExtension=N),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(N){var q,R;if(N.updateFlag===this._textureMatrix.updateFlag)return;N.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(R=this.va())||void 0===R||R.markAllMaterialsAsDirty(1,(N=>-1!==N.getActiveTextures().indexOf(this))));if(this._textureMatrix=N,null===(q=this.va())||void 0===q||!q.useRightHandedSystem)return;const z=F.k.o[0],v=F.k.Quaternion[0],B=F.k.o[1];this._textureMatrix.decompose(z,v,B),v.z*=-1,v.w*=-1,F.d.ComposeToRef(z,v,B,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var N;return null!==(N=this.va())&&void 0!==N&&N.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this.va(),z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const v=()=>{var q;(this.onLoadObservable.notifyObservers(this),z)&&(z.dispose(),null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1));N&&N()},F=(N,R)=>{this._loadingError=!0,this._errorObject={message:N,exception:R},q&&q(N,R),A.c.OnTextureLoadErrorObservable.notifyObservers(this)};var S;this._texture?this._texture.isReady?B.f.SetImmediate((()=>v())):this._texture.onLoadedObservable.add((()=>v())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,R,this._lodScale,this._lodOffset,N,F,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,R,this._files,this._noMipmap,N,F,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(S=this._texture)||void 0===S||S.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(N,q,R){const z=t.e.Parse((()=>{let z=!1;return N.prefiltered&&(z=N.prefiltered),new x(R+(N.url??N.name),q,N.extensions,!1,N.files||null,null,null,void 0,z,N.forcedExtension)}),N,q);if(N.boundingBoxPosition&&(z.boundingBoxPosition=F.m.Zg(N.boundingBoxPosition)),N.boundingBoxSize&&(z.boundingBoxSize=F.m.Zg(N.boundingBoxSize)),N.animations)for(let v=0;v<N.animations.length;v++){const q=N.animations[v],R=(0,y.c)("BABYLON.Animation");R&&z.animations.push(R.Parse(q))}return z}clone(){let N=0;const q=t.e.Clone((()=>{const q=new x(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return N=q.uniqueId,q}),this);return q.uniqueId=N,q}}(0,z.c)([(0,v.D)()],x.prototype,"url",void 0),(0,z.c)([(0,v.C)()],x.prototype,"boundingBoxPosition",void 0),(0,z.c)([(0,v.C)()],x.prototype,"boundingBoxSize",null),(0,z.c)([(0,v.D)("rotationY")],x.prototype,"rotationY",null),(0,z.c)([(0,v.D)("files")],x.prototype,"_files",void 0),(0,z.c)([(0,v.D)("forcedExtension")],x.prototype,"_forcedExtension",void 0),(0,z.c)([(0,v.D)("extensions")],x.prototype,"_extensions",void 0),(0,z.c)([(0,v.q)("textureMatrix")],x.prototype,"_textureMatrix",void 0),(0,z.c)([(0,v.q)("textureMatrixRefraction")],x.prototype,"_textureMatrixRefraction",void 0),A.c._CubeTextureParser=x.Parse,(0,y.f)("BABYLON.CubeTexture",x)},12560:(N,q,R)=>{"use strict";R.d(q,{e:()=>A});var z=R(10907),v=R(11402),B=R(11013),F=R(11614),S=R(10985);F.ThinEngine.prototype.createDynamicTexture=function(N,q,R,z){const v=new S.c(this,4);return v.baseWidth=N,v.baseHeight=q,R&&(N=this.needPOTTextures?(0,B.f)(N,this._caps.maxTextureSize):N,q=this.needPOTTextures?(0,B.f)(q,this._caps.maxTextureSize):q),v.width=N,v.height=q,v.isReady=!1,v.generateMipMaps=R,v.samplingMode=z,this.updateTextureSamplingMode(z,v),this._internalTexturesCache.push(v),v},F.ThinEngine.prototype.updateDynamicTexture=function(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!N)return;const F=this._gl,S=F.TEXTURE_2D,A=this._bindTextureDirectly(S,N,!0,B);this._unpackFlipY(void 0===R?N.invertY:R),z&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const y=this._getWebGLTextureType(N.type),E=this._getInternalFormat(v||N.format),t=this._getRGBABufferInternalSizedFormat(N.type,E);F.texImage2D(S,0,t,E,y,q),N.generateMipMaps&&F.generateMipmap(S),A||this._bindTextureDirectly(S,null),z&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),v&&(N.format=v),N._dynamicTextureSource=q,N._premulAlpha=z,N.invertY=R||!1,N.isReady=!0};class A extends v.c{constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,S=arguments.length>6?arguments[6]:void 0;const A=!R||R._isScene;super(null,A?R:null===R||void 0===R?void 0:R.Xd,A?!z:R,S,B,void 0,void 0,void 0,void 0,F),this.name=N,this.wrapU=v.c.CLAMP_ADDRESSMODE,this.wrapV=v.c.CLAMP_ADDRESSMODE,this._generateMipMaps=z;const y=this._getEngine();if(!y)return;if(q.getContext)this._canvas=q,this._ownCanvas=!1,this._texture=y.createDynamicTexture(this._canvas.width,this._canvas.height,z,B);else{this._canvas=y.createCanvas(1,1),this._ownCanvas=!0;const N=q;N.width||0===N.width?this._texture=y.createDynamicTexture(N.width,N.height,z,B):this._texture=y.createDynamicTexture(q,q,z,B)}const E=this.getSize();this._canvas.width!==E.width&&(this._canvas.width=E.width),this._canvas.height!==E.height&&(this._canvas.height=E.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(N){this._canvas.width=N.width,this._canvas.height=N.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(N.width,N.height,this._generateMipMaps,this.samplingMode)}scale(N){const q=this.getSize();q.width*=N,q.height*=N,this._recreate(q)}scaleTo(N,q){const R=this.getSize();R.width=N,R.height=q,this._recreate(R)}getContext(){return this._context}clear(N){const q=this.getSize();N&&(this._context.fillStyle=N),this._context.clearRect(0,0,q.width,q.height)}update(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===N||N,q,this._format||void 0,void 0,R)}drawText(N,q,R,z,v,B,F){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const A=this.getSize();if(B&&(this._context.fillStyle=B,this._context.fillRect(0,0,A.width,A.height)),this._context.font=z,null===q||void 0===q){const R=this._context.measureText(N);q=(A.width-R.width)/2}if(null===R||void 0===R){const N=parseInt(z.replace(/\D/g,""));R=A.height/2+N/3.65}this._context.fillStyle=v||"",this._context.fillText(N,q,R),S&&this.update(F)}dispose(){var N,q;(super.dispose(),this._ownCanvas)&&(null===(N=this._canvas)||void 0===N||null===(q=N.remove)||void 0===q||q.call(N));this._canvas=null,this._context=null}clone(){const N=this.va();if(!N)return this;const q=this.getSize(),R=new A(this.name,q,N,this._generateMipMaps);return R.Fe=this.Fe,R.level=this.level,R.wrapU=this.wrapU,R.wrapV=this.wrapV,R}serialize(){const N=this.va();N&&!N.isReady()&&z.c.Warn("The scene must be ready before serializing the dynamic texture");const q=super.serialize();return A._IsCanvasElement(this._canvas)&&(q.base64String=this._canvas.toDataURL()),q.invertY=this._invertY,q.samplingMode=this.samplingMode,q}static _IsCanvasElement(N){return void 0!==N.toDataURL}_rebuild(){this.update()}}},10985:(N,q,R)=>{"use strict";R.d(q,{c:()=>F});var z,v=R(10893),B=R(10987);!function(N){N[N.Unknown=0]="Unknown",N[N.Url=1]="Url",N[N.Temp=2]="Temp",N[N.Raw=3]="Raw",N[N.Dynamic=4]="Dynamic",N[N.RenderTarget=5]="RenderTarget",N[N.MultiRenderTarget=6]="MultiRenderTarget",N[N.Cube=7]="Cube",N[N.CubeRaw=8]="CubeRaw",N[N.CubePrefiltered=9]="CubePrefiltered",N[N.Raw3D=10]="Raw3D",N[N.Raw2DArray=11]="Raw2DArray",N[N.DepthStencil=12]="DepthStencil",N[N.CubeRawRGBD=13]="CubeRawRGBD",N[N.Depth=14]="Depth"}(z||(z={}));class F extends B.b{get useMipMaps(){return this.generateMipMaps}set useMipMaps(N){this.generateMipMaps=N}get uniqueId(){return this._uniqueId}_setUniqueId(N){this._uniqueId=N}getEngine(){return this._engine}get source(){return this._source}constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new v.d,this.onErrorObservable=new v.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=N,this._source=q,this._uniqueId=F._Counter++,R||(this._hardwareTexture=N._createHardwareTexture())}incrementReferences(){this._references++}updateSize(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,N,q,R),this.width=N,this.height=q,this.depth=R,this.baseWidth=N,this.baseHeight=q,this.baseDepth=R,this._size=N*q*R}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const N=this.onRebuildCallback(this),q=q=>{q._swapAndDie(this,!1),this.isReady=N.isReady};return void(N.isAsync?N.proxy.then(q):q(N.proxy))}let N;switch(this.source){case 2:case 12:case 14:break;case 1:return void(N=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(N=>{N._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:N=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),N._swapAndDie(this,!1),this.isReady=!0;break;case 10:N=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),N._swapAndDie(this,!1),this.isReady=!0;break;case 11:N=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),N._swapAndDie(this,!1),this.isReady=!0;break;case 4:N=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),N._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(N=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{N._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:N=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),N._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return N=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(N=>{N&&N._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(N._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(N){var q;let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(q=this._hardwareTexture)||void 0===q||q.setUsage(N._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),N._hardwareTexture=this._hardwareTexture,R&&(N._isRGBD=this._isRGBD),this._lodTextureHigh&&(N._lodTextureHigh&&N._lodTextureHigh.dispose(),N._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(N._lodTextureMid&&N._lodTextureMid.dispose(),N._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(N._lodTextureLow&&N._lodTextureLow.dispose(),N._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(N._irradianceTexture&&N._irradianceTexture.dispose(),N._irradianceTexture=this._irradianceTexture);const z=this._engine.getLoadedTexturesCache();let v=z.indexOf(this);-1!==v&&z.splice(v,1),v=z.indexOf(N),-1===v&&z.push(N)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}F._Counter=0},11642:(N,q,R)=>{"use strict";R.d(q,{e:()=>v});var z=R(11402);class v extends z.c{constructor(N,q,R,v,B){let F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,E=arguments.length>9?arguments[9]:void 0,t=arguments.length>10?arguments[10]:void 0;super(null,B,!F,S,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,E),this.format=v,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==y||(A=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==y||(A=1),this._texture=this._engine.createRawTexture(N,q,R,v,F,S,A,null,y,E??0,t??!1),this.wrapU=z.c.CLAMP_ADDRESSMODE,this.wrapV=z.c.CLAMP_ADDRESSMODE)}update(N){this._getEngine().updateRawTexture(this._texture,N,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const N=new v(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return N._texture=this._texture,this._texture.incrementReferences(),N}static CreateLuminanceTexture(N,q,R,z){return new v(N,q,R,1,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(N,q,R,z){return new v(N,q,R,2,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(N,q,R,z){return new v(N,q,R,0,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(N,q,R,z){return new v(N,q,R,4,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(N,q,R,z){return new v(N,q,R,5,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(N,q,R,z){return new v(N,q,R,5,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(N,q,R,B){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.c.TRILINEAR_SAMPLINGMODE;return new v(N,q,R,6,B,F,S,A,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(N,q,R,B){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.c.TRILINEAR_SAMPLINGMODE;return new v(N,q,R,6,B,F,S,A,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11987:(N,q,R)=>{"use strict";R.d(q,{e:()=>v});var z=R(11402);class v extends z.c{get depth(){return this._depth}constructor(N,q,R,v,B,F){let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7],y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:z.c.TRILINEAR_SAMPLINGMODE,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,t=arguments.length>10?arguments[10]:void 0;super(null,F,!S,A),this.format=B,this._texture=F.getEngine().createRawTexture2DArray(N,q,R,v,B,S,A,y,null,E,t),this._depth=v,this.is2DArray=!0}update(N){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,N,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(N,q,R,z,B){return new v(N,q,R,z,5,B,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11711:(N,q,R)=>{"use strict";R.d(q,{d:()=>x});var z=R(10893),v=R(11181),B=R(11402),F=R(11264),S=R(11273),A=R(11190),y=R(11013),E=R(10964),t=R(10907);E.d.prototype.setDepthStencilTexture=function(N,q){this._engine.setDepthStencilTexture(this._samplers[N],this._uniforms[N],q,N)};class x extends B.c{get renderList(){return this._renderList}set renderList(N){this._renderList!==N&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),N&&(this._unObserveRenderList=(0,A.i)(N,this._renderListHasChanged)),this._renderList=N)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(N){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(N)}set onBeforeRender(N){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(N)}set onAfterRender(N){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(N)}set onClear(N){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(N)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(N,q){let R;R=Array.isArray(N)?N:[N];for(let z=0;z<R.length;++z)for(let N=0;N<this._renderPassIds.length;++N)R[z].setMaterialForRenderPass(this._renderPassIds[N],void 0!==q?Array.isArray(q)?q[N]:q:void 0)}get isMulti(){var N;return(null===(N=this._renderTarget)||void 0===N?void 0:N.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(N){if(this._boundingBoxSize&&this._boundingBoxSize.equals(N))return;this._boundingBoxSize=N;const q=this.va();q&&q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var N;return(null===(N=this._renderTarget)||void 0===N?void 0:N._depthStencilTexture)??null}constructor(N,q,R){let F,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:B.c.TRILINEAR_SAMPLINGMODE,e=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],b=arguments.length>9&&void 0!==arguments[9]&&arguments[9],f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,V=arguments.length>12&&void 0!==arguments[12]&&arguments[12],H=arguments.length>13?arguments[13]:void 0,Y=arguments.length>14?arguments[14]:void 0,T=arguments.length>15&&void 0!==arguments[15]&&arguments[15],L=arguments.length>16&&void 0!==arguments[16]&&arguments[16],X=!0;if("object"===typeof A){const N=A;A=!!N.generateMipMaps,y=N.doNotChangeAspectRatio??!0,E=N.type??0,t=!!N.isCube,x=N.samplingMode??B.c.TRILINEAR_SAMPLINGMODE,e=N.generateDepthBuffer??!0,b=!!N.generateStencilBuffer,f=!!N.isMulti,D=N.format??5,V=!!N.delayAllocation,H=N.samples,Y=N.creationFlags,T=!!N.noColorAttachment,L=!!N.useSRGBBuffer,F=N.colorAttachment,X=N.gammaSpace??X}if(super(null,R,!A,void 0,x,void 0,void 0,void 0,void 0,D),this._unObserveRenderList=null,this._renderListHasChanged=(N,q)=>{const R=this._renderList?this._renderList.length:0;var z;(0===q&&R>0||0===R)&&(null===(z=this.va())||void 0===z||z.meshes.forEach((N=>{N._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new z.d,this.onAfterUnbindObservable=new z.d,this.onBeforeRenderObservable=new z.d,this.onAfterRenderObservable=new z.d,this.onClearObservable=new z.d,this.onResizeObservable=new z.d,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=v.m.Zero(),this._dumpToolsLoading=!1,!(R=this.va()))return;const Q=this.va().getEngine();this._gammaSpace=X,this._coordinatesMode=B.c.PROJECTION_MODE,this.renderList=[],this.name=N,this.isRenderTarget=!0,this._initialSizeParameter=q,this._renderPassIds=[],this._isCubeData=t,this._processSizeParameter(q),this.renderPassId=this._renderPassIds[0],this._resizeObserver=Q.onResizeObservable.add((()=>{})),this._generateMipMaps=!!A,this._doNotChangeAspectRatio=y,this._renderingManager=new S.d(R),this._renderingManager._useSceneAutoClearSetup=!0,f||(this._renderTargetOptions={generateMipMaps:A,type:E,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:e,generateStencilBuffer:b,samples:H,creationFlags:Y,noColorAttachment:T,useSRGBBuffer:L,colorAttachment:F,label:this.name},this.samplingMode===B.c.NEAREST_SAMPLINGMODE&&(this.wrapU=B.c.CLAMP_ADDRESSMODE,this.wrapV=B.c.CLAMP_ADDRESSMODE),V||(t?(this._renderTarget=R.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=B.c.INVCUBIC_MODE,this._textureMatrix=v.d.Identity()):this._renderTarget=R.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==H&&(this.samples=H)))}createDepthStencilTexture(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,F=arguments.length>5?arguments[5]:void 0;null===(N=this._renderTarget)||void 0===N||N.createDepthStencilTexture(q,R,z,v,B,F)}_releaseRenderPassId(){if(this._scene){const N=this._scene.getEngine();for(let q=0;q<this._renderPassIds.length;++q)N.releaseRenderPassId(this._renderPassIds[q])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const N=this._scene.getEngine(),q=this._isCubeData?6:this.getRenderLayers()||1;for(let R=0;R<q;++R)this._renderPassIds[R]=N.createRenderPassId(`RenderTargetTexture - ${this.name}#${R}`)}_processSizeParameter(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N.ratio){this._sizeRatio=N.ratio;const q=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(q.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(q.getRenderHeight(),this._sizeRatio)}}else this._size=N;q&&this._createRenderPassId()}get samples(){var N;return(null===(N=this._renderTarget)||void 0===N?void 0:N.samples)??this._samples}set samples(N){this._renderTarget&&(this._samples=this._renderTarget.setSamples(N))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(N){this._refreshRate=N,this.resetRefreshCounter()}addPostProcess(N){if(!this._postProcessManager){const N=this.va();if(!N)return;this._postProcessManager=new F.e(N),this._postProcesses=new Array}this._postProcesses.push(N),this._postProcesses[0].Ti=!1}clearPostProcesses(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(N)for(const N of this._postProcesses)N.dispose();this._postProcesses=[]}}removePostProcess(N){if(!this._postProcesses)return;const q=this._postProcesses.indexOf(N);-1!==q&&(this._postProcesses.splice(q,1),this._postProcesses.length>0&&(this._postProcesses[0].Ti=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const N=this._size.layers;if(N)return N;const q=this._size.depth;return q||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(N){const q=Math.max(1,this.getRenderSize()*N);this.resize(q)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(N){var q;const R=this.isCube;null===(q=this._renderTarget)||void 0===q||q.dispose(),this._renderTarget=null;const z=this.va();z&&(this._processSizeParameter(N,!1),this._renderTarget=R?z.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):z.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(N,q)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(R.bind(R,12151)).then((N=>this._dumpTools=N))),this._render(!1,!1,!0)}_render(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this.va();if(!z)return R;const v=z.getEngine();if(void 0!==this.useCameraPostProcesses&&(N=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let N=0;N<this._waitingRenderList.length;N++){const q=this._waitingRenderList[N],R=z.getMeshById(q);R&&this.renderList.push(R)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const N=this.va();if(!N)return R;const q=N.meshes;for(let R=0;R<q.length;R++){const N=q[R];this.renderListPredicate(N)&&this.renderList.push(N)}}const B=v.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const F=this.activeCamera??z.activeCamera,S=z.activeCamera;F&&(F!==z.activeCamera&&(z.setTransformMatrix(F.getViewMatrix(),F.getProjectionMatrix(!0)),z.activeCamera=F),v.setViewport(F.rigParent?F.rigParent.viewport:F.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let A=R;if(R){z.getViewMatrix()||z.updateTransformMatrix();const N=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let B=0;B<N&&A;B++){let N=null;const q=this.renderList?this.renderList:z.getActiveMeshes().data,F=this.renderList?this.renderList.length:z.getActiveMeshes().length;v.currentRenderPassId=this._renderPassIds[B],this.onBeforeRenderObservable.notifyObservers(B),this.getCustomRenderList&&(N=this.getCustomRenderList(B,q,F)),N||(N=q),this._doNotChangeAspectRatio||z.updateTransformMatrix(!0);for(let z=0;z<N.length&&A;++z){const q=N[z];if(q.isEnabled()&&!q.isBlocked&&q.isVisible&&q.lg)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(q,this.refreshRate,R)){A=!1;continue}}else if(!q.isReady(!0)){A=!1;continue}}this.onAfterRenderObservable.notifyObservers(B),(this.is2DArray||this.is3D||this.isCube)&&(z.incrementRenderId(),z.resetCachedMaterial())}const q=this.particleSystemList||z.qj;for(const R of q)R.isReady()||(A=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let y=0;y<6;y++)this._renderToTarget(y,N,q,void 0,F),z.incrementRenderId(),z.resetCachedMaterial();else this._renderToTarget(0,N,q,void 0,F);else for(let y=0;y<this.getRenderLayers();y++)this._renderToTarget(0,N,q,y,F),z.incrementRenderId(),z.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),v.currentRenderPassId=B,z.activeCamera=S,S&&(this.activeCamera&&this.activeCamera!==z.activeCamera&&z.setTransformMatrix(S.getViewMatrix(),S.getProjectionMatrix(!0)),v.setViewport(S.viewport)),z.resetCachedMaterial(),A}_bestReflectionRenderTargetDimension(N,q){const R=N*q,z=(0,y.p)(R+16384/(128+R));return Math.min((0,y.b)(N),z)}_prepareRenderingManager(N,q,R,z){const v=this.va();if(!v)return;this._renderingManager.reset();const B=v.getRenderId();for(let S=0;S<q;S++){const q=N[S];if(q&&!q.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(q,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!q.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!q._internalAbstractMeshDataInfo._currentLODIsUpToDate&&R&&(q._internalAbstractMeshDataInfo._currentLOD=v.customLODSelector?v.customLODSelector(q,R):q.getLOD(R),q._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!q._internalAbstractMeshDataInfo._currentLOD)continue;let N,F=q._internalAbstractMeshDataInfo._currentLOD;if(F!==q&&0!==F.billboardMode&&F.Oj(),F._preActivateForIntermediateRendering(B),N=!(!z||!R)&&0===(q.layerMask&R.layerMask),q.isEnabled()&&q.isVisible&&q.lg&&!N){if(F!==q&&F._activate(B,!0),q._activate(B,!0)&&q.lg.length){q.isAnInstance?q._internalAbstractMeshDataInfo._actAsRegularMesh&&(F=q):F._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,F._internalAbstractMeshDataInfo._isActiveIntermediate=!0,v._prepareSkeleton(F);for(let N=0;N<F.lg.length;N++){const q=F.lg[N];this._renderingManager.dispatch(q,F)}}q._postActivate()}}}const F=this.particleSystemList||v.qj;for(let S=0;S<F.length;S++){const N=F[S],q=N.j;N.isStarted()&&q&&(!q.position||q.isEnabled())&&this._renderingManager.dispatchParticles(N)}}_bindFrameBuffer(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.va();if(!R)return;const z=R.getEngine();this._renderTarget&&z.bindFramebuffer(this._renderTarget,this.isCube?N:void 0,void 0,void 0,this.ignoreCameraViewport,0,q)}_unbindFrameBuffer(N,q){this._renderTarget&&N.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(q)}))}_prepareFrame(N,q,R,z){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):z&&N.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(q,R)}_renderToTarget(N,q,R){var z,v;let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=this.va();if(!S)return;const A=S.getEngine();this._prepareFrame(S,N,B,q),null===(z=A._debugPushGroup)||void 0===z||z.call(A,`render to face #${N} layer #${B}`,2),this.is2DArray||this.is3D?(A.currentRenderPassId=this._renderPassIds[B],this.onBeforeRenderObservable.notifyObservers(B)):(A.currentRenderPassId=this._renderPassIds[N],this.onBeforeRenderObservable.notifyObservers(N));if(A.snapshotRendering&&1===A.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(A):this.skipInitialClear||A.clear(this.clearColor||S.clearColor,!0,!0,!0);else{var y;let z=null;const v=this.renderList?this.renderList:S.getActiveMeshes().data,E=this.renderList?this.renderList.length:S.getActiveMeshes().length;this.getCustomRenderList&&(z=this.getCustomRenderList(this.is2DArray||this.is3D?B:N,v,E)),z?this._prepareRenderingManager(z,z.length,F,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(v,E,F,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),z=v);for(const q of S._beforeRenderTargetClearStage)q.action(this,N,B);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(A):this.skipInitialClear||A.clear(this.clearColor||S.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||S.updateTransformMatrix(!0);for(const q of S._beforeRenderTargetDrawStage)q.action(this,N,B);this._renderingManager.render(this.customRenderFunction,z,this.renderParticles,this.renderSprites);for(const q of S._afterRenderTargetDrawStage)q.action(this,N,B);const x=(null===(y=this._texture)||void 0===y?void 0:y.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,N,this._postProcesses,this.ignoreCameraViewport):q&&S.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,N);for(const q of S._afterRenderTargetPostProcessStage)q.action(this,N,B);this._texture&&(this._texture.generateMipMaps=x),this._doNotChangeAspectRatio||S.updateTransformMatrix(!0),R&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),A):t.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(v=A._debugPopGroup)||void 0===v||v.call(A,2),this._unbindFrameBuffer(A,N),this._texture&&this.isCube&&5===N&&A.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(N,q,R,z)}setRenderingAutoClearDepthStencil(N,q){this._renderingManager.setRenderingAutoClearDepthStencil(N,q),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const N=this.getSize(),q=new x(this.name,N,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return q.Fe=this.Fe,q.level=this.level,q.coordinatesMode=this.coordinatesMode,this.renderList&&(q.renderList=this.renderList.slice(0)),q}serialize(){if(!this.name)return null;const N=super.serialize();if(N.renderTargetSize=this.getRenderSize(),N.renderList=[],this.renderList)for(let q=0;q<this.renderList.length;q++)N.renderList.push(this.renderList[q].id);return N}disposeFramebufferObjects(){var N;null===(N=this._renderTarget)||void 0===N||N.dispose(!0)}releaseInternalTexture(){var N;null===(N=this._renderTarget)||void 0===N||N.releaseTextures(),this._texture=null}dispose(){var N;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const q=this.va();if(!q)return;let R=q.customRenderTargets.indexOf(this);R>=0&&q.customRenderTargets.splice(R,1);for(const z of q.cameras)R=z.customRenderTargets.indexOf(this),R>=0&&z.customRenderTargets.splice(R,1);null===(N=this._renderTarget)||void 0===N||N.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===x.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=x.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}x.REFRESHRATE_RENDER_ONCE=0,x.REFRESHRATE_RENDER_ONEVERYFRAME=1,x.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,B.c._CreateRenderTargetTexture=(N,q,R,z,v)=>new x(N,q,R,z)},11402:(N,q,R)=>{"use strict";R.d(q,{c:()=>Y});var z=R(11147),v=R(11151),B=R(10893),F=R(11181),S=R(11407),A=R(11002),y=R(10923),E=R(10955),t=R(11e3),x=R(11313),e=R(10945);function b(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=q.width,v=q.height;if(N instanceof Float32Array){let q=N.byteLength/N.BYTES_PER_ELEMENT;const R=new Uint8Array(q);for(;--q>=0;){let z=N[q];z<0?z=0:z>1&&(z=1),R[q]=255*z}N=R}const B=document.createElement("canvas");B.width=z,B.height=v;const F=B.getContext("2d");if(!F)return null;const S=F.createImageData(z,v);if(S.data.set(N),F.putImageData(S,0,0),R){const N=document.createElement("canvas");N.width=z,N.height=v;const q=N.getContext("2d");return q?(q.translate(0,v),q.scale(1,-1),q.drawImage(B,0,0),N.toDataURL("image/png")):null}return B.toDataURL("image/png")}function f(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=N.getInternalTexture();if(!z)return null;const v=N._readPixelsSync(q,R);return v?b(v,N.getSize(),z.invertY):null}async function D(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=N.getInternalTexture();if(!z)return null;const v=await N.readPixels(q,R);return v?b(v,N.getSize(),z.invertY):null}var V=R(11414),H=R(11221);class Y extends S.c{static _CreateVideoTexture(N,q,R){arguments.length>5&&void 0!==arguments[5]||Y.TRILINEAR_SAMPLINGMODE;throw(0,y.b)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(N){this._isBlocking=N}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(N,q,R,z){let v,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Y.TRILINEAR_SAMPLINGMODE,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9?arguments[9]:void 0,e=arguments.length>10?arguments[10]:void 0,b=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,D=arguments.length>13?arguments[13]:void 0;super(q),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new B.d,this._isBlocking=!0,this.name=N||"",this.url=N;let H=!1,T=null,L=!0;"object"===typeof R&&null!==R?(v=R.noMipmap??!1,z=R.invertY??!V.b,F=R.samplingMode??Y.TRILINEAR_SAMPLINGMODE,S=R.X??null,A=R.onError??null,y=R.buffer??null,t=R.deleteBuffer??!1,x=R.format,e=R.mimeType,b=R.loaderOptions,f=R.creationFlags,H=R.useSRGBBuffer??!1,T=R.internalTexture??null,L=R.gammaSpace??L):v=!!R,this._gammaSpace=L,this._noMipmap=v,this._invertY=void 0===z?!V.b:z,this._initialSamplingMode=F,this._buffer=y,this._deleteBuffer=t,this._mimeType=e,this._loaderOptions=b,this._creationFlags=f,this._useSRGBBuffer=H,this._forcedExtension=D,x&&(this._format=x);const X=this.va(),Q=this._getEngine();if(!Q)return;Q.onBeforeTextureInitObservable.notifyObservers(this);const h=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),S&&S(),!this.isBlocking&&X&&X.resetCachedMaterial()},u=(N,q)=>{this._loadingError=!0,this._errorObject={message:N,exception:q},A&&A(N,q),Y.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!T)return this._delayedOnLoad=h,void(this._delayedOnError=u);if(this._texture=T??this._getFromCache(this.url,v,F,this._invertY,H,this.isCube),this._texture)if(this._texture.isReady)E.d.SetImmediate((()=>h()));else{const N=this._texture.onLoadedObservable.add(h);this._texture.onErrorObservable.add((q=>{var R;u(q.message,q.exception),null===(R=this._texture)||void 0===R||R.onLoadedObservable.remove(N)}))}else if(X&&X.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=h,this._delayedOnError=u;else{try{this._texture=Q.createTexture(this.url,v,this._invertY,X,F,h,u,this._buffer,void 0,this._format,this._forcedExtension,e,b,f,H)}catch(w){throw u("error loading",w),w}t&&(this._buffer=null)}}updateURL(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(N=>N.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=N),this.url=N,this._buffer=q,this._forcedExtension=z,this.delayLoadState=4,R&&(this._delayedOnLoad=R),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const N=this.va();N&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?E.d.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=N.getEngine().createTexture(this.url,this._noMipmap,this._invertY,N,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(N,q,R,z){N*=this._cachedUScale,q*=this._cachedVScale,N-=this.uRotationCenter*this._cachedUScale,q-=this.vRotationCenter*this._cachedVScale,R-=this.wRotationCenter,F.m.TransformCoordinatesFromFloatsToRef(N,q,R,this._rowGenerationMatrix,z),z.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,z.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,z.z+=this.wRotationCenter}getTextureMatrix(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*N===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*N,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=F.d.Zero(),this._rowGenerationMatrix=new F.d,this._t0=F.m.Zero(),this._t1=F.m.Zero(),this._t2=F.m.Zero()),F.d.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(F.d.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,F.k.Matrix[0]),F.d.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,F.k.Matrix[1]),F.d.ScalingToRef(this._cachedUScale,this._cachedVScale,0,F.k.Matrix[2]),F.d.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,F.k.Matrix[3]),F.k.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(F.k.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(F.k.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(F.k.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.pi(this._t0),this._t2.pi(this._t0),F.d.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const q=this.va();if(!q)return this._cachedTextureMatrix;const R=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&R!==this._cachedIdentity3x2&&q.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const N=this.va();if(!N)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==Y.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===N.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=F.d.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=F.d.Zero());const q=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case Y.PLANAR_MODE:F.d.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case Y.PROJECTION_MODE:{F.d.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const q=N.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=q.updateFlag,q.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:F.d.IdentityToRef(this._cachedReflectionTextureMatrix)}return q&&N.markAllMaterialsAsDirty(1,(N=>N.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const N={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return H.e.Clone((()=>new Y(this._texture?this._texture.url:null,this.va(),N)),this)}serialize(){var N;const q=this.name;Y.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const R=super.serialize(Y._SerializeInternalTextureUniqueId);if(!R)return null;var z;((Y.SerializeBuffers||Y.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(R.base64String=this._buffer,R.name=R.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?R.base64String="data:image/png;base64,"+(0,e.p)(this._buffer):(Y.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(R.base64String=!this._engine||this._engine._features.supportSyncTextureRead?f(this):D(this))),R.invertY=this._invertY,R.samplingMode=this.samplingMode,R._creationFlags=this._creationFlags,R._useSRGBBuffer=this._useSRGBBuffer,Y._SerializeInternalTextureUniqueId)&&(R.internalTextureUniqueId=null===(z=this._texture)||void 0===z?void 0:z.uniqueId);return R.internalTextureLabel=null===(N=this._texture)||void 0===N?void 0:N.label,R.noMipmap=this._noMipmap,this.name=q,R}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(N,q,R){if(N.customType){const z=t.b.Instantiate(N.customType).Parse(N,q,R);return N.samplingMode&&z.updateSamplingMode&&z._samplingMode&&z._samplingMode!==N.samplingMode&&z.updateSamplingMode(N.samplingMode),z}if(N.isCube&&!N.isRenderTarget)return Y._CubeTextureParser(N,q,R);const z=void 0!==N.internalTextureUniqueId;if(!N.name&&!N.isRenderTarget&&!z)return null;let v;if(z){const R=q.getEngine().getLoadedTexturesCache();for(const q of R)if(q.uniqueId===N.internalTextureUniqueId){v=q;break}}const B=q=>{if(q&&q._texture&&(q._texture._cachedWrapU=null,q._texture._cachedWrapV=null,q._texture._cachedWrapR=null),N.samplingMode){const R=N.samplingMode;q&&q.samplingMode!==R&&q.updateSamplingMode(R)}if(q&&N.animations)for(let R=0;R<N.animations.length;R++){const z=N.animations[R],v=(0,A.c)("BABYLON.Animation");v&&q.animations.push(v.Parse(z))}q&&q._texture&&(z&&!v&&q._texture._setUniqueId(N.internalTextureUniqueId),q._texture.label=N.internalTextureLabel)};return H.e.Parse((()=>{let z=!0;if(N.noMipmap&&(z=!1),N.mirrorPlane){const R=Y._CreateMirror(N.name,N.renderTargetSize,q,z);return R._waitingRenderList=N.renderList,R.mirrorPlane=x.e.Zg(N.mirrorPlane),B(R),R}if(N.isRenderTarget){let R=null;if(N.isCube){if(q.reflectionProbes)for(let z=0;z<q.reflectionProbes.length;z++){const R=q.reflectionProbes[z];if(R.name===N.name)return R.cubeTexture}}else R=Y._CreateRenderTargetTexture(N.name,N.renderTargetSize,q,z,N._creationFlags??0),R._waitingRenderList=N.renderList;return B(R),R}if(N.isVideo){const v=Y._CreateVideoTexture(R+(N.url||N.name),R+(N.src||N.url),q,z,N.invertY,N.samplingMode,N.settings||{});return B(v),v}{let F;if(N.base64String&&!v)F=Y.CreateFromBase64String(N.base64String,N.base64String,q,!z,N.invertY,N.samplingMode,(()=>{B(F)}),N._creationFlags??0,N._useSRGBBuffer??!1),F.name=N.name;else{let S;S=N.name&&(N.name.indexOf("://")>0||N.name.startsWith("data:"))?N.name:R+N.name,N.url&&(N.url.startsWith("data:")||Y.UseSerializedUrlIfAny)&&(S=N.url);const A={noMipmap:!z,invertY:N.invertY,samplingMode:N.samplingMode,X:()=>{B(F)},internalTexture:v};F=new Y(S,q,A)}return F}}),N,q)}static CreateFromBase64String(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Y.TRILINEAR_SAMPLINGMODE;return new Y("data:"+q,R,z,v,B,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Y.TRILINEAR_SAMPLINGMODE,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,E=arguments.length>10?arguments[10]:void 0,t=arguments.length>11?arguments[11]:void 0;return"data:"!==N.substring(0,5)&&(N="data:"+N),new Y(N,R,v,B,F,S,A,q,z,y,void 0,void 0,E,t)}}Y.SerializeBuffers=!0,Y.ForceSerializeBuffers=!1,Y.OnTextureLoadErrorObservable=new B.d,Y._SerializeInternalTextureUniqueId=!1,Y._CubeTextureParser=(N,q,R)=>{throw(0,y.b)("CubeTexture")},Y._CreateMirror=(N,q,R,z)=>{throw(0,y.b)("MirrorTexture")},Y._CreateRenderTargetTexture=(N,q,R,z,v)=>{throw(0,y.b)("RenderTargetTexture")},Y.NEAREST_SAMPLINGMODE=1,Y.NEAREST_NEAREST_MIPLINEAR=8,Y.BILINEAR_SAMPLINGMODE=2,Y.LINEAR_LINEAR_MIPNEAREST=11,Y.TRILINEAR_SAMPLINGMODE=3,Y.LINEAR_LINEAR_MIPLINEAR=3,Y.NEAREST_NEAREST_MIPNEAREST=4,Y.NEAREST_LINEAR_MIPNEAREST=5,Y.NEAREST_LINEAR_MIPLINEAR=6,Y.NEAREST_LINEAR=7,Y.NEAREST_NEAREST=1,Y.LINEAR_NEAREST_MIPNEAREST=9,Y.LINEAR_NEAREST_MIPLINEAR=10,Y.LINEAR_LINEAR=2,Y.LINEAR_NEAREST=12,Y.EXPLICIT_MODE=0,Y.SPHERICAL_MODE=1,Y.PLANAR_MODE=2,Y.CUBIC_MODE=3,Y.PROJECTION_MODE=4,Y.SKYBOX_MODE=5,Y.INVCUBIC_MODE=6,Y.EQUIRECTANGULAR_MODE=7,Y.FIXED_EQUIRECTANGULAR_MODE=8,Y.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Y.CLAMP_ADDRESSMODE=0,Y.WRAP_ADDRESSMODE=1,Y.MIRROR_ADDRESSMODE=2,Y.UseSerializedUrlIfAny=!1,(0,z.c)([(0,v.D)()],Y.prototype,"url",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"uOffset",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"vOffset",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"uScale",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"vScale",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"uAng",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"vAng",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"wAng",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"uRotationCenter",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"vRotationCenter",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"wRotationCenter",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"homogeneousRotationInUVTransform",void 0),(0,z.c)([(0,v.D)()],Y.prototype,"isBlocking",null),(0,A.f)("BABYLON.Texture",Y),H.e._TextureParser=Y.Parse},10987:(N,q,R)=>{"use strict";R.d(q,{b:()=>z});class z{get wrapU(){return this._cachedWrapU}set wrapU(N){this._cachedWrapU=N}get wrapV(){return this._cachedWrapV}set wrapV(N){this._cachedWrapV=N}get wrapR(){return this._cachedWrapR}set wrapR(N){this._cachedWrapR=N}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(N){this._cachedAnisotropicFilteringLevel=N}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(N){this._comparisonFunction=N}get useMipMaps(){return this._useMipMaps}set useMipMaps(N){this._useMipMaps=N}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=N,this._cachedWrapV=q,this._cachedWrapR=R,this._cachedAnisotropicFilteringLevel=z,this.samplingMode=v,this._comparisonFunction=B,this}compareSampler(N){return this._cachedWrapU===N._cachedWrapU&&this._cachedWrapV===N._cachedWrapV&&this._cachedWrapR===N._cachedWrapR&&this._cachedAnisotropicFilteringLevel===N._cachedAnisotropicFilteringLevel&&this.samplingMode===N.samplingMode&&this._comparisonFunction===N._comparisonFunction&&this._useMipMaps===N._useMipMaps}}},11386:(N,q,R)=>{"use strict";function z(N){-1===N.indexOf("vClipPlane")&&N.push("vClipPlane"),-1===N.indexOf("vClipPlane2")&&N.push("vClipPlane2"),-1===N.indexOf("vClipPlane3")&&N.push("vClipPlane3"),-1===N.indexOf("vClipPlane4")&&N.push("vClipPlane4"),-1===N.indexOf("vClipPlane5")&&N.push("vClipPlane5"),-1===N.indexOf("vClipPlane6")&&N.push("vClipPlane6")}function v(N,q,R){const z=!!(N.clipPlane??q.clipPlane),v=!!(N.clipPlane2??q.clipPlane2),B=!!(N.clipPlane3??q.clipPlane3),F=!!(N.clipPlane4??q.clipPlane4),S=!!(N.clipPlane5??q.clipPlane5),A=!!(N.clipPlane6??q.clipPlane6);z&&R.push("#define CLIPPLANE"),v&&R.push("#define CLIPPLANE2"),B&&R.push("#define CLIPPLANE3"),F&&R.push("#define CLIPPLANE4"),S&&R.push("#define CLIPPLANE5"),A&&R.push("#define CLIPPLANE6")}function B(N,q,R){let z=!1;const v=!!(N.clipPlane??q.clipPlane),B=!!(N.clipPlane2??q.clipPlane2),F=!!(N.clipPlane3??q.clipPlane3),S=!!(N.clipPlane4??q.clipPlane4),A=!!(N.clipPlane5??q.clipPlane5),y=!!(N.clipPlane6??q.clipPlane6);return R.CLIPPLANE!==v&&(R.CLIPPLANE=v,z=!0),R.CLIPPLANE2!==B&&(R.CLIPPLANE2=B,z=!0),R.CLIPPLANE3!==F&&(R.CLIPPLANE3=F,z=!0),R.CLIPPLANE4!==S&&(R.CLIPPLANE4=S,z=!0),R.CLIPPLANE5!==A&&(R.CLIPPLANE5=A,z=!0),R.CLIPPLANE6!==y&&(R.CLIPPLANE6=y,z=!0),z}function F(N,q,R){let z=q.clipPlane??R.clipPlane;S(N,"vClipPlane",z),z=q.clipPlane2??R.clipPlane2,S(N,"vClipPlane2",z),z=q.clipPlane3??R.clipPlane3,S(N,"vClipPlane3",z),z=q.clipPlane4??R.clipPlane4,S(N,"vClipPlane4",z),z=q.clipPlane5??R.clipPlane5,S(N,"vClipPlane5",z),z=q.clipPlane6??R.clipPlane6,S(N,"vClipPlane6",z)}function S(N,q,R){R&&N.setFloat4(q,R.k.x,R.k.y,R.k.z,R.d)}R.d(q,{c:()=>z,e:()=>F,f:()=>B,j:()=>v})},11229:(N,q,R)=>{"use strict";function z(N){N.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}R.d(q,{c:()=>z})},11622:(N,q,R)=>{"use strict";function z(N){return void 0===N.getPipelineContext}R.d(q,{b:()=>z})},11370:(N,q,R)=>{"use strict";R.d(q,{e:()=>z});class z{static GetEffect(N){return void 0===N.getPipelineContext?N.effect:N}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=N.createDrawContext(),q&&(this.materialContext=N.createMaterialContext())}setEffect(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var z;(this.effect=N,void 0!==q&&(this.defines=q),R)&&(null===(z=this.drawContext)||void 0===z||z.reset())}dispose(){var N;null===(N=this.drawContext)||void 0===N||N.dispose()}}},10968:(N,q,R)=>{"use strict";R.d(q,{d:()=>t,g:()=>e,i:()=>y,m:()=>E});var z=R(10900),v=R(10974),B=R(10966),F=R(10907),S=R(10949),A=R(10951);function y(N,q){return(0,v.v)(q).cachedPipelines[N]}function E(N){const q=N._name,R=N.context;if(q&&R){const N=(0,v.v)(R),z=N.cachedPipelines[q];null===z||void 0===z||z.dispose(),delete N.cachedPipelines[q]}}function t(N,q,R,v,B,F,A){let y,E;const t=(0,z.l)()?null===F||void 0===F?void 0:F.getHostDocument():null;y="string"===typeof q?q:q.vertexSource?"source:"+q.vertexSource:q.vertexElement?(null===t||void 0===t?void 0:t.getElementById(q.vertexElement))||q.vertexElement:q.vertex||q,E="string"===typeof q?q:q.fragmentSource?"source:"+q.fragmentSource:q.fragmentElement?(null===t||void 0===t?void 0:t.getElementById(q.fragmentElement))||q.fragmentElement:q.fragment||q;const e=[void 0,void 0],b=()=>{if(e[0]&&e[1]){N.isFragment=!0;const[z,y]=e;(0,S.e)(y,N,((F,y)=>{A&&(A._fragmentSourceCodeBeforeMigration=y),R&&(F=R("fragment",F));const E=(0,S.b)(z,F,N);N=null;const t=function(N,q,R,z){if(R){return{vertexSourceCode:(1===z?"//":"")+"#define SHADER_NAME vertex:"+(R.vertexElement||R.vertex||R.spectorName||R)+"\n"+N,fragmentSourceCode:(1===z?"//":"")+"#define SHADER_NAME fragment:"+(R.fragmentElement||R.fragment||R.spectorName||R)+"\n"+q}}return{vertexSourceCode:N,fragmentSourceCode:q}}(E.vertexCode,E.fragmentCode,q,B);null===v||void 0===v||v(t.vertexSourceCode,t.fragmentSourceCode)}),F)}};x(y,"Vertex","",(q=>{(0,S.c)(N),(0,S.e)(q,N,((N,z)=>{A&&(A._rawVertexSourceCode=q,A._vertexSourceCodeBeforeMigration=z),R&&(N=R("vertex",N)),e[0]=N,b()}),F)}),B),x(E,"Fragment","Pixel",(N=>{A&&(A._rawFragmentSourceCode=N),e[1]=N,b()}),B)}function x(N,q,R,v,F,S){if("undefined"!==typeof HTMLElement&&N instanceof HTMLElement){return void v((0,z.c)(N))}if("source:"===N.substring(0,7))return void v(N.substring(7));if("base64:"===N.substring(0,7)){return void v(window.atob(N.substring(7)))}const y=B.e.GetShadersStore(F);if(y[N+q+"Shader"])return void v(y[N+q+"Shader"]);if(R&&y[N+R+"Shader"])return void v(y[N+R+"Shader"]);let E;if(E="."===N[0]||"/"===N[0]||N.indexOf("http")>-1?N:B.e.GetShadersRepository(F)+N,!(S=S||A.m))throw new Error("loadFileInjection is not defined");S(E+"."+q.toLowerCase()+".fx",v)}const e=(N,q,R,z)=>{try{const B=N.existingPipelineContext||q(N.shaderProcessingContext);if(B._name=N.name,N.name&&N.context){(0,v.v)(N.context).cachedPipelines[N.name]=B}return R(B,N.vertex,N.fragment,!!N.createAsRaw,"","",N.rebuildRebind,N.defines,N.transformFeedbackVaryings,"",(()=>{z(B,(()=>{var q;null===(q=N.onRenderingStateCompiled)||void 0===q||q.call(N,B)}))})),B}catch(B){throw F.c.Error("Error compiling effect"),B}}},10964:(N,q,R)=>{"use strict";R.d(q,{d:()=>S});var z=R(10893),v=R(10907),B=R(10966),F=R(10968);class S{static get ShadersRepository(){return B.e.ShadersRepository}static set ShadersRepository(N){B.e.ShadersRepository=N}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new z.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9?arguments[9]:void 0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new z.d,this.onErrorObservable=new z.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=N,this._key=e;const D=this._key.replace(/\r/g,"").replace(/\n/g,"|");let V;if(q.attributes){const N=q;if(this._engine=R,this._attributesNames=N.attributes,this._uniformsNames=N.uniformsNames.concat(N.samplers),this._samplerList=N.samplers.slice(),this.defines=N.defines,this.onError=N.onError,this.onCompiled=N.onCompiled,this._fallbacks=N.fallbacks,this._indexParameters=N.indexParameters,this._transformFeedbackVaryings=N.transformFeedbackVaryings||null,this._multiTarget=!!N.multiTarget,this._shaderLanguage=N.shaderLanguage??0,N.uniformBuffersNames){this._uniformBuffersNamesList=N.uniformBuffersNames.slice();for(let q=0;q<N.uniformBuffersNames.length;q++)this._uniformBuffersNames[N.uniformBuffersNames[q]]=q}this._processFinalCode=N.processFinalCode??null,this._processCodeAfterIncludes=N.processCodeAfterIncludes??void 0,V=N.existingPipelineContext}else this._engine=B,this.defines=null==A?"":A,this._uniformsNames=R.concat(v),this._samplerList=v?v.slice():[],this._attributesNames=q,this._uniformBuffersNamesList=[],this._shaderLanguage=b,this.onError=t,this.onCompiled=E,this._indexParameters=x,this._fallbacks=y;"WEBGL2"===this._engine.shaderPlatformName&&(V=(0,F.i)(D,this._engine._gl)??V),this._attributeLocationByName={},this.uniqueId=S._UniqueIdSeed++,V?(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,f)}async _processShaderCodeAsync(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0;z&&await z(),this._processingContext=R||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const v={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:N??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:B.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:B.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,F.d)(v,this.name,this._processFinalCode,((N,R)=>{this._vertexSourceCode=N,this._fragmentSourceCode=R,this._prepareEffect(q)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(N){return this._attributes[N]}getAttributeLocationByName(N){return this._attributeLocationByName[N]}getAttributesCount(){return this._attributes.length}getUniformIndex(N){return this._uniformsNames.indexOf(N)}getUniform(N){return this._uniforms[N]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(N){this.isReady()?N(this):(this.onCompileObservable.add((q=>{N(q)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(N){try{if(this._isReadyInternal())return}catch(q){return void this._processCompilationErrors(q,N)}this._isDisposed||setTimeout((()=>{this._checkIsReady(N)}),16)}get vertexSourceCode(){var N;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(N=this._pipelineContext)||void 0===N?void 0:N._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var N;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(N=this._pipelineContext)||void 0===N?void 0:N._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(N,q,R,z){this._isReady=!1,this._vertexSourceCodeOverride=N,this._fragmentSourceCodeOverride=q,this.onError=(N,q)=>{z&&z(q)},this.onCompiled=()=>{var N,q;const z=this.getEngine().scenes;if(z)for(let R=0;R<z.length;R++)z[R].markAllMaterialsAsDirty(63);null===(N=(q=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===N||N.call(q,R)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(N){if(this._pipelineContext=N,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let q=0;q<this._attributesNames.length;q++){const N=this._attributesNames[q];this._attributeLocationByName[N]=this._attributes[q]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),S.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this._pipelineContext;this._isReady=!1;try{const R=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),z=R?null:this.defines,v=R?this._vertexSourceCodeOverride:this._vertexSourceCode,B=R?this._fragmentSourceCodeOverride:this._fragmentSourceCode,S=this._engine;this._pipelineContext=(0,F.g)({existingPipelineContext:N?q:null,vertex:v,fragment:B,context:"WEBGL2"===S.shaderPlatformName?S._gl:void 0,rebuildRebind:(N,q,R,z)=>this._rebuildProgram(N,q,R,z),defines:z,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:R,parallelShaderCompile:S._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:R=>{q&&!N&&this._engine._deletePipelineContext(q),R&&this._onRenderingStateCompiled(R)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(q)}catch(R){this._processCompilationErrors(R,q)}}_getShaderCodeAndErrorLine(N,q,R){const z=R?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let v=null;if(q&&N){const B=q.match(z);if(B&&2===B.length){const q=parseInt(B[1]),z=N.split("\n",-1);z.length>=q&&(v=`Offending line [${q}] in ${R?"fragment":"vertex"} code: ${z[q-1]}`)}}return[N,v]}_processCompilationErrors(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=N.message;const R=this._attributesNames,z=this._fallbacks;if(v.c.Error("Unable to compile effect:"),v.c.Error("Uniforms: "+this._uniformsNames.map((function(N){return" "+N}))),v.c.Error("Attributes: "+R.map((function(N){return" "+N}))),v.c.Error("Defines:\n"+this.defines),S.LogShaderCodeOnCompilationError){var B,F;let N=null,q=null,R=null;var A;if(null!==(B=this._pipelineContext)&&void 0!==B&&B._getVertexShaderCode()&&([R,N]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),R&&(v.c.Error("Vertex code:"),v.c.Error(R))),null!==(F=this._pipelineContext)&&void 0!==F&&F._getFragmentShaderCode())[R,q]=this._getShaderCodeAndErrorLine(null===(A=this._pipelineContext)||void 0===A?void 0:A._getFragmentShaderCode(),this._compilationError,!0),R&&(v.c.Error("Fragment code:"),v.c.Error(R));N&&v.c.Error(N),q&&v.c.Error(q)}v.c.Error("Error: "+this._compilationError);const y=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};q&&(this._pipelineContext=q,this._isReady=!0,y()),z?(this._pipelineContext=null,z.hasMoreFallbacks?(this._allFallbacksProcessed=!1,v.c.Error("Trying next fallback."),this.defines=z.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,y(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,q||y())}get isSupported(){return""===this._compilationError}_bindTexture(N,q){this._engine._bindTexture(this._samplers[N],q,N)}setTexture(N,q){this._engine.setTexture(this._samplers[N],this._uniforms[N],q,N)}setTextureArray(N,q){const R=N+"Ex";if(-1===this._samplerList.indexOf(R+"0")){const z=this._samplerList.indexOf(N);for(let N=1;N<q.length;N++){const q=R+(N-1).toString();this._samplerList.splice(z+N,0,q)}let v=0;for(const N of this._samplerList)this._samplers[N]=v,v+=1}this._engine.setTextureArray(this._samplers[N],this._uniforms[N],q,N)}bindUniformBuffer(N,q){const R=this._uniformBuffersNames[q];void 0===R||S._BaseCache[R]===N&&this._engine._features.useUBOBindingCache||(S._BaseCache[R]=N,this._engine.bindUniformBufferBase(N,R,q))}bindUniformBlock(N,q){this._engine.bindUniformBlock(this._pipelineContext,N,q)}setInt(N,q){return this._pipelineContext.setInt(N,q),this}setInt2(N,q,R){return this._pipelineContext.setInt2(N,q,R),this}setInt3(N,q,R,z){return this._pipelineContext.setInt3(N,q,R,z),this}setInt4(N,q,R,z,v){return this._pipelineContext.setInt4(N,q,R,z,v),this}setIntArray(N,q){return this._pipelineContext.setIntArray(N,q),this}setIntArray2(N,q){return this._pipelineContext.setIntArray2(N,q),this}setIntArray3(N,q){return this._pipelineContext.setIntArray3(N,q),this}setIntArray4(N,q){return this._pipelineContext.setIntArray4(N,q),this}setUInt(N,q){return this._pipelineContext.setUInt(N,q),this}setUInt2(N,q,R){return this._pipelineContext.setUInt2(N,q,R),this}setUInt3(N,q,R,z){return this._pipelineContext.setUInt3(N,q,R,z),this}setUInt4(N,q,R,z,v){return this._pipelineContext.setUInt4(N,q,R,z,v),this}setUIntArray(N,q){return this._pipelineContext.setUIntArray(N,q),this}setUIntArray2(N,q){return this._pipelineContext.setUIntArray2(N,q),this}setUIntArray3(N,q){return this._pipelineContext.setUIntArray3(N,q),this}setUIntArray4(N,q){return this._pipelineContext.setUIntArray4(N,q),this}setFloatArray(N,q){return this._pipelineContext.setArray(N,q),this}setFloatArray2(N,q){return this._pipelineContext.setArray2(N,q),this}setFloatArray3(N,q){return this._pipelineContext.setArray3(N,q),this}setFloatArray4(N,q){return this._pipelineContext.setArray4(N,q),this}setArray(N,q){return this._pipelineContext.setArray(N,q),this}setArray2(N,q){return this._pipelineContext.setArray2(N,q),this}setArray3(N,q){return this._pipelineContext.setArray3(N,q),this}setArray4(N,q){return this._pipelineContext.setArray4(N,q),this}setMatrices(N,q){return this._pipelineContext.setMatrices(N,q),this}setMatrix(N,q){return this._pipelineContext.setMatrix(N,q),this}setMatrix3x3(N,q){return this._pipelineContext.setMatrix3x3(N,q),this}setMatrix2x2(N,q){return this._pipelineContext.setMatrix2x2(N,q),this}setFloat(N,q){return this._pipelineContext.setFloat(N,q),this}setBool(N,q){return this._pipelineContext.setInt(N,q?1:0),this}setVector2(N,q){return this._pipelineContext.setVector2(N,q),this}setFloat2(N,q,R){return this._pipelineContext.setFloat2(N,q,R),this}setVector3(N,q){return this._pipelineContext.setVector3(N,q),this}setFloat3(N,q,R,z){return this._pipelineContext.setFloat3(N,q,R,z),this}setVector4(N,q){return this._pipelineContext.setVector4(N,q),this}setQuaternion(N,q){return this._pipelineContext.setQuaternion(N,q),this}setFloat4(N,q,R,z,v){return this._pipelineContext.setFloat4(N,q,R,z,v),this}setColor3(N,q){return this._pipelineContext.setColor3(N,q),this}setColor4(N,q,R){return this._pipelineContext.setColor4(N,q,R),this}setDirectColor4(N,q){return this._pipelineContext.setDirectColor4(N,q),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,F.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;q&&(B.e.GetShadersStore(z)[`${N}PixelShader`]=q),R&&(B.e.GetShadersStore(z)[`${N}VertexShader`]=R)}static ResetCache(){S._BaseCache={}}}S.LogShaderCodeOnCompilationError=!0,S.AutomaticallyClearCodeCache=!1,S._UniqueIdSeed=0,S._BaseCache={},S.ShadersStore=B.e.ShadersStore,S.IncludesShadersStore=B.e.IncludesShadersStore},11421:(N,q,R)=>{"use strict";R.d(q,{e:()=>z});class z{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(N,q){this._defines[N]||(N<this._currentRank&&(this._currentRank=N),N>this._maxRank&&(this._maxRank=N),this._defines[N]=new Array),this._defines[N].push(q)}addCPUSkinningFallback(N,q){this._mesh=q,N<this._currentRank&&(this._currentRank=N),N>this._maxRank&&(this._maxRank=N)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(N,q){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,N=N.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),q._bonesComputationForcedToCPU=!0;const R=this._mesh.va();for(let N=0;N<R.meshes.length;N++){const z=R.meshes[N];if(z.material){if(z.computeBonesUsingShaders&&0!==z.numBoneInfluencers)if(z.material.getEffect()===q)z.computeBonesUsingShaders=!1;else if(z.lg)for(const N of z.lg){if(N.effect===q){z.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&z.computeBonesUsingShaders&&z.numBoneInfluencers>0&&(z.computeBonesUsingShaders=!1)}}else{const q=this._defines[this._currentRank];if(q)for(let R=0;R<q.length;R++)N=N.replace("#define "+q[R],"");this._currentRank++}return N}}},11719:(N,q,R)=>{"use strict";R.d(q,{d:()=>y,f:()=>E});var z=R(11251),v=R(11463),B=R(10893),F=R(10964),S=R(11370);R(11728);const A={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class y{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A;this._fullscreenViewport=new v.d(0,0,1,1);const R=q.xa??A.xa,B=q.indices??A.indices;this.Dd=N,this._vertexBuffers={[z.h.PositionKind]:new z.h(N,R,z.h.PositionKind,!1,!1,2)},this._indexBuffer=N.createIndexBuffer(B),this._onContextRestoredObserver=N.onContextRestoredObservable.add((()=>{this._indexBuffer=N.createIndexBuffer(B);for(const N in this._vertexBuffers){this._vertexBuffers[N]._rebuild()}}))}setViewport(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Dd.setViewport(N)}bindBuffers(N){this.Dd.bindBuffers(this._vertexBuffers,this._indexBuffer,N)}applyEffectWrapper(N){this.Dd.setState(!0),this.Dd.depthCullingState.depthTest=!1,this.Dd.stencilState.stencilTest=!1,this.Dd.enableEffect(N.drawWrapper),this.bindBuffers(N.effect),N.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Dd.depthCullingState.depthTest,this._savedStateStencilTest=this.Dd.stencilState.stencilTest}restoreStates(){this.Dd.depthCullingState.depthTest=this._savedStateDepthTest,this.Dd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Dd.drawElementsType(0,0,6)}_isRenderTargetTexture(N){return void 0!==N.renderTarget}render(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!N.effect.isReady())return;this.saveStates(),this.setViewport();const R=null===q?null:this._isRenderTargetTexture(q)?q.renderTarget:q;R&&this.Dd.bindFramebuffer(R),this.applyEffectWrapper(N),this.draw(),R&&this.Dd.unBindFramebuffer(R),this.restoreStates()}dispose(){const N=this._vertexBuffers[z.h.PositionKind];N&&(N.dispose(),delete this._vertexBuffers[z.h.PositionKind]),this._indexBuffer&&this.Dd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Dd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class E{static RegisterShaderCodeProcessing(N,q){q?E._CustomShaderCodeProcessing[N??""]=q:delete E._CustomShaderCodeProcessing[N??""]}static _GetShaderCodeProcessing(N){return E._CustomShaderCodeProcessing[N]??E._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(N){this.options.name=N}isReady(){var N;return(null===(N=this._drawWrapper.effect)||void 0===N?void 0:N.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(N){this._drawWrapper.effect=N}constructor(N){this.alphaMode=0,this.onEffectCreatedObservable=new B.d(void 0,!0),this.onApplyObservable=new B.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...N,name:N.name||"effectWrapper",Dd:N.Dd,uniforms:N.uniforms||N.uniformNames||[],uniformNames:void 0,samplers:N.samplers||N.samplerNames||[],samplerNames:void 0,attributeNames:N.attributeNames||["position"],uniformBuffers:N.uniformBuffers||[],defines:N.defines||"",useShaderStore:N.useShaderStore||!1,vertexUrl:N.vertexUrl||N.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:N.fragmentShader||"pass",indexParameters:N.indexParameters,blockCompilation:N.blockCompilation||!1,shaderLanguage:N.shaderLanguage||0,onCompiled:N.onCompiled||void 0,extraInitializations:N.extraInitializations||void 0,extraInitializationsAsync:N.extraInitializationsAsync||void 0,useAsPostProcess:N.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),N.vertexUrl||N.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Dd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new S.e(this.options.Dd),this._webGPUReady=1===this.options.shaderLanguage;const q=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,q,this.options.extraInitializations)}_gatherImports(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(N&&this._webGPUReady?q.push(Promise.all([R.e(37).then(R.bind(R,13372))])):q.push(Promise.all([Promise.resolve().then(R.bind(R,11728))])))}_postConstructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,z&&this._importPromises.push(...z);const v=this.options.Dd.isWebGPU&&!E.ForceGLSL;this._gatherImports(v,this._importPromises),void 0!==R&&R(v,this._importPromises),v&&this._webGPUReady&&(this.options.shaderLanguage=1),N||this.updateEffect(q)}updateEffect(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,A=arguments.length>7?arguments[7]:void 0;const y=E._GetShaderCodeProcessing(this.name);if(null!==y&&void 0!==y&&y.defineCustomBindings){var t,x;const z=(null===(t=q)||void 0===t?void 0:t.slice())??[];z.push(...this.options.uniforms);const v=(null===(x=R)||void 0===x?void 0:x.slice())??[];v.push(...this.options.samplers),N=y.defineCustomBindings(this.name,N,z,v),q=z,R=v}this.options.defines=N||"";const e=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let b;b=this.options.extraInitializationsAsync?async()=>{null===e||void 0===e||e(),await this.options.extraInitializationsAsync}:e,this.options.useShaderStore?this._drawWrapper.effect=this.options.Dd.createEffect({vertex:S??this._shaderPath.vertex,fragment:A??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:q||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:R||this.options.samplers,defines:null!==N?N:"",fallbacks:null,onCompiled:v??this.options.onCompiled,onError:B??null,indexParameters:z||this.options.indexParameters,processCodeAfterIncludes:null!==y&&void 0!==y&&y.processCodeAfterIncludes?(N,q)=>y.processCodeAfterIncludes(this.name,N,q):null,processFinalCode:null!==y&&void 0!==y&&y.processFinalCode?(N,q)=>y.processFinalCode(this.name,N,q):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:b},this.options.Dd):this._drawWrapper.effect=new F.d(this._shaderPath,this.options.attributeNames,q||this.options.uniforms,R||this.options.samplerNames,this.options.Dd,N,void 0,v||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,b),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var N,q;this.options.useAsPostProcess&&(this.options.Dd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(N=E._GetShaderCodeProcessing(this.name))||void 0===N||null===(q=N.bindCustomBindings)||void 0===q||q.call(N,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}E.ForceGLSL=!1,E._CustomShaderCodeProcessing={}},11236:(N,q,R)=>{"use strict";R.d(q,{e:()=>B,h:()=>v});var z=R(11229);function v(N,q){q.EXPOSURE&&N.push("exposureLinear"),q.CONTRAST&&N.push("contrast"),q.COLORGRADING&&N.push("colorTransformSettings"),(q.VIGNETTE||q.DITHER)&&N.push("vInverseScreenSize"),q.VIGNETTE&&(N.push("vignetteSettings1"),N.push("vignetteSettings2")),q.COLORCURVES&&(0,z.c)(N),q.DITHER&&N.push("ditherIntensity")}function B(N,q){q.COLORGRADING&&N.push("txColorTransform")}},11206:(N,q,R)=>{"use strict";R.d(q,{c:()=>e});var z=R(11147),v=R(11151),B=R(10893),F=R(11213),S=R(11221),A=R(11229);class y{constructor(){this._dirty=!0,this._tempColor=new F.g(0,0,0,0),this._globalCurve=new F.g(0,0,0,0),this._highlightsCurve=new F.g(0,0,0,0),this._midtonesCurve=new F.g(0,0,0,0),this._shadowsCurve=new F.g(0,0,0,0),this._positiveCurve=new F.g(0,0,0,0),this._negativeCurve=new F.g(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(N){this._globalHue=N,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(N){this._globalDensity=N,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(N){this._globalSaturation=N,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(N){this._globalExposure=N,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(N){this._highlightsHue=N,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(N){this._highlightsDensity=N,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(N){this._highlightsSaturation=N,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(N){this._highlightsExposure=N,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(N){this._midtonesHue=N,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(N){this._midtonesDensity=N,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(N){this._midtonesSaturation=N,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(N){this._midtonesExposure=N,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(N){this._shadowsHue=N,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(N){this._shadowsDensity=N,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(N){this._shadowsSaturation=N,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(N){this._shadowsExposure=N,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";N._dirty&&(N._dirty=!1,N._getColorGradingDataToRef(N._globalHue,N._globalDensity,N._globalSaturation,N._globalExposure,N._globalCurve),N._getColorGradingDataToRef(N._highlightsHue,N._highlightsDensity,N._highlightsSaturation,N._highlightsExposure,N._tempColor),N._tempColor.multiplyToRef(N._globalCurve,N._highlightsCurve),N._getColorGradingDataToRef(N._midtonesHue,N._midtonesDensity,N._midtonesSaturation,N._midtonesExposure,N._tempColor),N._tempColor.multiplyToRef(N._globalCurve,N._midtonesCurve),N._getColorGradingDataToRef(N._shadowsHue,N._shadowsDensity,N._shadowsSaturation,N._shadowsExposure,N._tempColor),N._tempColor.multiplyToRef(N._globalCurve,N._shadowsCurve),N._highlightsCurve.subtractToRef(N._midtonesCurve,N._positiveCurve),N._midtonesCurve.subtractToRef(N._shadowsCurve,N._negativeCurve)),q&&(q.setFloat4(R,N._positiveCurve.r,N._positiveCurve.g,N._positiveCurve.b,N._positiveCurve.a),q.setFloat4(z,N._midtonesCurve.r,N._midtonesCurve.g,N._midtonesCurve.b,N._midtonesCurve.a),q.setFloat4(v,N._negativeCurve.r,N._negativeCurve.g,N._negativeCurve.b,N._negativeCurve.a))}_getColorGradingDataToRef(N,q,R,z,v){null!=N&&(N=y._Clamp(N,0,360),q=y._Clamp(q,-100,100),R=y._Clamp(R,-100,100),z=y._Clamp(z,-100,100),q=y._ApplyColorGradingSliderNonlinear(q),q*=.5,z=y._ApplyColorGradingSliderNonlinear(z),q<0&&(q*=-1,N=(N+180)%360),y._FromHSBToRef(N,q,50+.25*z,v),v.scaleToRef(2,v),v.a=1+.01*R)}static _ApplyColorGradingSliderNonlinear(N){N/=100;let q=Math.abs(N);return q=Math.pow(q,2),N<0&&(q*=-1),q*=100,q}static _FromHSBToRef(N,q,R,z){let v=y._Clamp(N,0,360);const B=y._Clamp(q/100,0,1),F=y._Clamp(R/100,0,1);if(0===B)z.r=F,z.g=F,z.b=F;else{v/=60;const N=Math.floor(v),q=v-N,R=F*(1-B),S=F*(1-B*q),A=F*(1-B*(1-q));switch(N){case 0:z.r=F,z.g=A,z.b=R;break;case 1:z.r=S,z.g=F,z.b=R;break;case 2:z.r=R,z.g=F,z.b=A;break;case 3:z.r=R,z.g=S,z.b=F;break;case 4:z.r=A,z.g=R,z.b=F;break;default:z.r=F,z.g=R,z.b=S}}z.a=1}static _Clamp(N,q,R){return Math.min(Math.max(N,q),R)}clone(){return S.e.Clone((()=>new y),this)}serialize(){return S.e.Serialize(this)}static Parse(N){return S.e.Parse((()=>new y),N,null,null)}}y.PrepareUniforms=A.c,(0,z.c)([(0,v.D)()],y.prototype,"_globalHue",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_globalDensity",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_globalSaturation",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_globalExposure",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_highlightsHue",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_highlightsDensity",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_highlightsSaturation",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_highlightsExposure",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_midtonesHue",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_midtonesDensity",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_midtonesSaturation",void 0),(0,z.c)([(0,v.D)()],y.prototype,"_midtonesExposure",void 0),S.e._ColorCurvesParser=y.Parse;var E=R(11013),t=R(11236),x=R(11002);class e{constructor(){this.colorCurves=new y,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new F.g(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new B.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(N){this._colorCurvesEnabled!==N&&(this._colorCurvesEnabled=N,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(N){this._colorGradingTexture!==N&&(this._colorGradingTexture=N,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(N){this._colorGradingEnabled!==N&&(this._colorGradingEnabled=N,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(N){this._colorGradingWithGreenDepth!==N&&(this._colorGradingWithGreenDepth=N,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(N){this._colorGradingBGR!==N&&(this._colorGradingBGR=N,this._updateParameters())}get exposure(){return this._exposure}set exposure(N){this._exposure!==N&&(this._exposure=N,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(N){this._toneMappingEnabled!==N&&(this._toneMappingEnabled=N,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(N){this._toneMappingType!==N&&(this._toneMappingType=N,this._updateParameters())}get contrast(){return this._contrast}set contrast(N){this._contrast!==N&&(this._contrast=N,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(N){this.vignetteCenterY=N}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(N){this.vignetteCenterX=N}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(N){this._vignetteBlendMode!==N&&(this._vignetteBlendMode=N,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(N){this._vignetteEnabled!==N&&(this._vignetteEnabled=N,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(N){this._ditheringEnabled!==N&&(this._ditheringEnabled=N,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(N){this._ditheringIntensity!==N&&(this._ditheringIntensity=N,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(N){this._skipFinalColorClamp!==N&&(this._skipFinalColorClamp=N,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(N){this._applyByPostProcess!==N&&(this._applyByPostProcess=N,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(N){this._isEnabled!==N&&(this._isEnabled=N,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(N){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return N.VIGNETTE=!1,N.TONEMAPPING=0,N.CONTRAST=!1,N.EXPOSURE=!1,N.COLORCURVES=!1,N.COLORGRADING=!1,N.COLORGRADING3D=!1,N.DITHER=!1,N.IMAGEPROCESSING=!1,N.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(N.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(N.VIGNETTE=this.vignetteEnabled,N.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,N.VIGNETTEBLENDMODEOPAQUE=!N.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case e.TONEMAPPING_KHR_PBR_NEUTRAL:N.TONEMAPPING=3;break;case e.TONEMAPPING_ACES:N.TONEMAPPING=2;break;default:N.TONEMAPPING=1}else N.TONEMAPPING=0;N.CONTRAST=1!==this.contrast,N.EXPOSURE=1!==this.exposure,N.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,N.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,N.COLORGRADING?N.COLORGRADING3D=this.colorGradingTexture.is3D:N.COLORGRADING3D=!1,N.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,N.SAMPLER3DBGRMAP=this.colorGradingBGR,N.DITHER=this._ditheringEnabled,N.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,N.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,N.IMAGEPROCESSING=N.VIGNETTE||!!N.TONEMAPPING||N.CONTRAST||N.EXPOSURE||N.COLORCURVES||N.COLORGRADING||N.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(N,q){if(this._colorCurvesEnabled&&this.colorCurves&&y.Bind(this.colorCurves,N),this._vignetteEnabled||this._ditheringEnabled){const R=1/N.getEngine().getRenderWidth(),z=1/N.getEngine().getRenderHeight();if(N.setFloat2("vInverseScreenSize",R,z),this._ditheringEnabled&&N.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const v=null!=q?q:z/R;let B=Math.tan(.5*this.vignetteCameraFov),F=B*v;const S=Math.sqrt(F*B);F=(0,E.n)(F,S,this.vignetteStretch),B=(0,E.n)(B,S,this.vignetteStretch),N.setFloat4("vignetteSettings1",F,B,-F*this.vignetteCenterX,-B*this.vignetteCenterY);const A=-2*this.vignetteWeight;N.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,A)}}if(N.setFloat("exposureLinear",this.exposure),N.setFloat("contrast",this.contrast),this.colorGradingTexture){N.setTexture("txColorTransform",this.colorGradingTexture);const q=this.colorGradingTexture.getSize().height;N.setFloat4("colorTransformSettings",(q-1)/q,.5/q,q,this.colorGradingTexture.level)}}clone(){return S.e.Clone((()=>new e),this)}serialize(){return S.e.Serialize(this)}static Parse(N){const q=S.e.Parse((()=>new e),N,null,null);return void 0!==N.vignetteCentreX&&(q.vignetteCenterX=N.vignetteCentreX),void 0!==N.vignetteCentreY&&(q.vignetteCenterY=N.vignetteCentreY),q}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e.TONEMAPPING_KHR_PBR_NEUTRAL=2,e.PrepareUniforms=t.h,e.PrepareSamplers=t.e,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,(0,z.c)([(0,v.i)()],e.prototype,"colorCurves",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_colorCurvesEnabled",void 0),(0,z.c)([(0,v.x)("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_colorGradingEnabled",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_colorGradingWithGreenDepth",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_colorGradingBGR",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_exposure",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_toneMappingEnabled",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_toneMappingType",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_contrast",void 0),(0,z.c)([(0,v.D)()],e.prototype,"vignetteStretch",void 0),(0,z.c)([(0,v.D)()],e.prototype,"vignetteCenterX",void 0),(0,z.c)([(0,v.D)()],e.prototype,"vignetteCenterY",void 0),(0,z.c)([(0,v.D)()],e.prototype,"vignetteWeight",void 0),(0,z.c)([(0,v.m)()],e.prototype,"vignetteColor",void 0),(0,z.c)([(0,v.D)()],e.prototype,"vignetteCameraFov",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_vignetteBlendMode",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_vignetteEnabled",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_ditheringEnabled",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_ditheringIntensity",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_skipFinalColorClamp",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_applyByPostProcess",void 0),(0,z.c)([(0,v.D)()],e.prototype,"_isEnabled",void 0),S.e._ImageProcessingConfigurationParser=e.Parse,(0,x.f)("BABYLON.ImageProcessingConfiguration",e)},11429:(N,q,R)=>{"use strict";R.d(q,{b:()=>t});var z=R(11147),v=R(11332),B=R(11151),F=R(11418),S=R(11391),A=R(11436),y=R(11379);class E extends S.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class t extends A.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"DetailMap",140,new E,q),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=v.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,q,R){return!this._isEnabled||!(N._areTexturesDirty&&q.texturesEnabled&&R.getCaps().standardDerivatives&&this._texture&&F.d.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(N,q){if(this._isEnabled){N.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const R=q.getEngine();N._areTexturesDirty&&(R.getCaps().standardDerivatives&&this._texture&&F.d.DetailTextureEnabled&&this._isEnabled?((0,y.J)(this._texture,N,"DETAIL"),N.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):N.DETAIL=!1)}else N.DETAIL=!1}bindForSubMesh(N,q){if(!this._isEnabled)return;const R=this._material.isFrozen;N.useUbo&&R&&N.isSync||this._texture&&F.d.DetailTextureEnabled&&(N.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,y.p)(this._texture,N,"detail")),q.texturesEnabled&&this._texture&&F.d.DetailTextureEnabled&&N.setTexture("detailSampler",this._texture)}hasTexture(N){return this._texture===N}getActiveTextures(N){this._texture&&N.push(this._texture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture)}dispose(N){var q;N&&(null===(q=this._texture)||void 0===q||q.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(N){N.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,z.c)([(0,B.x)("detailTexture"),(0,B.e)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,z.c)([(0,B.D)()],t.prototype,"diffuseBlendLevel",void 0),(0,z.c)([(0,B.D)()],t.prototype,"roughnessBlendLevel",void 0),(0,z.c)([(0,B.D)()],t.prototype,"bumpLevel",void 0),(0,z.c)([(0,B.D)(),(0,B.e)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalBlendMethod",void 0),(0,z.c)([(0,B.D)(),(0,B.e)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0)},11332:(N,q,R)=>{"use strict";R.d(q,{d:()=>D});var z=R(11147),v=R(11151),B=R(10888),F=R(10893),S=R(10933),A=R(11335),y=R(11238),E=R(10907),t=R(11313),x=R(11370),e=R(11221);class b{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(N){this._func=N}get funcRef(){return this._funcRef}set funcRef(N){this._funcRef=N}get funcMask(){return this._funcMask}set funcMask(N){this._funcMask=N}get opStencilFail(){return this._opStencilFail}set opStencilFail(N){this._opStencilFail=N}get opDepthFail(){return this._opDepthFail}set opDepthFail(N){this._opDepthFail=N}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(N){this._opStencilDepthPass=N}get mask(){return this._mask}set mask(N){this._mask=N}get enabled(){return this._enabled}set enabled(N){this._enabled=N}getClassName(){return"MaterialStencilState"}copyTo(N){e.e.Clone((()=>N),this)}serialize(){return e.e.Serialize(this)}parse(N,q,R){e.e.Parse((()=>this),N,q,R)}}(0,z.c)([(0,v.D)()],b.prototype,"func",null),(0,z.c)([(0,v.D)()],b.prototype,"funcRef",null),(0,z.c)([(0,v.D)()],b.prototype,"funcMask",null),(0,z.c)([(0,v.D)()],b.prototype,"opStencilFail",null),(0,z.c)([(0,v.D)()],b.prototype,"opDepthFail",null),(0,z.c)([(0,v.D)()],b.prototype,"opStencilDepthPass",null),(0,z.c)([(0,v.D)()],b.prototype,"mask",null),(0,z.c)([(0,v.D)()],b.prototype,"enabled",null);var f=R(11379);class D{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(N){if(this._alpha===N)return;const q=this._alpha;this._alpha=N,1!==q&&1!==N||this.Lg(D.MiscDirtyFlag+D.PrePassDirtyFlag)}get alpha(){return this._alpha}set hh(N){this._backFaceCulling!==N&&(this._backFaceCulling=N,this.Lg(D.TextureDirtyFlag))}get hh(){return this._backFaceCulling}set cullBackFaces(N){this._cullBackFaces!==N&&(this._cullBackFaces=N,this.Lg(D.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(N){this._blockDirtyMechanism!==N&&(this._blockDirtyMechanism=N,N||this.dj())}atomicMaterialsUpdate(N){this.blockDirtyMechanism=!0;try{N(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(N){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(N)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new F.d),this._onBindObservable}set onBind(N){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(N)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new F.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new F.d),this._onEffectCreatedObservable}set alphaMode(N){this._alphaMode!==N&&(this._alphaMode=N,this.Lg(D.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(N){this._needDepthPrePass!==N&&(this._needDepthPrePass=N,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(N){this._fogEnabled!==N&&(this._fogEnabled=N,this.Lg(D.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case D.WireFrameFillMode:case D.LineListDrawMode:case D.LineLoopDrawMode:case D.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(N){this.fillMode=N?D.WireFrameFillMode:D.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case D.PointFillMode:case D.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(N){this.fillMode=N?D.PointFillMode:D.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(N){this._fillMode!==N&&(this._fillMode=N,this.Lg(D.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){const q=this.va().getEngine().getCaps().fragmentDepthSupported;N&&!q&&E.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=N&&q,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(N){this._drawWrapper=N}constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.jj=new F.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new b,this._useUBO=!1,this._fillMode=D.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=N;const v=q||S.b.LastCreatedScene;v&&(this._scene=v,this._dirtyCallbacks={},this._forceGLSL=z,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=N||B.f.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new x.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new y.b(this._scene.getEngine(),void 0,void 0,N),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),R||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),D.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var N;const q=this.va().getEngine();null===(N=this._uniformBuffer)||void 0===N||N.dispose(),q.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new y.b(q,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new y.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(N){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.dj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.dj(),this.checkReadyOnlyOnce=!1}isReady(N,q){return!0}isReadyForSubMesh(N,q,R){const z=q.materialDefines;return!!z&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(N){return null!==this.sideOrientation?this.sideOrientation:N.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(N){this._transparencyMode!==N&&(this._transparencyMode=N,this._forceAlphaTest=N===D.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===D.MATERIAL_OPAQUE||this._transparencyMode===D.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(N){return N.visibility<1||!this._disableAlphaBlending&&(N.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(N){return!this.needAlphaBlendingForMesh(N)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}dj(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this.va().meshes;for(const R of q)if(R.lg)for(const q of R.lg)if(q.Ha()===this)for(const R of q._drawWrappers)R&&this._materialContext===R.materialContext&&(R._wasPreviouslyReady=!1,R._wasPreviouslyUsingInstances=null,R._forceRebindOnNextCall=N);N&&this.Lg(D.AllDirtyFlag)}_preBind(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this._scene.getEngine(),z=(null==q?this.sideOrientation:q)===D.ClockWiseSideOrientation;return R.enableEffect(N||this._getDrawWrapper()),R.setState(this.hh,this.zOffset,!1,z,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),z}bind(N,q){}buildUniformLayout(){const N=this._uniformBuffer;this._eventInfo.ubo=N,this._callbackPluginEventGeneric(8,this._eventInfo),N.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(N,q,R){const z=R._drawWrapper;this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),z._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(N){}bindView(N){this._useUBO?this._needToBindSceneUbo=!0:N.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(N){this._useUBO?this._needToBindSceneUbo=!0:(N.setMatrix("viewProjection",this.va().getTransformMatrix()),N.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(N,q){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(N,q)}_afterBind(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&q&&(this._needToBindSceneUbo=!1,(0,f.l)(q,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=N?N.visibility:1,this._onBindObservable&&N&&this._onBindObservable.notifyObservers(N),this.disableDepthWrite){const N=this._scene.getEngine();this._cachedDepthWriteState=N.getDepthWrite(),N.setDepthWrite(!1)}if(this.disableColorWrite){const N=this._scene.getEngine();this._cachedColorWriteState=N.getColorWrite(),N.setColorWrite(!1)}if(0!==this.depthFunction){const N=this._scene.getEngine();this._cachedDepthFunctionState=N.getDepthFunction()||0,N.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(N){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=N,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(N){return null}_clonePlugins(N,q){const R={};if(this._serializePlugins(R),D._ParsePlugins(R,N,this._scene,q),this.pluginManager)for(const z of this.pluginManager._plugins){const q=N.pluginManager.getPlugin(z.name);q&&z.copyTo(q)}}getBindedMeshes(){if(this.meshMap){const N=[];for(const q in this.meshMap){const R=this.meshMap[q];R&&N.push(R)}return N}return this._scene.meshes.filter((N=>N.material===this))}forceCompilation(N,q,R,z){const v={clipPlane:!1,useInstances:!1,...R},B=this.va(),F=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const S=()=>{if(!this._scene||!this._scene.getEngine())return;const R=B.clipPlane;if(v.clipPlane&&(B.clipPlane=new t.e(0,0,0,1)),this._storeEffectOnSubMeshes){let R=!0,B=null;if(N.lg){const q=new A.e(0,0,0,0,0,N,void 0,!1,!1);q.materialDefines&&(q.materialDefines._renderId=-1),this.isReadyForSubMesh(N,q,v.useInstances)||(q.effect&&q.effect.getCompilationError()&&q.effect.allFallbacksProcessed()?B=q.effect.getCompilationError():(R=!1,setTimeout(S,16)))}R&&(this.allowShaderHotSwapping=F,B&&z&&z(B),q&&q(this))}else this.isReady()?(this.allowShaderHotSwapping=F,q&&q(this)):setTimeout(S,16);v.clipPlane&&(B.clipPlane=R)};S()}forceCompilationAsync(N,q){return new Promise(((R,z)=>{this.forceCompilation(N,(()=>{R()}),q,(N=>{z(N)}))}))}Lg(N){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(D._DirtyCallbackArray.length=0,N&D.TextureDirtyFlag&&D._DirtyCallbackArray.push(D._TextureDirtyCallBack),N&D.LightDirtyFlag&&D._DirtyCallbackArray.push(D._LightsDirtyCallBack),N&D.FresnelDirtyFlag&&D._DirtyCallbackArray.push(D._FresnelDirtyCallBack),N&D.AttributesDirtyFlag&&D._DirtyCallbackArray.push(D._AttributeDirtyCallBack),N&D.MiscDirtyFlag&&D._DirtyCallbackArray.push(D._MiscDirtyCallBack),N&D.PrePassDirtyFlag&&D._DirtyCallbackArray.push(D._PrePassDirtyCallBack),D._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(D._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const N=this.va().meshes;for(const q of N)if(q.lg)for(const N of q.lg)N.Ha()===this&&N.resetDrawCache()}_markAllSubMeshesAsDirty(N){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const q=this.va().meshes;for(const R of q)if(R.lg)for(const q of R.lg)if(q.Ha(!1)===this)for(const R of q._drawWrappers)R&&R.defines&&R.defines.markAllAsDirty&&this._materialContext===R.materialContext&&N(R.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const N=this.va().enablePrePassRenderer();N&&N.Lg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(D._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(D._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(D._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(D._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(D._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(D._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(D._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(D._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(D._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(D._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const N=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.jj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(N)}))}}setPrePassRenderer(N){return!1}dispose(N,q,R){const z=this.va();if(z.stopAnimation(this),z.freeProcessedMaterials(),z.removeMaterial(this),this._eventInfo.forceDisposeTextures=q,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const N=this._parentContainer.materials.indexOf(this);N>-1&&this._parentContainer.materials.splice(N,1),this._parentContainer=null}if(!0!==R)if(this.meshMap)for(const v in this.meshMap){const q=this.meshMap[v];q&&(q.material=null,this.releaseVertexArrayObject(q,N))}else{const q=z.meshes;for(const R of q)R.material!==this||R.sourceMesh||(R.material=null,this.releaseVertexArrayObject(R,N))}this._uniformBuffer.dispose(),N&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.jj.notifyObservers(this),this.jj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(N,q){const R=N.Dj;if(R)if(this._storeEffectOnSubMeshes){if(N.lg)for(const z of N.lg)R._releaseVertexArrayObject(z.effect),q&&z.effect&&z.effect.dispose()}else R._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const N=e.e.Serialize(this);return N.stencil=this.stencil.serialize(),N.uniqueId=this.uniqueId,this._serializePlugins(N),N}_serializePlugins(N){if(N.plugins={},this.pluginManager)for(const q of this.pluginManager._plugins)N.plugins[q.getClassName()]=q.serialize()}static Parse(N,q,R){if(N.customType){if("BABYLON.PBRMaterial"===N.customType&&N.overloadedAlbedo&&(N.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return E.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else N.customType="BABYLON.StandardMaterial";const z=B.f.Instantiate(N.customType).Parse(N,q,R);return z._loadedUniqueId=N.uniqueId,z}static _ParsePlugins(N,q,R,z){if(N.plugins)for(const S in N.plugins){var v,F;const A=N.plugins[S];let y=null===(v=q.pluginManager)||void 0===v?void 0:v.getPlugin(A.name);if(!y){const N=B.f.Instantiate("BABYLON."+S);N&&(y=new N(q))}null===(F=y)||void 0===F||F.parse(A,R,z)}}}D.TriangleFillMode=0,D.WireFrameFillMode=1,D.PointFillMode=2,D.PointListDrawMode=3,D.LineListDrawMode=4,D.LineLoopDrawMode=5,D.LineStripDrawMode=6,D.TriangleStripDrawMode=7,D.TriangleFanDrawMode=8,D.ClockWiseSideOrientation=0,D.CounterClockWiseSideOrientation=1,D.TextureDirtyFlag=1,D.LightDirtyFlag=2,D.FresnelDirtyFlag=4,D.AttributesDirtyFlag=8,D.MiscDirtyFlag=16,D.PrePassDirtyFlag=32,D.AllDirtyFlag=63,D.MATERIAL_OPAQUE=0,D.MATERIAL_ALPHATEST=1,D.MATERIAL_ALPHABLEND=2,D.MATERIAL_ALPHATESTANDBLEND=3,D.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,D.MATERIAL_NORMALBLENDMETHOD_RNM=1,D.OnEventObservable=new F.d,D._AllDirtyCallBack=N=>N.markAllAsDirty(),D._ImageProcessingDirtyCallBack=N=>N.markAsImageProcessingDirty(),D._TextureDirtyCallBack=N=>N.markAsTexturesDirty(),D._FresnelDirtyCallBack=N=>N.markAsFresnelDirty(),D._MiscDirtyCallBack=N=>N.markAsMiscDirty(),D._PrePassDirtyCallBack=N=>N.markAsPrePassDirty(),D._LightsDirtyCallBack=N=>N.markAsLightDirty(),D._AttributeDirtyCallBack=N=>N.markAsAttributesDirty(),D._FresnelAndMiscDirtyCallBack=N=>{D._FresnelDirtyCallBack(N),D._MiscDirtyCallBack(N)},D._TextureAndMiscDirtyCallBack=N=>{D._TextureDirtyCallBack(N),D._MiscDirtyCallBack(N)},D._DirtyCallbackArray=[],D._RunDirtyCallBacks=N=>{for(const q of D._DirtyCallbackArray)q(N)},(0,z.c)([(0,v.D)()],D.prototype,"id",void 0),(0,z.c)([(0,v.D)()],D.prototype,"uniqueId",void 0),(0,z.c)([(0,v.D)()],D.prototype,"name",void 0),(0,z.c)([(0,v.D)()],D.prototype,"metadata",void 0),(0,z.c)([(0,v.D)()],D.prototype,"checkReadyOnEveryCall",void 0),(0,z.c)([(0,v.D)()],D.prototype,"checkReadyOnlyOnce",void 0),(0,z.c)([(0,v.D)()],D.prototype,"state",void 0),(0,z.c)([(0,v.D)("alpha")],D.prototype,"_alpha",void 0),(0,z.c)([(0,v.D)("hh")],D.prototype,"_backFaceCulling",void 0),(0,z.c)([(0,v.D)("cullBackFaces")],D.prototype,"_cullBackFaces",void 0),(0,z.c)([(0,v.D)()],D.prototype,"sideOrientation",void 0),(0,z.c)([(0,v.D)("alphaMode")],D.prototype,"_alphaMode",void 0),(0,z.c)([(0,v.D)()],D.prototype,"_needDepthPrePass",void 0),(0,z.c)([(0,v.D)()],D.prototype,"disableDepthWrite",void 0),(0,z.c)([(0,v.D)()],D.prototype,"disableColorWrite",void 0),(0,z.c)([(0,v.D)()],D.prototype,"forceDepthWrite",void 0),(0,z.c)([(0,v.D)()],D.prototype,"depthFunction",void 0),(0,z.c)([(0,v.D)()],D.prototype,"separateCullingPass",void 0),(0,z.c)([(0,v.D)("fogEnabled")],D.prototype,"_fogEnabled",void 0),(0,z.c)([(0,v.D)()],D.prototype,"pointSize",void 0),(0,z.c)([(0,v.D)()],D.prototype,"zOffset",void 0),(0,z.c)([(0,v.D)()],D.prototype,"zOffsetUnits",void 0),(0,z.c)([(0,v.D)()],D.prototype,"pointsCloud",null),(0,z.c)([(0,v.D)()],D.prototype,"fillMode",null),(0,z.c)([(0,v.D)()],D.prototype,"useLogarithmicDepth",null),(0,z.c)([(0,v.D)()],D.prototype,"transparencyMode",null)},11391:(N,q,R)=>{"use strict";R.d(q,{c:()=>z});class z{constructor(N){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=N,N)for(const q in N)Object.prototype.hasOwnProperty.call(N,q)&&this._setDefaultValue(q)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||N,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const N of Object.keys(this))"_"!==N[0]&&this._keys.push(N);if(this._externalProperties)for(const N in this._externalProperties)-1===this._keys.indexOf(N)&&this._keys.push(N)}isEqual(N){if(this._keys.length!==N._keys.length)return!1;for(let q=0;q<this._keys.length;q++){const R=this._keys[q];if(this[R]!==N[R])return!1}return!0}cloneTo(N){this._keys.length!==N._keys.length&&(N._keys=this._keys.slice(0));for(let q=0;q<this._keys.length;q++){const R=this._keys[q];N[R]=this[R]}}reset(){this._keys.forEach((N=>this._setDefaultValue(N)))}_setDefaultValue(N){var q,R,z,v;const B=(null===(q=this._externalProperties)||void 0===q||null===(R=q[N])||void 0===R?void 0:R.type)??typeof this[N],F=null===(z=this._externalProperties)||void 0===z||null===(v=z[N])||void 0===v?void 0:v.default;switch(B){case"number":this[N]=F??0;break;case"string":this[N]=F??"";break;default:this[N]=F??!1}}toString(){let N="";for(let q=0;q<this._keys.length;q++){const R=this._keys[q],z=this[R];switch(typeof z){case"number":case"string":N+="#define "+R+" "+z+"\n";break;default:z&&(N+="#define "+R+"\n")}}return N}}},11418:(N,q,R)=>{"use strict";R.d(q,{d:()=>v});var z=R(10957);class v{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(N){this._DiffuseTextureEnabled!==N&&(this._DiffuseTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(N){this._DetailTextureEnabled!==N&&(this._DetailTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(N){this._DecalMapEnabled!==N&&(this._DecalMapEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(N){this._AmbientTextureEnabled!==N&&(this._AmbientTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(N){this._OpacityTextureEnabled!==N&&(this._OpacityTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(N){this._ReflectionTextureEnabled!==N&&(this._ReflectionTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(N){this._EmissiveTextureEnabled!==N&&(this._EmissiveTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(N){this._SpecularTextureEnabled!==N&&(this._SpecularTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(N){this._BumpTextureEnabled!==N&&(this._BumpTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(N){this._LightmapTextureEnabled!==N&&(this._LightmapTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(N){this._RefractionTextureEnabled!==N&&(this._RefractionTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(N){this._ColorGradingTextureEnabled!==N&&(this._ColorGradingTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(N){this._FresnelEnabled!==N&&(this._FresnelEnabled=N,z.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(N){this._ClearCoatTextureEnabled!==N&&(this._ClearCoatTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(N){this._ClearCoatBumpTextureEnabled!==N&&(this._ClearCoatBumpTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(N){this._ClearCoatTintTextureEnabled!==N&&(this._ClearCoatTintTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(N){this._SheenTextureEnabled!==N&&(this._SheenTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(N){this._AnisotropicTextureEnabled!==N&&(this._AnisotropicTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(N){this._ThicknessTextureEnabled!==N&&(this._ThicknessTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(N){this._RefractionIntensityTextureEnabled!==N&&(this._RefractionIntensityTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(N){this._TranslucencyIntensityTextureEnabled!==N&&(this._TranslucencyIntensityTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(N){this._TranslucencyColorTextureEnabled!==N&&(this._TranslucencyColorTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(N){this._IridescenceTextureEnabled!==N&&(this._IridescenceTextureEnabled=N,z.d.MarkAllMaterialsAsDirty(1))}}v._DiffuseTextureEnabled=!0,v._DetailTextureEnabled=!0,v._DecalMapEnabled=!0,v._AmbientTextureEnabled=!0,v._OpacityTextureEnabled=!0,v._ReflectionTextureEnabled=!0,v._EmissiveTextureEnabled=!0,v._SpecularTextureEnabled=!0,v._BumpTextureEnabled=!0,v._LightmapTextureEnabled=!0,v._RefractionTextureEnabled=!0,v._ColorGradingTextureEnabled=!0,v._FresnelEnabled=!0,v._ClearCoatTextureEnabled=!0,v._ClearCoatBumpTextureEnabled=!0,v._ClearCoatTintTextureEnabled=!0,v._SheenTextureEnabled=!0,v._AnisotropicTextureEnabled=!0,v._ThicknessTextureEnabled=!0,v._RefractionIntensityTextureEnabled=!0,v._TranslucencyIntensityTextureEnabled=!0,v._TranslucencyColorTextureEnabled=!0,v._IridescenceTextureEnabled=!0},11379:(N,q,R)=>{"use strict";R.d(q,{D:()=>n,E:()=>c,G:()=>u,J:()=>f,K:()=>h,O:()=>G,S:()=>s,U:()=>Z,W:()=>M,X:()=>x,b:()=>H,c:()=>E,e:()=>T,i:()=>y,j:()=>e,l:()=>b,p:()=>D,t:()=>Q,u:()=>V,w:()=>L,x:()=>X,z:()=>t});var z=R(10907),v=R(11213),B=R(10933),F=R(11318),S=R(11386);const A=v.c.Black();function y(N,q,R){if(!N||N.LOGARITHMICDEPTH||N.indexOf&&N.indexOf("LOGARITHMICDEPTH")>=0){const N=R.activeCamera;1===N.mode&&z.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),q.setFloat("logarithmicDepthConstant",2/(Math.log(N.maxZ+1)/Math.LN2))}}function E(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];R&&N.fogEnabled&&(!q||q.applyFog)&&0!==N.fogMode&&(R.setFloat4("vFogInfos",N.fogMode,N.fogStart,N.fogEnd,N.fogDensity),z?(N.fogColor.toLinearSpaceToRef(A,N.getEngine().useExactSrgbConversions),R.setColor3("vFogColor",A)):R.setColor3("vFogColor",N.fogColor))}function t(N,q,R){const v=R.NUM_MORPH_INFLUENCERS;if(v>0&&B.b.LastCreatedEngine){const F=B.b.LastCreatedEngine.getCaps().maxVertexAttribs,S=q.morphTargetManager;if(null!==S&&void 0!==S&&S.isUsingTextureForTargets)return;const A=S&&S.supportsNormals&&R.NORMAL,y=S&&S.supportsTangents&&R.TANGENT,E=S&&S.supportsUVs&&R.UV1;for(let R=0;R<v;R++)N.push("position"+R),A&&N.push("normal"+R),y&&N.push("tangent"+R),E&&N.push("uv_"+R),N.length>F&&z.c.Error("Cannot add more vertex attributes for mesh "+q.name)}}function x(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N.push("world0"),N.push("world1"),N.push("world2"),N.push("world3"),q&&(N.push("previousWorld0"),N.push("previousWorld1"),N.push("previousWorld2"),N.push("previousWorld3"))}function e(N,q){const R=N.morphTargetManager;N&&R&&q.setFloatArray("morphTargetInfluences",R.influences)}function b(N,q){q.bindToEffect(N,"Scene")}function f(N,q,R){q._needUVs=!0,q[R]=!0,N.optimizeUVAllocation&&N.getTextureMatrix().isIdentityAs3x2()?(q[R+"DIRECTUV"]=N.coordinatesIndex+1,q["MAINUV"+(N.coordinatesIndex+1)]=!0):q[R+"DIRECTUV"]=0}function D(N,q,R){const z=N.getTextureMatrix();q.Hj(R+"Matrix",z)}function V(N,q,R){R.BAKED_VERTEX_ANIMATION_TEXTURE&&R.INSTANCES&&N.push("bakedVertexAnimationSettingsInstanced")}function H(N,q,R){var z;if(q&&N&&(N.computeBonesUsingShaders&&q._bonesComputationForcedToCPU&&(N.computeBonesUsingShaders=!1),N.useBones&&N.computeBonesUsingShaders&&N.skeleton)){const v=N.skeleton;if(v.isUsingTextureForMatrices&&q.getUniformIndex("boneTextureWidth")>-1){const R=v.getTransformMatrixTexture(N);q.setTexture("boneSampler",R),q.setFloat("boneTextureWidth",4*(v.bones.length+1))}else{const B=v.getTransformMatrices(N);B&&(q.setMatrices("mBones",B),R&&N.va().prePassRenderer&&N.va().prePassRenderer.getIndex(2)&&(R.previousBones[N.uniqueId]||(R.previousBones[N.uniqueId]=B.slice()),q.setMatrices("mPreviousBones",R.previousBones[N.uniqueId]),z=B,R.previousBones[N.uniqueId].set(z)))}}}function Y(N,q,R,z,v){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];N._bindLight(q,R,z,v,B)}function T(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const B=Math.min(q.lightSources.length,v);for(let F=0;F<B;F++){Y(q.lightSources[F],F,N,R,"boolean"===typeof z?z:z.SPECULARTERM,q.receiveShadows)}}function L(N,q,R,z){R.NUM_BONE_INFLUENCERS>0&&(z.addCPUSkinningFallback(0,q),N.push("matricesIndices"),N.push("matricesWeights"),R.NUM_BONE_INFLUENCERS>4&&(N.push("matricesIndicesExtra"),N.push("matricesWeightsExtra")))}function X(N,q){(q.INSTANCES||q.THIN_INSTANCES)&&x(N,!!q.PREPASS_VELOCITY),q.INSTANCESCOLOR&&N.push("instanceColor")}function Q(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=0;for(let B=0;B<R&&N["LIGHT"+B];B++)B>0&&(v=z+B,q.addFallback(v,"LIGHT"+B)),N.SHADOWS||(N["SHADOW"+B]&&q.addFallback(z,"SHADOW"+B),N["SHADOWPCF"+B]&&q.addFallback(z,"SHADOWPCF"+B),N["SHADOWPCSS"+B]&&q.addFallback(z,"SHADOWPCSS"+B),N["SHADOWPOISSON"+B]&&q.addFallback(z,"SHADOWPOISSON"+B),N["SHADOWESM"+B]&&q.addFallback(z,"SHADOWESM"+B),N["SHADOWCLOSEESM"+B]&&q.addFallback(z,"SHADOWCLOSEESM"+B));return v++}function h(N,q,R,z,v,B,F){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];F._areMiscDirty&&(F.LOGARITHMICDEPTH=R,F.POINTSIZE=z,F.FOG=v&&function(N,q){return q.fogEnabled&&N.applyFog&&0!==q.fogMode}(N,q),F.NONUNIFORMSCALING=N.nonUniformScaling,F.ALPHATEST=B,F.DECAL_AFTER_DETAIL=S)}function u(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R._areLightsDirty)return R._needNormals;let F=0;const S={needNormals:R._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(N.lightsEnabled&&!B)for(const y of q.lightSources)if(w(N,q,y,F,R,z,S),F++,F===v)break;R.SPECULARTERM=S.specularEnabled,R.SHADOWS=S.shadowEnabled;for(let y=F;y<v;y++)void 0!==R["LIGHT"+y]&&(R["LIGHT"+y]=!1,R["HEMILIGHT"+y]=!1,R["POINTLIGHT"+y]=!1,R["DIRLIGHT"+y]=!1,R["SPOTLIGHT"+y]=!1,R["SHADOW"+y]=!1,R["SHADOWCSM"+y]=!1,R["SHADOWCSMDEBUG"+y]=!1,R["SHADOWCSMNUM_CASCADES"+y]=!1,R["SHADOWCSMUSESHADOWMAXZ"+y]=!1,R["SHADOWCSMNOBLEND"+y]=!1,R["SHADOWCSM_RIGHTHANDED"+y]=!1,R["SHADOWPCF"+y]=!1,R["SHADOWPCSS"+y]=!1,R["SHADOWPOISSON"+y]=!1,R["SHADOWESM"+y]=!1,R["SHADOWCLOSEESM"+y]=!1,R["SHADOWCUBE"+y]=!1,R["SHADOWLOWQUALITY"+y]=!1,R["SHADOWMEDIUMQUALITY"+y]=!1);const A=N.getEngine().getCaps();return void 0===R.SHADOWFLOAT&&(S.needRebuild=!0),R.SHADOWFLOAT=S.shadowEnabled&&(A.textureFloatRender&&A.textureFloatLinearFiltering||A.textureHalfFloatRender&&A.textureHalfFloatLinearFiltering),R.LIGHTMAPEXCLUDED=S.lightmapMode,S.needRebuild&&R.rebuild(),S.needNormals}function w(N,q,R,z,v,B,S){switch(S.needNormals=!0,void 0===v["LIGHT"+z]&&(S.needRebuild=!0),v["LIGHT"+z]=!0,v["SPOTLIGHT"+z]=!1,v["HEMILIGHT"+z]=!1,v["POINTLIGHT"+z]=!1,v["DIRLIGHT"+z]=!1,R.prepareLightSpecificDefines(v,z),v["LIGHT_FALLOFF_PHYSICAL"+z]=!1,v["LIGHT_FALLOFF_GLTF"+z]=!1,v["LIGHT_FALLOFF_STANDARD"+z]=!1,R.falloffType){case F.d.FALLOFF_GLTF:v["LIGHT_FALLOFF_GLTF"+z]=!0;break;case F.d.FALLOFF_PHYSICAL:v["LIGHT_FALLOFF_PHYSICAL"+z]=!0;break;case F.d.FALLOFF_STANDARD:v["LIGHT_FALLOFF_STANDARD"+z]=!0}if(B&&!R.Dh.equalsFloats(0,0,0)&&(S.specularEnabled=!0),v["SHADOW"+z]=!1,v["SHADOWCSM"+z]=!1,v["SHADOWCSMDEBUG"+z]=!1,v["SHADOWCSMNUM_CASCADES"+z]=!1,v["SHADOWCSMUSESHADOWMAXZ"+z]=!1,v["SHADOWCSMNOBLEND"+z]=!1,v["SHADOWCSM_RIGHTHANDED"+z]=!1,v["SHADOWPCF"+z]=!1,v["SHADOWPCSS"+z]=!1,v["SHADOWPOISSON"+z]=!1,v["SHADOWESM"+z]=!1,v["SHADOWCLOSEESM"+z]=!1,v["SHADOWCUBE"+z]=!1,v["SHADOWLOWQUALITY"+z]=!1,v["SHADOWMEDIUMQUALITY"+z]=!1,q&&q.receiveShadows&&N.shadowsEnabled&&R.shadowEnabled){const q=R.getShadowGenerator(N.activeCamera)??R.getShadowGenerator();if(q){const N=q.getShadowMap();N&&N.renderList&&N.renderList.length>0&&(S.shadowEnabled=!0,q.prepareDefines(v,z))}}R.lightmapMode!=F.d.LIGHTMAP_DEFAULT?(S.lightmapMode=!0,v["LIGHTMAPEXCLUDED"+z]=!0,v["LIGHTMAPNOSPECULAR"+z]=R.lightmapMode==F.d.LIGHTMAP_SHADOWSONLY):(v["LIGHTMAPEXCLUDED"+z]=!1,v["LIGHTMAPNOSPECULAR"+z]=!1)}function c(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=function(N,q){let R=!1;if(N.activeCamera){const z=q.CAMERA_ORTHOGRAPHIC?1:0,v=q.CAMERA_PERSPECTIVE?1:0,B=1===N.activeCamera.mode?1:0,F=0===N.activeCamera.mode?1:0;(z^B||v^F)&&(q.CAMERA_ORTHOGRAPHIC=1===B,q.CAMERA_PERSPECTIVE=1===F,R=!0)}return R}(N,z);!1!==B&&(A=(0,S.f)(R,N,z)),z.DEPTHPREPASS!==!q.getColorWrite()&&(z.DEPTHPREPASS=!z.DEPTHPREPASS,A=!0),z.INSTANCES!==v&&(z.INSTANCES=v,A=!0),z.THIN_INSTANCES!==F&&(z.THIN_INSTANCES=F,A=!0),A&&z.markAsUnprocessed()}function n(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!q._areAttributesDirty&&q._needNormals===q._normals&&q._needUVs===q._uvs)return!1;q._normals=q._needNormals,q._uvs=q._needUVs,q.NORMAL=q._needNormals&&N.isVerticesDataPresent("normal"),q._needNormals&&N.isVerticesDataPresent("tangent")&&(q.TANGENT=!0);for(let S=1;S<=6;++S)q["UV"+S]=!!q._needUVs&&N.isVerticesDataPresent(`uv${1===S?"":S}`);if(R){const R=N.useVertexColors&&N.isVerticesDataPresent("color");q.VERTEXCOLOR=R,q.VERTEXALPHA=N.hasVertexAlpha&&R&&B}return N.isVerticesDataPresent("instanceColor")&&(N.hasInstances||N.hasThinInstances)&&(q.INSTANCESCOLOR=!0),z&&function(N,q){if(N.useBones&&N.computeBonesUsingShaders&&N.skeleton){q.NUM_BONE_INFLUENCERS=N.numBoneInfluencers;const R=void 0!==q.BONETEXTURE;if(N.skeleton.isUsingTextureForMatrices&&R)q.BONETEXTURE=!0;else{q.BonesPerMesh=N.skeleton.bones.length+1,q.BONETEXTURE=!R&&void 0;const z=N.va().prePassRenderer;if(z&&z.enabled){const R=-1===z.excludedSkinnedMesh.indexOf(N);q.BONES_VELOCITY_ENABLED=R}}}else q.NUM_BONE_INFLUENCERS=0,q.BonesPerMesh=0,void 0!==q.BONETEXTURE&&(q.BONETEXTURE=!1)}(N,q),v&&function(N,q){const R=N.morphTargetManager;R?(q.MORPHTARGETS_UV=R.supportsUVs&&q.UV1,q.MORPHTARGETS_TANGENT=R.supportsTangents&&q.TANGENT,q.MORPHTARGETS_NORMAL=R.supportsNormals&&q.NORMAL,q.NUM_MORPH_INFLUENCERS=R.numMaxInfluencers||R.numInfluencers,q.MORPHTARGETS=q.NUM_MORPH_INFLUENCERS>0,q.MORPHTARGETS_TEXTURE=R.isUsingTextureForTargets):(q.MORPHTARGETS_UV=!1,q.MORPHTARGETS_TANGENT=!1,q.MORPHTARGETS_NORMAL=!1,q.MORPHTARGETS=!1,q.NUM_MORPH_INFLUENCERS=0)}(N,q),F&&function(N,q){const R=N.bakedVertexAnimationManager;q.BAKED_VERTEX_ANIMATION_TEXTURE=!(!R||!R.isEnabled)}(N,q),!0}function G(N,q){if(N.activeCamera){const R=q.MULTIVIEW;q.MULTIVIEW=null!==N.activeCamera.outputRenderTarget&&N.activeCamera.outputRenderTarget.getViewCount()>1,q.MULTIVIEW!=R&&q.markAsUnprocessed()}}function s(N,q,R){const z=q.ORDER_INDEPENDENT_TRANSPARENCY,v=q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;q.ORDER_INDEPENDENT_TRANSPARENCY=N.useOrderIndependentTransparency&&R,q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!N.getEngine().getCaps().textureFloatLinearFiltering,z===q.ORDER_INDEPENDENT_TRANSPARENCY&&v===q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||q.markAsUnprocessed()}function Z(N,q,R){const z=q.PREPASS;if(!q._arePrePassDirty)return;const v=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(N.prePassRenderer&&N.prePassRenderer.enabled&&R){q.PREPASS=!0,q.SCENE_MRT_COUNT=N.prePassRenderer.mrtCount,q.PREPASS_NORMAL_WORLDSPACE=N.prePassRenderer.generateNormalsInWorldSpace,q.PREPASS_COLOR=!0,q.PREPASS_COLOR_INDEX=0;for(let R=0;R<v.length;R++){const z=N.prePassRenderer.getIndex(v[R].type);-1!==z?(q[v[R].define]=!0,q[v[R].index]=z):q[v[R].define]=!1}}else{q.PREPASS=!1;for(let N=0;N<v.length;N++)q[v[N].define]=!1}q.PREPASS!=z&&(q.markAsUnprocessed(),q.markAsImageProcessingDirty())}function J(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];v&&v.push("Light"+N),B||(q.push("vLightData"+N,"vLightDiffuse"+N,"vLightSpecular"+N,"vLightDirection"+N,"vLightFalloff"+N,"vLightGround"+N,"lightMatrix"+N,"shadowsInfo"+N,"depthValues"+N),R.push("shadowTexture"+N),R.push("depthTexture"+N),q.push("viewFrustumZ"+N,"cascadeBlendFactor"+N,"lightSizeUVCorrection"+N,"depthCorrection"+N,"penumbraDarkness"+N,"frustumLengths"+N),z&&(R.push("projectionLightTexture"+N),q.push("textureProjectionMatrix"+N)))}function M(N,q,R){let z,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,B=null;if(N.uniformsNames){const F=N;z=F.uniformsNames,B=F.uniformBuffersNames,q=F.samplers,R=F.defines,v=F.maxSimultaneousLights||0}else z=N,q||(q=[]);for(let F=0;F<v&&R["LIGHT"+F];F++)J(F,z,q,R["PROJECTEDLIGHTTEXTURE"+F],B);R.NUM_MORPH_INFLUENCERS&&(z.push("morphTargetInfluences"),z.push("morphTargetCount")),R.BAKED_VERTEX_ANIMATION_TEXTURE&&(z.push("bakedVertexAnimationSettings"),z.push("bakedVertexAnimationTextureSizeInverted"),z.push("bakedVertexAnimationTime"),q.push("bakedVertexAnimationTexture"))}},11438:(N,q,R)=>{"use strict";R.d(q,{d:()=>B});var z,v=R(11181);!function(N){N[N.Zero=0]="Zero",N[N.One=1]="One",N[N.MaxViewZ=2]="MaxViewZ"}(z||(z={}));class B{static CreateConfiguration(N){return B._Configurations[N]={defines:{},previousWorldMatrices:{},previousViewProjection:v.d.Zero(),currentViewProjection:v.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},B._Configurations[N]}static DeleteConfiguration(N){delete B._Configurations[N]}static GetConfiguration(N){return B._Configurations[N]}static AddUniformsAndSamplers(N,q){N.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(N,q){for(const R of q)if(R.lg)for(const q of R.lg)q._removeDrawWrapper(N)}static PrepareDefines(N,q,R){if(!R._arePrePassDirty)return;const z=B._Configurations[N];if(!z)return;R.PREPASS=!0,R.PREPASS_COLOR=!1,R.PREPASS_COLOR_INDEX=-1;let v=0;for(let F=0;F<B.GeometryTextureDescriptions.length;F++){const N=B.GeometryTextureDescriptions[F],q=N.define,S=N.defineIndex,A=z.defines[S];void 0!==A?(R[q]=!0,R[S]=A,v++):(R[q]=!1,delete R[S])}R.SCENE_MRT_COUNT=v,R.BONES_VELOCITY_ENABLED=q.useBones&&q.computeBonesUsingShaders&&q.skeleton&&!q.skeleton.isUsingTextureForMatrices&&-1===z.excludedSkinnedMesh.indexOf(q)}static Bind(N,q,R,z){const v=B._Configurations[N];if(v&&(void 0!==v.defines.PREPASS_VELOCITY_INDEX||void 0!==v.defines.PREPASS_VELOCITY_LINEAR_INDEX)){v.previousWorldMatrices[R.uniqueId]||(v.previousWorldMatrices[R.uniqueId]=z.clone());const N=R.va();v.previousViewProjection||(v.previousViewProjection=N.getTransformMatrix().clone(),v.currentViewProjection=N.getTransformMatrix().clone());const B=N.getEngine();if(v.currentViewProjection.updateFlag!==N.getTransformMatrix().updateFlag?(v.lastUpdateFrameId=B.frameId,v.previousViewProjection.p(v.currentViewProjection),v.currentViewProjection.p(N.getTransformMatrix())):v.lastUpdateFrameId!==B.frameId&&(v.lastUpdateFrameId=B.frameId,v.previousViewProjection.p(v.currentViewProjection)),q.setMatrix("previousWorld",v.previousWorldMatrices[R.uniqueId]),q.setMatrix("previousViewProjection",v.previousViewProjection),v.previousWorldMatrices[R.uniqueId]=z.clone(),R.useBones&&R.computeBonesUsingShaders&&R.skeleton){const N=R.skeleton;if(!N.isUsingTextureForMatrices||-1===q.getUniformIndex("boneTextureWidth")){const z=N.getTransformMatrices(R);z&&(v.previousBones[R.uniqueId]||(v.previousBones[R.uniqueId]=z.slice()),q.setMatrices("mPreviousBones",v.previousBones[R.uniqueId]),v.previousBones[R.uniqueId].set(z))}}}}}B.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],B._Configurations={}},11436:(N,q,R)=>{"use strict";R.d(q,{d:()=>V});var z=R(11147),v=R(11151),B=R(11332),F=R(10933),S=R(10949),A=R(10966);const y=new RegExp("^([gimus]+)!");class E{constructor(N){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=N,this._scene=N.va(),this._engine=this._scene.getEngine()}_addPlugin(N){for(let z=0;z<this._plugins.length;++z)if(this._plugins[z].name===N.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!N.isCompatible(this._material.shaderLanguage))throw`The plugin "${N.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const q=N.getClassName();E._MaterialPluginClassToMainDefine[q]||(E._MaterialPluginClassToMainDefine[q]="MATERIALPLUGIN_"+ ++E._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(N,q)=>this._handlePluginEvent(N,q),this._plugins.push(N),this._plugins.sort(((N,q)=>N.priority-q.priority)),this._codeInjectionPoints={};const R={};R[E._MaterialPluginClassToMainDefine[q]]={type:"boolean",default:!0};for(const z of this._plugins)z.collectDefines(R),this._collectPointNames("vertex",z.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",z.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=R,!0}_activatePlugin(N){-1===this._activePlugins.indexOf(N)&&(this._activePlugins.push(N),this._activePlugins.sort(((N,q)=>N.priority-q.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),N.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(N),this._activePluginsForExtraEvents.sort(((N,q)=>N.priority-q.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(N){for(let q=0;q<this._plugins.length;++q)if(this._plugins[q].name===N)return this._plugins[q];return null}_handlePluginEventIsReadyForSubMesh(N){let q=!0;for(const R of this._activePlugins)q=q&&R.isReadyForSubMesh(N.defines,this._scene,this._engine,N.subMesh);N.isReadyForSubMesh=q}_handlePluginEventPrepareDefinesBeforeAttributes(N){for(const q of this._activePlugins)q.prepareDefinesBeforeAttributes(N.defines,this._scene,N.mesh)}_handlePluginEventPrepareDefines(N){for(const q of this._activePlugins)q.prepareDefines(N.defines,this._scene,N.mesh)}_handlePluginEventHardBindForSubMesh(N){for(const q of this._activePluginsForExtraEvents)q.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,N.subMesh)}_handlePluginEventBindForSubMesh(N){for(const q of this._activePlugins)q.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,N.subMesh)}_handlePluginEventHasRenderTargetTextures(N){let q=!1;for(const R of this._activePluginsForExtraEvents)if(q=R.hasRenderTargetTextures(),q)break;N.hasRenderTargetTextures=q}_handlePluginEventFillRenderTargetTextures(N){for(const q of this._activePluginsForExtraEvents)q.fillRenderTargetTextures(N.renderTargets)}_handlePluginEvent(N,q){switch(N){case 512:{const N=q;for(const q of this._activePlugins)q.getActiveTextures(N.activeTextures);break}case 256:{const N=q;for(const q of this._activePlugins)q.getAnimatables(N.animatables);break}case 1024:{const N=q;let R=!1;for(const q of this._activePlugins)if(R=q.hasTexture(N.texture),R)break;N.hasTexture=R;break}case 2:{const N=q;for(const q of this._plugins)q.dispose(N.forceDisposeTextures);break}case 4:q.defineNames=this._defineNamesFromPlugins;break;case 128:{const N=q;for(const q of this._activePlugins)N.fallbackRank=q.addFallbacks(N.defines,N.fallbacks,N.fallbackRank),q.getAttributes(N.attributes,this._scene,N.mesh);this._uniformList.length>0&&N.uniforms.push(...this._uniformList),this._samplerList.length>0&&N.samplers.push(...this._samplerList),this._uboList.length>0&&N.uniformBuffersNames.push(...this._uboList),N.customCode=this._injectCustomCode(N,N.customCode);break}case 8:{const N=q;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const R=1===this._material.shaderLanguage;for(const q of this._plugins){const z=q.getUniforms(this._material.shaderLanguage);if(z){if(z.ubo)for(const q of z.ubo){if(q.size&&q.type){const z=q.arraySize??0;if(N.ubo.addUniform(q.name,q.size,z),R){let N;switch(q.type){case"mat4":N="mat4x4f";break;case"float":N="f32";break;default:N=`${q.type}f`}this._uboDeclaration+=`uniform ${q.name}: ${N}${z>0?`[${z}]`:""};\n`}else this._uboDeclaration+=`${q.type} ${q.name}${z>0?`[${z}]`:""};\n`}this._uniformList.push(q.name)}z.vertex&&(this._vertexDeclaration+=z.vertex+"\n"),z.fragment&&(this._fragmentDeclaration+=z.fragment+"\n")}q.getSamplers(this._samplerList),q.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(N,q){if(q)for(const R in q)this._codeInjectionPoints[N]||(this._codeInjectionPoints[N]={}),this._codeInjectionPoints[N][R]=!0}_injectCustomCode(N,q){return(R,z)=>{var v;q&&(z=q(R,z)),this._uboDeclaration&&(z=z.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(z=z.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(z=z.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const B=null===(v=this._codeInjectionPoints)||void 0===v?void 0:v[R];if(!B)return z;let F=null;for(let q in B){let v="";for(const z of this._activePlugins){var E;let B=null===(E=z.getCustomCode(R,this._material.shaderLanguage))||void 0===E?void 0:E[q];if(B){if(z.resolveIncludes){if(null===F){const q=0;F={defines:[],indexParameters:N.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:A.e.GetShadersRepository(q),includesShadersStore:A.e.GetIncludesShadersStore(q),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}F.isFragment="fragment"===R,(0,S.f)(B,F,(N=>B=N))}v+=B+"\n"}}if(v.length>0)if("!"===q.charAt(0)){q=q.substring(1);let N="g";if("!"===q.charAt(0))N="",q=q.substring(1);else{const R=y.exec(q);R&&R.length>=2&&(N=R[1],q=q.substring(N.length+1))}N.indexOf("g")<0&&(N+="g");const R=z,B=new RegExp(q,N);let F=B.exec(R);for(;null!==F;){let N=v;for(let q=0;q<F.length;++q)N=N.replace("$"+q,F[q]);z=z.replace(F[0],N),F=B.exec(R)}}else{const N="#define "+q;z=z.replace(N,"\n"+v+"\n"+N)}}return z}}}E._MaterialPluginClassToMainDefine={},E._MaterialPluginCounter=0,F.b.OnEnginesDisposedObservable.add((()=>{b()}));const t=[];let x=!1,e=null;function b(){t.length=0,x=!1,B.d.OnEventObservable.remove(e),e=null}var f=R(11221),D=R(11002);class V{isCompatible(N){return 0===N}_enable(N){N&&this._pluginManager._activatePlugin(this)}constructor(N,q,R,z){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=N,this.name=q,this.priority=R,this.resolveIncludes=F,N.pluginManager||(N.pluginManager=new E(N),N.jj.add((()=>{N.pluginManager=void 0}))),this._pluginDefineNames=z,this._pluginManager=N.pluginManager,v&&this._pluginManager._addPlugin(this),B&&this._enable(!0),this.markAllDefinesAsDirty=N._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(N,q,R,z){return!0}hardBindForSubMesh(N,q,R,z){}bindForSubMesh(N,q,R,z){}dispose(N){}getCustomCode(N){return null}collectDefines(N){if(this._pluginDefineNames)for(const q of Object.keys(this._pluginDefineNames)){if("_"===q[0])continue;const R=typeof this._pluginDefineNames[q];N[q]={type:"number"===R?"number":"string"===R?"string":"boolean"===R?"boolean":"object",default:this._pluginDefineNames[q]}}}prepareDefinesBeforeAttributes(N,q,R){}prepareDefines(N,q,R){}hasTexture(N){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(N){}getActiveTextures(N){}getAnimatables(N){}addFallbacks(N,q,R){return R}getSamplers(N){}getAttributes(N,q,R){}getUniformBuffersNames(N){}getUniforms(){return{}}copyTo(N){f.e.Clone((()=>N),this)}serialize(){return f.e.Serialize(this)}parse(N,q,R){f.e.Parse((()=>this),N,q,R)}}(0,z.c)([(0,v.D)()],V.prototype,"name",void 0),(0,z.c)([(0,v.D)()],V.prototype,"priority",void 0),(0,z.c)([(0,v.D)()],V.prototype,"resolveIncludes",void 0),(0,z.c)([(0,v.D)()],V.prototype,"registerForExtraEvents",void 0),(0,D.f)("BABYLON.MaterialPluginBase",V)},11503:(N,q,R)=>{"use strict";R.d(q,{e:()=>F});var z=R(11332),v=R(11178),B=R(11002);class F extends z.d{get mg(){return this._subMaterials}set mg(N){this._subMaterials=N,this._hookArray(N)}getChildren(){return this.mg}constructor(N,q){super(N,q,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.mg=[],this._storeEffectOnSubMeshes=!0}_hookArray(N){var q=this;const R=N.push;N.push=function(){for(var z=arguments.length,v=new Array(z),B=0;B<z;B++)v[B]=arguments[B];const F=R.apply(N,v);return q._markAllSubMeshesAsTexturesDirty(),F};const z=N.splice;N.splice=(q,R)=>{const v=z.apply(N,[q,R]);return this._markAllSubMeshesAsTexturesDirty(),v}}getSubMaterial(N){return N<0||N>=this.mg.length?this.va().defaultMaterial:this.mg[N]}getActiveTextures(){return super.getActiveTextures().concat(...this.mg.map((N=>N?N.getActiveTextures():[])))}hasTexture(N){if(super.hasTexture(N))return!0;for(let R=0;R<this.mg.length;R++){var q;if(null!==(q=this.mg[R])&&void 0!==q&&q.hasTexture(N))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(N,q,R){for(let z=0;z<this.mg.length;z++){const v=this.mg[z];if(v){if(v._storeEffectOnSubMeshes){if(!v.isReadyForSubMesh(N,q,R))return!1;continue}if(!v.isReady(N))return!1}}return!0}clone(N,q){const R=new F(N,this.va());for(let z=0;z<this.mg.length;z++){let v=null;const B=this.mg[z];v=q&&B?B.clone(N+"-"+B.name):this.mg[z],R.mg.push(v)}return R}serialize(){const N={};N.name=this.name,N.id=this.id,N.uniqueId=this.uniqueId,v.b&&(N.tags=v.b.GetTags(this)),N.materialsUniqueIds=[],N.materials=[];for(let q=0;q<this.mg.length;q++){const R=this.mg[q];R?(N.materialsUniqueIds.push(R.uniqueId),N.materials.push(R.id)):(N.materialsUniqueIds.push(null),N.materials.push(null))}return N}dispose(N,q,R){const z=this.va();if(!z)return;if(R)for(let B=0;B<this.mg.length;B++){const R=this.mg[B];R&&R.dispose(N,q)}const v=z.multiMaterials.indexOf(this);v>=0&&z.multiMaterials.splice(v,1),super.dispose(N,q)}static ParseMultiMaterial(N,q){const R=new F(N.name,q);return R.id=N.id,R._loadedUniqueId=N.uniqueId,v.b&&v.b.AddTagsTo(R,N.tags),N.materialsUniqueIds?R._waitingSubMaterialsUniqueIds=N.materialsUniqueIds:N.materials.forEach((N=>R.mg.push(q.getLastMaterialById(N)))),R}}(0,B.f)("BABYLON.MultiMaterial",F)},11326:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(N){N.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(N){}bindForSubMesh(N,q,R,z,v){if(q.prePassRenderer&&q.prePassRenderer.enabled&&q.prePassRenderer.currentRTisSceneRT&&(-1!==q.prePassRenderer.getIndex(2)||-1!==q.prePassRenderer.getIndex(11))){this.previousWorldMatrices[R.uniqueId]||(this.previousWorldMatrices[R.uniqueId]=z.clone()),this.previousViewProjection||(this.previousViewProjection=q.getTransformMatrix().clone(),this.currentViewProjection=q.getTransformMatrix().clone());const v=q.getEngine();this.currentViewProjection.updateFlag!==q.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=v.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(q.getTransformMatrix())):this._lastUpdateFrameId!==v.frameId&&(this._lastUpdateFrameId=v.frameId,this.previousViewProjection.p(this.currentViewProjection)),N.setMatrix("previousWorld",this.previousWorldMatrices[R.uniqueId]),N.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[R.uniqueId]=z.clone()}}}},11393:(N,q,R)=>{"use strict";R.d(q,{b:()=>B});var z=R(11181),v=R(11332);class B extends v.d{constructor(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(N,q,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new z.d,this._storeEffectOnSubMeshes=R}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(N,q){return!!N&&(!this._storeEffectOnSubMeshes||(!N.lg||0===N.lg.length||this.isReadyForSubMesh(N,N.lg[0],q)))}_isReadyForSubMesh(N){const q=N.materialDefines;return!(this.checkReadyOnEveryCall||!N.effect||!q||q._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(N){this._activeEffect.setMatrix("world",N)}bindOnlyNormalMatrix(N){this._activeEffect.setMatrix("normalMatrix",N)}bind(N,q){q&&this.bindForSubMesh(N,q,q.lg[0])}_afterBind(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;super._afterBind(N,q,R),this.va()._cachedEffect=q,R?R._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return R._drawWrapper._forceRebindOnNextCall||N.isCachedMaterialInvalid(this,q,z)}dispose(N,q,R){this._activeEffect=void 0,super.dispose(N,q,R)}}},11144:(N,q,R)=>{"use strict";R.d(q,{b:()=>w});var z=R(11147),v=R(11151),B=R(11167),F=R(11172),S=R(11181),A=R(11213),y=R(11251),E=R(11326),t=R(11206),x=R(11332),e=R(11391),b=R(11393),f=R(11402),D=R(11002),V=R(11418),H=R(11421),Y=R(11429),T=R(11386),L=R(11379),X=R(11221),Q=R(11438);const h={effect:null,subMesh:null};class u extends e.c{constructor(N){super(N),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(N){const q=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const R of q)this[R]=R===N}}class w extends b.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=N||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(N){this.imageProcessingConfiguration.colorCurvesEnabled=N}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(N){this.imageProcessingConfiguration.colorGradingEnabled=N}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(N){this._imageProcessingConfiguration.toneMappingEnabled=N}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(N){this._imageProcessingConfiguration.exposure=N}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(N){this._imageProcessingConfiguration.contrast=N}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(N){this._imageProcessingConfiguration.colorGradingTexture=N}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(N){this._imageProcessingConfiguration.colorCurves=N}get canRenderToMRT(){return!0}constructor(N,q){super(N,q,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||w.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new A.c(0,0,0),this.diffuseColor=new A.c(1,1,1),this.specularColor=new A.c(1,1,1),this.emissiveColor=new A.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new B.h(16),this._worldViewProjectionMatrix=S.d.Zero(),this._globalAmbientColor=new A.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new Y.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new E.d,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),w.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),w.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(w.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(w.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"mb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===x.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Fe&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==x.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Fe||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(N,q){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const v=q._drawWrapper;if(v.effect&&this.isFrozen&&v._wasPreviouslyReady&&v._wasPreviouslyUsingInstances===z)return!0;q.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),q.materialDefines=new u(this._eventInfo.defineNames));const B=this.va(),F=q.materialDefines;if(this._isReadyForSubMesh(q))return!0;const S=B.getEngine();F._needNormals=(0,L.G)(B,N,F,!0,this._maxSimultaneousLights,this._disableLighting),(0,L.O)(B,F);const A=this.needAlphaBlendingForMesh(N)&&this.va().useOrderIndependentTransparency;if((0,L.U)(B,F,this.canRenderToMRT&&!A),(0,L.S)(B,F,A),Q.d.PrepareDefines(S.currentRenderPassId,N,F),F._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,F._needUVs=!1;for(let N=1;N<=6;++N)F["MAINUV"+N]=!1;if(B.texturesEnabled){if(F.DIFFUSEDIRECTUV=0,F.BUMPDIRECTUV=0,F.AMBIENTDIRECTUV=0,F.OPACITYDIRECTUV=0,F.EMISSIVEDIRECTUV=0,F.SPECULARDIRECTUV=0,F.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&w.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._diffuseTexture,F,"DIFFUSE")}else F.DIFFUSE=!1;if(this._ambientTexture&&w.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._ambientTexture,F,"AMBIENT")}else F.AMBIENT=!1;if(this._opacityTexture&&w.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._opacityTexture,F,"OPACITY"),F.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else F.OPACITY=!1;if(this._reflectionTexture&&w.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(F._needNormals=!0,F.REFLECTION=!0,F.ROUGHNESS=this._roughness>0,F.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,F.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===f.c.INVCUBIC_MODE,F.REFLECTIONMAP_3D=this._reflectionTexture.isCube,F.REFLECTIONMAP_OPPOSITEZ=F.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,F.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case f.c.EXPLICIT_MODE:F.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case f.c.PLANAR_MODE:F.setReflectionMode("REFLECTIONMAP_PLANAR");break;case f.c.PROJECTION_MODE:F.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case f.c.SKYBOX_MODE:F.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case f.c.SPHERICAL_MODE:F.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case f.c.EQUIRECTANGULAR_MODE:F.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case f.c.FIXED_EQUIRECTANGULAR_MODE:F.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case f.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:F.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case f.c.CUBIC_MODE:case f.c.INVCUBIC_MODE:default:F.setReflectionMode("REFLECTIONMAP_CUBIC")}F.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else F.REFLECTION=!1,F.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&w.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._emissiveTexture,F,"EMISSIVE")}else F.EMISSIVE=!1;if(this._lightmapTexture&&w.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._lightmapTexture,F,"LIGHTMAP"),F.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,F.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else F.LIGHTMAP=!1;if(this._specularTexture&&w.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._specularTexture,F,"SPECULAR"),F.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else F.SPECULAR=!1;if(B.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&w.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,L.J)(this._bumpTexture,F,"BUMP"),F.PARALLAX=this._useParallax,F.PARALLAX_RHS=B.useRightHandedSystem,F.PARALLAXOCCLUSION=this._useParallaxOcclusion,F.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else F.BUMP=!1,F.PARALLAX=!1,F.PARALLAX_RHS=!1,F.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&w.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;F._needUVs=!0,F.REFRACTION=!0,F.REFRACTIONMAP_3D=this._refractionTexture.isCube,F.RGBDREFRACTION=this._refractionTexture.isRGBD,F.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else F.REFRACTION=!1;F.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else F.DIFFUSE=!1,F.AMBIENT=!1,F.OPACITY=!1,F.REFLECTION=!1,F.EMISSIVE=!1,F.LIGHTMAP=!1,F.BUMP=!1,F.REFRACTION=!1;F.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),F.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,F.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,F.SPECULAROVERALPHA=this._useSpecularOverAlpha,F.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,F.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,F.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(N)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=F,this._eventInfo.subMesh=q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(F._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(F),F.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,F.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}F._areFresnelDirty&&(w.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(F.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,F.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,F.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,F.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,F.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,F.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,F._needNormals=!0,F.FRESNEL=!0):F.FRESNEL=!1),(0,L.K)(N,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(N)||this._forceAlphaTest,F,this._applyDecalMapAfterDetailMap),(0,L.E)(B,S,this,F,z,null,q.getRenderingMesh().hasThinInstances),this._eventInfo.defines=F,this._eventInfo.mesh=N,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,L.D)(N,F,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let x=!1;if(F.isDirty){const z=F._areLightsDisposed;F.markAsProcessed();const v=new H.e;F.REFLECTION&&v.addFallback(0,"REFLECTION"),F.SPECULAR&&v.addFallback(0,"SPECULAR"),F.BUMP&&v.addFallback(0,"BUMP"),F.PARALLAX&&v.addFallback(1,"PARALLAX"),F.PARALLAX_RHS&&v.addFallback(1,"PARALLAX_RHS"),F.PARALLAXOCCLUSION&&v.addFallback(0,"PARALLAXOCCLUSION"),F.SPECULAROVERALPHA&&v.addFallback(0,"SPECULAROVERALPHA"),F.FOG&&v.addFallback(1,"FOG"),F.POINTSIZE&&v.addFallback(0,"POINTSIZE"),F.LOGARITHMICDEPTH&&v.addFallback(0,"LOGARITHMICDEPTH"),(0,L.t)(F,v,this._maxSimultaneousLights),F.SPECULARTERM&&v.addFallback(0,"SPECULARTERM"),F.DIFFUSEFRESNEL&&v.addFallback(1,"DIFFUSEFRESNEL"),F.OPACITYFRESNEL&&v.addFallback(2,"OPACITYFRESNEL"),F.REFLECTIONFRESNEL&&v.addFallback(3,"REFLECTIONFRESNEL"),F.EMISSIVEFRESNEL&&v.addFallback(4,"EMISSIVEFRESNEL"),F.FRESNEL&&v.addFallback(4,"FRESNEL"),F.MULTIVIEW&&v.addFallback(0,"MULTIVIEW");const A=[y.h.PositionKind];F.NORMAL&&A.push(y.h.NormalKind),F.TANGENT&&A.push(y.h.TangentKind);for(let N=1;N<=6;++N)F["UV"+N]&&A.push(`uv${1===N?"":N}`);F.VERTEXCOLOR&&A.push(y.h.ColorKind),(0,L.w)(A,N,F,v),(0,L.x)(A,F),(0,L.z)(A,N,F),(0,L.u)(A,N,F);let e="default";const b=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],f=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],D=["Material","Scene","Mesh"],V={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:F.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=v,this._eventInfo.fallbackRank=0,this._eventInfo.defines=F,this._eventInfo.uniforms=b,this._eventInfo.attributes=A,this._eventInfo.samplers=f,this._eventInfo.uniformBuffersNames=D,this._eventInfo.customCode=void 0,this._eventInfo.mesh=N,this._eventInfo.indexParameters=V,this._callbackPluginEventGeneric(128,this._eventInfo),Q.d.AddUniformsAndSamplers(b,f),E.d.AddUniforms(b),E.d.AddSamplers(f),t.c&&(t.c.PrepareUniforms(b,F),t.c.PrepareSamplers(f,F)),(0,L.W)({uniformsNames:b,uniformBuffersNames:D,samplers:f,defines:F,maxSimultaneousLights:this._maxSimultaneousLights}),(0,T.c)(b);const Y={};this.customShaderNameResolve&&(e=this.customShaderNameResolve(e,b,D,f,F,A,Y));const X=F.toString(),u=q.effect;let w=B.getEngine().createEffect(e,{attributes:A,uniformsNames:b,uniformBuffersNames:D,samplers:f,defines:X,fallbacks:v,onCompiled:this.onCompiled,onError:this.onError,indexParameters:V,processFinalCode:Y.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:F.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([R.e(21),R.e(19)]).then(R.bind(R,12856)),Promise.all([R.e(22),R.e(20)]).then(R.bind(R,13003))]):await Promise.all([Promise.all([R.e(25),R.e(24)]).then(R.bind(R,13079)),Promise.all([R.e(27),R.e(26)]).then(R.bind(R,13250))]),this._shadersLoaded=!0}},S);if(this._eventInfo.customCode=void 0,w)if(this._onEffectCreatedObservable&&(h.effect=w,h.subMesh=q,this._onEffectCreatedObservable.notifyObservers(h)),this.allowShaderHotSwapping&&u&&!w.isReady()){if(w=u,F.markAsUnprocessed(),x=this.isFrozen,z)return F._areLightsDisposed=!0,!1}else B.resetCachedMaterial(),q.setEffect(w,F,this._materialContext)}return!(!q.effect||!q.effect.isReady())&&(F._renderId=B.getRenderId(),v._wasPreviouslyReady=!x,v._wasPreviouslyUsingInstances=z,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const N=this._uniformBuffer;N.addUniform("diffuseLeftColor",4),N.addUniform("diffuseRightColor",4),N.addUniform("opacityParts",4),N.addUniform("reflectionLeftColor",4),N.addUniform("reflectionRightColor",4),N.addUniform("refractionLeftColor",4),N.addUniform("refractionRightColor",4),N.addUniform("emissiveLeftColor",4),N.addUniform("emissiveRightColor",4),N.addUniform("vDiffuseInfos",2),N.addUniform("vAmbientInfos",2),N.addUniform("vOpacityInfos",2),N.addUniform("vReflectionInfos",2),N.addUniform("vReflectionPosition",3),N.addUniform("vReflectionSize",3),N.addUniform("vEmissiveInfos",2),N.addUniform("vLightmapInfos",2),N.addUniform("vSpecularInfos",2),N.addUniform("vBumpInfos",3),N.addUniform("diffuseMatrix",16),N.addUniform("ambientMatrix",16),N.addUniform("opacityMatrix",16),N.addUniform("reflectionMatrix",16),N.addUniform("emissiveMatrix",16),N.addUniform("lightmapMatrix",16),N.addUniform("specularMatrix",16),N.addUniform("bumpMatrix",16),N.addUniform("vTangentSpaceParams",2),N.addUniform("pointSize",1),N.addUniform("alphaCutOff",1),N.addUniform("refractionMatrix",16),N.addUniform("vRefractionInfos",4),N.addUniform("vRefractionPosition",3),N.addUniform("vRefractionSize",3),N.addUniform("vSpecularColor",4),N.addUniform("vEmissiveColor",3),N.addUniform("vDiffuseColor",4),N.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(N,q,R){const z=this.va(),v=R.materialDefines;if(!v)return;const B=R.effect;if(!B)return;this._activeEffect=B,q.getMeshUniformBuffer().bindToEffect(B,"Mesh"),q.transferToEffect(N),this._uniformBuffer.bindToEffect(B,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,z,q,N,this.isFrozen),Q.d.Bind(z.getEngine().currentRenderPassId,this._activeEffect,q,N),this._eventInfo.subMesh=R,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),v.OBJECTSPACE_NORMALMAP&&(N.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(z,B,R,q.visibility);(0,L.b)(q,B);const y=this._uniformBuffer;if(S){if(this.bindViewProjection(B),!y.useUbo||!this.isFrozen||!y.isSync||R._drawWrapper._forceRebindOnNextCall){if(w.FresnelEnabled&&v.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(y.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),y.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&y.updateColor4("opacityParts",new A.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(y.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),y.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(y.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),y.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(y.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),y.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),z.texturesEnabled){if(this._diffuseTexture&&w.DiffuseTextureEnabled&&(y.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,L.p)(this._diffuseTexture,y,"diffuse")),this._ambientTexture&&w.AmbientTextureEnabled&&(y.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,L.p)(this._ambientTexture,y,"ambient")),this._opacityTexture&&w.OpacityTextureEnabled&&(y.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,L.p)(this._opacityTexture,y,"opacity")),this._hasAlphaChannel()&&y.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&w.ReflectionTextureEnabled&&(y.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),y.Hj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const N=this._reflectionTexture;y.updateVector3("vReflectionPosition",N.boundingBoxPosition),y.updateVector3("vReflectionSize",N.boundingBoxSize)}if(this._emissiveTexture&&w.EmissiveTextureEnabled&&(y.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,L.p)(this._emissiveTexture,y,"emissive")),this._lightmapTexture&&w.LightmapTextureEnabled&&(y.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,L.p)(this._lightmapTexture,y,"lightmap")),this._specularTexture&&w.SpecularTextureEnabled&&(y.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,L.p)(this._specularTexture,y,"specular")),this._bumpTexture&&z.getEngine().getCaps().standardDerivatives&&w.BumpTextureEnabled&&(y.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,L.p)(this._bumpTexture,y,"bump"),z._mirroredCameraPosition?y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&w.RefractionTextureEnabled){let N=1;if(this._refractionTexture.isCube||(y.Hj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(N=this._refractionTexture.depth)),y.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,N,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const N=this._refractionTexture;y.updateVector3("vRefractionPosition",N.boundingBoxPosition),y.updateVector3("vRefractionSize",N.boundingBoxSize)}}}this.pointsCloud&&y.updateFloat("pointSize",this.pointSize),y.updateColor4("vSpecularColor",this.specularColor,this.specularPower),y.updateColor3("vEmissiveColor",w.EmissiveTextureEnabled?this.emissiveColor:A.c.BlackReadOnly),y.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),z.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),y.updateColor3("vAmbientColor",this._globalAmbientColor)}z.texturesEnabled&&(this._diffuseTexture&&w.DiffuseTextureEnabled&&B.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&w.AmbientTextureEnabled&&B.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&w.OpacityTextureEnabled&&B.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&w.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?B.setTexture("reflectionCubeSampler",this._reflectionTexture):B.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&w.EmissiveTextureEnabled&&B.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&w.LightmapTextureEnabled&&B.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&w.SpecularTextureEnabled&&B.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&z.getEngine().getCaps().standardDerivatives&&w.BumpTextureEnabled&&B.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&w.RefractionTextureEnabled&&(this._refractionTexture.isCube?B.setTexture("refractionCubeSampler",this._refractionTexture):B.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(q)&&this.va().depthPeelingRenderer.bind(B),this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,T.e)(B,this,z),this.bindEyePosition(B)}else z.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var E;if(z.lightsEnabled&&!this._disableLighting&&(0,L.e)(z,q,B,v,this._maxSimultaneousLights),(z.fogEnabled&&q.applyFog&&z.fogMode!==F.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||q.receiveShadows||v.PREPASS)&&this.bindView(B),(0,L.c)(z,q,B),v.NUM_MORPH_INFLUENCERS&&(0,L.j)(q,B),v.BAKED_VERTEX_ANIMATION_TEXTURE)null===(E=q.bakedVertexAnimationManager)||void 0===E||E.bind(B,v.INSTANCES);this.useLogarithmicDepth&&(0,L.i)(v,B,z),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(q,this._activeEffect,R),y.update()}getAnimatables(){const N=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&N.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&N.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&N.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&N.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&N.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&N.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&N.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&N.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&N.push(this._refractionTexture),N}getActiveTextures(){const N=super.getActiveTextures();return this._diffuseTexture&&N.push(this._diffuseTexture),this._ambientTexture&&N.push(this._ambientTexture),this._opacityTexture&&N.push(this._opacityTexture),this._reflectionTexture&&N.push(this._reflectionTexture),this._emissiveTexture&&N.push(this._emissiveTexture),this._specularTexture&&N.push(this._specularTexture),this._bumpTexture&&N.push(this._bumpTexture),this._lightmapTexture&&N.push(this._lightmapTexture),this._refractionTexture&&N.push(this._refractionTexture),N}hasTexture(N){return!!super.hasTexture(N)||(this._diffuseTexture===N||(this._ambientTexture===N||(this._opacityTexture===N||(this._reflectionTexture===N||(this._emissiveTexture===N||(this._specularTexture===N||(this._bumpTexture===N||(this._lightmapTexture===N||this._refractionTexture===N))))))))}dispose(N,q){var R,z,v,B,F,S,A,y,E;q&&(null===(R=this._diffuseTexture)||void 0===R||R.dispose(),null===(z=this._ambientTexture)||void 0===z||z.dispose(),null===(v=this._opacityTexture)||void 0===v||v.dispose(),null===(B=this._reflectionTexture)||void 0===B||B.dispose(),null===(F=this._emissiveTexture)||void 0===F||F.dispose(),null===(S=this._specularTexture)||void 0===S||S.dispose(),null===(A=this._bumpTexture)||void 0===A||A.dispose(),null===(y=this._lightmapTexture)||void 0===y||y.dispose(),null===(E=this._refractionTexture)||void 0===E||E.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(N,q)}clone(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const z=X.e.Clone((()=>new w(N,this.va())),this,{cloneTexturesOnlyOnce:q});return z.name=N,z.id=N,this.stencil.copyTo(z.stencil),this._clonePlugins(z,R),z}static Parse(N,q,R){const z=X.e.Parse((()=>new w(N.name,q)),N,q,R);return N.stencil&&z.stencil.parse(N.stencil,q,R),x.d._ParsePlugins(N,z,q,R),z}static get DiffuseTextureEnabled(){return V.d.DiffuseTextureEnabled}static set DiffuseTextureEnabled(N){V.d.DiffuseTextureEnabled=N}static get DetailTextureEnabled(){return V.d.DetailTextureEnabled}static set DetailTextureEnabled(N){V.d.DetailTextureEnabled=N}static get AmbientTextureEnabled(){return V.d.AmbientTextureEnabled}static set AmbientTextureEnabled(N){V.d.AmbientTextureEnabled=N}static get OpacityTextureEnabled(){return V.d.OpacityTextureEnabled}static set OpacityTextureEnabled(N){V.d.OpacityTextureEnabled=N}static get ReflectionTextureEnabled(){return V.d.ReflectionTextureEnabled}static set ReflectionTextureEnabled(N){V.d.ReflectionTextureEnabled=N}static get EmissiveTextureEnabled(){return V.d.EmissiveTextureEnabled}static set EmissiveTextureEnabled(N){V.d.EmissiveTextureEnabled=N}static get SpecularTextureEnabled(){return V.d.SpecularTextureEnabled}static set SpecularTextureEnabled(N){V.d.SpecularTextureEnabled=N}static get BumpTextureEnabled(){return V.d.BumpTextureEnabled}static set BumpTextureEnabled(N){V.d.BumpTextureEnabled=N}static get LightmapTextureEnabled(){return V.d.LightmapTextureEnabled}static set LightmapTextureEnabled(N){V.d.LightmapTextureEnabled=N}static get RefractionTextureEnabled(){return V.d.RefractionTextureEnabled}static set RefractionTextureEnabled(N){V.d.RefractionTextureEnabled=N}static get ColorGradingTextureEnabled(){return V.d.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(N){V.d.ColorGradingTextureEnabled=N}static get FresnelEnabled(){return V.d.FresnelEnabled}static set FresnelEnabled(N){V.d.FresnelEnabled=N}}w.ForceGLSL=!1,(0,z.c)([(0,v.x)("diffuseTexture")],w.prototype,"_diffuseTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"diffuseTexture",void 0),(0,z.c)([(0,v.x)("ambientTexture")],w.prototype,"_ambientTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"ambientTexture",void 0),(0,z.c)([(0,v.x)("opacityTexture")],w.prototype,"_opacityTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"opacityTexture",void 0),(0,z.c)([(0,v.x)("reflectionTexture")],w.prototype,"_reflectionTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"reflectionTexture",void 0),(0,z.c)([(0,v.x)("emissiveTexture")],w.prototype,"_emissiveTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"emissiveTexture",void 0),(0,z.c)([(0,v.x)("specularTexture")],w.prototype,"_specularTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"specularTexture",void 0),(0,z.c)([(0,v.x)("bumpTexture")],w.prototype,"_bumpTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"bumpTexture",void 0),(0,z.c)([(0,v.x)("lightmapTexture")],w.prototype,"_lightmapTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"lightmapTexture",void 0),(0,z.c)([(0,v.x)("refractionTexture")],w.prototype,"_refractionTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"refractionTexture",void 0),(0,z.c)([(0,v.j)("ambient")],w.prototype,"ambientColor",void 0),(0,z.c)([(0,v.j)("diffuse")],w.prototype,"diffuseColor",void 0),(0,z.c)([(0,v.j)("specular")],w.prototype,"specularColor",void 0),(0,z.c)([(0,v.j)("emissive")],w.prototype,"emissiveColor",void 0),(0,z.c)([(0,v.D)()],w.prototype,"specularPower",void 0),(0,z.c)([(0,v.D)("useAlphaFromDiffuseTexture")],w.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"useAlphaFromDiffuseTexture",void 0),(0,z.c)([(0,v.D)("useEmissiveAsIllumination")],w.prototype,"_useEmissiveAsIllumination",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useEmissiveAsIllumination",void 0),(0,z.c)([(0,v.D)("linkEmissiveWithDiffuse")],w.prototype,"_linkEmissiveWithDiffuse",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"linkEmissiveWithDiffuse",void 0),(0,z.c)([(0,v.D)("useSpecularOverAlpha")],w.prototype,"_useSpecularOverAlpha",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useSpecularOverAlpha",void 0),(0,z.c)([(0,v.D)("useReflectionOverAlpha")],w.prototype,"_useReflectionOverAlpha",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useReflectionOverAlpha",void 0),(0,z.c)([(0,v.D)("disableLighting")],w.prototype,"_disableLighting",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsLightsDirty")],w.prototype,"disableLighting",void 0),(0,z.c)([(0,v.D)("useObjectSpaceNormalMap")],w.prototype,"_useObjectSpaceNormalMap",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useObjectSpaceNormalMap",void 0),(0,z.c)([(0,v.D)("useParallax")],w.prototype,"_useParallax",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useParallax",void 0),(0,z.c)([(0,v.D)("useParallaxOcclusion")],w.prototype,"_useParallaxOcclusion",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useParallaxOcclusion",void 0),(0,z.c)([(0,v.D)()],w.prototype,"parallaxScaleBias",void 0),(0,z.c)([(0,v.D)("roughness")],w.prototype,"_roughness",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"roughness",void 0),(0,z.c)([(0,v.D)()],w.prototype,"indexOfRefraction",void 0),(0,z.c)([(0,v.D)()],w.prototype,"invertRefractionY",void 0),(0,z.c)([(0,v.D)()],w.prototype,"alphaCutOff",void 0),(0,z.c)([(0,v.D)("useLightmapAsShadowmap")],w.prototype,"_useLightmapAsShadowmap",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useLightmapAsShadowmap",void 0),(0,z.c)([(0,v.n)("diffuseFresnelParameters")],w.prototype,"_diffuseFresnelParameters",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsFresnelDirty")],w.prototype,"diffuseFresnelParameters",void 0),(0,z.c)([(0,v.n)("opacityFresnelParameters")],w.prototype,"_opacityFresnelParameters",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],w.prototype,"opacityFresnelParameters",void 0),(0,z.c)([(0,v.n)("reflectionFresnelParameters")],w.prototype,"_reflectionFresnelParameters",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsFresnelDirty")],w.prototype,"reflectionFresnelParameters",void 0),(0,z.c)([(0,v.n)("refractionFresnelParameters")],w.prototype,"_refractionFresnelParameters",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsFresnelDirty")],w.prototype,"refractionFresnelParameters",void 0),(0,z.c)([(0,v.n)("emissiveFresnelParameters")],w.prototype,"_emissiveFresnelParameters",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsFresnelDirty")],w.prototype,"emissiveFresnelParameters",void 0),(0,z.c)([(0,v.D)("useReflectionFresnelFromSpecular")],w.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsFresnelDirty")],w.prototype,"useReflectionFresnelFromSpecular",void 0),(0,z.c)([(0,v.D)("useGlossinessFromSpecularMapAlpha")],w.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,z.c)([(0,v.D)("maxSimultaneousLights")],w.prototype,"_maxSimultaneousLights",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsLightsDirty")],w.prototype,"maxSimultaneousLights",void 0),(0,z.c)([(0,v.D)("invertNormalMapX")],w.prototype,"_invertNormalMapX",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"invertNormalMapX",void 0),(0,z.c)([(0,v.D)("invertNormalMapY")],w.prototype,"_invertNormalMapY",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"invertNormalMapY",void 0),(0,z.c)([(0,v.D)("twoSidedLighting")],w.prototype,"_twoSidedLighting",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"twoSidedLighting",void 0),(0,z.c)([(0,v.D)("applyDecalMapAfterDetailMap")],w.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,z.c)([(0,v.e)("_markAllSubMeshesAsMiscDirty")],w.prototype,"applyDecalMapAfterDetailMap",void 0),(0,D.f)("BABYLON.StandardMaterial",w),F.b.DefaultMaterialFactory=N=>new w("default material",N)},11238:(N,q,R)=>{"use strict";R.d(q,{b:()=>B});var z=R(10907),v=R(10888);class B{constructor(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=N,this._noUBO=!N.supportsUniformBuffers||v,this._dynamic=R,this._name=z??"no-name",this._data=q||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Hj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Hj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(N){let q;if(q=N<=2?N:4,this._uniformLocationPointer%q!==0){const N=this._uniformLocationPointer;this._uniformLocationPointer+=q-this._uniformLocationPointer%q;const R=this._uniformLocationPointer-N;for(let q=0;q<R;q++)this._data.push(0)}}addUniform(N,q){let R,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[N]){if(z>0){if(q instanceof Array)throw"addUniform should not be use with Array in UBO: "+N;if(this._fillAlignment(4),this._uniformArraySizes[N]={strideSize:q,arraySize:z},16==q)q*=z;else{q=q*z+(4-q)*z}R=[];for(let N=0;N<q;N++)R.push(0)}else{if(q instanceof Array)R=q,q=R.length;else{R=[];for(let N=0;N<q;N++)R.push(0)}this._fillAlignment(q)}this._uniformSizes[N]=q,this._uniformLocations[N]=this._uniformLocationPointer,this._uniformLocationPointer+=q;for(let N=0;N<q;N++)this._data.push(R[N]);this._needSync=!0}}addMatrix(N,q){this.addUniform(N,Array.prototype.slice.call(q.ij()))}addFloat2(N,q,R){const z=[q,R];this.addUniform(N,z)}addFloat3(N,q,R,z){const v=[q,R,z];this.addUniform(N,v)}addColor3(N,q){const R=[q.r,q.g,q.b];this.addUniform(N,R)}addColor4(N,q,R){const z=[q.r,q.g,q.b,R];this.addUniform(N,z)}addVector3(N,q){const R=[q.x,q.y,q.z];this.addUniform(N,R)}addMatrix3x3(N){this.addUniform(N,12)}addMatrix2x2(N){this.addUniform(N,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const N=[];let q=0;for(const R in this._uniformLocations)if(N.push(R),10===++q)break;return N.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(N,q){for(let R=0;R<N.length;++R)if(N[R]!==q[R])return!1;return!0}_copyBuffer(N,q){for(let R=0;R<N.length;++R)q[R]=N[R]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(B._UpdatedUbosInFrame[this._name]||(B._UpdatedUbosInFrame[this._name]=0),B._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(N,q,R){this._checkNewFrame();let v=this._uniformLocations[N];if(void 0===v){if(this._buffer)return void z.c.Error("Cannot add an uniform after UBO has been created. uniformName="+N);this.addUniform(N,R),v=this._uniformLocations[N]}if(this._buffer||this.create(),this._dynamic)for(let z=0;z<R;z++)this._bufferData[v+z]=q[z];else{let N=!1;for(let z=0;z<R;z++)(16===R&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[v+z]!==Math.fround(q[z]))&&(N=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[v+z]=q[z]);this._needSync=this._needSync||N}}updateUniformArray(N,q,R){this._checkNewFrame();const B=this._uniformLocations[N];if(void 0===B)return void z.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const F=this._uniformArraySizes[N];if(this._dynamic)for(let z=0;z<R;z++)this._bufferData[B+z]=q[z];else{let N=!1,z=0,S=0;for(let A=0;A<R;A++)if(this._bufferData[B+4*S+z]!==v.f.FloatRound(q[A])&&(N=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[B+4*S+z]=q[A]),z++,z===F.strideSize){for(;z<4;z++)this._bufferData[B+4*S+z]=0;z=0,S++}this._needSync=this._needSync||N}}_cacheMatrix(N,q){this._checkNewFrame();const R=this._valueCache[N],z=q.updateFlag;return(void 0===R||R!==z)&&(this._valueCache[N]=z,!0)}_updateMatrix3x3ForUniform(N,q){for(let R=0;R<3;R++)B._TempBuffer[4*R]=q[3*R],B._TempBuffer[4*R+1]=q[3*R+1],B._TempBuffer[4*R+2]=q[3*R+2],B._TempBuffer[4*R+3]=0;this.updateUniform(N,B._TempBuffer,12)}_updateMatrix3x3ForEffect(N,q){this._currentEffect.setMatrix3x3(N,q)}_updateMatrix2x2ForEffect(N,q){this._currentEffect.setMatrix2x2(N,q)}_updateMatrix2x2ForUniform(N,q){for(let R=0;R<2;R++)B._TempBuffer[4*R]=q[2*R],B._TempBuffer[4*R+1]=q[2*R+1],B._TempBuffer[4*R+2]=0,B._TempBuffer[4*R+3]=0;this.updateUniform(N,B._TempBuffer,8)}_updateFloatForEffect(N,q){this._currentEffect.setFloat(N,q)}_updateFloatForUniform(N,q){B._TempBuffer[0]=q,this.updateUniform(N,B._TempBuffer,1)}_updateFloat2ForEffect(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(N+z,q,R)}_updateFloat2ForUniform(N,q,R){B._TempBuffer[0]=q,B._TempBuffer[1]=R,this.updateUniform(N,B._TempBuffer,2)}_updateFloat3ForEffect(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(N+v,q,R,z)}_updateFloat3ForUniform(N,q,R,z){B._TempBuffer[0]=q,B._TempBuffer[1]=R,B._TempBuffer[2]=z,this.updateUniform(N,B._TempBuffer,3)}_updateFloat4ForEffect(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(N+B,q,R,z,v)}_updateFloat4ForUniform(N,q,R,z,v){B._TempBuffer[0]=q,B._TempBuffer[1]=R,B._TempBuffer[2]=z,B._TempBuffer[3]=v,this.updateUniform(N,B._TempBuffer,4)}_updateFloatArrayForEffect(N,q){this._currentEffect.setFloatArray(N,q)}_updateFloatArrayForUniform(N,q){this.updateUniformArray(N,q,q.length)}_updateArrayForEffect(N,q){this._currentEffect.setArray(N,q)}_updateArrayForUniform(N,q){this.updateUniformArray(N,q,q.length)}_updateIntArrayForEffect(N,q){this._currentEffect.setIntArray(N,q)}_updateIntArrayForUniform(N,q){B._TempBufferInt32View.set(q),this.updateUniformArray(N,B._TempBuffer,q.length)}_updateUIntArrayForEffect(N,q){this._currentEffect.setUIntArray(N,q)}_updateUIntArrayForUniform(N,q){B._TempBufferUInt32View.set(q),this.updateUniformArray(N,B._TempBuffer,q.length)}_updateMatrixForEffect(N,q){this._currentEffect.setMatrix(N,q)}_updateMatrixForUniform(N,q){this._cacheMatrix(N,q)&&this.updateUniform(N,q.ij(),16)}_updateMatricesForEffect(N,q){this._currentEffect.setMatrices(N,q)}_updateMatricesForUniform(N,q){this.updateUniform(N,q,q.length)}_updateVector3ForEffect(N,q){this._currentEffect.setVector3(N,q)}_updateVector3ForUniform(N,q){B._TempBuffer[0]=q.x,B._TempBuffer[1]=q.y,B._TempBuffer[2]=q.z,this.updateUniform(N,B._TempBuffer,3)}_updateVector4ForEffect(N,q){this._currentEffect.setVector4(N,q)}_updateVector4ForUniform(N,q){B._TempBuffer[0]=q.x,B._TempBuffer[1]=q.y,B._TempBuffer[2]=q.z,B._TempBuffer[3]=q.w,this.updateUniform(N,B._TempBuffer,4)}_updateColor3ForEffect(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(N+R,q)}_updateColor3ForUniform(N,q){B._TempBuffer[0]=q.r,B._TempBuffer[1]=q.g,B._TempBuffer[2]=q.b,this.updateUniform(N,B._TempBuffer,3)}_updateColor4ForEffect(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(N+z,q,R)}_updateDirectColor4ForEffect(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(N+R,q)}_updateColor4ForUniform(N,q,R){B._TempBuffer[0]=q.r,B._TempBuffer[1]=q.g,B._TempBuffer[2]=q.b,B._TempBuffer[3]=R,this.updateUniform(N,B._TempBuffer,4)}_updateDirectColor4ForUniform(N,q){B._TempBuffer[0]=q.r,B._TempBuffer[1]=q.g,B._TempBuffer[2]=q.b,B._TempBuffer[3]=q.a,this.updateUniform(N,B._TempBuffer,4)}_updateIntForEffect(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(N+R,q)}_updateIntForUniform(N,q){B._TempBufferInt32View[0]=q,this.updateUniform(N,B._TempBuffer,1)}_updateInt2ForEffect(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(N+z,q,R)}_updateInt2ForUniform(N,q,R){B._TempBufferInt32View[0]=q,B._TempBufferInt32View[1]=R,this.updateUniform(N,B._TempBuffer,2)}_updateInt3ForEffect(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(N+v,q,R,z)}_updateInt3ForUniform(N,q,R,z){B._TempBufferInt32View[0]=q,B._TempBufferInt32View[1]=R,B._TempBufferInt32View[2]=z,this.updateUniform(N,B._TempBuffer,3)}_updateInt4ForEffect(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(N+B,q,R,z,v)}_updateInt4ForUniform(N,q,R,z,v){B._TempBufferInt32View[0]=q,B._TempBufferInt32View[1]=R,B._TempBufferInt32View[2]=z,B._TempBufferInt32View[3]=v,this.updateUniform(N,B._TempBuffer,4)}_updateUIntForEffect(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(N+R,q)}_updateUIntForUniform(N,q){B._TempBufferUInt32View[0]=q,this.updateUniform(N,B._TempBuffer,1)}_updateUInt2ForEffect(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(N+z,q,R)}_updateUInt2ForUniform(N,q,R){B._TempBufferUInt32View[0]=q,B._TempBufferUInt32View[1]=R,this.updateUniform(N,B._TempBuffer,2)}_updateUInt3ForEffect(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(N+v,q,R,z)}_updateUInt3ForUniform(N,q,R,z){B._TempBufferUInt32View[0]=q,B._TempBufferUInt32View[1]=R,B._TempBufferUInt32View[2]=z,this.updateUniform(N,B._TempBuffer,3)}_updateUInt4ForEffect(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(N+B,q,R,z,v)}_updateUInt4ForUniform(N,q,R,z,v){B._TempBufferUInt32View[0]=q,B._TempBufferUInt32View[1]=R,B._TempBufferUInt32View[2]=z,B._TempBufferUInt32View[3]=v,this.updateUniform(N,B._TempBuffer,4)}setTexture(N,q){this._currentEffect.setTexture(N,q)}setTextureArray(N,q){this._currentEffect.setTextureArray(N,q)}bindTexture(N,q){this._currentEffect._bindTexture(N,q)}updateUniformDirectly(N,q){this.updateUniform(N,q,q.length),this.update()}bindToEffect(N,q){this._currentEffect=N,this._currentEffectName=q}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(N){if(!this._buffers)return this._buffer===N;for(let q=0;q<this._buffers.length;++q){if(this._buffers[q][0]===N)return this._bufferIndex=q,this._buffer=N,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const N=this._engine._uniformBuffers,q=N.indexOf(this);if(-1!==q&&(N[q]=N[N.length-1],N.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let R=0;R<this._buffers.length;++R){const N=this._buffers[R][0];this._engine._releaseBuffer(N)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}B._UpdatedUbosInFrame={},B._MAX_UNIFORM_SIZE=256,B._TempBuffer=new Float32Array(B._MAX_UNIFORM_SIZE),B._TempBufferInt32View=new Int32Array(B._TempBuffer.buffer),B._TempBufferUInt32View=new Uint32Array(B._TempBuffer.buffer)},11495:(N,q,R)=>{"use strict";R.d(q,{b:()=>F,c:()=>z});var z,v,B=R(11181);!function(N){N[N.LOCAL=0]="LOCAL",N[N.WORLD=1]="WORLD",N[N.BONE=2]="BONE"}(z||(z={}));class F{}F.X=new B.m(1,0,0),F.Y=new B.m(0,1,0),F.Z=new B.m(0,0,1),function(N){N[N.X=0]="X",N[N.Y=1]="Y",N[N.Z=2]="Z"}(v||(v={}))},11213:(N,q,R)=>{"use strict";R.d(q,{c:()=>t,g:()=>x,h:()=>e});var z=R(11190),v=R(11002),B=R(11186),F=R(11197);function S(N){return Math.pow(N,B.l)}function A(N){return N<=.04045?.0773993808*N:Math.pow(.947867299*(N+.055),2.4)}function y(N){return Math.pow(N,B.h)}function E(N){return N<=.0031308?12.92*N:1.055*Math.pow(N,.41666)-.055}class t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=N,this.g=q,this.b=R}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"hb"}getHashCode(){let N=255*this.r|0;return N=397*N^255*this.g,N=397*N^255*this.b,N}toArray(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N[q]=this.r,N[q+1]=this.g,N[q+2]=this.b,this}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(N,q,this),this}toColor4(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new x(this.r,this.g,this.b,N)}ij(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(N){return new t(this.r*N.r,this.g*N.g,this.b*N.b)}multiplyToRef(N,q){return q.r=this.r*N.r,q.g=this.g*N.g,q.b=this.b*N.b,q}multiplyInPlace(N){return this.r*=N.r,this.g*=N.g,this.b*=N.b,this}multiplyByFloats(N,q,R){return new t(this.r*N,this.g*q,this.b*R)}divide(N){throw new ReferenceError("Can not divide a color")}divideToRef(N,q){throw new ReferenceError("Can not divide a color")}divideInPlace(N){throw new ReferenceError("Can not divide a color")}minimizeInPlace(N){return this.minimizeInPlaceFromFloats(N.r,N.g,N.b)}maximizeInPlace(N){return this.maximizeInPlaceFromFloats(N.r,N.g,N.b)}minimizeInPlaceFromFloats(N,q,R){return this.r=Math.min(N,this.r),this.g=Math.min(q,this.g),this.b=Math.min(R,this.b),this}maximizeInPlaceFromFloats(N,q,R){return this.r=Math.max(N,this.r),this.g=Math.max(q,this.g),this.b=Math.max(R,this.b),this}floorToRef(N){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(N){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(N){return N&&this.r===N.r&&this.g===N.g&&this.b===N.b}equalsFloats(N,q,R){return this.equalsToFloats(N,q,R)}equalsToFloats(N,q,R){return this.r===N&&this.g===q&&this.b===R}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.d;return(0,F.w)(this.r,N.r,q)&&(0,F.w)(this.g,N.g,q)&&(0,F.w)(this.b,N.b,q)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(N){throw new ReferenceError("Can not negate a color")}scale(N){return new t(this.r*N,this.g*N,this.b*N)}scaleInPlace(N){return this.r*=N,this.g*=N,this.b*=N,this}scaleToRef(N,q){return q.r=this.r*N,q.g=this.g*N,q.b=this.b*N,q}scaleAndAddToRef(N,q){return q.r+=this.r*N,q.g+=this.g*N,q.b+=this.b*N,q}clampToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;return R.r=(0,F.c)(this.r,N,q),R.g=(0,F.c)(this.g,N,q),R.b=(0,F.c)(this.b,N,q),R}add(N){return new t(this.r+N.r,this.g+N.g,this.b+N.b)}addInPlace(N){return this.r+=N.r,this.g+=N.g,this.b+=N.b,this}addInPlaceFromFloats(N,q,R){return this.r+=N,this.g+=q,this.b+=R,this}addToRef(N,q){return q.r=this.r+N.r,q.g=this.g+N.g,q.b=this.b+N.b,q}gd(N){return new t(this.r-N.r,this.g-N.g,this.b-N.b)}subtractToRef(N,q){return q.r=this.r-N.r,q.g=this.g-N.g,q.b=this.b-N.b,q}pi(N){return this.r-=N.r,this.g-=N.g,this.b-=N.b,this}subtractFromFloats(N,q,R){return new t(this.r-N,this.g-q,this.b-R)}subtractFromFloatsToRef(N,q,R,z){return z.r=this.r-N,z.g=this.g-q,z.b=this.b-R,z}clone(){return new t(this.r,this.g,this.b)}p(N){return this.r=N.r,this.g=N.g,this.b=N.b,this}qe(N,q,R){return this.r=N,this.g=q,this.b=R,this}set(N,q,R){return this.qe(N,q,R)}oe(N){return this.r=this.g=this.b=N,this}toHexString(){const N=Math.round(255*this.r),q=Math.round(255*this.g),R=Math.round(255*this.b);return"#"+(0,F.v)(N)+(0,F.v)(q)+(0,F.v)(R)}fromHexString(N){return"#"!==N.substring(0,1)||7!==N.length||(this.r=parseInt(N.substring(1,3),16)/255,this.g=parseInt(N.substring(3,5),16)/255,this.b=parseInt(N.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new t)}toHSVToRef(N){const q=this.r,R=this.g,z=this.b,v=Math.max(q,R,z),B=Math.min(q,R,z);let F=0,S=0;const A=v,y=v-B;return 0!==v&&(S=y/v),v!=B&&(v==q?(F=(R-z)/y,R<z&&(F+=6)):v==R?F=(z-q)/y+2:v==z&&(F=(q-R)/y+4),F*=60),N.r=F,N.g=S,N.b=A,N}toLinearSpace(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new t;return this.toLinearSpaceToRef(q,N),q}toLinearSpaceToRef(N){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(N.r=A(this.r),N.g=A(this.g),N.b=A(this.b)):(N.r=S(this.r),N.g=S(this.g),N.b=S(this.b)),this}toGammaSpace(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new t;return this.toGammaSpaceToRef(q,N),q}toGammaSpaceToRef(N){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(N.r=E(this.r),N.g=E(this.g),N.b=E(this.b)):(N.r=y(this.r),N.g=y(this.g),N.b=y(this.b)),this}static HSVtoRGBToRef(N,q,R,z){const v=R*q,B=N/60,F=v*(1-Math.abs(B%2-1));let S=0,A=0,y=0;B>=0&&B<=1?(S=v,A=F):B>=1&&B<=2?(S=F,A=v):B>=2&&B<=3?(A=v,y=F):B>=3&&B<=4?(A=F,y=v):B>=4&&B<=5?(S=F,y=v):B>=5&&B<=6&&(S=v,y=F);const E=R-v;return z.r=S+E,z.g=A+E,z.b=y+E,z}static FromHSV(N,q,R){const z=new t(0,0,0);return t.HSVtoRGBToRef(N,q,R,z),z}static FromHexString(N){return new t(0,0,0).fromHexString(N)}static Zg(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(N[q],N[q+1],N[q+2])}static FromArrayToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;R.r=N[q],R.g=N[q+1],R.b=N[q+2]}static FromInts(N,q,R){return new t(N/255,q/255,R/255)}static Lerp(N,q,R){const z=new t(0,0,0);return t.LerpToRef(N,q,R,z),z}static LerpToRef(N,q,R,z){z.r=N.r+(q.r-N.r)*R,z.g=N.g+(q.g-N.g)*R,z.b=N.b+(q.b-N.b)*R}static Hermite(N,q,R,z,v){const B=v*v,F=v*B,S=2*F-3*B+1,A=-2*F+3*B,y=F-2*B+v,E=F-B,x=N.r*S+R.r*A+q.r*y+z.r*E,e=N.g*S+R.g*A+q.g*y+z.g*E,b=N.b*S+R.b*A+q.b*y+z.b*E;return new t(x,e,b)}static Hermite1stDerivative(N,q,R,z,v){const B=t.Black();return this.Hermite1stDerivativeToRef(N,q,R,z,v,B),B}static Hermite1stDerivativeToRef(N,q,R,z,v,B){const F=v*v;B.r=6*(F-v)*N.r+(3*F-4*v+1)*q.r+6*(-F+v)*R.r+(3*F-2*v)*z.r,B.g=6*(F-v)*N.g+(3*F-4*v+1)*q.g+6*(-F+v)*R.g+(3*F-2*v)*z.g,B.b=6*(F-v)*N.b+(3*F-4*v+1)*q.b+6*(-F+v)*R.b+(3*F-2*v)*z.b}static Red(){return new t(1,0,0)}static Green(){return new t(0,1,0)}static Blue(){return new t(0,0,1)}static Black(){return new t(0,0,0)}static get BlackReadOnly(){return t._BlackReadOnly}static White(){return new t(1,1,1)}static Purple(){return new t(.5,0,.5)}static Magenta(){return new t(1,0,1)}static Yellow(){return new t(1,1,0)}static Gray(){return new t(.5,.5,.5)}static Teal(){return new t(0,1,1)}static Random(){return new t(Math.random(),Math.random(),Math.random())}}t._BlackReadOnly=t.Black(),Object.defineProperties(t.prototype,{dimension:{value:[3]},rank:{value:1}});class x{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=N,this.g=q,this.b=R,this.a=z}ij(){return[this.r,this.g,this.b,this.a]}toArray(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N[q]=this.r,N[q+1]=this.g,N[q+2]=this.b,N[q+3]=this.a,this}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=N[q],this.g=N[q+1],this.b=N[q+2],this.a=N[q+3],this}equals(N){return N&&this.r===N.r&&this.g===N.g&&this.b===N.b&&this.a===N.a}add(N){return new x(this.r+N.r,this.g+N.g,this.b+N.b,this.a+N.a)}addToRef(N,q){return q.r=this.r+N.r,q.g=this.g+N.g,q.b=this.b+N.b,q.a=this.a+N.a,q}addInPlace(N){return this.r+=N.r,this.g+=N.g,this.b+=N.b,this.a+=N.a,this}addInPlaceFromFloats(N,q,R,z){return this.r+=N,this.g+=q,this.b+=R,this.a+=z,this}gd(N){return new x(this.r-N.r,this.g-N.g,this.b-N.b,this.a-N.a)}subtractToRef(N,q){return q.r=this.r-N.r,q.g=this.g-N.g,q.b=this.b-N.b,q.a=this.a-N.a,q}pi(N){return this.r-=N.r,this.g-=N.g,this.b-=N.b,this.a-=N.a,this}subtractFromFloats(N,q,R,z){return new x(this.r-N,this.g-q,this.b-R,this.a-z)}subtractFromFloatsToRef(N,q,R,z,v){return v.r=this.r-N,v.g=this.g-q,v.b=this.b-R,v.a=this.a-z,v}scale(N){return new x(this.r*N,this.g*N,this.b*N,this.a*N)}scaleInPlace(N){return this.r*=N,this.g*=N,this.b*=N,this.a*=N,this}scaleToRef(N,q){return q.r=this.r*N,q.g=this.g*N,q.b=this.b*N,q.a=this.a*N,q}scaleAndAddToRef(N,q){return q.r+=this.r*N,q.g+=this.g*N,q.b+=this.b*N,q.a+=this.a*N,q}clampToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;return R.r=(0,F.c)(this.r,N,q),R.g=(0,F.c)(this.g,N,q),R.b=(0,F.c)(this.b,N,q),R.a=(0,F.c)(this.a,N,q),R}multiply(N){return new x(this.r*N.r,this.g*N.g,this.b*N.b,this.a*N.a)}multiplyToRef(N,q){return q.r=this.r*N.r,q.g=this.g*N.g,q.b=this.b*N.b,q.a=this.a*N.a,q}multiplyInPlace(N){return this.r*=N.r,this.g*=N.g,this.b*=N.b,this.a*=N.a,this}multiplyByFloats(N,q,R,z){return new x(this.r*N,this.g*q,this.b*R,this.a*z)}divide(N){throw new ReferenceError("Can not divide a color")}divideToRef(N,q){throw new ReferenceError("Can not divide a color")}divideInPlace(N){throw new ReferenceError("Can not divide a color")}minimizeInPlace(N){return this.r=Math.min(this.r,N.r),this.g=Math.min(this.g,N.g),this.b=Math.min(this.b,N.b),this.a=Math.min(this.a,N.a),this}maximizeInPlace(N){return this.r=Math.max(this.r,N.r),this.g=Math.max(this.g,N.g),this.b=Math.max(this.b,N.b),this.a=Math.max(this.a,N.a),this}minimizeInPlaceFromFloats(N,q,R,z){return this.r=Math.min(N,this.r),this.g=Math.min(q,this.g),this.b=Math.min(R,this.b),this.a=Math.min(z,this.a),this}maximizeInPlaceFromFloats(N,q,R,z){return this.r=Math.max(N,this.r),this.g=Math.max(q,this.g),this.b=Math.max(R,this.b),this.a=Math.max(z,this.a),this}floorToRef(N){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(N){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(N){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.d;return(0,F.w)(this.r,N.r,q)&&(0,F.w)(this.g,N.g,q)&&(0,F.w)(this.b,N.b,q)&&(0,F.w)(this.a,N.a,q)}equalsToFloats(N,q,R,z){return this.r===N&&this.g===q&&this.b===R&&this.a===z}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let N=255*this.r|0;return N=397*N^255*this.g,N=397*N^255*this.b,N=397*N^255*this.a,N}clone(){return(new x).p(this)}p(N){return this.r=N.r,this.g=N.g,this.b=N.b,this.a=N.a,this}qe(N,q,R,z){return this.r=N,this.g=q,this.b=R,this.a=z,this}set(N,q,R,z){return this.qe(N,q,R,z)}oe(N){return this.r=this.g=this.b=this.a=N,this}toHexString(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=Math.round(255*this.r),R=Math.round(255*this.g),z=Math.round(255*this.b);if(N)return"#"+(0,F.v)(q)+(0,F.v)(R)+(0,F.v)(z);const v=Math.round(255*this.a);return"#"+(0,F.v)(q)+(0,F.v)(R)+(0,F.v)(z)+(0,F.v)(v)}fromHexString(N){return"#"!==N.substring(0,1)||9!==N.length&&7!==N.length||(this.r=parseInt(N.substring(1,3),16)/255,this.g=parseInt(N.substring(3,5),16)/255,this.b=parseInt(N.substring(5,7),16)/255,9===N.length&&(this.a=parseInt(N.substring(7,9),16)/255)),this}toLinearSpace(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new x;return this.toLinearSpaceToRef(q,N),q}toLinearSpaceToRef(N){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(N.r=A(this.r),N.g=A(this.g),N.b=A(this.b)):(N.r=S(this.r),N.g=S(this.g),N.b=S(this.b)),N.a=this.a,this}toGammaSpace(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new x;return this.toGammaSpaceToRef(q,N),q}toGammaSpaceToRef(N){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(N.r=E(this.r),N.g=E(this.g),N.b=E(this.b)):(N.r=y(this.r),N.g=y(this.g),N.b=y(this.b)),N.a=this.a,this}static FromHexString(N){return"#"!==N.substring(0,1)||9!==N.length&&7!==N.length?new x(0,0,0,0):new x(0,0,0,1).fromHexString(N)}static Lerp(N,q,R){return x.LerpToRef(N,q,R,new x)}static LerpToRef(N,q,R,z){return z.r=N.r+(q.r-N.r)*R,z.g=N.g+(q.g-N.g)*R,z.b=N.b+(q.b-N.b)*R,z.a=N.a+(q.a-N.a)*R,z}static Hermite(N,q,R,z,v){const B=v*v,F=v*B,S=2*F-3*B+1,A=-2*F+3*B,y=F-2*B+v,E=F-B,t=N.r*S+R.r*A+q.r*y+z.r*E,e=N.g*S+R.g*A+q.g*y+z.g*E,b=N.b*S+R.b*A+q.b*y+z.b*E,f=N.a*S+R.a*A+q.a*y+z.a*E;return new x(t,e,b,f)}static Hermite1stDerivative(N,q,R,z,v){const B=new x;return this.Hermite1stDerivativeToRef(N,q,R,z,v,B),B}static Hermite1stDerivativeToRef(N,q,R,z,v,B){const F=v*v;B.r=6*(F-v)*N.r+(3*F-4*v+1)*q.r+6*(-F+v)*R.r+(3*F-2*v)*z.r,B.g=6*(F-v)*N.g+(3*F-4*v+1)*q.g+6*(-F+v)*R.g+(3*F-2*v)*z.g,B.b=6*(F-v)*N.b+(3*F-4*v+1)*q.b+6*(-F+v)*R.b+(3*F-2*v)*z.b,B.a=6*(F-v)*N.a+(3*F-4*v+1)*q.a+6*(-F+v)*R.a+(3*F-2*v)*z.a}static FromColor3(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new x(N.r,N.g,N.b,q)}static Zg(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new x(N[q],N[q+1],N[q+2],N[q+3])}static FromArrayToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;R.r=N[q],R.g=N[q+1],R.b=N[q+2],R.a=N[q+3]}static FromInts(N,q,R,z){return new x(N/255,q/255,R/255,z/255)}static CheckColors4(N,q){if(N.length===3*q){const q=[];for(let R=0;R<N.length;R+=3){const z=R/3*4;q[z]=N[R],q[z+1]=N[R+1],q[z+2]=N[R+2],q[z+3]=1}return q}return N}}Object.defineProperties(x.prototype,{dimension:{value:[4]},rank:{value:1}});class e{}e.hb=(0,z.d)(3,t.Black),e.ob=(0,z.d)(3,(()=>new x(0,0,0,0))),(0,v.f)("BABYLON.Color3",t),(0,v.f)("BABYLON.Color4",x)},11186:(N,q,R)=>{"use strict";R.d(q,{d:()=>F,f:()=>B,h:()=>z,l:()=>v});const z=1/2.2,v=2.2,B=(1+Math.sqrt(5))/2,F=.001},11306:(N,q,R)=>{"use strict";R.d(q,{c:()=>v});var z=R(11313);class v{static GetPlanes(N){const q=[];for(let R=0;R<6;R++)q.push(new z.e(0,0,0,0));return v.GetPlanesToRef(N,q),q}static GetNearPlaneToRef(N,q){const R=N.m;q.k.x=R[3]+R[2],q.k.y=R[7]+R[6],q.k.z=R[11]+R[10],q.d=R[15]+R[14],q.normalize()}static GetFarPlaneToRef(N,q){const R=N.m;q.k.x=R[3]-R[2],q.k.y=R[7]-R[6],q.k.z=R[11]-R[10],q.d=R[15]-R[14],q.normalize()}static GetLeftPlaneToRef(N,q){const R=N.m;q.k.x=R[3]+R[0],q.k.y=R[7]+R[4],q.k.z=R[11]+R[8],q.d=R[15]+R[12],q.normalize()}static GetRightPlaneToRef(N,q){const R=N.m;q.k.x=R[3]-R[0],q.k.y=R[7]-R[4],q.k.z=R[11]-R[8],q.d=R[15]-R[12],q.normalize()}static GetTopPlaneToRef(N,q){const R=N.m;q.k.x=R[3]-R[1],q.k.y=R[7]-R[5],q.k.z=R[11]-R[9],q.d=R[15]-R[13],q.normalize()}static GetBottomPlaneToRef(N,q){const R=N.m;q.k.x=R[3]+R[1],q.k.y=R[7]+R[5],q.k.z=R[11]+R[9],q.d=R[15]+R[13],q.normalize()}static GetPlanesToRef(N,q){v.GetNearPlaneToRef(N,q[0]),v.GetFarPlaneToRef(N,q[1]),v.GetLeftPlaneToRef(N,q[2]),v.GetRightPlaneToRef(N,q[3]),v.GetTopPlaneToRef(N,q[4]),v.GetBottomPlaneToRef(N,q[5])}static IsPointInFrustum(N,q){for(let R=0;R<6;R++)if(q[R].dotCoordinate(N)<0)return!1;return!0}}},11362:(N,q,R)=>{"use strict";R.d(q,{e:()=>S,f:()=>A});var z=R(11147),v=R(11181),B=R(11151);class F{static extractMinAndMaxIndexed(N,q,R,z,v,B){for(let F=R;F<R+z;F++){const R=3*q[F],z=N[R],S=N[R+1],A=N[R+2];v.minimizeInPlaceFromFloats(z,S,A),B.maximizeInPlaceFromFloats(z,S,A)}}static extractMinAndMax(N,q,R,z,v,B){for(let F=q,S=q*z;F<q+R;F++,S+=z){const q=N[S],R=N[S+1],z=N[S+2];v.minimizeInPlaceFromFloats(q,R,z),B.maximizeInPlaceFromFloats(q,R,z)}}}function S(N,q,R,z){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new v.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return F.extractMinAndMaxIndexed(N,q,R,z,S,A),B&&(S.x-=S.x*B.x+B.y,S.y-=S.y*B.x+B.y,S.z-=S.z*B.x+B.y,A.x+=A.x*B.x+B.y,A.y+=A.y*B.x+B.y,A.z+=A.z*B.x+B.y),{minimum:S,maximum:A}}function A(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0;const S=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new v.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return B||(B=3),F.extractMinAndMax(N,q,R,B,S,A),z&&(S.x-=S.x*z.x+z.y,S.y-=S.y*z.x+z.y,S.z-=S.z*z.x+z.y,A.x+=A.x*z.x+z.y,A.y+=A.y*z.x+z.y,A.z+=A.z*z.x+z.y),{minimum:S,maximum:A}}(0,z.c)([B.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z,v]=q;return!Array.isArray(z)&&!Array.isArray(v)}))],F,"extractMinAndMaxIndexed",null),(0,z.c)([B.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z]=q;return!Array.isArray(z)}))],F,"extractMinAndMax",null)},11689:(N,q,R)=>{"use strict";R.d(q,{e:()=>z.k});R(11495),R(11213),R(11186),R(11306),R(11693),R(11313),R(11411);var z=R(11181);R(11463)},11693:(N,q,R)=>{"use strict";R.d(q,{b:()=>S,d:()=>E,h:()=>t});var z,v=R(11197),B=R(11181),F=R(11186);!function(N){N[N.CW=0]="CW",N[N.CCW=1]="CCW"}(z||(z={}));class S{static Interpolate(N,q,R,z,v){const B=1-3*z+3*q,F=3*z-6*q,S=3*q;let A=N;for(let y=0;y<5;y++){const q=A*A;A-=(B*(q*A)+F*q+S*A-N)*(1/(3*B*q+2*F*A+S)),A=Math.min(1,Math.max(0,A))}return 3*Math.pow(1-A,2)*A*R+3*(1-A)*Math.pow(A,2)*v+Math.pow(A,3)}}class A{constructor(N){this._radians=N,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(N,q){const R=q.gd(N),z=Math.atan2(R.y,R.x);return new A(z)}static BetweenTwoVectors(N,q){let R=N.lengthSquared()*q.lengthSquared();if(0===R)return new A(Math.PI/2);R=Math.sqrt(R);let z=N.dot(q)/R;z=(0,v.c)(z,-1,1);const B=Math.acos(z);return new A(B)}static FromRadians(N){return new A(N)}static FromDegrees(N){return new A(N*Math.PI/180)}}class y{constructor(N,q,R){this.startPoint=N,this.midPoint=q,this.endPoint=R;const z=Math.pow(q.x,2)+Math.pow(q.y,2),v=(Math.pow(N.x,2)+Math.pow(N.y,2)-z)/2,F=(z-Math.pow(R.x,2)-Math.pow(R.y,2))/2,S=(N.x-q.x)*(q.y-R.y)-(q.x-R.x)*(N.y-q.y);this.centerPoint=new B.l((v*(q.y-R.y)-F*(N.y-q.y))/S,((N.x-q.x)*F-(q.x-R.x)*v)/S),this.radius=this.centerPoint.gd(this.startPoint).length(),this.startAngle=A.BetweenTwoPoints(this.centerPoint,this.startPoint);const y=this.startAngle.degrees();let E=A.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),t=A.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();E-y>180&&(E-=360),E-y<-180&&(E+=360),t-E>180&&(t-=360),t-E<-180&&(t+=360),this.orientation=E-y<0?0:1,this.angle=A.FromDegrees(0===this.orientation?y-t:t-y)}}class E{constructor(N,q){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new B.l(N,q))}addLineTo(N,q){if(this.closed)return this;const R=new B.l(N,q),z=this._points[this._points.length-1];return this._points.push(R),this._length+=R.gd(z).length(),this}addArcTo(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const F=this._points[this._points.length-1],S=new B.l(N,q),A=new B.l(R,z),E=new y(F,S,A);let t=E.angle.radians()/v;0===E.orientation&&(t*=-1);let x=E.startAngle.radians()+t;for(let B=0;B<v;B++){const N=Math.cos(x)*E.radius+E.centerPoint.x,q=Math.sin(x)*E.radius+E.centerPoint.y;this.addLineTo(N,q),x+=t}return this}addQuadraticCurveTo(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const B=(N,q,R,z)=>(1-N)*(1-N)*q+2*N*(1-N)*R+N*N*z,F=this._points[this._points.length-1];for(let S=0;S<=v;S++){const A=S/v,y=B(A,F.x,N,R),E=B(A,F.y,q,z);this.addLineTo(y,E)}return this}addBezierCurveTo(N,q,R,z,v,B){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const S=(N,q,R,z,v)=>(1-N)*(1-N)*(1-N)*q+3*N*(1-N)*(1-N)*R+3*N*N*(1-N)*z+N*N*N*v,A=this._points[this._points.length-1];for(let y=0;y<=F;y++){const E=y/F,t=S(E,A.x,N,R,v),x=S(E,A.y,q,z,B);this.addLineTo(t,x)}return this}isPointInside(N){let q=!1;const R=this._points.length;for(let z=R-1,v=0;v<R;z=v++){let R=this._points[z],B=this._points[v],F=B.x-R.x,S=B.y-R.y;if(Math.abs(S)>Number.EPSILON){if(S<0&&(R=this._points[v],F=-F,B=this._points[z],S=-S),N.y<R.y||N.y>B.y)continue;if(N.y===R.y&&N.x===R.x)return!0;{const z=S*(N.x-R.x)-F*(N.y-R.y);if(0===z)return!0;if(z<0)continue;q=!q}}else{if(N.y!==R.y)continue;if(B.x<=N.x&&N.x<=R.x||R.x<=N.x&&N.x<=B.x)return!0}}return q}close(){return this.closed=!0,this}length(){let N=this._length;if(this.closed){const q=this._points[this._points.length-1];N+=this._points[0].gd(q).length()}return N}area(){const N=this._points.length;let q=0;for(let R=N-1,z=0;z<N;R=z++)q+=this._points[R].x*this._points[z].y-this._points[z].x*this._points[R].y;return.5*q}getPoints(){return this._points}getPointAtLengthPosition(N){if(N<0||N>1)return B.l.Zero();const q=N*this.length();let R=0;for(let z=0;z<this._points.length;z++){const N=(z+1)%this._points.length,v=this._points[z],F=this._points[N].gd(v),S=F.length()+R;if(q>=R&&q<=S){const N=F.normalize(),z=q-R;return new B.l(v.x+N.x*z,v.y+N.y*z)}R=S}return B.l.Zero()}static StartingAt(N,q){return new E(N,q)}}class t{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=N,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:B.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:B.d.Identity()};for(let v=0;v<N.length;v++)this._curve[v]=N[v].clone();this._raw=R||!1,this._alignTangentsWithPath=z,this._compute(q,z)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(N){return this._updatePointAtData(N).point}getTangentAt(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(N,q),q?B.m.TransformCoordinates(B.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(N,q),q?B.m.TransformCoordinates(B.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(N,q),q?B.m.TransformCoordinates(B.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(N){return this.length()*N}getPreviousPointIndexAt(N){return this._updatePointAtData(N),this._pointAtData.previousPointArrayIndex}getSubPositionAt(N){return this._updatePointAtData(N),this._pointAtData.subPosition}getClosestPositionTo(N){let q=Number.MAX_VALUE,R=0;for(let z=0;z<this._curve.length-1;z++){const v=this._curve[z+0],F=this._curve[z+1].gd(v).normalize(),S=this._distances[z+1]-this._distances[z+0],A=Math.min(Math.max(B.m.Dot(F,N.gd(v).normalize()),0)*B.m.Distance(v,N)/S,1),y=B.m.Distance(v.add(F.scale(A*S)),N);y<q&&(q=y,R=(this._distances[z+0]+S*A)/this.length())}return R}slice(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(N<0&&(N=1- -1*N%1),q<0&&(q=1- -1*q%1),N>q){const R=N;N=q,q=R}const R=this.getCurve(),z=this.getPointAt(N);let v=this.getPreviousPointIndexAt(N);const B=this.getPointAt(q),F=this.getPreviousPointIndexAt(q)+1,S=[];return 0!==N&&(v++,S.push(z)),S.push(...R.slice(v,F)),1===q&&1!==N||S.push(B),new t(S,this.getNormalAt(N),this._raw,this._alignTangentsWithPath)}update(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let z=0;z<N.length;z++)this._curve[z].x=N[z].x,this._curve[z].y=N[z].y,this._curve[z].z=N[z].z;return this._compute(q,R),this}_compute(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=this._curve.length;if(R<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[R-1]=this._curve[R-1].gd(this._curve[R-2]),this._raw||this._tangents[R-1].normalize();const z=this._tangents[0],v=this._normalVector(z,N);let F,S,A,y,E;this._normals[0]=v,this._raw||this._normals[0].normalize(),this._binormals[0]=B.m.Cross(z,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let t=1;t<R;t++)F=this._getLastNonNullVector(t),t<R-1&&(S=this._getFirstNonNullVector(t),this._tangents[t]=q?S:F.add(S),this._tangents[t].normalize()),this._distances[t]=this._distances[t-1]+this._curve[t].gd(this._curve[t-1]).length(),A=this._tangents[t],E=this._binormals[t-1],this._normals[t]=B.m.Cross(E,A),this._raw||(0===this._normals[t].length()?(y=this._normals[t-1],this._normals[t]=y.clone()):this._normals[t].normalize()),this._binormals[t]=B.m.Cross(A,this._normals[t]),this._raw||this._binormals[t].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(N){let q=1,R=this._curve[N+q].gd(this._curve[N]);for(;0===R.length()&&N+q+1<this._curve.length;)q++,R=this._curve[N+q].gd(this._curve[N]);return R}_getLastNonNullVector(N){let q=1,R=this._curve[N].gd(this._curve[N-q]);for(;0===R.length()&&N>q+1;)q++,R=this._curve[N].gd(this._curve[N-q]);return R}_normalVector(N,q){let R,z=N.length();if(0===z&&(z=1),void 0===q||null===q){let q;q=(0,v.w)(Math.abs(N.y)/z,1,F.d)?(0,v.w)(Math.abs(N.x)/z,1,F.d)?(0,v.w)(Math.abs(N.z)/z,1,F.d)?B.m.Zero():new B.m(0,0,1):new B.m(1,0,0):new B.m(0,-1,0),R=B.m.Cross(N,q)}else R=B.m.Cross(N,q),B.m.CrossToRef(R,N,R);return R.normalize(),R}_updatePointAtData(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===N)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=N;const R=this.getPoints();if(N<=0)return this._setPointAtData(0,0,R[0],0,q);if(N>=1)return this._setPointAtData(1,1,R[R.length-1],R.length-1,q);let z,v=R[0],F=0;const S=N*this.length();for(let A=1;A<R.length;A++){z=R[A];const y=B.m.Distance(v,z);if(F+=y,F===S)return this._setPointAtData(N,1,z,A,q);if(F>S){const R=(F-S)/y,B=v.gd(z),E=z.add(B.scaleInPlace(R));return this._setPointAtData(N,1-R,E,A-1,q)}v=z}return this._pointAtData}_setPointAtData(N,q,R,z,v){return this._pointAtData.point=R,this._pointAtData.position=N,this._pointAtData.subPosition=q,this._pointAtData.previousPointArrayIndex=z,this._pointAtData.interpolateReady=v,v&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=B.d.Identity();const N=this._pointAtData.previousPointArrayIndex;if(N!==this._tangents.length-1){const q=N+1,R=this._tangents[N].clone(),z=this._normals[N].clone(),v=this._binormals[N].clone(),F=this._tangents[q].clone(),S=this._normals[q].clone(),A=this._binormals[q].clone(),y=B.g.RotationQuaternionFromAxis(z,v,R),E=B.g.RotationQuaternionFromAxis(S,A,F);B.g.Slerp(y,E,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11313:(N,q,R)=>{"use strict";R.d(q,{e:()=>v});var z=R(11181);class v{constructor(N,q,R,v){this.k=new z.m(N,q,R),this.d=v}ij(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new v(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let N=this.k.getHashCode();return N=397*N^this.d,N}normalize(){const N=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let q=0;return 0!==N&&(q=1/N),this.k.x*=q,this.k.y*=q,this.k.z*=q,this.d*=q,this}transform(N){const q=v._TmpMatrix;N.invertToRef(q);const R=q.m,z=this.k.x,B=this.k.y,F=this.k.z,S=this.d,A=z*R[0]+B*R[1]+F*R[2]+S*R[3],y=z*R[4]+B*R[5]+F*R[6]+S*R[7],E=z*R[8]+B*R[9]+F*R[10]+S*R[11],t=z*R[12]+B*R[13]+F*R[14]+S*R[15];return new v(A,y,E,t)}dotCoordinate(N){return this.k.x*N.x+this.k.y*N.y+this.k.z*N.z+this.d}copyFromPoints(N,q,R){const z=q.x-N.x,v=q.y-N.y,B=q.z-N.z,F=R.x-N.x,S=R.y-N.y,A=R.z-N.z,y=v*A-B*S,E=B*F-z*A,t=z*S-v*F,x=Math.sqrt(y*y+E*E+t*t);let e;return e=0!==x?1/x:0,this.k.x=y*e,this.k.y=E*e,this.k.z=t*e,this.d=-(this.k.x*N.x+this.k.y*N.y+this.k.z*N.z),this}isFrontFacingTo(N,q){return z.m.Dot(this.k,N)<=q}signedDistanceTo(N){return z.m.Dot(N,this.k)+this.d}static Zg(N){return new v(N[0],N[1],N[2],N[3])}static FromPoints(N,q,R){const z=new v(0,0,0,0);return z.copyFromPoints(N,q,R),z}static FromPositionAndNormal(N,q){const R=new v(0,0,0,0);return this.FromPositionAndNormalToRef(N,q,R)}static FromPositionAndNormalToRef(N,q,R){return R.k.p(q),R.k.normalize(),R.d=-N.dot(R.k),R}static SignedDistanceToPlaneFromPositionAndNormal(N,q,R){const v=-(q.x*N.x+q.y*N.y+q.z*N.z);return z.m.Dot(R,q)+v}}v._TmpMatrix=z.d.Identity()},11197:(N,q,R)=>{"use strict";function z(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(N-q)<=R}function v(N,q){return N===q?N:Math.random()*(q-N)+N}function B(N,q,R){return N+(q-N)*R}function F(N,q,R,z,v){const B=v*v,F=v*B;return N*(2*F-3*B+1)+R*(-2*F+3*B)+q*(F-2*B+v)+z*(F-B)}function S(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(R,Math.max(q,N))}function A(N){return N-=2*Math.PI*Math.floor((N+Math.PI)/(2*Math.PI))}function y(N){const q=N.toString(16);return N<=15?("0"+q).toUpperCase():q.toUpperCase()}function E(N){if(Math.log2)return Math.floor(Math.log2(N));if(N<0)return NaN;if(0===N)return-1/0;let q=0;if(N<1){for(;N<1;)q++,N*=2;q=-q}else if(N>1)for(;N>1;)q++,N=Math.floor(N/2);return q}function t(N,q){const R=N%q;return 0===R?q:t(q,R)}R.d(q,{c:()=>S,g:()=>F,i:()=>t,l:()=>E,m:()=>B,q:()=>A,u:()=>v,v:()=>y,w:()=>z})},11411:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{constructor(N,q){this.width=N,this.height=q}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let N=0|this.width;return N=397*N^this.height,N}p(N){this.width=N.width,this.height=N.height}qe(N,q){return this.width=N,this.height=q,this}set(N,q){return this.qe(N,q)}multiplyByFloats(N,q){return new z(this.width*N,this.height*q)}clone(){return new z(this.width,this.height)}equals(N){return!!N&&(this.width===N.width&&this.height===N.height)}get surface(){return this.width*this.height}static Zero(){return new z(0,0)}add(N){return new z(this.width+N.width,this.height+N.height)}gd(N){return new z(this.width-N.width,this.height-N.height)}scale(N){return new z(this.width*N,this.height*N)}static Lerp(N,q,R){const v=N.width+(q.width-N.width)*R,B=N.height+(q.height-N.height)*R;return new z(v,B)}}},11181:(N,q,R)=>{"use strict";R.d(q,{d:()=>b,g:()=>e,k:()=>D,l:()=>E,m:()=>t,p:()=>x});var z=R(11186),v=R(11190),B=R(11002),F=R(10977),S=R(10933),A=R(11197);const y=N=>parseInt(N.toString().replace(/\W/g,""));class E{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=N,this.y=q}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let N=y(this.x);return N=397*N^y(this.y),N}toArray(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N[q]=this.x,N[q+1]=this.y,this}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E.FromArrayToRef(N,q,this),this}ij(){return[this.x,this.y]}p(N){return this.x=N.x,this.y=N.y,this}qe(N,q){return this.x=N,this.y=q,this}set(N,q){return this.qe(N,q)}oe(N){return this.qe(N,N)}add(N){return new E(this.x+N.x,this.y+N.y)}addToRef(N,q){return q.x=this.x+N.x,q.y=this.y+N.y,q}addInPlace(N){return this.x+=N.x,this.y+=N.y,this}addInPlaceFromFloats(N,q){return this.x+=N,this.y+=q,this}addVector3(N){return new E(this.x+N.x,this.y+N.y)}gd(N){return new E(this.x-N.x,this.y-N.y)}subtractToRef(N,q){return q.x=this.x-N.x,q.y=this.y-N.y,q}pi(N){return this.x-=N.x,this.y-=N.y,this}multiplyInPlace(N){return this.x*=N.x,this.y*=N.y,this}multiply(N){return new E(this.x*N.x,this.y*N.y)}multiplyToRef(N,q){return q.x=this.x*N.x,q.y=this.y*N.y,q}multiplyByFloats(N,q){return new E(this.x*N,this.y*q)}divide(N){return new E(this.x/N.x,this.y/N.y)}divideToRef(N,q){return q.x=this.x/N.x,q.y=this.y/N.y,q}divideInPlace(N){return this.x=this.x/N.x,this.y=this.y/N.y,this}minimizeInPlace(N){return this.minimizeInPlaceFromFloats(N.x,N.y)}maximizeInPlace(N){return this.maximizeInPlaceFromFloats(N.x,N.y)}minimizeInPlaceFromFloats(N,q){return this.x=Math.min(N,this.x),this.y=Math.min(q,this.y),this}maximizeInPlaceFromFloats(N,q){return this.x=Math.max(N,this.x),this.y=Math.max(q,this.y),this}subtractFromFloats(N,q){return new E(this.x-N,this.y-q)}subtractFromFloatsToRef(N,q,R){return R.x=this.x-N,R.y=this.y-q,R}negate(){return new E(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(N){return N.x=-this.x,N.y=-this.y,N}scaleInPlace(N){return this.x*=N,this.y*=N,this}scale(N){return new E(this.x*N,this.y*N)}scaleToRef(N,q){return q.x=this.x*N,q.y=this.y*N,q}scaleAndAddToRef(N,q){return q.x+=this.x*N,q.y+=this.y*N,q}equals(N){return N&&this.x===N.x&&this.y===N.y}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.d;return N&&(0,A.w)(this.x,N.x,q)&&(0,A.w)(this.y,N.y,q)}equalsToFloats(N,q){return this.x===N&&this.y===q}floor(){return new E(Math.floor(this.x),Math.floor(this.y))}floorToRef(N){return N.x=Math.floor(this.x),N.y=Math.floor(this.y),N}fract(){return new E(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(N){return N.x=this.x-Math.floor(this.x),N.y=this.y-Math.floor(this.y),N}rotateToRef(N,q){const R=Math.cos(N),z=Math.sin(N),v=R*this.x-z*this.y,B=z*this.x+R*this.y;return q.x=v,q.y=B,q}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(N){return 0===N||1===N?this:this.scaleInPlace(1/N)}normalizeToNew(){const N=new E;return this.normalizeToRef(N),N}normalizeToRef(N){const q=this.length();return 0===q&&(N.x=this.x,N.y=this.y),this.scaleToRef(1/q,N)}clone(){return new E(this.x,this.y)}dot(N){return this.x*N.x+this.y*N.y}static Zero(){return new E(0,0)}static One(){return new E(1,1)}static Random(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new E((0,A.u)(N,q),(0,A.u)(N,q))}static RandomToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).qe((0,A.u)(N,q),(0,A.u)(N,q))}static get ZeroReadOnly(){return E._ZeroReadOnly}static Zg(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new E(N[q],N[q+1])}static FromArrayToRef(N,q,R){return R.x=N[q],R.y=N[q+1],R}static FromFloatsToRef(N,q,R){return R.qe(N,q),R}static CatmullRom(N,q,R,z,v){const B=v*v,F=v*B,S=.5*(2*q.x+(-N.x+R.x)*v+(2*N.x-5*q.x+4*R.x-z.x)*B+(-N.x+3*q.x-3*R.x+z.x)*F),A=.5*(2*q.y+(-N.y+R.y)*v+(2*N.y-5*q.y+4*R.y-z.y)*B+(-N.y+3*q.y-3*R.y+z.y)*F);return new E(S,A)}static ClampToRef(N,q,R,z){return z.x=(0,A.c)(N.x,q.x,R.x),z.y=(0,A.c)(N.y,q.y,R.y),z}static Clamp(N,q,R){const z=(0,A.c)(N.x,q.x,R.x),v=(0,A.c)(N.y,q.y,R.y);return new E(z,v)}static Hermite(N,q,R,z,v){const B=v*v,F=v*B,S=2*F-3*B+1,A=-2*F+3*B,y=F-2*B+v,t=F-B,x=N.x*S+R.x*A+q.x*y+z.x*t,e=N.y*S+R.y*A+q.y*y+z.y*t;return new E(x,e)}static Hermite1stDerivative(N,q,R,z,v){return this.Hermite1stDerivativeToRef(N,q,R,z,v,new E)}static Hermite1stDerivativeToRef(N,q,R,z,v,B){const F=v*v;return B.x=6*(F-v)*N.x+(3*F-4*v+1)*q.x+6*(-F+v)*R.x+(3*F-2*v)*z.x,B.y=6*(F-v)*N.y+(3*F-4*v+1)*q.y+6*(-F+v)*R.y+(3*F-2*v)*z.y,B}static Lerp(N,q,R){return E.LerpToRef(N,q,R,new E)}static LerpToRef(N,q,R,z){return z.x=N.x+(q.x-N.x)*R,z.y=N.y+(q.y-N.y)*R,z}static Dot(N,q){return N.x*q.x+N.y*q.y}static Normalize(N){return E.NormalizeToRef(N,new E)}static NormalizeToRef(N,q){return N.normalizeToRef(q),q}static Minimize(N,q){const R=N.x<q.x?N.x:q.x,z=N.y<q.y?N.y:q.y;return new E(R,z)}static Maximize(N,q){const R=N.x>q.x?N.x:q.x,z=N.y>q.y?N.y:q.y;return new E(R,z)}static Transform(N,q){return E.TransformToRef(N,q,new E)}static TransformToRef(N,q,R){const z=q.m,v=N.x*z[0]+N.y*z[4]+z[12],B=N.x*z[1]+N.y*z[5]+z[13];return R.x=v,R.y=B,R}static PointInTriangle(N,q,R,z){const v=.5*(-R.y*z.x+q.y*(-R.x+z.x)+q.x*(R.y-z.y)+R.x*z.y),B=v<0?-1:1,F=(q.y*z.x-q.x*z.y+(z.y-q.y)*N.x+(q.x-z.x)*N.y)*B,S=(q.x*R.y-q.y*R.x+(q.y-R.y)*N.x+(R.x-q.x)*N.y)*B;return F>0&&S>0&&F+S<2*v*B}static Distance(N,q){return Math.sqrt(E.DistanceSquared(N,q))}static DistanceSquared(N,q){const R=N.x-q.x,z=N.y-q.y;return R*R+z*z}static Center(N,q){return E.CenterToRef(N,q,new E)}static CenterToRef(N,q,R){return R.qe((N.x+q.x)/2,(N.y+q.y)/2)}static DistanceOfPointFromSegment(N,q,R){const z=E.DistanceSquared(q,R);if(0===z)return E.Distance(N,q);const v=R.gd(q),B=Math.max(0,Math.min(1,E.Dot(N.gd(q),v)/z)),F=q.add(v.multiplyByFloats(B,B));return E.Distance(N,F)}}E._ZeroReadOnly=E.Zero(),Object.defineProperties(E.prototype,{dimension:{value:[2]},rank:{value:1}});class t{get x(){return this._x}set x(N){this._x=N,this._isDirty=!0}get y(){return this._y}set y(N){this._y=N,this._isDirty=!0}get z(){return this._z}set z(N){this._z=N,this._isDirty=!0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=N,this._y=q,this._z=R}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"o"}getHashCode(){let N=y(this._x);return N=397*N^y(this._y),N=397*N^y(this._z),N}ij(){return[this._x,this._y,this._z]}toArray(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N[q]=this._x,N[q+1]=this._y,N[q+2]=this._z,this}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(N,q,this),this}toQuaternion(){return e.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(N){return this._x+=N._x,this._y+=N._y,this._z+=N._z,this._isDirty=!0,this}addInPlaceFromFloats(N,q,R){return this._x+=N,this._y+=q,this._z+=R,this._isDirty=!0,this}add(N){return new t(this._x+N._x,this._y+N._y,this._z+N._z)}addToRef(N,q){return q._x=this._x+N._x,q._y=this._y+N._y,q._z=this._z+N._z,q._isDirty=!0,q}pi(N){return this._x-=N._x,this._y-=N._y,this._z-=N._z,this._isDirty=!0,this}gd(N){return new t(this._x-N._x,this._y-N._y,this._z-N._z)}subtractToRef(N,q){return this.subtractFromFloatsToRef(N._x,N._y,N._z,q)}subtractFromFloats(N,q,R){return new t(this._x-N,this._y-q,this._z-R)}subtractFromFloatsToRef(N,q,R,z){return z._x=this._x-N,z._y=this._y-q,z._z=this._z-R,z._isDirty=!0,z}negate(){return new t(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(N){return N._x=-1*this._x,N._y=-1*this._y,N._z=-1*this._z,N._isDirty=!0,N}scaleInPlace(N){return this._x*=N,this._y*=N,this._z*=N,this._isDirty=!0,this}scale(N){return new t(this._x*N,this._y*N,this._z*N)}scaleToRef(N,q){return q._x=this._x*N,q._y=this._y*N,q._z=this._z*N,q._isDirty=!0,q}getNormalToRef(N){const q=this.length();let R=Math.acos(this.y/q);const z=Math.atan2(this.z,this.x);R>Math.PI/2?R-=Math.PI/2:R+=Math.PI/2;const v=q*Math.sin(R)*Math.cos(z),B=q*Math.cos(R),F=q*Math.sin(R)*Math.sin(z);return N.set(v,B,F),N}applyRotationQuaternionToRef(N,q){const R=this._x,z=this._y,v=this._z,B=N._x,F=N._y,S=N._z,A=N._w,y=2*(F*v-S*z),E=2*(S*R-B*v),t=2*(B*z-F*R);return q._x=R+A*y+F*t-S*E,q._y=z+A*E+S*y-B*t,q._z=v+A*t+B*E-F*y,q._isDirty=!0,q}applyRotationQuaternionInPlace(N){return this.applyRotationQuaternionToRef(N,this)}applyRotationQuaternion(N){return this.applyRotationQuaternionToRef(N,new t)}scaleAndAddToRef(N,q){return q._x+=this._x*N,q._y+=this._y*N,q._z+=this._z*N,q._isDirty=!0,q}projectOnPlane(N,q){return this.projectOnPlaneToRef(N,q,new t)}projectOnPlaneToRef(N,q,R){const z=N.k,v=N.d,B=f.o[0];this.subtractToRef(q,B),B.normalize();const F=t.Dot(B,z);if(Math.abs(F)<1e-10)R.oe(1/0);else{const N=-(t.Dot(q,z)+v)/F,S=B.scaleInPlace(N);q.addToRef(S,R)}return R}equals(N){return N&&this._x===N._x&&this._y===N._y&&this._z===N._z}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.d;return N&&(0,A.w)(this._x,N._x,q)&&(0,A.w)(this._y,N._y,q)&&(0,A.w)(this._z,N._z,q)}equalsToFloats(N,q,R){return this._x===N&&this._y===q&&this._z===R}multiplyInPlace(N){return this._x*=N._x,this._y*=N._y,this._z*=N._z,this._isDirty=!0,this}multiply(N){return this.multiplyByFloats(N._x,N._y,N._z)}multiplyToRef(N,q){return q._x=this._x*N._x,q._y=this._y*N._y,q._z=this._z*N._z,q._isDirty=!0,q}multiplyByFloats(N,q,R){return new t(this._x*N,this._y*q,this._z*R)}divide(N){return new t(this._x/N._x,this._y/N._y,this._z/N._z)}divideToRef(N,q){return q._x=this._x/N._x,q._y=this._y/N._y,q._z=this._z/N._z,q._isDirty=!0,q}divideInPlace(N){return this._x=this._x/N._x,this._y=this._y/N._y,this._z=this._z/N._z,this._isDirty=!0,this}minimizeInPlace(N){return this.minimizeInPlaceFromFloats(N._x,N._y,N._z)}maximizeInPlace(N){return this.maximizeInPlaceFromFloats(N._x,N._y,N._z)}minimizeInPlaceFromFloats(N,q,R){return N<this._x&&(this.x=N),q<this._y&&(this.y=q),R<this._z&&(this.z=R),this}maximizeInPlaceFromFloats(N,q,R){return N>this._x&&(this.x=N),q>this._y&&(this.y=q),R>this._z&&(this.z=R),this}isNonUniformWithinEpsilon(N){const q=Math.abs(this._x),R=Math.abs(this._y);if(!(0,A.w)(q,R,N))return!0;const z=Math.abs(this._z);return!(0,A.w)(q,z,N)||!(0,A.w)(R,z,N)}get isNonUniform(){const N=Math.abs(this._x);if(N!==Math.abs(this._y))return!0;return N!==Math.abs(this._z)}floorToRef(N){return N._x=Math.floor(this._x),N._y=Math.floor(this._y),N._z=Math.floor(this._z),N._isDirty=!0,N}floor(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(N){return N._x=this.x-Math.floor(this._x),N._y=this.y-Math.floor(this._y),N._z=this.z-Math.floor(this._z),N._isDirty=!0,N}fract(){return new t(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(N){if("xyz"===(N=N.toLowerCase()))return this;const q=f.o[0].p(this);return this.x=q[N[0]],this.y=q[N[1]],this.z=q[N[2]],this}rotateByQuaternionToRef(N,q){return N.toRotationMatrix(f.Matrix[0]),t.TransformCoordinatesToRef(this,f.Matrix[0],q),q}rotateByQuaternionAroundPointToRef(N,q,R){return this.subtractToRef(q,f.o[0]),f.o[0].rotateByQuaternionToRef(N,f.o[0]),q.addToRef(f.o[0],R),R}cross(N){return t.CrossToRef(this,N,new t)}normalizeFromLength(N){return 0===N||1===N?this:this.scaleInPlace(1/N)}normalizeToNew(){return this.normalizeToRef(new t)}normalizeToRef(N){const q=this.length();return 0===q||1===q?(N._x=this._x,N._y=this._y,N._z=this._z,N._isDirty=!0,N):this.scaleToRef(1/q,N)}clone(){return new t(this._x,this._y,this._z)}p(N){return this.qe(N._x,N._y,N._z)}qe(N,q,R){return this._x=N,this._y=q,this._z=R,this._isDirty=!0,this}set(N,q,R){return this.qe(N,q,R)}oe(N){return this._x=this._y=this._z=N,this._isDirty=!0,this}static GetClipFactor(N,q,R,z){const v=t.Dot(N,R);return(v-z)/(v-t.Dot(q,R))}static GetAngleBetweenVectors(N,q,R){const z=N.normalizeToRef(f.o[1]),v=q.normalizeToRef(f.o[2]);let B=t.Dot(z,v);B=(0,A.c)(B,-1,1);const F=Math.acos(B),S=f.o[3];return t.CrossToRef(z,v,S),t.Dot(S,R)>0?isNaN(F)?0:F:isNaN(F)?-Math.PI:-Math.acos(B)}static GetAngleBetweenVectorsOnPlane(N,q,R){f.o[0].p(N);const z=f.o[0];f.o[1].p(q);const v=f.o[1];f.o[2].p(R);const B=f.o[2],F=f.o[3],S=f.o[4];z.normalize(),v.normalize(),B.normalize(),t.CrossToRef(B,z,F),t.CrossToRef(F,B,S);const y=Math.atan2(t.Dot(v,F),t.Dot(v,S));return(0,A.q)(y)}static PitchYawRollToMoveBetweenPointsToRef(N,q,R){const z=D.o[0];return q.subtractToRef(N,z),R._y=Math.atan2(z.x,z.z)||0,R._x=Math.atan2(Math.sqrt(z.x**2+z.z**2),z.y)||0,R._z=0,R._isDirty=!0,R}static PitchYawRollToMoveBetweenPoints(N,q){const R=t.Zero();return t.PitchYawRollToMoveBetweenPointsToRef(N,q,R)}static SlerpToRef(N,q,R,v){R=(0,A.c)(R,0,1);const B=f.o[0],F=f.o[1];B.p(N);const S=B.length();B.normalizeFromLength(S),F.p(q);const y=F.length();F.normalizeFromLength(y);const E=t.Dot(B,F);let x,e;if(E<1-z.d){const N=Math.acos(E),q=1/Math.sin(N);x=Math.sin((1-R)*N)*q,e=Math.sin(R*N)*q}else x=1-R,e=R;return B.scaleInPlace(x),F.scaleInPlace(e),v.p(B).addInPlace(F),v.scaleInPlace((0,A.m)(S,y,R)),v}static SmoothToRef(N,q,R,z,v){return t.SlerpToRef(N,q,0===z?1:R/z,v),v}static Zg(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(N[q],N[q+1],N[q+2])}static FromFloatArray(N,q){return t.Zg(N,q)}static FromArrayToRef(N,q,R){return R._x=N[q],R._y=N[q+1],R._z=N[q+2],R._isDirty=!0,R}static FromFloatArrayToRef(N,q,R){return t.FromArrayToRef(N,q,R)}static FromFloatsToRef(N,q,R,z){return z.qe(N,q,R),z}static Zero(){return new t(0,0,0)}static One(){return new t(1,1,1)}static Up(){return new t(0,1,0)}static get UpReadOnly(){return t._UpReadOnly}static get DownReadOnly(){return t._DownReadOnly}static get RightReadOnly(){return t._RightReadOnly}static get LeftReadOnly(){return t._LeftReadOnly}static get LeftHandedForwardReadOnly(){return t._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return t._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return t._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return t._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return t._ZeroReadOnly}static get OneReadOnly(){return t._OneReadOnly}static Down(){return new t(0,-1,0)}static Forward(){return new t(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new t(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new t(1,0,0)}static Left(){return new t(-1,0,0)}static Random(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q))}static RandomToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).qe((0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q))}static TransformCoordinates(N,q){const R=t.Zero();return t.TransformCoordinatesToRef(N,q,R),R}static TransformCoordinatesToRef(N,q,R){return t.TransformCoordinatesFromFloatsToRef(N._x,N._y,N._z,q,R),R}static TransformCoordinatesFromFloatsToRef(N,q,R,z,v){const B=z.m,F=N*B[0]+q*B[4]+R*B[8]+B[12],S=N*B[1]+q*B[5]+R*B[9]+B[13],A=N*B[2]+q*B[6]+R*B[10]+B[14],y=1/(N*B[3]+q*B[7]+R*B[11]+B[15]);return v._x=F*y,v._y=S*y,v._z=A*y,v._isDirty=!0,v}static TransformNormal(N,q){const R=t.Zero();return t.TransformNormalToRef(N,q,R),R}static TransformNormalToRef(N,q,R){return this.TransformNormalFromFloatsToRef(N._x,N._y,N._z,q,R),R}static TransformNormalFromFloatsToRef(N,q,R,z,v){const B=z.m;return v._x=N*B[0]+q*B[4]+R*B[8],v._y=N*B[1]+q*B[5]+R*B[9],v._z=N*B[2]+q*B[6]+R*B[10],v._isDirty=!0,v}static CatmullRom(N,q,R,z,v){const B=v*v,F=v*B,S=.5*(2*q._x+(-N._x+R._x)*v+(2*N._x-5*q._x+4*R._x-z._x)*B+(-N._x+3*q._x-3*R._x+z._x)*F),A=.5*(2*q._y+(-N._y+R._y)*v+(2*N._y-5*q._y+4*R._y-z._y)*B+(-N._y+3*q._y-3*R._y+z._y)*F),y=.5*(2*q._z+(-N._z+R._z)*v+(2*N._z-5*q._z+4*R._z-z._z)*B+(-N._z+3*q._z-3*R._z+z._z)*F);return new t(S,A,y)}static Clamp(N,q,R){const z=new t;return t.ClampToRef(N,q,R,z),z}static ClampToRef(N,q,R,z){let v=N._x;v=v>R._x?R._x:v,v=v<q._x?q._x:v;let B=N._y;B=B>R._y?R._y:B,B=B<q._y?q._y:B;let F=N._z;return F=F>R._z?R._z:F,F=F<q._z?q._z:F,z.qe(v,B,F),z}static CheckExtends(N,q,R){q.minimizeInPlace(N),R.maximizeInPlace(N)}static Hermite(N,q,R,z,v){const B=v*v,F=v*B,S=2*F-3*B+1,A=-2*F+3*B,y=F-2*B+v,E=F-B,x=N._x*S+R._x*A+q._x*y+z._x*E,e=N._y*S+R._y*A+q._y*y+z._y*E,b=N._z*S+R._z*A+q._z*y+z._z*E;return new t(x,e,b)}static Hermite1stDerivative(N,q,R,z,v){const B=new t;return this.Hermite1stDerivativeToRef(N,q,R,z,v,B),B}static Hermite1stDerivativeToRef(N,q,R,z,v,B){const F=v*v;return B._x=6*(F-v)*N._x+(3*F-4*v+1)*q._x+6*(-F+v)*R._x+(3*F-2*v)*z._x,B._y=6*(F-v)*N._y+(3*F-4*v+1)*q._y+6*(-F+v)*R._y+(3*F-2*v)*z._y,B._z=6*(F-v)*N._z+(3*F-4*v+1)*q._z+6*(-F+v)*R._z+(3*F-2*v)*z._z,B._isDirty=!0,B}static Lerp(N,q,R){const z=new t(0,0,0);return t.LerpToRef(N,q,R,z),z}static LerpToRef(N,q,R,z){return z._x=N._x+(q._x-N._x)*R,z._y=N._y+(q._y-N._y)*R,z._z=N._z+(q._z-N._z)*R,z._isDirty=!0,z}static Dot(N,q){return N._x*q._x+N._y*q._y+N._z*q._z}dot(N){return this._x*N._x+this._y*N._y+this._z*N._z}static Cross(N,q){const R=new t;return t.CrossToRef(N,q,R),R}static CrossToRef(N,q,R){const z=N._y*q._z-N._z*q._y,v=N._z*q._x-N._x*q._z,B=N._x*q._y-N._y*q._x;return R.qe(z,v,B),R}static Normalize(N){const q=t.Zero();return t.NormalizeToRef(N,q),q}static NormalizeToRef(N,q){return N.normalizeToRef(q),q}static Project(N,q,R,z){const v=new t;return t.ProjectToRef(N,q,R,z,v),v}static ProjectToRef(N,q,R,z,v){var B;const F=z.width,A=z.height,y=z.x,E=z.y,x=f.Matrix[1],e=null===(B=S.b.LastCreatedEngine)||void 0===B?void 0:B.isNDCHalfZRange,D=e?1:.5,V=e?0:.5;b.FromValuesToRef(F/2,0,0,0,0,-A/2,0,0,0,0,D,0,y+F/2,A/2+E,V,1,x);const H=f.Matrix[0];return q.multiplyToRef(R,H),H.multiplyToRef(x,H),t.TransformCoordinatesToRef(N,H,v),v}static Reflect(N,q){return this.ReflectToRef(N,q,new t)}static ReflectToRef(N,q,R){const z=D.o[0];return z.p(q).scaleInPlace(2*t.Dot(N,q)),R.p(N).pi(z)}static _UnprojectFromInvertedMatrixToRef(N,q,R){t.TransformCoordinatesToRef(N,q,R);const z=q.m,v=N._x*z[3]+N._y*z[7]+N._z*z[11]+z[15];return(0,A.w)(v,1)&&R.scaleInPlace(1/v),R}static UnprojectFromTransform(N,q,R,z,v){return this.Unproject(N,q,R,z,v,b.IdentityReadOnly)}static Unproject(N,q,R,z,v,B){const F=new t;return t.UnprojectToRef(N,q,R,z,v,B,F),F}static UnprojectToRef(N,q,R,z,v,B,F){return t.UnprojectFloatsToRef(N._x,N._y,N._z,q,R,z,v,B,F),F}static UnprojectFloatsToRef(N,q,R,z,v,B,F,A,y){var E;const x=f.Matrix[0];B.multiplyToRef(F,x),x.multiplyToRef(A,x),x.invert();const e=f.o[0];return e.x=N/z*2-1,e.y=-(q/v*2-1),null!==(E=S.b.LastCreatedEngine)&&void 0!==E&&E.isNDCHalfZRange?e.z=R:e.z=2*R-1,t._UnprojectFromInvertedMatrixToRef(e,x,y),y}static Minimize(N,q){const R=new t;return R.p(N),R.minimizeInPlace(q),R}static Maximize(N,q){const R=new t;return R.p(N),R.maximizeInPlace(q),R}static Distance(N,q){return Math.sqrt(t.DistanceSquared(N,q))}static DistanceSquared(N,q){const R=N._x-q._x,z=N._y-q._y,v=N._z-q._z;return R*R+z*z+v*v}static ProjectOnTriangleToRef(N,q,R,v,B){const F=f.o[0],S=f.o[1],y=f.o[2],E=f.o[3],x=f.o[4];R.subtractToRef(q,F),v.subtractToRef(q,S),v.subtractToRef(R,y);const e=F.length(),b=S.length(),D=y.length();if(e<z.d||b<z.d||D<z.d)return B.p(q),t.Distance(N,q);N.subtractToRef(q,x),t.CrossToRef(F,S,E);const V=E.length();if(V<z.d)return B.p(q),t.Distance(N,q);E.normalizeFromLength(V);let H=x.length();if(H<z.d)return B.p(q),0;x.normalizeFromLength(H);const Y=t.Dot(E,x),T=f.o[5],L=f.o[6];T.p(E).scaleInPlace(-H*Y),L.p(N).addInPlace(T);const X=f.o[4],Q=f.o[5],h=f.o[7],u=f.o[8];X.p(F).scaleInPlace(1/e),u.p(S).scaleInPlace(1/b),X.addInPlace(u).scaleInPlace(-1),Q.p(F).scaleInPlace(-1/e),u.p(y).scaleInPlace(1/D),Q.addInPlace(u).scaleInPlace(-1),h.p(y).scaleInPlace(-1/D),u.p(S).scaleInPlace(-1/b),h.addInPlace(u).scaleInPlace(-1);const w=f.o[9];let c;w.p(L).pi(q),t.CrossToRef(X,w,u),c=t.Dot(u,E);const n=c;w.p(L).pi(R),t.CrossToRef(Q,w,u),c=t.Dot(u,E);const G=c;w.p(L).pi(v),t.CrossToRef(h,w,u),c=t.Dot(u,E);const s=c,Z=f.o[10];let J,M;n>0&&G<0?(Z.p(F),J=q,M=R):G>0&&s<0?(Z.p(y),J=R,M=v):(Z.p(S).scaleInPlace(-1),J=v,M=q);const m=f.o[9],g=f.o[4];J.subtractToRef(L,u),M.subtractToRef(L,m),t.CrossToRef(u,m,g);if(!(t.Dot(g,E)<0))return B.p(L),Math.abs(H*Y);const j=f.o[5];t.CrossToRef(Z,g,j),j.normalize();const l=f.o[9];l.p(J).pi(L);const I=l.length();if(I<z.d)return B.p(J),t.Distance(N,J);l.normalizeFromLength(I);const U=t.Dot(j,l),O=f.o[7];O.p(L).addInPlace(j.scaleInPlace(I*U)),u.p(O).pi(J),H=Z.length(),Z.normalizeFromLength(H);let i=t.Dot(u,Z)/Math.max(H,z.d);return i=(0,A.c)(i,0,1),O.p(J).addInPlace(Z.scaleInPlace(i*H)),B.p(O),t.Distance(N,O)}static Center(N,q){return t.CenterToRef(N,q,t.Zero())}static CenterToRef(N,q,R){return R.qe((N._x+q._x)/2,(N._y+q._y)/2,(N._z+q._z)/2)}static RotationFromAxis(N,q,R){const z=new t;return t.RotationFromAxisToRef(N,q,R,z),z}static RotationFromAxisToRef(N,q,R,z){const v=f.Quaternion[0];return e.RotationQuaternionFromAxisToRef(N,q,R,v),v.toEulerAnglesToRef(z),z}}t._UpReadOnly=t.Up(),t._DownReadOnly=t.Down(),t._LeftHandedForwardReadOnly=t.Forward(!1),t._RightHandedForwardReadOnly=t.Forward(!0),t._LeftHandedBackwardReadOnly=t.Backward(!1),t._RightHandedBackwardReadOnly=t.Backward(!0),t._RightReadOnly=t.Right(),t._LeftReadOnly=t.Left(),t._ZeroReadOnly=t.Zero(),t._OneReadOnly=t.One(),Object.defineProperties(t.prototype,{dimension:{value:[3]},rank:{value:1}});class x{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=N,this.y=q,this.z=R,this.w=z}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let N=y(this.x);return N=397*N^y(this.y),N=397*N^y(this.z),N=397*N^y(this.w),N}ij(){return[this.x,this.y,this.z,this.w]}toArray(N,q){return void 0===q&&(q=0),N[q]=this.x,N[q+1]=this.y,N[q+2]=this.z,N[q+3]=this.w,this}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x.FromArrayToRef(N,q,this),this}addInPlace(N){return this.x+=N.x,this.y+=N.y,this.z+=N.z,this.w+=N.w,this}addInPlaceFromFloats(N,q,R,z){return this.x+=N,this.y+=q,this.z+=R,this.w+=z,this}add(N){return new x(this.x+N.x,this.y+N.y,this.z+N.z,this.w+N.w)}addToRef(N,q){return q.x=this.x+N.x,q.y=this.y+N.y,q.z=this.z+N.z,q.w=this.w+N.w,q}pi(N){return this.x-=N.x,this.y-=N.y,this.z-=N.z,this.w-=N.w,this}gd(N){return new x(this.x-N.x,this.y-N.y,this.z-N.z,this.w-N.w)}subtractToRef(N,q){return q.x=this.x-N.x,q.y=this.y-N.y,q.z=this.z-N.z,q.w=this.w-N.w,q}subtractFromFloats(N,q,R,z){return new x(this.x-N,this.y-q,this.z-R,this.w-z)}subtractFromFloatsToRef(N,q,R,z,v){return v.x=this.x-N,v.y=this.y-q,v.z=this.z-R,v.w=this.w-z,v}negate(){return new x(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(N){return N.x=-this.x,N.y=-this.y,N.z=-this.z,N.w=-this.w,N}scaleInPlace(N){return this.x*=N,this.y*=N,this.z*=N,this.w*=N,this}scale(N){return new x(this.x*N,this.y*N,this.z*N,this.w*N)}scaleToRef(N,q){return q.x=this.x*N,q.y=this.y*N,q.z=this.z*N,q.w=this.w*N,q}scaleAndAddToRef(N,q){return q.x+=this.x*N,q.y+=this.y*N,q.z+=this.z*N,q.w+=this.w*N,q}equals(N){return N&&this.x===N.x&&this.y===N.y&&this.z===N.z&&this.w===N.w}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.d;return N&&(0,A.w)(this.x,N.x,q)&&(0,A.w)(this.y,N.y,q)&&(0,A.w)(this.z,N.z,q)&&(0,A.w)(this.w,N.w,q)}equalsToFloats(N,q,R,z){return this.x===N&&this.y===q&&this.z===R&&this.w===z}multiplyInPlace(N){return this.x*=N.x,this.y*=N.y,this.z*=N.z,this.w*=N.w,this}multiply(N){return new x(this.x*N.x,this.y*N.y,this.z*N.z,this.w*N.w)}multiplyToRef(N,q){return q.x=this.x*N.x,q.y=this.y*N.y,q.z=this.z*N.z,q.w=this.w*N.w,q}multiplyByFloats(N,q,R,z){return new x(this.x*N,this.y*q,this.z*R,this.w*z)}divide(N){return new x(this.x/N.x,this.y/N.y,this.z/N.z,this.w/N.w)}divideToRef(N,q){return q.x=this.x/N.x,q.y=this.y/N.y,q.z=this.z/N.z,q.w=this.w/N.w,q}divideInPlace(N){return this.divideToRef(N,this)}minimizeInPlace(N){return N.x<this.x&&(this.x=N.x),N.y<this.y&&(this.y=N.y),N.z<this.z&&(this.z=N.z),N.w<this.w&&(this.w=N.w),this}maximizeInPlace(N){return N.x>this.x&&(this.x=N.x),N.y>this.y&&(this.y=N.y),N.z>this.z&&(this.z=N.z),N.w>this.w&&(this.w=N.w),this}minimizeInPlaceFromFloats(N,q,R,z){return this.x=Math.min(N,this.x),this.y=Math.min(q,this.y),this.z=Math.min(R,this.z),this.w=Math.min(z,this.w),this}maximizeInPlaceFromFloats(N,q,R,z){return this.x=Math.max(N,this.x),this.y=Math.max(q,this.y),this.z=Math.max(R,this.z),this.w=Math.max(z,this.w),this}floorToRef(N){return N.x=Math.floor(this.x),N.y=Math.floor(this.y),N.z=Math.floor(this.z),N.w=Math.floor(this.w),N}floor(){return new x(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(N){return N.x=this.x-Math.floor(this.x),N.y=this.y-Math.floor(this.y),N.z=this.z-Math.floor(this.z),N.w=this.w-Math.floor(this.w),N}fract(){return new x(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(N){return 0===N||1===N?this:this.scaleInPlace(1/N)}normalizeToNew(){return this.normalizeToRef(new x)}normalizeToRef(N){const q=this.length();return 0===q||1===q?(N.x=this.x,N.y=this.y,N.z=this.z,N.w=this.w,N):this.scaleToRef(1/q,N)}toVector3(){return new t(this.x,this.y,this.z)}clone(){return new x(this.x,this.y,this.z,this.w)}p(N){return this.x=N.x,this.y=N.y,this.z=N.z,this.w=N.w,this}qe(N,q,R,z){return this.x=N,this.y=q,this.z=R,this.w=z,this}set(N,q,R,z){return this.qe(N,q,R,z)}oe(N){return this.x=this.y=this.z=this.w=N,this}dot(N){return this.x*N.x+this.y*N.y+this.z*N.z+this.w*N.w}static Zg(N,q){return q||(q=0),new x(N[q],N[q+1],N[q+2],N[q+3])}static FromArrayToRef(N,q,R){return R.x=N[q],R.y=N[q+1],R.z=N[q+2],R.w=N[q+3],R}static FromFloatArrayToRef(N,q,R){return x.FromArrayToRef(N,q,R),R}static FromFloatsToRef(N,q,R,z,v){return v.x=N,v.y=q,v.z=R,v.w=z,v}static Zero(){return new x(0,0,0,0)}static One(){return new x(1,1,1,1)}static Random(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new x((0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q))}static RandomToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;return R.x=(0,A.u)(N,q),R.y=(0,A.u)(N,q),R.z=(0,A.u)(N,q),R.w=(0,A.u)(N,q),R}static Clamp(N,q,R){return x.ClampToRef(N,q,R,new x)}static ClampToRef(N,q,R,z){return z.x=(0,A.c)(N.x,q.x,R.x),z.y=(0,A.c)(N.y,q.y,R.y),z.z=(0,A.c)(N.z,q.z,R.z),z.w=(0,A.c)(N.w,q.w,R.w),z}static CheckExtends(N,q,R){q.minimizeInPlace(N),R.maximizeInPlace(N)}static get ZeroReadOnly(){return x._ZeroReadOnly}static Normalize(N){return x.NormalizeToRef(N,new x)}static NormalizeToRef(N,q){return N.normalizeToRef(q),q}static Minimize(N,q){const R=new x;return R.p(N),R.minimizeInPlace(q),R}static Maximize(N,q){const R=new x;return R.p(N),R.maximizeInPlace(q),R}static Distance(N,q){return Math.sqrt(x.DistanceSquared(N,q))}static DistanceSquared(N,q){const R=N.x-q.x,z=N.y-q.y,v=N.z-q.z,B=N.w-q.w;return R*R+z*z+v*v+B*B}static Center(N,q){return x.CenterToRef(N,q,new x)}static CenterToRef(N,q,R){return R.x=(N.x+q.x)/2,R.y=(N.y+q.y)/2,R.z=(N.z+q.z)/2,R.w=(N.w+q.w)/2,R}static TransformCoordinates(N,q){return x.TransformCoordinatesToRef(N,q,new x)}static TransformCoordinatesToRef(N,q,R){return x.TransformCoordinatesFromFloatsToRef(N._x,N._y,N._z,q,R),R}static TransformCoordinatesFromFloatsToRef(N,q,R,z,v){const B=z.m,F=N*B[0]+q*B[4]+R*B[8]+B[12],S=N*B[1]+q*B[5]+R*B[9]+B[13],A=N*B[2]+q*B[6]+R*B[10]+B[14],y=N*B[3]+q*B[7]+R*B[11]+B[15];return v.x=F,v.y=S,v.z=A,v.w=y,v}static TransformNormal(N,q){return x.TransformNormalToRef(N,q,new x)}static TransformNormalToRef(N,q,R){const z=q.m,v=N.x*z[0]+N.y*z[4]+N.z*z[8],B=N.x*z[1]+N.y*z[5]+N.z*z[9],F=N.x*z[2]+N.y*z[6]+N.z*z[10];return R.x=v,R.y=B,R.z=F,R.w=N.w,R}static TransformNormalFromFloatsToRef(N,q,R,z,v,B){const F=v.m;return B.x=N*F[0]+q*F[4]+R*F[8],B.y=N*F[1]+q*F[5]+R*F[9],B.z=N*F[2]+q*F[6]+R*F[10],B.w=z,B}static FromVector3(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new x(N._x,N._y,N._z,q)}static Dot(N,q){return N.x*q.x+N.y*q.y+N.z*q.z+N.w*q.w}}x._ZeroReadOnly=x.Zero(),Object.defineProperties(x.prototype,{dimension:{value:[4]},rank:{value:1}});class e{get x(){return this._x}set x(N){this._x=N,this._isDirty=!0}get y(){return this._y}set y(N){this._y=N,this._isDirty=!0}get z(){return this._z}set z(N){this._z=N,this._isDirty=!0}get w(){return this._w}set w(N){this._w=N,this._isDirty=!0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=N,this._y=q,this._z=R,this._w=z}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let N=y(this._x);return N=397*N^y(this._y),N=397*N^y(this._z),N=397*N^y(this._w),N}ij(){return[this._x,this._y,this._z,this._w]}toArray(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N[q]=this._x,N[q+1]=this._y,N[q+2]=this._z,N[q+3]=this._w,this}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(N,q,this)}equals(N){return N&&this._x===N._x&&this._y===N._y&&this._z===N._z&&this._w===N._w}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.d;return N&&(0,A.w)(this._x,N._x,q)&&(0,A.w)(this._y,N._y,q)&&(0,A.w)(this._z,N._z,q)&&(0,A.w)(this._w,N._w,q)}clone(){return new e(this._x,this._y,this._z,this._w)}p(N){return this._x=N._x,this._y=N._y,this._z=N._z,this._w=N._w,this._isDirty=!0,this}qe(N,q,R,z){return this._x=N,this._y=q,this._z=R,this._w=z,this._isDirty=!0,this}set(N,q,R,z){return this.qe(N,q,R,z)}oe(N){return this.qe(N,N,N,N)}add(N){return new e(this._x+N._x,this._y+N._y,this._z+N._z,this._w+N._w)}addInPlace(N){return this._x+=N._x,this._y+=N._y,this._z+=N._z,this._w+=N._w,this._isDirty=!0,this}addToRef(N,q){return q._x=this._x+N._x,q._y=this._y+N._y,q._z=this._z+N._z,q._w=this._w+N._w,q._isDirty=!0,q}addInPlaceFromFloats(N,q,R,z){return this._x+=N,this._y+=q,this._z+=R,this._w+=z,this._isDirty=!0,this}subtractToRef(N,q){return q._x=this._x-N._x,q._y=this._y-N._y,q._z=this._z-N._z,q._w=this._w-N._w,q._isDirty=!0,q}subtractFromFloats(N,q,R,z){return this.subtractFromFloatsToRef(N,q,R,z,new e)}subtractFromFloatsToRef(N,q,R,z,v){return v._x=this._x-N,v._y=this._y-q,v._z=this._z-R,v._w=this._w-z,v._isDirty=!0,v}gd(N){return new e(this._x-N._x,this._y-N._y,this._z-N._z,this._w-N._w)}pi(N){return this._x-=N._x,this._y-=N._y,this._z-=N._z,this._w-=N._w,this._isDirty=!0,this}scale(N){return new e(this._x*N,this._y*N,this._z*N,this._w*N)}scaleToRef(N,q){return q._x=this._x*N,q._y=this._y*N,q._z=this._z*N,q._w=this._w*N,q._isDirty=!0,q}scaleInPlace(N){return this._x*=N,this._y*=N,this._z*=N,this._w*=N,this._isDirty=!0,this}scaleAndAddToRef(N,q){return q._x+=this._x*N,q._y+=this._y*N,q._z+=this._z*N,q._w+=this._w*N,q._isDirty=!0,q}multiply(N){const q=new e(0,0,0,1);return this.multiplyToRef(N,q),q}multiplyToRef(N,q){const R=this._x*N._w+this._y*N._z-this._z*N._y+this._w*N._x,z=-this._x*N._z+this._y*N._w+this._z*N._x+this._w*N._y,v=this._x*N._y-this._y*N._x+this._z*N._w+this._w*N._z,B=-this._x*N._x-this._y*N._y-this._z*N._z+this._w*N._w;return q.qe(R,z,v,B),q}multiplyInPlace(N){return this.multiplyToRef(N,this)}multiplyByFloats(N,q,R,z){return this._x*=N,this._y*=q,this._z*=R,this._w*=z,this._isDirty=!0,this}divide(N){throw new ReferenceError("Can not divide a quaternion")}divideToRef(N,q){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(N){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new e)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(N){return N._x=-this._x,N._y=-this._y,N._z=-this._z,N._w=-this._w,N._isDirty=!0,N}equalsToFloats(N,q,R,z){return this._x===N&&this._y===q&&this._z===R&&this._w===z}floorToRef(N){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(N){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(N){return N.qe(-this._x,-this._y,-this._z,this._w),N}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new e(-this._x,-this._y,-this._z,this._w)}invert(){const N=this.conjugate(),q=this.lengthSquared();return 0==q||1==q||N.scaleInPlace(1/q),N}invertInPlace(){this.conjugateInPlace();const N=this.lengthSquared();return 0==N||1==N||this.scaleInPlace(1/N),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(N){return 0===N||1===N?this:this.scaleInPlace(1/N)}normalizeToNew(){const N=new e(0,0,0,1);return this.normalizeToRef(N),N}normalizeToRef(N){const q=this.length();return 0===q||1===q?N.qe(this._x,this._y,this._z,this._w):this.scaleToRef(1/q,N)}toEulerAngles(){const N=t.Zero();return this.toEulerAnglesToRef(N),N}toEulerAnglesToRef(N){const q=this._z,R=this._x,z=this._y,v=this._w,B=z*q-R*v,F=.4999999;if(B<-F)N._y=2*Math.atan2(z,v),N._x=Math.PI/2,N._z=0,N._isDirty=!0;else if(B>F)N._y=2*Math.atan2(z,v),N._x=-Math.PI/2,N._z=0,N._isDirty=!0;else{const F=v*v,S=q*q,A=R*R,y=z*z;N._z=Math.atan2(2*(R*z+q*v),-S-A+y+F),N._x=Math.asin(-2*B),N._y=Math.atan2(2*(q*R+z*v),S-A-y+F),N._isDirty=!0}return N}toAlphaBetaGammaToRef(N){const q=this._z,R=this._x,z=this._y,v=this._w,B=Math.sqrt(R*R+z*z),F=Math.sqrt(q*q+v*v),S=2*Math.atan2(B,F),A=2*Math.atan2(q,v),y=2*Math.atan2(z,R),E=(A+y)/2,t=(A-y)/2;return N.set(t,S,E),N}toRotationMatrix(N){return b.FromQuaternionToRef(this,N),N}fromRotationMatrix(N){return e.FromRotationMatrixToRef(N,this),this}dot(N){return this._x*N._x+this._y*N._y+this._z*N._z+this._w*N._w}static FromRotationMatrix(N){const q=new e;return e.FromRotationMatrixToRef(N,q),q}static FromRotationMatrixToRef(N,q){const R=N.m,z=R[0],v=R[4],B=R[8],F=R[1],S=R[5],A=R[9],y=R[2],E=R[6],t=R[10],x=z+S+t;let e;return x>0?(e=.5/Math.sqrt(x+1),q._w=.25/e,q._x=(E-A)*e,q._y=(B-y)*e,q._z=(F-v)*e,q._isDirty=!0):z>S&&z>t?(e=2*Math.sqrt(1+z-S-t),q._w=(E-A)/e,q._x=.25*e,q._y=(v+F)/e,q._z=(B+y)/e,q._isDirty=!0):S>t?(e=2*Math.sqrt(1+S-z-t),q._w=(B-y)/e,q._x=(v+F)/e,q._y=.25*e,q._z=(A+E)/e,q._isDirty=!0):(e=2*Math.sqrt(1+t-z-S),q._w=(F-v)/e,q._x=(B+y)/e,q._y=(A+E)/e,q._z=.25*e,q._isDirty=!0),q}static Dot(N,q){return N._x*q._x+N._y*q._y+N._z*q._z+N._w*q._w}static AreClose(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const z=e.Dot(N,q);return 1-z*z<=R}static SmoothToRef(N,q,R,z,v){let B=0===z?1:R/z;return B=(0,A.c)(B,0,1),e.SlerpToRef(N,q,B,v),v}static Zero(){return new e(0,0,0,0)}static Inverse(N){return new e(-N._x,-N._y,-N._z,N._w)}static InverseToRef(N,q){return q.set(-N._x,-N._y,-N._z,N._w),q}static Identity(){return new e(0,0,0,1)}static IsIdentity(N){return N&&0===N._x&&0===N._y&&0===N._z&&1===N._w}static RotationAxis(N,q){return e.RotationAxisToRef(N,q,new e)}static RotationAxisToRef(N,q,R){R._w=Math.cos(q/2);const z=Math.sin(q/2)/N.length();return R._x=N._x*z,R._y=N._y*z,R._z=N._z*z,R._isDirty=!0,R}static Zg(N,q){return q||(q=0),new e(N[q],N[q+1],N[q+2],N[q+3])}static FromArrayToRef(N,q,R){return R._x=N[q],R._y=N[q+1],R._z=N[q+2],R._w=N[q+3],R._isDirty=!0,R}static FromFloatsToRef(N,q,R,z,v){return v.qe(N,q,R,z),v}static FromEulerAngles(N,q,R){const z=new e;return e.RotationYawPitchRollToRef(q,N,R,z),z}static FromEulerAnglesToRef(N,q,R,z){return e.RotationYawPitchRollToRef(q,N,R,z),z}static FromEulerVector(N){const q=new e;return e.RotationYawPitchRollToRef(N._y,N._x,N._z,q),q}static FromEulerVectorToRef(N,q){return e.RotationYawPitchRollToRef(N._y,N._x,N._z,q),q}static FromUnitVectorsToRef(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.d;const B=t.Dot(N,q)+1;return B<v?Math.abs(N.x)>Math.abs(N.z)?R.set(-N.y,N.x,0,0):R.set(0,-N.z,N.y,0):(t.CrossToRef(N,q,D.o[0]),R.set(D.o[0].x,D.o[0].y,D.o[0].z,B)),R.normalize()}static RotationYawPitchRoll(N,q,R){const z=new e;return e.RotationYawPitchRollToRef(N,q,R,z),z}static RotationYawPitchRollToRef(N,q,R,z){const v=.5*R,B=.5*q,F=.5*N,S=Math.sin(v),A=Math.cos(v),y=Math.sin(B),E=Math.cos(B),t=Math.sin(F),x=Math.cos(F);return z._x=x*y*A+t*E*S,z._y=t*E*A-x*y*S,z._z=x*E*S-t*y*A,z._w=x*E*A+t*y*S,z._isDirty=!0,z}static RotationAlphaBetaGamma(N,q,R){const z=new e;return e.RotationAlphaBetaGammaToRef(N,q,R,z),z}static RotationAlphaBetaGammaToRef(N,q,R,z){const v=.5*(R+N),B=.5*(R-N),F=.5*q;return z._x=Math.cos(B)*Math.sin(F),z._y=Math.sin(B)*Math.sin(F),z._z=Math.sin(v)*Math.cos(F),z._w=Math.cos(v)*Math.cos(F),z._isDirty=!0,z}static RotationQuaternionFromAxis(N,q,R){const z=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(N,q,R,z),z}static RotationQuaternionFromAxisToRef(N,q,R,z){const v=f.Matrix[0];return N=N.normalizeToRef(f.o[0]),q=q.normalizeToRef(f.o[1]),R=R.normalizeToRef(f.o[2]),b.FromXYZAxesToRef(N,q,R,v),e.FromRotationMatrixToRef(v,z),z}static FromLookDirectionLH(N,q){const R=new e;return e.FromLookDirectionLHToRef(N,q,R),R}static FromLookDirectionLHToRef(N,q,R){const z=f.Matrix[0];return b.LookDirectionLHToRef(N,q,z),e.FromRotationMatrixToRef(z,R),R}static FromLookDirectionRH(N,q){const R=new e;return e.FromLookDirectionRHToRef(N,q,R),R}static FromLookDirectionRHToRef(N,q,R){const z=f.Matrix[0];return b.LookDirectionRHToRef(N,q,z),e.FromRotationMatrixToRef(z,R)}static Slerp(N,q,R){const z=e.Identity();return e.SlerpToRef(N,q,R,z),z}static SlerpToRef(N,q,R,z){let v,B,F=N._x*q._x+N._y*q._y+N._z*q._z+N._w*q._w,S=!1;if(F<0&&(S=!0,F=-F),F>.999999)B=1-R,v=S?-R:R;else{const N=Math.acos(F),q=1/Math.sin(N);B=Math.sin((1-R)*N)*q,v=S?-Math.sin(R*N)*q:Math.sin(R*N)*q}return z._x=B*N._x+v*q._x,z._y=B*N._y+v*q._y,z._z=B*N._z+v*q._z,z._w=B*N._w+v*q._w,z._isDirty=!0,z}static Hermite(N,q,R,z,v){const B=v*v,F=v*B,S=2*F-3*B+1,A=-2*F+3*B,y=F-2*B+v,E=F-B,t=N._x*S+R._x*A+q._x*y+z._x*E,x=N._y*S+R._y*A+q._y*y+z._y*E,b=N._z*S+R._z*A+q._z*y+z._z*E,f=N._w*S+R._w*A+q._w*y+z._w*E;return new e(t,x,b,f)}static Hermite1stDerivative(N,q,R,z,v){const B=new e;return this.Hermite1stDerivativeToRef(N,q,R,z,v,B),B}static Hermite1stDerivativeToRef(N,q,R,z,v,B){const F=v*v;return B._x=6*(F-v)*N._x+(3*F-4*v+1)*q._x+6*(-F+v)*R._x+(3*F-2*v)*z._x,B._y=6*(F-v)*N._y+(3*F-4*v+1)*q._y+6*(-F+v)*R._y+(3*F-2*v)*z._y,B._z=6*(F-v)*N._z+(3*F-4*v+1)*q._z+6*(-F+v)*R._z+(3*F-2*v)*z._z,B._w=6*(F-v)*N._w+(3*F-4*v+1)*q._w+6*(-F+v)*R._w+(3*F-2*v)*z._w,B._isDirty=!0,B}static Normalize(N){const q=e.Zero();return e.NormalizeToRef(N,q),q}static NormalizeToRef(N,q){return N.normalizeToRef(q),q}static Clamp(N,q,R){const z=new e;return e.ClampToRef(N,q,R,z),z}static ClampToRef(N,q,R,z){return z.qe((0,A.c)(N.x,q.x,R.x),(0,A.c)(N.y,q.y,R.y),(0,A.c)(N.z,q.z,R.z),(0,A.c)(N.w,q.w,R.w))}static Random(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new e((0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q))}static RandomToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).qe((0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q),(0,A.u)(N,q))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(N,q){return Math.sqrt(e.DistanceSquared(N,q))}static DistanceSquared(N,q){const R=N.x-q.x,z=N.y-q.y,v=N.z-q.z,B=N.w-q.w;return R*R+z*z+v*v+B*B}static Center(N,q){return e.CenterToRef(N,q,e.Zero())}static CenterToRef(N,q,R){return R.qe((N.x+q.x)/2,(N.y+q.y)/2,(N.z+q.z)/2,(N.w+q.w)/2)}}Object.defineProperties(e.prototype,{dimension:{value:[4]},rank:{value:1}});class b{static get Use64Bits(){return F.d.MatrixUse64Bits}get m(){return this.Pj}markAsUpdated(){this.updateFlag=b._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=N,this._isIdentity3x2=N||R,this._isIdentityDirty=!this._isIdentity&&q,this._isIdentity3x2Dirty=!this._isIdentity3x2&&z}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,F.d.MatrixTrackPrecisionChange&&F.d.MatrixTrackedMatrices.push(this),this.Pj=new F.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const N=this.Pj;this._isIdentity=1===N[0]&&0===N[1]&&0===N[2]&&0===N[3]&&0===N[4]&&1===N[5]&&0===N[6]&&0===N[7]&&0===N[8]&&0===N[9]&&1===N[10]&&0===N[11]&&0===N[12]&&0===N[13]&&0===N[14]&&1===N[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Pj[0]||1!==this.Pj[5]||1!==this.Pj[15]||0!==this.Pj[1]||0!==this.Pj[2]||0!==this.Pj[3]||0!==this.Pj[4]||0!==this.Pj[6]||0!==this.Pj[7]||0!==this.Pj[8]||0!==this.Pj[9]||0!==this.Pj[10]||0!==this.Pj[11]||0!==this.Pj[12]||0!==this.Pj[13]||0!==this.Pj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const N=this.Pj,q=N[0],R=N[1],z=N[2],v=N[3],B=N[4],F=N[5],S=N[6],A=N[7],y=N[8],E=N[9],t=N[10],x=N[11],e=N[12],b=N[13],f=N[14],D=N[15],V=t*D-f*x,H=E*D-b*x,Y=E*f-b*t,T=y*D-e*x,L=y*f-t*e,X=y*b-e*E;return q*+(F*V-S*H+A*Y)+R*-(B*V-S*T+A*L)+z*+(B*H-F*T+A*X)+v*-(B*Y-F*L+S*X)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!N)return this.Pj;const R=this.Pj;for(let z=0;z<16;z++)N[q+z]=R[z];return this}ij(){return this.Pj}jd(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(N,q,this)}qe(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];return b.FromArrayToRef(q,0,this)}set(){const N=this.Pj;for(let q=0;q<16;q++)N[q]=q<0||arguments.length<=q?void 0:arguments[q];return this.markAsUpdated(),this}oe(N){const q=this.Pj;for(let R=0;R<16;R++)q[R]=N;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return b.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(N){const q=new b;return this.addToRef(N,q),q}addToRef(N,q){const R=this.Pj,z=q.Pj,v=N.m;for(let B=0;B<16;B++)z[B]=R[B]+v[B];return q.markAsUpdated(),q}addToSelf(N){const q=this.Pj,R=N.m;return q[0]+=R[0],q[1]+=R[1],q[2]+=R[2],q[3]+=R[3],q[4]+=R[4],q[5]+=R[5],q[6]+=R[6],q[7]+=R[7],q[8]+=R[8],q[9]+=R[9],q[10]+=R[10],q[11]+=R[11],q[12]+=R[12],q[13]+=R[13],q[14]+=R[14],q[15]+=R[15],this.markAsUpdated(),this}addInPlace(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]+=R[z];return this.markAsUpdated(),this}addInPlaceFromFloats(){const N=this.Pj;for(let q=0;q<16;q++)N[q]+=q<0||arguments.length<=q?void 0:arguments[q];return this.markAsUpdated(),this}gd(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]-=R[z];return this.markAsUpdated(),this}subtractToRef(N,q){const R=this.Pj,z=N.m,v=q.Pj;for(let B=0;B<16;B++)v[B]=R[B]-z[B];return q.markAsUpdated(),q}pi(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]-=R[z];return this.markAsUpdated(),this}subtractFromFloats(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];return this.subtractFromFloatsToRef(...q,new b)}subtractFromFloatsToRef(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];const z=q.pop(),v=this.Pj,B=z.Pj,F=q;for(let S=0;S<16;S++)B[S]=v[S]-F[S];return z.markAsUpdated(),z}invertToRef(N){if(!0===this._isIdentity)return b.IdentityToRef(N),N;const q=this.Pj,R=q[0],z=q[1],v=q[2],B=q[3],F=q[4],S=q[5],A=q[6],y=q[7],E=q[8],t=q[9],x=q[10],e=q[11],f=q[12],D=q[13],V=q[14],H=q[15],Y=x*H-V*e,T=t*H-D*e,L=t*V-D*x,X=E*H-f*e,Q=E*V-x*f,h=E*D-f*t,u=+(S*Y-A*T+y*L),w=-(F*Y-A*X+y*Q),c=+(F*T-S*X+y*h),n=-(F*L-S*Q+A*h),G=R*u+z*w+v*c+B*n;if(0===G)return N.p(this),N;const s=1/G,Z=A*H-V*y,J=S*H-D*y,M=S*V-D*A,m=F*H-f*y,g=F*V-f*A,j=F*D-f*S,l=A*e-x*y,I=S*e-t*y,U=S*x-t*A,O=F*e-E*y,i=F*x-E*A,P=F*t-E*S,k=-(z*Y-v*T+B*L),o=+(R*Y-v*X+B*Q),C=-(R*T-z*X+B*h),K=+(R*L-z*Q+v*h),r=+(z*Z-v*J+B*M),a=-(R*Z-v*m+B*g),d=+(R*J-z*m+B*j),p=-(R*M-z*g+v*j),W=-(z*l-v*I+B*U),NN=+(R*l-v*O+B*i),qN=-(R*I-z*O+B*P),RN=+(R*U-z*i+v*P);return b.FromValuesToRef(u*s,k*s,r*s,W*s,w*s,o*s,a*s,NN*s,c*s,C*s,d*s,qN*s,n*s,K*s,p*s,RN*s,N),N}addAtIndex(N,q){return this.Pj[N]+=q,this.markAsUpdated(),this}multiplyAtIndex(N,q){return this.Pj[N]*=q,this.markAsUpdated(),this}setTranslationFromFloats(N,q,R){return this.Pj[12]=N,this.Pj[13]=q,this.Pj[14]=R,this.markAsUpdated(),this}addTranslationFromFloats(N,q,R){return this.Pj[12]+=N,this.Pj[13]+=q,this.Pj[14]+=R,this.markAsUpdated(),this}setTranslation(N){return this.setTranslationFromFloats(N._x,N._y,N._z)}getTranslation(){return new t(this.Pj[12],this.Pj[13],this.Pj[14])}getTranslationToRef(N){return N.x=this.Pj[12],N.y=this.Pj[13],N.z=this.Pj[14],N}removeRotationAndScaling(){const N=this.m;return b.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,N[12],N[13],N[14],N[15],this),this._updateIdentityStatus(0===N[12]&&0===N[13]&&0===N[14]&&1===N[15]),this}p(N){N.copyToArray(this.Pj);const q=N;return this.updateFlag=q.updateFlag,this._updateIdentityStatus(q._isIdentity,q._isIdentityDirty,q._isIdentity3x2,q._isIdentity3x2Dirty),this}copyToArray(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.Pj;return N[q]=R[0],N[q+1]=R[1],N[q+2]=R[2],N[q+3]=R[3],N[q+4]=R[4],N[q+5]=R[5],N[q+6]=R[6],N[q+7]=R[7],N[q+8]=R[8],N[q+9]=R[9],N[q+10]=R[10],N[q+11]=R[11],N[q+12]=R[12],N[q+13]=R[13],N[q+14]=R[14],N[q+15]=R[15],this}multiply(N){const q=new b;return this.multiplyToRef(N,q),q}multiplyInPlace(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]*=R[z];return this.markAsUpdated(),this}multiplyByFloats(){const N=this.Pj;for(let q=0;q<16;q++)N[q]*=q<0||arguments.length<=q?void 0:arguments[q];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];const z=q.pop(),v=this.Pj,B=z.Pj,F=q;for(let S=0;S<16;S++)B[S]=v[S]*F[S];return z.markAsUpdated(),z}multiplyToRef(N,q){return this._isIdentity?(q.p(N),q):N._isIdentity?(q.p(this),q):(this.multiplyToArray(N,q.Pj,0),q.markAsUpdated(),q)}multiplyToArray(N,q,R){const z=this.Pj,v=N.m,B=z[0],F=z[1],S=z[2],A=z[3],y=z[4],E=z[5],t=z[6],x=z[7],e=z[8],b=z[9],f=z[10],D=z[11],V=z[12],H=z[13],Y=z[14],T=z[15],L=v[0],X=v[1],Q=v[2],h=v[3],u=v[4],w=v[5],c=v[6],n=v[7],G=v[8],s=v[9],Z=v[10],J=v[11],M=v[12],m=v[13],g=v[14],j=v[15];return q[R]=B*L+F*u+S*G+A*M,q[R+1]=B*X+F*w+S*s+A*m,q[R+2]=B*Q+F*c+S*Z+A*g,q[R+3]=B*h+F*n+S*J+A*j,q[R+4]=y*L+E*u+t*G+x*M,q[R+5]=y*X+E*w+t*s+x*m,q[R+6]=y*Q+E*c+t*Z+x*g,q[R+7]=y*h+E*n+t*J+x*j,q[R+8]=e*L+b*u+f*G+D*M,q[R+9]=e*X+b*w+f*s+D*m,q[R+10]=e*Q+b*c+f*Z+D*g,q[R+11]=e*h+b*n+f*J+D*j,q[R+12]=V*L+H*u+Y*G+T*M,q[R+13]=V*X+H*w+Y*s+T*m,q[R+14]=V*Q+H*c+Y*Z+T*g,q[R+15]=V*h+H*n+Y*J+T*j,this}divide(N){return this.divideToRef(N,new b)}divideToRef(N,q){const R=this.Pj,z=N.m,v=q.Pj;for(let B=0;B<16;B++)v[B]=R[B]/z[B];return q.markAsUpdated(),q}divideInPlace(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]/=R[z];return this.markAsUpdated(),this}minimizeInPlace(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]=Math.min(q[z],R[z]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const N=this.Pj;for(let q=0;q<16;q++)N[q]=Math.min(N[q],q<0||arguments.length<=q?void 0:arguments[q]);return this.markAsUpdated(),this}maximizeInPlace(N){const q=this.Pj,R=N.m;for(let z=0;z<16;z++)q[z]=Math.min(q[z],R[z]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const N=this.Pj;for(let q=0;q<16;q++)N[q]=Math.min(N[q],q<0||arguments.length<=q?void 0:arguments[q]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new b)}negateInPlace(){const N=this.Pj;for(let q=0;q<16;q++)N[q]=-N[q];return this.markAsUpdated(),this}negateToRef(N){const q=this.Pj,R=N.Pj;for(let z=0;z<16;z++)R[z]=-q[z];return N.markAsUpdated(),N}equals(N){const q=N;if(!q)return!1;if((this._isIdentity||q._isIdentity)&&!this._isIdentityDirty&&!q._isIdentityDirty)return this._isIdentity&&q._isIdentity;const R=this.m,z=q.m;return R[0]===z[0]&&R[1]===z[1]&&R[2]===z[2]&&R[3]===z[3]&&R[4]===z[4]&&R[5]===z[5]&&R[6]===z[6]&&R[7]===z[7]&&R[8]===z[8]&&R[9]===z[9]&&R[10]===z[10]&&R[11]===z[11]&&R[12]===z[12]&&R[13]===z[13]&&R[14]===z[14]&&R[15]===z[15]}equalsWithEpsilon(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.Pj,z=N.m;for(let v=0;v<16;v++)if(!(0,A.w)(R[v],z[v],q))return!1;return!0}equalsToFloats(){const N=this.Pj;for(let q=0;q<16;q++)if(N[q]!=(q<0||arguments.length<=q?void 0:arguments[q]))return!1;return!0}floor(){return this.floorToRef(new b)}floorToRef(N){const q=this.Pj,R=N.Pj;for(let z=0;z<16;z++)R[z]=Math.floor(q[z]);return N.markAsUpdated(),N}fract(){return this.fractToRef(new b)}fractToRef(N){const q=this.Pj,R=N.Pj;for(let z=0;z<16;z++)R[z]=q[z]-Math.floor(q[z]);return N.markAsUpdated(),N}clone(){const N=new b;return N.p(this),N}getClassName(){return"Matrix"}getHashCode(){let N=y(this.Pj[0]);for(let q=1;q<16;q++)N=397*N^y(this.Pj[q]);return N}decomposeToTransformNode(N){return N.rotationQuaternion=N.rotationQuaternion||new e,this.decompose(N.re,N.rotationQuaternion,N.position)}decompose(N,q,R,z){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return R&&R.oe(0),N&&N.oe(1),q&&q.qe(0,0,0,1),!0;const B=this.Pj;if(R&&R.qe(B[12],B[13],B[14]),(N=N||f.o[0]).x=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2]),N.y=Math.sqrt(B[4]*B[4]+B[5]*B[5]+B[6]*B[6]),N.z=Math.sqrt(B[8]*B[8]+B[9]*B[9]+B[10]*B[10]),z){const q=(v?z.absoluteScaling.x:z.re.x)<0?-1:1,R=(v?z.absoluteScaling.y:z.re.y)<0?-1:1,B=(v?z.absoluteScaling.z:z.re.z)<0?-1:1;N.x*=q,N.y*=R,N.z*=B}else this.determinant()<=0&&(N.y*=-1);if(0===N._x||0===N._y||0===N._z)return q&&q.qe(0,0,0,1),!1;if(q){const R=1/N._x,z=1/N._y,v=1/N._z;b.FromValuesToRef(B[0]*R,B[1]*R,B[2]*R,0,B[4]*z,B[5]*z,B[6]*z,0,B[8]*v,B[9]*v,B[10]*v,0,0,0,0,1,f.Matrix[0]),e.FromRotationMatrixToRef(f.Matrix[0],q)}return!0}getRow(N){if(N<0||N>3)return null;const q=4*N;return new x(this.Pj[q+0],this.Pj[q+1],this.Pj[q+2],this.Pj[q+3])}getRowToRef(N,q){if(N>=0&&N<=3){const R=4*N;q.x=this.Pj[R+0],q.y=this.Pj[R+1],q.z=this.Pj[R+2],q.w=this.Pj[R+3]}return q}setRow(N,q){return this.setRowFromFloats(N,q.x,q.y,q.z,q.w)}transpose(){const N=new b;return b.TransposeToRef(this,N),N}transposeToRef(N){return b.TransposeToRef(this,N),N}setRowFromFloats(N,q,R,z,v){if(N<0||N>3)return this;const B=4*N;return this.Pj[B+0]=q,this.Pj[B+1]=R,this.Pj[B+2]=z,this.Pj[B+3]=v,this.markAsUpdated(),this}scale(N){const q=new b;return this.scaleToRef(N,q),q}scaleToRef(N,q){for(let R=0;R<16;R++)q.Pj[R]=this.Pj[R]*N;return q.markAsUpdated(),q}scaleAndAddToRef(N,q){for(let R=0;R<16;R++)q.Pj[R]+=this.Pj[R]*N;return q.markAsUpdated(),q}scaleInPlace(N){const q=this.Pj;for(let R=0;R<16;R++)q[R]*=N;return this.markAsUpdated(),this}toNormalMatrix(N){const q=f.Matrix[0];this.invertToRef(q),q.transposeToRef(N);const R=N.Pj;return b.FromValuesToRef(R[0],R[1],R[2],0,R[4],R[5],R[6],0,R[8],R[9],R[10],0,0,0,0,1,N),N}getRotationMatrix(){const N=new b;return this.getRotationMatrixToRef(N),N}getRotationMatrixToRef(N){const q=f.o[0];if(!this.decompose(q))return b.IdentityToRef(N),N;const R=this.Pj,z=1/q._x,v=1/q._y,B=1/q._z;return b.FromValuesToRef(R[0]*z,R[1]*z,R[2]*z,0,R[4]*v,R[5]*v,R[6]*v,0,R[8]*B,R[9]*B,R[10]*B,0,0,0,0,1,N),N}toggleModelMatrixHandInPlace(){const N=this.Pj;return N[2]*=-1,N[6]*=-1,N[8]*=-1,N[9]*=-1,N[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const N=this.Pj;return N[8]*=-1,N[9]*=-1,N[10]*=-1,N[11]*=-1,this.markAsUpdated(),this}static Zg(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=new b;return b.FromArrayToRef(N,q,R),R}static FromArrayToRef(N,q,R){for(let z=0;z<16;z++)R.Pj[z]=N[z+q];return R.markAsUpdated(),R}static FromFloat32ArrayToRefScaled(N,q,R,z){return z.Pj[0]=N[0+q]*R,z.Pj[1]=N[1+q]*R,z.Pj[2]=N[2+q]*R,z.Pj[3]=N[3+q]*R,z.Pj[4]=N[4+q]*R,z.Pj[5]=N[5+q]*R,z.Pj[6]=N[6+q]*R,z.Pj[7]=N[7+q]*R,z.Pj[8]=N[8+q]*R,z.Pj[9]=N[9+q]*R,z.Pj[10]=N[10+q]*R,z.Pj[11]=N[11+q]*R,z.Pj[12]=N[12+q]*R,z.Pj[13]=N[13+q]*R,z.Pj[14]=N[14+q]*R,z.Pj[15]=N[15+q]*R,z.markAsUpdated(),z}static get IdentityReadOnly(){return b._IdentityReadOnly}static FromValuesToRef(N,q,R,z,v,B,F,S,A,y,E,t,x,e,b,f,D){const V=D.Pj;V[0]=N,V[1]=q,V[2]=R,V[3]=z,V[4]=v,V[5]=B,V[6]=F,V[7]=S,V[8]=A,V[9]=y,V[10]=E,V[11]=t,V[12]=x,V[13]=e,V[14]=b,V[15]=f,D.markAsUpdated()}static FromValues(N,q,R,z,v,B,F,S,A,y,E,t,x,e,f,D){const V=new b,H=V.Pj;return H[0]=N,H[1]=q,H[2]=R,H[3]=z,H[4]=v,H[5]=B,H[6]=F,H[7]=S,H[8]=A,H[9]=y,H[10]=E,H[11]=t,H[12]=x,H[13]=e,H[14]=f,H[15]=D,V.markAsUpdated(),V}static Compose(N,q,R){const z=new b;return b.ComposeToRef(N,q,R,z),z}static ComposeToRef(N,q,R,z){const v=z.Pj,B=q._x,F=q._y,S=q._z,A=q._w,y=B+B,E=F+F,t=S+S,x=B*y,e=B*E,b=B*t,f=F*E,D=F*t,V=S*t,H=A*y,Y=A*E,T=A*t,L=N._x,X=N._y,Q=N._z;return v[0]=(1-(f+V))*L,v[1]=(e+T)*L,v[2]=(b-Y)*L,v[3]=0,v[4]=(e-T)*X,v[5]=(1-(x+V))*X,v[6]=(D+H)*X,v[7]=0,v[8]=(b+Y)*Q,v[9]=(D-H)*Q,v[10]=(1-(x+f))*Q,v[11]=0,v[12]=R._x,v[13]=R._y,v[14]=R._z,v[15]=1,z.markAsUpdated(),z}static Identity(){const N=b.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return N._updateIdentityStatus(!0),N}static IdentityToRef(N){return b.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,N),N._updateIdentityStatus(!0),N}static Zero(){const N=b.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return N._updateIdentityStatus(!1),N}static RotationX(N){const q=new b;return b.RotationXToRef(N,q),q}static Invert(N){const q=new b;return N.invertToRef(q),q}static RotationXToRef(N,q){const R=Math.sin(N),z=Math.cos(N);return b.FromValuesToRef(1,0,0,0,0,z,R,0,0,-R,z,0,0,0,0,1,q),q._updateIdentityStatus(1===z&&0===R),q}static RotationY(N){const q=new b;return b.RotationYToRef(N,q),q}static RotationYToRef(N,q){const R=Math.sin(N),z=Math.cos(N);return b.FromValuesToRef(z,0,-R,0,0,1,0,0,R,0,z,0,0,0,0,1,q),q._updateIdentityStatus(1===z&&0===R),q}static RotationZ(N){const q=new b;return b.RotationZToRef(N,q),q}static RotationZToRef(N,q){const R=Math.sin(N),z=Math.cos(N);return b.FromValuesToRef(z,R,0,0,-R,z,0,0,0,0,1,0,0,0,0,1,q),q._updateIdentityStatus(1===z&&0===R),q}static RotationAxis(N,q){const R=new b;return b.RotationAxisToRef(N,q,R),R}static RotationAxisToRef(N,q,R){const z=Math.sin(-q),v=Math.cos(-q),B=1-v;N=N.normalizeToRef(f.o[0]);const F=R.Pj;return F[0]=N._x*N._x*B+v,F[1]=N._x*N._y*B-N._z*z,F[2]=N._x*N._z*B+N._y*z,F[3]=0,F[4]=N._y*N._x*B+N._z*z,F[5]=N._y*N._y*B+v,F[6]=N._y*N._z*B-N._x*z,F[7]=0,F[8]=N._z*N._x*B-N._y*z,F[9]=N._z*N._y*B+N._x*z,F[10]=N._z*N._z*B+v,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,R.markAsUpdated(),R}static RotationAlignToRef(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=t.Dot(q,N),F=R.Pj;if(B<-1+z.d)F[0]=-1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=v?1:-1,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=v?-1:1,F[11]=0;else{const R=t.Cross(q,N),z=1/(1+B);F[0]=R._x*R._x*z+B,F[1]=R._y*R._x*z-R._z,F[2]=R._z*R._x*z+R._y,F[3]=0,F[4]=R._x*R._y*z+R._z,F[5]=R._y*R._y*z+B,F[6]=R._z*R._y*z-R._x,F[7]=0,F[8]=R._x*R._z*z-R._y,F[9]=R._y*R._z*z+R._x,F[10]=R._z*R._z*z+B,F[11]=0}return F[12]=0,F[13]=0,F[14]=0,F[15]=1,R.markAsUpdated(),R}static RotationYawPitchRoll(N,q,R){const z=new b;return b.RotationYawPitchRollToRef(N,q,R,z),z}static RotationYawPitchRollToRef(N,q,R,z){return e.RotationYawPitchRollToRef(N,q,R,f.Quaternion[0]),f.Quaternion[0].toRotationMatrix(z),z}static Scaling(N,q,R){const z=new b;return b.ScalingToRef(N,q,R,z),z}static ScalingToRef(N,q,R,z){return b.FromValuesToRef(N,0,0,0,0,q,0,0,0,0,R,0,0,0,0,1,z),z._updateIdentityStatus(1===N&&1===q&&1===R),z}static Translation(N,q,R){const z=new b;return b.TranslationToRef(N,q,R,z),z}static TranslationToRef(N,q,R,z){return b.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,N,q,R,1,z),z._updateIdentityStatus(0===N&&0===q&&0===R),z}static Lerp(N,q,R){const z=new b;return b.LerpToRef(N,q,R,z),z}static LerpToRef(N,q,R,z){const v=z.Pj,B=N.m,F=q.m;for(let S=0;S<16;S++)v[S]=B[S]*(1-R)+F[S]*R;return z.markAsUpdated(),z}static DecomposeLerp(N,q,R){const z=new b;return b.DecomposeLerpToRef(N,q,R,z),z}static DecomposeLerpToRef(N,q,R,z){const v=f.o[0],B=f.Quaternion[0],F=f.o[1];N.decompose(v,B,F);const S=f.o[2],A=f.Quaternion[1],y=f.o[3];q.decompose(S,A,y);const E=f.o[4];t.LerpToRef(v,S,R,E);const x=f.Quaternion[2];e.SlerpToRef(B,A,R,x);const D=f.o[5];return t.LerpToRef(F,y,R,D),b.ComposeToRef(E,x,D,z),z}static LookAtLH(N,q,R){const z=new b;return b.LookAtLHToRef(N,q,R,z),z}static LookAtLHToRef(N,q,R,z){const v=f.o[0],B=f.o[1],F=f.o[2];q.subtractToRef(N,F),F.normalize(),t.CrossToRef(R,F,v);const S=v.lengthSquared();0===S?v.x=1:v.normalizeFromLength(Math.sqrt(S)),t.CrossToRef(F,v,B),B.normalize();const A=-t.Dot(v,N),y=-t.Dot(B,N),E=-t.Dot(F,N);return b.FromValuesToRef(v._x,B._x,F._x,0,v._y,B._y,F._y,0,v._z,B._z,F._z,0,A,y,E,1,z),z}static LookAtRH(N,q,R){const z=new b;return b.LookAtRHToRef(N,q,R,z),z}static LookAtRHToRef(N,q,R,z){const v=f.o[0],B=f.o[1],F=f.o[2];N.subtractToRef(q,F),F.normalize(),t.CrossToRef(R,F,v);const S=v.lengthSquared();0===S?v.x=1:v.normalizeFromLength(Math.sqrt(S)),t.CrossToRef(F,v,B),B.normalize();const A=-t.Dot(v,N),y=-t.Dot(B,N),E=-t.Dot(F,N);return b.FromValuesToRef(v._x,B._x,F._x,0,v._y,B._y,F._y,0,v._z,B._z,F._z,0,A,y,E,1,z),z}static LookDirectionLH(N,q){const R=new b;return b.LookDirectionLHToRef(N,q,R),R}static LookDirectionLHToRef(N,q,R){const z=f.o[0];z.p(N),z.scaleInPlace(-1);const v=f.o[1];return t.CrossToRef(q,z,v),b.FromValuesToRef(v._x,v._y,v._z,0,q._x,q._y,q._z,0,z._x,z._y,z._z,0,0,0,0,1,R),R}static LookDirectionRH(N,q){const R=new b;return b.LookDirectionRHToRef(N,q,R),R}static LookDirectionRHToRef(N,q,R){const z=f.o[2];return t.CrossToRef(q,N,z),b.FromValuesToRef(z._x,z._y,z._z,0,q._x,q._y,q._z,0,N._x,N._y,N._z,0,0,0,0,1,R),R}static OrthoLH(N,q,R,z,v){const B=new b;return b.OrthoLHToRef(N,q,R,z,B,v),B}static OrthoLHToRef(N,q,R,z,v,B){const F=2/N,S=2/q,A=2/(z-R),y=-(z+R)/(z-R);return b.FromValuesToRef(F,0,0,0,0,S,0,0,0,0,A,0,0,0,y,1,v),B&&v.multiplyToRef(V,v),v._updateIdentityStatus(1===F&&1===S&&1===A&&0===y),v}static OrthoOffCenterLH(N,q,R,z,v,B,F){const S=new b;return b.OrthoOffCenterLHToRef(N,q,R,z,v,B,S,F),S}static OrthoOffCenterLHToRef(N,q,R,z,v,B,F,S){const A=2/(q-N),y=2/(z-R),E=2/(B-v),t=-(B+v)/(B-v),x=(N+q)/(N-q),e=(z+R)/(R-z);return b.FromValuesToRef(A,0,0,0,0,y,0,0,0,0,E,0,x,e,t,1,F),S&&F.multiplyToRef(V,F),F.markAsUpdated(),F}static ObliqueOffCenterLHToRef(N,q,R,z,v,B,F,S,A,y,E){const t=-F*Math.cos(S),x=-F*Math.sin(S);return b.TranslationToRef(0,0,-A,f.Matrix[1]),b.FromValuesToRef(1,0,0,0,0,1,0,0,t,x,1,0,0,0,0,1,f.Matrix[0]),f.Matrix[1].multiplyToRef(f.Matrix[0],f.Matrix[0]),b.TranslationToRef(0,0,A,f.Matrix[1]),f.Matrix[0].multiplyToRef(f.Matrix[1],f.Matrix[0]),b.OrthoOffCenterLHToRef(N,q,R,z,v,B,y,E),f.Matrix[0].multiplyToRef(y,y),y}static OrthoOffCenterRH(N,q,R,z,v,B,F){const S=new b;return b.OrthoOffCenterRHToRef(N,q,R,z,v,B,S,F),S}static OrthoOffCenterRHToRef(N,q,R,z,v,B,F,S){return b.OrthoOffCenterLHToRef(N,q,R,z,v,B,F,S),F.Pj[10]*=-1,F}static ObliqueOffCenterRHToRef(N,q,R,z,v,B,F,S,A,y,E){const t=F*Math.cos(S),x=F*Math.sin(S);return b.TranslationToRef(0,0,A,f.Matrix[1]),b.FromValuesToRef(1,0,0,0,0,1,0,0,t,x,1,0,0,0,0,1,f.Matrix[0]),f.Matrix[1].multiplyToRef(f.Matrix[0],f.Matrix[0]),b.TranslationToRef(0,0,-A,f.Matrix[1]),f.Matrix[0].multiplyToRef(f.Matrix[1],f.Matrix[0]),b.OrthoOffCenterRHToRef(N,q,R,z,v,B,y,E),f.Matrix[0].multiplyToRef(y,y),y}static PerspectiveLH(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const F=new b,S=2*R/N,A=2*R/q,y=(z+R)/(z-R),E=-2*z*R/(z-R),t=Math.tan(B);return b.FromValuesToRef(S,0,0,0,0,A,0,t,0,0,y,1,0,0,E,0,F),v&&F.multiplyToRef(V,F),F._updateIdentityStatus(!1),F}static PerspectiveFovLH(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const S=new b;return b.PerspectiveFovLHToRef(N,q,R,z,S,!0,v,B,F),S}static PerspectiveFovLHToRef(N,q,R,z,v){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const y=R,E=z,t=1/Math.tan(.5*N),x=B?t/q:t,e=B?t:t*q,f=A&&0===y?-1:0!==E?(E+y)/(E-y):1,D=A&&0===y?2*E:0!==E?-2*E*y/(E-y):-2*y,H=Math.tan(S);return b.FromValuesToRef(x,0,0,0,0,e,0,H,0,0,f,1,0,0,D,0,v),F&&v.multiplyToRef(V,v),v._updateIdentityStatus(!1),v}static PerspectiveFovReverseLHToRef(N,q,R,z,v){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const A=1/Math.tan(.5*N),y=B?A/q:A,E=B?A:A*q,t=Math.tan(S);return b.FromValuesToRef(y,0,0,0,0,E,0,t,0,0,-R,1,0,0,1,0,v),F&&v.multiplyToRef(V,v),v._updateIdentityStatus(!1),v}static PerspectiveFovRH(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const S=new b;return b.PerspectiveFovRHToRef(N,q,R,z,S,!0,v,B,F),S}static PerspectiveFovRHToRef(N,q,R,z,v){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const y=R,E=z,t=1/Math.tan(.5*N),x=B?t/q:t,e=B?t:t*q,f=A&&0===y?1:0!==E?-(E+y)/(E-y):-1,D=A&&0===y?2*E:0!==E?-2*E*y/(E-y):-2*y,H=Math.tan(S);return b.FromValuesToRef(x,0,0,0,0,e,0,H,0,0,f,-1,0,0,D,0,v),F&&v.multiplyToRef(V,v),v._updateIdentityStatus(!1),v}static PerspectiveFovReverseRHToRef(N,q,R,z,v){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const A=1/Math.tan(.5*N),y=B?A/q:A,E=B?A:A*q,t=Math.tan(S);return b.FromValuesToRef(y,0,0,0,0,E,0,t,0,0,-R,-1,0,0,-1,0,v),F&&v.multiplyToRef(V,v),v._updateIdentityStatus(!1),v}static GetFinalMatrix(N,q,R,z,v,B){const F=N.width,S=N.height,A=N.x,y=N.y,E=b.FromValues(F/2,0,0,0,0,-S/2,0,0,0,0,B-v,0,A+F/2,S/2+y,v,1),t=new b;return q.multiplyToRef(R,t),t.multiplyToRef(z,t),t.multiplyToRef(E,t)}static GetAsMatrix2x2(N){const q=N.m,R=[q[0],q[1],q[4],q[5]];return F.d.MatrixUse64Bits?R:new Float32Array(R)}static GetAsMatrix3x3(N){const q=N.m,R=[q[0],q[1],q[2],q[4],q[5],q[6],q[8],q[9],q[10]];return F.d.MatrixUse64Bits?R:new Float32Array(R)}static Transpose(N){const q=new b;return b.TransposeToRef(N,q),q}static TransposeToRef(N,q){const R=N.m,z=R[0],v=R[4],B=R[8],F=R[12],S=R[1],A=R[5],y=R[9],E=R[13],t=R[2],x=R[6],e=R[10],b=R[14],f=R[3],D=R[7],V=R[11],H=R[15],Y=q.Pj;return Y[0]=z,Y[1]=v,Y[2]=B,Y[3]=F,Y[4]=S,Y[5]=A,Y[6]=y,Y[7]=E,Y[8]=t,Y[9]=x,Y[10]=e,Y[11]=b,Y[12]=f,Y[13]=D,Y[14]=V,Y[15]=H,q.markAsUpdated(),q._updateIdentityStatus(N._isIdentity,N._isIdentityDirty),q}static Reflection(N){const q=new b;return b.ReflectionToRef(N,q),q}static ReflectionToRef(N,q){N.normalize();const R=N.k.x,z=N.k.y,v=N.k.z,B=-2*R,F=-2*z,S=-2*v;return b.FromValuesToRef(B*R+1,F*R,S*R,0,B*z,F*z+1,S*z,0,B*v,F*v,S*v+1,0,B*N.d,F*N.d,S*N.d,1,q),q}static FromXYZAxesToRef(N,q,R,z){return b.FromValuesToRef(N._x,N._y,N._z,0,q._x,q._y,q._z,0,R._x,R._y,R._z,0,0,0,0,1,z),z}static FromQuaternionToRef(N,q){const R=N._x*N._x,z=N._y*N._y,v=N._z*N._z,B=N._x*N._y,F=N._z*N._w,S=N._z*N._x,A=N._y*N._w,y=N._y*N._z,E=N._x*N._w;return q.Pj[0]=1-2*(z+v),q.Pj[1]=2*(B+F),q.Pj[2]=2*(S-A),q.Pj[3]=0,q.Pj[4]=2*(B-F),q.Pj[5]=1-2*(v+R),q.Pj[6]=2*(y+E),q.Pj[7]=0,q.Pj[8]=2*(S+A),q.Pj[9]=2*(y-E),q.Pj[10]=1-2*(z+R),q.Pj[11]=0,q.Pj[12]=0,q.Pj[13]=0,q.Pj[14]=0,q.Pj[15]=1,q.markAsUpdated(),q}}b._UpdateFlagSeed=0,b._IdentityReadOnly=b.Identity(),Object.defineProperties(b.prototype,{dimension:{value:[4,4]},rank:{value:2}});class f{}f.o=(0,v.e)(11,t.Zero),f.Matrix=(0,v.e)(2,b.Identity),f.Quaternion=(0,v.e)(3,e.Zero);class D{}D.Vector2=(0,v.e)(3,E.Zero),D.o=(0,v.e)(13,t.Zero),D.Vector4=(0,v.e)(3,x.Zero),D.Quaternion=(0,v.e)(3,e.Zero),D.Matrix=(0,v.e)(8,b.Identity),(0,B.f)("BABYLON.Vector2",E),(0,B.f)("BABYLON.Vector3",t),(0,B.f)("BABYLON.Vector4",x),(0,B.f)("BABYLON.Matrix",b);const V=b.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11463:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{constructor(N,q,R,z){this.x=N,this.y=q,this.width=R,this.height=z}toGlobal(N,q){return new z(this.x*N,this.y*q,this.width*N,this.height*q)}toGlobalToRef(N,q,R){return R.x=this.x*N,R.y=this.y*q,R.width=this.width*N,R.height=this.height*q,this}clone(){return new z(this.x,this.y,this.width,this.height)}}},11680:(N,q,R)=>{"use strict";R.d(q,{b:()=>y,d:()=>E});var z=R(11181),v=R(11689);const B=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],F=[()=>1,N=>N.y,N=>N.z,N=>N.x,N=>N.x*N.y,N=>N.y*N.z,N=>3*N.z*N.z-1,N=>N.x*N.z,N=>N.x*N.x-N.y*N.y],S=(N,q)=>B[N]*F[N](q),A=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class y{constructor(){this.preScaled=!1,this.l00=z.m.Zero(),this.l1_1=z.m.Zero(),this.l10=z.m.Zero(),this.l11=z.m.Zero(),this.l2_2=z.m.Zero(),this.l2_1=z.m.Zero(),this.l20=z.m.Zero(),this.l21=z.m.Zero(),this.l22=z.m.Zero()}addLight(N,q,R){v.e.o[0].set(q.r,q.g,q.b);const z=v.e.o[0],B=v.e.o[1];z.scaleToRef(R,B),B.scaleToRef(S(0,N),v.e.o[2]),this.l00.addInPlace(v.e.o[2]),B.scaleToRef(S(1,N),v.e.o[2]),this.l1_1.addInPlace(v.e.o[2]),B.scaleToRef(S(2,N),v.e.o[2]),this.l10.addInPlace(v.e.o[2]),B.scaleToRef(S(3,N),v.e.o[2]),this.l11.addInPlace(v.e.o[2]),B.scaleToRef(S(4,N),v.e.o[2]),this.l2_2.addInPlace(v.e.o[2]),B.scaleToRef(S(5,N),v.e.o[2]),this.l2_1.addInPlace(v.e.o[2]),B.scaleToRef(S(6,N),v.e.o[2]),this.l20.addInPlace(v.e.o[2]),B.scaleToRef(S(7,N),v.e.o[2]),this.l21.addInPlace(v.e.o[2]),B.scaleToRef(S(8,N),v.e.o[2]),this.l22.addInPlace(v.e.o[2])}scaleInPlace(N){this.l00.scaleInPlace(N),this.l1_1.scaleInPlace(N),this.l10.scaleInPlace(N),this.l11.scaleInPlace(N),this.l2_2.scaleInPlace(N),this.l2_1.scaleInPlace(N),this.l20.scaleInPlace(N),this.l21.scaleInPlace(N),this.l22.scaleInPlace(N)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(A[0]),this.l1_1.scaleInPlace(A[1]),this.l10.scaleInPlace(A[2]),this.l11.scaleInPlace(A[3]),this.l2_2.scaleInPlace(A[4]),this.l2_1.scaleInPlace(A[5]),this.l20.scaleInPlace(A[6]),this.l21.scaleInPlace(A[7]),this.l22.scaleInPlace(A[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(B[0]),this.l1_1.scaleInPlace(B[1]),this.l10.scaleInPlace(B[2]),this.l11.scaleInPlace(B[3]),this.l2_2.scaleInPlace(B[4]),this.l2_1.scaleInPlace(B[5]),this.l20.scaleInPlace(B[6]),this.l21.scaleInPlace(B[7]),this.l22.scaleInPlace(B[8])}updateFromArray(N){return z.m.FromArrayToRef(N[0],0,this.l00),z.m.FromArrayToRef(N[1],0,this.l1_1),z.m.FromArrayToRef(N[2],0,this.l10),z.m.FromArrayToRef(N[3],0,this.l11),z.m.FromArrayToRef(N[4],0,this.l2_2),z.m.FromArrayToRef(N[5],0,this.l2_1),z.m.FromArrayToRef(N[6],0,this.l20),z.m.FromArrayToRef(N[7],0,this.l21),z.m.FromArrayToRef(N[8],0,this.l22),this}updateFromFloatsArray(N){return z.m.FromFloatsToRef(N[0],N[1],N[2],this.l00),z.m.FromFloatsToRef(N[3],N[4],N[5],this.l1_1),z.m.FromFloatsToRef(N[6],N[7],N[8],this.l10),z.m.FromFloatsToRef(N[9],N[10],N[11],this.l11),z.m.FromFloatsToRef(N[12],N[13],N[14],this.l2_2),z.m.FromFloatsToRef(N[15],N[16],N[17],this.l2_1),z.m.FromFloatsToRef(N[18],N[19],N[20],this.l20),z.m.FromFloatsToRef(N[21],N[22],N[23],this.l21),z.m.FromFloatsToRef(N[24],N[25],N[26],this.l22),this}static Zg(N){return(new y).updateFromArray(N)}static FromPolynomial(N){const q=new y;return q.l00=N.xx.scale(.376127).add(N.yy.scale(.376127)).add(N.zz.scale(.376126)),q.l1_1=N.y.scale(.977204),q.l10=N.z.scale(.977204),q.l11=N.x.scale(.977204),q.l2_2=N.xy.scale(1.16538),q.l2_1=N.yz.scale(1.16538),q.l20=N.zz.scale(1.34567).gd(N.xx.scale(.672834)).gd(N.yy.scale(.672834)),q.l21=N.zx.scale(1.16538),q.l22=N.xx.scale(1.16538).gd(N.yy.scale(1.16538)),q.l1_1.scaleInPlace(-1),q.l11.scaleInPlace(-1),q.l2_1.scaleInPlace(-1),q.l21.scaleInPlace(-1),q.scaleInPlace(Math.PI),q}}class E{constructor(){this.x=z.m.Zero(),this.y=z.m.Zero(),this.z=z.m.Zero(),this.xx=z.m.Zero(),this.yy=z.m.Zero(),this.zz=z.m.Zero(),this.xy=z.m.Zero(),this.yz=z.m.Zero(),this.zx=z.m.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=y.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(N){v.e.o[0].qe(N.r,N.g,N.b);const q=v.e.o[0];this.xx.addInPlace(q),this.yy.addInPlace(q),this.zz.addInPlace(q)}scaleInPlace(N){this.x.scaleInPlace(N),this.y.scaleInPlace(N),this.z.scaleInPlace(N),this.xx.scaleInPlace(N),this.yy.scaleInPlace(N),this.zz.scaleInPlace(N),this.yz.scaleInPlace(N),this.zx.scaleInPlace(N),this.xy.scaleInPlace(N)}updateFromHarmonics(N){return this._harmonics=N,this.x.p(N.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(N.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(N.l10),this.z.scaleInPlace(1.02333),this.xx.p(N.l00),v.e.o[0].p(N.l20).scaleInPlace(.247708),v.e.o[1].p(N.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).pi(v.e.o[0]).addInPlace(v.e.o[1]),this.yy.p(N.l00),this.yy.scaleInPlace(.886277).pi(v.e.o[0]).pi(v.e.o[1]),this.zz.p(N.l00),v.e.o[0].p(N.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(v.e.o[0]),this.yz.p(N.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(N.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(N.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(N){return(new E).updateFromHarmonics(N)}static Zg(N){const q=new E;return z.m.FromArrayToRef(N[0],0,q.x),z.m.FromArrayToRef(N[1],0,q.y),z.m.FromArrayToRef(N[2],0,q.z),z.m.FromArrayToRef(N[3],0,q.xx),z.m.FromArrayToRef(N[4],0,q.yy),z.m.FromArrayToRef(N[5],0,q.zz),z.m.FromArrayToRef(N[6],0,q.yz),z.m.FromArrayToRef(N[7],0,q.zx),z.m.FromArrayToRef(N[8],0,q.xy),q}}},11509:(N,q,R)=>{"use strict";R.d(q,{d:()=>y});var z=R(11181),v=R(11213),B=R(11445),F=R(11468),S=R(11414);R(11513);function A(N){let q=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const R=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],B=[];let A=[];const y=N.width||N.size||1,E=N.height||N.size||1,t=N.depth||N.size||1,x=N.wrap||!1;let e=void 0===N.topBaseAt?1:N.topBaseAt,b=void 0===N.bottomBaseAt?0:N.bottomBaseAt;e=(e+4)%4,b=(b+4)%4;let f=[2,0,3,1][e],D=[2,0,1,3][b],V=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(x){q=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],V=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let N=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],R=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const z=[17,18,19,16],v=[22,23,20,21];for(;f>0;)N.unshift(N.pop()),z.unshift(z.pop()),f--;for(;D>0;)R.unshift(R.pop()),v.unshift(v.pop()),D--;N=N.flat(),R=R.flat(),V=V.concat(N).concat(R),q.push(z[0],z[2],z[3],z[0],z[1],z[2]),q.push(v[0],v[2],v[3],v[0],v[1],v[2])}const H=[y/2,E/2,t/2];A=V.reduce(((N,q,R)=>N.concat(q*H[R%3])),[]);const Y=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,T=N.faceUV||new Array(6),L=N.faceColors,X=[];for(let F=0;F<6;F++)void 0===T[F]&&(T[F]=new z.p(0,0,1,1)),L&&void 0===L[F]&&(L[F]=new v.g(1,1,1,1));for(let z=0;z<6;z++)if(B.push(T[z].z,S.b?1-T[z].w:T[z].w),B.push(T[z].x,S.b?1-T[z].w:T[z].w),B.push(T[z].x,S.b?1-T[z].y:T[z].y),B.push(T[z].z,S.b?1-T[z].y:T[z].y),L)for(let N=0;N<4;N++)X.push(L[z].r,L[z].g,L[z].b,L[z].a);F.e._ComputeSides(Y,A,q,R,B,N.frontUVs,N.backUVs);const Q=new F.e;if(Q.indices=q,Q.xa=A,Q.ya=R,Q.Aa=B,L){const N=Y===F.e.DOUBLESIDE?X.concat(X):X;Q.za=N}return Q}function y(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new B.b(N,R);q.sideOrientation=B.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return A(q).Ca(z,q.updatable),z}F.e.CreateBox=A,B.b.CreateBox=function(N,q){return y(N,{size:q,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11824:(N,q,R)=>{"use strict";R.d(q,{b:()=>S});var z=R(11445),v=R(11468),B=R(11414);function F(N){const q=[],R=[],z=[],F=[],S=N.radius||.5,A=N.tessellation||64,y=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,E=0===N.sideOrientation?0:N.sideOrientation||v.e.DEFAULTSIDE;q.push(0,0,0),F.push(.5,.5);const t=2*Math.PI*y,x=1===y?t/A:t/(A-1);let e=0;for(let v=0;v<A;v++){const N=Math.cos(e),R=Math.sin(e),z=(N+1)/2,v=(1-R)/2;q.push(S*N,S*R,0),F.push(z,B.b?1-v:v),e+=x}1===y&&(q.push(q[3],q[4],q[5]),F.push(F[2],B.b?1-F[3]:F[3]));const b=q.length/3;for(let v=1;v<b-1;v++)R.push(v+1,0,v);v.e.ComputeNormals(q,R,z),v.e._ComputeSides(E,q,R,z,F,N.frontUVs,N.backUVs);const f=new v.e;return f.indices=R,f.xa=q,f.ya=z,f.Aa=F,f}function S(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new z.b(N,R);q.sideOrientation=z.b._GetDefaultSideOrientation(q.sideOrientation),v._originalBuilderSideOrientation=q.sideOrientation;return F(q).Ca(v,q.updatable),v}v.e.CreateDisc=F,z.b.CreateDisc=function(N,q,R){return S(N,{radius:q,tessellation:R,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11513:(N,q,R)=>{"use strict";R.d(q,{c:()=>D,b:()=>H,e:()=>V});var z=R(11181),v=R(11213),B=R(11445),F=R(11468),S=R(11251);B.b._GroundMeshParser=(N,q)=>A.Parse(N,q);class A extends B.b{constructor(N,q){super(N,q),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=N,this._subdivisionsY=N,this.subdivide(N);const R=this;R.createOrUpdateSubmeshesOctree&&R.createOrUpdateSubmeshesOctree(q)}getHeightAtCoordinates(N,q){const R=this.getWorldMatrix(),v=z.k.Matrix[5];R.invertToRef(v);const B=z.k.o[8];if(z.m.TransformCoordinatesFromFloatsToRef(N,0,q,v,B),N=B.x,q=B.z,N<this._minX||N>=this._maxX||q<=this._minZ||q>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(N,q),S=-(F.x*N+F.z*q+F.w)/F.y;return z.m.TransformCoordinatesFromFloatsToRef(0,S,0,R,B),B.y}getNormalAtCoordinates(N,q){const R=new z.m(0,1,0);return this.getNormalAtCoordinatesToRef(N,q,R),R}getNormalAtCoordinatesToRef(N,q,R){const v=this.getWorldMatrix(),B=z.k.Matrix[5];v.invertToRef(B);const F=z.k.o[8];if(z.m.TransformCoordinatesFromFloatsToRef(N,0,q,B,F),N=F.x,q=F.z,N<this._minX||N>this._maxX||q<this._minZ||q>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(N,q);return z.m.TransformNormalFromFloatsToRef(S.x,S.y,S.z,v,R),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(N,q){const R=Math.floor((N+this._maxX)*this._subdivisionsX/this._width),z=Math.floor(-(q+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),v=this._heightQuads[z*this._subdivisionsX+R];let B;return B=q<v.slope.x*N+v.slope.y?v.facet1:v.facet2,B}_initHeightQuads(){const N=this._subdivisionsX,q=this._subdivisionsY;this._heightQuads=new Array;for(let R=0;R<q;R++)for(let q=0;q<N;q++){const v={slope:z.l.Zero(),facet1:new z.p(0,0,0,0),facet2:new z.p(0,0,0,0)};this._heightQuads[R*N+q]=v}return this}_computeHeightQuads(){const N=this.getVerticesData(S.h.PositionKind);if(!N)return this;const q=z.k.o[3],R=z.k.o[2],v=z.k.o[1],B=z.k.o[0],F=z.k.o[4],A=z.k.o[5],y=z.k.o[6],E=z.k.o[7],t=z.k.o[8];let x=0,e=0,b=0,f=0,D=0,V=0,H=0;const Y=this._subdivisionsX,T=this._subdivisionsY;for(let S=0;S<T;S++)for(let T=0;T<Y;T++){x=3*T,e=S*(Y+1)*3,b=(S+1)*(Y+1)*3,q.x=N[e+x],q.y=N[e+x+1],q.z=N[e+x+2],R.x=N[e+x+3],R.y=N[e+x+4],R.z=N[e+x+5],v.x=N[b+x],v.y=N[b+x+1],v.z=N[b+x+2],B.x=N[b+x+3],B.y=N[b+x+4],B.z=N[b+x+5],f=(B.z-q.z)/(B.x-q.x),D=q.z-f*q.x,R.subtractToRef(q,F),v.subtractToRef(q,A),B.subtractToRef(q,y),z.m.CrossToRef(y,A,E),z.m.CrossToRef(F,y,t),E.normalize(),t.normalize(),V=-(E.x*q.x+E.y*q.y+E.z*q.z),H=-(t.x*R.x+t.y*R.y+t.z*R.z);const L=this._heightQuads[S*Y+T];L.slope.qe(f,D),L.facet1.qe(E.x,E.y,E.z,V),L.facet2.qe(t.x,t.y,t.z,H)}return this}serialize(N){super.serialize(N),N.subdivisionsX=this._subdivisionsX,N.subdivisionsY=this._subdivisionsY,N.minX=this._minX,N.maxX=this._maxX,N.Wi=this._minZ,N.maxZ=this._maxZ,N.width=this._width,N.height=this._height}static Parse(N,q){const R=new A(N.name,q);return R._subdivisionsX=N.subdivisionsX||1,R._subdivisionsY=N.subdivisionsY||1,R._minX=N.minX,R._maxX=N.maxX,R._minZ=N.Wi,R._maxZ=N.maxZ,R._width=N.width,R._height=N.height,R}}var y=R(10888),E=R(10933),t=R(11186),x=R(11414);function e(N){const q=[],R=[],v=[],B=[];let S,A;const y=N.width||N.size||1,E=N.height||N.size||1,t=0|(N.subdivisionsX||N.subdivisions||1),e=0|(N.subdivisionsY||N.subdivisions||1);for(S=0;S<=e;S++)for(A=0;A<=t;A++){const N=new z.m(A*y/t-y/2,0,(e-S)*E/e-E/2),q=new z.m(0,1,0);R.push(N.x,N.y,N.z),v.push(q.x,q.y,q.z),B.push(A/t,x.b?S/e:1-S/e)}for(S=0;S<e;S++)for(A=0;A<t;A++)q.push(A+1+(S+1)*(t+1)),q.push(A+1+S*(t+1)),q.push(A+S*(t+1)),q.push(A+(S+1)*(t+1)),q.push(A+1+(S+1)*(t+1)),q.push(A+S*(t+1));const b=new F.e;return b.indices=q,b.xa=R,b.ya=v,b.Aa=B,b}function b(N){const q=void 0!==N.xmin&&null!==N.xmin?N.xmin:-1,R=void 0!==N.zmin&&null!==N.zmin?N.zmin:-1,v=void 0!==N.xmax&&null!==N.xmax?N.xmax:1,B=void 0!==N.zmax&&null!==N.zmax?N.zmax:1,S=N.subdivisions||{w:1,h:1},A=N.precision||{w:1,h:1},y=[],E=[],t=[],x=[];let e,b,f,D;S.h=S.h<1?1:S.h,S.w=S.w<1?1:S.w,A.w=A.w<1?1:A.w,A.h=A.h<1?1:A.h;const V=(v-q)/S.w,H=(B-R)/S.h;function Y(N,q,R,v){const B=E.length/3,F=A.w+1;for(e=0;e<A.h;e++)for(b=0;b<A.w;b++){const N=[B+b+e*F,B+(b+1)+e*F,B+(b+1)+(e+1)*F,B+b+(e+1)*F];y.push(N[1]),y.push(N[2]),y.push(N[3]),y.push(N[0]),y.push(N[1]),y.push(N[3])}const S=z.m.Zero(),f=new z.m(0,1,0);for(e=0;e<=A.h;e++)for(S.z=e*(v-q)/A.h+q,b=0;b<=A.w;b++)S.x=b*(R-N)/A.w+N,S.y=0,E.push(S.x,S.y,S.z),t.push(f.x,f.y,f.z),x.push(b/A.w,e/A.h)}for(f=0;f<S.h;f++)for(D=0;D<S.w;D++)Y(q+D*V,R+f*H,q+(D+1)*V,R+(f+1)*H);const T=new F.e;return T.indices=y,T.xa=E,T.ya=t,T.Aa=x,T}function f(N){const q=[],R=[],B=[],S=[];let A,y;const E=N.colorFilter||new v.c(.3,.59,.11),x=N.alphaFilter||0;let e=!1;if(N.minHeight>N.maxHeight){e=!0;const q=N.maxHeight;N.maxHeight=N.minHeight,N.minHeight=q}for(A=0;A<=N.subdivisions;A++)for(y=0;y<=N.subdivisions;y++){const q=new z.m(y*N.width/N.subdivisions-N.width/2,0,(N.subdivisions-A)*N.height/N.subdivisions-N.height/2),v=4*(((q.x+N.width/2)/N.width*(N.bufferWidth-1)|0)+((1-(q.z+N.height/2)/N.height)*(N.bufferHeight-1)|0)*N.bufferWidth);let F=N.buffer[v]/255,b=N.buffer[v+1]/255,f=N.buffer[v+2]/255;const D=N.buffer[v+3]/255;e&&(F=1-F,b=1-b,f=1-f);const V=F*E.r+b*E.g+f*E.b;q.y=D>=x?N.minHeight+(N.maxHeight-N.minHeight)*V:N.minHeight-t.d,N.heightBuffer&&(N.heightBuffer[A*(N.subdivisions+1)+y]=q.y),R.push(q.x,q.y,q.z),B.push(0,0,0),S.push(y/N.subdivisions,1-A/N.subdivisions)}for(A=0;A<N.subdivisions;A++)for(y=0;y<N.subdivisions;y++){const z=y+1+(A+1)*(N.subdivisions+1),v=y+1+A*(N.subdivisions+1),B=y+A*(N.subdivisions+1),F=y+(A+1)*(N.subdivisions+1),S=R[3*z+1]>=N.minHeight,E=R[3*v+1]>=N.minHeight,t=R[3*B+1]>=N.minHeight;S&&E&&t&&(q.push(z),q.push(v),q.push(B));R[3*F+1]>=N.minHeight&&S&&t&&(q.push(F),q.push(z),q.push(B))}F.e.ComputeNormals(R,q,B);const b=new F.e;return b.indices=q,b.xa=R,b.ya=B,b.Aa=S,b}function D(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const R=new A(N,arguments.length>2?arguments[2]:void 0);R._setReady(!1),R._subdivisionsX=q.subdivisionsX||q.subdivisions||1,R._subdivisionsY=q.subdivisionsY||q.subdivisions||1,R._width=q.width||1,R._height=q.height||1,R._maxX=R._width/2,R._maxZ=R._height/2,R._minX=-R._maxX,R._minZ=-R._maxZ;return e(q).Ca(R,q.updatable),R._setReady(!0),R}function V(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new B.b(N,R);return b(q).Ca(z,q.updatable),z}function H(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=R.width||10,F=R.height||10,S=R.subdivisions||1,t=R.minHeight||0,x=R.maxHeight||1,e=R.colorFilter||new v.c(.3,.59,.11),b=R.alphaFilter||0,D=R.updatable,V=R.onReady;z=z||E.b.LastCreatedScene;const H=new A(N,z);let Y;H._subdivisionsX=S,H._subdivisionsY=S,H._width=B,H._height=F,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ,H._setReady(!1),R.passHeightBufferInCallback&&(Y=new Float32Array((S+1)*(S+1)));const T=(N,q,R)=>{f({width:B,height:F,subdivisions:S,minHeight:t,maxHeight:x,colorFilter:e,buffer:N,bufferWidth:q,bufferHeight:R,alphaFilter:b,heightBuffer:Y}).Ca(H,D),V&&V(H,Y),H._setReady(!0)};if("string"===typeof q){const N=N=>{var q;const R=N.width,v=N.height;if(z.u)return;const B=null===(q=z)||void 0===q?void 0:q.getEngine().resizeImageBitmap(N,R,v);T(B,R,v)};y.f.LoadImage(q,N,R.onError?R.onError:()=>{},z.offlineProvider)}else T(q.data,q.width,q.height);return H}F.e.CreateGround=e,F.e.CreateTiledGround=b,F.e.CreateGroundFromHeightMap=f,B.b.CreateGround=(N,q,R,z,v,B)=>D(N,{width:q,height:R,subdivisions:z,updatable:B},v),B.b.CreateTiledGround=(N,q,R,z,v,B,F,S,A)=>V(N,{xmin:q,zmin:R,xmax:z,zmax:v,subdivisions:B,precision:F,updatable:A},S),B.b.CreateGroundFromHeightMap=(N,q,R,z,v,B,F,S,A,y,E)=>H(N,q,{width:R,height:z,subdivisions:v,minHeight:B,maxHeight:F,updatable:A,onReady:y,alphaFilter:E},S)},12553:(N,q,R)=>{"use strict";R.d(q,{c:()=>G,f:()=>c,i:()=>n});var z=R(11181),v=R(11445),B=R(11468),F=R(11213),S=R(11251),A=R(12121),y=R(11332),E=R(11221),t=R(11172),x=R(11402),e=R(11002),b=R(11421),f=R(10931),D=R(11393),V=R(10933),H=R(11386),Y=R(11379);const T={effect:null,subMesh:null};class L extends D.b{constructor(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(N,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new z.d,this._cachedWorldViewProjectionMatrix=new z.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=R,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...v}}get shaderPath(){return this._shaderPath}set shaderPath(N){this._shaderPath=N}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(N){-1===this._options.uniforms.indexOf(N)&&this._options.uniforms.push(N)}setTexture(N,q){return-1===this._options.samplers.indexOf(N)&&this._options.samplers.push(N),this._textures[N]=q,this}removeTexture(N){delete this._textures[N]}setTextureArray(N,q){return-1===this._options.samplers.indexOf(N)&&this._options.samplers.push(N),this._checkUniform(N),this._textureArrays[N]=q,this}setExternalTexture(N,q){return-1===this._options.externalTextures.indexOf(N)&&this._options.externalTextures.push(N),this._externalTextures[N]=q,this}setFloat(N,q){return this._checkUniform(N),this._floats[N]=q,this}setInt(N,q){return this._checkUniform(N),this._ints[N]=q,this}setUInt(N,q){return this._checkUniform(N),this._uints[N]=q,this}setFloats(N,q){return this._checkUniform(N),this._floatsArrays[N]=q,this}setColor3(N,q){return this._checkUniform(N),this._colors3[N]=q,this}setColor3Array(N,q){return this._checkUniform(N),this._colors3Arrays[N]=q.reduce(((N,q)=>(q.toArray(N,N.length),N)),[]),this}setColor4(N,q){return this._checkUniform(N),this._colors4[N]=q,this}setColor4Array(N,q){return this._checkUniform(N),this._colors4Arrays[N]=q.reduce(((N,q)=>(q.toArray(N,N.length),N)),[]),this}setVector2(N,q){return this._checkUniform(N),this._vectors2[N]=q,this}setVector3(N,q){return this._checkUniform(N),this._vectors3[N]=q,this}setVector4(N,q){return this._checkUniform(N),this._vectors4[N]=q,this}setQuaternion(N,q){return this._checkUniform(N),this._quaternions[N]=q,this}setQuaternionArray(N,q){return this._checkUniform(N),this._quaternionsArrays[N]=q.reduce(((N,q)=>(q.toArray(N,N.length),N)),[]),this}setMatrix(N,q){return this._checkUniform(N),this._matrices[N]=q,this}setMatrices(N,q){this._checkUniform(N);const R=new Float32Array(16*q.length);for(let z=0;z<q.length;z++){q[z].copyToArray(R,16*z)}return this._matrixArrays[N]=R,this}setMatrix3x3(N,q){return this._checkUniform(N),this._matrices3x3[N]=q,this}setMatrix2x2(N,q){return this._checkUniform(N),this._matrices2x2[N]=q,this}setArray2(N,q){return this._checkUniform(N),this._vectors2Arrays[N]=q,this}setArray3(N,q){return this._checkUniform(N),this._vectors3Arrays[N]=q,this}setArray4(N,q){return this._checkUniform(N),this._vectors4Arrays[N]=q,this}setUniformBuffer(N,q){return-1===this._options.uniformBuffers.indexOf(N)&&this._options.uniformBuffers.push(N),this._uniformBuffers[N]=q,this}setTextureSampler(N,q){return-1===this._options.samplerObjects.indexOf(N)&&this._options.samplerObjects.push(N),this._textureSamplers[N]=q,this}setStorageBuffer(N,q){return-1===this._options.storageBuffers.indexOf(N)&&this._options.storageBuffers.push(N),this._storageBuffers[N]=q,this}setDefine(N,q){const R=N.trimEnd()+" ",z=this.options.defines.findIndex((q=>q===N||q.startsWith(R)));return z>=0&&this.options.defines.splice(z,1),("boolean"!==typeof q||q)&&this.options.defines.push(R+q),this}isReadyForSubMesh(N,q,R){return this.isReady(N,R,q)}isReady(N,q,R){var z;const v=R&&this._storeEffectOnSubMeshes;if(this.isFrozen){const N=v?R._drawWrapper:this._drawWrapper;if(N.effect&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===q)return!0}const B=this.va(),F=B.getEngine(),A=[],y=[],E=new b.e;let x=this._shaderPath,e=this._options.uniforms,f=this._options.uniformBuffers,D=this._options.samplers;F.getCaps().multiview&&B.activeCamera&&B.activeCamera.outputRenderTarget&&B.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,A.push("#define MULTIVIEW"),-1!==e.indexOf("viewProjection")&&-1===e.indexOf("viewProjectionR")&&e.push("viewProjectionR"));for(let S=0;S<this._options.defines.length;S++){const N=0===this._options.defines[S].indexOf("#define")?this._options.defines[S]:`#define ${this._options.defines[S]}`;A.push(N)}for(let S=0;S<this._options.attributes.length;S++)y.push(this._options.attributes[S]);if(N&&N.isVerticesDataPresent(S.h.ColorKind)&&(-1===y.indexOf(S.h.ColorKind)&&y.push(S.h.ColorKind),A.push("#define VERTEXCOLOR")),q&&(A.push("#define INSTANCES"),(0,Y.X)(y,this._materialHelperNeedsPreviousMatrices),null!==N&&void 0!==N&&N.hasThinInstances&&(A.push("#define THIN_INSTANCES"),N&&N.isVerticesDataPresent(S.h.ColorInstanceKind)&&(y.push(S.h.ColorInstanceKind),A.push("#define INSTANCESCOLOR")))),N&&N.useBones&&N.computeBonesUsingShaders&&N.skeleton){y.push(S.h.MatricesIndicesKind),y.push(S.h.MatricesWeightsKind),N.numBoneInfluencers>4&&(y.push(S.h.MatricesIndicesExtraKind),y.push(S.h.MatricesWeightsExtraKind));const q=N.skeleton;A.push("#define NUM_BONE_INFLUENCERS "+N.numBoneInfluencers),E.addCPUSkinningFallback(0,N),q.isUsingTextureForMatrices?(A.push("#define BONETEXTURE"),-1===e.indexOf("boneTextureWidth")&&e.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(A.push("#define BonesPerMesh "+(q.bones.length+1)),-1===e.indexOf("mBones")&&e.push("mBones"))}else A.push("#define NUM_BONE_INFLUENCERS 0");let V=0;const L=N?N.morphTargetManager:null;if(L){const N=L.supportsUVs&&-1!==A.indexOf("#define UV1"),q=L.supportsTangents&&-1!==A.indexOf("#define TANGENT"),R=L.supportsNormals&&-1!==A.indexOf("#define NORMAL");V=L.numMaxInfluencers||L.numInfluencers,N&&A.push("#define MORPHTARGETS_UV"),q&&A.push("#define MORPHTARGETS_TANGENT"),R&&A.push("#define MORPHTARGETS_NORMAL"),V>0&&A.push("#define MORPHTARGETS"),L.isUsingTextureForTargets&&(A.push("#define MORPHTARGETS_TEXTURE"),-1===e.indexOf("morphTargetTextureIndices")&&e.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),A.push("#define NUM_MORPH_INFLUENCERS "+V);for(let z=0;z<V;z++)y.push(S.h.PositionKind+z),R&&y.push(S.h.NormalKind+z),q&&y.push(S.h.TangentKind+z),N&&y.push(S.h.UVKind+"_"+z);V>0&&(e=e.slice(),e.push("morphTargetInfluences"),e.push("morphTargetCount"),e.push("morphTargetTextureInfo"),e.push("morphTargetTextureIndices"))}else A.push("#define NUM_MORPH_INFLUENCERS 0");if(N){const q=N.bakedVertexAnimationManager;q&&q.isEnabled&&(A.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===e.indexOf("bakedVertexAnimationSettings")&&e.push("bakedVertexAnimationSettings"),-1===e.indexOf("bakedVertexAnimationTextureSizeInverted")&&e.push("bakedVertexAnimationTextureSizeInverted"),-1===e.indexOf("bakedVertexAnimationTime")&&e.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,Y.u)(y,N,A)}for(const S in this._textures)if(!this._textures[S].isReady())return!1;N&&this._shouldTurnAlphaTestOn(N)&&A.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,H.c)(e),(0,H.j)(this,B,A)),B.fogEnabled&&null!==N&&void 0!==N&&N.applyFog&&B.fogMode!==t.b.FOGMODE_NONE&&(A.push("#define FOG"),-1===e.indexOf("view")&&e.push("view"),-1===e.indexOf("vFogInfos")&&e.push("vFogInfos"),-1===e.indexOf("vFogColor")&&e.push("vFogColor")),this._useLogarithmicDepth&&(A.push("#define LOGARITHMICDEPTH"),-1===e.indexOf("logarithmicDepthConstant")&&e.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(e=e.slice(),f=f.slice(),D=D.slice(),x=this.customShaderNameResolve(this.name,e,f,D,A,y));const X=v?R._getDrawWrapper(void 0,!0):this._drawWrapper,Q=(null===X||void 0===X?void 0:X.effect)??null,h=(null===X||void 0===X?void 0:X.defines)??null,u=A.join("\n");let w=Q;return h!==u&&(w=F.createEffect(x,{attributes:y,uniformsNames:e,uniformBuffersNames:f,samplers:D,defines:u,fallbacks:E,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:V},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},F),v?R.setEffect(w,u,this._materialContext):X&&X.setEffect(w,u),this._onEffectCreatedObservable&&(T.effect=w,T.subMesh=R??(null===N||void 0===N?void 0:N.lg[0])??null,this._onEffectCreatedObservable.notifyObservers(T))),X._wasPreviouslyUsingInstances=!!q,!((null===(z=w)||void 0===z||!z.isReady())??1)&&(Q!==w&&B.resetCachedMaterial(),X._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(N,q){const R=this.va(),z=q??this.getEffect();z&&(-1!==this._options.uniforms.indexOf("world")&&z.setMatrix("world",N),-1!==this._options.uniforms.indexOf("worldView")&&(N.multiplyToRef(R.getViewMatrix(),this._cachedWorldViewMatrix),z.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(N.multiplyToRef(R.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),z.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&z.setMatrix("view",R.getViewMatrix()))}bindForSubMesh(N,q,R){var z;this.bind(N,q,null===(z=R._drawWrapperOverride)||void 0===z?void 0:z.effect,R)}bind(N,q,R,z){const v=z&&this._storeEffectOnSubMeshes,B=R??(v?z.effect:this.getEffect());if(!B)return;const F=this.va();this._activeEffect=B,this.bindOnlyWorldMatrix(N,R);const S=this._options.uniformBuffers;let A=!1;if(B&&S&&S.length>0&&F.getEngine().supportsUniformBuffers)for(let t=0;t<S.length;++t){switch(S[t]){case"Mesh":q&&(q.getMeshUniformBuffer().bindToEffect(B,"Mesh"),q.transferToEffect(N));break;case"Scene":(0,Y.l)(B,F.getSceneUniformBuffer()),F.finalizeSceneUbo(),A=!0}}const y=q&&v?this._mustRebind(F,B,z,q.visibility):F.getCachedMaterial()!==this;if(B&&y){let N;for(N in A||-1===this._options.uniforms.indexOf("view")||B.setMatrix("view",F.getViewMatrix()),A||-1===this._options.uniforms.indexOf("projection")||B.setMatrix("projection",F.getProjectionMatrix()),A||-1===this._options.uniforms.indexOf("viewProjection")||(B.setMatrix("viewProjection",F.getTransformMatrix()),this._multiview&&B.setMatrix("viewProjectionR",F._transformMatrixR)),F.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&B.setVector3("cameraPosition",F.activeCamera.globalPosition),(0,Y.b)(q,B),(0,H.e)(B,this,F),this._useLogarithmicDepth&&(0,Y.i)(v?z.materialDefines:B.defines,B,F),q&&(0,Y.c)(F,q,B),this._textures)B.setTexture(N,this._textures[N]);for(N in this._textureArrays)B.setTextureArray(N,this._textureArrays[N]);for(N in this._ints)B.setInt(N,this._ints[N]);for(N in this._uints)B.setUInt(N,this._uints[N]);for(N in this._floats)B.setFloat(N,this._floats[N]);for(N in this._floatsArrays)B.setArray(N,this._floatsArrays[N]);for(N in this._colors3)B.setColor3(N,this._colors3[N]);for(N in this._colors3Arrays)B.setArray3(N,this._colors3Arrays[N]);for(N in this._colors4){const q=this._colors4[N];B.setFloat4(N,q.r,q.g,q.b,q.a)}for(N in this._colors4Arrays)B.setArray4(N,this._colors4Arrays[N]);for(N in this._vectors2)B.setVector2(N,this._vectors2[N]);for(N in this._vectors3)B.setVector3(N,this._vectors3[N]);for(N in this._vectors4)B.setVector4(N,this._vectors4[N]);for(N in this._quaternions)B.setQuaternion(N,this._quaternions[N]);for(N in this._matrices)B.setMatrix(N,this._matrices[N]);for(N in this._matrixArrays)B.setMatrices(N,this._matrixArrays[N]);for(N in this._matrices3x3)B.setMatrix3x3(N,this._matrices3x3[N]);for(N in this._matrices2x2)B.setMatrix2x2(N,this._matrices2x2[N]);for(N in this._vectors2Arrays)B.setArray2(N,this._vectors2Arrays[N]);for(N in this._vectors3Arrays)B.setArray3(N,this._vectors3Arrays[N]);for(N in this._vectors4Arrays)B.setArray4(N,this._vectors4Arrays[N]);for(N in this._quaternionsArrays)B.setArray4(N,this._quaternionsArrays[N]);for(N in this._uniformBuffers){const q=this._uniformBuffers[N].getBuffer();q&&B.bindUniformBuffer(q,N)}const R=F.getEngine(),S=R.setExternalTexture;if(S)for(N in this._externalTextures)S.call(R,N,this._externalTextures[N]);const y=R.setTextureSampler;if(y)for(N in this._textureSamplers)y.call(R,N,this._textureSamplers[N]);const E=R.setStorageBuffer;if(E)for(N in this._storageBuffers)E.call(R,N,this._storageBuffers[N])}if(B&&q&&(y||!this.isFrozen)){const N=q.morphTargetManager;N&&N.numInfluencers>0&&(0,Y.j)(q,B);const R=q.bakedVertexAnimationManager;if(R&&R.isEnabled){var E;const N=v?z._drawWrapper:this._drawWrapper;null===(E=q.bakedVertexAnimationManager)||void 0===E||E.bind(B,!!N._wasPreviouslyUsingInstances)}}this._afterBind(q,B,z)}getActiveTextures(){const N=super.getActiveTextures();for(const q in this._textures)N.push(this._textures[q]);for(const q in this._textureArrays){const R=this._textureArrays[q];for(let q=0;q<R.length;q++)N.push(R[q])}return N}hasTexture(N){if(super.hasTexture(N))return!0;for(const q in this._textures)if(this._textures[q]===N)return!0;for(const q in this._textureArrays){const R=this._textureArrays[q];for(let q=0;q<R.length;q++)if(R[q]===N)return!0}return!1}clone(N){const q=E.e.Clone((()=>new L(N,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);q.name=N,q.id=N,"object"===typeof q._shaderPath&&(q._shaderPath={...q._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((N=>{const q=this._options[N];Array.isArray(q)&&(this._options[N]=q.slice(0))})),this.stencil.copyTo(q.stencil);for(const R in this._textures)q.setTexture(R,this._textures[R]);for(const R in this._textureArrays)q.setTextureArray(R,this._textureArrays[R]);for(const R in this._externalTextures)q.setExternalTexture(R,this._externalTextures[R]);for(const R in this._ints)q.setInt(R,this._ints[R]);for(const R in this._uints)q.setUInt(R,this._uints[R]);for(const R in this._floats)q.setFloat(R,this._floats[R]);for(const R in this._floatsArrays)q.setFloats(R,this._floatsArrays[R]);for(const R in this._colors3)q.setColor3(R,this._colors3[R]);for(const R in this._colors3Arrays)q._colors3Arrays[R]=this._colors3Arrays[R];for(const R in this._colors4)q.setColor4(R,this._colors4[R]);for(const R in this._colors4Arrays)q._colors4Arrays[R]=this._colors4Arrays[R];for(const R in this._vectors2)q.setVector2(R,this._vectors2[R]);for(const R in this._vectors3)q.setVector3(R,this._vectors3[R]);for(const R in this._vectors4)q.setVector4(R,this._vectors4[R]);for(const R in this._quaternions)q.setQuaternion(R,this._quaternions[R]);for(const R in this._quaternionsArrays)q._quaternionsArrays[R]=this._quaternionsArrays[R];for(const R in this._matrices)q.setMatrix(R,this._matrices[R]);for(const R in this._matrixArrays)q._matrixArrays[R]=this._matrixArrays[R].slice();for(const R in this._matrices3x3)q.setMatrix3x3(R,this._matrices3x3[R]);for(const R in this._matrices2x2)q.setMatrix2x2(R,this._matrices2x2[R]);for(const R in this._vectors2Arrays)q.setArray2(R,this._vectors2Arrays[R]);for(const R in this._vectors3Arrays)q.setArray3(R,this._vectors3Arrays[R]);for(const R in this._vectors4Arrays)q.setArray4(R,this._vectors4Arrays[R]);for(const R in this._uniformBuffers)q.setUniformBuffer(R,this._uniformBuffers[R]);for(const R in this._textureSamplers)q.setTextureSampler(R,this._textureSamplers[R]);for(const R in this._storageBuffers)q.setStorageBuffer(R,this._storageBuffers[R]);return q}dispose(N,q,R){if(q){let N;for(N in this._textures)this._textures[N].dispose();for(N in this._textureArrays){const q=this._textureArrays[N];for(let N=0;N<q.length;N++)q[N].dispose()}}this._textures={},super.dispose(N,q,R)}serialize(){const N=E.e.Serialize(this);let q;for(q in N.customType="BABYLON.ShaderMaterial",N.uniqueId=this.uniqueId,N.options=this._options,N.shaderPath=this._shaderPath,N.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,N.stencil=this.stencil.serialize(),N.textures={},this._textures)N.textures[q]=this._textures[q].serialize();for(q in N.textureArrays={},this._textureArrays){N.textureArrays[q]=[];const R=this._textureArrays[q];for(let z=0;z<R.length;z++)N.textureArrays[q].push(R[z].serialize())}for(q in N.ints={},this._ints)N.ints[q]=this._ints[q];for(q in N.uints={},this._uints)N.uints[q]=this._uints[q];for(q in N.floats={},this._floats)N.floats[q]=this._floats[q];for(q in N.floatsArrays={},this._floatsArrays)N.floatsArrays[q]=this._floatsArrays[q];for(q in N.colors3={},this._colors3)N.colors3[q]=this._colors3[q].ij();for(q in N.colors3Arrays={},this._colors3Arrays)N.colors3Arrays[q]=this._colors3Arrays[q];for(q in N.colors4={},this._colors4)N.colors4[q]=this._colors4[q].ij();for(q in N.colors4Arrays={},this._colors4Arrays)N.colors4Arrays[q]=this._colors4Arrays[q];for(q in N.vectors2={},this._vectors2)N.vectors2[q]=this._vectors2[q].ij();for(q in N.vectors3={},this._vectors3)N.vectors3[q]=this._vectors3[q].ij();for(q in N.vectors4={},this._vectors4)N.vectors4[q]=this._vectors4[q].ij();for(q in N.quaternions={},this._quaternions)N.quaternions[q]=this._quaternions[q].ij();for(q in N.matrices={},this._matrices)N.matrices[q]=this._matrices[q].ij();for(q in N.matrixArray={},this._matrixArrays)N.matrixArray[q]=this._matrixArrays[q];for(q in N.matrices3x3={},this._matrices3x3)N.matrices3x3[q]=this._matrices3x3[q];for(q in N.matrices2x2={},this._matrices2x2)N.matrices2x2[q]=this._matrices2x2[q];for(q in N.vectors2Arrays={},this._vectors2Arrays)N.vectors2Arrays[q]=this._vectors2Arrays[q];for(q in N.vectors3Arrays={},this._vectors3Arrays)N.vectors3Arrays[q]=this._vectors3Arrays[q];for(q in N.vectors4Arrays={},this._vectors4Arrays)N.vectors4Arrays[q]=this._vectors4Arrays[q];for(q in N.quaternionsArrays={},this._quaternionsArrays)N.quaternionsArrays[q]=this._quaternionsArrays[q];return N}static Parse(N,q,R){const v=E.e.Parse((()=>new L(N.name,q,N.shaderPath,N.options,N.storeEffectOnSubMeshes)),N,q,R);let B;for(B in N.stencil&&v.stencil.parse(N.stencil,q,R),N.textures)v.setTexture(B,x.c.Parse(N.textures[B],q,R));for(B in N.textureArrays){const z=N.textureArrays[B],F=[];for(let N=0;N<z.length;N++)F.push(x.c.Parse(z[N],q,R));v.setTextureArray(B,F)}for(B in N.ints)v.setInt(B,N.ints[B]);for(B in N.uints)v.setUInt(B,N.uints[B]);for(B in N.floats)v.setFloat(B,N.floats[B]);for(B in N.floatsArrays)v.setFloats(B,N.floatsArrays[B]);for(B in N.colors3)v.setColor3(B,F.c.Zg(N.colors3[B]));for(B in N.colors3Arrays){const q=N.colors3Arrays[B].reduce(((N,q,R)=>(R%3===0?N.push([q]):N[N.length-1].push(q),N)),[]).map((N=>F.c.Zg(N)));v.setColor3Array(B,q)}for(B in N.colors4)v.setColor4(B,F.g.Zg(N.colors4[B]));for(B in N.colors4Arrays){const q=N.colors4Arrays[B].reduce(((N,q,R)=>(R%4===0?N.push([q]):N[N.length-1].push(q),N)),[]).map((N=>F.g.Zg(N)));v.setColor4Array(B,q)}for(B in N.vectors2)v.setVector2(B,z.l.Zg(N.vectors2[B]));for(B in N.vectors3)v.setVector3(B,z.m.Zg(N.vectors3[B]));for(B in N.vectors4)v.setVector4(B,z.p.Zg(N.vectors4[B]));for(B in N.quaternions)v.setQuaternion(B,z.g.Zg(N.quaternions[B]));for(B in N.matrices)v.setMatrix(B,z.d.Zg(N.matrices[B]));for(B in N.matrixArray)v._matrixArrays[B]=new Float32Array(N.matrixArray[B]);for(B in N.matrices3x3)v.setMatrix3x3(B,N.matrices3x3[B]);for(B in N.matrices2x2)v.setMatrix2x2(B,N.matrices2x2[B]);for(B in N.vectors2Arrays)v.setArray2(B,N.vectors2Arrays[B]);for(B in N.vectors3Arrays)v.setArray3(B,N.vectors3Arrays[B]);for(B in N.vectors4Arrays)v.setArray4(B,N.vectors4Arrays[B]);for(B in N.quaternionsArrays)v.setArray4(B,N.quaternionsArrays[B]);return v}static ParseFromFileAsync(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((v,B)=>{const F=new f.b;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const q=JSON.parse(F.responseText),B=this.Parse(q,R||V.b.LastCreatedScene,z);N&&(B.name=N),v(B)}else B("Unable to load the ShaderMaterial")})),F.open("GET",q),F.send()}))}static ParseFromSnippetAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((z,v)=>{const B=new f.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const v=JSON.parse(JSON.parse(B.responseText).jsonPayload),F=JSON.parse(v.shaderMaterial),S=this.Parse(F,q||V.b.LastCreatedScene,R);S.snippetId=N,z(S)}else v("Unable to load the snippet "+N)})),B.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),B.send()}))}}L.SnippetUrl="https://snippet.babylonjs.com",L.CreateFromSnippetAsync=L.ParseFromSnippetAsync,(0,e.f)("BABYLON.ShaderMaterial",L),v.b._LinesMeshParser=(N,q)=>X.Parse(N,q);class X extends v.b{_isShaderMaterial(N){return"ShaderMaterial"===N.getClassName()}constructor(N){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0;super(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q,arguments.length>4?arguments[4]:void 0),this.useVertexColor=z,this.useVertexAlpha=v,this.color=new F.c(1,1,1),this.alpha=1,this._shaderLanguage=0,q&&(this.color=q.color.clone(),this.alpha=q.alpha,this.useVertexColor=q.useVertexColor,this.useVertexAlpha=q.useVertexAlpha),this.intersectionThreshold=.1;const A={attributes:[S.h.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===v?A.needAlphaBlending=!1:A.defines.push("#define VERTEXALPHA"),z?(A.defines.push("#define VERTEXCOLOR"),A.attributes.push(S.h.ColorKind)):(A.uniforms.push("color"),this._color4=new F.g),B)this.material=B;else{this.va().getEngine().isWebGPU&&!X.ForceGLSL&&(this._shaderLanguage=1),A.shaderLanguage=this._shaderLanguage,A.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([R.e(23).then(R.bind(R,13443)),R.e(47).then(R.bind(R,13449))]):await Promise.all([R.e(28).then(R.bind(R,13457)),R.e(48).then(R.bind(R,13460))])},this.material=new L("colorShader",this.va(),"color",A,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(N){this._lineMaterial=N,this._lineMaterial.fillMode=y.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(N){}_bind(N,q){if(!this._geometry)return this;const R=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(q,R):this._geometry._bind(q,R,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:N,g:q,b:R}=this.color;this._color4.set(N,q,R,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(N,q,R){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const z=this.va().getEngine();return this._unIndexed?z.drawArraysType(y.d.LineListDrawMode,N.verticesStart,N.verticesCount,R):z.drawElementsType(y.d.LineListDrawMode,N.indexStart,N.indexCount,R),this}dispose(N){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(N)}clone(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;return new X(N,this.va(),q,this,R)}createInstance(N){const q=new Q(N,this);if(this.instancedBuffers){q.instancedBuffers={};for(const N in this.instancedBuffers)q.instancedBuffers[N]=this.instancedBuffers[N]}return q}serialize(N){super.serialize(N),N.color=this.color.ij(),N.alpha=this.alpha}static Parse(N,q){const R=new X(N.name,q);return R.color=F.c.Zg(N.color),R.alpha=N.alpha,R}}X.ForceGLSL=!1;class Q extends A.d{constructor(N,q){super(N,q),this.intersectionThreshold=q.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var h=R(10907);function u(N){const q=[],R=[],z=N.lines,v=N.za,F=[];let S=0;for(let B=0;B<z.length;B++){const N=z[B];for(let z=0;z<N.length;z++){const{x:A,y:y,z:E}=N[z];if(R.push(A,y,E),v){const N=v[B],{r:q,g:R,b:S,a:A}=N[z];F.push(q,R,S,A)}z>0&&(q.push(S-1),q.push(S)),S++}}const A=new B.e;return A.indices=q,A.xa=R,v&&(A.za=F),A}function w(N){const q=N.dashSize||3,R=N.gapSize||1,v=N.dashNb||200,F=N.points,S=[],A=[],y=z.m.Zero();let E=0,t=0,x=0,e=0,b=0,f=0,D=0;for(D=0;D<F.length-1;D++)F[D+1].subtractToRef(F[D],y),E+=y.length();for(x=E/v,e=q*x/(q+R),D=0;D<F.length-1;D++){F[D+1].subtractToRef(F[D],y),t=Math.floor(y.length()/x),y.normalize();for(let N=0;N<t;N++)b=x*N,S.push(F[D].x+b*y.x,F[D].y+b*y.y,F[D].z+b*y.z),S.push(F[D].x+(b+e)*y.x,F[D].y+(b+e)*y.y,F[D].z+(b+e)*y.z),A.push(f,f+1),f+=2}const V=new B.e;return V.xa=S,V.indices=A,V}function c(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.instance,v=q.lines,B=q.za;if(z){const N=z.getVerticesData(S.h.PositionKind);let q,R;B&&(q=z.getVerticesData(S.h.ColorKind));let F=0,A=0;for(let z=0;z<v.length;z++){const S=v[z];for(let v=0;v<S.length;v++)N[F]=S[v].x,N[F+1]=S[v].y,N[F+2]=S[v].z,B&&q&&(R=B[z],q[A]=R[v].r,q[A+1]=R[v].g,q[A+2]=R[v].b,q[A+3]=R[v].a,A+=4),F+=3}return z.updateVerticesData(S.h.PositionKind,N,!1,!1),B&&q&&z.updateVerticesData(S.h.ColorKind,q,!1,!1),z.refreshBoundingInfo(),z}const F=new X(N,R,null,void 0,void 0,!!B,q.useVertexAlpha,q.material);return u(q).Ca(F,q.updatable),F}function n(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.za?[q.za]:null;return c(N,{lines:[q.points],updatable:q.updatable,instance:q.instance,za:z,useVertexAlpha:q.useVertexAlpha,material:q.material},R)}function G(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.points,F=q.instance,S=q.gapSize||1,A=q.dashSize||3;if(F){const N=N=>{const q=z.m.Zero(),R=N.length/6;let v=0,S=0,A=0,y=0,E=0,t=0,x=0,e=0;for(x=0;x<B.length-1;x++)B[x+1].subtractToRef(B[x],q),v+=q.length();A=v/R;const b=F._creationDataStorage.dashSize;for(y=b*A/(b+F._creationDataStorage.gapSize),x=0;x<B.length-1;x++)for(B[x+1].subtractToRef(B[x],q),S=Math.floor(q.length()/A),q.normalize(),e=0;e<S&&t<N.length;)E=A*e,N[t]=B[x].x+E*q.x,N[t+1]=B[x].y+E*q.y,N[t+2]=B[x].z+E*q.z,N[t+3]=B[x].x+(E+y)*q.x,N[t+4]=B[x].y+(E+y)*q.y,N[t+5]=B[x].z+(E+y)*q.z,t+=6,e++;for(;t<N.length;)N[t]=B[x].x,N[t+1]=B[x].y,N[t+2]=B[x].z,t+=3};return(q.dashNb||q.dashSize||q.gapSize||q.useVertexAlpha||q.material)&&h.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),F.updateMeshPositions(N,!1),F}const y=new X(N,R,null,void 0,void 0,void 0,q.useVertexAlpha,q.material);return w(q).Ca(y,q.updatable),y._creationDataStorage=new v.d,y._creationDataStorage.dashSize=A,y._creationDataStorage.gapSize=S,y}B.e.CreateLineSystem=u,B.e.CreateDashedLines=w,v.b.pb=function(N,q){return n(N,{points:q,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},v.b.CreateDashedLines=function(N,q,R,z,v){return G(N,{points:q,dashSize:R,gapSize:z,dashNb:v,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11569:(N,q,R)=>{"use strict";R.d(q,{c:()=>S,f:()=>A});var z=R(11445),v=R(11468),B=R(11414);function F(N){const q=[],R=[],z=[],F=[],S=N.width||N.size||1,A=N.height||N.size||1,y=0===N.sideOrientation?0:N.sideOrientation||v.e.DEFAULTSIDE,E=S/2,t=A/2;R.push(-E,-t,0),z.push(0,0,-1),F.push(0,B.b?1:0),R.push(E,-t,0),z.push(0,0,-1),F.push(1,B.b?1:0),R.push(E,t,0),z.push(0,0,-1),F.push(1,B.b?0:1),R.push(-E,t,0),z.push(0,0,-1),F.push(0,B.b?0:1),q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),v.e._ComputeSides(y,R,q,z,F,N.frontUVs,N.backUVs);const x=new v.e;return x.indices=q,x.xa=R,x.ya=z,x.Aa=F,x}function S(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new z.b(N,R);q.sideOrientation=z.b._GetDefaultSideOrientation(q.sideOrientation),v._originalBuilderSideOrientation=q.sideOrientation;return F(q).Ca(v,q.updatable),q.sourcePlane&&(v.translate(q.sourcePlane.k,-q.sourcePlane.d),v.setDirection(q.sourcePlane.k.scale(-1))),v}const A={ng:S};v.e.ng=F,z.b.ng=(N,q,R,z,v)=>S(N,{size:q,width:q,height:q,sideOrientation:v,updatable:z},R)},11812:(N,q,R)=>{"use strict";R.d(q,{c:()=>A});var z=R(11181),v=R(11445),B=R(11468),F=R(11414);function S(N){const q=0|(N.segments||32),R=N.diameterX||N.diameter||1,v=N.diameterY||N.diameter||1,S=N.diameterZ||N.diameter||1,A=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,y=N.slice&&N.slice<=0?1:N.slice||1,E=0===N.sideOrientation?0:N.sideOrientation||B.e.DEFAULTSIDE,t=!!N.dedupTopBottomIndices,x=new z.m(R/2,v/2,S/2),e=2+q,b=2*e,f=[],D=[],V=[],H=[];for(let B=0;B<=e;B++){const N=B/e,q=N*Math.PI*y;for(let R=0;R<=b;R++){const v=R/b,B=v*Math.PI*2*A,S=z.d.RotationZ(-q),y=z.d.RotationY(B),E=z.m.TransformCoordinates(z.m.Up(),S),t=z.m.TransformCoordinates(E,y),e=t.multiply(x),f=t.divide(x).normalize();D.push(e.x,e.y,e.z),V.push(f.x,f.y,f.z),H.push(v,F.b?1-N:N)}if(B>0){const N=D.length/3;for(let q=N-2*(b+1);q+b+2<N;q++)t?(B>1&&(f.push(q),f.push(q+1),f.push(q+b+1)),(B<e||y<1)&&(f.push(q+b+1),f.push(q+1),f.push(q+b+2))):(f.push(q),f.push(q+1),f.push(q+b+1),f.push(q+b+1),f.push(q+1),f.push(q+b+2))}}B.e._ComputeSides(E,D,f,V,H,N.frontUVs,N.backUVs);const Y=new B.e;return Y.indices=f,Y.xa=D,Y.ya=V,Y.Aa=H,Y}function A(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return S(q).Ca(z,q.updatable),z}B.e.CreateSphere=S,v.b.CreateSphere=(N,q,R,z,v,B)=>A(N,{segments:q,diameterX:R,diameterY:R,diameterZ:R,sideOrientation:B,updatable:v},z)},12165:(N,q,R)=>{"use strict";R.d(q,{c:()=>t});var z=R(10888),v=R(12171),B=R(11475),F=R(11251),S=R(11468),A=R(10907);function y(N,q,R,z,v){let B=null,F=null,S=null;try{let A;B=new N.Decoder,F=new N.DecoderBuffer,F.Init(q,q.byteLength);const y=B.GetEncodedGeometryType(F);switch(y){case N.TRIANGULAR_MESH:{const q=new N.Mesh;if(A=B.DecodeBufferToMesh(F,q),!A.ok()||0===q.ptr)throw new Error(A.error_msg());const R=3*q.num_faces(),v=4*R,y=N._malloc(v);try{B.GetTrianglesUInt32Array(q,v,y);const F=new Uint32Array(R);F.set(new Uint32Array(N.HEAPF32.buffer,y,R)),z(F)}finally{N._free(y)}S=q;break}case N.POINT_CLOUD:{const q=new N.PointCloud;if(A=B.DecodeBufferToPointCloud(F,q),!A.ok()||!q.ptr)throw new Error(A.error_msg());S=q;break}default:throw new Error(`Invalid geometry type ${y}`)}const E=S.num_points(),t=(q,R,z,B)=>{const F=B.data_type(),S=B.num_components(),A=B.normalized(),y=B.byte_stride(),t=B.byte_offset(),x={[N.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:N.HEAPF32},[N.DT_INT8]:{typedArrayConstructor:Int8Array,heap:N.HEAP8},[N.DT_INT16]:{typedArrayConstructor:Int16Array,heap:N.HEAP16},[N.DT_INT32]:{typedArrayConstructor:Int32Array,heap:N.HEAP32},[N.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:N.HEAPU8},[N.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:N.HEAPU16},[N.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:N.HEAPU32}}[F];if(!x)throw new Error(`Invalid data type ${F}`);const e=E*S,b=e*x.typedArrayConstructor.BYTES_PER_ELEMENT,f=N._malloc(b);try{q.GetAttributeDataArrayForAllPoints(R,B,F,b,f);const N=new x.typedArrayConstructor(x.heap.buffer,f,e);v(z,N.slice(),S,t,y,A)}finally{N._free(f)}};if(R)for(const N in R){const q=R[N],z=B.GetAttributeByUniqueId(S,q);t(B,S,N,z)}else{const q={position:N.POSITION,k:N.NORMAL,color:N.COLOR,uv:N.TEX_COORD};for(const N in q){const R=B.GetAttributeId(S,q[N]);if(-1!==R){const q=B.GetAttribute(S,R);t(B,S,N,q)}}}return E}finally{S&&N.destroy(S),F&&N.destroy(F),B&&N.destroy(B)}}function E(){let N;onmessage=q=>{const R=q.data;switch(R.id){case"init":{const q=R.decoder;q.url&&importScripts(q.url);const z=q.wasmBinary?{wasmBinary:q.wasmBinary}:{};N=DracoDecoderModule(z),postMessage({id:"initDone"});break}case"decodeMesh":if(!N)throw new Error("Draco decoder module is not available");N.then((N=>{const q=y(N,R.dataView,R.attributes,(N=>{postMessage({id:"indices",data:N},[N.buffer])}),((N,q,R,z,v,B)=>{postMessage({id:"attribute",kind:N,data:q,size:R,byteOffset:z,byteStride:v,normalized:B},[q.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:q})}))}}}class t{static get DecoderAvailable(){const N=t.Configuration.decoder;return!!(N.wasmUrl&&N.wasmBinaryUrl&&"object"===typeof WebAssembly||N.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return t._Default||(t._Default=new t),t._Default}static ResetDefault(N){t._Default&&(N||t._Default.dispose(),t._Default=null)}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultNumWorkers;const q=t.Configuration.decoder;if(q.workerPool||"object"===typeof N&&N.workerPool)this._workerPoolPromise=Promise.resolve(q.workerPool||N.workerPool);else{const R=q.wasmBinary||"object"===typeof N&&N.wasmBinary,B="number"===typeof N?N:N.numWorkers,F=B&&"function"===typeof Worker&&"function"===typeof URL,S=F||!F&&!q.jsModule,A=q.wasmUrl&&q.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:S?z.f.GetBabylonScriptURL(q.wasmUrl,!0):"",wasmBinaryPromise:R?Promise.resolve(R):z.f.LoadFileAsync(z.f.GetBabylonScriptURL(q.wasmBinaryUrl,!0))}:{url:S?z.f.GetBabylonScriptURL(q.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};F?this._workerPoolPromise=A.wasmBinaryPromise.then((N=>{const q=`${y}(${E})()`,R=URL.createObjectURL(new Blob([q],{type:"application/javascript"}));return new v.b(B,(()=>function(N,q,R){return new Promise(((z,v)=>{const B=q=>{N.removeEventListener("error",B),N.removeEventListener("message",F),v(q)},F=q=>{"initDone"===q.data.id&&(N.removeEventListener("error",B),N.removeEventListener("message",F),z(N))};if(N.addEventListener("error",B),N.addEventListener("message",F),q){const z=q.slice(0);N.postMessage({id:"init",decoder:{url:R,wasmBinary:z}},[z])}else N.postMessage({id:"init",decoder:{url:R}})}))}(new Worker(R),N,A.url)))})):this._decoderModulePromise=A.wasmBinaryPromise.then((async N=>{if("undefined"===typeof DracoDecoderModule&&!q.jsModule){if(!A.url)throw new Error("Draco decoder module is not available");await z.f.LoadBabylonScriptAsync(A.url)}return await(R=N,v=q.jsModule,new Promise((N=>{(v||DracoDecoderModule)({wasmBinary:R}).then((q=>{N({module:q})}))})));var R,v}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((N=>{N.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(N,q,R){const z=N instanceof ArrayBuffer?new Int8Array(N):new Int8Array(N.buffer,N.byteOffset,N.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((N=>new Promise(((v,B)=>{N.push(((N,F)=>{let S=null;const y=[],E=q=>{N.removeEventListener("error",E),N.removeEventListener("message",t),B(q),F()},t=q=>{const z=q.data;switch(z.id){case"decodeMeshDone":N.removeEventListener("error",E),N.removeEventListener("message",t),v({indices:S,attributes:y,totalVertices:z.totalVertices}),F();break;case"indices":S=z.data;break;case"attribute":y.push({kind:z.kind,data:z.data,size:z.size,byteOffset:z.byteOffset,byteStride:z.byteStride,normalized:(B=z.kind,x=z.normalized,R&&void 0!==R[B]?(x!==R[B]&&A.c.Warn(`Normalized flag from Draco data (${x}) does not match normalized flag from glTF accessor (${R[B]}). Using flag from glTF accessor.`),R[B]):x)})}var B,x};N.addEventListener("error",E),N.addEventListener("message",t);const x=z.slice();N.postMessage({id:"decodeMesh",dataView:x,attributes:q},[x.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((N=>{let R=null;const v=[],B=y(N.module,z,q,(N=>{R=N}),((N,q,R,z,B,F)=>{v.push({kind:N,data:q,size:R,byteOffset:z,byteStride:B,normalized:F})}));return{indices:R,attributes:v,totalVertices:B}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(N,q,R,z){const v=await this.decodeMeshToMeshDataAsync(R,z),S=new B.b(N,q);v.indices&&S.setIndices(v.indices);for(const B of v.attributes)S.setVerticesBuffer(new F.h(q.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),v.totalVertices);return S}async _decodeMeshToGeometryForGltfAsync(N,q,R,z,v){const S=await this.decodeMeshToMeshDataAsync(R,z,v),A=new B.b(N,q);S.indices&&A.setIndices(S.indices);for(const B of S.attributes)A.setVerticesBuffer(new F.h(q.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),S.totalVertices);return A}async decodeMeshAsync(N,q){const R=await this.decodeMeshToMeshDataAsync(N,q),z=new S.e;R.indices&&(z.indices=R.indices);for(const v of R.attributes){const N=F.h.GetFloatData(v.data,v.size,F.h.GetDataType(v.data),v.byteOffset,v.byteStride,v.normalized,R.totalVertices);z.set(N,v.kind)}return z}}t.Configuration={decoder:{wasmUrl:`${z.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${z.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${z.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},t.DefaultNumWorkers=t.GetDefaultNumWorkers(),t._Default=null},11630:(N,q,R)=>{"use strict";R.d(q,{c:()=>v});var z=R(11258);class v extends z.c{constructor(N){super(),this._buffer=N}get underlyingResource(){return this._buffer}}},11481:(N,q,R)=>{"use strict";R.d(q,{e:()=>Q});var z=R(11147),v=R(10893),B=R(11181),F=R(11251),S=R(11468),A=R(11486),y=R(11242),E=R(11344),t=R(11238);class x{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new B.m(0,0,0),this._diffPositionForCollisions=new B.m(0,0,0),this._collisionResponse=!0}}var e=R(10923),b=R(11362),f=R(11213),D=R(11186),V=R(11495),H=R(11002),Y=R(11151),T=R(10957);class L{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=B.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class X{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new L,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new x,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class Q extends A.e{static get BILLBOARDMODE_NONE(){return A.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return A.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return A.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return A.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return A.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return A.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(N){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=N}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(N){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=N}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(N){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=N}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(N){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=N}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(N){this._internalAbstractMeshDataInfo._collisionRetryCount=N}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(N){this._internalAbstractMeshDataInfo._morphTargetManager!==N&&(this._internalAbstractMeshDataInfo._morphTargetManager=N,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(N){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==N&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=N,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(N){return!!super._updateNonUniformScalingState(N)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(N){this._internalAbstractMeshDataInfo._rawBoundingInfo=N}set Ik(N){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(N)}set onCollisionPositionChange(N){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(N)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(N){if(this._internalAbstractMeshDataInfo._visibility===N)return;const q=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=N,(1===q&&1!==N||1!==q&&1===N)&&this._markSubMeshesAsDirty((N=>{N.markAsMiscDirty(),N.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(N){this._internalAbstractMeshDataInfo._inheritVisibility=N}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let N=this._parentNode;for(;N;){const q=N.isVisible;if("undefined"!==typeof q)return q;N=N.parent}}return this._isVisible}set isVisible(N){this._isVisible=N}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(N){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=N}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(N){this._internalAbstractMeshDataInfo._renderingGroupId=N}get material(){return this._internalAbstractMeshDataInfo._material}set material(N){this._setMaterial(N)}_setMaterial(N){this._internalAbstractMeshDataInfo._material!==N&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=N,N&&N.meshMap&&(N.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.lg&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(N){var q;return null===(q=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===q?void 0:q[N]}setMaterialForRenderPass(N,q){this.resetDrawCache(N),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[N]=q}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(N){this._internalAbstractMeshDataInfo._receiveShadows!==N&&(this._internalAbstractMeshDataInfo._receiveShadows=N,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(N){this._internalAbstractMeshDataInfo._hasVertexAlpha!==N&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=N,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(N){this._internalAbstractMeshDataInfo._useVertexColors!==N&&(this._internalAbstractMeshDataInfo._useVertexColors=N,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(N){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==N&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=N,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(N){this._internalAbstractMeshDataInfo._numBoneInfluencers!==N&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=N,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(N){this._internalAbstractMeshDataInfo._applyFog!==N&&(this._internalAbstractMeshDataInfo._applyFog=N,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(N){this._internalAbstractMeshDataInfo._enableDistantPicking=N}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(N){N!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=N,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(N){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(N)?-1:N}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(N){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=N}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(N){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(N)?-1:N}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(N){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=N}get lightSources(){return this._lightSources}set skeleton(N){const q=this._internalAbstractMeshDataInfo._skeleton;q&&q.needInitialSkinMatrix&&q._unregisterMeshWithPoseMatrix(this),N&&N.needInitialSkinMatrix&&N._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=N,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(N){var q;let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(N,R,!1),q=this,this._internalAbstractMeshDataInfo=new X,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Di=Q.Ei,this.onCollideObservable=new v.d,this.onCollisionPositionChangeObservable=new v.d,this.onMaterialChangedObservable=new v.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Ub=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=f.c.Red(),this.outlineWidth=.02,this.overlayColor=f.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Sb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new B.m(.5,1,.5),this.ellipsoidOffset=new B.m(0,0,0),this.edgesWidth=1,this.edgesColor=new f.g(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Nc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new v.d,this._onCollisionPositionChange=function(N,R){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.subtractToRef(q._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>T.d.CollisionsEpsilon&&q.position.addInPlace(q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),z&&q.onCollideObservable.notifyObservers(z),q.onCollisionPositionChangeObservable.notifyObservers(q.position)},R=this.va(),R.li(this),this._resyncLightSources(),this._uniformBuffer=new t.b(this.va().getEngine(),void 0,void 0,N,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),R.performancePriority){case 2:this.Da=!0;case 1:this.Sb=!0,this.Ub=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(N){const q=this._uniformBuffer;q.Hj("world",N),q.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),q.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(N){let q="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");q+=", # of submeshes: "+(this.lg?this.lg.length:0);const R=this._internalAbstractMeshDataInfo._skeleton;return R&&(q+=", skeleton: "+R.name),N&&(q+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],q+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Nc?"YES":"NO")),q}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==A.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(q||this.actionManager.isRecursive)){if(!N)return this.actionManager;if(this.actionManager.hasSpecificTrigger(N))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(N,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.lg){for(const N of this.lg)N._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const N of this.va().lights)N.isEnabled()&&N.canAffectMesh(this)&&this._lightSources.push(N);this._markSubMeshesAsLightDirty()}_resyncLightSource(N){const q=N.isEnabled()&&N.canAffectMesh(this),R=this._lightSources.indexOf(N);let z=!1;if(-1===R){if(!q)return;this._lightSources.push(N)}else{if(q)return;z=!0,this._lightSources.splice(R,1)}this._markSubMeshesAsLightDirty(z)}_unBindEffect(){for(const N of this.lg)N.setEffect(null)}_removeLightSource(N,q){const R=this._lightSources.indexOf(N);-1!==R&&(this._lightSources.splice(R,1),this._markSubMeshesAsLightDirty(q))}_markSubMeshesAsDirty(N){if(this.lg)for(const q of this.lg)for(let R=0;R<q._drawWrappers.length;++R){const z=q._drawWrappers[R];z&&z.defines&&z.defines.markAllAsDirty&&N(z.defines)}}_markSubMeshesAsLightDirty(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((q=>q.markAsLightDirty(N)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((N=>N.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((N=>N.markAsMiscDirty()))}Lg(N){return this._currentRenderId=Number.MAX_VALUE,super.Lg(N),this._isDirty=!0,this}resetDrawCache(N){if(this.lg)for(const q of this.lg)q.resetDrawCache(N)}get isBlocked(){return!1}getLOD(N){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}gg(){return null}getVerticesData(N){return null}Ga(N,q,R,z){return this}updateVerticesData(N,q,R,z){return this}setIndices(N,q){return this}isVerticesDataPresent(N){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(N){return this._boundingInfo=N,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(N,q,R){return this._boundingInfo=new E.e(N,q,R),this._boundingInfo}normalizeToUnitCube(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(N,q,R)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(F.h.MatricesIndicesKind)&&this.isVerticesDataPresent(F.h.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(N){}_activate(N,q){return this._renderId=N,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===A.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(N,q,R){return this.position.addInPlace(this.calcMovePOV(N,q,R)),this}calcMovePOV(N,q,R){const z=new B.d;(this.rotationQuaternion?this.rotationQuaternion:B.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(z);const v=B.m.Zero(),F=this.definedFacingForward?-1:1;return B.m.TransformCoordinatesFromFloatsToRef(N*F,q,R*F,z,v),v}rotatePOV(N,q,R){return this.rotation.addInPlace(this.calcRotatePOV(N,q,R)),this}calcRotatePOV(N,q,R){const z=this.definedFacingForward?1:-1;return new B.m(N*z,q,R*z)}Fa(N,q){if(N){const R=(0,b.f)(N,0,this.getTotalVertices(),q);this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new E.e(R.minimum,R.maximum)}if(this.lg)for(let R=0;R<this.lg.length;R++)this.lg[R].refreshBoundingInfo(N);this.Ea()}_refreshBoundingInfoDirect(N){if(this._boundingInfo?this._boundingInfo.reConstruct(N.minimum,N.maximum):this._boundingInfo=new E.e(N.minimum,N.maximum),this.lg)for(let q=0;q<this.lg.length;q++)this.lg[q].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(N,q,R,z,v,S,A){!function(N,q,R,z,v,S,A){const y=B.k.o[0],E=B.k.Matrix[0],t=B.k.Matrix[1],x=q===F.h.NormalKind?B.m.TransformNormalFromFloatsToRef:B.m.TransformCoordinatesFromFloatsToRef;for(let F=0,e=0;F<N.length;F+=3,e+=4){let q,b;for(E.reset(),q=0;q<4;q++)b=v[e+q],b>0&&(B.d.FromFloat32ArrayToRefScaled(R,Math.floor(16*z[e+q]),b,t),E.addToSelf(t));if(S&&A)for(q=0;q<4;q++)b=A[e+q],b>0&&(B.d.FromFloat32ArrayToRefScaled(R,Math.floor(16*S[e+q]),b,t),E.addToSelf(t));x(N[F],N[F+1],N[F+2],E,y),y.toArray(N,F)}}(N,q,R,z,v,S,A)}_getData(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.h.PositionKind;const z=N.cache,v=N=>{if(z){const q=z._vertexData||(z._vertexData={});return q[N]||this.copyVerticesData(N,q),q[N]}return this.getVerticesData(N)};if(q||(q=v(R)),!q)return null;if(z?(z._outputData?z._outputData.set(q):z._outputData=new Float32Array(q),q=z._outputData):(N.applyMorph&&this.morphTargetManager||N.applySkeleton&&this.skeleton)&&(q=q.slice()),N.applyMorph&&this.morphTargetManager&&function(N,q,R){let z=null;switch(q){case F.h.PositionKind:z=N=>N.getPositions();break;case F.h.NormalKind:z=N=>N.getNormals();break;case F.h.TangentKind:z=N=>N.getTangents();break;case F.h.UVKind:z=N=>N.getUVs();break;default:return}for(let v=0;v<N.length;v++){let q=N[v];for(let B=0;B<R.numTargets;B++){const F=R.getTarget(B),S=F.influence;if(0!==S){const R=z(F);R&&(q+=(R[v]-N[v])*S)}}N[v]=q}}(q,R,this.morphTargetManager),N.applySkeleton&&this.skeleton){const N=v(F.h.MatricesIndicesKind),z=v(F.h.MatricesWeightsKind);if(z&&N){const B=this.numBoneInfluencers>4,S=B?v(F.h.MatricesIndicesExtraKind):null,A=B?v(F.h.MatricesWeightsExtraKind):null,y=this.skeleton.getTransformMatrices(this);Q._ApplySkeleton(q,R,y,N,z,S,A)}}if(!1!==N.updatePositionsArray&&R===F.h.PositionKind){const N=this._internalAbstractMeshDataInfo._positions||[],R=N.length;if(N.length=q.length/3,R<N.length)for(let q=R;q<N.length;q++)N[q]=new B.m;for(let z=0,v=0;z<N.length;z++,v+=3)N[z].qe(q[v],q[v+1],q[v+2]);this._internalAbstractMeshDataInfo._positions=N}return q}getNormalsData(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:N,applyMorph:q,updatePositionsArray:!1},null,F.h.NormalKind)}be(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:N,applyMorph:q,updatePositionsArray:!1},R,F.h.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new E.e(B.m.Zero(),B.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(N){if(!this.lg)return this;const q=this.lg.length;for(let R=0;R<q;R++){const z=this.lg[R];(q>1||!z.IsGlobal)&&z.updateBoundingInfo(N)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(N){return this.getBoundingInfo().isInFrustum(N,this.Di)}isCompletelyInFrustum(N){return this.getBoundingInfo().isCompletelyInFrustum(N)}intersectsMesh(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;const z=this.getBoundingInfo(),v=N.getBoundingInfo();if(z.intersects(v,q))return!0;if(R)for(const B of this.getChildMeshes())if(B.intersectsMesh(N,q,!0))return!0;return!1}intersectsPoint(N){return this.getBoundingInfo().intersectsPoint(N)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(N){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=N}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(N){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const q=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=q.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,q.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,N,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(N,q,R){var z;if(this._generatePointsArray(),!this._positions)return this;if(!N._lastColliderWorldVertices||!N._lastColliderTransformMatrix.equals(q)){N._lastColliderTransformMatrix=q.clone(),N._lastColliderWorldVertices=[],N._trianglePlanes=[];const R=N.verticesStart,z=N.verticesStart+N.verticesCount;for(let v=R;v<z;v++)N._lastColliderWorldVertices.push(B.m.TransformCoordinates(this._positions[v],q))}return R._collide(N._trianglePlanes,N._lastColliderWorldVertices,this.gg(),N.indexStart,N.indexStart+N.indexCount,N.verticesStart,!!N.Ha(),this,this._shouldConvertRHS(),7===(null===(z=N.Ha())||void 0===z?void 0:z.fillMode)),this}_processCollisionsForSubMeshes(N,q){const R=this._scene.getCollidingSubMeshCandidates(this,N),z=R.length;for(let v=0;v<z;v++){const B=R.data[v];z>1&&!B._checkCollision(N)||this._collideForSubMesh(B,q,N)}return this}_shouldConvertRHS(){return!1}_checkCollision(N){if(!this.getBoundingInfo()._checkCollision(N))return this;const q=B.k.Matrix[0],R=B.k.Matrix[1];return B.d.ScalingToRef(1/N._radius.x,1/N._radius.y,1/N._radius.z,q),this.worldMatrixFromCache.multiplyToRef(q,R),this._processCollisionsForSubMeshes(N,R),this}_generatePointsArray(){return!1}intersects(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=new y.b,A=this.getClassName(),E="InstancedLinesMesh"===A||"LinesMesh"===A||"GreasedLineMesh"===A?this.intersectionThreshold:0,t=this.getBoundingInfo();if(!this.lg)return S;if(!F&&(!N.intersectsSphere(t.boundingSphere,E)||!N.intersectsBox(t.boundingBox,E)))return S;if(z)return S.hit=!F,S.pickedMesh=F?null:this,S.distance=F?0:B.m.Distance(N.origin,t.boundingSphere.center),S.subMeshId=0,S;if(!this._generatePointsArray())return S;let x=null;const e=this._scene.getIntersectingSubMeshCandidates(this,N),b=e.length;let f=!1;for(let B=0;B<b;B++){const N=e.data[B].Ha();if(N&&(7==N.fillMode||0==N.fillMode||1==N.fillMode||2==N.fillMode||4==N.fillMode)){f=!0;break}}if(!f)return S.hit=!0,S.pickedMesh=this,S.distance=B.m.Distance(N.origin,t.boundingSphere.center),S.subMeshId=-1,S;for(let B=0;B<b;B++){const z=e.data[B];if(b>1&&!F&&!z.canIntersects(N))continue;const v=z.intersects(N,this._positions,this.gg(),q,R);if(v&&(q||!x||v.distance<x.distance)&&(x=v,x.subMeshId=B,q))break}if(x){const q=v??this.getWorldMatrix(),R=B.k.o[0],z=B.k.o[1];B.m.TransformCoordinatesToRef(N.origin,q,R),N.direction.scaleToRef(x.distance,z);const F=B.m.TransformNormal(z,q).addInPlace(R);return S.hit=!0,S.distance=B.m.Distance(R,F),S.pickedPoint=F,S.pickedMesh=this,S.bu=x.bu||0,S.bv=x.bv||0,S.subMeshFaceId=x.faceId,S.faceId=x.faceId+e.data[x.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),S.subMeshId=x.subMeshId,S}return S}clone(N,q,R){return null}releaseSubMeshes(){if(this.lg)for(;this.lg.length;)this.lg[0].dispose();else this.lg=[];return this}dispose(N){let q,R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const z=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),z.freeActiveMeshes(),z.freeRenderingGroups(),z.renderingManager.maintainStateBetweenFrames&&z.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((N=>N!==this&&N.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),q=0;q<this._intersectionsInProgress.length;q++){const N=this._intersectionsInProgress[q],R=N._intersectionsInProgress.indexOf(this);N._intersectionsInProgress.splice(R,1)}this._intersectionsInProgress.length=0;z.lights.forEach((N=>{let q=N.includedOnlyMeshes.indexOf(this);-1!==q&&N.includedOnlyMeshes.splice(q,1),q=N.excludedMeshes.indexOf(this),-1!==q&&N.excludedMeshes.splice(q,1);const R=N.getShadowGenerators();if(R){const N=R.values();for(let R=N.next();!0!==R.done;R=N.next()){const N=R.value.getShadowMap();N&&N.renderList&&(q=N.renderList.indexOf(this),-1!==q&&N.renderList.splice(q,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const v=z.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,v.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),v.wipeCaches(),z.Ud(this),this._parentContainer){const N=this._parentContainer.meshes.indexOf(this);N>-1&&this._parentContainer.meshes.splice(N,1),this._parentContainer=null}if(R&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!N)for(q=0;q<z.qj.length;q++)z.qj[q].j===this&&(z.qj[q].dispose(),q--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(N,R)}_initFacetData(){const N=this._internalAbstractMeshDataInfo._facetData;N.facetNormals||(N.facetNormals=[]),N.facetPositions||(N.facetPositions=[]),N.facetPartitioning||(N.facetPartitioning=new Array),N.facetNb=this.gg().length/3|0,N.partitioningSubdivisions=N.partitioningSubdivisions?N.partitioningSubdivisions:10,N.partitioningBBoxRatio=N.partitioningBBoxRatio?N.partitioningBBoxRatio:1.01;for(let q=0;q<N.facetNb;q++)N.facetNormals[q]=B.m.Zero(),N.facetPositions[q]=B.m.Zero();return N.facetDataEnabled=!0,this}updateFacetData(){const N=this._internalAbstractMeshDataInfo._facetData;N.facetDataEnabled||this._initFacetData();const q=this.getVerticesData(F.h.PositionKind),R=this.gg(),z=this.getVerticesData(F.h.NormalKind),v=this.getBoundingInfo();if(N.facetDepthSort&&!N.facetDepthSortEnabled){if(N.facetDepthSortEnabled=!0,R instanceof Uint16Array)N.depthSortedIndices=new Uint16Array(R);else if(R instanceof Uint32Array)N.depthSortedIndices=new Uint32Array(R);else{let q=!1;for(let N=0;N<R.length;N++)if(R[N]>65535){q=!0;break}N.depthSortedIndices=q?new Uint32Array(R):new Uint16Array(R)}if(N.facetDepthSortFunction=function(N,q){return q.sqDistance-N.sqDistance},!N.facetDepthSortFrom){const q=this.va().activeCamera;N.facetDepthSortFrom=q?q.position:B.m.Zero()}N.depthSortedFacets=[];for(let q=0;q<N.facetNb;q++){const R={ind:3*q,sqDistance:0};N.depthSortedFacets.push(R)}N.invertedMatrix=B.d.Identity(),N.facetDepthSortOrigin=B.m.Zero()}N.bbSize.x=v.maximum.x-v.minimum.x>D.d?v.maximum.x-v.minimum.x:D.d,N.bbSize.y=v.maximum.y-v.minimum.y>D.d?v.maximum.y-v.minimum.y:D.d,N.bbSize.z=v.maximum.z-v.minimum.z>D.d?v.maximum.z-v.minimum.z:D.d;let A=N.bbSize.x>N.bbSize.y?N.bbSize.x:N.bbSize.y;if(A=A>N.bbSize.z?A:N.bbSize.z,N.subDiv.max=N.partitioningSubdivisions,N.subDiv.X=Math.floor(N.subDiv.max*N.bbSize.x/A),N.subDiv.Y=Math.floor(N.subDiv.max*N.bbSize.y/A),N.subDiv.Z=Math.floor(N.subDiv.max*N.bbSize.z/A),N.subDiv.X=N.subDiv.X<1?1:N.subDiv.X,N.subDiv.Y=N.subDiv.Y<1?1:N.subDiv.Y,N.subDiv.Z=N.subDiv.Z<1?1:N.subDiv.Z,N.facetParameters.facetNormals=this.getFacetLocalNormals(),N.facetParameters.facetPositions=this.getFacetLocalPositions(),N.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),N.facetParameters.bInfo=v,N.facetParameters.bbSize=N.bbSize,N.facetParameters.subDiv=N.subDiv,N.facetParameters.ratio=this.partitioningBBoxRatio,N.facetParameters.depthSort=N.facetDepthSort,N.facetDepthSort&&N.facetDepthSortEnabled&&(this.Oj(!0),this._worldMatrix.invertToRef(N.invertedMatrix),B.m.TransformCoordinatesToRef(N.facetDepthSortFrom,N.invertedMatrix,N.facetDepthSortOrigin),N.facetParameters.distanceTo=N.facetDepthSortOrigin),N.facetParameters.depthSortedFacets=N.depthSortedFacets,z&&S.e.ComputeNormals(q,R,z,N.facetParameters),N.facetDepthSort&&N.facetDepthSortEnabled){N.depthSortedFacets.sort(N.facetDepthSortFunction);const q=N.depthSortedIndices.length/3|0;for(let z=0;z<q;z++){const q=N.depthSortedFacets[z].ind;N.depthSortedIndices[3*z]=R[q],N.depthSortedIndices[3*z+1]=R[q+1],N.depthSortedIndices[3*z+2]=R[q+2]}this.updateIndices(N.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetNormals||this.updateFacetData(),N.facetNormals}getFacetLocalPositions(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetPositions||this.updateFacetData(),N.facetPositions}getFacetLocalPartitioning(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetPartitioning||this.updateFacetData(),N.facetPartitioning}getFacetPosition(N){const q=B.m.Zero();return this.getFacetPositionToRef(N,q),q}getFacetPositionToRef(N,q){const R=this.getFacetLocalPositions()[N],z=this.getWorldMatrix();return B.m.TransformCoordinatesToRef(R,z,q),this}getFacetNormal(N){const q=B.m.Zero();return this.getFacetNormalToRef(N,q),q}getFacetNormalToRef(N,q){const R=this.getFacetLocalNormals()[N];return B.m.TransformNormalToRef(R,this.getWorldMatrix(),q),this}getFacetsAtLocalCoordinates(N,q,R){const z=this.getBoundingInfo(),v=this._internalAbstractMeshDataInfo._facetData,B=Math.floor((N-z.minimum.x*v.partitioningBBoxRatio)*v.subDiv.X*v.partitioningBBoxRatio/v.bbSize.x),F=Math.floor((q-z.minimum.y*v.partitioningBBoxRatio)*v.subDiv.Y*v.partitioningBBoxRatio/v.bbSize.y),S=Math.floor((R-z.minimum.z*v.partitioningBBoxRatio)*v.subDiv.Z*v.partitioningBBoxRatio/v.bbSize.z);return B<0||B>v.subDiv.max||F<0||F>v.subDiv.max||S<0||S>v.subDiv.max?null:v.facetPartitioning[B+v.subDiv.max*F+v.subDiv.max*v.subDiv.max*S]}getClosestFacetAtCoordinates(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const S=this.getWorldMatrix(),A=B.k.Matrix[5];S.invertToRef(A);const y=B.k.o[8];B.m.TransformCoordinatesFromFloatsToRef(N,q,R,A,y);const E=this.getClosestFacetAtLocalCoordinates(y.x,y.y,y.z,z,v,F);return z&&B.m.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,S,z),E}getClosestFacetAtLocalCoordinates(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=null,S=0,A=0,y=0,E=0,t=0,x=0,e=0,b=0;const f=this.getFacetLocalPositions(),D=this.getFacetLocalNormals(),V=this.getFacetsAtLocalCoordinates(N,q,R);if(!V)return null;let H,Y,T,L=Number.MAX_VALUE,X=L;for(let Q=0;Q<V.length;Q++)H=V[Q],Y=D[H],T=f[H],E=(N-T.x)*Y.x+(q-T.y)*Y.y+(R-T.z)*Y.z,(!v||v&&B&&E>=0||v&&!B&&E<=0)&&(E=Y.x*T.x+Y.y*T.y+Y.z*T.z,t=-(Y.x*N+Y.y*q+Y.z*R-E)/(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z),x=N+Y.x*t,e=q+Y.y*t,b=R+Y.z*t,S=x-N,A=e-q,y=b-R,X=S*S+A*A+y*y,X<L&&(L=X,F=H,z&&(z.x=x,z.y=e,z.z=b)));return F}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetDataEnabled&&(N.facetDataEnabled=!1,N.facetPositions=[],N.facetNormals=[],N.facetPartitioning=new Array,N.facetParameters=null,N.depthSortedIndices=new Uint32Array(0)),this}updateIndices(N,q){return this}createNormals(N){const q=this.getVerticesData(F.h.PositionKind),R=this.gg();let z;return z=this.isVerticesDataPresent(F.h.NormalKind)?this.getVerticesData(F.h.NormalKind):[],S.e.ComputeNormals(q,R,z,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(F.h.NormalKind,z,N),this}alignWithNormal(N,q){q||(q=V.b.Y);const R=B.k.o[0],z=B.k.o[1];return B.m.CrossToRef(q,N,z),B.m.CrossToRef(N,z,R),this.rotationQuaternion?B.g.RotationQuaternionFromAxisToRef(R,N,z,this.rotationQuaternion):B.m.RotationFromAxisToRef(R,N,z,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,e.b)("EdgesRenderer")}enableEdgesRendering(N,q,R){throw(0,e.b)("EdgesRenderer")}rj(){return this._scene.qj.filter((N=>N.j===this))}}Q.OCCLUSION_TYPE_NONE=0,Q.OCCLUSION_TYPE_OPTIMISTIC=1,Q.OCCLUSION_TYPE_STRICT=2,Q.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Q.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Q.CULLINGSTRATEGY_STANDARD=0,Q.Ei=1,Q.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Q.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,z.c)([Y.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z,v,B,F,S]=q;return!Array.isArray(z)&&!Array.isArray(v)&&!Array.isArray(B)&&!Array.isArray(F)&&!Array.isArray(S)}))],Q,"_ApplySkeleton",null),(0,H.f)("BABYLON.AbstractMesh",Q)},11475:(N,q,R)=>{"use strict";R.d(q,{b:()=>D});var z=R(11181),v=R(11213),B=R(11468),F=R(11251),S=R(11335),A=R(11477),y=R(11344),E=R(10888),t=R(11178),x=R(11362),e=R(10933),b=R(11414),f=R(10907);class D{get boundingBias(){return this._boundingBias}set boundingBias(N){this._boundingBias?this._boundingBias.p(N):this._boundingBias=N.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(N){const q=new D(D.RandomId(),N.va());return q.Ca(N),q}get meshes(){return this._meshes}constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=q||e.b.LastCreatedScene,this._scene&&(this.id=N,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=z,R?this.setAllVerticesData(R,z):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),v&&(this.Ca(v),v.Oj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let N=0;N<this._meshes.length;N++)if(!this._meshes[N].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const N=new Set;for(const q in this._vertexBuffers)N.add(this._vertexBuffers[q].getWrapperBuffer());N.forEach((N=>{N._rebuild()}))}setAllVerticesData(N,q){N.applyToGeometry(this,q),this._notifyUpdate()}Ga(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;R&&Array.isArray(q)&&(q=new Float32Array(q));const v=new F.h(this._engine,q,N,{updatable:R,postponeInternalCreation:0===this._meshes.length,stride:z,label:"Geometry_"+this.id+"_"+N});this.setVerticesBuffer(v)}removeVerticesData(N){this._vertexBuffers[N]&&(this._vertexBuffers[N].dispose(),delete this._vertexBuffers[N]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=N.getKind();this._vertexBuffers[v]&&R&&this._vertexBuffers[v].dispose(),N._buffer&&N._buffer._increaseReferences(),this._vertexBuffers[v]=N;const B=this._meshes,S=B.length;if(v===F.h.PositionKind){this._totalVertices=q??N._maxVerticesCount,this._updateExtend(N.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const R=this._extend&&this._extend.minimum||new z.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),v=this._extend&&this._extend.maximum||new z.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let N=0;N<S;N++){const q=B[N];q.buildBoundingInfo(R,v),q._createGlobalSubMesh(q.isUnIndexed),q.Oj(!0),q.synchronizeInstances()}}this._notifyUpdate(v)}updateVerticesDataDirectly(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const v=this.getVertexBuffer(N);v&&(v.updateDirectly(q,R,z),this._notifyUpdate(N))}updateVerticesData(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this.getVertexBuffer(N);z&&(z.update(q),N===F.h.PositionKind&&this.Ea(R,q),this._notifyUpdate(N))}Ea(N,q){if(N&&this._updateExtend(q),this._resetPointsArrayCache(),N){const N=this._meshes;for(const q of N){q.hasBoundingInfo?q.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):q.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const N=q.lg;for(const q of N)q.refreshBoundingInfo()}}}_bind(N,q,R,z){if(!N)return;void 0===q&&(q=this._indexBuffer);const v=this.getVertexBuffers();if(!v)return;if(q!=this._indexBuffer||!this._vertexArrayObjects&&!z)return void this._engine.bindBuffers(v,q,N,R);const B=z||this._vertexArrayObjects,F=this._engine;B[N.key]||(B[N.key]=F.recordVertexArrayObject(v,q,N,R)),F.bindVertexArrayObject(B[N.key],q)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(N,q,R){const z=this.getVertexBuffer(N);return z?z.getFloatData(this._totalVertices,R||q&&1!==this._meshes.length):null}copyVerticesData(N,q){const R=this.getVertexBuffer(N);if(!R)return;q[N]||(q[N]=new Float32Array(this._totalVertices*R.getSize()));const z=R.getData();z&&function(N,q,R,z,v,B,S,A){const y=q*F.h.GetTypeByteLength(R),E=S*q;if(A.length!==E)throw new Error("Output length is not valid");if(R===F.h.FLOAT&&v===y)if(N instanceof Array){const q=z/4;A.set(N,q)}else if(N instanceof ArrayBuffer){const q=new Float32Array(N,z,E);A.set(q)}else{const q=N.byteOffset+z;if(q%4)return f.c.Warn("CopyFloatData: copied misaligned data."),void A.set(new Float32Array(N.buffer.slice(q,q+4*E)));const R=new Float32Array(N.buffer,q,E);A.set(R)}else F.h.ForEach(N,z,v,q,R,E,B,((N,q)=>A[q]=N))}(z,R.getSize(),R.type,R.byteOffset,R.byteStride,R.normalized,this._totalVertices,q[N])}isVertexBufferUpdatable(N){const q=this._vertexBuffers[N];return!!q&&q.isUpdatable()}getVertexBuffer(N){return this.isReady()?this._vertexBuffers[N]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(N){return this._vertexBuffers?void 0!==this._vertexBuffers[N]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(N)}getVerticesDataKinds(){const N=[];let q;if(!this._vertexBuffers&&this._delayInfo)for(q in this._delayInfo)N.push(q);else for(q in this._vertexBuffers)N.push(q);return N}updateIndices(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const z=N.length!==this._indices.length;if(R||(this._indices=N.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,N,q),z)for(const N of this._meshes)N._createGlobalSubMesh(!0)}else this.setIndices(N,null,!0)}setIndexBuffer(N,q,R){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=N,this._totalVertices=q,this._totalIndices=R,N.is32Bits||(N.is32Bits=this._totalIndices>65535);for(const z of this._meshes)z._createGlobalSubMesh(!0),z.synchronizeInstances();this._notifyUpdate()}setIndices(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=N,this._indexBufferIsUpdatable=R,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,R,"Geometry_"+this.id+"_IndexBuffer")),void 0!=q&&(this._totalVertices=q);for(const v of this._meshes)v._createGlobalSubMesh(!z),v.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}gg(N,q){if(!this.isReady())return null;const R=this._indices;return q||N&&1!==this._meshes.length?R.slice():R}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;N&&this._vertexArrayObjects&&this._vertexArrayObjects[N.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[N.key]),delete this._vertexArrayObjects[N.key])}releaseForMesh(N,q){const R=this._meshes,z=R.indexOf(N);-1!==z&&(R.splice(z,1),this._vertexArrayObjects&&N._invalidateInstanceVertexArrayObject(),N._geometry=null,0===R.length&&q&&this.dispose())}Ca(N){if(N._geometry===this)return;const q=N._geometry;q&&q.releaseForMesh(N),this._vertexArrayObjects&&N._invalidateInstanceVertexArrayObject();const R=this._meshes;N._geometry=this,N._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),R.push(N),this.isReady()?this._applyToMesh(N):this._boundingInfo&&N.setBoundingInfo(this._boundingInfo)}_updateExtend(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!N&&(N=this.getVerticesData(F.h.PositionKind),!N))return;this._extend=(0,x.f)(N,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(N){const q=this._meshes.length;for(const R in this._vertexBuffers)1===q&&this._vertexBuffers[R].create(),R===F.h.PositionKind&&(this._extend||this._updateExtend(),N.buildBoundingInfo(this._extend.minimum,this._extend.maximum),N._createGlobalSubMesh(N.isUnIndexed),N.Ea());1===q&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),N._syncGeometryWithMorphTargetManager(),N.synchronizeInstances()}_notifyUpdate(N){this.onGeometryUpdated&&this.onGeometryUpdated(this,N),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const q of this._meshes)q._markSubMeshesAsAttributesDirty()}load(N,q){2!==this.delayLoadState&&(this.isReady()?q&&q():(this.delayLoadState=2,this._queueLoad(N,q)))}_queueLoad(N,q){this.delayLoadingFile&&(N.addPendingData(this),N._loadFile(this.delayLoadingFile,(R=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(R),this),this.delayLoadState=1,this._delayInfo=[],N.removePendingData(this);const z=this._meshes,v=z.length;for(let N=0;N<v;N++)this._applyToMesh(z[N]);q&&q()}),void 0,!0))}toLeftHanded(){const N=this.gg(!1);if(null!=N&&N.length>0){for(let q=0;q<N.length;q+=3){const R=N[q+0];N[q+0]=N[q+2],N[q+2]=R}this.setIndices(N)}const q=this.getVerticesData(F.h.PositionKind,!1);if(null!=q&&q.length>0){for(let N=0;N<q.length;N+=3)q[N+2]=-q[N+2];this.Ga(F.h.PositionKind,q,!1)}const R=this.getVerticesData(F.h.NormalKind,!1);if(null!=R&&R.length>0){for(let N=0;N<R.length;N+=3)R[N+2]=-R[N+2];this.Ga(F.h.NormalKind,R,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const N=this.getVerticesData(F.h.PositionKind);if(!N||0===N.length)return!1;for(let q=3*this._positionsCache.length,R=this._positionsCache.length;q<N.length;q+=3,++R)this._positionsCache[R]=z.m.Zg(N,q);for(let q=0,R=0;q<N.length;q+=3,++R)this._positionsCache[R].set(N[0+q],N[1+q],N[2+q]);return this._positionsCache.length=N.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const R in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[R]);this._vertexArrayObjects={};const N=this._meshes,q=N.length;for(let R=0;R<q;R++)N[R]._invalidateInstanceVertexArrayObject()}}dispose(){const N=this._meshes,q=N.length;let R;for(R=0;R<q;R++)this.releaseForMesh(N[R]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const z in this._vertexBuffers)this._vertexBuffers[z].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const N=this._parentContainer.geometries.indexOf(this);N>-1&&this._parentContainer.geometries.splice(N,1),this._parentContainer=null}this._isDisposed=!0}i(N){const q=new B.e;q.indices=[];const R=this.gg();if(R)for(let B=0;B<R.length;B++)q.indices.push(R[B]);let z,v=!1,F=!1;for(z in this._vertexBuffers){const N=this.getVerticesData(z);if(N&&(N instanceof Float32Array?q.set(new Float32Array(N),z):q.set(N.slice(0),z),!F)){const N=this.getVertexBuffer(z);N&&(v=N.isUpdatable(),F=!v)}}const S=new D(N,this._scene,q,v);for(z in S.delayLoadState=this.delayLoadState,S.delayLoadingFile=this.delayLoadingFile,S._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)S._delayInfo=S._delayInfo||[],S._delayInfo.push(z);return S._boundingInfo=new y.e(this._extend.minimum,this._extend.maximum),S}serialize(){const N={};return N.id=this.id,N.uniqueId=this.uniqueId,N.updatable=this._updatable,t.b&&t.b.HasTags(this)&&(N.tags=t.b.GetTags(this)),N}_toNumberArray(N){return Array.isArray(N)?N:Array.prototype.slice.call(N)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const N in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,N)&&(this._vertexBuffers[N]._buffer._data=null)}serializeVerticeData(){const N=this.serialize();return this.isVerticesDataPresent(F.h.PositionKind)&&(N.xa=this._toNumberArray(this.getVerticesData(F.h.PositionKind)),this.isVertexBufferUpdatable(F.h.PositionKind)&&(N.xa._updatable=!0)),this.isVerticesDataPresent(F.h.NormalKind)&&(N.ya=this._toNumberArray(this.getVerticesData(F.h.NormalKind)),this.isVertexBufferUpdatable(F.h.NormalKind)&&(N.ya._updatable=!0)),this.isVerticesDataPresent(F.h.TangentKind)&&(N.tangents=this._toNumberArray(this.getVerticesData(F.h.TangentKind)),this.isVertexBufferUpdatable(F.h.TangentKind)&&(N.tangents._updatable=!0)),this.isVerticesDataPresent(F.h.UVKind)&&(N.Aa=this._toNumberArray(this.getVerticesData(F.h.UVKind)),this.isVertexBufferUpdatable(F.h.UVKind)&&(N.Aa._updatable=!0)),this.isVerticesDataPresent(F.h.UV2Kind)&&(N.uvs2=this._toNumberArray(this.getVerticesData(F.h.UV2Kind)),this.isVertexBufferUpdatable(F.h.UV2Kind)&&(N.uvs2._updatable=!0)),this.isVerticesDataPresent(F.h.UV3Kind)&&(N.uvs3=this._toNumberArray(this.getVerticesData(F.h.UV3Kind)),this.isVertexBufferUpdatable(F.h.UV3Kind)&&(N.uvs3._updatable=!0)),this.isVerticesDataPresent(F.h.UV4Kind)&&(N.uvs4=this._toNumberArray(this.getVerticesData(F.h.UV4Kind)),this.isVertexBufferUpdatable(F.h.UV4Kind)&&(N.uvs4._updatable=!0)),this.isVerticesDataPresent(F.h.UV5Kind)&&(N.uvs5=this._toNumberArray(this.getVerticesData(F.h.UV5Kind)),this.isVertexBufferUpdatable(F.h.UV5Kind)&&(N.uvs5._updatable=!0)),this.isVerticesDataPresent(F.h.UV6Kind)&&(N.uvs6=this._toNumberArray(this.getVerticesData(F.h.UV6Kind)),this.isVertexBufferUpdatable(F.h.UV6Kind)&&(N.uvs6._updatable=!0)),this.isVerticesDataPresent(F.h.ColorKind)&&(N.za=this._toNumberArray(this.getVerticesData(F.h.ColorKind)),this.isVertexBufferUpdatable(F.h.ColorKind)&&(N.za._updatable=!0)),this.isVerticesDataPresent(F.h.MatricesIndicesKind)&&(N.matricesIndices=this._toNumberArray(this.getVerticesData(F.h.MatricesIndicesKind)),N.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(F.h.MatricesIndicesKind)&&(N.matricesIndices._updatable=!0)),this.isVerticesDataPresent(F.h.MatricesWeightsKind)&&(N.matricesWeights=this._toNumberArray(this.getVerticesData(F.h.MatricesWeightsKind)),this.isVertexBufferUpdatable(F.h.MatricesWeightsKind)&&(N.matricesWeights._updatable=!0)),N.indices=this._toNumberArray(this.gg()),N}static ExtractFromMesh(N,q){const R=N._geometry;return R?R.i(q):null}static RandomId(){return E.f.RandomId()}static _GetGeometryByLoadedUniqueId(N,q){for(let R=0;R<q.geometries.length;R++)if(q.geometries[R]._loadedUniqueId===N)return q.geometries[R];return null}static _ImportGeometry(N,q){const R=q.va(),z=N.geometryUniqueId,B=N.geometryId;if(z||B){const N=z?this._GetGeometryByLoadedUniqueId(z,R):R.getGeometryById(B);N&&N.Ca(q)}else if(N instanceof ArrayBuffer){const R=q._binaryInfo;if(R.positionsAttrDesc&&R.positionsAttrDesc.count>0){const z=new Float32Array(N,R.positionsAttrDesc.offset,R.positionsAttrDesc.count);q.Ga(F.h.PositionKind,z,!1)}if(R.normalsAttrDesc&&R.normalsAttrDesc.count>0){const z=new Float32Array(N,R.normalsAttrDesc.offset,R.normalsAttrDesc.count);q.Ga(F.h.NormalKind,z,!1)}if(R.tangetsAttrDesc&&R.tangetsAttrDesc.count>0){const z=new Float32Array(N,R.tangetsAttrDesc.offset,R.tangetsAttrDesc.count);q.Ga(F.h.TangentKind,z,!1)}if(R.uvsAttrDesc&&R.uvsAttrDesc.count>0){const z=new Float32Array(N,R.uvsAttrDesc.offset,R.uvsAttrDesc.count);if(b.b)for(let N=1;N<z.length;N+=2)z[N]=1-z[N];q.Ga(F.h.UVKind,z,!1)}if(R.uvs2AttrDesc&&R.uvs2AttrDesc.count>0){const z=new Float32Array(N,R.uvs2AttrDesc.offset,R.uvs2AttrDesc.count);if(b.b)for(let N=1;N<z.length;N+=2)z[N]=1-z[N];q.Ga(F.h.UV2Kind,z,!1)}if(R.uvs3AttrDesc&&R.uvs3AttrDesc.count>0){const z=new Float32Array(N,R.uvs3AttrDesc.offset,R.uvs3AttrDesc.count);if(b.b)for(let N=1;N<z.length;N+=2)z[N]=1-z[N];q.Ga(F.h.UV3Kind,z,!1)}if(R.uvs4AttrDesc&&R.uvs4AttrDesc.count>0){const z=new Float32Array(N,R.uvs4AttrDesc.offset,R.uvs4AttrDesc.count);if(b.b)for(let N=1;N<z.length;N+=2)z[N]=1-z[N];q.Ga(F.h.UV4Kind,z,!1)}if(R.uvs5AttrDesc&&R.uvs5AttrDesc.count>0){const z=new Float32Array(N,R.uvs5AttrDesc.offset,R.uvs5AttrDesc.count);if(b.b)for(let N=1;N<z.length;N+=2)z[N]=1-z[N];q.Ga(F.h.UV5Kind,z,!1)}if(R.uvs6AttrDesc&&R.uvs6AttrDesc.count>0){const z=new Float32Array(N,R.uvs6AttrDesc.offset,R.uvs6AttrDesc.count);if(b.b)for(let N=1;N<z.length;N+=2)z[N]=1-z[N];q.Ga(F.h.UV6Kind,z,!1)}if(R.colorsAttrDesc&&R.colorsAttrDesc.count>0){const z=new Float32Array(N,R.colorsAttrDesc.offset,R.colorsAttrDesc.count);q.Ga(F.h.ColorKind,z,!1,R.colorsAttrDesc.stride)}if(R.matricesIndicesAttrDesc&&R.matricesIndicesAttrDesc.count>0){const z=new Int32Array(N,R.matricesIndicesAttrDesc.offset,R.matricesIndicesAttrDesc.count),v=[];for(let N=0;N<z.length;N++){const q=z[N];v.push(255&q),v.push((65280&q)>>8),v.push((16711680&q)>>16),v.push(q>>24&255)}q.Ga(F.h.MatricesIndicesKind,v,!1)}if(R.matricesIndicesExtraAttrDesc&&R.matricesIndicesExtraAttrDesc.count>0){const z=new Int32Array(N,R.matricesIndicesExtraAttrDesc.offset,R.matricesIndicesExtraAttrDesc.count),v=[];for(let N=0;N<z.length;N++){const q=z[N];v.push(255&q),v.push((65280&q)>>8),v.push((16711680&q)>>16),v.push(q>>24&255)}q.Ga(F.h.MatricesIndicesExtraKind,v,!1)}if(R.matricesWeightsAttrDesc&&R.matricesWeightsAttrDesc.count>0){const z=new Float32Array(N,R.matricesWeightsAttrDesc.offset,R.matricesWeightsAttrDesc.count);q.Ga(F.h.MatricesWeightsKind,z,!1)}if(R.indicesAttrDesc&&R.indicesAttrDesc.count>0){const z=new Int32Array(N,R.indicesAttrDesc.offset,R.indicesAttrDesc.count);q.setIndices(z,null)}if(R.subMeshesAttrDesc&&R.subMeshesAttrDesc.count>0){const z=new Int32Array(N,R.subMeshesAttrDesc.offset,5*R.subMeshesAttrDesc.count);q.lg=[];for(let N=0;N<R.subMeshesAttrDesc.count;N++){const R=z[5*N+0],v=z[5*N+1],B=z[5*N+2],F=z[5*N+3],A=z[5*N+4];S.e.AddToMesh(R,v,B,F,A,q)}}}else if(N.xa&&N.ya&&N.indices){if(q.Ga(F.h.PositionKind,N.xa,N.xa._updatable),q.Ga(F.h.NormalKind,N.ya,N.ya._updatable),N.tangents&&q.Ga(F.h.TangentKind,N.tangents,N.tangents._updatable),N.Aa&&q.Ga(F.h.UVKind,N.Aa,N.Aa._updatable),N.uvs2&&q.Ga(F.h.UV2Kind,N.uvs2,N.uvs2._updatable),N.uvs3&&q.Ga(F.h.UV3Kind,N.uvs3,N.uvs3._updatable),N.uvs4&&q.Ga(F.h.UV4Kind,N.uvs4,N.uvs4._updatable),N.uvs5&&q.Ga(F.h.UV5Kind,N.uvs5,N.uvs5._updatable),N.uvs6&&q.Ga(F.h.UV6Kind,N.uvs6,N.uvs6._updatable),N.za&&q.Ga(F.h.ColorKind,v.g.CheckColors4(N.za,N.xa.length/3),N.za._updatable),N.matricesIndices)if(N.matricesIndices._isExpanded)delete N.matricesIndices._isExpanded,q.Ga(F.h.MatricesIndicesKind,N.matricesIndices,N.matricesIndices._updatable);else{const R=[];for(let q=0;q<N.matricesIndices.length;q++){const z=N.matricesIndices[q];R.push(255&z),R.push((65280&z)>>8),R.push((16711680&z)>>16),R.push(z>>24&255)}q.Ga(F.h.MatricesIndicesKind,R,N.matricesIndices._updatable)}if(N.matricesIndicesExtra)if(N.matricesIndicesExtra._isExpanded)delete N.matricesIndices._isExpanded,q.Ga(F.h.MatricesIndicesExtraKind,N.matricesIndicesExtra,N.matricesIndicesExtra._updatable);else{const R=[];for(let q=0;q<N.matricesIndicesExtra.length;q++){const z=N.matricesIndicesExtra[q];R.push(255&z),R.push((65280&z)>>8),R.push((16711680&z)>>16),R.push(z>>24&255)}q.Ga(F.h.MatricesIndicesExtraKind,R,N.matricesIndicesExtra._updatable)}N.matricesWeights&&(D._CleanMatricesWeights(N,q),q.Ga(F.h.MatricesWeightsKind,N.matricesWeights,N.matricesWeights._updatable)),N.matricesWeightsExtra&&q.Ga(F.h.MatricesWeightsExtraKind,N.matricesWeightsExtra,N.matricesWeights._updatable),q.setIndices(N.indices,null)}if(N.lg){q.lg=[];for(let R=0;R<N.lg.length;R++){const z=N.lg[R];S.e.AddToMesh(z.materialIndex,z.verticesStart,z.verticesCount,z.indexStart,z.indexCount,q)}}q._shouldGenerateFlatShading&&(q.convertToFlatShadedMesh(),q._shouldGenerateFlatShading=!1),q.Oj(!0),R.onMeshImportedObservable.notifyObservers(q)}static _CleanMatricesWeights(N,q){const R=.001;if(!A.c.CleanBoneMatrixWeights)return;let z=0;if(!(N.skeletonId>-1))return;{const R=q.va().getLastSkeletonById(N.skeletonId);if(!R)return;z=R.bones.length}const v=q.getVerticesData(F.h.MatricesIndicesKind),B=q.getVerticesData(F.h.MatricesIndicesExtraKind),S=N.matricesWeights,y=N.matricesWeightsExtra,E=N.numBoneInfluencer,t=S.length;for(let F=0;F<t;F+=4){let N=0,q=-1;for(let z=0;z<4;z++){const v=S[F+z];N+=v,v<R&&q<0&&(q=z)}if(y)for(let z=0;z<4;z++){const v=y[F+z];N+=v,v<R&&q<0&&(q=z+4)}if((q<0||q>E-1)&&(q=E-1),N>R){const q=1/N;for(let N=0;N<4;N++)S[F+N]*=q;if(y)for(let N=0;N<4;N++)y[F+N]*=q}else q>=4?(y[F+q-4]=1-N,B[F+q-4]=z):(S[F+q]=1-N,v[F+q]=z)}q.Ga(F.h.MatricesIndicesKind,v),N.matricesWeightsExtra&&q.Ga(F.h.MatricesIndicesExtraKind,B)}static Parse(N,q,R){const v=new D(N.id,q,void 0,N.updatable);return v._loadedUniqueId=N.uniqueId,t.b&&t.b.AddTagsTo(v,N.tags),N.delayLoadingFile?(v.delayLoadState=4,v.delayLoadingFile=R+N.delayLoadingFile,v._boundingInfo=new y.e(z.m.Zg(N.boundingBoxMinimum),z.m.Zg(N.boundingBoxMaximum)),v._delayInfo=[],N.hasUVs&&v._delayInfo.push(F.h.UVKind),N.hasUVs2&&v._delayInfo.push(F.h.UV2Kind),N.hasUVs3&&v._delayInfo.push(F.h.UV3Kind),N.hasUVs4&&v._delayInfo.push(F.h.UV4Kind),N.hasUVs5&&v._delayInfo.push(F.h.UV5Kind),N.hasUVs6&&v._delayInfo.push(F.h.UV6Kind),N.hasColors&&v._delayInfo.push(F.h.ColorKind),N.hasMatricesIndices&&v._delayInfo.push(F.h.MatricesIndicesKind),N.hasMatricesWeights&&v._delayInfo.push(F.h.MatricesWeightsKind),v._delayLoadingFunction=B.e.ImportVertexData):B.e.ImportVertexData(N,v),q.pushGeometry(v,!0),v}}},12121:(N,q,R)=>{"use strict";R.d(q,{d:()=>x});var z=R(11181),v=R(10907),B=R(11481),F=R(11445),S=R(10911),A=R(11486),y=R(11251),E=R(10888),t=R(11002);F.b._instancedMeshFactory=(N,q)=>{const R=new x(N,q);if(q.instancedBuffers){R.instancedBuffers={};for(const N in q.instancedBuffers)R.instancedBuffers[N]=q.instancedBuffers[N]}return R};class x extends B.e{constructor(N,q){super(N,q.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,q.Gj(this),this._sourceMesh=q,this._unIndexed=q._unIndexed,this.position.p(q.position),this.rotation.p(q.rotation),this.re.p(q.re),q.rotationQuaternion&&(this.rotationQuaternion=q.rotationQuaternion.clone()),this.animations=q.animations.slice();for(const R of q.getAnimationRanges())null!=R&&this.createAnimationRange(R.name,R.from,R.to);this.infiniteDistance=q.infiniteDistance,this.setPivotMatrix(q.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(N){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.receiveShadows)!==N&&E.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(N){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.material)!==N&&E.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(N){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.visibility)!==N&&E.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(N){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.skeleton)!==N&&E.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(N){this._sourceMesh&&N!==this._sourceMesh.renderingGroupId&&v.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(N){return this._sourceMesh.createInstance(N)}isReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(N,!0)}getVerticesData(N,q,R){return this._sourceMesh.getVerticesData(N,q,R)}copyVerticesData(N,q){this._sourceMesh.copyVerticesData(N,q)}Ga(N,q,R,z){return this.sourceMesh&&this.sourceMesh.Ga(N,q,R,z),this.sourceMesh}updateVerticesData(N,q,R,z){return this.sourceMesh&&this.sourceMesh.updateVerticesData(N,q,R,z),this.sourceMesh}setIndices(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(N,q),this.sourceMesh}isVerticesDataPresent(N){return this._sourceMesh.isVerticesDataPresent(N)}gg(){return this._sourceMesh.gg()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let N,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;N="object"===typeof q?q:{applySkeleton:q,applyMorph:R};const z=this._sourceMesh.Dj?this._sourceMesh.Dj.boundingBias:null;return this.Fa(this._sourceMesh._getData(N,null,y.h.PositionKind),z),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(N,q){if(super._activate(N,q),this._sourceMesh.lg||v.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,N),q){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==A.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new z.d);const N=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,z.k.o[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Oj(!0)),this._currentLOD.position.p(z.k.o[7]),this._currentLOD._masterMesh=N,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(N){if(!N)return this;const q=this.sourceMesh.getLODLevels();if(q&&0!==q.length){const q=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(N,q.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(N){return this.sourceMesh._preActivateForIntermediateRendering(N)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.lg)for(let N=0;N<this._sourceMesh.lg.length;N++)this._sourceMesh.lg[N].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;const z=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(N);if(S.d.DeepCopy(this,z,["name","lg","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),q&&(z.parent=q),!R)for(let v=0;v<this.va().meshes.length;v++){const N=this.va().meshes[v];N.parent===this&&N.clone(N.name,z)}return z.Oj(!0),this.onClonedObservable.notifyObservers(z),z}dispose(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Fj(this),super.dispose(N,q)}_serializeAsParent(N){super._serializeAsParent(N),N.parentId=this._sourceMesh.uniqueId,N.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const z=this.clone("Clone of "+(this.name||this.id),N||this.parent,!0,q&&q.newSourcedMesh);z&&R&&R(this,z);for(const v of this.getChildTransformNodes(!0))v.instantiateHierarchy(z,q,R);return z}}F.b.prototype.registerInstancedBuffer=function(N,q){var R,z;if(null===(R=this._userInstancedBuffersStorage)||void 0===R||null===(z=R.vertexBuffers[N])||void 0===z||z.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const N of this.instances)N.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[N]=null,this._userInstancedBuffersStorage.strides[N]=q,this._userInstancedBuffersStorage.sizes[N]=32*q,this._userInstancedBuffersStorage.data[N]=new Float32Array(this._userInstancedBuffersStorage.sizes[N]),this._userInstancedBuffersStorage.vertexBuffers[N]=new y.h(this.getEngine(),this._userInstancedBuffersStorage.data[N],N,!0,!1,q,!0);for(const v of this.instances)v.instancedBuffers[N]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},F.b.prototype._processInstancedBuffers=function(N,q){const R=N?N.length:0;for(const z in this.instancedBuffers){let v=this._userInstancedBuffersStorage.sizes[z];const B=this._userInstancedBuffersStorage.strides[z],F=(R+1)*B;for(;v<F;)v*=2;this._userInstancedBuffersStorage.data[z].length!=v&&(this._userInstancedBuffersStorage.data[z]=new Float32Array(v),this._userInstancedBuffersStorage.sizes[z]=v,this._userInstancedBuffersStorage.vertexBuffers[z]&&(this._userInstancedBuffersStorage.vertexBuffers[z].dispose(),this._userInstancedBuffersStorage.vertexBuffers[z]=null));const S=this._userInstancedBuffersStorage.data[z];let A=0;if(q){const N=this.instancedBuffers[z];N.toArray?N.toArray(S,A):N.copyToArray?N.copyToArray(S,A):S[A]=N,A+=B}for(let q=0;q<R;q++){const R=N[q].instancedBuffers[z];R.toArray?R.toArray(S,A):R.copyToArray?R.copyToArray(S,A):S[A]=R,A+=B}this._userInstancedBuffersStorage.vertexBuffers[z]?this._userInstancedBuffersStorage.vertexBuffers[z].updateDirectly(S,0):(this._userInstancedBuffersStorage.vertexBuffers[z]=new y.h(this.getEngine(),this._userInstancedBuffersStorage.data[z],z,!0,!1,B,!0),this._invalidateInstanceVertexArrayObject())}},F.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const N in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[N]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},F.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const N in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[N]&&this._userInstancedBuffersStorage.vertexBuffers[N].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,t.f)("BABYLON.InstancedMesh",x)},11445:(N,q,R)=>{"use strict";R.d(q,{b:()=>Z,d:()=>w});var z=R(10893),v=R(10888),B=R(10911),F=R(11178),S=R(11450),A=R(11452),y=R(11181),E=R(11213),t=R(11454),x=R(11251),e=R(11468),b=R(11475),f=R(11481),D=R(11335),V=R(11332),H=R(11503),Y=R(11477),T=R(11221),L=R(10907),X=R(11002),Q=R(10923),h=R(11282);class u{constructor(N,q){this.distanceOrScreenCoverage=N,this.mesh=q}}class w{}class c{constructor(){this.visibleInstances={},this.batchCache=new n,this.batchCacheReplacementModeInFrozenMode=new n,this.instancesBufferSize=2048}}class n{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class G{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class s{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class Z extends f.e{static _GetDefaultSideOrientation(N){return N||Z.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(N){this._internalMeshDataInfo._useLODScreenCoverage=N,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(N){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==N&&(N&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(x.h.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(x.h.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=N,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new z.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new z.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new z.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new z.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new z.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(N){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(N)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(N){this._internalMeshDataInfo._forcedInstanceCount=N}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(N){this._internalMeshDataInfo._sideOrientation=N,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===N||!this._scene.useRightHandedSystem&&0===N}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(N){this.sideOrientation=N,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(N){this._internalMeshDataInfo._overrideRenderingFillMode=N}get material(){return this._internalAbstractMeshDataInfo._material}set material(N){N&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(N.sideOrientation=null),this._setMaterial(N)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(N){this._unIndexed!==N&&(this._unIndexed=N,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(N){this._instanceDataStorage.manualUpdate=N}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(N){this._instanceDataStorage.previousManualUpdate=N}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(N){this._instanceDataStorage.forceMatrixUpdates=N}_copySource(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this.va();if(N._geometry&&N._geometry.Ca(this),B.d.DeepCopy(N,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Dj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=N,z.useClonedMeshMap&&(N._internalMeshDataInfo.meshMap||(N._internalMeshDataInfo.meshMap={}),N._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=N._originalBuilderSideOrientation,this._creationDataStorage=N._creationDataStorage,N._ranges){const q=N._ranges;for(const N in q)Object.prototype.hasOwnProperty.call(q,N)&&q[N]&&this.createAnimationRange(N,q[N].from,q[N].to)}if(N.metadata&&N.metadata.clone?this.metadata=N.metadata.clone():this.metadata=N.metadata,this._internalMetadata=N._internalMetadata,F.b&&F.b.HasTags(N)&&F.b.AddTagsTo(this,F.b.GetTags(N,!0)),this.Vb(N.isEnabled(!1)),this.parent=N.parent,this.setPivotMatrix(N.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+N.id,this.material=N.material,!q){const q=N.getDescendants(!0);for(let N=0;N<q.length;N++){const R=q[N];R.clone&&R.clone(this.name+"."+R.name,this)}}if(N.morphTargetManager&&(this.morphTargetManager=N.morphTargetManager),z.getPhysicsEngine){const q=z.getPhysicsEngine();if(R&&q)if(1===q.getPluginVersion()){const R=q.getImpostorForPhysicsObject(N);R&&(this.physicsImpostor=R.clone(this))}else 2===q.getPluginVersion()&&N.physicsBody&&N.physicsBody.clone(this)}for(let v=0;v<z.qj.length;v++){const q=z.qj[v];q.j===N&&q.clone(q.name,this)}this.skeleton=N.skeleton,this.refreshBoundingInfo(!0,!0),this.Oj(!0)}constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0,F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(N,q),this._internalMeshDataInfo=new s,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new c,this._thinInstanceDataStorage=new G,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=Z.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,q=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(N,q,R)=>{N&&R&&(this._uniformBuffer?this.transferToEffect(q):R.bindOnlyWorldMatrix(q))},v&&this._copySource(v,B,F),null!==R&&(this.parent=R),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=N=>{N.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new z.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),v&&v.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const z=0===this.getTotalVertices()||q&&q.doNotInstantiate&&(!0===q.doNotInstantiate||q.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),N||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));z.parent=N||this.parent,z.position=this.position.clone(),z.re=this.re.clone(),this.rotationQuaternion?z.rotationQuaternion=this.rotationQuaternion.clone():z.rotation=this.rotation.clone(),R&&R(this,z);for(const v of this.getChildTransformNodes(!0))"InstancedMesh"===v.getClassName()&&"Mesh"===z.getClassName()&&v.sourceMesh===this?v.instantiateHierarchy(z,{doNotInstantiate:q&&q.doNotInstantiate||!1,newSourcedMesh:z},R):v.instantiateHierarchy(z,q,R);return z}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(N){let q=super.toString(N);if(q+=", n vertices: "+this.getTotalVertices(),q+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let R=0;R<this.animations.length;R++)q+=", animation[0]: "+this.animations[R].toString(N);if(N)if(this._geometry){const N=this.gg(),R=this.getVerticesData(x.h.PositionKind);R&&N&&(q+=", flat shading: "+(R.length/3===N.length?"YES":"NO"))}else q+=", flat shading: UNKNOWN";return q}_unBindEffect(){super._unBindEffect();for(const N of this.instances)N._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const N=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((q,R)=>q.distanceOrScreenCoverage<R.distanceOrScreenCoverage?N:q.distanceOrScreenCoverage>R.distanceOrScreenCoverage?-N:0))}addLODLevel(N,q){if(q&&q._masterMesh)return L.c.Warn("You cannot use a mesh as LOD level twice"),this;const R=new u(N,q);return this._internalMeshDataInfo._LODLevels.push(R),q&&(q._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(N){const q=this._internalMeshDataInfo;for(let R=0;R<q._LODLevels.length;R++){const z=q._LODLevels[R];if(z.distanceOrScreenCoverage===N)return z.mesh}return null}removeLODLevel(N){const q=this._internalMeshDataInfo;for(let R=0;R<q._LODLevels.length;R++)q._LODLevels[R].mesh===N&&(q._LODLevels.splice(R,1),N&&(N._masterMesh=null));return this._sortLODLevels(),this}getLOD(N,q){const R=this._internalMeshDataInfo;if(!R._LODLevels||0===R._LODLevels.length)return this;const z=q||this.getBoundingInfo().boundingSphere,v=N.mode===A.e.ORTHOGRAPHIC_CAMERA?N.Wi:z.centerWorld.gd(N.globalPosition).length();let B=v,F=1;if(R._useLODScreenCoverage){const q=N.screenArea;let R=z.radiusWorld*N.Wi/v;R=R*R*Math.PI,B=R/q,F=-1}if(F*R._LODLevels[R._LODLevels.length-1].distanceOrScreenCoverage>F*B)return this.onLODLevelSelection&&this.onLODLevelSelection(B,this,this),this;for(let S=0;S<R._LODLevels.length;S++){const N=R._LODLevels[S];if(F*N.distanceOrScreenCoverage<F*B){if(N.mesh){if(4===N.mesh.delayLoadState)return N.mesh._checkDelayState(),this;if(2===N.mesh.delayLoadState)return this;N.mesh._preActivate(),N.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(B,this,N.mesh),N.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(B,this,this),this}get Dj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(N,q,R,z){var v,B;if(!this._geometry)return null;let F=z||null===(v=this._userInstancedBuffersStorage)||void 0===v||null===(B=v.vertexBuffers[N])||void 0===B?void 0:B.getFloatData(this.instances.length+1,R||q&&1!==this._geometry.meshes.length);return F||(F=this._geometry.getVerticesData(N,q,R)),F}copyVerticesData(N,q){this._geometry&&this._geometry.copyVerticesData(N,q)}getVertexBuffer(N,q){var R;return this._geometry?(q||null===(R=this._userInstancedBuffersStorage)||void 0===R?void 0:R.vertexBuffers[N])??this._geometry.getVertexBuffer(N):null}isVerticesDataPresent(N,q){var R;return this._geometry?!q&&void 0!==(null===(R=this._userInstancedBuffersStorage)||void 0===R?void 0:R.vertexBuffers[N])||this._geometry.isVerticesDataPresent(N):!!this._delayInfo&&-1!==this._delayInfo.indexOf(N)}isVertexBufferUpdatable(N,q){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(N);if(!q){var R;const q=null===(R=this._userInstancedBuffersStorage)||void 0===R?void 0:R.vertexBuffers[N];if(q)return q.isUpdatable()}return this._geometry.isVertexBufferUpdatable(N)}getVerticesDataKinds(N){if(!this._geometry){const N=[];return this._delayInfo&&this._delayInfo.forEach((function(q){N.push(q)})),N}const q=this._geometry.getVerticesDataKinds();if(!N&&this._userInstancedBuffersStorage)for(const R in this._userInstancedBuffersStorage.vertexBuffers)-1===q.indexOf(R)&&q.push(R);return q}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}gg(N,q){return this._geometry?this._geometry.gg(N,q):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(N))return!1;if(!this.lg||0===this.lg.length)return!0;if(!N)return!0;const R=this.getEngine(),z=this.va(),v=q||R.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Oj();const B=this.material||z.defaultMaterial;if(B)if(B._storeEffectOnSubMeshes)for(const x of this.lg){const N=x.Ha();if(N)if(N._storeEffectOnSubMeshes){if(!N.isReadyForSubMesh(this,x,v))return!1}else if(!N.isReady(this,v))return!1}else if(!B.isReady(this,v))return!1;const F=R.currentRenderPassId;for(const x of this.lightSources){const N=x.getShadowGenerators();if(!N)continue;const q=N.values();for(let z=q.next();!0!==z.done;z=q.next()){var S,A,y,E;const N=z.value;if(N&&(null===(S=N.getShadowMap())||void 0===S||!S.renderList||null!==(A=N.getShadowMap())&&void 0!==A&&A.renderList&&-1!==(null===(y=N.getShadowMap())||void 0===y||null===(E=y.renderList)||void 0===E?void 0:E.indexOf(this)))){const q=N.getShadowMap().renderPassIds??[R.currentRenderPassId];for(let z=0;z<q.length;++z){R.currentRenderPassId=q[z];for(const q of this.lg){var t;if(!N.isReady(q,v,(null===(t=q.Ha())||void 0===t?void 0:t.needAlphaBlendingForMesh(this))??!1))return R.currentRenderPassId=F,!1}}R.currentRenderPassId=F}}}for(const x of this._internalMeshDataInfo._LODLevels)if(x.mesh&&!x.mesh.isReady(v))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Oh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(N){this._instanceDataStorage.overridenInstanceCount=N}_preActivate(){const N=this._internalMeshDataInfo,q=this.va().getRenderId();return N._preActivateId===q||(N._preActivateId=q,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(N){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=N),this}_registerInstanceForRenderId(N,q){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:q,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[q]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=q,this._instanceDataStorage.visibleInstances[q]=new Array),this._instanceDataStorage.visibleInstances[q].push(N),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let N,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;N="object"===typeof q?q:{applySkeleton:q,applyMorph:R};const z=this.Dj?this.Dj.boundingBias:null;return this.Fa(this._getData(N,null,x.h.PositionKind),z),this}_createGlobalSubMesh(N){const q=this.getTotalVertices();if(!q||!this.gg())return null;if(this.lg&&this.lg.length>0){const R=this.gg();if(!R)return null;const z=R.length;let v=!1;if(N)v=!0;else for(const N of this.lg){if(N.indexStart+N.indexCount>z){v=!0;break}if(N.verticesStart+N.verticesCount>q){v=!0;break}}if(!v)return this.lg[0]}return this.releaseSubMeshes(),new D.e(0,0,q,0,this.getTotalIndices(),this)}subdivide(N){if(N<1)return;const q=this.getTotalIndices();let R=q/N|0,z=0;for(;R%3!==0;)R++;this.releaseSubMeshes();for(let v=0;v<N&&!(z>=q);v++)D.e.CreateFromIndices(0,z,v===N-1?q-z:R,this,void 0,!1),z+=R;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(N,q,R,z);else{const z=new e.e;z.set(q,N);const v=this.va();new b.b(b.b.RandomId(),v,z,R,this)}return this}removeVerticesData(N){this._geometry&&this._geometry.removeVerticesData(N)}markVerticesDataAsUpdatable(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=this.getVertexBuffer(N);R&&R.isUpdatable()!==q&&this.Ga(N,this.getVerticesData(N),q)}setVerticesBuffer(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=b.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(N,null,q),this}updateVerticesData(N,q,R,z){return this._geometry?(z?(this.makeGeometryUnique(),this.updateVerticesData(N,q,R,!1)):this._geometry.updateVerticesData(N,q,R),this):this}updateMeshPositions(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=this.getVerticesData(x.h.PositionKind);if(!R)return this;if(N(R),this.updateVerticesData(x.h.PositionKind,R,!1,!1),q){const N=this.gg(),q=this.getVerticesData(x.h.NormalKind);if(!q)return this;e.e.ComputeNormals(R,N,q),this.updateVerticesData(x.h.NormalKind,q,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const N=this._geometry,q=this._geometry.i(b.b.RandomId());return N.releaseForMesh(this,!0),q.Ca(this),this}setIndexBuffer(N,q,R){let z=this._geometry;z||(z=new b.b(b.b.RandomId(),this.va(),void 0,void 0,this)),z.setIndexBuffer(N,q,R)}setIndices(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(N,q,R,z);else{const q=new e.e;q.indices=N;const z=this.va();new b.b(b.b.RandomId(),z,q,R,this)}return this}updateIndices(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(N,q,R),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(N,q,R){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const v=this.va().getEngine();let B;if(this._unIndexed)if(this._getRenderingFillMode(R)===V.d.WireFrameFillMode)B=N._getLinesIndexBuffer(this.gg(),v);else B=null;else switch(this._getRenderingFillMode(R)){case V.d.PointFillMode:B=null;break;case V.d.WireFrameFillMode:B=N._getLinesIndexBuffer(this.gg(),v);break;default:case V.d.TriangleFillMode:B=this._geometry.getIndexBuffer()}return this._bindDirect(q,B,z)}_bindDirect(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(N),R&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(N,q,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(N,q),this):this}_draw(N,q,R){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const z=this.va().getEngine();return this._unIndexed&&q!==V.d.WireFrameFillMode||q==V.d.PointFillMode?z.drawArraysType(q,N.verticesStart,N.verticesCount,this.forcedInstanceCount||R):q==V.d.WireFrameFillMode?z.drawElementsType(q,0,N._linesIndexCount,this.forcedInstanceCount||R):z.drawElementsType(q,N.indexStart,N.indexCount,this.forcedInstanceCount||R),this}registerBeforeRender(N){return this.onBeforeRenderObservable.add(N),this}unregisterBeforeRender(N){return this.onBeforeRenderObservable.removeCallback(N),this}registerAfterRender(N){return this.onAfterRenderObservable.add(N),this}unregisterAfterRender(N){return this.onAfterRenderObservable.removeCallback(N),this}_getInstancesRenderList(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(q)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[N]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[N]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const R=this.va(),z=R._isInIntermediateRendering(),v=z?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,B=this._instanceDataStorage.batchCache;if(B.mustReturn=!1,B.renderSelf[N]=q||!v&&this.isEnabled()&&this.isVisible,B.visibleInstances[N]=null,this._instanceDataStorage.visibleInstances&&!q){const q=this._instanceDataStorage.visibleInstances,v=R.getRenderId(),F=z?q.intermediateDefaultRenderId:q.defaultRenderId;B.visibleInstances[N]=q[v],!B.visibleInstances[N]&&F&&(B.visibleInstances[N]=q[F])}return B.hardwareInstancedRendering[N]=!q&&this._instanceDataStorage.hardwareInstancedRendering&&null!==B.visibleInstances[N]&&void 0!==B.visibleInstances[N],this._instanceDataStorage.previousBatch=B,B}_renderWithInstances(N,q,R,z,v){const B=R.visibleInstances[N._id],F=B?B.length:0,S=this._instanceDataStorage,A=S.instancesBufferSize;let E=S.instancesBuffer,t=S.instancesPreviousBuffer;const e=16*(F+1)*4;for(;S.instancesBufferSize<e;)S.instancesBufferSize*=2;S.instancesData&&A==S.instancesBufferSize||(S.instancesData=new Float32Array(S.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!S.instancesPreviousData||A!=S.instancesBufferSize)&&(S.instancesPreviousData=new Float32Array(S.instancesBufferSize/4));let b=0,f=0;const D=R.renderSelf[N._id],V=!E||A!==S.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!S.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||S.isFrozen&&!V)f=(D?1:0)+F;else{const q=this.getWorldMatrix();if(D&&(this._scene.needsPreviousWorldMatrices&&(S.masterMeshPreviousWorldMatrix?(S.masterMeshPreviousWorldMatrix.copyToArray(S.instancesPreviousData,b),S.masterMeshPreviousWorldMatrix.p(q)):(S.masterMeshPreviousWorldMatrix=q.clone(),S.masterMeshPreviousWorldMatrix.copyToArray(S.instancesPreviousData,b))),q.copyToArray(S.instancesData,b),b+=16,f++),B){var H;if(Z.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(H=N.Ha())&&void 0!==H&&H.needAlphaBlendingForMesh(N.getRenderingMesh())){const N=this._scene.activeCamera.globalPosition;for(let q=0;q<B.length;q++){const R=B[q];R._distanceToCamera=y.m.Distance(R.getBoundingInfo().boundingSphere.centerWorld,N)}B.sort(((N,q)=>N._distanceToCamera>q._distanceToCamera?-1:N._distanceToCamera<q._distanceToCamera?1:0))}for(let N=0;N<B.length;N++){const q=B[N],R=q.getWorldMatrix();R.copyToArray(S.instancesData,b),this._scene.needsPreviousWorldMatrices&&(q._previousWorldMatrix?(q._previousWorldMatrix.copyToArray(S.instancesPreviousData,b),q._previousWorldMatrix.p(R)):(q._previousWorldMatrix=R.clone(),q._previousWorldMatrix.copyToArray(S.instancesPreviousData,b))),b+=16,f++}}}return V?(E&&E.dispose(),t&&t.dispose(),E=new x.e(v,S.instancesData,!0,16,!1,!0),S.instancesBuffer=E,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=E.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=E.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=E.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=E.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(t=new x.e(v,S.instancesPreviousData,!0,16,!1,!0),S.instancesPreviousBuffer=t,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=t.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=t.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=t.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=t.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(E.updateDirectly(S.instancesData,0,f),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||t.updateDirectly(S.instancesPreviousData,0,f)),this._processInstancedBuffers(B,D),this.va()._activeIndices.addCount(N.indexCount*f,!1),v._currentDrawContext&&(v._currentDrawContext.useInstancing=!0),this._bind(N,z,q),this._draw(N,q,f),!this._scene.needsPreviousWorldMatrices||V||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||t.updateDirectly(S.instancesData,0,f),v.unbindInstanceAttributes(),this}_renderWithThinInstances(N,q,R,z){var v;const B=(null===(v=this._thinInstanceDataStorage)||void 0===v?void 0:v.instancesCount)??0;this.va()._activeIndices.addCount(N.indexCount*B,!1),z._currentDrawContext&&(z._currentDrawContext.useInstancing=!0),this._bind(N,R,q),this._draw(N,q,B),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,B):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),z.unbindInstanceAttributes()}_processInstancedBuffers(N,q){}_processRendering(N,q,R,z,v,B,F,S){const A=this.va(),y=A.getEngine();if(z=this._getRenderingFillMode(z),B&&q.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(q,z,R,y),this;if(B)this._renderWithInstances(q,z,v,R,y);else{y._currentDrawContext&&(y._currentDrawContext.useInstancing=!1);let R=0;v.renderSelf[q._id]&&(F&&F(!1,N.getWorldMatrix(),S),R++,this._draw(q,z,this._instanceDataStorage.overridenInstanceCount));const B=v.visibleInstances[q._id];if(B){const N=B.length;R+=N;for(let R=0;R<N;R++){const N=B[R].getWorldMatrix();F&&F(!0,N,S),this._draw(q,z)}}A._activeIndices.addCount(q.indexCount*R,!1)}return this}_rebuild(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(N&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const q in this._userInstancedBuffersStorage.vertexBuffers){const R=this._userInstancedBuffersStorage.vertexBuffers[q];R&&(N&&R.dispose(),this._userInstancedBuffersStorage.vertexBuffers[q]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(N)}_freeze(){if(this.lg){for(let N=0;N<this.lg.length;N++)this._getInstancesRenderList(N);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(N,q,R,z){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const B=this._scene.getEngine(),F=B.currentRenderPassId;if(void 0!==N&&(B.currentRenderPassId=N),z)(!v||v&&z.isInFrustum(this._scene._frustumPlanes))&&this.render(z,!!q,R);else for(let S=0;S<this.lg.length;S++){const N=this.lg[S];(!v||v&&N.isInFrustum(this._scene._frustumPlanes))&&this.render(N,!!q,R)}return void 0!==N&&(B.currentRenderPassId=F),this}directRender(){if(!this.lg)return this;for(const N of this.lg)this.render(N,!1);return this}render(N,q,R){var z,v,B;const F=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const S=(null===(z=F.activeCameras)||void 0===z?void 0:z.length)??0;if((S>1&&F.activeCamera===F.activeCameras[0]||S<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const A=this._getInstancesRenderList(N._id,!!R);if(A.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const y=F.getEngine();let E=0,t=null;this.ignoreCameraMaxZ&&F.activeCamera&&!F._isInIntermediateRendering()&&(E=F.activeCamera.maxZ,t=F.activeCamera,F.activeCamera.maxZ=0,F.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const x=N.getRenderingMesh(),e=A.hardwareInstancedRendering[N._id]||x.hasThinInstances||!!this._userInstancedBuffersStorage&&!N.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,b=this._instanceDataStorage,f=N.Ha();if(!f)return t&&(t.maxZ=E,F.updateTransformMatrix(!0)),this;if(b.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===f){if(f._storeEffectOnSubMeshes&&(null===(v=N._drawWrapper)||void 0===v||!v._wasPreviouslyReady)||!f._storeEffectOnSubMeshes&&!f._getDrawWrapper()._wasPreviouslyReady)return t&&(t.maxZ=E,F.updateTransformMatrix(!0)),this}else{if(f._storeEffectOnSubMeshes){if(!f.isReadyForSubMesh(this,N,e))return t&&(t.maxZ=E,F.updateTransformMatrix(!0)),this}else if(!f.isReady(this,e))return t&&(t.maxZ=E,F.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=f}let D;q&&y.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),D=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?N._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const H=(null===(B=D)||void 0===B?void 0:B.effect)??null;for(const V of F._beforeRenderingMeshStage)V.action(this,N,A,H);if(!D||!H)return t&&(t.maxZ=E,F.updateTransformMatrix(!0)),this;const Y=R||this;let T;if(b.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.hh&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)T=b.sideOrientation;else{const N=Y._getWorldMatrixDeterminant();T=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),N<0&&(T=T===V.d.ClockWiseSideOrientation?V.d.CounterClockWiseSideOrientation:V.d.ClockWiseSideOrientation),b.sideOrientation=T}const L=this._internalMeshDataInfo._effectiveMaterial._preBind(D,T);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&y.setDepthWrite(!0);const X=this._internalMeshDataInfo._effectiveMaterial,Q=X.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),e||this._bind(N,H,Q,!1);const h=Y.getWorldMatrix();X._storeEffectOnSubMeshes?X.bindForSubMesh(h,this,N):X.bind(h,this),!X.hh&&X.separateCullingPass&&(y.setState(!0,X.zOffset,!1,!L,X.cullBackFaces,X.stencil,X.zOffsetUnits),this._processRendering(this,N,H,Q,A,e,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),y.setState(!0,X.zOffset,!1,L,X.cullBackFaces,X.stencil,X.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(N)),this._processRendering(this,N,H,Q,A,e,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const V of F._afterRenderingMeshStage)V.action(this,N,A,H);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),t&&(t.maxZ=E,F.updateTransformMatrix(!0)),2!==F.performancePriority||b.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(x.h.MatricesWeightsKind)&&(this.isVerticesDataPresent(x.h.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const N=this.getVerticesData(x.h.MatricesWeightsKind),q=N.length;for(let R=0;R<q;R+=4){const q=N[R]+N[R+1]+N[R+2]+N[R+3];if(0===q)N[R]=1;else{const z=1/q;N[R]*=z,N[R+1]*=z,N[R+2]*=z,N[R+3]*=z}}this.Ga(x.h.MatricesWeightsKind,N)}_normalizeSkinWeightsAndExtra(){const N=this.getVerticesData(x.h.MatricesWeightsExtraKind),q=this.getVerticesData(x.h.MatricesWeightsKind),R=q.length;for(let z=0;z<R;z+=4){let R=q[z]+q[z+1]+q[z+2]+q[z+3];if(R+=N[z]+N[z+1]+N[z+2]+N[z+3],0===R)q[z]=1;else{const v=1/R;q[z]*=v,q[z+1]*=v,q[z+2]*=v,q[z+3]*=v,N[z]*=v,N[z+1]*=v,N[z+2]*=v,N[z+3]*=v}}this.Ga(x.h.MatricesWeightsKind,q),this.Ga(x.h.MatricesWeightsKind,N)}validateSkinning(){const N=this.getVerticesData(x.h.MatricesWeightsExtraKind),q=this.getVerticesData(x.h.MatricesWeightsKind);if(null===q||null==this.skeleton)return{skinned:!1,valid:!0,jm:"not skinned"};const R=q.length;let z=0,v=0,B=0,F=0;const S=null===N?4:8,A=[];for(let x=0;x<=S;x++)A[x]=0;for(let x=0;x<R;x+=4){let R=q[x],y=R,E=0===y?0:1;for(let v=1;v<S;v++){const B=v<4?q[x+v]:N[x+v-4];B>R&&z++,0!==B&&E++,y+=B,R=B}if(A[E]++,E>B&&(B=E),0===y)v++;else{const R=1/y;let z=0;for(let v=0;v<S;v++)z+=v<4?Math.abs(q[x+v]-q[x+v]*R):Math.abs(N[x+v-4]-N[x+v-4]*R);z>.001&&F++}}const y=this.skeleton.bones.length,E=this.getVerticesData(x.h.MatricesIndicesKind),t=this.getVerticesData(x.h.MatricesIndicesExtraKind);let e=0;for(let x=0;x<R;x+=4)for(let N=0;N<S;N++){const q=N<4?E[x+N]:t[x+N-4];(q>=y||q<0)&&e++}return{skinned:!0,valid:0===v&&0===F&&0===e,jm:"Number of Weights = "+R/4+"\nMaximum influences = "+B+"\nMissing Weights = "+v+"\nNot Sorted = "+z+"\nNot Normalized = "+F+"\nWeightCounts = ["+A+"]\nNumber of bones = "+y+"\nBad Bone Indices = "+e}}_checkDelayState(){const N=this.va();return this._geometry?this._geometry.load(N):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(N)),this}_queueLoad(N){N.addPendingData(this);const q=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return v.f.LoadFile(this.delayLoadingFile,(q=>{q instanceof ArrayBuffer?this._delayLoadingFunction(q,this):this._delayLoadingFunction(JSON.parse(q),this),this.instances.forEach((N=>{N.refreshBoundingInfo(),N._syncSubMeshes()})),this.delayLoadState=1,N.removePendingData(this)}),(()=>{}),N.offlineProvider,q),this}isInFrustum(N){return 2!==this.delayLoadState&&(!!super.isInFrustum(N)&&(this._checkDelayState(),!0))}setMaterialById(N){const q=this.va().materials;let R;for(R=q.length-1;R>-1;R--)if(q[R].id===N)return this.material=q[R],this;const z=this.va().multiMaterials;for(R=z.length-1;R>-1;R--)if(z[R].id===N)return this.material=z[R],this;return this}getAnimatables(){const N=[];return this.material&&N.push(this.material),this.skeleton&&N.push(this.skeleton),N}bakeTransformIntoVertices(N){if(!this.isVerticesDataPresent(x.h.PositionKind))return this;const q=this.lg.splice(0);this._resetPointsArrayCache();let R=this.getVerticesData(x.h.PositionKind);const z=y.m.Zero();let v;for(v=0;v<R.length;v+=3)y.m.TransformCoordinatesFromFloatsToRef(R[v],R[v+1],R[v+2],N,z).toArray(R,v);if(this.Ga(x.h.PositionKind,R,this.getVertexBuffer(x.h.PositionKind).isUpdatable()),this.isVerticesDataPresent(x.h.NormalKind)){for(R=this.getVerticesData(x.h.NormalKind),v=0;v<R.length;v+=3)y.m.TransformNormalFromFloatsToRef(R[v],R[v+1],R[v+2],N,z).normalize().toArray(R,v);this.Ga(x.h.NormalKind,R,this.getVertexBuffer(x.h.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(x.h.TangentKind)){for(R=this.getVerticesData(x.h.TangentKind),v=0;v<R.length;v+=4)y.m.TransformNormalFromFloatsToRef(R[v],R[v+1],R[v+2],N,z).normalize().toArray(R,v);this.Ga(x.h.TangentKind,R,this.getVertexBuffer(x.h.TangentKind).isUpdatable())}return N.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.lg=q,this}bakeCurrentTransformIntoVertices(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Oj(!0)),this.resetLocalMatrix(N),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),N,this,q,R)}dispose(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const R=this._internalMeshDataInfo;if(R._onBeforeDrawObservable&&R._onBeforeDrawObservable.clear(),R._onBeforeBindObservable&&R._onBeforeBindObservable.clear(),R._onBeforeRenderObservable&&R._onBeforeRenderObservable.clear(),R._onAfterRenderObservable&&R._onAfterRenderObservable.clear(),R._onBetweenPassObservable&&R._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(R.meshMap)for(const N in R.meshMap){const q=R.meshMap[N];q&&(q._internalMeshDataInfo._source=null,R.meshMap[N]=void 0)}R._source&&R._source._internalMeshDataInfo.meshMap&&(R._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const N=this.va().meshes;for(const q of N){const N=q;N._internalMeshDataInfo&&N._internalMeshDataInfo._source&&N._internalMeshDataInfo._source===this&&(N._internalMeshDataInfo._source=null)}}R._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(N,q)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(N,q,R,z,B,F){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7?arguments[7]:void 0;const y=this.va();return v.f.LoadImage(N,(N=>{const v=N.width,A=N.height,y=this.getEngine().createCanvas(v,A).getContext("2d");y.drawImage(N,0,0);const E=y.getImageData(0,0,v,A).data;this.applyDisplacementMapFromBuffer(E,v,A,q,R,B,F,S),z&&z(this)}),A||(()=>{}),y.offlineProvider),this}applyDisplacementMapFromBuffer(N,q,R,z,v,B,F){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(x.h.PositionKind)||!this.isVerticesDataPresent(x.h.NormalKind)||!this.isVerticesDataPresent(x.h.UVKind))return L.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const A=this.getVerticesData(x.h.PositionKind,!0,!0),E=this.getVerticesData(x.h.NormalKind),t=this.getVerticesData(x.h.UVKind);let b=y.m.Zero();const f=y.m.Zero(),D=y.l.Zero();B=B||y.l.Zero(),F=F||new y.l(1,1);for(let x=0;x<A.length;x+=3){y.m.FromArrayToRef(A,x,b),y.m.FromArrayToRef(E,x,f),y.l.FromArrayToRef(t,x/3*2,D);const S=4*((Math.abs(D.x*F.x+B.x%1)*(q-1)%q|0)+(Math.abs(D.y*F.y+B.y%1)*(R-1)%R|0)*q),e=.3*(N[S]/255)+.59*(N[S+1]/255)+.11*(N[S+2]/255);f.normalize(),f.scaleInPlace(z+(v-z)*e),b=b.add(f),b.toArray(A,x)}return e.e.ComputeNormals(A,this.gg(),E),S?(this.Ga(x.h.PositionKind,A),this.Ga(x.h.NormalKind,E),this.Ga(x.h.UVKind,t)):(this.updateVerticesData(x.h.PositionKind,A),this.updateVerticesData(x.h.NormalKind,E)),this}_getFlattenedNormals(N,q){const R=new Float32Array(3*N.length);let z=0;const v=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let B=0;B<N.length;B+=3){const F=y.m.Zg(q,3*N[B]),S=y.m.Zg(q,3*N[B+1]),A=y.m.Zg(q,3*N[B+2]),E=F.gd(S),t=A.gd(S),x=y.m.Normalize(y.m.Cross(E,t));v&&x.scaleInPlace(-1);for(let N=0;N<3;N++)R[z++]=x.x,R[z++]=x.y,R[z++]=x.z}return R}_convertToUnIndexedMesh(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this.getVerticesDataKinds().filter((N=>{var q;return!(null!==(q=this.getVertexBuffer(N))&&void 0!==q&&q.getIsInstanced())})),R=this.gg(),z={},v=(N,q)=>{const z=new Float32Array(R.length*q);let v=0;for(let B=0;B<R.length;B++)for(let F=0;F<q;F++)z[v++]=N[R[B]*q+F];return z},B=this.getBoundingInfo(),F=this.Dj?this.lg.slice(0):[];for(const S of q)z[S]=this.getVerticesData(S);for(const S of q){const q=this.getVertexBuffer(S),B=q.getSize();if(N&&S===x.h.NormalKind){const N=this._getFlattenedNormals(R,z[x.h.PositionKind]);this.Ga(x.h.NormalKind,N,q.isUpdatable(),B)}else this.Ga(S,v(z[S],B),q.isUpdatable(),B)}if(this.morphTargetManager){for(let q=0;q<this.morphTargetManager.numTargets;q++){const z=this.morphTargetManager.getTarget(q),B=z.getPositions();z.setPositions(v(B,3));const F=z.getNormals();F&&z.setNormals(N?this._getFlattenedNormals(R,B):v(F,3));const S=z.getTangents();S&&z.setTangents(v(S,3));const A=z.getUVs();A&&z.setUVs(v(A,2))}this.morphTargetManager.synchronize()}for(let S=0;S<R.length;S++)R[S]=S;this.setIndices(R),this._unIndexed=!0,this.releaseSubMeshes();for(const S of F){const N=S.getBoundingInfo();D.e.AddToMesh(S.materialIndex,S.indexStart,S.indexCount,S.indexStart,S.indexCount,this).setBoundingInfo(N)}return this.setBoundingInfo(B),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=e.e.ExtractFromMesh(this);let R;if(N&&this.isVerticesDataPresent(x.h.NormalKind)&&q.ya){for(R=0;R<q.ya.length;R++)q.ya[R]*=-1;this.Ga(x.h.NormalKind,q.ya,this.isVertexBufferUpdatable(x.h.NormalKind))}if(q.indices){let N;for(R=0;R<q.indices.length;R+=3)N=q.indices[R+1],q.indices[R+1]=q.indices[R+2],q.indices[R+2]=N;this.setIndices(q.indices,null,this.isVertexBufferUpdatable(x.h.PositionKind),!0)}return this}increaseVertices(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const q=e.e.ExtractFromMesh(this),R=q.indices&&!Array.isArray(q.indices)&&Array.from?Array.from(q.indices):q.indices,z=q.xa&&!Array.isArray(q.xa)&&Array.from?Array.from(q.xa):q.xa,v=q.Aa&&!Array.isArray(q.Aa)&&Array.from?Array.from(q.Aa):q.Aa,B=q.ya&&!Array.isArray(q.ya)&&Array.from?Array.from(q.ya):q.ya;if(R&&z){q.indices=R,q.xa=z,v&&(q.Aa=v),B&&(q.ya=B);const F=N+1,S=new Array;for(let N=0;N<F+1;N++)S[N]=new Array;let A,E;const t=new y.m(0,0,0),e=new y.m(0,0,0),b=new y.l(0,0),f=new Array,D=new Array,V=new Array;let H,Y,T,L=z.length;v&&(Y=v.length),B&&(T=B.length);for(let N=0;N<R.length;N+=3){D[0]=R[N],D[1]=R[N+1],D[2]=R[N+2];for(let N=0;N<3;N++)if(A=D[N],E=D[(N+1)%3],void 0===V[A]&&void 0===V[E]?(V[A]=new Array,V[E]=new Array):(void 0===V[A]&&(V[A]=new Array),void 0===V[E]&&(V[E]=new Array)),void 0===V[A][E]&&void 0===V[E][A]){V[A][E]=[],t.x=(z[3*E]-z[3*A])/F,t.y=(z[3*E+1]-z[3*A+1])/F,t.z=(z[3*E+2]-z[3*A+2])/F,B&&(e.x=(B[3*E]-B[3*A])/F,e.y=(B[3*E+1]-B[3*A+1])/F,e.z=(B[3*E+2]-B[3*A+2])/F),v&&(b.x=(v[2*E]-v[2*A])/F,b.y=(v[2*E+1]-v[2*A+1])/F),V[A][E].push(A);for(let N=1;N<F;N++)V[A][E].push(z.length/3),z[L++]=z[3*A]+N*t.x,z[L++]=z[3*A+1]+N*t.y,z[L++]=z[3*A+2]+N*t.z,B&&(B[T++]=B[3*A]+N*e.x,B[T++]=B[3*A+1]+N*e.y,B[T++]=B[3*A+2]+N*e.z),v&&(v[Y++]=v[2*A]+N*b.x,v[Y++]=v[2*A+1]+N*b.y);V[A][E].push(E),V[E][A]=new Array,H=V[A][E].length;for(let N=0;N<H;N++)V[E][A][N]=V[A][E][H-1-N]}S[0][0]=R[N],S[1][0]=V[R[N]][R[N+1]][1],S[1][1]=V[R[N]][R[N+2]][1];for(let q=2;q<F;q++){S[q][0]=V[R[N]][R[N+1]][q],S[q][q]=V[R[N]][R[N+2]][q],t.x=(z[3*S[q][q]]-z[3*S[q][0]])/q,t.y=(z[3*S[q][q]+1]-z[3*S[q][0]+1])/q,t.z=(z[3*S[q][q]+2]-z[3*S[q][0]+2])/q,B&&(e.x=(B[3*S[q][q]]-B[3*S[q][0]])/q,e.y=(B[3*S[q][q]+1]-B[3*S[q][0]+1])/q,e.z=(B[3*S[q][q]+2]-B[3*S[q][0]+2])/q),v&&(b.x=(v[2*S[q][q]]-v[2*S[q][0]])/q,b.y=(v[2*S[q][q]+1]-v[2*S[q][0]+1])/q);for(let N=1;N<q;N++)S[q][N]=z.length/3,z[L++]=z[3*S[q][0]]+N*t.x,z[L++]=z[3*S[q][0]+1]+N*t.y,z[L++]=z[3*S[q][0]+2]+N*t.z,B&&(B[T++]=B[3*S[q][0]]+N*e.x,B[T++]=B[3*S[q][0]+1]+N*e.y,B[T++]=B[3*S[q][0]+2]+N*e.z),v&&(v[Y++]=v[2*S[q][0]]+N*b.x,v[Y++]=v[2*S[q][0]+1]+N*b.y)}S[F]=V[R[N+1]][R[N+2]],f.push(S[0][0],S[1][0],S[1][1]);for(let N=1;N<F;N++){let q;for(q=0;q<N;q++)f.push(S[N][q],S[N+1][q],S[N+1][q+1]),f.push(S[N][q],S[N+1][q+1],S[N][q+1]);f.push(S[N][q],S[N+1][q],S[N+1][q+1])}}q.indices=f,q.Ca(this,this.isVertexBufferUpdatable(x.h.PositionKind))}else L.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const N=e.e.ExtractFromMesh(this),q=N.Aa,R=N.indices,z=N.xa,v=N.za,B=N.matricesIndices,F=N.matricesWeights,S=N.matricesIndicesExtra,A=N.matricesWeightsExtra;if(void 0===R||void 0===z||null===R||null===z)L.c.Warn("VertexData contains empty entries");else{const y=new Array,E=new Array,t=new Array,b=new Array,f=new Array,D=new Array,V=new Array,H=new Array;let Y=new Array,T=0;const L={};let X,Q;for(let N=0;N<R.length;N+=3){Q=[R[N],R[N+1],R[N+2]],Y=[];for(let N=0;N<3;N++){Y[N]="";for(let q=0;q<3;q++)Math.abs(z[3*Q[N]+q])<1e-8&&(z[3*Q[N]+q]=0),Y[N]+=z[3*Q[N]+q]+"|"}if(Y[0]!=Y[1]&&Y[0]!=Y[2]&&Y[1]!=Y[2])for(let N=0;N<3;N++){if(X=L[Y[N]],void 0===X){L[Y[N]]=T,X=T++;for(let q=0;q<3;q++)y.push(z[3*Q[N]+q]);if(null!==v&&void 0!==v)for(let q=0;q<4;q++)b.push(v[4*Q[N]+q]);if(null!==q&&void 0!==q)for(let R=0;R<2;R++)t.push(q[2*Q[N]+R]);if(null!==B&&void 0!==B)for(let q=0;q<4;q++)f.push(B[4*Q[N]+q]);if(null!==F&&void 0!==F)for(let q=0;q<4;q++)D.push(F[4*Q[N]+q]);if(null!==S&&void 0!==S)for(let q=0;q<4;q++)V.push(S[4*Q[N]+q]);if(null!==A&&void 0!==A)for(let q=0;q<4;q++)H.push(A[4*Q[N]+q])}E.push(X)}}const h=new Array;e.e.ComputeNormals(y,E,h),N.xa=y,N.indices=E,N.ya=h,null!==q&&void 0!==q&&(N.Aa=t),null!==v&&void 0!==v&&(N.za=b),null!==B&&void 0!==B&&(N.matricesIndices=f),null!==F&&void 0!==F&&(N.matricesWeights=D),null!==S&&void 0!==S&&(N.matricesIndicesExtra=V),null!==F&&void 0!==F&&(N.matricesWeightsExtra=H),N.Ca(this,this.isVertexBufferUpdatable(x.h.PositionKind))}}static _instancedMeshFactory(N,q){throw(0,Q.b)("InstancedMesh")}static _PhysicsImpostorParser(N,q,R){throw(0,Q.b)("PhysicsImpostor")}createInstance(N){const q=Z._instancedMeshFactory(N,this);return q.parent=this.parent,q}synchronizeInstances(){for(let N=0;N<this.instances.length;N++){this.instances[N]._syncSubMeshes()}return this}optimizeIndices(N){const q=this.gg(),R=this.getVerticesData(x.h.PositionKind);if(!R||!q)return this;const z=[];for(let v=0;v<R.length;v+=3)z.push(y.m.Zg(R,v));const B=[];return v.b.SyncAsyncForLoop(z.length,40,(N=>{const q=z.length-1-N,R=z[q];for(let v=0;v<q;++v){const N=z[v];if(R.equals(N)){B[q]=v;break}}}),(()=>{for(let N=0;N<q.length;++N)q[N]=B[q[N]]||q[N];const R=this.lg.slice(0);this.setIndices(q),this.lg=R,N&&N(this)})),this}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.name=this.name,N.id=this.id,N.uniqueId=this.uniqueId,N.type=this.getClassName(),F.b&&F.b.HasTags(this)&&(N.tags=F.b.GetTags(this)),N.position=this.position.ij(),this.rotationQuaternion?N.rotationQuaternion=this.rotationQuaternion.ij():this.rotation&&(N.rotation=this.rotation.ij()),N.re=this.re.ij(),this._postMultiplyPivotMatrix?N.pivotMatrix=this.getPivotMatrix().ij():N.localMatrix=this.getPivotMatrix().ij(),N.isEnabled=this.isEnabled(!1),N.isVisible=this.isVisible,N.infiniteDistance=this.infiniteDistance,N.pickable=this.Ub,N.receiveShadows=this.receiveShadows,N.billboardMode=this.billboardMode,N.visibility=this.visibility,N.Sb=this.Sb,N.checkCollisions=this.checkCollisions,N.ellipsoid=this.ellipsoid.ij(),N.ellipsoidOffset=this.ellipsoidOffset.ij(),N.Da=this.Da,N.isBlocker=this.isBlocker,N.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(N),N.isUnIndexed=this.isUnIndexed;const q=this._geometry;if(q&&this.lg){N.geometryUniqueId=q.uniqueId,N.geometryId=q.id,N.lg=[];for(let q=0;q<this.lg.length;q++){const R=this.lg[q];N.lg.push({materialIndex:R.materialIndex,verticesStart:R.verticesStart,verticesCount:R.verticesCount,indexStart:R.indexStart,indexCount:R.indexCount})}}if(this.material?this.material.doNotSerialize||(N.materialUniqueId=this.material.uniqueId,N.materialId=this.material.id):(this.material=null,N.materialUniqueId=this._scene.defaultMaterial.uniqueId,N.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(N.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(N.skeletonId=this.skeleton.id,N.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(h.c.NAME_PHYSICSENGINE)){const q=this.getPhysicsImpostor();q&&(N.physicsMass=q.getParam("mass"),N.physicsFriction=q.getParam("friction"),N.physicsRestitution=q.getParam("mass"),N.physicsImpostor=q.type)}this.metadata&&(N.metadata=this.metadata),N.instances=[];for(let R=0;R<this.instances.length;R++){const q=this.instances[R];if(q.doNotSerialize)continue;const z={name:q.name,id:q.id,isEnabled:q.isEnabled(!1),isVisible:q.isVisible,Ub:q.Ub,checkCollisions:q.checkCollisions,position:q.position.ij(),re:q.re.ij()};if(q.parent&&q.parent._serializeAsParent(z),q.rotationQuaternion?z.rotationQuaternion=q.rotationQuaternion.ij():q.rotation&&(z.rotation=q.rotation.ij()),this.va()._getComponent(h.c.NAME_PHYSICSENGINE)){const N=q.getPhysicsImpostor();N&&(z.physicsMass=N.getParam("mass"),z.physicsFriction=N.getParam("friction"),z.physicsRestitution=N.getParam("mass"),z.physicsImpostor=N.type)}q.metadata&&(z.metadata=q.metadata),q.actionManager&&(z.actions=q.actionManager.serialize(q.name)),N.instances.push(z),T.e.AppendSerializedAnimations(q,z),z.ranges=q.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(N.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const q={data:{},sizes:{},strides:{}};for(const N in this._userThinInstanceBuffersStorage.data)q.data[N]=Array.from(this._userThinInstanceBuffersStorage.data[N]),q.sizes[N]=this._userThinInstanceBuffersStorage.sizes[N],q.strides[N]=this._userThinInstanceBuffersStorage.strides[N];N.thinInstances.userThinInstance=q}return T.e.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N.layerMask=this.layerMask,N.alphaIndex=this.alphaIndex,N.hasVertexAlpha=this.hasVertexAlpha,N.overlayAlpha=this.overlayAlpha,N.overlayColor=this.overlayColor.ij(),N.renderOverlay=this.renderOverlay,N.applyFog=this.applyFog,this.actionManager&&(N.actions=this.actionManager.serialize(this.name)),N}_syncGeometryWithMorphTargetManager(){if(!this.Dj)return;this._markSubMeshesAsAttributesDirty();const N=this._internalAbstractMeshDataInfo._morphTargetManager;if(N&&N.vertexCount){if(N.vertexCount!==this.getTotalVertices())return L.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(N.isUsingTextureForTargets)return;for(let q=0;q<N.numInfluencers;q++){const R=N.getActiveTarget(q),z=R.getPositions();if(!z)return void L.c.Error("Invalid morph target. Target must have positions.");this.Dj.Ga(x.h.PositionKind+q,z,!1,3);const v=R.getNormals();v&&this.Dj.Ga(x.h.NormalKind+q,v,!1,3);const B=R.getTangents();B&&this.Dj.Ga(x.h.TangentKind+q,B,!1,3);const F=R.getUVs();F&&this.Dj.Ga(x.h.UVKind+"_"+q,F,!1,2)}}else{let N=0;for(;this.Dj.isVerticesDataPresent(x.h.PositionKind+N);)this.Dj.removeVerticesData(x.h.PositionKind+N),this.Dj.isVerticesDataPresent(x.h.NormalKind+N)&&this.Dj.removeVerticesData(x.h.NormalKind+N),this.Dj.isVerticesDataPresent(x.h.TangentKind+N)&&this.Dj.removeVerticesData(x.h.TangentKind+N),this.Dj.isVerticesDataPresent(x.h.UVKind+N)&&this.Dj.removeVerticesData(x.h.UVKind+"_"+N),N++}}static Parse(N,q,R){let z;if(z=N.type&&"LinesMesh"===N.type?Z._LinesMeshParser(N,q):N.type&&"GroundMesh"===N.type?Z._GroundMeshParser(N,q):N.type&&"GoldbergMesh"===N.type?Z._GoldbergMeshParser(N,q):N.type&&"GreasedLineMesh"===N.type?Z._GreasedLineMeshParser(N,q):N.type&&"TrailMesh"===N.type?Z._TrailMeshParser(N,q):new Z(N.name,q),z.id=N.id,z._waitingParsedUniqueId=N.uniqueId,F.b&&F.b.AddTagsTo(z,N.tags),z.position=y.m.Zg(N.position),void 0!==N.metadata&&(z.metadata=N.metadata),N.rotationQuaternion?z.rotationQuaternion=y.g.Zg(N.rotationQuaternion):N.rotation&&(z.rotation=y.m.Zg(N.rotation)),z.re=y.m.Zg(N.re),N.localMatrix?z.setPreTransformMatrix(y.d.Zg(N.localMatrix)):N.pivotMatrix&&z.setPivotMatrix(y.d.Zg(N.pivotMatrix)),z.Vb(N.isEnabled),z.isVisible=N.isVisible,z.infiniteDistance=N.infiniteDistance,z.Sb=!!N.Sb,z.showBoundingBox=N.showBoundingBox,z.showSubMeshesBoundingBox=N.showSubMeshesBoundingBox,void 0!==N.applyFog&&(z.applyFog=N.applyFog),void 0!==N.pickable&&(z.Ub=N.pickable),void 0!==N.alphaIndex&&(z.alphaIndex=N.alphaIndex),z.receiveShadows=N.receiveShadows,void 0!==N.billboardMode&&(z.billboardMode=N.billboardMode),void 0!==N.visibility&&(z.visibility=N.visibility),z.checkCollisions=N.checkCollisions,z.Da=!!N.Da,N.ellipsoid&&(z.ellipsoid=y.m.Zg(N.ellipsoid)),N.ellipsoidOffset&&(z.ellipsoidOffset=y.m.Zg(N.ellipsoidOffset)),null!=N.overrideMaterialSideOrientation&&(z.sideOrientation=N.overrideMaterialSideOrientation),void 0!==N.sideOrientation&&(z.sideOrientation=N.sideOrientation),void 0!==N.isBlocker&&(z.isBlocker=N.isBlocker),z._shouldGenerateFlatShading=N.useFlatShading,N.Nc&&(z._waitingData.Nc=N.Nc),void 0!==N.parentId&&(z._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(z._waitingParentInstanceIndex=N.parentInstanceIndex),void 0!==N.actions&&(z._waitingData.actions=N.actions),void 0!==N.overlayAlpha&&(z.overlayAlpha=N.overlayAlpha),void 0!==N.overlayColor&&(z.overlayColor=E.c.Zg(N.overlayColor)),void 0!==N.renderOverlay&&(z.renderOverlay=N.renderOverlay),z.isUnIndexed=!!N.isUnIndexed,z.hasVertexAlpha=N.hasVertexAlpha,N.delayLoadingFile?(z.delayLoadState=4,z.delayLoadingFile=R+N.delayLoadingFile,z.buildBoundingInfo(y.m.Zg(N.boundingBoxMinimum),y.m.Zg(N.boundingBoxMaximum)),N._binaryInfo&&(z._binaryInfo=N._binaryInfo),z._delayInfo=[],N.hasUVs&&z._delayInfo.push(x.h.UVKind),N.hasUVs2&&z._delayInfo.push(x.h.UV2Kind),N.hasUVs3&&z._delayInfo.push(x.h.UV3Kind),N.hasUVs4&&z._delayInfo.push(x.h.UV4Kind),N.hasUVs5&&z._delayInfo.push(x.h.UV5Kind),N.hasUVs6&&z._delayInfo.push(x.h.UV6Kind),N.hasColors&&z._delayInfo.push(x.h.ColorKind),N.hasMatricesIndices&&z._delayInfo.push(x.h.MatricesIndicesKind),N.hasMatricesWeights&&z._delayInfo.push(x.h.MatricesWeightsKind),z._delayLoadingFunction=b.b._ImportGeometry,Y.c.ForceFullSceneLoadingForIncremental&&z._checkDelayState()):b.b._ImportGeometry(N,z),N.materialUniqueId?z._waitingMaterialId=N.materialUniqueId:N.materialId&&(z._waitingMaterialId=N.materialId),N.morphTargetManagerId>-1&&(z._waitingMorphTargetManagerId=N.morphTargetManagerId),void 0!==N.skeletonId&&null!==N.skeletonId&&(z.skeleton=q.getLastSkeletonById(N.skeletonId),N.numBoneInfluencers&&(z.numBoneInfluencers=N.numBoneInfluencers)),N.animations){for(let q=0;q<N.animations.length;q++){const R=N.animations[q],v=(0,X.c)("BABYLON.Animation");v&&z.animations.push(v.Parse(R))}t.c.ParseAnimationRanges(z,N,q)}if(N.autoAnimate&&q.beginAnimation(z,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),N.layerMask&&!isNaN(N.layerMask)?z.layerMask=Math.abs(parseInt(N.layerMask)):z.layerMask=268435455,N.physicsImpostor&&(z.physicsImpostor=Z._PhysicsImpostorParser(q,z,N)),N.lodMeshIds&&(z._waitingData.lods={ids:N.lodMeshIds,distances:N.lodDistances?N.lodDistances:null,coverages:N.lodCoverages?N.lodCoverages:null}),N.instances)for(let v=0;v<N.instances.length;v++){const R=N.instances[v],B=z.createInstance(R.name);if(R.id&&(B.id=R.id),F.b&&(R.tags?F.b.AddTagsTo(B,R.tags):F.b.AddTagsTo(B,N.tags)),B.position=y.m.Zg(R.position),void 0!==R.metadata&&(B.metadata=R.metadata),void 0!==R.parentId&&(B._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(B._waitingParentInstanceIndex=R.parentInstanceIndex),void 0!==R.isEnabled&&null!==R.isEnabled&&B.Vb(R.isEnabled),void 0!==R.isVisible&&null!==R.isVisible&&(B.isVisible=R.isVisible),void 0!==R.Ub&&null!==R.Ub&&(B.Ub=R.Ub),R.rotationQuaternion?B.rotationQuaternion=y.g.Zg(R.rotationQuaternion):R.rotation&&(B.rotation=y.m.Zg(R.rotation)),B.re=y.m.Zg(R.re),void 0!=R.checkCollisions&&null!=R.checkCollisions&&(B.checkCollisions=R.checkCollisions),void 0!=R.pickable&&null!=R.pickable&&(B.Ub=R.pickable),void 0!=R.showBoundingBox&&null!=R.showBoundingBox&&(B.showBoundingBox=R.showBoundingBox),void 0!=R.showSubMeshesBoundingBox&&null!=R.showSubMeshesBoundingBox&&(B.showSubMeshesBoundingBox=R.showSubMeshesBoundingBox),void 0!=R.alphaIndex&&null!=R.showSubMeshesBoundingBox&&(B.alphaIndex=R.alphaIndex),R.physicsImpostor&&(B.physicsImpostor=Z._PhysicsImpostorParser(q,B,R)),void 0!==R.actions&&(B._waitingData.actions=R.actions),R.animations){for(let N=0;N<R.animations.length;N++){const q=R.animations[N],z=(0,X.c)("BABYLON.Animation");z&&B.animations.push(z.Parse(q))}t.c.ParseAnimationRanges(B,R,q),R.autoAnimate&&q.beginAnimation(B,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1)}}if(N.thinInstances){const q=N.thinInstances;if(z.thinInstanceEnablePicking=!!q.enablePicking,q.matrixData?(z.mc("matrix",new Float32Array(q.matrixData),16,!1),z._thinInstanceDataStorage.matrixBufferSize=q.matrixBufferSize,z._thinInstanceDataStorage.instancesCount=q.instancesCount):z._thinInstanceDataStorage.matrixBufferSize=q.matrixBufferSize,N.thinInstances.userThinInstance){const q=N.thinInstances.userThinInstance;for(const N in q.data)z.mc(N,new Float32Array(q.data[N]),q.strides[N],!1),z._userThinInstanceBuffersStorage.sizes[N]=q.sizes[N]}}return z}setPositionsForCPUSkinning(){const N=this._internalMeshDataInfo;if(!N._sourcePositions){const q=this.getVerticesData(x.h.PositionKind);if(!q)return N._sourcePositions;N._sourcePositions=new Float32Array(q),this.isVertexBufferUpdatable(x.h.PositionKind)||this.Ga(x.h.PositionKind,q,!0)}return N._sourcePositions}setNormalsForCPUSkinning(){const N=this._internalMeshDataInfo;if(!N._sourceNormals){const q=this.getVerticesData(x.h.NormalKind);if(!q)return N._sourceNormals;N._sourceNormals=new Float32Array(q),this.isVertexBufferUpdatable(x.h.NormalKind)||this.Ga(x.h.NormalKind,q,!0)}return N._sourceNormals}applySkeleton(N){if(!this.Dj)return this;if(this.Dj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Dj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(x.h.PositionKind))return this;if(!this.isVerticesDataPresent(x.h.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(x.h.MatricesWeightsKind))return this;const q=this.isVerticesDataPresent(x.h.NormalKind),R=this._internalMeshDataInfo;if(!R._sourcePositions){const N=this.lg.slice();this.setPositionsForCPUSkinning(),this.lg=N}q&&!R._sourceNormals&&this.setNormalsForCPUSkinning();let z=this.getVerticesData(x.h.PositionKind);if(!z)return this;z instanceof Float32Array||(z=new Float32Array(z));let v=this.getVerticesData(x.h.NormalKind);if(q){if(!v)return this;v instanceof Float32Array||(v=new Float32Array(v))}const B=this.getVerticesData(x.h.MatricesIndicesKind),F=this.getVerticesData(x.h.MatricesWeightsKind);if(!F||!B)return this;const S=this.numBoneInfluencers>4,A=S?this.getVerticesData(x.h.MatricesIndicesExtraKind):null,E=S?this.getVerticesData(x.h.MatricesWeightsExtraKind):null,t=N.getTransformMatrices(this),e=y.m.Zero(),b=new y.d,f=new y.d;let D,V=0;for(let x=0;x<z.length;x+=3,V+=4){let N;for(D=0;D<4;D++)N=F[V+D],N>0&&(y.d.FromFloat32ArrayToRefScaled(t,Math.floor(16*B[V+D]),N,f),b.addToSelf(f));if(S)for(D=0;D<4;D++)N=E[V+D],N>0&&(y.d.FromFloat32ArrayToRefScaled(t,Math.floor(16*A[V+D]),N,f),b.addToSelf(f));y.m.TransformCoordinatesFromFloatsToRef(R._sourcePositions[x],R._sourcePositions[x+1],R._sourcePositions[x+2],b,e),e.toArray(z,x),q&&(y.m.TransformNormalFromFloatsToRef(R._sourceNormals[x],R._sourceNormals[x+1],R._sourceNormals[x+2],b,e),e.toArray(v,x)),b.reset()}return this.updateVerticesData(x.h.PositionKind,z),q&&this.updateVerticesData(x.h.NormalKind,v),this}static MinMax(N){let q=null,R=null;return N.forEach((function(N){const z=N.getBoundingInfo().boundingBox;q&&R?(q.minimizeInPlace(z.minimumWorld),R.maximizeInPlace(z.maximumWorld)):(q=z.minimumWorld,R=z.maximumWorld)})),q&&R?{min:q,max:R}:{min:y.m.Zero(),max:y.m.Zero()}}static Center(N){const q=N instanceof Array?Z.MinMax(N):N;return y.m.Center(q.min,q.max)}static MergeMeshes(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;return(0,S.k)(Z._MergeMeshesCoroutine(N,q,R,z,v,B,!1))}static MergeMeshesAsync(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;return(0,S.h)(Z._MergeMeshesCoroutine(N,q,R,z,v,B,!0),(0,S.e)())}static*_MergeMeshesCoroutine(N){let q,R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;if(0===(N=N.filter(Boolean)).length)return null;if(!z){let R=0;for(q=0;q<N.length;q++)if(R+=N[q].getTotalVertices(),R>=65536)return L.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}F&&(B=!1);const A=new Array,y=new Array,E=new Array,t=N[0].sideOrientation;for(q=0;q<N.length;q++){const R=N[q];if(R.isAnInstance)return L.c.Warn("Cannot merge instance meshes."),null;if(t!==R.sideOrientation)return L.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(B&&E.push(R.getTotalIndices()),F)if(R.material){const N=R.material;if(N instanceof H.e){for(let q=0;q<N.mg.length;q++)A.indexOf(N.mg[q])<0&&A.push(N.mg[q]);for(let q=0;q<R.lg.length;q++)y.push(A.indexOf(N.mg[R.lg[q].materialIndex])),E.push(R.lg[q].indexCount)}else{A.indexOf(N)<0&&A.push(N);for(let q=0;q<R.lg.length;q++)y.push(A.indexOf(N)),E.push(R.lg[q].indexCount)}}else for(let N=0;N<R.lg.length;N++)y.push(0),E.push(R.lg[N].indexCount)}const x=N[0],b=N=>{const q=N.Oj(!0);return{vertexData:e.e.ExtractFromMesh(N,!1,!1),transform:q}},{vertexData:f,transform:V}=b(x);S&&(yield);const Y=new Array(N.length-1);for(let e=1;e<N.length;e++)Y[e-1]=b(N[e]),S&&(yield);const T=f._mergeCoroutine(V,Y,z,S,!R);let X=T.next();for(;!X.done;)S&&(yield),X=T.next();const Q=X.value;v||(v=new Z(x.name+"_merged",x.va()));const h=Q._applyToCoroutine(v,void 0,S);let u=h.next();for(;!u.done;)S&&(yield),u=h.next();if(v.checkCollisions=x.checkCollisions,v.sideOrientation=x.sideOrientation,R)for(q=0;q<N.length;q++)N[q].dispose();if(B||F){v.releaseSubMeshes(),q=0;let N=0;for(;q<E.length;)D.e.CreateFromIndices(0,N,E[q],v,void 0,!1),N+=E[q],q++;for(const q of v.lg)q.refreshBoundingInfo();v.Oj(!0)}if(F){const N=new H.e(x.name+"_merged",x.va());N.mg=A;for(let q=0;q<v.lg.length;q++)v.lg[q].materialIndex=y[q];v.material=N}else v.material=x.material;return v}Gj(N){N._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(N)}Fj(N){const q=N._indexInSourceMeshInstanceArray;if(-1!=q){if(q!==this.instances.length-1){const N=this.instances[this.instances.length-1];this.instances[q]=N,N._indexInSourceMeshInstanceArray=q}N._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===V.d.CounterClockWiseSideOrientation}_getRenderingFillMode(N){const q=this.va();return q.forcePointsCloud?V.d.PointFillMode:q.forceWireframe?V.d.WireFrameFillMode:this.overrideRenderingFillMode??N}setMaterialByID(N){return this.setMaterialById(N)}static CreateRibbon(N,q,R,z,v,B,F,S,A){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(N,q,R,z,v,B){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(N,q,R,z,v){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(N,q,R,z,v,B){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(N,q,R,z){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(N,q,R,z,v,B,F,S,A){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(N,q,R,z,v,B,F){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(N,q,R,z,v,B,F,S,A,y){throw new Error("Import MeshBuilder to populate this function")}static pb(N,q,R,z,v){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(N,q,R,z,v,B,F,S){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(N,q,R,z,v,B,F){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(N,q,R,z,v,B,F,S){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(N,q,R,z,v,B,F,S,A,y){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(N,q,R,z,v,B,F,S,A,y,E,t){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(N,q,R,z,v,B,F){throw new Error("Import MeshBuilder to populate this function")}static ng(N,q,R,z,v){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(N,q,R,z,v,B){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(N,q,R,z,v,B,F,S,A){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(N,q,R,z,v,B,F,S,A,y,E){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(N,q,R,z,v,B,F,S,A,y){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(N,q,R){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(N,q,R){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(N,q,R,z,v,B){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(N,q,R){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(N){throw new Error("Import MeshBuilder to populate this function")}}Z.FRONTSIDE=e.e.FRONTSIDE,Z.BACKSIDE=e.e.BACKSIDE,Z.DOUBLESIDE=e.e.DOUBLESIDE,Z.DEFAULTSIDE=e.e.DEFAULTSIDE,Z.NO_CAP=0,Z.CAP_START=1,Z.CAP_END=2,Z.CAP_ALL=3,Z.NO_FLIP=0,Z.FLIP_TILE=1,Z.ROTATE_TILE=2,Z.FLIP_ROW=3,Z.ROTATE_ROW=4,Z.FLIP_N_ROTATE_TILE=5,Z.FLIP_N_ROTATE_ROW=6,Z.CENTER=0,Z.LEFT=1,Z.RIGHT=2,Z.TOP=3,Z.BOTTOM=4,Z.INSTANCEDMESH_SORT_TRANSPARENT=!1,Z._GroundMeshParser=(N,q)=>{throw(0,Q.b)("GroundMesh")},Z._GoldbergMeshParser=(N,q)=>{throw(0,Q.b)("GoldbergMesh")},Z._LinesMeshParser=(N,q)=>{throw(0,Q.b)("LinesMesh")},Z._GreasedLineMeshParser=(N,q)=>{throw(0,Q.b)("GreasedLineMesh")},Z._GreasedLineRibbonMeshParser=(N,q)=>{throw(0,Q.b)("GreasedLineRibbonMesh")},Z._TrailMeshParser=(N,q)=>{throw(0,Q.b)("TrailMesh")},(0,X.f)("BABYLON.Mesh",Z)},11468:(N,q,R)=>{"use strict";R.d(q,{e:()=>b});var z=R(11147),v=R(11181),B=R(11251),F=R(10923),S=R(11213),A=R(10907),y=R(11151),E=R(11450),t=R(10942),x=R(11335);class e{}class b{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,E.g)(this._applyToCoroutine.bind(this)),this.uniqueId=b._UniqueIDGenerator,b._UniqueIDGenerator++}set(N,q){switch(N.length||A.c.Warn(`Setting vertex data kind '${q}' with an empty array`),q){case B.h.PositionKind:this.xa=N;break;case B.h.NormalKind:this.ya=N;break;case B.h.TangentKind:this.tangents=N;break;case B.h.UVKind:this.Aa=N;break;case B.h.UV2Kind:this.uvs2=N;break;case B.h.UV3Kind:this.uvs3=N;break;case B.h.UV4Kind:this.uvs4=N;break;case B.h.UV5Kind:this.uvs5=N;break;case B.h.UV6Kind:this.uvs6=N;break;case B.h.ColorKind:this.za=N;break;case B.h.MatricesIndicesKind:this.matricesIndices=N;break;case B.h.MatricesWeightsKind:this.matricesWeights=N;break;case B.h.MatricesIndicesExtraKind:this.matricesIndicesExtra=N;break;case B.h.MatricesWeightsExtraKind:this.matricesWeightsExtra=N}}Ca(N,q){return this._applyTo(N,q,!1),this}applyToGeometry(N,q){return this._applyTo(N,q,!1),this}updateMesh(N){return this._update(N),this}updateGeometry(N){return this._update(N),this}*_applyToCoroutine(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;if(this.xa&&(N.Ga(B.h.PositionKind,this.xa,q),R&&(yield)),this.ya&&(N.Ga(B.h.NormalKind,this.ya,q),R&&(yield)),this.tangents&&(N.Ga(B.h.TangentKind,this.tangents,q),R&&(yield)),this.Aa&&(N.Ga(B.h.UVKind,this.Aa,q),R&&(yield)),this.uvs2&&(N.Ga(B.h.UV2Kind,this.uvs2,q),R&&(yield)),this.uvs3&&(N.Ga(B.h.UV3Kind,this.uvs3,q),R&&(yield)),this.uvs4&&(N.Ga(B.h.UV4Kind,this.uvs4,q),R&&(yield)),this.uvs5&&(N.Ga(B.h.UV5Kind,this.uvs5,q),R&&(yield)),this.uvs6&&(N.Ga(B.h.UV6Kind,this.uvs6,q),R&&(yield)),this.za&&(N.Ga(B.h.ColorKind,this.za,q),this.hasVertexAlpha&&void 0!==N.hasVertexAlpha&&(N.hasVertexAlpha=!0),R&&(yield)),this.matricesIndices&&(N.Ga(B.h.MatricesIndicesKind,this.matricesIndices,q),R&&(yield)),this.matricesWeights&&(N.Ga(B.h.MatricesWeightsKind,this.matricesWeights,q),R&&(yield)),this.matricesIndicesExtra&&(N.Ga(B.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,q),R&&(yield)),this.matricesWeightsExtra&&(N.Ga(B.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,q),R&&(yield)),this.indices?(N.setIndices(this.indices,null,q),R&&(yield)):N.setIndices([],null),N.lg&&this.materialInfos&&this.materialInfos.length>1){const q=N;q.lg=[];for(const N of this.materialInfos)new x.e(N.materialIndex,N.verticesStart,N.verticesCount,N.indexStart,N.indexCount,q)}return this}_update(N,q,R){return this.xa&&N.updateVerticesData(B.h.PositionKind,this.xa,q,R),this.ya&&N.updateVerticesData(B.h.NormalKind,this.ya,q,R),this.tangents&&N.updateVerticesData(B.h.TangentKind,this.tangents,q,R),this.Aa&&N.updateVerticesData(B.h.UVKind,this.Aa,q,R),this.uvs2&&N.updateVerticesData(B.h.UV2Kind,this.uvs2,q,R),this.uvs3&&N.updateVerticesData(B.h.UV3Kind,this.uvs3,q,R),this.uvs4&&N.updateVerticesData(B.h.UV4Kind,this.uvs4,q,R),this.uvs5&&N.updateVerticesData(B.h.UV5Kind,this.uvs5,q,R),this.uvs6&&N.updateVerticesData(B.h.UV6Kind,this.uvs6,q,R),this.za&&N.updateVerticesData(B.h.ColorKind,this.za,q,R),this.matricesIndices&&N.updateVerticesData(B.h.MatricesIndicesKind,this.matricesIndices,q,R),this.matricesWeights&&N.updateVerticesData(B.h.MatricesWeightsKind,this.matricesWeights,q,R),this.matricesIndicesExtra&&N.updateVerticesData(B.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,q,R),this.matricesWeightsExtra&&N.updateVerticesData(B.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,q,R),this.indices&&N.setIndices(this.indices,null),this}static _TransformVector3Coordinates(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.length;const B=v.k.o[0],F=v.k.o[1];for(let S=R;S<R+z;S+=3)v.m.FromArrayToRef(N,S,B),v.m.TransformCoordinatesToRef(B,q,F),N[S]=F.x,N[S+1]=F.y,N[S+2]=F.z}static _TransformVector3Normals(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.length;const B=v.k.o[0],F=v.k.o[1];for(let S=R;S<R+z;S+=3)v.m.FromArrayToRef(N,S,B),v.m.TransformNormalToRef(B,q,F),N[S]=F.x,N[S+1]=F.y,N[S+2]=F.z}static _TransformVector4Normals(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.length;const B=v.k.Vector4[0],F=v.k.Vector4[1];for(let S=R;S<R+z;S+=4)v.p.FromArrayToRef(N,S,B),v.p.TransformNormalToRef(B,q,F),N[S]=F.x,N[S+1]=F.y,N[S+2]=F.z,N[S+3]=F.w}static _FlipFaces(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.length;for(let z=q;z<q+R;z+=3){const q=N[z+1];N[z+1]=N[z+2],N[z+2]=q}}transform(N){const q=N.determinant()<0;return this.xa&&b._TransformVector3Coordinates(this.xa,N),this.ya&&b._TransformVector3Normals(this.ya,N),this.tangents&&b._TransformVector4Normals(this.tangents,N),q&&this.indices&&b._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const N=[];for(const q of this.materialInfos){const R=new b;if(this.xa&&(R.xa=this.xa.slice(3*q.verticesStart,3*(q.verticesCount+q.verticesStart))),this.ya&&(R.ya=this.ya.slice(3*q.verticesStart,3*(q.verticesCount+q.verticesStart))),this.tangents&&(R.tangents=this.tangents.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.za&&(R.za=this.za.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.Aa&&(R.Aa=this.Aa.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs2&&(R.uvs2=this.uvs2.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs3&&(R.uvs3=this.uvs3.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs4&&(R.uvs4=this.uvs4.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs5&&(R.uvs5=this.uvs5.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs6&&(R.uvs6=this.uvs6.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.matricesIndices&&(R.matricesIndices=this.matricesIndices.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.matricesIndicesExtra&&(R.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.matricesWeights&&(R.matricesWeights=this.matricesWeights.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.matricesWeightsExtra&&(R.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.indices){R.indices=[];for(let N=q.indexStart;N<q.indexStart+q.indexCount;N++)R.indices.push(this.indices[N]-q.verticesStart)}const z=new e;z.indexStart=0,z.indexCount=R.indices?R.indices.length:0,z.materialIndex=q.materialIndex,z.verticesStart=0,z.verticesCount=(R.xa?R.xa.length:0)/3,R.materialInfos=[z],N.push(R)}return N}merge(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=Array.isArray(N)?N.map((N=>({vertexData:N}))):[{vertexData:N}];return(0,E.k)(this._mergeCoroutine(void 0,B,q,!1,R,z,v))}*_mergeCoroutine(N,q){var R,z;let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let E=q.map((N=>N.vertexData)),t=this;if(y)for(const B of E)B&&(B._validate(),!this.ya&&B.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&B.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&B.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&B.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&B.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&B.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&B.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&B.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&B.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&B.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&B.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&B.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&B.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const B of E)if(B)if(y)this.ya&&!B.ya&&(B.ya=new Float32Array(B.xa.length)),this.tangents&&!B.tangents&&(B.tangents=new Float32Array(B.xa.length/3*4)),this.Aa&&!B.Aa&&(B.Aa=new Float32Array(B.xa.length/3*2)),this.uvs2&&!B.uvs2&&(B.uvs2=new Float32Array(B.xa.length/3*2)),this.uvs3&&!B.uvs3&&(B.uvs3=new Float32Array(B.xa.length/3*2)),this.uvs4&&!B.uvs4&&(B.uvs4=new Float32Array(B.xa.length/3*2)),this.uvs5&&!B.uvs5&&(B.uvs5=new Float32Array(B.xa.length/3*2)),this.uvs6&&!B.uvs6&&(B.uvs6=new Float32Array(B.xa.length/3*2)),this.za&&!B.za&&(B.za=new Float32Array(B.xa.length/3*4),B.za.fill(1)),this.matricesIndices&&!B.matricesIndices&&(B.matricesIndices=new Float32Array(B.xa.length/3*4)),this.matricesWeights&&!B.matricesWeights&&(B.matricesWeights=new Float32Array(B.xa.length/3*4)),this.matricesIndicesExtra&&!B.matricesIndicesExtra&&(B.matricesIndicesExtra=new Float32Array(B.xa.length/3*4)),this.matricesWeightsExtra&&!B.matricesWeightsExtra&&(B.matricesWeightsExtra=new Float32Array(B.xa.length/3*4));else if(B._validate(),!this.ya!==!B.ya||!this.tangents!==!B.tangents||!this.Aa!==!B.Aa||!this.uvs2!==!B.uvs2||!this.uvs3!==!B.uvs3||!this.uvs4!==!B.uvs4||!this.uvs5!==!B.uvs5||!this.uvs6!==!B.uvs6||!this.za!==!B.za||!this.matricesIndices!==!B.matricesIndices||!this.matricesWeights!==!B.matricesWeights||!this.matricesIndicesExtra!==!B.matricesIndicesExtra||!this.matricesWeightsExtra!==!B.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(A){let R=0,z=0,v=0;const B=[];let F=null;const S=[];for(const q of this.splitBasedOnMaterialID())S.push({vertexData:q,transform:N});for(const N of q)if(N.vertexData)for(const q of N.vertexData.splitBasedOnMaterialID())S.push({vertexData:q,transform:N.transform});S.sort(((N,q)=>{const R=N.vertexData.materialInfos?N.vertexData.materialInfos[0].materialIndex:0,z=q.vertexData.materialInfos?q.vertexData.materialInfos[0].materialIndex:0;return R>z?1:R===z?0:-1}));for(const N of S){const q=N.vertexData;if(R=q.materialInfos?q.materialInfos[0].materialIndex:0,F&&F.materialIndex===R)F.indexCount+=q.indices.length,F.verticesCount+=q.xa.length/3;else{const N=new e;N.materialIndex=R,N.indexStart=z,N.indexCount=q.indices.length,N.verticesStart=v,N.verticesCount=q.xa.length/3,B.push(N),F=N}z+=q.indices.length,v+=q.xa.length/3}const A=S.splice(0,1)[0];t=A.vertexData,N=A.transform,E=S.map((N=>N.vertexData)),q=S,this.materialInfos=B}const x=E.reduce(((N,q)=>{var R;return N+((null===(R=q.indices)||void 0===R?void 0:R.length)??0)}),(null===(R=t.indices)||void 0===R?void 0:R.length)??0);let f=S||E.some((N=>N.indices===t.indices))?null===(z=t.indices)||void 0===z?void 0:z.slice():t.indices;if(x>0){var D;let R=(null===(D=f)||void 0===D?void 0:D.length)??0;if(f||(f=new Array(x)),f.length!==x){if(Array.isArray(f))f.length=x;else{const N=v||f instanceof Uint32Array?new Uint32Array(x):new Uint16Array(x);N.set(f),f=N}N&&N.determinant()<0&&b._FlipFaces(f,0,R)}let z=t.xa?t.xa.length/3:0;for(const{vertexData:N,transform:v}of q)if(N.indices){for(let q=0;q<N.indices.length;q++)f[R+q]=N.indices[q]+z;v&&v.determinant()<0&&b._FlipFaces(f,R,N.indices.length),z+=N.xa.length/3,R+=N.indices.length,F&&(yield)}}return this.indices=f,this.xa=b._MergeElement(B.h.PositionKind,t.xa,N,q.map((N=>[N.vertexData.xa,N.transform]))),F&&(yield),t.ya&&(this.ya=b._MergeElement(B.h.NormalKind,t.ya,N,q.map((N=>[N.vertexData.ya,N.transform]))),F&&(yield)),t.tangents&&(this.tangents=b._MergeElement(B.h.TangentKind,t.tangents,N,q.map((N=>[N.vertexData.tangents,N.transform]))),F&&(yield)),t.Aa&&(this.Aa=b._MergeElement(B.h.UVKind,t.Aa,N,q.map((N=>[N.vertexData.Aa,N.transform]))),F&&(yield)),t.uvs2&&(this.uvs2=b._MergeElement(B.h.UV2Kind,t.uvs2,N,q.map((N=>[N.vertexData.uvs2,N.transform]))),F&&(yield)),t.uvs3&&(this.uvs3=b._MergeElement(B.h.UV3Kind,t.uvs3,N,q.map((N=>[N.vertexData.uvs3,N.transform]))),F&&(yield)),t.uvs4&&(this.uvs4=b._MergeElement(B.h.UV4Kind,t.uvs4,N,q.map((N=>[N.vertexData.uvs4,N.transform]))),F&&(yield)),t.uvs5&&(this.uvs5=b._MergeElement(B.h.UV5Kind,t.uvs5,N,q.map((N=>[N.vertexData.uvs5,N.transform]))),F&&(yield)),t.uvs6&&(this.uvs6=b._MergeElement(B.h.UV6Kind,t.uvs6,N,q.map((N=>[N.vertexData.uvs6,N.transform]))),F&&(yield)),t.za&&(this.za=b._MergeElement(B.h.ColorKind,t.za,N,q.map((N=>[N.vertexData.za,N.transform]))),(void 0!==t.hasVertexAlpha||q.some((N=>void 0!==N.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=t.hasVertexAlpha||q.some((N=>N.vertexData.hasVertexAlpha))),F&&(yield)),t.matricesIndices&&(this.matricesIndices=b._MergeElement(B.h.MatricesIndicesKind,t.matricesIndices,N,q.map((N=>[N.vertexData.matricesIndices,N.transform]))),F&&(yield)),t.matricesWeights&&(this.matricesWeights=b._MergeElement(B.h.MatricesWeightsKind,t.matricesWeights,N,q.map((N=>[N.vertexData.matricesWeights,N.transform]))),F&&(yield)),t.matricesIndicesExtra&&(this.matricesIndicesExtra=b._MergeElement(B.h.MatricesIndicesExtraKind,t.matricesIndicesExtra,N,q.map((N=>[N.vertexData.matricesIndicesExtra,N.transform]))),F&&(yield)),t.matricesWeightsExtra&&(this.matricesWeightsExtra=b._MergeElement(B.h.MatricesWeightsExtraKind,t.matricesWeightsExtra,N,q.map((N=>[N.vertexData.matricesWeightsExtra,N.transform])))),this}static _MergeElement(N,q,R,z){const v=z.filter((N=>null!==N[0]&&void 0!==N[0]));if(!q&&0==v.length)return q;if(!q)return this._MergeElement(N,v[0][0],v[0][1],v.slice(1));const F=v.reduce(((N,q)=>N+q[0].length),q.length),S=N===B.h.PositionKind?b._TransformVector3Coordinates:N===B.h.NormalKind?b._TransformVector3Normals:N===B.h.TangentKind?b._TransformVector4Normals:()=>{};if(q instanceof Float32Array){const N=new Float32Array(F);N.set(q),R&&S(N,R,0,q.length);let z=q.length;for(const[q,R]of v)N.set(q,z),R&&S(N,R,z,q.length),z+=q.length;return N}{const N=new Array(F);for(let R=0;R<q.length;R++)N[R]=q[R];R&&S(N,R,0,q.length);let z=q.length;for(const[q,R]of v){for(let R=0;R<q.length;R++)N[z+R]=q[R];R&&S(N,R,z,q.length),z+=q.length}return N}}_validate(){if(!this.xa)throw new t.i("Positions are required",t.e.MeshInvalidPositionsError);const N=(N,q)=>{const R=B.h.DeduceStride(N);if(q.length%R!==0)throw new Error("The "+N+"s array count must be a multiple of "+R);return q.length/R},q=N(B.h.PositionKind,this.xa),R=(R,z)=>{const v=N(R,z);if(v!==q)throw new Error("The "+R+"s element count ("+v+") does not match the positions count ("+q+")")};this.ya&&R(B.h.NormalKind,this.ya),this.tangents&&R(B.h.TangentKind,this.tangents),this.Aa&&R(B.h.UVKind,this.Aa),this.uvs2&&R(B.h.UV2Kind,this.uvs2),this.uvs3&&R(B.h.UV3Kind,this.uvs3),this.uvs4&&R(B.h.UV4Kind,this.uvs4),this.uvs5&&R(B.h.UV5Kind,this.uvs5),this.uvs6&&R(B.h.UV6Kind,this.uvs6),this.za&&R(B.h.ColorKind,this.za),this.matricesIndices&&R(B.h.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&R(B.h.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&R(B.h.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&R(B.h.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const N=this.serialize();return b.Parse(N)}serialize(){const N={};if(this.xa&&(N.xa=Array.from(this.xa)),this.ya&&(N.ya=Array.from(this.ya)),this.tangents&&(N.tangents=Array.from(this.tangents)),this.Aa&&(N.Aa=Array.from(this.Aa)),this.uvs2&&(N.uvs2=Array.from(this.uvs2)),this.uvs3&&(N.uvs3=Array.from(this.uvs3)),this.uvs4&&(N.uvs4=Array.from(this.uvs4)),this.uvs5&&(N.uvs5=Array.from(this.uvs5)),this.uvs6&&(N.uvs6=Array.from(this.uvs6)),this.za&&(N.za=Array.from(this.za),N.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(N.matricesIndices=Array.from(this.matricesIndices),N.matricesIndices._isExpanded=!0),this.matricesWeights&&(N.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(N.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),N.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(N.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),N.indices=Array.from(this.indices),this.materialInfos){N.materialInfos=[];for(const q of this.materialInfos){const R={indexStart:q.indexStart,indexCount:q.indexCount,materialIndex:q.materialIndex,verticesStart:q.verticesStart,verticesCount:q.verticesCount};N.materialInfos.push(R)}}return N}static ExtractFromMesh(N,q,R){return b._ExtractFrom(N,q,R)}static ExtractFromGeometry(N,q,R){return b._ExtractFrom(N,q,R)}static _ExtractFrom(N,q,R){const z=new b;if(N.isVerticesDataPresent(B.h.PositionKind)&&(z.xa=N.getVerticesData(B.h.PositionKind,q,R)),N.isVerticesDataPresent(B.h.NormalKind)&&(z.ya=N.getVerticesData(B.h.NormalKind,q,R)),N.isVerticesDataPresent(B.h.TangentKind)&&(z.tangents=N.getVerticesData(B.h.TangentKind,q,R)),N.isVerticesDataPresent(B.h.UVKind)&&(z.Aa=N.getVerticesData(B.h.UVKind,q,R)),N.isVerticesDataPresent(B.h.UV2Kind)&&(z.uvs2=N.getVerticesData(B.h.UV2Kind,q,R)),N.isVerticesDataPresent(B.h.UV3Kind)&&(z.uvs3=N.getVerticesData(B.h.UV3Kind,q,R)),N.isVerticesDataPresent(B.h.UV4Kind)&&(z.uvs4=N.getVerticesData(B.h.UV4Kind,q,R)),N.isVerticesDataPresent(B.h.UV5Kind)&&(z.uvs5=N.getVerticesData(B.h.UV5Kind,q,R)),N.isVerticesDataPresent(B.h.UV6Kind)&&(z.uvs6=N.getVerticesData(B.h.UV6Kind,q,R)),N.isVerticesDataPresent(B.h.ColorKind)){const v=N.Dj||N,F=v.getVertexBuffer(B.h.ColorKind),S=v.getVerticesData(B.h.ColorKind,q,R);if(3===F.getSize()){const N=new Float32Array(4*S.length/3);for(let q=0,R=0;q<S.length;q+=3,R+=4)N[R]=S[q],N[R+1]=S[q+1],N[R+2]=S[q+2],N[R+3]=1;z.za=N}else{if(4!==F.getSize())throw new Error(`Unexpected number of color components: ${F.getSize()}`);z.za=S}}return N.isVerticesDataPresent(B.h.MatricesIndicesKind)&&(z.matricesIndices=N.getVerticesData(B.h.MatricesIndicesKind,q,R)),N.isVerticesDataPresent(B.h.MatricesWeightsKind)&&(z.matricesWeights=N.getVerticesData(B.h.MatricesWeightsKind,q,R)),N.isVerticesDataPresent(B.h.MatricesIndicesExtraKind)&&(z.matricesIndicesExtra=N.getVerticesData(B.h.MatricesIndicesExtraKind,q,R)),N.isVerticesDataPresent(B.h.MatricesWeightsExtraKind)&&(z.matricesWeightsExtra=N.getVerticesData(B.h.MatricesWeightsExtraKind,q,R)),z.indices=N.gg(q,R),z}static CreateRibbon(N){throw(0,F.b)("ribbonBuilder")}static CreateBox(N){throw(0,F.b)("boxBuilder")}static CreateTiledBox(N){throw(0,F.b)("tiledBoxBuilder")}static CreateTiledPlane(N){throw(0,F.b)("tiledPlaneBuilder")}static CreateSphere(N){throw(0,F.b)("sphereBuilder")}static CreateCylinder(N){throw(0,F.b)("cylinderBuilder")}static CreateTorus(N){throw(0,F.b)("torusBuilder")}static CreateLineSystem(N){throw(0,F.b)("linesBuilder")}static CreateDashedLines(N){throw(0,F.b)("linesBuilder")}static CreateGround(N){throw(0,F.b)("groundBuilder")}static CreateTiledGround(N){throw(0,F.b)("groundBuilder")}static CreateGroundFromHeightMap(N){throw(0,F.b)("groundBuilder")}static ng(N){throw(0,F.b)("planeBuilder")}static CreateDisc(N){throw(0,F.b)("discBuilder")}static CreatePolygon(N,q,R,z,v,B,S){throw(0,F.b)("polygonBuilder")}static CreateIcoSphere(N){throw(0,F.b)("icoSphereBuilder")}static CreatePolyhedron(N){throw(0,F.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||v.m.Up();throw(0,F.b)("capsuleBuilder")}static CreateTorusKnot(N){throw(0,F.b)("torusKnotBuilder")}static ComputeNormals(N,q,R,z){let B=0,F=0,S=0,A=0,y=0,E=0,t=0,x=0,e=0,b=0,f=0,D=0,V=0,H=0,Y=0,T=0,L=0,X=0,Q=0,h=0,u=!1,w=!1,c=!1,n=!1,G=1,s=0,Z=null;z&&(u=!!z.facetNormals,w=!!z.facetPositions,c=!!z.facetPartitioning,G=!0===z.useRightHandedSystem?-1:1,s=z.ratio||0,n=!!z.depthSort,Z=z.distanceTo,n&&void 0===Z&&(Z=v.m.Zero()));let J=0,M=0,m=0,g=0;for(c&&z&&z.bbSize&&(J=z.subDiv.X*s/z.bbSize.x,M=z.subDiv.Y*s/z.bbSize.y,m=z.subDiv.Z*s/z.bbSize.z,g=z.subDiv.max*z.subDiv.max,z.facetPartitioning.length=0),B=0;B<N.length;B++)R[B]=0;const j=q.length/3|0;for(B=0;B<j;B++){if(D=3*q[3*B],V=D+1,H=D+2,Y=3*q[3*B+1],T=Y+1,L=Y+2,X=3*q[3*B+2],Q=X+1,h=X+2,F=N[D]-N[Y],S=N[V]-N[T],A=N[H]-N[L],y=N[X]-N[Y],E=N[Q]-N[T],t=N[h]-N[L],x=G*(S*t-A*E),e=G*(A*y-F*t),b=G*(F*E-S*y),f=Math.sqrt(x*x+e*e+b*b),f=0===f?1:f,x/=f,e/=f,b/=f,u&&z&&(z.facetNormals[B].x=x,z.facetNormals[B].y=e,z.facetNormals[B].z=b),w&&z&&(z.facetPositions[B].x=(N[D]+N[Y]+N[X])/3,z.facetPositions[B].y=(N[V]+N[T]+N[Q])/3,z.facetPositions[B].z=(N[H]+N[L]+N[h])/3),c&&z){const q=Math.floor((z.facetPositions[B].x-z.bInfo.minimum.x*s)*J),R=Math.floor((z.facetPositions[B].y-z.bInfo.minimum.y*s)*M),v=Math.floor((z.facetPositions[B].z-z.bInfo.minimum.z*s)*m),F=Math.floor((N[D]-z.bInfo.minimum.x*s)*J),S=Math.floor((N[V]-z.bInfo.minimum.y*s)*M),A=Math.floor((N[H]-z.bInfo.minimum.z*s)*m),y=Math.floor((N[Y]-z.bInfo.minimum.x*s)*J),E=Math.floor((N[T]-z.bInfo.minimum.y*s)*M),t=Math.floor((N[L]-z.bInfo.minimum.z*s)*m),x=Math.floor((N[X]-z.bInfo.minimum.x*s)*J),e=Math.floor((N[Q]-z.bInfo.minimum.y*s)*M),b=Math.floor((N[h]-z.bInfo.minimum.z*s)*m),f=F+z.subDiv.max*S+g*A,u=y+z.subDiv.max*E+g*t,w=x+z.subDiv.max*e+g*b,c=q+z.subDiv.max*R+g*v;z.facetPartitioning[c]=z.facetPartitioning[c]?z.facetPartitioning[c]:new Array,z.facetPartitioning[f]=z.facetPartitioning[f]?z.facetPartitioning[f]:new Array,z.facetPartitioning[u]=z.facetPartitioning[u]?z.facetPartitioning[u]:new Array,z.facetPartitioning[w]=z.facetPartitioning[w]?z.facetPartitioning[w]:new Array,z.facetPartitioning[f].push(B),u!=f&&z.facetPartitioning[u].push(B),w!=u&&w!=f&&z.facetPartitioning[w].push(B),c!=f&&c!=u&&c!=w&&z.facetPartitioning[c].push(B)}if(n&&z&&z.facetPositions){const N=z.depthSortedFacets[B];N.ind=3*B,N.sqDistance=v.m.DistanceSquared(z.facetPositions[B],Z)}R[D]+=x,R[V]+=e,R[H]+=b,R[Y]+=x,R[T]+=e,R[L]+=b,R[X]+=x,R[Q]+=e,R[h]+=b}for(B=0;B<R.length/3;B++)x=R[3*B],e=R[3*B+1],b=R[3*B+2],f=Math.sqrt(x*x+e*e+b*b),f=0===f?1:f,x/=f,e/=f,b/=f,R[3*B]=x,R[3*B+1]=e,R[3*B+2]=b}static _ComputeSides(N,q,R,z,B,F,S){const A=R.length,y=z.length;let E,t;switch(N=N||b.DEFAULTSIDE){case b.FRONTSIDE:break;case b.BACKSIDE:for(E=0;E<A;E+=3){const N=R[E];R[E]=R[E+2],R[E+2]=N}for(t=0;t<y;t++)z[t]=-z[t];break;case b.DOUBLESIDE:{const N=q.length,x=N/3;for(let R=0;R<N;R++)q[N+R]=q[R];for(E=0;E<A;E+=3)R[E+A]=R[E+2]+x,R[E+1+A]=R[E+1]+x,R[E+2+A]=R[E]+x;for(t=0;t<y;t++)z[y+t]=-z[t];const e=B.length;let b=0;for(b=0;b<e;b++)B[b+e]=B[b];for(F=F||new v.p(0,0,1,1),S=S||new v.p(0,0,1,1),b=0,E=0;E<e/2;E++)B[b]=F.x+(F.z-F.x)*B[b],B[b+1]=F.y+(F.w-F.y)*B[b+1],B[b+e]=S.x+(S.z-S.x)*B[b+e],B[b+e+1]=S.y+(S.w-S.y)*B[b+e+1],b+=2;break}}}static Parse(N){const q=new b,R=N.xa;R&&q.set(R,B.h.PositionKind);const z=N.ya;z&&q.set(z,B.h.NormalKind);const v=N.tangents;v&&q.set(v,B.h.TangentKind);const F=N.Aa;F&&q.set(F,B.h.UVKind);const A=N.uvs2;A&&q.set(A,B.h.UV2Kind);const y=N.uvs3;y&&q.set(y,B.h.UV3Kind);const E=N.uvs4;E&&q.set(E,B.h.UV4Kind);const t=N.uvs5;t&&q.set(t,B.h.UV5Kind);const x=N.uvs6;x&&q.set(x,B.h.UV6Kind);const f=N.za;f&&(q.set(S.g.CheckColors4(f,R.length/3),B.h.ColorKind),void 0!==N.hasVertexAlpha&&(q.hasVertexAlpha=N.hasVertexAlpha));const D=N.matricesIndices;D&&q.set(D,B.h.MatricesIndicesKind);const V=N.matricesWeights;V&&q.set(V,B.h.MatricesWeightsKind);const H=N.indices;H&&(q.indices=H);const Y=N.materialInfos;if(Y){q.materialInfos=[];for(const N of Y){const R=new e;R.indexCount=N.indexCount,R.indexStart=N.indexStart,R.verticesCount=N.verticesCount,R.verticesStart=N.verticesStart,R.materialIndex=N.materialIndex,q.materialInfos.push(R)}}return q}static ImportVertexData(N,q){const R=b.Parse(N);q.setAllVerticesData(R,N.updatable)}}b.FRONTSIDE=0,b.BACKSIDE=1,b.DOUBLESIDE=2,b.DEFAULTSIDE=0,b._UniqueIDGenerator=0,(0,z.c)([y.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z]=q;return!Array.isArray(z)}))],b,"_TransformVector3Coordinates",null),(0,z.c)([y.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z]=q;return!Array.isArray(z)}))],b,"_TransformVector3Normals",null),(0,z.c)([y.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z]=q;return!Array.isArray(z)}))],b,"_TransformVector4Normals",null),(0,z.c)([y.f.filter((function(){for(var N=arguments.length,q=new Array(N),R=0;R<N;R++)q[R]=arguments[R];let[z]=q;return!Array.isArray(z)}))],b,"_FlipFaces",null)},12550:(N,q,R)=>{"use strict";R.d(q,{d:()=>fN});var z=R(11181),v=R(11445),B=R(11251),F=R(11468),S=R(11414);function A(N){let q=N.pathArray;const R=N.closeArray||!1,z=N.closePath||!1,v=N.invertUV||!1,A=Math.floor(q[0].length/2);let y=N.offset||A;y=y>A?A:Math.floor(y);const E=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,t=N.Aa,x=N.za,e=[],b=[],f=[],D=[],V=[],H=[],Y=[],T=[];let L;const X=[],Q=[];let h,u,w;if(q.length<2){const N=[],R=[];for(u=0;u<q[0].length-y;u++)N.push(q[0][u]),R.push(q[0][u+y]);q=[N,R]}let c=0;const n=z?1:0,G=R?1:0;let s,Z,J,M,m,g;for(L=q[0].length,h=0;h<q.length+G;h++){for(Y[h]=0,V[h]=[0],s=h===q.length?q[0]:q[h],Z=s.length,L=L<Z?L:Z,w=0;w<Z;)e.push(s[w].x,s[w].y,s[w].z),w>0&&(J=s[w].gd(s[w-1]).length(),M=J+Y[h],V[h].push(M),Y[h]=M),w++;z&&(w--,e.push(s[0].x,s[0].y,s[0].z),J=s[w].gd(s[0]).length(),M=J+Y[h],V[h].push(M),Y[h]=M),X[h]=Z+n,Q[h]=c,c+=Z+n}let j,l,I=null,U=null;for(u=0;u<L+n;u++)for(T[u]=0,H[u]=[0],h=0;h<q.length-1+G;h++)m=q[h],g=h===q.length-1?q[0]:q[h+1],u===L?(I=m[0],U=g[0]):(I=m[u],U=g[u]),J=U.gd(I).length(),M=J+T[u],H[u].push(M),T[u]=M;if(t)for(h=0;h<t.length;h++)D.push(t[h].x,S.b?1-t[h].y:t[h].y);else for(h=0;h<q.length+G;h++)for(u=0;u<L+n;u++)j=0!=Y[h]?V[h][u]/Y[h]:0,l=0!=T[u]?H[u][h]/T[u]:0,v?D.push(l,j):D.push(j,S.b?1-l:l);h=0;let O=0,i=X[h]-1,P=X[h+1]-1,k=i<P?i:P,o=Q[1]-Q[0];const C=X.length-1;for(;O<=k&&h<C;)b.push(O,O+o,O+1),b.push(O+o+1,O+1,O+o),O+=1,O===k&&(h++,o=Q[h+1]-Q[h],i=X[h]-1,P=X[h+1]-1,O=Q[h],k=i<P?i+O:P+O);if(F.e.ComputeNormals(e,b,f),z){let N=0,R=0;for(h=0;h<q.length;h++){N=3*Q[h],R=h+1<q.length?3*(Q[h+1]-1):f.length-3,f[N]=.5*(f[N]+f[R]),f[N+1]=.5*(f[N+1]+f[R+1]),f[N+2]=.5*(f[N+2]+f[R+2]);const z=Math.sqrt(f[N]*f[N]+f[N+1]*f[N+1]+f[N+2]*f[N+2]);f[N]/=z,f[N+1]/=z,f[N+2]/=z,f[R]=f[N],f[R+1]=f[N+1],f[R+2]=f[N+2]}}if(R){let N=3*Q[0],R=3*Q[q.length];for(u=0;u<L+n;u++){f[N]=.5*(f[N]+f[R]),f[N+1]=.5*(f[N+1]+f[R+1]),f[N+2]=.5*(f[N+2]+f[R+2]);const q=Math.sqrt(f[N]*f[N]+f[N+1]*f[N+1]+f[N+2]*f[N+2]);f[N]/=q,f[N+1]/=q,f[N+2]/=q,f[R]=f[N],f[R+1]=f[N+1],f[R+2]=f[N+2],N+=3,R+=3}}F.e._ComputeSides(E,e,b,f,D,N.frontUVs,N.backUVs);let K=null;if(x){K=new Float32Array(4*x.length);for(let N=0;N<x.length;N++)K[4*N]=x[N].r,K[4*N+1]=x[N].g,K[4*N+2]=x[N].b,K[4*N+3]=x[N].a}const r=new F.e,a=new Float32Array(e),d=new Float32Array(f),p=new Float32Array(D);return r.indices=b,r.xa=a,r.ya=d,r.Aa=p,K&&r.set(K,B.h.ColorKind),z&&(r._idx=Q),r}function y(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=q.pathArray,E=q.closeArray,t=q.closePath,x=v.b._GetDefaultSideOrientation(q.sideOrientation),e=q.instance,b=q.updatable;if(e){const N=z.k.o[0].oe(Number.MAX_VALUE),R=z.k.o[1].oe(-Number.MAX_VALUE),A=q=>{let z=y[0].length;const B=e;let F=0;const S=B._originalBuilderSideOrientation===v.b.DOUBLESIDE?2:1;for(let v=1;v<=S;++v)for(let S=0;S<y.length;++S){const v=y[S],A=v.length;z=z<A?z:A;for(let B=0;B<z;++B){const z=v[B];q[F]=z.x,q[F+1]=z.y,q[F+2]=z.z,N.minimizeInPlaceFromFloats(z.x,z.y,z.z),R.maximizeInPlaceFromFloats(z.x,z.y,z.z),F+=3}if(B._creationDataStorage&&B._creationDataStorage.closePath){const N=v[0];q[F]=N.x,q[F+1]=N.y,q[F+2]=N.z,F+=3}}},E=e.getVerticesData(B.h.PositionKind);if(A(E),e.hasBoundingInfo?e.getBoundingInfo().reConstruct(N,R,e._worldMatrix):e.buildBoundingInfo(N,R,e._worldMatrix),e.updateVerticesData(B.h.PositionKind,E,!1,!1),q.za){const N=e.getVerticesData(B.h.ColorKind);for(let R=0,z=0;R<q.za.length;R++,z+=4){const v=q.za[R];N[z]=v.r,N[z+1]=v.g,N[z+2]=v.b,N[z+3]=v.a}e.updateVerticesData(B.h.ColorKind,N,!1,!1)}if(q.Aa){const N=e.getVerticesData(B.h.UVKind);for(let R=0;R<q.Aa.length;R++)N[2*R]=q.Aa[R].x,N[2*R+1]=S.b?1-q.Aa[R].y:q.Aa[R].y;e.updateVerticesData(B.h.UVKind,N,!1,!1)}if(!e.areNormalsFrozen||e.isFacetDataEnabled){const N=e.gg(),q=e.getVerticesData(B.h.NormalKind),R=e.isFacetDataEnabled?e.getFacetDataParameters():null;if(F.e.ComputeNormals(E,N,q,R),e._creationDataStorage&&e._creationDataStorage.closePath){let N=0,R=0;for(let z=0;z<y.length;z++)N=3*e._creationDataStorage.idx[z],R=z+1<y.length?3*(e._creationDataStorage.idx[z+1]-1):q.length-3,q[N]=.5*(q[N]+q[R]),q[N+1]=.5*(q[N+1]+q[R+1]),q[N+2]=.5*(q[N+2]+q[R+2]),q[R]=q[N],q[R+1]=q[N+1],q[R+2]=q[N+2]}e.areNormalsFrozen||e.updateVerticesData(B.h.NormalKind,q,!1,!1)}return e}{const z=new v.b(N,R);z._originalBuilderSideOrientation=x,z._creationDataStorage=new v.d;const B=A(q);return t&&(z._creationDataStorage.idx=B._idx),z._creationDataStorage.closePath=t,z._creationDataStorage.closeArray=E,B.Ca(z,b),z}}F.e.CreateRibbon=A,v.b.CreateRibbon=function(N,q){return y(N,{pathArray:q,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var E=R(11824),t=R(11509),x=R(11213);function e(N){const q=N.pattern||v.b.NO_FLIP,R=N.tileWidth||N.tileSize||1,z=N.tileHeight||N.tileSize||1,B=N.alignHorizontal||0,S=N.alignVertical||0,A=N.width||N.size||1,y=Math.floor(A/R);let E=A-y*R;const t=N.height||N.size||1,x=Math.floor(t/z);let e=t-x*z;const b=R*y/2,f=z*x/2;let D=0,V=0,H=0,Y=0,T=0,L=0;if(E>0||e>0){switch(H=-b,Y=-f,T=b,L=f,B){case v.b.CENTER:E/=2,H-=E,T+=E;break;case v.b.LEFT:T+=E,D=-E/2;break;case v.b.RIGHT:H-=E,D=E/2}switch(S){case v.b.CENTER:e/=2,Y-=e,L+=e;break;case v.b.BOTTOM:L+=e,V=-e/2;break;case v.b.TOP:Y-=e,V=e/2}}const X=[],Q=[],h=[];h[0]=[0,0,1,0,1,1,0,1],h[1]=[0,0,1,0,1,1,0,1],q!==v.b.ROTATE_TILE&&q!==v.b.ROTATE_ROW||(h[1]=[1,1,0,1,0,0,1,0]),q!==v.b.FLIP_TILE&&q!==v.b.FLIP_ROW||(h[1]=[1,0,0,0,0,1,1,1]),q!==v.b.FLIP_N_ROTATE_TILE&&q!==v.b.FLIP_N_ROTATE_ROW||(h[1]=[0,1,1,1,1,0,0,0]);let u=[];const w=[],c=[];let n=0;for(let F=0;F<x;F++)for(let N=0;N<y;N++)X.push(N*R-b+D,F*z-f+V,0),X.push((N+1)*R-b+D,F*z-f+V,0),X.push((N+1)*R-b+D,(F+1)*z-f+V,0),X.push(N*R-b+D,(F+1)*z-f+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),u=q===v.b.FLIP_TILE||q===v.b.ROTATE_TILE||q===v.b.FLIP_N_ROTATE_TILE?u.concat(h[(N%2+F%2)%2]):q===v.b.FLIP_ROW||q===v.b.ROTATE_ROW||q===v.b.FLIP_N_ROTATE_ROW?u.concat(h[F%2]):u.concat(h[0]),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),n+=4;if(E>0||e>0){const N=e>0&&(S===v.b.CENTER||S===v.b.TOP),F=e>0&&(S===v.b.CENTER||S===v.b.BOTTOM),A=E>0&&(B===v.b.CENTER||B===v.b.RIGHT),t=E>0&&(B===v.b.CENTER||B===v.b.LEFT);let h,G,s,Z,J=[];if(N&&A&&(X.push(H+D,Y+V,0),X.push(-b+D,Y+V,0),X.push(-b+D,Y+e+V,0),X.push(H+D,Y+e+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,h=1-E/R,G=1-e/z,s=1,Z=1,J=[h,G,s,G,s,Z,h,Z],q===v.b.ROTATE_ROW&&(J=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),q===v.b.FLIP_ROW&&(J=[1-h,G,1-s,G,1-s,Z,1-h,Z]),q===v.b.FLIP_N_ROTATE_ROW&&(J=[h,1-G,s,1-G,s,1-Z,h,1-Z]),u=u.concat(J),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&t&&(X.push(b+D,Y+V,0),X.push(T+D,Y+V,0),X.push(T+D,Y+e+V,0),X.push(b+D,Y+e+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,h=0,G=1-e/z,s=E/R,Z=1,J=[h,G,s,G,s,Z,h,Z],(q===v.b.ROTATE_ROW||q===v.b.ROTATE_TILE&&y%2===0)&&(J=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),(q===v.b.FLIP_ROW||q===v.b.FLIP_TILE&&y%2===0)&&(J=[1-h,G,1-s,G,1-s,Z,1-h,Z]),(q===v.b.FLIP_N_ROTATE_ROW||q===v.b.FLIP_N_ROTATE_TILE&&y%2===0)&&(J=[h,1-G,s,1-G,s,1-Z,h,1-Z]),u=u.concat(J),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&A&&(X.push(H+D,f+V,0),X.push(-b+D,f+V,0),X.push(-b+D,L+V,0),X.push(H+D,L+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,h=1-E/R,G=0,s=1,Z=e/z,J=[h,G,s,G,s,Z,h,Z],(q===v.b.ROTATE_ROW&&x%2===1||q===v.b.ROTATE_TILE&&x%1===0)&&(J=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),(q===v.b.FLIP_ROW&&x%2===1||q===v.b.FLIP_TILE&&x%2===0)&&(J=[1-h,G,1-s,G,1-s,Z,1-h,Z]),(q===v.b.FLIP_N_ROTATE_ROW&&x%2===1||q===v.b.FLIP_N_ROTATE_TILE&&x%2===0)&&(J=[h,1-G,s,1-G,s,1-Z,h,1-Z]),u=u.concat(J),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&t&&(X.push(b+D,f+V,0),X.push(T+D,f+V,0),X.push(T+D,L+V,0),X.push(b+D,L+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,h=0,G=0,s=E/R,Z=e/z,J=[h,G,s,G,s,Z,h,Z],(q===v.b.ROTATE_ROW&&x%2===1||q===v.b.ROTATE_TILE&&(x+y)%2===1)&&(J=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),(q===v.b.FLIP_ROW&&x%2===1||q===v.b.FLIP_TILE&&(x+y)%2===1)&&(J=[1-h,G,1-s,G,1-s,Z,1-h,Z]),(q===v.b.FLIP_N_ROTATE_ROW&&x%2===1||q===v.b.FLIP_N_ROTATE_TILE&&(x+y)%2===1)&&(J=[h,1-G,s,1-G,s,1-Z,h,1-Z]),u=u.concat(J),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N){const N=[];h=0,G=1-e/z,s=1,Z=1,N[0]=[h,G,s,G,s,Z,h,Z],N[1]=[h,G,s,G,s,Z,h,Z],q!==v.b.ROTATE_TILE&&q!==v.b.ROTATE_ROW||(N[1]=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),q!==v.b.FLIP_TILE&&q!==v.b.FLIP_ROW||(N[1]=[1-h,G,1-s,G,1-s,Z,1-h,Z]),q!==v.b.FLIP_N_ROTATE_TILE&&q!==v.b.FLIP_N_ROTATE_ROW||(N[1]=[h,1-G,s,1-G,s,1-Z,h,1-Z]);for(let z=0;z<y;z++)X.push(z*R-b+D,Y+V,0),X.push((z+1)*R-b+D,Y+V,0),X.push((z+1)*R-b+D,Y+e+V,0),X.push(z*R-b+D,Y+e+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,u=q===v.b.FLIP_TILE||q===v.b.ROTATE_TILE||q===v.b.FLIP_N_ROTATE_TILE?u.concat(N[(z+1)%2]):q===v.b.FLIP_ROW||q===v.b.ROTATE_ROW||q===v.b.FLIP_N_ROTATE_ROW?u.concat(N[1]):u.concat(N[0]),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const N=[];h=0,G=0,s=1,Z=e/z,N[0]=[h,G,s,G,s,Z,h,Z],N[1]=[h,G,s,G,s,Z,h,Z],q!==v.b.ROTATE_TILE&&q!==v.b.ROTATE_ROW||(N[1]=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),q!==v.b.FLIP_TILE&&q!==v.b.FLIP_ROW||(N[1]=[1-h,G,1-s,G,1-s,Z,1-h,Z]),q!==v.b.FLIP_N_ROTATE_TILE&&q!==v.b.FLIP_N_ROTATE_ROW||(N[1]=[h,1-G,s,1-G,s,1-Z,h,1-Z]);for(let z=0;z<y;z++)X.push(z*R-b+D,L-e+V,0),X.push((z+1)*R-b+D,L-e+V,0),X.push((z+1)*R-b+D,L+V,0),X.push(z*R-b+D,L+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,u=q===v.b.FLIP_TILE||q===v.b.ROTATE_TILE||q===v.b.FLIP_N_ROTATE_TILE?u.concat(N[(z+x)%2]):q===v.b.FLIP_ROW||q===v.b.ROTATE_ROW||q===v.b.FLIP_N_ROTATE_ROW?u.concat(N[x%2]):u.concat(N[0]),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const N=[];h=1-E/R,G=0,s=1,Z=1,N[0]=[h,G,s,G,s,Z,h,Z],N[1]=[h,G,s,G,s,Z,h,Z],q!==v.b.ROTATE_TILE&&q!==v.b.ROTATE_ROW||(N[1]=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),q!==v.b.FLIP_TILE&&q!==v.b.FLIP_ROW||(N[1]=[1-h,G,1-s,G,1-s,Z,1-h,Z]),q!==v.b.FLIP_N_ROTATE_TILE&&q!==v.b.FLIP_N_ROTATE_ROW||(N[1]=[h,1-G,s,1-G,s,1-Z,h,1-Z]);for(let R=0;R<x;R++)X.push(H+D,R*z-f+V,0),X.push(H+E+D,R*z-f+V,0),X.push(H+E+D,(R+1)*z-f+V,0),X.push(H+D,(R+1)*z-f+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,u=q===v.b.FLIP_TILE||q===v.b.ROTATE_TILE||q===v.b.FLIP_N_ROTATE_TILE?u.concat(N[(R+1)%2]):q===v.b.FLIP_ROW||q===v.b.ROTATE_ROW||q===v.b.FLIP_N_ROTATE_ROW?u.concat(N[R%2]):u.concat(N[0]),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const N=[];h=0,G=0,s=E/z,Z=1,N[0]=[h,G,s,G,s,Z,h,Z],N[1]=[h,G,s,G,s,Z,h,Z],q!==v.b.ROTATE_TILE&&q!==v.b.ROTATE_ROW||(N[1]=[1-h,1-G,1-s,1-G,1-s,1-Z,1-h,1-Z]),q!==v.b.FLIP_TILE&&q!==v.b.FLIP_ROW||(N[1]=[1-h,G,1-s,G,1-s,Z,1-h,Z]),q!==v.b.FLIP_N_ROTATE_TILE&&q!==v.b.FLIP_N_ROTATE_ROW||(N[1]=[h,1-G,s,1-G,s,1-Z,h,1-Z]);for(let R=0;R<x;R++)X.push(T-E+D,R*z-f+V,0),X.push(T+D,R*z-f+V,0),X.push(T+D,(R+1)*z-f+V,0),X.push(T-E+D,(R+1)*z-f+V,0),c.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,u=q===v.b.FLIP_TILE||q===v.b.ROTATE_TILE||q===v.b.FLIP_N_ROTATE_TILE?u.concat(N[(R+y)%2]):q===v.b.FLIP_ROW||q===v.b.ROTATE_ROW||q===v.b.FLIP_N_ROTATE_ROW?u.concat(N[R%2]):u.concat(N[0]),w.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const G=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE;F.e._ComputeSides(G,X,c,Q,u,N.frontUVs,N.backUVs);const s=new F.e;s.indices=c,s.xa=X,s.ya=Q,s.Aa=u;const Z=G===F.e.DOUBLESIDE?w.concat(w):w;return s.za=Z,s}function b(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return e(q).Ca(z,q.updatable),z}function f(N){const q=N.faceUV||new Array(6),R=N.faceColors,B=N.pattern||v.b.NO_FLIP,A=N.width||N.size||1,y=N.height||N.size||1,E=N.depth||N.size||1,t=N.tileWidth||N.tileSize||1,b=N.tileHeight||N.tileSize||1,f=N.alignHorizontal||0,D=N.alignVertical||0,V=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE;for(let v=0;v<6;v++)void 0===q[v]&&(q[v]=new z.p(0,0,1,1)),R&&void 0===R[v]&&(R[v]=new x.g(1,1,1,1));const H=A/2,Y=y/2,T=E/2,L=[];for(let z=0;z<2;z++)L[z]=e({pattern:B,tileWidth:t,tileHeight:b,width:A,height:y,alignVertical:D,alignHorizontal:f,sideOrientation:V});for(let z=2;z<4;z++)L[z]=e({pattern:B,tileWidth:t,tileHeight:b,width:E,height:y,alignVertical:D,alignHorizontal:f,sideOrientation:V});let X=D;D===v.b.BOTTOM?X=v.b.TOP:D===v.b.TOP&&(X=v.b.BOTTOM);for(let z=4;z<6;z++)L[z]=e({pattern:B,tileWidth:t,tileHeight:b,width:A,height:E,alignVertical:X,alignHorizontal:f,sideOrientation:V});let Q=[],h=[],u=[],w=[];const c=[],n=[],G=[],s=[];let Z=0,J=0;for(let v=0;v<6;v++){const N=L[v].xa.length;n[v]=[],G[v]=[];for(let q=0;q<N/3;q++)n[v].push(new z.m(L[v].xa[3*q],L[v].xa[3*q+1],L[v].xa[3*q+2])),G[v].push(new z.m(L[v].ya[3*q],L[v].ya[3*q+1],L[v].ya[3*q+2]));Z=L[v].Aa.length,s[v]=[];for(let R=0;R<Z;R+=2)s[v][R]=q[v].x+(q[v].z-q[v].x)*L[v].Aa[R],s[v][R+1]=q[v].y+(q[v].w-q[v].y)*L[v].Aa[R+1],S.b&&(s[v][R+1]=1-s[v][R+1]);if(u=u.concat(s[v]),w=w.concat(L[v].indices.map((N=>N+J))),J+=n[v].length,R)for(let q=0;q<4;q++)c.push(R[v].r,R[v].g,R[v].b,R[v].a)}const M=new z.m(0,0,T),m=z.d.RotationY(Math.PI);Q=n[0].map((N=>z.m.TransformNormal(N,m).add(M))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]),h=G[0].map((N=>z.m.TransformNormal(N,m))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]),Q=Q.concat(n[1].map((N=>N.gd(M))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),h=h.concat(G[1].map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const g=new z.m(H,0,0),j=z.d.RotationY(-Math.PI/2);Q=Q.concat(n[2].map((N=>z.m.TransformNormal(N,j).add(g))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),h=h.concat(G[2].map((N=>z.m.TransformNormal(N,j))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const l=z.d.RotationY(Math.PI/2);Q=Q.concat(n[3].map((N=>z.m.TransformNormal(N,l).gd(g))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),h=h.concat(G[3].map((N=>z.m.TransformNormal(N,l))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const I=new z.m(0,Y,0),U=z.d.RotationX(Math.PI/2);Q=Q.concat(n[4].map((N=>z.m.TransformNormal(N,U).add(I))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),h=h.concat(G[4].map((N=>z.m.TransformNormal(N,U))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const O=z.d.RotationX(-Math.PI/2);Q=Q.concat(n[5].map((N=>z.m.TransformNormal(N,O).gd(I))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),h=h.concat(G[5].map((N=>z.m.TransformNormal(N,O))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),F.e._ComputeSides(V,Q,w,h,u);const i=new F.e;if(i.indices=w,i.xa=Q,i.ya=h,i.Aa=u,R){const N=V===F.e.DOUBLESIDE?c.concat(c):c;i.za=N}return i}function D(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return f(q).Ca(z,q.updatable),z}F.e.CreateTiledPlane=e;F.e.CreateTiledBox=f;var V=R(11812),H=R(11172),Y=R(11495);function T(N){const q=N.height||2;let R=0===N.diameterTop?0:N.diameterTop||N.diameter||1,B=0===N.diameterBottom?0:N.diameterBottom||N.diameter||1;R=R||1e-5,B=B||1e-5;const A=0|(N.tessellation||24),y=0|(N.subdivisions||1),E=!!N.hasRings,t=!!N.enclose,e=0===N.cap?0:N.cap||v.b.CAP_ALL,b=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,f=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,D=N.faceUV||new Array(3),V=N.faceColors,H=2+(1+(1!==b&&t?2:0))*(E?y:1);let T;for(T=0;T<H;T++)V&&void 0===V[T]&&(V[T]=new x.g(1,1,1,1));for(T=0;T<H;T++)D&&void 0===D[T]&&(D[T]=new z.p(0,0,1,1));const L=[],X=[],Q=[],h=[],u=[],w=2*Math.PI*b/A;let c,n,G;const s=(B-R)/2/q,Z=z.m.Zero(),J=z.m.Zero(),M=z.m.Zero(),m=z.m.Zero(),g=z.m.Zero(),j=Y.b.Y;let l,I,U,O=1,i=1,P=0,k=0;for(l=0;l<=y;l++)for(n=l/y,G=(n*(R-B)+B)/2,O=E&&0!==l&&l!==y?2:1,U=0;U<O;U++){for(E&&(i+=U),t&&(i+=2*U),I=0;I<=A;I++)c=I*w,Z.x=Math.cos(-c)*G,Z.y=-q/2+n*q,Z.z=Math.sin(-c)*G,0===R&&l===y?(J.x=Q[Q.length-3*(A+1)],J.y=Q[Q.length-3*(A+1)+1],J.z=Q[Q.length-3*(A+1)+2]):(J.x=Z.x,J.z=Z.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*s,J.normalize()),0===I&&(M.p(Z),m.p(J)),X.push(Z.x,Z.y,Z.z),Q.push(J.x,J.y,J.z),k=E?P!==i?D[i].y:D[i].w:D[i].y+(D[i].w-D[i].y)*n,h.push(D[i].x+(D[i].z-D[i].x)*I/A,S.b?1-k:k),V&&u.push(V[i].r,V[i].g,V[i].b,V[i].a);1!==b&&t&&(X.push(Z.x,Z.y,Z.z),X.push(0,Z.y,0),X.push(0,Z.y,0),X.push(M.x,M.y,M.z),z.m.CrossToRef(j,J,g),g.normalize(),Q.push(g.x,g.y,g.z,g.x,g.y,g.z),z.m.CrossToRef(m,j,g),g.normalize(),Q.push(g.x,g.y,g.z,g.x,g.y,g.z),k=E?P!==i?D[i+1].y:D[i+1].w:D[i+1].y+(D[i+1].w-D[i+1].y)*n,h.push(D[i+1].x,S.b?1-k:k),h.push(D[i+1].z,S.b?1-k:k),k=E?P!==i?D[i+2].y:D[i+2].w:D[i+2].y+(D[i+2].w-D[i+2].y)*n,h.push(D[i+2].x,S.b?1-k:k),h.push(D[i+2].z,S.b?1-k:k),V&&(u.push(V[i+1].r,V[i+1].g,V[i+1].b,V[i+1].a),u.push(V[i+1].r,V[i+1].g,V[i+1].b,V[i+1].a),u.push(V[i+2].r,V[i+2].g,V[i+2].b,V[i+2].a),u.push(V[i+2].r,V[i+2].g,V[i+2].b,V[i+2].a))),P!==i&&(P=i)}const o=1!==b&&t?A+4:A;for(l=0,i=0;i<y;i++){let N=0,q=0,R=0,z=0;for(I=0;I<A;I++)N=l*(o+1)+I,q=(l+1)*(o+1)+I,R=l*(o+1)+(I+1),z=(l+1)*(o+1)+(I+1),L.push(N,q,R),L.push(z,R,q);1!==b&&t&&(L.push(N+2,q+2,R+2),L.push(z+2,R+2,q+2),L.push(N+4,q+4,R+4),L.push(z+4,R+4,q+4)),l=E?l+2:l+1}const C=N=>{const v=N?R/2:B/2;if(0===v)return;let F,y,E;const t=N?D[H-1]:D[0];let x=null;V&&(x=N?V[H-1]:V[0]);const e=X.length/3,f=N?q/2:-q/2,Y=new z.m(0,f,0);X.push(Y.x,Y.y,Y.z),Q.push(0,N?1:-1,0);const T=t.y+.5*(t.w-t.y);h.push(t.x+.5*(t.z-t.x),S.b?1-T:T),x&&u.push(x.r,x.g,x.b,x.a);const w=new z.l(.5,.5);for(E=0;E<=A;E++){F=2*Math.PI*E*b/A;const q=Math.cos(-F),R=Math.sin(-F);y=new z.m(q*v,f,R*v);const B=new z.l(q*w.x+.5,R*w.y+.5);X.push(y.x,y.y,y.z),Q.push(0,N?1:-1,0);const e=t.y+(t.w-t.y)*B.y;h.push(t.x+(t.z-t.x)*B.x,S.b?1-e:e),x&&u.push(x.r,x.g,x.b,x.a)}for(E=0;E<A;E++)N?(L.push(e),L.push(e+(E+2)),L.push(e+(E+1))):(L.push(e),L.push(e+(E+1)),L.push(e+(E+2)))};e!==v.b.CAP_START&&e!==v.b.CAP_ALL||C(!1),e!==v.b.CAP_END&&e!==v.b.CAP_ALL||C(!0),F.e._ComputeSides(f,X,L,Q,h,N.frontUVs,N.backUVs);const K=new F.e;return K.indices=L,K.xa=X,K.ya=Q,K.Aa=h,V&&(K.za=u),K}function L(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return T(q).Ca(z,q.updatable),z}function X(N){const q=[],R=[],v=[],B=[],A=N.diameter||1,y=N.thickness||.5,E=0|(N.tessellation||16),t=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,x=E+1;for(let F=0;F<=E;F++){const N=F/E,t=F*Math.PI*2/E-Math.PI/2,e=z.d.Translation(A/2,0,0).multiply(z.d.RotationY(t));for(let A=0;A<=E;A++){const t=1-A/E,b=A*Math.PI*2/E+Math.PI,f=Math.cos(b),D=Math.sin(b);let V=new z.m(f,D,0),H=V.scale(y/2);const Y=new z.l(N,t);H=z.m.TransformCoordinates(H,e),V=z.m.TransformNormal(V,e),R.push(H.x,H.y,H.z),v.push(V.x,V.y,V.z),B.push(Y.x,S.b?1-Y.y:Y.y);const T=(F+1)%x,L=(A+1)%x;q.push(F*x+A),q.push(F*x+L),q.push(T*x+A),q.push(F*x+L),q.push(T*x+L),q.push(T*x+A)}}F.e._ComputeSides(t,R,q,v,B,N.frontUVs,N.backUVs);const e=new F.e;return e.indices=q,e.xa=R,e.ya=v,e.Aa=B,e}function Q(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return X(q).Ca(z,q.updatable),z}F.e.CreateCylinder=T,v.b.CreateCylinder=(N,q,R,z,B,F,S,A,y)=>{void 0!==S&&S instanceof H.b||(void 0!==S&&(y=A||v.b.DEFAULTSIDE,A=S),S=F,F=1);return L(N,{height:q,diameterTop:R,diameterBottom:z,tessellation:B,subdivisions:F,sideOrientation:y,updatable:A},S)};function h(N){const q=[],R=[],v=[],B=[],A=N.radius||2,y=N.tube||.5,E=N.radialSegments||32,t=N.tubularSegments||32,x=N.p||2,e=N.q||3,b=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,f=N=>{const q=Math.cos(N),R=Math.sin(N),v=e/x*N,B=Math.cos(v),F=A*(2+B)*.5*q,S=A*(2+B)*R*.5,y=A*Math.sin(v)*.5;return new z.m(F,S,y)};let D,V;for(D=0;D<=E;D++){const N=D%E/E*2*x*Math.PI,q=f(N),v=f(N+.01),F=v.gd(q);let A=v.add(q);const e=z.m.Cross(F,A);for(A=z.m.Cross(e,F),e.normalize(),A.normalize(),V=0;V<t;V++){const N=V%t/t*2*Math.PI,z=-y*Math.cos(N),v=y*Math.sin(N);R.push(q.x+z*A.x+v*e.x),R.push(q.y+z*A.y+v*e.y),R.push(q.z+z*A.z+v*e.z),B.push(D/E),B.push(S.b?1-V/t:V/t)}}for(D=0;D<E;D++)for(V=0;V<t;V++){const N=(V+1)%t,R=D*t+V,z=(D+1)*t+V,v=(D+1)*t+N,B=D*t+N;q.push(B),q.push(z),q.push(R),q.push(B),q.push(v),q.push(z)}F.e.ComputeNormals(R,q,v),F.e._ComputeSides(b,R,q,v,B,N.frontUVs,N.backUVs);const H=new F.e;return H.indices=q,H.xa=R,H.ya=v,H.Aa=B,H}function u(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return h(q).Ca(z,q.updatable),z}F.e.CreateTorus=X,v.b.CreateTorus=(N,q,R,z,v,B,F)=>Q(N,{diameter:q,thickness:R,tessellation:z,sideOrientation:F,updatable:B},v);F.e.CreateTorusKnot=h,v.b.CreateTorusKnot=(N,q,R,z,v,B,F,S,A,y)=>u(N,{radius:q,tube:R,radialSegments:z,tubularSegments:v,p:B,q:F,sideOrientation:y,updatable:A},S);var w=R(12553),c=R(10907),n=R(11693),G=R(11186),s=R(10933);class Z extends z.l{constructor(N,q){super(N.x,N.y),this.index=q}}class J{constructor(){this.elements=[]}add(N){const q=[];return N.forEach((N=>{const R=new Z(N,this.elements.length);q.push(R),this.elements.push(R)})),q}computeBounds(){const N=new z.l(this.elements[0].x,this.elements[0].y),q=new z.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((R=>{R.x<N.x?N.x=R.x:R.x>q.x&&(q.x=R.x),R.y<N.y?N.y=R.y:R.y>q.y&&(q.y=R.y)})),{min:N,max:q,width:q.x-N.x,height:q.y-N.y}}}class M{_addToepoint(N){for(const q of N)this._epoints.push(q.x,q.y)}constructor(N,q,R){let z,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new J,this._outlinepoints=new J,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=v,this._name=N,this._scene=R||s.b.LastCreatedScene,z=q instanceof n.d?q.getPoints():q,this._addToepoint(z),this._points.add(z),this._outlinepoints.add(z),"undefined"===typeof this.bjsEarcut&&c.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(N){this._points.add(N);const q=new J;return q.add(N),this._holes.push(q),this._eholes.push(this._epoints.length/2),this._addToepoint(N),this}build(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const z=new v.b(this._name,this._scene),F=this.buildVertexData(q,R);return z.Ga(B.h.PositionKind,F.xa,N),z.Ga(B.h.NormalKind,F.ya,N),z.Ga(B.h.UVKind,F.Aa,N),z.setIndices(F.indices),z}buildVertexData(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const R=new F.e,z=[],v=[],B=[],S=this._points.computeBounds();this._points.elements.forEach((N=>{z.push(0,1,0),v.push(N.x,0,N.y),B.push((N.x-S.min.x)/S.width,(N.y-S.min.y)/S.height)}));const A=[],y=this.bjsEarcut(this._epoints,this._eholes,2);for(let F=0;F<y.length;F++)A.push(y[F]);if(N>0){const R=v.length/3;this._points.elements.forEach((q=>{z.push(0,-1,0),v.push(q.x,-N,q.y),B.push(1-(q.x-S.min.x)/S.width,1-(q.y-S.min.y)/S.height)}));const F=A.length;for(let N=0;N<F;N+=3){const q=A[N+0],z=A[N+1],v=A[N+2];A.push(v+R),A.push(z+R),A.push(q+R)}this._addSide(v,z,B,A,S,this._outlinepoints,N,!1,q),this._holes.forEach((R=>{this._addSide(v,z,B,A,S,R,N,!0,q)}))}return R.indices=A,R.xa=v,R.ya=z,R.Aa=B,R}_addSide(N,q,R,v,B,F,S,A,y){let E=N.length/3,t=0;for(let x=0;x<F.elements.length;x++){const e=F.elements[x],b=F.elements[(x+1)%F.elements.length];N.push(e.x,0,e.y),N.push(e.x,-S,e.y),N.push(b.x,0,b.y),N.push(b.x,-S,b.y);const f=F.elements[(x+F.elements.length-1)%F.elements.length],D=F.elements[(x+2)%F.elements.length];let V=new z.m(-(b.y-e.y),0,b.x-e.x),H=new z.m(-(e.y-f.y),0,e.x-f.x),Y=new z.m(-(D.y-b.y),0,D.x-b.x);A||(V=V.scale(-1),H=H.scale(-1),Y=Y.scale(-1));const T=V.normalizeToNew();let L=H.normalizeToNew(),X=Y.normalizeToNew();const Q=z.m.Dot(L,T);L=Q>y?Q<G.d-1?new z.m(e.x,0,e.y).gd(new z.m(b.x,0,b.y)).normalize():H.add(V).normalize():T;const h=z.m.Dot(Y,V);X=h>y?h<G.d-1?new z.m(b.x,0,b.y).gd(new z.m(e.x,0,e.y)).normalize():Y.add(V).normalize():T,R.push(t/B.width,0),R.push(t/B.width,1),t+=V.length(),R.push(t/B.width,0),R.push(t/B.width,1),q.push(L.x,L.y,L.z),q.push(L.x,L.y,L.z),q.push(X.x,X.y,X.z),q.push(X.x,X.y,X.z),A?(v.push(E),v.push(E+2),v.push(E+1),v.push(E+1),v.push(E+2),v.push(E+3)):(v.push(E),v.push(E+1),v.push(E+2),v.push(E+1),v.push(E+3),v.push(E+2)),E+=4}}}function m(N,q,R,v,A,y,E){const t=R||new Array(3),e=v,b=[],f=E||!1;for(let B=0;B<3;B++)void 0===t[B]&&(t[B]=new z.p(0,0,1,1)),e&&void 0===e[B]&&(e[B]=new x.g(1,1,1,1));const D=N.getVerticesData(B.h.PositionKind),V=N.getVerticesData(B.h.NormalKind),H=N.getVerticesData(B.h.UVKind),Y=N.gg(),T=D.length/9;let L=0,X=0,Q=0,h=0,u=0;const w=[0];if(f)for(let z=T;z<D.length/3;z+=4)X=D[3*(z+2)]-D[3*z],Q=D[3*(z+2)+2]-D[3*z+2],h=Math.sqrt(X*X+Q*Q),u+=h,w.push(u);let c=0,n=0;for(let z=0;z<V.length;z+=3)Math.abs(V[z+1])<.001&&(n=1),Math.abs(V[z+1]-1)<.001&&(n=0),Math.abs(V[z+1]+1)<.001&&(n=2),c=z/3,1===n?(L=c-T,H[2*c]=L%4<1.5?f?t[n].x+(t[n].z-t[n].x)*w[Math.floor(L/4)]/u:t[n].x:f?t[n].x+(t[n].z-t[n].x)*w[Math.floor(L/4)+1]/u:t[n].z,H[2*c+1]=L%2===0?S.b?1-t[n].w:t[n].w:S.b?1-t[n].y:t[n].y):(H[2*c]=(1-H[2*c])*t[n].x+H[2*c]*t[n].z,H[2*c+1]=(1-H[2*c+1])*t[n].y+H[2*c+1]*t[n].w,S.b&&(H[2*c+1]=1-H[2*c+1])),e&&b.push(e[n].r,e[n].g,e[n].b,e[n].a);F.e._ComputeSides(q,D,Y,V,H,A,y);const G=new F.e;if(G.indices=Y,G.xa=D,G.ya=V,G.Aa=H,e){const N=q===F.e.DOUBLESIDE?b.concat(b):b;G.za=N}return G}function g(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation);const F=q.shape,S=q.holes||[],A=q.depth||0,y=q.smoothingThreshold||2,E=[];let t=[];for(let v=0;v<F.length;v++)E[v]=new z.l(F[v].x,F[v].z);E[0].equalsWithEpsilon(E[E.length-1],1e-8)&&E.pop();const x=new M(N,E,R||s.b.LastCreatedScene,B);for(let v=0;v<S.length;v++){t=[];for(let N=0;N<S[v].length;N++)t.push(new z.l(S[v][N].x,S[v][N].z));x.addHole(t)}const e=x.build(!1,A,y);e._originalBuilderSideOrientation=q.sideOrientation;return m(e,q.sideOrientation,q.faceUV,q.faceColors,q.frontUVs,q.backUVs,q.wrap).Ca(e,q.updatable),e}function j(N,q){return g(N,q,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function l(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.path,B=q.shape,F=q.scale||1,S=q.rotation||0,A=0===q.cap?0:q.cap||v.b.NO_CAP,y=q.updatable,E=v.b._GetDefaultSideOrientation(q.sideOrientation),t=q.instance||null,x=q.invertUV||!1,e=q.closeShape||!1;return U(N,B,z,F,S,null,null,q.closePath||!1,e,A,!1,R,!!y,E,t,x,q.frontUVs||null,q.backUVs||null,q.firstNormal||null,!!q.adjustFrame)}function I(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.path,B=q.shape,F=q.scaleFunction||(()=>1),S=q.rotationFunction||(()=>0),A=q.closePath||q.ribbonCloseArray||!1,y=q.closeShape||q.ribbonClosePath||!1,E=0===q.cap?0:q.cap||v.b.NO_CAP,t=q.updatable,x=q.firstNormal||null,e=q.adjustFrame||!1;return U(N,B,z,null,null,F,S,A,y,E,!0,R,!!t,v.b._GetDefaultSideOrientation(q.sideOrientation),q.instance||null,q.invertUV||!1,q.frontUVs||null,q.backUVs||null,x,e)}function U(N,q,R,B,F,S,A,E,t,x,e,b,f,D,V,H,Y,T,L,X){const Q=(N,q,R,B,F,S,A,y,E,t,x)=>{const e=R.getTangents(),b=R.getNormals(),f=R.getBinormals(),D=R.getDistances();if(x)for(let v=0;v<e.length;v++)if(0==e[v].x&&0==e[v].y&&0==e[v].z&&e[v].p(e[v-1]),0==b[v].x&&0==b[v].y&&0==b[v].z&&b[v].p(b[v-1]),0==f[v].x&&0==f[v].y&&0==f[v].z&&f[v].p(f[v-1]),v>0){let N=e[v-1];z.m.Dot(N,e[v])<0&&e[v].scaleInPlace(-1),N=b[v-1],z.m.Dot(N,b[v])<0&&b[v].scaleInPlace(-1),N=f[v-1],z.m.Dot(N,f[v])<0&&f[v].scaleInPlace(-1)}let V=0;const H=t&&y?y:()=>null!==S?S:0,Y=t&&A?A:()=>null!==F?F:1;let T=E===v.b.NO_CAP||E===v.b.CAP_END?0:2;const L=z.k.Matrix[0];for(let v=0;v<q.length;v++){const R=[],F=H(v,D[v]),S=Y(v,D[v]);z.d.RotationAxisToRef(e[v],V,L);for(let B=0;B<N.length;B++){const F=e[v].scale(N[B].z).add(b[v].scale(N[B].x)).add(f[v].scale(N[B].y)),A=z.m.Zero();z.m.TransformCoordinatesToRef(F,L,A),A.scaleInPlace(S).addInPlace(q[v]),R[B]=A}B[T]=R,V+=F,T++}const X=N=>{const q=Array(),R=z.m.Zero();let v;for(v=0;v<N.length;v++)R.addInPlace(N[v]);for(R.scaleInPlace(1/N.length),v=0;v<N.length;v++)q.push(R);return q};switch(E){case v.b.NO_CAP:break;case v.b.CAP_START:B[0]=X(B[2]),B[1]=B[2];break;case v.b.CAP_END:B[T]=B[T-1],B[T+1]=X(B[T-1]);break;case v.b.CAP_ALL:B[0]=X(B[2]),B[1]=B[2],B[T]=B[T-1],B[T+1]=X(B[T-1])}return B};let h,u;if(V){const N=V._creationDataStorage;return h=L?N.path3D.update(R,L):N.path3D.update(R),u=Q(q,R,N.path3D,N.pathArray,B,F,S,A,N.cap,e,X),V=y("",{pathArray:u,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:V},b||void 0)}h=L?new n.h(R,L):new n.h(R);u=Q(q,R,h,new Array,B,F,S,A,x=x<0||x>3?0:x,e,X);const w=y(N,{pathArray:u,closeArray:E,closePath:t,updatable:f,sideOrientation:D,invertUV:H,frontUVs:Y||void 0,backUVs:T||void 0},b);return w._creationDataStorage.pathArray=u,w._creationDataStorage.path3D=h,w._creationDataStorage.cap=x,w}F.e.CreatePolygon=m,v.b.CreatePolygon=function(N,q,R,z,v,B){return g(N,{shape:q,holes:z,updatable:v,sideOrientation:B},R,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},v.b.ExtrudePolygon=function(N,q,R,z,v,B,F){return j(N,{shape:q,holes:v,depth:R,updatable:B,sideOrientation:F},z,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function O(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.arc?q.arc<=0||q.arc>1?1:q.arc:1,F=void 0===q.closed||q.closed,S=q.shape,A=q.radius||1,E=q.tessellation||64,t=q.clip||0,x=q.updatable,e=v.b._GetDefaultSideOrientation(q.sideOrientation),b=q.cap||v.b.NO_CAP,f=2*Math.PI,D=[],V=q.invertUV||!1;let H=0,Y=0;const T=f/E*B;let L,X;for(H=0;H<=E-t;H++){for(X=[],b!=v.b.CAP_START&&b!=v.b.CAP_ALL||(X.push(new z.m(0,S[0].y,0)),X.push(new z.m(Math.cos(H*T)*S[0].x*A,S[0].y,Math.sin(H*T)*S[0].x*A))),Y=0;Y<S.length;Y++)L=new z.m(Math.cos(H*T)*S[Y].x*A,S[Y].y,Math.sin(H*T)*S[Y].x*A),X.push(L);b!=v.b.CAP_END&&b!=v.b.CAP_ALL||(X.push(new z.m(Math.cos(H*T)*S[S.length-1].x*A,S[S.length-1].y,Math.sin(H*T)*S[S.length-1].x*A)),X.push(new z.m(0,S[S.length-1].y,0))),D.push(X)}return y(N,{pathArray:D,closeArray:F,sideOrientation:e,updatable:x,invertUV:V,frontUVs:q.frontUVs,backUVs:q.backUVs},R)}v.b.ExtrudeShape=function(N,q,R,z,B,F){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7?arguments[7]:void 0,y=arguments.length>8?arguments[8]:void 0,E=arguments.length>9?arguments[9]:void 0;return l(N,{shape:q,path:R,scale:z,rotation:B,cap:0===F?0:F||v.b.NO_CAP,sideOrientation:y,instance:E,updatable:A},S)},v.b.ExtrudeShapeCustom=(N,q,R,z,B,F,S,A,y,E,t,x)=>I(N,{shape:q,path:R,scaleFunction:z,rotationFunction:B,ribbonCloseArray:F,ribbonClosePath:S,cap:0===A?0:A||v.b.NO_CAP,sideOrientation:t,instance:x,updatable:E},y);v.b.CreateLathe=(N,q,R,z,v,B,F)=>O(N,{shape:q,radius:R,tessellation:z,sideOrientation:F,updatable:B},v);var i=R(11569),P=R(11513);function k(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.path;let F=q.instance,S=1;void 0!==q.radius?S=q.radius:F&&(S=F._creationDataStorage.radius);const A=q.tessellation||64,E=q.radiusFunction||null;let t=q.cap||v.b.NO_CAP;const x=q.invertUV||!1,e=q.updatable,b=v.b._GetDefaultSideOrientation(q.sideOrientation);q.arc=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1;const f=(N,q,R,B,F,S,A,y)=>{const E=q.getTangents(),t=q.getNormals(),x=q.getDistances(),e=2*Math.PI/F*y,b=S||(()=>B);let f,D,V,H;const Y=z.k.Matrix[0];let T=A===v.b.NO_CAP||A===v.b.CAP_END?0:2;for(let v=0;v<N.length;v++){D=b(v,x[v]),f=Array(),V=t[v];for(let q=0;q<F;q++)z.d.RotationAxisToRef(E[v],e*q,Y),H=f[q]?f[q]:z.m.Zero(),z.m.TransformCoordinatesToRef(V,Y,H),H.scaleInPlace(D).addInPlace(N[v]),f[q]=H;R[T]=f,T++}const L=(q,R)=>{const z=Array();for(let v=0;v<q;v++)z.push(N[R]);return z};switch(A){case v.b.NO_CAP:break;case v.b.CAP_START:R[0]=L(F,0),R[1]=R[2].slice(0);break;case v.b.CAP_END:R[T]=R[T-1].slice(0),R[T+1]=L(F,N.length-1);break;case v.b.CAP_ALL:R[0]=L(F,0),R[1]=R[2].slice(0),R[T]=R[T-1].slice(0),R[T+1]=L(F,N.length-1)}return R};let D,V;if(F){const N=F._creationDataStorage,R=q.arc||N.arc;return D=N.path3D.update(B),V=f(B,D,N.pathArray,S,N.tessellation,E,N.cap,R),F=y("",{pathArray:V,instance:F}),N.path3D=D,N.pathArray=V,N.arc=R,N.radius=S,F}D=new n.h(B);t=t<0||t>3?0:t,V=f(B,D,new Array,S,A,E,t,q.arc);const H=y(N,{pathArray:V,closePath:!0,closeArray:!1,updatable:e,sideOrientation:b,invertUV:x,frontUVs:q.frontUVs,backUVs:q.backUVs},R);return H._creationDataStorage.pathArray=V,H._creationDataStorage.path3D=D,H._creationDataStorage.tessellation=A,H._creationDataStorage.cap=t,H._creationDataStorage.arc=q.arc,H._creationDataStorage.radius=S,H}function o(N){const q=[];q[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},q[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},q[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},q[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},q[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},q[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},q[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},q[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},q[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},q[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},q[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},q[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},q[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},q[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},q[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const R=N.type&&(N.type<0||N.type>=q.length)?0:N.type||0,v=N.size,B=N.sizeX||v||1,A=N.sizeY||v||1,y=N.sizeZ||v||1,E=N.custom||q[R],t=E.face.length,e=N.faceUV||new Array(t),b=N.faceColors,f=void 0===N.flat||N.flat,D=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,V=[],H=[],Y=[],T=[],L=[];let X=0,Q=0;const h=[];let u,w,c,n,G,s,Z=0,J=0;if(f)for(J=0;J<t;J++)b&&void 0===b[J]&&(b[J]=new x.g(1,1,1,1)),e&&void 0===e[J]&&(e[J]=new z.p(0,0,1,1));if(f)for(J=0;J<t;J++){const N=E.face[J].length;for(c=2*Math.PI/N,n=.5*Math.tan(c/2),G=.5,Z=0;Z<N;Z++)V.push(E.vertex[E.face[J][Z]][0]*B,E.vertex[E.face[J][Z]][1]*A,E.vertex[E.face[J][Z]][2]*y),h.push(X),X++,u=e[J].x+(e[J].z-e[J].x)*(.5+n),w=e[J].y+(e[J].w-e[J].y)*(G-.5),T.push(u,S.b?1-w:w),s=n*Math.cos(c)-G*Math.sin(c),G=n*Math.sin(c)+G*Math.cos(c),n=s,b&&L.push(b[J].r,b[J].g,b[J].b,b[J].a);for(Z=0;Z<N-2;Z++)H.push(h[0+Q],h[Z+2+Q],h[Z+1+Q]);Q+=N}else{for(Z=0;Z<E.vertex.length;Z++)V.push(E.vertex[Z][0]*B,E.vertex[Z][1]*A,E.vertex[Z][2]*y),T.push(0,S.b?1:0);for(J=0;J<t;J++)for(Z=0;Z<E.face[J].length-2;Z++)H.push(E.face[J][0],E.face[J][Z+2],E.face[J][Z+1])}F.e.ComputeNormals(V,H,Y),F.e._ComputeSides(D,V,H,Y,T,N.frontUVs,N.backUVs);const M=new F.e;return M.xa=V,M.indices=H,M.ya=Y,M.Aa=T,b&&f&&(M.za=L),M}function C(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return o(q).Ca(z,q.updatable),z}v.b.CreateTube=(N,q,R,z,v,B,F,S,A,y)=>k(N,{path:q,radius:R,tessellation:z,radiusFunction:v,arc:1,cap:B,updatable:S,sideOrientation:A,instance:y},F);function K(N){const q=N.sideOrientation||F.e.DEFAULTSIDE,R=N.radius||1,v=void 0===N.flat||N.flat,B=0|(N.subdivisions||4),A=N.radiusX||R,y=N.radiusY||R,E=N.radiusZ||R,t=(1+Math.sqrt(5))/2,x=[-1,t,-0,1,t,0,-1,-t,0,1,-t,0,0,-1,-t,0,1,-t,0,-1,t,0,1,t,t,0,1,t,0,-1,-t,0,1,-t,0,-1],e=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],b=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],f=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],D=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],V=[],H=[],Y=[],T=[];let L=0;const X=new Array(3),Q=new Array(3);let h;for(h=0;h<3;h++)X[h]=z.m.Zero(),Q[h]=z.l.Zero();for(let F=0;F<20;F++){for(h=0;h<3;h++){const N=e[3*F+h];X[h].qe(x[3*b[N]],x[3*b[N]+1],x[3*b[N]+2]),X[h].normalize(),Q[h].qe(.134765625*f[2*N]+.05859375+-.0390625*D[F],.2333984375*f[2*N+1]+.025390625+.01953125*D[F])}const N=(N,q,R,F)=>{const t=z.m.Lerp(X[0],X[2],q/B),x=z.m.Lerp(X[1],X[2],q/B),e=B===q?X[2]:z.m.Lerp(t,x,N/(B-q));let b;if(e.normalize(),v){const N=z.m.Lerp(X[0],X[2],F/B),q=z.m.Lerp(X[1],X[2],F/B);b=z.m.Lerp(N,q,R/(B-F))}else b=new z.m(e.x,e.y,e.z);b.x/=A,b.y/=y,b.z/=E,b.normalize();const f=z.l.Lerp(Q[0],Q[2],q/B),D=z.l.Lerp(Q[1],Q[2],q/B),h=B===q?Q[2]:z.l.Lerp(f,D,N/(B-q));H.push(e.x*A,e.y*y,e.z*E),Y.push(b.x,b.y,b.z),T.push(h.x,S.b?1-h.y:h.y),V.push(L),L++};for(let q=0;q<B;q++)for(let R=0;R+q<B;R++)N(R,q,R+1/3,q+1/3),N(R+1,q,R+1/3,q+1/3),N(R,q+1,R+1/3,q+1/3),R+q+1<B&&(N(R+1,q,R+2/3,q+2/3),N(R+1,q+1,R+2/3,q+2/3),N(R,q+1,R+2/3,q+2/3))}F.e._ComputeSides(q,H,V,Y,T,N.frontUVs,N.backUVs);const u=new F.e;return u.indices=V,u.xa=H,u.ya=Y,u.Aa=T,u}function r(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.b(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),z._originalBuilderSideOrientation=q.sideOrientation;return K(q).Ca(z,q.updatable),z}F.e.CreatePolyhedron=o,v.b.CreatePolyhedron=(N,q,R)=>C(N,q,R);F.e.CreateIcoSphere=K,v.b.CreateIcoSphere=(N,q,R)=>r(N,q,R);var a=R(11197);const d=new z.m(1,0,0),p=new z.m(-1,0,0),W=new z.m(0,1,0),NN=new z.m(0,-1,0),qN=new z.m(0,0,1),RN=new z.m(0,0,-1);class zN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.m.Zero(),q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.m.Up(),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.l.Zero(),v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=N,this.k=q,this.uv=R,this.vertexIdx=v,this.vertexIdxForBones=B,this.localPositionOverride=F,this.localNormalOverride=S,this.matrixIndicesOverride=A,this.matrixWeightsOverride=y}clone(){var N,q,R,z;return new zN(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(N=this.localPositionOverride)||void 0===N?void 0:N.slice(),null===(q=this.localNormalOverride)||void 0===q?void 0:q.slice(),null===(R=this.matrixIndicesOverride)||void 0===R?void 0:R.slice(),null===(z=this.matrixWeightsOverride)||void 0===z?void 0:z.slice())}}function vN(N,q,R){var A,y,E,t;const x=!!q.skeleton,e=R.localMode||x,b=q.gg(),f=x?q.be(!0,!0):q.getVerticesData(B.h.PositionKind),D=x?q.getNormalsData(!0,!0):q.getVerticesData(B.h.NormalKind),V=e?x?q.getVerticesData(B.h.PositionKind):f:null,H=e?x?q.getVerticesData(B.h.NormalKind):D:null,Y=q.getVerticesData(B.h.UVKind),T=x?q.getVerticesData(B.h.MatricesIndicesKind):null,L=x?q.getVerticesData(B.h.MatricesWeightsKind):null,X=x?q.getVerticesData(B.h.MatricesIndicesExtraKind):null,Q=x?q.getVerticesData(B.h.MatricesWeightsExtraKind):null,h=R.position||z.m.Zero();let u=R.k||z.m.Up();const w=R.size||z.m.One(),c=R.angle||0;if(!u){const N=new z.m(0,0,1),R=q.va().activeCamera,v=z.m.TransformCoordinates(N,R.getWorldMatrix());u=R.globalPosition.gd(v)}const n=-Math.atan2(u.z,u.x)-Math.PI/2,G=Math.sqrt(u.x*u.x+u.z*u.z),s=Math.atan2(u.y,G),Z=new F.e;Z.indices=[],Z.xa=[],Z.ya=[],Z.Aa=[],Z.matricesIndices=x?[]:null,Z.matricesWeights=x?[]:null,Z.matricesIndicesExtra=X?[]:null,Z.matricesWeightsExtra=Q?[]:null;let J=0;const M=(N,q)=>{const v=new zN;if(!b||!f||!D)return v;const B=b[N];if(v.vertexIdx=3*B,v.vertexIdxForBones=4*B,v.position=new z.m(f[3*B],f[3*B+1],f[3*B+2]),z.m.TransformCoordinatesToRef(v.position,q,v.position),v.k=new z.m(D[3*B],D[3*B+1],D[3*B+2]),z.m.TransformNormalToRef(v.k,q,v.k),R.captureUVS&&Y){const N=Y[2*B+1];v.uv=new z.l(Y[2*B],S.b?1-N:N)}return v},m=[0,0,0,0],g=(N,q)=>{if(0===N.length)return N;const R=.5*Math.abs(z.m.Dot(w,q)),v=(N,q,R,z)=>{for(let v=0;v<z;++v)if(N[R+v]===q)return R+v;return-1},B=(N,B)=>{const F=z.m.GetClipFactor(N.position,B.position,q,R);let S=m,A=m;if(T&&L){const q=N.matrixIndicesOverride?0:N.vertexIdxForBones,R=N.matrixIndicesOverride??T,z=N.matrixWeightsOverride??L,y=B.matrixIndicesOverride?0:B.vertexIdxForBones,E=B.matrixIndicesOverride??T,t=B.matrixWeightsOverride??L;S=[0,0,0,0],A=[0,0,0,0];let x=0;for(let N=0;N<4;++N)if(z[q+N]>0){const B=v(E,R[q+N],y,4);S[x]=R[q+N],A[x]=(0,a.m)(z[q+N],B>=0?t[B]:0,F),x++}for(let N=0;N<4&&x<4;++N){const z=E[y+N];-1===v(R,z,q,4)&&(S[x]=z,A[x]=(0,a.m)(0,t[y+N],F),x++)}const e=A[0]+A[1]+A[2]+A[3];A[0]/=e,A[1]/=e,A[2]/=e,A[3]/=e}const y=N.localPositionOverride?N.localPositionOverride[0]:(null===V||void 0===V?void 0:V[N.vertexIdx])??0,E=N.localPositionOverride?N.localPositionOverride[1]:(null===V||void 0===V?void 0:V[N.vertexIdx+1])??0,t=N.localPositionOverride?N.localPositionOverride[2]:(null===V||void 0===V?void 0:V[N.vertexIdx+2])??0,x=B.localPositionOverride?B.localPositionOverride[0]:(null===V||void 0===V?void 0:V[B.vertexIdx])??0,e=B.localPositionOverride?B.localPositionOverride[1]:(null===V||void 0===V?void 0:V[B.vertexIdx+1])??0,b=B.localPositionOverride?B.localPositionOverride[2]:(null===V||void 0===V?void 0:V[B.vertexIdx+2])??0,f=N.localNormalOverride?N.localNormalOverride[0]:(null===H||void 0===H?void 0:H[N.vertexIdx])??0,D=N.localNormalOverride?N.localNormalOverride[1]:(null===H||void 0===H?void 0:H[N.vertexIdx+1])??0,Y=N.localNormalOverride?N.localNormalOverride[2]:(null===H||void 0===H?void 0:H[N.vertexIdx+2])??0,X=f+((B.localNormalOverride?B.localNormalOverride[0]:(null===H||void 0===H?void 0:H[B.vertexIdx])??0)-f)*F,Q=D+((B.localNormalOverride?B.localNormalOverride[1]:(null===H||void 0===H?void 0:H[B.vertexIdx+1])??0)-D)*F,h=Y+((B.localNormalOverride?B.localNormalOverride[2]:(null===H||void 0===H?void 0:H[B.vertexIdx+2])??0)-Y)*F,u=Math.sqrt(X*X+Q*Q+h*h);return new zN(z.m.Lerp(N.position,B.position,F),z.m.Lerp(N.k,B.k,F).normalize(),z.l.Lerp(N.uv,B.uv,F),-1,-1,V?[y+(x-y)*F,E+(e-E)*F,t+(b-t)*F]:null,H?[X/u,Q/u,h/u]:null,S,A)};let F=null;N.length>3&&(F=[]);for(let S=0;S<N.length;S+=3){let v=0,A=null,y=null,E=null,t=null;const x=z.m.Dot(N[S].position,q)-R>0,e=z.m.Dot(N[S+1].position,q)-R>0,b=z.m.Dot(N[S+2].position,q)-R>0;switch(v=(x?1:0)+(e?1:0)+(b?1:0),v){case 0:N.length>3?(F.push(N[S]),F.push(N[S+1]),F.push(N[S+2])):F=N;break;case 1:if(F=F??new Array,x&&(A=N[S+1],y=N[S+2],E=B(N[S],A),t=B(N[S],y)),e){A=N[S],y=N[S+2],E=B(N[S+1],A),t=B(N[S+1],y),F.push(E),F.push(y.clone()),F.push(A.clone()),F.push(y.clone()),F.push(E.clone()),F.push(t);break}b&&(A=N[S],y=N[S+1],E=B(N[S+2],A),t=B(N[S+2],y)),A&&y&&E&&t&&(F.push(A.clone()),F.push(y.clone()),F.push(E),F.push(t),F.push(E.clone()),F.push(y.clone()));break;case 2:F=F??new Array,x||(A=N[S].clone(),y=B(A,N[S+1]),E=B(A,N[S+2]),F.push(A),F.push(y),F.push(E)),e||(A=N[S+1].clone(),y=B(A,N[S+2]),E=B(A,N[S]),F.push(A),F.push(y),F.push(E)),b||(A=N[S+2].clone(),y=B(A,N[S]),E=B(A,N[S+1]),F.push(A),F.push(y),F.push(E))}}return F},j=q instanceof v.b?q:null,l=null===j||void 0===j?void 0:j._thinInstanceDataStorage.matrixData,I=(null===j||void 0===j?void 0:j.tc)||1,U=z.k.Matrix[0];U.p(z.d.IdentityReadOnly);for(let v=0;v<I;++v){if(null!==j&&void 0!==j&&j.hasThinInstances&&l){const N=16*v;U.setRowFromFloats(0,l[N+0],l[N+1],l[N+2],l[N+3]),U.setRowFromFloats(1,l[N+4],l[N+5],l[N+6],l[N+7]),U.setRowFromFloats(2,l[N+8],l[N+9],l[N+10],l[N+11]),U.setRowFromFloats(3,l[N+12],l[N+13],l[N+14],l[N+15])}const N=z.d.RotationYawPitchRoll(n,s,c).multiply(z.d.Translation(h.x,h.y,h.z)),B=z.d.Invert(N),F=q.getWorldMatrix(),A=U.multiply(F).multiply(B),y=new Array(3);for(let q=0;q<b.length;q+=3){let N=y;if(N[0]=M(q,A),N[1]=M(q+1,A),N[2]=M(q+2,A),!(R.cullBackFaces&&-N[0].k.z<=0&&-N[1].k.z<=0&&-N[2].k.z<=0)&&(N=g(N,d),N&&(N=g(N,p),N&&(N=g(N,W),N&&(N=g(N,NN),N&&(N=g(N,qN),N&&(N=g(N,RN),N)))))))for(let q=0;q<N.length;q++){const z=N[q];if(Z.indices.push(J),e?(z.localPositionOverride?(Z.xa[3*J]=z.localPositionOverride[0],Z.xa[3*J+1]=z.localPositionOverride[1],Z.xa[3*J+2]=z.localPositionOverride[2]):V&&(Z.xa[3*J]=V[z.vertexIdx],Z.xa[3*J+1]=V[z.vertexIdx+1],Z.xa[3*J+2]=V[z.vertexIdx+2]),z.localNormalOverride?(Z.ya[3*J]=z.localNormalOverride[0],Z.ya[3*J+1]=z.localNormalOverride[1],Z.ya[3*J+2]=z.localNormalOverride[2]):H&&(Z.ya[3*J]=H[z.vertexIdx],Z.ya[3*J+1]=H[z.vertexIdx+1],Z.ya[3*J+2]=H[z.vertexIdx+2])):(z.position.toArray(Z.xa,3*J),z.k.toArray(Z.ya,3*J)),Z.matricesIndices&&Z.matricesWeights&&(z.matrixIndicesOverride?(Z.matricesIndices[4*J]=z.matrixIndicesOverride[0],Z.matricesIndices[4*J+1]=z.matrixIndicesOverride[1],Z.matricesIndices[4*J+2]=z.matrixIndicesOverride[2],Z.matricesIndices[4*J+3]=z.matrixIndicesOverride[3]):(T&&(Z.matricesIndices[4*J]=T[z.vertexIdxForBones],Z.matricesIndices[4*J+1]=T[z.vertexIdxForBones+1],Z.matricesIndices[4*J+2]=T[z.vertexIdxForBones+2],Z.matricesIndices[4*J+3]=T[z.vertexIdxForBones+3]),X&&Z.matricesIndicesExtra&&(Z.matricesIndicesExtra[4*J]=X[z.vertexIdxForBones],Z.matricesIndicesExtra[4*J+1]=X[z.vertexIdxForBones+1],Z.matricesIndicesExtra[4*J+2]=X[z.vertexIdxForBones+2],Z.matricesIndicesExtra[4*J+3]=X[z.vertexIdxForBones+3])),z.matrixWeightsOverride?(Z.matricesWeights[4*J]=z.matrixWeightsOverride[0],Z.matricesWeights[4*J+1]=z.matrixWeightsOverride[1],Z.matricesWeights[4*J+2]=z.matrixWeightsOverride[2],Z.matricesWeights[4*J+3]=z.matrixWeightsOverride[3]):(L&&(Z.matricesWeights[4*J]=L[z.vertexIdxForBones],Z.matricesWeights[4*J+1]=L[z.vertexIdxForBones+1],Z.matricesWeights[4*J+2]=L[z.vertexIdxForBones+2],Z.matricesWeights[4*J+3]=L[z.vertexIdxForBones+3]),Q&&Z.matricesWeightsExtra&&(Z.matricesWeightsExtra[4*J]=Q[z.vertexIdxForBones],Z.matricesWeightsExtra[4*J+1]=Q[z.vertexIdxForBones+1],Z.matricesWeightsExtra[4*J+2]=Q[z.vertexIdxForBones+2],Z.matricesWeightsExtra[4*J+3]=Q[z.vertexIdxForBones+3]))),R.captureUVS)z.uv.toArray(Z.Aa,2*J);else{Z.Aa.push(.5+z.position.x/w.x);const N=.5+z.position.y/w.y;Z.Aa.push(S.b?1-N:N)}J++}}}0===Z.indices.length&&(Z.indices=null),0===Z.xa.length&&(Z.xa=null),0===Z.ya.length&&(Z.ya=null),0===Z.Aa.length&&(Z.Aa=null),0===(null===(A=Z.matricesIndices)||void 0===A?void 0:A.length)&&(Z.matricesIndices=null),0===(null===(y=Z.matricesWeights)||void 0===y?void 0:y.length)&&(Z.matricesWeights=null),0===(null===(E=Z.matricesIndicesExtra)||void 0===E?void 0:E.length)&&(Z.matricesIndicesExtra=null),0===(null===(t=Z.matricesWeightsExtra)||void 0===t?void 0:t.length)&&(Z.matricesWeightsExtra=null);const O=new v.b(N,q.va());return Z.Ca(O),e?(O.skeleton=q.skeleton,O.parent=q):(O.position=h.clone(),O.rotation=new z.m(s,n,c)),O.Oj(!0),O.refreshBoundingInfo(!0,!0),O}function BN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const q=0|Math.max(N.subdivisions?N.subdivisions:2,1),R=0|Math.max(N.tessellation?N.tessellation:16,3),v=Math.max(N.height?N.height:1,0),B=Math.max(N.radius?N.radius:.25,0),A=0|Math.max(N.capSubdivisions?N.capSubdivisions:6,1),y=R,E=q,t=Math.max(N.radiusTop?N.radiusTop:B,0),x=Math.max(N.radiusBottom?N.radiusBottom:B,0),e=v-(t+x),b=2*Math.PI,f=Math.max(N.topCapSubdivisions?N.topCapSubdivisions:A,1),D=Math.max(N.bottomCapSubdivisions?N.bottomCapSubdivisions:A,1),V=Math.acos((x-t)/v);let H=[];const Y=[],T=[],L=[];let X=0;const Q=[],h=.5*e,u=.5*Math.PI;let w,c;const n=z.m.Zero(),G=z.m.Zero(),s=Math.cos(V),Z=Math.sin(V),J=new z.l(t*Z,h+t*s).gd(new z.l(x*Z,x*s-h)).length(),M=t*V+J+x*(u-V);let m=0;for(c=0;c<=f;c++){const N=[],q=u-V*(c/f);m+=t*V/f;const R=Math.cos(q),z=Math.sin(q),v=R*t;for(w=0;w<=y;w++){const q=w/y,B=q*b+0,F=Math.sin(B),A=Math.cos(B);G.x=v*F,G.y=h+z*t,G.z=v*A,Y.push(G.x,G.y,G.z),n.set(R*F,z,R*A),T.push(n.x,n.y,n.z),L.push(q,S.b?m/M:1-m/M),N.push(X),X++}Q.push(N)}const g=v-t-x+s*t-s*x,j=Z*(x-t)/g;for(c=1;c<=E;c++){const N=[];m+=J/E;const q=Z*(c*(x-t)/E+t);for(w=0;w<=y;w++){const R=w/y,z=R*b+0,v=Math.sin(z),B=Math.cos(z);G.x=q*v,G.y=h+s*t-c*g/E,G.z=q*B,Y.push(G.x,G.y,G.z),n.set(v,j,B).normalize(),T.push(n.x,n.y,n.z),L.push(R,S.b?m/M:1-m/M),N.push(X),X++}Q.push(N)}for(c=1;c<=D;c++){const N=[],q=u-V-(Math.PI-V)*(c/D);m+=x*V/D;const R=Math.cos(q),z=Math.sin(q),v=R*x;for(w=0;w<=y;w++){const q=w/y,B=q*b+0,F=Math.sin(B),A=Math.cos(B);G.x=v*F,G.y=z*x-h,G.z=v*A,Y.push(G.x,G.y,G.z),n.set(R*F,z,R*A),T.push(n.x,n.y,n.z),L.push(q,S.b?m/M:1-m/M),N.push(X),X++}Q.push(N)}for(w=0;w<y;w++)for(c=0;c<f+E+D;c++){const N=Q[c][w],q=Q[c+1][w],R=Q[c+1][w+1],z=Q[c][w+1];H.push(N),H.push(q),H.push(z),H.push(q),H.push(R),H.push(z)}if(H=H.reverse(),N.orientation&&!N.orientation.equals(z.m.Up())){const q=new z.d;N.orientation.clone().scale(.5*Math.PI).cross(z.m.Up()).toQuaternion().toRotationMatrix(q);const R=z.m.Zero();for(let N=0;N<Y.length;N+=3)R.set(Y[N],Y[N+1],Y[N+2]),z.m.TransformCoordinatesToRef(R.clone(),q,R),Y[N]=R.x,Y[N+1]=R.y,Y[N+2]=R.z}const l=new F.e;return l.xa=Y,l.ya=T,l.Aa=L,l.indices=H,l}function FN(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:z.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new v.b(N,R);return BN(q).Ca(B,q.updatable),B}v.b.CreateDecal=(N,q,R,z,v,B)=>vN(N,q,{position:R,k:z,size:v,angle:B});v.b.CreateCapsule=(N,q,R)=>FN(N,q,R),F.e.CreateCapsule=BN;class SN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=N,this.y=q,N!==Math.floor(N)&&(N=Math.floor(N),c.c.Warn("x is not an integer, floor(x) used")),q!==Math.floor(q)&&(q=Math.floor(q),c.c.Warn("y is not an integer, floor(y) used"))}clone(){return new SN(this.x,this.y)}rotate60About(N){const q=this.x;return this.x=N.x+N.y-this.y,this.y=q+this.y-N.x,this}rotateNeg60About(N){const q=this.x;return this.x=q+this.y-N.y,this.y=N.x+N.y-q,this}rotate120(N,q){N!==Math.floor(N)&&(N=Math.floor(N),c.c.Warn("m not an integer only floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),c.c.Warn("n not an integer only floor(n) used"));const R=this.x;return this.x=N-R-this.y,this.y=q+R,this}rotateNeg120(N,q){N!==Math.floor(N)&&(N=Math.floor(N),c.c.Warn("m is not an integer, floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),c.c.Warn("n is not an integer,   floor(n) used"));const R=this.x;return this.x=this.y-q,this.y=N+q-R-this.y,this}toCartesianOrigin(N,q){const R=z.m.Zero();return R.x=N.x+2*this.x*q+this.y*q,R.y=N.y+Math.sqrt(3)*this.y*q,R}static Zero(){return new SN(0,0)}}class AN{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new yN("icosahedron","Regular",[[0,G.f,-1],[-G.f,1,0],[-1,0,-G.f],[1,0,-G.f],[G.f,1,0],[0,G.f,1],[-1,0,G.f],[-G.f,-1,0],[0,-G.f,-1],[G.f,-1,0],[1,0,G.f],[0,-G.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let N=12;const q={},R=this.m,z=this.n;let v,B,F,S,A,y=R,E=1,t=0;0!==z&&(y=(0,a.i)(R,z)),E=R/y,t=z/y;const x=SN.Zero(),e=new SN(R,z),b=new SN(-z,R+z),f=SN.Zero(),D=SN.Zero(),V=SN.Zero();let H,Y,T,L,X=[];const Q=[],h=this.vertByDist,u=(R,z,v,B)=>{H=R+"|"+v,Y=z+"|"+B,H in q||Y in q?H in q&&!(Y in q)?q[Y]=q[H]:Y in q&&!(H in q)&&(q[H]=q[Y]):(q[H]=N,q[Y]=N,N++),h[v][0]>2?Q[q[H]]=[-h[v][0],h[v][1],q[H]]:Q[q[H]]=[X[h[v][0]],h[v][1],q[H]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let w=0;w<20;w++){if(X=this.IDATA.face[w],F=X[2],S=X[1],A=X[0],T=x.x+"|"+x.y,H=w+"|"+T,H in q||(q[H]=F,Q[F]=[X[h[T][0]],h[T][1]]),T=e.x+"|"+e.y,H=w+"|"+T,H in q||(q[H]=S,Q[S]=[X[h[T][0]],h[T][1]]),T=b.x+"|"+b.y,H=w+"|"+T,H in q||(q[H]=A,Q[A]=[X[h[T][0]],h[T][1]]),v=this.IDATA.edgematch[w][0],B=this.IDATA.edgematch[w][1],"B"===B)for(let N=1;N<y;N++)D.x=R-N*(E+t),D.y=z+N*E,V.x=-N*t,V.y=N*(E+t),T=D.x+"|"+D.y,L=V.x+"|"+V.y,u(w,v,T,L);if("O"===B)for(let N=1;N<y;N++)V.x=-N*t,V.y=N*(E+t),f.x=N*E,f.y=N*t,T=V.x+"|"+V.y,L=f.x+"|"+f.y,u(w,v,T,L);if(v=this.IDATA.edgematch[w][2],B=this.IDATA.edgematch[w][3],B&&"A"===B)for(let N=1;N<y;N++)f.x=N*E,f.y=N*t,D.x=R-(y-N)*(E+t),D.y=z+(y-N)*E,T=f.x+"|"+f.y,L=D.x+"|"+D.y,u(w,v,T,L);for(let R=0;R<this.vertices.length;R++)T=this.vertices[R].x+"|"+this.vertices[R].y,H=w+"|"+T,H in q||(q[H]=N++,h[T][0]>2?Q[q[H]]=[-h[T][0],h[T][1],q[H]]:Q[q[H]]=[X[h[T][0]],h[T][1],q[H]])}this.closestTo=Q,this.vecToidx=q}calcCoeffs(){const N=this.m,q=this.n,R=Math.sqrt(3)/3,z=N*N+q*q+N*q;this.coau=(N+q)/z,this.cobu=-q/z,this.coav=-R*(N-q)/z,this.cobv=R*(2*N+q)/z}createInnerFacets(){const N=this.m,q=this.n;for(let R=0;R<q+N+1;R++)for(let N=this.min[R];N<this.max[R]+1;N++)N<this.max[R]&&N<this.max[R+1]+1&&this.innerFacets.push(["|"+N+"|"+R,"|"+N+"|"+(R+1),"|"+(N+1)+"|"+R]),R>0&&N<this.max[R-1]&&N+1<this.max[R]+1&&this.innerFacets.push(["|"+N+"|"+R,"|"+(N+1)+"|"+R,"|"+(N+1)+"|"+(R-1)])}edgeVecsABOB(){const N=this.m,q=this.n,R=new SN(-q,N+q);for(let z=1;z<N+q;z++){const N=new SN(this.min[z],z),q=new SN(this.min[z-1],z-1),v=new SN(this.min[z+1],z+1),B=N.clone(),F=q.clone(),S=v.clone();B.rotate60About(R),F.rotate60About(R),S.rotate60About(R);const A=new SN(this.max[B.y],B.y),y=new SN(this.max[B.y-1],B.y-1),E=new SN(this.max[B.y-1]-1,B.y-1);B.x===A.x&&B.y===A.y||(B.x!==y.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,y,E]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,E,A])):B.y===S.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,q,y]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([N,y,v])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,q,y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,y,A])))}}mapABOBtoOBOA(){const N=new SN(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const R=[];for(let z=0;z<3;z++)N.x=this.isoVecsABOB[q][z].x,N.y=this.isoVecsABOB[q][z].y,0===this.vertexTypes[q][z]&&N.rotateNeg120(this.m,this.n),R.push(N.clone());this.isoVecsOBOA.push(R)}}mapABOBtoBAOA(){const N=new SN(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const R=[];for(let z=0;z<3;z++)N.x=this.isoVecsABOB[q][z].x,N.y=this.isoVecsABOB[q][z].y,1===this.vertexTypes[q][z]&&N.rotate120(this.m,this.n),R.push(N.clone());this.isoVecsBAOA.push(R)}}MapToFace(N,q){const R=this.IDATA.face[N],v=R[2],B=R[1],F=R[0],S=z.m.Zg(this.IDATA.vertex[v]),A=z.m.Zg(this.IDATA.vertex[B]),y=z.m.Zg(this.IDATA.vertex[F]),E=A.gd(S),t=y.gd(S),x=E.scale(this.coau).add(t.scale(this.cobu)),e=E.scale(this.coav).add(t.scale(this.cobv)),b=[];let f,D=z.k.o[0];for(let z=0;z<this.cartesian.length;z++)D=x.scale(this.cartesian[z].x).add(e.scale(this.cartesian[z].y)).add(S),b[z]=[D.x,D.y,D.z],f=N+"|"+this.vertices[z].x+"|"+this.vertices[z].y,q.vertex[this.vecToidx[f]]=[D.x,D.y,D.z]}build(N,q){const R=[],z=SN.Zero(),v=new SN(N,q),B=new SN(-q,N+q);R.push(z,v,B);for(let T=q;T<N+1;T++)for(let q=0;q<N+1-T;q++)R.push(new SN(q,T));if(q>0){const z=(0,a.i)(N,q),v=N/z,B=q/z;for(let S=1;S<z;S++)R.push(new SN(S*v,S*B)),R.push(new SN(-S*B,S*(v+B))),R.push(new SN(N-S*(v+B),q+S*v));const F=N/q;for(let S=1;S<q;S++)for(let z=0;z<S*F;z++)R.push(new SN(z,S)),R.push(new SN(z,S).rotate120(N,q)),R.push(new SN(z,S).rotateNeg120(N,q))}R.sort(((N,q)=>N.x-q.x)),R.sort(((N,q)=>N.y-q.y));const F=new Array(N+q+1),S=new Array(N+q+1);for(let T=0;T<F.length;T++)F[T]=1/0,S[T]=-1/0;let A=0,y=0;const E=R.length;for(let T=0;T<E;T++)y=R[T].x,A=R[T].y,F[A]=Math.min(y,F[A]),S[A]=Math.max(y,S[A]);const t=(R,z)=>{const v=R.clone();return"A"===z&&v.rotateNeg120(N,q),"B"===z&&v.rotate120(N,q),v.x<0?v.y:v.x+v.y},x=[],e=[],b=[],f=[],D={},V=[];let H=-1,Y=-1;for(let T=0;T<E;T++)x[T]=R[T].toCartesianOrigin(new SN(0,0),.5),e[T]=t(R[T],"O"),b[T]=t(R[T],"A"),f[T]=t(R[T],"B"),e[T]===b[T]&&b[T]===f[T]?(H=3,Y=e[T]):e[T]===b[T]?(H=4,Y=e[T]):b[T]===f[T]?(H=5,Y=b[T]):f[T]===e[T]&&(H=6,Y=e[T]),e[T]<b[T]&&e[T]<f[T]&&(H=2,Y=e[T]),b[T]<e[T]&&b[T]<f[T]&&(H=1,Y=b[T]),f[T]<b[T]&&f[T]<e[T]&&(H=0,Y=f[T]),V.push([H,Y,R[T].x,R[T].y]);V.sort(((N,q)=>N[2]-q[2])),V.sort(((N,q)=>N[3]-q[3])),V.sort(((N,q)=>N[1]-q[1])),V.sort(((N,q)=>N[0]-q[0]));for(let T=0;T<V.length;T++)D[V[T][2]+"|"+V[T][3]]=[V[T][0],V[T][1],T];return this.m=N,this.n=q,this.vertices=R,this.vertByDist=D,this.cartesian=x,this.min=F,this.max=S,this}}class yN{constructor(N,q,R,z){this.name=N,this.category=q,this.vertex=R,this.face=z}}class EN extends yN{innerToData(N,q){for(let R=0;R<q.innerFacets.length;R++)this.face.push(q.innerFacets[R].map((R=>q.vecToidx[N+R])))}mapABOBtoDATA(N,q){const R=q.IDATA.edgematch[N][0];for(let z=0;z<q.isoVecsABOB.length;z++){const v=[];for(let B=0;B<3;B++)0===q.vertexTypes[z][B]?v.push(N+"|"+q.isoVecsABOB[z][B].x+"|"+q.isoVecsABOB[z][B].y):v.push(R+"|"+q.isoVecsABOB[z][B].x+"|"+q.isoVecsABOB[z][B].y);this.face.push([q.vecToidx[v[0]],q.vecToidx[v[1]],q.vecToidx[v[2]]])}}mapOBOAtoDATA(N,q){const R=q.IDATA.edgematch[N][0];for(let z=0;z<q.isoVecsOBOA.length;z++){const v=[];for(let B=0;B<3;B++)1===q.vertexTypes[z][B]?v.push(N+"|"+q.isoVecsOBOA[z][B].x+"|"+q.isoVecsOBOA[z][B].y):v.push(R+"|"+q.isoVecsOBOA[z][B].x+"|"+q.isoVecsOBOA[z][B].y);this.face.push([q.vecToidx[v[0]],q.vecToidx[v[1]],q.vecToidx[v[2]]])}}mapBAOAtoDATA(N,q){const R=q.IDATA.edgematch[N][2];for(let z=0;z<q.isoVecsBAOA.length;z++){const v=[];for(let B=0;B<3;B++)1===q.vertexTypes[z][B]?v.push(N+"|"+q.isoVecsBAOA[z][B].x+"|"+q.isoVecsBAOA[z][B].y):v.push(R+"|"+q.isoVecsBAOA[z][B].x+"|"+q.isoVecsBAOA[z][B].y);this.face.push([q.vecToidx[v[0]],q.vecToidx[v[1]],q.vecToidx[v[2]]])}}orderData(N){const q=[];for(let B=0;B<13;B++)q[B]=[];const R=N.closestTo;for(let B=0;B<R.length;B++)R[B][0]>-1?R[B][1]>0&&q[R[B][0]].push([B,R[B][1]]):q[12].push([B,R[B][0]]);const z=[];for(let B=0;B<12;B++)z[B]=B;let v=12;for(let B=0;B<12;B++){q[B].sort(((N,q)=>N[1]-q[1]));for(let N=0;N<q[B].length;N++)z[q[B][N][0]]=v++}for(let B=0;B<q[12].length;B++)z[q[12][B][0]]=v++;for(let B=0;B<this.vertex.length;B++)this.vertex[B].push(z[B]);this.vertex.sort(((N,q)=>N[3]-q[3]));for(let B=0;B<this.vertex.length;B++)this.vertex[B].pop();for(let B=0;B<this.face.length;B++)for(let N=0;N<this.face[B].length;N++)this.face[B][N]=z[this.face[B][N]];this.sharedNodes=q[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(N,q){const R=[],z=[];let v=q.pop();z.push(v);let B=this.face[v].indexOf(N);B=(B+2)%3;let F=this.face[v][B];R.push(F);let S=0;for(;q.length>0;)v=q[S],this.face[v].indexOf(F)>-1?(B=(this.face[v].indexOf(F)+1)%3,F=this.face[v][B],R.push(F),z.push(v),q.splice(S,1),S=0):S++;return this.adjacentFaces.push(R),z}toGoldbergPolyhedronData(){const N=new yN("GeoDual","Goldberg",[],[]);N.name="GD dual";const q=this.vertex.length,R=new Array(q);for(let A=0;A<q;A++)R[A]=[];for(let A=0;A<this.face.length;A++)for(let N=0;N<3;N++)R[this.face[A][N]].push(A);let z=0,v=0,B=0,F=[],S=[];this.adjacentFaces=[];for(let A=0;A<R.length;A++)N.face[A]=this.setOrder(A,R[A].concat([])),R[A].forEach((q=>{z=0,v=0,B=0,F=this.face[q];for(let N=0;N<3;N++)S=this.vertex[F[N]],z+=S[0],v+=S[1],B+=S[2];N.vertex[q]=[z/3,v/3,B/3]}));return N}static BuildGeodesicData(N){const q=new EN("Geodesic-m-n","Geodesic",[[0,G.f,-1],[-G.f,1,0],[-1,0,-G.f],[1,0,-G.f],[G.f,1,0],[0,G.f,1],[-1,0,G.f],[-G.f,-1,0],[0,-G.f,-1],[G.f,-1,0],[1,0,G.f],[0,-G.f,1]],[]);N.setIndices(),N.calcCoeffs(),N.createInnerFacets(),N.edgeVecsABOB(),N.mapABOBtoOBOA(),N.mapABOBtoBAOA();for(let R=0;R<N.IDATA.face.length;R++)N.MapToFace(R,q),q.innerToData(R,N),"B"===N.IDATA.edgematch[R][1]&&q.mapABOBtoDATA(R,N),"O"===N.IDATA.edgematch[R][1]&&q.mapOBOAtoDATA(R,N),"A"===N.IDATA.edgematch[R][3]&&q.mapBAOAtoDATA(R,N);q.orderData(N);return q.vertex=q.vertex.map((function(N){const q=N[0],R=N[1],z=N[2],v=Math.sqrt(q*q+R*R+z*z);return N[0]*=1/v,N[1]*=1/v,N[2]*=1/v,N})),q}}v.b._GoldbergMeshParser=(N,q)=>tN.Parse(N,q);class tN extends v.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(N,q){return void 0===q?(N>this.goldbergData.nbUnsharedFaces-1&&(c.c.Warn("Maximum number of unshared faces used"),N=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+N):(N>11&&(c.c.Warn("Last pole used"),N=11),q>this.goldbergData.nbFacesAtPole-1&&(c.c.Warn("Maximum number of faces at a pole used"),q=this.goldbergData.nbFacesAtPole-1),12+N*this.goldbergData.nbFacesAtPole+q)}_changeGoldbergFaceColors(N){for(let R=0;R<N.length;R++){const q=N[R][0],z=N[R][1],v=N[R][2];for(let N=q;N<z+1;N++)this.goldbergData.faceColors[N]=v}const q=[];for(let R=0;R<12;R++)for(let N=0;N<5;N++)q.push(this.goldbergData.faceColors[R].r,this.goldbergData.faceColors[R].g,this.goldbergData.faceColors[R].b,this.goldbergData.faceColors[R].a);for(let R=12;R<this.goldbergData.faceColors.length;R++)for(let N=0;N<6;N++)q.push(this.goldbergData.faceColors[R].r,this.goldbergData.faceColors[R].g,this.goldbergData.faceColors[R].b,this.goldbergData.faceColors[R].a);return q}setGoldbergFaceColors(N){const q=this._changeGoldbergFaceColors(N);this.Ga(B.h.ColorKind,q)}updateGoldbergFaceColors(N){const q=this._changeGoldbergFaceColors(N);this.updateVerticesData(B.h.ColorKind,q)}_changeGoldbergFaceUVs(N){const q=this.getVerticesData(B.h.UVKind);for(let R=0;R<N.length;R++){const z=N[R][0],v=N[R][1],B=N[R][2],F=N[R][3],S=N[R][4],A=[],y=[];let E,t;for(let N=0;N<5;N++)E=B.x+F*Math.cos(S+N*Math.PI/2.5),t=B.y+F*Math.sin(S+N*Math.PI/2.5),E<0&&(E=0),E>1&&(E=1),A.push(E,t);for(let N=0;N<6;N++)E=B.x+F*Math.cos(S+N*Math.PI/3),t=B.y+F*Math.sin(S+N*Math.PI/3),E<0&&(E=0),E>1&&(E=1),y.push(E,t);for(let N=z;N<Math.min(12,v+1);N++)for(let R=0;R<5;R++)q[10*N+2*R]=A[2*R],q[10*N+2*R+1]=A[2*R+1];for(let N=Math.max(12,z);N<v+1;N++)for(let R=0;R<6;R++)q[12*N-24+2*R]=y[2*R],q[12*N-23+2*R]=y[2*R+1]}return q}setGoldbergFaceUVs(N){const q=this._changeGoldbergFaceUVs(N);this.Ga(B.h.UVKind,q)}updateGoldbergFaceUVs(N){const q=this._changeGoldbergFaceUVs(N);this.updateVerticesData(B.h.UVKind,q)}placeOnGoldbergFaceAt(N,q,R){const v=z.m.RotationFromAxis(this.goldbergData.faceXaxis[q],this.goldbergData.faceYaxis[q],this.goldbergData.faceZaxis[q]);N.rotation=v,N.position=this.goldbergData.faceCenters[q].add(this.goldbergData.faceXaxis[q].scale(R.x)).add(this.goldbergData.faceYaxis[q].scale(R.y)).add(this.goldbergData.faceZaxis[q].scale(R.z))}serialize(N){super.serialize(N),N.type="GoldbergMesh";const q={};if(q.adjacentFaces=this.goldbergData.adjacentFaces,q.nbSharedFaces=this.goldbergData.nbSharedFaces,q.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,q.nbFaces=this.goldbergData.nbFaces,q.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){q.faceColors=[];for(const N of this.goldbergData.faceColors)q.faceColors.push(N.ij())}if(this.goldbergData.faceCenters){q.faceCenters=[];for(const N of this.goldbergData.faceCenters)q.faceCenters.push(N.ij())}if(this.goldbergData.faceZaxis){q.faceZaxis=[];for(const N of this.goldbergData.faceZaxis)q.faceZaxis.push(N.ij())}if(this.goldbergData.faceYaxis){q.faceYaxis=[];for(const N of this.goldbergData.faceYaxis)q.faceYaxis.push(N.ij())}if(this.goldbergData.faceXaxis){q.faceXaxis=[];for(const N of this.goldbergData.faceXaxis)q.faceXaxis.push(N.ij())}N.goldbergData=q}static Parse(N,q){const R=N.goldbergData;R.faceColors=R.faceColors.map((N=>x.g.Zg(N))),R.faceCenters=R.faceCenters.map((N=>z.m.Zg(N))),R.faceZaxis=R.faceZaxis.map((N=>z.m.Zg(N))),R.faceXaxis=R.faceXaxis.map((N=>z.m.Zg(N))),R.faceYaxis=R.faceYaxis.map((N=>z.m.Zg(N)));const v=new tN(N.name,q);return v.goldbergData=R,v}}var xN=R(11486);class eN{constructor(N){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=N}moveTo(N,q){this._currentPath=new n.d(N,q),this._tempPaths.push(this._currentPath)}lineTo(N,q){this._currentPath.addLineTo(N,q)}quadraticCurveTo(N,q,R,z){this._currentPath.addQuadraticCurveTo(N,q,R,z,this._resolution)}bezierCurveTo(N,q,R,z,v,B){this._currentPath.addBezierCurveTo(N,q,R,z,v,B,this._resolution)}extractHoles(){for(const N of this._tempPaths)N.area()>0?this._holes.push(N):this._paths.push(N);if(!this._paths.length&&this._holes.length){const N=this._holes;this._holes=this._paths,this._paths=N}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function bN(N,q,R,z,v,B){const F=B.glyphs[N]||B.glyphs["?"];if(!F)return null;const S=new eN(v);if(F.o){const N=F.o.split(" ");for(let v=0,B=N.length;v<B;){switch(N[v++]){case"m":{const B=parseInt(N[v++])*q+R,F=parseInt(N[v++])*q+z;S.moveTo(B,F);break}case"l":{const B=parseInt(N[v++])*q+R,F=parseInt(N[v++])*q+z;S.lineTo(B,F);break}case"q":{const B=parseInt(N[v++])*q+R,F=parseInt(N[v++])*q+z,A=parseInt(N[v++])*q+R,y=parseInt(N[v++])*q+z;S.quadraticCurveTo(A,y,B,F);break}case"b":{const B=parseInt(N[v++])*q+R,F=parseInt(N[v++])*q+z,A=parseInt(N[v++])*q+R,y=parseInt(N[v++])*q+z,E=parseInt(N[v++])*q+R,t=parseInt(N[v++])*q+z;S.bezierCurveTo(A,y,E,t,B,F);break}}}}return S.extractHoles(),{offsetX:F.ha*q,shapePath:S}}const fN={CreateBox:t.d,CreateTiledBox:D,CreateSphere:V.c,CreateDisc:E.b,CreateIcoSphere:r,CreateRibbon:y,CreateCylinder:L,CreateTorus:Q,CreateTorusKnot:u,CreateLineSystem:w.f,pb:w.i,CreateDashedLines:w.c,ExtrudeShape:l,ExtrudeShapeCustom:I,CreateLathe:O,CreateTiledPlane:b,ng:i.c,CreateGround:P.c,CreateTiledGround:P.e,CreateGroundFromHeightMap:P.b,CreatePolygon:g,ExtrudePolygon:j,CreateTube:k,CreatePolyhedron:C,CreateGeodesic:function(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=q.m||1;z!==Math.floor(z)&&(z=Math.floor(z),c.c.Warn("m not an integer only floor(m) used"));let v=q.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),c.c.Warn("n not an integer only floor(n) used")),v>z){const N=v;v=z,z=N,c.c.Warn("n > m therefore m and n swapped")}const B=new AN;return B.build(z,v),C(N,{custom:EN.BuildGeodesicData(B),size:q.size,sizeX:q.sizeX,sizeY:q.sizeY,sizeZ:q.sizeZ,faceUV:q.faceUV,faceColors:q.faceColors,flat:q.flat,updatable:q.updatable,sideOrientation:q.sideOrientation,frontUVs:q.frontUVs,backUVs:q.backUVs},R)},CreateGoldberg:function(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.size,A=q.sizeX||B||1,y=q.sizeY||B||1,E=q.sizeZ||B||1;let t=q.m||1;t!==Math.floor(t)&&(t=Math.floor(t),c.c.Warn("m not an integer only floor(m) used"));let e=q.n||0;if(e!==Math.floor(e)&&(e=Math.floor(e),c.c.Warn("n not an integer only floor(n) used")),e>t){const N=e;e=t,t=N,c.c.Warn("n > m therefore m and n swapped")}const b=new AN;b.build(t,e);const f=EN.BuildGeodesicData(b),D=f.toGoldbergPolyhedronData(),V=new tN(N,R);q.sideOrientation=v.b._GetDefaultSideOrientation(q.sideOrientation),V._originalBuilderSideOrientation=q.sideOrientation;(function(N,q){const R=N.size,v=N.sizeX||R||1,B=N.sizeY||R||1,A=N.sizeZ||R||1,y=0===N.sideOrientation?0:N.sideOrientation||F.e.DEFAULTSIDE,E=[],t=[],x=[],e=[];let b=1/0,f=-1/0,D=1/0,V=-1/0;for(let z=0;z<q.vertex.length;z++)b=Math.min(b,q.vertex[z][0]*v),f=Math.max(f,q.vertex[z][0]*v),D=Math.min(D,q.vertex[z][1]*B),V=Math.max(V,q.vertex[z][1]*B);let H=0;for(let F=0;F<q.face.length;F++){const N=q.face[F],R=z.m.Zg(q.vertex[N[0]]),y=z.m.Zg(q.vertex[N[2]]),Y=z.m.Zg(q.vertex[N[1]]),T=y.gd(R),L=Y.gd(R),X=z.m.Cross(L,T).normalize();for(let z=0;z<N.length;z++){x.push(X.x,X.y,X.z);const R=q.vertex[N[z]];E.push(R[0]*v,R[1]*B,R[2]*A);const F=(R[1]*B-D)/(V-D);e.push((R[0]*v-b)/(f-b),S.b?1-F:F)}for(let q=0;q<N.length-2;q++)t.push(H,H+q+2,H+q+1);H+=N.length}F.e._ComputeSides(y,E,t,x,e);const Y=new F.e;return Y.xa=E,Y.indices=t,Y.ya=x,Y.Aa=e,Y})(q,D).Ca(V,q.updatable),V.goldbergData.nbSharedFaces=f.sharedNodes,V.goldbergData.nbUnsharedFaces=f.poleNodes,V.goldbergData.adjacentFaces=f.adjacentFaces,V.goldbergData.nbFaces=V.goldbergData.nbSharedFaces+V.goldbergData.nbUnsharedFaces,V.goldbergData.nbFacesAtPole=(V.goldbergData.nbUnsharedFaces-12)/12;for(let v=0;v<f.vertex.length;v++)V.goldbergData.faceCenters.push(z.m.Zg(f.vertex[v])),V.goldbergData.faceCenters[v].x*=A,V.goldbergData.faceCenters[v].y*=y,V.goldbergData.faceCenters[v].z*=E,V.goldbergData.faceColors.push(new x.g(1,1,1,1));for(let v=0;v<D.face.length;v++){const N=D.face[v],q=z.m.Zg(D.vertex[N[0]]),R=z.m.Zg(D.vertex[N[2]]),B=z.m.Zg(D.vertex[N[1]]),F=R.gd(q),S=B.gd(q),A=z.m.Cross(S,F).normalize(),y=z.m.Cross(S,A).normalize();V.goldbergData.faceXaxis.push(S.normalize()),V.goldbergData.faceYaxis.push(A),V.goldbergData.faceZaxis.push(y)}return V},CreateDecal:vN,CreateCapsule:FN,CreateText:function(N,q,R){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const A=function(N,q,R,z){const v=Array.from(N),B=q/z.resolution,F=(z.boundingBox.yMax-z.boundingBox.yMin+z.underlineThickness)*B,S=[];let A=0,y=0;for(let E=0;E<v.length;E++){const N=v[E];if("\n"===N)A=0,y-=F;else{const q=bN(N,B,A,y,R,z);q&&(A+=q.offsetX,S.push(q.shapePath))}}return S}(q,B.size||50,B.resolution||8,R),y=[];let E=0;for(const b of A){if(!b.paths.length)continue;const q=b.holes.slice();for(const R of b.paths){var t,x;const A=[],e=[],b=R.getPoints();for(const N of b)e.push(new z.m(N.x,0,N.y));const f=q.slice();for(const N of f){const v=N.getPoints();let B=!1;for(const N of v)if(R.isPointInside(N)){B=!0;break}if(!B)continue;const F=[];for(const N of v)F.push(new z.m(N.x,0,N.y));A.push(F),q.splice(q.indexOf(N),1)}if(!A.length&&q.length)for(const N of q){const q=N.getPoints(),R=[];for(const N of q)R.push(new z.m(N.x,0,N.y));A.push(R)}const D=j(N,{shape:e,holes:A.length?A:void 0,depth:B.depth||1,faceUV:B.faceUV||(null===(t=B.perLetterFaceUV)||void 0===t?void 0:t.call(B,E)),faceColors:B.faceColors||(null===(x=B.perLetterFaceColors)||void 0===x?void 0:x.call(B,E)),sideOrientation:v.b._GetDefaultSideOrientation(B.sideOrientation||v.b.DOUBLESIDE)},F,S);y.push(D),E++}}const e=v.b.MergeMeshes(y,!0,!0);if(e){const q=e.getBoundingInfo().boundingBox;e.position.x+=-(q.minimumWorld.x+q.maximumWorld.x)/2,e.position.y+=-(q.minimumWorld.y+q.maximumWorld.y)/2,e.position.z+=-(q.minimumWorld.z+q.maximumWorld.z)/2+q.extendSize.z,e.name=N;const R=new xN.e("pivot",F);R.rotation.x=-Math.PI/2,e.parent=R,e.bakeCurrentTransformIntoVertices(),e.parent=null,R.dispose()}return e}}},11335:(N,q,R)=>{"use strict";R.d(q,{e:()=>A});var z=R(11251),v=R(11338),B=R(11344),F=R(11362),S=R(11370);class A{get materialDefines(){var N;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(N=this._getDrawWrapper())||void 0===N?void 0:N.defines}set materialDefines(N){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=N}_getDrawWrapper(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N??this._engine.currentRenderPassId;let R=this._drawWrappers[N];return!R&&q&&(this._drawWrappers[N]=R=new S.e(this._mesh.va().getEngine())),R}_removeDrawWrapper(N){var q;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(q=this._drawWrappers[N])||void 0===q||q.dispose());this._drawWrappers[N]=void 0}get effect(){var N;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(N=this._getDrawWrapper())||void 0===N?void 0:N.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(N){this._mainDrawWrapperOverride=N}setEffect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const v=this._drawWrapper;v.setEffect(N,q,z),void 0!==R&&(v.materialContext=R),N||(v.defines=null,v.materialContext=void 0)}resetDrawCache(N){if(this._drawWrappers){if(void 0!==N)return void this._removeDrawWrapper(N);for(const N of this._drawWrappers)null===N||void 0===N||N.dispose()}this._drawWrappers=[]}static AddToMesh(N,q,R,z,v,B,F){return new A(N,q,R,z,v,B,F,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(N,q,R,z,v,B,F){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],A=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=N,this.verticesStart=q,this.verticesCount=R,this.indexStart=z,this.indexCount=v,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=B,this._renderingMesh=F||B,A&&B.lg.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=B.lg.length-1,S&&(this.refreshBoundingInfo(),B.Oj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(N){return this._boundingInfo=N,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const N=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return N||this._renderingMesh}Ha(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const q=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!q)return N?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(q)){const N=q.getSubMaterial(this.materialIndex);return this._currentMaterial!==N&&(this._currentMaterial=N,this.resetDrawCache()),N}return q}_isMultiMaterial(N){return void 0!==N.getSubMaterial}refreshBoundingInfo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Dj)return this;if(N||(N=this._renderingMesh.getVerticesData(z.h.PositionKind)),!N)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const q=this._renderingMesh.gg();let R;if(0===this.indexStart&&this.indexCount===q.length){const N=this._renderingMesh.getBoundingInfo();R={minimum:N.minimum.clone(),maximum:N.maximum.clone()}}else R=(0,F.e)(N,q,this.indexStart,this.indexCount,this._renderingMesh.Dj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new B.e(R.minimum,R.maximum),this}_checkCollision(N){return this.getBoundingInfo()._checkCollision(N)}updateBoundingInfo(N){let q=this.getBoundingInfo();return q||(this.refreshBoundingInfo(),q=this.getBoundingInfo()),q&&q.update(N),this}isInFrustum(N){const q=this.getBoundingInfo();return!!q&&q.isInFrustum(N,this._mesh.Di)}isCompletelyInFrustum(N){const q=this.getBoundingInfo();return!!q&&q.isCompletelyInFrustum(N)}render(N){return this._renderingMesh.render(this,N,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(N,q){if(!this._linesIndexBuffer){const R=[];for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=3)R.push(N[q],N[q+1],N[q+1],N[q+2],N[q+2],N[q]);this._linesIndexBuffer=q.createIndexBuffer(R),this._linesIndexCount=R.length}return this._linesIndexBuffer}canIntersects(N){const q=this.getBoundingInfo();return!!q&&N.intersectsBox(q.boundingBox)}intersects(N,q,R,z,v){const B=this.Ha();if(!B)return null;let F=3,S=!1;switch(B.fillMode){case 3:case 5:case 6:case 8:return null;case 7:F=1,S=!0}return 4===B.fillMode?R.length?this._intersectLines(N,q,R,this._mesh.intersectionThreshold,z):this._intersectUnIndexedLines(N,q,R,this._mesh.intersectionThreshold,z):!R.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(N,q,R,z,v):this._intersectTriangles(N,q,R,F,S,z,v)}_intersectLines(N,q,R,z,B){let F=null;for(let S=this.indexStart;S<this.indexStart+this.indexCount;S+=2){const A=q[R[S]],y=q[R[S+1]],E=N.intersectionSegment(A,y,z);if(!(E<0)&&((B||!F||E<F.distance)&&(F=new v.d(null,null,E),F.faceId=S/2,B)))break}return F}_intersectUnIndexedLines(N,q,R,z,B){let F=null;for(let S=this.verticesStart;S<this.verticesStart+this.verticesCount;S+=2){const R=q[S],A=q[S+1],y=N.intersectionSegment(R,A,z);if(!(y<0)&&((B||!F||y<F.distance)&&(F=new v.d(null,null,y),F.faceId=S/2,B)))break}return F}_intersectTriangles(N,q,R,z,v,B,F){let S=null,A=-1;for(let y=this.indexStart;y<this.indexStart+this.indexCount-(3-z);y+=z){A++;const z=R[y],E=R[y+1],t=R[y+2];if(v&&4294967295===t){y+=2;continue}const x=q[z],e=q[E],b=q[t];if(!x||!e||!b)continue;if(F&&!F(x,e,b,N,z,E,t))continue;const f=N.intersectsTriangle(x,e,b);if(f){if(f.distance<0)continue;if((B||!S||f.distance<S.distance)&&(S=f,S.faceId=A,B))break}}return S}_intersectUnIndexedTriangles(N,q,R,z,v){let B=null;for(let F=this.verticesStart;F<this.verticesStart+this.verticesCount;F+=3){const R=q[F],S=q[F+1],A=q[F+2];if(v&&!v(R,S,A,N,-1,-1,-1))continue;const y=N.intersectsTriangle(R,S,A);if(y){if(y.distance<0)continue;if((z||!B||y.distance<B.distance)&&(B=y,B.faceId=F/3,z))break}}return B}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(N,q){const R=new A(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,N,q,!1);if(!this.IsGlobal){const N=this.getBoundingInfo();if(!N)return R;R._boundingInfo=new B.e(N.minimum,N.maximum)}return R}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const N=this._mesh.lg.indexOf(this);this._mesh.lg.splice(N,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(N,q,R,z,v){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=Number.MAX_VALUE,S=-Number.MAX_VALUE;const y=(v||z).gg();for(let A=q;A<q+R;A++){const N=y[A];N<F&&(F=N),N>S&&(S=N)}return new A(N,F,S-F+1,q,R,z,v,B)}}},12163:(N,q,R)=>{"use strict";var z=R(11445),v=R(11251),B=R(11181),F=R(10907),S=R(11344);z.b.prototype.thinInstanceAdd=function(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return F.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(N)?N.length:1);const R=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(N))for(let z=0;z<N.length;++z)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,N[z],z===N.length-1&&q);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,N,q);return R},z.b.prototype.thinInstanceAddSelf=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(B.d.IdentityReadOnly,N)},z.b.prototype.thinInstanceRegisterAttribute=function(N,q){N===v.h.ColorKind&&(N=v.h.ColorInstanceKind),this.removeVerticesData(N),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[N]=q,this._userThinInstanceBuffersStorage.sizes[N]=q*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[N]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[N]),this._userThinInstanceBuffersStorage.vertexBuffers[N]=new v.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[N],N,!0,!1,q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])},z.b.prototype.thinInstanceSetMatrixAt=function(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||N>=this._thinInstanceDataStorage.instancesCount)return!1;const z=this._thinInstanceDataStorage.matrixData;return q.copyToArray(z,16*N),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[N]=q),R&&(this.vc("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},z.b.prototype.thinInstanceSetAttributeAt=function(N,q,R){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return N===v.h.ColorKind&&(N=v.h.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[N]||q>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(N,0),this._userThinInstanceBuffersStorage.data[N].set(R,q*this._userThinInstanceBuffersStorage.strides[N]),z&&this.vc(N),!0)},Object.defineProperty(z.b.prototype,"tc",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(N){var q;const R=this._thinInstanceDataStorage.matrixData??(null===(q=this.source)||void 0===q?void 0:q._thinInstanceDataStorage.matrixData);N<=(R?R.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=N)},enumerable:!0,configurable:!0}),z.b.prototype._thinInstanceCreateMatrixBuffer=function(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=new v.e(this.getEngine(),q,!R,16,!1,!0);for(let v=0;v<4;v++)this.setVerticesBuffer(z.createVertexBuffer(N+v,4*v,4));return z},z.b.prototype.mc=function(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var B;if(R=R||16,"matrix"===N)null===(B=this._thinInstanceDataStorage.matrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=q?q.length:32*R,this._thinInstanceDataStorage.matrixData=q,this._thinInstanceDataStorage.worldMatrices=null,null!==q?(this._thinInstanceDataStorage.instancesCount=q.length/R,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",q,z),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===N){var F;null===(F=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===F||F.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=q,null!==q&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",q,z))}else{var S;if(N===v.h.ColorKind&&(N=v.h.ColorInstanceKind),null===q)null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.data[N]&&(this.removeVerticesData(N),delete this._userThinInstanceBuffersStorage.data[N],delete this._userThinInstanceBuffersStorage.strides[N],delete this._userThinInstanceBuffersStorage.sizes[N],delete this._userThinInstanceBuffersStorage.vertexBuffers[N]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[N]=q,this._userThinInstanceBuffersStorage.strides[N]=R,this._userThinInstanceBuffersStorage.sizes[N]=q.length,this._userThinInstanceBuffersStorage.vertexBuffers[N]=new v.h(this.getEngine(),q,N,!z,!1,R,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])}},z.b.prototype.vc=function(N){var q;if("matrix"===N)this.Mj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(N),null===(q=this._thinInstanceDataStorage.matrixBuffer)||void 0===q||q.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===N){var R;this.Mj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(N),null===(R=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===R||R.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var z;N===v.h.ColorKind&&(N=v.h.ColorInstanceKind),null!==(z=this._userThinInstanceBuffersStorage)&&void 0!==z&&z.vertexBuffers[N]&&(this.Mj&&!this._userThinInstanceBuffersStorage.vertexBuffers[N].isUpdatable()&&this._thinInstanceRecreateBuffer(N),this._userThinInstanceBuffersStorage.vertexBuffers[N].updateDirectly(this._userThinInstanceBuffersStorage.data[N],0))}},z.b.prototype.thinInstancePartialBufferUpdate=function(N,q,R){var z;"matrix"===N?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(q,R):(N===v.h.ColorKind&&(N=v.h.ColorInstanceKind),null!==(z=this._userThinInstanceBuffersStorage)&&void 0!==z&&z.vertexBuffers[N]&&this._userThinInstanceBuffersStorage.vertexBuffers[N].updateDirectly(q,R))},z.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const N=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let q=0;q<this._thinInstanceDataStorage.instancesCount;++q)this._thinInstanceDataStorage.worldMatrices[q]=B.d.Zg(N,16*q)}return this._thinInstanceDataStorage.worldMatrices},z.b.prototype.thinInstanceRefreshBoundingInfo=function(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const z=this._thinInstanceDataStorage.boundingVectors;if(N||!this.rawBoundingInfo){z.length=0,this.refreshBoundingInfo(q,R);const N=this.getBoundingInfo();this.rawBoundingInfo=new S.e(N.minimum,N.maximum)}const v=this.getBoundingInfo(),F=this._thinInstanceDataStorage.matrixData;if(0===z.length)for(let B=0;B<v.boundingBox.vectors.length;++B)z.push(v.boundingBox.vectors[B].clone());B.k.o[0].oe(Number.POSITIVE_INFINITY),B.k.o[1].oe(Number.NEGATIVE_INFINITY);for(let S=0;S<this._thinInstanceDataStorage.instancesCount;++S){B.d.FromArrayToRef(F,16*S,B.k.Matrix[0]);for(let N=0;N<z.length;++N)B.m.TransformCoordinatesToRef(z[N],B.k.Matrix[0],B.k.o[2]),B.k.o[0].minimizeInPlace(B.k.o[2]),B.k.o[1].maximizeInPlace(B.k.o[2])}v.reConstruct(B.k.o[0],B.k.o[1]),this.Ea()},z.b.prototype._thinInstanceRecreateBuffer=function(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var R;if("matrix"===N)null===(R=this._thinInstanceDataStorage.matrixBuffer)||void 0===R||R.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,q);else if("previousMatrix"===N){var z;if(this._scene.needsPreviousWorldMatrices)null===(z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===z||z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,q)}else{var B;N===v.h.ColorKind&&(N=v.h.ColorInstanceKind),null===(B=this._userThinInstanceBuffersStorage.vertexBuffers[N])||void 0===B||B.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[N]=new v.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[N],N,!q,!1,this._userThinInstanceBuffersStorage.strides[N],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])}},z.b.prototype._thinInstanceUpdateBufferSize=function(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;N===v.h.ColorKind&&(N=v.h.ColorInstanceKind);const R="matrix"===N;if(!R&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[N]))return;const z=R?16:this._userThinInstanceBuffersStorage.strides[N],B=R?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[N];let F=R?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[N];const S=(this._thinInstanceDataStorage.instancesCount+q)*z;let A=B;for(;A<S;)A*=2;if(!F||B!=A){if(F){const N=new Float32Array(A);N.set(F,0),F=N}else F=new Float32Array(A);var y,E,t;if(R){if(null===(y=this._thinInstanceDataStorage.matrixBuffer)||void 0===y||y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",F,!1),this._thinInstanceDataStorage.matrixData=F,this._thinInstanceDataStorage.matrixBufferSize=A,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(E=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===E||E.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",F,!1)}else null===(t=this._userThinInstanceBuffersStorage.vertexBuffers[N])||void 0===t||t.dispose(),this._userThinInstanceBuffersStorage.data[N]=F,this._userThinInstanceBuffersStorage.sizes[N]=A,this._userThinInstanceBuffersStorage.vertexBuffers[N]=new v.h(this.getEngine(),F,N,!0,!1,z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])}},z.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},z.b.prototype._disposeThinInstanceSpecificData=function(){var N;null!==(N=this._thinInstanceDataStorage)&&void 0!==N&&N.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11486:(N,q,R)=>{"use strict";R.d(q,{e:()=>t});var z=R(11147),v=R(11151),B=R(11221),F=R(10893),S=R(11181),A=R(11454),y=R(11002);const E=S.d.Compose(S.m.One(),S.g.FromEulerAngles(0,Math.PI,0),S.m.Zero());class t extends A.c{get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._cache.useBillboardPosition=0!==(this._billboardMode&t.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(N){N!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=N,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(N){this._infiniteDistance!==N&&(this._infiniteDistance=N)}constructor(N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new S.m(0,0,1),this._up=new S.m(0,1,0),this._right=new S.m(1,0,0),this._position=S.m.Zero(),this._rotation=S.m.Zero(),this._rotationQuaternion=null,this._scaling=S.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=t.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Qj=S.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=S.m.Zero(),this._absoluteScaling=S.m.Zero(),this._absoluteRotationQuaternion=S.g.Identity(),this._pivotMatrix=S.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new F.d,this._nonUniformScaling=!1,q&&this.va().addTransformNode(this)}getClassName(){return"qb"}get position(){return this._position}set position(N){this._position=N,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(N){this._rotation=N,this._rotationQuaternion=null,this._markAsDirtyInternal()}get re(){return this._scaling}set re(N){this._scaling=N,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(N){this._rotationQuaternion=N,N&&this._rotation.oe(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return S.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return S.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return S.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(N){return this._poseMatrix?(this._poseMatrix.p(N),this):(this._poseMatrix=N.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=S.d.Identity()),this._poseMatrix}_isSynchronized(){const N=this._cache;return this._billboardMode===N.billboardMode&&this._billboardMode===t.BILLBOARDMODE_NONE&&(!N.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const N=this._cache;N.localMatrixUpdated=!1,N.billboardMode=-1,N.infiniteDistance=!1,N.useBillboardPosition=!1,N.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(N){return this.setPivotMatrix(N,!1)}setPivotMatrix(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(N),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=q,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=S.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const z=this.clone("Clone of "+(this.name||this.id),N||this.parent,!0);z&&R&&R(this,z);for(const v of this.getChildTransformNodes(!0))v.instantiateHierarchy(z,q,R);return z}Nc(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return N?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.oe(0),this._rotationQuaternion=this._rotationQuaternion||S.g.Identity(),N.decompose(this._scaling,this._rotationQuaternion,this._position),this.Oj(!0)):(this._worldMatrix=N,this._absolutePosition.qe(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Oj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Oj(!0),this}get pj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Oj(),this._absolutePosition}setAbsolutePosition(N){if(!N)return this;let q,R,z;if(void 0===N.x){if(arguments.length<3)return this;q=arguments[0],R=arguments[1],z=arguments[2]}else q=N.x,R=N.y,z=N.z;if(this.parent){const N=S.k.Matrix[0];this.parent.getWorldMatrix().invertToRef(N),S.m.TransformCoordinatesFromFloatsToRef(q,R,z,N,this.position)}else this.position.x=q,this.position.y=R,this.position.z=z;return this._absolutePosition.p(N),this}setPositionWithLocalVector(N){return this.Oj(),this.position=S.m.TransformNormal(N,this.Qj),this}getPositionExpressedInLocalSpace(){this.Oj();const N=S.k.Matrix[0];return this.Qj.invertToRef(N),S.m.TransformNormal(this.position,N)}locallyTranslate(N){return this.Oj(!0),this.position=S.m.TransformCoordinates(N,this.Qj),this}lookAt(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const B=t._LookAtVectorCache,F=0===v?this.position:this.getAbsolutePosition();if(N.subtractToRef(F,B),this.setDirection(B,q,R,z),1===v&&this.parent)if(this.rotationQuaternion){const N=S.k.Matrix[0];this.rotationQuaternion.toRotationMatrix(N);const q=S.k.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.invert(),N.multiplyToRef(q,N),this.rotationQuaternion.fromRotationMatrix(N)}else{const N=S.k.Quaternion[0];S.g.FromEulerVectorToRef(this.rotation,N);const q=S.k.Matrix[0];N.toRotationMatrix(q);const R=S.k.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.invert(),q.multiplyToRef(R,q),N.fromRotationMatrix(q),N.toEulerAnglesToRef(this.rotation)}return this}hf(N){const q=S.m.Zero();return this.getDirectionToRef(N,q),q}getDirectionToRef(N,q){return S.m.TransformNormalToRef(N,this.getWorldMatrix(),q),this}setDirection(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const v=-Math.atan2(N.z,N.x)+Math.PI/2,B=Math.sqrt(N.x*N.x+N.z*N.z),F=-Math.atan2(N.y,B);return this.rotationQuaternion?S.g.RotationYawPitchRollToRef(v+q,F+R,z,this.rotationQuaternion):(this.rotation.x=F+R,this.rotation.y=v+q,this.rotation.z=z),this}setPivotPoint(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Oj(!0);const R=this.getWorldMatrix();if(1==q){const q=S.k.Matrix[0];R.invertToRef(q),N=S.m.TransformCoordinates(N,q)}return this.setPivotMatrix(S.d.Translation(-N.x,-N.y,-N.z),!0)}getPivotPoint(){const N=S.m.Zero();return this.getPivotPointToRef(N),N}getPivotPointToRef(N){return N.x=-this._pivotMatrix.m[12],N.y=-this._pivotMatrix.m[13],N.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const N=S.m.Zero();return this.getAbsolutePivotPointToRef(N),N}getAbsolutePivotPointToRef(N){return this.getPivotPointToRef(N),S.m.TransformCoordinatesToRef(N,this.getWorldMatrix(),N),this}Lg(N){if(this._isDirty)return this;if(this._children)for(const q of this._children)q.Lg(N);return super.Lg(N)}setParent(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!N&&!this.parent)return this;const z=S.k.Quaternion[0],v=S.k.o[0],B=S.k.o[1],F=S.k.Matrix[1];S.d.IdentityToRef(F);const A=S.k.Matrix[0];this.Oj(!0);let y=this.rotationQuaternion;return y||(y=t._TmpRotation,S.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,y)),S.d.ComposeToRef(this.re,y,this.position,A),this.parent&&A.multiplyToRef(this.parent.Oj(!0),A),N&&(N.Oj(!0).invertToRef(F),A.multiplyToRef(F,A)),A.decompose(B,z,v,q?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(z):z.toEulerAnglesToRef(this.rotation),this.re.p(B),this.position.p(v),this.parent=N,R&&this.setPivotMatrix(S.d.Identity()),this}addChild(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return N.setParent(this,q),this}removeChild(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return N.setParent(null,q),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(N){return this._nonUniformScaling!==N&&(this._nonUniformScaling=N,!0)}attachToBone(N,q){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=q,this.parent=N,N.getSkeleton().prepare(!0),N.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=N?this._currentParentWhenAttachingToBone:null,this):(N&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(N,q,R){let z;if(N.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.oe(0)),R&&0!==R){if(this.parent){const R=this.parent.getWorldMatrix(),z=S.k.Matrix[0];R.invertToRef(z),N=S.m.TransformNormal(N,z),R.determinant()<0&&(q*=-1)}z=S.g.RotationAxisToRef(N,q,t._RotationAxisCache),z.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else z=S.g.RotationAxisToRef(N,q,t._RotationAxisCache),this.rotationQuaternion.multiplyToRef(z,this.rotationQuaternion);return this}rotateAround(N,q,R){q.normalize(),this.rotationQuaternion||(this.rotationQuaternion=S.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.oe(0));const z=S.k.o[0],v=S.k.o[1],B=S.k.o[2],F=S.k.Quaternion[0],A=S.k.Matrix[0],y=S.k.Matrix[1],E=S.k.Matrix[2],t=S.k.Matrix[3];return N.subtractToRef(this.position,z),S.d.TranslationToRef(z.x,z.y,z.z,A),S.d.TranslationToRef(-z.x,-z.y,-z.z,y),S.d.RotationAxisToRef(q,R,E),y.multiplyToRef(E,t),t.multiplyToRef(A,t),t.decompose(v,F,B),this.position.addInPlace(B),F.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(N,q,R){const z=N.scale(q);if(R&&0!==R)this.setAbsolutePosition(this.getAbsolutePosition().add(z));else{const N=this.getPositionExpressedInLocalSpace().add(z);this.setPositionWithLocalVector(N)}return this}addRotation(N,q,R){let z;this.rotationQuaternion?z=this.rotationQuaternion:(z=S.k.Quaternion[1],S.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,z));const v=S.k.Quaternion[0];return S.g.RotationYawPitchRollToRef(q,N,R,v),z.multiplyInPlace(v),this.rotationQuaternion||z.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Oj(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const R=this.va().getRenderId();if(!this._isDirty&&!N&&(this._currentRenderId===R||this.isSynchronized()))return this._currentRenderId=R,this._worldMatrix;q=q||this.va().activeCamera,this._updateCache();const z=this._cache;z.pivotMatrixUpdated=!1,z.billboardMode=this.billboardMode,z.infiniteDistance=this.infiniteDistance,z.parent=this._parentNode,this._currentRenderId=R,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const v=this._getEffectiveParent(),B=t._TmpScaling;let F,A=this._position;if(this._infiniteDistance&&!this.parent&&q){const N=q.getWorldMatrix(),R=new S.m(N.m[12],N.m[13],N.m[14]);A=t._TmpTranslation,A.qe(this._position.x+R.x,this._position.y+R.y,this._position.z+R.z)}if(B.qe(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,F=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(S.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.qe(0,0,0))}}else F=t._TmpRotation,S.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,F);if(this._usePivotMatrix){const N=S.k.Matrix[1];S.d.ScalingToRef(B.x,B.y,B.z,N);const q=S.k.Matrix[0];F.toRotationMatrix(q),this._pivotMatrix.multiplyToRef(N,S.k.Matrix[4]),S.k.Matrix[4].multiplyToRef(q,this.Qj),this._postMultiplyPivotMatrix&&this.Qj.multiplyToRef(this._pivotMatrixInverse,this.Qj),this.Qj.addTranslationFromFloats(A.x,A.y,A.z)}else S.d.ComposeToRef(B,F,A,this.Qj);if(v&&v.getWorldMatrix){if(N&&v.Oj(N),z.useBillboardPath){if(this._transformToBoneReferal){const N=this.parent;N.getSkeleton().prepare(),N.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),S.k.Matrix[7])}else S.k.Matrix[7].p(v.getWorldMatrix());const N=S.k.o[5],q=S.k.o[6],R=S.k.Quaternion[0];S.k.Matrix[7].decompose(q,R,N),S.d.ScalingToRef(q.x,q.y,q.z,S.k.Matrix[7]),S.k.Matrix[7].setTranslation(N),t.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(R,N),this.Qj.setTranslation(N)),this.Qj.multiplyToRef(S.k.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const N=this.parent;N.getSkeleton().prepare(),this.Qj.multiplyToRef(N.getFinalMatrix(),S.k.Matrix[6]),S.k.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Qj.multiplyToRef(v.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Qj);if(z.useBillboardPath&&q&&this.billboardMode&&!z.useBillboardPosition){const N=S.k.o[0];if(this._worldMatrix.getTranslationToRef(N),S.k.Matrix[1].p(q.getViewMatrix()),this._scene.useRightHandedSystem&&S.k.Matrix[1].multiplyToRef(E,S.k.Matrix[1]),S.k.Matrix[1].setTranslationFromFloats(0,0,0),S.k.Matrix[1].invertToRef(S.k.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){S.k.Matrix[0].decompose(void 0,S.k.Quaternion[0],void 0);const N=S.k.o[1];S.k.Quaternion[0].toEulerAnglesToRef(N),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(N.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(N.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(N.z=0),S.d.RotationYawPitchRollToRef(N.y,N.x,N.z,S.k.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(S.k.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(S.k.o[0])}else if(z.useBillboardPath&&q&&z.useBillboardPosition){const N=S.k.o[0];this._worldMatrix.getTranslationToRef(N);const R=q.globalPosition;this._worldMatrix.invertToRef(S.k.Matrix[1]);const z=S.k.o[1];S.m.TransformCoordinatesToRef(R,S.k.Matrix[1],z),z.normalize();const v=-Math.atan2(z.z,z.x)+Math.PI/2,B=Math.sqrt(z.x*z.x+z.z*z.z),F=-Math.atan2(z.y,B);if(S.g.RotationYawPitchRollToRef(v,F,0,S.k.Quaternion[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){const N=S.k.o[1];S.k.Quaternion[0].toEulerAnglesToRef(N),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(N.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(N.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(N.z=0),S.d.RotationYawPitchRollToRef(N.y,N.x,N.z,S.k.Matrix[0])}else S.d.FromQuaternionToRef(S.k.Quaternion[0],S.k.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(S.k.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(S.k.o[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):v&&v._nonUniformScaling?this._updateNonUniformScalingState(v._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.qe(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=S.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Oj(),N){const N=this.getChildren();for(let q=0;q<N.length;++q){const R=N[q];if(R){R.Oj();const N=S.k.Matrix[0];R.Qj.multiplyToRef(this.Qj,N);const q=S.k.Quaternion[0];N.decompose(R.re,q,R.position),R.rotationQuaternion?R.rotationQuaternion.p(q):q.toEulerAnglesToRef(R.rotation)}}}this.re.qe(1,1,1),this.position.qe(0,0,0),this.rotation.qe(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=S.g.Identity()),this._worldMatrix=S.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(N){return this.onAfterWorldMatrixUpdateObservable.add(N),this}unregisterAfterWorldMatrixUpdate(N){return this.onAfterWorldMatrixUpdateObservable.removeCallback(N),this}getPositionInCameraSpace(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return N||(N=this.va().activeCamera),S.m.TransformCoordinates(this.getAbsolutePosition(),N.getViewMatrix())}getDistanceToCamera(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return N||(N=this.va().activeCamera),this.getAbsolutePosition().gd(N.globalPosition).length()}clone(N,q,R){const z=B.e.Clone((()=>new t(N,this.va())),this);if(z.name=N,z.id=N,q&&(z.parent=q),!R){const q=this.getDescendants(!0);for(let R=0;R<q.length;R++){const v=q[R];v.clone&&v.clone(N+"."+v.name,z)}}return z}serialize(N){const q=B.e.Serialize(this,N);return q.type=this.getClassName(),q.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(q),q.localMatrix=this.getPivotMatrix().ij(),q.isEnabled=this.isEnabled(),B.e.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q}static Parse(N,q,R){const z=B.e.Parse((()=>new t(N.name,q)),N,q,R);if(N.localMatrix?z.setPreTransformMatrix(S.d.Zg(N.localMatrix)):N.pivotMatrix&&z.setPivotMatrix(S.d.Zg(N.pivotMatrix)),z.Vb(N.isEnabled),z._waitingParsedUniqueId=N.uniqueId,void 0!==N.parentId&&(z._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(z._waitingParentInstanceIndex=N.parentInstanceIndex),N.animations){for(let q=0;q<N.animations.length;q++){const R=N.animations[q],v=(0,y.c)("BABYLON.Animation");v&&z.animations.push(v.Parse(R))}A.c.ParseAnimationRanges(z,N,q)}return N.autoAnimate&&q.beginAnimation(z,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),z}getChildTransformNodes(N,q){const R=[];return this._getDescendants(R,N,(N=>(!q||q(N))&&N instanceof t)),R}dispose(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const N=this._parentContainer.transformNodes.indexOf(this);N>-1&&this._parentContainer.transformNodes.splice(N,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),N){const N=this.getChildTransformNodes(!0);for(const q of N)q.parent=null,q.Oj(!0)}super.dispose(N,q)}normalizeToUnitCube(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,z=null,v=null;q&&(this.rotationQuaternion?(v=this.rotationQuaternion.clone(),this.rotationQuaternion.qe(0,0,0,1)):this.rotation&&(z=this.rotation.clone(),this.rotation.qe(0,0,0)));const B=this.getHierarchyBoundingVectors(N,R),F=B.max.gd(B.min),S=Math.max(F.x,F.y,F.z);if(0===S)return this;const A=1/S;return this.re.scaleInPlace(A),q&&(this.rotationQuaternion&&v?this.rotationQuaternion.p(v):this.rotation&&z&&this.rotation.p(z)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t.BILLBOARDMODE_USE_POSITION=128,t.BillboardUseParentOrientation=!1,t._TmpRotation=S.g.Zero(),t._TmpScaling=S.m.Zero(),t._TmpTranslation=S.m.Zero(),t._LookAtVectorCache=new S.m(0,0,0),t._RotationAxisCache=new S.g,(0,z.c)([(0,v.C)("position")],t.prototype,"_position",void 0),(0,z.c)([(0,v.C)("rotation")],t.prototype,"_rotation",void 0),(0,z.c)([(0,v.w)("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),(0,z.c)([(0,v.C)("re")],t.prototype,"_scaling",void 0),(0,z.c)([(0,v.D)("billboardMode")],t.prototype,"_billboardMode",void 0),(0,z.c)([(0,v.D)()],t.prototype,"scalingDeterminant",void 0),(0,z.c)([(0,v.D)("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),(0,z.c)([(0,v.D)()],t.prototype,"ignoreNonUniformScaling",void 0),(0,z.c)([(0,v.D)()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11702:(N,q,R)=>{"use strict";R.d(q,{d:()=>y});var z=R(11181),v=R(11197),B=R(11680),F=R(11186),S=R(11213);class A{constructor(N,q,R,z){this.name=N,this.worldAxisForNormal=q,this.worldAxisForFileX=R,this.worldAxisForFileY=z}}class y{static ConvertCubeMapTextureToSphericalPolynomial(N){var q;if(!N.isCube)return null;null===(q=N.va())||void 0===q||q.getEngine().flushFramebuffer();const R=N.getSize().width,z=N.readPixels(0,void 0,void 0,!1),v=N.readPixels(1,void 0,void 0,!1);let B,F;N.isRenderTarget?(B=N.readPixels(3,void 0,void 0,!1),F=N.readPixels(2,void 0,void 0,!1)):(B=N.readPixels(2,void 0,void 0,!1),F=N.readPixels(3,void 0,void 0,!1));const S=N.readPixels(4,void 0,void 0,!1),A=N.readPixels(5,void 0,void 0,!1),y=N.gammaSpace;let E=0;return 1!=N.textureType&&2!=N.textureType||(E=1),new Promise((N=>{Promise.all([v,z,B,F,S,A]).then((q=>{let[z,v,B,F,S,A]=q;const t={size:R,right:v,left:z,up:B,down:F,front:S,back:A,format:5,type:E,gammaSpace:y};N(this.ConvertCubeMapToSphericalPolynomial(t))}))}))}static _AreaElement(N,q){return Math.atan2(N*q,Math.sqrt(N*N+q*q+1))}static ConvertCubeMapToSphericalPolynomial(N){const q=new B.b;let R=0;const z=2/N.size,A=z,y=.5*z,E=y-1;for(let B=0;B<6;B++){const t=this._FileFaces[B],x=N[t.name];let e=E;const b=5===N.format?4:3;for(let B=0;B<N.size;B++){let f=E;for(let A=0;A<N.size;A++){const E=t.worldAxisForFileX.scale(f).add(t.worldAxisForFileY.scale(e)).add(t.worldAxisForNormal);E.normalize();const D=this._AreaElement(f-y,e-y)-this._AreaElement(f-y,e+y)-this._AreaElement(f+y,e-y)+this._AreaElement(f+y,e+y);let V=x[B*N.size*b+A*b+0],H=x[B*N.size*b+A*b+1],Y=x[B*N.size*b+A*b+2];isNaN(V)&&(V=0),isNaN(H)&&(H=0),isNaN(Y)&&(Y=0),0===N.type&&(V/=255,H/=255,Y/=255),N.gammaSpace&&(V=Math.pow((0,v.c)(V),F.l),H=Math.pow((0,v.c)(H),F.l),Y=Math.pow((0,v.c)(Y),F.l));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const N=Math.max(V,H,Y);if(N>T){const q=T/N;V*=q,H*=q,Y*=q}}else V=(0,v.c)(V,0,T),H=(0,v.c)(H,0,T),Y=(0,v.c)(Y,0,T);const L=new S.c(V,H,Y);q.addLight(E,L,D),R+=D,f+=z}e+=A}}const t=6*(4*Math.PI)/6/R;return q.scaleInPlace(t),q.convertIncidentRadianceToIrradiance(),q.convertIrradianceToLambertianRadiance(),B.d.FromHarmonics(q)}}y._FileFaces=[new A("right",new z.m(1,0,0),new z.m(0,0,-1),new z.m(0,-1,0)),new A("left",new z.m(-1,0,0),new z.m(0,0,1),new z.m(0,-1,0)),new A("up",new z.m(0,1,0),new z.m(1,0,0),new z.m(0,0,1)),new A("down",new z.m(0,-1,0),new z.m(1,0,0),new z.m(0,0,-1)),new A("front",new z.m(0,0,1),new z.m(1,0,0),new z.m(0,-1,0)),new A("back",new z.m(0,0,-1),new z.m(-1,0,0),new z.m(0,-1,0))],y.MAX_HDRI_VALUE=4096,y.PRESERVE_CLAMPED_COLORS=!1},11190:(N,q,R)=>{"use strict";function z(N,q){const R=[];for(let z=0;z<N;++z)R.push(q());return R}function v(N,q){return z(N,q)}R.d(q,{d:()=>z,e:()=>v,i:()=>F});const B=["push","splice","pop","shift","unshift"];function F(N,q){const R=B.map((R=>function(N,q,R){const z=N[q];if("function"!==typeof z)return null;const v=function(){const z=N.length,B=v.previous.apply(N,arguments);return R(q,z),B};return z.next=v,v.previous=z,N[q]=v,()=>{const R=v.previous;if(!R)return;const z=v.next;z?(R.next=z,z.previous=R):(R.next=void 0,N[q]=R),v.next=void 0,v.previous=void 0}}(N,R,q)));return()=>{R.forEach((N=>{null===N||void 0===N||N()}))}}},12090:(N,q,R)=>{"use strict";R.d(q,{b:()=>F});var z=R(11402),v=R(12094);let B=0;const F=N=>{if(!N.environmentBRDFTexture){const q=N.useDelayedTextureLoading;N.useDelayedTextureLoading=!1;const R=N._blockEntityCollection;N._blockEntityCollection=!1;const F=z.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+B++,N,!0,!1,z.c.BILINEAR_SAMPLINGMODE);N._blockEntityCollection=R;const S=N.getEngine().getLoadedTexturesCache(),A=S.indexOf(F.getInternalTexture());-1!==A&&S.splice(A,1),F.isRGBD=!0,F.wrapU=z.c.CLAMP_ADDRESSMODE,F.wrapV=z.c.CLAMP_ADDRESSMODE,N.environmentBRDFTexture=F,N.useDelayedTextureLoading=q,v.c.ExpandRGBDTexture(F);const y=N.getEngine().onContextRestoredObservable.add((()=>{F.isRGBD=!0;const q=N.onBeforeRenderObservable.add((()=>{F.isReady()&&(N.onBeforeRenderObservable.remove(q),v.c.ExpandRGBDTexture(F))}))}));N.jj.add((()=>{N.getEngine().onContextRestoredObservable.remove(y)}))}return N.environmentBRDFTexture}},11450:(N,q,R)=>{"use strict";function z(N,q,R){try{const z=N.next();z.done?q(z):z.value?z.value.then((()=>{z.value=void 0,q(z)}),R):q(z)}catch(z){R(z)}}function v(){let N,q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(R,v,B)=>{const F=performance.now();void 0===N||F-N>q?(N=F,setTimeout((()=>{z(R,v,B)}),0)):z(R,v,B)}}function B(N,q,R,z,v){const B=()=>{let F;const S=N=>{N.done?R(N.value):void 0===F?F=!0:B()};do{F=void 0,v&&v.aborted?z(new Error("Aborted")):q(N,S,z),void 0===F&&(F=!1)}while(F)};B()}function F(N,q){let R;return B(N,z,(N=>R=N),(N=>{throw N}),q),R}function S(N,q,R){return new Promise(((z,v)=>{B(N,q,z,v,R)}))}function A(N,q){return function(){return F(N(...arguments),q)}}R.d(q,{e:()=>v,g:()=>A,h:()=>S,k:()=>F})},11699:(N,q,R)=>{"use strict";R.d(q,{b:()=>b});var z=R(11197),v=R(10907),B=R(11702),F=R(11706);R(11732);const S=131072,A=131072;function y(N){return N.charCodeAt(0)+(N.charCodeAt(1)<<8)+(N.charCodeAt(2)<<16)+(N.charCodeAt(3)<<24)}const E=y("DXT1"),t=y("DXT3"),x=y("DXT5"),e=y("DX10");class b{static GetDDSInfo(N){const q=new Int32Array(N.buffer,N.byteOffset,31),R=new Int32Array(N.buffer,N.byteOffset,35);let z=1;q[2]&S&&(z=Math.max(1,q[7]));const v=q[21],B=v===e?R[32]:0;let F=0;switch(v){case 113:F=2;break;case 116:F=1;break;case e:if(10===B){F=2;break}if(2===B){F=1;break}}return{width:q[4],height:q[3],mipmapCount:z,isFourCC:4===(4&q[20]),isRGB:64===(64&q[20]),isLuminance:(q[20]&A)===A,isCube:512===(512&q[28]),isCompressed:v===E||v===t||v===x,dxgiFormat:B,textureType:F}}static _GetHalfFloatAsFloatRGBAArrayBuffer(N,q,R,z,v,B){const S=new Float32Array(z),A=new Uint16Array(v,R);let y=0;for(let E=0;E<q;E++)for(let q=0;q<N;q++){const R=4*(q+E*N);S[y]=(0,F.i)(A[R]),S[y+1]=(0,F.i)(A[R+1]),S[y+2]=(0,F.i)(A[R+2]),b.StoreLODInAlphaChannel?S[y+3]=B:S[y+3]=(0,F.i)(A[R+3]),y+=4}return S}static _GetHalfFloatRGBAArrayBuffer(N,q,R,z,v,B){if(b.StoreLODInAlphaChannel){const S=new Uint16Array(z),A=new Uint16Array(v,R);let y=0;for(let R=0;R<q;R++)for(let q=0;q<N;q++){const z=4*(q+R*N);S[y]=A[z],S[y+1]=A[z+1],S[y+2]=A[z+2],S[y+3]=(0,F.j)(B),y+=4}return S}return new Uint16Array(v,R,z)}static _GetFloatRGBAArrayBuffer(N,q,R,z,v,B){if(b.StoreLODInAlphaChannel){const F=new Float32Array(z),S=new Float32Array(v,R);let A=0;for(let R=0;R<q;R++)for(let q=0;q<N;q++){const z=4*(q+R*N);F[A]=S[z],F[A+1]=S[z+1],F[A+2]=S[z+2],F[A+3]=B,A+=4}return F}return new Float32Array(v,R,z)}static _GetFloatAsHalfFloatRGBAArrayBuffer(N,q,R,z,v,B){const S=new Uint16Array(z),A=new Float32Array(v,R);let y=0;for(let E=0;E<q;E++)for(let q=0;q<N;q++)S[y]=(0,F.j)(A[y]),S[y+1]=(0,F.j)(A[y+1]),S[y+2]=(0,F.j)(A[y+2]),b.StoreLODInAlphaChannel?S[y+3]=(0,F.j)(B):S[y+3]=(0,F.j)(A[y+3]),y+=4;return S}static _GetFloatAsUIntRGBAArrayBuffer(N,q,R,v,B,F){const S=new Uint8Array(v),A=new Float32Array(B,R);let y=0;for(let E=0;E<q;E++)for(let q=0;q<N;q++){const R=4*(q+E*N);S[y]=255*(0,z.c)(A[R]),S[y+1]=255*(0,z.c)(A[R+1]),S[y+2]=255*(0,z.c)(A[R+2]),b.StoreLODInAlphaChannel?S[y+3]=F:S[y+3]=255*(0,z.c)(A[R+3]),y+=4}return S}static _GetHalfFloatAsUIntRGBAArrayBuffer(N,q,R,v,B,S){const A=new Uint8Array(v),y=new Uint16Array(B,R);let E=0;for(let t=0;t<q;t++)for(let q=0;q<N;q++){const R=4*(q+t*N);A[E]=255*(0,z.c)((0,F.i)(y[R])),A[E+1]=255*(0,z.c)((0,F.i)(y[R+1])),A[E+2]=255*(0,z.c)((0,F.i)(y[R+2])),b.StoreLODInAlphaChannel?A[E+3]=S:A[E+3]=255*(0,z.c)((0,F.i)(y[R+3])),E+=4}return A}static _GetRGBAArrayBuffer(N,q,R,z,v,B,F,S,A){const y=new Uint8Array(z),E=new Uint8Array(v,R);let t=0;for(let x=0;x<q;x++)for(let q=0;q<N;q++){const R=4*(q+x*N);y[t]=E[R+B],y[t+1]=E[R+F],y[t+2]=E[R+S],y[t+3]=E[R+A],t+=4}return y}static _ExtractLongWordOrder(N){return 0===N||255===N||-16777216===N?0:1+b._ExtractLongWordOrder(N>>8)}static _GetRGBArrayBuffer(N,q,R,z,v,B,F,S){const A=new Uint8Array(z),y=new Uint8Array(v,R);let E=0;for(let t=0;t<q;t++)for(let q=0;q<N;q++){const R=3*(q+t*N);A[E]=y[R+B],A[E+1]=y[R+F],A[E+2]=y[R+S],E+=3}return A}static _GetLuminanceArrayBuffer(N,q,R,z,v){const B=new Uint8Array(z),F=new Uint8Array(v,R);let S=0;for(let A=0;A<q;A++)for(let q=0;q<N;q++){const R=q+A*N;B[S]=F[R],S++}return B}static UploadDDSLevels(N,q,R,z,F,A){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,f=arguments.length>7?arguments[7]:void 0,D=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],V=null;z.sphericalPolynomial&&(V=[]);const H=!!N.getCaps().s3tc;q.generateMipMaps=F;const Y=new Int32Array(R.buffer,R.byteOffset,31);let T,L,X,Q,h,u,w,c=0,n=0,G=1;if(542327876!==Y[0])return void v.c.Error("Invalid magic number in DDS header");if(!z.isFourCC&&!z.isRGB&&!z.isLuminance)return void v.c.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(z.isCompressed&&!H)return void v.c.Error("Compressed textures are not supported on this platform.");let s=Y[22];Q=Y[1]+4;let Z=!1;if(z.isFourCC)switch(T=Y[21],T){case E:G=8,n=33777;break;case t:G=16,n=33778;break;case x:G=16,n=33779;break;case 113:Z=!0,s=64;break;case 116:Z=!0,s=128;break;case e:{Q+=20;let N=!1;switch(z.dxgiFormat){case 10:Z=!0,s=64,N=!0;break;case 2:Z=!0,s=128,N=!0;break;case 88:z.isRGB=!0,z.isFourCC=!1,s=32,N=!0}if(N)break}default:return void v.c.Error(["Unsupported FourCC code:",(J=T,String.fromCharCode(255&J,J>>8&255,J>>16&255,J>>24&255))])}var J;const M=b._ExtractLongWordOrder(Y[23]),m=b._ExtractLongWordOrder(Y[24]),g=b._ExtractLongWordOrder(Y[25]),j=b._ExtractLongWordOrder(Y[26]);Z&&(n=N._getRGBABufferInternalSizedFormat(z.textureType)),u=1,Y[2]&S&&!1!==F&&(u=Math.max(1,Y[7]));const l=f||0,I=N.getCaps();for(let v=l;v<A;v++){for(L=Y[4],X=Y[3],w=0;w<u;++w){if(-1===y||y===w){const B=-1===y?w:0;if(!z.isCompressed&&z.isFourCC){q.format=5,c=L*X*4;let z=null;if(N._badOS||N._badDesktopOS||!I.textureHalfFloat&&!I.textureFloat)128===s?(z=b._GetFloatAsUIntRGBAArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer,B),V&&0==B&&V.push(b._GetFloatRGBAArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer,B))):64===s&&(z=b._GetHalfFloatAsUIntRGBAArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer,B),V&&0==B&&V.push(b._GetHalfFloatAsFloatRGBAArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer,B))),q.type=0;else{const N=I.textureFloat&&(D&&I.textureFloatLinearFiltering||!D),v=I.textureHalfFloat&&(D&&I.textureHalfFloatLinearFiltering||!D),F=(128===s||64===s&&!v)&&N?1:(64===s||128===s&&!N)&&v?2:0;let S,A=null;if(128===s)switch(F){case 1:S=b._GetFloatRGBAArrayBuffer,A=null;break;case 2:S=b._GetFloatAsHalfFloatRGBAArrayBuffer,A=b._GetFloatRGBAArrayBuffer;break;case 0:S=b._GetFloatAsUIntRGBAArrayBuffer,A=b._GetFloatRGBAArrayBuffer}else switch(F){case 1:S=b._GetHalfFloatAsFloatRGBAArrayBuffer,A=null;break;case 2:S=b._GetHalfFloatRGBAArrayBuffer,A=b._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:S=b._GetHalfFloatAsUIntRGBAArrayBuffer,A=b._GetHalfFloatAsFloatRGBAArrayBuffer}q.type=F,z=S(L,X,R.byteOffset+Q,c,R.buffer,B),V&&0==B&&V.push(A?A(L,X,R.byteOffset+Q,c,R.buffer,B):z)}z&&N._uploadDataToTextureDirectly(q,z,v,B)}else if(z.isRGB)q.type=0,24===s?(q.format=4,c=L*X*3,h=b._GetRGBArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer,M,m,g),N._uploadDataToTextureDirectly(q,h,v,B)):(q.format=5,c=L*X*4,h=b._GetRGBAArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer,M,m,g,j),N._uploadDataToTextureDirectly(q,h,v,B));else if(z.isLuminance){const z=N._getUnpackAlignement(),F=L;c=Math.floor((L+z-1)/z)*z*(X-1)+F,h=b._GetLuminanceArrayBuffer(L,X,R.byteOffset+Q,c,R.buffer),q.format=1,q.type=0,N._uploadDataToTextureDirectly(q,h,v,B)}else c=Math.max(4,L)/4*Math.max(4,X)/4*G,h=new Uint8Array(R.buffer,R.byteOffset+Q,c),q.type=0,N._uploadCompressedDataToTextureDirectly(q,n,L,X,h,v,B)}Q+=s?L*X*(s/8):c,L*=.5,X*=.5,L=Math.max(1,L),X=Math.max(1,X)}if(void 0!==f)break}V&&V.length>0?z.sphericalPolynomial=B.d.ConvertCubeMapToSphericalPolynomial({size:Y[4],right:V[0],left:V[1],up:V[2],down:V[3],front:V[4],back:V[5],format:5,type:1,gammaSpace:!1}):z.sphericalPolynomial=void 0}}b.StoreLODInAlphaChannel=!1},11158:(N,q,R)=>{"use strict";R.d(q,{d:()=>B,h:()=>F});const z={},v={};function B(N){const q=N.getClassName();return v[q]||(v[q]={}),v[q]}function F(N){const q=N.getClassName();if(z[q])return z[q];z[q]={};const R=z[q];let B=N,F=q;for(;F;){const N=v[F];for(const v in N)R[v]=N[v];let q,z=!1;do{if(q=Object.getPrototypeOf(B),!q.getClassName){z=!0;break}if(q.getClassName()!==F)break;B=q}while(q);if(z)break;F=q.getClassName(),B=q}return R}},11151:(N,q,R)=>{"use strict";R.d(q,{A:()=>E,C:()=>t,D:()=>F,e:()=>B,f:()=>H,i:()=>e,j:()=>A,m:()=>b,n:()=>y,o:()=>f,q:()=>V,s:()=>x,w:()=>D,x:()=>S});var z=R(11158);function v(N,q){return(R,v)=>{const B=(0,z.d)(R);B[v]||(B[v]={type:N,sourceName:q})}}function B(N){return function(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(R,z)=>{const v=q||"_"+z;Object.defineProperty(R,z,{get:function(){return this[v]},set:function(q){"function"===typeof this.equals&&this.equals(q)||this[v]!==q&&(this[v]=q,R[N].apply(this))},enumerable:!0,configurable:!0})}}(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function F(N){return v(0,N)}function S(N){return v(1,N)}function A(N){return v(2,N)}function y(N){return v(3,N)}function E(N){return v(4,N)}function t(N){return v(5,N)}function x(N){return v(6,N)}function e(N){return v(7,N)}function b(N){return v(8,N)}function f(N){return v(9,N)}function D(N){return v(10,N)}function V(N){return v(12,N)}function H(N,q,R,z){const v=R.value;R.value=function(){let R=v;if("undefined"!==typeof _native&&_native[q]){const N=_native[q];R=z?function(){return z(...arguments)?N(...arguments):v(...arguments)}:N}return N[q]=R,R(...arguments)}}H.filter=function(N){return(q,R,z)=>H(q,R,z,N)}},11221:(N,q,R)=>{"use strict";R.d(q,{e:()=>y});var z=R(10923),v=R(11178),B=R(11213),F=R(11181),S=R(11158);const A=function(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const B=N();v.b&&v.b.HasTags(q)&&v.b.AddTagsTo(B,v.b.GetTags(q,!0));const F=(0,S.h)(B),A={};for(const v in F){const N=F[v],S=q[v],E=N.type;if(void 0!==S&&null!==S&&("uniqueId"!==v||y.AllowLoadingUniqueId))switch(E){case 0:case 6:case 11:B[v]=S;break;case 1:z.cloneTexturesOnlyOnce&&A[S.uniqueId]?B[v]=A[S.uniqueId]:(B[v]=R||S.isRenderTarget?S:S.clone(),A[S.uniqueId]=B[v]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:B[v]=R?S:S.clone()}}return B};class y{static AppendSerializedAnimations(N,q){if(N.animations){q.animations=[];for(let R=0;R<N.animations.length;R++){const z=N.animations[R];q.animations.push(z.serialize())}}}static Serialize(N,q){q||(q={}),v.b&&(q.tags=v.b.GetTags(N));const R=(0,S.h)(N);for(const z in R){const v=R[z],B=v.sourceName||z,F=v.type,S=N[z];if(void 0!==S&&null!==S&&("uniqueId"!==z||y.AllowLoadingUniqueId))switch(F){case 0:q[B]=S;break;case 1:case 3:case 7:case 9:q[B]=S.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:q[B]=S.ij();break;case 6:case 11:q[B]=S.id}}return q}static ParseProperties(N,q,R,z){z||(z="");const v=(0,S.h)(q);for(const S in v){const A=v[S],E=N[A.sourceName||S],t=A.type;if(void 0!==E&&null!==E&&("uniqueId"!==S||y.AllowLoadingUniqueId)){const N=q;switch(t){case 0:N[S]=E;break;case 1:R&&(N[S]=y._TextureParser(E,R,z));break;case 2:N[S]=B.c.Zg(E);break;case 3:N[S]=y._FresnelParametersParser(E);break;case 4:N[S]=F.l.Zg(E);break;case 5:N[S]=F.m.Zg(E);break;case 6:R&&(N[S]=R.getLastMeshById(E));break;case 7:N[S]=y._ColorCurvesParser(E);break;case 8:N[S]=B.g.Zg(E);break;case 9:N[S]=y._ImageProcessingConfigurationParser(E);break;case 10:N[S]=F.g.Zg(E);break;case 11:R&&(N[S]=R.getCameraById(E));break;case 12:N[S]=F.d.Zg(E)}}}}static Parse(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=N();return v.b&&v.b.AddTagsTo(B,q.tags),y.ParseProperties(q,B,R,z),B}static Clone(N,q){return A(N,q,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(N,q){return A(N,q,!0)}}y.AllowLoadingUniqueId=!1,y._ImageProcessingConfigurationParser=N=>{throw(0,z.b)("ImageProcessingConfiguration")},y._FresnelParametersParser=N=>{throw(0,z.b)("FresnelParameters")},y._ColorCurvesParser=N=>{throw(0,z.b)("ColorCurves")},y._TextureParser=(N,q,R)=>{throw(0,z.b)("Texture")}},10911:(N,q,R)=>{"use strict";R.d(q,{d:()=>B});var z=R(10907);const v=(N,q,R)=>N?N.getClassName&&"Mesh"===N.getClassName()?null:!N.getClassName||"SubMesh"!==N.getClassName()&&"PhysicsBody"!==N.getClassName()?N.clone?N.clone():Array.isArray(N)?N.slice():R&&"object"===typeof N?{...N}:null:N.clone(q):null;class B{static DeepCopy(N,q,R,B){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=function(N){const q=[];do{Object.getOwnPropertyNames(N).forEach((function(N){-1===q.indexOf(N)&&q.push(N)}))}while(N=Object.getPrototypeOf(N));return q}(N);for(const y of S){if("_"===y[0]&&(!B||-1===B.indexOf(y)))continue;if(y.endsWith("Observable"))continue;if(R&&-1!==R.indexOf(y))continue;const S=N[y],E=typeof S;if("function"!==E)try{if("object"===E)if(S instanceof Uint8Array)q[y]=Uint8Array.from(S);else if(S instanceof Array){if(q[y]=[],S.length>0)if("object"==typeof S[0])for(let N=0;N<S.length;N++){const R=v(S[N],q,F);-1===q[y].indexOf(R)&&q[y].push(R)}else q[y]=S.slice(0)}else q[y]=v(S,q,F);else q[y]=S}catch(A){z.c.Warn(A.message)}}}}},10923:(N,q,R)=>{"use strict";R.d(q,{b:()=>v});const z={};function v(N){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!z[N])return z[N]=!0,`${N} needs to be imported before as it contains a side-effect required by your code.`}},10900:(N,q,R)=>{"use strict";function z(){return"undefined"!==typeof window}function v(){return"undefined"!==typeof navigator}function B(){return"undefined"!==typeof document}function F(N){let q="",R=N.firstChild;for(;R;)3===R.nodeType&&(q+=R.textContent),R=R.nextSibling;return q}R.d(q,{c:()=>F,f:()=>B,j:()=>v,l:()=>z})},12151:(N,q,R)=>{"use strict";R.r(q),R.d(q,{Dispose:()=>x,DumpData:()=>t,DumpDataAsync:()=>E,DumpFramebuffer:()=>y,DumpTools:()=>e});var z=R(11719),v=R(10888),B=R(11197),F=R(10933);let S,A=null;async function y(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0;const S=await R.readPixels(0,0,N,q);t(N,q,new Uint8Array(S.buffer),z,v,B,!0,void 0,F)}function E(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0;return new Promise((A=>{t(N,q,R,(N=>A(N)),z,v,B,F,S)}))}function t(N,q,y,E){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8?arguments[8]:void 0;(async function(){return A||(A=new Promise(((N,q)=>{let v,B=null;const A={Ah:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(R.bind(R,11614)).then((y=>{let{ThinEngine:E}=y;try{v=new OffscreenCanvas(100,100),B=new E(v,!1,A)}catch(e){v=document.createElement("canvas"),B=new E(v,!1,A)}F.b.Instances.pop(),F.b.OnEnginesDisposedObservable.add((N=>{B&&N!==B&&!B.u&&0===F.b.Instances.length&&x()})),B.getCaps().parallelShaderCompile=void 0;const t=new z.d(B);R.e(34).then(R.bind(R,13360)).then((R=>{let{passPixelShader:F}=R;if(!B)return void q("Engine is not defined");const A=new z.f({Dd:B,name:F.name,fragmentShader:F.shader,samplerNames:["textureSampler"]});S={canvas:v,Dd:B,renderer:t,wrapper:A},N(S)}))})).catch(q)}))),await A})().then((R=>{if(R.Dd.setSize(N,q,!0),y instanceof Float32Array){const N=new Uint8Array(y.length);let q=y.length;for(;q--;){const R=y[q];N[q]=Math.round(255*(0,B.c)(R))}y=N}const z=R.Dd.createRawTexture(y,N,q,5,!1,!b,1);R.renderer.setViewport(),R.renderer.applyEffectWrapper(R.wrapper),R.wrapper.effect._bindTexture("textureSampler",z),R.renderer.draw(),f?v.f.ToBlob(R.canvas,(N=>{const q=new FileReader;q.onload=N=>{const q=N.target.result;E&&E(q)},q.readAsArrayBuffer(N)}),t,D):v.f.EncodeScreenshotCanvasData(R.canvas,E,t,e,D),z.dispose()}))}function x(){var N;S?(S.wrapper.dispose(),S.renderer.dispose(),S.Dd.dispose()):null===(N=A)||void 0===N||N.then((N=>{N.wrapper.dispose(),N.renderer.dispose(),N.Dd.dispose()}));A=null,S=null}const e={DumpData:t,DumpDataAsync:E,DumpFramebuffer:y,Dispose:x};v.f.DumpData=t,v.f.DumpDataAsync=E,v.f.DumpFramebuffer=y},12142:(N,q,R)=>{"use strict";R.d(q,{c:()=>b,d:()=>V,e:()=>T,f:()=>L});var z=R(10888),v=R(11181),B=R(11197),F=R(11680),S=R(10985),A=R(11407),y=(R(11172),R(11715)),E=R(10907);R(12094),R(12111),R(12151);const t="image/png",x=2,e=[134,22,135,150,246,214,150,54];function b(N){const q=new DataView(N.buffer,N.byteOffset,N.byteLength);let R=0;for(let F=0;F<e.length;F++)if(q.getUint8(R++)!==e[F])return E.c.Error("Not a babylon environment map"),null;let z="",v=0;for(;v=q.getUint8(R++);)z+=String.fromCharCode(v);let B=JSON.parse(z);return B=f(B),B.Dh&&(B.Dh.specularDataPosition=R,B.Dh.lodGenerationScale=B.Dh.lodGenerationScale||.8),B}function f(N){if(N.version>x)throw new Error(`Unsupported babylon environment map version "${N.version}". Latest supported version is "${x}".`);return 2===N.version?N:N={...N,version:2,imageType:t}}function D(N,q){const R=(q=f(q)).Dh;let z=Math.log2(q.width);if(z=Math.round(z)+1,R.mipmaps.length!==6*z)throw new Error(`Unsupported specular mipmaps number "${R.mipmaps.length}"`);const v=new Array(z);for(let B=0;B<z;B++){v[B]=new Array(6);for(let q=0;q<6;q++){const z=R.mipmaps[6*B+q];v[B][q]=new Uint8Array(N.buffer,N.byteOffset+R.specularDataPosition+z.position,z.length)}}return v}function V(N,q,R){const z=(R=f(R)).Dh;if(!z)return Promise.resolve();N._lodGenerationScale=z.lodGenerationScale;return Y(N,D(q,R),R.imageType)}function H(N,q,R,z,v,B,F,S,A,y,E){return new Promise(((t,x)=>{if(R){const R=q.createTexture(null,!0,!0,null,1,null,(N=>{x(N)}),N);null===z||void 0===z||z.onEffectCreatedObservable.addOnce((S=>{S.executeWhenCompiled((()=>{z.externalTextureSamplerBinding=!0,z.onApply=z=>{z._bindTexture("textureSampler",R),z.setFloat2("scale",1,q._features.needsInvertingBitmap&&N instanceof ImageBitmap?-1:1)},q.scenes.length&&(q.scenes[0].postProcessManager.directRender([z],y,!0,B,F),q.restoreDefaultFramebuffer(),R.dispose(),URL.revokeObjectURL(v),t())}))}))}else{if(q._uploadImageToTexture(E,N,B,F),S){const R=A[F];R&&q._uploadImageToTexture(R._texture,N,B,0)}t()}}))}async function Y(N,q){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(!z.f.IsExponentOfTwo(N.width))throw new Error("Texture size must be a power of two");const F=(0,B.l)(N.width)+1,E=N.getEngine();let x=!1,e=!1,b=null,f=null,D=null;const V=E.getCaps();N.format=5,N.type=0,N.generateMipMaps=!0,N._cachedAnisotropicFilteringLevel=null,E.updateTextureSamplingMode(3,N),V.textureLOD?E._features.supportRenderAndCopyToLodForFloatTextures?V.textureHalfFloatRender&&V.textureHalfFloatLinearFiltering?(x=!0,N.type=2):V.textureFloatRender&&V.textureFloatLinearFiltering&&(x=!0,N.type=1):x=!1:(x=!1,e=!0,D={});let Y=0;if(x)E.isWebGPU?(Y=1,await R.e(39).then(R.bind(R,13385))):await R.e(41).then(R.bind(R,13395)),b=new y.b("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,N.type,void 0,null,!1,void 0,Y),N._isRGBD=!1,N.invertY=!1,f=E.createRenderTargetCubeTexture(N.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:N.type,format:5});else if(N._isRGBD=!0,N.invertY=!0,e){const q=3,R=N._lodGenerationScale,z=N._lodGenerationOffset;for(let v=0;v<q;v++){const B=(F-1)*R+z,y=z+(B-z)*(1-v/(q-1)),t=Math.round(Math.min(Math.max(y,0),B)),x=new S.c(E,2);x.isCube=!0,x.invertY=!0,x.generateMipMaps=!1,E.updateTextureSamplingMode(2,x);const e=new A.c(null);switch(e._isCube=!0,e._texture=x,D[t]=e,v){case 0:N._lodTextureLow=e;break;case 1:N._lodTextureMid=e;break;case 2:N._lodTextureHigh=e}}}const T=[];for(let R=0;R<q.length;R++)for(let z=0;z<6;z++){const B=q[R][z],F=new Blob([B],{type:v}),S=URL.createObjectURL(F);let A;if(E._features.forceBitmapOverHTMLImageElement)A=E.createImageBitmap(F,{premultiplyAlpha:"none"}).then((q=>H(q,E,x,b,S,z,R,e,D,f,N)));else{const q=new Image;q.src=S,A=new Promise(((v,B)=>{q.onload=()=>{H(q,E,x,b,S,z,R,e,D,f,N).then((()=>v())).catch((N=>{B(N)}))},q.onerror=N=>{B(N)}}))}T.push(A)}if(q.length<F){let R;const z=Math.pow(2,F-1-q.length),v=z*z*4;switch(N.type){case 0:R=new Uint8Array(v);break;case 2:R=new Uint16Array(v);break;case 1:R=new Float32Array(v)}for(let B=q.length;B<F;B++)for(let q=0;q<6;q++)E._uploadArrayBufferViewToTexture(N,R,q,B)}return Promise.all(T).then((()=>{f&&(E._releaseTexture(N),f._swapAndDie(N)),b&&b.dispose(),e&&(N._lodTextureHigh&&N._lodTextureHigh._texture&&(N._lodTextureHigh._texture.isReady=!0),N._lodTextureMid&&N._lodTextureMid._texture&&(N._lodTextureMid._texture.isReady=!0),N._lodTextureLow&&N._lodTextureLow._texture&&(N._lodTextureLow._texture.isReady=!0))}))}function T(N,q){const R=(q=f(q)).irradiance;if(!R)return;const z=new F.d;v.m.FromArrayToRef(R.x,0,z.x),v.m.FromArrayToRef(R.y,0,z.y),v.m.FromArrayToRef(R.z,0,z.z),v.m.FromArrayToRef(R.xx,0,z.xx),v.m.FromArrayToRef(R.yy,0,z.yy),v.m.FromArrayToRef(R.zz,0,z.zz),v.m.FromArrayToRef(R.yz,0,z.yz),v.m.FromArrayToRef(R.zx,0,z.zx),v.m.FromArrayToRef(R.xy,0,z.xy),N._sphericalPolynomial=z}function L(N,q,R,z,v){const B=Y(N.getEngine().createRawCubeTexture(null,N.width,N.format,N.type,N.generateMipMaps,N.invertY,N.samplingMode,N._compression),q).then((()=>N));return N.onRebuildCallback=N=>({proxy:B,isReady:!0,isAsync:!0}),N._source=13,N._bufferViewArrayArray=q,N._lodGenerationScale=z,N._lodGenerationOffset=v,N._sphericalPolynomial=R,Y(N,q).then((()=>(N.isReady=!0,N)))}},10942:(N,q,R)=>{"use strict";R.d(q,{b:()=>z,e:()=>v,i:()=>B});class z extends Error{}z._setPrototypeOf=Object.setPrototypeOf||((N,q)=>(N.__proto__=q,N));const v={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class B extends z{constructor(N,q,R){super(N),this.errorCode=q,this.innerError=R,this.name="RuntimeError",z._setPrototypeOf(this,B.prototype)}}},10938:(N,q,R)=>{"use strict";R.d(q,{e:()=>G,h:()=>Y,i:()=>c,n:()=>h,j:()=>D,q:()=>X,s:()=>Q,u:()=>u,y:()=>T});var z=R(10931),v=R(10900),B=R(10893);class F{}F.FilesToLoad={};var S=R(10942),A=R(10945),y=R(10949),E=R(10933),t=R(10907),x=R(10955),e=R(10951),b=R(10957);const f=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class D extends S.i{constructor(N,q){super(N,S.e.LoadFileError),this.name="LoadFileError",S.b._setPrototypeOf(this,D.prototype),q instanceof z.b?this.request=q:this.file=q}}class V extends S.i{constructor(N,q){super(N,S.e.RequestFileError),this.request=q,this.name="RequestFileError",S.b._setPrototypeOf(this,V.prototype)}}class H extends S.i{constructor(N,q){super(N,S.e.ReadFileError),this.file=q,this.name="ReadFileError",S.b._setPrototypeOf(this,H.prototype)}}const Y={DefaultRetryStrategy:class{static ExponentialBackoff(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(R,z,v)=>0!==z.status||v>=N||-1!==R.indexOf("file:")?-1:Math.pow(2,v)*q}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:N=>N,ScriptBaseUrl:"",ScriptPreprocessUrl:N=>N,CleanUrl:N=>N=N.replace(/#/gm,"%23")},T=(N,q)=>{if((!N||0!==N.indexOf("data:"))&&Y.CorsBehavior)if("string"===typeof Y.CorsBehavior||Y.CorsBehavior instanceof String)q.crossOrigin=Y.CorsBehavior;else{const R=Y.CorsBehavior(N);R&&(q.crossOrigin=R)}},L={getRequiredSize:null},X=function(N,q,R,v){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",S=arguments.length>5?arguments[5]:void 0;const y=E.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===y||void 0===y||!y._features.forceBitmapOverHTMLImageElement))return R("LoadImage is only supported in web or BabylonNative environments."),null;let t,x=!1;N instanceof ArrayBuffer||ArrayBuffer.isView(N)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(t=URL.createObjectURL(new Blob([N],{type:B})),x=!0):t=`data:${B};base64,`+(0,A.p)(N):N instanceof Blob?(t=URL.createObjectURL(N),x=!0):(t=Y.CleanUrl(N),t=Y.PreprocessUrl(t));const e=q=>{if(R){const z=t||N.toString();R(`Error while trying to load image: ${0===z.indexOf("http")||z.length<=128?z:z.slice(0,128)+"..."}`,q)}};if(null!==y&&void 0!==y&&y._features.forceBitmapOverHTMLImageElement)return h(t,(z=>{y.createImageBitmap(new Blob([z],{type:B}),{premultiplyAlpha:"none",...S}).then((N=>{q(N),x&&URL.revokeObjectURL(t)})).catch((q=>{R&&R("Error while trying to load image: "+N,q)}))}),void 0,v||void 0,!0,((N,q)=>{e(q)})),null;const b=new Image;if(L.getRequiredSize){const q=L.getRequiredSize(N);q.width&&(b.width=q.width),q.height&&(b.height=q.height)}T(t,b);const f=[],D=()=>{f.forEach((N=>{N.target.removeEventListener(N.name,N.handler)})),f.length=0};f.push({target:b,name:"load",handler:()=>{D(),q(b),x&&b.src&&URL.revokeObjectURL(b.src)}}),f.push({target:b,name:"error",handler:N=>{D(),e(N),x&&b.src&&URL.revokeObjectURL(b.src)}}),f.push({target:document,name:"securitypolicyviolation",handler:N=>{if(N.blockedURI!==b.src||"jm"===N.disposition)return;D();const q=new Error(`CSP violation of policy ${N.effectiveDirective} ${N.blockedURI}. Current policy is ${N.originalPolicy}`);E.b.UseFallbackTexture=!1,e(q),x&&b.src&&URL.revokeObjectURL(b.src),b.src=""}}),f.forEach((N=>{N.target.addEventListener(N.name,N.handler)}));const V="blob:"===t.substring(0,5),H="data:"===t.substring(0,5),X=()=>{V||H||!z.b.IsCustomRequestAvailable?b.src=t:h(t,((N,q,R)=>{const z=new Blob([N],{type:!B&&R?R:B}),v=URL.createObjectURL(z);x=!0,b.src=v}),void 0,v||void 0,!0,((N,q)=>{e(q)}))},Q=()=>{v&&v.loadImage(t,b)};if(!V&&!H&&v&&v.enableTexturesOffline)v.open(Q,X);else{if(-1!==t.indexOf("file:")){const N=decodeURIComponent(t.substring(5).toLowerCase());if(F.FilesToLoad[N]&&"undefined"!==typeof URL){try{let q;try{q=URL.createObjectURL(F.FilesToLoad[N])}catch(u){q=URL.createObjectURL(F.FilesToLoad[N])}b.src=q,x=!0}catch(w){b.src=""}return b}}X()}return b},Q=(N,q,R,z,v)=>{const F=new FileReader,S={onCompleteObservable:new B.d,abort:()=>F.abort()};return F.onloadend=()=>S.onCompleteObservable.notifyObservers(S),v&&(F.onerror=()=>{v(new H(`Unable to read ${N.name}`,N))}),F.onload=N=>{q(N.target.result)},R&&(F.onprogress=R),z?F.readAsArrayBuffer(N):F.readAsText(N),S},h=(N,q,R,z,v,A,y)=>{if(N.name)return Q(N,q,R,v,A?N=>{A(void 0,N)}:void 0);const E=N;if(-1!==E.indexOf("file:")){let N=decodeURIComponent(E.substring(5).toLowerCase());0===N.indexOf("./")&&(N=N.substring(2));const z=F.FilesToLoad[N];if(z)return Q(z,q,R,v,A?N=>A(void 0,new D(N.message,N.file)):void 0)}const{match:e,type:b}=n(E);if(e){const N={onCompleteObservable:new B.d,abort:()=>()=>{}};try{const N=v?G(E):s(E);q(N,void 0,b)}catch(S){A?A(void 0,S):t.c.Error(S.message||"Failed to parse the Data URL")}return x.d.SetImmediate((()=>{N.onCompleteObservable.notifyObservers(N)})),N}return u(E,((N,R)=>{q(N,null===R||void 0===R?void 0:R.responseURL,null===R||void 0===R?void 0:R.getResponseHeader("content-type"))}),R,z,v,A?N=>{A(N.request,new D(N.message,N.request))}:void 0,y)},u=(N,q,R,F,S,A,y)=>{N=Y.CleanUrl(N),N=Y.PreprocessUrl(N);const E=Y.BaseUrl+N;let x=!1;const e={onCompleteObservable:new B.d,abort:()=>x=!0},b=()=>{let N,B=new z.b,F=null;const b=()=>{B&&(R&&B.removeEventListener("progress",R),N&&B.removeEventListener("readystatechange",N),B.removeEventListener("loadend",f))};let f=()=>{b(),e.onCompleteObservable.notifyObservers(e),e.onCompleteObservable.clear(),R=void 0,N=null,f=null,A=void 0,y=void 0,q=void 0};e.abort=()=>{x=!0,f&&f(),B&&B.readyState!==(XMLHttpRequest.DONE||4)&&B.abort(),null!==F&&(clearTimeout(F),F=null),B=null};const D=N=>{const q=N.message||"Unknown error";A&&B?A(new V(q,B)):t.c.Error(q)},H=t=>{if(B){if(B.open("GET",E),y)try{y(B)}catch(e){return void D(e)}S&&(B.responseType="arraybuffer"),R&&B.addEventListener("progress",R),f&&B.addEventListener("loadend",f),N=()=>{if(!x&&B&&B.readyState===(XMLHttpRequest.DONE||4)){if(N&&B.removeEventListener("readystatechange",N),B.status>=200&&B.status<300||0===B.status&&(!(0,v.l)()||w())){try{q&&q(S?B.response:B.responseText,B)}catch(e){D(e)}return}const R=Y.DefaultRetryStrategy;if(R){const N=R(E,B,t);if(-1!==N)return b(),B=new z.b,void(F=setTimeout((()=>H(t+1)),N))}const y=new V("Error status: "+B.status+" "+B.statusText+" - Unable to load "+E,B);A&&A(y)}},B.addEventListener("readystatechange",N),B.send()}};H(0)};if(F&&F.enableSceneOffline){const z=N=>{N&&N.status>400?A&&A(N):b()},v=()=>{F&&F.loadFile(Y.BaseUrl+N,(N=>{!x&&q&&q(N),e.onCompleteObservable.notifyObservers(e)}),R?N=>{!x&&R&&R(N)}:void 0,z,S)};F.open(v,z)}else b();return e},w=()=>"undefined"!==typeof location&&"file:"===location.protocol,c=N=>f.test(N),n=N=>{const q=f.exec(N);if(null===q||0===q.length)return{match:!1,type:""};return{match:!0,type:q[0].replace("data:","").replace("base64,","")}};function G(N){return(0,A.e)(N.split(",")[1])}const s=N=>(0,A.i)(N.split(",")[1]);let Z;b.d._FileToolsLoadImage=X,e.e.loadFile=h,y.g.loadFile=h;((N,q,R,z,v,B,F,S,A,y)=>{Z={DecodeBase64UrlToBinary:N,DecodeBase64UrlToString:q,DefaultRetryStrategy:R.DefaultRetryStrategy,BaseUrl:R.BaseUrl,CorsBehavior:R.CorsBehavior,PreprocessUrl:R.PreprocessUrl,IsBase64DataUrl:z,IsFileURL:v,LoadFile:B,LoadImage:F,ReadFile:S,RequestFile:A,SetCorsBehavior:y},Object.defineProperty(Z,"DefaultRetryStrategy",{get:function(){return R.DefaultRetryStrategy},set:function(N){R.DefaultRetryStrategy=N}}),Object.defineProperty(Z,"BaseUrl",{get:function(){return R.BaseUrl},set:function(N){R.BaseUrl=N}}),Object.defineProperty(Z,"PreprocessUrl",{get:function(){return R.PreprocessUrl},set:function(N){R.PreprocessUrl=N}}),Object.defineProperty(Z,"CorsBehavior",{get:function(){return R.CorsBehavior},set:function(N){R.CorsBehavior=N}})})(G,s,Y,c,w,h,X,Q,u,T)},11007:(N,q,R)=>{"use strict";function z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(N=>{const q=16*Math.random()|0;return("x"===N?q:3&q|8).toString(16)}))}R.d(q,{e:()=>z})},11e3:(N,q,R)=>{"use strict";R.d(q,{b:()=>B});var z=R(10907),v=R(11002);class B{static Instantiate(N){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[N])return this.RegisteredExternalClasses[N];const q=(0,v.c)(N);if(q)return q;z.c.Warn(N+" not found, you may have missed an import.");const R=N.split(".");let B=window||this;for(let z=0,v=R.length;z<v;z++)B=B[R[z]];return"function"!==typeof B?null:B}}B.RegisteredExternalClasses={}},10907:(N,q,R)=>{"use strict";R.d(q,{c:()=>z});class z{static _CheckLimit(N,q){let R=z._LogLimitOutputs[N];return R?R.current++:(R={limit:q,current:1},z._LogLimitOutputs[N]=R),R.current<=R.limit}static _GenerateLimitMessage(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const R=z._LogLimitOutputs[N];if(!R||!z.MessageLimitReached)return;const v=this._Levels[q];R.current===R.limit&&z[v.name](z.MessageLimitReached.replace(/%LIMIT%/g,""+R.limit).replace(/%TYPE%/g,v.name??""))}static _AddLogEntry(N){z._LogCache=N+z._LogCache,z.OnNewCacheEntry&&z.OnNewCacheEntry(N)}static _FormatMessage(N){const q=N=>N<10?"0"+N:""+N,R=new Date;return"["+q(R.getHours())+":"+q(R.getMinutes())+":"+q(R.getSeconds())+"]: "+N}static _LogDisabled(N,q){}static _LogEnabled(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const v=Array.isArray(q)?q[0]:q;if(void 0!==R&&!z._CheckLimit(v,R))return;const B=z._FormatMessage(v),F=this._Levels[N],S=Array.isArray(q)?q.slice(1):[];F.logFunc&&F.logFunc("BJS - "+B,...S);const A=`<div style='color:${F.color}'>${B}</div><br>`;z._AddLogEntry(A),z._GenerateLimitMessage(v,N)}static get LogCache(){return z._LogCache}static ClearLogCache(){z._LogCache="",z._LogLimitOutputs={},z.errorsCount=0}static set LogLevels(N){z.Log=z._LogDisabled,z.Warn=z._LogDisabled,z.Error=z._LogDisabled,[z.MessageLogLevel,z.WarningLogLevel,z.ErrorLogLevel].forEach((q=>{if((N&q)===q){const N=this._Levels[q];z[N.name]=z._LogEnabled.bind(z,q)}}))}}z.NoneLogLevel=0,z.MessageLogLevel=1,z.WarningLogLevel=2,z.ErrorLogLevel=4,z.AllLogLevel=7,z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",z._LogCache="",z._LogLimitOutputs={},z._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],z.errorsCount=0,z.Log=z._LogEnabled.bind(z,z.MessageLogLevel),z.Warn=z._LogEnabled.bind(z,z.WarningLogLevel),z.Error=z._LogEnabled.bind(z,z.ErrorLogLevel)},10893:(N,q,R)=>{"use strict";R.d(q,{d:()=>B});class z{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this.initialize(N,q,R,z)}initialize(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;return this.mask=N,this.skipNextObservers=q,this.target=R,this.currentTarget=z,this}}class v{constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=N,this.mask=q,this.scope=R,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class B{static FromPromise(N,q){const R=new B;return N.then((N=>{R.notifyObservers(N)})).catch((N=>{if(!q)throw N;q.notifyObservers(N)})),R}get observers(){return this._observers}constructor(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=q,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new z(0),N&&(this._onObserverAdded=N)}add(N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!N)return null;const z=new v(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return z.unregisterOnNextCall=R,q?this._observers.unshift(z):this._observers.push(z),this._onObserverAdded&&this._onObserverAdded(z),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(z,this._lastNotifiedValue),z._remove=()=>{this.remove(z)},z}addOnce(N){return this.add(N,void 0,void 0,void 0,!0)}remove(N){if(!N)return!1;N._remove=null;return-1!==this._observers.indexOf(N)&&(this._deferUnregister(N),!0)}removeCallback(N,q){for(let R=0;R<this._observers.length;R++){const z=this._observers[R];if(!z._willBeUnregistered&&(z.callback===N&&(!q||q===z.scope)))return this._deferUnregister(z),!0}return!1}_deferUnregister(N){N._willBeUnregistered||(this._numObserversMarkedAsDeleted++,N.unregisterOnNextCall=!1,N._willBeUnregistered=!0,setTimeout((()=>{this._remove(N)}),0))}_remove(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!N)return!1;const R=this._observers.indexOf(N);return-1!==R&&(q&&this._numObserversMarkedAsDeleted--,this._observers.splice(R,1),!0)}makeObserverTopPriority(N){this._remove(N,!1),this._observers.unshift(N)}makeObserverBottomPriority(N){this._remove(N,!1),this._observers.push(N)}notifyObservers(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=N),!this._observers.length)return!0;const B=this._eventState;B.mask=q,B.target=R,B.currentTarget=z,B.skipNextObservers=!1,B.lastReturnValue=N,B.userInfo=v;for(const F of this._observers)if(!F._willBeUnregistered&&(F.mask&q&&(F.unregisterOnNextCall&&this._deferUnregister(F),F.scope?B.lastReturnValue=F.callback.apply(F.scope,[N,B]):B.lastReturnValue=F.callback(N,B)),B.skipNextObservers))return!1;return!0}notifyObserver(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=q),N._willBeUnregistered)return;const z=this._eventState;z.mask=R,z.skipNextObservers=!1,N.unregisterOnNextCall&&this._deferUnregister(N),N.callback(q,z)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const N=this._observers.pop();N&&(N._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const N=new B;return N._observers=this._observers.slice(0),N}hasSpecificMask(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const q of this._observers)if(q.mask&N||q.mask===N)return!0;return!1}}},11019:(N,q,R)=>{"use strict";R.d(q,{c:()=>v});var z=R(10919);class v{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(N,q){v.Enabled&&(this._current+=N,q&&this._fetchResult())}beginMonitoring(){v.Enabled&&(this._startMonitoringTime=z.d.Now)}endMonitoring(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!v.Enabled)return;N&&this.fetchNewFrame();const q=z.d.Now;this._current=q-this._startMonitoringTime,N&&this._fetchResult()}fj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const N=z.d.Now;N-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=N,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}v.Enabled=!0},10919:(N,q,R)=>{"use strict";R.d(q,{d:()=>v});var z=R(10900);class v{static get Now(){return(0,z.l)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12094:(N,q,R)=>{"use strict";R.d(q,{c:()=>B});var z=R(11715),v=R(11706);class B{static ExpandRGBDTexture(N){const q=N._texture;if(!q||!N.isRGBD)return;const v=q.getEngine(),B=v.getCaps(),F=q.isReady;let S=!1;B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(S=!0,q.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(S=!0,q.type=1),S&&(q.isReady=!1,q._isRGBD=!1,q.invertY=!1);const A=async()=>{const B=v.isWebGPU,F=B?1:0;q.isReady=!1,B?await Promise.all([R.e(39).then(R.bind(R,13385)),R.e(40).then(R.bind(R,13391))]):await Promise.all([R.e(41).then(R.bind(R,13395)),R.e(42).then(R.bind(R,13404))]);const S=new z.b("rgbdDecode","rgbdDecode",null,null,1,null,3,v,!1,void 0,q.type,void 0,null,!1,void 0,F);S.externalTextureSamplerBinding=!0;const A=v.createRenderTargetTexture(q.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:q.samplingMode,type:q.type,format:5});S.onEffectCreatedObservable.addOnce((R=>{R.executeWhenCompiled((()=>{S.onApply=N=>{N._bindTexture("textureSampler",q),N.setFloat2("scale",1,1)},N.va().postProcessManager.directRender([S],A,!0),v.restoreDefaultFramebuffer(),v._releaseTexture(q),S&&S.dispose(),A._swapAndDie(q),q.isReady=!0}))}))};S&&(F?A():N.onLoadObservable.addOnce(A))}static EncodeTextureToRGBD(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,v.e)("rgbdEncode",N,q,R,1,5)}}},11167:(N,q,R)=>{"use strict";R.d(q,{e:()=>v,h:()=>z});class z{constructor(N){this.length=0,this.data=new Array(N),this._id=z._GlobalId++}push(N){this.data[this.length++]=N,this.length>this.data.length&&(this.data.length*=2)}forEach(N){for(let q=0;q<this.length;q++)N(this.data[q])}sort(N){this.data.sort(N)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(N){if(0!==N.length){this.length+N.length>this.data.length&&(this.data.length=2*(this.length+N.length));for(let q=0;q<N.length;q++)this.data[this.length++]=(N.data||N)[q]}}indexOf(N){const q=this.data.indexOf(N);return q>=this.length?-1:q}contains(N){return-1!==this.indexOf(N)}}z._GlobalId=0;class v extends z{constructor(){super(...arguments),this._duplicateId=0}push(N){super.push(N),N.__smartArrayFlags||(N.__smartArrayFlags={}),N.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(N){return(!N.__smartArrayFlags||N.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(N),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(N){if(0!==N.length){this.length+N.length>this.data.length&&(this.data.length=2*(this.length+N.length));for(let q=0;q<N.length;q++){const R=(N.data||N)[q];this.pushNoDuplicate(R)}}}}},10945:(N,q,R)=>{"use strict";R.d(q,{e:()=>F,i:()=>B,m:()=>z,p:()=>v});const z=N=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(N);let q="";for(let R=0;R<N.byteLength;R++)q+=String.fromCharCode(N[R]);return q},v=N=>{const q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let R,z,v,B,F,S,A,y="",E=0;const t=ArrayBuffer.isView(N)?new Uint8Array(N.buffer,N.byteOffset,N.byteLength):new Uint8Array(N);for(;E<t.length;)R=t[E++],z=E<t.length?t[E++]:Number.NaN,v=E<t.length?t[E++]:Number.NaN,B=R>>2,F=(3&R)<<4|z>>4,S=(15&z)<<2|v>>6,A=63&v,isNaN(z)?S=A=64:isNaN(v)&&(A=64),y+=q.charAt(B)+q.charAt(F)+q.charAt(S)+q.charAt(A);return y},B=N=>atob(N),F=N=>{const q=B(N),R=q.length,z=new Uint8Array(new ArrayBuffer(R));for(let v=0;v<R;v++)z[v]=q.charCodeAt(v);return z.buffer}},11178:(N,q,R)=>{"use strict";R.d(q,{b:()=>v});class z{static Eval(N,q){return"true"===(N=N.match(/\([^()]*\)/g)?N.replace(/\([^()]*\)/g,(N=>(N=N.slice(1,N.length-1),z._HandleParenthesisContent(N,q)))):z._HandleParenthesisContent(N,q))||"false"!==N&&z.Eval(N,q)}static _HandleParenthesisContent(N,q){let R;q=q||(N=>"true"===N);const v=N.split("||");for(const B in v)if(Object.prototype.hasOwnProperty.call(v,B)){let N=z._SimplifyNegation(v[B].trim());const F=N.split("&&");if(F.length>1)for(let v=0;v<F.length;++v){const B=z._SimplifyNegation(F[v].trim());if(R="true"!==B&&"false"!==B?"!"===B[0]?!q(B.substring(1)):q(B):"true"===B,!R){N="false";break}}if(R||"true"===N){R=!0;break}R="true"!==N&&"false"!==N?"!"===N[0]?!q(N.substring(1)):q(N):"true"===N}return R?"true":"false"}static _SimplifyNegation(N){return"!true"===(N=(N=N.replace(/^[\s!]+/,(N=>(N=N.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?N="false":"!false"===N&&(N="true"),N}}class v{static EnableFor(N){N._tags=N._tags||{},N.hasTags=()=>v.HasTags(N),N.addTags=q=>v.AddTagsTo(N,q),N.removeTags=q=>v.RemoveTagsFrom(N,q),N.matchesTagsQuery=q=>v.MatchesQuery(N,q)}static DisableFor(N){delete N._tags,delete N.hasTags,delete N.addTags,delete N.removeTags,delete N.matchesTagsQuery}static HasTags(N){if(!N._tags)return!1;const q=N._tags;for(const R in q)if(Object.prototype.hasOwnProperty.call(q,R))return!0;return!1}static GetTags(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!N._tags)return null;if(q){const q=[];for(const R in N._tags)Object.prototype.hasOwnProperty.call(N._tags,R)&&!0===N._tags[R]&&q.push(R);return q.join(" ")}return N._tags}static AddTagsTo(N,q){if(!q)return;if("string"!==typeof q)return;q.split(" ").forEach((function(q){v._AddTagTo(N,q)}))}static _AddTagTo(N,q){""!==(q=q.trim())&&"true"!==q&&"false"!==q&&(q.match(/[\s]/)||q.match(/^([!]|([|]|[&]){2})/)||(v.EnableFor(N),N._tags[q]=!0))}static RemoveTagsFrom(N,q){if(!v.HasTags(N))return;const R=q.split(" ");for(const z in R)v._RemoveTagFrom(N,R[z])}static _RemoveTagFrom(N,q){delete N._tags[q]}static MatchesQuery(N,q){return void 0===q||(""===q?v.HasTags(N):z.Eval(q,(q=>v.HasTags(N)&&N._tags[q])))}}},11706:(N,q,R)=>{"use strict";R.d(q,{e:()=>A,i:()=>x,j:()=>t});R(11402),R(11711);var z=R(11715),v=R(10957),B=R(11002),F=R(11221);class S extends z.b{getClassName(){return"PassPostProcess"}constructor(N,q){super(N,"pass",null,null,q,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(N,q){N?(this._webGPUReady=!0,q.push(Promise.all([R.e(33).then(R.bind(R,13354))]))):q.push(Promise.all([R.e(34).then(R.bind(R,13360))])),super._gatherImports(N,q)}static _Parse(N,q,R,z){return F.e.Parse((()=>new S(N.name,N.options,q,N.renderTargetSamplingMode,N._engine,N.reusable)),N,R,z)}}(0,B.f)("BABYLON.PassPostProcess",S);z.b;function A(N,q,R,v,B,F,S,A){const y=q.getEngine();return q.isReady=!1,B=B??q.samplingMode,v=v??q.type,F=F??q.format,S=S??q.width,A=A??q.height,-1===v&&(v=0),new Promise((E=>{const t=new z.b("postprocess",N,null,null,1,null,B,y,!1,void 0,v,void 0,null,!1,F);t.externalTextureSamplerBinding=!0;const x=y.createRenderTargetTexture({width:S,height:A},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:B,type:v,format:F});t.onEffectCreatedObservable.addOnce((N=>{N.executeWhenCompiled((()=>{t.onApply=N=>{N._bindTexture("textureSampler",q),N.setFloat2("scale",1,1)},R.postProcessManager.directRender([t],x,!0),y.restoreDefaultFramebuffer(),y._releaseTexture(q),t&&t.dispose(),x._swapAndDie(q),q.type=v,q.format=5,q.isReady=!0,E(q)}))}))}))}let y,E;function t(N){y||(y=new Float32Array(1),E=new Int32Array(y.buffer)),y[0]=N;const q=E[0];let R=q>>16&32768,z=q>>12&2047;const v=q>>23&255;return v<103?R:v>142?(R|=31744,R|=(255==v?0:1)&&8388607&q,R):v<113?(z|=2048,R|=(z>>114-v)+(z>>113-v&1),R):(R|=v-112<<10|z>>1,R+=1&z,R)}function x(N){const q=(32768&N)>>15,R=(31744&N)>>10,z=1023&N;return 0===R?(q?-1:1)*Math.pow(2,-14)*(z/Math.pow(2,10)):31==R?z?NaN:1/0*(q?-1:1):(q?-1:1)*Math.pow(2,R-15)*(1+z/Math.pow(2,10))}v.d._RescalePostProcessFactory=N=>new S("rescale",1,null,2,N,!1,0)},10955:(N,q,R)=>{"use strict";R.d(q,{d:()=>v});var z=R(10900);class v{static SetImmediate(N){(0,z.l)()&&window.setImmediate?window.setImmediate(N):setTimeout(N,1)}}},11013:(N,q,R)=>{"use strict";function z(N){let q=1;do{q*=2}while(q<N);return q===N}function v(N,q,R){return N*(1-R)+q*R}function B(N){const q=F(N),R=S(N);return q-N>N-R?R:q}function F(N){return N--,N|=N>>1,N|=N>>2,N|=N>>4,N|=N>>8,N|=N>>16,++N}function S(N){return N|=N>>1,N|=N>>2,N|=N>>4,N|=N>>8,(N|=N>>16)-(N>>1)}function A(N,q){let R;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:R=S(N);break;case 2:R=B(N);break;default:R=F(N)}return Math.min(R,q)}R.d(q,{b:()=>S,f:()=>A,j:()=>z,n:()=>v,p:()=>B})},10888:(N,q,R)=>{"use strict";R.d(q,{b:()=>V,f:()=>D});var z=R(10893),v=R(10900),B=R(10907),F=R(10911),S=R(10919),A=R(10923),y=R(10931),E=R(10933),t=R(10938),x=R(10955),e=R(11e3),b=R(11007),f=R(11013);class D{static get BaseUrl(){return t.h.BaseUrl}static set BaseUrl(N){t.h.BaseUrl=N}static get CleanUrl(){return t.h.CleanUrl}static set CleanUrl(N){t.h.CleanUrl=N}static IsAbsoluteUrl(N){return 0===N.indexOf("//")||-1!==N.indexOf("://")&&(-1!==N.indexOf(".")&&(-1!==N.indexOf("/")&&(!(N.indexOf(":")>N.indexOf("/"))&&(N.indexOf("://")<N.indexOf(".")||(0===N.indexOf("data:")||0===N.indexOf("blob:"))))))}static set ScriptBaseUrl(N){t.h.ScriptBaseUrl=N}static get ScriptBaseUrl(){return t.h.ScriptBaseUrl}static set ScriptPreprocessUrl(N){t.h.ScriptPreprocessUrl=N}static get ScriptPreprocessUrl(){return t.h.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return t.h.DefaultRetryStrategy}static set DefaultRetryStrategy(N){t.h.DefaultRetryStrategy=N}static get CorsBehavior(){return t.h.CorsBehavior}static set CorsBehavior(N){t.h.CorsBehavior=N}static get UseFallbackTexture(){return E.b.UseFallbackTexture}static set UseFallbackTexture(N){E.b.UseFallbackTexture=N}static get RegisteredExternalClasses(){return e.b.RegisteredExternalClasses}static set RegisteredExternalClasses(N){e.b.RegisteredExternalClasses=N}static get fallbackTexture(){return E.b.FallbackTexture}static set fallbackTexture(N){E.b.FallbackTexture=N}static FetchToRef(N,q,R,z,v,B){const F=4*((Math.abs(N)*R%R|0)+(Math.abs(q)*z%z|0)*R);B.r=v[F]/255,B.g=v[F+1]/255,B.b=v[F+2]/255,B.a=v[F+3]/255}static Mix(N,q,R){return 0}static Instantiate(N){return e.b.Instantiate(N)}static SetImmediate(N){x.d.SetImmediate(N)}static IsExponentOfTwo(N){return!0}static FloatRound(N){return Math.fround(N)}static GetFilename(N){const q=N.lastIndexOf("/");return q<0?N:N.substring(q+1)}static GetFolderPath(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=N.lastIndexOf("/");return R<0?q?N:"":N.substring(0,R+1)}static ToDegrees(N){return 180*N/Math.PI}static ToRadians(N){return N*Math.PI/180}static SmoothAngleChange(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const z=this.ToRadians(N),v=this.ToRadians(q);return this.ToDegrees(Math.atan2((1-R)*Math.sin(v)+R*Math.sin(z),(1-R)*Math.cos(v)+R*Math.cos(z)))}static MakeArray(N,q){return!0===q||void 0!==N&&null!=N?Array.isArray(N)?N:[N]:null}static GetPointerPrefix(N){return(0,v.l)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(N,q){(0,t.y)(N,q)}static SetReferrerPolicyBehavior(N,q){q.referrerPolicy=N}static get PreprocessUrl(){return t.h.PreprocessUrl}static set PreprocessUrl(N){t.h.PreprocessUrl=N}static LoadImage(N,q,R,z,v,B){return(0,t.q)(N,q,R,z,v,B)}static LoadFile(N,q,R,z,v,B){return(0,t.n)(N,q,R,z,v,B)}static LoadFileAsync(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((R,z)=>{(0,t.n)(N,(N=>{R(N)}),void 0,void 0,q,((N,q)=>{z(q)}))}))}static GetBabylonScriptURL(N,q){if(!N)return"";if(D.ScriptBaseUrl&&N.startsWith(D._DefaultCdnUrl)){const q="/"===D.ScriptBaseUrl[D.ScriptBaseUrl.length-1]?D.ScriptBaseUrl.substring(0,D.ScriptBaseUrl.length-1):D.ScriptBaseUrl;N=N.replace(D._DefaultCdnUrl,q)}return N=D.ScriptPreprocessUrl(N),q&&(N=D.GetAbsoluteUrl(N)),N}static LoadBabylonScript(N,q,R,z){N=D.GetBabylonScriptURL(N),D.LoadScript(N,q,R)}static LoadBabylonScriptAsync(N){return N=D.GetBabylonScriptURL(N),D.LoadScriptAsync(N)}static LoadScript(N,q,R,z){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(N),q&&q()}catch(A){null===R||void 0===R||R(`Unable to load script '${N}' in worker`,A)}return}if(!(0,v.l)())return void(null===R||void 0===R||R(`Cannot load script '${N}' outside of a window or a worker`));const F=document.getElementsByTagName("head")[0],S=document.createElement("script");B?(S.setAttribute("type","module"),S.innerText=N):(S.setAttribute("type","text/javascript"),S.setAttribute("src",N)),z&&(S.id=z),S.onload=()=>{q&&q()},S.onerror=q=>{R&&R(`Unable to load script '${N}'`,q)},F.appendChild(S)}static LoadScriptAsync(N,q){return new Promise(((R,z)=>{this.LoadScript(N,(()=>{R()}),((N,q)=>{z(q||new Error(N))}),q)}))}static ReadFileAsDataURL(N,q,R){const v=new FileReader,B={onCompleteObservable:new z.d,abort:()=>v.abort()};return v.onloadend=()=>{B.onCompleteObservable.notifyObservers(B)},v.onload=N=>{q(N.target.result)},v.onprogress=R,v.readAsDataURL(N),B}static ReadFile(N,q,R,z,v){return(0,t.s)(N,q,R,z,v)}static FileAsURL(N){const q=new Blob([N]);return window.URL.createObjectURL(q)}static Format(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return N.toFixed(q)}static DeepCopy(N,q,R,z){F.d.DeepCopy(N,q,R,z)}static IsEmpty(N){for(const q in N)if(Object.prototype.hasOwnProperty.call(N,q))return!1;return!0}static RegisterTopRootEvents(N,q){for(let z=0;z<q.length;z++){const v=q[z];N.addEventListener(v.name,v.handler,!1);try{window.parent&&window.parent.addEventListener(v.name,v.handler,!1)}catch(R){}}}static UnregisterTopRootEvents(N,q){for(let z=0;z<q.length;z++){const v=q[z];N.removeEventListener(v.name,v.handler);try{N.parent&&N.parent.removeEventListener(v.name,v.handler)}catch(R){}}}static async DumpFramebuffer(N,q,R,z){throw(0,A.b)("DumpTools")}static DumpData(N,q,R,z){throw(0,A.b)("DumpTools")}static DumpDataAsync(N,q,R){throw(0,A.b)("DumpTools")}static _IsOffScreenCanvas(N){return void 0!==N.convertToBlob}static ToBlob(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",z=arguments.length>3?arguments[3]:void 0;D._IsOffScreenCanvas(N)||N.toBlob||(N.toBlob=function(N,q,R){setTimeout((()=>{const z=atob(this.toDataURL(q,R).split(",")[1]),v=z.length,B=new Uint8Array(v);for(let N=0;N<v;N++)B[N]=z.charCodeAt(N);N(new Blob([B]))}))}),D._IsOffScreenCanvas(N)?N.convertToBlob({type:R,quality:z}).then((N=>q(N))):N.toBlob((function(N){q(N)}),R,z)}static DownloadBlob(N,q){if("download"in document.createElement("a")){if(!q){const N=new Date;q="screenshot_"+((N.getFullYear()+"-"+(N.getMonth()+1)).slice(2)+"-"+N.getDate()+"_"+N.getHours()+"-"+("0"+N.getMinutes()).slice(-2))+".png"}D.Download(N,q)}else if(N&&"undefined"!==typeof URL){const q=URL.createObjectURL(N),R=window.open("");if(!R)return;const z=R.document.createElement("img");z.onload=function(){URL.revokeObjectURL(q)},z.src=q,R.document.body.appendChild(z)}}static EncodeScreenshotCanvasData(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0;if("string"!==typeof z&&q){if(q){if(D._IsOffScreenCanvas(N))return void N.convertToBlob({type:R,quality:v}).then((N=>{const R=new FileReader;R.readAsDataURL(N),R.onloadend=()=>{const N=R.result;q(N)}}));const z=N.toDataURL(R,v);q(z)}}else this.ToBlob(N,(function(N){N&&D.DownloadBlob(N,z),q&&q("")}),R,v)}static Download(N,q){if("undefined"===typeof URL)return;const R=window.URL.createObjectURL(N),z=document.createElement("a");document.body.appendChild(z),z.style.display="none",z.href=R,z.download=q,z.addEventListener("click",(()=>{z.parentElement&&z.parentElement.removeChild(z)})),z.click(),window.URL.revokeObjectURL(R)}static BackCompatCameraNoPreventDefault(N){return"boolean"===typeof N[0]?N[0]:"boolean"===typeof N[1]&&N[1]}static CreateScreenshot(N,q,R,z){throw(0,A.b)("ScreenshotTools")}static CreateScreenshotAsync(N,q,R){throw(0,A.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(N,q,R,z){throw(0,A.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(N,q,R){throw(0,A.b)("ScreenshotTools")}static RandomId(){return(0,b.e)()}static IsBase64(N){return(0,t.i)(N)}static DecodeBase64(N){return(0,t.e)(N)}static get errorsCount(){return B.c.errorsCount}static Log(N){B.c.Log(N)}static Warn(N){B.c.Warn(N)}static Error(N){B.c.Error(N)}static get LogCache(){return B.c.LogCache}static ClearLogCache(){B.c.ClearLogCache()}static set LogLevels(N){B.c.LogLevels=N}static set PerformanceLogLevel(N){return(N&D.PerformanceUserMarkLogLevel)===D.PerformanceUserMarkLogLevel?(D.StartPerformanceCounter=D._StartUserMark,void(D.EndPerformanceCounter=D._EndUserMark)):(N&D.PerformanceConsoleLogLevel)===D.PerformanceConsoleLogLevel?(D.StartPerformanceCounter=D._StartPerformanceConsole,void(D.EndPerformanceCounter=D._EndPerformanceConsole)):(D.StartPerformanceCounter=D._StartPerformanceCounterDisabled,void(D.EndPerformanceCounter=D._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(N,q){}static _EndPerformanceCounterDisabled(N,q){}static _StartUserMark(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!D._Performance){if(!(0,v.l)())return;D._Performance=window.performance}q&&D._Performance.mark&&D._Performance.mark(N+"-Begin")}static _EndUserMark(N){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&D._Performance.mark&&(D._Performance.mark(N+"-End"),D._Performance.measure(N,N+"-Begin",N+"-End"))}static _StartPerformanceConsole(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];q&&(D._StartUserMark(N,q),console.time&&console.time(N))}static _EndPerformanceConsole(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];q&&(D._EndUserMark(N,q),console.timeEnd(N))}static get Now(){return S.d.Now}static GetClassName(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=null;if(!q&&N.getClassName)R=N.getClassName();else{if(N instanceof Object){R=(q?N:Object.getPrototypeOf(N)).constructor.__bjsclassName__}R||(R=typeof N)}return R}static First(N,q){for(const R of N)if(q(R))return R;return null}static getFullClassName(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=null,z=null;if(!q&&N.getClassName)R=N.getClassName();else{if(N instanceof Object){const v=q?N:Object.getPrototypeOf(N);R=v.constructor.__bjsclassName__,z=v.constructor.__bjsmoduleName__}R||(R=typeof N)}return R?(null!=z?z+".":"")+R:null}static DelayAsync(N){return new Promise((q=>{setTimeout((()=>{q()}),N)}))}static IsSafari(){return!!(0,v.j)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}D.UseCustomRequestHeaders=!1,D.CustomRequestHeaders=y.b.CustomRequestHeaders,D.GetDOMTextContent=v.c,D._DefaultCdnUrl="https://cdn.babylonjs.com",D.GetAbsoluteUrl="object"===typeof document?N=>{const q=document.createElement("a");return q.href=N,q.href}:"function"===typeof URL&&"object"===typeof location?N=>new URL(N,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},D.NoneLogLevel=B.c.NoneLogLevel,D.MessageLogLevel=B.c.MessageLogLevel,D.WarningLogLevel=B.c.WarningLogLevel,D.ErrorLogLevel=B.c.ErrorLogLevel,D.AllLogLevel=B.c.AllLogLevel,D.IsWindowObjectExist=v.l,D.PerformanceNoneLogLevel=0,D.PerformanceUserMarkLogLevel=1,D.PerformanceConsoleLogLevel=2,D.StartPerformanceCounter=D._StartPerformanceCounterDisabled,D.EndPerformanceCounter=D._EndPerformanceCounterDisabled;class V{constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=N,this.index=z-1,this._done=!1,this._fn=q,this._successCallback=R}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(N,q,R){const z=new V(N,q,R,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return z.executeNext(),z}static SyncAsyncForLoop(N,q,R,z,v){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return V.Run(Math.ceil(N/q),(z=>{v&&v()?z.breakLoop():setTimeout((()=>{for(let B=0;B<q;++B){const F=z.index*q+B;if(F>=N)break;if(R(F),v&&v()){z.breakLoop();break}}z.executeNext()}),B)}),z)}}D.Mix=f.n,D.IsExponentOfTwo=f.j,E.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11002:(N,q,R)=>{"use strict";R.d(q,{c:()=>B,f:()=>v});const z={};function v(N,q){z[N]=q}function B(N){return z[N]}},11315:(N,q,R)=>{"use strict";R.d(q,{d:()=>z});class z{static get UniqueId(){const N=this._UniqueIdCounter;return this._UniqueIdCounter++,N}}z._UniqueIdCounter=1},10931:(N,q,R)=>{"use strict";R.d(q,{b:()=>z});class z{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(z.CustomRequestHeaders).length>0||z.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const N in z.CustomRequestHeaders){const q=z.CustomRequestHeaders[N];q&&this._xhr.setRequestHeader(N,q)}}_shouldSkipRequestModifications(N){return z.SkipRequestModificationForBabylonCDN&&(N.includes("preview.babylonjs.com")||N.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(N){this._xhr.onprogress=N}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(N){this._xhr.responseType=N}get timeout(){return this._xhr.timeout}set timeout(N){this._xhr.timeout=N}addEventListener(N,q,R){this._xhr.addEventListener(N,q,R)}removeEventListener(N,q,R){this._xhr.removeEventListener(N,q,R)}abort(){this._xhr.abort()}send(N){z.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(N)}open(N,q){for(const R of z.CustomRequestModifiers){if(this._shouldSkipRequestModifications(q))return;R(this._xhr,q)}q=(q=q.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=q,this._xhr.open(N,q,!0)}setRequestHeader(N,q){this._xhr.setRequestHeader(N,q)}getResponseHeader(N){return this._xhr.getResponseHeader(N)}}z.CustomRequestHeaders={},z.CustomRequestModifiers=new Array,z.SkipRequestModificationForBabylonCDN=!0},12171:(N,q,R)=>{"use strict";R.d(q,{b:()=>v});class z{constructor(N){this._pendingActions=new Array,this._workerInfos=N.map((N=>({workerPromise:Promise.resolve(N),idle:!0})))}dispose(){for(const N of this._workerInfos)N.workerPromise.then((N=>{N.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(N){this._executeOnIdleWorker(N)||this._pendingActions.push(N)}_executeOnIdleWorker(N){for(const q of this._workerInfos)if(q.idle)return this._execute(q,N),!0;return!1}_execute(N,q){N.idle=!1,N.workerPromise.then((R=>{q(R,(()=>{const q=this._pendingActions.shift();q?this._execute(N,q):N.idle=!0}))}))}}class v extends z{constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.DefaultOptions;super([]),this._maxWorkers=N,this._createWorkerAsync=q,this._options=R}push(N){if(!this._executeOnIdleWorker(N))if(this._workerInfos.length<this._maxWorkers){const q={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(q),this._execute(q,N)}else this._pendingActions.push(N)}_execute(N,q){N.timeoutId&&(clearTimeout(N.timeoutId),delete N.timeoutId),super._execute(N,((R,z)=>{q(R,(()=>{z(),N.idle&&(N.timeoutId=setTimeout((()=>{N.workerPromise.then((N=>{N.terminate()}));const q=this._workerInfos.indexOf(N);-1!==q&&this._workerInfos.splice(q,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}v.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11602:(N,q,R)=>{"use strict";R.d(q,{e:()=>VN});var z=R(11181),v=R(11391);class B extends v.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var F=R(11213),S=(R(11611),R(11002));class A{get noiseTexture(){return this._noiseTexture}set noiseTexture(N){this._noiseTexture!==N&&(this._noiseTexture=N,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(N){this._isAnimationSheetEnabled!=N&&(this._isAnimationSheetEnabled=N,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){this._useLogarithmicDepth=N&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:z.m.Zero()}set direction1(N){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=N)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:z.m.Zero()}set direction2(N){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=N)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:z.m.Zero()}set minEmitBox(N){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=N)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:z.m.Zero()}set maxEmitBox(N){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=N)}get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(N){this._isBillboardBased!==N&&(this._isBillboardBased=N,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N)}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(!N&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=N)}_reset(){}_removeGradientAndTexture(N,q,R){if(!q)return this;let z=0;for(const v of q){if(v.gradient===N){q.splice(z,1);break}z++}return R&&R.dispose(),this}constructor(N){this.animations=[],this.renderingGroupId=0,this.j=z.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new z.m(10,10,10),this.onAnimationEnd=null,this.blendMode=A.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new z.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.eg=new z.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=z.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new F.g(1,1,1,1),this.color2=new F.g(1,1,1,1),this.colorDead=new F.g(0,0,0,1),this.textureMask=new F.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new B,this.id=N,this.name=N}createPointEmitter(N,q){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new z.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new z.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new z.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new z.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new z.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new z.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(N,q,R,z){throw new Error("Method not implemented.")}}A.BLENDMODE_ONEONE=0,A.BLENDMODE_STANDARD=1,A.BLENDMODE_ADD=2,A.BLENDMODE_MULTIPLY=3,A.BLENDMODE_MULTIPLYADD=4,(0,S.f)("BABYLON.BaseParticleSystem",A);var y=R(11197),E=R(10911);class t{constructor(){this.direction1=new z.m(0,1,0),this.direction2=new z.m(0,1,0),this.minEmitBox=new z.m(-.5,-.5,-.5),this.maxEmitBox=new z.m(.5,.5,.5)}startDirectionFunction(N,q,R,v){const B=(0,y.u)(this.direction1.x,this.direction2.x),F=(0,y.u)(this.direction1.y,this.direction2.y),S=(0,y.u)(this.direction1.z,this.direction2.z);if(v)return q.x=B,q.y=F,void(q.z=S);z.m.TransformNormalFromFloatsToRef(B,F,S,N,q)}startPositionFunction(N,q,R,v){const B=(0,y.u)(this.minEmitBox.x,this.maxEmitBox.x),F=(0,y.u)(this.minEmitBox.y,this.maxEmitBox.y),S=(0,y.u)(this.minEmitBox.z,this.maxEmitBox.z);if(v)return q.x=B,q.y=F,void(q.z=S);z.m.TransformCoordinatesFromFloatsToRef(B,F,S,N,q)}clone(){const N=new t;return E.d.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2),N.setVector3("minEmitBox",this.minEmitBox),N.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3),N.addUniform("minEmitBox",3),N.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.ij(),N.direction2=this.direction2.ij(),N.minEmitBox=this.minEmitBox.ij(),N.maxEmitBox=this.maxEmitBox.ij(),N}parse(N){z.m.FromArrayToRef(N.direction1,0,this.direction1),z.m.FromArrayToRef(N.direction2,0,this.direction2),z.m.FromArrayToRef(N.minEmitBox,0,this.minEmitBox),z.m.FromArrayToRef(N.maxEmitBox,0,this.maxEmitBox)}}class x{get radius(){return this._radius}set radius(N){this._radius=N,this._buildHeight()}get angle(){return this._angle}set angle(N){this._angle=N,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=R,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=q,this.radius=N}startDirectionFunction(N,q,R,v){v?z.k.o[0].p(R.ne).normalize():R.position.subtractToRef(N.getTranslation(),z.k.o[0]).normalize();const B=(0,y.u)(0,this.directionRandomizer),F=(0,y.u)(0,this.directionRandomizer),S=(0,y.u)(0,this.directionRandomizer);q.x=z.k.o[0].x+B,q.y=z.k.o[0].y+F,q.z=z.k.o[0].z+S,q.normalize()}startPositionFunction(N,q,R,v){const B=(0,y.u)(0,2*Math.PI);let F;this.emitFromSpawnPointOnly?F=1e-4:(F=(0,y.u)(0,this.heightRange),F=1-F*F);let S=this._radius-(0,y.u)(0,this._radius*this.radiusRange);S*=F;const A=S*Math.sin(B),E=S*Math.cos(B),t=F*this._height;if(v)return q.x=A,q.y=t,void(q.z=E);z.m.TransformCoordinatesFromFloatsToRef(A,t,E,N,q)}clone(){const N=new x(this._radius,this._angle,this.directionRandomizer);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat2("radius",this._radius,this.radiusRange),N.setFloat("coneAngle",this._angle),N.setFloat2("height",this._height,this.heightRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",2),N.addUniform("coneAngle",1),N.addUniform("height",2),N.addUniform("directionRandomizer",1)}getEffectDefines(){let N="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(N+="\n#define CONEEMITTERSPAWNPOINT"),N}getClassName(){return"ConeParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this._radius,N.angle=this._angle,N.directionRandomizer=this.directionRandomizer,N.radiusRange=this.radiusRange,N.heightRange=this.heightRange,N.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,N}parse(N){this.radius=N.radius,this.angle=N.angle,this.directionRandomizer=N.directionRandomizer,this.radiusRange=void 0!==N.radiusRange?N.radiusRange:1,this.heightRange=void 0!==N.radiusRange?N.heightRange:1,this.emitFromSpawnPointOnly=void 0!==N.emitFromSpawnPointOnly&&N.emitFromSpawnPointOnly}}class e extends x{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0),v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0);super(N,q),this.direction1=R,this.direction2=v}startDirectionFunction(N,q){const R=(0,y.u)(this.direction1.x,this.direction2.x),v=(0,y.u)(this.direction1.y,this.direction2.y),B=(0,y.u)(this.direction1.z,this.direction2.z);z.m.TransformNormalFromFloatsToRef(R,v,B,N,q)}clone(){const N=new e(this.radius,this.angle,this.direction1,this.direction2);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.ij(),N.direction2=this.direction2.ij(),N}parse(N){super.parse(N),this.direction1.p(N.direction1),this.direction2.p(N.direction2)}}class b{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=N,this.height=q,this.radiusRange=R,this.directionRandomizer=v,this._tempVector=z.m.Zero()}startDirectionFunction(N,q,R,v,B){R.position.subtractToRef(N.getTranslation(),this._tempVector),this._tempVector.normalize(),z.m.TransformNormalToRef(this._tempVector,B,this._tempVector);const F=(0,y.u)(-this.directionRandomizer/2,this.directionRandomizer/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,y.u)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=F,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),v?q.p(this._tempVector):z.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N,q)}startPositionFunction(N,q,R,v){const B=(0,y.u)(-this.height/2,this.height/2),F=(0,y.u)(0,2*Math.PI),S=(0,y.u)((1-this.radiusRange)*(1-this.radiusRange),1),A=Math.sqrt(S)*this.radius,E=A*Math.cos(F),t=A*Math.sin(F);v?q.qe(E,B,t):z.m.TransformCoordinatesFromFloatsToRef(E,B,t,N,q)}clone(){const N=new b(this.radius,this.directionRandomizer);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.height=this.height,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.height=N.height,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class f extends b{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.m(0,1,0);super(N,q,R),this.direction1=v,this.direction2=B}startDirectionFunction(N,q,R,v){const B=(0,y.u)(this.direction1.x,this.direction2.x),F=(0,y.u)(this.direction1.y,this.direction2.y),S=(0,y.u)(this.direction1.z,this.direction2.z);v?q.qe(B,F,S):z.m.TransformNormalFromFloatsToRef(B,F,S,N,q)}clone(){const N=new f(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.ij(),N.direction2=this.direction2.ij(),N}parse(N){super.parse(N),z.m.FromArrayToRef(N.direction1,0,this.direction1),z.m.FromArrayToRef(N.direction2,0,this.direction2)}}class D{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=q,this.directionRandomizer=R}startDirectionFunction(N,q,R,v){const B=R.position.gd(N.getTranslation()).normalize(),F=(0,y.u)(0,this.directionRandomizer),S=(0,y.u)(0,this.directionRandomizer),A=(0,y.u)(0,this.directionRandomizer);B.x+=F,B.y+=S,B.z+=A,B.normalize(),v?q.p(B):z.m.TransformNormalFromFloatsToRef(B.x,B.y,B.z,N,q)}startPositionFunction(N,q,R,v){const B=this.radius-(0,y.u)(0,this.radius*this.radiusRange),F=(0,y.u)(0,1),S=(0,y.u)(0,2*Math.PI),A=Math.acos(2*F-1),E=B*Math.cos(S)*Math.sin(A),t=B*Math.cos(A),x=B*Math.sin(S)*Math.sin(A);v?q.qe(E,Math.abs(t),x):z.m.TransformCoordinatesFromFloatsToRef(E,Math.abs(t),x,N,q)}clone(){const N=new D(this.radius,this.directionRandomizer);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class V{constructor(){this.direction1=new z.m(0,1,0),this.direction2=new z.m(0,1,0)}startDirectionFunction(N,q,R,v){const B=(0,y.u)(this.direction1.x,this.direction2.x),F=(0,y.u)(this.direction1.y,this.direction2.y),S=(0,y.u)(this.direction1.z,this.direction2.z);v?q.qe(B,F,S):z.m.TransformNormalFromFloatsToRef(B,F,S,N,q)}startPositionFunction(N,q,R,v){v?q.qe(0,0,0):z.m.TransformCoordinatesFromFloatsToRef(0,0,0,N,q)}clone(){const N=new V;return E.d.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.ij(),N.direction2=this.direction2.ij(),N}parse(N){z.m.FromArrayToRef(N.direction1,0,this.direction1),z.m.FromArrayToRef(N.direction2,0,this.direction2)}}class H{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=q,this.directionRandomizer=R}startDirectionFunction(N,q,R,v){const B=R.position.gd(N.getTranslation()).normalize(),F=(0,y.u)(0,this.directionRandomizer),S=(0,y.u)(0,this.directionRandomizer),A=(0,y.u)(0,this.directionRandomizer);B.x+=F,B.y+=S,B.z+=A,B.normalize(),v?q.p(B):z.m.TransformNormalFromFloatsToRef(B.x,B.y,B.z,N,q)}startPositionFunction(N,q,R,v){const B=this.radius-(0,y.u)(0,this.radius*this.radiusRange),F=(0,y.u)(0,1),S=(0,y.u)(0,2*Math.PI),A=Math.acos(2*F-1),E=B*Math.cos(S)*Math.sin(A),t=B*Math.cos(A),x=B*Math.sin(S)*Math.sin(A);v?q.qe(E,t,x):z.m.TransformCoordinatesFromFloatsToRef(E,t,x,N,q)}clone(){const N=new H(this.radius,this.directionRandomizer);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class Y extends H{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.m(0,1,0),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0);super(N),this.direction1=q,this.direction2=R}startDirectionFunction(N,q){const R=(0,y.u)(this.direction1.x,this.direction2.x),v=(0,y.u)(this.direction1.y,this.direction2.y),B=(0,y.u)(this.direction1.z,this.direction2.z);z.m.TransformNormalFromFloatsToRef(R,v,B,N,q)}clone(){const N=new Y(this.radius,this.direction1,this.direction2);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.ij(),N.direction2=this.direction2.ij(),N}parse(N){super.parse(N),this.direction1.p(N.direction1),this.direction2.p(N.direction2)}}class T{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(N,q,R,v){const B=z.k.o[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,R,B);const N=z.k.o[1];B.subtractToRef(R.position,N),N.scaleToRef(1/R.lifeTime,B)}else B.set(0,0,0);v?q.p(B):z.m.TransformNormalToRef(B,N,q)}startPositionFunction(N,q,R,v){const B=z.k.o[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,R,B):B.set(0,0,0),v?q.p(B):z.m.TransformCoordinatesToRef(B,N,q)}clone(){const N=new T;return E.d.DeepCopy(this,N),N}applyToShader(N){}buildUniformLayout(N){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.particlePositionGenerator=this.particlePositionGenerator,N.particleDestinationGenerator=this.particleDestinationGenerator,N}parse(N){N.particlePositionGenerator&&(this.particlePositionGenerator=N.particlePositionGenerator),N.particleDestinationGenerator&&(this.particleDestinationGenerator=N.particleDestinationGenerator)}}var L=R(11251);class X{get mesh(){return this._mesh}set mesh(N){this._mesh!==N&&(this._mesh=N,N?(this._indices=N.gg(),this._positions=N.getVerticesData(L.h.PositionKind),this._normals=N.getVerticesData(L.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=z.m.Zero(),this._mesh=null,this.direction1=new z.m(0,1,0),this.direction2=new z.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=N}startDirectionFunction(N,q,R,v){if(this.useMeshNormalsForDirection&&this._normals)return void z.m.TransformNormalToRef(this._storedNormal,N,q);const B=(0,y.u)(this.direction1.x,this.direction2.x),F=(0,y.u)(this.direction1.y,this.direction2.y),S=(0,y.u)(this.direction1.z,this.direction2.z);v?q.qe(B,F,S):z.m.TransformNormalFromFloatsToRef(B,F,S,N,q)}startPositionFunction(N,q,R,v){if(!this._indices||!this._positions)return;const B=3*Math.random()*(this._indices.length/3)|0,F=Math.random(),S=Math.random()*(1-F),A=1-F-S,y=this._indices[B],E=this._indices[B+1],t=this._indices[B+2],x=z.k.o[0],e=z.k.o[1],b=z.k.o[2],f=z.k.o[3];z.m.FromArrayToRef(this._positions,3*y,x),z.m.FromArrayToRef(this._positions,3*E,e),z.m.FromArrayToRef(this._positions,3*t,b),f.x=F*x.x+S*e.x+A*b.x,f.y=F*x.y+S*e.y+A*b.y,f.z=F*x.z+S*e.z+A*b.z,v?q.qe(f.x,f.y,f.z):z.m.TransformCoordinatesFromFloatsToRef(f.x,f.y,f.z,N,q),this.useMeshNormalsForDirection&&this._normals&&(z.m.FromArrayToRef(this._normals,3*y,x),z.m.FromArrayToRef(this._normals,3*E,e),z.m.FromArrayToRef(this._normals,3*t,b),this._storedNormal.x=F*x.x+S*e.x+A*b.x,this._storedNormal.y=F*x.y+S*e.y+A*b.y,this._storedNormal.z=F*x.z+S*e.z+A*b.z)}clone(){const N=new X(this.mesh);return E.d.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var N;const q={};return q.type=this.getClassName(),q.direction1=this.direction1.ij(),q.direction2=this.direction2.ij(),q.meshId=null===(N=this.mesh)||void 0===N?void 0:N.id,q.useMeshNormalsForDirection=this.useMeshNormalsForDirection,q}parse(N,q){z.m.FromArrayToRef(N.direction1,0,this.direction1),z.m.FromArrayToRef(N.direction2,0,this.direction2),N.meshId&&q&&(this.mesh=q.getLastMeshById(N.meshId)),this.useMeshNormalsForDirection=N.useMeshNormalsForDirection}}var Q=R(10964);class h{_isUbo(N){return void 0!==N.addUniform}constructor(N){this._isUbo(N)?(this.setMatrix3x3=N.updateMatrix3x3.bind(N),this.setMatrix2x2=N.updateMatrix2x2.bind(N),this.setFloat=N.updateFloat.bind(N),this.setFloat2=N.updateFloat2.bind(N),this.setFloat3=N.updateFloat3.bind(N),this.setFloat4=N.updateFloat4.bind(N),this.setFloatArray=N.updateFloatArray.bind(N),this.setArray=N.updateArray.bind(N),this.setIntArray=N.updateIntArray.bind(N),this.setMatrix=N.Hj.bind(N),this.setMatrices=N.updateMatrices.bind(N),this.setVector3=N.updateVector3.bind(N),this.setVector4=N.updateVector4.bind(N),this.setColor3=N.updateColor3.bind(N),this.setColor4=N.updateColor4.bind(N),this.setDirectColor4=N.updateDirectColor4.bind(N),this.setInt=N.updateInt.bind(N),this.setInt2=N.updateInt2.bind(N),this.setInt3=N.updateInt3.bind(N),this.setInt4=N.updateInt4.bind(N)):(this.setMatrix3x3=N.setMatrix3x3.bind(N),this.setMatrix2x2=N.setMatrix2x2.bind(N),this.setFloat=N.setFloat.bind(N),this.setFloat2=N.setFloat2.bind(N),this.setFloat3=N.setFloat3.bind(N),this.setFloat4=N.setFloat4.bind(N),this.setFloatArray=N.setFloatArray.bind(N),this.setArray=N.setArray.bind(N),this.setIntArray=N.setIntArray.bind(N),this.setMatrix=N.setMatrix.bind(N),this.setMatrices=N.setMatrices.bind(N),this.setVector3=N.setVector3.bind(N),this.setVector4=N.setVector4.bind(N),this.setColor3=N.setColor3.bind(N),this.setColor4=N.setColor4.bind(N),this.setDirectColor4=N.setDirectColor4.bind(N),this.setInt=N.setInt.bind(N),this.setInt2=N.setInt2.bind(N),this.setInt3=N.setInt3.bind(N),this.setInt4=N.setInt4.bind(N))}}var u=R(10966);const w="gpuUpdateParticlesPixelShader",c="#version 300 es\nvoid main() {discard;}\n";u.e.ShadersStore[w]=c;const n="gpuUpdateParticlesVertexShader",G="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";u.e.ShadersStore[n]=G;(0,S.f)("BABYLON.WebGL2ParticleSystem",class{constructor(N,q){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=N,this._engine=q,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var N;return(null===(N=this._updateEffect)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof T&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=N,this._updateEffect=new Q.d("gpuUpdateParticles",this._updateEffectOptions,this._engine),new h(this._updateEffect)}createVertexBuffers(N,q){this._updateVAO.push(this._createUpdateVAO(N)),this._renderVAO.push(this._engine.recordVertexArrayObject(q,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=q}createParticleBuffer(N){return N}bindDrawBuffers(N,q,R){R?this._engine.bindBuffers(this._renderVertexBuffers,R,q):this._engine.bindVertexArrayObject(this._renderVAO[N],null)}preUpdateParticleBuffer(){const N=this._engine;if(this._engine.enableEffect(this._updateEffect),!N.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(N,q,R){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[N],null);const z=this._engine;z.bindTransformFeedbackBuffer(q.getBuffer()),z.setRasterizerState(!1),z.beginTransformFeedback(!0),z.drawArraysType(3,0,R),z.endTransformFeedback(),z.setRasterizerState(!0),z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let N=0;N<this._updateVAO.length;N++)this._engine.releaseVertexArrayObject(this._updateVAO[N]);this._updateVAO.length=0;for(let N=0;N<this._renderVAO.length;N++)this._engine.releaseVertexArrayObject(this._renderVAO[N]);this._renderVAO.length=0}_createUpdateVAO(N){const q={};q.position=N.createVertexBuffer("position",0,3);let R=3;q.age=N.createVertexBuffer("age",R,1),R+=1,q.size=N.createVertexBuffer("size",R,3),R+=3,q.life=N.createVertexBuffer("life",R,1),R+=1,q.seed=N.createVertexBuffer("seed",R,4),R+=4,q.direction=N.createVertexBuffer("direction",R,3),R+=3,this._parent.particleEmitterType instanceof T&&(q.initialPosition=N.createVertexBuffer("initialPosition",R,3),R+=3),this._parent._colorGradientsTexture||(q.color=N.createVertexBuffer("color",R,4),R+=4),this._parent._isBillboardBased||(q.initialDirection=N.createVertexBuffer("initialDirection",R,3),R+=3),this._parent.noiseTexture&&(q.noiseCoordinates1=N.createVertexBuffer("noiseCoordinates1",R,3),R+=3,q.noiseCoordinates2=N.createVertexBuffer("noiseCoordinates2",R,3),R+=3),this._parent._angularSpeedGradientsTexture?(q.angle=N.createVertexBuffer("angle",R,1),R+=1):(q.angle=N.createVertexBuffer("angle",R,2),R+=2),this._parent._isAnimationSheetEnabled&&(q.cellIndex=N.createVertexBuffer("cellIndex",R,1),R+=1,this._parent.spriteRandomStartCell&&(q.cellStartOffset=N.createVertexBuffer("cellStartOffset",R,1),R+=1));const z=this._engine.recordVertexArrayObject(q,null,this._updateEffect);return this._engine.bindArrayBuffer(null),z}});class s{constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,z=arguments.length>3?arguments[3]:void 0;this._engine=N,this._label=z,this._engine._storageBuffers.push(this),this._create(q,R)}_create(N,q){this._bufferSize=N,this._creationFlags=q,this._buffer=this._engine.createStorageBuffer(N,q,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(N,q,R){this._buffer&&this._engine.updateStorageBuffer(this._buffer,N,q,R)}read(N,q,R,z){return this._engine.readFromStorageBuffer(this._buffer,N,q,R,z)}dispose(){const N=this._engine._storageBuffers,q=N.indexOf(this);-1!==q&&(N[q]=N[N.length-1],N.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Z=R(11147),J=R(11151),M=R(11221),m=R(11402),g=R(11315),j=R(10907),l=R(10987),I=R(11019);class U{constructor(){this._gpuTimeInFrameId=-1,this.counter=new I.c}_addDuration(N,q){N<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==N?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(q,!1),this._gpuTimeInFrameId=N):this.counter.addCount(q,!1))}}class O{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=N,this._engine=q,this.uniqueId=g.d.UniqueId,q.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new U),this._engine.getCaps().supportComputeShaders?z.bindingsMapping?(this._context=q.createComputeContext(),this._shaderPath=R,this._options={bindingsMapping:{},defines:[],...z}):j.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):j.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this._bindings[N];this._bindings[N]={type:R?0:4,object:q,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!z||z.object!==q||z.type!==this._bindings[N].type)}setStorageTexture(N,q){const R=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==q),this._bindings[N]={type:1,object:q,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setExternalTexture(N,q){const R=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==q),this._bindings[N]={type:6,object:q,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setVideoTexture(N,q){return!!q.externalTexture&&(this.setExternalTexture(N,q.externalTexture),!0)}setUniformBuffer(N,q){const R=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==q),this._bindings[N]={type:O._BufferIsDataBuffer(q)?7:2,object:q,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setStorageBuffer(N,q){const R=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==q),this._bindings[N]={type:O._BufferIsDataBuffer(q)?7:3,object:q,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setTextureSampler(N,q){const R=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!R||!q.compareSampler(R.object)),this._bindings[N]={type:5,object:q,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}isReady(){let N=this._effect;for(const v in this._bindings){const N=this._bindings[v],q=N.type,R=N.object;switch(q){case 0:case 4:case 1:if(!R.isReady())return!1;break;case 6:if(!R.isReady())return!1;break}}const q=[],R=this._shaderPath;if(this._options.defines)for(let v=0;v<this._options.defines.length;v++)q.push(this._options.defines[v]);const z=q.join("\n");return this._cachedDefines!==z&&(this._cachedDefines=z,N=this._engine.createComputeEffect(R,{defines:z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=N),!!N.isReady()}dispatch(N,q,R){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,N,q,R,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const R=O._BufferIsDataBuffer(N)?N:N.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,R,q,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const q in this._bindings){const R=this._bindings[q];if(!this._options.bindingsMapping[q])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+q+"'");switch(R.type){case 0:{const z=this._samplers[q],v=R.object;var N;if(!z||!v._texture||!z.compareSampler(v._texture))this._samplers[q]=(new l.b).setParameters(v.wrapU,v.wrapV,v.wrapR,v.anisotropicFilteringLevel,v._texture.samplingMode,null===(N=v._texture)||void 0===N?void 0:N._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const N=R.object;N.getBuffer()!==R.buffer&&(R.buffer=N.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((v=>{const B=()=>{this.dispatch(N,q,R)?v():setTimeout(B,z)};B()}))}serialize(){const N=M.e.Serialize(this);N.options=this._options,N.shaderPath=this._shaderPath,N.xj={},N.textures={};for(const q in this._bindings){const R=this._bindings[q],z=R.object;switch(R.type){case 0:case 4:case 1:{const v=z.serialize();v&&(N.textures[q]=v,N.xj[q]={type:R.type});break}}}return N}static Parse(N,q,R){const z=M.e.Parse((()=>new O(N.name,q.getEngine(),N.shaderPath,N.options)),N,q,R);for(const v in N.textures){const B=N.xj[v],F=m.c.Parse(N.textures[v],q,R);0===B.type?z.setTexture(v,F):4===B.type?z.setTexture(v,F,!1):z.setStorageTexture(v,F)}return z}static _BufferIsDataBuffer(N){return void 0!==N.underlyingResource}}(0,Z.c)([(0,J.D)()],O.prototype,"name",void 0),(0,Z.c)([(0,J.D)()],O.prototype,"fastMode",void 0),(0,S.f)("BABYLON.ComputeShader",O);var i=R(11238);const P="gpuUpdateParticlesComputeShader",k="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";u.e.ShadersStoreWGSL[P]=k;(0,S.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(N,q){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=N,this._engine=q}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var N;return(null===(N=this._updateComputeShader)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){var q;const R={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(R.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(R.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(R.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(R.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(R.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(R.noiseTexture={group:1,binding:11}),this._updateComputeShader=new O("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:R,defines:N.split("\n")}),null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=new i.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new h(this._simParamsComputeShader)}createVertexBuffers(N,q){this._renderVertexBuffers.push(q)}createParticleBuffer(N){const q=new s(this._engine,4*N.length,11,"ComputeShaderParticleSystemBuffer");return q.update(N),this._bufferComputeShader.push(q),q.getBuffer()}bindDrawBuffers(N,q,R){this._engine.bindBuffers(this._renderVertexBuffers[N],R,q)}preUpdateParticleBuffer(){}updateParticleBuffer(N,q,R){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[N]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^N]),this._updateComputeShader.dispatch(Math.ceil(R/64))}releaseBuffers(){var N;for(let q=0;q<this._bufferComputeShader.length;++q)this._bufferComputeShader[q].dispose();this._bufferComputeShader.length=0,null===(N=this._simParamsComputeShader)||void 0===N||N.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class o{constructor(N,q,R){this.gradient=N,this.color1=q,this.color2=R}getColorToRef(N){this.color2?F.g.LerpToRef(this.color1,this.color2,Math.random(),N):N.p(this.color1)}}class C{constructor(N,q){this.gradient=N,this.color=q}}class K{constructor(N,q,R){this.gradient=N,this.factor1=q,this.factor2=R}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class r{static GetCurrentGradient(N,q,R){if(q[0].gradient>N)return void R(q[0],q[0],1);for(let v=0;v<q.length-1;v++){const z=q[v],B=q[v+1];if(N>=z.gradient&&N<=B.gradient){return void R(z,B,(N-z.gradient)/(B.gradient-z.gradient))}}const z=q.length-1;R(q[z],q[z],1)}}var a=R(10893),d=R(11642),p=R(10933);class W{constructor(N){this.particleSystem=N,this.position=z.m.Zero(),this.direction=z.m.Zero(),this.color=new F.g(0,0,0,0),this.colorStep=new F.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new z.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new F.g(0,0,0,0),this._currentColor2=new F.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=W._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let N=this.age,q=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===q?(q=1,N=this._randomCellOffset):N+=this._randomCellOffset);const R=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let z;z=this._initialSpriteCellLoop?(0,y.c)(N*q%this.lifeTime/this.lifeTime):(0,y.c)(N*q/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+z*R|0}_inheritParticleInfoToSubEmitter(N){if(N.particleSystem.j.position){const q=N.particleSystem.j;if(q.position.p(this.position),N.inheritDirection){const N=z.k.o[0];this.direction.normalizeToRef(N),q.setDirection(N,0,Math.PI/2)}}else{N.particleSystem.j.p(this.position)}this.direction.scaleToRef(N.inheritedVelocityAmount/2,z.k.o[0]),N.particleSystem._inheritedVelocityOffset.p(z.k.o[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((N=>{this._inheritParticleInfoToSubEmitter(N)}))}_reset(){this.age=0,this.id=W._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(N){N.position.p(this.position),this._initialDirection?N._initialDirection?N._initialDirection.p(this._initialDirection):N._initialDirection=this._initialDirection.clone():N._initialDirection=null,N.direction.p(this.direction),this.ne&&(N.ne?N.ne.p(this.ne):N.ne=this.ne.clone()),N.color.p(this.color),N.colorStep.p(this.colorStep),N.lifeTime=this.lifeTime,N.age=this.age,N._randomCellOffset=this._randomCellOffset,N.size=this.size,N.scale.p(this.scale),N.angle=this.angle,N.angularSpeed=this.angularSpeed,N.particleSystem=this.particleSystem,N.cellIndex=this.cellIndex,N.id=this.id,N._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(N._currentColorGradient=this._currentColorGradient,N._currentColor1.p(this._currentColor1),N._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(N._currentSizeGradient=this._currentSizeGradient,N._currentSize1=this._currentSize1,N._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(N._currentAngularSpeedGradient=this._currentAngularSpeedGradient,N._currentAngularSpeed1=this._currentAngularSpeed1,N._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(N._currentVelocityGradient=this._currentVelocityGradient,N._currentVelocity1=this._currentVelocity1,N._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(N._currentLimitVelocityGradient=this._currentLimitVelocityGradient,N._currentLimitVelocity1=this._currentLimitVelocity1,N._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(N._currentDragGradient=this._currentDragGradient,N._currentDrag1=this._currentDrag1,N._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(N._initialStartSpriteCellID=this._initialStartSpriteCellID,N._initialEndSpriteCellID=this._initialEndSpriteCellID,N._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(N.remapData&&this.remapData?N.remapData.p(this.remapData):N.remapData=new z.p(0,0,0,0)),this._randomNoiseCoordinates1&&(N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),N._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(N._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),N._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}W._Count=0;var NN=R(11370),qN=(R(11646),R(11386)),RN=R(11379),zN=R(11236);class vN extends A{set onDispose(N){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(N)}get useRampGradients(){return this._useRampGradients}set useRampGradients(N){this._useRampGradients!==N&&(this._useRampGradients=N,this._resetEffect())}get particles(){return this.sj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.sj.length}getClassName(){return"sb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[q])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new NN.e(this._engine),this._customWrappers[q].effect=N,this._customWrappers[q].drawContext&&(this._customWrappers[q].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(N),this._emitterInverseWorldMatrix=z.d.Identity(),this._inheritedVelocityOffset=new z.m,this.jj=new a.d,this.onStoppedObservable=new a.d,this.sj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new F.g(0,0,0,0),this._colorDiff=new F.g(0,0,0,0),this._scaledDirection=z.m.Zero(),this._scaledGravity=z.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=N=>{},this.recycleParticle=N=>{const q=this.sj.pop();q!==N&&q.copyTo(N),this._stockParticles.push(q)},this._createParticle=()=>{let N;return 0!==this._stockParticles.length?(N=this._stockParticles.pop(),N._reset()):N=new W(this),this._prepareParticle(N),N},this._shadersLoaded=!1,this._capacity=q,this._epsilon=S,this._isAnimationSheetEnabled=B,R&&"Scene"!==R.getClassName()?(this._engine=R,this.defaultProjectionMatrix=z.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=R||p.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new NN.e(this._engine)},this._customWrappers[0].effect=v,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new t;let A=null;this.updateFunction=N=>{let q=null;var R;this.noiseTexture&&(q=this.noiseTexture.getSize(),null===(R=this.noiseTexture.getContent())||void 0===R||R.then((N=>{A=N})));const v=N===this.sj;for(let B=0;B<N.length;B++){const R=N[B];let S=this._scaledUpdateSpeed;const E=R.age;if(R.age+=S,R.age>R.lifeTime){const N=R.age-E;S=(R.lifeTime-E)*S/N,R.age=R.lifeTime}const t=R.age/R.lifeTime;this._colorGradients&&this._colorGradients.length>0?r.GetCurrentGradient(t,this._colorGradients,((N,q,z)=>{N!==R._currentColorGradient&&(R._currentColor1.p(R._currentColor2),q.getColorToRef(R._currentColor2),R._currentColorGradient=N),F.g.LerpToRef(R._currentColor1,R._currentColor2,z,R.color)})):(R.colorStep.scaleToRef(S,this._scaledColorStep),R.color.addInPlace(this._scaledColorStep),R.color.a<0&&(R.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&r.GetCurrentGradient(t,this._angularSpeedGradients,((N,q,z)=>{N!==R._currentAngularSpeedGradient&&(R._currentAngularSpeed1=R._currentAngularSpeed2,R._currentAngularSpeed2=q.getFactor(),R._currentAngularSpeedGradient=N),R.angularSpeed=(0,y.m)(R._currentAngularSpeed1,R._currentAngularSpeed2,z)})),R.angle+=R.angularSpeed*S;let x=S;if(this._velocityGradients&&this._velocityGradients.length>0&&r.GetCurrentGradient(t,this._velocityGradients,((N,q,z)=>{N!==R._currentVelocityGradient&&(R._currentVelocity1=R._currentVelocity2,R._currentVelocity2=q.getFactor(),R._currentVelocityGradient=N),x*=(0,y.m)(R._currentVelocity1,R._currentVelocity2,z)})),R.direction.scaleToRef(x,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&r.GetCurrentGradient(t,this._limitVelocityGradients,((N,q,z)=>{N!==R._currentLimitVelocityGradient&&(R._currentLimitVelocity1=R._currentLimitVelocity2,R._currentLimitVelocity2=q.getFactor(),R._currentLimitVelocityGradient=N);const v=(0,y.m)(R._currentLimitVelocity1,R._currentLimitVelocity2,z);R.direction.length()>v&&R.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&r.GetCurrentGradient(t,this._dragGradients,((N,q,z)=>{N!==R._currentDragGradient&&(R._currentDrag1=R._currentDrag2,R._currentDrag2=q.getFactor(),R._currentDragGradient=N);const v=(0,y.m)(R._currentDrag1,R._currentDrag2,z);this._scaledDirection.scaleInPlace(1-v)})),this.isLocal&&R.ne?(R.ne.addInPlace(this._scaledDirection),z.m.TransformCoordinatesToRef(R.ne,this._emitterWorldMatrix,R.position)):R.position.addInPlace(this._scaledDirection),A&&q&&R._randomNoiseCoordinates1){const N=this._fetchR(R._randomNoiseCoordinates1.x,R._randomNoiseCoordinates1.y,q.width,q.height,A),v=this._fetchR(R._randomNoiseCoordinates1.z,R._randomNoiseCoordinates2.x,q.width,q.height,A),B=this._fetchR(R._randomNoiseCoordinates2.y,R._randomNoiseCoordinates2.z,q.width,q.height,A),F=z.k.o[0],y=z.k.o[1];F.qe((2*N-1)*this.noiseStrength.x,(2*v-1)*this.noiseStrength.y,(2*B-1)*this.noiseStrength.z),F.scaleToRef(S,y),R.direction.addInPlace(y)}this.gravity.scaleToRef(S,this._scaledGravity),R.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&r.GetCurrentGradient(t,this._sizeGradients,((N,q,z)=>{N!==R._currentSizeGradient&&(R._currentSize1=R._currentSize2,R._currentSize2=q.getFactor(),R._currentSizeGradient=N),R.size=(0,y.m)(R._currentSize1,R._currentSize2,z)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&r.GetCurrentGradient(t,this._colorRemapGradients,((N,q,z)=>{const v=(0,y.m)(N.factor1,q.factor1,z),B=(0,y.m)(N.factor2,q.factor2,z);R.remapData.x=v,R.remapData.y=B-v})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&r.GetCurrentGradient(t,this._alphaRemapGradients,((N,q,z)=>{const v=(0,y.m)(N.factor1,q.factor1,z),B=(0,y.m)(N.factor2,q.factor2,z);R.remapData.z=v,R.remapData.w=B-v}))),this._isAnimationSheetEnabled&&R.updateCellIndex(),R._inheritParticleInfoToSubEmitters(),R.age>=R.lifeTime&&(this._emitFromParticle(R),R._attachedSubEmitters&&(R._attachedSubEmitters.forEach((N=>{N.particleSystem.disposeOnStop=!0,N.particleSystem.stop()})),R._attachedSubEmitters=null),this.recycleParticle(R),v&&B--)}}}serialize(N){throw new Error("Method not implemented.")}clone(N,q){throw new Error("Method not implemented.")}_addFactorGradient(N,q,R,z){const v=new K(q,R,z);N.push(v),N.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0))}_removeFactorGradient(N,q){if(!N)return;let R=0;for(const z of N){if(z.gradient===q){N.splice(R,1);break}R++}}addLifeTimeGradient(N,q,R){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,N,q,R),this}removeLifeTimeGradient(N){return this._removeFactorGradient(this._lifeTimeGradients,N),this}addSizeGradient(N,q,R){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,q,R),this}removeSizeGradient(N){return this._removeFactorGradient(this._sizeGradients,N),this}addColorRemapGradient(N,q,R){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,N,q,R),this}removeColorRemapGradient(N){return this._removeFactorGradient(this._colorRemapGradients,N),this}addAlphaRemapGradient(N,q,R){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,N,q,R),this}removeAlphaRemapGradient(N){return this._removeFactorGradient(this._alphaRemapGradients,N),this}addAngularSpeedGradient(N,q,R){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,q,R),this}removeAngularSpeedGradient(N){return this._removeFactorGradient(this._angularSpeedGradients,N),this}addVelocityGradient(N,q,R){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,q,R),this}removeVelocityGradient(N){return this._removeFactorGradient(this._velocityGradients,N),this}addLimitVelocityGradient(N,q,R){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,q,R),this}removeLimitVelocityGradient(N){return this._removeFactorGradient(this._limitVelocityGradients,N),this}addDragGradient(N,q,R){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,q,R),this}removeDragGradient(N){return this._removeFactorGradient(this._dragGradients,N),this}addEmitRateGradient(N,q,R){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,N,q,R),this}removeEmitRateGradient(N){return this._removeFactorGradient(this._emitRateGradients,N),this}addStartSizeGradient(N,q,R){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,N,q,R),this}removeStartSizeGradient(N){return this._removeFactorGradient(this._startSizeGradients,N),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const N=new Uint8Array(4*this._rawTextureWidth),q=F.h.hb[0];for(let R=0;R<this._rawTextureWidth;R++){const z=R/this._rawTextureWidth;r.GetCurrentGradient(z,this._rampGradients,((z,v,B)=>{F.c.LerpToRef(z.color,v.color,B,q),N[4*R]=255*q.r,N[4*R+1]=255*q.g,N[4*R+2]=255*q.b,N[4*R+3]=255}))}this._rampGradientsTexture=d.e.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(N,q){this._rampGradients||(this._rampGradients=[]);const R=new C(N,q);return this._rampGradients.push(R),this._syncRampGradientTexture(),this}removeRampGradient(N){return this._removeGradientAndTexture(N,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(N,q,R){this._colorGradients||(this._colorGradients=[]);const z=new o(N,q,R);return this._colorGradients.push(z),this._colorGradients.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0)),this}removeColorGradient(N){if(!this._colorGradients)return this;let q=0;for(const R of this._colorGradients){if(R.gradient===N){this._colorGradients.splice(q,1);break}q++}return this}resetDrawCache(){for(const N of this._drawWrappers)if(N)for(const q of N)null===q||void 0===q||q.dispose();this._drawWrappers=[]}_fetchR(N,q,R,z,v){return v[4*(((N=.5*Math.abs(N)+.5)*R%R|0)+((q=.5*Math.abs(q)+.5)*z%z|0)*R)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const N=this._engine,q=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*q),this._vertexBuffer=new L.e(N,this._vertexData,!0,q);let R=0;const z=this._vertexBuffer.createVertexBuffer(L.h.PositionKind,R,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.h.PositionKind]=z,R+=3;const v=this._vertexBuffer.createVertexBuffer(L.h.ColorKind,R,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.h.ColorKind]=v,R+=4;const B=this._vertexBuffer.createVertexBuffer("angle",R,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=B,R+=1;const F=this._vertexBuffer.createVertexBuffer("size",R,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=F,R+=2,this._isAnimationSheetEnabled){const N=this._vertexBuffer.createVertexBuffer("cellIndex",R,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=N,R+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const N=this._vertexBuffer.createVertexBuffer("direction",R,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=N,R+=3}if(this._useRampGradients){const N=this._vertexBuffer.createVertexBuffer("remapData",R,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=N,R+=4}let S;if(this._useInstancing){const q=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new L.e(N,q,!1,2),S=this._spriteBuffer.createVertexBuffer("offset",0,2)}else S=this._vertexBuffer.createVertexBuffer("offset",R,2,this._vertexBufferSize,this._useInstancing),R+=2;this._vertexBuffers.offset=S,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const N=[],q=[];let R=0;for(let z=0;z<this._capacity;z++)N.push(R),N.push(R+1),N.push(R+2),N.push(R),N.push(R+2),N.push(R+3),q.push(R,R+1,R+1,R+2,R+2,R+3,R+3,R,R,R+3),R+=4;this._indexBuffer=this._engine.createIndexBuffer(N),this._linesIndexBuffer=this._engine.createIndexBuffer(q)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(N)setTimeout((()=>{this.start(0)}),N);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var q;-1!==(null===(q=this.j)||void 0===q?void 0:q.getClassName().indexOf("Mesh"))&&this.j.Oj(!0);const N=this.noiseTexture;if(N&&N.onGeneratedObservable)N.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),N.render()}))}));else for(let q=0;q<this.preWarmCycles;q++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(N))}_postStop(N){}reset(){this._stockParticles.length=0,this.sj.length=0}_appendParticleVertex(N,q,R,v){let B=N*this._vertexBufferSize;if(this._vertexData[B++]=q.position.x+this.eg.x,this._vertexData[B++]=q.position.y+this.eg.y,this._vertexData[B++]=q.position.z+this.eg.z,this._vertexData[B++]=q.color.r,this._vertexData[B++]=q.color.g,this._vertexData[B++]=q.color.b,this._vertexData[B++]=q.color.a,this._vertexData[B++]=q.angle,this._vertexData[B++]=q.scale.x*q.size,this._vertexData[B++]=q.scale.y*q.size,this._isAnimationSheetEnabled&&(this._vertexData[B++]=q.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[B++]=q.direction.x,this._vertexData[B++]=q.direction.y,this._vertexData[B++]=q.direction.z);else if(q._initialDirection){let N=q._initialDirection;this.isLocal&&(z.m.TransformNormalToRef(N,this._emitterWorldMatrix,z.k.o[0]),N=z.k.o[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[B++]=N.x,this._vertexData[B++]=N.y,this._vertexData[B++]=N.z}else{let N=q.direction;this.isLocal&&(z.m.TransformNormalToRef(N,this._emitterWorldMatrix,z.k.o[0]),N=z.k.o[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[B++]=N.x,this._vertexData[B++]=N.y,this._vertexData[B++]=N.z}this._useRampGradients&&q.remapData&&(this._vertexData[B++]=q.remapData.x,this._vertexData[B++]=q.remapData.y,this._vertexData[B++]=q.remapData.z,this._vertexData[B++]=q.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===R?R=this._epsilon:1===R&&(R=1-this._epsilon),0===v?v=this._epsilon:1===v&&(v=1-this._epsilon)),this._vertexData[B++]=R,this._vertexData[B++]=v)}_prepareParticle(N){}_update(N){if(this._alive=this.sj.length>0,this.j.position){const N=this.j;this._emitterWorldMatrix=N.getWorldMatrix()}else{const N=this.j;this._emitterWorldMatrix=z.d.Translation(N.x,N.y,N.z)}let q;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.sj);for(let R=0;R<N&&this.sj.length!==this._capacity;R++){if(q=this._createParticle(),this.sj.push(q),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const N=(0,y.c)(this._actualFrame/this.targetStopDuration);r.GetCurrentGradient(N,this._lifeTimeGradients,((R,z)=>{const v=R,B=z,F=v.getFactor(),S=B.getFactor(),A=(N-v.gradient)/(B.gradient-v.gradient);q.lifeTime=(0,y.m)(F,S,A)}))}else q.lifeTime=(0,y.u)(this.minLifeTime,this.maxLifeTime);const N=(0,y.u)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,q.position,q,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,q.position,q,this.isLocal),this.isLocal&&(q.ne?q.ne.p(q.position):q.ne=q.position.clone(),z.m.TransformCoordinatesToRef(q.ne,this._emitterWorldMatrix,q.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,q.direction,q,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,q.direction,q,this.isLocal,this._emitterInverseWorldMatrix),0===N?q._initialDirection?q._initialDirection.p(q.direction):q._initialDirection=q.direction.clone():q._initialDirection=null,q.direction.scaleInPlace(N),this._sizeGradients&&0!==this._sizeGradients.length?(q._currentSizeGradient=this._sizeGradients[0],q._currentSize1=q._currentSizeGradient.getFactor(),q.size=q._currentSize1,this._sizeGradients.length>1?q._currentSize2=this._sizeGradients[1].getFactor():q._currentSize2=q._currentSize1):q.size=(0,y.u)(this.minSize,this.maxSize),q.scale.qe((0,y.u)(this.minScaleX,this.maxScaleX),(0,y.u)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const N=this._actualFrame/this.targetStopDuration;r.GetCurrentGradient(N,this._startSizeGradients,((N,R,z)=>{N!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=R.getFactor(),this._currentStartSizeGradient=N);const v=(0,y.m)(this._currentStartSize1,this._currentStartSize2,z);q.scale.scaleInPlace(v)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(q._currentAngularSpeedGradient=this._angularSpeedGradients[0],q.angularSpeed=q._currentAngularSpeedGradient.getFactor(),q._currentAngularSpeed1=q.angularSpeed,this._angularSpeedGradients.length>1?q._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():q._currentAngularSpeed2=q._currentAngularSpeed1):q.angularSpeed=(0,y.u)(this.minAngularSpeed,this.maxAngularSpeed),q.angle=(0,y.u)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(q._currentVelocityGradient=this._velocityGradients[0],q._currentVelocity1=q._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?q._currentVelocity2=this._velocityGradients[1].getFactor():q._currentVelocity2=q._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(q._currentLimitVelocityGradient=this._limitVelocityGradients[0],q._currentLimitVelocity1=q._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?q._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():q._currentLimitVelocity2=q._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(q._currentDragGradient=this._dragGradients[0],q._currentDrag1=q._currentDragGradient.getFactor(),this._dragGradients.length>1?q._currentDrag2=this._dragGradients[1].getFactor():q._currentDrag2=q._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)q._currentColorGradient=this._colorGradients[0],q._currentColorGradient.getColorToRef(q.color),q._currentColor1.p(q.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(q._currentColor2):q._currentColor2.p(q.color);else{const N=(0,y.u)(0,1);F.g.LerpToRef(this.color1,this.color2,N,q.color),this.colorDead.subtractToRef(q.color,this._colorDiff),this._colorDiff.scaleToRef(1/q.lifeTime,q.colorStep)}this._isAnimationSheetEnabled&&(q._initialStartSpriteCellID=this.startSpriteCellID,q._initialEndSpriteCellID=this.endSpriteCellID,q._initialSpriteCellLoop=this.spriteCellLoop),q.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(q.remapData=new z.p(0,1,0,1)),this.noiseTexture&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.qe(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2.qe(Math.random(),Math.random(),Math.random())):(q._randomNoiseCoordinates1=new z.m(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2=new z.m(Math.random(),Math.random(),Math.random()))),q._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=[L.h.PositionKind,L.h.ColorKind,"angle","offset","size"];return N&&z.push("cellIndex"),q||z.push("direction"),R&&z.push("remapData"),z}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,qN.c)(z),N&&z.push("particlesInfos"),q&&z.push("logarithmicDepthConstant"),R&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qN.j)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&N.push("#define FOG")),this._isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),q===A.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&N.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case 2:N.push("#define BILLBOARDY");break;case 8:case 9:N.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&N.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:N.push("#define BILLBOARDMODE_ALL")}R&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,q,R){q.push(...vN._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),N.push(...vN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),R.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,zN.h)(N,this._imageProcessingConfigurationDefines),(0,zN.e)(R,this._imageProcessingConfigurationDefines))}_getWrapper(N){const q=this._getCustomDrawWrapper(N);if(null!==q&&void 0!==q&&q.effect)return q;const R=[];this.fillDefines(R,N);const z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let v=this._drawWrappers[z];v||(v=this._drawWrappers[z]=[]);let B=v[N];B||(B=new NN.e(this._engine),B.drawContext&&(B.drawContext.useInstancing=this._useInstancing),v[N]=B);const F=R.join("\n");if(B.defines!==F){const N=[],q=[],R=[];this.fillUniformsAttributesAndSamplerNames(q,N,R),B.setEffect(this._engine.createEffect("particles",N,q,R,F,void 0,void 0,void 0,void 0,this._shaderLanguage),F)}return B}animate(){var N;let q,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!R&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(R?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this.manualEmitCount>-1)q=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let N=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const q=this._actualFrame/this.targetStopDuration;r.GetCurrentGradient(q,this._emitRateGradients,((q,R,z)=>{q!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=R.getFactor(),this._currentEmitRateGradient=q),N=(0,y.m)(this._currentEmitRate1,this._currentEmitRate2,z)}))}q=N*this._scaledUpdateSpeed|0,this._newPartsExcess+=N*this._scaledUpdateSpeed-q}if(this._newPartsExcess>1&&(q+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?q=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(q),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!R){let N=0;for(let q=0;q<this.sj.length;q++){const R=this.sj[q];this._appendParticleVertices(N,R),N+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.sj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(N,q){this._appendParticleVertex(N++,q,0,0),this._useInstancing||(this._appendParticleVertex(N++,q,1,0),this._appendParticleVertex(N++,q,1,1),this._appendParticleVertex(N++,q,0,1))}rebuild(){var N;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(N=this._spriteBuffer)||void 0===N||N._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!vN.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(R.bind(R,11903)),Promise.resolve().then(R.bind(R,11858))])):await Promise.all([Promise.resolve().then(R.bind(R,11846)),Promise.resolve().then(R.bind(R,11838))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==A.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(A.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(A.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(N){const q=this._getWrapper(N),R=q.effect,v=this._engine;v.enableEffect(q);const B=this.defaultViewMatrix??this._scene.getViewMatrix();if(R.setTexture("diffuseSampler",this.particleTexture),R.setMatrix("view",B),R.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();R.setFloat3("particlesInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,this.spriteCellWidth/N.width)}if(R.setVector2("translationPivot",this.translationPivot),R.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;R.setVector3("eyePosition",N.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),R.setTexture("rampSampler",this._rampGradientsTexture));const F=R.defines;var S,y,E,t,x,e;(this._scene&&((0,qN.e)(R,this,this._scene),this.applyFog&&(0,RN.c)(this._scene,void 0,R)),F.indexOf("#define BILLBOARDMODE_ALL")>=0&&(B.invertToRef(z.k.Matrix[0]),R.setMatrix("invView",z.k.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?v.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,R):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,R)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?v.bindBuffers(this._vertexBuffers,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBuffer:this._indexBuffer,R):v.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null,R);switch(this.useLogarithmicDepth&&this._scene&&(0,RN.i)(F,R,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(R),N){case A.BLENDMODE_ADD:v.setAlphaMode(1);break;case A.BLENDMODE_ONEONE:v.setAlphaMode(6);break;case A.BLENDMODE_STANDARD:v.setAlphaMode(2);break;case A.BLENDMODE_MULTIPLY:v.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(R),this._useInstancing)?null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?v.drawElementsType(6,0,10,this.sj.length):v.drawArraysType(7,0,4,this.sj.length):null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?v.drawElementsType(1,0,10*this.sj.length):v.drawElementsType(0,0,6*this.sj.length);return this.sj.length}render(){if(!this.isReady()||!this.sj.length)return 0;const N=this._engine;N.setState&&(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0));let q=0;return q=this.blendMode===A.BLENDMODE_MULTIPLYADD?this._render(A.BLENDMODE_MULTIPLY)+this._render(A.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),q}_onDispose(){}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(q,R),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const N=this._scene.qj.indexOf(this);N>-1&&this._scene.qj.splice(N,1),this._scene._activeParticleSystems.dispose()}this.jj.notifyObservers(this),this.jj.clear(),this.onStoppedObservable.clear(),this.reset()}}vN.ForceGLSL=!1;var BN,FN=R(10923);!function(N){N[N.ATTACHED=0]="ATTACHED",N[N.END=1]="END"}(BN||(BN={}));class SN{constructor(N){if(this.particleSystem=N,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!N.j||!N.j.dispose){const q=(0,S.c)("BABYLON.AbstractMesh");N.j=new q("SubemitterSystemEmitter",N.va()),N._disposeEmitterOnDispose=!0}}clone(){let N=this.particleSystem.j;if(N){if(N instanceof z.m)N=N.clone();else if(-1!==N.getClassName().indexOf("Mesh")){N=new((0,S.c)("BABYLON.Mesh"))("",N.va()),N.isVisible=!1}}else N=new z.m;const q=new SN(this.particleSystem.clone(this.particleSystem.name,N));return q.particleSystem.name+="Clone",q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem._disposeEmitterOnDispose=!0,q.particleSystem.disposeOnStop=!0,q}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem=this.particleSystem.serialize(N),q}static _ParseParticleSystem(N,q,R){throw(0,FN.b)("ParseParticle")}static Parse(N,q,R){const z=N.particleSystem,v=new SN(SN._ParseParticleSystem(z,q,R,!0));return v.type=N.type,v.inheritDirection=N.inheritDirection,v.inheritedVelocityAmount=N.inheritedVelocityAmount,v.particleSystem._isSubEmitter=!0,v}dispose(){this.particleSystem.dispose()}}var AN=R(10957);function yN(N,q){const R=new V;return R.direction1=N,R.direction2=q,R}function EN(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function tN(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function xN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.m(0,1,0),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0);return new Y(N,q,R)}function eN(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function bN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.m(0,1,0);return new f(N,q,R,v,B)}function fN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new x(N,q)}function DN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0),v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0);return new e(N,q,R,v)}class VN extends vN{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=N=>{if(!this._subEmitters||0===this._subEmitters.length)return;const q=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[q].forEach((q=>{if(1===q.type){const R=q.clone();N._inheritParticleInfoToSubEmitter(R),R.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(R.particleSystem),R.particleSystem.start()}}))}}createPointEmitter(N,q){const R=yN(N,q);return this.particleEmitterType=R,R}createHemisphericEmitter(){const N=EN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=tN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=xN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=eN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=bN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.m(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=fN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=DN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,q,R,z){const v=new t;return this.particleEmitterType=v,this.direction1=N,this.direction2=q,this.minEmitBox=R,this.maxEmitBox=z,v}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((N=>{N instanceof VN?this._subEmitters.push([new SN(N)]):N instanceof SN?this._subEmitters.push([N]):N instanceof Array&&this._subEmitters.push(N)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((N=>{N.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const N=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==N&&this._rootParticleSystem.activeSubSystems.splice(N,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(N){N&&this._stopSubEmitters()}_prepareParticle(N){if(this._subEmitters&&this._subEmitters.length>0){const q=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];N._attachedSubEmitters=[],q.forEach((q=>{if(0===q.type){const R=q.clone();N._attachedSubEmitters.push(R),R.particleSystem.start()}}))}}_onDispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var R;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),N)&&(null===(R=this.particles)||void 0===R||R.forEach((N=>{if(N._attachedSubEmitters)for(let q=N._attachedSubEmitters.length-1;q>=0;q-=1)N._attachedSubEmitters[q].dispose()})));if(q&&this.activeSubSystems)for(let z=this.activeSubSystems.length-1;z>=0;z-=1)this.activeSubSystems[z].dispose();if(this._subEmitters&&this._subEmitters.length){for(let N=0;N<this._subEmitters.length;N++)for(const q of this._subEmitters[N])q.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(N,q,R,v){let B;B=R instanceof AN.d?null:R;const A=(0,S.c)("BABYLON.Texture");if(A&&B&&(N.texture?q.particleTexture=A.Parse(N.texture,B,v):N.textureName&&(q.particleTexture=new A(v+N.textureName,B,!1,void 0===N.invertY||N.invertY),q.particleTexture.name=N.textureName)),N.emitterId||0===N.emitterId||void 0!==N.j?N.emitterId&&B?q.j=B.getLastMeshById(N.emitterId):q.j=z.m.Zg(N.j):q.j=z.m.Zero(),q.isLocal=!!N.isLocal,void 0!==N.renderingGroupId&&(q.renderingGroupId=N.renderingGroupId),void 0!==N.isBillboardBased&&(q.isBillboardBased=N.isBillboardBased),void 0!==N.billboardMode&&(q.billboardMode=N.billboardMode),void 0!==N.useLogarithmicDepth&&(q.useLogarithmicDepth=N.useLogarithmicDepth),N.animations){for(let R=0;R<N.animations.length;R++){const z=N.animations[R],v=(0,S.c)("BABYLON.Animation");v&&q.animations.push(v.Parse(z))}q.beginAnimationOnStart=N.beginAnimationOnStart,q.beginAnimationFrom=N.beginAnimationFrom,q.beginAnimationTo=N.beginAnimationTo,q.beginAnimationLoop=N.beginAnimationLoop}if(N.autoAnimate&&B&&B.beginAnimation(q,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),q.startDelay=0|N.startDelay,q.minAngularSpeed=N.minAngularSpeed,q.maxAngularSpeed=N.maxAngularSpeed,q.minSize=N.minSize,q.maxSize=N.maxSize,N.minScaleX&&(q.minScaleX=N.minScaleX,q.maxScaleX=N.maxScaleX,q.minScaleY=N.minScaleY,q.maxScaleY=N.maxScaleY),void 0!==N.preWarmCycles&&(q.preWarmCycles=N.preWarmCycles,q.preWarmStepOffset=N.preWarmStepOffset),void 0!==N.minInitialRotation&&(q.minInitialRotation=N.minInitialRotation,q.maxInitialRotation=N.maxInitialRotation),q.minLifeTime=N.minLifeTime,q.maxLifeTime=N.maxLifeTime,q.minEmitPower=N.minEmitPower,q.maxEmitPower=N.maxEmitPower,q.emitRate=N.emitRate,q.gravity=z.m.Zg(N.gravity),N.noiseStrength&&(q.noiseStrength=z.m.Zg(N.noiseStrength)),q.color1=F.g.Zg(N.color1),q.color2=F.g.Zg(N.color2),q.colorDead=F.g.Zg(N.colorDead),q.updateSpeed=N.updateSpeed,q.targetStopDuration=N.targetStopDuration,q.blendMode=N.blendMode,N.colorGradients)for(const z of N.colorGradients)q.addColorGradient(z.gradient,F.g.Zg(z.color1),z.color2?F.g.Zg(z.color2):void 0);if(N.rampGradients){for(const R of N.rampGradients)q.addRampGradient(R.gradient,F.c.Zg(R.color));q.useRampGradients=N.useRampGradients}if(N.colorRemapGradients)for(const z of N.colorRemapGradients)q.addColorRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.alphaRemapGradients)for(const z of N.alphaRemapGradients)q.addAlphaRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.sizeGradients)for(const z of N.sizeGradients)q.addSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.angularSpeedGradients)for(const z of N.angularSpeedGradients)q.addAngularSpeedGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.velocityGradients)for(const z of N.velocityGradients)q.addVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.dragGradients)for(const z of N.dragGradients)q.addDragGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.emitRateGradients)for(const z of N.emitRateGradients)q.addEmitRateGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.startSizeGradients)for(const z of N.startSizeGradients)q.addStartSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.lifeTimeGradients)for(const z of N.lifeTimeGradients)q.addLifeTimeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(N.limitVelocityGradients){for(const R of N.limitVelocityGradients)q.addLimitVelocityGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);q.limitVelocityDamping=N.limitVelocityDamping}if(N.noiseTexture&&B){const R=(0,S.c)("BABYLON.ProceduralTexture");q.noiseTexture=R.Parse(N.noiseTexture,B,v)}let y;if(N.particleEmitterType){switch(N.particleEmitterType.type){case"SphereParticleEmitter":y=new H;break;case"SphereDirectedParticleEmitter":y=new Y;break;case"ConeEmitter":case"ConeParticleEmitter":y=new x;break;case"ConeDirectedParticleEmitter":y=new e;break;case"CylinderParticleEmitter":y=new b;break;case"CylinderDirectedParticleEmitter":y=new f;break;case"HemisphericParticleEmitter":y=new D;break;case"PointParticleEmitter":y=new V;break;case"MeshParticleEmitter":y=new X;break;case"CustomParticleEmitter":y=new T;break;default:y=new t}y.parse(N.particleEmitterType,B)}else y=new t,y.parse(N,B);q.particleEmitterType=y,q.startSpriteCellID=N.startSpriteCellID,q.endSpriteCellID=N.endSpriteCellID,q.spriteCellLoop=N.spriteCellLoop??!0,q.spriteCellWidth=N.spriteCellWidth,q.spriteCellHeight=N.spriteCellHeight,q.spriteCellChangeSpeed=N.spriteCellChangeSpeed,q.spriteRandomStartCell=N.spriteRandomStartCell,q.disposeOnStop=N.disposeOnStop??!1,q.manualEmitCount=N.manualEmitCount??-1}static Parse(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const S=N.name;let A,y,E=null,t=null;if(q instanceof AN.d?A=q:(y=q,A=y.getEngine()),N.customShader&&A.createEffectForParticles){t=N.customShader;const q=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";E=A.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,q)}const x=new VN(S,B||N.rb,q,E,N.isAnimationSheetEnabled);if(x.customShader=t,x._rootUrl=R,N.id&&(x.id=N.id),N.subEmitters){x.subEmitters=[];for(const z of N.subEmitters){const N=[];for(const v of z)N.push(SN.Parse(v,q,R));x.subEmitters.push(N)}}return VN._Parse(N,x,q,R),N.textureMask&&(x.textureMask=F.g.Zg(N.textureMask)),N.eg&&(x.eg=z.m.Zg(N.eg)),N.preventAutoStart&&(x.preventAutoStart=N.preventAutoStart),v||x.preventAutoStart||x.start(),x}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};if(VN._Serialize(q,this,N),q.textureMask=this.textureMask.ij(),q.customShader=this.customShader,q.preventAutoStart=this.preventAutoStart,q.eg=this.eg.ij(),this.subEmitters){q.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const R of this._subEmitters){const z=[];for(const q of R)z.push(q.serialize(N));q.subEmitters.push(z)}}return q}static _Serialize(N,q,R){if(N.name=q.name,N.id=q.id,N.rb=q.getCapacity(),N.disposeOnStop=q.disposeOnStop,N.manualEmitCount=q.manualEmitCount,q.j.position){const R=q.j;N.emitterId=R.id}else{const R=q.j;N.j=R.ij()}q.particleEmitterType&&(N.particleEmitterType=q.particleEmitterType.serialize()),q.particleTexture&&(R?N.texture=q.particleTexture.serialize():(N.textureName=q.particleTexture.name,N.invertY=!!q.particleTexture._invertY)),N.isLocal=q.isLocal,M.e.AppendSerializedAnimations(q,N),N.beginAnimationOnStart=q.beginAnimationOnStart,N.beginAnimationFrom=q.beginAnimationFrom,N.beginAnimationTo=q.beginAnimationTo,N.beginAnimationLoop=q.beginAnimationLoop,N.startDelay=q.startDelay,N.renderingGroupId=q.renderingGroupId,N.isBillboardBased=q.isBillboardBased,N.billboardMode=q.billboardMode,N.minAngularSpeed=q.minAngularSpeed,N.maxAngularSpeed=q.maxAngularSpeed,N.minSize=q.minSize,N.maxSize=q.maxSize,N.minScaleX=q.minScaleX,N.maxScaleX=q.maxScaleX,N.minScaleY=q.minScaleY,N.maxScaleY=q.maxScaleY,N.minEmitPower=q.minEmitPower,N.maxEmitPower=q.maxEmitPower,N.minLifeTime=q.minLifeTime,N.maxLifeTime=q.maxLifeTime,N.emitRate=q.emitRate,N.gravity=q.gravity.ij(),N.noiseStrength=q.noiseStrength.ij(),N.color1=q.color1.ij(),N.color2=q.color2.ij(),N.colorDead=q.colorDead.ij(),N.updateSpeed=q.updateSpeed,N.targetStopDuration=q.targetStopDuration,N.blendMode=q.blendMode,N.preWarmCycles=q.preWarmCycles,N.preWarmStepOffset=q.preWarmStepOffset,N.minInitialRotation=q.minInitialRotation,N.maxInitialRotation=q.maxInitialRotation,N.startSpriteCellID=q.startSpriteCellID,N.spriteCellLoop=q.spriteCellLoop,N.endSpriteCellID=q.endSpriteCellID,N.spriteCellChangeSpeed=q.spriteCellChangeSpeed,N.spriteCellWidth=q.spriteCellWidth,N.spriteCellHeight=q.spriteCellHeight,N.spriteRandomStartCell=q.spriteRandomStartCell,N.isAnimationSheetEnabled=q.isAnimationSheetEnabled,N.useLogarithmicDepth=q.useLogarithmicDepth;const z=q.getColorGradients();if(z){N.colorGradients=[];for(const q of z){const R={gradient:q.gradient,color1:q.color1.ij()};q.color2?R.color2=q.color2.ij():R.color2=q.color1.ij(),N.colorGradients.push(R)}}const v=q.getRampGradients();if(v){N.rampGradients=[];for(const q of v){const R={gradient:q.gradient,color:q.color.ij()};N.rampGradients.push(R)}N.useRampGradients=q.useRampGradients}const B=q.getColorRemapGradients();if(B){N.colorRemapGradients=[];for(const q of B){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.colorRemapGradients.push(R)}}const F=q.getAlphaRemapGradients();if(F){N.alphaRemapGradients=[];for(const q of F){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.alphaRemapGradients.push(R)}}const S=q.getSizeGradients();if(S){N.sizeGradients=[];for(const q of S){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.sizeGradients.push(R)}}const A=q.getAngularSpeedGradients();if(A){N.angularSpeedGradients=[];for(const q of A){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.angularSpeedGradients.push(R)}}const y=q.getVelocityGradients();if(y){N.velocityGradients=[];for(const q of y){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.velocityGradients.push(R)}}const E=q.getDragGradients();if(E){N.dragGradients=[];for(const q of E){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.dragGradients.push(R)}}const t=q.getEmitRateGradients();if(t){N.emitRateGradients=[];for(const q of t){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.emitRateGradients.push(R)}}const x=q.getStartSizeGradients();if(x){N.startSizeGradients=[];for(const q of x){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.startSizeGradients.push(R)}}const e=q.getLifeTimeGradients();if(e){N.lifeTimeGradients=[];for(const q of e){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.lifeTimeGradients.push(R)}}const b=q.getLimitVelocityGradients();if(b){N.limitVelocityGradients=[];for(const q of b){const R={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?R.factor2=q.factor2:R.factor2=q.factor1,N.limitVelocityGradients.push(R)}N.limitVelocityDamping=q.limitVelocityDamping}q.noiseTexture&&(N.noiseTexture=q.noiseTexture.serialize())}clone(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let v=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){v=this.customShader;const N=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"",q=B.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,N);z[0]?z[0].effect=q:this.setCustomEffect(q,0)}const F=this.serialize(R),S=VN.Parse(F,this._scene||this._engine,this._rootUrl);return S.name=N,S.customShader=v,S._customWrappers=z,void 0===q&&(q=this.j),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.j=q,this.preventAutoStart||S.start(),S}}VN.BILLBOARDMODE_Y=2,VN.BILLBOARDMODE_ALL=7,VN.BILLBOARDMODE_STRETCHED=8,VN.BILLBOARDMODE_STRETCHED_LOCAL=9,SN._ParseParticleSystem=VN.Parse;var HN=R(11206),YN=R(11172),TN=R(11652);TN.e.prototype.createTransformFeedback=function(){const N=this._gl.createTransformFeedback();if(!N)throw new Error("Unable to create Transform Feedback");return N},TN.e.prototype.deleteTransformFeedback=function(N){this._gl.deleteTransformFeedback(N)},TN.e.prototype.bindTransformFeedback=function(N){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,N)},TN.e.prototype.beginTransformFeedback=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(N?this._gl.POINTS:this._gl.TRIANGLES)},TN.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},TN.e.prototype.setTranformFeedbackVaryings=function(N,q){this._gl.transformFeedbackVaryings(N,q,this._gl.INTERLEAVED_ATTRIBS)},TN.e.prototype.bindTransformFeedbackBuffer=function(N){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N?N.underlyingResource:null)},TN.e.prototype.readTransformFeedbackBuffer=function(N){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N)};const LN="clipPlaneFragmentDeclaration2",XN="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";u.e.IncludesShadersStore[LN]=XN;R(11744),R(11750),R(11754),R(11762),R(11765),R(11770),R(11777),R(11779);const QN="gpuRenderParticlesPixelShader",hN="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";u.e.ShadersStore[QN]=hN;const uN="clipPlaneVertexDeclaration2",wN="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";u.e.IncludesShadersStore[uN]=wN;R(11788),R(11792),R(11796),R(11804);const cN="gpuRenderParticlesVertexShader",nN="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";u.e.ShadersStore[cN]=nN;class GN extends A{static get IsSupported(){if(!p.b.LastCreatedEngine)return!1;const N=p.b.LastCreatedEngine.getCaps();return N.supportTransformFeedbacks||N.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(N){this._maxActiveParticleCount=Math.min(N,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(N){this.maxActiveParticleCount=N}createPointEmitter(N,q){const R=yN(N,q);return this.particleEmitterType=R,R}createHemisphericEmitter(){const N=EN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=tN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=xN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=eN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=bN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.m(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=fN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=DN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.m(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,q,R,z){const v=new t;return this.particleEmitterType=v,this.direction1=N,this.direction2=q,this.minEmitBox=R,this.maxEmitBox=z,v}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==VN.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(VN.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(VN.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";N?setTimeout((()=>{this.start(0)}),N):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[q])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new NN.e(this._engine),this._customWrappers[q].effect=N}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(N,q,R){return super._removeGradientAndTexture(N,q,R),this._releaseBuffers(),this}addColorGradient(N,q){this._colorGradients||(this._colorGradients=[]);const R=new o(N,q);return this._colorGradients.push(R),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(N&&this._colorGradients.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(N){return this._removeGradientAndTexture(N,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const q in this._drawWrappers){var N;null===(N=this._drawWrappers[q].drawContext)||void 0===N||N.reset()}}_addFactorGradient(N,q,R){const z=new K(q,R);N.push(z),this._releaseBuffers()}addSizeGradient(N,q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,q),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(N){return this._removeGradientAndTexture(N,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(N,q){if(!N)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&N.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0));const R=this;R[q]&&(R[q].dispose(),R[q]=null)}addAngularSpeedGradient(N,q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,q),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(N){return this._removeGradientAndTexture(N,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(N,q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,q),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(N){return this._removeGradientAndTexture(N,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(N,q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,q),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(N){return this._removeGradientAndTexture(N,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(N,q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,q),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(N){return this._removeGradientAndTexture(N,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(N){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(N),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.jj=new a.d,this.onStoppedObservable=new a.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,R&&"Scene"!==R.getClassName()?(this._engine=R,this.defaultProjectionMatrix=z.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=R||p.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,S.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,S.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new NN.e(this._engine)},this._customWrappers[0].effect=v,this._drawWrappers={0:new NN.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(q=q??{}).randomTextureSize||delete q.randomTextureSize;const F={rb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...q},A=q;isFinite(A)&&(F.rb=A),this._capacity=F.rb,this._maxActiveParticleCount=F.rb,this._currentActiveCount=0,this._isAnimationSheetEnabled=B,this.particleEmitterType=new t;const y=Math.min(this._engine.getCaps().maxTextureSize,F.randomTextureSize);let E=[];for(let z=0;z<y;++z)E.push(Math.random()),E.push(Math.random()),E.push(Math.random()),E.push(Math.random());this._randomTexture=new d.e(new Float32Array(E),y,1,5,R,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,E=[];for(let z=0;z<y;++z)E.push(Math.random()),E.push(Math.random()),E.push(Math.random()),E.push(Math.random());this._randomTexture2=new d.e(new Float32Array(E),y,1,5,R,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=y}_reset(){this._releaseBuffers()}_createVertexBuffers(N,q,R){const z={};z.position=q.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let v=3;z.age=q.createVertexBuffer("age",v,1,this._attributesStrideSize,!0),v+=1,z.size=q.createVertexBuffer("size",v,3,this._attributesStrideSize,!0),v+=3,z.life=q.createVertexBuffer("life",v,1,this._attributesStrideSize,!0),v+=1,v+=4,this.billboardMode===VN.BILLBOARDMODE_STRETCHED&&(z.direction=q.createVertexBuffer("direction",v,3,this._attributesStrideSize,!0)),v+=3,this._platform.alignDataInBuffer&&(v+=1),this.particleEmitterType instanceof T&&(v+=3,this._platform.alignDataInBuffer&&(v+=1)),this._colorGradientsTexture||(z.color=q.createVertexBuffer("color",v,4,this._attributesStrideSize,!0),v+=4),this._isBillboardBased||(z.initialDirection=q.createVertexBuffer("initialDirection",v,3,this._attributesStrideSize,!0),v+=3,this._platform.alignDataInBuffer&&(v+=1)),this.noiseTexture&&(z.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",v,3,this._attributesStrideSize,!0),v+=3,this._platform.alignDataInBuffer&&(v+=1),z.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",v,3,this._attributesStrideSize,!0),v+=3,this._platform.alignDataInBuffer&&(v+=1)),z.angle=q.createVertexBuffer("angle",v,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?v++:v+=2,this._isAnimationSheetEnabled&&(z.cellIndex=q.createVertexBuffer("cellIndex",v,1,this._attributesStrideSize,!0),v+=1,this.spriteRandomStartCell&&(z.cellStartOffset=q.createVertexBuffer("cellStartOffset",v,1,this._attributesStrideSize,!0),v+=1)),z.offset=R.createVertexBuffer("offset",0,2),z.uv=R.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(z),this._platform.createVertexBuffers(N,z),this.resetDrawCache()}_initialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!N)return;const q=this._engine,R=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof T&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const v=this.particleEmitterType instanceof T,B=z.k.o[0];let F=0;for(let z=0;z<this._capacity;z++)if(R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),v?(this.particleEmitterType.particleDestinationGenerator(z,null,B),R.push(B.x),R.push(B.y),R.push(B.z)):(R.push(0),R.push(0),R.push(0)),this._platform.alignDataInBuffer&&R.push(0),F+=16,v&&(this.particleEmitterType.particlePositionGenerator(z,null,B),R.push(B.x),R.push(B.y),R.push(B.z),this._platform.alignDataInBuffer&&R.push(0),F+=4),this._colorGradientsTexture||(R.push(0),R.push(0),R.push(0),R.push(0),F+=4),this.isBillboardBased||(R.push(0),R.push(0),R.push(0),this._platform.alignDataInBuffer&&R.push(0),F+=4),this.noiseTexture&&(R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),this._platform.alignDataInBuffer&&R.push(0),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),this._platform.alignDataInBuffer&&R.push(0),F+=8),R.push(0),F+=1,this._angularSpeedGradientsTexture||(R.push(0),F+=1),this._isAnimationSheetEnabled&&(R.push(0),F+=1,this.spriteRandomStartCell&&(R.push(0),F+=1)),this._platform.alignDataInBuffer){let N=3-(F+3&3);for(F+=N;N-- >0;)R.push(0)}const S=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),A=this._platform.createParticleBuffer(R),y=this._platform.createParticleBuffer(R);this._buffer0=new L.e(q,A,!1,this._attributesStrideSize),this._buffer1=new L.e(q,y,!1,this._attributesStrideSize),this._spriteBuffer=new L.e(q,S,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let N=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(N+="\n#define BILLBOARD"),this._colorGradientsTexture&&(N+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(N+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(N+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(N+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(N+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(N+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(N+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(N+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(N+="\n#define NOISE"),this.isLocal&&(N+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===N||(this._cachedUpdateDefines=N,this._updateBuffer=this._platform.createUpdateBuffer(N)),this._platform.isUpdateBufferReady()}_getWrapper(N){const q=this._getCustomDrawWrapper(N);if(null!==q&&void 0!==q&&q.effect)return q;const R=[];this.fillDefines(R,N);let z=this._drawWrappers[N];z||(z=new NN.e(this._engine),z.drawContext&&(z.drawContext.useInstancing=!0),this._drawWrappers[N]=z);const v=R.join("\n");if(z.defines!==v){const N=[],q=[],R=[];this.fillUniformsAttributesAndSamplerNames(q,N,R),z.setEffect(this._engine.createEffect("gpuRenderParticles",N,q,R,v),v)}return z}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const v=[L.h.PositionKind,"age","life","size","angle"];return N||v.push(L.h.ColorKind),q&&v.push("cellIndex"),R||v.push("initialDirection"),z&&v.push("direction"),v.push("offset",L.h.UVKind),v}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["emitterWM","eg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,qN.c)(z),N&&z.push("sheetInfos"),q&&z.push("logarithmicDepthConstant"),R&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qN.j)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==YN.b.FOGMODE_NONE&&N.push("#define FOG")),q===VN.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this.isLocal&&N.push("#define LOCAL"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case VN.BILLBOARDMODE_Y:N.push("#define BILLBOARDY");break;case VN.BILLBOARDMODE_STRETCHED:N.push("#define BILLBOARDSTRETCHED");break;case VN.BILLBOARDMODE_ALL:N.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&N.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),R&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,q,R){q.push(...GN._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===VN.BILLBOARDMODE_STRETCHED)),N.push(...GN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),R.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(HN.c.PrepareUniforms(N,this._imageProcessingConfigurationDefines),HN.c.PrepareSamplers(R,this._imageProcessingConfigurationDefines))}animate(){var N;let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(q?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(N,q){const R=this[q];if(!N||!N.length||R)return;const z=new Float32Array(this._rawTextureWidth);for(let v=0;v<this._rawTextureWidth;v++){const q=v/this._rawTextureWidth;r.GetCurrentGradient(q,N,((N,q,R)=>{z[v]=(0,y.m)(N.factor1,q.factor1,R)}))}this[q]=d.e.CreateRTexture(z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[q].name=q.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const N=new Uint8Array(4*this._rawTextureWidth),q=F.h.ob[0];for(let R=0;R<this._rawTextureWidth;R++){const z=R/this._rawTextureWidth;r.GetCurrentGradient(z,this._colorGradients,((z,v,B)=>{F.g.LerpToRef(z.color1,v.color1,B,q),N[4*R]=255*q.r,N[4*R+1]=255*q.g,N[4*R+2]=255*q.b,N[4*R+3]=255*q.a}))}this._colorGradientsTexture=d.e.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(N,q){var R,v,B,F;const S=this._getWrapper(N),A=S.effect;this._engine.enableEffect(S);const y=(null===(R=this._scene)||void 0===R?void 0:R.getViewMatrix())||z.d.IdentityReadOnly;if(A.setMatrix("view",y),A.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),A.setTexture("diffuseSampler",this.particleTexture),A.setVector2("translationPivot",this.translationPivot),A.setVector3("eg",this.eg),this.isLocal&&A.setMatrix("emitterWM",q),this._colorGradientsTexture?A.setTexture("colorGradientSampler",this._colorGradientsTexture):A.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();A.setFloat3("sheetInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,N.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;A.setVector3("eyePosition",N.globalPosition)}const E=A.defines;if(this._scene&&((0,qN.e)(A,this,this._scene),this.applyFog&&(0,RN.c)(this._scene,void 0,A)),E.indexOf("#define BILLBOARDMODE_ALL")>=0){const N=y.clone();N.invert(),A.setMatrix("invView",N)}switch(this.useLogarithmicDepth&&this._scene&&(0,RN.i)(E,A,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(A),N){case VN.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case VN.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case VN.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case VN.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,A,null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(A),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(F=this._scene)&&void 0!==F&&F.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(N){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!N)if(this.j.position){N=this.j.getWorldMatrix()}else{const q=this.j;N=z.k.Matrix[0],z.d.TranslationToRef(q.x,q.y,q.z,N)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",N),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q}render(){let N,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!q&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let N=0;N<this.preWarmCycles;N++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const N=0|this._accumulatedCount;this._accumulatedCount-=N,this._currentActiveCount+=N}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){N=this.j.getWorldMatrix()}else{const q=this.j;N=z.k.Matrix[0],z.d.TranslationToRef(q.x,q.y,q.z,N)}const v=this._engine;this.updateInAnimate||this._update(N);let B=0;return q||R||(v.setState(!1),this.forceDepthWrite&&v.setDepthWrite(!0),B=this.blendMode===VN.BLENDMODE_MULTIPLYADD?this._render(VN.BLENDMODE_MULTIPLY,N)+this._render(VN.BLENDMODE_ADD,N):this._render(this.blendMode,N),this._engine.setAlphaMode(0)),B}rebuild(){const N=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(N,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,N()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const q in this._drawWrappers){this._drawWrappers[q].dispose()}if(this._drawWrappers={},this._scene){const N=this._scene.qj.indexOf(this);N>-1&&this._scene.qj.splice(N,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let q=0;q<this._renderVertexBuffers.length;++q){const N=this._renderVertexBuffers[q];for(const q in N)N[q].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.jj.notifyObservers(this),this.jj.clear()}clone(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let v=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){v=this.customShader;const N=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"";z[0]=B.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,N,void 0,void 0,void 0,this)}const F=this.serialize(R),S=GN.Parse(F,this._scene||this._engine,this._rootUrl);return S.name=N,S.customShader=v,S._customWrappers=z,void 0===q&&(q=this.j),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.j=q,S}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return VN._Serialize(q,this,N),q.activeParticleCount=this.activeParticleCount,q.randomTextureSize=this._randomTextureSize,q.customShader=this.customShader,q}static Parse(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0;const B=N.name;let F,S;q instanceof AN.d?F=q:(S=q,F=S.getEngine());const A=new GN(B,{rb:v||N.rb,randomTextureSize:N.randomTextureSize},q,null,N.isAnimationSheetEnabled);if(A._rootUrl=R,N.customShader&&F.createEffectForParticles){const q=N.customShader,R=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",z=F.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,R,void 0,void 0,void 0,A);A.setCustomEffect(z,0),A.customShader=q}return N.id&&(A.id=N.id),N.activeParticleCount&&(A.activeParticleCount=N.activeParticleCount),VN._Parse(N,A,q,R),N.preventAutoStart&&(A.preventAutoStart=N.preventAutoStart),z||A.preventAutoStart||A.start(),A}}var sN=R(10888),ZN=R(11812),JN=R(11144);class MN{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(N){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const q of this.systems)q.j=N;this._emitterNode=N}setEmitterAsSphere(N,q,R){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:N,renderingGroupId:q};const z=(0,ZN.c)("emitterSphere",{diameter:N.diameter,segments:N.segments},R);z.renderingGroupId=q;const v=new JN.b("emitterSphereMaterial",R);v.emissiveColor=N.color,z.material=v;for(const B of this.systems)B.j=z;this._emitterNode=z}start(N){for(const q of this.systems)N&&(q.j=N),q.start()}dispose(){for(const N of this.systems)N.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={systems:[]};for(const R of this.systems)q.systems.push(R.serialize(N));return this._emitterNode&&(q.j=this._emitterCreationOptions),q}static Parse(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;const v=new MN,B=this.BaseAssetsUrl+"/textures/";q=q||p.b.LastCreatedScene;for(const F of N.systems)v.systems.push(R?GN.Parse(F,q,B,!0,z):VN.Parse(F,q,B,!0,z));if(N.j){const R=N.j.options;if("Sphere"===N.j.kind)v.setEmitterAsSphere({diameter:R.diameter,segments:R.segments,color:F.c.Zg(R.color)},N.j.renderingGroupId,q)}return v}}MN.BaseAssetsUrl="https://assets.babylonjs.com/particles";var mN=R(10931);class gN{static CreateDefault(N){let q,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,z=arguments.length>2?arguments[2]:void 0;return q=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new GN("default system",{rb:R},z):new VN("default system",R,z),q.j=N,q.particleTexture=new m.c("https://assets.babylonjs.com/textures/flare.png",q.va()),q.createConeEmitter(.1,Math.PI/4),q.color1=new F.g(1,1,1,1),q.color2=new F.g(1,1,1,1),q.colorDead=new F.g(1,1,1,0),q.minSize=.1,q.maxSize=.1,q.minEmitPower=2,q.maxEmitPower=2,q.updateSpeed=1/60,q.emitRate=30,q}static CreateAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;q||(q=p.b.LastCreatedScene);const v={};return q.addPendingData(v),new Promise(((B,F)=>{if(R&&!GN.IsSupported)return q.removePendingData(v),F("Particle system with GPU is not supported.");sN.f.LoadFile(`${gN.BaseAssetsUrl}/systems/${N}.json`,(N=>{q.removePendingData(v);const F=JSON.parse(N.toString());return B(MN.Parse(F,q,R,z))}),void 0,void 0,void 0,(()=>(q.removePendingData(v),F(`An error occurred with the creation of your particle system. Check if your type '${N}' exists.`))))}))}static ExportSet(N){const q=new MN;for(const R of N)q.systems.push(R);return q}static ParseFromFileAsync(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",B=arguments.length>5?arguments[5]:void 0;return new Promise(((F,S)=>{const A=new mN.b;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const q=JSON.parse(A.responseText);let S;S=z?GN.Parse(q,R,v,!1,B):VN.Parse(q,R,v,!1,B),N&&(S.name=N),F(S)}else S("Unable to load the particle system")})),A.open("GET",q),A.send()}))}static ParseFromSnippetAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",v=arguments.length>4?arguments[4]:void 0;if("_BLANK"===N){const N=this.CreateDefault(null);return N.start(),Promise.resolve(N)}return new Promise(((B,F)=>{const S=new mN.b;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const F=JSON.parse(JSON.parse(S.responseText).jsonPayload),A=JSON.parse(F.particleSystem);let y;y=R?GN.Parse(A,q,z,!1,v):VN.Parse(A,q,z,!1,v),y.snippetId=N,B(y)}else F("Unable to load the snippet "+N)})),S.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),S.send()}))}}gN.BaseAssetsUrl=MN.BaseAssetsUrl,gN.SnippetUrl="https://snippet.babylonjs.com",gN.CreateFromSnippetAsync=gN.ParseFromSnippetAsync;var jN=R(11445),lN=R(11282),IN=R(11819);(0,IN.g)(lN.c.NAME_PARTICLESYSTEM,((N,q,R,z)=>{const v=(0,IN.j)(lN.c.NAME_PARTICLESYSTEM);if(v&&void 0!==N.qj&&null!==N.qj)for(let B=0,F=N.qj.length;B<F;B++){const F=N.qj[B];R.qj.push(v(F,q,z))}})),(0,IN.e)(lN.c.NAME_PARTICLESYSTEM,((N,q,R)=>{if(N.activeParticleCount){return GN.Parse(N,q,R)}return VN.Parse(N,q,R)})),AN.d.prototype.createEffectForParticles=function(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,A=arguments.length>7?arguments[7]:void 0,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,E=[],t=[];const x=[];return A?A.fillUniformsAttributesAndSamplerNames(t,E,x):(E=VN._GetAttributeNamesOrOptions(),t=VN._GetEffectCreationOptions()),-1===v.indexOf(" BILLBOARD")&&(v+="\n#define BILLBOARD\n"),null!==A&&void 0!==A&&A.isAnimationSheetEnabled&&-1===v.indexOf(" ANIMATESHEET")&&(v+="\n#define ANIMATESHEET\n"),-1===z.indexOf("diffuseSampler")&&z.push("diffuseSampler"),this.createEffect({vertex:(null===A||void 0===A?void 0:A.vertexShaderName)??"particles",fragmentElement:N},E,t.concat(q),x.concat(z),v,B,F,S,void 0,y,(async()=>{0===y?await Promise.resolve().then(R.bind(R,11846)):await Promise.resolve().then(R.bind(R,11903))}))},jN.b.prototype.getEmittedParticleSystems=function(){const N=[];for(let q=0;q<this.va().qj.length;q++){const R=this.va().qj[q];R.j===this&&N.push(R)}return N},jN.b.prototype.getHierarchyEmittedParticleSystems=function(){const N=[],q=this.getDescendants();q.push(this);for(let R=0;R<this.va().qj.length;R++){const z=this.va().qj[R],v=z.j;v.position&&-1!==q.indexOf(v)&&N.push(z)}return N};R(11344),R(11356),R(11481);R(11468),R(11824),R(11495),R(11335),R(11503);R(11689);var UN;R(11831),R(11407);!function(N){N[N.Color=2]="Color",N[N.UV=1]="UV",N[N.Random=0]="Random",N[N.Stated=3]="Stated"}(UN||(UN={}));R(11838),R(11846),R(11858),R(11903)},11715:(N,q,R)=>{"use strict";R.d(q,{b:()=>b});var z=R(11147),v=R(11167),B=R(10893),F=R(11181),S=R(10964),A=R(11151),y=R(11221),E=R(11002),t=R(10957),x=R(11013),e=R(11719);t.d.prototype.setTextureFromPostProcess=function(N,q,R){var z;let v=null;q&&(q._forcedOutputTexture?v=q._forcedOutputTexture:q._textures.data[q._currentRenderTextureInd]&&(v=q._textures.data[q._currentRenderTextureInd])),this._bindTexture(N,(null===(z=v)||void 0===z?void 0:z.texture)??null,R)},t.d.prototype.setTextureFromPostProcessOutput=function(N,q,R){var z;this._bindTexture(N,(null===q||void 0===q||null===(z=q._outputTexture)||void 0===z?void 0:z.texture)??null,R)},S.d.prototype.setTextureFromPostProcess=function(N,q){this._engine.setTextureFromPostProcess(this._samplers[N],q,N)},S.d.prototype.setTextureFromPostProcessOutput=function(N,q){this._engine.setTextureFromPostProcessOutput(this._samplers[N],q,N)};class b{static get ForceGLSL(){return e.f.ForceGLSL}static set ForceGLSL(N){e.f.ForceGLSL=N}static RegisterShaderCodeProcessing(N,q){e.f.RegisterShaderCodeProcessing(N,q)}get name(){return this._effectWrapper.name}set name(N){this._effectWrapper.name=N}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(N){this._effectWrapper.alphaMode=N}get samples(){return this._samples}set samples(N){this._samples=Math.min(N,this._engine.getCaps().maxMSAASamples),this._textures.forEach((N=>{N.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(N){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),N&&(this._onActivateObserver=this.onActivateObservable.add(N))}set onSizeChanged(N){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(N)}set onApply(N){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(N)}set onBeforeRender(N){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(N)}set onAfterRender(N){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(N)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(N){this._forcedOutputTexture=N}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.qe(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(N,q,R,z,S,A){var y;let E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,t=arguments.length>7?arguments[7]:void 0,x=arguments.length>8?arguments[8]:void 0,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",H=arguments.length>12?arguments[12]:void 0,Y=arguments.length>13&&void 0!==arguments[13]&&arguments[13],T=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,L=arguments.length>15?arguments[15]:void 0,X=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ti=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new v.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new F.l(1,1),this._texelSize=F.l.Zero(),this.onActivateObservable=new B.d,this.onSizeChangedObservable=new B.d,this.onApplyObservable=new B.d,this.onBeforeRenderObservable=new B.d,this.onAfterRenderObservable=new B.d;let Q,h=1,u=null;if(R&&!Array.isArray(R)){const N=R;R=N.uniforms??null,z=N.samplers??null,h=N.size??1,A=N.camera??null,E=N.samplingMode??1,t=N.Dd,x=N.reusable,f=Array.isArray(N.defines)?N.defines.join("\n"):N.defines??null,D=N.textureType??0,V=N.vertexUrl??"postprocess",H=N.indexParameters,Y=N.blockCompilation??!1,T=N.textureFormat??5,L=N.shaderLanguage??0,u=N.uniformBuffers??null,X=N.extraInitializations,Q=N.effectWrapper}else S&&(h="number"===typeof S?S:{width:S.width,height:S.height});const w=!!Q;if(this._effectWrapper=Q??new e.f({name:N,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:q,Dd:t||(null===(y=A)||void 0===y?void 0:y.va().getEngine()),uniforms:R,samplers:z,uniformBuffers:u,defines:f,vertexUrl:V,indexParameters:H,blockCompilation:Y,shaderLanguage:L,extraInitializations:X}),this.name=N,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=A?(this._camera=A,this._scene=A.va(),A.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):t&&(this._engine=t,this._engine.postProcesses.push(this)),this._options=h,this.renderTargetSamplingMode=E||1,this._reusable=x||!1,this._textureType=D,this._textureFormat=T,this._shaderLanguage=L||0,this._samplers=z||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=q,this._vertexUrl=V,this._parameters=R||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=u||[],this._indexParameters=H,!w){this._webGPUReady=1===this._shaderLanguage;const N=[];this._gatherImports(this._engine.isWebGPU&&!b.ForceGLSL,N),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(Y,f,X,N)}}_gatherImports(){let N=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?N.push(Promise.all([R.e(37).then(R.bind(R,13372))])):N.push(Promise.all([Promise.resolve().then(R.bind(R,11728))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(N){return this._disposeTextures(),this._shareOutputWithPostProcess=N,this}useOwnOutput(){0==this._textures.length&&(this._textures=new v.h(2)),this._shareOutputWithPostProcess=null}updateEffect(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,S=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(N,q,R,z,v,B,F,S),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let v=0;v<this._textureCache.length;v++)if(this._textureCache[v].texture.width===N.width&&this._textureCache[v].texture.height===N.height&&this._textureCache[v].postProcessChannel===R&&this._textureCache[v].texture._generateDepthBuffer===q.generateDepthBuffer&&this._textureCache[v].texture.samples===q.samples)return this._textureCache[v].texture;const z=this._engine.createRenderTargetTexture(N,q);return this._textureCache.push({texture:z,postProcessChannel:R,lastUsedRenderId:-1}),z}_flushTextureCache(){const N=this._renderId;for(let q=this._textureCache.length-1;q>=0;q--)if(N-this._textureCache[q].lastUsedRenderId>100){let N=!1;for(let R=0;R<this._textures.length;R++)if(this._textures.data[R]===this._textureCache[q].texture){N=!0;break}N||(this._textureCache[q].texture.dispose(),this._textureCache.splice(q,1))}}resize(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=N,this.height=q;let B=null;if(R)for(let A=0;A<R._postProcesses.length;A++)if(null!==R._postProcesses[A]){B=R._postProcesses[A];break}const F={width:this.width,height:this.height},S={generateMipMaps:z,generateDepthBuffer:v||B===this,generateStencilBuffer:(v||B===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(F,S,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(F,S,1)),this._texelSize.qe(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let N;if(this._shareOutputWithPostProcess)N=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)N=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let q;N=this.inputTexture;for(let R=0;R<this._textureCache.length;R++)if(this._textureCache[R].texture===N){q=this._textureCache[R];break}q&&(q.lastUsedRenderId=this._renderId)}return N}activate(N){var q,R;let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;const B=(N=N||this._camera).va(),F=B.getEngine(),S=F.getCaps().maxTextureSize,A=(z?z.width:this._engine.getRenderWidth(!0))*this._options|0,y=(z?z.height:this._engine.getRenderHeight(!0))*this._options|0;let E=this._options.width||A,t=this._options.height||y;const e=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let b=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const N=F.currentViewport;N&&(E*=N.width,t*=N.height)}(e||this.alwaysForcePOT)&&(this._options.width||(E=F.needPOTTextures?(0,x.f)(E,S,this.scaleMode):E),this._options.height||(t=F.needPOTTextures?(0,x.f)(t,S,this.scaleMode):t)),this.width===E&&this.height===t&&(b=this._getTarget())||this.resize(E,t,N,e,v),this._textures.forEach((N=>{N.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(N,this.samples)})),this._flushTextureCache(),this._renderId++}return b||(b=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.qe(A/E,y/t),this._engine.bindFramebuffer(b,0,A,y,this.forceFullscreenViewport)):(this._scaleRatio.qe(1,1),this._engine.bindFramebuffer(b,0,void 0,void 0,this.forceFullscreenViewport)),null===(q=(R=this._engine)._debugInsertMarker)||void 0===q||q.call(R,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(N),this.Ti&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:B.clearColor,B._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),b}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let N;var q;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),N=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(q=N)||void 0===q?void 0:q.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let N=this._textureCache.length-1;N>=0;N--)this._textureCache[N].texture.dispose();this._textureCache.length=0}setPrePassRenderer(N){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=N.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(N){let q;if(N=N||this._camera,this._disposeTextures(),this._scene&&(q=this._scene.postProcesses.indexOf(this),-1!==q&&this._scene.postProcesses.splice(q,1)),this._parentContainer){const N=this._parentContainer.postProcesses.indexOf(this);N>-1&&this._parentContainer.postProcesses.splice(N,1),this._parentContainer=null}if(q=this._engine.postProcesses.indexOf(this),-1!==q&&this._engine.postProcesses.splice(q,1),N){if(N.detachPostProcess(this),q=N._postProcesses.indexOf(this),0===q&&N._postProcesses.length>0){const N=this._camera._getFirstPostProcess();N&&N.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const N=y.e.Serialize(this),q=this.getCamera()||this._scene&&this._scene.activeCamera;return N.customType="BABYLON."+this.getClassName(),N.cameraId=q?q.id:null,N.reusable=this._reusable,N.textureType=this._textureType,N.fragmentUrl=this._fragmentUrl,N.parameters=this._parameters,N.samplers=this._samplers,N.uniformBuffers=this._uniformBuffers,N.options=this._options,N.defines=this._postProcessDefines,N.textureFormat=this._textureFormat,N.vertexUrl=this._vertexUrl,N.indexParameters=this._indexParameters,N}clone(){const N=this.serialize();N._engine=this._engine,N.cameraId=null;const q=b.Parse(N,this._scene,"");return q?(q.onActivateObservable=this.onActivateObservable.clone(),q.onSizeChangedObservable=this.onSizeChangedObservable.clone(),q.onApplyObservable=this.onApplyObservable.clone(),q.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),q.onAfterRenderObservable=this.onAfterRenderObservable.clone(),q._prePassEffectConfiguration=this._prePassEffectConfiguration,q):null}static Parse(N,q,R){const z=(0,E.c)(N.customType);if(!z||!z._Parse)return null;const v=q?q.getCameraById(N.cameraId):null;return z._Parse(N,v,q,R)}static _Parse(N,q,R,z){return y.e.Parse((()=>new b(N.name,N.fragmentUrl,N.parameters,N.samplers,N.options,q,N.renderTargetSamplingMode,N._engine,N.reusable,N.defines,N.textureType,N.vertexUrl,N.indexParameters,!1,N.textureFormat)),N,R,z)}}(0,z.c)([(0,A.D)()],b.prototype,"uniqueId",void 0),(0,z.c)([(0,A.D)()],b.prototype,"name",null),(0,z.c)([(0,A.D)()],b.prototype,"width",void 0),(0,z.c)([(0,A.D)()],b.prototype,"height",void 0),(0,z.c)([(0,A.D)()],b.prototype,"renderTargetSamplingMode",void 0),(0,z.c)([(0,A.m)()],b.prototype,"clearColor",void 0),(0,z.c)([(0,A.D)()],b.prototype,"Ti",void 0),(0,z.c)([(0,A.D)()],b.prototype,"forceAutoClearInAlphaMode",void 0),(0,z.c)([(0,A.D)()],b.prototype,"alphaMode",null),(0,z.c)([(0,A.D)()],b.prototype,"alphaConstants",void 0),(0,z.c)([(0,A.D)()],b.prototype,"enablePixelPerfectMode",void 0),(0,z.c)([(0,A.D)()],b.prototype,"forceFullscreenViewport",void 0),(0,z.c)([(0,A.D)()],b.prototype,"scaleMode",void 0),(0,z.c)([(0,A.D)()],b.prototype,"alwaysForcePOT",void 0),(0,z.c)([(0,A.D)("samples")],b.prototype,"_samples",void 0),(0,z.c)([(0,A.D)()],b.prototype,"adaptScaleToCurrentViewport",void 0),(0,E.f)("BABYLON.PostProcess",b)},11264:(N,q,R)=>{"use strict";R.d(q,{e:()=>B});var z=R(11251),v=R(10893);class B{constructor(N){this._vertexBuffers={},this.onBeforeRenderObservable=new v.d,this._scene=N}_prepareBuffers(){if(this._vertexBuffers[z.h.PositionKind])return;const N=[];N.push(1,1),N.push(-1,1),N.push(-1,-1),N.push(1,-1),this._vertexBuffers[z.h.PositionKind]=new z.h(this._scene.getEngine(),N,z.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const N=[];N.push(0),N.push(1),N.push(2),N.push(0),N.push(2),N.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(N)}_rebuild(){const N=this._vertexBuffers[z.h.PositionKind];N&&(N._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this._scene.activeCamera;return!!R&&(q=q||R._postProcesses.filter((N=>null!=N)),!(!q||0===q.length||!this._scene.postProcessesEnabled)&&(q[0].activate(R,N,null!==q&&void 0!==q),!0))}directRender(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=this._scene.getEngine();for(let A=0;A<N.length;A++){var S;if(A<N.length-1)N[A+1].activate(this._scene.activeCamera,null===q||void 0===q?void 0:q.texture);else q?F.bindFramebuffer(q,z,void 0,void 0,R,v):B||F.restoreDefaultFramebuffer(),null===(S=F._debugInsertMarker)||void 0===S||S.call(F,`post process ${N[A].name} output`);const y=N[A],E=y.apply();E&&(y.onBeforeRenderObservable.notifyObservers(E),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,E),F.drawElementsType(0,0,6),y.onAfterRenderObservable.notifyObservers(E))}F.setDepthBuffer(!0),F.setDepthWrite(!0)}_finalizeFrame(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=this._scene.activeCamera;if(!B)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(z=z||B._postProcesses.filter((N=>null!=N))).length||!this._scene.postProcessesEnabled)return;const F=this._scene.getEngine();for(let A=0,y=z.length;A<y;A++){const E=z[A];var S;if(A<y-1)E._outputTexture=z[A+1].activate(B,null===q||void 0===q?void 0:q.texture);else q?(F.bindFramebuffer(q,R,void 0,void 0,v),E._outputTexture=q):(F.restoreDefaultFramebuffer(),E._outputTexture=null),null===(S=F._debugInsertMarker)||void 0===S||S.call(F,`post process ${z[A].name} output`);if(N)break;const t=E.apply();t&&(E.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,t),F.drawElementsType(0,0,6),E.onAfterRenderObservable.notifyObservers(t))}F.setDepthBuffer(!0),F.setDepthWrite(!0),F.setAlphaMode(0)}dispose(){const N=this._vertexBuffers[z.h.PositionKind];N&&(N.dispose(),this._vertexBuffers[z.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11273:(N,q,R)=>{"use strict";R.d(q,{d:()=>S});var z=R(11167),v=R(11181);class B{set opaqueSortCompareFn(N){this._opaqueSortCompareFn=N||B.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(N){this._alphaTestSortCompareFn=N||B.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(N){this._transparentSortCompareFn=N||B.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=N,this._opaqueSubMeshes=new z.h(256),this._transparentSubMeshes=new z.h(256),this._alphaTestSubMeshes=new z.h(256),this._depthOnlySubMeshes=new z.h(256),this._particleSystems=new z.h(256),this._spriteManagers=new z.h(256),this._empty=!0,this._edgesRenderers=new z.e(16),this._scene=q,this.opaqueSortCompareFn=R,this.alphaTestSortCompareFn=v,this.transparentSortCompareFn=B}render(N,q,R,z){if(N)return void N(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const v=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(v.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),v.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const B=v.getStencilBuffer();if(v.setStencilBuffer(!1),q&&this._renderSprites(),R&&this._renderParticles(z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(v.setStencilBuffer(B),this._scene.useOrderIndependentTransparency){const N=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);N.length&&this._renderTransparent(N)}else this._renderTransparent(this._transparentSubMeshes);v.setAlphaMode(0)}if(v.setStencilBuffer(!1),this._edgesRenderers.length){for(let N=0;N<this._edgesRenderers.length;N++)this._edgesRenderers.data[N].render();v.setAlphaMode(0)}v.setStencilBuffer(B)}_renderOpaqueSorted(N){B._RenderSorted(N,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(N){B._RenderSorted(N,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(N){B._RenderSorted(N,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(N,q,R,z){let F,S=0;const A=R?R.globalPosition:B._ZeroVector;if(z)for(;S<N.length;S++)F=N.data[S],F._alphaIndex=F.getMesh().alphaIndex,F._distanceToCamera=v.m.Distance(F.getBoundingInfo().boundingSphere.centerWorld,A);const y=N.length===N.data.length?N.data:N.data.slice(0,N.length);q&&y.sort(q);const E=y[0].getMesh().va();for(S=0;S<y.length;S++)if(F=y[S],!E._activeMeshesFrozenButKeepClipping||F.isInFrustum(E._frustumPlanes)){if(z){const N=F.Ha();if(N&&N.needDepthPrePass){const q=N.va().getEngine();q.setColorWrite(!1),q.setAlphaMode(0),F.render(!1),q.setColorWrite(!0)}}F.render(z)}}static defaultTransparentSortCompare(N,q){return N._alphaIndex>q._alphaIndex?1:N._alphaIndex<q._alphaIndex?-1:B.backToFrontSortCompare(N,q)}static backToFrontSortCompare(N,q){return N._distanceToCamera<q._distanceToCamera?1:N._distanceToCamera>q._distanceToCamera?-1:0}static frontToBackSortCompare(N,q){return N._distanceToCamera<q._distanceToCamera?-1:N._distanceToCamera>q._distanceToCamera?1:0}static PainterSortCompare(N,q){const R=N.getMesh(),z=q.getMesh();return R.material&&z.material?R.material.uniqueId-z.material.uniqueId:R.uniqueId-z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(N,q,R){void 0===q&&(q=N.getMesh()),void 0===R&&(R=N.Ha()),null!==R&&void 0!==R&&(R.needAlphaBlendingForMesh(q)?this._transparentSubMeshes.push(N):R.needAlphaTesting()?(R.needDepthPrePass&&this._depthOnlySubMeshes.push(N),this._alphaTestSubMeshes.push(N)):(R.needDepthPrePass&&this._depthOnlySubMeshes.push(N),this._opaqueSubMeshes.push(N)),q._renderingGroup=this,q._edgesRenderer&&q.isEnabled()&&q.isVisible&&q._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(q._edgesRenderer),this._empty=!1)}dispatchSprites(N){this._spriteManagers.push(N),this._empty=!1}dispatchParticles(N){this._particleSystems.push(N),this._empty=!1}_renderParticles(N){if(0===this._particleSystems.length)return;const q=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let R=0;R<this._particleSystems.length;R++){const z=this._particleSystems.data[R];if(0===(q&&q.layerMask&z.layerMask))continue;const v=z.j;v.position&&N&&-1===N.indexOf(v)||this._scene._activeParticles.addCount(z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const N=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let q=0;q<this._spriteManagers.length;q++){const R=this._spriteManagers.data[q];0!==(N&&N.layerMask&R.layerMask)&&R.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}B._ZeroVector=v.m.Zero();class F{}class S{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(N){N!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=N,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const N of this._scene.meshes)if(N.lg)for(const q of N.lg)q._wasDispatched=!1;if(this._scene.spriteManagers)for(const N of this._scene.spriteManagers)N._wasDispatched=!1;for(const N of this._scene.qj)N._wasDispatched=!1}constructor(N){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new F,this._maintainStateBetweenFrames=!1,this._scene=N;for(let q=S.MIN_RENDERINGGROUPS;q<S.MAX_RENDERINGGROUPS;q++)this._autoClearDepthStencil[q]={Ti:!0,depth:!0,stencil:!0}}getRenderingGroup(N){const q=N||0;return this._prepareRenderingGroup(q),this._renderingGroups[q]}_clearDepthStencilBuffer(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,N,q),this._depthStencilBufferAlreadyCleaned=!0)}render(N,q,R,z){const v=this._renderingGroupInfo;if(v.Xd=this._scene,v.camera=this._scene.activeCamera,this._scene.spriteManagers&&z)for(let B=0;B<this._scene.spriteManagers.length;B++){const N=this._scene.spriteManagers[B];this.dispatchSprites(N)}for(let B=S.MIN_RENDERINGGROUPS;B<S.MAX_RENDERINGGROUPS;B++){this._depthStencilBufferAlreadyCleaned=B===S.MIN_RENDERINGGROUPS;const F=this._renderingGroups[B];if(!F||F._empty)continue;const A=1<<B;if(v.renderingGroupId=B,this._scene.onBeforeRenderingGroupObservable.notifyObservers(v,A),S.AUTOCLEAR){const N=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(B):this._autoClearDepthStencil[B];N&&N.Ti&&this._clearDepthStencilBuffer(N.depth,N.stencil)}for(const N of this._scene._beforeRenderingGroupDrawStage)N.action(B);F.render(N,z,R,q);for(const N of this._scene._afterRenderingGroupDrawStage)N.action(B);this._scene.onAfterRenderingGroupObservable.notifyObservers(v,A)}}reset(){if(!this.maintainStateBetweenFrames)for(let N=S.MIN_RENDERINGGROUPS;N<S.MAX_RENDERINGGROUPS;N++){const q=this._renderingGroups[N];q&&q.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let N=S.MIN_RENDERINGGROUPS;N<S.MAX_RENDERINGGROUPS;N++){const q=this._renderingGroups[N];q&&q.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let N=S.MIN_RENDERINGGROUPS;N<S.MAX_RENDERINGGROUPS;N++){const q=this._renderingGroups[N];q&&q.dispose()}}_prepareRenderingGroup(N){void 0===this._renderingGroups[N]&&(this._renderingGroups[N]=new B(N,this._scene,this._customOpaqueSortCompareFn[N],this._customAlphaTestSortCompareFn[N],this._customTransparentSortCompareFn[N]))}dispatchSprites(N){this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(N.renderingGroupId).dispatchSprites(N))}dispatchParticles(N){this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(N.renderingGroupId).dispatchParticles(N))}dispatch(N,q,R){void 0===q&&(q=N.getMesh()),this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatch(N,q,R))}setRenderingOrder(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[N]=q,this._customAlphaTestSortCompareFn[N]=R,this._customTransparentSortCompareFn[N]=z,this._renderingGroups[N]){const q=this._renderingGroups[N];q.opaqueSortCompareFn=this._customOpaqueSortCompareFn[N],q.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[N],q.transparentSortCompareFn=this._customTransparentSortCompareFn[N]}}setRenderingAutoClearDepthStencil(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[N]={Ti:q,depth:R,stencil:z}}getAutoClearDepthStencilSetup(N){return this._autoClearDepthStencil[N]}}S.MAX_RENDERINGGROUPS=4,S.MIN_RENDERINGGROUPS=0,S.AUTOCLEAR=!0},11894:(N,q,R)=>{"use strict";const z="clipPlaneFragment",v="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11860:(N,q,R)=>{"use strict";const z="clipPlaneFragmentDeclaration",v="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11913:(N,q,R)=>{"use strict";const z="clipPlaneVertex",v="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11908:(N,q,R)=>{"use strict";const z="clipPlaneVertexDeclaration",v="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11901:(N,q,R)=>{"use strict";const z="fogFragment",v="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11892:(N,q,R)=>{"use strict";const z="fogFragmentDeclaration",v="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11921:(N,q,R)=>{"use strict";const z="fogVertex",v="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11911:(N,q,R)=>{"use strict";const z="fogVertexDeclaration",v="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11875:(N,q,R)=>{"use strict";const z="helperFunctions",v="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11867:(N,q,R)=>{"use strict";const z="imageProcessingDeclaration",v="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11884:(N,q,R)=>{"use strict";const z="imageProcessingFunctions",v="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";R(10966).e.IncludesShadersStoreWGSL[z]=v},11871:(N,q,R)=>{"use strict";const z="logDepthDeclaration",v="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11898:(N,q,R)=>{"use strict";const z="logDepthFragment",v="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11925:(N,q,R)=>{"use strict";const z="logDepthVertex",v="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";R(10966).e.IncludesShadersStoreWGSL[z]=v},11858:(N,q,R)=>{"use strict";R.r(q),R.d(q,{particlesPixelShaderWGSL:()=>F});var z=R(10966);R(11860),R(11867),R(11871),R(11875),R(11884),R(11892),R(11894),R(11898),R(11901);const v="particlesPixelShader",B="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.e.ShadersStoreWGSL[v]=B;const F={name:v,shader:B}},11903:(N,q,R)=>{"use strict";R.r(q),R.d(q,{particlesVertexShaderWGSL:()=>F});var z=R(10966);R(11908),R(11911),R(11871),R(11913),R(11921),R(11925);const v="particlesVertexShader",B="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.e.ShadersStoreWGSL[v]=B;const F={name:v,shader:B}},11770:(N,q,R)=>{"use strict";const z="clipPlaneFragment",v="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11840:(N,q,R)=>{"use strict";const z="clipPlaneFragmentDeclaration",v="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11792:(N,q,R)=>{"use strict";const z="clipPlaneVertex",v="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11853:(N,q,R)=>{"use strict";const z="clipPlaneVertexDeclaration",v="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11779:(N,q,R)=>{"use strict";const z="fogFragment",v="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11765:(N,q,R)=>{"use strict";const z="fogFragmentDeclaration",v="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11796:(N,q,R)=>{"use strict";const z="fogVertex",v="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11788:(N,q,R)=>{"use strict";const z="fogVertexDeclaration",v="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11754:(N,q,R)=>{"use strict";const z="helperFunctions",v="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";R(10966).e.IncludesShadersStore[z]=v},11744:(N,q,R)=>{"use strict";const z="imageProcessingDeclaration",v="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11762:(N,q,R)=>{"use strict";const z="imageProcessingFunctions",v="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";R(10966).e.IncludesShadersStore[z]=v},11750:(N,q,R)=>{"use strict";const z="logDepthDeclaration",v="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11777:(N,q,R)=>{"use strict";const z="logDepthFragment",v="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11804:(N,q,R)=>{"use strict";const z="logDepthVertex",v="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";R(10966).e.IncludesShadersStore[z]=v},11838:(N,q,R)=>{"use strict";R.r(q),R.d(q,{particlesPixelShader:()=>F});var z=R(10966);R(11840),R(11744),R(11750),R(11754),R(11762),R(11765),R(11770),R(11777),R(11779);const v="particlesPixelShader",B="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.e.ShadersStore[v]=B;const F={name:v,shader:B}},11846:(N,q,R)=>{"use strict";R.r(q),R.d(q,{particlesVertexShader:()=>F});var z=R(10966);R(11853),R(11788),R(11750),R(11792),R(11796),R(11804);const v="particlesVertexShader",B="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.e.ShadersStore[v]=B;const F={name:v,shader:B}},11728:(N,q,R)=>{"use strict";R.r(q),R.d(q,{postprocessVertexShader:()=>B});const z="postprocessVertexShader",v="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";R(10966).e.ShadersStore[z]=v;const B={name:z,shader:v}},11301:(N,q,R)=>{"use strict";R.d(q,{b:()=>z});class z{}z._IsPickingAvailable=!1},11454:(N,q,R)=>{"use strict";R.d(q,{c:()=>t});var z=R(11147),v=R(11181),B=R(11151),F=R(10893),S=R(10933),A=R(10923),y=R(11221);class E{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new F.d,this._onClonedObservable=new F.d}}class t{static AddNodeConstructor(N,q){this._NodeConstructors[N]=q}static Construct(N,q,R,z){const v=this._NodeConstructors[N];return v?v(q,R,z):null}set accessibilityTag(N){this._accessibilityTag=N,this.onAccessibilityTagChangedObservable.notifyObservers(N)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(N){this._nodeDataStorage._doNotSerialize=N}u(){return this._nodeDataStorage._isDisposed}set parent(N){if(this._parentNode===N)return;const q=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const q=this._parentNode._children.indexOf(this);-1!==q&&this._parentNode._children.splice(q,1),N||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=N,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),q||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(N){N.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const N=this._scene.rootNodes,q=N.length-1;N[this._nodeDataStorage._sceneRootNodesIndex]=N[q],N[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}getClassName(){return"Node"}set onDispose(N){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(N)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new E,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new F.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=v.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.jj=new F.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=N,this.id=N,this._scene=q||S.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),R&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(N)||(N.init(),this._scene.isLoading&&!q?this._scene.onDataLoadedObservable.addOnce((()=>{N.attach(this)})):N.attach(this),this._behaviors.push(N)),this}removeBehavior(N){const q=this._behaviors.indexOf(N);return-1===q||(this._behaviors[q].detach(),this._behaviors.splice(q,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(N){for(const q of this._behaviors)if(q.name===N)return q;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Oj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(N){!N&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(N){return this.parent?this.parent._getActionManagerForTrigger(N,!1):null}_updateCache(N){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Lg(N){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((N=>{N._syncParentEnabledState()}))}Vb(N){this._nodeDataStorage._isEnabled!==N&&(this._nodeDataStorage._isEnabled=N,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(N))}isDescendantOf(N){return!!this.parent&&(this.parent===N||this.parent.isDescendantOf(N))}_getDescendants(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;if(this._children)for(let z=0;z<this._children.length;z++){const v=this._children[z];R&&!R(v)||N.push(v),q||v._getDescendants(N,!1,R)}}getDescendants(N,q){const R=[];return this._getDescendants(R,N,q),R}getChildMeshes(N,q){const R=[];return this._getDescendants(R,N,(N=>(!q||q(N))&&void 0!==N.Di)),R}getChildren(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(q,N)}_setReady(N){N!==this._nodeDataStorage._isReady&&(N?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(N){for(let q=0;q<this.animations.length;q++){const R=this.animations[q];if(R.name===N)return R}return null}createAnimationRange(N,q,R){if(!this._ranges[N]){this._ranges[N]=t._AnimationRangeFactory(N,q,R);for(let z=0,v=this.animations.length;z<v;z++)this.animations[z]&&this.animations[z].createRange(N,q,R)}}deleteAnimationRange(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let R=0,z=this.animations.length;R<z;R++)this.animations[R]&&this.animations[R].deleteRange(N,q);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}clone(N,q,R){const z=y.e.Clone((()=>new t(N,this.va())),this);if(q&&(z.parent=q),!R){const q=this.getDescendants(!0);for(let R=0;R<q.length;R++){const v=q[R];v.clone(N+"."+v.name,z)}}return z}getAnimationRanges(){const N=[];let q;for(q in this._ranges)N.push(this._ranges[q]);return N}beginAnimation(N,q,R,z){const v=this.getAnimationRange(N);return v?this._scene.beginAnimation(this,v.from,v.to,q,R,z):null}serializeAnimationRanges(){const N=[];for(const q in this._ranges){const R=this._ranges[q];if(!R)continue;const z={};z.name=q,z.from=R.from,z.to=R.to,N.push(z)}return N}Oj(N){return this._worldMatrix||(this._worldMatrix=v.d.Identity()),this._worldMatrix}dispose(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!N){const R=this.getDescendants(!0);for(const z of R)z.dispose(N,q)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.jj.notifyObservers(this),this.jj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const R of this._behaviors)R.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(N,q,R){if(q.ranges)for(let z=0;z<q.ranges.length;z++){const R=q.ranges[z];N.createAnimationRange(R.name,R.from,R.to)}}getHierarchyBoundingVectors(){let N,q,R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Oj(!0);const B=this;if(B.getBoundingInfo&&B.lg){const R=B.getBoundingInfo();N=R.boundingBox.minimumWorld.clone(),q=R.boundingBox.maximumWorld.clone()}else N=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new v.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(R){const R=this.getDescendants(!1);for(const B of R){const R=B;if(R.Oj(!0),z&&!z(R))continue;if(!R.getBoundingInfo||0===R.getTotalVertices())continue;const F=R.getBoundingInfo().boundingBox,S=F.minimumWorld,A=F.maximumWorld;v.m.CheckExtends(S,N,q),v.m.CheckExtends(A,N,q)}}return{min:N,max:q}}}t._AnimationRangeFactory=(N,q,R)=>{throw(0,A.b)("AnimationRange")},t._NodeConstructors={},(0,z.c)([(0,B.D)()],t.prototype,"name",void 0),(0,z.c)([(0,B.D)()],t.prototype,"id",void 0),(0,z.c)([(0,B.D)()],t.prototype,"uniqueId",void 0),(0,z.c)([(0,B.D)()],t.prototype,"state",void 0),(0,z.c)([(0,B.D)()],t.prototype,"metadata",void 0)},11172:(N,q,R)=>{"use strict";R.d(q,{b:()=>NN});var z=R(10888),v=R(10919),B=R(10893),F=R(11167);class S{constructor(){this._count=0,this._data={}}p(N){this.clear(),N.forEach(((N,q)=>this.add(N,q)))}get(N){const q=this._data[N];if(void 0!==q)return q}getOrAddWithFactory(N,q){let R=this.get(N);return void 0!==R||(R=q(N),R&&this.add(N,R)),R}getOrAdd(N,q){const R=this.get(N);return void 0!==R?R:(this.add(N,q),q)}contains(N){return void 0!==this._data[N]}add(N,q){return void 0===this._data[N]&&(this._data[N]=q,++this._count,!0)}set(N,q){return void 0!==this._data[N]&&(this._data[N]=q,!0)}getAndRemove(N){const q=this.get(N);return void 0!==q?(delete this._data[N],--this._count,q):null}remove(N){return!!this.contains(N)&&(delete this._data[N],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(N){for(const q in this._data){N(q,this._data[q])}}first(N){for(const q in this._data){const R=N(q,this._data[q]);if(R)return R}return null}}var A=R(11178),y=R(11181),E=R(11206),t=R(11238),x=R(11242);class e{constructor(N,q,R,z,v,B){this.source=N,this.pointerX=q,this.pointerY=R,this.meshUnderPointer=z,this.sourceEvent=v,this.additionalData=B}static CreateNew(N,q,R){const z=N.va();return new e(N,z.pointerX,z.pointerY,z.meshUnderPointer||N,q,R)}static CreateNewFromSprite(N,q,R,z){return new e(N,q.pointerX,q.pointerY,q.meshUnderPointer,R,z)}static CreateNewFromScene(N,q){return new e(null,N.pointerX,N.pointerY,N.meshUnderPointer,q)}static CreateNewFromPrimitive(N,q,R,z){return new e(N,q.x,q.y,null,R,z)}}var b=R(11264),f=R(11273),D=R(11282),V=R(10900),H=R(10933),Y=R(10923),T=R(11286);class L{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const N in L.Triggers)if(Object.prototype.hasOwnProperty.call(L.Triggers,N))return!0;return!1}static get HasPickTriggers(){for(const N in L.Triggers)if(Object.prototype.hasOwnProperty.call(L.Triggers,N)){const q=parseInt(N);if(q>=1&&q<=7)return!0}return!1}static HasSpecificTrigger(N){for(const q in L.Triggers)if(Object.prototype.hasOwnProperty.call(L.Triggers,q)){if(parseInt(q)===N)return!0}return!1}}L.Triggers={};var X,Q,h,u,w,c,n,G=R(11289);!function(N){N[N.Generic=0]="Generic",N[N.Keyboard=1]="Keyboard",N[N.Mouse=2]="Mouse",N[N.Touch=3]="Touch",N[N.DualShock=4]="DualShock",N[N.Xbox=5]="Xbox",N[N.Switch=6]="Switch",N[N.DualSense=7]="DualSense"}(X||(X={})),function(N){N[N.Horizontal=0]="Horizontal",N[N.Vertical=1]="Vertical",N[N.LeftClick=2]="LeftClick",N[N.MiddleClick=3]="MiddleClick",N[N.RightClick=4]="RightClick",N[N.BrowserBack=5]="BrowserBack",N[N.BrowserForward=6]="BrowserForward",N[N.MouseWheelX=7]="MouseWheelX",N[N.MouseWheelY=8]="MouseWheelY",N[N.MouseWheelZ=9]="MouseWheelZ",N[N.Move=12]="Move"}(Q||(Q={})),function(N){N[N.Horizontal=0]="Horizontal",N[N.Vertical=1]="Vertical",N[N.LeftClick=2]="LeftClick",N[N.MiddleClick=3]="MiddleClick",N[N.RightClick=4]="RightClick",N[N.BrowserBack=5]="BrowserBack",N[N.BrowserForward=6]="BrowserForward",N[N.MouseWheelX=7]="MouseWheelX",N[N.MouseWheelY=8]="MouseWheelY",N[N.MouseWheelZ=9]="MouseWheelZ",N[N.DeltaHorizontal=10]="DeltaHorizontal",N[N.DeltaVertical=11]="DeltaVertical"}(h||(h={})),function(N){N[N.Cross=0]="Cross",N[N.Circle=1]="Circle",N[N.Square=2]="Square",N[N.Triangle=3]="Triangle",N[N.L1=4]="L1",N[N.R1=5]="R1",N[N.L2=6]="L2",N[N.R2=7]="R2",N[N.Share=8]="Share",N[N.Options=9]="Options",N[N.L3=10]="L3",N[N.R3=11]="R3",N[N.DPadUp=12]="DPadUp",N[N.DPadDown=13]="DPadDown",N[N.DPadLeft=14]="DPadLeft",N[N.DPadRight=15]="DPadRight",N[N.Home=16]="Home",N[N.TouchPad=17]="TouchPad",N[N.LStickXAxis=18]="LStickXAxis",N[N.LStickYAxis=19]="LStickYAxis",N[N.RStickXAxis=20]="RStickXAxis",N[N.RStickYAxis=21]="RStickYAxis"}(u||(u={})),function(N){N[N.Cross=0]="Cross",N[N.Circle=1]="Circle",N[N.Square=2]="Square",N[N.Triangle=3]="Triangle",N[N.L1=4]="L1",N[N.R1=5]="R1",N[N.L2=6]="L2",N[N.R2=7]="R2",N[N.Create=8]="Create",N[N.Options=9]="Options",N[N.L3=10]="L3",N[N.R3=11]="R3",N[N.DPadUp=12]="DPadUp",N[N.DPadDown=13]="DPadDown",N[N.DPadLeft=14]="DPadLeft",N[N.DPadRight=15]="DPadRight",N[N.Home=16]="Home",N[N.TouchPad=17]="TouchPad",N[N.LStickXAxis=18]="LStickXAxis",N[N.LStickYAxis=19]="LStickYAxis",N[N.RStickXAxis=20]="RStickXAxis",N[N.RStickYAxis=21]="RStickYAxis"}(w||(w={})),function(N){N[N.A=0]="A",N[N.B=1]="B",N[N.X=2]="X",N[N.Y=3]="Y",N[N.LB=4]="LB",N[N.RB=5]="RB",N[N.LT=6]="LT",N[N.RT=7]="RT",N[N.Back=8]="Back",N[N.Start=9]="Start",N[N.LS=10]="LS",N[N.RS=11]="RS",N[N.DPadUp=12]="DPadUp",N[N.DPadDown=13]="DPadDown",N[N.DPadLeft=14]="DPadLeft",N[N.DPadRight=15]="DPadRight",N[N.Home=16]="Home",N[N.LStickXAxis=17]="LStickXAxis",N[N.LStickYAxis=18]="LStickYAxis",N[N.RStickXAxis=19]="RStickXAxis",N[N.RStickYAxis=20]="RStickYAxis"}(c||(c={})),function(N){N[N.B=0]="B",N[N.A=1]="A",N[N.Y=2]="Y",N[N.X=3]="X",N[N.L=4]="L",N[N.R=5]="R",N[N.ZL=6]="ZL",N[N.ZR=7]="ZR",N[N.Minus=8]="Minus",N[N.Plus=9]="Plus",N[N.LS=10]="LS",N[N.RS=11]="RS",N[N.DPadUp=12]="DPadUp",N[N.DPadDown=13]="DPadDown",N[N.DPadLeft=14]="DPadLeft",N[N.DPadRight=15]="DPadRight",N[N.Home=16]="Home",N[N.Capture=17]="Capture",N[N.LStickXAxis=18]="LStickXAxis",N[N.LStickYAxis=19]="LStickYAxis",N[N.RStickXAxis=20]="RStickXAxis",N[N.RStickYAxis=21]="RStickYAxis"}(n||(n={}));var s=R(11296);class Z{static CreateDeviceEvent(N,q,R,z,v,B,F){switch(N){case X.Keyboard:return this._CreateKeyboardEvent(R,z,v,B);case X.Mouse:if(R===Q.MouseWheelX||R===Q.MouseWheelY||R===Q.MouseWheelZ)return this._CreateWheelEvent(N,q,R,z,v,B);case X.Touch:return this._CreatePointerEvent(N,q,R,z,v,B,F);default:throw`Unable to generate event for device ${X[N]}`}}static _CreatePointerEvent(N,q,R,z,v,B,F){const S=this._CreateMouseEvent(N,q,R,z,v,B);N===X.Mouse?(S.deviceType=X.Mouse,S.pointerId=1,S.pointerType="mouse"):(S.deviceType=X.Touch,S.pointerId=F??q,S.pointerType="touch");let A=0;return A+=v.pollInput(N,q,Q.LeftClick),A+=2*v.pollInput(N,q,Q.RightClick),A+=4*v.pollInput(N,q,Q.MiddleClick),S.buttons=A,R===Q.Move?S.type="pointermove":R>=Q.LeftClick&&R<=Q.RightClick&&(S.type=1===z?"pointerdown":"pointerup",S.button=R-2),S}static _CreateWheelEvent(N,q,R,z,v,B){const F=this._CreateMouseEvent(N,q,R,z,v,B);switch(F.pointerId=1,F.type="wheel",F.deltaMode=s.e.DOM_DELTA_PIXEL,F.deltaX=0,F.deltaY=0,F.deltaZ=0,R){case Q.MouseWheelX:F.deltaX=z;break;case Q.MouseWheelY:F.deltaY=z;break;case Q.MouseWheelZ:F.deltaZ=z}return F}static _CreateMouseEvent(N,q,R,z,v,B){const F=this._CreateEvent(B),S=v.pollInput(N,q,Q.Horizontal),A=v.pollInput(N,q,Q.Vertical);return B?(F.movementX=0,F.movementY=0,F.offsetX=F.movementX-B.getBoundingClientRect().x,F.offsetY=F.movementY-B.getBoundingClientRect().y):(F.movementX=v.pollInput(N,q,10),F.movementY=v.pollInput(N,q,11),F.offsetX=0,F.offsetY=0),this._CheckNonCharacterKeys(F,v),F.clientX=S,F.clientY=A,F.x=S,F.y=A,F.deviceType=N,F.deviceSlot=q,F.inputIndex=R,F}static _CreateKeyboardEvent(N,q,R,z){const v=this._CreateEvent(z);return this._CheckNonCharacterKeys(v,R),v.deviceType=X.Keyboard,v.deviceSlot=0,v.inputIndex=N,v.type=1===q?"keydown":"keyup",v.key=String.fromCharCode(N),v.keyCode=N,v}static _CheckNonCharacterKeys(N,q){const R=q.isDeviceAvailable(X.Keyboard),z=R&&1===q.pollInput(X.Keyboard,0,18),v=R&&1===q.pollInput(X.Keyboard,0,17),B=R&&(1===q.pollInput(X.Keyboard,0,91)||1===q.pollInput(X.Keyboard,0,92)||1===q.pollInput(X.Keyboard,0,93)),F=R&&1===q.pollInput(X.Keyboard,0,16);N.altKey=z,N.ctrlKey=v,N.metaKey=B,N.shiftKey=F}static _CreateEvent(N){const q={preventDefault:()=>{}};return q.target=N,q}}class J{constructor(N,q,R){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(N,q,((N,q,z,v)=>{const B=Z.CreateDeviceEvent(N,q,z,v,this);R(N,q,B)})):this._createDummyNativeInput()}pollInput(N,q,R){return this._nativeInput.pollInput(N,q,R)}isDeviceAvailable(N){return N===X.Mouse||N===X.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const M=Object.keys(Q).length/2;class m{constructor(N,q,R,v){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=z.f.IsSafari(),this._usingMacOS=(0,V.j)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=N=>{},this._keyboardUpEvent=N=>{},this._keyboardBlurEvent=N=>{},this._pointerMoveEvent=N=>{},this._pointerDownEvent=N=>{},this._pointerUpEvent=N=>{},this._pointerCancelEvent=N=>{},this._pointerWheelEvent=N=>{},this._pointerBlurEvent=N=>{},this._pointerMacOSChromeOutEvent=N=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,V.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,V.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=N=>{},this._gamepadDisconnectedEvent=N=>{},this._eventPrefix=z.f.GetPointerPrefix(N),this._engine=N,this._onDeviceConnected=q,this._onDeviceDisconnected=R,this._onInputChanged=v,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(N,q,R){const v=this._inputs[N][q];if(!v)throw`Unable to find device ${X[N]}`;N>=X.DualShock&&N<=X.DualSense&&this._updateDevice(N,q,R);const B=v[R];if(void 0===B)throw`Unable to find input ${R} for device ${X[N]} in slot ${q}`;return R===Q.Move&&z.f.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),B}isDeviceAvailable(N){return void 0!==this._inputs[N]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const N=null===this||void 0===this?void 0:this._engine.getInputElement();if(N&&(!this._eventsAttached||this._elementToAttachTo!==N)){if(this._disableEvents(),this._inputs)for(const N of this._inputs)if(N)for(const q in N){const R=N[+q];if(R)for(let N=0;N<R.length;N++)R[N]=0}this._elementToAttachTo=N,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const N=navigator.getGamepads();for(const q of N)q&&this._addGamePad(q)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(X.Mouse,0,0,0)}_addGamePad(N){const q=this._getGamepadDeviceType(N.id),R=N.index;this._gamepads=this._gamepads||new Array(N.index+1),this._registerDevice(q,R,N.buttons.length+N.axes.length),this._gamepads[R]=q}_addPointerDevice(N,q,R,z){this._pointerActive||(this._pointerActive=!0),this._registerDevice(N,q,M);const v=this._inputs[N][q];v[0]=R,v[1]=z}_registerDevice(N,q,R){if(void 0===q)throw`Unable to register device ${X[N]} to undefined slot.`;if(this._inputs[N]||(this._inputs[N]={}),!this._inputs[N][q]){const z=new Array(R);z.fill(0),this._inputs[N][q]=z,this._onDeviceConnected(N,q)}}_unregisterDevice(N,q){this._inputs[N][q]&&(delete this._inputs[N][q],this._onDeviceDisconnected(N,q))}_handleKeyActions(){this._keyboardDownEvent=N=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(X.Keyboard,0,255));const q=this._inputs[X.Keyboard][0];if(q){q[N.keyCode]=1;const R=N;R.inputIndex=N.keyCode,this._usingMacOS&&N.metaKey&&"Meta"!==N.key&&(this._metaKeys.includes(N.keyCode)||this._metaKeys.push(N.keyCode)),this._onInputChanged(X.Keyboard,0,R)}},this._keyboardUpEvent=N=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(X.Keyboard,0,255));const q=this._inputs[X.Keyboard][0];if(q){q[N.keyCode]=0;const R=N;if(R.inputIndex=N.keyCode,this._usingMacOS&&"Meta"===N.key&&this._metaKeys.length>0){for(const N of this._metaKeys){const R=Z.CreateDeviceEvent(X.Keyboard,0,N,0,this,this._elementToAttachTo);q[N]=0,this._onInputChanged(X.Keyboard,0,R)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(X.Keyboard,0,R)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const N=this._inputs[X.Keyboard][0];for(let q=0;q<N.length;q++)if(0!==N[q]){N[q]=0;const R=Z.CreateDeviceEvent(X.Keyboard,0,q,0,this,this._elementToAttachTo);this._onInputChanged(X.Keyboard,0,R)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,V.j)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let z=0;z<this._maxTouchPoints;z++)this._activeTouchIds[z]=-1;this._pointerMoveEvent=N=>{const q=this._getPointerType(N);let R=q===X.Mouse?0:this._activeTouchIds.indexOf(N.pointerId);if(q===X.Touch&&-1===R){const v=this._activeTouchIds.indexOf(-1);if(!(v>=0))return void z.f.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);R=v,this._activeTouchIds[v]=N.pointerId,this._onDeviceConnected(q,R)}this._inputs[q]||(this._inputs[q]={}),this._inputs[q][R]||this._addPointerDevice(q,R,N.clientX,N.clientY);const v=this._inputs[q][R];if(v){const z=N;z.inputIndex=Q.Move,v[Q.Horizontal]=N.clientX,v[Q.Vertical]=N.clientY,q===X.Touch&&0===v[Q.LeftClick]&&(v[Q.LeftClick]=1),void 0===N.pointerId&&(N.pointerId=this._mouseId),this._onInputChanged(q,R,z),this._usingSafari||-1===N.button||(z.inputIndex=N.button+2,v[N.button+2]=v[N.button+2]?0:1,this._onInputChanged(q,R,z))}},this._pointerDownEvent=N=>{const q=this._getPointerType(N);let R=q===X.Mouse?0:N.pointerId;if(q===X.Touch){let q=this._activeTouchIds.indexOf(N.pointerId);if(-1===q&&(q=this._activeTouchIds.indexOf(-1)),!(q>=0))return void z.f.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);R=q,this._activeTouchIds[q]=N.pointerId}this._inputs[q]||(this._inputs[q]={}),this._inputs[q][R]?q===X.Touch&&this._onDeviceConnected(q,R):this._addPointerDevice(q,R,N.clientX,N.clientY);const v=this._inputs[q][R];if(v){const z=v[Q.Horizontal],F=v[Q.Vertical];if(q===X.Mouse){if(void 0===N.pointerId&&(N.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(B){}}else if(N.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(N.pointerId)}catch(B){}v[Q.Horizontal]=N.clientX,v[Q.Vertical]=N.clientY,v[N.button+2]=1;const S=N;S.inputIndex=N.button+2,this._onInputChanged(q,R,S),z===N.clientX&&F===N.clientY||(S.inputIndex=Q.Move,this._onInputChanged(q,R,S))}},this._pointerUpEvent=N=>{var q;const R=this._getPointerType(N),z=R===X.Mouse?0:this._activeTouchIds.indexOf(N.pointerId);if(R===X.Touch){if(-1===z)return;this._activeTouchIds[z]=-1}const v=null===(q=this._inputs[R])||void 0===q?void 0:q[z];if(v&&0!==v[N.button+2]){var B,F,S,A;const q=v[Q.Horizontal],y=v[Q.Vertical];v[Q.Horizontal]=N.clientX,v[Q.Vertical]=N.clientY,v[N.button+2]=0;const E=N;void 0===N.pointerId&&(N.pointerId=this._mouseId),q===N.clientX&&y===N.clientY||(E.inputIndex=Q.Move,this._onInputChanged(R,z,E)),E.inputIndex=N.button+2,R===X.Mouse&&this._mouseId>=0&&null!==(B=(F=this._elementToAttachTo).hasPointerCapture)&&void 0!==B&&B.call(F,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):N.pointerId&&null!==(S=(A=this._elementToAttachTo).hasPointerCapture)&&void 0!==S&&S.call(A,N.pointerId)&&this._elementToAttachTo.releasePointerCapture(N.pointerId),this._onInputChanged(R,z,E),R===X.Touch&&this._onDeviceDisconnected(R,z)}},this._pointerCancelEvent=N=>{if("mouse"===N.pointerType){var q,R;const N=this._inputs[X.Mouse][0];this._mouseId>=0&&null!==(q=(R=this._elementToAttachTo).hasPointerCapture)&&void 0!==q&&q.call(R,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let q=Q.LeftClick;q<=Q.BrowserForward;q++)if(1===N[q]){N[q]=0;const R=Z.CreateDeviceEvent(X.Mouse,0,q,0,this,this._elementToAttachTo);this._onInputChanged(X.Mouse,0,R)}}else{var z,v;const q=this._activeTouchIds.indexOf(N.pointerId);if(-1===q)return;null!==(z=(v=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(v,N.pointerId)&&this._elementToAttachTo.releasePointerCapture(N.pointerId),this._inputs[X.Touch][q][Q.LeftClick]=0;const R=Z.CreateDeviceEvent(X.Touch,q,Q.LeftClick,0,this,this._elementToAttachTo,N.pointerId);this._onInputChanged(X.Touch,q,R),this._activeTouchIds[q]=-1,this._onDeviceDisconnected(X.Touch,q)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let N=!1;const q=function(){};try{const R=Object.defineProperty({},"passive",{get:function(){N=!0}});this._elementToAttachTo.addEventListener("test",q,R),this._elementToAttachTo.removeEventListener("test",q,R)}catch(R){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(X.Mouse)){var N,q;const R=this._inputs[X.Mouse][0];this._mouseId>=0&&null!==(N=(q=this._elementToAttachTo).hasPointerCapture)&&void 0!==N&&N.call(q,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let N=Q.LeftClick;N<=Q.BrowserForward;N++)if(1===R[N]){R[N]=0;const q=Z.CreateDeviceEvent(X.Mouse,0,N,0,this,this._elementToAttachTo);this._onInputChanged(X.Mouse,0,q)}}if(this.isDeviceAvailable(X.Touch)){const N=this._inputs[X.Touch];for(let q=0;q<this._activeTouchIds.length;q++){var R,z,v;const B=this._activeTouchIds[q];if(null!==(R=(z=this._elementToAttachTo).hasPointerCapture)&&void 0!==R&&R.call(z,B)&&this._elementToAttachTo.releasePointerCapture(B),-1!==B&&1===(null===(v=N[q])||void 0===v?void 0:v[Q.LeftClick])){N[q][Q.LeftClick]=0;const R=Z.CreateDeviceEvent(X.Touch,q,Q.LeftClick,0,this,this._elementToAttachTo,B);this._onInputChanged(X.Touch,q,R),this._activeTouchIds[q]=-1,this._onDeviceDisconnected(X.Touch,q)}}}},this._pointerWheelEvent=N=>{const q=X.Mouse;this._inputs[q]||(this._inputs[q]=[]),this._inputs[q][0]||(this._pointerActive=!0,this._registerDevice(q,0,M));const R=this._inputs[q][0];if(R){R[Q.MouseWheelX]=N.deltaX||0,R[Q.MouseWheelY]=N.deltaY||N.wheelDelta||0,R[Q.MouseWheelZ]=N.deltaZ||0;const z=N;void 0===N.pointerId&&(N.pointerId=this._mouseId),0!==R[Q.MouseWheelX]&&(z.inputIndex=Q.MouseWheelX,this._onInputChanged(q,0,z)),0!==R[Q.MouseWheelY]&&(z.inputIndex=Q.MouseWheelY,this._onInputChanged(q,0,z)),0!==R[Q.MouseWheelZ]&&(z.inputIndex=Q.MouseWheelZ,this._onInputChanged(q,0,z))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=N=>{N.buttons>1&&this._pointerCancelEvent(N)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!N&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(X.Mouse)){const N=this._inputs[X.Mouse][0];N[Q.MouseWheelX]=0,N[Q.MouseWheelY]=0,N[Q.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=N=>{this._addGamePad(N.gamepad)},this._gamepadDisconnectedEvent=N=>{if(this._gamepads){const q=this._getGamepadDeviceType(N.gamepad.id),R=N.gamepad.index;this._unregisterDevice(q,R),delete this._gamepads[R]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(N,q,R){const z=navigator.getGamepads()[q];if(z&&N===this._gamepads[q]){const v=this._inputs[N][q];R>=z.buttons.length?v[R]=z.axes[R-z.buttons.length].valueOf():v[R]=z.buttons[R].value}}_getGamepadDeviceType(N){return-1!==N.indexOf("054c")?-1!==N.indexOf("0ce6")?X.DualSense:X.DualShock:-1!==N.indexOf("Xbox One")||-1!==N.search("Xbox 360")||-1!==N.search("xinput")?X.Xbox:-1!==N.indexOf("057e")?X.Switch:X.Generic}_getPointerType(N){let q=X.Mouse;return("touch"===N.pointerType||"pen"===N.pointerType||N.touches)&&(q=X.Touch),q}}class g{constructor(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=q,this.deviceSlot=R,this.onInputChangedObservable=new B.d,this._deviceInputSystem=N}getInput(N){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,N)}}class j{constructor(N){this._registeredManagers=new Array,this._refCount=0,this.registerManager=N=>{for(let q=0;q<this._devices.length;q++){const R=this._devices[q];for(const z in R){const R=+z;N._addDevice(new g(this._deviceInputSystem,q,R))}}this._registeredManagers.push(N)},this.unregisterManager=N=>{const q=this._registeredManagers.indexOf(N);q>-1&&this._registeredManagers.splice(q,1)};const q=Object.keys(X).length/2;this._devices=new Array(q);const R=(N,q)=>{this._devices[N]||(this._devices[N]=new Array),this._devices[N][q]||(this._devices[N][q]=q);for(const R of this._registeredManagers){const z=new g(this._deviceInputSystem,N,q);R._addDevice(z)}},z=(N,q)=>{var R;null!==(R=this._devices[N])&&void 0!==R&&R[q]&&delete this._devices[N][q];for(const z of this._registeredManagers)z._removeDevice(N,q)},v=(N,q,R)=>{if(R)for(const z of this._registeredManagers)z._onInputChanged(N,q,R)};"undefined"!==typeof _native?this._deviceInputSystem=new J(R,z,v):this._deviceInputSystem=new m(N,R,z,v)}dispose(){this._deviceInputSystem.dispose()}}class l{getDeviceSource(N,q){if(void 0===q){if(void 0===this._firstDevice[N])return null;q=this._firstDevice[N]}return this._devices[N]&&void 0!==this._devices[N][q]?this._devices[N][q]:null}getDeviceSources(N){return this._devices[N]?this._devices[N].filter((N=>!!N)):[]}constructor(N){const q=Object.keys(X).length/2;this._devices=new Array(q),this._firstDevice=new Array(q),this._engine=N,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new j(N)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new B.d((N=>{for(const q of this._devices)if(q)for(const R of q)R&&this.onDeviceConnectedObservable.notifyObserver(N,R)})),this.onDeviceDisconnectedObservable=new B.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=N.jj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.jj.remove(this._onDisposeObserver)}_addDevice(N){this._devices[N.deviceType]||(this._devices[N.deviceType]=new Array),this._devices[N.deviceType][N.deviceSlot]||(this._devices[N.deviceType][N.deviceSlot]=N,this._updateFirstDevices(N.deviceType)),this.onDeviceConnectedObservable.notifyObservers(N)}_removeDevice(N,q){var R,z;const v=null===(R=this._devices[N])||void 0===R?void 0:R[q];this.onDeviceDisconnectedObservable.notifyObservers(v),null!==(z=this._devices[N])&&void 0!==z&&z[q]&&delete this._devices[N][q],this._updateFirstDevices(N)}_onInputChanged(N,q,R){var z,v;null===(z=this._devices[N])||void 0===z||null===(v=z[q])||void 0===v||v.onInputChangedObservable.notifyObservers(R)}_updateFirstDevices(N){switch(N){case X.Keyboard:case X.Mouse:this._firstDevice[N]=0;break;case X.Touch:case X.DualSense:case X.DualShock:case X.Xbox:case X.Switch:case X.Generic:{delete this._firstDevice[N];const q=this._devices[N];if(q)for(let R=0;R<q.length;R++)if(q[R]){this._firstDevice[N]=R;break}break}}}}var I=R(11301);class U{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(N){this._singleClick=N}set doubleClick(N){this._doubleClick=N}set hasSwiped(N){this._hasSwiped=N}set ignore(N){this._ignore=N}}class O{constructor(N){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new y.l(0,0),this._previousStartingPointerPosition=new y.l(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=N||H.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(N){return this._meshUnderPointerId[N]||null}get unTranslatedPointer(){return new y.l(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(N){this._pointerX=N}get pointerY(){return this._pointerY}set pointerY(N){this._pointerY=N}_updatePointerPosition(N){const q=this._scene.getEngine().getInputElementClientRect();q&&(this._pointerX=N.clientX-q.left,this._pointerY=N.clientY-q.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(N,q){const R=this._scene,z=R.getEngine(),v=z.getInputElement();v&&(v.tabIndex=z.canvasTabIndex,R.doNotHandleCursors||(v.style.cursor=R.defaultCursor)),this._setCursorAndPointerOverMesh(N,q,R);for(const A of R._pointerMoveStage){var B;const R=!(null===(B=N=N||this._pickMove(q))||void 0===B||!B.pickedMesh);N=A.action(this._unTranslatedPointerX,this._unTranslatedPointerY,N,R,v)}const F=q.inputIndex>=Q.MouseWheelX&&q.inputIndex<=Q.MouseWheelZ?T.e.POINTERWHEEL:T.e.POINTERMOVE;let S;R.onPointerMove&&(N=N||this._pickMove(q),R.onPointerMove(q,N,F)),N?(S=new T.g(F,q,N),this._setRayOnPointerInfo(N,q)):(S=new T.g(F,q,null,this),this._movePointerInfo=S),R.onPointerObservable.hasObservers()&&R.onPointerObservable.notifyObservers(S,F)}_setRayOnPointerInfo(N,q){const R=this._scene;N&&I.b._IsPickingAvailable&&(N.ray||(N.ray=R.createPickingRay(q.offsetX,q.offsetY,y.d.Identity(),R.activeCamera)))}_addCameraPointerObserver(N,q){return this._cameraObserverCount++,this._scene.onPointerObservable.add(N,q)}_removeCameraPointerObserver(N){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(N)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(N,q,R){const z=this._scene,v=new T.f(R,q,this._unTranslatedPointerX,this._unTranslatedPointerY);return N&&(v.originalPickingInfo=N,v.ray=N.ray,"xr-near"===q.pointerType&&N.originMesh&&(v.nearInteractionPickingInfo=N)),z.onPrePointerObservable.notifyObservers(v,R),!!v.skipOnPointerObservable}_pickMove(N){const q=this._scene,R=q.fd(this._unTranslatedPointerX,this._unTranslatedPointerY,q.pointerMovePredicate,q.pointerMoveFastCheck,q.cameraToUseForPointers,q.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(R,N,q),R}_setCursorAndPointerOverMesh(N,q,R){const z=R.getEngine().getInputElement();if(null!==N&&void 0!==N&&N.pickedMesh){if(this.setPointerOverMesh(N.pickedMesh,q.pointerId,N,q),!R.doNotHandleCursors&&z&&this._pointerOverMesh){const N=this._pointerOverMesh._getActionManagerForTrigger();N&&N.hasPointerTriggers&&(z.style.cursor=N.hoverCursor||R.hoverCursor)}}else this.setPointerOverMesh(null,q.pointerId,N,q)}simulatePointerMove(N,q){const R=new PointerEvent("pointermove",q);R.inputIndex=Q.Move,this._checkPrePointerObservable(N,R,T.e.POINTERMOVE)||this._processPointerMove(N,R)}simulatePointerDown(N,q){const R=new PointerEvent("pointerdown",q);R.inputIndex=R.button+2,this._checkPrePointerObservable(N,R,T.e.POINTERDOWN)||this._processPointerDown(N,R)}_processPointerDown(N,q){var R;const z=this._scene;if(null!==(R=N)&&void 0!==R&&R.pickedMesh){this._pickedDownMesh=N.pickedMesh;const R=N.pickedMesh._getActionManagerForTrigger();if(R){if(R.hasPickTriggers)switch(R.processTrigger(5,e.CreateNew(N.pickedMesh,q,N)),q.button){case 0:R.processTrigger(2,e.CreateNew(N.pickedMesh,q,N));break;case 1:R.processTrigger(4,e.CreateNew(N.pickedMesh,q,N));break;case 2:R.processTrigger(3,e.CreateNew(N.pickedMesh,q,N))}R.hasSpecificTrigger(8)&&window.setTimeout((()=>{const N=z.fd(this._unTranslatedPointerX,this._unTranslatedPointerY,(N=>N.Ub&&N.isVisible&&N.isReady()&&N.actionManager&&N.actionManager.hasSpecificTrigger(8)&&N===this._pickedDownMesh),!1,z.cameraToUseForPointers);null!==N&&void 0!==N&&N.pickedMesh&&R&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>O.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,R.processTrigger(8,e.CreateNew(N.pickedMesh,q)))}),O.LongPressDelay)}}else for(const F of z._pointerDownStage)N=F.action(this._unTranslatedPointerX,this._unTranslatedPointerY,N,q,!1);let v;const B=T.e.POINTERDOWN;N?(z.onPointerDown&&z.onPointerDown(q,N,B),v=new T.g(B,q,N),this._setRayOnPointerInfo(N,q)):v=new T.g(B,q,null,this),z.onPointerObservable.hasObservers()&&z.onPointerObservable.notifyObservers(v,B)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(N,q,R){const z=new PointerEvent("pointerup",q);z.inputIndex=Q.Move;const v=new U;R?v.doubleClick=!0:v.singleClick=!0,this._checkPrePointerObservable(N,z,T.e.POINTERUP)||this._processPointerUp(N,z,v)}_processPointerUp(N,q,R){var z;const v=this._scene;if(null!==(z=N)&&void 0!==z&&z.pickedMesh){if(this._pickedUpMesh=N.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(v.onPointerPick&&v.onPointerPick(q,N),R.singleClick&&!R.ignore&&v.onPointerObservable.observers.length>this._cameraObserverCount)){const R=T.e.POINTERPICK,z=new T.g(R,q,N);this._setRayOnPointerInfo(N,q),v.onPointerObservable.notifyObservers(z,R)}const z=N.pickedMesh._getActionManagerForTrigger();if(z&&!R.ignore){z.processTrigger(7,e.CreateNew(N.pickedMesh,q,N)),!R.hasSwiped&&R.singleClick&&z.processTrigger(1,e.CreateNew(N.pickedMesh,q,N));const v=N.pickedMesh._getActionManagerForTrigger(6);R.doubleClick&&v&&v.processTrigger(6,e.CreateNew(N.pickedMesh,q,N))}}else if(!R.ignore)for(const B of v._pointerUpStage)N=B.action(this._unTranslatedPointerX,this._unTranslatedPointerY,N,q,R.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const N=this._pickedDownMesh._getActionManagerForTrigger(16);N&&N.processTrigger(16,e.CreateNew(this._pickedDownMesh,q))}if(!R.ignore){const z=new T.g(T.e.POINTERUP,q,N);if(this._setRayOnPointerInfo(N,q),v.onPointerObservable.notifyObservers(z,T.e.POINTERUP),v.onPointerUp&&v.onPointerUp(q,N,T.e.POINTERUP),!R.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let z=0;if(R.singleClick?z=T.e.POINTERTAP:R.doubleClick&&(z=T.e.POINTERDOUBLETAP),z){const R=new T.g(z,q,N);v.onPointerObservable.hasObservers()&&v.onPointerObservable.hasSpecificMask(z)&&v.onPointerObservable.notifyObservers(R,z)}}}}isPointerCaptured(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[N]}attachControl(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const v=this._scene,B=v.getEngine();z||(z=B.getInputElement()),this._alreadyAttached&&this.Si(),z&&(this._alreadyAttachedTo=z),this._deviceSourceManager=new l(B),this._initActionManager=N=>{if(!this._meshPickProceed){const q=v.skipPointerUpPicking||0===v._registeredActions&&!this._checkForPicking()&&!v.onPointerUp?null:v.fd(this._unTranslatedPointerX,this._unTranslatedPointerY,v.pointerUpPredicate,v.pointerUpFastCheck,v.cameraToUseForPointers,v.pointerUpTrianglePredicate);this._currentPickResult=q,q&&(N=q.hit&&q.pickedMesh?q.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return N},this._delayedSimpleClick=(N,q,R)=>{if((Date.now()-this._previousStartingPointerTime>O.DoubleClickDelay&&!this._doubleClickOccured||N!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,q.singleClick=!0,q.ignore=!1,this._delayedClicks[N])){const q=this._delayedClicks[N].evt,R=T.e.POINTERTAP,z=new T.g(R,q,this._currentPickResult);v.onPointerObservable.hasObservers()&&v.onPointerObservable.hasSpecificMask(R)&&v.onPointerObservable.notifyObservers(z,R),this._delayedClicks[N]=null}},this._initClickEvent=(N,q,R,z)=>{const v=new U;this._currentPickResult=null;let B=null,F=N.hasSpecificMask(T.e.POINTERPICK)||q.hasSpecificMask(T.e.POINTERPICK)||N.hasSpecificMask(T.e.POINTERTAP)||q.hasSpecificMask(T.e.POINTERTAP)||N.hasSpecificMask(T.e.POINTERDOUBLETAP)||q.hasSpecificMask(T.e.POINTERDOUBLETAP);!F&&L&&(B=this._initActionManager(B,v),B&&(F=B.hasPickTriggers));let S=!1;if(F){const F=R.button;if(v.hasSwiped=this._isPointerSwiping(),!v.hasSwiped){let E=!O.ExclusiveDoubleClickMode;if(E||(E=!N.hasSpecificMask(T.e.POINTERDOUBLETAP)&&!q.hasSpecificMask(T.e.POINTERDOUBLETAP),E&&!L.HasSpecificTrigger(6)&&(B=this._initActionManager(B,v),B&&(E=!B.hasSpecificTrigger(6)))),E)(Date.now()-this._previousStartingPointerTime>O.DoubleClickDelay||F!==this._previousButtonPressed)&&(v.singleClick=!0,z(v,this._currentPickResult),S=!0);else{const N={evt:R,clickInfo:v,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,F,v,z),O.DoubleClickDelay)};this._delayedClicks[F]=N}let t=N.hasSpecificMask(T.e.POINTERDOUBLETAP)||q.hasSpecificMask(T.e.POINTERDOUBLETAP);if(!t&&L.HasSpecificTrigger(6)&&(B=this._initActionManager(B,v),B&&(t=B.hasSpecificTrigger(6))),t)if(F===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<O.DoubleClickDelay&&!this._doubleClickOccured){if(v.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=F,O.ExclusiveDoubleClickMode){var A;if(this._delayedClicks[F])clearTimeout(null===(A=this._delayedClicks[F])||void 0===A?void 0:A.timeoutId),this._delayedClicks[F]=null;z(v,this._previousPickResult)}else z(v,this._currentPickResult);else{var y;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,v.doubleClick=!0,v.ignore=!1,O.ExclusiveDoubleClickMode&&this._delayedClicks[F])clearTimeout(null===(y=this._delayedClicks[F])||void 0===y?void 0:y.timeoutId),this._delayedClicks[F]=null;z(v,this._currentPickResult)}S=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=F}}S||z(v,this._currentPickResult)},this._onPointerMove=N=>{if(this._updatePointerPosition(N),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>O.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>O.DragMovementThreshold),B.isPointerLock&&B._verifyPointerLock(),this._checkPrePointerObservable(null,N,N.inputIndex>=Q.MouseWheelX&&N.inputIndex<=Q.MouseWheelZ?T.e.POINTERWHEEL:T.e.POINTERMOVE))return;if(!v.cameraToUseForPointers&&!v.activeCamera)return;if(v._i)return void this._processPointerMove(new x.b,N);v.pointerMovePredicate||(v.pointerMovePredicate=N=>N.Ub&&N.isVisible&&N.isReady()&&N.isEnabled()&&(N.enablePointerMoveEvents||v.constantlyUpdateMeshUnderPointer||null!==N._getActionManagerForTrigger())&&(!v.cameraToUseForPointers||0!==(v.cameraToUseForPointers.layerMask&N.layerMask)));const q=v._registeredActions>0||v.constantlyUpdateMeshUnderPointer?this._pickMove(N):null;this._processPointerMove(q,N)},this._onPointerDown=N=>{const q=this._activePointerIds.indexOf(-1);if(-1===q?this._activePointerIds.push(N.pointerId):this._activePointerIds[q]=N.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,O.ExclusiveDoubleClickMode)for(let z=0;z<this._delayedClicks.length;z++)if(this._delayedClicks[z])if(N.button===z){var R;clearTimeout(null===(R=this._delayedClicks[z])||void 0===R?void 0:R.timeoutId)}else{const N=this._delayedClicks[z].clickInfo;this._doubleClickOccured=!1,N.singleClick=!0,N.ignore=!1;const q=this._delayedClicks[z].evt,R=T.e.POINTERTAP,B=new T.g(R,q,this._currentPickResult);v.onPointerObservable.hasObservers()&&v.onPointerObservable.hasSpecificMask(R)&&v.onPointerObservable.notifyObservers(B,R),this._delayedClicks[z]=null}if(this._updatePointerPosition(N),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=N.button),v.preventDefaultOnPointerDown&&z&&(N.preventDefault(),z.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,N,T.e.POINTERDOWN))return;if(!v.cameraToUseForPointers&&!v.activeCamera)return;let B;this._pointerCaptures[N.pointerId]=!0,v.pointerDownPredicate||(v.pointerDownPredicate=N=>N.Ub&&N.isVisible&&N.isReady()&&N.isEnabled()&&(!v.cameraToUseForPointers||0!==(v.cameraToUseForPointers.layerMask&N.layerMask))),this._pickedDownMesh=null,B=v.skipPointerDownPicking||0===v._registeredActions&&!this._checkForPicking()&&!v.onPointerDown?new x.b:v.fd(this._unTranslatedPointerX,this._unTranslatedPointerY,v.pointerDownPredicate,v.pointerDownFastCheck,v.cameraToUseForPointers,v.pointerDownTrianglePredicate),this._processPointerDown(B,N)},this._onPointerUp=N=>{const q=this._activePointerIds.indexOf(N.pointerId);-1!==q&&(this._activePointerIds[q]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(N),v.preventDefaultOnPointerUp&&z&&(N.preventDefault(),z.focus()),this._initClickEvent(v.onPrePointerObservable,v.onPointerObservable,N,((q,R)=>{if(v.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!q.ignore)){if(this._checkPrePointerObservable(null,N,T.e.POINTERUP))return this._swipeButtonPressed===N.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===N.buttons&&(this._pointerCaptures[N.pointerId]=!1));q.hasSwiped||(q.singleClick&&v.onPrePointerObservable.hasSpecificMask(T.e.POINTERTAP)&&this._checkPrePointerObservable(null,N,T.e.POINTERTAP)&&(this._skipPointerTap=!0),q.doubleClick&&v.onPrePointerObservable.hasSpecificMask(T.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,N,T.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[N.pointerId]?(0===N.buttons&&(this._pointerCaptures[N.pointerId]=!1),(v.cameraToUseForPointers||v.activeCamera)&&(v.pointerUpPredicate||(v.pointerUpPredicate=N=>N.Ub&&N.isVisible&&N.isReady()&&N.isEnabled()&&(!v.cameraToUseForPointers||0!==(v.cameraToUseForPointers.layerMask&N.layerMask))),!this._meshPickProceed&&(L&&L.HasTriggers||this._checkForPicking()||v.onPointerUp)&&this._initActionManager(null,q),R||(R=this._currentPickResult),this._processPointerUp(R,N,q),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===N.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===N.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=N=>{const q=G.c.KEYDOWN;if(v.onPreKeyboardObservable.hasObservers()){const R=new G.f(q,N);if(v.onPreKeyboardObservable.notifyObservers(R,q),R.skipOnKeyboardObservable)return}if(v.onKeyboardObservable.hasObservers()){const R=new G.h(q,N);v.onKeyboardObservable.notifyObservers(R,q)}v.actionManager&&v.actionManager.processTrigger(14,e.CreateNewFromScene(v,N))},this._onKeyUp=N=>{const q=G.c.KEYUP;if(v.onPreKeyboardObservable.hasObservers()){const R=new G.f(q,N);if(v.onPreKeyboardObservable.notifyObservers(R,q),R.skipOnKeyboardObservable)return}if(v.onKeyboardObservable.hasObservers()){const R=new G.h(q,N);v.onKeyboardObservable.notifyObservers(R,q)}v.actionManager&&v.actionManager.processTrigger(15,e.CreateNewFromScene(v,N))},this._deviceSourceManager.onDeviceConnectedObservable.add((z=>{z.deviceType===X.Mouse?z.onInputChangedObservable.add((v=>{this._originMouseEvent=v,v.inputIndex===Q.LeftClick||v.inputIndex===Q.MiddleClick||v.inputIndex===Q.RightClick||v.inputIndex===Q.BrowserBack||v.inputIndex===Q.BrowserForward?q&&1===z.getInput(v.inputIndex)?this._onPointerDown(v):N&&0===z.getInput(v.inputIndex)&&this._onPointerUp(v):R&&(v.inputIndex===Q.Move?this._onPointerMove(v):v.inputIndex!==Q.MouseWheelX&&v.inputIndex!==Q.MouseWheelY&&v.inputIndex!==Q.MouseWheelZ||this._onPointerMove(v))})):z.deviceType===X.Touch?z.onInputChangedObservable.add((v=>{v.inputIndex===Q.LeftClick&&(q&&1===z.getInput(v.inputIndex)?(this._onPointerDown(v),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):N&&0===z.getInput(v.inputIndex)&&(this._onPointerUp(v),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),R&&v.inputIndex===Q.Move&&this._onPointerMove(v)})):z.deviceType===X.Keyboard&&z.onInputChangedObservable.add((N=>{"keydown"===N.type?this._onKeyDown(N):"keyup"===N.type&&this._onKeyUp(N)}))})),this._alreadyAttached=!0}Si(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[q]===N&&(!N||!N._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const v=this._meshUnderPointerId[q];let B;v&&(B=v._getActionManagerForTrigger(10),B&&B.processTrigger(10,e.CreateNew(v,z,{pointerId:q}))),N?(this._meshUnderPointerId[q]=N,this._pointerOverMesh=N,B=N._getActionManagerForTrigger(9),B&&B.processTrigger(9,e.CreateNew(N,z,{pointerId:q,pickResult:R}))):(delete this._meshUnderPointerId[q],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(N){this._pointerOverMesh===N&&(this._pointerOverMesh=null),this._pickedDownMesh===N&&(this._pickedDownMesh=null),this._pickedUpMesh===N&&(this._pickedUpMesh=null);for(const q in this._meshUnderPointerId)this._meshUnderPointerId[q]===N&&delete this._meshUnderPointerId[q]}}O.DragMovementThreshold=10,O.LongPressDelay=500,O.DoubleClickDelay=300,O.ExclusiveDoubleClickMode=!1;var i=R(11019),P=R(11213),k=R(11306),o=R(11315),C=R(10938),K=R(11318),r=R(11190);class a{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this._i=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var d,p=R(10907),W=R(11002);!function(N){N[N.BackwardCompatible=0]="BackwardCompatible",N[N.Intermediate=1]="Intermediate",N[N.Aggressive=2]="Aggressive"}(d||(d={}));class NN{static DefaultMaterialFactory(N){throw(0,Y.b)("mb")}static CollisionCoordinatorFactory(){throw(0,Y.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(N){N!==this._clearColor&&(this._clearColor=N,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(N){if(N!==this._performancePriority){switch(this._performancePriority=N,N){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this._i=!1,this.Ti=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this._i=!0,this.Ti=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this._i=!0,this.Ti=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(N)}}set forceWireframe(N){this._forceWireframe!==N&&(this._forceWireframe=N,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(N){this._skipFrustumClipping!==N&&(this._skipFrustumClipping=N)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(N){this._forcePointsCloud!==N&&(this._forcePointsCloud=N,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(N){this._environmentTexture!==N&&(this._environmentTexture=N,this.markAllMaterialsAsDirty(1))}getNodes(){let N=[];return N=N.concat(this.meshes),N=N.concat(this.lights),N=N.concat(this.cameras),N=N.concat(this.transformNodes),this.skeletons.forEach((q=>N=N.concat(q.bones))),N}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}set onDispose(N){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(N)}set beforeRender(N){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),N&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(N))}set afterRender(N){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),N&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(N))}set beforeCameraRender(N){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(N)}set afterCameraRender(N){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(N)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(N){this._pointerPickingConfiguration.pointerDownPredicate=N}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(N){this._pointerPickingConfiguration.pointerUpPredicate=N}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(N){this._pointerPickingConfiguration.pointerMovePredicate=N}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(N){this._pointerPickingConfiguration.pointerDownFastCheck=N}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(N){this._pointerPickingConfiguration.pointerUpFastCheck=N}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(N){this._pointerPickingConfiguration.pointerMoveFastCheck=N}get _i(){return this._pointerPickingConfiguration._i}set _i(N){this._pointerPickingConfiguration._i=N}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(N){this._pointerPickingConfiguration.skipPointerDownPicking=N}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(N){this._pointerPickingConfiguration.skipPointerUpPicking=N}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return O.DragMovementThreshold}static set DragMovementThreshold(N){O.DragMovementThreshold=N}static get LongPressDelay(){return O.LongPressDelay}static set LongPressDelay(N){O.LongPressDelay=N}static get DoubleClickDelay(){return O.DoubleClickDelay}static set DoubleClickDelay(N){O.DoubleClickDelay=N}static get ExclusiveDoubleClickMode(){return O.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(N){O.ExclusiveDoubleClickMode=N}bindEyePosition(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,v=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return y.k.Vector4[0].set(z.x,z.y,z.z,v?-1:1),N&&(R?N.setFloat3(q,y.k.Vector4[0].x,y.k.Vector4[0].y,y.k.Vector4[0].z):N.setVector4(q,y.k.Vector4[0])),y.k.Vector4[0]}finalizeSceneUbo(){const N=this.getSceneUniformBuffer(),q=this.bindEyePosition(null);return N.updateFloat4("vEyePosition",q.x,q.y,q.z,q.w),N.update(),N}set useRightHandedSystem(N){this._useRightHandedSystem!==N&&(this._useRightHandedSystem=N,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(N){this._currentStepId=N}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(N){this._fogEnabled!==N&&(this._fogEnabled=N,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(N){this._fogMode!==N&&(this._fogMode=N,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(N){this._shadowsEnabled!==N&&(this._shadowsEnabled=N,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(N){this._lightsEnabled!==N&&(this._lightsEnabled=N,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(N){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),N&&(this._unObserveActiveCameras=(0,r.i)(N,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=N}get activeCamera(){return this._activeCamera}set activeCamera(N){N!==this._activeCamera&&(this._activeCamera=N,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.ui||(this.ui=NN.DefaultMaterialFactory(this)),this.ui}set defaultMaterial(N){this.ui=N}set texturesEnabled(N){this._texturesEnabled!==N&&(this._texturesEnabled=N,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(N){if(this._frameGraph)return this._frameGraph=N,void(N||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=N,N&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(N){this._skeletonsEnabled!==N&&(this._skeletonsEnabled=N,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=NN.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const N of this._transientComponents)N.register();this._transientComponents.length=0}}gb(N){this._components.push(N),this._transientComponents.push(N);const q=N;q.addFromContainer&&q.serialize&&this._serializableComponents.push(q)}_getComponent(N){for(const q of this._components)if(q.name===N)return q;return null}constructor(N,q){this._inputManager=new O(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ti=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new P.g(.2,.2,.3,1),this.onClearColorChangedObservable=new B.d,this.ambientColor=new P.c(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new B.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this._j=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.jj=new B.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new B.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new B.d,this.onAfterRenderCameraObservable=new B.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new B.d,this.onAfterAnimationsObservable=new B.d,this.onBeforeDrawPhaseObservable=new B.d,this.onAfterDrawPhaseObservable=new B.d,this.onReadyObservable=new B.d,this.onBeforeCameraRenderObservable=new B.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new B.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new B.d,this.onAfterActiveMeshesEvaluationObservable=new B.d,this.onBeforeParticlesRenderingObservable=new B.d,this.onAfterParticlesRenderingObservable=new B.d,this.onDataLoadedObservable=new B.d,this.onNewCameraAddedObservable=new B.d,this.onCameraRemovedObservable=new B.d,this.onNewLightAddedObservable=new B.d,this.onLightRemovedObservable=new B.d,this.onNewGeometryAddedObservable=new B.d,this.onGeometryRemovedObservable=new B.d,this.onNewTransformNodeAddedObservable=new B.d,this.onTransformNodeRemovedObservable=new B.d,this.onNewMeshAddedObservable=new B.d,this.onMeshRemovedObservable=new B.d,this.onNewSkeletonAddedObservable=new B.d,this.onSkeletonRemovedObservable=new B.d,this.onNewMaterialAddedObservable=new B.d,this.onNewMultiMaterialAddedObservable=new B.d,this.onMaterialRemovedObservable=new B.d,this.onMultiMaterialRemovedObservable=new B.d,this.onNewTextureAddedObservable=new B.d,this.onTextureRemovedObservable=new B.d,this.onBeforeRenderTargetsRenderObservable=new B.d,this.onAfterRenderTargetsRenderObservable=new B.d,this.onBeforeStepObservable=new B.d,this.onAfterStepObservable=new B.d,this.onActiveCameraChanged=new B.d,this.onActiveCamerasChanged=new B.d,this.onBeforeRenderingGroupObservable=new B.d,this.onAfterRenderingGroupObservable=new B.d,this.onMeshImportedObservable=new B.d,this.onAnimationFileImportedObservable=new B.d,this._registeredForLateAnimationBindings=new F.e(256),this._pointerPickingConfiguration=new a,this.onPrePointerObservable=new B.d,this.onPointerObservable=new B.d,this.onPreKeyboardObservable=new B.d,this.onKeyboardObservable=new B.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=NN.FOGMODE_NONE,this.fogColor=new P.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new y.m(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new F.e(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new i.c,this._activeIndices=new i.c,this._activeParticles=new i.c,this._activeBones=new i.c,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new F.h(256),this._processedMaterials=new F.h(256),this._renderTargets=new F.e(256),this._materialsRenderTargets=new F.e(256),this._activeParticleSystems=new F.h(256),this._activeSkeletons=new F.e(32),this._softwareSkinnedMeshes=new F.e(32),this._activeAnimatables=new Array,this._transformMatrix=y.d.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=D.g.Create(),this._beforeClearStage=D.g.Create(),this._beforeRenderTargetClearStage=D.g.Create(),this._gatherRenderTargetsStage=D.g.Create(),this._gatherActiveCameraRenderTargetsStage=D.g.Create(),this._isReadyForMeshStage=D.g.Create(),this._beforeEvaluateActiveMeshStage=D.g.Create(),this._evaluateSubMeshStage=D.g.Create(),this._preActiveMeshStage=D.g.Create(),this._cameraDrawRenderTargetStage=D.g.Create(),this._beforeCameraDrawStage=D.g.Create(),this._beforeRenderTargetDrawStage=D.g.Create(),this._beforeRenderingGroupDrawStage=D.g.Create(),this._beforeRenderingMeshStage=D.g.Create(),this._afterRenderingMeshStage=D.g.Create(),this._afterRenderingGroupDrawStage=D.g.Create(),this._afterCameraDrawStage=D.g.Create(),this._afterCameraPostProcessStage=D.g.Create(),this._afterRenderTargetDrawStage=D.g.Create(),this._afterRenderTargetPostProcessStage=D.g.Create(),this._afterRenderStage=D.g.Create(),this._pointerMoveStage=D.g.Create(),this._pointerDownStage=D.g.Create(),this._pointerUpStage=D.g.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const R={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...q};N=this._engine=N||H.b.LastCreatedEngine,R.virtual?N._virtualScenes.push(this):(H.b._LastCreatedScene=this,N.scenes.push(this)),this._uid=null,this._renderingManager=new f.d(this),b.e&&(this.postProcessManager=new b.e(this)),(0,V.l)()&&this.attachControl(),this._createUbo(),E.c&&(this._imageProcessingConfiguration=new E.c),this.setDefaultCandidateProviders(),R.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=R.useMaterialMeshMap,this.useClonedMeshMap=R.useClonedMeshMap,q&&q.virtual||N.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(N){return this._defaultSubMeshCandidates.data=N.lg,this._defaultSubMeshCandidates.length=N.lg.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=N=>this._getDefaultSubMeshCandidates(N),this.getIntersectingSubMeshCandidates=(N,q)=>this._getDefaultSubMeshCandidates(N),this.getCollidingSubMeshCandidates=(N,q)=>this._getDefaultSubMeshCandidates(N)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(N){this._inputManager.pointerX=N}get pointerY(){return this._inputManager.pointerY}set pointerY(N){this._inputManager.pointerY=N}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==q||this._cachedMaterial!==N||this._cachedVisibility!==R}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(N,q){return this._inputManager.simulatePointerMove(N,q),this}simulatePointerDown(N,q){return this._inputManager.simulatePointerDown(N,q),this}simulatePointerUp(N,q,R){return this._inputManager.simulatePointerUp(N,q,R),this}isPointerCaptured(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(N)}attachControl(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(N,q,R)}Si(){this._inputManager.Si()}isReady(){var N,q;let R,z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const v=this.getEngine(),B=v.currentRenderPassId;v.currentRenderPassId=(null===(N=this.activeCamera)||void 0===N?void 0:N.renderPassId)??B;let F=!0;for(this._pendingData.length>0&&(F=!1),null===(q=this.prePassRenderer)||void 0===q||q.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&F&&(F=this.depthPeelingRenderer.isReady()),z&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),R=0;R<this.meshes.length;R++){const N=this.meshes[R];if(!N.lg||0===N.lg.length)continue;if(!N.isReady(!0)){F=!1;continue}const q=N.hasThinInstances||"InstancedMesh"===N.getClassName()||"InstancedLinesMesh"===N.getClassName()||v.getCaps().instancedArrays&&N.instances.length>0;for(const R of this._isReadyForMeshStage)R.action(N,q)||(F=!1);if(!z)continue;const B=N.material||this.defaultMaterial;if(B)if(B._storeEffectOnSubMeshes)for(const R of N.lg){const N=R.Ha();N&&N.hasRenderTargetTextures&&null!=N.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(N)&&(this._processedMaterials.push(N),this._materialsRenderTargets.concatWithNoDuplicate(N.getRenderTargetTextures()))}else B.hasRenderTargetTextures&&null!=B.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(B)&&(this._processedMaterials.push(B),this._materialsRenderTargets.concatWithNoDuplicate(B.getRenderTargetTextures()))}if(z)for(R=0;R<this._materialsRenderTargets.length;++R){this._materialsRenderTargets.data[R].isReadyForRendering()||(F=!1)}for(R=0;R<this.geometries.length;R++){2===this.geometries[R].delayLoadState&&(F=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const S of this.activeCameras)S.isReady(!0)||(F=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(F=!1));for(const S of this.qj)S.isReady()||(F=!1);if(this.layers)for(const S of this.layers)S.isReady()||(F=!1);return v.areAllEffectsReady()||(F=!1),v.currentRenderPassId=B,F}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(N){this.onBeforeRenderObservable.add(N)}unregisterBeforeRender(N){this.onBeforeRenderObservable.removeCallback(N)}registerAfterRender(N){this.onAfterRenderObservable.add(N)}unregisterAfterRender(N){this.onAfterRenderObservable.removeCallback(N)}_executeOnceBeforeRender(N){const q=()=>{N(),setTimeout((()=>{this.unregisterBeforeRender(q)}))};this.registerBeforeRender(q)}executeOnceBeforeRender(N,q){void 0!==q?setTimeout((()=>{this._executeOnceBeforeRender(N)}),q):this._executeOnceBeforeRender(N)}addPendingData(N){this._pendingData.push(N)}removePendingData(N){const q=this.isLoading,R=this._pendingData.indexOf(N);-1!==R&&this._pendingData.splice(R,1),q&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(N),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(q)}whenReadyAsync(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((q=>{this.executeWhenReady((()=>{q()}),N)}))}_checkIsReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(N)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(N)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=v.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(N,q,R,z){R||z||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===N.updateFlag&&this._projectionUpdateFlag===q.updateFlag||(this._viewUpdateFlag=N.updateFlag,this._projectionUpdateFlag=q.updateFlag,this._viewMatrix=N,this._projectionMatrix=q,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?k.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=k.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(R,z):this._sceneUbo.useUbo&&(this._sceneUbo.Hj("viewProjection",this._transformMatrix),this._sceneUbo.Hj("view",this._viewMatrix),this._sceneUbo.Hj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(N){const q=new t.b(this._engine,void 0,!1,N??"Xd");return q.addUniform("viewProjection",16),q.addUniform("view",16),q.addUniform("projection",16),q.addUniform("vEyePosition",4),q}setSceneUniformBuffer(N){this._sceneUbo=N,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return o.d.UniqueId}li(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(N),N._resyncLightSources(),N.parent||N._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(N),q&&N.getChildMeshes().forEach((N=>{this.li(N)})))}Ud(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=this.meshes.indexOf(N);return-1!==R&&(this.meshes.splice(R,1),N.parent||N._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(N),this.onMeshRemovedObservable.notifyObservers(N),q&&N.getChildMeshes().forEach((N=>{this.Ud(N)})),R}addTransformNode(N){this._blockEntityCollection||N.va()===this&&-1!==N._indexInSceneTransformNodesArray||(N._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(N),N.parent||N._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(N))}removeTransformNode(N){const q=N._indexInSceneTransformNodesArray;if(-1!==q){if(q!==this.transformNodes.length-1){const N=this.transformNodes[this.transformNodes.length-1];this.transformNodes[q]=N,N._indexInSceneTransformNodesArray=q}N._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),N.parent||N._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(N),q}removeSkeleton(N){const q=this.skeletons.indexOf(N);return-1!==q&&(this.skeletons.splice(q,1),this.onSkeletonRemovedObservable.notifyObservers(N),this._executeActiveContainerCleanup(this._activeSkeletons)),q}removeMorphTargetManager(N){const q=this.morphTargetManagers.indexOf(N);return-1!==q&&this.morphTargetManagers.splice(q,1),q}removeLight(N){const q=this.lights.indexOf(N);if(-1!==q){for(const q of this.meshes)q._removeLightSource(N,!1);this.lights.splice(q,1),this.sortLightsByPriority(),N.parent||N._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(N),q}removeCamera(N){const q=this.cameras.indexOf(N);if(-1!==q&&(this.cameras.splice(q,1),N.parent||N._removeFromSceneRootNodes()),this.activeCameras){const q=this.activeCameras.indexOf(N);-1!==q&&this.activeCameras.splice(q,1)}return this.activeCamera===N&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(N),q}removeParticleSystem(N){const q=this.qj.indexOf(N);return-1!==q&&(this.qj.splice(q,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),q}removeAnimation(N){const q=this.animations.indexOf(N);return-1!==q&&this.animations.splice(q,1),q}stopAnimation(N,q,R){}removeAnimationGroup(N){const q=this.animationGroups.indexOf(N);return-1!==q&&this.animationGroups.splice(q,1),q}removeMultiMaterial(N){const q=this.multiMaterials.indexOf(N);return-1!==q&&this.multiMaterials.splice(q,1),this.onMultiMaterialRemovedObservable.notifyObservers(N),q}removeMaterial(N){const q=N._indexInSceneMaterialArray;if(-1!==q&&q<this.materials.length){if(q!==this.materials.length-1){const N=this.materials[this.materials.length-1];this.materials[q]=N,N._indexInSceneMaterialArray=q}N._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(N),q}removeActionManager(N){const q=this.actionManagers.indexOf(N);return-1!==q&&this.actionManagers.splice(q,1),q}removeTexture(N){const q=this.textures.indexOf(N);return-1!==q&&this.textures.splice(q,1),this.onTextureRemovedObservable.notifyObservers(N),q}addLight(N){if(!this._blockEntityCollection){this.lights.push(N),this.sortLightsByPriority(),N.parent||N._addToSceneRootNodes();for(const q of this.meshes)-1===q.lightSources.indexOf(N)&&(q.lightSources.push(N),q._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(N)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(K.d.CompareLightsPriority)}addCamera(N){this._blockEntityCollection||(this.cameras.push(N),this.onNewCameraAddedObservable.notifyObservers(N),N.parent||N._addToSceneRootNodes())}addSkeleton(N){this._blockEntityCollection||(this.skeletons.push(N),this.onNewSkeletonAddedObservable.notifyObservers(N))}addParticleSystem(N){this._blockEntityCollection||this.qj.push(N)}addAnimation(N){this._blockEntityCollection||this.animations.push(N)}addAnimationGroup(N){this._blockEntityCollection||this.animationGroups.push(N)}addMultiMaterial(N){this._blockEntityCollection||(this.multiMaterials.push(N),this.onNewMultiMaterialAddedObservable.notifyObservers(N))}addMaterial(N){this._blockEntityCollection||N.va()===this&&-1!==N._indexInSceneMaterialArray||(N._indexInSceneMaterialArray=this.materials.length,this.materials.push(N),this.onNewMaterialAddedObservable.notifyObservers(N))}addMorphTargetManager(N){this._blockEntityCollection||this.morphTargetManagers.push(N)}addGeometry(N){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[N.uniqueId]=this.geometries.length),this.geometries.push(N))}addActionManager(N){this.actionManagers.push(N)}addTexture(N){this._blockEntityCollection||(this.textures.push(N),this.onNewTextureAddedObservable.notifyObservers(N))}switchActiveCamera(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Si(),this.activeCamera=N,q&&N.attachControl())}setActiveCameraById(N){const q=this.getCameraById(N);return q?(this.activeCamera=q,q):null}setActiveCameraByName(N){const q=this.getCameraByName(N);return q?(this.activeCamera=q,q):null}getAnimationGroupByName(N){for(let q=0;q<this.animationGroups.length;q++)if(this.animationGroups[q].name===N)return this.animationGroups[q];return null}_getMaterial(N,q){for(let R=0;R<this.materials.length;R++){const N=this.materials[R];if(q(N))return N}if(N)for(let R=0;R<this.multiMaterials.length;R++){const N=this.multiMaterials[R];if(q(N))return N}return null}getMaterialByUniqueID(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(q,(q=>q.uniqueId===N))}getMaterialById(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(q,(q=>q.id===N))}getMaterialByName(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(q,(q=>q.name===N))}getLastMaterialById(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let R=this.materials.length-1;R>=0;R--)if(this.materials[R].id===N)return this.materials[R];if(q)for(let R=this.multiMaterials.length-1;R>=0;R--)if(this.multiMaterials[R].id===N)return this.multiMaterials[R];return null}getTextureByUniqueId(N){for(let q=0;q<this.textures.length;q++)if(this.textures[q].uniqueId===N)return this.textures[q];return null}getTextureByName(N){for(let q=0;q<this.textures.length;q++)if(this.textures[q].name===N)return this.textures[q];return null}getCameraById(N){for(let q=0;q<this.cameras.length;q++)if(this.cameras[q].id===N)return this.cameras[q];return null}getCameraByUniqueId(N){for(let q=0;q<this.cameras.length;q++)if(this.cameras[q].uniqueId===N)return this.cameras[q];return null}getCameraByName(N){for(let q=0;q<this.cameras.length;q++)if(this.cameras[q].name===N)return this.cameras[q];return null}getBoneById(N){for(let q=0;q<this.skeletons.length;q++){const R=this.skeletons[q];for(let q=0;q<R.bones.length;q++)if(R.bones[q].id===N)return R.bones[q]}return null}getBoneByName(N){for(let q=0;q<this.skeletons.length;q++){const R=this.skeletons[q];for(let q=0;q<R.bones.length;q++)if(R.bones[q].name===N)return R.bones[q]}return null}getLightByName(N){for(let q=0;q<this.lights.length;q++)if(this.lights[q].name===N)return this.lights[q];return null}getLightById(N){for(let q=0;q<this.lights.length;q++)if(this.lights[q].id===N)return this.lights[q];return null}getLightByUniqueId(N){for(let q=0;q<this.lights.length;q++)if(this.lights[q].uniqueId===N)return this.lights[q];return null}getParticleSystemById(N){for(let q=0;q<this.qj.length;q++)if(this.qj[q].id===N)return this.qj[q];return null}getGeometryById(N){for(let q=0;q<this.geometries.length;q++)if(this.geometries[q].id===N)return this.geometries[q];return null}_getGeometryByUniqueId(N){if(this._geometriesByUniqueId){const q=this._geometriesByUniqueId[N];if(void 0!==q)return this.geometries[q]}else for(let q=0;q<this.geometries.length;q++)if(this.geometries[q].uniqueId===N)return this.geometries[q];return null}pushGeometry(N,q){return!(!q&&this._getGeometryByUniqueId(N.uniqueId))&&(this.addGeometry(N),this.onNewGeometryAddedObservable.notifyObservers(N),!0)}removeGeometry(N){let q;if(this._geometriesByUniqueId){if(q=this._geometriesByUniqueId[N.uniqueId],void 0===q)return!1}else if(q=this.geometries.indexOf(N),q<0)return!1;if(q!==this.geometries.length-1){const N=this.geometries[this.geometries.length-1];N&&(this.geometries[q]=N,this._geometriesByUniqueId&&(this._geometriesByUniqueId[N.uniqueId]=q))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[N.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(N),!0}getGeometries(){return this.geometries}getMeshById(N){for(let q=0;q<this.meshes.length;q++)if(this.meshes[q].id===N)return this.meshes[q];return null}getMeshesById(N){return this.meshes.filter((function(q){return q.id===N}))}getTransformNodeById(N){for(let q=0;q<this.transformNodes.length;q++)if(this.transformNodes[q].id===N)return this.transformNodes[q];return null}getTransformNodeByUniqueId(N){for(let q=0;q<this.transformNodes.length;q++)if(this.transformNodes[q].uniqueId===N)return this.transformNodes[q];return null}getTransformNodesById(N){return this.transformNodes.filter((function(q){return q.id===N}))}getMeshByUniqueId(N){for(let q=0;q<this.meshes.length;q++)if(this.meshes[q].uniqueId===N)return this.meshes[q];return null}getLastMeshById(N){for(let q=this.meshes.length-1;q>=0;q--)if(this.meshes[q].id===N)return this.meshes[q];return null}getLastTransformNodeById(N){for(let q=this.transformNodes.length-1;q>=0;q--)if(this.transformNodes[q].id===N)return this.transformNodes[q];return null}getLastEntryById(N){let q;for(q=this.meshes.length-1;q>=0;q--)if(this.meshes[q].id===N)return this.meshes[q];for(q=this.transformNodes.length-1;q>=0;q--)if(this.transformNodes[q].id===N)return this.transformNodes[q];for(q=this.cameras.length-1;q>=0;q--)if(this.cameras[q].id===N)return this.cameras[q];for(q=this.lights.length-1;q>=0;q--)if(this.lights[q].id===N)return this.lights[q];return null}getNodeById(N){const q=this.getMeshById(N);if(q)return q;const R=this.getTransformNodeById(N);if(R)return R;const z=this.getLightById(N);if(z)return z;const v=this.getCameraById(N);if(v)return v;const B=this.getBoneById(N);return B||null}getNodeByName(N){const q=this.getMeshByName(N);if(q)return q;const R=this.getTransformNodeByName(N);if(R)return R;const z=this.getLightByName(N);if(z)return z;const v=this.getCameraByName(N);if(v)return v;const B=this.getBoneByName(N);return B||null}getMeshByName(N){for(let q=0;q<this.meshes.length;q++)if(this.meshes[q].name===N)return this.meshes[q];return null}getTransformNodeByName(N){for(let q=0;q<this.transformNodes.length;q++)if(this.transformNodes[q].name===N)return this.transformNodes[q];return null}getLastSkeletonById(N){for(let q=this.skeletons.length-1;q>=0;q--)if(this.skeletons[q].id===N)return this.skeletons[q];return null}getSkeletonByUniqueId(N){for(let q=0;q<this.skeletons.length;q++)if(this.skeletons[q].uniqueId===N)return this.skeletons[q];return null}getSkeletonById(N){for(let q=0;q<this.skeletons.length;q++)if(this.skeletons[q].id===N)return this.skeletons[q];return null}getSkeletonByName(N){for(let q=0;q<this.skeletons.length;q++)if(this.skeletons[q].name===N)return this.skeletons[q];return null}getMorphTargetManagerById(N){for(let q=0;q<this.morphTargetManagers.length;q++)if(this.morphTargetManagers[q].uniqueId===N)return this.morphTargetManagers[q];return null}getMorphTargetById(N){for(let q=0;q<this.morphTargetManagers.length;++q){const R=this.morphTargetManagers[q];for(let q=0;q<R.numTargets;++q){const z=R.getTarget(q);if(z.id===N)return z}}return null}getMorphTargetByName(N){for(let q=0;q<this.morphTargetManagers.length;++q){const R=this.morphTargetManagers[q];for(let q=0;q<R.numTargets;++q){const z=R.getTarget(q);if(z.name===N)return z}}return null}getPostProcessByName(N){for(let q=0;q<this.postProcesses.length;++q){const R=this.postProcesses[q];if(R.name===N)return R}return null}isActiveMesh(N){return-1!==this._activeMeshes.indexOf(N)}get uid(){return this._uid||(this._uid=z.f.RandomId()),this._uid}addExternalData(N,q){return this._externalData||(this._externalData=new S),this._externalData.add(N,q)}getExternalData(N){return this._externalData?this._externalData.get(N):null}getOrAddExternalDataWithFactory(N,q){return this._externalData||(this._externalData=new S),this._externalData.getOrAddWithFactory(N,q)}removeExternalData(N){return this._externalData.remove(N)}_evaluateSubMesh(N,q,R,z){if(z||N.isInFrustum(this._frustumPlanes)){for(const z of this._evaluateSubMeshStage)z.action(q,N);const R=N.Ha();null!==R&&void 0!==R&&(R.hasRenderTargetTextures&&null!=R.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(R)&&(this._processedMaterials.push(R),this._materialsRenderTargets.concatWithNoDuplicate(R.getRenderTargetTextures())),this._renderingManager.dispatch(N,q,R))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(N){this._preventFreeActiveMeshesAndRenderingGroups!==N&&(N&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=N)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let N=0;N<this.activeCameras.length;N++){const q=this.activeCameras[N];q&&q._activeMeshes&&q._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let N=0;N<this.textures.length;N++){const q=this.textures[N];q&&q.renderList&&q.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=v,this._skipEvaluateActiveMeshesCompletely=N,z)for(let N=0;N<this._activeMeshes.length;N++)this._activeMeshes.data[N]._freeze();q&&q()}else R&&R("No active camera found")})),this}unfreezeActiveMeshes(){for(let N=0;N<this.meshes.length;N++){const q=this.meshes[N];q._internalAbstractMeshDataInfo&&(q._internalAbstractMeshDataInfo._isActive=!1)}for(let N=0;N<this._activeMeshes.length;N++)this._activeMeshes.data[N]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(N){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>N.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var N;if(this._activeMeshes.length>0)null===(N=this.activeCamera)||void 0===N||N._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const N=this._activeMeshes.length;for(let q=0;q<N;q++){this._activeMeshes.data[q].Oj()}}if(this._activeParticleSystems){const N=this._activeParticleSystems.length;for(let q=0;q<N;q++)this._activeParticleSystems.data[q].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const z of this._beforeEvaluateActiveMeshStage)z.action();const q=this.getActiveMeshCandidates(),R=q.length;for(let z=0;z<R;z++){const N=q.data[z];if(N._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,N.isBlocked)continue;if(this._totalVertices.addCount(N.getTotalVertices(),!1),!N.isReady()||!N.isEnabled()||N.re.hasAZeroComponent)continue;N.Oj(),N.actionManager&&N.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(N);let R=this.customLODSelector?this.customLODSelector(N,this.activeCamera):N.getLOD(this.activeCamera);if(N._internalAbstractMeshDataInfo._currentLOD=R,N._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==R&&null!==R&&(R!==N&&0!==R.billboardMode&&R.Oj(),N._preActivate(),N.isVisible&&N.visibility>0&&0!==(N.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||N.Sb||N.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(N),this.activeCamera._activeMeshes.push(N),R!==N&&R._activate(this._renderId,!1);for(const q of this._preActiveMeshStage)q.action(N);N._activate(this._renderId,!1)&&(N.isAnInstance?N._internalAbstractMeshDataInfo._actAsRegularMesh&&(R=N):R._internalAbstractMeshDataInfo._onlyForInstances=!1,R._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(N,R)),N._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let N=0;N<this.qj.length;N++){const q=this.qj[N];if(!q.isStarted()||!q.j)continue;const R=q.j;R.position&&!R.isEnabled()||(this._activeParticleSystems.push(q),q.animate(),this._renderingManager.dispatchParticles(q))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(N){this._skeletonsEnabled&&N.skeleton&&(this._activeSkeletons.pushNoDuplicate(N.skeleton)&&(N.skeleton.prepare(),this._activeBones.addCount(N.skeleton.bones.length,!1)),N.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(N)&&this.frameGraph&&N.applySkeleton(N.skeleton))}_activeMesh(N,q){this._prepareSkeleton(q);let R=N.hasInstances||N.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||q.Sb;if(q&&q.lg&&q.lg.length>0){const z=this.getActiveSubMeshCandidates(q),v=z.length;R=R||1===v;for(let B=0;B<v;B++){const v=z.data[B];this._evaluateSubMesh(v,q,N,R)}}}updateTransformMatrix(N){const q=this.activeCamera;if(q)if(q._renderingMultiview){const R=q._rigCameras[0],z=q._rigCameras[1];this.setTransformMatrix(R.getViewMatrix(),R.getProjectionMatrix(N),z.getViewMatrix(),z.getProjectionMatrix(N))}else this.setTransformMatrix(q.getViewMatrix(),q.getProjectionMatrix(N))}_bindFrameBuffer(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];N&&N._multiviewTexture?N._multiviewTexture._bindFrameBuffer():N&&N.outputRenderTarget?N.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),q&&this._clearFrameBuffer(N)}_clearFrameBuffer(N){if(N&&N._multiviewTexture);else if(N&&N.outputRenderTarget&&!N._renderingMultiview){const q=N.outputRenderTarget;q.onClearObservable.hasObservers()?q.onClearObservable.notifyObservers(this._engine):q.skipInitialClear||N.isRightCamera||(this.Ti&&this._engine.clear(q.clearColor||this._clearColor,!q._cleared,!0,!0),q._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(N,q){var R;let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(N&&N._skipRendering)return;const B=this._engine;if(this._activeCamera=N,!this.activeCamera)throw new Error("Active camera not set");if(B.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&v){let q=!0;N._renderingMultiview&&N.outputRenderTarget&&(q=N.outputRenderTarget.skipInitialClear,this.Ti&&(this._defaultFrameBufferCleared=!1,N.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),N._renderingMultiview&&N.outputRenderTarget&&(N.outputRenderTarget.skipInitialClear=q)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let z=0;z<this._softwareSkinnedMeshes.length;z++){const N=this._softwareSkinnedMeshes.data[z];N.applySkeleton(N.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),N.customRenderTargets&&N.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(N.customRenderTargets),q&&q.customRenderTargets&&q.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(q.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const z of this._gatherActiveCameraRenderTargetsStage)z.action(this._renderTargets);let F=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){z.f.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let N=0;N<this._renderTargets.length;N++){const q=this._renderTargets.data[N];if(q._shouldRender()){this._renderId++;const N=q.activeCamera&&q.activeCamera!==this.activeCamera;q.render(N,this.dumpNextRenderTargets),F=!0}}z.f.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const N of this._cameraDrawRenderTargetStage)F=N.action(this.activeCamera)||F;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(R=N.outputRenderTarget)||void 0===R?void 0:R.renderPassId)??N.renderPassId??0,F&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||N._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const z of this._beforeCameraDrawStage)z.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),B.snapshotRendering&&1===B.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const z of this._afterCameraDrawStage)z.action(this.activeCamera);if(this.postProcessManager&&!N._multiviewTexture){const q=N.outputRenderTarget?N.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(N.isIntermediate,q)}for(const z of this._afterCameraPostProcessStage)z.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===N.cameraRigMode||N._renderingMultiview)return N._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(N,void 0,q),void this.onAfterRenderCameraObservable.notifyObservers(N);if(N._useMultiviewToSingleView)this._renderMultiviewToSingleView(N);else{this.onBeforeCameraRenderObservable.notifyObservers(N);for(let q=0;q<N._rigCameras.length;q++)this._renderForCamera(N._rigCameras[q],N)}this._activeCamera=N,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(N)}_checkIntersections(){for(let N=0;N<this._meshesForIntersections.length;N++){const q=this._meshesForIntersections.data[N];if(q.actionManager)for(let N=0;q.actionManager&&N<q.actionManager.actions.length;N++){const R=q.actionManager.actions[N];if(12===R.trigger||13===R.trigger){const N=R.getTriggerParameter(),z=N.mesh?N.mesh:N,v=z.intersectsMesh(q,N.usePreciseIntersection),B=q._intersectionsInProgress.indexOf(z);v&&-1===B?12===R.trigger?(R._executeCurrent(e.CreateNew(q,void 0,z)),q._intersectionsInProgress.push(z)):13===R.trigger&&q._intersectionsInProgress.push(z):!v&&B>-1&&(13===R.trigger&&R._executeCurrent(e.CreateNew(q,void 0,z)),q.actionManager.hasSpecificTrigger(13,(N=>{const q=N.mesh?N.mesh:N;return z===q}))&&13!==R.trigger||q._intersectionsInProgress.splice(B,1))}}}}_advancePhysicsEngineStep(N){}_animate(N){}animate(){if(this._engine.isDeterministicLockStep()){let N=Math.max(NN.MinDeltaTime,Math.min(this._engine.getDeltaTime(),NN.MaxDeltaTime))+this._timeAccumulator;const q=this._engine.getTimeStep(),R=1e3/q/1e3;let z=0;const v=this._engine.getLockstepMaxSteps();let B=Math.floor(N/q);for(B=Math.min(B,v);N>0&&z<B;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=q*R,this._animate(q),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(q),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,z++,N-=q;this._timeAccumulator=N<0?0:N}else{const N=this.useConstantAnimationDeltaTime?16:Math.max(NN.MinDeltaTime,Math.min(this._engine.getDeltaTime(),NN.MaxDeltaTime));this._animationRatio=.06*N,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(N)}}_clear(){(this.autoClearDepthAndStencil||this.Ti)&&this._engine.clear(this._clearColor,this.Ti||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(N){var q;if(null===N||void 0===N||!N.outputRenderTarget||null!==N&&void 0!==N&&N.isRigCamera||(N.outputRenderTarget._cleared=!1),null!==N&&void 0!==N&&null!==(q=N.rigCameras)&&void 0!==q&&q.length)for(let R=0;R<N.rigCameras.length;++R){const q=N.rigCameras[R].outputRenderTarget;q&&(q._cleared=!1)}}resetDrawCache(N){if(this.meshes)for(const q of this.meshes)q.resetDrawCache(N)}_renderWithFrameGraph(){var N;let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),q)for(const v of this.cameras)if(v.update(),0!==v.cameraRigMode)for(let N=0;N<v._rigCameras.length;N++)v._rigCameras[N].update();for(const v of this._beforeClearStage)v.action();const R=this.getActiveMeshCandidates(),z=R.length;for(let v=0;v<z;v++){const N=R.data[v];N.isBlocked||(this._totalVertices.addCount(N.getTotalVertices(),!1),N.isReady()&&N.isEnabled()&&!N.re.hasAZeroComponent&&(N.Oj(),N.actionManager&&N.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(N)))}if(this.particlesEnabled)for(let v=0;v<this.qj.length;v++){const N=this.qj[v];if(!N.isStarted()||!N.j)continue;const q=N.j;q.position&&!q.isEnabled()||(this._activeParticleSystems.push(N),N.animate())}null===(N=this.frameGraph)||void 0===N||N.execute()}render(){var N;let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(N=this.activeCameras)&&void 0!==N&&N.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),R||this.animate();for(const N of this._beforeCameraUpdateStage)N.action();if(q)if(this.activeCameras&&this.activeCameras.length>0)for(let N=0;N<this.activeCameras.length;N++){const q=this.activeCameras[N];if(q.update(),0!==q.cameraRigMode)for(let N=0;N<q._rigCameras.length;N++)q._rigCameras[N].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let N=0;N<this.activeCamera._rigCameras.length;N++)this.activeCamera._rigCameras[N].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(q,R);else{var v;const N=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const q=null!==(v=this.activeCameras)&&void 0!==v&&v.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){z.f.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let R=0;R<this.customRenderTargets.length;R++){const z=this.customRenderTargets[R];if(z._shouldRender()){if(this._renderId++,this.activeCamera=z.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");N.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),z.render(q!==this.activeCamera,this.dumpNextRenderTargets)}}z.f.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===q||void 0===q?void 0:q.renderPassId)??0,this.activeCamera=q,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const R of this._beforeClearStage)R.action();this._clearFrameBuffer(this.activeCamera);for(const R of this._gatherRenderTargetsStage)R.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let R=0;R<this.activeCameras.length;R++)this._processSubCameras(this.activeCameras[R],R>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const N of this._afterRenderStage)N.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let N=0;N<this._toBeDisposed.length;N++){const q=this._toBeDisposed[N];q&&q.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let N=0;N<this.materials.length;N++)this.materials[N].freeze()}unfreezeMaterials(){for(let N=0;N<this.materials.length;N++)this.materials[N].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((N=>{N.onAnimationEndObservable.clear(),N.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const N=this._activeRequests.slice();for(const v of N)v.abort();this._activeRequests.length=0;try{this.jj.notifyObservers(this)}catch(z){p.c.Error("An error occurred while calling onDisposeObservable!",z)}this.Si();if(this._engine.getInputElement())for(let v=0;v<this.cameras.length;v++)this.cameras[v].Si();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(N=>N.dispose(!0))),this._disposeList(this.transformNodes,(N=>N.dispose(!0)));const q=this.cameras;this._disposeList(q),this.ui&&this.ui.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.qj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let R=this._engine.scenes.indexOf(this);R>-1&&this._engine.scenes.splice(R,1),H.b._LastCreatedScene===this&&(this._engine.scenes.length>0?H.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:H.b._LastCreatedScene=null),R=this._engine._virtualScenes.indexOf(this),R>-1&&this._engine._virtualScenes.splice(R,1),this._engine.wipeCaches(!0),this.jj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(N,q){const R=N.slice(0);q=q??(N=>N.dispose());for(const z of R)q(z);N.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let N=0;N<this.meshes.length;N++){const q=this.meshes[N].Dj;q&&q.clearCachedData()}}cleanCachedTextureBuffer(){for(const N of this.textures){N._buffer&&(N._buffer=null)}}getWorldExtends(N){const q=new y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R=new y.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return N=N||(()=>!0),this.meshes.filter(N).forEach((N=>{if(N.Oj(!0),!N.lg||0===N.lg.length||N.infiniteDistance)return;const z=N.getBoundingInfo(),v=z.boundingBox.minimumWorld,B=z.boundingBox.maximumWorld;y.m.CheckExtends(v,q,R),y.m.CheckExtends(B,q,R)})),{min:q,max:R}}createPickingRay(N,q,R,z){throw(0,Y.b)("Ray")}createPickingRayToRef(N,q,R,z,v){throw(0,Y.b)("Ray")}createPickingRayInCameraSpace(N,q,R){throw(0,Y.b)("Ray")}createPickingRayInCameraSpaceToRef(N,q,R,z){throw(0,Y.b)("Ray")}fd(N,q,R,z,v,B){const F=(0,Y.b)("Ray",!0);return F&&p.c.Warn(F),new x.b}pickWithBoundingInfo(N,q,R,z,v){const B=(0,Y.b)("Ray",!0);return B&&p.c.Warn(B),new x.b}pickWithRay(N,q,R,z){throw(0,Y.b)("Ray")}multiPick(N,q,R,z,v){throw(0,Y.b)("Ray")}multiPickWithRay(N,q,R){throw(0,Y.b)("Ray")}setPointerOverMesh(N,q,R){this._inputManager.setPointerOverMesh(N,q,R)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const N of this.geometries)N._rebuild();for(const N of this.meshes)N._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const N of this._components)N.rebuild();for(const N of this.qj)N.rebuild();if(this.spriteManagers)for(const N of this.spriteManagers)N.rebuild()}_rebuildTextures(){for(const N of this.textures)N._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(N,q,R){if(void 0===q)return N;const z=[];for(const v in N){const B=N[v];A.b&&A.b.MatchesQuery(B,q)&&(!R||R(B))&&z.push(B)}return z}getMeshesByTags(N,q){return this._getByTags(this.meshes,N,q)}getCamerasByTags(N,q){return this._getByTags(this.cameras,N,q)}getLightsByTags(N,q){return this._getByTags(this.lights,N,q)}getMaterialByTags(N,q){return this._getByTags(this.materials,N,q).concat(this._getByTags(this.multiMaterials,N,q))}getTransformNodesByTags(N,q){return this._getByTags(this.transformNodes,N,q)}setRenderingOrder(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(N,q,R,z)}setRenderingAutoClearDepthStencil(N,q){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(N,q,R,z)}getAutoClearDepthStencilSetup(N){return this._renderingManager.getAutoClearDepthStencilSetup(N)}_forceBlockMaterialDirtyMechanism(N){this._blockMaterialDirtyMechanism=N}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(N){this._blockMaterialDirtyMechanism!==N&&(this._blockMaterialDirtyMechanism=N,N||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(N,q){if(!this._blockMaterialDirtyMechanism)for(const R of this.materials)q&&!q(R)||R.Lg(N)}_loadFile(N,q,R,z,v,B,F){const S=(0,C.n)(N,q,R,z?this.offlineProvider:void 0,v,B,F);return this._activeRequests.push(S),S.onCompleteObservable.add((N=>{this._activeRequests.splice(this._activeRequests.indexOf(N),1)})),S}_loadFileAsync(N,q,R,z,v){return new Promise(((B,F)=>{this._loadFile(N,(N=>{B(N)}),q,R,z,((N,q)=>{F(q)}),v)}))}_requestFile(N,q,R,z,v,B,F){const S=(0,C.u)(N,q,R,z?this.offlineProvider:void 0,v,B,F);return this._activeRequests.push(S),S.onCompleteObservable.add((N=>{this._activeRequests.splice(this._activeRequests.indexOf(N),1)})),S}_requestFileAsync(N,q,R,z,v){return new Promise(((B,F)=>{this._requestFile(N,(N=>{B(N)}),q,R,z,(N=>{F(N)}),v)}))}_readFile(N,q,R,z,v){const B=(0,C.s)(N,q,R,z,v);return this._activeRequests.push(B),B.onCompleteObservable.add((N=>{this._activeRequests.splice(this._activeRequests.indexOf(N),1)})),B}_readFileAsync(N,q,R){return new Promise(((z,v)=>{this._readFile(N,(N=>{z(N)}),q,R,(N=>{v(N)}))}))}getPerfCollector(){throw(0,Y.b)("performanceViewerSceneExtension")}setActiveCameraByID(N){return this.setActiveCameraById(N)}getMaterialByID(N){return this.getMaterialById(N)}getLastMaterialByID(N){return this.getLastMaterialById(N)}getTextureByUniqueID(N){return this.getTextureByUniqueId(N)}getCameraByID(N){return this.getCameraById(N)}getCameraByUniqueID(N){return this.getCameraByUniqueId(N)}getBoneByID(N){return this.getBoneById(N)}getLightByID(N){return this.getLightById(N)}getLightByUniqueID(N){return this.getLightByUniqueId(N)}getParticleSystemByID(N){return this.getParticleSystemById(N)}getGeometryByID(N){return this.getGeometryById(N)}getMeshByID(N){return this.getMeshById(N)}getMeshByUniqueID(N){return this.getMeshByUniqueId(N)}getLastMeshByID(N){return this.getLastMeshById(N)}getMeshesByID(N){return this.getMeshesById(N)}getTransformNodeByID(N){return this.getTransformNodeById(N)}getTransformNodeByUniqueID(N){return this.getTransformNodeByUniqueId(N)}getTransformNodesByID(N){return this.getTransformNodesById(N)}getNodeByID(N){return this.getNodeById(N)}getLastEntryByID(N){return this.getLastEntryById(N)}getLastSkeletonByID(N){return this.getLastSkeletonById(N)}}NN.FOGMODE_NONE=0,NN.FOGMODE_EXP=1,NN.FOGMODE_EXP2=2,NN.FOGMODE_LINEAR=3,NN.MinDeltaTime=1,NN.MaxDeltaTime=1e3,(0,W.f)("BABYLON.Scene",NN)},11282:(N,q,R)=>{"use strict";R.d(q,{c:()=>z,g:()=>v});class z{}z.NAME_EFFECTLAYER="EffectLayer",z.NAME_LAYER="Layer",z.NAME_LENSFLARESYSTEM="LensFlareSystem",z.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",z.NAME_PARTICLESYSTEM="sb",z.NAME_GAMEPAD="Gamepad",z.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",z.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",z.NAME_PREPASSRENDERER="PrePassRenderer",z.NAME_DEPTHRENDERER="DepthRenderer",z.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",z.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",z.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",z.NAME_SPRITE="Sprite",z.NAME_SUBSURFACE="SubSurface",z.NAME_OUTLINERENDERER="Outline",z.NAME_PROCEDURALTEXTURE="ProceduralTexture",z.NAME_SHADOWGENERATOR="ShadowGenerator",z.NAME_OCTREE="ub",z.NAME_PHYSICSENGINE="PhysicsEngine",z.NAME_AUDIO="Audio",z.NAME_FLUIDRENDERER="FluidRenderer",z.STEP_ISREADYFORMESH_EFFECTLAYER=0,z.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,z.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,z.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,z.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,z.STEP_BEFORECAMERADRAW_PREPASS=0,z.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,z.STEP_BEFORECAMERADRAW_LAYER=2,z.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,z.STEP_BEFORERENDERTARGETDRAW_LAYER=1,z.STEP_BEFORERENDERINGMESH_PREPASS=0,z.STEP_BEFORERENDERINGMESH_OUTLINE=1,z.STEP_AFTERRENDERINGMESH_PREPASS=0,z.STEP_AFTERRENDERINGMESH_OUTLINE=1,z.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,z.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,z.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,z.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,z.STEP_BEFORECLEAR_PREPASS=1,z.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,z.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,z.STEP_AFTERRENDERTARGETDRAW_LAYER=1,z.STEP_AFTERCAMERADRAW_PREPASS=0,z.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,z.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,z.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,z.STEP_AFTERCAMERADRAW_LAYER=4,z.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,z.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,z.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,z.STEP_AFTERRENDER_AUDIO=0,z.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,z.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,z.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,z.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,z.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,z.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,z.STEP_POINTERMOVE_SPRITE=0,z.STEP_POINTERDOWN_SPRITE=0,z.STEP_POINTERUP_SPRITE=0;class v extends Array{constructor(N){super(...N)}static Create(){return Object.create(v.prototype)}registerStep(N,q,R){let z=0,v=Number.MAX_VALUE;for(;z<this.length;z++){if(v=this[z].index,N<v)break}this.splice(z,0,{index:N,component:q,action:R.bind(q)})}clear(){this.length=0}}},11147:(N,q,R)=>{"use strict";R.d(q,{c:()=>z});function z(N,q,R,z){var v,B=arguments.length,F=B<3?q:null===z?z=Object.getOwnPropertyDescriptor(q,R):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)F=Reflect.decorate(N,q,R,z);else for(var S=N.length-1;S>=0;S--)(v=N[S])&&(F=(B<3?v(F):B>3?v(q,R,F):v(q,R))||F);return B>3&&F&&Object.defineProperty(q,R,F),F}Object.create;Object.create},12052:(N,q,R)=>{"use strict";class z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((N,q)=>{this._resolve=N,this._reject=q}))}}var v=R(11181),B=R(11213),F=R(10888),S=R(11452),A=R(12055),y=R(12067),E=R(10893),t=R(11642),x=R(12075),e=R(12083),b=R(10933),f=R(10907),D=R(10911);class V{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(N){this._useTextureToStoreBoneMatrices=N,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(N,q,R){this.name=N,this.id=q,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=v.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new E.d,this.bones=[],this._scene=R||b.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const z=this._scene.getEngine().getCaps();this._canUseTextureForBones=z.textureFloat&&z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((N=>!N.getParent()))}getTransformMatrices(N){if(this.needInitialSkinMatrix){if(!N)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return N._bonesTransformMatrices||this.prepare(!0),N._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(N){return this.needInitialSkinMatrix&&N._transformMatrixTexture?N._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(N){let q=`Name: ${this.name}, nBones: ${this.bones.length}`;if(q+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,N){q+=", Ranges: {";let N=!0;for(const R in this._ranges)N&&(q+=", ",N=!1),q+=R;q+="}"}return q}getBoneIndexByName(N){for(let q=0,R=this.bones.length;q<R;q++)if(this.bones[q].name===N)return q;return-1}createAnimationRange(N,q,R){if(!this._ranges[N]){this._ranges[N]=new e.c(N,q,R);for(let z=0,v=this.bones.length;z<v;z++)this.bones[z].animations[0]&&this.bones[z].animations[0].createRange(N,q,R)}}deleteAnimationRange(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let R=0,z=this.bones.length;R<z;R++)this.bones[R].animations[0]&&this.bones[R].animations[0].deleteRange(N,q);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}getAnimationRanges(){const N=[];let q;for(q in this._ranges)N.push(this._ranges[q]);return N}copyAnimationRange(N,q){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[q]||!N.getAnimationRange(q))return!1;let z=!0;const v=this._getHighestAnimationFrame()+1,B={},F=N.bones;let S,A;for(A=0,S=F.length;A<S;A++)B[F[A].name]=F[A];this.bones.length!==F.length&&(f.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${F.length}`),z=!1);const y=R&&this.dimensionsAtRest&&N.dimensionsAtRest?this.dimensionsAtRest.divide(N.dimensionsAtRest):null;for(A=0,S=this.bones.length;A<S;A++){const N=this.bones[A].name,F=B[N];F?z=z&&this.bones[A].copyAnimationRange(F,q,v,R,y):(f.c.Warn("copyAnimationRange: not same rig, missing source bone "+N),z=!1)}const E=N.getAnimationRange(q);return E&&(this._ranges[q]=new e.c(q,E.from+v,E.to+v)),z}returnToRest(){for(const N of this.bones)-1!==N._index&&N.returnToRest()}_getHighestAnimationFrame(){let N=0;for(let q=0,R=this.bones.length;q<R;q++)if(this.bones[q].animations[0]){const R=this.bones[q].animations[0].getHighestFrame();N<R&&(N=R)}return N}beginAnimation(N,q,R,z){const v=this.getAnimationRange(N);return v?this._scene.beginAnimation(this,v.from,v.to,q,R,z):null}static MakeAnimationAdditive(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;const z=N.getAnimationRange(R);if(!z)return null;const v=N._scene.getAllAnimatablesByTarget(N);let B=null;for(let S=0;S<v.length;S++){const N=v[S];if(N.fromFrame===(null===z||void 0===z?void 0:z.from)&&N.toFrame===(null===z||void 0===z?void 0:z.to)){B=N;break}}const F=N.getAnimatables();for(let S=0;S<F.length;S++){const N=F[S].animations;if(N)for(let z=0;z<N.length;z++)x.c.MakeAnimationAdditive(N[z],q,R)}return B&&(B.isAdditive=!0),N}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(N){this._meshesWithPoseMatrix.push(N)}_unregisterMeshWithPoseMatrix(N){const q=this._meshesWithPoseMatrix.indexOf(N);q>-1&&this._meshesWithPoseMatrix.splice(q,1)}_computeTransformMatrices(N,q){this.onBeforeComputeObservable.notifyObservers(this);for(let R=0;R<this.bones.length;R++){const z=this.bones[R];z._childUpdateId++;const v=z.getParent();if(v?z.getLocalMatrix().multiplyToRef(v.getFinalMatrix(),z.getFinalMatrix()):q?z.getLocalMatrix().multiplyToRef(q,z.getFinalMatrix()):z.getFinalMatrix().p(z.getLocalMatrix()),-1!==z._index){const q=null===z._index?R:z._index;z.getAbsoluteInverseBindMatrix().multiplyToArray(z.getFinalMatrix(),N,16*q)}}this._identity.copyToArray(N,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const N=this.va().getRenderId();if(this._currentRenderId===N)return;this._currentRenderId=N}if(this._numBonesWithLinkedTransformNode>0)for(const N of this.bones)if(N._linkedTransformNode){const q=N._linkedTransformNode;N.position=q.position,q.rotationQuaternion?N.rotationQuaternion=q.rotationQuaternion:N.rotation=q.rotation,N.re=q.re}if(this.needInitialSkinMatrix)for(const N of this._meshesWithPoseMatrix){const q=N.getPoseMatrix();let R=this._isDirty;if(N._bonesTransformMatrices&&N._bonesTransformMatrices.length===16*(this.bones.length+1)||(N._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),R=!0),R){if(this._synchronizedWithMesh!==N){this._synchronizedWithMesh=N;for(const N of this.bones)if(!N.getParent()){N.getBindMatrix().multiplyToRef(q,v.k.Matrix[1]),N._updateAbsoluteBindMatrices(v.k.Matrix[1])}if(this.isUsingTextureForMatrices){const q=4*(this.bones.length+1);N._transformMatrixTexture&&N._transformMatrixTexture.getSize().width===q||(N._transformMatrixTexture&&N._transformMatrixTexture.dispose(),N._transformMatrixTexture=t.e.CreateRGBATexture(N._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(N._bonesTransformMatrices,q),this.isUsingTextureForMatrices&&N._transformMatrixTexture&&N._transformMatrixTexture.update(N._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=t.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let N=0;N<this.bones.length;N++)this._animatables.push(this.bones[N])}return this._animatables}clone(N,q){const R=new V(N,q||N,this._scene);R.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let z=0;z<this.bones.length;z++){const N=this.bones[z];let q=null;const v=N.getParent();if(v){const N=this.bones.indexOf(v);q=R.bones[N]}const B=new y.e(N.name,R,q,N.getBindMatrix().clone(),N.getRestMatrix().clone());B._index=N._index,N._linkedTransformNode&&B.linkTransformNode(N._linkedTransformNode),D.d.DeepCopy(N.animations,B.animations)}if(this._ranges){R._ranges={};for(const N in this._ranges){const q=this._ranges[N];q&&(R._ranges[N]=q.clone())}}return this._isDirty=!0,R.prepare(!0),R}enableBlending(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((q=>{q.animations.forEach((q=>{q.enableBlending=!0,q.blendingSpeed=N}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const N=this._parentContainer.skeletons.indexOf(this);N>-1&&this._parentContainer.skeletons.splice(N,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const N={};N.name=this.name,N.id=this.id,this.dimensionsAtRest&&(N.dimensionsAtRest=this.dimensionsAtRest.ij()),N.bones=[],N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let R=0;R<this.bones.length;R++){var q;const z=this.bones[R],v=z.getParent(),B={parentBoneIndex:v?this.bones.indexOf(v):-1,index:z.getIndex(),name:z.name,id:z.id,matrix:z.getBindMatrix().ij(),rest:z.getRestMatrix().ij(),linkedTransformNodeId:null===(q=z.getTransformNode())||void 0===q?void 0:q.id};N.bones.push(B),z.length&&(B.length=z.length),z.metadata&&(B.metadata=z.metadata),z.animations&&z.animations.length>0&&(B.animation=z.animations[0].serialize()),N.ranges=[];for(const q in this._ranges){const R=this._ranges[q];if(!R)continue;const z={};z.name=q,z.from=R.from,z.to=R.to,N.ranges.push(z)}}return N}static Parse(N,q){const R=new V(N.name,N.id,q);let z;for(N.dimensionsAtRest&&(R.dimensionsAtRest=v.m.Zg(N.dimensionsAtRest)),R.needInitialSkinMatrix=N.needInitialSkinMatrix,z=0;z<N.bones.length;z++){const q=N.bones[z],B=N.bones[z].index;let F=null;q.parentBoneIndex>-1&&(F=R.bones[q.parentBoneIndex]);const S=q.rest?v.d.Zg(q.rest):null,A=new y.e(q.name,R,F,v.d.Zg(q.matrix),S,null,B);void 0!==q.id&&null!==q.id&&(A.id=q.id),q.length&&(A.length=q.length),q.metadata&&(A.metadata=q.metadata),q.animation&&A.animations.push(x.c.Parse(q.animation)),void 0!==q.linkedTransformNodeId&&null!==q.linkedTransformNodeId&&(R._hasWaitingData=!0,A._waitingTransformNodeId=q.linkedTransformNodeId)}if(N.ranges)for(z=0;z<N.ranges.length;z++){const q=N.ranges[z];R.createAnimationRange(q.name,q.from,q.to)}return R}computeAbsoluteMatrices(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||N)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(N)}getPoseMatrix(){let N=null;return this._meshesWithPoseMatrix.length>0&&(N=this._meshesWithPoseMatrix[0].getPoseMatrix()),N}sortBones(){const N=[],q=new Array(this.bones.length);for(let R=0;R<this.bones.length;R++)this._sortBones(R,N,q);this.bones=N}_sortBones(N,q,R){if(R[N])return;R[N]=!0;const z=this.bones[N];if(!z)return;void 0===z._index&&(z._index=N);const v=z.getParent();v&&this._sortBones(this.bones.indexOf(v),q,R),q.push(z)}setCurrentPoseAsRest(){this.bones.forEach((N=>{N.setCurrentPoseAsRest()}))}}var H=R(11332),Y=R(11147),T=R(11151),L=R(12090),X=R(12102),Q=R(11002),h=R(11221);class u extends X.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(N){this.subSurface.refractionTexture=N,N?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(N){this.subSurface.indexOfRefraction=N}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(N){this.subSurface.invertRefractionY=N}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(N){this.subSurface.linkRefractionWithTransparency=N,N&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===X.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(N){N!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=N?X.b.LIGHTFALLOFF_PHYSICAL:X.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===X.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(N){N!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=N?X.b.LIGHTFALLOFF_GLTF:X.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(N){this.imageProcessingConfiguration.colorCurvesEnabled=N}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(N){this.imageProcessingConfiguration.colorGradingEnabled=N}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(N){this._imageProcessingConfiguration.toneMappingEnabled=N}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(N){this._imageProcessingConfiguration.exposure=N}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(N){this._imageProcessingConfiguration.contrast=N}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(N){this._imageProcessingConfiguration.colorGradingTexture=N}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(N){this._imageProcessingConfiguration.colorCurves=N}constructor(N,q){super(N,q,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=u.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=B.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new B.c(0,0,0),this.albedoColor=new B.c(1,1,1),this.reflectivityColor=new B.c(1,1,1),this.reflectionColor=new B.c(1,1,1),this.emissiveColor=new B.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,L.b)(this.va())}getClassName(){return"PBRMaterial"}clone(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const z=h.e.Clone((()=>new u(N,this.va())),this,{cloneTexturesOnlyOnce:q});return z.id=N,z.name=N,this.stencil.copyTo(z.stencil),this._clonePlugins(z,R),z}serialize(){const N=super.serialize();return N.customType="BABYLON.PBRMaterial",N}static Parse(N,q,R){const z=h.e.Parse((()=>new u(N.name,q)),N,q,R);return N.stencil&&z.stencil.parse(N.stencil,q,R),H.d._ParsePlugins(N,z,q,R),N.clearCoat&&z.clearCoat.parse(N.clearCoat,q,R),N.anisotropy&&z.anisotropy.parse(N.anisotropy,q,R),N.brdf&&z.brdf.parse(N.brdf,q,R),N.sheen&&z.sheen.parse(N.sheen,q,R),N.subSurface&&z.subSurface.parse(N.subSurface,q,R),N.iridescence&&z.iridescence.parse(N.iridescence,q,R),z}}u.PBRMATERIAL_OPAQUE=X.b.PBRMATERIAL_OPAQUE,u.PBRMATERIAL_ALPHATEST=X.b.PBRMATERIAL_ALPHATEST,u.PBRMATERIAL_ALPHABLEND=X.b.PBRMATERIAL_ALPHABLEND,u.PBRMATERIAL_ALPHATESTANDBLEND=X.b.PBRMATERIAL_ALPHATESTANDBLEND,u.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=X.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"directIntensity",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveIntensity",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"environmentIntensity",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"specularIntensity",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"disableBumpMap",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"albedoTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTexture",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTextureStrength",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"opacityTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectionTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectivityTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicTexture",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallic",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"roughness",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicF0Factor",void 0),(0,Y.c)([(0,T.j)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicReflectanceColor",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicReflectanceTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectanceTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"microSurfaceTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"bumpTexture",void 0),(0,Y.c)([(0,T.x)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty",null)],u.prototype,"lightmapTexture",void 0),(0,Y.c)([(0,T.j)("ambient"),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientColor",void 0),(0,Y.c)([(0,T.j)("albedo"),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"albedoColor",void 0),(0,Y.c)([(0,T.j)("reflectivity"),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectivityColor",void 0),(0,Y.c)([(0,T.j)("reflection"),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectionColor",void 0),(0,Y.c)([(0,T.j)("emissive"),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveColor",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"microSurface",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useLightmapAsShadowmap",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"useAlphaFromAlbedoTexture",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"forceAlphaTest",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"alphaCutOff",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useSpecularOverAlpha",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAmbientInGrayScale",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,Y.c)([(0,T.D)()],u.prototype,"usePhysicalLightFalloff",null),(0,Y.c)([(0,T.D)()],u.prototype,"useGLTFLightFalloff",null),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRadianceOverAlpha",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useObjectSpaceNormalMap",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallax",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallaxOcclusion",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"parallaxScaleBias",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsLightsDirty")],u.prototype,"disableLighting",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"forceIrradianceInFragment",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsLightsDirty")],u.prototype,"maxSimultaneousLights",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapX",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapY",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"twoSidedLighting",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAlphaFresnel",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useLinearAlphaFresnel",void 0),(0,Y.c)([(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"environmentBRDFTexture",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"forceNormalForward",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"enableSpecularAntiAliasing",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useHorizonOcclusion",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRadianceOcclusion",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],u.prototype,"unlit",void 0),(0,Y.c)([(0,T.D)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],u.prototype,"applyDecalMapAfterDetailMap",void 0),(0,Q.f)("BABYLON.PBRMaterial",u);var w=R(11402),c=R(11486),n=R(11251),G=R(11475),s=R(11481),Z=R(11445);class J{get influence(){return this._influence}set influence(N){if(this._influence===N)return;const q=this._influence;this._influence=N,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===q||0===N)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=N,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new E.d,this._onDataLayoutChanged=new E.d,this._animationPropertiesOverride=null,this.id=N,this._scene=R||b.b.LastCreatedScene,this.influence=q,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(N){const q=this.hasPositions;this._positions=N,q!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(N){const q=this.hasNormals;this._normals=N,q!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(N){const q=this.hasTangents;this._tangents=N,q!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(N){const q=this.hasUVs;this._uvs=N,q!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const N=h.e.Clone((()=>new J(this.name,this.influence,this._scene)),this);return N._positions=this._positions,N._normals=this._normals,N._tangents=this._tangents,N._uvs=this._uvs,N}serialize(){const N={};return N.name=this.name,N.influence=this.influence,N.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(N.id=this.id),this.hasNormals&&(N.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(N.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(N.Aa=Array.prototype.slice.call(this.getUVs())),h.e.AppendSerializedAnimations(this,N),N}getClassName(){return"MorphTarget"}static Parse(N,q){const R=new J(N.name,N.influence);if(R.setPositions(N.xa),null!=N.id&&(R.id=N.id),N.ya&&R.setNormals(N.ya),N.tangents&&R.setTangents(N.tangents),N.Aa&&R.setUVs(N.Aa),N.animations){for(let q=0;q<N.animations.length;q++){const z=N.animations[q],v=(0,Q.c)("BABYLON.Animation");v&&R.animations.push(v.Parse(z))}N.autoAnimate&&q&&q.beginAnimation(R,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1)}return R}static FromMesh(N,q,R){q||(q=N.name);const z=new J(q,R,N.va());return z.setPositions(N.getVerticesData(n.h.PositionKind)),N.isVerticesDataPresent(n.h.NormalKind)&&z.setNormals(N.getVerticesData(n.h.NormalKind)),N.isVerticesDataPresent(n.h.TangentKind)&&z.setTangents(N.getVerticesData(n.h.TangentKind)),N.isVerticesDataPresent(n.h.UVKind)&&z.setUVs(N.getVerticesData(n.h.UVKind)),z}}(0,Y.c)([(0,T.D)()],J.prototype,"id",void 0);var M=R(11167),m=R(11987);class g{set areUpdatesFrozen(N){N?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new M.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,N||(N=b.b.LastCreatedScene),this._scene=N,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const N=this._scene.getEngine().getCaps();this._canUseTextureForTargets=N.canUseGLVertexID&&N.textureFloat&&N.maxVertexTextureImageUnits>0&&N.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(N){this._numMaxInfluencers!==N&&(this._numMaxInfluencers=N,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(N){this._useTextureToStoreTargets=N}get isUsingTextureForTargets(){var N;return g.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(N=this._scene)&&void 0!==N&&N.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(N){return this._activeTargets.data[N]}getTarget(N){return this._targets[N]}getTargetByName(N){for(const q of this._targets)if(q.name===N)return q;return null}addTarget(N){this._targets.push(N),this._targetInfluenceChangedObservers.push(N.onInfluenceChanged.add((N=>{this._syncActiveTargets(N)}))),this._targetDataLayoutChangedObservers.push(N._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(N){const q=this._targets.indexOf(N);q>=0&&(this._targets.splice(q,1),N.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(q,1)[0]),N._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(q,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(N)}_bind(N){N.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),N.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),N.setTexture("morphTargets",this._targetStoreTexture),N.setInt("morphTargetCount",this.numInfluencers)}clone(){const N=new g(this._scene);for(const q of this._targets)N.addTarget(q.clone());return N.enableNormalMorphing=this.enableNormalMorphing,N.enableTangentMorphing=this.enableTangentMorphing,N.enableUVMorphing=this.enableUVMorphing,N}serialize(){const N={};N.id=this.uniqueId,N.targets=[];for(const q of this._targets)N.targets.push(q.serialize());return N}_syncActiveTargets(N){if(this.areUpdatesFrozen)return;let q=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let R=-1;for(const z of this._targets){if(R++,0===z.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=g.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(z),this._morphTargetTextureIndices[q]=R,this._tempInfluences[q++]=z.influence,this._supportsNormals=this._supportsNormals&&z.hasNormals,this._supportsTangents=this._supportsTangents&&z.hasTangents,this._supportsUVs=this._supportsUVs&&z.hasUVs;const N=z.getPositions();if(N){const q=N.length/3;if(0===this._vertexCount)this._vertexCount=q;else if(this._vertexCount!==q)return void f.c.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,q)),this._influences&&this._influences.length===q||(this._influences=new Float32Array(q));for(let z=0;z<q;z++)this._influences[z]=this._tempInfluences[z];N&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const N=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>N&&(this._textureHeight=Math.ceil(this._textureWidth/N),this._textureWidth=N);let q=!0;if(this._targetStoreTexture){const N=this._targetStoreTexture.getSize();N.width===this._textureWidth&&N.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(q=!1)}if(q){this._targetStoreTexture&&this._targetStoreTexture.dispose();const N=this._targets.length,q=new Float32Array(N*this._textureWidth*this._textureHeight*4);let R=0;for(let z=0;z<N;z++){const N=this._targets[z],v=N.getPositions(),B=N.getNormals(),F=N.getUVs(),S=N.getTangents();if(!v)return void(0===z&&f.c.Error("Invalid morph target. Target must have positions."));R=z*this._textureWidth*this._textureHeight*4;for(let z=0;z<this._vertexCount;z++)q[R]=v[3*z],q[R+1]=v[3*z+1],q[R+2]=v[3*z+2],R+=4,this._supportsNormals&&B&&(q[R]=B[3*z],q[R+1]=B[3*z+1],q[R+2]=B[3*z+2],R+=4),this._supportsUVs&&F&&(q[R]=F[2*z],q[R+1]=F[2*z+1],R+=4),this._supportsTangents&&S&&(q[R]=S[3*z],q[R+1]=S[3*z+1],q[R+2]=S[3*z+2],R+=4)}this._targetStoreTexture=m.e.CreateRGBATexture(q,this._textureWidth,this._textureHeight,N,this._scene,!1,!1,1,1)}}for(const N of this._scene.meshes)N.morphTargetManager===this&&N._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const N=this._parentContainer.morphTargetManagers.indexOf(this);N>-1&&this._parentContainer.morphTargetManagers.splice(N,1),this._parentContainer=null}for(const N of this._targets)this._scene.stopAnimation(N)}}static Parse(N,q){const R=new g(q);for(const z of N.targets)R.addTarget(J.Parse(z,q));return R}}g.EnableTextureStorage=!0,g.MaxActiveMorphTargetsInVertexAttributeMode=8;var j=R(12113),l=R(10938),I=R(11344);function U(N,q,R,z){return v.m.Zg(q,R).scaleInPlace(z)}class O{constructor(N,q,R,z){this.type=N,this.name=q,this.getValue=R,this.getStride=z}_buildAnimation(N,q,R){const z=new x.c(N,this.name,q,this.type);return z.setKeys(R),z}}class i extends O{buildAnimations(N,q,R,z,v){v(N._babylonTransformNode,this._buildAnimation(q,R,z))}}const P={translation:[new i(x.c.ANIMATIONTYPE_VECTOR3,"position",U,(()=>3))],rotation:[new i(x.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(N,q,R,z){return v.g.Zg(q,R).scaleInPlace(z)}),(()=>4))],scale:[new i(x.c.ANIMATIONTYPE_VECTOR3,"re",U,(()=>3))],weights:[new class extends O{buildAnimations(N,q,R,z,v){if(N._numMorphTargets)for(let B=0;B<N._numMorphTargets;B++){const F=new x.c(`${q}_${B}`,this.name,R,this.type);if(F.setKeys(z.map((N=>({frame:N.frame,inTangent:N.inTangent?N.inTangent[B]:void 0,value:N.value[B],outTangent:N.outTangent?N.outTangent[B]:void 0,interpolation:N.interpolation})))),N._primitiveBabylonMeshes)for(const q of N._primitiveBabylonMeshes)if(q.morphTargetManager){const N=q.morphTargetManager.getTarget(B),R=F.clone();N.animations.push(R),v(N,R)}}}}(x.c.ANIMATIONTYPE_FLOAT,"influence",(function(N,q,R,z){const v=new Array(N._numMorphTargets);for(let B=0;B<v.length;B++)v[B]=q[R++]*z;return v}),(N=>N._numMorphTargets))]},k=new Map,o=k;function C(N,q,R){K(N)&&f.c.Warn(`Extension with the name '${N}' already exists`),k.set(N,{isGLTFExtension:q,factory:R})}function K(N){return k.delete(N)}function r(){const N=N=>N&&"object"===typeof N;for(var q=arguments.length,R=new Array(q),z=0;z<q;z++)R[z]=arguments[z];return R.reduce(((q,R)=>(Object.keys(R).forEach((z=>{const v=q[z],B=R[z];Array.isArray(v)&&Array.isArray(B)?q[z]=v.concat(...B):N(v)&&N(B)?q[z]=r(v,B):q[z]=B})),q)),{})}class a{static Get(N,q,R){if(!q||void 0==R||!q[R])throw new Error(`${N}: Failed to find index (${R})`);return q[R]}static TryGet(N,q){return N&&void 0!=q&&N[q]?N[q]:null}static Assign(N){if(N)for(let q=0;q<N.length;q++)N[q].index=q}}class d{static RegisterExtension(N,q){C(N,!1,q)}static UnregisterExtension(N){return K(N)}get Oi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(N){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=N}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((N=>N.dispose&&N.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(N,q,R,z,v,B){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=q,this._assetContainer=R,this._loadData(z);let B=null;if(N){const q={};if(this._gltf.nodes)for(const N of this._gltf.nodes)N.name&&(q[N.name]=N.index);B=(N instanceof Array?N:[N]).map((N=>{const R=q[N];if(void 0===R)throw new Error(`Failed to find node '${N}'`);return R}))}return this._loadAsync(v,F,B,(()=>({meshes:this._getMeshes(),qj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=N,this._loadData(q),this._loadAsync(R,v,null,(()=>{})))))}_loadAsync(N,q,R,z){return Promise.resolve().then((async()=>{this._rootUrl=N,this._uniqueRootUrl=!N.startsWith("file:")&&q?N:`${N}${Date.now()}/`,this._fileName=q,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const v=`${j.k[j.k.LOADING]} => ${j.k[j.k.READY]}`,B=`${j.k[j.k.LOADING]} => ${j.k[j.k.COMPLETE]}`;this._parent._startPerformanceCounter(v),this._parent._startPerformanceCounter(B),this._parent._setState(j.k.LOADING),this._extensionsOnLoading();const S=new Array;if(!this.parent.loadOnlyMaterials)if(R)S.push(this.loadSceneAsync("/nodes",{nodes:R,index:-1}));else if(void 0!=this._gltf.Xd||this._gltf.scenes&&this._gltf.scenes[0]){const N=a.Get("/scene",this._gltf.scenes,this._gltf.Xd||0);S.push(this.loadSceneAsync(`/scenes/${N.index}`,N))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let N=0;N<this._gltf.materials.length;++N){const q=this._gltf.materials[N],R="/materials/"+N,z=H.d.TriangleFillMode;S.push(this._loadMaterialAsync(R,q,null,z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&S.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&S.push(this._compileShadowGeneratorsAsync());return Promise.all(S).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Vb(!0),this._extensionsOnReady(),this._parent._setState(j.k.READY),this._startAnimations(),z()))).then((N=>(this._parent._endPerformanceCounter(v),F.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(B),this._parent._setState(j.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(N=>{this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()}))})),N)))})).catch((N=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()),N}))}_loadData(N){if(this._gltf=N.json,this._setupData(),N.bin){const q=this._gltf.buffers;if(q&&q[0]&&!q[0].uri){const R=q[0];(R.byteLength<N.bin.byteLength-3||R.byteLength>N.bin.byteLength)&&f.c.Warn(`Binary buffer length (${R.byteLength}) from JSON does not match chunk length (${N.bin.byteLength})`),this._bin=N.bin}else f.c.Warn("Unexpected BIN chunk")}}_setupData(){if(a.Assign(this._gltf.accessors),a.Assign(this._gltf.animations),a.Assign(this._gltf.buffers),a.Assign(this._gltf.bufferViews),a.Assign(this._gltf.cameras),a.Assign(this._gltf.images),a.Assign(this._gltf.materials),a.Assign(this._gltf.meshes),a.Assign(this._gltf.nodes),a.Assign(this._gltf.samplers),a.Assign(this._gltf.scenes),a.Assign(this._gltf.skins),a.Assign(this._gltf.textures),this._gltf.nodes){const N={};for(const R of this._gltf.nodes)if(R.children)for(const q of R.children)N[q]=R.index;const q=this._createRootNode();for(const R of this._gltf.nodes){const z=N[R.index];R.parent=void 0===z?q:this._gltf.nodes[z]}}}async _loadExtensionsAsync(){const N=[];if(o.forEach(((q,R)=>{var z;!1===(null===(z=this.parent.extensionOptions[R])||void 0===z?void 0:z.enabled)?q.isGLTFExtension&&this.isExtensionUsed(R)&&f.c.Warn(`Extension ${R} is used but has been explicitly disabled.`):q.isGLTFExtension&&!this.isExtensionUsed(R)||N.push((async()=>{const N=await q.factory(this);return N.name!==R&&f.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${N.name} !== ${R}`),this._parent.onExtensionLoadedObservable.notifyObservers(N),N})())})),this._extensions.push(...await Promise.all(N)),this._extensions.sort(((N,q)=>(N.order||Number.MAX_VALUE)-(q.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const R of this._gltf.extensionsRequired){if(!this._extensions.some((N=>N.name===R&&N.enabled))){var q;if(!1===(null===(q=this.parent.extensionOptions[R])||void 0===q?void 0:q.enabled))throw new Error(`Required extension ${R} is disabled`);throw new Error(`Required extension ${R} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new Z.b("__root__",this._babylonScene);this._rootBabylonMesh=N,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Vb(!1);const q={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case j.j.AUTO:this._babylonScene.useRightHandedSystem||(q.rotation=[0,1,0,0],q.scale=[1,1,-1],d._LoadTransform(q,this._rootBabylonMesh));break;case j.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(N),q}loadSceneAsync(N,q){const R=this._extensionsLoadSceneAsync(N,q);if(R)return R;const z=new Array;if(this.logOpen(`${N} ${q.name||""}`),q.nodes)for(const v of q.nodes){const q=a.Get(`${N}/nodes/${v}`,this._gltf.nodes,v);z.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(N=>{N.parent=this._rootBabylonMesh})))}for(const v of this._postSceneLoadActions)v();return z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(z).then((()=>{}))}_forEachPrimitive(N,q){if(N._primitiveBabylonMeshes)for(const R of N._primitiveBabylonMeshes)q(R)}_getGeometries(){const N=[],q=this._gltf.nodes;if(q)for(const R of q)this._forEachPrimitive(R,(q=>{const R=q.Dj;R&&-1===N.indexOf(R)&&N.push(R)}));return N}_getMeshes(){const N=[];this._rootBabylonMesh instanceof s.e&&N.push(this._rootBabylonMesh);const q=this._gltf.nodes;if(q)for(const R of q)this._forEachPrimitive(R,(q=>{N.push(q)}));return N}_getTransformNodes(){const N=[],q=this._gltf.nodes;if(q)for(const R of q)R._babylonTransformNode&&"qb"===R._babylonTransformNode.getClassName()&&N.push(R._babylonTransformNode),R._babylonTransformNodeForSkin&&N.push(R._babylonTransformNodeForSkin);return N}_getSkeletons(){const N=[],q=this._gltf.skins;if(q)for(const R of q)R._data&&N.push(R._data.babylonSkeleton);return N}_getAnimationGroups(){const N=[],q=this._gltf.animations;if(q)for(const R of q)R._babylonAnimationGroup&&N.push(R._babylonAnimationGroup);return N}_startAnimations(){switch(this._parent.animationStartMode){case j.h.NONE:break;case j.h.FIRST:{const N=this._getAnimationGroups();0!==N.length&&N[0].start(!0);break}case j.h.ALL:{const N=this._getAnimationGroups();for(const q of N)q.start(!0);break}default:return void f.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadNodeAsync(N,q,R);if(z)return z;if(q._babylonTransformNode)throw new Error(`${N}: Invalid recursive node hierarchy`);const v=new Array;this.logOpen(`${N} ${q.name||""}`);const B=z=>{if(d.AddPointerMetadata(z,N),d._LoadTransform(q,z),void 0!=q.camera){const R=a.Get(`${N}/camera`,this._gltf.cameras,q.camera);v.push(this.loadCameraAsync(`/cameras/${R.index}`,R,(N=>{N.parent=z})))}if(q.children)for(const R of q.children){const q=a.Get(`${N}/children/${R}`,this._gltf.nodes,R);v.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(N=>{N.parent=z})))}R(z)},F=void 0!=q.mesh,S=this._parent.loadSkins&&void 0!=q.skin;if(!F||S){const N=q.name||`node${q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new c.e(N,this._babylonScene);R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==q.mesh?q._babylonTransformNode=R:q._babylonTransformNodeForSkin=R,B(R)}if(F)if(S){const R=a.Get(`${N}/mesh`,this._gltf.meshes,q.mesh);v.push(this._loadMeshAsync(`/meshes/${R.index}`,q,R,(R=>{const z=q._babylonTransformNodeForSkin;R.metadata=r(z.metadata,R.metadata||{});const B=a.Get(`${N}/skin`,this._gltf.skins,q.skin);v.push(this._loadSkinAsync(`/skins/${B.index}`,q,B,(N=>{this._forEachPrimitive(q,(q=>{q.skeleton=N})),this._postSceneLoadActions.push((()=>{if(void 0!=B.skeleton){const N=a.Get(`/skins/${B.index}/skeleton`,this._gltf.nodes,B.skeleton).parent;q.index===N.index?R.parent=z.parent:R.parent=N._babylonTransformNode}else R.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:z,skinnedNode:R})}))})))})))}else{const R=a.Get(`${N}/mesh`,this._gltf.meshes,q.mesh);v.push(this._loadMeshAsync(`/meshes/${R.index}`,q,R,B))}return this.logClose(),Promise.all(v).then((()=>(this._forEachPrimitive(q,(N=>{N.Dj&&N.Dj.useBoundingInfoFromGeometry?N.Ea():N.refreshBoundingInfo(!0,!0)})),q._babylonTransformNode)))}_loadMeshAsync(N,q,R,z){const v=R.primitives;if(!v||!v.length)throw new Error(`${N}: Primitives are missing`);void 0==v[0].index&&a.Assign(v);const B=new Array;this.logOpen(`${N} ${R.name||""}`);const F=q.name||`node${q.index}`;if(1===v.length){const z=R.primitives[0];B.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${z.index}`,F,q,R,z,(N=>{q._babylonTransformNode=N,q._primitiveBabylonMeshes=[N]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,q._babylonTransformNode=new c.e(F,this._babylonScene),q._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._primitiveBabylonMeshes=[];for(const z of v)B.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${z.index}`,`${F}_primitive${z.index}`,q,R,z,(N=>{N.parent=q._babylonTransformNode,q._primitiveBabylonMeshes.push(N)})))}return z(q._babylonTransformNode),this.logClose(),Promise.all(B).then((()=>q._babylonTransformNode))}_loadMeshPrimitiveAsync(N,q,R,z,v,B){const F=this._extensionsLoadMeshPrimitiveAsync(N,q,R,z,v,B);if(F)return F;this.logOpen(`${N}`);const S=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==R.skin&&!z.primitives[0].targets;let A,y;if(S&&v._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,A=v._instanceData.babylonSourceMesh.createInstance(q),A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y=v._instanceData.promise;else{const B=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new Z.b(q,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.sideOrientation=this._babylonScene.useRightHandedSystem?H.d.CounterClockWiseSideOrientation:H.d.ClockWiseSideOrientation,this._createMorphTargets(N,R,z,v,F),B.push(this._loadVertexDataAsync(N,v,F).then((q=>this._loadMorphTargetsAsync(N,v,F,q).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,q.Ca(F),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const E=d._GetDrawMode(N,v.mode);if(void 0==v.material){let N=this._defaultBabylonMaterialData[E];N||(N=this._createDefaultMaterial("__GLTFLoader._default",E),this._parent.onMaterialLoadedObservable.notifyObservers(N),this._defaultBabylonMaterialData[E]=N),F.material=N}else if(!this.parent.skipMaterials){const q=a.Get(`${N}/material`,this._gltf.materials,v.material);B.push(this._loadMaterialAsync(`/materials/${q.index}`,q,F,E,(N=>{F.material=N})))}y=Promise.all(B),S&&(v._instanceData={babylonSourceMesh:F,promise:y}),A=F}return d.AddPointerMetadata(A,N),this._parent.onMeshLoadedObservable.notifyObservers(A),B(A),this.logClose(),y.then((()=>A))}_loadVertexDataAsync(N,q,R){const z=this._extensionsLoadVertexDataAsync(N,q,R);if(z)return z;const B=q.attributes;if(!B)throw new Error(`${N}: Attributes are missing`);const F=new Array,S=new G.b(R.name,this._babylonScene);if(void 0==q.indices)R.isUnIndexed=!0;else{const R=a.Get(`${N}/indices`,this._gltf.accessors,q.indices);F.push(this._loadIndicesAccessorAsync(`/accessors/${R.index}`,R).then((N=>{S.setIndices(N)})))}const A=(q,z,A)=>{if(void 0==B[q])return;R._delayInfo=R._delayInfo||[],-1===R._delayInfo.indexOf(z)&&R._delayInfo.push(z);const y=a.Get(`${N}/attributes/${q}`,this._gltf.accessors,B[q]);F.push(this._loadVertexAccessorAsync(`/accessors/${y.index}`,y,z).then((N=>{if(N.getKind()===n.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!R.skeleton&&y.min&&y.max){const N=v.k.o[0].qe(...y.min),q=v.k.o[1].qe(...y.max);if(y.normalized&&5126!==y.componentType){let R=1;switch(y.componentType){case 5120:R=127;break;case 5121:R=255;break;case 5122:R=32767;break;case 5123:R=65535}const z=1/R;N.scaleInPlace(z),q.scaleInPlace(z)}S._boundingInfo=new I.e(N,q),S.useBoundingInfoFromGeometry=!0}S.setVerticesBuffer(N,y.count)}))),z==n.h.MatricesIndicesExtraKind&&(R.numBoneInfluencers=8),A&&A(y)};return A("POSITION",n.h.PositionKind),A("NORMAL",n.h.NormalKind),A("TANGENT",n.h.TangentKind),A("TEXCOORD_0",n.h.UVKind),A("TEXCOORD_1",n.h.UV2Kind),A("TEXCOORD_2",n.h.UV3Kind),A("TEXCOORD_3",n.h.UV4Kind),A("TEXCOORD_4",n.h.UV5Kind),A("TEXCOORD_5",n.h.UV6Kind),A("JOINTS_0",n.h.MatricesIndicesKind),A("WEIGHTS_0",n.h.MatricesWeightsKind),A("JOINTS_1",n.h.MatricesIndicesExtraKind),A("WEIGHTS_1",n.h.MatricesWeightsExtraKind),A("COLOR_0",n.h.ColorKind,(N=>{"VEC4"===N.type&&(R.hasVertexAlpha=!0)})),Promise.all(F).then((()=>S))}_createMorphTargets(N,q,R,z,v){if(!z.targets||!this._parent.loadMorphTargets)return;if(void 0==q._numMorphTargets)q._numMorphTargets=z.targets.length;else if(z.targets.length!==q._numMorphTargets)throw new Error(`${N}: Primitives do not have the same number of targets`);const B=R.extras?R.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,v.morphTargetManager=new g(this._babylonScene),v.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.morphTargetManager.areUpdatesFrozen=!0;for(let F=0;F<z.targets.length;F++){const N=q.weights?q.weights[F]:R.weights?R.weights[F]:0,z=B?B[F]:`morphTarget${F}`;v.morphTargetManager.addTarget(new J(z,N,v.va()))}}_loadMorphTargetsAsync(N,q,R,z){if(!q.targets||!this._parent.loadMorphTargets)return Promise.resolve();const v=new Array,B=R.morphTargetManager;for(let F=0;F<B.numTargets;F++){const R=B.getTarget(F);v.push(this._loadMorphTargetVertexDataAsync(`${N}/targets/${F}`,z,q.targets[F],R))}return Promise.all(v).then((()=>{B.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(N,q,R,z){const v=new Array,B=(z,B,F)=>{if(void 0==R[z])return;const S=q.getVertexBuffer(B);if(!S)return;const A=a.Get(`${N}/${z}`,this._gltf.accessors,R[z]);v.push(this._loadFloatAccessorAsync(`/accessors/${A.index}`,A).then((N=>{F(S,N)})))};return B("POSITION",n.h.PositionKind,((N,q)=>{const R=new Float32Array(q.length);N.forEach(q.length,((N,z)=>{R[z]=q[z]+N})),z.setPositions(R)})),B("NORMAL",n.h.NormalKind,((N,q)=>{const R=new Float32Array(q.length);N.forEach(R.length,((N,z)=>{R[z]=q[z]+N})),z.setNormals(R)})),B("TANGENT",n.h.TangentKind,((N,q)=>{const R=new Float32Array(q.length/3*4);let v=0;N.forEach(q.length/3*4,((N,z)=>{(z+1)%4!==0&&(R[v]=q[v]+N,v++)})),z.setTangents(R)})),Promise.all(v).then((()=>{}))}static _LoadTransform(N,q){if(void 0!=N.skin)return;let R=v.m.Zero(),z=v.g.Identity(),B=v.m.One();if(N.matrix){v.d.Zg(N.matrix).decompose(B,z,R)}else N.translation&&(R=v.m.Zg(N.translation)),N.rotation&&(z=v.g.Zg(N.rotation)),N.scale&&(B=v.m.Zg(N.scale));q.position=R,q.rotationQuaternion=z,q.re=B}_loadSkinAsync(N,q,R,z){if(!this._parent.loadSkins)return Promise.resolve();const v=this._extensionsLoadSkinAsync(N,q,R);if(v)return v;if(R._data)return z(R._data.babylonSkeleton),R._data.promise;const B=`skeleton${R.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new V(R.name||B,B,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(N,R,F);const S=this._loadSkinInverseBindMatricesDataAsync(N,R).then((N=>{this._updateBoneMatrices(F,N)}));return R._data={babylonSkeleton:F,promise:S},z(F),S}_loadBones(N,q,R){if(void 0==q.skeleton||this._parent.alwaysComputeSkeletonRootNode){const R=this._findSkeletonRootNode(`${N}/joints`,q.joints);if(R)if(void 0===q.skeleton)q.skeleton=R.index;else{const z=(N,q)=>{for(;q.parent;q=q.parent)if(q.parent===N)return!0;return!1},v=a.Get(`${N}/skeleton`,this._gltf.nodes,q.skeleton);v===R||z(v,R)||(f.c.Warn(`${N}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),q.skeleton=R.index)}else f.c.Warn(`${N}: Failed to find common root`)}const z={};for(const v of q.joints){const B=a.Get(`${N}/joints/${v}`,this._gltf.nodes,v);this._loadBone(B,q,R,z)}}_findSkeletonRootNode(N,q){if(0===q.length)return null;const R={};for(const v of q){const q=[];let z=a.Get(`${N}/${v}`,this._gltf.nodes,v);for(;-1!==z.index;)q.unshift(z),z=z.parent;R[v]=q}let z=null;for(let v=0;;++v){let N=R[q[0]];if(v>=N.length)return z;const B=N[v];for(let F=1;F<q.length;++F)if(N=R[q[F]],v>=N.length||B!==N[v])return z;z=B}}_loadBone(N,q,R,z){N._isJoint=!0;let v=z[N.index];if(v)return v;let B=null;N.index!==q.skeleton&&(N.parent&&-1!==N.parent.index?B=this._loadBone(N.parent,q,R,z):void 0!==q.skeleton&&f.c.Warn(`/skins/${q.index}/skeleton: Skeleton node is not a common root`));const F=q.joints.indexOf(N.index);return v=new y.e(N.name||`joint${N.index}`,R,B,this._getNodeMatrix(N),null,null,F),z[N.index]=v,this._postSceneLoadActions.push((()=>{v.linkTransformNode(N._babylonTransformNode)})),v}_loadSkinInverseBindMatricesDataAsync(N,q){if(void 0==q.inverseBindMatrices)return Promise.resolve(null);const R=a.Get(`${N}/inverseBindMatrices`,this._gltf.accessors,q.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${R.index}`,R)}_updateBoneMatrices(N,q){for(const R of N.bones){const N=v.d.Identity(),z=R._index;q&&-1!==z&&(v.d.FromArrayToRef(q,16*z,N),N.invertToRef(N));const B=R.getParent();B&&N.multiplyToRef(B.getAbsoluteInverseBindMatrix(),N),R.Hj(N,!1,!1),R._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(N){return N.matrix?v.d.Zg(N.matrix):v.d.Compose(N.scale?v.m.Zg(N.scale):v.m.One(),N.rotation?v.g.Zg(N.rotation):v.g.Identity(),N.translation?v.m.Zg(N.translation):v.m.Zero())}loadCameraAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadCameraAsync(N,q,R);if(z)return z;const B=new Array;this.logOpen(`${N} ${q.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new A.e(q.name||`camera${q.index}`,v.m.Zero(),this._babylonScene,!1);switch(F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.ignoreParentScaling=!0,q._babylonCamera=F,F.rotation.set(0,Math.PI,0),q.type){case"perspective":{const R=q.perspective;if(!R)throw new Error(`${N}: Camera perspective properties are missing`);F.fov=R.yfov,F.Wi=R.znear,F.maxZ=R.zfar||0;break}case"orthographic":if(!q.orthographic)throw new Error(`${N}: Camera orthographic properties are missing`);F.mode=S.e.ORTHOGRAPHIC_CAMERA,F.orthoLeft=-q.orthographic.xmag,F.orthoRight=q.orthographic.xmag,F.orthoBottom=-q.orthographic.ymag,F.orthoTop=q.orthographic.ymag,F.Wi=q.orthographic.znear,F.maxZ=q.orthographic.zfar;break;default:throw new Error(`${N}: Invalid camera type (${q.type})`)}return d.AddPointerMetadata(F,N),this._parent.onCameraLoadedObservable.notifyObservers(F),R(F),this.logClose(),Promise.all(B).then((()=>F))}_loadAnimationsAsync(){const N=this._gltf.animations;if(!N)return Promise.resolve();const q=new Array;for(let R=0;R<N.length;R++){const z=N[R];q.push(this.loadAnimationAsync(`/animations/${z.index}`,z).then((N=>{0===N.targetedAnimations.length&&N.dispose()})))}return Promise.all(q).then((()=>{}))}loadAnimationAsync(N,q){const z=this._extensionsLoadAnimationAsync(N,q);return z||R.e(38).then(R.bind(R,13380)).then((R=>{let{AnimationGroup:z}=R;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new z(q.name||`animation${q.index}`,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._babylonAnimationGroup=v;const B=new Array;a.Assign(q.channels),a.Assign(q.samplers);for(const F of q.channels)B.push(this._loadAnimationChannelAsync(`${N}/channels/${F.index}`,N,q,F,((N,q)=>{N.animations=N.animations||[],N.animations.push(q),v.addTargetedAnimation(q,N)})));return Promise.all(B).then((()=>(v.normalize(0),v)))}))}_loadAnimationChannelAsync(N,q,R,z,v){const B=this._extensionsLoadAnimationChannelAsync(N,q,R,z,v);if(B)return B;if(void 0==z.target.node)return Promise.resolve();const F=a.Get(`${N}/target/node`,this._gltf.nodes,z.target.node),S=z.target.path,A="weights"===S;if(A&&!F._numMorphTargets||!A&&!F._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!A&&!F._isJoint)return Promise.resolve();let y;switch(S){case"translation":y=P.translation;break;case"rotation":y=P.rotation;break;case"scale":y=P.scale;break;case"weights":y=P.weights;break;default:throw new Error(`${N}/target/path: Invalid value (${z.target.path})`)}const E={object:F,info:y};return this._loadAnimationChannelFromTargetInfoAsync(N,q,R,z,E,v)}_loadAnimationChannelFromTargetInfoAsync(N,q,R,z,v,B){const F=this.parent.targetFps,S=1/F,A=a.Get(`${N}/sampler`,R.samplers,z.sampler);return this._loadAnimationSamplerAsync(`${q}/samplers/${z.sampler}`,A).then((N=>{let q=0;const A=v.object,y=v.info;for(const v of y){const y=v.getStride(A),E=N.input,t=N.output,x=new Array(E.length);let e=0;switch(N.interpolation){case"STEP":for(let N=0;N<E.length;N++){const q=v.getValue(A,t,e,1);e+=y,x[N]={frame:E[N]*F,value:q,interpolation:1}}break;case"CUBICSPLINE":for(let N=0;N<E.length;N++){const q=v.getValue(A,t,e,S);e+=y;const R=v.getValue(A,t,e,1);e+=y;const z=v.getValue(A,t,e,S);e+=y,x[N]={frame:E[N]*F,inTangent:q,value:R,outTangent:z}}break;case"LINEAR":for(let N=0;N<E.length;N++){const q=v.getValue(A,t,e,1);e+=y,x[N]={frame:E[N]*F,value:q}}}if(e>0){const N=`${R.name||`animation${R.index}`}_channel${z.index}_${q}`;v.buildAnimations(A,N,F,x,((N,R)=>{++q,B(N,R)}))}}}))}_loadAnimationSamplerAsync(N,q){if(q._data)return q._data;const R=q.interpolation||"LINEAR";switch(R){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${N}/interpolation: Invalid value (${q.interpolation})`)}const z=a.Get(`${N}/input`,this._gltf.accessors,q.input),v=a.Get(`${N}/output`,this._gltf.accessors,q.output);return q._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${z.index}`,z),this._loadFloatAccessorAsync(`/accessors/${v.index}`,v)]).then((N=>{let[q,z]=N;return{input:q,interpolation:R,output:z}})),q._data}loadBufferAsync(N,q,R,z){const v=this._extensionsLoadBufferAsync(N,q,R,z);if(v)return v;if(!q._data)if(q.uri)q._data=this.loadUriAsync(`${N}/uri`,q,q.uri);else{if(!this._bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);q._data=this._bin.readAsync(0,q.byteLength)}return q._data.then((q=>{try{return new Uint8Array(q.buffer,q.byteOffset+R,z)}catch(v){throw new Error(`${N}: ${v.message}`)}}))}loadBufferViewAsync(N,q){const R=this._extensionsLoadBufferViewAsync(N,q);if(R)return R;if(q._data)return q._data;const z=a.Get(`${N}/buffer`,this._gltf.buffers,q.buffer);return q._data=this.loadBufferAsync(`/buffers/${z.index}`,z,q.byteOffset||0,q.byteLength),q._data}_loadAccessorAsync(N,q,R){if(q._data)return q._data;const z=d._GetNumComponents(N,q.type),v=z*n.h.GetTypeByteLength(q.componentType),B=z*q.count;if(void 0==q.bufferView)q._data=Promise.resolve(new R(B));else{const F=a.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((S=>{if(5126!==q.componentType||q.normalized||F.byteStride&&F.byteStride!==v){const N=new R(B);return n.h.ForEach(S,q.byteOffset||0,F.byteStride||v,z,q.componentType,N.length,q.normalized||!1,((q,R)=>{N[R]=q})),N}return d._GetTypedArray(N,q.componentType,S,q.byteOffset,B)}))}if(q.sparse){const B=q.sparse;q._data=q._data.then((F=>{const S=F,A=a.Get(`${N}/sparse/indices/bufferView`,this._gltf.bufferViews,B.indices.bufferView),y=a.Get(`${N}/sparse/values/bufferView`,this._gltf.bufferViews,B.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${A.index}`,A),this.loadBufferViewAsync(`/bufferViews/${y.index}`,y)]).then((F=>{let[A,y]=F;const E=d._GetTypedArray(`${N}/sparse/indices`,B.indices.componentType,A,B.indices.byteOffset,B.count),t=z*B.count;let x;if(5126!==q.componentType||q.normalized){const F=d._GetTypedArray(`${N}/sparse/values`,q.componentType,y,B.values.byteOffset,t);x=new R(t),n.h.ForEach(F,0,v,z,q.componentType,x.length,q.normalized||!1,((N,q)=>{x[q]=N}))}else x=d._GetTypedArray(`${N}/sparse/values`,q.componentType,y,B.values.byteOffset,t);let e=0;for(let N=0;N<E.length;N++){let q=E[N]*z;for(let N=0;N<z;N++)S[q++]=x[e++]}return S}))}))}return q._data}_loadFloatAccessorAsync(N,q){return this._loadAccessorAsync(N,q,Float32Array)}_loadIndicesAccessorAsync(N,q){if("SCALAR"!==q.type)throw new Error(`${N}/type: Invalid value ${q.type}`);if(5121!==q.componentType&&5123!==q.componentType&&5125!==q.componentType)throw new Error(`${N}/componentType: Invalid value ${q.componentType}`);if(q._data)return q._data;if(q.sparse){const R=d._GetTypedArrayConstructor(`${N}/componentType`,q.componentType);q._data=this._loadAccessorAsync(N,q,R)}else{const R=a.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R).then((R=>d._GetTypedArray(N,q.componentType,R,q.byteOffset,q.count)))}return q._data}_loadVertexBufferViewAsync(N){if(N._babylonBuffer)return N._babylonBuffer;const q=this._babylonScene.getEngine();return N._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>new n.e(q,N,!1))),N._babylonBuffer}_loadVertexAccessorAsync(N,q,R){var z;if(null!==(z=q._babylonVertexBuffer)&&void 0!==z&&z[R])return q._babylonVertexBuffer[R];q._babylonVertexBuffer||(q._babylonVertexBuffer={});const v=this._babylonScene.getEngine();if(q.sparse||void 0==q.bufferView)q._babylonVertexBuffer[R]=this._loadFloatAccessorAsync(N,q).then((N=>new n.h(v,N,R,!1)));else{const z=a.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._babylonVertexBuffer[R]=this._loadVertexBufferViewAsync(z).then((B=>{const F=d._GetNumComponents(N,q.type);return new n.h(v,B,R,!1,void 0,z.byteStride,void 0,q.byteOffset,F,q.componentType,q.normalized,!0,void 0,!0)}))}return q._babylonVertexBuffer[R]}_loadMaterialMetallicRoughnessPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return q&&(q.baseColorFactor?(R.albedoColor=B.c.Zg(q.baseColorFactor),R.alpha=q.baseColorFactor[3]):R.albedoColor=B.c.White(),R.metallic=void 0==q.metallicFactor?1:q.metallicFactor,R.roughness=void 0==q.roughnessFactor?1:q.roughnessFactor,q.baseColorTexture&&z.push(this.loadTextureInfoAsync(`${N}/baseColorTexture`,q.baseColorTexture,(N=>{N.name=`${R.name} (Base Color)`,R.albedoTexture=N}))),q.metallicRoughnessTexture&&(q.metallicRoughnessTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${N}/metallicRoughnessTexture`,q.metallicRoughnessTexture,(N=>{N.name=`${R.name} (Metallic Roughness)`,R.metallicTexture=N}))),R.useMetallnessFromMetallicTextureBlue=!0,R.useRoughnessFromMetallicTextureGreen=!0,R.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(z).then((()=>{}))}_loadMaterialAsync(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const B=this._extensionsLoadMaterialAsync(N,q,R,z,v);if(B)return B;q._data=q._data||{};let F=q._data[z];if(!F){this.logOpen(`${N} ${q.name||""}`);const R=this.createMaterial(N,q,z);F={babylonMaterial:R,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(N,q,R)},q._data[z]=F,d.AddPointerMetadata(R,N),this._parent.onMaterialLoadedObservable.notifyObservers(R),this.logClose()}return R&&(F.babylonMeshes.push(R),R.jj.addOnce((()=>{const N=F.babylonMeshes.indexOf(R);-1!==N&&F.babylonMeshes.splice(N,1)}))),v(F.babylonMaterial),F.promise.then((()=>F.babylonMaterial))}_createDefaultMaterial(N,q){this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new u(N,this._babylonScene);return R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R.fillMode=q,R.enableSpecularAntiAliasing=!0,R.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,R.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,R.transparencyMode=u.PBRMATERIAL_OPAQUE,R.metallic=1,R.roughness=1,R}createMaterial(N,q,R){const z=this._extensionsCreateMaterial(N,q,R);if(z)return z;const v=q.name||`material${q.index}`;return this._createDefaultMaterial(v,R)}loadMaterialPropertiesAsync(N,q,R){const z=this._extensionsLoadMaterialPropertiesAsync(N,q,R);if(z)return z;const v=new Array;return v.push(this.loadMaterialBasePropertiesAsync(N,q,R)),q.pbrMetallicRoughness&&v.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${N}/pbrMetallicRoughness`,q.pbrMetallicRoughness,R)),this.loadMaterialAlphaProperties(N,q,R),Promise.all(v).then((()=>{}))}loadMaterialBasePropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return R.emissiveColor=q.emissiveFactor?B.c.Zg(q.emissiveFactor):new B.c(0,0,0),q.doubleSided&&(R.hh=!1,R.twoSidedLighting=!0),q.normalTexture&&(q.normalTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${N}/normalTexture`,q.normalTexture,(N=>{N.name=`${R.name} (Normal)`,R.bumpTexture=N}))),R.invertNormalMapX=!this._babylonScene.useRightHandedSystem,R.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=q.normalTexture.scale&&R.bumpTexture&&(R.bumpTexture.level=q.normalTexture.scale),R.forceIrradianceInFragment=!0),q.occlusionTexture&&(q.occlusionTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${N}/occlusionTexture`,q.occlusionTexture,(N=>{N.name=`${R.name} (Occlusion)`,R.ambientTexture=N}))),R.useAmbientInGrayScale=!0,void 0!=q.occlusionTexture.strength&&(R.ambientTextureStrength=q.occlusionTexture.strength)),q.emissiveTexture&&z.push(this.loadTextureInfoAsync(`${N}/emissiveTexture`,q.emissiveTexture,(N=>{N.name=`${R.name} (Emissive)`,R.emissiveTexture=N}))),Promise.all(z).then((()=>{}))}loadMaterialAlphaProperties(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);switch(q.alphaMode||"OPAQUE"){case"OPAQUE":R.transparencyMode=u.PBRMATERIAL_OPAQUE,R.alpha=1;break;case"MASK":R.transparencyMode=u.PBRMATERIAL_ALPHATEST,R.alphaCutOff=void 0==q.alphaCutoff?.5:q.alphaCutoff,R.albedoTexture&&(R.albedoTexture.Fe=!0);break;case"BLEND":R.transparencyMode=u.PBRMATERIAL_ALPHABLEND,R.albedoTexture&&(R.albedoTexture.Fe=!0,R.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${N}/alphaMode: Invalid value (${q.alphaMode})`)}}loadTextureInfoAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureInfoAsync(N,q,R);if(z)return z;if(this.logOpen(`${N}`),q.texCoord>=6)throw new Error(`${N}/texCoord: Invalid value (${q.texCoord})`);const v=a.Get(`${N}/index`,this._gltf.textures,q.index);v._textureInfo=q;const B=this._loadTextureAsync(`/textures/${q.index}`,v,(z=>{z.coordinatesIndex=q.texCoord||0,d.AddPointerMetadata(z,N),this._parent.onTextureLoadedObservable.notifyObservers(z),R(z)}));return this.logClose(),B}_loadTextureAsync(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureAsync(N,q,R);if(z)return z;this.logOpen(`${N} ${q.name||""}`);const v=void 0==q.sampler?d.DefaultSampler:a.Get(`${N}/sampler`,this._gltf.samplers,q.sampler),B=a.Get(`${N}/source`,this._gltf.images,q.source),F=this._createTextureAsync(N,v,B,R,void 0,!q._textureInfo.nonColorData);return this.logClose(),F}_createTextureAsync(N,q,R){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},B=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0;const S=this._loadSampler(`/samplers/${q.index}`,q),A=new Array,y=new z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E={noMipmap:S.noMipMaps,invertY:!1,samplingMode:S.samplingMode,X:()=>{this._disposed||y.resolve()},onError:(q,R)=>{this._disposed||y.reject(new Error(`${N}: ${R&&R.message?R.message:q||"Failed to load texture"}`))},mimeType:R.mimeType,loaderOptions:B,useSRGBBuffer:!!F&&this._parent.useSRGBBuffers},t=new w.c(null,this._babylonScene,E);return t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.push(y.promise),A.push(this.loadImageAsync(`/images/${R.index}`,R).then((N=>{const q=R.uri||`${this._fileName}#image${R.index}`,z=`data:${this._uniqueRootUrl}${q}`;t.updateURL(z,N);const v=t.getInternalTexture();v&&(v.label=R.name)}))),t.wrapU=S.wrapU,t.wrapV=S.wrapV,v(t),this._parent.useGltfTextureNames&&(t.name=R.name||R.uri||`image${R.index}`),Promise.all(A).then((()=>t))}_loadSampler(N,q){return q._data||(q._data={noMipMaps:9728===q.minFilter||9729===q.minFilter,samplingMode:d._GetTextureSamplingMode(N,q),wrapU:d._GetTextureWrapMode(`${N}/wrapS`,q.wrapS),wrapV:d._GetTextureWrapMode(`${N}/wrapT`,q.wrapT)}),q._data}loadImageAsync(N,q){if(!q._data){if(this.logOpen(`${N} ${q.name||""}`),q.uri)q._data=this.loadUriAsync(`${N}/uri`,q,q.uri);else{const R=a.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R)}this.logClose()}return q._data}loadUriAsync(N,q,R){const z=this._extensionsLoadUriAsync(N,q,R);if(z)return z;if(!d._ValidateUri(R))throw new Error(`${N}: '${R}' is invalid`);if((0,l.i)(R)){const q=new Uint8Array((0,l.e)(R));return this.log(`${N}: Decoded ${R.substring(0,64)}... (${q.length} bytes)`),Promise.resolve(q)}return this.log(`${N}: Loading ${R}`),this._parent.preprocessUrlAsync(this._rootUrl+R).then((q=>new Promise(((z,v)=>{this._parent._loadFile(this._babylonScene,q,(q=>{this._disposed||(this.log(`${N}: Loaded ${R} (${q.byteLength} bytes)`),z(new Uint8Array(q)))}),!0,(q=>{v(new l.j(`${N}: Failed to load '${R}'${q?": "+q.status+" "+q.statusText:""}`,q))}))}))))}static AddPointerMetadata(N,q){N.metadata=N.metadata||{};const R=N._internalMetadata=N._internalMetadata||{},z=R.Oi=R.Oi||{};(z.pointers=z.pointers||[]).push(q)}static _GetTextureWrapMode(N,q){switch(q=void 0==q?10497:q){case 33071:return w.c.CLAMP_ADDRESSMODE;case 33648:return w.c.MIRROR_ADDRESSMODE;case 10497:return w.c.WRAP_ADDRESSMODE;default:return f.c.Warn(`${N}: Invalid value (${q})`),w.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(N,q){const R=void 0==q.magFilter?9729:q.magFilter,z=void 0==q.minFilter?9987:q.minFilter;if(9729===R)switch(z){case 9728:return w.c.LINEAR_NEAREST;case 9729:return w.c.LINEAR_LINEAR;case 9984:return w.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return w.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return w.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return w.c.LINEAR_LINEAR_MIPLINEAR;default:return f.c.Warn(`${N}/minFilter: Invalid value (${z})`),w.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==R&&f.c.Warn(`${N}/magFilter: Invalid value (${R})`),z){case 9728:return w.c.NEAREST_NEAREST;case 9729:return w.c.NEAREST_LINEAR;case 9984:return w.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return w.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return w.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return w.c.NEAREST_LINEAR_MIPLINEAR;default:return f.c.Warn(`${N}/minFilter: Invalid value (${z})`),w.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(N,q){switch(q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${N}: Invalid component type ${q}`)}}static _GetTypedArray(N,q,R,z,v){const B=R.buffer;z=R.byteOffset+(z||0);const F=d._GetTypedArrayConstructor(`${N}/componentType`,q),S=n.h.GetTypeByteLength(q);return z%S!==0?(f.c.Warn(`${N}: Copying buffer as byte offset (${z}) is not a multiple of component type byte length (${S})`),new F(B.slice(z,z+v*S),0)):new F(B,z,v)}static _GetNumComponents(N,q){switch(q){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${N}: Invalid type (${q})`)}static _ValidateUri(N){return F.f.IsBase64(N)||-1===N.indexOf("..")}static _GetDrawMode(N,q){switch(void 0==q&&(q=4),q){case 0:return H.d.PointListDrawMode;case 1:return H.d.LineListDrawMode;case 2:return H.d.LineLoopDrawMode;case 3:return H.d.LineStripDrawMode;case 4:return H.d.TriangleFillMode;case 5:return H.d.TriangleStripDrawMode;case 6:return H.d.TriangleFanDrawMode}throw new Error(`${N}: Invalid mesh primitive mode (${q})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const N=new Array;if(this._gltf.materials)for(const q of this._gltf.materials)if(q._data)for(const R in q._data){const z=q._data[R];for(const q of z.babylonMeshes){q.Oj(!0);const R=z.babylonMaterial;N.push(R.forceCompilationAsync(q)),N.push(R.forceCompilationAsync(q,{useInstances:!0})),this._parent.useClipPlane&&(N.push(R.forceCompilationAsync(q,{clipPlane:!0})),N.push(R.forceCompilationAsync(q,{clipPlane:!0,useInstances:!0})))}}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const N=new Array,q=this._babylonScene.lights;for(const R of q){const q=R.getShadowGenerator();q&&N.push(q.forceCompilationAsync())}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(N){for(const q of this._extensions)q.enabled&&N(q)}_applyExtensions(N,q,R){for(const z of this._extensions)if(z.enabled){const v=`${z.name}.${q}`,B=N;B._activeLoaderExtensionFunctions=B._activeLoaderExtensionFunctions||{};const F=B._activeLoaderExtensionFunctions;if(!F[v]){F[v]=!0;try{const N=R(z);if(N)return N}finally{delete F[v]}}}return null}_extensionsOnLoading(){this._forEachExtensions((N=>N.onLoading&&N.onLoading()))}_extensionsOnReady(){this._forEachExtensions((N=>N.onReady&&N.onReady()))}_extensionsLoadSceneAsync(N,q){return this._applyExtensions(q,"loadScene",(R=>R.loadSceneAsync&&R.loadSceneAsync(N,q)))}_extensionsLoadNodeAsync(N,q,R){return this._applyExtensions(q,"loadNode",(z=>z.loadNodeAsync&&z.loadNodeAsync(N,q,R)))}_extensionsLoadCameraAsync(N,q,R){return this._applyExtensions(q,"loadCamera",(z=>z.loadCameraAsync&&z.loadCameraAsync(N,q,R)))}_extensionsLoadVertexDataAsync(N,q,R){return this._applyExtensions(q,"loadVertexData",(z=>z._loadVertexDataAsync&&z._loadVertexDataAsync(N,q,R)))}_extensionsLoadMeshPrimitiveAsync(N,q,R,z,v,B){return this._applyExtensions(v,"loadMeshPrimitive",(F=>F._loadMeshPrimitiveAsync&&F._loadMeshPrimitiveAsync(N,q,R,z,v,B)))}_extensionsLoadMaterialAsync(N,q,R,z,v){return this._applyExtensions(q,"loadMaterial",(B=>B._loadMaterialAsync&&B._loadMaterialAsync(N,q,R,z,v)))}_extensionsCreateMaterial(N,q,R){return this._applyExtensions(q,"createMaterial",(z=>z.createMaterial&&z.createMaterial(N,q,R)))}_extensionsLoadMaterialPropertiesAsync(N,q,R){return this._applyExtensions(q,"loadMaterialProperties",(z=>z.loadMaterialPropertiesAsync&&z.loadMaterialPropertiesAsync(N,q,R)))}_extensionsLoadTextureInfoAsync(N,q,R){return this._applyExtensions(q,"loadTextureInfo",(z=>z.loadTextureInfoAsync&&z.loadTextureInfoAsync(N,q,R)))}_extensionsLoadTextureAsync(N,q,R){return this._applyExtensions(q,"loadTexture",(z=>z._loadTextureAsync&&z._loadTextureAsync(N,q,R)))}_extensionsLoadAnimationAsync(N,q){return this._applyExtensions(q,"loadAnimation",(R=>R.loadAnimationAsync&&R.loadAnimationAsync(N,q)))}_extensionsLoadAnimationChannelAsync(N,q,R,z,v){return this._applyExtensions(R,"loadAnimationChannel",(B=>B._loadAnimationChannelAsync&&B._loadAnimationChannelAsync(N,q,R,z,v)))}_extensionsLoadSkinAsync(N,q,R){return this._applyExtensions(R,"loadSkin",(z=>z._loadSkinAsync&&z._loadSkinAsync(N,q,R)))}_extensionsLoadUriAsync(N,q,R){return this._applyExtensions(q,"loadUri",(z=>z._loadUriAsync&&z._loadUriAsync(N,q,R)))}_extensionsLoadBufferViewAsync(N,q){return this._applyExtensions(q,"loadBufferView",(R=>R.loadBufferViewAsync&&R.loadBufferViewAsync(N,q)))}_extensionsLoadBufferAsync(N,q,R,z){return this._applyExtensions(q,"loadBuffer",(v=>v.loadBufferAsync&&v.loadBufferAsync(N,q,R,z)))}static LoadExtensionAsync(N,q,R,z){if(!q.extensions)return null;const v=q.extensions[R];return v?z(`${N}/extensions/${R}`,v):null}static LoadExtraAsync(N,q,R,z){if(!q.extras)return null;const v=q.extras[R];return v?z(`${N}/extras/${R}`,v):null}isExtensionUsed(N){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(N)}logOpen(N){this._parent._logOpen(N)}logClose(){this._parent._logClose()}log(N){this._parent._log(N)}startPerformanceCounter(N){this._parent._startPerformanceCounter(N)}endPerformanceCounter(N){this._parent._endPerformanceCounter(N)}}d.DefaultSampler={index:-1},j.d._CreateGLTF2Loader=N=>new d(N);var p=R(11680),W=R(12142),NN=R(12157);class qN extends NN.b{constructor(N,q,R){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",N),this._texture=N.getEngine().createRawCubeTexture(q,R,z,v,B,F,S,A)}update(N,q,R,z){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,N,q,R,z,v)}updateRGBDAsync(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,W.f)(this._texture,N,q,R,z).then((()=>{}))}clone(){return h.e.Clone((()=>{const N=this.va(),q=this._texture,R=new qN(N,q._bufferViewArray,q.width,q.format,q.type,q.generateMipMaps,q.invertY,q.samplingMode,q._compression);return 13===q.source&&R.updateRGBDAsync(q._bufferViewArrayArray,q._sphericalPolynomial,q._lodGenerationScale,q._lodGenerationOffset),R}),this)}}const RN="EXT_lights_image_based";class zN{constructor(N){this.name=RN,this._loader=N,this.enabled=this._loader.isExtensionUsed(RN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.Oi.extensions;if(N&&N[this.name]){const q=N[this.name];this._lights=q.lights}}loadSceneAsync(N,q){return d.LoadExtensionAsync(N,q,this.name,((R,z)=>{this._loader._allMaterialsDirtyRequired=!0;const v=new Array;v.push(this._loader.loadSceneAsync(N,q)),this._loader.logOpen(`${R}`);const B=a.Get(`${R}/light`,this._lights,z.eb);return v.push(this._loadLightAsync(`/extensions/${this.name}/lights/${z.eb}`,B).then((N=>{this._loader.babylonScene.environmentTexture=N}))),this._loader.logClose(),Promise.all(v).then((()=>{}))}))}_loadLightAsync(N,q){if(!q._loaded){const R=new Array;this._loader.logOpen(`${N}`);const z=new Array(q.specularImages.length);for(let v=0;v<q.specularImages.length;v++){const B=q.specularImages[v];z[v]=new Array(B.length);for(let q=0;q<B.length;q++){const F=`${N}/specularImages/${v}/${q}`;this._loader.logOpen(`${F}`);const S=B[q],A=a.Get(F,this._loader.Oi.images,S);R.push(this._loader.loadImageAsync(`/images/${S}`,A).then((N=>{z[v][q]=N}))),this._loader.logClose()}}this._loader.logClose(),q._loaded=Promise.all(R).then((()=>{const R=new qN(this._loader.babylonScene,null,q.specularImageSize);if(R.name=q.name||"environment",q._babylonTexture=R,void 0!=q.$i&&(R.level=q.$i),q.rotation){let N=v.g.Zg(q.rotation);this._loader.babylonScene.useRightHandedSystem||(N=v.g.Inverse(N)),v.d.FromQuaternionToRef(N,R.getReflectionTextureMatrix())}if(!q.irradianceCoefficients)throw new Error(`${N}: Irradiance coefficients are missing`);const B=p.b.Zg(q.irradianceCoefficients);B.scaleInPlace(q.$i),B.convertIrradianceToLambertianRadiance();const F=p.d.FromHarmonics(B),S=(z.length-1)/Math.log2(q.specularImageSize);return R.updateRGBDAsync(z,F,S)}))}return q._loaded.then((()=>q._babylonTexture))}}K(RN),C(RN,!0,(N=>new zN(N)));R(12163);const vN="EXT_mesh_gpu_instancing";class BN{constructor(N){this.name=vN,this._loader=N,this.enabled=this._loader.isExtensionUsed(vN)}dispose(){this._loader=null}loadNodeAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((N,z)=>{this._loader._disableInstancedMesh++;const B=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,R);if(this._loader._disableInstancedMesh--,!q._primitiveBabylonMeshes)return B;const F=new Array;let S=0;const A=q=>{if(void 0==z.attributes[q])return void F.push(Promise.resolve(null));const R=a.Get(`${N}/attributes/${q}`,this._loader.Oi.accessors,z.attributes[q]);if(F.push(this._loader._loadFloatAccessorAsync(`/accessors/${R.bufferView}`,R)),0===S)S=R.count;else if(S!==R.count)throw new Error(`${N}/attributes: Instance buffer accessors do not have the same count.`)};return A("TRANSLATION"),A("ROTATION"),A("SCALE"),B.then((N=>Promise.all(F).then((R=>{let[z,B,F]=R;const A=new Float32Array(16*S);v.k.o[0].qe(0,0,0),v.k.Quaternion[0].qe(0,0,0,1),v.k.o[1].qe(1,1,1);for(let N=0;N<S;++N)z&&v.m.FromArrayToRef(z,3*N,v.k.o[0]),B&&v.g.FromArrayToRef(B,4*N,v.k.Quaternion[0]),F&&v.m.FromArrayToRef(F,3*N,v.k.o[1]),v.d.ComposeToRef(v.k.o[1],v.k.Quaternion[0],v.k.o[0],v.k.Matrix[0]),v.k.Matrix[0].copyToArray(A,16*N);for(const N of q._primitiveBabylonMeshes)N.mc("matrix",A,16,!0);return N}))))}))}}K(vN),C(vN,!0,(N=>new BN(N)));class FN{static get Default(){return FN._Default||(FN._Default=new FN),FN._Default}constructor(){const N=FN.Configuration.decoder;this._decoderModulePromise=F.f.LoadBabylonScriptAsync(N.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(N,q,R,z,v){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const B=await MeshoptDecoder.decodeGltfBufferAsync(q,R,N,z,v);return MeshoptDecoder.useWorkers(0),B}))}}FN.Configuration={decoder:{url:`${F.f._DefaultCdnUrl}/meshopt_decoder.js`}},FN._Default=null;const SN="EXT_meshopt_compression";class AN{constructor(N){this.name=SN,this.enabled=N.isExtensionUsed(SN),this._loader=N}dispose(){this._loader=null}loadBufferViewAsync(N,q){return d.LoadExtensionAsync(N,q,this.name,((R,z)=>{const v=q;if(v._meshOptData)return v._meshOptData;const B=a.Get(`${N}/buffer`,this._loader.Oi.buffers,z.buffer);return v._meshOptData=this._loader.loadBufferAsync(`/buffers/${B.index}`,B,z.byteOffset||0,z.byteLength).then((N=>FN.Default.decodeGltfBufferAsync(N,z.count,z.byteStride,z.mode,z.filter))),v._meshOptData}))}}K(SN),C(SN,!0,(N=>new AN(N)));const yN="EXT_texture_webp";class EN{constructor(N){this.name=yN,this._loader=N,this.enabled=N.isExtensionUsed(yN)}dispose(){this._loader=null}_loadTextureAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=void 0==q.sampler?d.DefaultSampler:a.Get(`${N}/sampler`,this._loader.Oi.samplers,q.sampler),F=a.Get(`${z}/source`,this._loader.Oi.images,v.source);return this._loader._createTextureAsync(N,B,F,(N=>{R(N)}),void 0,!q._textureInfo.nonColorData)}))}}K(yN),C(yN,!0,(N=>new EN(N)));const tN="EXT_texture_avif";class xN{constructor(N){this.name=tN,this._loader=N,this.enabled=N.isExtensionUsed(tN)}dispose(){this._loader=null}_loadTextureAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=void 0==q.sampler?d.DefaultSampler:a.Get(`${N}/sampler`,this._loader.Oi.samplers,q.sampler),F=a.Get(`${z}/source`,this._loader.Oi.images,v.source);return this._loader._createTextureAsync(N,B,F,(N=>{R(N)}),void 0,!q._textureInfo.nonColorData)}))}}K(tN),C(tN,!0,(N=>new xN(N)));var eN=R(12165);const bN="KHR_draco_mesh_compression";class fN{constructor(N){this.name=bN,this.useNormalizedFlagFromAccessor=!0,this._loader=N,this.enabled=eN.c.DecoderAvailable&&this._loader.isExtensionUsed(bN)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{if(void 0!=q.mode&&4!==q.mode&&5!==q.mode)throw new Error(`${N}: Unsupported mode ${q.mode}`);const B={},F={},S=(N,z)=>{const S=v.attributes[N];if(void 0!=S&&(R._delayInfo=R._delayInfo||[],-1===R._delayInfo.indexOf(z)&&R._delayInfo.push(z),B[z]=S,this.useNormalizedFlagFromAccessor)){const R=a.TryGet(this._loader.Oi.accessors,q.attributes[N]);R&&(F[z]=R.normalized||!1)}};S("POSITION",n.h.PositionKind),S("NORMAL",n.h.NormalKind),S("TANGENT",n.h.TangentKind),S("TEXCOORD_0",n.h.UVKind),S("TEXCOORD_1",n.h.UV2Kind),S("TEXCOORD_2",n.h.UV3Kind),S("TEXCOORD_3",n.h.UV4Kind),S("TEXCOORD_4",n.h.UV5Kind),S("TEXCOORD_5",n.h.UV6Kind),S("JOINTS_0",n.h.MatricesIndicesKind),S("WEIGHTS_0",n.h.MatricesWeightsKind),S("COLOR_0",n.h.ColorKind);const A=a.Get(z,this._loader.Oi.bufferViews,v.bufferView);return A._dracoBabylonGeometry||(A._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((q=>(this.dracoCompression||eN.c.Default)._decodeMeshToGeometryForGltfAsync(R.name,this._loader.babylonScene,q,B,F).catch((q=>{throw new Error(`${N}: ${q.message}`)}))))),A._dracoBabylonGeometry}))}}K(bN),C(bN,!0,(N=>new fN(N)));var DN=R(12177),VN=R(11454),HN=R(12127),YN=R(12183);VN.c.AddNodeConstructor("Light_Type_0",((N,q)=>()=>new TN(N,v.m.Zero(),q)));class TN extends YN.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(N){this._shadowAngle=N,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(N){const q=this.needCube();if(this._direction=N,this.needCube()!==q&&this._shadowGenerators){const N=this._shadowGenerators.values();for(let q=N.next();!0!==q.done;q=N.next()){q.value.recreateShadowMap()}}}constructor(N,q,R){super(N,R),this._shadowAngle=Math.PI/2,this.position=q}getClassName(){return"PointLight"}getTypeID(){return HN.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(N){if(this.direction)return super.getShadowDirection(N);switch(N){case 0:return new v.m(1,0,0);case 1:return new v.m(-1,0,0);case 2:return new v.m(0,-1,0);case 3:return new v.m(0,1,0);case 4:return new v.m(0,0,1);case 5:return new v.m(0,0,-1)}return v.m.Zero()}_setDefaultShadowProjectionMatrix(N,q,R){const z=this.va().activeCamera;if(!z)return;const B=void 0!==this.shadowMinZ?this.shadowMinZ:z.Wi,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,S=this.va().getEngine().useReverseDepthBuffer;v.d.PerspectiveFovLHToRef(this.shadowAngle,1,S?F:B,S?B:F,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,q){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,q):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,q),this}transferToNodeMaterialEffect(N,q){return this.computeTransformedInformation()?N.setFloat3(q,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):N.setFloat3(q,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(N,q){N["POINTLIGHT"+q]=!0}}(0,Y.c)([(0,T.D)()],TN.prototype,"shadowAngle",null),(0,Q.f)("BABYLON.PointLight",TN),VN.c.AddNodeConstructor("Light_Type_2",((N,q)=>()=>new LN(N,v.m.Zero(),v.m.Zero(),0,0,q)));class LN extends YN.d{get angle(){return this._angle}set angle(N){this._angle=N,this._cosHalfAngle=Math.cos(.5*N),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(N){this._innerAngle=N,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(N){this._shadowAngleScale=N,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(N){this._projectionTextureLightNear=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(N){this._projectionTextureLightFar=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(N){this._projectionTextureUpDirection=N,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(N){this._projectionTexture!==N&&(this._projectionTexture=N,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(LN._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):LN._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(N){return void 0!==N.onGeneratedObservable}static _IsTexture(N){return void 0!==N.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(N){this._projectionTextureProjectionLightMatrix=N,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(N,q,R,z,B,F){super(N,F),this._innerAngle=0,this._projectionTextureMatrix=v.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=v.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=v.m.Zero(),this._projectionTextureViewLightMatrix=v.d.Zero(),this._projectionTextureProjectionLightMatrix=v.d.Zero(),this._projectionTextureScalingMatrix=v.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=q,this.direction=R,this.angle=z,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return HN.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(N){super._setDirection(N),this._projectionTextureViewLightDirty=!0}_setPosition(N){super._setPosition(N),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(N,q,R){const z=this.va().activeCamera;if(!z)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,F=void 0!==this.shadowMinZ?this.shadowMinZ:z.Wi,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,A=this.va().getEngine().useReverseDepthBuffer;v.d.PerspectiveFovLHToRef(B,1,A?S:F,A?F:S,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,A)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),v.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const N=this.projectionTextureLightFar,q=this.projectionTextureLightNear,R=N/(N-q),z=-R*q,B=1/Math.tan(this._angle/2);v.d.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,R,1,0,0,z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof w.c){const N=this._projectionTexture.uScale/2,q=this._projectionTexture.vScale/2;v.d.FromValuesToRef(N,0,0,0,0,q,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(N,q){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),N.setMatrix("textureProjectionMatrix"+q,this._projectionTextureMatrix),N.setTexture("projectionLightTexture"+q,this.projectionTexture)),this}transferToEffect(N,q){let R;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,q),R=v.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,q),R=v.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",R.x,R.y,R.z,this._cosHalfAngle,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,q),this}transferToNodeMaterialEffect(N,q){let R;return R=this.computeTransformedInformation()?v.m.Normalize(this.transformedDirection):v.m.Normalize(this.direction),this.va().useRightHandedSystem?N.setFloat3(q,-R.x,-R.y,-R.z):N.setFloat3(q,R.x,R.y,R.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(N){const q=this._scene.getEngine(),R=void 0!==this.shadowMinZ?this.shadowMinZ:N.Wi;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?R:this._scene.getEngine().isNDCHalfZRange?0:R}getDepthMaxZ(N){const q=this._scene.getEngine(),R=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:R}prepareLightSpecificDefines(N,q){N["SPOTLIGHT"+q]=!0,N["PROJECTEDLIGHTTEXTURE"+q]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,Y.c)([(0,T.D)()],LN.prototype,"angle",null),(0,Y.c)([(0,T.D)()],LN.prototype,"innerAngle",null),(0,Y.c)([(0,T.D)()],LN.prototype,"shadowAngleScale",null),(0,Y.c)([(0,T.D)()],LN.prototype,"exponent",void 0),(0,Y.c)([(0,T.D)()],LN.prototype,"projectionTextureLightNear",null),(0,Y.c)([(0,T.D)()],LN.prototype,"projectionTextureLightFar",null),(0,Y.c)([(0,T.D)()],LN.prototype,"projectionTextureUpDirection",null),(0,Y.c)([(0,T.x)("projectedLightTexture")],LN.prototype,"_projectionTexture",void 0),(0,Q.f)("BABYLON.SpotLight",LN);const XN="KHR_lights_punctual";class QN{constructor(N){this.name=XN,this._loader=N,this.enabled=this._loader.isExtensionUsed(XN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.Oi.extensions;if(N&&N[this.name]){const q=N[this.name];this._lights=q.lights,a.Assign(this._lights)}}loadNodeAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,F)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(N,q,(N=>{let q;const S=a.Get(z,this._lights,F.eb),A=S.name||N.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S.type){case"directional":{const N=new DN.e(A,v.m.Backward(),this._loader.babylonScene);N.position.oe(0),q=N;break}case"point":q=new TN(A,v.m.Zero(),this._loader.babylonScene);break;case"spot":{const N=new LN(A,v.m.Zero(),v.m.Backward(),0,1,this._loader.babylonScene);N.angle=2*(S.spot&&S.spot.outerConeAngle||Math.PI/4),N.innerAngle=2*(S.spot&&S.spot.innerConeAngle||0),q=N;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${z}: Invalid light type (${S.type})`)}q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,S._babylonLight=q,q.falloffType=HN.e.FALLOFF_GLTF,q.Ch=S.color?B.c.Zg(S.color):B.c.White(),q.$i=void 0==S.$i?1:S.$i,q.range=void 0==S.range?Number.MAX_VALUE:S.range,q.parent=N,this._loader._babylonLights.push(q),d.AddPointerMetadata(q,z),R(N)})))))}}K(XN),C(XN,!0,(N=>new QN(N)));const hN="KHR_materials_pbrSpecularGlossiness";class uN{constructor(N){this.name=hN,this.order=200,this._loader=N,this.enabled=this._loader.isExtensionUsed(hN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialBasePropertiesAsync(N,q,R)),B.push(this._loadSpecularGlossinessPropertiesAsync(z,v,R)),this._loader.loadMaterialAlphaProperties(N,q,R),Promise.all(B).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return R.metallic=null,R.roughness=null,q.diffuseFactor?(R.albedoColor=B.c.Zg(q.diffuseFactor),R.alpha=q.diffuseFactor[3]):R.albedoColor=B.c.White(),R.reflectivityColor=q.specularFactor?B.c.Zg(q.specularFactor):B.c.White(),R.microSurface=void 0==q.glossinessFactor?1:q.glossinessFactor,q.diffuseTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTexture`,q.diffuseTexture,(N=>{N.name=`${R.name} (Diffuse)`,R.albedoTexture=N}))),q.specularGlossinessTexture&&(z.push(this._loader.loadTextureInfoAsync(`${N}/specularGlossinessTexture`,q.specularGlossinessTexture,(N=>{N.name=`${R.name} (Specular Glossiness)`,R.reflectivityTexture=N,R.reflectivityTexture.Fe=!0}))),R.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(z).then((()=>{}))}}K(hN),C(hN,!0,(N=>new uN(N)));const wN="KHR_materials_unlit";class cN{constructor(N){this.name=wN,this.order=210,this._loader=N,this.enabled=this._loader.isExtensionUsed(wN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,(()=>this._loadUnlitPropertiesAsync(N,q,R)))}_loadUnlitPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;R.unlit=!0;const v=q.pbrMetallicRoughness;return v&&(v.baseColorFactor?(R.albedoColor=B.c.Zg(v.baseColorFactor),R.alpha=v.baseColorFactor[3]):R.albedoColor=B.c.White(),v.baseColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/baseColorTexture`,v.baseColorTexture,(N=>{N.name=`${R.name} (Base Color)`,R.albedoTexture=N})))),q.doubleSided&&(R.hh=!1,R.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(N,q,R),Promise.all(z).then((()=>{}))}}K(wN),C(wN,!0,(N=>new cN(N)));const nN="KHR_materials_clearcoat";class GN{constructor(N){this.name=nN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(nN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadClearCoatPropertiesAsync(z,v,R)),Promise.all(B).then((()=>{}))}))}_loadClearCoatPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return R.clearCoat.isEnabled=!0,R.clearCoat.useRoughnessFromMainTexture=!1,R.clearCoat.remapF0OnInterfaceChange=!1,void 0!=q.clearcoatFactor?R.clearCoat.$i=q.clearcoatFactor:R.clearCoat.$i=0,q.clearcoatTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatTexture`,q.clearcoatTexture,(N=>{N.name=`${R.name} (ClearCoat)`,R.clearCoat.texture=N}))),void 0!=q.clearcoatRoughnessFactor?R.clearCoat.roughness=q.clearcoatRoughnessFactor:R.clearCoat.roughness=0,q.clearcoatRoughnessTexture&&(q.clearcoatRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatRoughnessTexture`,q.clearcoatRoughnessTexture,(N=>{N.name=`${R.name} (ClearCoat Roughness)`,R.clearCoat.textureRoughness=N})))),q.clearcoatNormalTexture&&(q.clearcoatNormalTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatNormalTexture`,q.clearcoatNormalTexture,(N=>{N.name=`${R.name} (ClearCoat Normal)`,R.clearCoat.bumpTexture=N}))),R.invertNormalMapX=!R.va().useRightHandedSystem,R.invertNormalMapY=R.va().useRightHandedSystem,void 0!=q.clearcoatNormalTexture.scale&&(R.clearCoat.bumpTexture.level=q.clearcoatNormalTexture.scale)),Promise.all(z).then((()=>{}))}}K(nN),C(nN,!0,(N=>new GN(N)));const sN="KHR_materials_iridescence";class ZN{constructor(N){this.name=sN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(sN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadIridescencePropertiesAsync(z,v,R)),Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return R.iridescence.isEnabled=!0,R.iridescence.$i=q.iridescenceFactor??0,R.iridescence.indexOfRefraction=q.iridescenceIor??q.iridescenceIOR??1.3,R.iridescence.minimumThickness=q.iridescenceThicknessMinimum??100,R.iridescence.maximumThickness=q.iridescenceThicknessMaximum??400,q.iridescenceTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceTexture`,q.iridescenceTexture,(N=>{N.name=`${R.name} (Iridescence)`,R.iridescence.texture=N}))),q.iridescenceThicknessTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceThicknessTexture`,q.iridescenceThicknessTexture,(N=>{N.name=`${R.name} (Iridescence Thickness)`,R.iridescence.thicknessTexture=N}))),Promise.all(z).then((()=>{}))}}K(sN),C(sN,!0,(N=>new ZN(N)));const JN="KHR_materials_anisotropy";class MN{constructor(N){this.name=JN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(JN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadIridescencePropertiesAsync(z,v,R)),Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return R.anisotropy.isEnabled=!0,R.anisotropy.$i=q.anisotropyStrength??0,R.anisotropy.angle=q.anisotropyRotation??0,q.anisotropyTexture&&(q.anisotropyTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${N}/anisotropyTexture`,q.anisotropyTexture,(N=>{N.name=`${R.name} (Anisotropy Intensity)`,R.anisotropy.texture=N})))),Promise.all(z).then((()=>{}))}}K(JN),C(JN,!0,(N=>new MN(N)));const mN="KHR_materials_emissive_strength";class gN{constructor(N){this.name=mN,this.order=170,this._loader=N,this.enabled=this._loader.isExtensionUsed(mN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>this._loader.loadMaterialPropertiesAsync(N,q,R).then((()=>{this._loadEmissiveProperties(z,v,R)}))))}_loadEmissiveProperties(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);void 0!==q.emissiveStrength&&(R.emissiveIntensity=q.emissiveStrength)}}K(mN),C(mN,!0,(N=>new gN(N)));const jN="KHR_materials_sheen";class lN{constructor(N){this.name=jN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(jN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadSheenPropertiesAsync(z,v,R)),Promise.all(B).then((()=>{}))}))}_loadSheenPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return R.sheen.isEnabled=!0,R.sheen.$i=1,void 0!=q.sheenColorFactor?R.sheen.color=B.c.Zg(q.sheenColorFactor):R.sheen.color=B.c.Black(),q.sheenColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/sheenColorTexture`,q.sheenColorTexture,(N=>{N.name=`${R.name} (Sheen Color)`,R.sheen.texture=N}))),void 0!==q.sheenRoughnessFactor?R.sheen.roughness=q.sheenRoughnessFactor:R.sheen.roughness=0,q.sheenRoughnessTexture&&(q.sheenRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${N}/sheenRoughnessTexture`,q.sheenRoughnessTexture,(N=>{N.name=`${R.name} (Sheen Roughness)`,R.sheen.textureRoughness=N})))),R.sheen.albedoScaling=!0,R.sheen.useRoughnessFromMainTexture=!1,Promise.all(z).then((()=>{}))}}K(jN),C(jN,!0,(N=>new lN(N)));const IN="KHR_materials_specular";class UN{constructor(N){this.name=IN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(IN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadSpecularPropertiesAsync(z,v,R)),Promise.all(B).then((()=>{}))}))}_loadSpecularPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const z=new Array;return void 0!==q.specularFactor&&(R.metallicF0Factor=q.specularFactor),void 0!==q.specularColorFactor&&(R.metallicReflectanceColor=B.c.Zg(q.specularColorFactor)),q.specularTexture&&(q.specularTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${N}/specularTexture`,q.specularTexture,(N=>{N.name=`${R.name} (Specular)`,R.metallicReflectanceTexture=N,R.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),q.specularColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/specularColorTexture`,q.specularColorTexture,(N=>{N.name=`${R.name} (Specular Color)`,R.reflectanceTexture=N}))),Promise.all(z).then((()=>{}))}}K(IN),C(IN,!0,(N=>new UN(N)));const ON="KHR_materials_ior";class iN{constructor(N){this.name=ON,this.order=180,this._loader=N,this.enabled=this._loader.isExtensionUsed(ON)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadIorPropertiesAsync(z,v,R)),Promise.all(B).then((()=>{}))}))}_loadIorPropertiesAsync(N,q,R){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);return void 0!==q.ior?R.indexOfRefraction=q.ior:R.indexOfRefraction=iN._DEFAULT_IOR,Promise.resolve()}}iN._DEFAULT_IOR=1.5,K(ON),C(ON,!0,(N=>new iN(N)));const PN="KHR_materials_variants";class kN{constructor(N){this.name=PN,this._loader=N,this.enabled=this._loader.isExtensionUsed(PN)}dispose(){this._loader=null}static GetAvailableVariants(N){const q=this._GetExtensionMetadata(N);return q?Object.keys(q.variants):[]}getAvailableVariants(N){return kN.GetAvailableVariants(N)}static SelectVariant(N,q){const R=this._GetExtensionMetadata(N);if(!R)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${PN} extension`);const z=N=>{const q=R.variants[N];if(q)for(const R of q)R.mesh.material=R.material};if(q instanceof Array)for(const v of q)z(v);else z(q);R.lastSelected=q}selectVariant(N,q){kN.SelectVariant(N,q)}static Reset(N){const q=this._GetExtensionMetadata(N);if(!q)throw new Error(`Cannot reset on a glTF mesh that does not have the ${PN} extension`);for(const R of q.original)R.mesh.material=R.material;q.lastSelected=null}reset(N){kN.Reset(N)}static GetLastSelectedVariant(N){const q=this._GetExtensionMetadata(N);if(!q)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${PN} extension`);return q.lastSelected}getLastSelectedVariant(N){return kN.GetLastSelectedVariant(N)}static _GetExtensionMetadata(N){var q,R;return(null===N||void 0===N||null===(q=N._internalMetadata)||void 0===q||null===(R=q.Oi)||void 0===R?void 0:R[PN])||null}onLoading(){const N=this._loader.Oi.extensions;if(N&&N[this.name]){const q=N[this.name];this._variants=q.variants}}_loadMeshPrimitiveAsync(N,q,R,z,v,B){return d.LoadExtensionAsync(N,v,this.name,((F,S)=>{const A=new Array;return A.push(this._loader._loadMeshPrimitiveAsync(N,q,R,z,v,(q=>{if(B(q),q instanceof Z.b){const R=d._GetDrawMode(N,v.mode),z=this._loader.rootBabylonMesh,B=z?z._internalMetadata=z._internalMetadata||{}:{},y=B.Oi=B.Oi||{},E=y[PN]=y[PN]||{lastSelected:null,original:[],variants:{}};E.original.push({mesh:q,material:q.material});for(let N=0;N<S.mappings.length;++N){const v=S.mappings[N],B=a.Get(`${F}/mappings/${N}/material`,this._loader.Oi.materials,v.material);A.push(this._loader._loadMaterialAsync(`#/materials/${v.material}`,B,q,R,(N=>{for(let R=0;R<v.variants.length;++R){const B=v.variants[R],F=a.Get(`/extensions/${PN}/variants/${B}`,this._variants,B);E.variants[F.name]=E.variants[F.name]||[],E.variants[F.name].push({mesh:q,material:N}),q.onClonedObservable.add((N=>{const R=N;let v=null,B=R;do{if(B=B.parent,!B)return;v=kN._GetExtensionMetadata(B)}while(null===v);if(z&&v===kN._GetExtensionMetadata(z)){B._internalMetadata={};for(const N in z._internalMetadata)B._internalMetadata[N]=z._internalMetadata[N];B._internalMetadata.Oi=[];for(const N in z._internalMetadata.Oi)B._internalMetadata.Oi[N]=z._internalMetadata.Oi[N];B._internalMetadata.Oi[PN]={lastSelected:null,original:[],variants:{}};for(const N of v.original)B._internalMetadata.Oi[PN].original.push({mesh:N.mesh,material:N.material});for(const N in v.variants)if(Object.prototype.hasOwnProperty.call(v.variants,N)){B._internalMetadata.Oi[PN].variants[N]=[];for(const q of v.variants[N])B._internalMetadata.Oi[PN].variants[N].push({mesh:q.mesh,material:q.material})}v=B._internalMetadata.Oi[PN]}for(const z of v.original)z.mesh===q&&(z.mesh=R);for(const z of v.variants[F.name])z.mesh===q&&(z.mesh=R)}))}})))}}}))),Promise.all(A).then((N=>{let[q]=N;return q}))}))}}K(PN),C(PN,!0,(N=>new kN(N)));var oN=R(11711);class CN{}CN.AUTOSAMPLERSUFFIX="Sampler",CN.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",CN.ALPHA_DISABLE=0,CN.ALPHA_ADD=1,CN.ALPHA_COMBINE=2,CN.ALPHA_SUBTRACT=3,CN.ALPHA_MULTIPLY=4,CN.ALPHA_MAXIMIZED=5,CN.ALPHA_ONEONE=6,CN.ALPHA_PREMULTIPLIED=7,CN.ALPHA_PREMULTIPLIED_PORTERDUFF=8,CN.ALPHA_INTERPOLATE=9,CN.ALPHA_SCREENMODE=10,CN.ALPHA_ONEONE_ONEONE=11,CN.ALPHA_ALPHATOCOLOR=12,CN.ALPHA_REVERSEONEMINUS=13,CN.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,CN.ALPHA_ONEONE_ONEZERO=15,CN.ALPHA_EXCLUSION=16,CN.ALPHA_LAYER_ACCUMULATE=17,CN.ALPHA_EQUATION_ADD=0,CN.ALPHA_EQUATION_SUBSTRACT=1,CN.ALPHA_EQUATION_REVERSE_SUBTRACT=2,CN.ALPHA_EQUATION_MAX=3,CN.ALPHA_EQUATION_MIN=4,CN.ALPHA_EQUATION_DARKEN=5,CN.DELAYLOADSTATE_NONE=0,CN.DELAYLOADSTATE_LOADED=1,CN.DELAYLOADSTATE_LOADING=2,CN.DELAYLOADSTATE_NOTLOADED=4,CN.NEVER=512,CN.ALWAYS=519,CN.LESS=513,CN.EQUAL=514,CN.LEQUAL=515,CN.GREATER=516,CN.GEQUAL=518,CN.NOTEQUAL=517,CN.KEEP=7680,CN.ZERO=0,CN.REPLACE=7681,CN.INCR=7682,CN.DECR=7683,CN.INVERT=5386,CN.INCR_WRAP=34055,CN.DECR_WRAP=34056,CN.TEXTURE_CLAMP_ADDRESSMODE=0,CN.TEXTURE_WRAP_ADDRESSMODE=1,CN.TEXTURE_MIRROR_ADDRESSMODE=2,CN.TEXTURE_CREATIONFLAG_STORAGE=1,CN.TEXTUREFORMAT_ALPHA=0,CN.TEXTUREFORMAT_LUMINANCE=1,CN.TEXTUREFORMAT_LUMINANCE_ALPHA=2,CN.TEXTUREFORMAT_RGB=4,CN.TEXTUREFORMAT_RGBA=5,CN.TEXTUREFORMAT_RED=6,CN.TEXTUREFORMAT_R=6,CN.TEXTUREFORMAT_RG=7,CN.TEXTUREFORMAT_RED_INTEGER=8,CN.TEXTUREFORMAT_R_INTEGER=8,CN.TEXTUREFORMAT_RG_INTEGER=9,CN.TEXTUREFORMAT_RGB_INTEGER=10,CN.TEXTUREFORMAT_RGBA_INTEGER=11,CN.TEXTUREFORMAT_BGRA=12,CN.TEXTUREFORMAT_DEPTH24_STENCIL8=13,CN.TEXTUREFORMAT_DEPTH32_FLOAT=14,CN.TEXTUREFORMAT_DEPTH16=15,CN.TEXTUREFORMAT_DEPTH24=16,CN.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,CN.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,CN.TEXTUREFORMAT_STENCIL8=19,CN.TEXTUREFORMAT_UNDEFINED=4294967295,CN.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,CN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,CN.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,CN.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,CN.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,CN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,CN.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,CN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,CN.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,CN.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,CN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,CN.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,CN.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,CN.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,CN.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,CN.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,CN.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,CN.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,CN.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,CN.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,CN.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,CN.TEXTURETYPE_UNSIGNED_BYTE=0,CN.TEXTURETYPE_UNSIGNED_INT=0,CN.TEXTURETYPE_FLOAT=1,CN.TEXTURETYPE_HALF_FLOAT=2,CN.TEXTURETYPE_BYTE=3,CN.TEXTURETYPE_SHORT=4,CN.TEXTURETYPE_UNSIGNED_SHORT=5,CN.TEXTURETYPE_INT=6,CN.TEXTURETYPE_UNSIGNED_INTEGER=7,CN.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,CN.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,CN.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,CN.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,CN.TEXTURETYPE_UNSIGNED_INT_24_8=12,CN.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,CN.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,CN.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,CN.TEXTURETYPE_UNDEFINED=16,CN.TEXTURE_2D=3553,CN.TEXTURE_2D_ARRAY=35866,CN.TEXTURE_CUBE_MAP=34067,CN.TEXTURE_CUBE_MAP_ARRAY=3735928559,CN.TEXTURE_3D=32879,CN.TEXTURE_NEAREST_SAMPLINGMODE=1,CN.TEXTURE_NEAREST_NEAREST=1,CN.TEXTURE_BILINEAR_SAMPLINGMODE=2,CN.TEXTURE_LINEAR_LINEAR=2,CN.TEXTURE_TRILINEAR_SAMPLINGMODE=3,CN.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,CN.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,CN.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,CN.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,CN.TEXTURE_NEAREST_LINEAR=7,CN.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,CN.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,CN.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,CN.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,CN.TEXTURE_LINEAR_NEAREST=12,CN.TEXTURE_EXPLICIT_MODE=0,CN.TEXTURE_SPHERICAL_MODE=1,CN.TEXTURE_PLANAR_MODE=2,CN.TEXTURE_CUBIC_MODE=3,CN.TEXTURE_PROJECTION_MODE=4,CN.TEXTURE_SKYBOX_MODE=5,CN.TEXTURE_INVCUBIC_MODE=6,CN.TEXTURE_EQUIRECTANGULAR_MODE=7,CN.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,CN.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,CN.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,CN.TEXTURE_FILTERING_QUALITY_HIGH=64,CN.TEXTURE_FILTERING_QUALITY_MEDIUM=16,CN.TEXTURE_FILTERING_QUALITY_LOW=8,CN.SCALEMODE_FLOOR=1,CN.SCALEMODE_NEAREST=2,CN.SCALEMODE_CEILING=3,CN.MATERIAL_TextureDirtyFlag=1,CN.MATERIAL_LightDirtyFlag=2,CN.MATERIAL_FresnelDirtyFlag=4,CN.MATERIAL_AttributesDirtyFlag=8,CN.MATERIAL_MiscDirtyFlag=16,CN.MATERIAL_PrePassDirtyFlag=32,CN.MATERIAL_AllDirtyFlag=63,CN.MATERIAL_TriangleFillMode=0,CN.MATERIAL_WireFrameFillMode=1,CN.MATERIAL_PointFillMode=2,CN.MATERIAL_PointListDrawMode=3,CN.MATERIAL_LineListDrawMode=4,CN.MATERIAL_LineLoopDrawMode=5,CN.MATERIAL_LineStripDrawMode=6,CN.MATERIAL_TriangleStripDrawMode=7,CN.MATERIAL_TriangleFanDrawMode=8,CN.MATERIAL_ClockWiseSideOrientation=0,CN.MATERIAL_CounterClockWiseSideOrientation=1,CN.ACTION_NothingTrigger=0,CN.ACTION_OnPickTrigger=1,CN.ACTION_OnLeftPickTrigger=2,CN.ACTION_OnRightPickTrigger=3,CN.ACTION_OnCenterPickTrigger=4,CN.ACTION_OnPickDownTrigger=5,CN.ACTION_OnDoublePickTrigger=6,CN.ACTION_OnPickUpTrigger=7,CN.ACTION_OnPickOutTrigger=16,CN.ACTION_OnLongPressTrigger=8,CN.ACTION_OnPointerOverTrigger=9,CN.ACTION_OnPointerOutTrigger=10,CN.ACTION_OnEveryFrameTrigger=11,CN.ACTION_OnIntersectionEnterTrigger=12,CN.ACTION_OnIntersectionExitTrigger=13,CN.ACTION_OnKeyDownTrigger=14,CN.ACTION_OnKeyUpTrigger=15,CN.PARTICLES_BILLBOARDMODE_Y=2,CN.PARTICLES_BILLBOARDMODE_ALL=7,CN.PARTICLES_BILLBOARDMODE_STRETCHED=8,CN.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,CN.MESHES_CULLINGSTRATEGY_STANDARD=0,CN.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,CN.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,CN.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,CN.SCENELOADER_NO_LOGGING=0,CN.SCENELOADER_MINIMAL_LOGGING=1,CN.SCENELOADER_SUMMARY_LOGGING=2,CN.SCENELOADER_DETAILED_LOGGING=3,CN.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,CN.PREPASS_POSITION_TEXTURE_TYPE=1,CN.PREPASS_VELOCITY_TEXTURE_TYPE=2,CN.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,CN.PREPASS_COLOR_TEXTURE_TYPE=4,CN.PREPASS_DEPTH_TEXTURE_TYPE=5,CN.PREPASS_NORMAL_TEXTURE_TYPE=6,CN.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,CN.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,CN.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,CN.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,CN.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,CN.PREPASS_ALBEDO_TEXTURE_TYPE=12,CN.BUFFER_CREATIONFLAG_READ=1,CN.BUFFER_CREATIONFLAG_WRITE=2,CN.BUFFER_CREATIONFLAG_READWRITE=3,CN.BUFFER_CREATIONFLAG_UNIFORM=4,CN.BUFFER_CREATIONFLAG_VERTEX=8,CN.BUFFER_CREATIONFLAG_INDEX=16,CN.BUFFER_CREATIONFLAG_STORAGE=32,CN.BUFFER_CREATIONFLAG_INDIRECT=64,CN.RENDERPASS_MAIN=0,CN.INPUT_ALT_KEY=18,CN.INPUT_CTRL_KEY=17,CN.INPUT_META_KEY1=91,CN.INPUT_META_KEY2=92,CN.INPUT_META_KEY3=93,CN.INPUT_SHIFT_KEY=16,CN.SNAPSHOTRENDERING_STANDARD=0,CN.SNAPSHOTRENDERING_FAST=1,CN.PERSPECTIVE_CAMERA=0,CN.ORTHOGRAPHIC_CAMERA=1,CN.FOVMODE_VERTICAL_FIXED=0,CN.FOVMODE_HORIZONTAL_FIXED=1,CN.RIG_MODE_NONE=0,CN.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,CN.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,CN.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,CN.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,CN.RIG_MODE_STEREOSCOPIC_INTERLACED=14,CN.RIG_MODE_VR=20,CN.RIG_MODE_CUSTOM=22,CN.MAX_SUPPORTED_UV_SETS=6,CN.GL_ALPHA_EQUATION_ADD=32774,CN.GL_ALPHA_EQUATION_MIN=32775,CN.GL_ALPHA_EQUATION_MAX=32776,CN.GL_ALPHA_EQUATION_SUBTRACT=32778,CN.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,CN.GL_ALPHA_FUNCTION_SRC=768,CN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,CN.GL_ALPHA_FUNCTION_SRC_ALPHA=770,CN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,CN.GL_ALPHA_FUNCTION_DST_ALPHA=772,CN.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,CN.GL_ALPHA_FUNCTION_DST_COLOR=774,CN.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,CN.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,CN.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,CN.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,CN.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,CN.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,CN.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,CN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,CN.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,CN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,CN.SnippetUrl="https://snippet.babylonjs.com",CN.FOGMODE_NONE=0,CN.FOGMODE_EXP=1,CN.FOGMODE_EXP2=2,CN.FOGMODE_LINEAR=3,CN.BYTE=5120,CN.UNSIGNED_BYTE=5121,CN.SHORT=5122,CN.UNSIGNED_SHORT=5123,CN.INT=5124,CN.UNSIGNED_INT=5125,CN.FLOAT=5126,CN.PositionKind="position",CN.NormalKind="k",CN.TangentKind="tangent",CN.UVKind="uv",CN.UV2Kind="uv2",CN.UV3Kind="uv3",CN.UV4Kind="uv4",CN.UV5Kind="uv5",CN.UV6Kind="uv6",CN.ColorKind="color",CN.ColorInstanceKind="instanceColor",CN.MatricesIndicesKind="matricesIndices",CN.MatricesWeightsKind="matricesWeights",CN.MatricesIndicesExtraKind="matricesIndicesExtra",CN.MatricesWeightsExtraKind="matricesWeightsExtra";class KN{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:CN.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(N,q){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...KN._GetDefaultOptions(),...N},this._scene=q,this._scene._transmissionHelper=this,this.onErrorObservable=new E.d,this._scene.jj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(N){if(!Object.keys(N).filter((q=>this._options[q]!==N[q])).length)return;const q={...this._options,...N},R=this._options;this._options=q,q.renderSize===R.renderSize&&q.renderTargetTextureType===R.renderTargetTextureType&&q.generateMipmaps===R.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=q.samples,this._opaqueRenderTarget.lodGenerationScale=q.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=q.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(N){return!!N&&!!(N instanceof u&&N.subSurface.isRefractionEnabled)}_addMesh(N){this._materialObservers[N.uniqueId]=N.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),F.f.SetImmediate((()=>{this._shouldRenderAsTransmission(N.material)?(N.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(N)&&this._transparentMeshesCache.push(N)):-1===this._opaqueMeshesCache.indexOf(N)&&this._opaqueMeshesCache.push(N)}))}_removeMesh(N){N.onMaterialChangedObservable.remove(this._materialObservers[N.uniqueId]),delete this._materialObservers[N.uniqueId];let q=this._transparentMeshesCache.indexOf(N);-1!==q&&this._transparentMeshesCache.splice(q,1),q=this._opaqueMeshesCache.indexOf(N),-1!==q&&this._opaqueMeshesCache.splice(q,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(N){const q=this._transparentMeshesCache.indexOf(N),R=this._opaqueMeshesCache.indexOf(N);this._shouldRenderAsTransmission(N.material)?(N.material instanceof u&&(N.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==R?(this._opaqueMeshesCache.splice(R,1),this._transparentMeshesCache.push(N)):-1===q&&this._transparentMeshesCache.push(N)):-1!==q?(this._transparentMeshesCache.splice(q,1),this._opaqueMeshesCache.push(N)):-1===R&&this._opaqueMeshesCache.push(N)}_isRenderTargetValid(){var N;return null!==(null===(N=this._opaqueRenderTarget)||void 0===N?void 0:N.getInternalTexture())}_setupRenderTargets(){var N;let q,R;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new oN.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(N=this._options.clearColor)||void 0===N?void 0:N.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((N=>{R=this._scene.environmentIntensity,this._scene.environmentIntensity=1,q=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?N.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(N.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=R,this._scene.imageProcessingConfiguration._applyByPostProcess=q})),this._transparentMeshesCache.forEach((N=>{this._shouldRenderAsTransmission(N.material)&&(N.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const rN="KHR_materials_transmission";class aN{constructor(N){this.name=rN,this.order=175,this._loader=N,this.enabled=this._loader.isExtensionUsed(rN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadTransparentPropertiesAsync(z,q,R,v)),Promise.all(B).then((()=>{}))}))}_loadTransparentPropertiesAsync(N,q,R,z){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const v=R;if(v.subSurface.isRefractionEnabled=!0,v.subSurface.volumeIndexOfRefraction=1,v.subSurface.useAlbedoToTintRefraction=!0,void 0===z.transmissionFactor)return v.subSurface.refractionIntensity=0,v.subSurface.isRefractionEnabled=!1,Promise.resolve();{var B;v.subSurface.refractionIntensity=z.transmissionFactor;const N=v.va();if(v.subSurface.refractionIntensity&&!N._transmissionHelper)new KN({},v.va());else if(v.subSurface.refractionIntensity&&(null===(B=N._transmissionHelper)||void 0===B||!B._isRenderTargetValid())){var F;null===(F=N._transmissionHelper)||void 0===F||F._setupRenderTargets()}}return v.subSurface.minimumThickness=0,v.subSurface.maximumThickness=0,z.transmissionTexture?(z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/transmissionTexture`,z.transmissionTexture,void 0).then((N=>{N.name=`${R.name} (Transmission)`,v.subSurface.refractionIntensityTexture=N,v.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}K(rN),C(rN,!0,(N=>new aN(N)));const dN="KHR_materials_diffuse_transmission";class pN{constructor(N){this.name=dN,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(dN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadTranslucentPropertiesAsync(z,q,R,v)),Promise.all(B).then((()=>{}))}))}_loadTranslucentPropertiesAsync(N,q,R,z){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);const v=R;if(v.subSurface.isTranslucencyEnabled=!0,v.subSurface.volumeIndexOfRefraction=1,v.subSurface.minimumThickness=0,v.subSurface.maximumThickness=0,v.subSurface.useAlbedoToTintTranslucency=!1,void 0===z.diffuseTransmissionFactor)return v.subSurface.translucencyIntensity=0,v.subSurface.isTranslucencyEnabled=!1,Promise.resolve();v.subSurface.translucencyIntensity=z.diffuseTransmissionFactor;const F=new Array;return v.subSurface.useGltfStyleTextures=!0,z.diffuseTransmissionTexture&&(z.diffuseTransmissionTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionTexture`,z.diffuseTransmissionTexture).then((N=>{N.name=`${R.name} (Diffuse Transmission)`,v.subSurface.translucencyIntensityTexture=N})))),void 0!==z.diffuseTransmissionColorFactor?v.subSurface.translucencyColor=B.c.Zg(z.diffuseTransmissionColorFactor):v.subSurface.translucencyColor=B.c.White(),z.diffuseTransmissionColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionColorTexture`,z.diffuseTransmissionColorTexture).then((N=>{N.name=`${R.name} (Diffuse Transmission Color)`,v.subSurface.translucencyColorTexture=N}))),Promise.all(F).then((()=>{}))}}K(dN),C(dN,!0,(N=>new pN(N)));const WN="KHR_materials_volume";class Nq{constructor(N){this.name=WN,this.order=173,this._loader=N,this.enabled=this._loader.isExtensionUsed(WN),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadVolumePropertiesAsync(z,q,R,v)),Promise.all(B).then((()=>{}))}))}_loadVolumePropertiesAsync(N,q,R,z){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);if(!R.subSurface.isRefractionEnabled&&!R.subSurface.isTranslucencyEnabled||!z.thicknessFactor)return Promise.resolve();R.subSurface.volumeIndexOfRefraction=R.indexOfRefraction;const v=void 0!==z.attenuationDistance?z.attenuationDistance:Number.MAX_VALUE;return R.subSurface.tintColorAtDistance=v,void 0!==z.attenuationColor&&3==z.attenuationColor.length&&R.subSurface.tintColor.qe(z.attenuationColor[0],z.attenuationColor[1],z.attenuationColor[2]),R.subSurface.minimumThickness=0,R.subSurface.maximumThickness=z.thicknessFactor,R.subSurface.useThicknessAsDepth=!0,z.thicknessTexture?(z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/thicknessTexture`,z.thicknessTexture).then((N=>{N.name=`${R.name} (Thickness)`,R.subSurface.thicknessTexture=N,R.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}K(WN),C(WN,!0,(N=>new Nq(N)));const qq="KHR_materials_dispersion";class Rq{constructor(N){this.name=qq,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(qq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(N,q,R)),B.push(this._loadDispersionPropertiesAsync(z,q,R,v)),Promise.all(B).then((()=>{}))}))}_loadDispersionPropertiesAsync(N,q,R,z){if(!(R instanceof u))throw new Error(`${N}: Material type not supported`);return R.subSurface.isRefractionEnabled&&z.dispersion?(R.subSurface.isDispersionEnabled=!0,R.subSurface.dispersion=z.dispersion,Promise.resolve()):Promise.resolve()}}K(qq),C(qq,!0,(N=>new Rq(N)));const zq="KHR_mesh_quantization";class vq{constructor(N){this.name=zq,this.enabled=N.isExtensionUsed(zq)}dispose(){}}K(zq),C(zq,!0,(N=>new vq(N)));const Bq="KHR_texture_basisu";class Fq{constructor(N){this.name=Bq,this._loader=N,this.enabled=N.isExtensionUsed(Bq)}dispose(){this._loader=null}_loadTextureAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>{const B=void 0==q.sampler?d.DefaultSampler:a.Get(`${N}/sampler`,this._loader.Oi.samplers,q.sampler),F=a.Get(`${z}/source`,this._loader.Oi.images,v.source);return this._loader._createTextureAsync(N,B,F,(N=>{R(N)}),q._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!q._textureInfo.nonColorData)}))}}K(Bq),C(Bq,!0,(N=>new Fq(N)));const Sq="KHR_texture_transform";class Aq{constructor(N){this.name=Sq,this._loader=N,this.enabled=this._loader.isExtensionUsed(Sq)}dispose(){this._loader=null}loadTextureInfoAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((z,v)=>this._loader.loadTextureInfoAsync(N,q,(N=>{if(!(N instanceof w.c))throw new Error(`${z}: Texture type not supported`);v.offset&&(N.uOffset=v.offset[0],N.vOffset=v.offset[1]),N.uRotationCenter=0,N.vRotationCenter=0,v.rotation&&(N.wAng=-v.rotation),v.scale&&(N.uScale=v.scale[0],N.vScale=v.scale[1]),void 0!=v.texCoord&&(N.coordinatesIndex=v.texCoord),R(N)}))))}}K(Sq),C(Sq,!0,(N=>new Aq(N)));const yq="KHR_xmp_json_ld";class Eq{constructor(N){this.name=yq,this.order=100,this._loader=N,this.enabled=this._loader.isExtensionUsed(yq)}dispose(){this._loader=null}onLoading(){var N,q,R;if(null===this._loader.rootBabylonMesh)return;const z=null===(N=this._loader.Oi.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld,v=null===(q=this._loader.Oi.asset)||void 0===q||null===(R=q.extensions)||void 0===R?void 0:R.KHR_xmp_json_ld;if(z&&v){const N=+v.packet;z.packets&&N<z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=z.packets[N])}}}function tq(N,q,R,z){return B.c.Zg(q,R).scale(z)}function xq(N,q,R,z){return q[R]*z}function eq(N,q,R,z){return-q[R]*z}function bq(N,q,R,z){return q[R+1]*z}function fq(N,q,R,z){return q[R]*z*2}function Dq(N){return{scale:[new Hq(x.c.ANIMATIONTYPE_FLOAT,`${N}.uScale`,xq,(()=>2)),new Hq(x.c.ANIMATIONTYPE_FLOAT,`${N}.vScale`,bq,(()=>2))],offset:[new Hq(x.c.ANIMATIONTYPE_FLOAT,`${N}.uOffset`,xq,(()=>2)),new Hq(x.c.ANIMATIONTYPE_FLOAT,`${N}.vOffset`,bq,(()=>2))],rotation:[new Hq(x.c.ANIMATIONTYPE_FLOAT,`${N}.wAng`,eq,(()=>1))]}}K(yq),C(yq,!0,(N=>new Eq(N)));class Vq extends O{buildAnimations(N,q,R,z,v){v(N._babylonCamera,this._buildAnimation(q,R,z))}}class Hq extends O{buildAnimations(N,q,R,z,v){for(const B in N._data)v(N._data[B].babylonMaterial,this._buildAnimation(q,R,z))}}class Yq extends O{buildAnimations(N,q,R,z,v){v(N._babylonLight,this._buildAnimation(q,R,z))}}const Tq={__array__:{__target__:!0,...P}},Lq={__array__:{__target__:!0,orthographic:{xmag:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"orthoLeft",eq,(()=>1)),new Vq(x.c.ANIMATIONTYPE_FLOAT,"orthoRight",bq,(()=>1))],ymag:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"orthoBottom",eq,(()=>1)),new Vq(x.c.ANIMATIONTYPE_FLOAT,"orthoTop",bq,(()=>1))],zfar:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"maxZ",xq,(()=>1))],znear:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"Wi",xq,(()=>1))]},perspective:{yfov:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"fov",xq,(()=>1))],zfar:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"maxZ",xq,(()=>1))],znear:[new Vq(x.c.ANIMATIONTYPE_FLOAT,"Wi",xq,(()=>1))]}}},Xq={nodes:Tq,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Hq(x.c.ANIMATIONTYPE_COLOR3,"albedoColor",tq,(()=>4)),new Hq(x.c.ANIMATIONTYPE_FLOAT,"alpha",(function(N,q,R,z){return q[R+3]*z}),(()=>4))],metallicFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"metallic",xq,(()=>1))],roughnessFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"roughness",xq,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Dq("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Dq("metallicTexture")}}},emissiveFactor:[new Hq(x.c.ANIMATIONTYPE_COLOR3,"emissiveColor",tq,(()=>3))],normalTexture:{scale:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",xq,(()=>1))],extensions:{KHR_texture_transform:Dq("bumpTexture")}},occlusionTexture:{strength:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",xq,(()=>1))],extensions:{KHR_texture_transform:Dq("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Dq("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",xq,(()=>1))],anisotropyRotation:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",xq,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Dq("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",xq,(()=>1))],clearcoatRoughnessFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",xq,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Dq("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",xq,(()=>1))],extensions:{KHR_texture_transform:Dq("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Dq("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",xq,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",xq,(()=>1))]},KHR_materials_ior:{ior:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",xq,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",xq,(()=>1))],iridescenceIor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",xq,(()=>1))],iridescenceThicknessMinimum:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",xq,(()=>1))],iridescenceThicknessMaximum:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",xq,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Dq("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Dq("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Hq(x.c.ANIMATIONTYPE_COLOR3,"sheen.color",tq,(()=>3))],sheenRoughnessFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",xq,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Dq("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Dq("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",xq,(()=>1))],specularColorFactor:[new Hq(x.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",tq,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Dq("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Dq("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",xq,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Dq("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Hq(x.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",tq,(()=>3))],attenuationDistance:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",xq,(()=>1))],thicknessFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",xq,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Dq("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Hq(x.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",xq,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Dq("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Hq(x.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",tq,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Dq("subSurface.translucencyColorTexture")}}}}}},cameras:Lq,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Yq(x.c.ANIMATIONTYPE_COLOR3,"diffuse",tq,(()=>3))],$i:[new Yq(x.c.ANIMATIONTYPE_FLOAT,"intensity",xq,(()=>1))],range:[new Yq(x.c.ANIMATIONTYPE_FLOAT,"range",xq,(()=>1))],spot:{innerConeAngle:[new Yq(x.c.ANIMATIONTYPE_FLOAT,"innerAngle",fq,(()=>1))],outerConeAngle:[new Yq(x.c.ANIMATIONTYPE_FLOAT,"angle",fq,(()=>1))]}}}}}};class Qq{constructor(N,q){this._gltf=N,this._infoTree=q}convert(N){let q,R=this._gltf,z=this._infoTree;if(!N.startsWith("/"))throw new Error("Path must start with a /");const v=N.split("/");v.shift();for(const B of v){if(z.__array__)z=z.__array__;else if(z=z[B],!z)throw new Error(`Path ${N} is invalid`);if(void 0===R)throw new Error(`Path ${N} is invalid`);R=R[B],z.__target__&&(q=R)}return{object:q,info:z}}}const hq="KHR_animation_pointer";class uq extends Qq{constructor(N){super(N,Xq)}}class wq{constructor(N){this.name=hq,this._loader=N,this._pathToObjectConverter=new uq(this._loader.Oi)}get enabled(){return this._loader.isExtensionUsed(hq)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(N,q,R,z,v){var B;const F=null===(B=z.target.extensions)||void 0===B?void 0:B.KHR_animation_pointer;if(!F||!this._pathToObjectConverter)return null;"pointer"!==z.target.path&&f.c.Warn(`${N}/target/path: Value (${z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=z.target.node&&f.c.Warn(`${N}/target/node: Value (${z.target.node}) must not be present when using the ${this.name} extension`);const S=`${N}/extensions/${this.name}`,A=F.pointer;if(!A)throw new Error(`${S}: Pointer is missing`);try{const B=this._pathToObjectConverter.convert(A);return this._loader._loadAnimationChannelFromTargetInfoAsync(N,q,R,z,B,v)}catch(y){return f.c.Warn(`${S}/pointer: Invalid pointer (${A}) skipped`),null}}}K(hq),C(hq,!0,(N=>new wq(N)));class cq{constructor(N,q,R){this.frame=N,this.action=q,this.onlyOnce=R,this.isDone=!1}_clone(){return new cq(this.frame,this.action,this.onlyOnce)}}var nq=R(10923),Gq=R(10957);class sq{get loop(){return this._loop}set loop(N){N!==this._loop&&(this._loop=N,this.updateOptions({loop:N}))}get currentTime(){var N;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.audioContext&&(this.isPlaying||this.isPaused)){const N=this.isPaused?0:Gq.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+N}return 0}get spatialSound(){return this._spatialSound}set spatialSound(N){if(N==this._spatialSound)return;const q=this.isPlaying;this.pause(),N?(this._spatialSound=N,this._updateSpatialParameters()):this._disableSpatialSound(),q&&this.play()}constructor(N,q,R){var z;let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new E.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=v.m.Zero(),this._localDirection=new v.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=N,R=R||b.b.LastCreatedScene)if(this._scene=R,sq._SceneComponentInitialization(R),this._readyToPlayCallback=B,this._customAttenuationFunction=(N,q,R,z,v)=>q<R?N*(1-q/R):0,S&&(this.autoplay=S.autoplay||!1,this._loop=S.loop||!1,void 0!==S.volume&&(this._volume=S.volume),this._spatialSound=S.spatialSound??!1,this.maxDistance=S.maxDistance??100,this.useCustomAttenuation=S.useCustomAttenuation??!1,this.rolloffFactor=S.rolloffFactor||1,this.refDistance=S.refDistance||1,this.distanceModel=S.distanceModel||"linear",this._playbackRate=S.playbackRate||1,this._streaming=S.streaming??!1,this._length=S.length,this._offset=S.offset),null!==(z=Gq.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&Gq.d.audioEngine.audioContext){this._soundGain=Gq.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let N=!0;if(q)try{"string"===typeof q?(this._urlType="String",this._url=q):q instanceof ArrayBuffer?this._urlType="ArrayBuffer":q instanceof HTMLMediaElement?this._urlType="MediaElement":q instanceof MediaStream?this._urlType="MediaStream":q instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(q)&&(this._urlType="Array");let R=[],z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gq.d.audioEngine.audioContext.createMediaElementSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gq.d.audioEngine.audioContext.createMediaStreamSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":q.byteLength>0&&(z=!0,this._soundLoaded(q));break;case"AudioBuffer":this._audioBufferLoaded(q);break;case"String":R.push(q);case"Array":0===R.length&&(R=q);for(let N=0;N<R.length;N++){const q=R[N];if(z=S&&S.skipCodecCheck||-1!==q.indexOf(".mp3",q.length-4)&&Gq.d.audioEngine.isMP3supported||-1!==q.indexOf(".ogg",q.length-4)&&Gq.d.audioEngine.isOGGsupported||-1!==q.indexOf(".wav",q.length-4)||-1!==q.indexOf(".m4a",q.length-4)||-1!==q.indexOf(".mp4",q.length-4)||-1!==q.indexOf("blob:"),z){this._streaming?(this._htmlAudioElement=new Audio(q),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,F.f.SetCorsBehavior(q,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(q,(N=>{this._soundLoaded(N)}),void 0,!0,!0,(N=>{N&&f.c.Error("XHR "+N.status+" error on: "+q+"."),f.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:N=!1}N?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):f.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(A){f.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Gq.d.audioEngine&&!Gq.d.audioEngine.WarnedWebAudioUnsupported&&(f.c.Error("Web Audio is not supported by your browser."),Gq.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var N;null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(N){var q;null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.audioContext&&(this._audioBuffer=N,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(N){var q;null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.audioContext&&Gq.d.audioEngine.audioContext.decodeAudioData(N,(N=>{this._audioBufferLoaded(N)}),(N=>{f.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+N)}))}setAudioBuffer(N){var q;null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this._audioBuffer=N,this._isReadyToPlay=!0)}updateOptions(N){N&&(this.loop=N.loop??this.loop,this.maxDistance=N.maxDistance??this.maxDistance,this.useCustomAttenuation=N.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=N.rolloffFactor??this.rolloffFactor,this.refDistance=N.refDistance??this.refDistance,this.distanceModel=N.distanceModel??this.distanceModel,this._playbackRate=N.playbackRate??this._playbackRate,this._length=N.length??void 0,this.spatialSound=N.spatialSound??this._spatialSound,this._setOffset(N.offset??void 0),this.setVolume(N.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var N;null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&Gq.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Gq.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var N;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(N=this._soundPanner)||void 0===N||N.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var N;null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(N){var q;null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(N),this._isOutputConnected=!0)}setDirectionalCone(N,q,R){q<N?f.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=N,this._coneOuterAngle=q,this._coneOuterGain=R,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!=this._coneInnerAngle){var q;if(this._coneOuterAngle<N)return void f.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N,null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!=this._coneOuterAngle){var q;if(N<this._coneInnerAngle)return void f.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N,null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(N){var q;N.equals(this._position)||(this._position.p(N),null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(N){var q;this._localDirection=N,null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const N=this._connectedTransformNode.getWorldMatrix(),q=v.m.TransformNormal(this._localDirection,N);q.normalize(),this._soundPanner.orientationX.value=q.x,this._soundPanner.orientationY.value=q.y,this._soundPanner.orientationZ.value=q.z}updateDistanceFromListener(){var N;if(null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const N=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.gd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,N,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(N){this._customAttenuationFunction=N}play(N,q,R){var z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(z=Gq.d.audioEngine)&&void 0!==z&&z.audioContext)try{var v,B;this._clearTimeoutsAndObservers();let z=N?(null===(v=Gq.d.audioEngine)||void 0===v?void 0:v.audioContext.currentTime)+N:null===(B=Gq.d.audioEngine)||void 0===B?void 0:B.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Gq.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const N=()=>{var R;if(null!==(R=Gq.d.audioEngine)&&void 0!==R&&R.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=q??0;const R=this._htmlAudioElement.play();void 0!==R&&R.catch((()=>{var q,R;(null===(q=Gq.d.audioEngine)||void 0===q||q.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(R=Gq.d.audioEngine)||void 0===R?void 0:R.onAudioUnlockedObservable.addOnce((()=>{N()})))}))}else{var z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(z=Gq.d.audioEngine)||void 0===z?void 0:z.onAudioUnlockedObservable.addOnce((()=>{N()}))}};N()}}else{var F;const v=()=>{var v;if(null!==(v=Gq.d.audioEngine)&&void 0!==v&&v.audioContext){var B;if(R=R||this._length,void 0!==q&&this._setOffset(q),this._soundSource){const N=this._soundSource;N.onended=()=>{N.disconnect()}}if(this._soundSource=null===(B=Gq.d.audioEngine)||void 0===B?void 0:B.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var F;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==q&&(this._soundSource.loopStart=q),void 0!==R&&(this._soundSource.loopEnd=(0|q)+R),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},z=N?(null===(F=Gq.d.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+N:Gq.d.audioEngine.audioContext.currentTime;const v=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(z,v,this.loop?void 0:R)}}};"suspended"===(null===(F=Gq.d.audioEngine)||void 0===F?void 0:F.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var N;"suspended"===(null===(N=Gq.d.audioEngine)||void 0===N?void 0:N.audioContext.state)?(Gq.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Gq.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{v()})))):v()}),500):v()}this._startTime=z,this.isPlaying=!0,this.isPaused=!1}catch(S){f.c.Error("Error while trying to play audio: "+this.name+", "+S.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(N){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var R;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(R=this._streamingSource)||void 0===R||R.disconnect();this.isPlaying=!1}else if(null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource){const q=N?Gq.d.audioEngine.audioContext.currentTime+N:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(q)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var N;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var q;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(q=this._streamingSource)||void 0===q||q.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Gq.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(N,q){var R;null!==(R=Gq.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._soundGain&&(q&&Gq.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Gq.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Gq.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(N,Gq.d.audioEngine.audioContext.currentTime+q)):this._soundGain.gain.value=N),this._volume=N}setPlaybackRate(N){this._playbackRate=N,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(N){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=N,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=N=>this._onRegisterAfterWorldMatrixUpdate(N),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(N){var q;if(N.getBoundingInfo){const q=N.getBoundingInfo();this.setPosition(q.boundingSphere.centerWorld)}else this.setPosition(N.absolutePosition);null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const N=()=>{this._isReadyToPlay?(R._audioBuffer=this.getAudioBuffer(),R._isReadyToPlay=!0,R.autoplay&&R.play(0,this._offset,this._length)):setTimeout(N,300)},q={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},R=new sq(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,q);return this.useCustomAttenuation&&R.setAttenuationFunction(this._customAttenuationFunction),R.setPosition(this._position),R.setPlaybackRate(this._playbackRate),N(),R}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const N={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(N.connectedMeshId=this._connectedTransformNode.id),N.position=this._position.ij(),N.refDistance=this.refDistance,N.distanceModel=this.distanceModel,N.isDirectional=this._isDirectional,N.localDirectionToMesh=this._localDirection.ij(),N.coneInnerAngle=this._coneInnerAngle,N.coneOuterAngle=this._coneOuterAngle,N.coneOuterGain=this._coneOuterGain),N}static Parse(N,q,R,z){const B=N.name;let F;F=N.url?R+N.url:R+B;const S={autoplay:N.autoplay,loop:N.loop,volume:N.volume,spatialSound:N.spatialSound,maxDistance:N.maxDistance,rolloffFactor:N.rolloffFactor,refDistance:N.refDistance,distanceModel:N.distanceModel,playbackRate:N.playbackRate};let A;if(z){const N=()=>{z._isReadyToPlay?(A._audioBuffer=z.getAudioBuffer(),A._isReadyToPlay=!0,A.autoplay&&A.play(0,A._offset,A._length)):setTimeout(N,300)};A=new sq(B,new ArrayBuffer(0),q,null,S),N()}else A=new sq(B,F,q,(()=>{q.removePendingData(A)}),S),q.addPendingData(A);if(N.position){const q=v.m.Zg(N.position);A.setPosition(q)}if(N.isDirectional&&(A.setDirectionalCone(N.coneInnerAngle||360,N.coneOuterAngle||360,N.coneOuterGain||0),N.localDirectionToMesh)){const q=v.m.Zg(N.localDirectionToMesh);A.setLocalDirectionToMesh(q)}if(N.connectedMeshId){const R=q.getMeshById(N.connectedMeshId);R&&A.attachToMesh(R)}return N.metadata&&(A.metadata=N.metadata),A}_setOffset(N){this._offset!==N&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=N)}_clearTimeoutsAndObservers(){var N;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(N=Gq.d.audioEngine)||void 0===N||N.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}sq._SceneComponentInitialization=N=>{throw(0,nq.b)("AudioSceneComponent")},(0,Q.f)("BABYLON.Sound",sq);class Zq{constructor(N,q,R){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],q.length!==R.length)throw new Error("Sounds length does not equal weights length");this.loop=N,this._weights=R;let z=0;for(const B of R)z+=B;const v=z>0?1/z:0;for(let B=0;B<this._weights.length;B++)this._weights[B]*=v;this._sounds=q;for(const B of this._sounds)B.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!==this._coneInnerAngle){if(this._coneOuterAngle<N)return void f.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N;for(const q of this._sounds)q.directionalConeInnerAngle=N}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!==this._coneOuterAngle){if(N<this._coneInnerAngle)return void f.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N;for(const q of this._sounds)q.directionalConeOuterAngle=N}}get volume(){return this._volume}set volume(N){if(N!==this._volume)for(const q of this._sounds)q.setVolume(N)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(N){if(!this.isPaused){this.stop();const N=Math.random();let q=0;for(let R=0;R<this._weights.length;R++)if(q+=this._weights[R],N<=q){this._currentIndex=R;break}}const q=this._sounds[this._currentIndex??0];q.isReady()?q.play(0,this.isPaused?void 0:N):q.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Jq{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(N=N||b.b.LastCreatedScene)&&(this._scene=N,this.soundCollection=[],this._options=q,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var N;null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&Gq.d.audioEngine.audioContext&&(this._outputAudioNode=Gq.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Gq.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Gq.d.audioEngine&&Gq.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(N){var q;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&N.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==N.soundTrackId&&(-1===N.soundTrackId?this._scene.mainSoundTrack.removeSound(N):this._scene.soundTracks&&this._scene.soundTracks[N.soundTrackId].removeSound(N)),this.soundCollection.push(N),N.soundTrackId=this.id}removeSound(N){const q=this.soundCollection.indexOf(N);-1!==q&&this.soundCollection.splice(q,1)}setVolume(N){var q;null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=N)}switchPanningModelToHRTF(){var N;if(null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var N;if(null!==(N=Gq.d.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToEqualPower()}connectToAnalyser(N){var q;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=N,null!==(q=Gq.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Gq.d.audioEngine.masterGain))}}var Mq=R(11282),mq=R(11172),gq=(R(11738),R(10919));(0,R(11819).g)(Mq.c.NAME_AUDIO,((N,q,R,z)=>{let v,B=[];if(R._j=R._j||[],void 0!==N._j&&null!==N._j)for(let S=0,A=N._j.length;S<A;S++){var F;const A=N._j[S];null!==(F=Gq.d.audioEngine)&&void 0!==F&&F.canUseWebAudio?(A.url||(A.url=A.name),B[A.url]?R._j.push(sq.Parse(A,q,z,B[A.url])):(v=sq.Parse(A,q,z),B[A.url]=v,R._j.push(v))):R._j.push(new sq(A.name,null,q))}B=[]})),Object.defineProperty(mq.b.prototype,"mainSoundTrack",{get:function(){let N=this._getComponent(Mq.c.NAME_AUDIO);return N||(N=new jq(this),this.gb(N)),this._mainSoundTrack||(this._mainSoundTrack=new Jq(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),mq.b.prototype.getSoundByName=function(N){let q;for(q=0;q<this.mainSoundTrack.soundCollection.length;q++)if(this.mainSoundTrack.soundCollection[q].name===N)return this.mainSoundTrack.soundCollection[q];if(this.soundTracks)for(let R=0;R<this.soundTracks.length;R++)for(q=0;q<this.soundTracks[R].soundCollection.length;q++)if(this.soundTracks[R].soundCollection[q].name===N)return this.soundTracks[R].soundCollection[q];return null},Object.defineProperty(mq.b.prototype,"audioEnabled",{get:function(){let N=this._getComponent(Mq.c.NAME_AUDIO);return N||(N=new jq(this),this.gb(N)),N.audioEnabled},set:function(N){let q=this._getComponent(Mq.c.NAME_AUDIO);q||(q=new jq(this),this.gb(q)),N?q.enableAudio():q.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(mq.b.prototype,"headphone",{get:function(){let N=this._getComponent(Mq.c.NAME_AUDIO);return N||(N=new jq(this),this.gb(N)),N.headphone},set:function(N){let q=this._getComponent(Mq.c.NAME_AUDIO);q||(q=new jq(this),this.gb(q)),N?q.switchAudioModeForHeadphones():q.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(mq.b.prototype,"audioListenerPositionProvider",{get:function(){let N=this._getComponent(Mq.c.NAME_AUDIO);return N||(N=new jq(this),this.gb(N)),N.audioListenerPositionProvider},set:function(N){let q=this._getComponent(Mq.c.NAME_AUDIO);if(q||(q=new jq(this),this.gb(q)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");q.audioListenerPositionProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(mq.b.prototype,"audioListenerRotationProvider",{get:function(){let N=this._getComponent(Mq.c.NAME_AUDIO);return N||(N=new jq(this),this.gb(N)),N.audioListenerRotationProvider},set:function(N){let q=this._getComponent(Mq.c.NAME_AUDIO);if(q||(q=new jq(this),this.gb(q)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");q.audioListenerRotationProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(mq.b.prototype,"audioPositioningRefreshRate",{get:function(){let N=this._getComponent(Mq.c.NAME_AUDIO);return N||(N=new jq(this),this.gb(N)),N.audioPositioningRefreshRate},set:function(N){let q=this._getComponent(Mq.c.NAME_AUDIO);q||(q=new jq(this),this.gb(q)),q.audioPositioningRefreshRate=N},enumerable:!0,configurable:!0});class jq{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(N){this.name=Mq.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new v.m,this._cachedCameraPosition=new v.m,this._lastCheck=0,this._invertMatrixTemp=new v.d,this._cameraDirectionTemp=new v.m,(N=N||b.b.LastCreatedScene)&&(this.Xd=N,N.soundTracks=[],N._j=[])}register(){this.Xd._afterRenderStage.registerStep(Mq.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(N){if(N._j=[],this.Xd.soundTracks)for(let q=0;q<this.Xd.soundTracks.length;q++){const R=this.Xd.soundTracks[q];for(let q=0;q<R.soundCollection.length;q++)N._j.push(R.soundCollection[q].serialize())}}addFromContainer(N){N._j&&N._j.forEach((N=>{N.play(),N.autoplay=!0,this.Xd.mainSoundTrack.addSound(N)}))}removeFromContainer(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N._j&&N._j.forEach((N=>{N.stop(),N.autoplay=!1,this.Xd.mainSoundTrack.removeSound(N),q&&N.dispose()}))}dispose(){const N=this.Xd;if(N._mainSoundTrack&&N.mainSoundTrack.dispose(),N.soundTracks)for(let q=0;q<N.soundTracks.length;q++)N.soundTracks[q].dispose()}disableAudio(){const N=this.Xd;let q;for(this._audioEnabled=!1,Gq.d.audioEngine&&Gq.d.audioEngine.audioContext&&Gq.d.audioEngine.audioContext.suspend(),q=0;q<N.mainSoundTrack.soundCollection.length;q++)N.mainSoundTrack.soundCollection[q].pause();if(N.soundTracks)for(q=0;q<N.soundTracks.length;q++)for(let R=0;R<N.soundTracks[q].soundCollection.length;R++)N.soundTracks[q].soundCollection[R].pause()}enableAudio(){const N=this.Xd;let q;for(this._audioEnabled=!0,Gq.d.audioEngine&&Gq.d.audioEngine.audioContext&&Gq.d.audioEngine.audioContext.resume(),q=0;q<N.mainSoundTrack.soundCollection.length;q++)N.mainSoundTrack.soundCollection[q].isPaused&&N.mainSoundTrack.soundCollection[q].play();if(N.soundTracks)for(q=0;q<N.soundTracks.length;q++)for(let R=0;R<N.soundTracks[q].soundCollection.length;R++)N.soundTracks[q].soundCollection[R].isPaused&&N.soundTracks[q].soundCollection[R].play()}switchAudioModeForHeadphones(){const N=this.Xd;if(this._headphone=!0,N.mainSoundTrack.switchPanningModelToHRTF(),N.soundTracks)for(let q=0;q<N.soundTracks.length;q++)N.soundTracks[q].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const N=this.Xd;if(this._headphone=!1,N.mainSoundTrack.switchPanningModelToEqualPower(),N.soundTracks)for(let q=0;q<N.soundTracks.length;q++)N.soundTracks[q].switchPanningModelToEqualPower()}_afterRender(){const N=gq.d.Now;if(this._lastCheck&&N-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=N;const q=this.Xd;if(!this._audioEnabled||!q._mainSoundTrack||!q.soundTracks||0===q._mainSoundTrack.soundCollection.length&&1===q.soundTracks.length)return;const R=Gq.d.audioEngine;if(R&&R.audioContext){let N,z=q.activeCamera;if(q.activeCameras&&q.activeCameras.length>0&&(z=q.activeCameras[0]),this.audioListenerPositionProvider){const N=this.audioListenerPositionProvider();R.audioContext.listener.setPosition(N.x||0,N.y||0,N.z||0)}else z?this._cachedCameraPosition.equals(z.globalPosition)||(this._cachedCameraPosition.p(z.globalPosition),R.audioContext.listener.setPosition(z.globalPosition.x,z.globalPosition.y,z.globalPosition.z)):R.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const N=this.audioListenerRotationProvider();R.audioContext.listener.setOrientation(N.x||0,N.y||0,N.z||0,0,1,0)}else z?(z.rigCameras&&z.rigCameras.length>0&&(z=z.rigCameras[0]),z.getViewMatrix().invertToRef(this._invertMatrixTemp),v.m.TransformNormalToRef(jq._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),R.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):R.audioContext.listener.setOrientation(0,0,0,0,1,0);for(N=0;N<q.mainSoundTrack.soundCollection.length;N++){const R=q.mainSoundTrack.soundCollection[N];R.useCustomAttenuation&&R.updateDistanceFromListener()}if(q.soundTracks)for(N=0;N<q.soundTracks.length;N++)for(let R=0;R<q.soundTracks[N].soundCollection.length;R++){const z=q.soundTracks[N].soundCollection[R];z.useCustomAttenuation&&z.updateDistanceFromListener()}}}}jq._CameraDirection=new v.m(0,0,-1),sq._SceneComponentInitialization=N=>{let q=N._getComponent(Mq.c.NAME_AUDIO);q||(q=new jq(N),N.gb(q))};const lq="MSFT_audio_emitter";class Iq{constructor(N){this.name=lq,this._loader=N,this.enabled=this._loader.isExtensionUsed(lq)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const N=this._loader.Oi.extensions;if(N&&N[this.name]){const q=N[this.name];this._clips=q.clips,this._emitters=q.emitters,a.Assign(this._clips),a.Assign(this._emitters)}}loadSceneAsync(N,q){return d.LoadExtensionAsync(N,q,this.name,((R,z)=>{const v=new Array;v.push(this._loader.loadSceneAsync(N,q));for(const N of z.emitters){const q=a.Get(`${R}/emitters`,this._emitters,N);if(void 0!=q.refDistance||void 0!=q.maxDistance||void 0!=q.rolloffFactor||void 0!=q.distanceModel||void 0!=q.innerAngle||void 0!=q.outerAngle)throw new Error(`${R}: Direction or Distance properties are not allowed on emitters attached to a scene`);v.push(this._loadEmitterAsync(`${R}/emitters/${q.index}`,q))}return Promise.all(v).then((()=>{}))}))}loadNodeAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((N,z)=>{const B=new Array;return this._loader.loadNodeAsync(N,q,(q=>{for(const R of z.emitters){const z=a.Get(`${N}/emitters`,this._emitters,R);B.push(this._loadEmitterAsync(`${N}/emitters/${z.index}`,z).then((()=>{for(const N of z._babylonSounds)N.attachToMesh(q),void 0==z.innerAngle&&void 0==z.outerAngle||(N.setLocalDirectionToMesh(v.m.Forward()),N.setDirectionalCone(2*F.f.ToDegrees(void 0==z.innerAngle?Math.PI:z.innerAngle),2*F.f.ToDegrees(void 0==z.outerAngle?Math.PI:z.outerAngle),0))})))}R(q)})).then((N=>Promise.all(B).then((()=>N))))}))}loadAnimationAsync(N,q){return d.LoadExtensionAsync(N,q,this.name,((R,z)=>this._loader.loadAnimationAsync(N,q).then((v=>{const B=new Array;a.Assign(z.events);for(const F of z.events)B.push(this._loadAnimationEventAsync(`${R}/events/${F.index}`,N,q,F,v));return Promise.all(B).then((()=>v))}))))}_loadClipAsync(N,q){if(q._objectURL)return q._objectURL;let R;if(q.uri)R=this._loader.loadUriAsync(N,q,q.uri);else{const z=a.Get(`${N}/bufferView`,this._loader.Oi.bufferViews,q.bufferView);R=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z)}return q._objectURL=R.then((N=>URL.createObjectURL(new Blob([N],{type:q.mimeType})))),q._objectURL}_loadEmitterAsync(N,q){if(q._babylonSounds=q._babylonSounds||[],!q._babylonData){const N=new Array,R=q.name||`emitter${q.index}`,z={loop:!1,autoplay:!1,volume:void 0==q.volume?1:q.volume};for(let B=0;B<q.clips.length;B++){const v=`/extensions/${this.name}/clips`,F=a.Get(v,this._clips,q.clips[B].clip);N.push(this._loadClipAsync(`${v}/${q.clips[B].clip}`,F).then((N=>{const v=q._babylonSounds[B]=new sq(R,N,this._loader.babylonScene,null,z);v.refDistance=q.refDistance||1,v.maxDistance=q.maxDistance||256,v.rolloffFactor=q.rolloffFactor||1,v.distanceModel=q.distanceModel||"exponential"})))}const v=Promise.all(N).then((()=>{const N=q.clips.map((N=>N.weight||1)),R=new Zq(q.loop||!1,q._babylonSounds,N);q.innerAngle&&(R.directionalConeInnerAngle=2*F.f.ToDegrees(q.innerAngle)),q.outerAngle&&(R.directionalConeOuterAngle=2*F.f.ToDegrees(q.outerAngle)),q.volume&&(R.volume=q.volume),q._babylonData.sound=R}));q._babylonData={loaded:v}}return q._babylonData.loaded}_getEventAction(N,q,R,z,v){switch(R){case"play":return N=>{const R=(v||0)+(N-z);q.play(R)};case"stop":return()=>{q.stop()};case"pause":return()=>{q.pause()};default:throw new Error(`${N}: Unsupported action ${R}`)}}_loadAnimationEventAsync(N,q,R,z,v){if(0==v.targetedAnimations.length)return Promise.resolve();const B=v.targetedAnimations[0],F=z.j,S=a.Get(`/extensions/${this.name}/emitters`,this._emitters,F);return this._loadEmitterAsync(N,S).then((()=>{const q=S._babylonData.sound;if(q){const R=new cq(z.time,this._getEventAction(N,q,z.action,z.time,z.startOffset));B.animation.addEvent(R),v.onAnimationGroupEndObservable.add((()=>{q.stop()})),v.onAnimationGroupPauseObservable.add((()=>{q.pause()}))}}))}}K(lq),C(lq,!0,(N=>new Iq(N)));const Uq="MSFT_lod";class Oq{constructor(N){var q;this.name=Uq,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new E.d,this.onMaterialLODsLoadedObservable=new E.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=N,this.maxLODsToLoad=(null===(q=this._loader.parent.extensionOptions[Uq])||void 0===q?void 0:q.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Uq)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let N=0;N<this._nodePromiseLODs.length;N++){const q=Promise.all(this._nodePromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Node LOD ${N}`),this._loader.log(`Loaded node LOD ${N}`)),this.onNodeLODsLoadedObservable.notifyObservers(N),N!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${N+1}`),this._loadBufferLOD(this._nodeBufferLODs,N+1),this._nodeSignalLODs[N]&&this._nodeSignalLODs[N].resolve())}));this._loader._completePromises.push(q)}for(let N=0;N<this._materialPromiseLODs.length;N++){const q=Promise.all(this._materialPromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Material LOD ${N}`),this._loader.log(`Loaded material LOD ${N}`)),this.onMaterialLODsLoadedObservable.notifyObservers(N),N!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${N+1}`),this._loadBufferLOD(this._materialBufferLODs,N+1),this._materialSignalLODs[N]&&this._materialSignalLODs[N].resolve())}));this._loader._completePromises.push(q)}}loadSceneAsync(N,q){const R=this._loader.loadSceneAsync(N,q);return this._loadBufferLOD(this._bufferLODs,0),R}loadNodeAsync(N,q,R){return d.LoadExtensionAsync(N,q,this.name,((N,v)=>{let B;const F=this._getLODs(N,q,this._loader.Oi.nodes,v.ids);this._loader.logOpen(`${N}`);for(let q=0;q<F.length;q++){const N=F[q];0!==q&&(this._nodeIndexLOD=q,this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new z);const v=N=>{R(N),N.Vb(!1)},S=this._loader.loadNodeAsync(`/nodes/${N.index}`,N,v).then((N=>{if(0!==q){const N=F[q-1];N._babylonTransformNode&&(this._disposeTransformNode(N._babylonTransformNode),delete N._babylonTransformNode)}return N.Vb(!0),N}));this._nodePromiseLODs[q]=this._nodePromiseLODs[q]||[],0===q?B=S:(this._nodeIndexLOD=null,this._nodePromiseLODs[q].push(S))}return this._loader.logClose(),B}))}_loadMaterialAsync(N,q,R,z,v){return this._nodeIndexLOD?null:d.LoadExtensionAsync(N,q,this.name,((N,B)=>{let F;const S=this._getLODs(N,q,this._loader.Oi.materials,B.ids);this._loader.logOpen(`${N}`);for(let q=0;q<S.length;q++){const N=S[q];0!==q&&(this._materialIndexLOD=q);const B=this._loader._loadMaterialAsync(`/materials/${N.index}`,N,R,z,(N=>{0===q&&v(N)})).then((N=>{if(0!==q){v(N);const R=S[q-1]._data;R[z]&&(this._disposeMaterials([R[z].babylonMaterial]),delete R[z])}return N}));this._materialPromiseLODs[q]=this._materialPromiseLODs[q]||[],0===q?F=B:(this._materialIndexLOD=null,this._materialPromiseLODs[q].push(B))}return this._loader.logClose(),F}))}_loadUriAsync(N,q,R){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const v=this._nodeIndexLOD-1;return this._nodeSignalLODs[v]=this._nodeSignalLODs[v]||new z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(N,q,R)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const v=this._materialIndexLOD-1;return this._materialSignalLODs[v]=this._materialSignalLODs[v]||new z,this._materialSignalLODs[v].promise.then((()=>this._loader.loadUriAsync(N,q,R)))}return null}loadBufferAsync(N,q,R,v){if(this._loader.parent.useRangeRequests&&!q.uri){if(!this._loader.bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);const q=(N,q)=>{const B=R,F=B+v-1;let S=N[q];return S?(S.start=Math.min(S.start,B),S.end=Math.max(S.end,F)):(S={start:B,end:F,loaded:new z},N[q]=S),S.loaded.promise.then((N=>new Uint8Array(N.buffer,N.byteOffset+R-S.start,v)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?q(this._materialBufferLODs,this._materialIndexLOD):q(this._bufferLODs,0)}return null}_loadBufferLOD(N,q){const R=N[q];R&&(this._loader.log(`Loading buffer range [${R.start}-${R.end}]`),this._loader.bin.readAsync(R.start,R.end-R.start+1).then((N=>{R.loaded.resolve(N)}),(N=>{R.loaded.reject(N)})))}_getLODs(N,q,R,z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const v=[];for(let B=z.length-1;B>=0;B--)if(v.push(a.Get(`${N}/ids/${z[B]}`,R,z[B])),v.length===this.maxLODsToLoad)return v;return v.push(q),v}_disposeTransformNode(N){const q=[],R=N.material;R&&q.push(R);for(const v of N.getChildMeshes())v.material&&q.push(v.material);N.dispose();const z=q.filter((N=>this._loader.babylonScene.meshes.every((q=>q.material!=N))));this._disposeMaterials(z)}_disposeMaterials(N){const q={};for(const R of N){for(const N of R.getActiveTextures())q[N.uniqueId]=N;R.dispose()}for(const R in q)for(const N of this._loader.babylonScene.materials)N.hasTexture(q[R])&&delete q[R];for(const R in q)q[R].dispose()}}K(Uq),C(Uq,!0,(N=>new Oq(N)));const iq="MSFT_minecraftMesh";class Pq{constructor(N){this.name=iq,this._loader=N,this.enabled=this._loader.isExtensionUsed(iq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtraAsync(N,q,this.name,((z,v)=>{if(v){if(!(R instanceof u))throw new Error(`${z}: Material type not supported`);const v=this._loader.loadMaterialPropertiesAsync(N,q,R);return R.needAlphaBlending()&&(R.forceDepthWrite=!0,R.separateCullingPass=!0),R.hh=R.forceDepthWrite,R.twoSidedLighting=!0,v}return null}))}}K(iq),C(iq,!0,(N=>new Pq(N)));const kq="MSFT_sRGBFactors";class oq{constructor(N){this.name=kq,this._loader=N,this.enabled=this._loader.isExtensionUsed(kq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,R){return d.LoadExtraAsync(N,q,this.name,((z,v)=>{if(v){if(!(R instanceof u))throw new Error(`${z}: Material type not supported`);const v=this._loader.loadMaterialPropertiesAsync(N,q,R),B=R.va().getEngine().useExactSrgbConversions;return R.albedoTexture||R.albedoColor.toLinearSpaceToRef(R.albedoColor,B),R.reflectivityTexture||R.reflectivityColor.toLinearSpaceToRef(R.reflectivityColor,B),v}return null}))}}K(kq),C(kq,!0,(N=>new oq(N)));var Cq,Kq=R(11007);!function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(Cq||(Cq={}));class rq{constructor(N,q,R){this._ownerBlock=R,this._connectedPoint=[],this.uniqueId=(0,Kq.e)(),this.connectedPointIds=[],this.name=N,this._connectionType=q}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(N){if(this._connectionType===N._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||N._isSingularConnection()&&N._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(N),N._connectedPoint.push(this)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.name=this.name,N._connectionType=this._connectionType,N.connectedPointIds=[],N.className=this.getClassName();for(const q of this._connectedPoint)N.connectedPointIds.push(q.uniqueId)}getClassName(){return"FGConnection"}deserialize(N){this.uniqueId=N.uniqueId,this.name=N.name,this._connectionType=N._connectionType,this.connectedPointIds=N.connectedPointIds}static Parse(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1?arguments[1]:void 0;const R=new(F.f.Instantiate(N.className))(N.name,N._connectionType,q);return R.deserialize(N),R}}class aq{constructor(N){this.value=this._toInt(N)}_toInt(N){return 0|N}add(N){return new aq(this.value+N.value)}gd(N){return new aq(this.value-N.value)}multiply(N){return new aq(Math.imul(this.value,N.value))}divide(N){return new aq(this.value/N.value)}getClassName(){return aq.ClassName}equals(N){return this.value===N.value}static Parse(N){return new aq(N.value)}}aq.ClassName="FlowGraphInteger",(0,Q.f)("FlowGraphInteger",aq);class dq{constructor(N,q){this.typeName=N,this.defaultValue=q}serialize(N){N.typeName=this.typeName,N.defaultValue=this.defaultValue}static Parse(N){return new dq(N.typeName,N.defaultValue)}}const pq=new dq("any",void 0),Wq=(new dq("string",""),new dq("number",0)),NR=new dq("boolean",!1),qR=new dq("Vector2",v.l.Zero()),RR=new dq("o",v.m.Zero()),zR=(new dq("Vector4",v.p.Zero()),new dq("Matrix",v.d.Identity())),vR=(new dq("hb",B.c.Black()),new dq("ob",new B.g(0,0,0,0)),new dq("Quaternion",v.g.Identity()),new dq("FlowGraphInteger",new aq(0)));class BR extends rq{constructor(N,q,R,z){super(N,q,R),this.richType=z}_isSingularConnection(){return 0===this.connectionType}setValue(N,q){q._setConnectionValue(this,N)}connectTo(N){super.connectTo(N)}_getValueOrDefault(N){return N._hasConnectionValue(this)?N._getConnectionValue(this):this.richType.defaultValue}getValue(N){return 1===this.connectionType?(N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(N),this._getValueOrDefault(N)):this.isConnected()?this._connectedPoint[0].getValue(N):this._getValueOrDefault(N)}getClassName(){return"FGDataConnection"}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.richType={},this.richType.serialize(N.richType)}static Parse(N,q){const R=rq.Parse(N,q);return R.richType=dq.Parse(N.richType),R}}function FR(N){return"Mesh"===N||"AbstractMesh"===N||"GroundMesh"===N||"InstanceMesh"===N||"LinesMesh"===N||"GoldbergMesh"===N||"GreasedLineMesh"===N||"TrailMesh"===N}function SR(N){return"Vector2"===N||"o"===N||"Vector4"===N||"Quaternion"===N||"hb"===N||"ob"===N}function AR(N,q,R){var z;const v=(null===q||void 0===q||null===(z=q.getClassName)||void 0===z?void 0:z.call(q))??"";FR(v)?R[N]={name:q.name,className:v}:SR(v)?R[N]={value:q.ij(),className:v}:R[N]=q}function yR(N,q,R){const z=q[N];let F;const S=null===z||void 0===z?void 0:z.className;return F=FR(S)?R.getMeshByName(z.name):SR(S)?function(N,q){if("Vector2"===N)return v.l.Zg(q);if("o"===N)return v.m.Zg(q);if("Vector4"===N)return v.p.Zg(q);if("Quaternion"===N)return v.g.Zg(q);if("hb"===N)return new B.c(q[0],q[1],q[2]);if("ob"===N)return new B.g(q[0],q[1],q[2],q[3]);throw new Error(`Unknown vector class name ${N}`)}(S,z.value):"Matrix"===S?v.d.Zg(z.value):S===aq.ClassName?aq.Parse(z):z&&void 0!==z.value?z.value:z,F}(0,Q.f)("FGDataConnection",BR);class ER{constructor(N){var q;this.config=N,this.uniqueId=(0,Kq.e)(),this.name=(null===(q=this.config)||void 0===q?void 0:q.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(N){}registerDataInput(N,q){const R=new BR(N,0,this,q);return this.dataInputs.push(R),R}registerDataOutput(N,q){const R=new BR(N,1,this,q);return this.dataOutputs.push(R),R}getDataInput(N){return this.dataInputs.find((q=>q.name===N))}getDataOutput(N){return this.dataOutputs.find((q=>q.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.config={},this.config&&(N.config.name=this.config.name),N.dataInputs=[],N.dataOutputs=[],N.className=this.getClassName();for(const q of this.dataInputs){const R={};q.serialize(R),N.dataInputs.push(R)}for(const q of this.dataOutputs){const R={};q.serialize(R),N.dataOutputs.push(R)}}getClassName(){return"FGBlock"}static Parse(N,q){const R=F.f.Instantiate(N.className),z={},v=q.valueParseFunction??yR;if(N.config)for(const F in N.config)z[F]=v(F,N.config,q.Xd);var B;("FGSetPropertyBlock"===(B=N.className)||"FGGetPropertyBlock"===B||"FGPlayAnimationBlock"===B||"FGMeshPickEventBlock"===B)&&(z.pathConverter=q.pathConverter);const S=new R(z);S.uniqueId=N.uniqueId;for(let F=0;F<N.dataInputs.length;F++){const q=S.getDataInput(N.dataInputs[F].name);if(!q)throw new Error("Could not find data input with name "+N.dataInputs[F].name+" in block "+N.className);q.deserialize(N.dataInputs[F])}for(let F=0;F<N.dataOutputs.length;F++){const q=S.getDataOutput(N.dataOutputs[F].name);if(!q)throw new Error("Could not find data output with name "+N.dataOutputs[F].name+" in block "+N.className);q.deserialize(N.dataOutputs[F])}return S.metadata=N.metadata,S.deserialize&&S.deserialize(N),S}}class tR extends rq{_isSingularConnection(){return 1===this.connectionType}_activateSignal(N){var q;0===this.connectionType?(N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(N,this),N._increaseExecutionId()):null===(q=this._connectedPoint[0])||void 0===q||q._activateSignal(N)}}(0,Q.f)("FlowGraphSignalConnection",tR);class xR extends ER{constructor(N){super(N),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(N){const q=new tR(N,0,this);return this.signalInputs.push(q),q}_registerSignalOutput(N){const q=new tR(N,1,this);return this.signalOutputs.push(q),q}getSignalInput(N){return this.signalInputs.find((q=>q.name===N))}getSignalOutput(N){return this.signalOutputs.find((q=>q.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.signalInputs=[],N.signalOutputs=[];for(const q of this.signalInputs){const R={};q.serialize(R),N.signalInputs.push(R)}for(const q of this.signalOutputs){const R={};q.serialize(R),N.signalOutputs.push(R)}}deserialize(N){for(let q=0;q<N.signalInputs.length;q++){const R=this.getSignalInput(N.signalInputs[q].name);if(!R)throw new Error("Could not find signal input with name "+N.signalInputs[q].name+" in block "+N.className);R.deserialize(N.signalInputs[q])}for(let q=0;q<N.signalOutputs.length;q++){const R=this.getSignalOutput(N.signalOutputs[q].name);if(!R)throw new Error("Could not find signal output with name "+N.signalOutputs[q].name+" in block "+N.className);R.deserialize(N.signalOutputs[q])}}getClassName(){return"FGExecutionBlock"}}class eR extends xR{constructor(N){super(N),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(N){this._preparePendingTasks(N),N._addPendingBlock(this)}}class bR extends eR{_execute(N){N._notifyExecuteNode(this),this.out._activateSignal(N)}}class fR{constructor(N){this.uniqueId=(0,Kq.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.d,this._configuration=N}hasVariable(N){return N in this._userVariables}setVariable(N,q){this._userVariables[N]=q}getVariable(N){return this._userVariables[N]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(N,q){return`${N.uniqueId}_${q}`}_setExecutionVariable(N,q,R){this._executionVariables[this._getUniqueIdPrefixedName(N,q)]=R}_getExecutionVariable(N,q,R){return this._hasExecutionVariable(N,q)?this._executionVariables[this._getUniqueIdPrefixedName(N,q)]:R}_deleteExecutionVariable(N,q){delete this._executionVariables[this._getUniqueIdPrefixedName(N,q)]}_hasExecutionVariable(N,q){return this._getUniqueIdPrefixedName(N,q)in this._executionVariables}_hasConnectionValue(N){return N.uniqueId in this._connectionValues}_setConnectionValue(N,q){this._connectionValues[N.uniqueId]=q}_getConnectionValue(N){return this._connectionValues[N.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(N){this._pendingBlocks.push(N)}_removePendingBlock(N){const q=this._pendingBlocks.indexOf(N);-1!==q&&this._pendingBlocks.splice(q,1)}_clearPendingBlocks(){for(const N of this._pendingBlocks)N._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(N){this.onNodeExecutedObservable.notifyObservers(N)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AR;N.uniqueId=this.uniqueId,N._userVariables={};for(const R in this._userVariables)q(R,this._userVariables[R],N._userVariables);N._connectionValues={};for(const R in this._connectionValues)q(R,this._connectionValues[R],N._connectionValues)}getClassName(){return"FGContext"}static Parse(N,q){const R=q.graph.createContext(),z=q.valueParseFunction??yR;R.uniqueId=N.uniqueId;for(const v in N._userVariables){const q=z(v,N._userVariables,R._configuration.Xd);R._userVariables[v]=q}for(const v in N._connectionValues){const q=z(v,N._connectionValues,R._configuration.Xd);R._connectionValues[v]=q}return R}}(0,Y.c)([(0,T.D)()],fR.prototype,"uniqueId",void 0);var DR,VR,HR=R(11286);function YR(N,q){return!(!N.parent||N.parent!==q&&!YR(N.parent,q))}class TR extends bR{constructor(N){super(N),this.config=N}_getReferencedMesh(){const N=this.config.pathConverter.convert(this.config.path),q=N.info.getObject(N.object);if(!q||!(q instanceof s.e))throw new Error("Mesh pick event block requires a valid mesh");return q}_preparePendingTasks(N){let q=N._getExecutionVariable(this,"meshPickObserver");if(!q){const R=this._getReferencedMesh();N._setExecutionVariable(this,"mesh",R),q=R.va().onPointerObservable.add((q=>{var z,v,B;q.type===HR.e.POINTERPICK&&null!==(z=q.pickInfo)&&void 0!==z&&z.pickedMesh&&((null===(v=q.pickInfo)||void 0===v?void 0:v.pickedMesh)===R||YR(null===(B=q.pickInfo)||void 0===B?void 0:B.pickedMesh,R))&&this._execute(N)}));const z=R.jj.add((()=>this._onDispose));N._setExecutionVariable(this,"meshPickObserver",q),N._setExecutionVariable(this,"meshDisposeObserver",z)}}_onDispose(N){this._cancelPendingTasks(N),N._removePendingBlock(this)}_cancelPendingTasks(N){const q=N._getExecutionVariable(this,"mesh"),R=N._getExecutionVariable(this,"meshPickObserver"),z=N._getExecutionVariable(this,"meshDisposeObserver");q.va().onPointerObservable.remove(R),q.jj.remove(z),N._deleteExecutionVariable(this,"mesh"),N._deleteExecutionVariable(this,"meshPickObserver"),N._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return TR.ClassName}serialize(N){super.serialize(N),N.config.path=this.config.path}}TR.ClassName="FGMeshPickEventBlock",(0,Q.f)(TR.ClassName,TR),function(N){N[N.Stopped=0]="Stopped",N[N.Started=1]="Started"}(DR||(DR={}));class LR{constructor(N){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=N.Xd,this._coordinator=N.coordinator,this._sceneDisposeObserver=this._scene.jj.add((()=>this.dispose()))}createContext(){const N=new fR({Xd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(N),N}getContext(N){return this._executionContexts[N]}addEventBlock(N){this._eventBlocks.push(N)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const N of this._executionContexts){const q=this._getContextualOrder();for(const R of q)R._startPendingTasks(N)}}}_getContextualOrder(){const N=[];for(const q of this._eventBlocks)if(q.getClassName()===TR.ClassName){const R=q._getReferencedMesh();let z=0;for(;z<N.length;z++){const q=N[z]._getReferencedMesh();if(R&&q&&YR(R,q))break}N.splice(z,0,q)}else N.push(q);return N}dispose(){if(0!==this.state){this.state=0;for(const N of this._executionContexts)N._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.jj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(N){const q=[],R=new Set;for(const z of this._eventBlocks)q.push(z),R.add(z.uniqueId);for(;q.length>0;){const z=q.pop();N(z);for(const N of z.dataInputs)for(const z of N._connectedPoint)R.has(z._ownerBlock.uniqueId)||(q.push(z._ownerBlock),R.add(z._ownerBlock.uniqueId));if(z instanceof xR)for(const N of z.signalOutputs)for(const z of N._connectedPoint)R.has(z._ownerBlock.uniqueId)||(q.push(z._ownerBlock),R.add(z._ownerBlock.uniqueId))}}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1?arguments[1]:void 0;N.allBlocks=[],this.visitAllBlocks((q=>{const R={};q.serialize(R),N.allBlocks.push(R)})),N.executionContexts=[];for(const R of this._executionContexts){const z={};R.serialize(z,q),N.executionContexts.push(z)}}static GetDataOutConnectionByUniqueId(N,q){for(const R of N)for(const N of R.dataOutputs)if(N.uniqueId===q)return N;throw new Error("Could not find data out connection with unique id "+q)}static GetSignalInConnectionByUniqueId(N,q){for(const R of N)if(R instanceof xR)for(const N of R.signalInputs)if(N.uniqueId===q)return N;throw new Error("Could not find signal in connection with unique id "+q)}static Parse(N,q){const R=q.coordinator.createGraph(),z=[],v=q.valueParseFunction??yR;for(const B of N.allBlocks){const N=ER.Parse(B,{Xd:q.coordinator.config.Xd,pathConverter:q.pathConverter,valueParseFunction:v});z.push(N),N instanceof bR&&R.addEventBlock(N)}for(const B of z){for(const N of B.dataInputs)for(const q of N.connectedPointIds){const R=LR.GetDataOutConnectionByUniqueId(z,q);N.connectTo(R)}if(B instanceof xR)for(const N of B.signalOutputs)for(const q of N.connectedPointIds){const R=LR.GetSignalInConnectionByUniqueId(z,q);N.connectTo(R)}}for(const B of N.executionContexts)fR.Parse(B,{graph:R,valueParseFunction:v});return R}}class XR{constructor(N){this.config=N,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Xd.jj.add((()=>{this.dispose()}));(XR.SceneCoordinators.get(this.config.Xd)??[]).push(this)}createGraph(){const N=new LR({Xd:this.config.Xd,coordinator:this});return this._flowGraphs.push(N),N}removeGraph(N){const q=this._flowGraphs.indexOf(N);-1!==q&&(N.dispose(),this._flowGraphs.splice(q,1))}start(){this._flowGraphs.forEach((N=>N.start()))}dispose(){this._flowGraphs.forEach((N=>N.dispose())),this._flowGraphs.length=0;const N=XR.SceneCoordinators.get(this.config.Xd)??[],q=N.indexOf(this);-1!==q&&N.splice(q,1)}serialize(N,q){N._flowGraphs=[],this._flowGraphs.forEach((R=>{const z={};R.serialize(z,q),N._flowGraphs.push(z)}))}static Parse(N,q){var R;const z=q.valueParseFunction??yR,v=new XR({Xd:q.Xd});return null===(R=N._flowGraphs)||void 0===R||R.forEach((N=>{LR.Parse(N,{coordinator:v,valueParseFunction:z,pathConverter:q.pathConverter})})),v}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(N){let q=this._customEventsMap.get(N);return q||(q=new E.d,this._customEventsMap.set(N,q)),q}notifyCustomEvent(N,q){const R=this._customEventsMap.get(N);R&&R.notifyObservers(q)}}XR.SceneCoordinators=new Map;class QR extends bR{_preparePendingTasks(N){if(!N._getExecutionVariable(this,"sceneReadyObserver")){const q=N.configuration.Xd.onReadyObservable.add((()=>{this._execute(N)}));N._setExecutionVariable(this,"sceneReadyObserver",q)}}_cancelPendingTasks(N){const q=N._getExecutionVariable(this,"sceneReadyObserver");N.configuration.Xd.onReadyObservable.remove(q),N._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return QR.ClassName}}QR.ClassName="FGSceneReadyEventBlock",(0,Q.f)("FGSceneReadyEventBlock",QR);class hR extends bR{_preparePendingTasks(N){if(!N._getExecutionVariable(this,"sceneBeforeRender")){const q=N.configuration.Xd.onBeforeRenderObservable.add((()=>{this._execute(N)}));N._setExecutionVariable(this,"sceneBeforeRender",q)}}_cancelPendingTasks(N){const q=N._getExecutionVariable(this,"sceneBeforeRender");N.configuration.Xd.onBeforeRenderObservable.remove(q),N._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return hR.ClassName}}hR.ClassName="FGSceneTickEventBlock",(0,Q.f)(hR.ClassName,hR);class uR extends xR{constructor(N){super(N),this.out=this._registerSignalOutput("out")}}class wR extends uR{constructor(N){super(N),this.message=this.registerDataInput("message",pq)}_execute(N){const q=this.message.getValue(N);f.c.Log(q),this.out._activateSignal(N)}getClassName(){return wR.ClassName}}wR.ClassName="FGConsoleLogBlock",(0,Q.f)(wR.ClassName,wR),function(N){N[N.INIT=0]="INIT",N[N.STARTED=1]="STARTED",N[N.ENDED=2]="ENDED"}(VR||(VR={}));class cR{constructor(N){this.onEachCountObservable=new E.d,this.onTimerAbortedObservable=new E.d,this.onTimerEndedObservable=new E.d,this.onStateChangedObservable=new E.d,this._observer=null,this._breakOnNextTick=!1,this._tick=N=>{const q=Date.now();this._timer=q-this._startTime;const R={startTime:this._startTime,currentTime:q,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:N},z=this._breakOnNextTick||this._breakCondition(R);z||this._timer>=this._timeToEnd?this._stop(R,z):this.onEachCountObservable.notifyObservers(R)},this._setState(0),this._contextObservable=N.contextObservable,this._observableParameters=N.observableParameters??{},this._breakCondition=N.breakCondition??(()=>!1),this._timeToEnd=N.timeout,N.onEnded&&this.onTimerEndedObservable.add(N.onEnded),N.ci&&this.onEachCountObservable.add(N.ci),N.onAborted&&this.onTimerAbortedObservable.add(N.onAborted)}set breakCondition(N){this._breakCondition=N}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=N,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(N){this._state=N,this.onStateChangedObservable.notifyObservers(this._state)}_stop(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),q?this.onTimerAbortedObservable.notifyObservers(N):this.onTimerEndedObservable.notifyObservers(N)}}class nR extends eR{constructor(N){super(N),this.timeout=this.registerDataInput("timeout",Wq)}_preparePendingTasks(N){const q=this.timeout.getValue(N);if(void 0!==q&&q>=0){const R=N._getExecutionVariable(this,"runningTimers")||[],z=N.configuration.Xd,v=new cR({timeout:q,contextObservable:z.onBeforeRenderObservable,onEnded:()=>this._onEnded(v,N)});v.start(),R.push(v),N._setExecutionVariable(this,"runningTimers",R)}}_execute(N){this._startPendingTasks(N),this.out._activateSignal(N)}_onEnded(N,q){const R=q._getExecutionVariable(this,"runningTimers")||[],z=R.indexOf(N);-1!==z?R.splice(z,1):F.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),q._removePendingBlock(this),this.done._activateSignal(q)}_cancelPendingTasks(N){const q=N._getExecutionVariable(this,"runningTimers")||[];for(const R of q)R.dispose();N._deleteExecutionVariable(this,"runningTimers")}getClassName(){return nR.ClassName}}nR.ClassName="FGTimerBlock",(0,Q.f)("FGTimerBlock",nR);class GR extends uR{constructor(N){super(N),this.config=N;for(let q=0;q<this.config.eventData.length;q++){const N=this.config.eventData[q];this.registerDataInput(N,pq)}}_execute(N){const q=this.config.eventId,R=this.dataInputs.map((q=>q.getValue(N)));N.configuration.coordinator.notifyCustomEvent(q,R),this.out._activateSignal(N)}getClassName(){return GR.ClassName}}GR.ClassName="FGSendCustomEventBlock",(0,Q.f)("FGSendCustomEventBlock",GR);class sR extends bR{constructor(N){super(N),this.config=N;for(let q=0;q<this.config.eventData.length;q++){const N=this.config.eventData[q];this.registerDataOutput(N,pq)}}_preparePendingTasks(N){const q=N.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=q.add((q=>{for(let R=0;R<q.length;R++)this.dataOutputs[R].setValue(q[R],N);this._execute(N)}))}_cancelPendingTasks(N){const q=N.configuration.coordinator.getCustomEventObservable(this.config.eventId);q?q.remove(this._eventObserver):F.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return sR.ClassName}serialize(N){super.serialize(N),N.eventId=this.config.eventId,N.eventData=this.config.eventData}}sR.ClassName="FGReceiveCustomEventBlock",(0,Q.f)(sR.ClassName,sR);class ZR extends xR{constructor(N){super(N),this.config=N,this.outFlows=[];for(let q=0;q<this.config.numberOutputFlows;q++)this.outFlows.push(this._registerSignalOutput(`${q}`))}_execute(N){for(let q=0;q<this.config.numberOutputFlows;q++)this.outFlows[q]._activateSignal(N)}getClassName(){return ZR.ClassName}}ZR.ClassName="FGSequenceBlock",(0,Q.f)(ZR.ClassName,ZR);const JR=new RegExp(/\{(\w+)\}/g);class MR{constructor(N,q){this.path=N,this.ownerBlock=q,this.templatedInputs=[];let R=JR.exec(N);for(;R;){const[,z]=R;this.templatedInputs.push(q.registerDataInput(z,vR)),R=JR.exec(N)}}getAccessor(N,q){let R=this.path;for(const z of this.templatedInputs){const N=z.getValue(q).value;R=R.replace(`{${z.name}}`,N.toString())}return N.convert(R)}}class mR extends ER{constructor(N){super(N),this.config=N,this.value=this.registerDataOutput("value",pq),this.templateComponent=new MR(N.path,this)}_updateOutputs(N){const q=this.templateComponent.getAccessor(this.config.pathConverter,N),R=q.info.get(q.object);this.value.setValue(R,N)}getClassName(){return mR.ClassName}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.config.path=this.config.path}}mR.ClassName="FGGetPropertyBlock",(0,Q.f)(mR.ClassName,mR);class gR extends uR{constructor(N){super(N),this.config=N,this.a=this.registerDataInput("a",pq),this.templateComponent=new MR(N.path,this)}_execute(N){const q=this.a.getValue(N),R=this.templateComponent.getAccessor(this.config.pathConverter,N);R.info.set(q,R.object),this.out._activateSignal(N)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.config.path=this.config.path}getClassName(){return gR.ClassName}}gR.ClassName="FGSetPropertyBlock",(0,Q.f)("FGSetPropertyBlock",gR);const jR="cachedOperationValue",lR="cachedExecutionId";class IR extends ER{constructor(N,q){super(q),this.value=this.registerDataOutput("value",N)}_updateOutputs(N){const q=N._getExecutionVariable(this,lR),R=N._getExecutionVariable(this,jR);if(void 0!==R&&q===N.executionId)this.value.setValue(R,N);else{const q=this._doOperation(N);N._setExecutionVariable(this,jR,q),N._setExecutionVariable(this,lR,N.executionId),this.value.setValue(q,N)}}}class UR extends IR{constructor(N,q,R,z,v,B){super(R,B),this._operation=z,this._className=v,this.a=this.registerDataInput("a",N),this.b=this.registerDataInput("b",q)}_doOperation(N){return this._operation(this.a.getValue(N),this.b.getValue(N))}getClassName(){return this._className}}class OR extends IR{constructor(N,q,R,z){super(N,z),this._operation=q,this._className=R}_doOperation(N){return this._operation()}getClassName(){return this._className}}class iR extends IR{constructor(N,q,R,z,v){super(q,v),this._operation=R,this._className=z,this.a=this.registerDataInput("a",N)}_doOperation(N){return this._operation(this.a.getValue(N))}getClassName(){return this._className}}class PR extends IR{constructor(N,q,R,z,v,B,F){super(z,F),this._operation=v,this._className=B,this.a=this.registerDataInput("a",N),this.b=this.registerDataInput("b",q),this.c=this.registerDataInput("c",R)}_doOperation(N){return this._operation(this.a.getValue(N),this.b.getValue(N),this.c.getValue(N))}getClassName(){return this._className}}function kR(N){return N.getClassName?N.getClassName():""}function oR(N,q){return"Vector2"===N&&"Vector2"===q||"o"===N&&"o"===q||"Vector4"===N&&"Vector4"===q}function CR(N,q){return"Matrix"===N&&"Matrix"===q}function KR(N,q){return"FlowGraphInteger"===N&&"FlowGraphInteger"===q}class rR extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicAdd(N,q)),rR.ClassName,N)}_polymorphicAdd(N,q){const R=kR(N),z=kR(q);return oR(R,z)||CR(R,z)||KR(R,z)?N.add(q):N+q}}rR.ClassName="FGAddBlock",(0,Q.f)(rR.ClassName,rR);class aR extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicAdd(N,q)),aR.ClassName,N)}_polymorphicAdd(N,q){const R=kR(N),z=kR(q);return oR(R,z)||KR(R,z)?N.gd(q):CR(R,z)?N.add(q.scale(-1)):N-q}}aR.ClassName="FGSubBlock",(0,Q.f)(aR.ClassName,aR);class dR extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicMultiply(N,q)),dR.ClassName,N)}_polymorphicMultiply(N,q){const R=kR(N),z=kR(q);return oR(R,z)||KR(R,z)?N.multiply(q):CR(R,z)?v.d.FromValues(N.m[0]*q.m[0],N.m[4]*q.m[4],N.m[8]*q.m[8],N.m[12]*q.m[12],N.m[1]*q.m[1],N.m[5]*q.m[5],N.m[9]*q.m[9],N.m[13]*q.m[13],N.m[2]*q.m[2],N.m[6]*q.m[6],N.m[10]*q.m[10],N.m[14]*q.m[14],N.m[3]*q.m[3],N.m[7]*q.m[7],N.m[11]*q.m[11],N.m[15]*q.m[15]):N*q}}dR.ClassName="FGMultiplyBlock",(0,Q.f)(dR.ClassName,dR);class pR extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicDivide(N,q)),pR.ClassName,N)}_polymorphicDivide(N,q){const R=kR(N),z=kR(q);return oR(R,z)||KR(R,z)?N.divide(q):CR(R,z)?v.d.FromValues(N.m[0]/q.m[0],N.m[4]/q.m[4],N.m[8]/q.m[8],N.m[12]/q.m[12],N.m[1]/q.m[1],N.m[5]/q.m[5],N.m[9]/q.m[9],N.m[13]/q.m[13],N.m[2]/q.m[2],N.m[6]/q.m[6],N.m[10]/q.m[10],N.m[14]/q.m[14],N.m[3]/q.m[3],N.m[7]/q.m[7],N.m[11]/q.m[11],N.m[15]/q.m[15]):N/q}}pR.ClassName="FGDivideBlock",(0,Q.f)(pR.ClassName,pR);class WR extends OR{constructor(N){super(Wq,(()=>Math.random()),WR.ClassName,N)}}WR.ClassName="FGRandomBlock",(0,Q.f)(WR.ClassName,WR);class Nz extends UR{constructor(N){super(pq,pq,Wq,((N,q)=>this._polymorphicDot(N,q)),Nz.ClassName,N)}_polymorphicDot(N,q){switch(kR(N)){case"Vector2":return v.l.Dot(N,q);case"o":return v.m.Dot(N,q);case"Vector4":return v.p.Dot(N,q);default:throw new Error(`Cannot get dot product of ${N} and ${q}`)}}}Nz.ClassName="FGDotBlock",(0,Q.f)(Nz.ClassName,Nz);class qz extends OR{constructor(N){super(Wq,(()=>Math.E),qz.ClassName,N)}}qz.ClassName="FGEBlock",(0,Q.f)(qz.ClassName,qz);class Rz extends OR{constructor(N){super(Wq,(()=>Math.PI),Rz.ClassName,N)}}Rz.ClassName="FGPIBlock",(0,Q.f)(Rz.ClassName,Rz);class zz extends OR{constructor(N){super(Wq,(()=>Number.POSITIVE_INFINITY),zz.ClassName,N)}}zz.ClassName="FGInfBlock",(0,Q.f)(zz.ClassName,zz);class vz extends OR{constructor(N){super(Wq,(()=>Number.NaN),vz.ClassName,N)}}function Bz(N,q){switch(kR(N)){case"FlowGraphInteger":return new aq(q(N.value));case"Vector2":return new v.l(q(N.x),q(N.y));case"o":return new v.m(q(N.x),q(N.y),q(N.z));case"Vector4":return new v.p(q(N.x),q(N.y),q(N.z),q(N.w));case"Matrix":return v.d.FromValues(q(N.m[0]),q(N.m[4]),q(N.m[8]),q(N.m[12]),q(N.m[1]),q(N.m[5]),q(N.m[9]),q(N.m[13]),q(N.m[2]),q(N.m[6]),q(N.m[10]),q(N.m[14]),q(N.m[3]),q(N.m[7]),q(N.m[11]),q(N.m[15]));default:return q(N)}}vz.ClassName="FGNaNBlock",(0,Q.f)(vz.ClassName,vz);class Fz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicAbs(N)),Fz.ClassName,N)}_polymorphicAbs(N){return Bz(N,Math.abs)}}Fz.ClassName="FGAbsBlock",(0,Q.f)(Fz.ClassName,Fz);class Sz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicSign(N)),Sz.ClassName,N)}_polymorphicSign(N){return Bz(N,Math.sign)}}Sz.ClassName="FGSignBlock",(0,Q.f)(Sz.ClassName,Sz);class Az extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicTrunc(N)),Az.ClassName,N)}_polymorphicTrunc(N){return Bz(N,Math.trunc)}}Az.ClassName="FGTruncBlock",(0,Q.f)(Az.ClassName,Az);class yz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicFloor(N)),yz.ClassName,N)}_polymorphicFloor(N){return Bz(N,Math.floor)}}yz.ClassName="FGFloorBlock",(0,Q.f)(yz.ClassName,yz);class Ez extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicCeiling(N)),Ez.ClassName,N)}_polymorphicCeiling(N){return Bz(N,Math.ceil)}}Ez.ClassName="FGCeilBlock",(0,Q.f)(Ez.ClassName,Ez);class tz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicFract(N)),tz.ClassName,N)}_polymorphicFract(N){return Bz(N,(N=>N-Math.floor(N)))}}tz.ClassName="FGFractBlock",(0,Q.f)(tz.ClassName,tz);class xz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicNeg(N)),xz.ClassName,N)}_polymorphicNeg(N){return Bz(N,(N=>-N))}}function ez(N,q,R){switch(kR(N)){case"FlowGraphInteger":return new aq(R(N.value,q.value));case"Vector2":return new v.l(R(N.x,q.x),R(N.y,q.y));case"o":return new v.m(R(N.x,q.x),R(N.y,q.y),R(N.z,q.z));case"Vector4":return new v.p(R(N.x,q.x),R(N.y,q.y),R(N.z,q.z),R(N.w,q.w));case"Matrix":return v.d.FromValues(R(N.m[0],q.m[0]),R(N.m[4],q.m[4]),R(N.m[8],q.m[8]),R(N.m[12],q.m[12]),R(N.m[1],q.m[1]),R(N.m[5],q.m[5]),R(N.m[9],q.m[9]),R(N.m[13],q.m[13]),R(N.m[2],q.m[2]),R(N.m[6],q.m[6]),R(N.m[10],q.m[10]),R(N.m[14],q.m[14]),R(N.m[3],q.m[3]),R(N.m[7],q.m[7]),R(N.m[11],q.m[11]),R(N.m[15],q.m[15]));default:return R(N,q)}}xz.ClassName="FGNegBlock",(0,Q.f)(xz.ClassName,xz);class bz extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicRemainder(N,q)),bz.ClassName,N)}_polymorphicRemainder(N,q){return ez(N,q,((N,q)=>N%q))}}bz.ClassName="FGRemainderBlock",(0,Q.f)(bz.ClassName,bz);class fz extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicMin(N,q)),fz.ClassName,N)}_polymorphicMin(N,q){return ez(N,q,Math.min)}}fz.ClassName="FGMinBlock",(0,Q.f)(fz.ClassName,fz);class Dz extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicMax(N,q)),Dz.ClassName,N)}_polymorphicMax(N,q){return ez(N,q,Math.max)}}function Vz(N,q,R){return Math.min(Math.max(N,Math.min(q,R)),Math.max(q,R))}function Hz(N,q,R,z){switch(kR(N)){case"FlowGraphInteger":return new aq(z(N.value,q.value,R.value));case"Vector2":return new v.l(z(N.x,q.x,R.x),z(N.y,q.y,R.y));case"o":return new v.m(z(N.x,q.x,R.x),z(N.y,q.y,R.y),z(N.z,q.z,R.z));case"Vector4":return new v.p(z(N.x,q.x,R.x),z(N.y,q.y,R.y),z(N.z,q.z,R.z),z(N.w,q.w,R.w));case"Matrix":return v.d.FromValues(z(N.m[0],q.m[0],R.m[0]),z(N.m[4],q.m[4],R.m[4]),z(N.m[8],q.m[8],R.m[8]),z(N.m[12],q.m[12],R.m[12]),z(N.m[1],q.m[1],R.m[1]),z(N.m[5],q.m[5],R.m[5]),z(N.m[9],q.m[9],R.m[9]),z(N.m[13],q.m[13],R.m[13]),z(N.m[2],q.m[2],R.m[2]),z(N.m[6],q.m[6],R.m[6]),z(N.m[10],q.m[10],R.m[10]),z(N.m[14],q.m[14],R.m[14]),z(N.m[3],q.m[3],R.m[3]),z(N.m[7],q.m[7],R.m[7]),z(N.m[11],q.m[11],R.m[11]),z(N.m[15],q.m[15],R.m[15]));default:return z(N,q,R)}}Dz.ClassName="FGMaxBlock",(0,Q.f)(Dz.ClassName,Dz);class Yz extends PR{constructor(N){super(pq,pq,pq,pq,((N,q,R)=>this._polymorphicClamp(N,q,R)),Yz.ClassName,N)}_polymorphicClamp(N,q,R){return Hz(N,q,R,Vz)}}function Tz(N){return Math.min(Math.max(N,0),1)}Yz.ClassName="FGClampBlock",(0,Q.f)(Yz.ClassName,Yz);class Lz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicSaturate(N)),Lz.ClassName,N)}_polymorphicSaturate(N){return Bz(N,Tz)}}Lz.ClassName="FGSaturateBlock",(0,Q.f)(Lz.ClassName,Lz);class Xz extends PR{constructor(N){super(pq,pq,pq,pq,((N,q,R)=>this._polymorphicInterpolate(N,q,R)),Xz.ClassName,N)}_interpolate(N,q,R){return(1-R)*N+R*q}_polymorphicInterpolate(N,q,R){return Hz(N,q,R,this._interpolate)}}Xz.ClassName="FGInterpolateBlock",(0,Q.f)(Xz.ClassName,Xz);class Qz extends UR{constructor(N){super(pq,pq,NR,((N,q)=>this._polymorphicEq(N,q)),Qz.ClassName,N)}_polymorphicEq(N,q){const R=kR(N),z=kR(q);return oR(R,z)||CR(R,z)||KR(R,z)?N.equals(q):N===q}}function hz(N,q,R){const z=kR(N);if(z===kR(q)){if(""===z)return R(N,q);if("FlowGraphInteger"===z)return R(N.value,q.value);throw new Error(`Cannot compare ${N} and ${q}`)}throw new Error(`${N} and ${q} are of different types.`)}Qz.ClassName="FGEqBlock",(0,Q.f)(Qz.ClassName,Qz);class uz extends UR{constructor(N){super(pq,pq,NR,((N,q)=>this._polymorphicLessThan(N,q)),uz.ClassName,N)}_polymorphicLessThan(N,q){return hz(N,q,((N,q)=>N<q))}}uz.ClassName="FGLessThanBlock",(0,Q.f)(uz.ClassName,uz);class wz extends UR{constructor(N){super(pq,pq,NR,((N,q)=>this._polymorphicLessThanOrEqual(N,q)),wz.ClassName,N)}_polymorphicLessThanOrEqual(N,q){return hz(N,q,((N,q)=>N<=q))}}wz.ClassName="FGLessThanOrEqualBlock";class cz extends UR{constructor(N){super(pq,pq,NR,((N,q)=>this._polymorphicGreaterThan(N,q)),cz.ClassName,N)}_polymorphicGreaterThan(N,q){return hz(N,q,((N,q)=>N>q))}}cz.ClassName="FGGreaterThanBlock",(0,Q.f)(cz.ClassName,cz);class nz extends UR{constructor(N){super(pq,pq,NR,((N,q)=>this._polymorphicGreaterThanOrEqual(N,q)),nz.ClassName,N)}_polymorphicGreaterThanOrEqual(N,q){return hz(N,q,((N,q)=>N>=q))}}nz.ClassName="FGGreaterThanOrEqualBlock",(0,Q.f)(nz.ClassName,nz);class Gz extends iR{constructor(N){super(pq,NR,(N=>this._polymorphicIsNan(N)),Gz.ClassName,N)}_polymorphicIsNan(N){const q=kR(N);if(""===q)return isNaN(N);if("FlowGraphInteger"===q)return isNaN(N.value);throw new Error(`Cannot get NaN of ${N}`)}}Gz.ClassName="FGIsNanBlock",(0,Q.f)(Gz.ClassName,Gz);class sz extends iR{constructor(N){super(pq,NR,(N=>this._polymorphicIsInf(N)),sz.ClassName,N)}_polymorphicIsInf(N){const q=kR(N);if(""===q)return!isFinite(N);if("FlowGraphInteger"===q)return!isFinite(N.value);throw new Error(`Cannot get isInf of ${N}`)}}sz.ClassName="FGIsInfBlock";class Zz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicDegToRad(N)),Zz.ClassName,N)}_degToRad(N){return N*Math.PI/180}_polymorphicDegToRad(N){return Bz(N,this._degToRad)}}Zz.ClassName="FGDegToRadBlock",(0,Q.f)(Zz.ClassName,Zz);class Jz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicRadToDeg(N)),Jz.ClassName,N)}_radToDeg(N){return 180*N/Math.PI}_polymorphicRadToDeg(N){return Bz(N,this._radToDeg)}}Jz.ClassName="FGRadToDegBlock",(0,Q.f)(Jz.ClassName,Jz);class Mz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicSin(N)),Mz.ClassName,N)}_polymorphicSin(N){return Bz(N,Math.sin)}}Mz.ClassName="FGSinBlock",(0,Q.f)(Mz.ClassName,Mz);class mz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicCos(N)),mz.ClassName,N)}_polymorphicCos(N){return Bz(N,Math.cos)}}mz.ClassName="FGCosBlock",(0,Q.f)(mz.ClassName,mz);class gz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicTan(N)),gz.ClassName,N)}_polymorphicTan(N){return Bz(N,Math.tan)}}gz.ClassName="FGTanBlock",(0,Q.f)(gz.ClassName,gz);class jz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicAsin(N)),jz.ClassName,N)}_polymorphicAsin(N){return Bz(N,Math.asin)}}jz.ClassName="FGAsinBlock",(0,Q.f)(jz.ClassName,jz);class lz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicAcos(N)),lz.ClassName,N)}_polymorphicAcos(N){return Bz(N,Math.acos)}}lz.ClassName="FGAcosBlock",(0,Q.f)(lz.ClassName,lz);class Iz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicAtan(N)),Iz.ClassName,N)}_polymorphicAtan(N){return Bz(N,Math.atan)}}Iz.ClassName="FGAtanBlock",(0,Q.f)(Iz.ClassName,Iz);class Uz extends UR{constructor(N){super(pq,pq,pq,((N,q)=>this._polymorphicAtan2(N,q)),Uz.ClassName,N)}_polymorphicAtan2(N,q){return ez(N,q,Math.atan2)}}Uz.ClassName="FGAtan2Block",(0,Q.f)(Uz.ClassName,Uz);class Oz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicSinh(N)),Oz.ClassName,N)}_polymorphicSinh(N){return Bz(N,Math.sinh)}}Oz.ClassName="FGSinhBlock",(0,Q.f)(Oz.ClassName,Oz);class iz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicCosh(N)),iz.ClassName,N)}_polymorphicCosh(N){return Bz(N,Math.cosh)}}iz.ClassName="FGCoshBlock",(0,Q.f)(iz.ClassName,iz);class Pz extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicTanh(N)),Pz.ClassName,N)}_polymorphicTanh(N){return Bz(N,Math.tanh)}}Pz.ClassName="FGTanhBlock",(0,Q.f)(Pz.ClassName,Pz);class kz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicAsinh(N)),kz.ClassName,N)}_polymorphicAsinh(N){return Bz(N,Math.asinh)}}kz.ClassName="FGAsinhBlock",(0,Q.f)(kz.ClassName,kz);class oz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicAcosh(N)),oz.ClassName,N)}_polymorphicAcosh(N){return Bz(N,Math.acosh)}}oz.ClassName="FGAcoshBlock",(0,Q.f)(oz.ClassName,oz);class Cz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicAtanh(N)),Cz.ClassName,N)}_polymorphicAtanh(N){return Bz(N,Math.atanh)}}Cz.ClassName="FGAtanhBlock",(0,Q.f)(Cz.ClassName,Cz);class Kz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicExp(N)),Kz.ClassName,N)}_polymorphicExp(N){return Bz(N,Math.exp)}}Kz.ClassName="FGExpBlock",(0,Q.f)(Kz.ClassName,Kz);class rz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicLog(N)),rz.ClassName,N)}_polymorphicLog(N){return Bz(N,Math.log)}}rz.ClassName="FGLogBlock",(0,Q.f)(rz.ClassName,rz);class az extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicLog2(N)),az.ClassName,N)}_polymorphicLog2(N){return Bz(N,Math.log2)}}az.ClassName="FGLog2Block",(0,Q.f)(az.ClassName,az);class dz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicLog10(N)),dz.ClassName,N)}_polymorphicLog10(N){return Bz(N,Math.log10)}}dz.ClassName="FGLog10Block",(0,Q.f)(dz.ClassName,dz);class pz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicSqrt(N)),pz.ClassName,N)}_polymorphicSqrt(N){return Bz(N,Math.sqrt)}}pz.ClassName="FGSqrtBlock",(0,Q.f)(pz.ClassName,pz);class Wz extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicCubeRoot(N)),Wz.ClassName,N)}_polymorphicCubeRoot(N){return Bz(N,Math.cbrt)}}Wz.ClassName="FGCubeRootBlock",(0,Q.f)(Wz.ClassName,Wz);class Nv extends UR{constructor(N){super(pq,Wq,Wq,((N,q)=>this._polymorphicPow(N,q)),Nv.ClassName,N)}_polymorphicPow(N,q){return ez(N,q,Math.pow)}}Nv.ClassName="FGPowBlock",(0,Q.f)(Nv.ClassName,Nv);class qv extends iR{constructor(N){super(pq,Wq,(N=>this._polymorphicLength(N)),qv.ClassName,N)}_polymorphicLength(N){switch(kR(N)){case"Vector2":case"o":case"Vector4":return N.length();default:throw new Error(`Cannot compute length of value ${N}`)}}}qv.ClassName="FGLengthBlock",(0,Q.f)(qv.ClassName,qv);class Rv extends iR{constructor(N){super(pq,pq,(N=>this._polymorphicNormalize(N)),Rv.ClassName,N)}_polymorphicNormalize(N){switch(kR(N)){case"Vector2":case"o":case"Vector4":return N.normalize();default:throw new Error(`Cannot normalize value ${N}`)}}}Rv.ClassName="FGNormalizeBlock",(0,Q.f)(Rv.ClassName,Rv);class zv extends UR{constructor(N){super(RR,RR,RR,((N,q)=>v.m.Cross(N,q)),zv.ClassName,N)}}zv.ClassName="FGCrossBlock",(0,Q.f)(zv.ClassName,zv);class vv extends UR{constructor(N){super(qR,Wq,qR,((N,q)=>v.l.Transform(N,v.d.RotationZ(q))),vv.ClassName,N)}}vv.ClassName="FGRotate2DBlock",(0,Q.f)(vv.ClassName,vv);class Bv extends PR{constructor(N){super(RR,RR,Wq,RR,((N,q,R)=>v.m.TransformCoordinates(N,v.d.RotationAxis(q,R))),Bv.ClassName,N)}}Bv.ClassName="FGRotate3DBlock",(0,Q.f)(Bv.ClassName,Bv);class Fv extends iR{constructor(N){super(zR,zR,(N=>v.d.Transpose(N)),Fv.ClassName,N)}}Fv.ClassName="FGTransposeBlock",(0,Q.f)(Fv.ClassName,Fv);class Sv extends iR{constructor(N){super(zR,Wq,(N=>N.determinant()),Sv.ClassName,N)}}Sv.ClassName="FGDeterminantBlock",(0,Q.f)(Sv.ClassName,Sv);class Av extends iR{constructor(N){super(zR,zR,(N=>v.d.Invert(N)),Av.ClassName,N)}}Av.ClassName="FGInvertMatrixBlock",(0,Q.f)(Av.ClassName,Av);class yv extends UR{constructor(N){super(zR,zR,zR,((N,q)=>q.multiply(N)),yv.ClassName,N)}}yv.ClassName="FGMatMulBlock",(0,Q.f)(yv.ClassName,yv);class Ev extends iR{constructor(N){super(vR,vR,(N=>new aq(~N.value)),Ev.ClassName,N)}}Ev.ClassName="FGBitwiseNotBlock",(0,Q.f)(Ev.ClassName,Ev);class tv extends UR{constructor(N){super(vR,vR,vR,((N,q)=>new aq(N.value&q.value)),tv.ClassName,N)}}tv.ClassName="FGBitwiseAndBlock",(0,Q.f)(tv.ClassName,tv);class xv extends UR{constructor(N){super(vR,vR,vR,((N,q)=>new aq(N.value|q.value)),xv.ClassName,N)}}xv.ClassName="FGBitwiseOrBlock",(0,Q.f)(xv.ClassName,xv);class ev extends UR{constructor(N){super(vR,vR,vR,((N,q)=>new aq(N.value^q.value)),ev.ClassName,N)}}ev.ClassName="FGBitwiseXorBlock",(0,Q.f)(ev.ClassName,ev);class bv extends UR{constructor(N){super(vR,vR,vR,((N,q)=>new aq(N.value<<q.value)),bv.ClassName,N)}}bv.ClassName="FGBitwiseLeftShiftBlock",(0,Q.f)(bv.ClassName,bv);class fv extends UR{constructor(N){super(vR,vR,vR,((N,q)=>new aq(N.value>>q.value)),fv.ClassName,N)}}fv.ClassName="FGBitwiseRightShiftBlock",(0,Q.f)(fv.ClassName,fv);class Dv extends iR{constructor(N){super(vR,vR,(N=>new aq(Math.clz32(N.value))),Dv.ClassName,N)}}Dv.ClassName="FGCountLeadingZerosBlock",(0,Q.f)(Dv.ClassName,Dv);class Vv extends iR{constructor(N){super(vR,vR,(N=>new aq(N.value?31-Math.clz32(N.value&-N.value):32)),Vv.ClassName,N)}}Vv.ClassName="FGCountTrailingZerosBlock",(0,Q.f)(Vv.ClassName,Vv);class Hv extends iR{constructor(N){super(vR,vR,(N=>new aq(function(N){let q=0;for(;N;)q+=1&N,N>>=1;return q}(N.value))),Hv.ClassName,N)}}Hv.ClassName="FGCountOneBitsBlock",(0,Q.f)(Hv.ClassName,Hv);class Yv extends uR{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new aq(0)};super(N),this.config=N,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",vR),this.value=this.registerDataOutput("value",vR)}_execute(N,q){if(q===this.reset)this.value.setValue(this.config.startIndex,N);else{const q=this.value.getValue(N);q.value<this.n.getValue(N).value&&(this.value.setValue(new aq(q.value+1),N),this.out._activateSignal(N))}}getClassName(){return Yv.ClassName}}Yv.ClassName="FGDoNBlock",(0,Q.f)(Yv.ClassName,Yv);class Tv extends ER{constructor(N){super(N),this.config=N,this.output=this.registerDataOutput(N.variableName,pq)}_updateOutputs(N){const q=this.config.variableName;N.hasVariable(q)&&this.output.setValue(N.getVariable(q),N)}getClassName(){return Tv.ClassName}serialize(N){super.serialize(N),N.config.variableName=this.config.variableName}}Tv.ClassName="FGGetVariableBlock",(0,Q.f)(Tv.ClassName,Tv);class Lv extends uR{constructor(N){super(N),this.config=N,this.input=this.registerDataInput(N.variableName,pq)}_execute(N){const q=this.config.variableName,R=this.input.getValue(N);N.setVariable(q,R),this.out._activateSignal(N)}getClassName(){return Lv.ClassName}}Lv.ClassName="FGSetVariableBlock",(0,Q.f)(Lv.ClassName,Lv);class Xv extends uR{constructor(N){super(N),this.config=N,this.condition=this.registerDataInput("condition",NR),this.loopBody=this._registerSignalOutput("loopBody")}_execute(N,q){var R;let z=this.condition.getValue(N);for(null!==(R=this.config)&&void 0!==R&&R.isDo&&!z&&this.loopBody._activateSignal(N);z;)this.loopBody._activateSignal(N),z=this.condition.getValue(N);this.out._activateSignal(N)}getClassName(){return Xv.ClassName}serialize(N){var q;super.serialize(N),N.isDo=null===(q=this.config)||void 0===q?void 0:q.isDo}}Xv.ClassName="FGWhileLoopBlock",(0,Q.f)(Xv.ClassName,Xv);const Qv={"lifecycle/onStart":QR.ClassName,"lifecycle/onTick":hR.ClassName,log:wR.ClassName,"flow/delay":nR.ClassName,"customEvent/send":GR.ClassName,"customEvent/receive":sR.ClassName,"flow/sequence":ZR.ClassName,"world/get":mR.ClassName,"world/set":gR.ClassName,"flow/doN":Yv.ClassName,"variable/get":Tv.ClassName,"variable/set":Lv.ClassName,"flow/whileLoop":Xv.ClassName,"math/random":WR.ClassName,"math/e":qz.ClassName,"math/pi":Rz.ClassName,"math/inf":zz.ClassName,"math/nan":vz.ClassName,"math/abs":Fz.ClassName,"math/sign":Sz.ClassName,"math/trunc":Az.ClassName,"math/floor":yz.ClassName,"math/ceil":Ez.ClassName,"math/fract":tz.ClassName,"math/neg":xz.ClassName,"math/add":rR.ClassName,"math/sub":aR.ClassName,"math/mul":dR.ClassName,"math/div":pR.ClassName,"math/rem":bz.ClassName,"math/min":fz.ClassName,"math/max":Dz.ClassName,"math/clamp":Yz.ClassName,"math/saturate":Lz.ClassName,"math/mix":Xz.ClassName,"math/eq":Qz.ClassName,"math/lt":uz.ClassName,"math/le":wz.ClassName,"math/gt":cz.ClassName,"math/ge":nz.ClassName,"math/isnan":Gz.ClassName,"math/isinf":sz.ClassName,"math/rad":Zz.ClassName,"math/deg":Jz.ClassName,"math/sin":Mz.ClassName,"math/cos":mz.ClassName,"math/tan":gz.ClassName,"math/asin":jz.ClassName,"math/acos":lz.ClassName,"math/atan":Iz.ClassName,"math/atan2":Uz.ClassName,"math/sinh":Oz.ClassName,"math/cosh":iz.ClassName,"math/tanh":Pz.ClassName,"math/asinh":kz.ClassName,"math/acosh":oz.ClassName,"math/atanh":Cz.ClassName,"math/exp":Kz.ClassName,"math/log":rz.ClassName,"math/log2":az.ClassName,"math/log10":dz.ClassName,"math/sqrt":pz.ClassName,"math/cbrt":Wz.ClassName,"math/pow":Nv.ClassName,"math/length":qv.ClassName,"math/normalize":Rv.ClassName,"math/dot":Nz.ClassName,"math/cross":zv.ClassName,"math/rotate2d":vv.ClassName,"math/rotate3d":Bv.ClassName,"math/transpose":Fv.ClassName,"math/determinant":Sv.ClassName,"math/inverse":Av.ClassName,"math/matmul":yv.ClassName,"math/not":Ev.ClassName,"math/and":tv.ClassName,"math/or":xv.ClassName,"math/xor":ev.ClassName,"math/asr":fv.ClassName,"math/lsl":bv.ClassName,"math/clz":Dv.ClassName,"math/ctz":Vv.ClassName,"math/popcnt":Hv.ClassName},hv={float2:"Vector2",float3:"o",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function uv(N,q,R){if(void 0!==N.type){const z=q.types&&q.types[N.type];if(!z)throw new Error(`${R}: Unknown type: ${N.type}`);const v=z.signature;if(!v)throw new Error(`${R}: Type ${N.type} has no signature`);const B=hv[v];return{value:N.value,className:B}}return N.value}function wv(N,q,R){const z=Qv[q.type];if(!z)throw new Error(`/extensions/KHR_interactivity/nodes/${N}: Unknown block type: ${q.type}`);const v=N.toString(),B=function(N,q,R){const z={},v=N.configuration??[];for(const B of v)if("customEvent"===B.id){const N=q.customEvents&&q.customEvents[B.value];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${R}: Unknown custom event: ${B.value}`);z.eventId=N.id,z.eventData=N.values.map((N=>N.id))}else if("variable"===B.id){const N=q.variables&&q.variables[B.value];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${R}: Unknown variable: ${B.value}`);z.variableName=N.id}else if("path"===B.id){const N=B.value;z.path=N}else z[B.id]=uv(B,q,`/extensions/KHR_interactivity/nodes/${R}`);return z}(q,R,v);return{className:z,config:B,uniqueId:v,metadata:q.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class cv extends Qq{constructor(N){super(N,Gv)}}const nv={__array__:{__target__:!0,translation:{type:"o",get:N=>N._babylonTransformNode.position,set:(N,q)=>{q._babylonTransformNode.position=N},getObject:N=>N._babylonTransformNode}}},Gv={nodes:nv},sv="KHR_interactivity";class Zv{constructor(N){this._loader=N,this.name=sv,this.enabled=this._loader.isExtensionUsed(sv),this._pathConverter=new cv(this._loader.Oi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var N;if(!this._loader.babylonScene||!this._pathConverter)return;const q=this._loader.babylonScene,R=function(N){const q={uniqueId:(0,Kq.e)(),_userVariables:{},_connectionValues:{}},R=[q],z=[];for(let B=0;B<N.nodes.length;B++){const q=wv(B,N.nodes[B],N);z.push(q)}for(let B=0;B<N.nodes.length;B++){const R=N.nodes[B],v=z[B],F=R.flows??[];for(const N of F){const q=N.id,R={uniqueId:(0,Kq.e)(),name:q,_connectionType:1,connectedPointIds:[]};v.signalOutputs.push(R);const F=N.node,S=N.socket,A=z[F];if(!A)throw new Error(`/extensions/KHR_interactivity/nodes/${B}: Could not find node with id ${F} that connects its input with with node ${B}'s output ${q}`);let y=A.signalInputs.find((N=>N.name===S));y||(y={uniqueId:(0,Kq.e)(),name:S,_connectionType:0,connectedPointIds:[]},A.signalInputs.push(y)),y.connectedPointIds.push(R.uniqueId),R.connectedPointIds.push(y.uniqueId)}const S=R.values??[];for(const A of S){const R=A.id,F={uniqueId:(0,Kq.e)(),name:R,_connectionType:0,connectedPointIds:[]};if(v.dataInputs.push(F),void 0!==A.value){const R=uv(A,N,`/extensions/KHR_interactivity/nodes/${B}`);q._connectionValues[F.uniqueId]=R}else{if(void 0===A.node||void 0===A.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${B}: Invalid socket ${R} in node ${B}`);{const N=A.node,q=A.socket,v=z[N];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${B}: Could not find node with id ${N} that connects its output with node${B}'s input ${R}`);let S=v.dataOutputs.find((N=>N.name===q));S||(S={uniqueId:(0,Kq.e)(),name:q,_connectionType:1,connectedPointIds:[]},v.dataOutputs.push(S)),F.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(F.uniqueId)}}}}const v=N.variables??[];for(let B=0;B<v.length;B++){const R=v[B],z=R.id;q._userVariables[z]=uv(R,N,`/extensions/KHR_interactivity/variables/${B}`)}return{allBlocks:z,executionContexts:R}}(null===(N=this._loader.Oi.extensions)||void 0===N?void 0:N.KHR_interactivity),z=new XR({Xd:q});LR.Parse(R,{coordinator:z,pathConverter:this._pathConverter}),z.start()}}K(sv),C(sv,!0,(N=>new Zv(N)));const Jv="KHR_node_visibility";class Mv{constructor(N){this.name=Jv,this._loader=N,this.enabled=N.isExtensionUsed(Jv)}async onReady(){var N;null===(N=this._loader.Oi.nodes)||void 0===N||N.forEach((N=>{var q,R,z,v;(null===(q=N._primitiveBabylonMeshes)||void 0===q||q.forEach((N=>{N.inheritVisibility=!0})),null!==(R=N.extensions)&&void 0!==R&&R.KHR_node_visibility)&&(!1===(null===(z=N.extensions)||void 0===z?void 0:z.KHR_node_visibility.visible)&&(N._babylonTransformNode&&(N._babylonTransformNode.isVisible=!1),null===(v=N._primitiveBabylonMeshes)||void 0===v||v.forEach((N=>{N.isVisible=!1}))))}))}dispose(){this._loader=null}}K(Jv),C(Jv,!0,(N=>new Mv(N)));const mv="ExtrasAsMetadata";class gv{_assignExtras(N,q){if(q.extras&&Object.keys(q.extras).length>0){const R=N.metadata=N.metadata||{};(R.Oi=R.Oi||{}).extras=q.extras}}constructor(N){this.name=mv,this.enabled=!0,this._loader=N}dispose(){this._loader=null}loadNodeAsync(N,q,R){return this._loader.loadNodeAsync(N,q,(N=>{this._assignExtras(N,q),R(N)}))}loadCameraAsync(N,q,R){return this._loader.loadCameraAsync(N,q,(N=>{this._assignExtras(N,q),R(N)}))}createMaterial(N,q,R){const z=this._loader.createMaterial(N,q,R);return this._assignExtras(z,q),z}}K(mv),C(mv,!1,(N=>new gv(N)))},12113:(N,q,R)=>{"use strict";R.d(q,{d:()=>s,h:()=>h,j:()=>Q,k:()=>u});var z=R(10893),v=R(10888),B=R(11561),F=R(11445),S=R(11486),A=R(11481),y=R(10907),E=R(10933),t=R(12121),x=R(12127),e=R(11452);class b{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this._j=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(N){this._environmentTexture=N}getNodes(){let N=[];return N=N.concat(this.meshes),N=N.concat(this.lights),N=N.concat(this.cameras),N=N.concat(this.transformNodes),this.skeletons.forEach((q=>N=N.concat(q.bones))),N}}class f extends b{}class D{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((N=>{N.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((N=>{N.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((N=>{N.dispose()})),this.animationGroups.length=0}}class V extends b{constructor(N){super(),this._wasAddedToScene=!1,(N=N||E.b.LastCreatedScene)&&(this.Xd=N,this.proceduralTextures=[],N.jj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=N.getEngine().onContextRestoredObservable.add((()=>{for(const N of this.geometries)N._rebuild();for(const N of this.meshes)N._rebuild();for(const N of this.qj)N.rebuild();for(const N of this.textures)N._rebuild()})))}_topologicalSort(N){const q=new Map;for(const F of N)q.set(F.uniqueId,F);const R={dependsOn:new Map,dependedBy:new Map};for(const F of N){const N=F.uniqueId;R.dependsOn.set(N,new Set),R.dependedBy.set(N,new Set)}for(const F of N){const N=F.uniqueId,z=R.dependsOn.get(N);if(F instanceof t.d){const v=F.sourceMesh;q.has(v.uniqueId)&&(z.add(v.uniqueId),R.dependedBy.get(v.uniqueId).add(N))}const v=R.dependedBy.get(N);for(const B of F.getDescendants()){const z=B.uniqueId;if(q.has(z)){v.add(z);R.dependsOn.get(z).add(N)}}}const z=[],v=[];for(const F of N){const N=F.uniqueId;0===R.dependsOn.get(N).size&&(v.push(F),q.delete(N))}const B=v;for(;B.length>0;){const N=B.shift();z.push(N);const v=R.dependedBy.get(N.uniqueId);for(const z of Array.from(v.values())){const v=R.dependsOn.get(z);v.delete(N.uniqueId),0===v.size&&q.get(z)&&(B.push(q.get(z)),q.delete(z))}}return q.size>0&&(y.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),q.forEach((N=>y.c.Error(N.name)))),z}_addNodeAndDescendantsToList(N,q,R,z){if(R&&(!z||z(R))&&!q.has(R.uniqueId)){N.push(R),q.add(R.uniqueId);for(const v of R.getDescendants(!0))this._addNodeAndDescendantsToList(N,q,v,z)}}_isNodeInContainer(N){return N instanceof A.e&&-1!==this.meshes.indexOf(N)||(N instanceof S.e&&-1!==this.transformNodes.indexOf(N)||(N instanceof x.e&&-1!==this.lights.indexOf(N)||N instanceof e.e&&-1!==this.cameras.indexOf(N)))}_isValidHierarchy(){for(const N of this.meshes)if(N.parent&&!this._isNodeInContainer(N.parent))return y.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.transformNodes)if(N.parent&&!this._isNodeInContainer(N.parent))return y.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.lights)if(N.parent&&!this._isNodeInContainer(N.parent))return y.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.cameras)if(N.parent&&!this._isNodeInContainer(N.parent))return y.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||v.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const z={},B={},S=new D,A=[],y=[],E={doNotInstantiate:!0,...R},t=[],x=new Set;for(const v of this.transformNodes)null===v.parent&&this._addNodeAndDescendantsToList(t,x,v,E.predicate);for(const v of this.meshes)null===v.parent&&this._addNodeAndDescendantsToList(t,x,v,E.predicate);const e=this._topologicalSort(t),b=(R,v)=>{if(((q,R)=>{if(z[q.uniqueId]=R.uniqueId,B[R.uniqueId]=R,N&&(R.name=N(q.name)),R instanceof F.b){const N=R;if(N.morphTargetManager){const R=q.morphTargetManager;N.morphTargetManager=R.clone();for(let q=0;q<R.numTargets;q++){const v=R.getTarget(q),F=N.morphTargetManager.getTarget(q);z[v.uniqueId]=F.uniqueId,B[F.uniqueId]=F}}}})(R,v),R.parent){const N=z[R.parent.uniqueId],q=B[N];v.parent=q||R.parent}if(v.position&&R.position&&v.position.p(R.position),v.rotationQuaternion&&R.rotationQuaternion&&v.rotationQuaternion.p(R.rotationQuaternion),v.rotation&&R.rotation&&v.rotation.p(R.rotation),v.re&&R.re&&v.re.p(R.re),v.material){const F=v;if(F.material)if(q){const q=R.material;if(-1===y.indexOf(q)){let R=q.clone(N?N(q.name):"Clone of "+q.name);if(y.push(q),z[q.uniqueId]=R.uniqueId,B[R.uniqueId]=R,"MultiMaterial"===q.getClassName()){const v=q;for(const q of v.mg)q&&(R=q.clone(N?N(q.name):"Clone of "+q.name),y.push(q),z[q.uniqueId]=R.uniqueId,B[R.uniqueId]=R);v.mg=v.mg.map((N=>N&&B[z[N.uniqueId]]))}}"InstancedMesh"!==F.getClassName()&&(F.material=B[z[q.uniqueId]])}else"MultiMaterial"===F.material.getClassName()?-1===this.Xd.multiMaterials.indexOf(F.material)&&this.Xd.addMultiMaterial(F.material):-1===this.Xd.materials.indexOf(F.material)&&this.Xd.addMaterial(F.material)}null===v.parent&&S.rootNodes.push(v)};return e.forEach((N=>{if("InstancedMesh"===N.getClassName()){const q=N,R=q.sourceMesh,v=z[R.uniqueId],F=("number"===typeof v?B[v]:R).createInstance(q.name);b(q,F)}else{let q=!0;"qb"===N.getClassName()||"Node"===N.getClassName()||N.skeleton||!N.getTotalVertices||0===N.getTotalVertices()?q=!1:E.doNotInstantiate&&(q="function"===typeof E.doNotInstantiate?!E.doNotInstantiate(N):!E.doNotInstantiate);const R=q?N.createInstance(`instance of ${N.name}`):N.clone(`Clone of ${N.name}`,null,!0);if(!R)throw new Error(`Could not clone or instantiate node on Asset Container ${N.name}`);b(N,R)}})),this.skeletons.forEach((q=>{if(E.predicate&&!E.predicate(q))return;const R=q.clone(N?N(q.name):"Clone of "+q.name);for(const N of this.meshes)if(N.skeleton===q&&!N.isAnInstance){const q=B[z[N.uniqueId]];if(!q||q.isAnInstance)continue;if(q.skeleton=R,-1!==A.indexOf(R))continue;A.push(R);for(const N of R.bones)N._linkedTransformNode&&(N._linkedTransformNode=B[z[N._linkedTransformNode.uniqueId]])}S.skeletons.push(R)})),this.animationGroups.forEach((q=>{if(E.predicate&&!E.predicate(q))return;const R=q.clone(N?N(q.name):"Clone of "+q.name,(N=>B[z[N.uniqueId]]||N));S.animationGroups.push(R)})),S}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||v.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Xd.environmentTexture=this.environmentTexture);for(const N of this.Xd._serializableComponents)N.addFromContainer(this);this.Xd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=[];this.cameras.forEach((R=>{N&&!N(R)||(this.Xd.addCamera(R),q.push(R))})),this.lights.forEach((R=>{N&&!N(R)||(this.Xd.addLight(R),q.push(R))})),this.meshes.forEach((R=>{N&&!N(R)||(this.Xd.li(R),q.push(R))})),this.skeletons.forEach((q=>{N&&!N(q)||this.Xd.addSkeleton(q)})),this.animations.forEach((q=>{N&&!N(q)||this.Xd.addAnimation(q)})),this.animationGroups.forEach((q=>{N&&!N(q)||this.Xd.addAnimationGroup(q)})),this.multiMaterials.forEach((q=>{N&&!N(q)||this.Xd.addMultiMaterial(q)})),this.materials.forEach((q=>{N&&!N(q)||this.Xd.addMaterial(q)})),this.morphTargetManagers.forEach((q=>{N&&!N(q)||this.Xd.addMorphTargetManager(q)})),this.geometries.forEach((q=>{N&&!N(q)||this.Xd.addGeometry(q)})),this.transformNodes.forEach((R=>{N&&!N(R)||(this.Xd.addTransformNode(R),q.push(R))})),this.actionManagers.forEach((q=>{N&&!N(q)||this.Xd.addActionManager(q)})),this.textures.forEach((q=>{N&&!N(q)||this.Xd.addTexture(q)})),this.reflectionProbes.forEach((q=>{N&&!N(q)||this.Xd.addReflectionProbe(q)}));for(const R of q)R.parent&&-1===this.Xd.getNodes().indexOf(R.parent)&&(R.setParent?R.setParent(null):R.parent=null)}removeAllFromScene(){this._isValidHierarchy()||v.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Xd.environmentTexture&&(this.Xd.environmentTexture=null);for(const N of this.Xd._serializableComponents)N.removeFromContainer(this)}removeFromScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((q=>{N&&!N(q)||this.Xd.removeCamera(q)})),this.lights.forEach((q=>{N&&!N(q)||this.Xd.removeLight(q)})),this.meshes.forEach((q=>{N&&!N(q)||this.Xd.Ud(q,!0)})),this.skeletons.forEach((q=>{N&&!N(q)||this.Xd.removeSkeleton(q)})),this.animations.forEach((q=>{N&&!N(q)||this.Xd.removeAnimation(q)})),this.animationGroups.forEach((q=>{N&&!N(q)||this.Xd.removeAnimationGroup(q)})),this.multiMaterials.forEach((q=>{N&&!N(q)||this.Xd.removeMultiMaterial(q)})),this.materials.forEach((q=>{N&&!N(q)||this.Xd.removeMaterial(q)})),this.morphTargetManagers.forEach((q=>{N&&!N(q)||this.Xd.removeMorphTargetManager(q)})),this.geometries.forEach((q=>{N&&!N(q)||this.Xd.removeGeometry(q)})),this.transformNodes.forEach((q=>{N&&!N(q)||this.Xd.removeTransformNode(q)})),this.actionManagers.forEach((q=>{N&&!N(q)||this.Xd.removeActionManager(q)})),this.textures.forEach((q=>{N&&!N(q)||this.Xd.removeTexture(q)})),this.reflectionProbes.forEach((q=>{N&&!N(q)||this.Xd.removeReflectionProbe(q)}))}dispose(){this.cameras.slice(0).forEach((N=>{N.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((N=>{N.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((N=>{N.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((N=>{N.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((N=>{N.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((N=>{N.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((N=>{N.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((N=>{N.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((N=>{N.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((N=>{N.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((N=>{N.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((N=>{N.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((N=>{N.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.Xd._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Xd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(N,q,R){if(N&&q)for(const z of N){let N=!0;if(R)for(const q of R)if(z===q){N=!1;break}N&&(q.push(z),z._parentContainer=this)}}moveAllFromScene(N){this._wasAddedToScene=!1,void 0===N&&(N=new f);for(const q in this)Object.prototype.hasOwnProperty.call(this,q)&&(this[q]=this[q]||("_environmentTexture"===q?null:[]),this._moveAssets(this.Xd[q],this[q],N[q]));this.environmentTexture=this.Xd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const N=new F.b("assetContainerRootMesh",this.Xd);return this.meshes.forEach((q=>{q.parent||N.addChild(q)})),this.meshes.unshift(N),N}mergeAnimationsTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.b.LastCreatedScene,q=arguments.length>1?arguments[1]:void 0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!N)return y.c.Error("No scene available to merge animations to"),[];const z=R||(q=>{let R=null;const z=q.animations.length?q.animations[0].targetProperty:"",v=q.name.split(".").join("").split("_primitive")[0];switch(z){case"position":case"rotationQuaternion":R=N.getTransformNodeByName(q.name)||N.getTransformNodeByName(v);break;case"influence":R=N.getMorphTargetByName(q.name)||N.getMorphTargetByName(v);break;default:R=N.getNodeByName(q.name)||N.getNodeByName(v)}return R});this.getNodes().forEach((N=>{const q=z(N);if(null!==q){for(const R of N.animations){const N=q.animations.filter((N=>N.targetProperty===R.targetProperty));for(const R of N){const N=q.animations.indexOf(R,0);N>-1&&q.animations.splice(N,1)}}q.animations=q.animations.concat(N.animations)}}));const v=[];return this.animationGroups.slice().forEach((N=>{v.push(N.clone(N.name,z)),N.animatables.forEach((N=>{N.stop()}))})),q.forEach((q=>{const R=z(q.target);R&&(N.beginAnimation(R,q.fromFrame,q.toFrame,q.loopAnimation,q.speedRatio,q.onAnimationEnd?q.onAnimationEnd:void 0,void 0,!0,void 0,q.onAnimationLoop?q.onAnimationLoop:void 0),N.stopAnimation(q.target))})),v}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)})),this.transformNodes.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)})),this.lights.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)})),this.cameras.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)}))}addAllAssetsToContainer(N){if(!N)return;const q=[],R=new Set;for(q.push(N);q.length>0;){const N=q.pop();if(N instanceof F.b?(N.Dj&&-1===this.geometries.indexOf(N.Dj)&&this.geometries.push(N.Dj),this.meshes.push(N)):N instanceof S.e?this.transformNodes.push(N):N instanceof x.e?this.lights.push(N):N instanceof e.e&&this.cameras.push(N),N instanceof A.e){if(N.material&&-1===this.materials.indexOf(N.material)){this.materials.push(N.material);for(const q of N.material.getActiveTextures())-1===this.textures.indexOf(q)&&this.textures.push(q)}N.skeleton&&-1===this.skeletons.indexOf(N.skeleton)&&this.skeletons.push(N.skeleton),N.morphTargetManager&&-1===this.morphTargetManagers.indexOf(N.morphTargetManager)&&this.morphTargetManagers.push(N.morphTargetManager)}for(const z of N.getChildren())R.has(z)||q.push(z);R.add(N)}this.populateRootNodes()}}var H=R(10945);class Y{constructor(N){this.byteOffset=0,this.buffer=N}loadAsync(N){return this.buffer.readAsync(this.byteOffset,N).then((N=>{this._dataView=new DataView(N.buffer,N.byteOffset,N.byteLength),this._dataByteOffset=0}))}readUint32(){const N=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,N}readUint8Array(N){const q=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,N);return this._dataByteOffset+=N,this.byteOffset+=N,q}readString(N){return(0,H.m)(this.readUint8Array(N))}skipBytes(N){this._dataByteOffset+=N,this.byteOffset+=N}}var T=R(12135);const L="Z2xURg",X={name:"Oi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:N=>-1!==N.indexOf("asset")&&-1!==N.indexOf("version")||N.startsWith("data:base64,"+L)||N.startsWith("data:;base64,"+L)||N.startsWith("data:application/octet-stream;base64,"+L)||N.startsWith("data:model/gltf-binary;base64,"+L)};var Q,h,u,w=R(10938),c=R(10942);function n(N,q,R){try{return Promise.resolve(new Uint8Array(N,q,R))}catch(z){return Promise.reject(z)}}!function(N){N[N.AUTO=0]="AUTO",N[N.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Q||(Q={})),function(N){N[N.NONE=0]="NONE",N[N.FIRST=1]="FIRST",N[N.ALL=2]="ALL"}(h||(h={})),function(N){N[N.LOADING=0]="LOADING",N[N.READY=1]="READY",N[N.COMPLETE=2]="COMPLETE"}(u||(u={}));class G{constructor(){this.coordinateSystemMode=Q.AUTO,this.animationStartMode=h.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=N=>Promise.resolve(N),this.extensionOptions={}}p(N){N&&(this.onParsed=N.onParsed,this.coordinateSystemMode=N.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=N.animationStartMode??this.animationStartMode,this.loadNodeAnimations=N.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=N.loadSkins??this.loadSkins,this.loadMorphTargets=N.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=N.compileMaterials??this.compileMaterials,this.useClipPlane=N.useClipPlane??this.useClipPlane,this.compileShadowGenerators=N.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=N.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=N.useRangeRequests??this.useRangeRequests,this.createInstances=N.createInstances??this.createInstances,this.alwaysComputeBoundingBox=N.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=N.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=N.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=N.skipMaterials??this.skipMaterials,this.useSRGBBuffers=N.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=N.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=N.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=N.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=N.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=N.customRootNode,this.onMeshLoaded=N.onMeshLoaded,this.onSkinLoaded=N.onSkinLoaded,this.onTextureLoaded=N.onTextureLoaded,this.onMaterialLoaded=N.onMaterialLoaded,this.onCameraLoaded=N.onCameraLoaded,this.extensionOptions=N.extensionOptions??this.extensionOptions)}}class s extends G{constructor(N){super(),this.onParsedObservable=new z.d,this.onMeshLoadedObservable=new z.d,this.onSkinLoadedObservable=new z.d,this.onTextureLoadedObservable=new z.d,this.onMaterialLoadedObservable=new z.d,this.onCameraLoadedObservable=new z.d,this.onCompleteObservable=new z.d,this.onErrorObservable=new z.d,this.jj=new z.d,this.onExtensionLoadedObservable=new z.d,this.validate=!1,this.onValidatedObservable=new z.d,this._loader=null,this._state=null,this._requests=new Array,this.name=X.name,this.extensions=X.extensions,this.onLoaderStateChangedObservable=new z.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(N)}set onParsed(N){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),N&&(this._onParsedObserver=this.onParsedObservable.add(N))}set onMeshLoaded(N){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),N&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(N))}set onSkinLoaded(N){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),N&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((q=>N(q.node,q.skinnedNode))))}set onTextureLoaded(N){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),N&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(N))}set onMaterialLoaded(N){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),N&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(N))}set onCameraLoaded(N){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),N&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(N))}set onComplete(N){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(N)}set onError(N){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(N)}set onDispose(N){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(N)}set onExtensionLoaded(N){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(N)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(N){this._loggingEnabled!==N&&(this._loggingEnabled=N,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(N){this._capturePerformanceCounters!==N&&(this._capturePerformanceCounters=N,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(N){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(N)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const N of this._requests)N.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=N=>Promise.resolve(N),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.jj.notifyObservers(void 0),this.jj.clear()}loadFile(N,q,R,B,F,S,A,E){if(ArrayBuffer.isView(q))return this._loadBinary(N,q,R,B,A,E),null;this._progressCallback=F;const t=q.name||v.f.GetFilename(q);if(S){if(this.useRangeRequests){this.validate&&y.c.Warn("glTF validation is not supported when range requests are enabled");const R={abort:()=>{},onCompleteObservable:new z.d},v={readAsync:(R,z)=>new Promise(((v,B)=>{this._loadFile(N,q,(N=>{v(new Uint8Array(N))}),!0,(N=>{B(N)}),(N=>{N.setRequestHeader("Range",`bytes=${R}-${R+z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Y(v)).then((N=>{R.onCompleteObservable.notifyObservers(R),B(N)}),A?N=>A(void 0,N):void 0),R}return this._loadFile(N,q,(q=>{this._validate(N,new Uint8Array(q,0,q.byteLength),R,t),this._unpackBinaryAsync(new Y({readAsync:(N,R)=>n(q,N,R),byteLength:q.byteLength})).then((N=>{B(N)}),A?N=>A(void 0,N):void 0)}),!0,A)}return this._loadFile(N,q,(q=>{try{this._validate(N,q,R,t),B({json:this._parseJson(q)})}catch{A&&A()}}),!1,A)}_loadBinary(N,q,R,z,v,B){this._validate(N,new Uint8Array(q.buffer,q.byteOffset,q.byteLength),R,B),this._unpackBinaryAsync(new Y({readAsync:(N,R)=>function(N,q,R){try{if(q<0||q>=N.byteLength)throw new RangeError("Offset is out of range.");if(q+R>N.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(N.buffer,N.byteOffset+q,R))}catch(z){return Promise.reject(z)}}(q,N,R),byteLength:q.byteLength})).then((N=>{z(N)}),v?N=>v(void 0,N):void 0)}importMeshAsync(N,q,R,z,v,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(R),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(R),this._loader.importMeshAsync(N,q,null,R,z,v,B))))}loadAsync(N,q,R,z,v){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${v||""}`),this._loader=this._getLoader(q),this._loader.loadAsync(N,q,R,z,v))))}loadAssetContainerAsync(N,q,R,z,v){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${v||""}`),this._loader=this._getLoader(q);const B=new V(N),F=[];this.onMaterialLoadedObservable.add((N=>{F.push(N)}));const S=[];this.onTextureLoadedObservable.add((N=>{S.push(N)}));const A=[];this.onCameraLoadedObservable.add((N=>{A.push(N)}));const y=[];return this.onMeshLoadedObservable.add((N=>{N.morphTargetManager&&y.push(N.morphTargetManager)})),this._loader.importMeshAsync(null,N,B,q,R,z,v).then((N=>(Array.prototype.push.apply(B.geometries,N.geometries),Array.prototype.push.apply(B.meshes,N.meshes),Array.prototype.push.apply(B.qj,N.qj),Array.prototype.push.apply(B.skeletons,N.skeletons),Array.prototype.push.apply(B.animationGroups,N.animationGroups),Array.prototype.push.apply(B.materials,F),Array.prototype.push.apply(B.textures,S),Array.prototype.push.apply(B.lights,N.lights),Array.prototype.push.apply(B.transformNodes,N.transformNodes),Array.prototype.push.apply(B.cameras,A),Array.prototype.push.apply(B.morphTargetManagers,y),B)))}))}canDirectLoad(N){return X.canDirectLoad(N)}directLoad(N,q){if(q.startsWith("base64,"+L)||q.startsWith(";base64,"+L)||q.startsWith("application/octet-stream;base64,"+L)||q.startsWith("model/gltf-binary;base64,"+L)){const R=(0,w.e)(q);return this._validate(N,new Uint8Array(R,0,R.byteLength)),this._unpackBinaryAsync(new Y({readAsync:(N,q)=>n(R,N,q),byteLength:R.byteLength}))}return this._validate(N,q),Promise.resolve({json:this._parseJson(q)})}createPlugin(N){return new s(N[X.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((N,q)=>{this.onCompleteObservable.addOnce((()=>{N()})),this.onErrorObservable.addOnce((N=>{q(N)}))}))}_setState(N){this._state!==N&&(this._state=N,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(u[this._state]))}_loadFile(N,q,R,z,v,B){const F=N._loadFile(q,R,(N=>{this._onProgress(N,F)}),!0,z,v,B);return F.onCompleteObservable.add((()=>{F._lengthComputable=!0,F._total=F._loaded})),this._requests.push(F),F}_onProgress(N,q){if(!this._progressCallback)return;q._lengthComputable=N.lengthComputable,q._loaded=N.loaded,q._total=N.total;let R=!0,z=0,v=0;for(const B of this._requests){if(void 0===B._lengthComputable||void 0===B._loaded||void 0===B._total)return;R=R&&B._lengthComputable,z+=B._loaded,v+=B._total}this._progressCallback({lengthComputable:R,loaded:z,total:R?v:0})}_validate(N,q){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),T.c.ValidateAsync(q,R,z,(q=>this.preprocessUrlAsync(R+q).then((q=>N._loadFileAsync(q,void 0,!0,!0).then((N=>new Uint8Array(N,0,N.byteLength))))))).then((N=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(N),this.onValidatedObservable.clear()}),(N=>{this._endPerformanceCounter("Validate JSON"),v.f.Warn(`Failed to validate: ${N.message}`),this.onValidatedObservable.clear()})))}_getLoader(N){const q=N.json.asset||{};this._log(`Asset version: ${q.version}`),q.minVersion&&this._log(`Asset minimum version: ${q.minVersion}`),q.generator&&this._log(`Asset generator: ${q.generator}`);const R=s._parseVersion(q.version);if(!R)throw new Error("Invalid version: "+q.version);if(void 0!==q.minVersion){const N=s._parseVersion(q.minVersion);if(!N)throw new Error("Invalid minimum version: "+q.minVersion);if(s._compareVersion(N,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+q.minVersion)}const z={1:s._CreateGLTF1Loader,2:s._CreateGLTF2Loader}[R.major];if(!z)throw new Error("Unsupported version: "+q.version);return z(this)}_parseJson(N){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${N.length}`);const q=JSON.parse(N);return this._endPerformanceCounter("Parse JSON"),q}_unpackBinaryAsync(N){return this._startPerformanceCounter("Unpack Binary"),N.loadAsync(20).then((()=>{const q=N.readUint32();if(1179937895!==q)throw new c.i("Unexpected magic: "+q,c.e.GLTFLoaderUnexpectedMagicError);const R=N.readUint32();this.loggingEnabled&&this._log(`Binary version: ${R}`);const z=N.readUint32();let v;switch(this.useRangeRequests||z===N.buffer.byteLength||y.c.Warn(`Length in header does not match actual data length: ${z} != ${N.buffer.byteLength}`),R){case 1:v=this._unpackBinaryV1Async(N,z);break;case 2:v=this._unpackBinaryV2Async(N,z);break;default:throw new Error("Unsupported version: "+R)}return this._endPerformanceCounter("Unpack Binary"),v}))}_unpackBinaryV1Async(N,q){const R=N.readUint32(),z=N.readUint32();if(0!==z)throw new Error(`Unexpected content format: ${z}`);const v=q-N.byteOffset,B={json:this._parseJson(N.readString(R)),bin:null};if(0!==v){const q=N.byteOffset;B.bin={readAsync:(R,z)=>N.buffer.readAsync(q+R,z),byteLength:v}}return Promise.resolve(B)}_unpackBinaryV2Async(N,q){const R=1313821514,z=5130562,v=N.readUint32();if(N.readUint32()!==R)throw new Error("First chunk format is not JSON");return N.byteOffset+v===q?N.loadAsync(v).then((()=>({json:this._parseJson(N.readString(v)),bin:null}))):N.loadAsync(v+8).then((()=>{const B={json:this._parseJson(N.readString(v)),bin:null},F=()=>{const v=N.readUint32();switch(N.readUint32()){case R:throw new Error("Unexpected JSON chunk");case z:{const q=N.byteOffset;B.bin={readAsync:(R,z)=>N.buffer.readAsync(q+R,z),byteLength:v},N.skipBytes(v);break}default:N.skipBytes(v)}return N.byteOffset!==q?N.loadAsync(8).then(F):Promise.resolve(B)};return F()}))}static _parseVersion(N){if("1.0"===N||"1.0.1"===N)return{major:1,minor:0};const q=(N+"").match(/^(\d+)\.(\d+)/);return q?{major:parseInt(q[1]),minor:parseInt(q[2])}:null}static _compareVersion(N,q){return N.major>q.major?1:N.major<q.major?-1:N.minor>q.minor?1:N.minor<q.minor?-1:0}_logOpen(N){this._log(N),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(N){const q=s._logSpaces.substring(0,2*this._logIndentLevel);y.c.Log(`${q}${N}`)}_logDisabled(N){}_startPerformanceCounterEnabled(N){v.f.StartPerformanceCounter(N)}_startPerformanceCounterDisabled(N){}_endPerformanceCounterEnabled(N){v.f.EndPerformanceCounter(N)}_endPerformanceCounterDisabled(N){}}s.IncrementalLoading=!0,s.HomogeneousCoordinates=!1,s._logSpaces="                                ",(0,B.f)(new s)},12135:(N,q,R)=>{"use strict";R.d(q,{c:()=>F});var z=R(10888);function v(N,q,R,z){const v={externalResourceFunction:z};return R&&(v.uri="file:"===q?R:q+R),ArrayBuffer.isView(N)?GLTFValidator.validateBytes(N,v):GLTFValidator.validateString(N,v)}function B(){const N=[];onmessage=q=>{const R=q.data;switch(R.id){case"init":importScripts(R.url);break;case"validate":v(R.data,R.rootUrl,R.fileName,(q=>new Promise(((R,z)=>{const v=N.length;N.push({resolve:R,reject:z}),postMessage({id:"getExternalResource",index:v,uri:q})})))).then((N=>{postMessage({id:"validate.resolve",value:N})}),(N=>{postMessage({id:"validate.reject",reason:N})}));break;case"getExternalResource.resolve":N[R.index].resolve(R.value);break;case"getExternalResource.reject":N[R.index].reject(R.reason)}}}class F{static ValidateAsync(N,q,R,F){return"function"===typeof Worker?new Promise(((S,A)=>{const y=`${v}(${B})()`,E=URL.createObjectURL(new Blob([y],{type:"application/javascript"})),t=new Worker(E),x=N=>{t.removeEventListener("error",x),t.removeEventListener("message",e),A(N)},e=N=>{const q=N.data;switch(q.id){case"getExternalResource":F(q.uri).then((N=>{t.postMessage({id:"getExternalResource.resolve",index:q.index,value:N},[N.buffer])}),(N=>{t.postMessage({id:"getExternalResource.reject",index:q.index,reason:N})}));break;case"validate.resolve":t.removeEventListener("error",x),t.removeEventListener("message",e),S(q.value),t.terminate();break;case"validate.reject":t.removeEventListener("error",x),t.removeEventListener("message",e),A(q.reason),t.terminate()}};if(t.addEventListener("error",x),t.addEventListener("message",e),t.postMessage({id:"init",url:z.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(N)){const z=N.slice();t.postMessage({id:"validate",data:z,rootUrl:q,fileName:R},[z.buffer])}else t.postMessage({id:"validate",data:N,rootUrl:q,fileName:R})})):(this._LoadScriptPromise||(this._LoadScriptPromise=z.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>v(N,q,R,F))))}}F.Configuration={url:`${z.f._DefaultCdnUrl}/gltf_validator.js`}},12569:(N,q,R)=>{"use strict";R.d(q,{b:()=>Q});var z=R(11147),v=R(11151),B=R(11221),F=R(11181),S=R(11391),A=R(11393),y=R(11251),E=R(11172),t=R(11002),x=R(10966);R(11840),R(11750),R(11765),R(11754),R(11770),R(11777),R(11779);const e="imageProcessingCompatibility",b="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";x.e.IncludesShadersStore[e]=b;const f="skyPixelShader",D="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";x.e.ShadersStore[f]=D;R(11853),R(11788),R(11792),R(11804),R(11796);const V="skyVertexShader",H="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";x.e.ShadersStore[V]=H;var Y=R(11421),T=R(11386),L=R(11379);class X extends S.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Q extends A.b{constructor(N,q){super(N,q),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new F.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=F.m.Zero(),this.up=F.m.Up(),this.dithering=!1,this._cameraPosition=F.m.Zero(),this._skyOrientation=new F.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(N,q){const R=q._drawWrapper;if(this.isFrozen&&R.effect&&R._wasPreviouslyReady)return!0;q.materialDefines||(q.materialDefines=new X);const z=q.materialDefines,v=this.va();if(this._isReadyForSubMesh(q))return!0;if((0,L.K)(N,v,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,z),(0,L.D)(N,z,!0,!1),z.IMAGEPROCESSINGPOSTPROCESS!==v.imageProcessingConfiguration.applyByPostProcess&&z.markAsMiscDirty(),z.DITHER!==this.dithering&&z.markAsMiscDirty(),z.isDirty){z.markAsProcessed(),v.resetCachedMaterial();const N=new Y.e;z.FOG&&N.addFallback(1,"FOG"),z.IMAGEPROCESSINGPOSTPROCESS=v.imageProcessingConfiguration.applyByPostProcess,z.DITHER=this.dithering;const R=[y.h.PositionKind];z.VERTEXCOLOR&&R.push(y.h.ColorKind);const B="sky",F=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,T.c)(F);const S=z.toString();q.setEffect(v.getEngine().createEffect(B,R,F,[],S,N,this.onCompiled,this.onError),z,this._materialContext)}return!(!q.effect||!q.effect.isReady())&&(z._renderId=v.getRenderId(),R._wasPreviouslyReady=!0,!0)}bindForSubMesh(N,q,R){const z=this.va(),v=R.materialDefines;if(!v)return;const B=R.effect;if(!B)return;this._activeEffect=B,this.bindOnlyWorldMatrix(N),this._activeEffect.setMatrix("viewProjection",z.getTransformMatrix()),this._mustRebind(z,B,R)&&((0,T.e)(B,this,z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,L.i)(v,B,z)),z.fogEnabled&&q.applyFog&&z.fogMode!==E.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",z.getViewMatrix()),(0,L.c)(z,q,this._activeEffect);const S=z.activeCamera;if(S){const N=S.getWorldMatrix();this._cameraPosition.x=N.m[12],this._cameraPosition.y=N.m[13],this._cameraPosition.z=N.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const N=Math.PI*(this.inclination-.5),q=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(q)*Math.cos(N),this.sunPosition.y=this.distance*Math.sin(-N),this.sunPosition.z=this.distance*Math.sin(q)*Math.cos(N),F.g.FromUnitVectorsToRef(F.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(q,this._activeEffect,R)}getAnimatables(){return[]}dispose(N){super.dispose(N)}clone(N){return B.e.Clone((()=>new Q(N,this.va())),this)}serialize(){const N=super.serialize();return N.customType="BABYLON.SkyMaterial",N}getClassName(){return"SkyMaterial"}static Parse(N,q,R){return B.e.Parse((()=>new Q(N.name,q)),N,q,R)}}(0,z.c)([(0,v.D)()],Q.prototype,"luminance",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"turbidity",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"rayleigh",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"mieCoefficient",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"mieDirectionalG",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"distance",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"inclination",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"azimuth",void 0),(0,z.c)([(0,v.C)()],Q.prototype,"sunPosition",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"useSunPosition",void 0),(0,z.c)([(0,v.C)()],Q.prototype,"cameraOffset",void 0),(0,z.c)([(0,v.C)()],Q.prototype,"up",void 0),(0,z.c)([(0,v.D)()],Q.prototype,"dithering",void 0),(0,t.f)("BABYLON.SkyMaterial",Q)},10732:(N,q,R)=>{"use strict";function z(N,q){q.headers=N.headers||{},q.statusMessage=N.statusText,q.statusCode=N.status,q.data=N.response}function v(N,q,R){return new Promise((function(v,B){R=R||{};var F,S,A,y=new XMLHttpRequest,E=R.body,t=R.headers||{};for(F in R.timeout&&(y.timeout=R.timeout),y.ontimeout=y.onerror=function(N){N.timeout="timeout"==N.type,B(N)},y.open(N,q.href||q),y.onload=function(){for(A=y.getAllResponseHeaders().trim().split(/[\r\n]+/),z(y,y);S=A.shift();)S=S.split(": "),y.headers[S.shift().toLowerCase()]=S.join(": ");if((S=y.headers["content-type"])&&~S.indexOf("application/json"))try{y.data=JSON.parse(y.data,R.reviver)}catch(N){return z(y,N),B(N)}(y.status>=400?B:v)(y)},typeof FormData<"u"&&E instanceof FormData||E&&"object"==typeof E&&(t["content-type"]="application/json",E=JSON.stringify(E)),y.withCredentials=!!R.withCredentials,t)y.setRequestHeader(F,t[F]);y.send(E)}))}R.r(q),R.d(q,{del:()=>A,get:()=>B,patch:()=>S,post:()=>F,put:()=>y,send:()=>v});var B=v.bind(v,"GET"),F=v.bind(v,"POST"),S=v.bind(v,"PATCH"),A=v.bind(v,"DELETE"),y=v.bind(v,"PUT")},12672:(N,q,R)=>{"use strict";R.d(q,{d:()=>t});const z=.5*(Math.sqrt(3)-1),v=(3-Math.sqrt(3))/6,B=1/3,F=1/6,S=(Math.sqrt(5)-1)/4,A=(5-Math.sqrt(5))/20,y=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),E=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const t=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const q="function"==typeof N?N:function(N){let q=0,R=0,z=0,v=1;const B=function(){let N=4022871197;return function(q){q=q.toString();for(let R=0;R<q.length;R++){N+=q.charCodeAt(R);let z=.02519603282416938*N;N=z>>>0,z-=N,z*=N,N=z>>>0,z-=N,N+=4294967296*z}return 2.3283064365386963e-10*(N>>>0)}}();q=B(" "),R=B(" "),z=B(" "),q-=B(N),q<0&&(q+=1);R-=B(N),R<0&&(R+=1);z-=B(N),z<0&&(z+=1);return function(){const N=2091639*q+2.3283064365386963e-10*v;return q=R,R=z,z=N-(v=0|N)}}(N);this.p=function(N){const q=new Uint8Array(256);for(let R=0;R<256;R++)q[R]=R;for(let R=0;R<255;R++){const z=R+~~(N()*(256-R)),v=q[R];q[R]=q[z],q[z]=v}return q}(q),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let R=0;R<512;R++)this.perm[R]=this.p[255&R],this.permMod12[R]=this.perm[R]%12}noise2D(N,q){const R=this.permMod12,B=this.perm;let F=0,S=0,A=0;const E=(N+q)*z,t=Math.floor(N+E),x=Math.floor(q+E),e=(t+x)*v,b=N-(t-e),f=q-(x-e);let D,V;b>f?(D=1,V=0):(D=0,V=1);const H=b-D+v,Y=f-V+v,T=b-1+2*v,L=f-1+2*v,X=255&t,Q=255&x;let h=.5-b*b-f*f;if(h>=0){const N=3*R[X+B[Q]];h*=h,F=h*h*(y[N]*b+y[N+1]*f)}let u=.5-H*H-Y*Y;if(u>=0){const N=3*R[X+D+B[Q+V]];u*=u,S=u*u*(y[N]*H+y[N+1]*Y)}let w=.5-T*T-L*L;if(w>=0){const N=3*R[X+1+B[Q+1]];w*=w,A=w*w*(y[N]*T+y[N+1]*L)}return 70*(F+S+A)}noise3D(N,q,R){const z=this.permMod12,v=this.perm;let S,A,E,t;const x=(N+q+R)*B,e=Math.floor(N+x),b=Math.floor(q+x),f=Math.floor(R+x),D=(e+b+f)*F,V=N-(e-D),H=q-(b-D),Y=R-(f-D);let T,L,X,Q,h,u;V>=H?H>=Y?(T=1,L=0,X=0,Q=1,h=1,u=0):V>=Y?(T=1,L=0,X=0,Q=1,h=0,u=1):(T=0,L=0,X=1,Q=1,h=0,u=1):H<Y?(T=0,L=0,X=1,Q=0,h=1,u=1):V<Y?(T=0,L=1,X=0,Q=0,h=1,u=1):(T=0,L=1,X=0,Q=1,h=1,u=0);const w=V-T+F,c=H-L+F,n=Y-X+F,G=V-Q+2*F,s=H-h+2*F,Z=Y-u+2*F,J=V-1+.5,M=H-1+.5,m=Y-1+.5,g=255&e,j=255&b,l=255&f;let I=.6-V*V-H*H-Y*Y;if(I<0)S=0;else{const N=3*z[g+v[j+v[l]]];I*=I,S=I*I*(y[N]*V+y[N+1]*H+y[N+2]*Y)}let U=.6-w*w-c*c-n*n;if(U<0)A=0;else{const N=3*z[g+T+v[j+L+v[l+X]]];U*=U,A=U*U*(y[N]*w+y[N+1]*c+y[N+2]*n)}let O=.6-G*G-s*s-Z*Z;if(O<0)E=0;else{const N=3*z[g+Q+v[j+h+v[l+u]]];O*=O,E=O*O*(y[N]*G+y[N+1]*s+y[N+2]*Z)}let i=.6-J*J-M*M-m*m;if(i<0)t=0;else{const N=3*z[g+1+v[j+1+v[l+1]]];i*=i,t=i*i*(y[N]*J+y[N+1]*M+y[N+2]*m)}return 32*(S+A+E+t)}noise4D(N,q,R,z){const v=this.perm;let B,F,y,t,x;const e=(N+q+R+z)*S,b=Math.floor(N+e),f=Math.floor(q+e),D=Math.floor(R+e),V=Math.floor(z+e),H=(b+f+D+V)*A,Y=N-(b-H),T=q-(f-H),L=R-(D-H),X=z-(V-H);let Q=0,h=0,u=0,w=0;Y>T?Q++:h++,Y>L?Q++:u++,Y>X?Q++:w++,T>L?h++:u++,T>X?h++:w++,L>X?u++:w++;const c=Q>=3?1:0,n=h>=3?1:0,G=u>=3?1:0,s=w>=3?1:0,Z=Q>=2?1:0,J=h>=2?1:0,M=u>=2?1:0,m=w>=2?1:0,g=Q>=1?1:0,j=h>=1?1:0,l=u>=1?1:0,I=w>=1?1:0,U=Y-c+A,O=T-n+A,i=L-G+A,P=X-s+A,k=Y-Z+2*A,o=T-J+2*A,C=L-M+2*A,K=X-m+2*A,r=Y-g+3*A,a=T-j+3*A,d=L-l+3*A,p=X-I+3*A,W=Y-1+4*A,NN=T-1+4*A,qN=L-1+4*A,RN=X-1+4*A,zN=255&b,vN=255&f,BN=255&D,FN=255&V;let SN=.6-Y*Y-T*T-L*L-X*X;if(SN<0)B=0;else{const N=v[zN+v[vN+v[BN+v[FN]]]]%32*4;SN*=SN,B=SN*SN*(E[N]*Y+E[N+1]*T+E[N+2]*L+E[N+3]*X)}let AN=.6-U*U-O*O-i*i-P*P;if(AN<0)F=0;else{const N=v[zN+c+v[vN+n+v[BN+G+v[FN+s]]]]%32*4;AN*=AN,F=AN*AN*(E[N]*U+E[N+1]*O+E[N+2]*i+E[N+3]*P)}let yN=.6-k*k-o*o-C*C-K*K;if(yN<0)y=0;else{const N=v[zN+Z+v[vN+J+v[BN+M+v[FN+m]]]]%32*4;yN*=yN,y=yN*yN*(E[N]*k+E[N+1]*o+E[N+2]*C+E[N+3]*K)}let EN=.6-r*r-a*a-d*d-p*p;if(EN<0)t=0;else{const N=v[zN+g+v[vN+j+v[BN+l+v[FN+I]]]]%32*4;EN*=EN,t=EN*EN*(E[N]*r+E[N+1]*a+E[N+2]*d+E[N+3]*p)}let tN=.6-W*W-NN*NN-qN*qN-RN*RN;if(tN<0)x=0;else{const N=v[zN+1+v[vN+1+v[BN+1+v[FN+1]]]]%32*4;tN*=tN,x=tN*tN*(E[N]*W+E[N+1]*NN+E[N+2]*qN+E[N+3]*RN)}return 27*(B+F+y+t+x)}}}}]);