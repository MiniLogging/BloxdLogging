"use strict";(self.ksd6jhs1yr=self.ksd6jhs1yr||[]).push([[9],{12272:(C,c,d)=>{d.d(c,{e:()=>r,f:()=>E,i:()=>N,h:()=>T,k:()=>z});class b{constructor(){this.children=[]}isValid(C){return!0}process(C,c,d){let b="";if(this.line){let d=this.line;const g=c.processor;if(g){var X,P,V,R,p,j;g.lineProcessor&&(d=g.lineProcessor(d,c.isFragment,c.processingContext));const b=(null===(X=c.processor)||void 0===X?void 0:X.attributeKeywordName)??"attribute",k=c.isFragment&&null!==(P=c.processor)&&void 0!==P&&P.varyingFragmentKeywordName?null===(V=c.processor)||void 0===V?void 0:V.varyingFragmentKeywordName:!c.isFragment&&null!==(R=c.processor)&&void 0!==R&&R.varyingVertexKeywordName?null===(p=c.processor)||void 0===p?void 0:p.varyingVertexKeywordName:"varying";if(!c.isFragment&&g.attributeProcessor&&this.line.startsWith(b))d=g.attributeProcessor(this.line,C,c.processingContext);else if(g.varyingProcessor&&(null!==(j=g.varyingCheck)&&void 0!==j&&j.call(g,this.line,c.isFragment)||!g.varyingCheck&&this.line.startsWith(k)))d=g.varyingProcessor(this.line,c.isFragment,C,c.processingContext);else if(g.uniformProcessor&&g.uniformRegexp&&g.uniformRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(d=g.uniformProcessor(this.line,c.isFragment,C,c.processingContext));else if(g.uniformBufferProcessor&&g.uniformBufferRegexp&&g.uniformBufferRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(d=g.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0);else if(g.textureProcessor&&g.textureRegexp&&g.textureRegexp.test(this.line))d=g.textureProcessor(this.line,c.isFragment,C,c.processingContext);else if((g.uniformProcessor||g.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!c.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?g.uniformProcessor&&(d=g.uniformProcessor(this.line,c.isFragment,C,c.processingContext)):g.uniformBufferProcessor&&(d=g.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0)}c.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(c.lookForClosingBracketForUniformBuffer=!1,g.endOfUniformBufferProcessor&&(d=g.endOfUniformBufferProcessor(this.line,c.isFragment,c.processingContext)))}b+=d+"\n"}for(const g of this.children)b+=g.process(C,c,d);return this.additionalDefineKey&&(C[this.additionalDefineKey]=this.additionalDefineValue||"true",d[this.additionalDefineKey]=C[this.additionalDefineKey]),b}}class X{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(C){this._lines.length=0;for(const c of C){if(!c||"\r"===c)continue;if("#"===c[0]){this._lines.push(c);continue}const C=c.trim();if(!C)continue;if(C.startsWith("//")){this._lines.push(c);continue}const d=C.indexOf(";");if(-1===d)this._lines.push(C);else if(d===C.length-1)C.length>1&&this._lines.push(C);else{const C=c.split(";");for(let c=0;c<C.length;c++){let d=C[c];d&&(d=d.trim(),d&&this._lines.push(d+(c!==C.length-1?";":"")))}}}}}class P extends b{process(C,c,d){for(let b=0;b<this.children.length;b++){const X=this.children[b];if(X.isValid(C))return X.process(C,c,d)}return""}}class V extends b{isValid(C){return this.testExpression.isTrue(C)}}class R{isTrue(C){return!0}static postfixToInfix(C){const c=[];for(const d of C)if(void 0===R._OperatorPriority[d])c.push(d);else{const C=c[c.length-1],b=c[c.length-2];c.length-=2,c.push(`(${b}${d}${C})`)}return c[c.length-1]}static infixToPostfix(C){const c=R._InfixToPostfixCache.get(C);if(c)return c.accessTime=Date.now(),c.result;if(!C.includes("&&")&&!C.includes("||")&&!C.includes(")")&&!C.includes("("))return[C];const d=[];let b=-1;const X=()=>{g=g.trim(),""!==g&&(d.push(g),g="")},P=C=>{b<R._Stack.length-1&&(R._Stack[++b]=C)},V=()=>R._Stack[b],p=()=>-1===b?"!!INVALID EXPRESSION!!":R._Stack[b--];let j=0,g="";for(;j<C.length;){const c=C.charAt(j),k=j<C.length-1?C.substring(j,2+j):"";if("("===c)g="",P(c);else if(")"===c){for(X();-1!==b&&"("!==V();)d.push(p());p()}else if(R._OperatorPriority[k]>1){for(X();-1!==b&&R._OperatorPriority[V()]>=R._OperatorPriority[k];)d.push(p());P(k),j++}else g+=c;j++}for(X();-1!==b;)"("===V()?p():d.push(p());return R._InfixToPostfixCache.size>=R.InfixToPostfixCacheLimitSize&&R.ClearCache(),R._InfixToPostfixCache.set(C,{result:d,accessTime:Date.now()}),d}static ClearCache(){const C=Array.from(R._InfixToPostfixCache.entries()).sort(((C,c)=>C[1].accessTime-c[1].accessTime));for(let c=0;c<R.InfixToPostfixCacheCleanupSize;c++)R._InfixToPostfixCache.delete(C[c][0])}}R.InfixToPostfixCacheLimitSize=5e4,R.InfixToPostfixCacheCleanupSize=25e3,R._InfixToPostfixCache=new Map,R._OperatorPriority={")":0,"(":1,"||":2,"&&":3},R._Stack=["","","","","","","","","","","","","","","","","","","",""];class p extends R{constructor(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=C,this.not=c}isTrue(C){let c=void 0!==C[this.define];return this.not&&(c=!c),c}}class j extends R{isTrue(C){return this.leftOperand.isTrue(C)||this.rightOperand.isTrue(C)}}class g extends R{isTrue(C){return this.leftOperand.isTrue(C)&&this.rightOperand.isTrue(C)}}class k extends R{constructor(C,c,d){super(),this.define=C,this.operand=c,this.testValue=d}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(C){let c=!1;const d=parseInt(void 0!=C[this.define]?C[this.define]:this.define),b=parseInt(void 0!=C[this.testValue]?C[this.testValue]:this.testValue);if(isNaN(d)||isNaN(b))return!1;switch(this.operand){case">":c=d>b;break;case"<":c=d<b;break;case"<=":c=d<=b;break;case">=":c=d>=b;break;case"==":c=d===b;break;case"!=":c=d!==b}return c}}var Z=d(12243),U=d(12274);const A=/defined\s*?\((.+?)\)/g,u=/defined\s*?\[(.+?)\]/g,q=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,B=/__decl__/,t=/light\{X\}.(\w*)/g,e=/\{X\}/g,n=[],W=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function E(C){C.processor&&C.processor.initializeShaders&&C.processor.initializeShaders(C.processingContext)}function N(C,c,d,b){var X;null!==(X=c.processor)&&void 0!==X&&X.preProcessShaderCode&&(C=c.processor.preProcessShaderCode(C,c.isFragment)),T(C,c,(C=>{c.processCodeAfterIncludes&&(C=c.processCodeAfterIncludes(c.isFragment?"fragment":"vertex",C,c.defines));const X=function(C,c,d){let b=function(C,c){var d;if(null!==(d=c.processor)&&void 0!==d&&d.noPrecision)return C;const b=c.shouldUseHighPrecisionShader;-1===C.indexOf("precision highp float")?C=b?"precision highp float;\n"+C:"precision mediump float;\n"+C:b||(C=C.replace("precision highp float","precision mediump float"));return C}(C,c);if(!c.processor)return b;if(0===c.processor.shaderLanguage&&-1!==b.indexOf("#version 3")&&(b=b.replace("#version 300 es",""),!c.processor.parseGLES3))return b;const X=c.defines,P=f(c,d);c.processor.preProcessor&&(b=c.processor.preProcessor(b,X,P,c.isFragment,c.processingContext));const V={};b=L(b,P,c,V),c.processor.postProcessor&&(b=c.processor.postProcessor(b,X,c.isFragment,c.processingContext,d?{drawBuffersExtensionDisabled:!d.getCaps().drawBuffersExtension}:{},P,V));null!==d&&void 0!==d&&d._features.needShaderCodeInlining&&(b=d.inlineShaderCode(b));return b}(C,c,b);d(X,C)}))}function r(C,c,d){return d.processor&&d.processor.finalizeShaders?d.processor.finalizeShaders(C,c,d.processingContext):{vertexCode:C,fragmentCode:c}}function M(C){const c=/defined\((.+)\)/.exec(C);if(c&&c.length)return new p(c[1].trim(),"!"===C[0]);const d=["==","!=",">=","<=","<",">"];let b="",X=0;for(b of d)if(X=C.indexOf(b),X>-1)break;if(-1===X)return new p(C);const P=C.substring(0,X).trim(),V=C.substring(X+b.length).trim();return new k(P,b,V)}function K(C,c){const d=new V,b=C.substring(0,c);let X=C.substring(c);return X=X.substring(0,(X.indexOf("//")+1||X.length+1)-1).trim(),d.testExpression="#ifdef"===b?new p(X):"#ifndef"===b?new p(X,!0):function(C){C=C.replace(A,"defined[$1]");const c=R.infixToPostfix(C),d=[];for(const X of c)if("||"!==X&&"&&"!==X)d.push(X);else if(d.length>=2){let C=d[d.length-1],c=d[d.length-2];d.length-=2;const b="&&"==X?new g:new j;"string"===typeof C&&(C=C.replace(u,"defined($1)")),"string"===typeof c&&(c=c.replace(u,"defined($1)")),b.leftOperand="string"===typeof c?M(c):c,b.rightOperand="string"===typeof C?M(C):C,d.push(b)}let b=d[d.length-1];return"string"===typeof b&&(b=b.replace(u,"defined($1)")),"string"===typeof b?M(b):b}(X),d}function i(C,c,d,X){let P=C.currentLine;for(;h(C,d,X);){P=C.currentLine;const V=P.substring(0,5).toLowerCase();if("#else"===V){const d=new b;return c.children.push(d),void h(C,d,X)}if("#elif"===V){const C=K(P,5);c.children.push(C),d=C}}}function h(C,c,d){for(;C.canRead;){C.lineIndex++;const X=C.currentLine;if(X.indexOf("#")>=0){const b=W.exec(X);if(b&&b.length){switch(b[0]){case"#ifdef":{const b=new P;c.children.push(b);const V=K(X,6);b.children.push(V),i(C,b,V,d);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const b=new P;c.children.push(b);const V=K(X,7);b.children.push(V),i(C,b,V,d);break}case"#if":{const b=new P,V=K(X,3);c.children.push(b),b.children.push(V),i(C,b,V,d);break}}continue}}const V=new b;if(V.line=X,c.children.push(V),"#"===X[0]&&"d"===X[1]){const C=X.replace(";","").split(" ");V.additionalDefineKey=C[1],3===C.length&&(V.additionalDefineValue=C[2])}}return!1}function L(C,c,d,P){const V=new b,R=new X;return R.lineIndex=-1,R.lines=C.split("\n"),h(R,V,P),V.process(c,d,P)}function f(C,c){var d;const b=C.defines,X={};for(const P of b){const C=P.replace("#define","").replace(";","").trim().split(" ");X[C[0]]=C.length>1?C[1]:""}return 0===(null===(d=C.processor)||void 0===d?void 0:d.shaderLanguage)&&(X.GL_ES="true"),X.__VERSION__=C.version,X[C.platformName]="true",(0,U.k)(X,null===c||void 0===c?void 0:c.isNDCHalfZRange,null===c||void 0===c?void 0:c.o,null===c||void 0===c?void 0:c.useExactSrgbConversions),X}function T(C,c,d){let b;for(n.length=0;null!==(b=q.exec(C));)n.push(b);let X=String(C),P=[C],V=!1;for(const R of n){let C=R[1];if(-1!==C.indexOf("__decl__")&&(C=C.replace(B,""),c.supportsUniformBuffers&&(C=C.replace("Vertex","Ubo").replace("Fragment","Ubo")),C+="Declaration"),!c.includesShadersStore[C]){const b=c.shadersRepository+"ShadersInclude/"+C+".fx";return void z.loadFile(b,(b=>{c.includesShadersStore[C]=b,T(P.join(""),c,d)}))}{let d=c.includesShadersStore[C];if(R[2]){const C=R[3].split(",");for(let c=0;c<C.length;c+=2){const b=new RegExp(C[c],"g"),X=C[c+1];d=d.replace(b,X)}}if(R[4]){const C=R[5];if(-1!==C.indexOf("..")){const b=C.split(".."),X=parseInt(b[0]);let P=parseInt(b[1]),V=d.slice(0);d="",isNaN(P)&&(P=c.indexParameters[b[1]]);for(let C=X;C<P;C++)c.supportsUniformBuffers||(V=V.replace(t,((C,c)=>c+"{X}"))),d+=V.replace(e,C.toString())+"\n"}else c.supportsUniformBuffers||(d=d.replace(t,((C,c)=>c+"{X}"))),d=d.replace(e,C)}const b=[];for(const C of P){const c=C.split(R[0]);for(let C=0;C<c.length-1;C++)b.push(c[C]),b.push(d);b.push(c[c.length-1])}P=b,V=V||d.indexOf("#include<")>=0||d.indexOf("#include <")>=0}}n.length=0,X=P.join(""),V?T(X.toString(),c,d):d(X)}const z={loadFile:(C,c,d,b,X,P)=>{throw(0,Z.c)("FileTools")}}},12274:(C,c,d)=>{d.d(c,{e:()=>X,h:()=>P,k:()=>R,m:()=>V,n:()=>p});var b=d(12243);d(12227);const X={};function P(C,c){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(c?c+"\n":"")+C}function V(C,c,d,P,V,R,p){const j=p||X.loadFile;if(j){return j(C,c,d,P,V,R)}throw(0,b.c)("FileTools")}function R(C,c,d,b){if(C)return c?C.IS_NDC_HALF_ZRANGE="":delete C.IS_NDC_HALF_ZRANGE,d?C.USE_REVERSE_DEPTHBUFFER="":delete C.USE_REVERSE_DEPTHBUFFER,void(b?C.USE_EXACT_SRGB_CONVERSIONS="":delete C.USE_EXACT_SRGB_CONVERSIONS);{let C="";return c&&(C+="#define IS_NDC_HALF_ZRANGE"),d&&(C&&(C+="\n"),C+="#define USE_REVERSE_DEPTHBUFFER"),b&&(C&&(C+="\n"),C+="#define USE_EXACT_SRGB_CONVERSIONS"),C}}function p(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;switch(C){case 3:{const C=(ArrayBuffer,new Int8Array(c));return b&&C.set(new Int8Array(b)),C}case 0:{const C=(ArrayBuffer,new Uint8Array(c));return b&&C.set(new Uint8Array(b)),C}case 4:{const C=c instanceof ArrayBuffer?new Int16Array(c):new Int16Array(d?c/2:c);return b&&C.set(new Int16Array(b)),C}case 5:case 8:case 9:case 10:case 2:{const C=c instanceof ArrayBuffer?new Uint16Array(c):new Uint16Array(d?c/2:c);return b&&C.set(new Uint16Array(b)),C}case 6:{const C=c instanceof ArrayBuffer?new Int32Array(c):new Int32Array(d?c/4:c);return b&&C.set(new Int32Array(b)),C}case 7:case 11:case 12:case 13:case 14:case 15:{const C=c instanceof ArrayBuffer?new Uint32Array(c):new Uint32Array(d?c/4:c);return b&&C.set(new Uint32Array(b)),C}case 1:{const C=c instanceof ArrayBuffer?new Float32Array(c):new Float32Array(d?c/4:c);return b&&C.set(new Float32Array(b)),C}}const X=(ArrayBuffer,new Uint8Array(c));return b&&X.set(new Uint8Array(b)),X}},12292:(C,c,d)=>{d.d(c,{e:()=>b});class b{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?b.ShadersRepository:b.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?b.ShadersStore:b.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?b.IncludesShadersStore:b.IncludesShadersStoreWGSL}}b.ShadersRepository="src/Shaders/",b.ShadersStore={},b.IncludesShadersStore={},b.ShadersRepositoryWGSL="src/ShadersWGSL/",b.ShadersStoreWGSL={},b.IncludesShadersStoreWGSL={}},12302:(C,c,d)=>{d.d(c,{d:()=>Z,e:()=>e,i:()=>A,m:()=>U,n:()=>u,o:()=>t,s:()=>k,v:()=>j,z:()=>g,A:()=>p,D:()=>R});class b{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Gc._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(C){C&&this.program&&C(this.program)}setEngine(C){this.Gc=C}_fillEffectInformation(C,c,d,b,X,P,V,R){const p=this.Gc;if(p.supportsUniformBuffers)for(const g in c)C.bindUniformBlock(g,c[g]);let j;for(this.Gc.getUniforms(this,d).forEach(((C,c)=>{b[d[c]]=C})),this._uniforms=b,j=0;j<X.length;j++){null==C.getUniform(X[j])&&(X.splice(j,1),j--)}X.forEach(((C,c)=>{P[C]=c}));for(const g of p.getAttributes(this,V))R.push(g)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(C,c){const d=this._valueCache[C],b=c.updateFlag;return(void 0===d||d!==b)&&(this._valueCache[C]=b,!0)}_cacheFloat2(C,c,d){let b=this._valueCache[C];if(!b||2!==b.length)return b=[c,d],this._valueCache[C]=b,!0;let X=!1;return b[0]!==c&&(b[0]=c,X=!0),b[1]!==d&&(b[1]=d,X=!0),X}_cacheFloat3(C,c,d,b){let X=this._valueCache[C];if(!X||3!==X.length)return X=[c,d,b],this._valueCache[C]=X,!0;let P=!1;return X[0]!==c&&(X[0]=c,P=!0),X[1]!==d&&(X[1]=d,P=!0),X[2]!==b&&(X[2]=b,P=!0),P}_cacheFloat4(C,c,d,b,X){let P=this._valueCache[C];if(!P||4!==P.length)return P=[c,d,b,X],this._valueCache[C]=P,!0;let V=!1;return P[0]!==c&&(P[0]=c,V=!0),P[1]!==d&&(P[1]=d,V=!0),P[2]!==b&&(P[2]=b,V=!0),P[3]!==X&&(P[3]=X,V=!0),V}setInt(C,c){const d=this._valueCache[C];void 0!==d&&d===c||this.Gc.setInt(this._uniforms[C],c)&&(this._valueCache[C]=c)}setInt2(C,c,d){this._cacheFloat2(C,c,d)&&(this.Gc.setInt2(this._uniforms[C],c,d)||(this._valueCache[C]=null))}setInt3(C,c,d,b){this._cacheFloat3(C,c,d,b)&&(this.Gc.setInt3(this._uniforms[C],c,d,b)||(this._valueCache[C]=null))}setInt4(C,c,d,b,X){this._cacheFloat4(C,c,d,b,X)&&(this.Gc.setInt4(this._uniforms[C],c,d,b,X)||(this._valueCache[C]=null))}setIntArray(C,c){this._valueCache[C]=null,this.Gc.setIntArray(this._uniforms[C],c)}setIntArray2(C,c){this._valueCache[C]=null,this.Gc.setIntArray2(this._uniforms[C],c)}setIntArray3(C,c){this._valueCache[C]=null,this.Gc.setIntArray3(this._uniforms[C],c)}setIntArray4(C,c){this._valueCache[C]=null,this.Gc.setIntArray4(this._uniforms[C],c)}setUInt(C,c){const d=this._valueCache[C];void 0!==d&&d===c||this.Gc.setUInt(this._uniforms[C],c)&&(this._valueCache[C]=c)}setUInt2(C,c,d){this._cacheFloat2(C,c,d)&&(this.Gc.setUInt2(this._uniforms[C],c,d)||(this._valueCache[C]=null))}setUInt3(C,c,d,b){this._cacheFloat3(C,c,d,b)&&(this.Gc.setUInt3(this._uniforms[C],c,d,b)||(this._valueCache[C]=null))}setUInt4(C,c,d,b,X){this._cacheFloat4(C,c,d,b,X)&&(this.Gc.setUInt4(this._uniforms[C],c,d,b,X)||(this._valueCache[C]=null))}setUIntArray(C,c){this._valueCache[C]=null,this.Gc.setUIntArray(this._uniforms[C],c)}setUIntArray2(C,c){this._valueCache[C]=null,this.Gc.setUIntArray2(this._uniforms[C],c)}setUIntArray3(C,c){this._valueCache[C]=null,this.Gc.setUIntArray3(this._uniforms[C],c)}setUIntArray4(C,c){this._valueCache[C]=null,this.Gc.setUIntArray4(this._uniforms[C],c)}setArray(C,c){this._valueCache[C]=null,this.Gc.setArray(this._uniforms[C],c)}setArray2(C,c){this._valueCache[C]=null,this.Gc.setArray2(this._uniforms[C],c)}setArray3(C,c){this._valueCache[C]=null,this.Gc.setArray3(this._uniforms[C],c)}setArray4(C,c){this._valueCache[C]=null,this.Gc.setArray4(this._uniforms[C],c)}setMatrices(C,c){c&&(this._valueCache[C]=null,this.Gc.setMatrices(this._uniforms[C],c))}setMatrix(C,c){this._cacheMatrix(C,c)&&(this.Gc.setMatrices(this._uniforms[C],c.rc())||(this._valueCache[C]=null))}setMatrix3x3(C,c){this._valueCache[C]=null,this.Gc.setMatrix3x3(this._uniforms[C],c)}setMatrix2x2(C,c){this._valueCache[C]=null,this.Gc.setMatrix2x2(this._uniforms[C],c)}setFloat(C,c){const d=this._valueCache[C];void 0!==d&&d===c||this.Gc.setFloat(this._uniforms[C],c)&&(this._valueCache[C]=c)}setVector2(C,c){this._cacheFloat2(C,c.x,c.y)&&(this.Gc.setFloat2(this._uniforms[C],c.x,c.y)||(this._valueCache[C]=null))}setFloat2(C,c,d){this._cacheFloat2(C,c,d)&&(this.Gc.setFloat2(this._uniforms[C],c,d)||(this._valueCache[C]=null))}setVector3(C,c){this._cacheFloat3(C,c.x,c.y,c.z)&&(this.Gc.setFloat3(this._uniforms[C],c.x,c.y,c.z)||(this._valueCache[C]=null))}setFloat3(C,c,d,b){this._cacheFloat3(C,c,d,b)&&(this.Gc.setFloat3(this._uniforms[C],c,d,b)||(this._valueCache[C]=null))}setVector4(C,c){this._cacheFloat4(C,c.x,c.y,c.z,c.w)&&(this.Gc.setFloat4(this._uniforms[C],c.x,c.y,c.z,c.w)||(this._valueCache[C]=null))}setQuaternion(C,c){this._cacheFloat4(C,c.x,c.y,c.z,c.w)&&(this.Gc.setFloat4(this._uniforms[C],c.x,c.y,c.z,c.w)||(this._valueCache[C]=null))}setFloat4(C,c,d,b,X){this._cacheFloat4(C,c,d,b,X)&&(this.Gc.setFloat4(this._uniforms[C],c,d,b,X)||(this._valueCache[C]=null))}setColor3(C,c){this._cacheFloat3(C,c.r,c.g,c.b)&&(this.Gc.setFloat3(this._uniforms[C],c.r,c.g,c.b)||(this._valueCache[C]=null))}setColor4(C,c,d){this._cacheFloat4(C,c.r,c.g,c.b,d)&&(this.Gc.setFloat4(this._uniforms[C],c.r,c.g,c.b,d)||(this._valueCache[C]=null))}setDirectColor4(C,c){this._cacheFloat4(C,c.r,c.g,c.b,c.a)&&(this.Gc.setFloat4(this._uniforms[C],c.r,c.g,c.b,c.a)||(this._valueCache[C]=null))}_getVertexShaderCode(){return this.vertexShader?this.Gc._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Gc._getShaderSource(this.fragmentShader):null}}var X=d(12274);const P=new WeakMap,V={_webGLVersion:2,cachedPipelines:{}};function R(C){let c=P.get(C);if(!c){if(!C)return V;c={_webGLVersion:C.TEXTURE_BINDING_3D?2:1,_context:C,parallelShaderCompile:C.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},P.set(C,c)}return c}function p(C){P.delete(C)}function j(C,c,d,b,X,P){const V=R(b);P||(P=V._createShaderProgramInjection??Z);return P(C,B(c,"vertex",b,V._contextWasLost),B(d,"fragment",b,V._contextWasLost),b,X,V.validateShaderPrograms)}function g(C,c,d,b,X){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0;const p=R(X);V||(V=p._createShaderProgramInjection??Z);const j=p._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return V(C,q(c,"vertex",b,j,X,p._contextWasLost),q(d,"fragment",b,j,X,p._contextWasLost),X,P,p.validateShaderPrograms)}function k(C,c){const d=new b,X=R(C);return X.parallelShaderCompile&&!X.disableParallelShaderCompile&&(d.isParallelCompiled=!0),d.context=X._context,d}function Z(C,c,d,b){let X=arguments.length>5?arguments[5]:void 0;const P=b.createProgram();if(C.program=P,!P)throw new Error("Unable to create program");return b.attachShader(P,c),b.attachShader(P,d),b.linkProgram(P),C.context=b,C.vertexShader=c,C.fragmentShader=d,C.isParallelCompiled||A(C,b,X),P}function U(C,c,d){const b=C;if(b._isDisposed)return!1;const X=R(c);return!!(X&&X.parallelShaderCompile&&X.parallelShaderCompile.COMPLETION_STATUS_KHR&&b.program&&c.getProgramParameter(b.program,X.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(A(b,c,d),!0)}function A(C,c,d){const b=C.context,X=C.vertexShader,P=C.fragmentShader,V=C.program;if(!b.getProgramParameter(V,b.LINK_STATUS)){if(!c.getShaderParameter(X,c.COMPILE_STATUS)){const d=c.getShaderInfoLog(X);if(d)throw C.vertexCompilationError=d,new Error("VERTEX SHADER "+d)}if(!c.getShaderParameter(P,c.COMPILE_STATUS)){const d=c.getShaderInfoLog(P);if(d)throw C.fragmentCompilationError=d,new Error("FRAGMENT SHADER "+d)}const d=b.getProgramInfoLog(V);if(d)throw C.programLinkError=d,new Error(d)}if(d){b.validateProgram(V);if(!b.getProgramParameter(V,b.VALIDATE_STATUS)){const c=b.getProgramInfoLog(V);if(c)throw C.programValidationError=c,new Error(c)}}b.deleteShader(X),b.deleteShader(P),C.vertexShader=void 0,C.fragmentShader=void 0,C.onCompiled&&(C.onCompiled(),C.onCompiled=void 0)}function u(C,c,d,b,X,P,V,p,k){let Z=arguments.length>10?arguments[10]:void 0,U=arguments.length>11?arguments[11]:void 0,A=arguments.length>12?arguments[12]:void 0;const u=R(C.context);U||(U=u.createRawShaderProgramInjection??j),A||(A=u.createShaderProgramInjection??g);const q=C;q.program=b?U(q,c,d,q.context,k):A(q,c,d,p,q.context,k),q.program.__SPECTOR_rebuildProgram=V,Z()}function q(C,c,d,b,P,V){return B((0,X.h)(C,d,b),c,P,V)}function B(C,c,d,b){const X=d.createShader("vertex"===c?d.VERTEX_SHADER:d.FRAGMENT_SHADER);if(!X){let C=d.NO_ERROR,X=d.NO_ERROR;for(;(X=d.getError())!==d.NO_ERROR;)C=X;throw new Error(`Something went wrong while creating a gl ${c} shader object. gl error=${C}, gl isContextLost=${d.isContextLost()}, _contextWasLost=${b}`)}return d.shaderSource(X,C),d.compileShader(X),X}function t(C,c){c.useProgram(C)}function e(C,c){const d=C;if(!d.isParallelCompiled)return void c(C);const b=d.onCompiled;d.onCompiled=()=>{null===b||void 0===b||b(),c(C)}}},12296:(C,c,d)=>{d.d(c,{b:()=>k,d:()=>U,f:()=>j,i:()=>g});var b=d(12227),X=d(12302),P=d(12292),V=d(12233),R=d(12272),p=d(12274);function j(C,c){return(0,X.D)(c).cachedPipelines[C]}function g(C){const c=C._name,d=C.context;if(c&&d){const C=(0,X.D)(d),b=C.cachedPipelines[c];null===b||void 0===b||b.dispose(),delete C.cachedPipelines[c]}}function k(C,c,d,X,P,V,p){let j,g;const k=(0,b.l)()?null===V||void 0===V?void 0:V.getHostDocument():null;j="string"===typeof c?c:c.vertexSource?"source:"+c.vertexSource:c.vertexElement?(null===k||void 0===k?void 0:k.getElementById(c.vertexElement))||c.vertexElement:c.vertex||c,g="string"===typeof c?c:c.fragmentSource?"source:"+c.fragmentSource:c.fragmentElement?(null===k||void 0===k?void 0:k.getElementById(c.fragmentElement))||c.fragmentElement:c.fragment||c;const U=[void 0,void 0],A=()=>{if(U[0]&&U[1]){C.isFragment=!0;const[b,j]=U;(0,R.i)(j,C,((V,j)=>{p&&(p._fragmentSourceCodeBeforeMigration=j),d&&(V=d("fragment",V));const g=(0,R.e)(b,V,C);C=null;const k=function(C,c,d,b){if(d){return{vertexSourceCode:(1===b?"//":"")+"#define SHADER_NAME vertex:"+(d.vertexElement||d.vertex||d.spectorName||d)+"\n"+C,fragmentSourceCode:(1===b?"//":"")+"#define SHADER_NAME fragment:"+(d.fragmentElement||d.fragment||d.spectorName||d)+"\n"+c}}return{vertexSourceCode:C,fragmentSourceCode:c}}(g.vertexCode,g.fragmentCode,c,P);null===X||void 0===X||X(k.vertexSourceCode,k.fragmentSourceCode)}),V)}};Z(j,"Vertex","",(c=>{(0,R.f)(C),(0,R.i)(c,C,((C,b)=>{p&&(p._rawVertexSourceCode=c,p._vertexSourceCodeBeforeMigration=b),d&&(C=d("vertex",C)),U[0]=C,A()}),V)}),P),Z(g,"Fragment","Pixel",(C=>{p&&(p._rawFragmentSourceCode=C),U[1]=C,A()}),P)}function Z(C,c,d,X,V,R){if("undefined"!==typeof HTMLElement&&C instanceof HTMLElement){return void X((0,b.b)(C))}if("source:"===C.substring(0,7))return void X(C.substring(7));if("base64:"===C.substring(0,7)){return void X(window.atob(C.substring(7)))}const j=P.e.GetShadersStore(V);if(j[C+c+"Shader"])return void X(j[C+c+"Shader"]);if(d&&j[C+d+"Shader"])return void X(j[C+d+"Shader"]);let g;if(g="."===C[0]||"/"===C[0]||C.indexOf("http")>-1?C:P.e.GetShadersRepository(V)+C,!(R=R||p.m))throw new Error("loadFileInjection is not defined");R(g+"."+c.toLowerCase()+".fx",X)}const U=(C,c,d,b)=>{try{const P=C.context?(0,X.D)(C.context):null;P&&(P.disableParallelShaderCompile=C.disableParallelCompilation);const V=C.existingPipelineContext||c(C.shaderProcessingContext);return V._name=C.name,C.name&&P&&(P.cachedPipelines[C.name]=V),d(V,C.vertex,C.fragment,!!C.createAsRaw,"","",C.rebuildRebind,C.defines,C.transformFeedbackVaryings,"",(()=>{b(V,(()=>{var c;null===(c=C.onRenderingStateCompiled)||void 0===c||c.call(C,V)}))})),V}catch(P){throw V.d.Error("Error compiling effect"),P}}},12289:(C,c,d)=>{d.r(c),d.d(c,{Effect:()=>p});var b=d(12221),X=d(12233),P=d(12292),V=d(12296),R=d(12281);class p{static get ShadersRepository(){return P.e.ShadersRepository}static set ShadersRepository(C){P.e.ShadersRepository=C}get Z(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new b.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9?arguments[9]:void 0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,u=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new b.b,this.onErrorObservable=new b.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=C,this._key=U;const q=this._key.replace(/\r/g,"").replace(/\n/g,"|");let B;if(c.attributes){const C=c;if(this._engine=d,this._attributesNames=C.attributes,this._uniformsNames=C.uniformsNames.concat(C.samplers),this._samplerList=C.samplers.slice(),this.defines=C.defines,this.onError=C.onError,this.onCompiled=C.onCompiled,this._fallbacks=C.fallbacks,this._indexParameters=C.indexParameters,this._transformFeedbackVaryings=C.transformFeedbackVaryings||null,this._multiTarget=!!C.multiTarget,this._shaderLanguage=C.shaderLanguage??0,this._disableParallelShaderCompilation=!!C.disableParallelShaderCompilation,C.uniformBuffersNames){this._uniformBuffersNamesList=C.uniformBuffersNames.slice();for(let c=0;c<C.uniformBuffersNames.length;c++)this._uniformBuffersNames[C.uniformBuffersNames[c]]=c}this._processFinalCode=C.processFinalCode??null,this._processCodeAfterIncludes=C.processCodeAfterIncludes??void 0,u=C.extraInitializationsAsync,B=C.existingPipelineContext}else this._engine=P,this.defines=null==R?"":R,this._uniformsNames=d.concat(X),this._samplerList=X?X.slice():[],this._attributesNames=c,this._uniformBuffersNamesList=[],this._shaderLanguage=A,this.onError=k,this.onCompiled=g,this._indexParameters=Z,this._fallbacks=j;"WEBGL2"===this._engine.shaderPlatformName&&(B=(0,V.f)(q,this._engine._gl)??B),this._attributeLocationByName={},this.uniqueId=p._UniqueIdSeed++,B?(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,u),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.Z||this.dispose(!0)}))}async _processShaderCodeAsync(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3?arguments[3]:void 0;b&&await b(),this._processingContext=d||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const X={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:C??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:P.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:P.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,V.b)(X,this.name,this._processFinalCode,((C,d)=>{this._vertexSourceCode=C,this._fragmentSourceCode=d,this._prepareEffect(c)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.Z||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(C){return this._attributes[C]}getAttributeLocationByName(C){return this._attributeLocationByName[C]}getAttributesCount(){return this._attributes.length}getUniformIndex(C){return this._uniformsNames.indexOf(C)}getUniform(C){return this._uniforms[C]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((C=>{this.executeWhenCompiled(C)}))}executeWhenCompiled(C){this.isReady()?C(this):(this.onCompileObservable.add((c=>{C(c)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(C){(0,R.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(c=>{this._processCompilationErrors(c,C)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var C;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(C=this._pipelineContext)||void 0===C?void 0:C._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var C;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(C=this._pipelineContext)||void 0===C?void 0:C._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(C,c,d,b){this._isReady=!1,this._vertexSourceCodeOverride=C,this._fragmentSourceCodeOverride=c,this.onError=(C,c)=>{b&&b(c)},this.onCompiled=()=>{var C,c;const b=this.getEngine().scenes;if(b)for(let d=0;d<b.length;d++)b[d].markAllMaterialsAsDirty(127);null===(C=(c=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===C||C.call(c,d)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(C){if(this._pipelineContext=C,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let c=0;c<this._attributesNames.length;c++){const C=this._attributesNames[c];this._attributeLocationByName[C]=this._attributes[c]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),p.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this._pipelineContext;this._isReady=!1;try{const d=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),b=d?null:this.defines,X=d?this._vertexSourceCodeOverride:this._vertexSourceCode,P=d?this._fragmentSourceCodeOverride:this._fragmentSourceCode,R=this._engine;this._pipelineContext=(0,V.d)({existingPipelineContext:C?c:null,vertex:X,fragment:P,context:"WEBGL2"===R.shaderPlatformName||"WEBGL1"===R.shaderPlatformName?R._gl:void 0,rebuildRebind:(C,c,d,b)=>this._rebuildProgram(C,c,d,b),defines:b,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:d,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:d=>{c&&!C&&this._engine._deletePipelineContext(c),d&&this._onRenderingStateCompiled(d)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(c)}catch(d){this._processCompilationErrors(d,c)}}_getShaderCodeAndErrorLine(C,c,d){const b=d?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let X=null;if(c&&C){const P=c.match(b);if(P&&2===P.length){const c=parseInt(P[1]),b=C.split("\n",-1);b.length>=c&&(X=`Offending line [${c}] in ${d?"fragment":"vertex"} code: ${b[c-1]}`)}}return[C,X]}_processCompilationErrors(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=C.message;const d=this._attributesNames,b=this._fallbacks;if(X.d.Error("Unable to compile effect:"),X.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),X.d.Error(`Attributes: ${d.join(" ")}`),X.d.Error("Defines:\n"+this.defines),p.LogShaderCodeOnCompilationError){var P,V;let C=null,c=null,d=null;var R;if(null!==(P=this._pipelineContext)&&void 0!==P&&P._getVertexShaderCode()&&([d,C]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),d&&(X.d.Error("Vertex code:"),X.d.Error(d))),null!==(V=this._pipelineContext)&&void 0!==V&&V._getFragmentShaderCode())[d,c]=this._getShaderCodeAndErrorLine(null===(R=this._pipelineContext)||void 0===R?void 0:R._getFragmentShaderCode(),this._compilationError,!0),d&&(X.d.Error("Fragment code:"),X.d.Error(d));C&&X.d.Error(C),c&&X.d.Error(c)}X.d.Error("Error: "+this._compilationError);const j=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};c&&(this._pipelineContext=c,this._isReady=!0,j()),b?(this._pipelineContext=null,b.hasMoreFallbacks?(this._allFallbacksProcessed=!1,X.d.Error("Trying next fallback."),this.defines=b.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,j(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,c||j())}get isSupported(){return""===this._compilationError}_bindTexture(C,c){this._engine._bindTexture(this._samplers[C],c,C)}setTexture(C,c){this._engine.setTexture(this._samplers[C],this._uniforms[C],c,C)}setTextureArray(C,c){const d=C+"Ex";if(-1===this._samplerList.indexOf(d+"0")){const b=this._samplerList.indexOf(C);for(let C=1;C<c.length;C++){const c=d+(C-1).toString();this._samplerList.splice(b+C,0,c)}let X=0;for(const C of this._samplerList)this._samplers[C]=X,X+=1}this._engine.setTextureArray(this._samplers[C],this._uniforms[C],c,C)}bindUniformBuffer(C,c){const d=this._uniformBuffersNames[c];void 0===d||p._BaseCache[d]===C&&this._engine._features.useUBOBindingCache||(p._BaseCache[d]=C,this._engine.bindUniformBufferBase(C,d,c))}bindUniformBlock(C,c){this._engine.bindUniformBlock(this._pipelineContext,C,c)}setInt(C,c){return this._pipelineContext.setInt(C,c),this}setInt2(C,c,d){return this._pipelineContext.setInt2(C,c,d),this}setInt3(C,c,d,b){return this._pipelineContext.setInt3(C,c,d,b),this}setInt4(C,c,d,b,X){return this._pipelineContext.setInt4(C,c,d,b,X),this}setIntArray(C,c){return this._pipelineContext.setIntArray(C,c),this}setIntArray2(C,c){return this._pipelineContext.setIntArray2(C,c),this}setIntArray3(C,c){return this._pipelineContext.setIntArray3(C,c),this}setIntArray4(C,c){return this._pipelineContext.setIntArray4(C,c),this}setUInt(C,c){return this._pipelineContext.setUInt(C,c),this}setUInt2(C,c,d){return this._pipelineContext.setUInt2(C,c,d),this}setUInt3(C,c,d,b){return this._pipelineContext.setUInt3(C,c,d,b),this}setUInt4(C,c,d,b,X){return this._pipelineContext.setUInt4(C,c,d,b,X),this}setUIntArray(C,c){return this._pipelineContext.setUIntArray(C,c),this}setUIntArray2(C,c){return this._pipelineContext.setUIntArray2(C,c),this}setUIntArray3(C,c){return this._pipelineContext.setUIntArray3(C,c),this}setUIntArray4(C,c){return this._pipelineContext.setUIntArray4(C,c),this}setFloatArray(C,c){return this._pipelineContext.setArray(C,c),this}setFloatArray2(C,c){return this._pipelineContext.setArray2(C,c),this}setFloatArray3(C,c){return this._pipelineContext.setArray3(C,c),this}setFloatArray4(C,c){return this._pipelineContext.setArray4(C,c),this}setArray(C,c){return this._pipelineContext.setArray(C,c),this}setArray2(C,c){return this._pipelineContext.setArray2(C,c),this}setArray3(C,c){return this._pipelineContext.setArray3(C,c),this}setArray4(C,c){return this._pipelineContext.setArray4(C,c),this}setMatrices(C,c){return this._pipelineContext.setMatrices(C,c),this}setMatrix(C,c){return this._pipelineContext.setMatrix(C,c),this}setMatrix3x3(C,c){return this._pipelineContext.setMatrix3x3(C,c),this}setMatrix2x2(C,c){return this._pipelineContext.setMatrix2x2(C,c),this}setFloat(C,c){return this._pipelineContext.setFloat(C,c),this}setBool(C,c){return this._pipelineContext.setInt(C,c?1:0),this}setVector2(C,c){return this._pipelineContext.setVector2(C,c),this}setFloat2(C,c,d){return this._pipelineContext.setFloat2(C,c,d),this}setVector3(C,c){return this._pipelineContext.setVector3(C,c),this}setFloat3(C,c,d,b){return this._pipelineContext.setFloat3(C,c,d,b),this}setVector4(C,c){return this._pipelineContext.setVector4(C,c),this}setQuaternion(C,c){return this._pipelineContext.setQuaternion(C,c),this}setFloat4(C,c,d,b,X){return this._pipelineContext.setFloat4(C,c,d,b,X),this}setColor3(C,c){return this._pipelineContext.setColor3(C,c),this}setColor4(C,c,d){return this._pipelineContext.setColor4(C,c,d),this}setDirectColor4(C,c){return this._pipelineContext.setDirectColor4(C,c),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(p.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,V.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c&&(P.e.GetShadersStore(b)[`${C}PixelShader`]=c),d&&(P.e.GetShadersStore(b)[`${C}VertexShader`]=d)}static ResetCache(){p._BaseCache={}}}p.LogShaderCodeOnCompilationError=!0,p.PersistentMode=!1,p.AutomaticallyClearCodeCache=!1,p._UniqueIdSeed=0,p._BaseCache={},p.ShadersStore=P.e.ShadersStore,p.IncludesShadersStore=P.e.IncludesShadersStore},12243:(C,c,d)=>{d.d(c,{c:()=>X});const b={};function X(C){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!b[C])return b[C]=!0,`${C} needs to be imported before as it contains a side-effect required by your code.`}},12227:(C,c,d)=>{function b(){return"undefined"!==typeof window}function X(){return"undefined"!==typeof navigator}function P(){return"undefined"!==typeof document}function V(C){let c="",d=C.firstChild;for(;d;)3===d.nodeType&&(c+=d.textContent),d=d.nextSibling;return c}d.d(c,{b:()=>V,e:()=>P,i:()=>X,l:()=>b})},12233:(C,c,d)=>{d.d(c,{d:()=>b});class b{static _CheckLimit(C,c){let d=b._LogLimitOutputs[C];return d?d.current++:(d={limit:c,current:1},b._LogLimitOutputs[C]=d),d.current<=d.limit}static _GenerateLimitMessage(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const d=b._LogLimitOutputs[C];if(!d||!b.MessageLimitReached)return;const X=this._Levels[c];d.current===d.limit&&b[X.name](b.MessageLimitReached.replace(/%LIMIT%/g,""+d.limit).replace(/%TYPE%/g,X.name??""))}static _AddLogEntry(C){b._LogCache=C+b._LogCache,b.OnNewCacheEntry&&b.OnNewCacheEntry(C)}static _FormatMessage(C){const c=C=>C<10?"0"+C:""+C,d=new Date;return"["+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())+"]: "+C}static _LogDisabled(C,c){}static _LogEnabled(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;const X=Array.isArray(c)?c[0]:c;if(void 0!==d&&!b._CheckLimit(X,d))return;const P=b._FormatMessage(X),V=this._Levels[C],R=Array.isArray(c)?c.slice(1):[];V.logFunc&&V.logFunc("BJS - "+P,...R);const p=`<div style='color:${V.color}'>${P}</div><br>`;b._AddLogEntry(p),b._GenerateLimitMessage(X,C)}static get LogCache(){return b._LogCache}static ClearLogCache(){b._LogCache="",b._LogLimitOutputs={},b.errorsCount=0}static set LogLevels(C){b.Log=b._LogDisabled,b.Warn=b._LogDisabled,b.Error=b._LogDisabled;const c=[b.MessageLogLevel,b.WarningLogLevel,b.ErrorLogLevel];for(const d of c)if((C&d)===d){const C=this._Levels[d];b[C.name]=b._LogEnabled.bind(b,d)}}}b.NoneLogLevel=0,b.MessageLogLevel=1,b.WarningLogLevel=2,b.ErrorLogLevel=4,b.AllLogLevel=7,b.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",b._LogCache="",b._LogLimitOutputs={},b._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],b.errorsCount=0,b.Log=b._LogEnabled.bind(b,b.MessageLogLevel),b.Warn=b._LogEnabled.bind(b,b.WarningLogLevel),b.Error=b._LogEnabled.bind(b,b.ErrorLogLevel)},12221:(C,c,d)=>{d.d(c,{b:()=>V});const b="undefined"!==typeof WeakRef;class X{constructor(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0;this.initialize(C,c,d,b)}initialize(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0;return this.mask=C,this.skipNextObservers=c,this.target=d,this.currentTarget=b,this}}class P{constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=C,this.mask=c,this.scope=d,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(C)}}class V{static FromPromise(C,c){const d=new V;return C.then((C=>{d.notifyObservers(C)})).catch((C=>{if(!c)throw C;c.notifyObservers(C)})),d}get observers(){return this._observers}constructor(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=c,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new X(0),C&&(this._onObserverAdded=C)}add(C){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!C)return null;const X=new P(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);X.unregisterOnNextCall=d,c?this._observers.unshift(X):this._observers.push(X),this._onObserverAdded&&this._onObserverAdded(X),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(X,this._lastNotifiedValue);const V=b?new WeakRef(this):{deref:()=>this};return X._remove=function(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=V.deref();c&&(C?c.remove(X):c._remove(X))},X}addOnce(C){return this.add(C,void 0,void 0,void 0,!0)}remove(C){if(!C)return!1;C._remove=null;return-1!==this._observers.indexOf(C)&&(this._deferUnregister(C),!0)}removeCallback(C,c){for(let d=0;d<this._observers.length;d++){const b=this._observers[d];if(!b._willBeUnregistered&&(b.callback===C&&(!c||c===b.scope)))return this._deferUnregister(b),!0}return!1}_deferUnregister(C){C._willBeUnregistered||(this._numObserversMarkedAsDeleted++,C.unregisterOnNextCall=!1,C._willBeUnregistered=!0,setTimeout((()=>{this._remove(C)}),0))}_remove(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!C)return!1;const d=this._observers.indexOf(C);return-1!==d&&(c&&this._numObserversMarkedAsDeleted--,this._observers.splice(d,1),!0)}makeObserverTopPriority(C){this._remove(C,!1),this._observers.unshift(C)}makeObserverBottomPriority(C){this._remove(C,!1),this._observers.push(C)}notifyObservers(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,d=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=C),!this._observers.length)return!0;const P=this._eventState;P.mask=c,P.target=d,P.currentTarget=b,P.skipNextObservers=!1,P.lastReturnValue=C,P.userInfo=X;for(const V of this._observers)if(!V._willBeUnregistered&&(V.mask&c&&(V.unregisterOnNextCall&&this._deferUnregister(V),V.scope?P.lastReturnValue=V.callback.apply(V.scope,[C,P]):P.lastReturnValue=V.callback(C,P)),P.skipNextObservers))return!1;return!0}notifyObserver(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),C._willBeUnregistered)return;const b=this._eventState;b.mask=d,b.skipNextObservers=!1,C.unregisterOnNextCall&&this._deferUnregister(C),C.callback(c,b)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const C=this._observers.pop();C&&(C._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const C=new V;return C._observers=this._observers.slice(0),C}hasSpecificMask(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const c of this._observers)if(c.mask&C||c.mask===C)return!0;return!1}}},12281:(C,c,d)=>{d.d(c,{d:()=>X,f:()=>V});let b=[];class X{static SetImmediate(C){0===b.length&&setTimeout((()=>{const C=b;b=[];for(const c of C)c()}),1),b.push(C)}}function P(C,c,d){try{if(C())return c(),!0}catch(b){return null===d||void 0===d||d(b),!0}return!1}const V=function(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,V=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&P(C,c,d))return null;const R=setInterval((()=>{P(C,c,d)?clearInterval(R):(X-=b,X<0&&(clearInterval(R),null===d||void 0===d||d(new Error("Operation timed out after maximum retries. "+(V||"")),!0)))}),b);return()=>clearInterval(R)}}}]);