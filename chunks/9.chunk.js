/*! For license information please see 09wkk.9.b49d82cb.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10683:function(R,q){!function(R){"use strict";var q=function(R,L){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,q){R.__proto__=q}||function(R,q){for(var L in q)Object.prototype.hasOwnProperty.call(q,L)&&(R[L]=q[L])},q(R,L)};function L(R,L){if("function"!==typeof L&&null!==L)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function B(){this.constructor=R}q(R,L),R.prototype=null===L?Object.create(L):(B.prototype=L.prototype,new B)}function B(R,q,L,B){var N,h=arguments.length,Z=h<3?q:null===B?B=Object.getOwnPropertyDescriptor(q,L):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Z=Reflect.decorate(R,q,L,B);else for(var z=R.length-1;z>=0;z--)(N=R[z])&&(Z=(h<3?N(Z):h>3?N(q,L,Z):N(q,L))||Z);return h>3&&Z&&Object.defineProperty(q,L,Z),Z}function N(R,q,L){if(L||2===arguments.length)for(var B,N=0,h=q.length;N<h;N++)!B&&N in q||(B||(B=Array.prototype.slice.call(q,0,N)),B[N]=q[N]);return R.concat(B||Array.prototype.slice.call(q))}var h,Z=255,z=213;R.OPERATION=void 0,(h=R.OPERATION||(R.OPERATION={}))[h.ADD=128]="ADD",h[h.REPLACE=0]="REPLACE",h[h.DELETE=64]="DELETE",h[h.DELETE_AND_ADD=192]="DELETE_AND_ADD",h[h.TOUCH=1]="TOUCH",h[h.CLEAR=10]="CLEAR";var Y=function(){function q(R,q,L){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=R,this.setParent(q,L)}return q.prototype.setParent=function(R,q,L){var B=this;if(this.indexes||(this.indexes=this.ref instanceof WR?this.ref._definition.indexes:{}),this.parent=R,this.parentIndex=L,q)if(this.root=q,this.ref instanceof WR){var N=this.ref._definition;for(var h in N.schema){var Z=this.ref[h];if(Z&&Z.$changes){var z=N.indexes[h];Z.$changes.setParent(this.ref,q,z)}}}else"object"===typeof this.ref&&this.ref.forEach((function(R,q){if(R instanceof WR){var L=R.$changes,N=B.ref.$changes.indexes[q];L.setParent(B.ref,B.root,N)}}))},q.prototype.operation=function(R){this.changes.set(--this.currentCustomOperation,R)},q.prototype.change=function(q,L){void 0===L&&(L=R.OPERATION.ADD);var B="number"===typeof q?q:this.indexes[q];this.assertValidIndex(B,q);var N=this.changes.get(B);N&&N.op!==R.OPERATION.DELETE&&N.op!==R.OPERATION.TOUCH||this.changes.set(B,{op:N&&N.op===R.OPERATION.DELETE?R.OPERATION.DELETE_AND_ADD:L,index:B}),this.allChanges.add(B),this.changed=!0,this.touchParents()},q.prototype.touch=function(q){var L="number"===typeof q?q:this.indexes[q];this.assertValidIndex(L,q),this.changes.has(L)||this.changes.set(L,{op:R.OPERATION.TOUCH,index:L}),this.allChanges.add(L),this.touchParents()},q.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},q.prototype.getType=function(R){if(this.ref._definition)return(q=this.ref._definition).schema[q.fieldsByIndex[R]];var q,L=(q=this.parent._definition).schema[q.fieldsByIndex[this.parentIndex]];return Object.values(L)[0]},q.prototype.getChildrenFilter=function(){var R=this.parent._definition.childFilters;return R&&R[this.parentIndex]},q.prototype.getValue=function(R){return this.ref.getByIndex(R)},q.prototype.delete=function(q){var L="number"===typeof q?q:this.indexes[q];if(void 0!==L){var B=this.getValue(L);this.changes.set(L,{op:R.OPERATION.DELETE,index:L}),this.allChanges.delete(L),delete this.caches[L],B&&B.$changes&&(B.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(q," (").concat(L,")"))},q.prototype.discard=function(q,L){var B=this;void 0===q&&(q=!1),void 0===L&&(L=!1),this.ref instanceof WR||this.changes.forEach((function(q){if(q.op===R.OPERATION.DELETE){var L=B.ref.getIndex(q.index);delete B.indexes[L]}})),this.changes.clear(),this.changed=q,L&&this.allChanges.clear(),this.currentCustomOperation=0},q.prototype.discardAll=function(){var R=this;this.changes.forEach((function(q){var L=R.getValue(q.index);L&&L.$changes&&L.$changes.discardAll()})),this.discard()},q.prototype.cache=function(R,q){this.caches[R]=q},q.prototype.clone=function(){return new q(this.ref,this.parent,this.root)},q.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},q.prototype.assertValidIndex=function(R,q){if(void 0===R)throw new Error('ChangeTree: missing index for field "'.concat(q,'"'))},q}();function F(R,q,L,B){return R[q]||(R[q]=[]),R[q].push(L),null===B||void 0===B||B.forEach((function(R,q){return L(R,q)})),function(){return e(R[q],R[q].indexOf(L))}}function C(q){var L=this,B="string"!==typeof this.$changes.getType();this.$items.forEach((function(N,h){q.push({refId:L.$changes.refId,op:R.OPERATION.DELETE,field:h,value:void 0,previousValue:N}),B&&L.$changes.root.removeRef(N.$changes.refId)}))}function e(R,q){if(-1===q||q>=R.length)return!1;for(var L=R.length-1,B=q;B<L;B++)R[B]=R[B+1];return R.length=L,!0}var y=function(R,q){var L=R.toString(),B=q.toString();return L<B?-1:L>B?1:0};function U(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,q){return"symbol"===typeof q||isNaN(q)?R[q]:R.at(q)},set:function(R,q,L){if("symbol"===typeof q||isNaN(q))R[q]=L;else{var B=Array.from(R.$items.keys()),N=parseInt(B[q]||q);void 0===L||null===L?R.deleteAt(N):R.setAt(N,L)}return!0},deleteProperty:function(R,q){return"number"===typeof q?R.deleteAt(q):delete R[q],!0}})}var n=function(){function q(){for(var R=[],q=0;q<arguments.length;q++)R[q]=arguments[q];this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,R)}return q.prototype.sd=function(q,L){return void 0===L&&(L=!0),F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,q,L?this.$items:void 0)},q.prototype.ab=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,q)},q.is=function(R){return Array.isArray(R)||void 0!==R.array},Object.defineProperty(q.prototype,"length",{get:function(){return this.$items.size},set:function(R){0===R?this.clear():this.splice(R,this.length-R)},enumerable:!1,configurable:!0}),q.prototype.push=function(){for(var R,q=this,L=[],B=0;B<arguments.length;B++)L[B]=arguments[B];return L.forEach((function(L){R=q.$refId++,q.setAt(R,L)})),R},q.prototype.pop=function(){var R=Array.from(this.$indexes.values()).pop();if(void 0!==R){this.$changes.delete(R),this.$indexes.delete(R);var q=this.$items.get(R);return this.$items.delete(R),q}},q.prototype.at=function(R){var q=Array.from(this.$items.keys())[R];return this.$items.get(q)},q.prototype.setAt=function(q,L){var B,N;if(void 0!==L&&null!==L){if(this.$items.get(q)!==L){void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,q);var h=null!==(N=null===(B=this.$changes.indexes[q])||void 0===B?void 0:B.op)&&void 0!==N?N:R.OPERATION.ADD;this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,L),this.$changes.change(q,h)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},q.prototype.deleteAt=function(R){var q=Array.from(this.$items.keys())[R];return void 0!==q&&this.$deleteAt(q)},q.prototype.$deleteAt=function(R){return this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&C.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.concat=function(){for(var R,L=[],B=0;B<arguments.length;B++)L[B]=arguments[B];return new(q.bind.apply(q,N([void 0],(R=Array.from(this.$items.values())).concat.apply(R,L),!1)))},q.prototype.join=function(R){return Array.from(this.$items.values()).join(R)},q.prototype.reverse=function(){var R=this,q=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(L,B){R.setAt(q[B],L)})),this},q.prototype.shift=function(){var R=Array.from(this.$items.keys()).shift();if(void 0!==R){var q=this.$items.get(R);return this.$deleteAt(R),q}},q.prototype.slice=function(R,L){var B=new q;return B.push.apply(B,Array.from(this.$items.values()).slice(R,L)),B},q.prototype.sort=function(R){var q=this;void 0===R&&(R=y);var L=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(R).forEach((function(R,B){q.setAt(L[B],R)})),this},q.prototype.splice=function(R,q){void 0===q&&(q=this.length-R);for(var L=Array.from(this.$items.keys()),B=[],N=R;N<R+q;N++)B.push(this.$items.get(L[N])),this.$deleteAt(L[N]);return B},q.prototype.unshift=function(){for(var R=this,q=[],L=0;L<arguments.length;L++)q[L]=arguments[L];var B=this.length,N=q.length,h=Array.from(this.$items.values());return q.forEach((function(q,L){R.setAt(L,q)})),h.forEach((function(q,L){R.setAt(N+L,q)})),B+N},q.prototype.indexOf=function(R,q){return Array.from(this.$items.values()).indexOf(R,q)},q.prototype.lastIndexOf=function(R,q){return void 0===q&&(q=this.length-1),Array.from(this.$items.values()).lastIndexOf(R,q)},q.prototype.every=function(R,q){return Array.from(this.$items.values()).every(R,q)},q.prototype.some=function(R,q){return Array.from(this.$items.values()).some(R,q)},q.prototype.forEach=function(R,q){Array.from(this.$items.values()).forEach(R,q)},q.prototype.map=function(R,q){return Array.from(this.$items.values()).map(R,q)},q.prototype.filter=function(R,q){return Array.from(this.$items.values()).filter(R,q)},q.prototype.reduce=function(R,q){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},q.prototype.reduceRight=function(R,q){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},q.prototype.find=function(R,q){return Array.from(this.$items.values()).find(R,q)},q.prototype.findIndex=function(R,q){return Array.from(this.$items.values()).findIndex(R,q)},q.prototype.fill=function(R,q,L){throw new Error("ArraySchema#fill() not implemented")},q.prototype.copyWithin=function(R,q,L){throw new Error("ArraySchema#copyWithin() not implemented")},q.prototype.toString=function(){return this.$items.toString()},q.prototype.toLocaleString=function(){return this.$items.toLocaleString()},q.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},q.prototype.includes=function(R,q){return Array.from(this.$items.values()).includes(R,q)},q.prototype.flatMap=function(R,q){throw new Error("ArraySchema#flatMap() is not supported.")},q.prototype.flat=function(R){throw new Error("ArraySchema#flat() is not supported.")},q.prototype.findLast=function(){var R=Array.from(this.$items.values());return R.findLast.apply(R,arguments)},q.prototype.findLastIndex=function(){var R=Array.from(this.$items.values());return R.findLastIndex.apply(R,arguments)},q.prototype.setIndex=function(R,q){this.$indexes.set(R,q)},q.prototype.getIndex=function(R){return this.$indexes.get(R)},q.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},q.prototype.deleteByIndex=function(R){var q=this.$indexes.get(R);this.$items.delete(q),this.$indexes.delete(R)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){return this.toArray().map((function(R){return"function"===typeof R.toJSON?R.toJSON():R}))},q.prototype.clone=function(R){return R?new(q.bind.apply(q,N([void 0],Array.from(this.$items.values()),!1))):new(q.bind.apply(q,N([void 0],this.map((function(R){return R.$changes?R.clone():R})),!1)))},q}();function r(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,q){return"symbol"!==typeof q&&"undefined"===typeof R[q]?R.get(q):R[q]},set:function(R,q,L){return"symbol"!==typeof q&&-1===q.indexOf("$")&&"sd"!==q&&"ab"!==q&&"onChange"!==q?R.set(q,L):R[q]=L,!0},deleteProperty:function(R,q){return R.delete(q),!0}})}var p=function(){function q(R){var L=this;if(this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R)if(R instanceof Map||R instanceof q)R.forEach((function(R,q){return L.set(q,R)}));else for(var B in R)this.set(B,R[B])}return q.prototype.sd=function(q,L){return void 0===L&&(L=!0),F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,q,L?this.$items:void 0)},q.prototype.ab=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,q)},q.is=function(R){return void 0!==R.map},q.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(q.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.set=function(q,L){if(void 0===L||null===L)throw new Error("MapSchema#set('".concat(q,"', ").concat(L,"): trying to set ").concat(L," value on '").concat(q,"'."));q=q.toString();var B="undefined"!==typeof this.$changes.indexes[q],N=B?this.$changes.indexes[q]:this.$refId++,h=B?R.OPERATION.REPLACE:R.OPERATION.ADD,Z=void 0!==L.$changes;if(Z&&L.$changes.setParent(this,this.$changes.root,N),B){if(!Z&&this.$items.get(q)===L)return;Z&&this.$items.get(q)!==L&&(h=R.OPERATION.ADD)}else this.$changes.indexes[q]=N,this.$indexes.set(N,q);return this.$items.set(q,L),this.$changes.change(q,h),this},q.prototype.get=function(R){return this.$items.get(R)},q.prototype.delete=function(R){return this.$changes.delete(R),this.$items.delete(R)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&C.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(R){return this.$items.has(R)},q.prototype.forEach=function(R){this.$items.forEach(R)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(R,q){this.$indexes.set(R,q)},q.prototype.getIndex=function(R){return this.$indexes.get(R)},q.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},q.prototype.deleteByIndex=function(R){var q=this.$indexes.get(R);this.$items.delete(q),this.$indexes.delete(R)},q.prototype.toJSON=function(){var R={};return this.forEach((function(q,L){R[L]="function"===typeof q.toJSON?q.toJSON():q})),R},q.prototype.clone=function(R){var L;return R?L=Object.assign(new q,this):(L=new q,this.forEach((function(R,q){R.$changes?L.set(q,R.clone()):L.set(q,R)}))),L},q}(),c={};function d(R,q){c[R]=q}function f(R){return c[R]}var v=function(){function R(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return R.create=function(q){var L=new R;return L.schema=Object.assign({},q&&q.schema||{}),L.indexes=Object.assign({},q&&q.indexes||{}),L.fieldsByIndex=Object.assign({},q&&q.fieldsByIndex||{}),L.descriptors=Object.assign({},q&&q.descriptors||{}),L.deprecated=Object.assign({},q&&q.deprecated||{}),L},R.prototype.addField=function(R,q){var L=this.getNextFieldIndex();this.fieldsByIndex[L]=R,this.indexes[R]=L,this.schema[R]=Array.isArray(q)?{array:q[0]}:q},R.prototype.hasField=function(R){return void 0!==this.indexes[R]},R.prototype.addFilter=function(R,q){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[R]]=q,this.indexesWithFilters.push(this.indexes[R]),!0},R.prototype.addChildrenFilter=function(R,q){var L=this.indexes[R],B=this.schema[R];if(f(Object.keys(B)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[L]=q,!0;console.warn("@filterChildren: field '".concat(R,"' can't have children. Ignoring filter."))},R.prototype.getChildrenFilter=function(R){return this.childFilters&&this.childFilters[this.indexes[R]]},R.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},R}();function T(R){return R._context&&R._context.useFilters}var t=function(){function R(){this.types={},this.schemas=new Map,this.useFilters=!1}return R.prototype.has=function(R){return this.schemas.has(R)},R.prototype.get=function(R){return this.types[R]},R.prototype.add=function(R,q){void 0===q&&(q=this.schemas.size),R._definition=v.create(R._definition),R._typeid=q,this.types[q]=R,this.schemas.set(R,q)},R.create=function(q){return void 0===q&&(q={}),function(L){return q.context||(q.context=new R),S(L,q)}},R}(),D=new t;function S(R,q){return void 0===q&&(q={}),function(L,B){var h=q.context||D,Z=L.constructor;if(Z._context=h,!R)throw new Error("".concat(Z.name,': @type() reference provided for "').concat(B,"\" is undefined. Make sure you don't have any circular dependencies."));h.has(Z)||h.add(Z);var z=Z._definition;if(z.addField(B,R),z.descriptors[B]){if(z.deprecated[B])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(B,"' definition on '").concat(Z.name,"'.\nCheck @type() annotation"))}catch(c){var Y=c.stack.split("\n")[4].trim();throw new Error("".concat(c.message," ").concat(Y))}}var F=n.is(R),C=!F&&p.is(R);if("string"!==typeof R&&!WR.is(R)){var e=Object.values(R)[0];"string"===typeof e||h.has(e)||h.add(e)}if(q.manual)z.descriptors[B]={enumerable:!0,configurable:!0,writable:!0};else{var y="_".concat(B);z.descriptors[y]={enumerable:!1,configurable:!1,writable:!0},z.descriptors[B]={get:function(){return this[y]},set:function(R){R!==this[y]&&(void 0!==R&&null!==R?(!F||R instanceof n||(R=new(n.bind.apply(n,N([void 0],R,!1)))),!C||R instanceof p||(R=new p(R)),void 0===R.$proxy&&(C?R=r(R):F&&(R=U(R))),this.$changes.change(B),R.$changes&&R.$changes.setParent(this,this.$changes.root,this._definition.indexes[B])):this[y]&&this.$changes.delete(B),this[y]=R)},enumerable:!0,configurable:!0}}}}function I(R){return function(q,L){var B=q.constructor;B._definition.addFilter(L,R)&&(B._context.useFilters=!0)}}function K(R){return function(q,L){var B=q.constructor;B._definition.addChildrenFilter(L,R)&&(B._context.useFilters=!0)}}function m(R){return void 0===R&&(R=!0),function(q,L){var B=q.constructor._definition;B.deprecated[L]=!0,R&&(B.descriptors[L]={get:function(){throw new Error("".concat(L," is deprecated."))},set:function(R){},enumerable:!1,configurable:!0})}}function o(R,q,L){for(var B in void 0===L&&(L={}),L.context||(L.context=R._context||L.context||D),q)S(q[B],L)(R.prototype,B);return R}function l(R){for(var q=0,L=0,B=0,N=R.length;B<N;B++)(q=R.charCodeAt(B))<128?L+=1:q<2048?L+=2:q<55296||q>=57344?L+=3:(B++,L+=4);return L}function G(R,q,L){for(var B=0,N=0,h=L.length;N<h;N++)(B=L.charCodeAt(N))<128?R[q++]=B:B<2048?(R[q++]=192|B>>6,R[q++]=128|63&B):B<55296||B>=57344?(R[q++]=224|B>>12,R[q++]=128|B>>6&63,R[q++]=128|63&B):(N++,B=65536+((1023&B)<<10|1023&L.charCodeAt(N)),R[q++]=240|B>>18,R[q++]=128|B>>12&63,R[q++]=128|B>>6&63,R[q++]=128|63&B)}function W(R,q){R.push(255&q)}function H(R,q){R.push(255&q)}function P(R,q){R.push(255&q),R.push(q>>8&255)}function O(R,q){R.push(255&q),R.push(q>>8&255)}function E(R,q){R.push(255&q),R.push(q>>8&255),R.push(q>>16&255),R.push(q>>24&255)}function a(R,q){var L=q>>24,B=q>>16,N=q>>8,h=q;R.push(255&h),R.push(255&N),R.push(255&B),R.push(255&L)}function g(R,q){var L=Math.floor(q/Math.pow(2,32));a(R,q>>>0),a(R,L)}function Q(R,q){var L=q/Math.pow(2,32)|0;a(R,q>>>0),a(R,L)}function i(R,q){j(R,q)}function k(R,q){J(R,q)}var V=new Int32Array(2),x=new Float32Array(V.buffer),w=new Float64Array(V.buffer);function j(R,q){x[0]=q,E(R,V[0])}function J(R,q){w[0]=q,E(R,V[0]),E(R,V[1])}function s(R,q){return H(R,q?1:0)}function A(R,q){q||(q="");var L=l(q),B=0;if(L<32)R.push(160|L),B=1;else if(L<256)R.push(217),H(R,L),B=2;else if(L<65536)R.push(218),O(R,L),B=3;else{if(!(L<4294967296))throw new Error("String too long");R.push(219),a(R,L),B=5}return G(R,R.length,q),B+L}function M(R,q){return isNaN(q)?M(R,0):isFinite(q)?q!==(0|q)?(R.push(203),J(R,q),9):q>=0?q<128?(H(R,q),1):q<256?(R.push(204),H(R,q),2):q<65536?(R.push(205),O(R,q),3):q<4294967296?(R.push(206),a(R,q),5):(R.push(207),Q(R,q),9):q>=-32?(R.push(224|q+32),1):q>=-128?(R.push(208),W(R,q),2):q>=-32768?(R.push(209),P(R,q),3):q>=-2147483648?(R.push(210),E(R,q),5):(R.push(211),g(R,q),9):M(R,q>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var b=Object.freeze({__proto__:null,utf8Write:G,int8:W,uint8:H,int16:P,uint16:O,int32:E,uint32:a,int64:g,uint64:Q,float32:i,float64:k,writeFloat32:j,writeFloat64:J,boolean:s,string:A,number:M});function X(R,q,L){for(var B="",N=0,h=q,Z=q+L;h<Z;h++){var z=R[h];0!==(128&z)?192!==(224&z)?224!==(240&z)?240!==(248&z)?console.error("Invalid byte "+z.toString(16)):(N=(7&z)<<18|(63&R[++h])<<12|(63&R[++h])<<6|63&R[++h])>=65536?(N-=65536,B+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):B+=String.fromCharCode(N):B+=String.fromCharCode((15&z)<<12|(63&R[++h])<<6|63&R[++h]):B+=String.fromCharCode((31&z)<<6|63&R[++h]):B+=String.fromCharCode(z)}return B}function u(R,q){return RR(R,q)<<24>>24}function RR(R,q){return R[q.offset++]}function qR(R,q){return LR(R,q)<<16>>16}function LR(R,q){return R[q.offset++]|R[q.offset++]<<8}function BR(R,q){return R[q.offset++]|R[q.offset++]<<8|R[q.offset++]<<16|R[q.offset++]<<24}function NR(R,q){return BR(R,q)>>>0}function hR(R,q){return yR(R,q)}function ZR(R,q){return UR(R,q)}function zR(R,q){var L=NR(R,q);return BR(R,q)*Math.pow(2,32)+L}function YR(R,q){var L=NR(R,q);return NR(R,q)*Math.pow(2,32)+L}var FR=new Int32Array(2),CR=new Float32Array(FR.buffer),eR=new Float64Array(FR.buffer);function yR(R,q){return FR[0]=BR(R,q),CR[0]}function UR(R,q){return FR[0]=BR(R,q),FR[1]=BR(R,q),eR[0]}function nR(R,q){return RR(R,q)>0}function rR(R,q){var L,B=R[q.offset++];B<192?L=31&B:217===B?L=RR(R,q):218===B?L=LR(R,q):219===B&&(L=NR(R,q));var N=X(R,q.offset,L);return q.offset+=L,N}function pR(R,q){var L=R[q.offset];return L<192&&L>160||217===L||218===L||219===L}function cR(R,q){var L=R[q.offset++];return L<128?L:202===L?yR(R,q):203===L?UR(R,q):204===L?RR(R,q):205===L?LR(R,q):206===L?NR(R,q):207===L?YR(R,q):208===L?u(R,q):209===L?qR(R,q):210===L?BR(R,q):211===L?zR(R,q):L>223?-1*(255-L+1):void 0}function dR(R,q){var L=R[q.offset];return L<128||L>=202&&L<=211}function fR(R,q){return R[q.offset]<160}function vR(R,q){return R[q.offset-1]===Z&&(R[q.offset]<128||R[q.offset]>=202&&R[q.offset]<=211)}var TR=Object.freeze({__proto__:null,int8:u,uint8:RR,int16:qR,uint16:LR,int32:BR,uint32:NR,float32:hR,float64:ZR,int64:zR,uint64:YR,readFloat32:yR,readFloat64:UR,boolean:nR,string:rR,stringCheck:pR,number:cR,numberCheck:dR,arrayCheck:fR,switchStructureCheck:vR}),tR=function(){function q(R){var q=this;this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return q.add(R)}))}return q.prototype.sd=function(q,L){return void 0===L&&(L=!0),F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,q,L?this.$items:void 0)},q.prototype.ab=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,q)},q.is=function(R){return void 0!==R.collection},q.prototype.add=function(R){var q=this.$refId++;return void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,q),this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,R),this.$changes.change(q),q},q.prototype.at=function(R){var q=Array.from(this.$items.keys())[R];return this.$items.get(q)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(R){for(var q,L,B=this.$items.entries();(L=B.next())&&!L.done;)if(R===L.value[1]){q=L.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&C.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(R){return Array.from(this.$items.values()).some((function(q){return q===R}))},q.prototype.forEach=function(R){var q=this;this.$items.forEach((function(L,B,N){return R(L,B,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(R,q){this.$indexes.set(R,q)},q.prototype.getIndex=function(R){return this.$indexes.get(R)},q.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},q.prototype.deleteByIndex=function(R){var q=this.$indexes.get(R);this.$items.delete(q),this.$indexes.delete(R)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var R=[];return this.forEach((function(q,L){R.push("function"===typeof q.toJSON?q.toJSON():q)})),R},q.prototype.clone=function(R){var L;return R?L=Object.assign(new q,this):(L=new q,this.forEach((function(R){R.$changes?L.add(R.clone()):L.add(R)}))),L},q}(),DR=function(){function q(R){var q=this;this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return q.add(R)}))}return q.prototype.sd=function(q,L){return void 0===L&&(L=!0),F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,q,L?this.$items:void 0)},q.prototype.ab=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,q)},q.is=function(R){return void 0!==R.set},q.prototype.add=function(q){var L,B;if(this.has(q))return!1;var N=this.$refId++;void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,N);var h=null!==(B=null===(L=this.$changes.indexes[N])||void 0===L?void 0:L.op)&&void 0!==B?B:R.OPERATION.ADD;return this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,q),this.$changes.change(N,h),N},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(R){for(var q,L,B=this.$items.entries();(L=B.next())&&!L.done;)if(R===L.value[1]){q=L.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&C.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(R){for(var q,L=this.$items.values(),B=!1;(q=L.next())&&!q.done;)if(R===q.value){B=!0;break}return B},q.prototype.forEach=function(R){var q=this;this.$items.forEach((function(L,B,N){return R(L,B,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(R,q){this.$indexes.set(R,q)},q.prototype.getIndex=function(R){return this.$indexes.get(R)},q.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},q.prototype.deleteByIndex=function(R){var q=this.$indexes.get(R);this.$items.delete(q),this.$indexes.delete(R)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var R=[];return this.forEach((function(q,L){R.push("function"===typeof q.toJSON?q.toJSON():q)})),R},q.prototype.clone=function(R){var L;return R?L=Object.assign(new q,this):(L=new q,this.forEach((function(R){R.$changes?L.add(R.clone()):L.add(R)}))),L},q}(),SR=function(){function R(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return R.prototype.addRefId=function(R){this.refIds.has(R)||(this.refIds.add(R),this.containerIndexes.set(R,new Set))},R.get=function(q){return void 0===q.$filterState&&(q.$filterState=new R),q.$filterState},R}(),IR=function(){function R(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return R.prototype.getNextUniqueId=function(){return this.nextUniqueId++},R.prototype.addRef=function(R,q,L){void 0===L&&(L=!0),this.refs.set(R,q),L&&(this.refCounts[R]=(this.refCounts[R]||0)+1)},R.prototype.removeRef=function(R){this.refCounts[R]=this.refCounts[R]-1,this.deletedRefs.add(R)},R.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},R.prototype.garbageCollectDeletedRefs=function(){var R=this;this.deletedRefs.forEach((function(q){if(!(R.refCounts[q]>0)){var L=R.refs.get(q);if(L instanceof WR)for(var B in L._definition.schema)"string"!==typeof L._definition.schema[B]&&L[B]&&L[B].$changes&&R.removeRef(L[B].$changes.refId);else{var N=L.$changes.parent._definition,h=N.schema[N.fieldsByIndex[L.$changes.parentIndex]];"function"===typeof Object.values(h)[0]&&Array.from(L.values()).forEach((function(q){return R.removeRef(q.$changes.refId)}))}R.refs.delete(q),delete R.refCounts[q]}})),this.deletedRefs.clear()},R}(),KR=function(R){function q(){return null!==R&&R.apply(this,arguments)||this}return L(q,R),q}(Error);function mR(R,q,L,B){var N,h=!1;switch(q){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":N="number",isNaN(R)&&console.log('trying to encode "NaN" in '.concat(L.constructor.name,"#").concat(B));break;case"string":N="string",h=!0;break;case"boolean":return}if(typeof R!==N&&(!h||h&&null!==R)){var Z="'".concat(JSON.stringify(R),"'").concat(R&&R.constructor&&" (".concat(R.constructor.name,")")||"");throw new KR("a '".concat(N,"' was expected, but ").concat(Z," was provided in ").concat(L.constructor.name,"#").concat(B))}}function oR(R,q,L,B){if(!(R instanceof q))throw new KR("a '".concat(q.name,"' was expected, but '").concat(R.constructor.name,"' was provided in ").concat(L.constructor.name,"#").concat(B))}function lR(R,q,L,B,N){mR(L,R,B,N);var h=b[R];if(!h)throw new KR("a '".concat(R,"' was expected, but ").concat(L," was provided in ").concat(B.constructor.name,"#").concat(N));h(q,L)}function GR(R,q,L){return TR[R](q,L)}var WR=function(){function q(){for(var R=[],q=0;q<arguments.length;q++)R[q]=arguments[q];Object.defineProperties(this,{$changes:{value:new Y(this,void 0,new IR),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var L=this._definition.descriptors;L&&Object.defineProperties(this,L),R[0]&&this.assign(R[0])}return q.onError=function(R){console.error(R)},q.is=function(R){return R._definition&&void 0!==R._definition.schema},q.prototype.onChange=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,q)},q.prototype.ab=function(q){return F(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,q)},q.prototype.assign=function(R){return Object.assign(this,R),this},Object.defineProperty(q.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),q.prototype.setDirty=function(R,q){this.$changes.change(R,q)},q.prototype.listen=function(R,q,L){var B=this;return void 0===L&&(L=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[R]||(this.$callbacks[R]=[]),this.$callbacks[R].push(q),L&&void 0!==this[R]&&q(this[R],void 0),function(){return e(B.$callbacks[R],B.$callbacks[R].indexOf(q))}},q.prototype.decode=function(L,B,N){var h;void 0===B&&(B={offset:0}),void 0===N&&(N=this);var z=[],Y=this.$changes.root,F=L.length,C=0;for(Y.refs.set(C,this);B.offset<F;){var e=L[B.offset++];if(e!=Z){var y=N.$changes,U=void 0!==N._definition,r=U?e>>6<<6:e;if(r!==R.OPERATION.CLEAR){var c=U?e%(r||255):cR(L,B),d=U?N._definition.fieldsByIndex[c]:"",v=y.getType(c),T=void 0,t=void 0,D=void 0;if(U?t=N["_".concat(d)]:(t=N.getByIndex(c),(r&R.OPERATION.ADD)===R.OPERATION.ADD?(D=N instanceof p?rR(L,B):c,N.setIndex(c,D)):D=N.getIndex(c)),(r&R.OPERATION.DELETE)===R.OPERATION.DELETE&&(r!==R.OPERATION.DELETE_AND_ADD&&N.deleteByIndex(c),t&&t.$changes&&Y.removeRef(t.$changes.refId),T=null),void 0!==d){if(r===R.OPERATION.DELETE);else if(q.is(v)){var S=cR(L,B);if(T=Y.refs.get(S),r!==R.OPERATION.REPLACE){var I=this.getSchemaType(L,B,v);T||((T=this.createTypeInstance(I)).$changes.refId=S,t&&(T.$callbacks=t.$callbacks,t.$changes.refId&&S!==t.$changes.refId&&Y.removeRef(t.$changes.refId))),Y.addRef(S,T,T!==t)}}else if("string"===typeof v)T=GR(v,L,B);else{var K=f(Object.keys(v)[0]),m=cR(L,B),o=Y.refs.has(m)?t||Y.refs.get(m):new K.constructor;if((T=o.clone(!0)).$changes.refId=m,t&&(T.$callbacks=t.$callbacks,t.$changes.refId&&m!==t.$changes.refId)){Y.removeRef(t.$changes.refId);for(var l=t.entries(),G=void 0;(G=l.next())&&!G.done;){var W=(h=G.value)[0],H=h[1];z.push({refId:m,op:R.OPERATION.DELETE,field:W,value:void 0,previousValue:H})}}Y.addRef(m,T,o!==t)}if(null!==T&&void 0!==T)if(T.$changes&&T.$changes.setParent(y.ref,y.root,c),N instanceof q)N[d]=T;else if(N instanceof p)W=D,N.$items.set(W,T),N.$changes.allChanges.add(c);else if(N instanceof n)N.setAt(c,T);else if(N instanceof tR){var P=N.add(T);N.setIndex(c,P)}else N instanceof DR&&!1!==(P=N.add(T))&&N.setIndex(c,P);t!==T&&z.push({refId:C,op:r,field:d,dynamicIndex:D,value:T,previousValue:t})}else{console.warn("@colyseus/schema: definition mismatch");for(var O={offset:B.offset};B.offset<F&&(!vR(L,B)||(O.offset=B.offset+1,!Y.refs.has(cR(L,O))));)B.offset++}}else N.clear(z)}else{C=cR(L,B);var E=Y.refs.get(C);if(!E)throw new Error('"refId" not found: '.concat(C));N=E}}return this._triggerChanges(z),Y.garbageCollectDeletedRefs(),z},q.prototype.encode=function(L,B,N){void 0===L&&(L=!1),void 0===B&&(B=[]),void 0===N&&(N=!1);for(var h=this.$changes,z=new WeakSet,Y=[h],F=1,C=0;C<F;C++){var e=Y[C],y=e.ref,U=y instanceof q;e.ensureRefId(),z.add(e),e!==h&&(e.changed||L)&&(H(B,Z),M(B,e.refId));for(var n=L?Array.from(e.allChanges):Array.from(e.changes.values()),r=0,c=n.length;r<c;r++){var d=L?{op:R.OPERATION.ADD,index:n[r]}:n[r],v=d.index,T=U?y._definition.fieldsByIndex&&y._definition.fieldsByIndex[v]:v,t=B.length;if(d.op!==R.OPERATION.TOUCH)if(U)H(B,v|d.op);else{if(H(B,d.op),d.op===R.OPERATION.CLEAR)continue;M(B,v)}if(U||(d.op&R.OPERATION.ADD)!=R.OPERATION.ADD||y instanceof p&&A(B,e.ref.$indexes.get(v)),d.op!==R.OPERATION.DELETE){var D=e.getType(v),S=e.getValue(v);if(S&&S.$changes&&!z.has(S.$changes)&&(Y.push(S.$changes),S.$changes.ensureRefId(),F++),d.op!==R.OPERATION.TOUCH){if(q.is(D))oR(S,D,y,T),M(B,S.$changes.refId),(d.op&R.OPERATION.ADD)===R.OPERATION.ADD&&this.tryEncodeTypeId(B,D,S.constructor);else if("string"===typeof D)lR(D,B,S,y,T);else{var I=f(Object.keys(D)[0]);oR(y["_".concat(T)],I.constructor,y,T),M(B,S.$changes.refId)}N&&e.cache(v,B.slice(t))}}}L||N||e.discard()}return B},q.prototype.encodeAll=function(R){return this.encode(!0,[],R)},q.prototype.applyFilters=function(L,B){var N,h;void 0===B&&(B=!1);for(var z=this,Y=new Set,F=SR.get(L),C=[this.$changes],e=1,y=[],U=function(U){var n=C[U];if(Y.has(n.refId))return"continue";var r=n.ref,c=r instanceof q;H(y,Z),M(y,n.refId);var d=F.refIds.has(n),f=B||!d;F.addRefId(n);var v=F.containerIndexes.get(n),T=f?Array.from(n.allChanges):Array.from(n.changes.values());!B&&c&&r._definition.indexesWithFilters&&r._definition.indexesWithFilters.forEach((function(q){!v.has(q)&&n.allChanges.has(q)&&(f?T.push(q):T.push({op:R.OPERATION.ADD,index:q}))}));for(var t=0,D=T.length;t<D;t++){var S=f?{op:R.OPERATION.ADD,index:T[t]}:T[t];if(S.op!==R.OPERATION.CLEAR){var I=S.index;if(S.op!==R.OPERATION.DELETE){var K=n.getValue(I),m=n.getType(I);if(c){if((o=r._definition.filters&&r._definition.filters[I])&&!o.call(r,L,K,z)){K&&K.$changes&&Y.add(K.$changes.refId);continue}}else{var o,l=n.parent;if((o=n.getChildrenFilter())&&!o.call(l,L,r.$indexes.get(I),K,z)){K&&K.$changes&&Y.add(K.$changes.refId);continue}}if(K.$changes&&(C.push(K.$changes),e++),S.op!==R.OPERATION.TOUCH)if(S.op===R.OPERATION.ADD||c)y.push.apply(y,null!==(N=n.caches[I])&&void 0!==N?N:[]),v.add(I);else if(v.has(I))y.push.apply(y,null!==(h=n.caches[I])&&void 0!==h?h:[]);else{if(v.add(I),H(y,R.OPERATION.ADD),M(y,I),r instanceof p){var G=n.ref.$indexes.get(I);A(y,G)}K.$changes?M(y,K.$changes.refId):b[m](y,K)}else K.$changes&&!c&&(H(y,R.OPERATION.ADD),M(y,I),r instanceof p&&(G=n.ref.$indexes.get(I),A(y,G)),M(y,K.$changes.refId))}else c?H(y,S.op|I):(H(y,S.op),M(y,I))}else H(y,S.op)}},n=0;n<e;n++)U(n);return y},q.prototype.clone=function(){var R,q=new this.constructor,L=this._definition.schema;for(var B in L)"object"===typeof this[B]&&"function"===typeof(null===(R=this[B])||void 0===R?void 0:R.clone)?q[B]=this[B].clone():q[B]=this[B];return q},q.prototype.toJSON=function(){var R=this._definition.schema,q=this._definition.deprecated,L={};for(var B in R)q[B]||null===this[B]||"undefined"===typeof this[B]||(L[B]="function"===typeof this[B].toJSON?this[B].toJSON():this["_".concat(B)]);return L},q.prototype.discardAllChanges=function(){this.$changes.discardAll()},q.prototype.getByIndex=function(R){return this[this._definition.fieldsByIndex[R]]},q.prototype.deleteByIndex=function(R){this[this._definition.fieldsByIndex[R]]=void 0},q.prototype.tryEncodeTypeId=function(R,q,L){q._typeid!==L._typeid&&(H(R,z),M(R,L._typeid))},q.prototype.getSchemaType=function(R,q,L){var B;return R[q.offset]===z&&(q.offset++,B=this.constructor._context.get(cR(R,q))),B||L},q.prototype.createTypeInstance=function(R){var q=new R;return q.$changes.root=this.$changes.root,q},q.prototype._triggerChanges=function(L){for(var B,N,h,Z,z,Y,F,C,e,y=new Set,U=this.$changes.root.refs,n=function(n){var r=L[n],p=r.refId,c=U.get(p),d=c.$callbacks;if((r.op&R.OPERATION.DELETE)===R.OPERATION.DELETE&&r.previousValue instanceof q&&(null===(N=null===(B=r.previousValue.$callbacks)||void 0===B?void 0:B[R.OPERATION.DELETE])||void 0===N||N.forEach((function(R){return R()}))),!d)return"continue";if(c instanceof q){if(!y.has(p))try{null===(h=null===d||void 0===d?void 0:d[R.OPERATION.REPLACE])||void 0===h||h.forEach((function(R){return R()}))}catch(f){q.onError(f)}try{d.hasOwnProperty(r.field)&&(null===(Z=d[r.field])||void 0===Z||Z.forEach((function(R){return R(r.value,r.previousValue)})))}catch(f){q.onError(f)}}else r.op===R.OPERATION.ADD&&void 0===r.previousValue?null===(z=d[R.OPERATION.ADD])||void 0===z||z.forEach((function(R){var q;return R(r.value,null!==(q=r.dynamicIndex)&&void 0!==q?q:r.field)})):r.op===R.OPERATION.DELETE?void 0!==r.previousValue&&(null===(Y=d[R.OPERATION.DELETE])||void 0===Y||Y.forEach((function(R){var q;return R(r.previousValue,null!==(q=r.dynamicIndex)&&void 0!==q?q:r.field)}))):r.op===R.OPERATION.DELETE_AND_ADD&&(void 0!==r.previousValue&&(null===(F=d[R.OPERATION.DELETE])||void 0===F||F.forEach((function(R){var q;return R(r.previousValue,null!==(q=r.dynamicIndex)&&void 0!==q?q:r.field)}))),null===(C=d[R.OPERATION.ADD])||void 0===C||C.forEach((function(R){var q;return R(r.value,null!==(q=r.dynamicIndex)&&void 0!==q?q:r.field)}))),r.value!==r.previousValue&&(null===(e=d[R.OPERATION.REPLACE])||void 0===e||e.forEach((function(R){var q;return R(r.value,null!==(q=r.dynamicIndex)&&void 0!==q?q:r.field)})));y.add(p)},r=0;r<L.length;r++)n(r)},q._definition=v.create(),q}();function HR(R){for(var q=[R.$changes],L=1,B={},N=B,h=function(R){var L=q[R];L.changes.forEach((function(R){var q=L.ref,B=R.index,h=q._definition?q._definition.fieldsByIndex[B]:q.$indexes.get(B);N[h]=L.getValue(B)}))},Z=0;Z<L;Z++)h(Z);return B}var PR={context:new t},OR=function(R){function q(){return null!==R&&R.apply(this,arguments)||this}return L(q,R),B([S("string",PR)],q.prototype,"name",void 0),B([S("string",PR)],q.prototype,"type",void 0),B([S("number",PR)],q.prototype,"referencedType",void 0),q}(WR),ER=function(R){function q(){var q=null!==R&&R.apply(this,arguments)||this;return q.fields=new n,q}return L(q,R),B([S("number",PR)],q.prototype,"id",void 0),B([S([OR],PR)],q.prototype,"fields",void 0),q}(WR),aR=function(R){function q(){var q=null!==R&&R.apply(this,arguments)||this;return q.types=new n,q}return L(q,R),q.encode=function(R){var L=R.constructor,B=new q;B.rootType=L._typeid;var N=function(R,q){for(var L in q){var N=new OR;N.name=L;var h=void 0;if("string"===typeof q[L])h=q[L];else{var Z=q[L],z=void 0;WR.is(Z)?(h="ref",z=q[L]):"string"===typeof Z[h=Object.keys(Z)[0]]?h+=":"+Z[h]:z=Z[h],N.referencedType=z?z._typeid:-1}N.type=h,R.fields.push(N)}B.types.push(R)},h=L._context.types;for(var Z in h){var z=new ER;z.id=Number(Z),N(z,h[Z]._definition.schema)}return B.encodeAll()},q.decode=function(R,B){var N=new t,h=new q;h.decode(R,B);var Z=h.types.reduce((function(R,q){var B=function(R){function q(){return null!==R&&R.apply(this,arguments)||this}return L(q,R),q}(WR),h=q.id;return R[h]=B,N.add(B,h),R}),{});h.types.forEach((function(R){var q=Z[R.id];R.fields.forEach((function(R){var L;if(void 0!==R.referencedType){var B=R.type,h=Z[R.referencedType];if(!h){var z=R.type.split(":");B=z[0],h=z[1]}"ref"===B?S(h,{context:N})(q.prototype,R.name):S(((L={})[B]=h,L),{context:N})(q.prototype,R.name)}else S(R.type,{context:N})(q.prototype,R.name)}))}));var z=Z[h.rootType],Y=new z;for(var F in z._definition.schema){var C=z._definition.schema[F];"string"!==typeof C&&(Y[F]="function"===typeof C?new C:new(f(Object.keys(C)[0]).constructor))}return Y},B([S([ER],PR)],q.prototype,"types",void 0),B([S("number",PR)],q.prototype,"rootType",void 0),q}(WR);d("map",{constructor:p}),d("array",{constructor:n}),d("set",{constructor:DR}),d("collection",{constructor:tR}),R.ArraySchema=n,R.CollectionSchema=tR,R.Context=t,R.MapSchema=p,R.Reflection=aR,R.ReflectionField=OR,R.ReflectionType=ER,R.Schema=WR,R.SchemaDefinition=v,R.SetSchema=DR,R.decode=TR,R.defineTypes=o,R.deprecated=m,R.dumpChanges=HR,R.encode=b,R.filter=I,R.filterChildren=K,R.hasFilter=T,R.registerType=d,R.type=S,Object.defineProperty(R,"__esModule",{value:!0})}(q)},12281:R=>{R.exports=function(R){return null!=R&&null!=R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}},12262:(R,q,L)=>{"use strict";var B=L(12265),N=L(12274),h=L(12281);L.g.__TYPEDARRAY_POOL||(L.g.__TYPEDARRAY_POOL={UINT8:N([32,0]),UINT16:N([32,0]),UINT32:N([32,0]),INT8:N([32,0]),INT16:N([32,0]),INT32:N([32,0]),FLOAT:N([32,0]),DOUBLE:N([32,0]),DATA:N([32,0]),UINT8C:N([32,0]),BUFFER:N([32,0])});var Z="undefined"!==typeof Uint8ClampedArray,z=L.g.__TYPEDARRAY_POOL;z.UINT8C||(z.UINT8C=N([32,0])),z.BUFFER||(z.BUFFER=N([32,0]));var Y=z.DATA,F=z.BUFFER;function C(R){if(R){var q=R.length||R.byteLength,L=B.log2(q);Y[L].push(R)}}function e(R){R=B.nextPow2(R);var q=B.log2(R),L=Y[q];return L.length>0?L.pop():new ArrayBuffer(R)}function y(R){return new Uint8Array(e(R),0,R)}function U(R){return new Uint16Array(e(2*R),0,R)}function n(R){return new Uint32Array(e(4*R),0,R)}function r(R){return new Int8Array(e(R),0,R)}function p(R){return new Int16Array(e(2*R),0,R)}function c(R){return new Int32Array(e(4*R),0,R)}function d(R){return new Float32Array(e(4*R),0,R)}function f(R){return new Float64Array(e(8*R),0,R)}function v(R){return Z?new Uint8ClampedArray(e(R),0,R):y(R)}function T(R){return new DataView(e(R),0,R)}q.free=function(R){if(h(R))F[B.log2(R.length)].push(R);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(R)&&(R=R.buffer),!R)return;var q=R.length||R.byteLength,L=0|B.log2(q);Y[L].push(R)}},q.freeUint8=q.freeUint16=q.freeUint32=q.freeInt8=q.freeInt16=q.freeInt32=q.freeFloat32=q.freeFloat=q.freeFloat64=q.freeDouble=q.freeUint8Clamped=q.freeDataView=function(R){C(R.buffer)},q.freeArrayBuffer=C,q.freeBuffer=function(R){F[B.log2(R.length)].push(R)},q.malloc=function(R,q){if(void 0===q||"arraybuffer"===q)return e(R);switch(q){case"uint8":return y(R);case"uint16":return U(R);case"uint32":return n(R);case"int8":return r(R);case"int16":return p(R);case"int32":return c(R);case"float":case"float32":return d(R);case"double":case"float64":return f(R);case"uint8_clamped":return v(R);case"buffer":throw"Buffer not supported";case"data":case"dataview":return T(R);default:return null}return null},q.mallocArrayBuffer=e,q.mallocUint8=y,q.mallocUint16=U,q.mallocUint32=n,q.mallocInt8=r,q.mallocInt16=p,q.mallocInt32=c,q.mallocFloat32=q.mallocFloat=d,q.mallocFloat64=q.mallocDouble=f,q.mallocUint8Clamped=v,q.mallocDataView=T,q.clearCache=function(){for(var R=0;R<32;++R)z.UINT8[R].length=0,z.UINT16[R].length=0,z.UINT32[R].length=0,z.INT8[R].length=0,z.INT16[R].length=0,z.INT32[R].length=0,z.FLOAT[R].length=0,z.DOUBLE[R].length=0,z.UINT8C[R].length=0,Y[R].length=0,F[R].length=0}},12349:(R,q,L)=>{R.exports=N;var B=L(122);function N(R,q){if(!(this instanceof N))return new N(R,q);var L=B.create();B.add(L,R,q),this.base=B.min(B.create(),R,L),this.Kg=B.clone(q),this.max=B.max(B.create(),R,L),this.mag=B.length(this.Kg)}var h=N.prototype;h.width=function(){return this.Kg[0]},h.height=function(){return this.Kg[1]},h.depth=function(){return this.Kg[2]},h.x0=function(){return this.base[0]},h.y0=function(){return this.base[1]},h.z0=function(){return this.base[2]},h.x1=function(){return this.max[0]},h.y1=function(){return this.max[1]},h.z1=function(){return this.max[2]},h.translate=function(R){return B.add(this.max,this.max,R),B.add(this.base,this.base,R),this},h.setPosition=function(R){return B.add(this.max,R,this.Kg),B.i(this.base,R),this},h.expand=function(R){var q=B.create(),L=B.create();return B.max(q,R.max,this.max),B.min(L,R.base,this.base),B.Bc(q,q,L),new N(L,q)},h.intersects=function(R){return!(R.base[0]>this.max[0])&&(!(R.base[1]>this.max[1])&&(!(R.base[2]>this.max[2])&&(!(R.max[0]<this.base[0])&&(!(R.max[1]<this.base[1])&&!(R.max[2]<this.base[2])))))},h.touches=function(R){var q=this.union(R);return null!==q&&(0==q.width()||0==q.height()||0==q.depth())},h.union=function(R){if(!this.intersects(R))return null;var q=Math.max(R.base[0],this.base[0]),L=Math.max(R.base[1],this.base[1]),B=Math.max(R.base[2],this.base[2]);return new N([q,L,B],[Math.min(R.max[0],this.max[0])-q,Math.min(R.max[1],this.max[1])-L,Math.min(R.max[2],this.max[2])-B])}},12265:(R,q)=>{"use strict";function L(R){var q=32;return(R&=-R)&&q--,65535&R&&(q-=16),16711935&R&&(q-=8),252645135&R&&(q-=4),858993459&R&&(q-=2),1431655765&R&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(R){return(R>0)-(R<0)},q.abs=function(R){var q=R>>31;return(R^q)-q},q.min=function(R,q){return q^(R^q)&-(R<q)},q.max=function(R,q){return R^(R^q)&-(R<q)},q.isPow2=function(R){return!(R&R-1)&&!!R},q.log2=function(R){var q,L;return q=(R>65535)<<4,q|=L=((R>>>=q)>255)<<3,q|=L=((R>>>=L)>15)<<2,(q|=L=((R>>>=L)>3)<<1)|(R>>>=L)>>1},q.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},q.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},q.countTrailingZeros=L,q.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},q.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},q.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var B=new Array(256);!function(R){for(var q=0;q<256;++q){var L=q,B=q,N=7;for(L>>>=1;L;L>>>=1)B<<=1,B|=1&L,--N;R[q]=B<<N&255}}(B),q.reverse=function(R){return B[255&R]<<24|B[R>>>8&255]<<16|B[R>>>16&255]<<8|B[R>>>24&255]},q.interleave2=function(R,q){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(R,q){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>q&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},q.interleave3=function(R,q,L){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},q.deinterleave3=function(R,q){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>q&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},q.nextCombination=function(R){var q=R|R-1;return q+1|(~q&-~q)-1>>>L(R)+1}},12256:(R,q,L)=>{"use strict";R.exports=function(R,q,L){switch(arguments.length){case 1:return B=[],F(N=R,N,C,!0),B;case 2:return"function"===typeof q?F(R,R,q,!0):function(R,q){return B=[],F(R,q,C,!1),B}(R,q);case 3:return F(R,q,L,!1);default:throw new Error("box-intersect: Invalid arguments")}var N};var B,N=L(12262),h=L(12285),Z=L(12295);function z(R,q){for(var L=0;L<R;++L)if(!(q[L]<=q[L+R]))return!0;return!1}function Y(R,q,L,B){for(var N=0,h=0,Z=0,Y=R.length;Z<Y;++Z){var F=R[Z];if(!z(q,F)){for(var C=0;C<2*q;++C)L[N++]=F[C];B[h++]=Z}}return h}function F(R,q,L,B){var z=R.length,F=q.length;if(!(z<=0||F<=0)){var C=R[0].length>>>1;if(!(C<=0)){var e,y=N.mallocDouble(2*C*z),U=N.mallocInt32(z);if((z=Y(R,C,y,U))>0){if(1===C&&B)h.init(z),e=h.sweepComplete(C,L,0,z,y,U,0,z,y,U);else{var n=N.mallocDouble(2*C*F),r=N.mallocInt32(F);(F=Y(q,C,n,r))>0&&(h.init(z+F),e=1===C?h.sweepBipartite(C,L,0,z,y,U,0,F,n,r):Z(C,L,B,z,y,U,F,n,r),N.free(n),N.free(r))}N.free(y),N.free(U)}return e}}}function C(R,q){B.push([R,q])}},12300:(R,q)=>{"use strict";var L="d",B="ax",N="fp",h="es",Z="rs",z="re",Y="rb",F="bs",C="be",e="bb",y=[L,B,"vv",Z,z,Y,"ri",F,C,e,"bi"];function U(R){var q="bruteForce"+(R?"Full":"Partial"),B=[],Z=y.slice();R||Z.splice(3,0,N);var z=["function "+q+"("+Z.join()+"){"];function Y(q,N){var Z=function(R,q,B){var N="bruteForce"+(R?"Red":"Blue")+(q?"Flip":"")+(B?"Full":""),Z=["function ",N,"(",y.join(),"){","var ",h,"=2*",L,";"],z="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",Y="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(B?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return R?Z.push(z,"Q",":",Y):Z.push(Y,"Q",":",z),B?Z.push("if(y1<x0||x1<y0)continue;"):q?Z.push("if(y0<=x0||x1<y0)continue;"):Z.push("if(y0<x0||x1<y0)continue;"),Z.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),q?Z.push("yi,xi"):Z.push("xi,yi"),Z.push(");if(rv!==void 0)return rv;}}}"),{name:N,code:Z.join("")}}(q,N,R);B.push(Z.code),z.push("return "+Z.name+"("+y.join()+");")}z.push("if(re-rs>be-bs){"),R?(Y(!0,!1),z.push("}else{"),Y(!1,!1)):(z.push("if(fp){"),Y(!0,!0),z.push("}else{"),Y(!0,!1),z.push("}}else{if(fp){"),Y(!1,!0),z.push("}else{"),Y(!1,!1),z.push("}")),z.push("}}return "+q);var F=B.join("")+z.join("");return new Function(F)()}q.partial=U(!1),q.full=U(!0)},12295:(R,q,L)=>{"use strict";R.exports=function(R,q,L,h,C,m,o,l,G){!function(R,q){var L=8*N.log2(q+1)*(R+1)|0,h=N.nextPow2(v*L);t.length<h&&(B.free(t),t=B.mallocInt32(h));var Z=N.nextPow2(T*L);D.length<Z&&(B.free(D),D=B.mallocDouble(Z))}(R,h+o);var W,H=0,P=2*R;S(H++,0,0,h,0,o,L?16:0,-1/0,1/0),L||S(H++,0,0,o,0,h,1,-1/0,1/0);for(;H>0;){var O=(H-=1)*v,E=t[O],a=t[O+1],g=t[O+2],Q=t[O+3],i=t[O+4],k=t[O+5],V=H*T,x=D[V],w=D[V+1],j=1&k,J=!!(16&k),s=C,A=m,M=l,b=G;if(j&&(s=l,A=G,M=C,b=m),!(2&k&&a>=(g=p(R,E,a,g,s,A,w)))&&!(4&k&&(a=c(R,E,a,g,s,A,x))>=g)){var X=g-a,u=i-Q;if(J){if(R*X*(X+u)<U){if(void 0!==(W=Y.scanComplete(R,E,q,a,g,s,A,Q,i,M,b)))return W;continue}}else{if(R*Math.min(X,u)<e){if(void 0!==(W=Z(R,E,q,j,a,g,s,A,Q,i,M,b)))return W;continue}if(R*X*u<y){if(void 0!==(W=Y.scanBipartite(R,E,q,j,a,g,s,A,Q,i,M,b)))return W;continue}}var RR=n(R,E,a,g,s,A,x,w);if(a<RR)if(R*(RR-a)<e){if(void 0!==(W=z(R,E+1,q,a,RR,s,A,Q,i,M,b)))return W}else if(E===R-2){if(void 0!==(W=j?Y.sweepBipartite(R,q,Q,i,M,b,a,RR,s,A):Y.sweepBipartite(R,q,a,RR,s,A,Q,i,M,b)))return W}else S(H++,E+1,a,RR,Q,i,j,-1/0,1/0),S(H++,E+1,Q,i,a,RR,1^j,-1/0,1/0);if(RR<g){var qR=F(R,E,Q,i,M,b),LR=M[P*qR+E],BR=r(R,E,qR,i,M,b,LR);if(BR<i&&S(H++,E,RR,g,BR,i,(4|j)+(J?16:0),LR,w),Q<qR&&S(H++,E,RR,g,Q,qR,(2|j)+(J?16:0),x,LR),qR+1===BR){if(void 0!==(W=J?K(R,E,q,RR,g,s,A,qR,M,b[qR]):I(R,E,q,j,RR,g,s,A,qR,M,b[qR])))return W}else if(qR<BR){var NR;if(J){if(RR<(NR=d(R,E,RR,g,s,A,LR))){var hR=r(R,E,RR,NR,s,A,LR);if(E===R-2){if(RR<hR&&void 0!==(W=Y.sweepComplete(R,q,RR,hR,s,A,qR,BR,M,b)))return W;if(hR<NR&&void 0!==(W=Y.sweepBipartite(R,q,hR,NR,s,A,qR,BR,M,b)))return W}else RR<hR&&S(H++,E+1,RR,hR,qR,BR,16,-1/0,1/0),hR<NR&&(S(H++,E+1,hR,NR,qR,BR,0,-1/0,1/0),S(H++,E+1,qR,BR,hR,NR,1,-1/0,1/0))}}else RR<(NR=j?f(R,E,RR,g,s,A,LR):d(R,E,RR,g,s,A,LR))&&(E===R-2?W=j?Y.sweepBipartite(R,q,qR,BR,M,b,RR,NR,s,A):Y.sweepBipartite(R,q,RR,NR,s,A,qR,BR,M,b):(S(H++,E+1,RR,NR,qR,BR,j,-1/0,1/0),S(H++,E+1,qR,BR,RR,NR,1^j,-1/0,1/0)))}}}}};var B=L(12262),N=L(12265),h=L(12300),Z=h.partial,z=h.full,Y=L(12285),F=L(12309),C=L(12313),e=128,y=1<<22,U=1<<22,n=C("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),r=C("lo===p0",["p0"]),p=C("lo<p0",["p0"]),c=C("hi<=p0",["p0"]),d=C("lo<=p0&&p0<=hi",["p0"]),f=C("lo<p0&&p0<=hi",["p0"]),v=6,T=2,t=B.mallocInt32(1024),D=B.mallocDouble(1024);function S(R,q,L,B,N,h,Z,z,Y){var F=v*R;t[F]=q,t[F+1]=L,t[F+2]=B,t[F+3]=N,t[F+4]=h,t[F+5]=Z;var C=T*R;D[C]=z,D[C+1]=Y}function I(R,q,L,B,N,h,Z,z,Y,F,C){var e=2*R,y=Y*e,U=F[y+q];R:for(var n=N,r=N*e;n<h;++n,r+=e){var p=Z[r+q],c=Z[r+q+R];if(!(U<p||c<U)&&(!B||U!==p)){for(var d,f=z[n],v=q+1;v<R;++v){p=Z[r+v],c=Z[r+v+R];var T=F[y+v],t=F[y+v+R];if(c<T||t<p)continue R}if(void 0!==(d=B?L(C,f):L(f,C)))return d}}}function K(R,q,L,B,N,h,Z,z,Y,F){var C=2*R,e=z*C,y=Y[e+q];R:for(var U=B,n=B*C;U<N;++U,n+=C){var r=Z[U];if(r!==F){var p=h[n+q],c=h[n+q+R];if(!(y<p||c<y)){for(var d=q+1;d<R;++d){p=h[n+d],c=h[n+d+R];var f=Y[e+d],v=Y[e+d+R];if(c<f||v<p)continue R}var T=L(r,F);if(void 0!==T)return T}}}}},12309:(R,q,L)=>{"use strict";R.exports=function(R,q,L,Z,z,Y){if(Z<=L+1)return L;var F=L,C=Z,e=Z+L>>>1,y=2*R,U=e,n=z[y*e+q];for(;F<C;){if(C-F<N){h(R,q,F,C,z,Y),n=z[y*e+q];break}var r=C-F,p=Math.random()*r+F|0,c=z[y*p+q],d=Math.random()*r+F|0,f=z[y*d+q],v=Math.random()*r+F|0,T=z[y*v+q];c<=f?T>=f?(U=d,n=f):c>=T?(U=p,n=c):(U=v,n=T):f>=T?(U=d,n=f):T>=c?(U=p,n=c):(U=v,n=T);for(var t=y*(C-1),D=y*U,S=0;S<y;++S,++t,++D){var I=z[t];z[t]=z[D],z[D]=I}var K=Y[C-1];Y[C-1]=Y[U],Y[U]=K;for(t=y*(C-1),D=y*(U=B(R,q,F,C-1,z,Y,n)),S=0;S<y;++S,++t,++D){I=z[t];z[t]=z[D],z[D]=I}K=Y[C-1];if(Y[C-1]=Y[U],Y[U]=K,e<U){for(C=U-1;F<C&&z[y*(C-1)+q]===n;)C-=1;C+=1}else{if(!(U<e))break;for(F=U+1;F<C&&z[y*F+q]===n;)F+=1}}return B(R,q,L,e,z,Y,z[y*e+q])};var B=L(12313)("lo<p0",["p0"]),N=8;function h(R,q,L,B,N,h){for(var Z=2*R,z=Z*(L+1)+q,Y=L+1;Y<B;++Y,z+=Z)for(var F=N[z],C=Y,e=Z*(Y-1);C>L&&N[e+q]>F;--C,e-=Z){for(var y=e,U=e+Z,n=0;n<Z;++n,++y,++U){var r=N[y];N[y]=N[U],N[U]=r}var p=h[C];h[C]=h[C-1],h[C-1]=p}}},12313:R=>{"use strict";R.exports=function(R,L){var B="abcdef".split("").concat(L),N=[];R.indexOf("lo")>=0&&N.push("lo=e[k+n]");R.indexOf("hi")>=0&&N.push("hi=e[k+o]");return B.push(q.replace("_",N.join()).replace("$",R)),Function.apply(void 0,B)};var q="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12293:R=>{"use strict";R.exports=function(R,B){B<=4*q?L(0,B-1,R):F(0,B-1,R)};var q=32;function L(R,q,L){for(var B=2*(R+1),N=R+1;N<=q;++N){for(var h=L[B++],Z=L[B++],z=N,Y=B-2;z-- >R;){var F=L[Y-2],C=L[Y-1];if(F<h)break;if(F===h&&C<Z)break;L[Y]=F,L[Y+1]=C,Y-=2}L[Y]=h,L[Y+1]=Z}}function B(R,q,L){q*=2;var B=L[R*=2],N=L[R+1];L[R]=L[q],L[R+1]=L[q+1],L[q]=B,L[q+1]=N}function N(R,q,L){q*=2,L[R*=2]=L[q],L[R+1]=L[q+1]}function h(R,q,L,B){q*=2,L*=2;var N=B[R*=2],h=B[R+1];B[R]=B[q],B[R+1]=B[q+1],B[q]=B[L],B[q+1]=B[L+1],B[L]=N,B[L+1]=h}function Z(R,q,L,B,N){q*=2,N[R*=2]=N[q],N[q]=L,N[R+1]=N[q+1],N[q+1]=B}function z(R,q,L){q*=2;var B=L[R*=2],N=L[q];return!(B<N)&&(B!==N||L[R+1]>L[q+1])}function Y(R,q,L,B){var N=B[R*=2];return N<q||N===q&&B[R+1]<L}function F(R,C,e){var y=(C-R+1)/6|0,U=R+y,n=C-y,r=R+C>>1,p=r-y,c=r+y,d=U,f=p,v=r,T=c,t=n,D=R+1,S=C-1,I=0;z(d,f,e)&&(I=d,d=f,f=I),z(T,t,e)&&(I=T,T=t,t=I),z(d,v,e)&&(I=d,d=v,v=I),z(f,v,e)&&(I=f,f=v,v=I),z(d,T,e)&&(I=d,d=T,T=I),z(v,T,e)&&(I=v,v=T,T=I),z(f,t,e)&&(I=f,f=t,t=I),z(f,v,e)&&(I=f,f=v,v=I),z(T,t,e)&&(I=T,T=t,t=I);for(var K=e[2*f],m=e[2*f+1],o=e[2*T],l=e[2*T+1],G=2*d,W=2*v,H=2*t,P=2*U,O=2*r,E=2*n,a=0;a<2;++a){var g=e[G+a],Q=e[W+a],i=e[H+a];e[P+a]=g,e[O+a]=Q,e[E+a]=i}N(p,R,e),N(c,C,e);for(var k=D;k<=S;++k)if(Y(k,K,m,e))k!==D&&B(k,D,e),++D;else if(!Y(k,o,l,e))for(;;){if(Y(S,o,l,e)){Y(S,K,m,e)?(h(k,D,S,e),++D,--S):(B(k,S,e),--S);break}if(--S<k)break}Z(R,D-1,K,m,e),Z(C,S+1,o,l,e),D-2-R<=q?L(R,D-2,e):F(R,D-2,e),C-(S+2)<=q?L(S+2,C,e):F(S+2,C,e),S-D<=q?L(D,S,e):F(D,S,e)}},12285:(R,q,L)=>{"use strict";R.exports={init:function(R){var q=N.nextPow2(R);Y.length<q&&(B.free(Y),Y=B.mallocInt32(q));F.length<q&&(B.free(F),F=B.mallocInt32(q));C.length<q&&(B.free(C),C=B.mallocInt32(q));e.length<q&&(B.free(e),e=B.mallocInt32(q));y.length<q&&(B.free(y),y=B.mallocInt32(q));U.length<q&&(B.free(U),U=B.mallocInt32(q));var L=8*q;n.length<L&&(B.free(n),n=B.mallocDouble(L))},sweepBipartite:function(R,q,L,B,N,z,y,U,c,d){for(var f=0,v=2*R,T=R-1,t=v-1,D=L;D<B;++D){var S=z[D],I=v*D;n[f++]=N[I+T],n[f++]=-(S+1),n[f++]=N[I+t],n[f++]=S}for(D=y;D<U;++D){S=d[D]+Z;var K=v*D;n[f++]=c[K+T],n[f++]=-S,n[f++]=c[K+t],n[f++]=S}var m=f>>>1;h(n,m);var o=0,l=0;for(D=0;D<m;++D){var G=0|n[2*D+1];if(G>=Z)r(C,e,l--,G=G-Z|0);else if(G>=0)r(Y,F,o--,G);else if(G<=-Z){G=-G-Z|0;for(var W=0;W<o;++W){if(void 0!==(H=q(Y[W],G)))return H}p(C,e,l++,G)}else{G=-G-1|0;for(W=0;W<l;++W){var H;if(void 0!==(H=q(G,C[W])))return H}p(Y,F,o++,G)}}},sweepComplete:function(R,q,L,B,N,Z,z,c,d,f){for(var v=0,T=2*R,t=R-1,D=T-1,S=L;S<B;++S){var I=Z[S]+1<<1,K=T*S;n[v++]=N[K+t],n[v++]=-I,n[v++]=N[K+D],n[v++]=I}for(S=z;S<c;++S){I=f[S]+1<<1;var m=T*S;n[v++]=d[m+t],n[v++]=1|-I,n[v++]=d[m+D],n[v++]=1|I}var o=v>>>1;h(n,o);var l=0,G=0,W=0;for(S=0;S<o;++S){var H=0|n[2*S+1],P=1&H;if(S<o-1&&H>>1===n[2*S+3]>>1&&(P=2,S+=1),H<0){for(var O=-(H>>1)-1,E=0;E<W;++E){if(void 0!==(a=q(y[E],O)))return a}if(0!==P)for(E=0;E<l;++E){if(void 0!==(a=q(Y[E],O)))return a}if(1!==P)for(E=0;E<G;++E){var a;if(void 0!==(a=q(C[E],O)))return a}0===P?p(Y,F,l++,O):1===P?p(C,e,G++,O):2===P&&p(y,U,W++,O)}else{O=(H>>1)-1;0===P?r(Y,F,l--,O):1===P?r(C,e,G--,O):2===P&&r(y,U,W--,O)}}},scanBipartite:function(R,q,L,B,N,z,C,e,y,U,c,d){var f=0,v=2*R,T=q,t=q+R,D=1,S=1;B?S=Z:D=Z;for(var I=N;I<z;++I){var K=I+D,m=v*I;n[f++]=C[m+T],n[f++]=-K,n[f++]=C[m+t],n[f++]=K}for(I=y;I<U;++I){K=I+S;var o=v*I;n[f++]=c[o+T],n[f++]=-K}var l=f>>>1;h(n,l);var G=0;for(I=0;I<l;++I){var W=0|n[2*I+1];if(W<0){var H=!1;if((K=-W)>=Z?(H=!B,K-=Z):(H=!!B,K-=1),H)p(Y,F,G++,K);else{var P=d[K],O=v*K,E=c[O+q+1],a=c[O+q+1+R];R:for(var g=0;g<G;++g){var Q=Y[g],i=v*Q;if(!(a<C[i+q+1]||C[i+q+1+R]<E)){for(var k=q+2;k<R;++k)if(c[O+k+R]<C[i+k]||C[i+k+R]<c[O+k])continue R;var V,x=e[Q];if(void 0!==(V=B?L(P,x):L(x,P)))return V}}}}else r(Y,F,G--,W-D)}},scanComplete:function(R,q,L,B,N,z,F,C,e,y,U){for(var r=0,p=2*R,c=q,d=q+R,f=B;f<N;++f){var v=f+Z,T=p*f;n[r++]=z[T+c],n[r++]=-v,n[r++]=z[T+d],n[r++]=v}for(f=C;f<e;++f){v=f+1;var t=p*f;n[r++]=y[t+c],n[r++]=-v}var D=r>>>1;h(n,D);var S=0;for(f=0;f<D;++f){var I=0|n[2*f+1];if(I<0){if((v=-I)>=Z)Y[S++]=v-Z;else{var K=U[v-=1],m=p*v,o=y[m+q+1],l=y[m+q+1+R];R:for(var G=0;G<S;++G){var W=Y[G],H=F[W];if(H===K)break;var P=p*W;if(!(l<z[P+q+1]||z[P+q+1+R]<o)){for(var O=q+2;O<R;++O)if(y[m+O+R]<z[P+O]||z[P+O+R]<y[m+O])continue R;var E=L(H,K);if(void 0!==E)return E}}}}else{for(v=I-Z,G=S-1;G>=0;--G)if(Y[G]===v){for(O=G+1;O<S;++O)Y[O-1]=Y[O];break}--S}}}};var B=L(12262),N=L(12265),h=L(12293),Z=1<<28,z=1024,Y=B.mallocInt32(z),F=B.mallocInt32(z),C=B.mallocInt32(z),e=B.mallocInt32(z),y=B.mallocInt32(z),U=B.mallocInt32(z),n=B.mallocDouble(8192);function r(R,q,L,B){var N=q[B],h=R[L-1];R[N]=h,q[h]=N}function p(R,q,L,B){R[L]=B,q[B]=L}},12397:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12392:(R,q,L)=>{var B=L(12397),N=L(12404),h=Object.hasOwnProperty,Z=Object.create(null);for(var z in B)h.call(B,z)&&(Z[B[z]]=z);var Y=R.exports={to:{},get:{}};function F(R,q,L){return Math.min(Math.max(q,R),L)}function C(R){var q=Math.round(R).toString(16).toUpperCase();return q.length<2?"0"+q:q}Y.get=function(R){var q,L;switch(R.substring(0,3).toLowerCase()){case"hsl":q=Y.get.hsl(R),L="hsl";break;case"hwb":q=Y.get.hwb(R),L="hwb";break;default:q=Y.get.rgb(R),L="rgb"}return q?{model:L,value:q}:null},Y.get.rgb=function(R){if(!R)return null;var q,L,N,Z=[0,0,0,1];if(q=R.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(N=q[2],q=q[1],L=0;L<3;L++){var z=2*L;Z[L]=parseInt(q.slice(z,z+2),16)}N&&(Z[3]=parseInt(N,16)/255)}else if(q=R.match(/^#([a-f0-9]{3,4})$/i)){for(N=(q=q[1])[3],L=0;L<3;L++)Z[L]=parseInt(q[L]+q[L],16);N&&(Z[3]=parseInt(N+N,16)/255)}else if(q=R.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(L=0;L<3;L++)Z[L]=parseInt(q[L+1],0);q[4]&&(q[5]?Z[3]=.01*parseFloat(q[4]):Z[3]=parseFloat(q[4]))}else{if(!(q=R.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(q=R.match(/^(\w+)$/))?"transparent"===q[1]?[0,0,0,0]:h.call(B,q[1])?((Z=B[q[1]])[3]=1,Z):null:null;for(L=0;L<3;L++)Z[L]=Math.round(2.55*parseFloat(q[L+1]));q[4]&&(q[5]?Z[3]=.01*parseFloat(q[4]):Z[3]=parseFloat(q[4]))}for(L=0;L<3;L++)Z[L]=F(Z[L],0,255);return Z[3]=F(Z[3],0,1),Z},Y.get.hsl=function(R){if(!R)return null;var q=R.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var L=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,F(parseFloat(q[2]),0,100),F(parseFloat(q[3]),0,100),F(isNaN(L)?1:L,0,1)]}return null},Y.get.hwb=function(R){if(!R)return null;var q=R.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var L=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,F(parseFloat(q[2]),0,100),F(parseFloat(q[3]),0,100),F(isNaN(L)?1:L,0,1)]}return null},Y.to.hex=function(){var R=N(arguments);return"#"+C(R[0])+C(R[1])+C(R[2])+(R[3]<1?C(Math.round(255*R[3])):"")},Y.to.rgb=function(){var R=N(arguments);return R.length<4||1===R[3]?"rgb("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+")":"rgba("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+", "+R[3]+")"},Y.to.rgb.percent=function(){var R=N(arguments),q=Math.round(R[0]/255*100),L=Math.round(R[1]/255*100),B=Math.round(R[2]/255*100);return R.length<4||1===R[3]?"rgb("+q+"%, "+L+"%, "+B+"%)":"rgba("+q+"%, "+L+"%, "+B+"%, "+R[3]+")"},Y.to.hsl=function(){var R=N(arguments);return R.length<4||1===R[3]?"hsl("+R[0]+", "+R[1]+"%, "+R[2]+"%)":"hsla("+R[0]+", "+R[1]+"%, "+R[2]+"%, "+R[3]+")"},Y.to.hwb=function(){var R=N(arguments),q="";return R.length>=4&&1!==R[3]&&(q=", "+R[3]),"hwb("+R[0]+", "+R[1]+"%, "+R[2]+"%"+q+")"},Y.to.keyword=function(R){return Z[R.slice(0,3)]}},12383:(R,q,L)=>{const B=L(12392),N=L(12415),h=["keyword","gray","hex"],Z={};for(const U of Object.keys(N))Z[[...N[U].labels].sort().join("")]=U;const z={};function Y(R,q){if(!(this instanceof Y))return new Y(R,q);if(q&&q in h&&(q=null),q&&!(q in N))throw new Error("Unknown model: "+q);let L,F;if(null==R)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(R instanceof Y)this.model=R.model,this.color=[...R.color],this.valpha=R.valpha;else if("string"===typeof R){const q=B.get(R);if(null===q)throw new Error("Unable to parse color from string: "+R);this.model=q.model,F=N[this.model].channels,this.color=q.value.slice(0,F),this.valpha="number"===typeof q.value[F]?q.value[F]:1}else if(R.length>0){this.model=q||"rgb",F=N[this.model].channels;const L=Array.prototype.slice.call(R,0,F);this.color=y(L,F),this.valpha="number"===typeof R[F]?R[F]:1}else if("number"===typeof R)this.model="rgb",this.color=[R>>16&255,R>>8&255,255&R],this.valpha=1;else{this.valpha=1;const q=Object.keys(R);"alpha"in R&&(q.splice(q.indexOf("alpha"),1),this.valpha="number"===typeof R.alpha?R.alpha:0);const B=q.sort().join("");if(!(B in Z))throw new Error("Unable to parse color from object: "+JSON.stringify(R));this.model=Z[B];const{labels:h}=N[this.model],z=[];for(L=0;L<h.length;L++)z.push(R[h[L]]);this.color=y(z)}if(z[this.model])for(F=N[this.model].channels,L=0;L<F;L++){const R=z[this.model][L];R&&(this.color[L]=R(this.color[L]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Y.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(R){let q=this.model in B.to?this:this.rgb();q=q.round("number"===typeof R?R:1);const L=1===q.valpha?q.color:[...q.color,this.valpha];return B.to[q.model](L)},percentString(R){const q=this.rgb().round("number"===typeof R?R:1),L=1===q.valpha?q.color:[...q.color,this.valpha];return B.to.rgb.percent(L)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const R={},{channels:q}=N[this.model],{labels:L}=N[this.model];for(let B=0;B<q;B++)R[L[B]]=this.color[B];return 1!==this.valpha&&(R.alpha=this.valpha),R},unitArray(){const R=this.rgb().color;return R[0]/=255,R[1]/=255,R[2]/=255,1!==this.valpha&&R.push(this.valpha),R},unitObject(){const R=this.rgb().object();return R.r/=255,R.g/=255,R.b/=255,1!==this.valpha&&(R.alpha=this.valpha),R},round(R){return R=Math.max(R||0,0),new Y([...this.color.map(F(R)),this.valpha],this.model)},alpha(R){return void 0!==R?new Y([...this.color,Math.max(0,Math.min(1,R))],this.model):this.valpha},red:C("rgb",0,e(255)),green:C("rgb",1,e(255)),blue:C("rgb",2,e(255)),hue:C(["hsl","hsv","hsl","hwb","hcg"],0,(R=>(R%360+360)%360)),saturationl:C("hsl",1,e(100)),lightness:C("hsl",2,e(100)),saturationv:C("hsv",1,e(100)),value:C("hsv",2,e(100)),chroma:C("hcg",1,e(100)),gray:C("hcg",2,e(100)),white:C("hwb",1,e(100)),wblack:C("hwb",2,e(100)),cyan:C("cmyk",0,e(100)),magenta:C("cmyk",1,e(100)),yellow:C("cmyk",2,e(100)),black:C("cmyk",3,e(100)),x:C("xyz",0,e(95.047)),y:C("xyz",1,e(100)),z:C("xyz",2,e(108.833)),l:C("lab",0,e(100)),a:C("lab",1),b:C("lab",2),keyword(R){return void 0!==R?new Y(R):N[this.model].keyword(this.color)},hex(R){return void 0!==R?new Y(R):B.to.hex(this.rgb().round().color)},hexa(R){if(void 0!==R)return new Y(R);const q=this.rgb().round().color;let L=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===L.length&&(L="0"+L),B.to.hex(q)+L},rgbNumber(){const R=this.rgb().color;return(255&R[0])<<16|(255&R[1])<<8|255&R[2]},luminosity(){const R=this.rgb().color,q=[];for(const[L,B]of R.entries()){const R=B/255;q[L]=R<=.04045?R/12.92:((R+.055)/1.055)**2.4}return.2126*q[0]+.7152*q[1]+.0722*q[2]},contrast(R){const q=this.luminosity(),L=R.luminosity();return q>L?(q+.05)/(L+.05):(L+.05)/(q+.05)},level(R){const q=this.contrast(R);return q>=7?"AAA":q>=4.5?"AA":""},isDark(){const R=this.rgb().color;return(2126*R[0]+7152*R[1]+722*R[2])/1e4<128},isLight(){return!this.isDark()},negate(){const R=this.rgb();for(let q=0;q<3;q++)R.color[q]=255-R.color[q];return R},lighten(R){const q=this.hsl();return q.color[2]+=q.color[2]*R,q},darken(R){const q=this.hsl();return q.color[2]-=q.color[2]*R,q},saturate(R){const q=this.hsl();return q.color[1]+=q.color[1]*R,q},desaturate(R){const q=this.hsl();return q.color[1]-=q.color[1]*R,q},whiten(R){const q=this.hwb();return q.color[1]+=q.color[1]*R,q},blacken(R){const q=this.hwb();return q.color[2]+=q.color[2]*R,q},grayscale(){const R=this.rgb().color,q=.3*R[0]+.59*R[1]+.11*R[2];return Y.rgb(q,q,q)},fade(R){return this.alpha(this.valpha-this.valpha*R)},opaquer(R){return this.alpha(this.valpha+this.valpha*R)},rotate(R){const q=this.hsl();let L=q.color[0];return L=(L+R)%360,L=L<0?360+L:L,q.color[0]=L,q},mix(R,q){if(!R||!R.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof R);const L=R.rgb(),B=this.rgb(),N=void 0===q?.5:q,h=2*N-1,Z=L.alpha()-B.alpha(),z=((h*Z===-1?h:(h+Z)/(1+h*Z))+1)/2,F=1-z;return Y.rgb(z*L.red()+F*B.red(),z*L.green()+F*B.green(),z*L.blue()+F*B.blue(),L.alpha()*N+B.alpha()*(1-N))}};for(const U of Object.keys(N)){if(h.includes(U))continue;const{channels:R}=N[U];Y.prototype[U]=function(){if(this.model===U)return new Y(this);for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];return q.length>0?new Y(q,U):new Y([...(B=N[this.model][U].raw(this.color),Array.isArray(B)?B:[B]),this.valpha],U);var B},Y[U]=function(){for(var q=arguments.length,L=new Array(q),B=0;B<q;B++)L[B]=arguments[B];let N=L[0];return"number"===typeof N&&(N=y(L,R)),new Y(N,U)}}function F(R){return function(q){return function(R,q){return Number(R.toFixed(q))}(q,R)}}function C(R,q,L){R=Array.isArray(R)?R:[R];for(const B of R)(z[B]||(z[B]=[]))[q]=L;return R=R[0],function(B){let N;return void 0!==B?(L&&(B=L(B)),N=this[R](),N.color[q]=B,N):(N=this[R]().color[q],L&&(N=L(N)),N)}}function e(R){return function(q){return Math.max(0,Math.min(R,q))}}function y(R,q){for(let L=0;L<q;L++)"number"!==typeof R[L]&&(R[L]=0);return R}R.exports=Y},12420:(R,q,L)=>{const B=L(12424),N={};for(const Z of Object.keys(B))N[B[Z]]=Z;const h={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};R.exports=h;for(const Z of Object.keys(h)){if(!("channels"in h[Z]))throw new Error("missing channels property: "+Z);if(!("labels"in h[Z]))throw new Error("missing channel labels property: "+Z);if(h[Z].labels.length!==h[Z].channels)throw new Error("channel and label counts mismatch: "+Z);const{channels:R,labels:q}=h[Z];delete h[Z].channels,delete h[Z].labels,Object.defineProperty(h[Z],"channels",{value:R}),Object.defineProperty(h[Z],"labels",{value:q})}h.rgb.hsl=function(R){const q=R[0]/255,L=R[1]/255,B=R[2]/255,N=Math.min(q,L,B),h=Math.max(q,L,B),Z=h-N;let z,Y;h===N?z=0:q===h?z=(L-B)/Z:L===h?z=2+(B-q)/Z:B===h&&(z=4+(q-L)/Z),z=Math.min(60*z,360),z<0&&(z+=360);const F=(N+h)/2;return Y=h===N?0:F<=.5?Z/(h+N):Z/(2-h-N),[z,100*Y,100*F]},h.rgb.hsv=function(R){let q,L,B,N,h;const Z=R[0]/255,z=R[1]/255,Y=R[2]/255,F=Math.max(Z,z,Y),C=F-Math.min(Z,z,Y),e=function(R){return(F-R)/6/C+.5};return 0===C?(N=0,h=0):(h=C/F,q=e(Z),L=e(z),B=e(Y),Z===F?N=B-L:z===F?N=1/3+q-B:Y===F&&(N=2/3+L-q),N<0?N+=1:N>1&&(N-=1)),[360*N,100*h,100*F]},h.rgb.hwb=function(R){const q=R[0],L=R[1];let B=R[2];const N=h.rgb.hsl(R)[0],Z=1/255*Math.min(q,Math.min(L,B));return B=1-1/255*Math.max(q,Math.max(L,B)),[N,100*Z,100*B]},h.rgb.cmyk=function(R){const q=R[0]/255,L=R[1]/255,B=R[2]/255,N=Math.min(1-q,1-L,1-B);return[100*((1-q-N)/(1-N)||0),100*((1-L-N)/(1-N)||0),100*((1-B-N)/(1-N)||0),100*N]},h.rgb.keyword=function(R){const q=N[R];if(q)return q;let L,h=1/0;for(const N of Object.keys(B)){const q=B[N],Y=(z=q,((Z=R)[0]-z[0])**2+(Z[1]-z[1])**2+(Z[2]-z[2])**2);Y<h&&(h=Y,L=N)}var Z,z;return L},h.keyword.rgb=function(R){return B[R]},h.rgb.xyz=function(R){let q=R[0]/255,L=R[1]/255,B=R[2]/255;q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,L=L>.04045?((L+.055)/1.055)**2.4:L/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92;return[100*(.4124*q+.3576*L+.1805*B),100*(.2126*q+.7152*L+.0722*B),100*(.0193*q+.1192*L+.9505*B)]},h.rgb.lab=function(R){const q=h.rgb.xyz(R);let L=q[0],B=q[1],N=q[2];L/=95.047,B/=100,N/=108.883,L=L>.008856?L**(1/3):7.787*L+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*B-16,500*(L-B),200*(B-N)]},h.hsl.rgb=function(R){const q=R[0]/360,L=R[1]/100,B=R[2]/100;let N,h,Z;if(0===L)return Z=255*B,[Z,Z,Z];N=B<.5?B*(1+L):B+L-B*L;const z=2*B-N,Y=[0,0,0];for(let F=0;F<3;F++)h=q+1/3*-(F-1),h<0&&h++,h>1&&h--,Z=6*h<1?z+6*(N-z)*h:2*h<1?N:3*h<2?z+(N-z)*(2/3-h)*6:z,Y[F]=255*Z;return Y},h.hsl.hsv=function(R){const q=R[0];let L=R[1]/100,B=R[2]/100,N=L;const h=Math.max(B,.01);B*=2,L*=B<=1?B:2-B,N*=h<=1?h:2-h;return[q,100*(0===B?2*N/(h+N):2*L/(B+L)),100*((B+L)/2)]},h.hsv.rgb=function(R){const q=R[0]/60,L=R[1]/100;let B=R[2]/100;const N=Math.floor(q)%6,h=q-Math.floor(q),Z=255*B*(1-L),z=255*B*(1-L*h),Y=255*B*(1-L*(1-h));switch(B*=255,N){case 0:return[B,Y,Z];case 1:return[z,B,Z];case 2:return[Z,B,Y];case 3:return[Z,z,B];case 4:return[Y,Z,B];case 5:return[B,Z,z]}},h.hsv.hsl=function(R){const q=R[0],L=R[1]/100,B=R[2]/100,N=Math.max(B,.01);let h,Z;Z=(2-L)*B;const z=(2-L)*N;return h=L*N,h/=z<=1?z:2-z,h=h||0,Z/=2,[q,100*h,100*Z]},h.hwb.rgb=function(R){const q=R[0]/360;let L=R[1]/100,B=R[2]/100;const N=L+B;let h;N>1&&(L/=N,B/=N);const Z=Math.floor(6*q),z=1-B;h=6*q-Z,0!==(1&Z)&&(h=1-h);const Y=L+h*(z-L);let F,C,e;switch(Z){default:case 6:case 0:F=z,C=Y,e=L;break;case 1:F=Y,C=z,e=L;break;case 2:F=L,C=z,e=Y;break;case 3:F=L,C=Y,e=z;break;case 4:F=Y,C=L,e=z;break;case 5:F=z,C=L,e=Y}return[255*F,255*C,255*e]},h.cmyk.rgb=function(R){const q=R[0]/100,L=R[1]/100,B=R[2]/100,N=R[3]/100;return[255*(1-Math.min(1,q*(1-N)+N)),255*(1-Math.min(1,L*(1-N)+N)),255*(1-Math.min(1,B*(1-N)+N))]},h.xyz.rgb=function(R){const q=R[0]/100,L=R[1]/100,B=R[2]/100;let N,h,Z;return N=3.2406*q+-1.5372*L+-.4986*B,h=-.9689*q+1.8758*L+.0415*B,Z=.0557*q+-.204*L+1.057*B,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,N=Math.min(Math.max(0,N),1),h=Math.min(Math.max(0,h),1),Z=Math.min(Math.max(0,Z),1),[255*N,255*h,255*Z]},h.xyz.lab=function(R){let q=R[0],L=R[1],B=R[2];q/=95.047,L/=100,B/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,L=L>.008856?L**(1/3):7.787*L+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*L-16,500*(q-L),200*(L-B)]},h.lab.xyz=function(R){let q,L,B;L=(R[0]+16)/116,q=R[1]/500+L,B=L-R[2]/200;const N=L**3,h=q**3,Z=B**3;return L=N>.008856?N:(L-16/116)/7.787,q=h>.008856?h:(q-16/116)/7.787,B=Z>.008856?Z:(B-16/116)/7.787,q*=95.047,L*=100,B*=108.883,[q,L,B]},h.lab.lch=function(R){const q=R[0],L=R[1],B=R[2];let N;N=360*Math.atan2(B,L)/2/Math.PI,N<0&&(N+=360);return[q,Math.sqrt(L*L+B*B),N]},h.lch.lab=function(R){const q=R[0],L=R[1],B=R[2]/360*2*Math.PI;return[q,L*Math.cos(B),L*Math.sin(B)]},h.rgb.ansi16=function(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[L,B,N]=R;let Z=null===q?h.rgb.hsv(R)[2]:q;if(Z=Math.round(Z/50),0===Z)return 30;let z=30+(Math.round(N/255)<<2|Math.round(B/255)<<1|Math.round(L/255));return 2===Z&&(z+=60),z},h.hsv.ansi16=function(R){return h.rgb.ansi16(h.hsv.rgb(R),R[2])},h.rgb.ansi256=function(R){const q=R[0],L=R[1],B=R[2];if(q===L&&L===B)return q<8?16:q>248?231:Math.round((q-8)/247*24)+232;return 16+36*Math.round(q/255*5)+6*Math.round(L/255*5)+Math.round(B/255*5)},h.ansi16.rgb=function(R){let q=R%10;if(0===q||7===q)return R>50&&(q+=3.5),q=q/10.5*255,[q,q,q];const L=.5*(1+~~(R>50));return[(1&q)*L*255,(q>>1&1)*L*255,(q>>2&1)*L*255]},h.ansi256.rgb=function(R){if(R>=232){const q=10*(R-232)+8;return[q,q,q]}let q;R-=16;return[Math.floor(R/36)/5*255,Math.floor((q=R%36)/6)/5*255,q%6/5*255]},h.rgb.hex=function(R){const q=(((255&Math.round(R[0]))<<16)+((255&Math.round(R[1]))<<8)+(255&Math.round(R[2]))).toString(16).toUpperCase();return"000000".substring(q.length)+q},h.hex.rgb=function(R){const q=R.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!q)return[0,0,0];let L=q[0];3===q[0].length&&(L=L.split("").map((R=>R+R)).join(""));const B=parseInt(L,16);return[B>>16&255,B>>8&255,255&B]},h.rgb.hcg=function(R){const q=R[0]/255,L=R[1]/255,B=R[2]/255,N=Math.max(Math.max(q,L),B),h=Math.min(Math.min(q,L),B),Z=N-h;let z,Y;return z=Z<1?h/(1-Z):0,Y=Z<=0?0:N===q?(L-B)/Z%6:N===L?2+(B-q)/Z:4+(q-L)/Z,Y/=6,Y%=1,[360*Y,100*Z,100*z]},h.hsl.hcg=function(R){const q=R[1]/100,L=R[2]/100,B=L<.5?2*q*L:2*q*(1-L);let N=0;return B<1&&(N=(L-.5*B)/(1-B)),[R[0],100*B,100*N]},h.hsv.hcg=function(R){const q=R[1]/100,L=R[2]/100,B=q*L;let N=0;return B<1&&(N=(L-B)/(1-B)),[R[0],100*B,100*N]},h.hcg.rgb=function(R){const q=R[0]/360,L=R[1]/100,B=R[2]/100;if(0===L)return[255*B,255*B,255*B];const N=[0,0,0],h=q%1*6,Z=h%1,z=1-Z;let Y=0;switch(Math.floor(h)){case 0:N[0]=1,N[1]=Z,N[2]=0;break;case 1:N[0]=z,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=Z;break;case 3:N[0]=0,N[1]=z,N[2]=1;break;case 4:N[0]=Z,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=z}return Y=(1-L)*B,[255*(L*N[0]+Y),255*(L*N[1]+Y),255*(L*N[2]+Y)]},h.hcg.hsv=function(R){const q=R[1]/100,L=q+R[2]/100*(1-q);let B=0;return L>0&&(B=q/L),[R[0],100*B,100*L]},h.hcg.hsl=function(R){const q=R[1]/100,L=R[2]/100*(1-q)+.5*q;let B=0;return L>0&&L<.5?B=q/(2*L):L>=.5&&L<1&&(B=q/(2*(1-L))),[R[0],100*B,100*L]},h.hcg.hwb=function(R){const q=R[1]/100,L=q+R[2]/100*(1-q);return[R[0],100*(L-q),100*(1-L)]},h.hwb.hcg=function(R){const q=R[1]/100,L=1-R[2]/100,B=L-q;let N=0;return B<1&&(N=(L-B)/(1-B)),[R[0],100*B,100*N]},h.apple.rgb=function(R){return[R[0]/65535*255,R[1]/65535*255,R[2]/65535*255]},h.rgb.apple=function(R){return[R[0]/255*65535,R[1]/255*65535,R[2]/255*65535]},h.gray.rgb=function(R){return[R[0]/100*255,R[0]/100*255,R[0]/100*255]},h.gray.hsl=function(R){return[0,0,R[0]]},h.gray.hsv=h.gray.hsl,h.gray.hwb=function(R){return[0,100,R[0]]},h.gray.cmyk=function(R){return[0,0,0,R[0]]},h.gray.lab=function(R){return[R[0],0,0]},h.gray.hex=function(R){const q=255&Math.round(R[0]/100*255),L=((q<<16)+(q<<8)+q).toString(16).toUpperCase();return"000000".substring(L.length)+L},h.rgb.gray=function(R){return[(R[0]+R[1]+R[2])/3/255*100]}},12415:(R,q,L)=>{const B=L(12420),N=L(12426),h={};Object.keys(B).forEach((R=>{h[R]={},Object.defineProperty(h[R],"channels",{value:B[R].channels}),Object.defineProperty(h[R],"labels",{value:B[R].labels});const q=N(R);Object.keys(q).forEach((L=>{const B=q[L];h[R][L]=function(R){const q=function(){for(var q=arguments.length,L=new Array(q),B=0;B<q;B++)L[B]=arguments[B];const N=L[0];if(void 0===N||null===N)return N;N.length>1&&(L=N);const h=R(L);if("object"===typeof h)for(let R=h.length,Z=0;Z<R;Z++)h[Z]=Math.round(h[Z]);return h};return"conversion"in R&&(q.conversion=R.conversion),q}(B),h[R][L].raw=function(R){const q=function(){for(var q=arguments.length,L=new Array(q),B=0;B<q;B++)L[B]=arguments[B];const N=L[0];return void 0===N||null===N?N:(N.length>1&&(L=N),R(L))};return"conversion"in R&&(q.conversion=R.conversion),q}(B)}))})),R.exports=h},12426:(R,q,L)=>{const B=L(12420);function N(R){const q=function(){const R={},q=Object.keys(B);for(let L=q.length,B=0;B<L;B++)R[q[B]]={distance:-1,parent:null};return R}(),L=[R];for(q[R].distance=0;L.length;){const R=L.pop(),N=Object.keys(B[R]);for(let B=N.length,h=0;h<B;h++){const B=N[h],Z=q[B];-1===Z.distance&&(Z.distance=q[R].distance+1,Z.parent=R,L.unshift(B))}}return q}function h(R,q){return function(L){return q(R(L))}}function Z(R,q){const L=[q[R].parent,R];let N=B[q[R].parent][R],Z=q[R].parent;for(;q[Z].parent;)L.unshift(q[Z].parent),N=h(B[q[Z].parent][Z],N),Z=q[Z].parent;return N.conversion=L,N}R.exports=function(R){const q=N(R),L={},B=Object.keys(q);for(let N=B.length,h=0;h<N;h++){const R=B[h];null!==q[R].parent&&(L[R]=Z(R,q))}return L}},12424:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10688:function(R,q,L){"use strict";var B=this&&this.__createBinding||(Object.create?function(R,q,L,B){void 0===B&&(B=L);var N=Object.getOwnPropertyDescriptor(q,L);N&&!("get"in N?!q.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return q[L]}}),Object.defineProperty(R,B,N)}:function(R,q,L,B){void 0===B&&(B=L),R[B]=q[L]}),N=this&&this.__setModuleDefault||(Object.create?function(R,q){Object.defineProperty(R,"default",{enumerable:!0,value:q})}:function(R,q){R.default=q}),h=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var q={};if(null!=R)for(var L in R)"default"!==L&&Object.prototype.hasOwnProperty.call(R,L)&&B(q,R,L);return N(q,R),q},Z=this&&this.__awaiter||function(R,q,L,B){return new(L||(L=Promise))((function(N,h){function Z(R){try{Y(B.next(R))}catch(q){h(q)}}function z(R){try{Y(B.throw(R))}catch(q){h(q)}}function Y(R){var q;R.done?N(R.value):(q=R.value,q instanceof L?q:new L((function(R){R(q)}))).then(Z,z)}Y((B=B.apply(R,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Auth=q.Platform=void 0;const z=h(L(10613)),Y=L(10692),F="colyseus-auth-token";!function(R){R.ios="ios",R.android="android"}(q.Platform||(q.Platform={}));q.Auth=class{constructor(R){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=R.replace("ws","http"),(0,Y.getItem)(F,(R=>this.token=R))}get hasToken(){return!!this.token}login(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z(this,void 0,void 0,(function*(){const q=Object.assign({},R);this.hasToken&&(q.token=this.token);const L=yield this.request("post","/auth",q);this.token=L.token,(0,Y.setItem)(F,this.token);for(let R in L)this.hasOwnProperty(R)&&(this[R]=L[R]);return this.registerPingService(),this}))}save(){return Z(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return Z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return Z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return Z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(R){return Z(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:R})}))}acceptFriendRequest(R){return Z(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:R})}))}declineFriendRequest(R){return Z(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:R})}))}blockUser(R){return Z(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:R})}))}unblockUser(R){return Z(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:R})}))}request(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Z(this,void 0,void 0,(function*(){N.Accept="application/json",this.hasToken&&(N.Authorization="Bearer "+this.token);const h=[];for(const R in L)h.push(`${R}=${L[R]}`);const Z=h.length>0?`?${h.join("&")}`:"",Y={headers:N};return B&&(Y.body=B),(yield z[R](`${this.endpoint}${q}${Z}`,Y)).data}))}logout(){this.token=void 0,(0,Y.removeItem)(F),this.unregisterPingService()}registerPingService(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),R)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10611:function(R,q,L){"use strict";var B,N=this&&this.__awaiter||function(R,q,L,B){return new(L||(L=Promise))((function(N,h){function Z(R){try{Y(B.next(R))}catch(q){h(q)}}function z(R){try{Y(B.throw(R))}catch(q){h(q)}}function Y(R){var q;R.done?N(R.value):(q=R.value,q instanceof L?q:new L((function(R){R(q)}))).then(Z,z)}Y((B=B.apply(R,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Client=q.MatchMakeError=void 0;const h=L(10613),Z=L(10621),z=L(10627);class Y extends Error{constructor(R,q){super(R),this.code=q,Object.setPrototypeOf(this,Y.prototype)}}q.MatchMakeError=Y;const F="undefined"!==typeof window&&"undefined"!==typeof(null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";q.Client=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;if("string"===typeof R){const q=new URL(R),L="https:"===q.protocol||"wss:"===q.protocol,B=Number(q.port||(L?443:80));this.settings={hostname:q.hostname,pathname:"/"!==q.pathname?q.pathname:"",port:B,secure:L}}else void 0===R.port&&(R.port=R.secure?443:80),void 0===R.pathname&&(R.pathname=""),this.settings=R}joinOrCreate(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",R,q,L)}))}create(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",R,q,L)}))}join(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",R,q,L)}))}joinById(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",R,q,L)}))}reconnect(R,q){return N(this,void 0,void 0,(function*(){if("string"===typeof R&&"string"===typeof q)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[L,B]=R.split(":");return yield this.createMatchMakeRequest("reconnect",L,{reconnectionToken:B},q)}))}getAvailableRooms(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return N(this,void 0,void 0,(function*(){return(yield(0,h.get)(this.getHttpEndpoint(`${R}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(R,q,L){return N(this,void 0,void 0,(function*(){const B=this.createRoom(R.room.name,q);B.roomId=R.room.roomId,B.sessionId=R.sessionId;const h={sessionId:B.sessionId};R.reconnectionToken&&(h.reconnectionToken=R.reconnectionToken);const z=L||B;return B.connect(this.buildEndpoint(R.room,h),R.devMode&&(()=>N(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${B.roomId}'...`);let L=0;const h=()=>N(this,void 0,void 0,(function*(){L++;try{yield this.consumeSeatReservation(R,q,z),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${B.roomId}'`)}catch(N){L<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${L} out of 8)`),setTimeout(h,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(h,2e3)}))),z),new Promise(((R,q)=>{const L=(R,L)=>q(new Z.ServerError(R,L));z.onError.once(L),z.onJoin.once((()=>{z.onError.remove(L),R(z)}))}))}))}createMatchMakeRequest(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0;return N(this,void 0,void 0,(function*(){const N=(yield(0,h.post)(this.getHttpEndpoint(`${R}/${q}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(L)})).data;if(N.error)throw new Y(N.error,N.code);return"reconnect"===R&&(N.reconnectionToken=L.reconnectionToken),yield this.consumeSeatReservation(N,B,Z)}))}createRoom(R,q){return new z.Room(R,q)}buildEndpoint(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const L=[];for(const N in q)q.hasOwnProperty(N)&&L.push(`${N}=${q[N]}`);let B=this.settings.secure?"wss://":"ws://";return R.publicAddress?B+=`${R.publicAddress}`:B+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${B}/${R.processId}/${R.roomId}?${L.join("&")}`}getHttpEndpoint(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${R}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10636:(R,q,L)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.Connection=void 0;const B=L(10639);q.Connection=class{constructor(){this.events={},this.transport=new B.WebSocketTransport(this.events)}send(R){this.transport.send(R)}connect(R){this.transport.connect(R)}close(R,q){this.transport.close(R,q)}get isOpen(){return this.transport.isOpen}}},10654:(R,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.utf8Length=q.utf8Read=q.ErrorCode=q.Protocol=void 0,function(R){R[R.HANDSHAKE=9]="HANDSHAKE",R[R.JOIN_ROOM=10]="JOIN_ROOM",R[R.ERROR=11]="ERROR",R[R.LEAVE_ROOM=12]="LEAVE_ROOM",R[R.ROOM_DATA=13]="ROOM_DATA",R[R.ROOM_STATE=14]="ROOM_STATE",R[R.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",R[R.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",R[R.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(q.Protocol||(q.Protocol={})),function(R){R[R.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",R[R.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",R[R.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",R[R.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",R[R.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",R[R.AUTH_FAILED=4215]="AUTH_FAILED",R[R.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(q.ErrorCode||(q.ErrorCode={})),q.utf8Read=function(R,q){const L=R[q++];for(var B="",N=0,h=q,Z=q+L;h<Z;h++){var z=R[h];if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(N=(7&z)<<18|(63&R[++h])<<12|(63&R[++h])<<6|63&R[++h])>=65536?(N-=65536,B+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):B+=String.fromCharCode(N)}else B+=String.fromCharCode((15&z)<<12|(63&R[++h])<<6|63&R[++h]);else B+=String.fromCharCode((31&z)<<6|63&R[++h]);else B+=String.fromCharCode(z)}return B},q.utf8Length=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",q=0,L=0;for(let B=0,N=R.length;B<N;B++)q=R.charCodeAt(B),q<128?L+=1:q<2048?L+=2:q<55296||q>=57344?L+=3:(B++,L+=4);return L+1}},10627:function(R,q,L){"use strict";var B=this&&this.__createBinding||(Object.create?function(R,q,L,B){void 0===B&&(B=L);var N=Object.getOwnPropertyDescriptor(q,L);N&&!("get"in N?!q.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return q[L]}}),Object.defineProperty(R,B,N)}:function(R,q,L,B){void 0===B&&(B=L),R[B]=q[L]}),N=this&&this.__setModuleDefault||(Object.create?function(R,q){Object.defineProperty(R,"default",{enumerable:!0,value:q})}:function(R,q){R.default=q}),h=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var q={};if(null!=R)for(var L in R)"default"!==L&&Object.prototype.hasOwnProperty.call(R,L)&&B(q,R,L);return N(q,R),q};Object.defineProperty(q,"__esModule",{value:!0}),q.Room=void 0;const Z=h(L(10630)),z=L(10636),Y=L(10654),F=L(10662),C=L(10671),e=L(10674),y=L(10683),U=L(10621);class n{constructor(R,q){this.onStateChange=(0,e.createSignal)(),this.onError=(0,e.createSignal)(),this.onLeave=(0,e.createSignal)(),this.onJoin=(0,e.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,C.createNanoEvents)(),this.roomId=null,this.name=R,q&&(this.serializer=new((0,F.getSerializer)("schema")),this.rootSchema=q,this.serializer.state=new q),this.onError(((R,q)=>{var L;return null===(L=console.warn)||void 0===L?void 0:L.call(console,`colyseus.js - onError => (${R}) ${q}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const B=new z.Connection;L.connection=B,B.events.onmessage=n.prototype.onMessageCallback.bind(L),B.events.onclose=function(R){var B;if(!L.hasJoined)return null===(B=console.warn)||void 0===B||B.call(console,`Room connection was closed unexpectedly (${R.code}): ${R.reason}`),void L.onError.invoke(R.code,R.reason);R.code===U.CloseCode.DEVMODE_RESTART&&q?q():(L.onLeave.invoke(R.code),L.destroy())},B.events.onerror=function(R){var q;null===(q=console.warn)||void 0===q||q.call(console,`Room, onError (${R.code}): ${R.reason}`),L.onError.invoke(R.code,R.reason)},B.connect(R)}leave(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((q=>{this.onLeave((R=>q(R))),this.connection?R?this.connection.send([Y.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(U.CloseCode.CONSENTED)}))}onMessage(R,q){return this.onMessageHandlers.on(this.getMessageHandlerKey(R),q)}send(R,q){const L=[Y.Protocol.ROOM_DATA];let B;if("string"===typeof R?y.encode.string(L,R):y.encode.number(L,R),void 0!==q){const R=Z.encode(q);B=new Uint8Array(L.length+R.byteLength),B.set(new Uint8Array(L),0),B.set(new Uint8Array(R),L.length)}else B=new Uint8Array(L);this.connection.send(B.buffer)}sendBytes(R,q){const L=[Y.Protocol.ROOM_DATA_BYTES];let B;"string"===typeof R?y.encode.string(L,R):y.encode.number(L,R),B=new Uint8Array(L.length+(q.byteLength||q.length)),B.set(new Uint8Array(L),0),B.set(new Uint8Array(q),L.length),this.connection.send(B.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(R){const q=Array.from(new Uint8Array(R.data)),L=q[0];if(L===Y.Protocol.JOIN_ROOM){let R=1;const L=(0,Y.utf8Read)(q,R);if(R+=(0,Y.utf8Length)(L),this.serializerId=(0,Y.utf8Read)(q,R),R+=(0,Y.utf8Length)(this.serializerId),!this.serializer){const R=(0,F.getSerializer)(this.serializerId);this.serializer=new R}q.length>R&&this.serializer.handshake&&this.serializer.handshake(q,{offset:R}),this.reconnectionToken=`${this.roomId}:${L}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([Y.Protocol.JOIN_ROOM])}else if(L===Y.Protocol.ERROR){const R={offset:1},L=y.decode.number(q,R),B=y.decode.string(q,R);this.onError.invoke(L,B)}else if(L===Y.Protocol.LEAVE_ROOM)this.leave();else if(L===Y.Protocol.ROOM_DATA_SCHEMA){const R={offset:1},L=this.serializer.getState().constructor._context.get(y.decode.number(q,R)),B=new L;B.decode(q,R),this.dispatchMessage(L,B)}else if(L===Y.Protocol.ROOM_STATE)q.shift(),this.setState(q);else if(L===Y.Protocol.ROOM_STATE_PATCH)q.shift(),this.patch(q);else if(L===Y.Protocol.ROOM_DATA){const L={offset:1},B=y.decode.stringCheck(q,L)?y.decode.string(q,L):y.decode.number(q,L),N=q.length>L.offset?Z.decode(R.data,L.offset):void 0;this.dispatchMessage(B,N)}else if(L===Y.Protocol.ROOM_DATA_BYTES){const R={offset:1},L=y.decode.stringCheck(q,R)?y.decode.string(q,R):y.decode.number(q,R);this.dispatchMessage(L,new Uint8Array(q.slice(R.offset)))}}setState(R){this.serializer.setState(R),this.onStateChange.invoke(this.serializer.getState())}patch(R){this.serializer.patch(R),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(R,q){var L;const B=this.getMessageHandlerKey(R);this.onMessageHandlers.events[B]?this.onMessageHandlers.emit(B,q):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",R,q):null===(L=console.warn)||void 0===L||L.call(console,`colyseus.js: onMessage() not registered for type '${R}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(R){switch(typeof R){case"function":return`$${R._typeid}`;case"string":return R;case"number":return`i${R}`;default:throw new Error("invalid message type.")}}}q.Room=n},10692:(R,q)=>{"use strict";let L;function B(){return L||(L="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(R,q){this.cache[R]=q},getItem:function(R){this.cache[R]},removeItem:function(R){delete this.cache[R]}}),L}Object.defineProperty(q,"__esModule",{value:!0}),q.getItem=q.removeItem=q.setItem=void 0,q.setItem=function(R,q){B().setItem(R,q)},q.removeItem=function(R){B().removeItem(R)},q.getItem=function(R,q){const L=B().getItem(R);"undefined"!==typeof Promise&&L instanceof Promise?L.then((R=>q(R))):q(L)}},10671:(R,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createNanoEvents=void 0;q.createNanoEvents=()=>({emit(R){let q=this.events[R]||[];for(var L=arguments.length,B=new Array(L>1?L-1:0),N=1;N<L;N++)B[N-1]=arguments[N];for(let h=0,Z=q.length;h<Z;h++)q[h](...B)},events:{},on(R,q){var L;return(null===(L=this.events[R])||void 0===L?void 0:L.push(q))||(this.events[R]=[q]),()=>{var L;this.events[R]=null===(L=this.events[R])||void 0===L?void 0:L.filter((R=>q!==R))}}})},10674:(R,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createSignal=q.EventEmitter=void 0;class L{constructor(){this.handlers=[]}register(R){return this.handlers.push(R),this}invoke(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];this.handlers.forEach((R=>R.apply(this,q)))}invokeAsync(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];return Promise.all(this.handlers.map((R=>R.apply(this,q))))}remove(R){const q=this.handlers.indexOf(R);this.handlers[q]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}q.EventEmitter=L,q.createSignal=function(){const R=new L;function q(q){return R.register(q,null===this)}return q.once=q=>{const L=function(){for(var B=arguments.length,N=new Array(B),h=0;h<B;h++)N[h]=arguments[h];q.apply(this,N),R.remove(L)};R.register(L)},q.remove=q=>R.remove(q),q.invoke=function(){return R.invoke(...arguments)},q.invokeAsync=function(){return R.invokeAsync(...arguments)},q.clear=()=>R.clear(),q}},10621:(R,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.ServerError=q.CloseCode=void 0,function(R){R[R.CONSENTED=4e3]="CONSENTED",R[R.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(q.CloseCode||(q.CloseCode={}));class L extends Error{constructor(R,q){super(q),this.name="ServerError",this.code=R}}q.ServerError=L},10606:(R,q,L)=>{"use strict";q.b=void 0,L(10608);var B=L(10611);Object.defineProperty(q,"b",{enumerable:!0,get:function(){return B.Client}});var N=L(10654);var h=L(10627);var Z=L(10688);const z=L(10699);const Y=L(10708),F=L(10662);(0,F.registerSerializer)("schema",z.SchemaSerializer),(0,F.registerSerializer)("none",Y.NoneSerializer)},10608:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=R=>null!==R&&"object"===typeof R&&R.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10630:(R,q)=>{"use strict";function L(R,q){if(this._offset=q,R instanceof ArrayBuffer)this._buffer=R,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(R))throw new Error("Invalid argument");this._buffer=R.buffer,this._view=new DataView(this._buffer,R.byteOffset,R.byteLength)}}Object.defineProperty(q,"__esModule",{value:!0}),q.decode=q.encode=void 0,L.prototype._array=function(R){for(var q=new Array(R),L=0;L<R;L++)q[L]=this._parse();return q},L.prototype._map=function(R){for(var q={},L=0;L<R;L++)q[this._parse()]=this._parse();return q},L.prototype._str=function(R){var q=function(R,q,L){for(var B="",N=0,h=q,Z=q+L;h<Z;h++){var z=R.getUint8(h);if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(N=(7&z)<<18|(63&R.getUint8(++h))<<12|(63&R.getUint8(++h))<<6|63&R.getUint8(++h))>=65536?(N-=65536,B+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):B+=String.fromCharCode(N)}else B+=String.fromCharCode((15&z)<<12|(63&R.getUint8(++h))<<6|63&R.getUint8(++h));else B+=String.fromCharCode((31&z)<<6|63&R.getUint8(++h));else B+=String.fromCharCode(z)}return B}(this._view,this._offset,R);return this._offset+=R,q},L.prototype._bin=function(R){var q=this._buffer.slice(this._offset,this._offset+R);return this._offset+=R,q},L.prototype._parse=function(){var R,q=this._view.getUint8(this._offset++),L=0,B=0,N=0,h=0;if(q<192)return q<128?q:q<144?this._map(15&q):q<160?this._array(15&q):this._str(31&q);if(q>223)return-1*(255-q+1);switch(q){case 192:return null;case 194:return!1;case 195:return!0;case 196:return L=this._view.getUint8(this._offset),this._offset+=1,this._bin(L);case 197:return L=this._view.getUint16(this._offset),this._offset+=2,this._bin(L);case 198:return L=this._view.getUint32(this._offset),this._offset+=4,this._bin(L);case 199:if(L=this._view.getUint8(this._offset),B=this._view.getInt8(this._offset+1),this._offset+=2,-1===B){var Z=this._view.getUint32(this._offset);return N=this._view.getInt32(this._offset+4),h=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*N+h)+Z/1e6)}return[B,this._bin(L)];case 200:return L=this._view.getUint16(this._offset),B=this._view.getInt8(this._offset+2),this._offset+=3,[B,this._bin(L)];case 201:return L=this._view.getUint32(this._offset),B=this._view.getInt8(this._offset+4),this._offset+=5,[B,this._bin(L)];case 202:return R=this._view.getFloat32(this._offset),this._offset+=4,R;case 203:return R=this._view.getFloat64(this._offset),this._offset+=8,R;case 204:return R=this._view.getUint8(this._offset),this._offset+=1,R;case 205:return R=this._view.getUint16(this._offset),this._offset+=2,R;case 206:return R=this._view.getUint32(this._offset),this._offset+=4,R;case 207:return N=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,N+h;case 208:return R=this._view.getInt8(this._offset),this._offset+=1,R;case 209:return R=this._view.getInt16(this._offset),this._offset+=2,R;case 210:return R=this._view.getInt32(this._offset),this._offset+=4,R;case 211:return N=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,N+h;case 212:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?void(this._offset+=1):[B,this._bin(1)];case 213:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(2)];case 214:return B=this._view.getInt8(this._offset),this._offset+=1,-1===B?(R=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*R)):[B,this._bin(4)];case 215:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?(N=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(N+h)):-1===B?(N=this._view.getUint32(this._offset),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&N)+h)+(N>>>2)/1e6)):[B,this._bin(8)];case 216:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(16)];case 217:return L=this._view.getUint8(this._offset),this._offset+=1,this._str(L);case 218:return L=this._view.getUint16(this._offset),this._offset+=2,this._str(L);case 219:return L=this._view.getUint32(this._offset),this._offset+=4,this._str(L);case 220:return L=this._view.getUint16(this._offset),this._offset+=2,this._array(L);case 221:return L=this._view.getUint32(this._offset),this._offset+=4,this._array(L);case 222:return L=this._view.getUint16(this._offset),this._offset+=2,this._map(L);case 223:return L=this._view.getUint32(this._offset),this._offset+=4,this._map(L)}throw new Error("Could not parse")},q.decode=function(R){var q=new L(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),B=q._parse();if(q._offset!==R.byteLength)throw new Error(R.byteLength-q._offset+" trailing bytes");return B};function B(R,q,L){for(var B=0,N=0,h=L.length;N<h;N++)(B=L.charCodeAt(N))<128?R.setUint8(q++,B):B<2048?(R.setUint8(q++,192|B>>6),R.setUint8(q++,128|63&B)):B<55296||B>=57344?(R.setUint8(q++,224|B>>12),R.setUint8(q++,128|B>>6&63),R.setUint8(q++,128|63&B)):(N++,B=65536+((1023&B)<<10|1023&L.charCodeAt(N)),R.setUint8(q++,240|B>>18),R.setUint8(q++,128|B>>12&63),R.setUint8(q++,128|B>>6&63),R.setUint8(q++,128|63&B))}function N(R,q,L){var B=typeof L,h=0,Z=0,z=0,Y=0,F=0,C=0;if("string"===B){if(F=function(R){for(var q=0,L=0,B=0,N=R.length;B<N;B++)(q=R.charCodeAt(B))<128?L+=1:q<2048?L+=2:q<55296||q>=57344?L+=3:(B++,L+=4);return L}(L),F<32)R.push(160|F),C=1;else if(F<256)R.push(217,F),C=2;else if(F<65536)R.push(218,F>>8,F),C=3;else{if(!(F<4294967296))throw new Error("String too long");R.push(219,F>>24,F>>16,F>>8,F),C=5}return q.push({_str:L,_length:F,_offset:R.length}),C+F}if("number"===B)return Math.floor(L)===L&&isFinite(L)?L>=0?L<128?(R.push(L),1):L<256?(R.push(204,L),2):L<65536?(R.push(205,L>>8,L),3):L<4294967296?(R.push(206,L>>24,L>>16,L>>8,L),5):(z=L/Math.pow(2,32)|0,Y=L>>>0,R.push(207,z>>24,z>>16,z>>8,z,Y>>24,Y>>16,Y>>8,Y),9):L>=-32?(R.push(L),1):L>=-128?(R.push(208,L),2):L>=-32768?(R.push(209,L>>8,L),3):L>=-2147483648?(R.push(210,L>>24,L>>16,L>>8,L),5):(z=Math.floor(L/Math.pow(2,32)),Y=L>>>0,R.push(211,z>>24,z>>16,z>>8,z,Y>>24,Y>>16,Y>>8,Y),9):(R.push(203),q.push({_float:L,_length:8,_offset:R.length}),9);if("object"===B){if(null===L)return R.push(192),1;if(Array.isArray(L)){if((F=L.length)<16)R.push(144|F),C=1;else if(F<65536)R.push(220,F>>8,F),C=3;else{if(!(F<4294967296))throw new Error("Array too large");R.push(221,F>>24,F>>16,F>>8,F),C=5}for(h=0;h<F;h++)C+=N(R,q,L[h]);return C}if(L instanceof Date){var e=L.getTime(),y=Math.floor(e/1e3),U=1e6*(e-1e3*y);return y>=0&&U>=0&&y<=17179869183?0===U&&y<=4294967295?(R.push(214,255,y>>24,y>>16,y>>8,y),6):(z=y/4294967296,Y=4294967295&y,R.push(215,255,U>>22,U>>14,U>>6,z,Y>>24,Y>>16,Y>>8,Y),10):(z=Math.floor(y/4294967296),Y=y>>>0,R.push(199,12,255,U>>24,U>>16,U>>8,U,z>>24,z>>16,z>>8,z,Y>>24,Y>>16,Y>>8,Y),15)}if(L instanceof ArrayBuffer){if((F=L.byteLength)<256)R.push(196,F),C=2;else if(F<65536)R.push(197,F>>8,F),C=3;else{if(!(F<4294967296))throw new Error("Buffer too large");R.push(198,F>>24,F>>16,F>>8,F),C=5}return q.push({_bin:L,_length:F,_offset:R.length}),C+F}if("function"===typeof L.toJSON)return N(R,q,L.toJSON());var n=[],r="",p=Object.keys(L);for(h=0,Z=p.length;h<Z;h++)void 0!==L[r=p[h]]&&"function"!==typeof L[r]&&n.push(r);if((F=n.length)<16)R.push(128|F),C=1;else if(F<65536)R.push(222,F>>8,F),C=3;else{if(!(F<4294967296))throw new Error("Object too large");R.push(223,F>>24,F>>16,F>>8,F),C=5}for(h=0;h<F;h++)C+=N(R,q,r=n[h]),C+=N(R,q,L[r]);return C}if("boolean"===B)return R.push(L?195:194),1;if("undefined"===B)return R.push(192),1;if("function"===typeof L.toJSON)return N(R,q,L.toJSON());throw new Error("Could not encode")}q.encode=function(R){var q=[],L=[],h=N(q,L,R),Z=new ArrayBuffer(h),z=new DataView(Z),Y=0,F=0,C=-1;L.length>0&&(C=L[0]._offset);for(var e,y=0,U=0,n=0,r=q.length;n<r;n++)if(z.setUint8(F+n,q[n]),n+1===C){if(y=(e=L[Y])._length,U=F+C,e._bin)for(var p=new Uint8Array(e._bin),c=0;c<y;c++)z.setUint8(U+c,p[c]);else e._str?B(z,U,e._str):void 0!==e._float&&z.setFloat64(U,e._float);F+=y,L[++Y]&&(C=L[Y]._offset)}return Z}},10708:(R,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.NoneSerializer=void 0;q.NoneSerializer=class{setState(R){}getState(){return null}patch(R){}teardown(){}handshake(R){}}},10699:(R,q,L)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.SchemaSerializer=void 0;const B=L(10683);q.SchemaSerializer=class{setState(R){return this.state.decode(R)}getState(){return this.state}patch(R){return this.state.decode(R)}teardown(){var R,q;null===(q=null===(R=this.state)||void 0===R?void 0:R.$changes)||void 0===q||q.root.clearRefs()}handshake(R,q){if(this.state){(new B.Reflection).decode(R,q)}else this.state=B.Reflection.decode(R,q)}}},10662:(R,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.getSerializer=q.registerSerializer=void 0;const L={};q.registerSerializer=function(R,q){L[R]=q},q.getSerializer=function(R){const q=L[R];if(!q)throw new Error("missing serializer: "+R);return q}},10639:function(R,q,L){"use strict";var B=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(q,"__esModule",{value:!0}),q.WebSocketTransport=void 0;const N=B(L(10646)),h=globalThis.WebSocket||N.default;q.WebSocketTransport=class{constructor(R){this.events=R}send(R){R instanceof ArrayBuffer?this.ws.send(R):Array.isArray(R)&&this.ws.send(new Uint8Array(R).buffer)}connect(R){this.ws=new h(R,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(R,q){this.ws.close(R,q)}get isOpen(){return this.ws.readyState===h.OPEN}}},10646:R=>{"use strict";R.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12274:R=>{"use strict";function q(R,L,B){var N=0|R[B];if(N<=0)return[];var h,Z=new Array(N);if(B===R.length-1)for(h=0;h<N;++h)Z[h]=L;else for(h=0;h<N;++h)Z[h]=q(R,L,B+1);return Z}R.exports=function(R,L){switch("undefined"===typeof L&&(L=0),typeof R){case"number":if(R>0)return function(R,q){var L,B;for(L=new Array(R),B=0;B<R;++B)L[B]=q;return L}(0|R,L);break;case"object":if("number"===typeof R.length)return q(R,L,0)}return[]}},12228:(R,q,L)=>{R.exports=function(){var R=this;this.components={},this.comps=this.components;var q=this.components,L=1,N={},h=[],Z=[],z={timeout:!1,removals:[],multiComps:[]};function Y(R,L){var B=q[L],h=N[L],Z=h.hash[R];Z&&(h.remove(R),B.ab&&(B.multi?(Z.forEach((q=>{q&&B.ab(R,q)})),Z.length=0):B.ab(R,Z)),z.removals.push(h),F())}function F(){z.timeout||(z.timeout=!0,setTimeout(C,1))}function C(){z.timeout=!1,e()}function e(){z.multiComps.length&&function(R){for(var q=0;q<R.length;q++){var{entID:L,data:B}=R[q],N=B.hash[L];if(N){for(var h=0;h<N.length;h++)N[h]||(N.splice(h,1),h--);0===N.length&&(B.remove(L),z.removals.push(B))}}R.length=0}(z.multiComps),z.removals.length&&function(R){for(var q=0;q<R.length;q++){R[q].flush()}R.length=0}(z.removals)}this.xi=N,this._systems=h,this._renderSystems=Z,this.Og=function(q){var B=L++;return Array.isArray(q)&&q.forEach((q=>R.Ve(B,q))),B},this.deleteEntity=function(q){return Object.keys(N).forEach((R=>{N[R].hash[q]&&Y(q,R)})),R},this.ph=function(R){if(!R)throw new Error("Missing component definition");var L=R.name;if(!L)throw new Error("Component definition must have a name property.");if("string"!==typeof L)throw new Error("Component name must be a string.");if(""===L)throw new Error("Component name must be a non-empty string.");if(N[L])throw new Error(`Component ${L} already exists.`);var z={};return z.name=L,z.multi=!!R.multi,z.order=isNaN(R.order)?99:R.order,z.stateConstructor=R.stateConstructor||null,z.state=R.state||{},z.sd=R.sd||null,z.ab=R.ab||null,z.system=R.system||null,z.Id=R.Id||null,q[L]=z,N[L]=new B,N[L]._pendingMultiCleanup=!1,N[L]._multiCleanupIDs=z.multi?[]:null,z.system&&(h.push(L),h.sort(((R,L)=>q[R].order-q[L].order))),z.Id&&(Z.push(L),Z.sort(((R,L)=>q[R].order-q[L].order))),L},this.overwriteComponent=function(R,L){var B=q[R];if(!B)throw new Error(`Unknown component: ${R}`);if(!L)throw new Error("Missing component definition");if(B.name!==L.name)throw new Error("Overwriting component must use the same name property.");var z={};z.name=R,z.multi=!!L.multi,z.order=isNaN(L.order)?99:L.order,z.state=L.state||{},z.sd=L.sd||null,z.ab=L.ab||null,z.system=L.system||null,z.Id=L.Id||null,q[R]=z,N[R]._pendingMultiCleanup=!1,N[R]._multiCleanupIDs=z.multi?[]:null;var Y=h.indexOf(R);z.system&&Y<0&&h.push(R),!z.system&&Y>=0&&h.splice(Y,1),h.sort(((R,L)=>q[R].order-q[L].order));var F=Z.indexOf(R);z.Id&&F<0&&Z.push(R),!z.Id&&F>=0&&Z.splice(F,1),Z.sort(((R,L)=>q[R].order-q[L].order));var C=z.state;return this.vg(R).forEach((R=>{for(var q in C)q in R||(R[q]=C[q]);z.sd&&z.sd(R.Fd,R)})),R},this.deleteComponent=function(L){var B=N[L];if(!B)throw new Error(`Unknown component: ${L}`);B.flush(),B.list.forEach((R=>{R&&Y(R.Fd||R[0].Fd,L)}));var z=h.indexOf(L),F=Z.indexOf(L);return z>-1&&h.splice(z,1),F>-1&&Z.splice(F,1),N[L].dispose(),delete N[L],delete q[L],R},this.Ve=function(R,L,B){var h,Z=q[L],z=N[L];if(!z)throw new Error(`Unknown component: ${L}.`);if(z.hash[R]&&!Z.multi)throw new Error(`Entity ${R} already has component: ${L}.`);if(Z.stateConstructor){if(!(h=new Z.stateConstructor).hasOwnProperty("Fd"))throw new Error(`Component ${Z.name} stateConstructor type does not have property __id`)}else h=Object.assign({},{Fd:R},Z.state,B);if(h.Fd=R,Z.multi){var Y=z.hash[R];Y||(Y=[],z.add(R,Y)),Y.push(h)}else z.add(R,h);return Z.sd&&Z.sd(R,h),this},this.ff=function(R,q){var L=N[q];if(!L)throw new Error(`Unknown component: ${q}.`);return!!L.hash[R]},this.Ze=function(q,L){if(!N[L])throw new Error(`Unknown component: ${L}.`);return Y(q,L),R},this.getState=function(R,q){var L=N[q];if(!L)throw new Error(`Unknown component: ${q}.`);return L.hash[R]},this.vg=function(R){var q=N[R];if(!q)throw new Error(`Unknown component: ${R}.`);return e(),q.list},this.sk=function(R){if(!N[R])throw new Error(`Unknown component: ${R}.`);var q=N[R].hash;return R=>q[R]},this.vk=function(R){if(!N[R])throw new Error(`Unknown component: ${R}.`);var q=N[R].hash;return R=>!!q[R]},this.yd=function(L){e();for(var B=0;B<h.length;B++){var Z=h[B],z=q[Z],Y=N[Z];z.system(L,Y.list),e()}return R},this.render=function(L){e();for(var B=0;B<Z.length;B++){var h=Z[B],z=q[h],Y=N[h];z.Id(L,Y.list),e()}return R},this.removeMultiComponent=function(L,B,h){var Z=q[B],Y=N[B];if(!Y)throw new Error(`Unknown component: ${B}.`);if(!Z.multi)throw new Error("removeMultiComponent called on non-multi component");return function(R,q,L,B){var N=L.hash[R];if(N){var h=N[B];h&&(N[B]=null,q.ab&&q.ab(R,h),z.multiComps.push({entID:R,data:L}),F())}}(L,Z,Y,h),R}};var B=L(12230)},12230:R=>{function q(R,q){var L=R._map[q];if(delete R.hash[q],delete R._map[q],L===R.list.length-1)R.list.pop();else{var B=R.list.pop();if(R.list[L]=B,null===B||null===B[0]){var N=R.list.length;for(var h in R._map)if(R._map[h]===N)return void(R._map[h]=L)}else{var Z=B.Fd||B[0].Fd;R._map[Z]=L}}}R.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(R,q){if("number"===typeof this._map[R]){var L=this._map[R];this.hash[R]=q,this.list[L]=q}else this._map[R]=this.list.length,this.hash[R]=q,this.list.push(q)}remove(R){var q=this._map[R];this.hash[R]=null,this.list[q]=null,this._pendingRemovals.push(R)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var R=0;R<this._pendingRemovals.length;R++){var L=this._pendingRemovals[R];null===this.hash[L]&&q(this,L)}this._pendingRemovals.length=0}}},12491:R=>{"use strict";R.exports=function(R,q,L,B,N,h){var Z=+q[0],z=+q[1],Y=+q[2],F=+L[0],C=+L[1],e=+L[2],y=Math.sqrt(F*F+C*C+e*e);if(0===y)throw new Error("Can't raycast along a zero vector");return function(R,q,L,B,N,h,Z,z,Y,F){for(var C=0,e=Math.floor,y=0|e(q),U=0|e(L),n=0|e(B),r=N>0?1:-1,p=h>0?1:-1,c=Z>0?1:-1,d=Math.abs(1/N),f=Math.abs(1/h),v=Math.abs(1/Z),T=d<1/0?d*(r>0?y+1-q:q-y):1/0,t=f<1/0?f*(p>0?U+1-L:L-U):1/0,D=v<1/0?v*(c>0?n+1-B:B-n):1/0,S=-1;C<=z;){var I=R(y,U,n);if(I)return Y&&(Y[0]=q+C*N,Y[1]=L+C*h,Y[2]=B+C*Z),F&&(F[0]=F[1]=F[2]=0,0===S&&(F[0]=-r),1===S&&(F[1]=-p),2===S&&(F[2]=-c)),I;T<t?T<D?(y+=r,C=T,T+=d,S=0):(n+=c,C=D,D+=v,S=2):t<D?(U+=p,C=t,t+=f,S=1):(n+=c,C=D,D+=v,S=2)}return Y&&(Y[0]=q+C*N,Y[1]=L+C*h,Y[2]=B+C*Z),F&&(F[0]=F[1]=F[2]=0),0}(R,Z,z,Y,F/=y,C/=y,e/=y,B="undefined"===typeof B?64:+B,N,h)}},12526:(R,q,L)=>{"use strict";L.d(q,{c:()=>h});var B=L(676);function N(){this.qj=!1,this.stopPropagation=!1,this.rj=!1,this.disabled=!1}class h{constructor(R,q){this.version="0.7.0";var L=Object.assign({},new N,q||{});this.element=R||document,this.qj=!!L.qj,this.stopPropagation=!!L.stopPropagation,this.rj=!!L.rj,this.disabled=!!L.disabled,this.filterEvents=(R,q)=>!0,this.down=new B.EventEmitter,this.up=new B.EventEmitter,this.state={},this.lg={dx:0,dy:0,ik:0,kg:0,jk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?z(this):document.addEventListener("DOMContentLoaded",(R=>{z(this)}),{once:!0})}bind(R){for(var q=arguments.length,L=new Array(q>1?q-1:0),B=1;B<q;B++)L[B-1]=arguments[B];L.forEach((q=>{var L=this._keyBindmap[q]||[];L.includes(R)||(L.push(R),this._keyBindmap[q]=L)})),this.state[R]=!!this.state[R],this.pressCount[R]=this.pressCount[R]||0,this.releaseCount[R]=this.releaseCount[R]||0}unbind(R){for(var q in this._keyBindmap){var L=this._keyBindmap[q],B=L.indexOf(R);B>-1&&L.splice(B,1)}}getBindings(){var R={};for(var q in this._keyBindmap){this._keyBindmap[q].forEach((L=>{R[L]=R[L]||[],R[L].push(q)}))}return R}yd(){Z(this.lg),Z(this.pressCount),Z(this.releaseCount)}}function Z(R){for(var q in R)R[q]=0}function z(R){window.addEventListener("keydown",n.bind(null,R,!0),!1),window.addEventListener("keyup",n.bind(null,R,!1),!1);var q={passive:!0};R.element.addEventListener("touchstart",e.bind(void 0,R),{passive:!1}),R.element.addEventListener("touchend",U.bind(void 0,R),q),R.element.addEventListener("mousedown",r.bind(null,R,!0),q),window.document.addEventListener("mouseup",r.bind(null,R,!1),q),R.element.addEventListener("touchmove",p.bind(null,R),q),R.element.addEventListener("mousemove",p.bind(null,R),q),window.PointerEvent,R.element.addEventListener("wheel",c.bind(null,R),q),R.element.addEventListener("contextmenu",d.bind(null,R),!1),window.addEventListener("blur",f.bind(null,R),!1)}var Y=0,F=0,C=null;function e(R,q){q.preventDefault(),y(q)}function y(R){let q=!1;for(let L=0;L<R.touches.length;++L)if(R.touches[L].identifier===C){q=!0;break}if(!q){const q=R.changedTouches[0];Y=q.clientX,F=q.clientY,C=q.identifier}}function U(R,q){for(var L=q.changedTouches,B=0;B<L.length;++B)L[B].identifier===C&&(C=null)}function n(R,q,L){v(L.code,q,R,L)}function r(R,q,L){if("pointerId"in L)if(q){if(null!==R._touches.currID)return;R._touches.currID=L.pointerId}else{if(R._touches.currID!==L.pointerId)return;R._touches.currID=null}return v("Mouse"+("button"in L?L.button+1:1),q,R,L),!1}function p(R,q){var L=q.movementX||q.mozMovementX||0,B=q.movementY||q.mozMovementY||0;if(q.touches&&0===(L|B)){var N=function(R){y(R);for(let q=0;q<R.changedTouches.length;++q)if(R.changedTouches[q].identifier==C){const L=R.changedTouches[q],B=[L.clientX-Y,L.clientY-F];return Y=L.clientX,F=L.clientY,B}return console.error(`Did not find touch id ${C}`),[0,0]}(q);L=N[0],B=N[1]}R.lg.dx+=L,R.lg.dy+=B}function c(R,q){var L=1;switch(q.deltaMode){case 0:L=1;break;case 1:L=12;break;case 2:L=R.element.clientHeight||window.innerHeight}R.lg.ik+=(q.deltaX||0)*L,R.lg.kg+=(q.deltaY||0)*L,R.lg.jk+=(q.deltaZ||0)*L}function d(R,q){if(!R.rj)return q.preventDefault(),!1}function f(R){for(var q in R._keyStates)R._keyStates[q]&&(/^Mouse\d/.test(q)||v(q,!1,R,{code:q,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function v(R,q,L,B){var N=L._keyBindmap[R];N&&(T(L._keyStates[R],q)&&(L._keyStates[R]=q,N.forEach((R=>{(!L.filterEvents||L.filterEvents(B,R))&&function(R,q,L,B){var N=q?L.pressCount:L.releaseCount;N[R]=(N[R]||0)+1;var h=L._bindPressCount[R]||0;(h+=q?1:-1)<0&&(h=0);L._bindPressCount[R]=h;var Z=L.state[R];if(T(Z,h)){L.state[R]=h>0;var z=q?L.down:L.up;L.disabled||z.emit(R,B)}}(R,q,L,B)}))),"button"in B||(L.qj&&!B.defaultPrevented&&B.preventDefault(),L.stopPropagation&&B.stopPropagation()))}function T(R,q){return R?!q:q}},10748:R=>{"use strict";R.exports=function(R){for(var q=new Array(R),L=0;L<R;++L)q[L]=L;return q}},10750:R=>{function q(R){return!!R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}R.exports=function(R){return null!=R&&(q(R)||function(R){return"function"===typeof R.readFloatLE&&"function"===typeof R.slice&&q(R.slice(0,0))}(R)||!!R._isBuffer)}},12494:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Wh=!1,this.Xh=!1,this.Uh=30,this.Vh=0,this.di=!1,this.fullscreen=!1,this.Zh=function(R){},this.$h=function(){},this.bi=function(){},this.bb=function(){},this._h=function(R){},this.onFullscreenChanged=function(R){},F((()=>{!function(R,q){R._nowObject=performance||Date,R._lastTick=0,R._renderAccum=0,R._rt=0,R._frameCB=z.bind(null,R),requestAnimationFrame(R._frameCB),q>0&&(R._intervalCB=Z.bind(null,R),R._interval=setInterval(R._intervalCB,Math.max(q,1e3/R.Uh/2)))}(this,q),function(R,q){if(!q)return;var L=!1,B=!1;document.addEventListener("pointerlockchange",(B=>{L=document.pointerLockElement===q,R._h(L)})),document.addEventListener("fullscreenchange",(L=>{B=document.fullscreenElement===q,R.onFullscreenChanged(B)})),Object.defineProperty(R,"di",{get:()=>L,set:R=>{R&&!L?Y(q):L&&!R&&function(R){R.exitPointerLock&&R.exitPointerLock()}(document)}}),Object.defineProperty(R,"fullscreen",{get:()=>B,set:R=>{R&&!B?q.requestFullscreen():B&&!R&&document.exitFullscreen()}}),q.addEventListener("click",(N=>{R.Wh&&!L&&Y(q),R.Xh&&!B&&q.requestFullscreen()}));var N=()=>R.bb();if(window.ResizeObserver){new ResizeObserver(N).observe(q)}else window.addEventListener("resize",N)}(this,R),this.bi()}))}}var N=3,h=20;function Z(R){for(var q=1e3/R.Uh,L=R._nowObject.now()+h,B=0;R._nowObject.now()>=R._lastTick+q&&R._nowObject.now()<L&&++B<=N;)R.Zh(q),R._lastTick+=q;var Z=5*(q+5),z=R._nowObject.now();if(z-R._lastTick>Z)for(;z>=R._lastTick+q;)R._lastTick+=q}function z(R){requestAnimationFrame(R._frameCB),Z(R);var q=R._nowObject.now(),L=q-R._rt;if(R._rt=q,R.Vh>0){R._renderAccum+=L;var B=1e3/R.Vh;if(R._renderAccum<B)return;R._renderAccum=Math.min(R._renderAccum-B,B)}var N=1e3/R.Uh,h=(q-R._lastTick)/N;R.$h(L,h,N)}function Y(R){R.requestPointerLock&&R.requestPointerLock()}var F=R=>{if("loading"===document.readyState){var q=()=>{document.removeEventListener("readystatechange",q),R()};document.addEventListener("readystatechange",q)}else setTimeout(R,1)}},10744:(R,q,L)=>{var B=L(10748),N=L(10750),h="undefined"!==typeof Float64Array;function Z(R,q){return R[0]-q[0]}function z(){var R,q=this.stride,L=new Array(q.length);for(R=0;R<L.length;++R)L[R]=[Math.abs(q[R]),R];L.sort(Z);var B=new Array(L.length);for(R=0;R<B.length;++R)B[R]=L[R][1];return B}function Y(R,q){var L=["View",q,"d",R].join("");q<0&&(L="View_Nil"+R);var N="generic"===R;if(-1===q){var h="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+R+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(h)()}if(0===q){h="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+R+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",h)(F[R][0])}h=["'use strict'"];var Z=B(q),Y=Z.map((function(R){return"i"+R})),C="this.offset+"+Z.map((function(R){return"this.stride["+R+"]*i"+R})).join("+"),e=Z.map((function(R){return"b"+R})).join(","),y=Z.map((function(R){return"c"+R})).join(",");h.push("function "+L+"(a,"+e+","+y+",d){this.data=a","this.shape=["+e+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+R+"'","proto.dimension="+q),h.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+Z.map((function(R){return"this.shape["+R+"]"})).join("*"),"}})"),1===q?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),q<4?(h.push("function "+L+"_order(){"),2===q?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===q&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+L+"_set("+Y.join(",")+",v){"),N?h.push("return this.data.set("+C+",v)}"):h.push("return this.data["+C+"]=v}"),h.push("proto.get=function "+L+"_get("+Y.join(",")+"){"),N?h.push("return this.data.get("+C+")}"):h.push("return this.data["+C+"]}"),h.push("proto.index=function "+L+"_index(",Y.join(),"){return "+C+"}"),h.push("proto.hi=function "+L+"_hi("+Y.join(",")+"){return new "+L+"(this.data,"+Z.map((function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")})).join(",")+","+Z.map((function(R){return"this.stride["+R+"]"})).join(",")+",this.offset)}");var U=Z.map((function(R){return"a"+R+"=this.shape["+R+"]"})),n=Z.map((function(R){return"c"+R+"=this.stride["+R+"]"}));h.push("proto.lo=function "+L+"_lo("+Y.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+n.join(","));for(var r=0;r<q;++r)h.push("if(typeof i"+r+"==='number'&&i"+r+">=0){d=i"+r+"|0;b+=c"+r+"*d;a"+r+"-=d}");h.push("return new "+L+"(this.data,"+Z.map((function(R){return"a"+R})).join(",")+","+Z.map((function(R){return"c"+R})).join(",")+",b)}"),h.push("proto.step=function "+L+"_step("+Y.join(",")+"){var "+Z.map((function(R){return"a"+R+"=this.shape["+R+"]"})).join(",")+","+Z.map((function(R){return"b"+R+"=this.stride["+R+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(r=0;r<q;++r)h.push("if(typeof i"+r+"==='number'){d=i"+r+"|0;if(d<0){c+=b"+r+"*(a"+r+"-1);a"+r+"=ceil(-a"+r+"/d)}else{a"+r+"=ceil(a"+r+"/d)}b"+r+"*=d}");h.push("return new "+L+"(this.data,"+Z.map((function(R){return"a"+R})).join(",")+","+Z.map((function(R){return"b"+R})).join(",")+",c)}");var p=new Array(q),c=new Array(q);for(r=0;r<q;++r)p[r]="a[i"+r+"]",c[r]="b[i"+r+"]";h.push("proto.transpose=function "+L+"_transpose("+Y+"){"+Y.map((function(R,q){return R+"=("+R+"===undefined?"+q+":"+R+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+p.join(",")+","+c.join(",")+",this.offset)}"),h.push("proto.pick=function "+L+"_pick("+Y+"){var a=[],b=[],c=this.offset");for(r=0;r<q;++r)h.push("if(typeof i"+r+"==='number'&&i"+r+">=0){c=(c+this.stride["+r+"]*i"+r+")|0}else{a.push(this.shape["+r+"]);b.push(this.stride["+r+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+Z.map((function(R){return"shape["+R+"]"})).join(",")+","+Z.map((function(R){return"stride["+R+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(F[R],z)}var F={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};R.exports=function(R,q,L,B){if(void 0===R)return(0,F.array[0])([]);"number"===typeof R&&(R=[R]),void 0===q&&(q=[R.length]);var Z=q.length;if(void 0===L){L=new Array(Z);for(var z=Z-1,C=1;z>=0;--z)L[z]=C,C*=q[z]}if(void 0===B){B=0;for(z=0;z<Z;++z)L[z]<0&&(B-=(q[z]-1)*L[z])}for(var e=function(R){if(N(R))return"buffer";if(h)switch(Object.prototype.toString.call(R)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(R)?"array":"generic"}(R),y=F[e];y.length<=Z+1;)y.push(Y(e,y.length-1));return(0,y[Z+1])(R,q,L,B)}},10723:R=>{var q;self,q=()=>(()=>{"use strict";var R={d:(q,L)=>{for(var B in L)R.o(L,B)&&!R.o(q,B)&&Object.defineProperty(q,B,{enumerable:!0,get:L[B]})},o:(R,q)=>Object.prototype.hasOwnProperty.call(R,q)},q={};R.d(q,{default:()=>H});var L,B=function(R,q){var L=q.x-R.x,B=q.y-R.y;return Math.sqrt(L*L+B*B)},N=function(R){return R*(Math.PI/180)},h=new Map,Z=function(R){h.has(R)&&clearTimeout(h.get(R)),h.set(R,setTimeout(R,100))},z=function(R,q,L){for(var B,N=q.split(/[ ,]+/g),h=0;h<N.length;h+=1)B=N[h],R.addEventListener?R.addEventListener(B,L,!1):R.attachEvent&&R.attachEvent(B,L)},Y=function(R,q,L){for(var B,N=q.split(/[ ,]+/g),h=0;h<N.length;h+=1)B=N[h],R.removeEventListener?R.removeEventListener(B,L):R.detachEvent&&R.detachEvent(B,L)},F=function(R){return R.preventDefault(),R.type.match(/^touch/)?R.changedTouches:R},C=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},e=function(R,q){q.top||q.right||q.bottom||q.left?(R.style.top=q.top,R.style.right=q.right,R.style.bottom=q.bottom,R.style.left=q.left):(R.style.left=q.x+"px",R.style.top=q.y+"px")},y=function(R,q,L){var B=U(R);for(var N in B)if(B.hasOwnProperty(N))if("string"==typeof q)B[N]=q+" "+L;else{for(var h="",Z=0,z=q.length;Z<z;Z+=1)h+=q[Z]+" "+L+", ";B[N]=h.slice(0,-2)}return B},U=function(R){var q={};return q[R]="",["webkit","Moz","o"].forEach((function(L){q[L+R.charAt(0).toUpperCase()+R.slice(1)]=""})),q},n=function(R,q){for(var L in q)q.hasOwnProperty(L)&&(R[L]=q[L]);return R},r=function(R,q){if(R.length)for(var L=0,B=R.length;L<B;L+=1)q(R[L]);else q(R)},p="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,c=window.matchMedia("(any-hover: none)").matches,d=!!("ontouchstart"in window),f=!!window.PointerEvent,v=!!window.MSPointerEvent,T={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},t={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function S(){}p&&!c?L=T:f?L={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:v?L={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:d?(L=T,D=t):L=t,S.prototype.on=function(R,q){var L,B=this,N=R.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var h=0;h<N.length;h+=1)L=N[h],B._handlers_[L]=B._handlers_[L]||[],B._handlers_[L].push(q);return B},S.prototype.off=function(R,q){var L=this;return L._handlers_=L._handlers_||{},void 0===R?L._handlers_={}:void 0===q?L._handlers_[R]=null:L._handlers_[R]&&L._handlers_[R].indexOf(q)>=0&&L._handlers_[R].splice(L._handlers_[R].indexOf(q),1),L},S.prototype.trigger=function(R,q){var L,B=this,N=R.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var h=0;h<N.length;h+=1)L=N[h],B._handlers_[L]&&B._handlers_[L].length&&B._handlers_[L].forEach((function(R){R.call(B,{type:L,target:B},q)}))},S.prototype.config=function(R){var q=this;q.options=q.defaults||{},R&&(q.options=function(R,q){var L={};for(var B in R)R.hasOwnProperty(B)&&q.hasOwnProperty(B)?L[B]=q[B]:R.hasOwnProperty(B)&&(L[B]=R[B]);return L}(q.options,R))},S.prototype.bindEvt=function(R,q){var B=this;return B._domHandlers_=B._domHandlers_||{},B._domHandlers_[q]=function(){"function"==typeof B["on"+q]?B["on"+q].apply(B,arguments):console.warn('[WARNING] : Missing "on'+q+'" handler.')},z(R,L[q],B._domHandlers_[q]),D[q]&&z(R,D[q],B._domHandlers_[q]),B},S.prototype.unbindEvt=function(R,q){var B=this;return B._domHandlers_=B._domHandlers_||{},Y(R,L[q],B._domHandlers_[q]),D[q]&&Y(R,D[q],B._domHandlers_[q]),delete B._domHandlers_[q],this};const I=S;function K(R,q){return this.identifier=q.identifier,this.position=q.position,this.frontPosition=q.frontPosition,this.collection=R,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(q),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new I,K.constructor=K,K.id=0,K.prototype.buildEl=function(R){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var R=this.options.fadeTime+"ms",q=function(){var R=U("borderRadius");for(var q in R)R.hasOwnProperty(q)&&(R[q]="50%");return R}(),L=y("transition","opacity",R),B={};return B.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},B.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},B.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},n(B.el,L),"circle"===this.options.shape&&n(B.back,q),n(B.front,q),this.applyStyles(B),this},K.prototype.applyStyles=function(R){for(var q in this.ui)if(this.ui.hasOwnProperty(q))for(var L in R[q])this.ui[q].style[L]=R[q][L];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(R){var q=this;return q.options.dataOnly||(clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.addToDom(),q.restCallback(),setTimeout((function(){q.ui.el.style.opacity=1}),0),q.showTimeout=setTimeout((function(){q.trigger("shown",q.instance),"function"==typeof R&&R.call(this)}),q.options.fadeTime)),q},K.prototype.hide=function(R){var q=this;if(q.options.dataOnly)return q;if(q.ui.el.style.opacity=q.options.restOpacity,clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.removeTimeout=setTimeout((function(){var L="dynamic"===q.options.mode?"none":"block";q.ui.el.style.display=L,"function"==typeof R&&R.call(q),q.trigger("hidden",q.instance)}),q.options.fadeTime),q.options.restJoystick){var L=q.options.restJoystick,B={};B.x=!0===L||!1!==L.x?0:q.instance.frontPosition.x,B.y=!0===L||!1!==L.y?0:q.instance.frontPosition.y,q.setPosition(R,B)}return q},K.prototype.setPosition=function(R,q){var L=this;L.frontPosition={x:q.x,y:q.y};var B=L.options.fadeTime+"ms",N={};N.front=y("transition",["transform"],B);var h={front:{}};h.front={transform:"translate("+L.frontPosition.x+"px,"+L.frontPosition.y+"px)"},L.applyStyles(N),L.applyStyles(h),L.restTimeout=setTimeout((function(){"function"==typeof R&&R.call(L),L.restCallback()}),L.options.fadeTime)},K.prototype.restCallback=function(){var R=this,q={};q.front=y("transition","none",""),R.applyStyles(q),R.trigger("rested",R.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(R){var q,L,B,N=R.angle.radian,h=Math.PI/4,Z=Math.PI/2;if(N>h&&N<3*h&&!R.lockX?q="up":N>-h&&N<=h&&!R.lockY?q="left":N>3*-h&&N<=-h&&!R.lockX?q="down":R.lockY||(q="right"),R.lockY||(L=N>-Z&&N<Z?"left":"right"),R.lockX||(B=N>0?"up":"down"),R.force>this.options.threshold){var z,Y={};for(z in this.direction)this.direction.hasOwnProperty(z)&&(Y[z]=this.direction[z]);var F={};for(z in this.direction={x:L,y:B,angle:q},R.direction=this.direction,Y)Y[z]===this.direction[z]&&(F[z]=!0);if(F.x&&F.y&&F.angle)return R;F.x&&F.y||this.trigger("plain",R),F.x||this.trigger("plain:"+L,R),F.y||this.trigger("plain:"+B,R),F.angle||this.trigger("dir dir:"+q,R)}else this.resetDirection();return R};const m=K;function o(R,q){var L=this;L.nipples=[],L.idles=[],L.actives=[],L.ids=[],L.pressureIntervals={},L.manager=R,L.id=o.id,o.id+=1,L.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},L.config(q),"static"!==L.options.mode&&"semi"!==L.options.mode||(L.options.multitouch=!1),L.options.multitouch||(L.options.maxNumberOfNipples=1);var B=getComputedStyle(L.options.zone.parentElement);return B&&"flex"===B.display&&(L.parentIsFlex=!0),L.updateBox(),L.prepareNipples(),L.sj(),L.begin(),L.nipples}o.prototype=new I,o.constructor=o,o.id=0,o.prototype.prepareNipples=function(){var R=this,q=R.nipples;q.on=R.on.bind(R),q.off=R.off.bind(R),q.options=R.options,q.destroy=R.destroy.bind(R),q.ids=R.ids,q.id=R.id,q.processOnMove=R.processOnMove.bind(R),q.processOnEnd=R.processOnEnd.bind(R),q.get=function(R){if(void 0===R)return q[0];for(var L=0,B=q.length;L<B;L+=1)if(q[L].identifier===R)return q[L];return!1}},o.prototype.sj=function(){var R=this;R.bindEvt(R.options.zone,"start"),R.options.zone.style.touchAction="none",R.options.zone.style.msTouchAction="none"},o.prototype.begin=function(){var R=this,q=R.options;if("static"===q.mode){var L=R.createNipple(q.position,R.manager.getIdentifier());L.add(),R.idles.push(L)}},o.prototype.createNipple=function(R,q){var L=this,B=L.manager.scroll,N={},h=L.options,Z=L.parentIsFlex?B.x:B.x+L.box.left,z=L.parentIsFlex?B.y:B.y+L.box.top;if(R.x&&R.y)N={x:R.x-Z,y:R.y-z};else if(R.top||R.right||R.bottom||R.left){var Y=document.createElement("DIV");Y.style.display="hidden",Y.style.top=R.top,Y.style.right=R.right,Y.style.bottom=R.bottom,Y.style.left=R.left,Y.style.position="absolute",h.zone.appendChild(Y);var F=Y.getBoundingClientRect();h.zone.removeChild(Y),N=R,R={x:F.left+B.x,y:F.top+B.y}}var C=new m(L,{color:h.color,size:h.size,threshold:h.threshold,fadeTime:h.fadeTime,dataOnly:h.dataOnly,restJoystick:h.restJoystick,restOpacity:h.restOpacity,mode:h.mode,identifier:q,position:R,zone:h.zone,frontPosition:{x:0,y:0},shape:h.shape});return h.dataOnly||(e(C.ui.el,N),e(C.ui.front,C.frontPosition)),L.nipples.push(C),L.trigger("added "+C.identifier+":added",C),L.manager.trigger("added "+C.identifier+":added",C),L.bindNipple(C),C},o.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},o.prototype.bindNipple=function(R){var q,L=this,B=function(R,B){q=R.type+" "+B.id+":"+R.type,L.trigger(q,B)};R.on("destroyed",L.onDestroyed.bind(L)),R.on("shown hidden rested dir plain",B),R.on("dir:up dir:right dir:down dir:left",B),R.on("plain:up plain:right plain:down plain:left",B)},o.prototype.pressureFn=function(R,q,L){var B=this,N=0;clearInterval(B.pressureIntervals[L]),B.pressureIntervals[L]=setInterval(function(){var L=R.force||R.pressure||R.webkitForce||0;L!==N&&(q.trigger("pressure",L),B.trigger("pressure "+q.identifier+":pressure",L),N=L)}.bind(B),100)},o.prototype.onstart=function(R){var q=this,L=q.options,B=R;return R=F(R),q.updateBox(),r(R,(function(N){q.actives.length<L.maxNumberOfNipples?q.processOnStart(N):B.type.match(/^touch/)&&(Object.keys(q.manager.ids).forEach((function(L){if(Object.values(B.touches).findIndex((function(R){return R.identifier===L}))<0){var N=[R[0]];N.identifier=L,q.processOnEnd(N)}})),q.actives.length<L.maxNumberOfNipples&&q.processOnStart(N))})),q.manager.bindDocument(),!1},o.prototype.processOnStart=function(R){var q,L=this,N=L.options,h=L.manager.getIdentifier(R),Z=R.force||R.pressure||R.webkitForce||0,z={x:R.pageX,y:R.pageY},Y=L.getOrCreate(h,z);Y.identifier!==h&&L.manager.removeIdentifier(Y.identifier),Y.identifier=h;var F=function(q){q.trigger("start",q),L.trigger("start "+q.id+":start",q),q.show(),Z>0&&L.pressureFn(R,q,q.identifier),L.processOnMove(R)};if((q=L.idles.indexOf(Y))>=0&&L.idles.splice(q,1),L.actives.push(Y),L.ids.push(Y.identifier),"semi"!==N.mode)F(Y);else{if(!(B(z,Y.position)<=N.catchDistance))return Y.destroy(),void L.processOnStart(R);F(Y)}return Y},o.prototype.getOrCreate=function(R,q){var L,B=this,N=B.options;return/(semi|static)/.test(N.mode)?(L=B.idles[0])?(B.idles.splice(0,1),L):"semi"===N.mode?B.createNipple(q,R):(console.warn("Coudln't find the needed nipple."),!1):L=B.createNipple(q,R)},o.prototype.processOnMove=function(R){var q=this,L=q.options,h=q.manager.getIdentifier(R),Z=q.nipples.get(h),z=q.manager.scroll;if(function(R){return isNaN(R.buttons)?0!==R.pressure:0!==R.buttons}(R)){if(!Z)return console.error("Found zombie joystick with ID "+h),void q.manager.removeIdentifier(h);if(L.dynamicPage){var Y=Z.el.getBoundingClientRect();Z.position={x:z.x+Y.left,y:z.y+Y.top}}Z.identifier=h;var F=Z.options.size/2,C={x:R.pageX,y:R.pageY};L.lockX&&(C.y=Z.position.y),L.lockY&&(C.x=Z.position.x);var e,y,U,n,r,p,c,d,f,v,T=B(C,Z.position),t=(e=C,U=(y=Z.position).x-e.x,n=y.y-e.y,function(R){return R*(180/Math.PI)}(Math.atan2(n,U))),D=N(t),S=T/F,I={distance:T,position:C};if("circle"===Z.options.shape?(r=Math.min(T,F),c=Z.position,d=r,v={x:0,y:0},f=N(f=t),v.x=c.x-d*Math.cos(f),v.y=c.y-d*Math.sin(f),p=v):(p=function(R,q,L){return{x:Math.min(Math.max(R.x,q.x-L),q.x+L),y:Math.min(Math.max(R.y,q.y-L),q.y+L)}}(C,Z.position,F),r=B(p,Z.position)),L.follow){if(T>F){var K=C.x-p.x,m=C.y-p.y;Z.position.x+=K,Z.position.y+=m,Z.el.style.top=Z.position.y-(q.box.top+z.y)+"px",Z.el.style.left=Z.position.x-(q.box.left+z.x)+"px",T=B(C,Z.position)}}else C=p,T=r;var o=C.x-Z.position.x,l=C.y-Z.position.y;Z.frontPosition={x:o,y:l},L.dataOnly||(Z.ui.front.style.transform="translate("+o+"px,"+l+"px)");var G={identifier:Z.identifier,position:C,force:S,pressure:R.force||R.pressure||R.webkitForce||0,distance:T,angle:{radian:D,degree:t},vector:{x:o/F,y:-l/F},raw:I,instance:Z,lockX:L.lockX,lockY:L.lockY};(G=Z.computeDirection(G)).angle={radian:N(180-t),degree:180-t},Z.trigger("move",G),q.trigger("move "+Z.id+":move",G)}else this.processOnEnd(R)},o.prototype.processOnEnd=function(R){var q=this,L=q.options,B=q.manager.getIdentifier(R),N=q.nipples.get(B),h=q.manager.removeIdentifier(N.identifier);N&&(L.dataOnly||N.hide((function(){"dynamic"===L.mode&&(N.trigger("removed",N),q.trigger("removed "+N.id+":removed",N),q.manager.trigger("removed "+N.id+":removed",N),N.destroy())})),clearInterval(q.pressureIntervals[N.identifier]),N.resetDirection(),N.trigger("end",N),q.trigger("end "+N.id+":end",N),q.ids.indexOf(N.identifier)>=0&&q.ids.splice(q.ids.indexOf(N.identifier),1),q.actives.indexOf(N)>=0&&q.actives.splice(q.actives.indexOf(N),1),/(semi|static)/.test(L.mode)?q.idles.push(N):q.nipples.indexOf(N)>=0&&q.nipples.splice(q.nipples.indexOf(N),1),q.manager.unbindDocument(),/(semi|static)/.test(L.mode)&&(q.manager.ids[h.id]=h.identifier))},o.prototype.onDestroyed=function(R,q){var L=this;L.nipples.indexOf(q)>=0&&L.nipples.splice(L.nipples.indexOf(q),1),L.actives.indexOf(q)>=0&&L.actives.splice(L.actives.indexOf(q),1),L.idles.indexOf(q)>=0&&L.idles.splice(L.idles.indexOf(q),1),L.ids.indexOf(q.identifier)>=0&&L.ids.splice(L.ids.indexOf(q.identifier),1),L.manager.removeIdentifier(q.identifier),L.manager.unbindDocument()},o.prototype.destroy=function(){var R=this;for(var q in R.unbindEvt(R.options.zone,"start"),R.nipples.forEach((function(R){R.destroy()})),R.pressureIntervals)R.pressureIntervals.hasOwnProperty(q)&&clearInterval(R.pressureIntervals[q]);R.trigger("destroyed",R.nipples),R.manager.unbindDocument(),R.off()};const l=o;function G(R){var q=this;q.ids={},q.index=0,q.collections=[],q.scroll=C(),q.config(R),q.prepareCollections();var L=function(){var R;q.collections.forEach((function(L){L.forEach((function(L){R=L.el.getBoundingClientRect(),L.position={x:q.scroll.x+R.left,y:q.scroll.y+R.top}}))}))};z(window,"resize",(function(){Z(L)}));var B=function(){q.scroll=C()};return z(window,"scroll",(function(){Z(B)})),q.collections}G.prototype=new I,G.constructor=G,G.prototype.prepareCollections=function(){var R=this;R.collections.create=R.create.bind(R),R.collections.on=R.on.bind(R),R.collections.off=R.off.bind(R),R.collections.destroy=R.destroy.bind(R),R.collections.get=function(q){var L;return R.collections.every((function(R){return!(L=R.get(q))})),L}},G.prototype.create=function(R){return this.createCollection(R)},G.prototype.createCollection=function(R){var q=this,L=new l(q,R);return q.bindCollection(L),q.collections.push(L),L},G.prototype.bindCollection=function(R){var q,L=this,B=function(R,B){q=R.type+" "+B.id+":"+R.type,L.trigger(q,B)};R.on("destroyed",L.onDestroyed.bind(L)),R.on("shown hidden rested dir plain",B),R.on("dir:up dir:right dir:down dir:left",B),R.on("plain:up plain:right plain:down plain:left",B)},G.prototype.bindDocument=function(){var R=this;R.binded||(R.bindEvt(document,"move").bindEvt(document,"end"),R.binded=!0)},G.prototype.unbindDocument=function(R){var q=this;Object.keys(q.ids).length&&!0!==R||(q.unbindEvt(document,"move").unbindEvt(document,"end"),q.binded=!1)},G.prototype.getIdentifier=function(R){var q;return R?void 0===(q=void 0===R.identifier?R.pointerId:R.identifier)&&(q=this.latest||0):q=this.index,void 0===this.ids[q]&&(this.ids[q]=this.index,this.index+=1),this.latest=q,this.ids[q]},G.prototype.removeIdentifier=function(R){var q={};for(var L in this.ids)if(this.ids[L]===R){q.id=L,q.identifier=this.ids[L],delete this.ids[L];break}return q},G.prototype.onmove=function(R){return this.onAny("move",R),!1},G.prototype.onend=function(R){return this.onAny("end",R),!1},G.prototype.oncancel=function(R){return this.onAny("end",R),!1},G.prototype.onAny=function(R,q){var L,B=this,N="processOn"+R.charAt(0).toUpperCase()+R.slice(1);q=F(q);var h=function(R,q,L){L.ids.indexOf(q)>=0&&(L[N](R),R._found_=!0)};return r(q,(function(R){L=B.getIdentifier(R),r(B.collections,h.bind(null,R,L)),R._found_||B.removeIdentifier(L)})),!1},G.prototype.destroy=function(){var R=this;R.unbindDocument(!0),R.ids={},R.index=0,R.collections.forEach((function(R){R.destroy()})),R.off()},G.prototype.onDestroyed=function(R,q){var L=this;if(L.collections.indexOf(q)<0)return!1;L.collections.splice(L.collections.indexOf(q),1)};var W=new G;const H={create:function(R){return W.create(R)},factory:W};return q.default})(),R.exports=q()},10922:(R,q,L)=>{"use strict";const{Deflate:B,deflate:N,deflateRaw:h,gzip:Z}=L(10931),{Inflate:z,inflate:Y,inflateRaw:F,ungzip:C}=L(10992),e=L(10962);R.exports.Deflate=B,R.exports.deflate=N,R.exports.deflateRaw=h,R.exports.gzip=Z,R.exports.Inflate=z,R.exports.inflate=Y,R.exports.inflateRaw=F,R.exports.ungzip=C,R.exports.constants=e},10931:(R,q,L)=>{"use strict";const B=L(10939),N=L(10968),h=L(10977),Z=L(10960),z=L(10984),Y=Object.prototype.toString,{Z_NO_FLUSH:F,Z_SYNC_FLUSH:C,Z_FULL_FLUSH:e,Z_FINISH:y,Z_OK:U,Z_STREAM_END:n,Z_DEFAULT_COMPRESSION:r,Z_DEFAULT_STRATEGY:p,Z_DEFLATED:c}=L(10962);function d(R){this.options=N.assign({level:r,method:c,Ja:16384,windowBits:15,memLevel:8,strategy:p},R||{});let q=this.options;q.raw&&q.windowBits>0?q.windowBits=-q.windowBits:q.gzip&&q.windowBits>0&&q.windowBits<16&&(q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let L=B.deflateInit2(this.strm,q.level,q.method,q.windowBits,q.memLevel,q.strategy);if(L!==U)throw new Error(Z[L]);if(q.header&&B.deflateSetHeader(this.strm,q.header),q.dictionary){let R;if(R="string"===typeof q.dictionary?h.string2buf(q.dictionary):"[object ArrayBuffer]"===Y.call(q.dictionary)?new Uint8Array(q.dictionary):q.dictionary,L=B.deflateSetDictionary(this.strm,R),L!==U)throw new Error(Z[L]);this._dict_set=!0}}function f(R,q){const L=new d(q);if(L.push(R,!0),L.err)throw L.msg||Z[L.err];return L.result}d.prototype.push=function(R,q){const L=this.strm,N=this.options.Ja;let Z,z;if(this.ended)return!1;for(z=q===~~q?q:!0===q?y:F,"string"===typeof R?L.input=h.string2buf(R):"[object ArrayBuffer]"===Y.call(R)?L.input=new Uint8Array(R):L.input=R,L.next_in=0,L.avail_in=L.input.length;;)if(0===L.avail_out&&(L.output=new Uint8Array(N),L.next_out=0,L.avail_out=N),(z===C||z===e)&&L.avail_out<=6)this.onData(L.output.subarray(0,L.next_out)),L.avail_out=0;else{if(Z=B.deflate(L,z),Z===n)return L.next_out>0&&this.onData(L.output.subarray(0,L.next_out)),Z=B.deflateEnd(this.strm),this.onEnd(Z),this.ended=!0,Z===U;if(0!==L.avail_out){if(z>0&&L.next_out>0)this.onData(L.output.subarray(0,L.next_out)),L.avail_out=0;else if(0===L.avail_in)break}else this.onData(L.output)}return!0},d.prototype.onData=function(R){this.chunks.push(R)},d.prototype.onEnd=function(R){R===U&&(this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg},R.exports.Deflate=d,R.exports.deflate=f,R.exports.deflateRaw=function(R,q){return(q=q||{}).raw=!0,f(R,q)},R.exports.gzip=function(R,q){return(q=q||{}).gzip=!0,f(R,q)},R.exports.constants=L(10962)},10992:(R,q,L)=>{"use strict";const B=L(11001),N=L(10968),h=L(10977),Z=L(10960),z=L(10984),Y=L(11020),F=Object.prototype.toString,{Z_NO_FLUSH:C,Z_FINISH:e,Z_OK:y,Z_STREAM_END:U,Z_NEED_DICT:n,Z_STREAM_ERROR:r,Z_DATA_ERROR:p,Z_MEM_ERROR:c}=L(10962);function d(R){this.options=N.assign({Ja:65536,windowBits:15,to:""},R||{});const q=this.options;q.raw&&q.windowBits>=0&&q.windowBits<16&&(q.windowBits=-q.windowBits,0===q.windowBits&&(q.windowBits=-15)),!(q.windowBits>=0&&q.windowBits<16)||R&&R.windowBits||(q.windowBits+=32),q.windowBits>15&&q.windowBits<48&&0===(15&q.windowBits)&&(q.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let L=B.inflateInit2(this.strm,q.windowBits);if(L!==y)throw new Error(Z[L]);if(this.header=new Y,B.inflateGetHeader(this.strm,this.header),q.dictionary&&("string"===typeof q.dictionary?q.dictionary=h.string2buf(q.dictionary):"[object ArrayBuffer]"===F.call(q.dictionary)&&(q.dictionary=new Uint8Array(q.dictionary)),q.raw&&(L=B.inflateSetDictionary(this.strm,q.dictionary),L!==y)))throw new Error(Z[L])}function f(R,q){const L=new d(q);if(L.push(R),L.err)throw L.msg||Z[L.err];return L.result}d.prototype.push=function(R,q){const L=this.strm,N=this.options.Ja,Z=this.options.dictionary;let z,Y,d;if(this.ended)return!1;for(Y=q===~~q?q:!0===q?e:C,"[object ArrayBuffer]"===F.call(R)?L.input=new Uint8Array(R):L.input=R,L.next_in=0,L.avail_in=L.input.length;;){for(0===L.avail_out&&(L.output=new Uint8Array(N),L.next_out=0,L.avail_out=N),z=B.inflate(L,Y),z===n&&Z&&(z=B.inflateSetDictionary(L,Z),z===y?z=B.inflate(L,Y):z===p&&(z=n));L.avail_in>0&&z===U&&L.state.wrap>0&&0!==R[L.next_in];)B.inflateReset(L),z=B.inflate(L,Y);switch(z){case r:case p:case n:case c:return this.onEnd(z),this.ended=!0,!1}if(d=L.avail_out,L.next_out&&(0===L.avail_out||z===U))if("string"===this.options.to){let R=h.utf8border(L.output,L.next_out),q=L.next_out-R,B=h.buf2string(L.output,R);L.next_out=q,L.avail_out=N-q,q&&L.output.set(L.output.subarray(R,R+q),0),this.onData(B)}else this.onData(L.output.length===L.next_out?L.output:L.output.subarray(0,L.next_out));if(z!==y||0!==d){if(z===U)return z=B.inflateEnd(this.strm),this.onEnd(z),this.ended=!0,!0;if(0===L.avail_in)break}}return!0},d.prototype.onData=function(R){this.chunks.push(R)},d.prototype.onEnd=function(R){R===y&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg},R.exports.Inflate=d,R.exports.inflate=f,R.exports.inflateRaw=function(R,q){return(q=q||{}).raw=!0,f(R,q)},R.exports.ungzip=f,R.exports.constants=L(10962)},10968:R=>{"use strict";const q=(R,q)=>Object.prototype.hasOwnProperty.call(R,q);R.exports.assign=function(R){const L=Array.prototype.slice.call(arguments,1);for(;L.length;){const B=L.shift();if(B){if("object"!==typeof B)throw new TypeError(B+"must be non-object");for(const L in B)q(B,L)&&(R[L]=B[L])}}return R},R.exports.flattenChunks=R=>{let q=0;for(let B=0,N=R.length;B<N;B++)q+=R[B].length;const L=new Uint8Array(q);for(let B=0,N=0,h=R.length;B<h;B++){let q=R[B];L.set(q,N),N+=q.length}return L}},10977:R=>{"use strict";let q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(B){q=!1}const L=new Uint8Array(256);for(let N=0;N<256;N++)L[N]=N>=252?6:N>=248?5:N>=240?4:N>=224?3:N>=192?2:1;L[254]=L[254]=1,R.exports.string2buf=R=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(R);let q,L,B,N,h,Z=R.length,z=0;for(N=0;N<Z;N++)L=R.charCodeAt(N),55296===(64512&L)&&N+1<Z&&(B=R.charCodeAt(N+1),56320===(64512&B)&&(L=65536+(L-55296<<10)+(B-56320),N++)),z+=L<128?1:L<2048?2:L<65536?3:4;for(q=new Uint8Array(z),h=0,N=0;h<z;N++)L=R.charCodeAt(N),55296===(64512&L)&&N+1<Z&&(B=R.charCodeAt(N+1),56320===(64512&B)&&(L=65536+(L-55296<<10)+(B-56320),N++)),L<128?q[h++]=L:L<2048?(q[h++]=192|L>>>6,q[h++]=128|63&L):L<65536?(q[h++]=224|L>>>12,q[h++]=128|L>>>6&63,q[h++]=128|63&L):(q[h++]=240|L>>>18,q[h++]=128|L>>>12&63,q[h++]=128|L>>>6&63,q[h++]=128|63&L);return q};R.exports.buf2string=(R,B)=>{const N=B||R.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(R.subarray(0,B));let h,Z;const z=new Array(2*N);for(Z=0,h=0;h<N;){let q=R[h++];if(q<128){z[Z++]=q;continue}let B=L[q];if(B>4)z[Z++]=65533,h+=B-1;else{for(q&=2===B?31:3===B?15:7;B>1&&h<N;)q=q<<6|63&R[h++],B--;B>1?z[Z++]=65533:q<65536?z[Z++]=q:(q-=65536,z[Z++]=55296|q>>10&1023,z[Z++]=56320|1023&q)}}return((R,L)=>{if(L<65534&&R.subarray&&q)return String.fromCharCode.apply(null,R.length===L?R:R.subarray(0,L));let B="";for(let q=0;q<L;q++)B+=String.fromCharCode(R[q]);return B})(z,Z)},R.exports.utf8border=(R,q)=>{(q=q||R.length)>R.length&&(q=R.length);let B=q-1;for(;B>=0&&128===(192&R[B]);)B--;return B<0||0===B?q:B+L[R[B]]>q?B:q}},10951:R=>{"use strict";R.exports=(R,q,L,B)=>{let N=65535&R,h=R>>>16&65535,Z=0;for(;0!==L;){Z=L>2e3?2e3:L,L-=Z;do{N=N+q[B++]|0,h=h+N|0}while(--Z);N%=65521,h%=65521}return N|h<<16}},10962:R=>{"use strict";R.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10954:R=>{"use strict";const q=new Uint32Array((()=>{let R,q=[];for(var L=0;L<256;L++){R=L;for(var B=0;B<8;B++)R=1&R?3988292384^R>>>1:R>>>1;q[L]=R}return q})());R.exports=(R,L,B,N)=>{const h=q,Z=N+B;R^=-1;for(let q=N;q<Z;q++)R=R>>>8^h[255&(R^L[q])];return~R}},10939:(R,q,L)=>{"use strict";const{_tr_init:B,_tr_stored_block:N,_tr_flush_block:h,_tr_tally:Z,_tr_align:z}=L(10945),Y=L(10951),F=L(10954),C=L(10960),{Z_NO_FLUSH:e,Z_PARTIAL_FLUSH:y,Z_FULL_FLUSH:U,Z_FINISH:n,Z_BLOCK:r,Z_OK:p,Z_STREAM_END:c,Z_STREAM_ERROR:d,Z_DATA_ERROR:f,Z_BUF_ERROR:v,Z_DEFAULT_COMPRESSION:T,Z_FILTERED:t,Z_HUFFMAN_ONLY:D,Z_RLE:S,Z_FIXED:I,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:m,Z_DEFLATED:o}=L(10962),l=258,G=262,W=103,H=113,P=666,O=(R,q)=>(R.msg=C[q],q),E=R=>(R<<1)-(R>4?9:0),a=R=>{let q=R.length;for(;--q>=0;)R[q]=0};let g=(R,q,L)=>(q<<R.hash_shift^L)&R.hash_mask;const Q=R=>{const q=R.state;let L=q.pending;L>R.avail_out&&(L=R.avail_out),0!==L&&(R.output.set(q.pending_buf.subarray(q.pending_out,q.pending_out+L),R.next_out),R.next_out+=L,q.pending_out+=L,R.total_out+=L,R.avail_out-=L,q.pending-=L,0===q.pending&&(q.pending_out=0))},i=(R,q)=>{h(R,R.block_start>=0?R.block_start:-1,R.strstart-R.block_start,q),R.block_start=R.strstart,Q(R.strm)},k=(R,q)=>{R.pending_buf[R.pending++]=q},V=(R,q)=>{R.pending_buf[R.pending++]=q>>>8&255,R.pending_buf[R.pending++]=255&q},x=(R,q,L,B)=>{let N=R.avail_in;return N>B&&(N=B),0===N?0:(R.avail_in-=N,q.set(R.input.subarray(R.next_in,R.next_in+N),L),1===R.state.wrap?R.adler=Y(R.adler,q,N,L):2===R.state.wrap&&(R.adler=F(R.adler,q,N,L)),R.next_in+=N,R.total_in+=N,N)},w=(R,q)=>{let L,B,N=R.max_chain_length,h=R.strstart,Z=R.prev_length,z=R.nice_match;const Y=R.strstart>R.w_size-G?R.strstart-(R.w_size-G):0,F=R.window,C=R.w_mask,e=R.prev,y=R.strstart+l;let U=F[h+Z-1],n=F[h+Z];R.prev_length>=R.good_match&&(N>>=2),z>R.lookahead&&(z=R.lookahead);do{if(L=q,F[L+Z]===n&&F[L+Z-1]===U&&F[L]===F[h]&&F[++L]===F[h+1]){h+=2,L++;do{}while(F[++h]===F[++L]&&F[++h]===F[++L]&&F[++h]===F[++L]&&F[++h]===F[++L]&&F[++h]===F[++L]&&F[++h]===F[++L]&&F[++h]===F[++L]&&F[++h]===F[++L]&&h<y);if(B=l-(y-h),h=y-l,B>Z){if(R.match_start=q,Z=B,B>=z)break;U=F[h+Z-1],n=F[h+Z]}}}while((q=e[q&C])>Y&&0!==--N);return Z<=R.lookahead?Z:R.lookahead},j=R=>{const q=R.w_size;let L,B,N,h,Z;do{if(h=R.window_size-R.lookahead-R.strstart,R.strstart>=q+(q-G)){R.window.set(R.window.subarray(q,q+q),0),R.match_start-=q,R.strstart-=q,R.block_start-=q,B=R.hash_size,L=B;do{N=R.head[--L],R.head[L]=N>=q?N-q:0}while(--B);B=q,L=B;do{N=R.prev[--L],R.prev[L]=N>=q?N-q:0}while(--B);h+=q}if(0===R.strm.avail_in)break;if(B=x(R.strm,R.window,R.strstart+R.lookahead,h),R.lookahead+=B,R.lookahead+R.insert>=3)for(Z=R.strstart-R.insert,R.ins_h=R.window[Z],R.ins_h=g(R,R.ins_h,R.window[Z+1]);R.insert&&(R.ins_h=g(R,R.ins_h,R.window[Z+3-1]),R.prev[Z&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=Z,Z++,R.insert--,!(R.lookahead+R.insert<3)););}while(R.lookahead<G&&0!==R.strm.avail_in)},J=(R,q)=>{let L,B;for(;;){if(R.lookahead<G){if(j(R),R.lookahead<G&&q===e)return 1;if(0===R.lookahead)break}if(L=0,R.lookahead>=3&&(R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),L=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),0!==L&&R.strstart-L<=R.w_size-G&&(R.match_length=w(R,L)),R.match_length>=3)if(B=Z(R,R.strstart-R.match_start,R.match_length-3),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=3){R.match_length--;do{R.strstart++,R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),L=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart}while(0!==--R.match_length);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=g(R,R.ins_h,R.window[R.strstart+1]);else B=Z(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(B&&(i(R,!1),0===R.strm.avail_out))return 1}return R.insert=R.strstart<2?R.strstart:2,q===n?(i(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(i(R,!1),0===R.strm.avail_out)?1:2},s=(R,q)=>{let L,B,N;for(;;){if(R.lookahead<G){if(j(R),R.lookahead<G&&q===e)return 1;if(0===R.lookahead)break}if(L=0,R.lookahead>=3&&(R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),L=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=2,0!==L&&R.prev_length<R.max_lazy_match&&R.strstart-L<=R.w_size-G&&(R.match_length=w(R,L),R.match_length<=5&&(R.strategy===t||3===R.match_length&&R.strstart-R.match_start>4096)&&(R.match_length=2)),R.prev_length>=3&&R.match_length<=R.prev_length){N=R.strstart+R.lookahead-3,B=Z(R,R.strstart-1-R.prev_match,R.prev_length-3),R.lookahead-=R.prev_length-1,R.prev_length-=2;do{++R.strstart<=N&&(R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),L=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart)}while(0!==--R.prev_length);if(R.match_available=0,R.match_length=2,R.strstart++,B&&(i(R,!1),0===R.strm.avail_out))return 1}else if(R.match_available){if(B=Z(R,0,R.window[R.strstart-1]),B&&i(R,!1),R.strstart++,R.lookahead--,0===R.strm.avail_out)return 1}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(B=Z(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<2?R.strstart:2,q===n?(i(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(i(R,!1),0===R.strm.avail_out)?1:2};function A(R,q,L,B,N){this.good_length=R,this.max_lazy=q,this.nice_length=L,this.max_chain=B,this.func=N}const M=[new A(0,0,0,0,((R,q)=>{let L=65535;for(L>R.pending_buf_size-5&&(L=R.pending_buf_size-5);;){if(R.lookahead<=1){if(j(R),0===R.lookahead&&q===e)return 1;if(0===R.lookahead)break}R.strstart+=R.lookahead,R.lookahead=0;const B=R.block_start+L;if((0===R.strstart||R.strstart>=B)&&(R.lookahead=R.strstart-B,R.strstart=B,i(R,!1),0===R.strm.avail_out))return 1;if(R.strstart-R.block_start>=R.w_size-G&&(i(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,q===n?(i(R,!0),0===R.strm.avail_out?3:4):(R.strstart>R.block_start&&(i(R,!1),R.strm.avail_out),1)})),new A(4,4,8,4,J),new A(4,5,16,8,J),new A(4,6,32,32,J),new A(4,4,16,16,s),new A(8,16,32,32,s),new A(8,16,128,128,s),new A(8,32,128,256,s),new A(32,128,258,1024,s),new A(32,258,258,4096,s)];function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=o,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const X=R=>{if(!R||!R.state)return O(R,d);R.total_in=R.total_out=0,R.data_type=m;const q=R.state;return q.pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?42:H,R.adler=2===q.wrap?0:1,q.last_flush=e,B(q),p},u=R=>{const q=X(R);var L;return q===p&&((L=R.state).window_size=2*L.w_size,a(L.head),L.max_lazy_match=M[L.level].max_lazy,L.good_match=M[L.level].good_length,L.nice_match=M[L.level].nice_length,L.max_chain_length=M[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=2,L.match_available=0,L.ins_h=0),q},RR=(R,q,L,B,N,h)=>{if(!R)return d;let Z=1;if(q===T&&(q=6),B<0?(Z=0,B=-B):B>15&&(Z=2,B-=16),N<1||N>9||L!==o||B<8||B>15||q<0||q>9||h<0||h>I)return O(R,d);8===B&&(B=9);const z=new b;return R.state=z,z.strm=R,z.wrap=Z,z.gzhead=null,z.w_bits=B,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=N+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+3-1)/3),z.window=new Uint8Array(2*z.w_size),z.head=new Uint16Array(z.hash_size),z.prev=new Uint16Array(z.w_size),z.lit_bufsize=1<<N+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new Uint8Array(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=q,z.strategy=h,z.method=L,u(R)};R.exports.deflateInit=(R,q)=>RR(R,q,o,15,8,K),R.exports.deflateInit2=RR,R.exports.deflateReset=u,R.exports.deflateResetKeep=X,R.exports.deflateSetHeader=(R,q)=>R&&R.state?2!==R.state.wrap?d:(R.state.gzhead=q,p):d,R.exports.deflate=(R,q)=>{let L,B;if(!R||!R.state||q>r||q<0)return R?O(R,d):d;const h=R.state;if(!R.output||!R.input&&0!==R.avail_in||h.status===P&&q!==n)return O(R,0===R.avail_out?v:d);h.strm=R;const Y=h.last_flush;if(h.last_flush=q,42===h.status)if(2===h.wrap)R.adler=0,k(h,31),k(h,139),k(h,8),h.gzhead?(k(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),k(h,255&h.gzhead.time),k(h,h.gzhead.time>>8&255),k(h,h.gzhead.time>>16&255),k(h,h.gzhead.time>>24&255),k(h,9===h.level?2:h.strategy>=D||h.level<2?4:0),k(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(k(h,255&h.gzhead.extra.length),k(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(R.adler=F(R.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=69):(k(h,0),k(h,0),k(h,0),k(h,0),k(h,0),k(h,9===h.level?2:h.strategy>=D||h.level<2?4:0),k(h,3),h.status=H);else{let q=o+(h.w_bits-8<<4)<<8,L=-1;L=h.strategy>=D||h.level<2?0:h.level<6?1:6===h.level?2:3,q|=L<<6,0!==h.strstart&&(q|=32),q+=31-q%31,h.status=H,V(h,q),0!==h.strstart&&(V(h,R.adler>>>16),V(h,65535&R.adler)),R.adler=1}if(69===h.status)if(h.gzhead.extra){for(L=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>L&&(R.adler=F(R.adler,h.pending_buf,h.pending-L,L)),Q(R),L=h.pending,h.pending!==h.pending_buf_size));)k(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>L&&(R.adler=F(R.adler,h.pending_buf,h.pending-L,L)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=73)}else h.status=73;if(73===h.status)if(h.gzhead.name){L=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>L&&(R.adler=F(R.adler,h.pending_buf,h.pending-L,L)),Q(R),L=h.pending,h.pending===h.pending_buf_size)){B=1;break}B=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,k(h,B)}while(0!==B);h.gzhead.hcrc&&h.pending>L&&(R.adler=F(R.adler,h.pending_buf,h.pending-L,L)),0===B&&(h.gzindex=0,h.status=91)}else h.status=91;if(91===h.status)if(h.gzhead.comment){L=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>L&&(R.adler=F(R.adler,h.pending_buf,h.pending-L,L)),Q(R),L=h.pending,h.pending===h.pending_buf_size)){B=1;break}B=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,k(h,B)}while(0!==B);h.gzhead.hcrc&&h.pending>L&&(R.adler=F(R.adler,h.pending_buf,h.pending-L,L)),0===B&&(h.status=W)}else h.status=W;if(h.status===W&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&Q(R),h.pending+2<=h.pending_buf_size&&(k(h,255&R.adler),k(h,R.adler>>8&255),R.adler=0,h.status=H)):h.status=H),0!==h.pending){if(Q(R),0===R.avail_out)return h.last_flush=-1,p}else if(0===R.avail_in&&E(q)<=E(Y)&&q!==n)return O(R,v);if(h.status===P&&0!==R.avail_in)return O(R,v);if(0!==R.avail_in||0!==h.lookahead||q!==e&&h.status!==P){let L=h.strategy===D?((R,q)=>{let L;for(;;){if(0===R.lookahead&&(j(R),0===R.lookahead)){if(q===e)return 1;break}if(R.match_length=0,L=Z(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,L&&(i(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,q===n?(i(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(i(R,!1),0===R.strm.avail_out)?1:2})(h,q):h.strategy===S?((R,q)=>{let L,B,N,h;const z=R.window;for(;;){if(R.lookahead<=l){if(j(R),R.lookahead<=l&&q===e)return 1;if(0===R.lookahead)break}if(R.match_length=0,R.lookahead>=3&&R.strstart>0&&(N=R.strstart-1,B=z[N],B===z[++N]&&B===z[++N]&&B===z[++N])){h=R.strstart+l;do{}while(B===z[++N]&&B===z[++N]&&B===z[++N]&&B===z[++N]&&B===z[++N]&&B===z[++N]&&B===z[++N]&&B===z[++N]&&N<h);R.match_length=l-(h-N),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=3?(L=Z(R,1,R.match_length-3),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(L=Z(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),L&&(i(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,q===n?(i(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(i(R,!1),0===R.strm.avail_out)?1:2})(h,q):M[h.level].func(h,q);if(3!==L&&4!==L||(h.status=P),1===L||3===L)return 0===R.avail_out&&(h.last_flush=-1),p;if(2===L&&(q===y?z(h):q!==r&&(N(h,0,0,!1),q===U&&(a(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),Q(R),0===R.avail_out))return h.last_flush=-1,p}return q!==n?p:h.wrap<=0?c:(2===h.wrap?(k(h,255&R.adler),k(h,R.adler>>8&255),k(h,R.adler>>16&255),k(h,R.adler>>24&255),k(h,255&R.total_in),k(h,R.total_in>>8&255),k(h,R.total_in>>16&255),k(h,R.total_in>>24&255)):(V(h,R.adler>>>16),V(h,65535&R.adler)),Q(R),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?p:c)},R.exports.deflateEnd=R=>{if(!R||!R.state)return d;const q=R.state.status;return 42!==q&&69!==q&&73!==q&&91!==q&&q!==W&&q!==H&&q!==P?O(R,d):(R.state=null,q===H?O(R,f):p)},R.exports.deflateSetDictionary=(R,q)=>{let L=q.length;if(!R||!R.state)return d;const B=R.state,N=B.wrap;if(2===N||1===N&&42!==B.status||B.lookahead)return d;if(1===N&&(R.adler=Y(R.adler,q,L,0)),B.wrap=0,L>=B.w_size){0===N&&(a(B.head),B.strstart=0,B.block_start=0,B.insert=0);let R=new Uint8Array(B.w_size);R.set(q.subarray(L-B.w_size,L),0),q=R,L=B.w_size}const h=R.avail_in,Z=R.next_in,z=R.input;for(R.avail_in=L,R.next_in=0,R.input=q,j(B);B.lookahead>=3;){let R=B.strstart,q=B.lookahead-2;do{B.ins_h=g(B,B.ins_h,B.window[R+3-1]),B.prev[R&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=R,R++}while(--q);B.strstart=R,B.lookahead=2,j(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=2,B.match_available=0,R.next_in=Z,R.input=z,R.avail_in=h,B.wrap=N,p},R.exports.deflateInfo="pako deflate (from Nodeca project)"},11020:R=>{"use strict";R.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11007:R=>{"use strict";R.exports=function(R,q){let L,B,N,h,Z,z,Y,F,C,e,y,U,n,r,p,c,d,f,v,T,t,D,S,I;const K=R.state;L=R.next_in,S=R.input,B=L+(R.avail_in-5),N=R.next_out,I=R.output,h=N-(q-R.avail_out),Z=N+(R.avail_out-257),z=K.dmax,Y=K.wsize,F=K.whave,C=K.wnext,e=K.window,y=K.hold,U=K.bits,n=K.lencode,r=K.distcode,p=(1<<K.lenbits)-1,c=(1<<K.distbits)-1;R:do{U<15&&(y+=S[L++]<<U,U+=8,y+=S[L++]<<U,U+=8),d=n[y&p];q:for(;;){if(f=d>>>24,y>>>=f,U-=f,f=d>>>16&255,0===f)I[N++]=65535&d;else{if(!(16&f)){if(0===(64&f)){d=n[(65535&d)+(y&(1<<f)-1)];continue q}if(32&f){K.mode=12;break R}R.msg="invalid literal/length code",K.mode=30;break R}v=65535&d,f&=15,f&&(U<f&&(y+=S[L++]<<U,U+=8),v+=y&(1<<f)-1,y>>>=f,U-=f),U<15&&(y+=S[L++]<<U,U+=8,y+=S[L++]<<U,U+=8),d=r[y&c];L:for(;;){if(f=d>>>24,y>>>=f,U-=f,f=d>>>16&255,!(16&f)){if(0===(64&f)){d=r[(65535&d)+(y&(1<<f)-1)];continue L}R.msg="invalid distance code",K.mode=30;break R}if(T=65535&d,f&=15,U<f&&(y+=S[L++]<<U,U+=8,U<f&&(y+=S[L++]<<U,U+=8)),T+=y&(1<<f)-1,T>z){R.msg="invalid distance too far back",K.mode=30;break R}if(y>>>=f,U-=f,f=N-h,T>f){if(f=T-f,f>F&&K.sane){R.msg="invalid distance too far back",K.mode=30;break R}if(t=0,D=e,0===C){if(t+=Y-f,f<v){v-=f;do{I[N++]=e[t++]}while(--f);t=N-T,D=I}}else if(C<f){if(t+=Y+C-f,f-=C,f<v){v-=f;do{I[N++]=e[t++]}while(--f);if(t=0,C<v){f=C,v-=f;do{I[N++]=e[t++]}while(--f);t=N-T,D=I}}}else if(t+=C-f,f<v){v-=f;do{I[N++]=e[t++]}while(--f);t=N-T,D=I}for(;v>2;)I[N++]=D[t++],I[N++]=D[t++],I[N++]=D[t++],v-=3;v&&(I[N++]=D[t++],v>1&&(I[N++]=D[t++]))}else{t=N-T;do{I[N++]=I[t++],I[N++]=I[t++],I[N++]=I[t++],v-=3}while(v>2);v&&(I[N++]=I[t++],v>1&&(I[N++]=I[t++]))}break}}break}}while(L<B&&N<Z);v=U>>3,L-=v,U-=v<<3,y&=(1<<U)-1,R.next_in=L,R.next_out=N,R.avail_in=L<B?B-L+5:5-(L-B),R.avail_out=N<Z?Z-N+257:257-(N-Z),K.hold=y,K.bits=U}},11001:(R,q,L)=>{"use strict";const B=L(10951),N=L(10954),h=L(11007),Z=L(11015),{Z_FINISH:z,Z_BLOCK:Y,Z_TREES:F,Z_OK:C,Z_STREAM_END:e,Z_NEED_DICT:y,Z_STREAM_ERROR:U,Z_DATA_ERROR:n,Z_MEM_ERROR:r,Z_BUF_ERROR:p,Z_DEFLATED:c}=L(10962),d=12,f=30,v=R=>(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24);function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const t=R=>{if(!R||!R.state)return U;const q=R.state;return R.total_in=R.total_out=q.total=0,R.msg="",q.wrap&&(R.adler=1&q.wrap),q.mode=1,q.last=0,q.havedict=0,q.dmax=32768,q.head=null,q.hold=0,q.bits=0,q.lencode=q.lendyn=new Int32Array(852),q.distcode=q.distdyn=new Int32Array(592),q.sane=1,q.back=-1,C},D=R=>{if(!R||!R.state)return U;const q=R.state;return q.wsize=0,q.whave=0,q.wnext=0,t(R)},S=(R,q)=>{let L;if(!R||!R.state)return U;const B=R.state;return q<0?(L=0,q=-q):(L=1+(q>>4),q<48&&(q&=15)),q&&(q<8||q>15)?U:(null!==B.window&&B.wbits!==q&&(B.window=null),B.wrap=L,B.wbits=q,D(R))},I=(R,q)=>{if(!R)return U;const L=new T;R.state=L,L.window=null;const B=S(R,q);return B!==C&&(R.state=null),B};let K,m,o=!0;const l=R=>{if(o){K=new Int32Array(512),m=new Int32Array(32);let q=0;for(;q<144;)R.lens[q++]=8;for(;q<256;)R.lens[q++]=9;for(;q<280;)R.lens[q++]=7;for(;q<288;)R.lens[q++]=8;for(Z(1,R.lens,0,288,K,0,R.work,{bits:9}),q=0;q<32;)R.lens[q++]=5;Z(2,R.lens,0,32,m,0,R.work,{bits:5}),o=!1}R.lencode=K,R.lenbits=9,R.distcode=m,R.distbits=5},G=(R,q,L,B)=>{let N;const h=R.state;return null===h.window&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),B>=h.wsize?(h.window.set(q.subarray(L-h.wsize,L),0),h.wnext=0,h.whave=h.wsize):(N=h.wsize-h.wnext,N>B&&(N=B),h.window.set(q.subarray(L-B,L-B+N),h.wnext),(B-=N)?(h.window.set(q.subarray(L-B,L),0),h.wnext=B,h.whave=h.wsize):(h.wnext+=N,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=N))),0};R.exports.inflateReset=D,R.exports.inflateReset2=S,R.exports.inflateResetKeep=t,R.exports.inflateInit=R=>I(R,15),R.exports.inflateInit2=I,R.exports.inflate=(R,q)=>{let L,T,t,D,S,I,K,m,o,W,H,P,O,E,a,g,Q,i,k,V,x,w,j=0;const J=new Uint8Array(4);let s,A;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!R||!R.state||!R.output||!R.input&&0!==R.avail_in)return U;L=R.state,L.mode===d&&(L.mode=13),S=R.next_out,t=R.output,K=R.avail_out,D=R.next_in,T=R.input,I=R.avail_in,m=L.hold,o=L.bits,W=I,H=K,w=C;R:for(;;)switch(L.mode){case 1:if(0===L.wrap){L.mode=13;break}for(;o<16;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(2&L.wrap&&35615===m){L.check=0,J[0]=255&m,J[1]=m>>>8&255,L.check=N(L.check,J,2,0),m=0,o=0,L.mode=2;break}if(L.flags=0,L.head&&(L.head.done=!1),!(1&L.wrap)||(((255&m)<<8)+(m>>8))%31){R.msg="incorrect header check",L.mode=f;break}if((15&m)!==c){R.msg="unknown compression method",L.mode=f;break}if(m>>>=4,o-=4,x=8+(15&m),0===L.wbits)L.wbits=x;else if(x>L.wbits){R.msg="invalid window size",L.mode=f;break}L.dmax=1<<L.wbits,R.adler=L.check=1,L.mode=512&m?10:d,m=0,o=0;break;case 2:for(;o<16;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(L.flags=m,(255&L.flags)!==c){R.msg="unknown compression method",L.mode=f;break}if(57344&L.flags){R.msg="unknown header flags set",L.mode=f;break}L.head&&(L.head.text=m>>8&1),512&L.flags&&(J[0]=255&m,J[1]=m>>>8&255,L.check=N(L.check,J,2,0)),m=0,o=0,L.mode=3;case 3:for(;o<32;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}L.head&&(L.head.time=m),512&L.flags&&(J[0]=255&m,J[1]=m>>>8&255,J[2]=m>>>16&255,J[3]=m>>>24&255,L.check=N(L.check,J,4,0)),m=0,o=0,L.mode=4;case 4:for(;o<16;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}L.head&&(L.head.xflags=255&m,L.head.os=m>>8),512&L.flags&&(J[0]=255&m,J[1]=m>>>8&255,L.check=N(L.check,J,2,0)),m=0,o=0,L.mode=5;case 5:if(1024&L.flags){for(;o<16;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}L.length=m,L.head&&(L.head.extra_len=m),512&L.flags&&(J[0]=255&m,J[1]=m>>>8&255,L.check=N(L.check,J,2,0)),m=0,o=0}else L.head&&(L.head.extra=null);L.mode=6;case 6:if(1024&L.flags&&(P=L.length,P>I&&(P=I),P&&(L.head&&(x=L.head.extra_len-L.length,L.head.extra||(L.head.extra=new Uint8Array(L.head.extra_len)),L.head.extra.set(T.subarray(D,D+P),x)),512&L.flags&&(L.check=N(L.check,T,P,D)),I-=P,D+=P,L.length-=P),L.length))break R;L.length=0,L.mode=7;case 7:if(2048&L.flags){if(0===I)break R;P=0;do{x=T[D+P++],L.head&&x&&L.length<65536&&(L.head.name+=String.fromCharCode(x))}while(x&&P<I);if(512&L.flags&&(L.check=N(L.check,T,P,D)),I-=P,D+=P,x)break R}else L.head&&(L.head.name=null);L.length=0,L.mode=8;case 8:if(4096&L.flags){if(0===I)break R;P=0;do{x=T[D+P++],L.head&&x&&L.length<65536&&(L.head.comment+=String.fromCharCode(x))}while(x&&P<I);if(512&L.flags&&(L.check=N(L.check,T,P,D)),I-=P,D+=P,x)break R}else L.head&&(L.head.comment=null);L.mode=9;case 9:if(512&L.flags){for(;o<16;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(m!==(65535&L.check)){R.msg="header crc mismatch",L.mode=f;break}m=0,o=0}L.head&&(L.head.hcrc=L.flags>>9&1,L.head.done=!0),R.adler=L.check=0,L.mode=d;break;case 10:for(;o<32;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}R.adler=L.check=v(m),m=0,o=0,L.mode=11;case 11:if(0===L.havedict)return R.next_out=S,R.avail_out=K,R.next_in=D,R.avail_in=I,L.hold=m,L.bits=o,y;R.adler=L.check=1,L.mode=d;case d:if(q===Y||q===F)break R;case 13:if(L.last){m>>>=7&o,o-=7&o,L.mode=27;break}for(;o<3;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}switch(L.last=1&m,m>>>=1,o-=1,3&m){case 0:L.mode=14;break;case 1:if(l(L),L.mode=20,q===F){m>>>=2,o-=2;break R}break;case 2:L.mode=17;break;case 3:R.msg="invalid block type",L.mode=f}m>>>=2,o-=2;break;case 14:for(m>>>=7&o,o-=7&o;o<32;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if((65535&m)!==(m>>>16^65535)){R.msg="invalid stored block lengths",L.mode=f;break}if(L.length=65535&m,m=0,o=0,L.mode=15,q===F)break R;case 15:L.mode=16;case 16:if(P=L.length,P){if(P>I&&(P=I),P>K&&(P=K),0===P)break R;t.set(T.subarray(D,D+P),S),I-=P,D+=P,K-=P,S+=P,L.length-=P;break}L.mode=d;break;case 17:for(;o<14;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(L.nlen=257+(31&m),m>>>=5,o-=5,L.ndist=1+(31&m),m>>>=5,o-=5,L.ncode=4+(15&m),m>>>=4,o-=4,L.nlen>286||L.ndist>30){R.msg="too many length or distance symbols",L.mode=f;break}L.have=0,L.mode=18;case 18:for(;L.have<L.ncode;){for(;o<3;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}L.lens[M[L.have++]]=7&m,m>>>=3,o-=3}for(;L.have<19;)L.lens[M[L.have++]]=0;if(L.lencode=L.lendyn,L.lenbits=7,s={bits:L.lenbits},w=Z(0,L.lens,0,19,L.lencode,0,L.work,s),L.lenbits=s.bits,w){R.msg="invalid code lengths set",L.mode=f;break}L.have=0,L.mode=19;case 19:for(;L.have<L.nlen+L.ndist;){for(;j=L.lencode[m&(1<<L.lenbits)-1],a=j>>>24,g=j>>>16&255,Q=65535&j,!(a<=o);){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(Q<16)m>>>=a,o-=a,L.lens[L.have++]=Q;else{if(16===Q){for(A=a+2;o<A;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(m>>>=a,o-=a,0===L.have){R.msg="invalid bit length repeat",L.mode=f;break}x=L.lens[L.have-1],P=3+(3&m),m>>>=2,o-=2}else if(17===Q){for(A=a+3;o<A;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}m>>>=a,o-=a,x=0,P=3+(7&m),m>>>=3,o-=3}else{for(A=a+7;o<A;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}m>>>=a,o-=a,x=0,P=11+(127&m),m>>>=7,o-=7}if(L.have+P>L.nlen+L.ndist){R.msg="invalid bit length repeat",L.mode=f;break}for(;P--;)L.lens[L.have++]=x}}if(L.mode===f)break;if(0===L.lens[256]){R.msg="invalid code -- missing end-of-block",L.mode=f;break}if(L.lenbits=9,s={bits:L.lenbits},w=Z(1,L.lens,0,L.nlen,L.lencode,0,L.work,s),L.lenbits=s.bits,w){R.msg="invalid literal/lengths set",L.mode=f;break}if(L.distbits=6,L.distcode=L.distdyn,s={bits:L.distbits},w=Z(2,L.lens,L.nlen,L.ndist,L.distcode,0,L.work,s),L.distbits=s.bits,w){R.msg="invalid distances set",L.mode=f;break}if(L.mode=20,q===F)break R;case 20:L.mode=21;case 21:if(I>=6&&K>=258){R.next_out=S,R.avail_out=K,R.next_in=D,R.avail_in=I,L.hold=m,L.bits=o,h(R,H),S=R.next_out,t=R.output,K=R.avail_out,D=R.next_in,T=R.input,I=R.avail_in,m=L.hold,o=L.bits,L.mode===d&&(L.back=-1);break}for(L.back=0;j=L.lencode[m&(1<<L.lenbits)-1],a=j>>>24,g=j>>>16&255,Q=65535&j,!(a<=o);){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(g&&0===(240&g)){for(i=a,k=g,V=Q;j=L.lencode[V+((m&(1<<i+k)-1)>>i)],a=j>>>24,g=j>>>16&255,Q=65535&j,!(i+a<=o);){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}m>>>=i,o-=i,L.back+=i}if(m>>>=a,o-=a,L.back+=a,L.length=Q,0===g){L.mode=26;break}if(32&g){L.back=-1,L.mode=d;break}if(64&g){R.msg="invalid literal/length code",L.mode=f;break}L.extra=15&g,L.mode=22;case 22:if(L.extra){for(A=L.extra;o<A;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}L.length+=m&(1<<L.extra)-1,m>>>=L.extra,o-=L.extra,L.back+=L.extra}L.was=L.length,L.mode=23;case 23:for(;j=L.distcode[m&(1<<L.distbits)-1],a=j>>>24,g=j>>>16&255,Q=65535&j,!(a<=o);){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(0===(240&g)){for(i=a,k=g,V=Q;j=L.distcode[V+((m&(1<<i+k)-1)>>i)],a=j>>>24,g=j>>>16&255,Q=65535&j,!(i+a<=o);){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}m>>>=i,o-=i,L.back+=i}if(m>>>=a,o-=a,L.back+=a,64&g){R.msg="invalid distance code",L.mode=f;break}L.offset=Q,L.extra=15&g,L.mode=24;case 24:if(L.extra){for(A=L.extra;o<A;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}L.offset+=m&(1<<L.extra)-1,m>>>=L.extra,o-=L.extra,L.back+=L.extra}if(L.offset>L.dmax){R.msg="invalid distance too far back",L.mode=f;break}L.mode=25;case 25:if(0===K)break R;if(P=H-K,L.offset>P){if(P=L.offset-P,P>L.whave&&L.sane){R.msg="invalid distance too far back",L.mode=f;break}P>L.wnext?(P-=L.wnext,O=L.wsize-P):O=L.wnext-P,P>L.length&&(P=L.length),E=L.window}else E=t,O=S-L.offset,P=L.length;P>K&&(P=K),K-=P,L.length-=P;do{t[S++]=E[O++]}while(--P);0===L.length&&(L.mode=21);break;case 26:if(0===K)break R;t[S++]=L.length,K--,L.mode=21;break;case 27:if(L.wrap){for(;o<32;){if(0===I)break R;I--,m|=T[D++]<<o,o+=8}if(H-=K,R.total_out+=H,L.total+=H,H&&(R.adler=L.check=L.flags?N(L.check,t,H,S-H):B(L.check,t,H,S-H)),H=K,(L.flags?m:v(m))!==L.check){R.msg="incorrect data check",L.mode=f;break}m=0,o=0}L.mode=28;case 28:if(L.wrap&&L.flags){for(;o<32;){if(0===I)break R;I--,m+=T[D++]<<o,o+=8}if(m!==(4294967295&L.total)){R.msg="incorrect length check",L.mode=f;break}m=0,o=0}L.mode=29;case 29:w=e;break R;case f:w=n;break R;case 31:return r;default:return U}return R.next_out=S,R.avail_out=K,R.next_in=D,R.avail_in=I,L.hold=m,L.bits=o,(L.wsize||H!==R.avail_out&&L.mode<f&&(L.mode<27||q!==z))&&G(R,R.output,R.next_out,H-R.avail_out)?(L.mode=31,r):(W-=R.avail_in,H-=R.avail_out,R.total_in+=W,R.total_out+=H,L.total+=H,L.wrap&&H&&(R.adler=L.check=L.flags?N(L.check,t,H,R.next_out-H):B(L.check,t,H,R.next_out-H)),R.data_type=L.bits+(L.last?64:0)+(L.mode===d?128:0)+(20===L.mode||15===L.mode?256:0),(0===W&&0===H||q===z)&&w===C&&(w=p),w)},R.exports.inflateEnd=R=>{if(!R||!R.state)return U;let q=R.state;return q.window&&(q.window=null),R.state=null,C},R.exports.inflateGetHeader=(R,q)=>{if(!R||!R.state)return U;const L=R.state;return 0===(2&L.wrap)?U:(L.head=q,q.done=!1,C)},R.exports.inflateSetDictionary=(R,q)=>{const L=q.length;let N,h,Z;return R&&R.state?(N=R.state,0!==N.wrap&&11!==N.mode?U:11===N.mode&&(h=1,h=B(h,q,L,0),h!==N.check)?n:(Z=G(R,q,L,L),Z?(N.mode=31,r):(N.havedict=1,C))):U},R.exports.inflateInfo="pako inflate (from Nodeca project)"},11015:R=>{"use strict";const q=15,L=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),B=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),N=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),h=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);R.exports=(R,Z,z,Y,F,C,e,y)=>{const U=y.bits;let n,r,p,c,d,f,v=0,T=0,t=0,D=0,S=0,I=0,K=0,m=0,o=0,l=0,G=null,W=0;const H=new Uint16Array(16),P=new Uint16Array(16);let O,E,a,g=null,Q=0;for(v=0;v<=q;v++)H[v]=0;for(T=0;T<Y;T++)H[Z[z+T]]++;for(S=U,D=q;D>=1&&0===H[D];D--);if(S>D&&(S=D),0===D)return F[C++]=20971520,F[C++]=20971520,y.bits=1,0;for(t=1;t<D&&0===H[t];t++);for(S<t&&(S=t),m=1,v=1;v<=q;v++)if(m<<=1,m-=H[v],m<0)return-1;if(m>0&&(0===R||1!==D))return-1;for(P[1]=0,v=1;v<q;v++)P[v+1]=P[v]+H[v];for(T=0;T<Y;T++)0!==Z[z+T]&&(e[P[Z[z+T]]++]=T);if(0===R?(G=g=e,f=19):1===R?(G=L,W-=257,g=B,Q-=257,f=256):(G=N,g=h,f=-1),l=0,T=0,v=t,d=C,I=S,K=0,p=-1,o=1<<S,c=o-1,1===R&&o>852||2===R&&o>592)return 1;for(;;){O=v-K,e[T]<f?(E=0,a=e[T]):e[T]>f?(E=g[Q+e[T]],a=G[W+e[T]]):(E=96,a=0),n=1<<v-K,r=1<<I,t=r;do{r-=n,F[d+(l>>K)+r]=O<<24|E<<16|a}while(0!==r);for(n=1<<v-1;l&n;)n>>=1;if(0!==n?(l&=n-1,l+=n):l=0,T++,0===--H[v]){if(v===D)break;v=Z[z+e[T]]}if(v>S&&(l&c)!==p){for(0===K&&(K=S),d+=t,I=v-K,m=1<<I;I+K<D&&(m-=H[I+K],!(m<=0));)I++,m<<=1;if(o+=1<<I,1===R&&o>852||2===R&&o>592)return 1;p=l&c,F[p]=S<<24|I<<16|d-C}}return 0!==l&&(F[d+l]=v-K<<24|64<<16),y.bits=S,0}},10960:R=>{"use strict";R.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10945:R=>{"use strict";function q(R){let q=R.length;for(;--q>=0;)R[q]=0}const L=256,B=286,N=30,h=15,Z=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),z=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C=new Array(576);q(C);const e=new Array(60);q(e);const y=new Array(512);q(y);const U=new Array(256);q(U);const n=new Array(29);q(n);const r=new Array(N);function p(R,q,L,B,N){this.static_tree=R,this.extra_bits=q,this.extra_base=L,this.elems=B,this.max_length=N,this.has_stree=R&&R.length}let c,d,f;function v(R,q){this.dyn_tree=R,this.max_code=0,this.stat_desc=q}q(r);const T=R=>R<256?y[R]:y[256+(R>>>7)],t=(R,q)=>{R.pending_buf[R.pending++]=255&q,R.pending_buf[R.pending++]=q>>>8&255},D=(R,q,L)=>{R.bi_valid>16-L?(R.bi_buf|=q<<R.bi_valid&65535,t(R,R.bi_buf),R.bi_buf=q>>16-R.bi_valid,R.bi_valid+=L-16):(R.bi_buf|=q<<R.bi_valid&65535,R.bi_valid+=L)},S=(R,q,L)=>{D(R,L[2*q],L[2*q+1])},I=(R,q)=>{let L=0;do{L|=1&R,R>>>=1,L<<=1}while(--q>0);return L>>>1},K=(R,q,L)=>{const B=new Array(16);let N,Z,z=0;for(N=1;N<=h;N++)B[N]=z=z+L[N-1]<<1;for(Z=0;Z<=q;Z++){let q=R[2*Z+1];0!==q&&(R[2*Z]=I(B[q]++,q))}},m=R=>{let q;for(q=0;q<B;q++)R.dyn_ltree[2*q]=0;for(q=0;q<N;q++)R.dyn_dtree[2*q]=0;for(q=0;q<19;q++)R.bl_tree[2*q]=0;R.dyn_ltree[512]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0},o=R=>{R.bi_valid>8?t(R,R.bi_buf):R.bi_valid>0&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0},l=(R,q,L,B)=>{const N=2*q,h=2*L;return R[N]<R[h]||R[N]===R[h]&&B[q]<=B[L]},G=(R,q,L)=>{const B=R.heap[L];let N=L<<1;for(;N<=R.heap_len&&(N<R.heap_len&&l(q,R.heap[N+1],R.heap[N],R.depth)&&N++,!l(q,B,R.heap[N],R.depth));)R.heap[L]=R.heap[N],L=N,N<<=1;R.heap[L]=B},W=(R,q,B)=>{let N,h,Y,F,C=0;if(0!==R.last_lit)do{N=R.pending_buf[R.d_buf+2*C]<<8|R.pending_buf[R.d_buf+2*C+1],h=R.pending_buf[R.l_buf+C],C++,0===N?S(R,h,q):(Y=U[h],S(R,Y+L+1,q),F=Z[Y],0!==F&&(h-=n[Y],D(R,h,F)),N--,Y=T(N),S(R,Y,B),F=z[Y],0!==F&&(N-=r[Y],D(R,N,F)))}while(C<R.last_lit);S(R,256,q)},H=(R,q)=>{const L=q.dyn_tree,B=q.stat_desc.static_tree,N=q.stat_desc.has_stree,Z=q.stat_desc.elems;let z,Y,F,C=-1;for(R.heap_len=0,R.heap_max=573,z=0;z<Z;z++)0!==L[2*z]?(R.heap[++R.heap_len]=C=z,R.depth[z]=0):L[2*z+1]=0;for(;R.heap_len<2;)F=R.heap[++R.heap_len]=C<2?++C:0,L[2*F]=1,R.depth[F]=0,R.opt_len--,N&&(R.static_len-=B[2*F+1]);for(q.max_code=C,z=R.heap_len>>1;z>=1;z--)G(R,L,z);F=Z;do{z=R.heap[1],R.heap[1]=R.heap[R.heap_len--],G(R,L,1),Y=R.heap[1],R.heap[--R.heap_max]=z,R.heap[--R.heap_max]=Y,L[2*F]=L[2*z]+L[2*Y],R.depth[F]=(R.depth[z]>=R.depth[Y]?R.depth[z]:R.depth[Y])+1,L[2*z+1]=L[2*Y+1]=F,R.heap[1]=F++,G(R,L,1)}while(R.heap_len>=2);R.heap[--R.heap_max]=R.heap[1],((R,q)=>{const L=q.dyn_tree,B=q.max_code,N=q.stat_desc.static_tree,Z=q.stat_desc.has_stree,z=q.stat_desc.extra_bits,Y=q.stat_desc.extra_base,F=q.stat_desc.max_length;let C,e,y,U,n,r,p=0;for(U=0;U<=h;U++)R.bl_count[U]=0;for(L[2*R.heap[R.heap_max]+1]=0,C=R.heap_max+1;C<573;C++)e=R.heap[C],U=L[2*L[2*e+1]+1]+1,U>F&&(U=F,p++),L[2*e+1]=U,e>B||(R.bl_count[U]++,n=0,e>=Y&&(n=z[e-Y]),r=L[2*e],R.opt_len+=r*(U+n),Z&&(R.static_len+=r*(N[2*e+1]+n)));if(0!==p){do{for(U=F-1;0===R.bl_count[U];)U--;R.bl_count[U]--,R.bl_count[U+1]+=2,R.bl_count[F]--,p-=2}while(p>0);for(U=F;0!==U;U--)for(e=R.bl_count[U];0!==e;)y=R.heap[--C],y>B||(L[2*y+1]!==U&&(R.opt_len+=(U-L[2*y+1])*L[2*y],L[2*y+1]=U),e--)}})(R,q),K(L,C,R.bl_count)},P=(R,q,L)=>{let B,N,h=-1,Z=q[1],z=0,Y=7,F=4;for(0===Z&&(Y=138,F=3),q[2*(L+1)+1]=65535,B=0;B<=L;B++)N=Z,Z=q[2*(B+1)+1],++z<Y&&N===Z||(z<F?R.bl_tree[2*N]+=z:0!==N?(N!==h&&R.bl_tree[2*N]++,R.bl_tree[32]++):z<=10?R.bl_tree[34]++:R.bl_tree[36]++,z=0,h=N,0===Z?(Y=138,F=3):N===Z?(Y=6,F=3):(Y=7,F=4))},O=(R,q,L)=>{let B,N,h=-1,Z=q[1],z=0,Y=7,F=4;for(0===Z&&(Y=138,F=3),B=0;B<=L;B++)if(N=Z,Z=q[2*(B+1)+1],!(++z<Y&&N===Z)){if(z<F)do{S(R,N,R.bl_tree)}while(0!==--z);else 0!==N?(N!==h&&(S(R,N,R.bl_tree),z--),S(R,16,R.bl_tree),D(R,z-3,2)):z<=10?(S(R,17,R.bl_tree),D(R,z-3,3)):(S(R,18,R.bl_tree),D(R,z-11,7));z=0,h=N,0===Z?(Y=138,F=3):N===Z?(Y=6,F=3):(Y=7,F=4)}};let E=!1;const a=(R,q,L,B)=>{D(R,0+(B?1:0),3),((R,q,L,B)=>{o(R),B&&(t(R,L),t(R,~L)),R.pending_buf.set(R.window.subarray(q,q+L),R.pending),R.pending+=L})(R,q,L,!0)};R.exports._tr_init=R=>{E||((()=>{let R,q,L,F,v;const T=new Array(16);for(L=0,F=0;F<28;F++)for(n[F]=L,R=0;R<1<<Z[F];R++)U[L++]=F;for(U[L-1]=F,v=0,F=0;F<16;F++)for(r[F]=v,R=0;R<1<<z[F];R++)y[v++]=F;for(v>>=7;F<N;F++)for(r[F]=v<<7,R=0;R<1<<z[F]-7;R++)y[256+v++]=F;for(q=0;q<=h;q++)T[q]=0;for(R=0;R<=143;)C[2*R+1]=8,R++,T[8]++;for(;R<=255;)C[2*R+1]=9,R++,T[9]++;for(;R<=279;)C[2*R+1]=7,R++,T[7]++;for(;R<=287;)C[2*R+1]=8,R++,T[8]++;for(K(C,287,T),R=0;R<N;R++)e[2*R+1]=5,e[2*R]=I(R,5);c=new p(C,Z,257,B,h),d=new p(e,z,0,N,h),f=new p(new Array(0),Y,0,19,7)})(),E=!0),R.l_desc=new v(R.dyn_ltree,c),R.d_desc=new v(R.dyn_dtree,d),R.bl_desc=new v(R.bl_tree,f),R.bi_buf=0,R.bi_valid=0,m(R)},R.exports._tr_stored_block=a,R.exports._tr_flush_block=(R,q,B,N)=>{let h,Z,z=0;R.level>0?(2===R.strm.data_type&&(R.strm.data_type=(R=>{let q,B=4093624447;for(q=0;q<=31;q++,B>>>=1)if(1&B&&0!==R.dyn_ltree[2*q])return 0;if(0!==R.dyn_ltree[18]||0!==R.dyn_ltree[20]||0!==R.dyn_ltree[26])return 1;for(q=32;q<L;q++)if(0!==R.dyn_ltree[2*q])return 1;return 0})(R)),H(R,R.l_desc),H(R,R.d_desc),z=(R=>{let q;for(P(R,R.dyn_ltree,R.l_desc.max_code),P(R,R.dyn_dtree,R.d_desc.max_code),H(R,R.bl_desc),q=18;q>=3&&0===R.bl_tree[2*F[q]+1];q--);return R.opt_len+=3*(q+1)+5+5+4,q})(R),h=R.opt_len+3+7>>>3,Z=R.static_len+3+7>>>3,Z<=h&&(h=Z)):h=Z=B+5,B+4<=h&&-1!==q?a(R,q,B,N):4===R.strategy||Z===h?(D(R,2+(N?1:0),3),W(R,C,e)):(D(R,4+(N?1:0),3),((R,q,L,B)=>{let N;for(D(R,q-257,5),D(R,L-1,5),D(R,B-4,4),N=0;N<B;N++)D(R,R.bl_tree[2*F[N]+1],3);O(R,R.dyn_ltree,q-1),O(R,R.dyn_dtree,L-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,z+1),W(R,R.dyn_ltree,R.dyn_dtree)),m(R),N&&o(R)},R.exports._tr_tally=(R,q,B)=>(R.pending_buf[R.d_buf+2*R.last_lit]=q>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&q,R.pending_buf[R.l_buf+R.last_lit]=255&B,R.last_lit++,0===q?R.dyn_ltree[2*B]++:(R.matches++,q--,R.dyn_ltree[2*(U[B]+L+1)]++,R.dyn_dtree[2*T(q)]++),R.last_lit===R.lit_bufsize-1),R.exports._tr_align=R=>{D(R,2,3),S(R,256,C),(R=>{16===R.bi_valid?(t(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):R.bi_valid>=8&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(R)}},10984:R=>{"use strict";R.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11996:R=>{function q(R,q,L){for(var B=R.length,N=-1/0,h=1/0,Z=0;Z<B;Z++){var z=(L[0][Z]-R[Z])/q[Z],Y=(L[1][Z]-R[Z])/q[Z];if(z>Y){var F=z;z=Y,Y=F}if(Y<N||z>h)return 1/0;z>N&&(N=z),Y<h&&(h=Y)}return N>h?1/0:N}R.exports=function(R,L,B,N){var h=q(L,B,N);if(h===1/0)R=null;else{R=R||[];for(var Z=0;Z<L.length;Z++)R[Z]=L[Z]+B[Z]*h}return R},R.exports.distance=q},12445:(R,q,L)=>{"use strict";L.d(q,{d:()=>Z});var B=L(28);const N=B.useLayoutEffect;const h=function(R){var q=(0,B.useRef)(R);return N((function(){q.current=R})),q};var Z=function(R){var q=h(R);(0,B.useEffect)((function(){var R=function(R){var L;if(null!=q.current&&(L=q.current(R)),R.defaultPrevented&&(R.returnValue=""),"string"===typeof L)return R.returnValue=L,L};return window.addEventListener("beforeunload",R),function(){window.removeEventListener("beforeunload",R)}}),[])}},12404:(R,q,L)=>{"use strict";var B=L(12413),N=Array.prototype.concat,h=Array.prototype.slice,Z=R.exports=function(R){for(var q=[],L=0,Z=R.length;L<Z;L++){var z=R[L];B(z)?q=N.call(q,h.call(z)):q.push(z)}return q};Z.wrap=function(R){return function(){return R(Z(arguments))}}},12413:R=>{R.exports=function(R){return!(!R||"string"===typeof R)&&(R instanceof Array||Array.isArray(R)||R.length>=0&&(R.splice instanceof Function||Object.getOwnPropertyDescriptor(R,R.length-1)&&"String"!==R.constructor.name))}},12354:R=>{"use strict";var q=[],L=[],B=[],N=[],h=[],Z=[],z=[],Y=[],F=[],C=[],e=[],y=[];R.exports=function(R,U,n,r,p,c){for(var d=z,f=F,v=C,T=y,t=0;t<3;t++)d[t]=+n[t],v[t]=+U.max[t],f[t]=+U.base[t];c||(c=1e-10);var D=function(R,z,F,C,y,U){var n=q,r=L,p=B,c=N,d=h,f=Z,v=Y,T=Math.floor,t=0,D=0,S=0,I=0,K=0;if(m(),0===S)return 0;for(I=G();D<=S;){if(o(I)&&l())return t;I=G()}for(t+=S,K=0;K<3;K++)C[K]+=F[K],y[K]+=F[K];return t;function m(){if(D=0,0!==(S=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2])))for(var R=0;R<3;R++){var q=F[R]>=0;c[R]=q?1:-1;var L=q?y[R]:C[R];n[R]=q?C[R]:y[R],r[R]=W(L,c[R]),p[R]=H(n[R],c[R]),v[R]=F[R]/S,d[R]=Math.abs(1/v[R]);var B=q?r[R]+1-L:L-r[R];f[R]=d[R]<1/0?d[R]*B:1/0}}function o(q){for(var L=c[0],B=0===q?r[0]:p[0],N=r[0]+L,h=c[1],Z=1===q?r[1]:p[1],z=r[1]+h,Y=c[2],F=2===q?r[2]:p[2],C=r[2]+Y,e=B;e!=N;e+=L)for(var y=Z;y!=z;y+=h)for(var U=F;U!=C;U+=Y)if(R(e,y,U))return!0;return!1}function l(){t+=D;var R=c[I],q=D/S,L=e;for(K=0;K<3;K++){var B=F[K]*q;C[K]+=B,y[K]+=B,L[K]=F[K]-B}if(R>0?y[I]=Math.round(y[I]):C[I]=Math.round(C[I]),z(t,I,R,L))return!0;for(K=0;K<3;K++)F[K]=L[K];return m(),0===S}function G(){var R=f[0]<f[1]?f[0]<f[2]?0:2:f[1]<f[2]?1:2,q=f[R]-D;for(D=f[R],r[R]+=c[R],f[R]+=d[R],K=0;K<3;K++)n[K]+=q*v[K],p[K]=H(n[K],c[K]);return R}function W(R,q){return T(R-q*U)}function H(R,q){return T(R+q*U)}}(R,r,d,f,v,c);if(!p){for(t=0;t<3;t++)T[t]=n[t]>0?v[t]-U.max[t]:f[t]-U.base[t];U.translate(T)}return D}},10733:(R,q,L)=>{var B=L(10735);function N(R){for(var q,L,N=0,h=R.length,Z=0;Z<R.length;){for(q=R[Z],L=0;Z<h&&R[Z]===q;)++Z,++L;N+=B.log2(L)/7|0,N+=B.log2(q>>>0)/7|0,N+=2}return N}q.size=N,q.encode=function(R,q){q||(q=new Uint8Array(N(R)));for(var L,B,h=0,Z=q.length,z=0;z<R.length;){for(L=R[z],B=0;z<R.length&&R[z]===L;)++z,++B;for(;h<Z&&B>=128;)q[h++]=128+(127&B),B>>>=7;if(h>=Z)throw new Error("RLE buffer overflow");for(q[h++]=B,L>>>=0;h<Z&&L>=128;)q[h++]=128+(127&L),L>>>=7;if(h>=Z)throw new Error("RLE buffer overflow");q[h++]=L}return q},q.decode=function(R,q){for(var L,B,N,h,Z=q.length,z=R.length,Y=0,F=0;F<z;){for(L=0,B=0;F<z&&R[F]>=128;)L+=(127&R[F++])<<B,B+=7;if(L+=R[F++]<<B,F>=z)throw new Error("RLE buffer underrun");if(Y+L>Z)throw new Error("Chunk buffer overflow");for(N=0,B=0;F<z&&R[F]>=128;)N+=(127&R[F++])<<B,B+=7;if(F>=z)throw new Error("RLE buffer underrun");for(N+=R[F++]<<B,h=0;h<L;++h)q[Y++]=N}return q}},10735:(R,q)=>{"use strict";function L(R){var q=32;return(R&=-R)&&q--,65535&R&&(q-=16),16711935&R&&(q-=8),252645135&R&&(q-=4),858993459&R&&(q-=2),1431655765&R&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(R){return(R>0)-(R<0)},q.abs=function(R){var q=R>>31;return(R^q)-q},q.min=function(R,q){return q^(R^q)&-(R<q)},q.max=function(R,q){return R^(R^q)&-(R<q)},q.isPow2=function(R){return!(R&R-1)&&!!R},q.log2=function(R){var q,L;return q=(R>65535)<<4,q|=L=((R>>>=q)>255)<<3,q|=L=((R>>>=L)>15)<<2,(q|=L=((R>>>=L)>3)<<1)|(R>>>=L)>>1},q.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},q.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},q.countTrailingZeros=L,q.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},q.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},q.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var B=new Array(256);!function(R){for(var q=0;q<256;++q){var L=q,B=q,N=7;for(L>>>=1;L;L>>>=1)B<<=1,B|=1&L,--N;R[q]=B<<N&255}}(B),q.reverse=function(R){return B[255&R]<<24|B[R>>>8&255]<<16|B[R>>>16&255]<<8|B[R>>>24&255]},q.interleave2=function(R,q){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(R,q){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>q&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},q.interleave3=function(R,q,L){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},q.deinterleave3=function(R,q){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>q&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},q.nextCombination=function(R){var q=R|R-1;return q+1|(~q&-~q)-1>>>L(R)+1}},12530:(R,q,L)=>{"use strict";L.d(q,{c:()=>e});var B=L(12349),N=L(122);class h{constructor(R,q,L,h,Z,z,Y){this.sg=new B(R.base,R.Kg),this.mass=q,this.friction=L,this.restitution=h,this.Oc=Z,this.Dk=z,this.Qc=!!Y,this.Jg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ol=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.If=N.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=N.create(),this._impulses=N.create(),this._sleepFrameCount=10}loadFromCopy(R){N.i(this.sg.base,R.sg.base),N.i(this.sg.Kg,R.sg.Kg),N.i(this.sg.max,R.sg.max),this.sg.mag=R.sg.mag,this.mass=R.mass,this.friction=R.friction,this.restitution=R.restitution,this.Oc=R.Oc,this.Dk=R.Dk,this.Qc=R.Qc,this.Jg=R.Jg,this.fluidDrag=R.fluidDrag,this.ol=R.ol,this.preventFallOffEdge=R.preventFallOffEdge,this.rolledBackLastTick=R.rolledBackLastTick,N.i(this.If,R.If),N.i(this.resting,R.resting),this.inFluid=R.inFluid,this._ratioInFluid=R._ratioInFluid,N.i(this._forces,R._forces),N.i(this._impulses,R._impulses),this._sleepFrameCount=R._sleepFrameCount}setPosition(R){Z(R),N.Bc(R,R,this.sg.base),this.sg.translate(R),this.Of()}cb(){return N.clone(this.sg.base)}applyForce(R){Z(R),N.add(this._forces,this._forces,R),this.Of()}applyImpulse(R){Z(R),N.add(this._impulses,this._impulses,R),this.Of()}Of(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Z=R=>{};var z=L(12349),Y=L(122),F=L(12354);function C(){this.Jg=.1,this.fluidDrag=.4,this._c=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function e(R,q,L){R=Object.assign(new C,R),this.gravity=R.gravity||[0,-10,0],this.Jg=R.Jg||.1,this._c=R._c||2,this.fluidDrag=R.fluidDrag||.4,this.minBounceImpulse=R.minBounceImpulse,this.bodies=[],this.$j=R.$j,this.testSolid=q,this.testFluid=L}e.prototype.Kk=function(R,q,L,B,N,Z){R=R||new z([0,0,0],[1,1,1]),"undefined"==typeof q&&(q=1),"undefined"==typeof L&&(L=1),"undefined"==typeof B&&(B=0),"undefined"==typeof N&&(N=1);var Y=new h(R,q,L,B,N,Z);return this.bodies.push(Y),Y},e.prototype.Lk=function(R){var q=this.bodies.indexOf(R);q<0||(this.bodies.splice(q,1),R.sg=R.Dk=null)};var y=Y.create(),U=Y.create(),n=Y.create(),r=Y.create(),p=Y.create(),c=Y.create(),d=Y.create(),f=new z([0,0,0],[1,1,1]),v=new h(f,1,1,0,1,(()=>{}),!1);function T(R,q,L){return q=L,q*=1-(1-R.ratioInFluid)**2}e.prototype.yd=function(R){R/=1e3;var q=g(0,Y.squaredLength(this.gravity));this.bodies.forEach((L=>function(R,q,L,B){Y.i(p,q.resting),R.$j&&v.loadFromCopy(q);if(q.mass<=0)return Y.set(q.If,0,0,0),Y.set(q._forces,0,0,0),void Y.set(q._impulses,0,0,0);var N=B||0===q.Oc;if(function(R,q,L,B){if(q._sleepFrameCount>0)return!1;if(B)return!0;var N=!1,h=.5*L*L*q.Oc;return Y.scale(a,R.gravity,h),F(R.testSolid,q.sg,a,(function(){return N=!0,!0}),!0),N}(R,q,L,N))return;q._sleepFrameCount--,function(R,q){var L=q.sg,B=Math.floor(L.base[0]),N=Math.floor(L.base[2]),h=Math.floor(L.base[1]),Z=Math.floor(L.max[1]);if(!R.testFluid(B,h,N))return q.inFluid=!1,void(q.ratioInFluid=0);var z=1,F=h+1;for(;F<=Z&&R.testFluid(B,F,N);)z++,F++;var C=(h+z-L.base[1])/L.Kg[1];C>1&&(C=1);var e=L.Kg[0]*L.Kg[1]*L.Kg[2]*C,y=D;Y.scale(y,R.gravity,-R._c*e*q.Oc),q.applyForce(y),q.inFluid=!0,q.ratioInFluid=C}(R,q),i(q._forces),i(q._impulses),i(q.If),i(q.resting),Y.scale(y,q._forces,1/q.mass),Y.ld(y,y,R.gravity,q.Oc),Y.scale(U,q._impulses,1/q.mass),Y.ld(U,U,y,L),Y.add(q.If,q.If,U),q.friction&&(S(R,0,q,U,L),S(R,1,q,U,L),S(R,2,q,U,L));var h=q.fluidDrag>=0?q.fluidDrag:R.fluidDrag,Z=q.Jg>=0?q.Jg:R.Jg,z=Z,C=Z;q.inFluid&&(z=T(q,z,q.fluidDragHoriz>=0?q.fluidDragHoriz:h),C=T(q,C,q.fluidDragVert>=0?q.fluidDragVert:h));z=Math.max(1-z*L/q.mass,0),C=Math.max(1-C*L/q.mass,0),Y.set(t,z,C,z),Y.multiply(q.If,q.If,t),Y.scale(n,q.If,L),Y.set(q._forces,0,0,0),Y.set(q._impulses,0,0,0),q.Qc&&Q(m,q.sg);Y.i(c,n),Y.set(d,0,0,0),q.preventFallOffEdge&&function(R,q,L,B){if(!q.resting[1]||L[1]>0)return;var N=P;Q(N,q.sg);for(var h=0;h<3;h+=2){Y.set(H,0,0,0),H[h]=L[h];var Z=!0;(Z=(Z=(Z=(Z=Z&&!E(R,N.base[0]+H[0]+1e-5,N.base[1],N.base[2]+H[2]+1e-5))&&!E(R,N.max[0]+H[0]-1e-5,N.base[1],N.base[2]+H[2]+1e-5))&&!E(R,N.base[0]+H[0]+1e-5,N.base[1],N.max[2]+H[2]-1e-5))&&!E(R,N.max[0]+H[0]-1e-5,N.base[1],N.max[2]+H[2]-1e-5))?(B[h]=L[h]>0?1:-1,L[h]=0):0===h&&(Y.set(O,L[0],0,0),K(R,N,O,B,q.slideOnCollision))}}(R,q,n,d);K(R,q.sg,n,q.resting,q.slideOnCollision),q.Qc&&function(R,q,L,B){if(q.resting[1]>=0&&!q.inFluid)return;var N=0!==q.resting[0],h=0!==q.resting[2];if(!N&&!h)return;var Z=Math.abs(B[0]/B[2]),z=4;if(!N&&Z>z)return;if(!h&&Z<1/z)return;Y.add(l,L.base,B);var C=R.testSolid;F(C,L,B,(function(R,q,L,B){if(1!==q)return!0;B[q]=0}));var e=L.base[1],y=q.inFluid?1.951:1.001,U=Math.floor(e+y)-e;Y.set(G,0,U,0);var n=!1;if(F(C,L,G,(function(R,q,L,B){return n=!0,!0})),n)return;Y.Bc(W,l,L.base),W[1]=0,K(R,L,W,o,!0);var r=g(L.base[0],l[0]),p=g(L.base[2],l[2]);if(N&&!r&&(!p||!h))return;if(h&&(!r||!N)&&!p)return;var c=!0;if(c=c&&!E(R,L.base[0]+1e-5,L.base[1],L.base[2]+1e-5),c=c&&!E(R,L.max[0]-1e-5,L.base[1],L.base[2]+1e-5),c=c&&!E(R,L.base[0]+1e-5,L.base[1],L.max[2]-1e-5),c=c&&!E(R,L.max[0]-1e-5,L.base[1],L.max[2]-1e-5),c)return;Q(q.sg,L),q.resting[0]=o[0],q.resting[2]=o[2],q.ol&&q.ol()}(R,q,m,c);for(var e=0;e<3;++e)q.resting[e]=q.resting[e]||d[e],r[e]=0,q.resting[e]&&(p[e]||(r[e]=-q.If[e]),q.If[e]=0);var f=Y.length(r);f>.001&&(Y.scale(r,r,q.mass),q.Dk&&q.Dk(r),q.restitution>0&&f>R.minBounceImpulse&&(Y.scale(r,r,q.restitution),q.applyImpulse(r)));var I=Y.squaredLength(q.If);I>1e-5&&q.Of();R.$j&&R.$j(q)?(q.loadFromCopy(v),q.rolledBackLastTick=!0):q.rolledBackLastTick=!1}(this,L,R,q)))};var t=Y.create([0,0,0]);var D=Y.create();function S(R,q,L,B,N){var h=L.resting[q],Z=B[q];if(!L.alwaysApplyHorizFriction||1!==q){if(0===h)return;if(h*Z<=0)return}Y.i(I,L.If),I[q]=0;var z=Y.length(I);if(!g(z,0)){var F=Math.abs(L.friction*R.gravity[q]*N),C=z>F?(z-F)/z:0;L.If[(q+1)%3]*=C,L.If[(q+2)%3]*=C}}var I=Y.create();function K(R,q,L,B,N){return Y.set(B,0,0,0),F(R.testSolid,q,L,(function(R,q,L,h){B[q]=L,h[q]=0,N||(h[0]=0,h[1]=0,h[2]=0)}))}var m=new z([],[]),o=Y.create(),l=Y.create(),G=Y.create(),W=Y.create();var H=Y.create(),P=new z([],[]),O=Y.create();function E(R,q,L,B){return R.testSolid(Math.floor(q),Math.floor(L-1),Math.floor(B))}var a=Y.create();function g(R,q){return Math.abs(R-q)<1e-5}function Q(R,q){for(var L=0;L<3;L++)R.base[L]=q.base[L],R.max[L]=q.max[L],R.Kg[L]=q.Kg[L]}var i=function(R){}},10914:R=>{"use strict";R.exports=function(R,q,L,B){var N=self||window;try{try{var h;try{h=new N.Blob([R])}catch(F){(h=new(N.BlobBuilder||N.WebKitBlobBuilder||N.MozBlobBuilder||N.MSBlobBuilder)).append(R),h=h.getBlob()}var Z=N.URL||N.webkitURL,z=Z.createObjectURL(h),Y=new N[q](z,L);return Z.revokeObjectURL(z),Y}catch(F){return new N[q]("data:application/javascript,".concat(encodeURIComponent(R)),L)}}catch(F){if(!B)throw Error("Inline worker is not supported");return new N[q](B,L)}}},11978:(R,q,L)=>{"use strict";function B(R,q,L,B,N){var h={};return Object.keys(B).forEach((function(R){h[R]=B[R]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=L.slice().reverse().reduce((function(L,B){return B(R,q,L)||L}),h),N&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(N):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(R,q,h),h=null),h}L.d(q,{d:()=>B})},11969:(R,q,L)=>{"use strict";function B(R,q,L,B){L&&Object.defineProperty(R,q,{enumerable:L.enumerable,configurable:L.configurable,writable:L.writable,value:L.initializer?L.initializer.call(B):void 0})}L.d(q,{d:()=>B})},12047:(R,q,L)=>{"use strict";L.d(q,{b:()=>f,e:()=>p,i:()=>c,j:()=>y,k:()=>r,n:()=>n,q:()=>U});var B=L(11081),N=L(11112),h=L(11099),Z=L(10889),z=L(12051),Y=L(11345),F=L(11287),C=L(10791),e=L(11117);const y=Object.freeze(new B.d(0,0,0,0)),U=Object.freeze(B.m.Zero()),n=Object.freeze(B.i.Zero()),r=Object.freeze(F.c.Zero()),p=Object.freeze(N.e.Black()),c=Object.freeze(new N.g(0,0,0,0)),d={key:0,repeatCount:0,loopMode:2};class f{static _PrepareAnimation(R,q,L,h,Z,z,Y,C){let e;if(!isNaN(parseFloat(Z))&&isFinite(Z)?e=f.ANIMATIONTYPE_FLOAT:Z instanceof B.d?e=f.ANIMATIONTYPE_QUATERNION:Z instanceof B.m?e=f.ANIMATIONTYPE_VECTOR3:Z instanceof B.i?e=f.ANIMATIONTYPE_VECTOR2:Z instanceof N.e?e=f.ANIMATIONTYPE_COLOR3:Z instanceof N.g?e=f.ANIMATIONTYPE_COLOR4:Z instanceof F.c&&(e=f.ANIMATIONTYPE_SIZE),void 0==e)return null;const y=new f(R,q,L,e,Y),U=[{frame:0,value:Z},{frame:h,value:z}];return y.setKeys(U),void 0!==C&&y.setEasingFunction(C),y}static CreateAnimation(R,q,L,B){const N=new f(R+"Animation",R,L,q,f.ANIMATIONLOOPMODE_CONSTANT);return N.setEasingFunction(B),N}static CreateAndStartAnimation(R,q,L,B,N,h,Z,z,Y,F,C){const e=f._PrepareAnimation(R,L,B,N,h,Z,z,Y);return e?(q.va&&(C=q.va()),C?C.beginDirectAnimation(q,[e],0,N,1===e.loopMode,1,F):null):null}static CreateAndStartHierarchyAnimation(R,q,L,B,N,h,Z,z,Y,F,C){const e=f._PrepareAnimation(R,B,N,h,Z,z,Y,F);if(!e)return null;return q.va().beginDirectHierarchyAnimation(q,L,[e],0,h,1===e.loopMode,1,C)}static CreateMergeAndStartAnimation(R,q,L,B,N,h,Z,z,Y,F){const C=f._PrepareAnimation(R,L,B,N,h,Z,z,Y);return C?(q.animations.push(C),q.va().beginAnimation(q,0,N,1===C.loopMode,1,F)):null}static MakeAnimationAdditive(R,q,L){let N;N="object"===typeof q?q:{referenceFrame:q??0,range:L,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let h=R;if(N.cloneOriginalAnimation&&(h=R.clone(),h.name=N.clonedAnimationName||h.name),!h._keys.length)return h;const Z=N.referenceFrame&&N.referenceFrame>=0?N.referenceFrame:0;let z=0;const Y=h._keys[0];let F=h._keys.length-1;const C=h._keys[F],e={referenceValue:Y.value,referencePosition:B.h.o[0],referenceQuaternion:B.h.Quaternion[0],referenceScaling:B.h.o[1],keyPosition:B.h.o[2],keyQuaternion:B.h.Quaternion[1],keyScaling:B.h.o[3]};let y=Y.frame,U=C.frame;if(N.range){const R=h.getRange(N.range);R&&(y=R.from,U=R.to)}else y=N.fromFrame??y,U=N.toFrame??U;if(y!==Y.frame&&(z=h.createKeyForFrame(y)),U!==C.frame&&(F=h.createKeyForFrame(U)),1===h._keys.length){const R=h._getKeyValue(h._keys[0]);e.referenceValue=R.clone?R.clone():R}else if(Z<=Y.frame){const R=h._getKeyValue(Y.value);e.referenceValue=R.clone?R.clone():R}else if(Z>=C.frame){const R=h._getKeyValue(C.value);e.referenceValue=R.clone?R.clone():R}else{d.key=0;const R=h._interpolate(Z,d);e.referenceValue=R.clone?R.clone():R}h.dataType===f.ANIMATIONTYPE_QUATERNION?e.referenceValue.normalize().conjugateInPlace():h.dataType===f.ANIMATIONTYPE_MATRIX&&(e.referenceValue.decompose(e.referenceScaling,e.referenceQuaternion,e.referencePosition),e.referenceQuaternion.normalize().conjugateInPlace());let n=Number.MAX_VALUE;const r=N.clipKeys?[]:null;for(let p=z;p<=F;p++){let R=h._keys[p];if((r||N.cloneOriginalAnimation)&&(R={frame:R.frame,value:R.value.clone?R.value.clone():R.value,inTangent:R.inTangent,outTangent:R.outTangent,interpolation:R.interpolation,lockedTangent:R.lockedTangent},r&&(n===Number.MAX_VALUE&&(n=R.frame),R.frame-=n,r.push(R))),!p||h.dataType===f.ANIMATIONTYPE_FLOAT||R.value!==Y.value)switch(h.dataType){case f.ANIMATIONTYPE_MATRIX:R.value.decompose(e.keyScaling,e.keyQuaternion,e.keyPosition),e.keyPosition.ki(e.referencePosition),e.keyScaling.divideInPlace(e.referenceScaling),e.referenceQuaternion.multiplyToRef(e.keyQuaternion,e.keyQuaternion),B.c.ComposeToRef(e.keyScaling,e.keyQuaternion,e.keyPosition,R.value);break;case f.ANIMATIONTYPE_QUATERNION:e.referenceValue.multiplyToRef(R.value,R.value);break;case f.ANIMATIONTYPE_VECTOR2:case f.ANIMATIONTYPE_VECTOR3:case f.ANIMATIONTYPE_COLOR3:case f.ANIMATIONTYPE_COLOR4:R.value.subtractToRef(e.referenceValue,R.value);break;case f.ANIMATIONTYPE_SIZE:R.value.width-=e.referenceValue.width,R.value.height-=e.referenceValue.height;break;default:R.value-=e.referenceValue}}return r&&h.setKeys(r,!0),h}static TransitionTo(R,q,L,B,N,h,Z){let z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(Z<=0)return L[R]=q,z&&z(),null;const Y=N*(Z/1e3);h.setKeys([{frame:0,value:L[R].clone?L[R].clone():L[R]},{frame:Y,value:q}]),L.animations||(L.animations=[]),L.animations.push(h);const F=B.beginAnimation(L,0,Y,!1);return F.onAnimationEnd=z,F}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const R of this._runtimeAnimations)if(!R.isStopped())return!0;return!1}constructor(R,q,L,B,N,h){this.name=R,this.targetProperty=q,this.framePerSecond=L,this.dataType=B,this.loopMode=N,this.enableBlending=h,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=q.split("."),this.dataType=B,this.loopMode=void 0===N?f.ANIMATIONLOOPMODE_CYCLE:N,this.uniqueId=f._UniqueIdGenerator++}toString(R){let q="Name: "+this.name+", property: "+this.targetProperty;if(q+=", datatype: "+["Float","o","Quaternion","Matrix","gb","Vector2"][this.dataType],q+=", nKeys: "+(this._keys?this._keys.length:"none"),q+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),R){q+=", Ranges: {";let R=!0;for(const L in this._ranges)R&&(q+=", ",R=!1),q+=L;q+="}"}return q}addEvent(R){this._events.push(R),this._events.sort(((R,q)=>R.frame-q.frame))}removeEvents(R){for(let q=0;q<this._events.length;q++)this._events[q].frame===R&&(this._events.splice(q,1),q--)}getEvents(){return this._events}createRange(R,q,L){this._ranges[R]||(this._ranges[R]=new z.e(R,q,L))}deleteRange(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this._ranges[R];if(L){if(q){const R=L.from,q=L.to;for(let L=this._keys.length-1;L>=0;L--)this._keys[L].frame>=R&&this._keys[L].frame<=q&&this._keys.splice(L,1)}this._ranges[R]=null}}getRange(R){return this._ranges[R]}getKeys(){return this._keys}getHighestFrame(){let R=0;for(let q=0,L=this._keys.length;q<L;q++)R<this._keys[q].frame&&(R=this._keys[q].frame);return R}getEasingFunction(){return this._easingFunction}setEasingFunction(R){this._easingFunction=R}floatInterpolateFunction(R,q,L){return(0,h.h)(R,q,L)}floatInterpolateFunctionWithTangents(R,q,L,B,N){return(0,h.c)(R,q,L,B,N)}quaternionInterpolateFunction(R,q,L){return B.d.Slerp(R,q,L)}quaternionInterpolateFunctionWithTangents(R,q,L,N,h){return B.d.Hermite(R,q,L,N,h).normalize()}vector3InterpolateFunction(R,q,L){return B.m.Lerp(R,q,L)}vector3InterpolateFunctionWithTangents(R,q,L,N,h){return B.m.Hermite(R,q,L,N,h)}vector2InterpolateFunction(R,q,L){return B.i.Lerp(R,q,L)}vector2InterpolateFunctionWithTangents(R,q,L,N,h){return B.i.Hermite(R,q,L,N,h)}sizeInterpolateFunction(R,q,L){return F.c.Lerp(R,q,L)}color3InterpolateFunction(R,q,L){return N.e.Lerp(R,q,L)}color3InterpolateFunctionWithTangents(R,q,L,B,h){return N.e.Hermite(R,q,L,B,h)}color4InterpolateFunction(R,q,L){return N.g.Lerp(R,q,L)}color4InterpolateFunctionWithTangents(R,q,L,B,h){return N.g.Hermite(R,q,L,B,h)}_getKeyValue(R){return"function"===typeof R?R():R}evaluate(R){return d.key=0,this._interpolate(R,d)}_interpolate(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(q.loopMode===f.ANIMATIONLOOPMODE_CONSTANT&&q.repeatCount>0)return q.highLimitValue.clone?q.highLimitValue.clone():q.highLimitValue;const B=this._keys,N=B.length;let h=q.key;for(;h>=0&&R<B[h].frame;)--h;for(;h+1<=N-1&&R>=B[h+1].frame;)++h;if(q.key=h,h<0)return L?void 0:this._getKeyValue(B[0].value);if(h+1>N-1)return L?void 0:this._getKeyValue(B[N-1].value);const Z=B[h],z=B[h+1];if(L&&(R===Z.frame||R===z.frame))return;const Y=this._getKeyValue(Z.value),F=this._getKeyValue(z.value);if(1===Z.interpolation)return z.frame>R?Y:F;const C=void 0!==Z.outTangent&&void 0!==z.inTangent,e=z.frame-Z.frame;let d=(R-Z.frame)/e;const v=Z.easingFunction||this.getEasingFunction();switch(null!==v&&(d=v.ease(d)),this.dataType){case f.ANIMATIONTYPE_FLOAT:{const R=C?this.floatInterpolateFunctionWithTangents(Y,Z.outTangent*e,F,z.inTangent*e,d):this.floatInterpolateFunction(Y,F,d);switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return R;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(q.offsetValue??0)*q.repeatCount+R}break}case f.ANIMATIONTYPE_QUATERNION:{const R=C?this.quaternionInterpolateFunctionWithTangents(Y,Z.outTangent.scale(e),F,z.inTangent.scale(e),d):this.quaternionInterpolateFunction(Y,F,d);switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return R;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.addInPlace((q.offsetValue||y).scale(q.repeatCount))}return R}case f.ANIMATIONTYPE_VECTOR3:{const R=C?this.vector3InterpolateFunctionWithTangents(Y,Z.outTangent.scale(e),F,z.inTangent.scale(e),d):this.vector3InterpolateFunction(Y,F,d);switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return R;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((q.offsetValue||U).scale(q.repeatCount))}break}case f.ANIMATIONTYPE_VECTOR2:{const R=C?this.vector2InterpolateFunctionWithTangents(Y,Z.outTangent.scale(e),F,z.inTangent.scale(e),d):this.vector2InterpolateFunction(Y,F,d);switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return R;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((q.offsetValue||n).scale(q.repeatCount))}break}case f.ANIMATIONTYPE_SIZE:switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(Y,F,d);case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(Y,F,d).add((q.offsetValue||r).scale(q.repeatCount))}break;case f.ANIMATIONTYPE_COLOR3:{const R=C?this.color3InterpolateFunctionWithTangents(Y,Z.outTangent.scale(e),F,z.inTangent.scale(e),d):this.color3InterpolateFunction(Y,F,d);switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return R;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((q.offsetValue||p).scale(q.repeatCount))}break}case f.ANIMATIONTYPE_COLOR4:{const R=C?this.color4InterpolateFunctionWithTangents(Y,Z.outTangent.scale(e),F,z.inTangent.scale(e),d):this.color4InterpolateFunction(Y,F,d);switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return R;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((q.offsetValue||c).scale(q.repeatCount))}break}case f.ANIMATIONTYPE_MATRIX:switch(q.loopMode){case f.ANIMATIONLOOPMODE_CYCLE:case f.ANIMATIONLOOPMODE_CONSTANT:case f.ANIMATIONLOOPMODE_YOYO:return f.AllowMatricesInterpolation?this.matrixInterpolateFunction(Y,F,d,q.workValue):Y;case f.ANIMATIONLOOPMODE_RELATIVE:case f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Y}}return 0}matrixInterpolateFunction(R,q,L,N){return f.AllowMatrixDecomposeForInterpolation?N?(B.c.DecomposeLerpToRef(R,q,L,N),N):B.c.DecomposeLerp(R,q,L):N?(B.c.LerpToRef(R,q,L,N),N):B.c.Lerp(R,q,L)}clone(){const R=new f(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(R.enableBlending=this.enableBlending,R.blendingSpeed=this.blendingSpeed,this._keys&&R.setKeys(this._keys),this._ranges){R._ranges={};for(const q in this._ranges){const L=this._ranges[q];L&&(R._ranges[q]=L.clone())}}return R}setKeys(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=q?R:R.slice(0)}createKeyForFrame(R){d.key=0;const q=this._interpolate(R,d,!0);if(!q)return this._keys[d.key].frame===R?d.key:d.key+1;const L={frame:R,value:q.clone?q.clone():q};return this._keys.splice(d.key+1,0,L),d.key+1}serialize(){const R={};R.name=this.name,R.property=this.targetProperty,R.framePerSecond=this.framePerSecond,R.dataType=this.dataType,R.loopBehavior=this.loopMode,R.enableBlending=this.enableBlending,R.blendingSpeed=this.blendingSpeed;const q=this.dataType;R.keys=[];const L=this.getKeys();for(let B=0;B<L.length;B++){const N=L[B],h={};switch(h.frame=N.frame,q){case f.ANIMATIONTYPE_FLOAT:h.values=[N.value],void 0!==N.inTangent&&h.values.push(N.inTangent),void 0!==N.outTangent&&(void 0===N.inTangent&&h.values.push(void 0),h.values.push(N.outTangent)),void 0!==N.interpolation&&(void 0===N.inTangent&&h.values.push(void 0),void 0===N.outTangent&&h.values.push(void 0),h.values.push(N.interpolation));break;case f.ANIMATIONTYPE_QUATERNION:case f.ANIMATIONTYPE_MATRIX:case f.ANIMATIONTYPE_VECTOR3:case f.ANIMATIONTYPE_COLOR3:case f.ANIMATIONTYPE_COLOR4:h.values=N.value.dj(),void 0!=N.inTangent&&h.values.push(N.inTangent.dj()),void 0!=N.outTangent&&(void 0===N.inTangent&&h.values.push(void 0),h.values.push(N.outTangent.dj())),void 0!==N.interpolation&&(void 0===N.inTangent&&h.values.push(void 0),void 0===N.outTangent&&h.values.push(void 0),h.values.push(N.interpolation))}R.keys.push(h)}R.ranges=[];for(const B in this._ranges){const q=this._ranges[B];if(!q)continue;const L={};L.name=B,L.from=q.from,L.to=q.to,R.ranges.push(L)}return R}static _UniversalLerp(R,q,L){const B=R.constructor;return B.Lerp?B.Lerp(R,q,L):B.Slerp?B.Slerp(R,q,L):R.toFixed?R*(1-L)+L*q:q}static Parse(R){const q=new f(R.name,R.property,R.framePerSecond,R.dataType,R.loopBehavior),L=R.dataType,h=[];let Z,z;for(R.enableBlending&&(q.enableBlending=R.enableBlending),R.blendingSpeed&&(q.blendingSpeed=R.blendingSpeed),z=0;z<R.keys.length;z++){const q=R.keys[z];let Y,F,C;switch(L){case f.ANIMATIONTYPE_FLOAT:Z=q.values[0],q.values.length>=2&&(Y=q.values[1]),q.values.length>=3&&(F=q.values[2]),q.values.length>=4&&(C=q.values[3]);break;case f.ANIMATIONTYPE_QUATERNION:if(Z=B.d.Ig(q.values),q.values.length>=8){const R=B.d.Ig(q.values.slice(4,8));R.equals(B.d.Zero())||(Y=R)}if(q.values.length>=12){const R=B.d.Ig(q.values.slice(8,12));R.equals(B.d.Zero())||(F=R)}q.values.length>=13&&(C=q.values[12]);break;case f.ANIMATIONTYPE_MATRIX:Z=B.c.Ig(q.values),q.values.length>=17&&(C=q.values[16]);break;case f.ANIMATIONTYPE_COLOR3:Z=N.e.Ig(q.values),q.values[3]&&(Y=N.e.Ig(q.values[3])),q.values[4]&&(F=N.e.Ig(q.values[4])),q.values[5]&&(C=q.values[5]);break;case f.ANIMATIONTYPE_COLOR4:Z=N.g.Ig(q.values),q.values[4]&&(Y=N.g.Ig(q.values[4])),q.values[5]&&(F=N.g.Ig(q.values[5])),q.values[6]&&(C=N.g.Ig(q.values[6]));break;case f.ANIMATIONTYPE_VECTOR3:default:Z=B.m.Ig(q.values),q.values[3]&&(Y=B.m.Ig(q.values[3])),q.values[4]&&(F=B.m.Ig(q.values[4])),q.values[5]&&(C=q.values[5])}const e={};e.frame=q.frame,e.value=Z,void 0!=Y&&(e.inTangent=Y),void 0!=F&&(e.outTangent=F),void 0!=C&&(e.interpolation=C),h.push(e)}if(q.setKeys(h),R.ranges)for(z=0;z<R.ranges.length;z++)Z=R.ranges[z],q.createRange(Z.name,Z.from,Z.to);return q}static AppendSerializedAnimations(R,q){e.b.AppendSerializedAnimations(R,q)}static ParseFromFileAsync(R,q){return new Promise(((L,B)=>{const N=new C.b;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){let q=JSON.parse(N.responseText);if(q.animations&&(q=q.animations),q.length){const R=[];for(const L of q)R.push(this.Parse(L));L(R)}else{const B=this.Parse(q);R&&(B.name=R),L(B)}}else B("Unable to load the animation")})),N.open("GET",q),N.send()}))}static ParseFromSnippetAsync(R){return new Promise(((q,L)=>{const B=new C.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const L=JSON.parse(JSON.parse(B.responseText).jsonPayload);if(L.animations){const B=JSON.parse(L.animations),N=[];for(const q of B.animations){const L=this.Parse(q);L.snippetId=R,N.push(L)}q(N)}else{const B=JSON.parse(L.animation),N=this.Parse(B);N.snippetId=R,q(N)}}else L("Unable to load the snippet "+R)})),B.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),B.send()}))}}f._UniqueIdGenerator=0,f.AllowMatricesInterpolation=!1,f.AllowMatrixDecomposeForInterpolation=!0,f.SnippetUrl="https://snippet.babylonjs.com",f.ANIMATIONTYPE_FLOAT=0,f.ANIMATIONTYPE_VECTOR3=1,f.ANIMATIONTYPE_QUATERNION=2,f.ANIMATIONTYPE_MATRIX=3,f.ANIMATIONTYPE_COLOR3=4,f.ANIMATIONTYPE_COLOR4=7,f.ANIMATIONTYPE_VECTOR2=5,f.ANIMATIONTYPE_SIZE=6,f.ANIMATIONLOOPMODE_RELATIVE=0,f.ANIMATIONLOOPMODE_CYCLE=1,f.ANIMATIONLOOPMODE_CONSTANT=2,f.ANIMATIONLOOPMODE_YOYO=4,f.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,f.CreateFromSnippetAsync=f.ParseFromSnippetAsync,(0,Z.f)("BABYLON.Animation",f),Y.d._AnimationRangeFactory=(R,q,L)=>new z.e(R,q,L)},12051:(R,q,L)=>{"use strict";L.d(q,{e:()=>B});class B{constructor(R,q,L){this.name=R,this.from=q,this.to=L}clone(){return new B(this.name,this.from,this.to)}}},11645:(R,q,L)=>{"use strict";var B=L(10760),N=L(10767),h=L(10834),Z=L(10763);h.e.AudioEngineFactory=(R,q,L)=>new z(R,q,L);class z{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new B.b,this.onAudioLockedObservable=new B.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,Z.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const N=document.createElement("audio");this._hostElement=R,this._audioContext=q,this._audioDestination=L;try{N&&N.canPlayType&&(N.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||N.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(h){}try{N&&N.canPlayType&&N.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(h){}}lock(){this._triggerSuspendedState()}unlock(){var R,q;if("running"===(null===(R=this._audioContext)||void 0===R?void 0:R.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(q=this._audioContext)||void 0===q||q.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var R;null===(R=this._audioContext)||void 0===R||R.addEventListener("statechange",(()=>{var R;this.unlocked&&"running"!==(null===(R=this._audioContext)||void 0===R?void 0:R.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var R;return null!==(R=this._audioContext)&&void 0!==R&&R.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(R){this.canUseWebAudio=!1,N.d.Error("Web Audio: "+R.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const R=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",q=document.createElement("style");q.appendChild(document.createTextNode(R)),document.getElementsByTagName("head")[0].appendChild(q),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(R){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=R)}connectToAnalyser(R){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=R,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12039:(R,q,L)=>{"use strict";L.d(q,{d:()=>Z});var B=L(11081),N=L(11092),h=L(11345);class Z extends h.d{get _matrix(){return this._compose(),this.Lj}set _matrix(R){(R.updateFlag!==this.Lj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Lj.p(R),this._markAsDirtyAndDecompose())}constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(R,q.va(),!1),this.name=R,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=q,this.Lj=(null===N||void 0===N?void 0:N.clone())??B.c.Identity(),this._restMatrix=h??this.Lj.clone(),this._bindMatrix=Z??this.Lj.clone(),this._index=z,this._absoluteMatrix=new B.c,this._absoluteBindMatrix=new B.c,this._absoluteInverseBindMatrix=new B.c,this._finalMatrix=new B.c,q.bones.push(this),this.setParent(L,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(R){this.setParent(R)}setParent(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==R){if(this.parent){const R=this.parent.children.indexOf(this);-1!==R&&this.parent.children.splice(R,1)}this._parentNode=R,this.parent&&this.parent.children.push(this),q&&this._updateAbsoluteBindMatrices(),this.Ag()}}getLocalMatrix(){return this._compose(),this.Lj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(R){this._restMatrix.p(R)}setRestPose(R){this.setRestMatrix(R)}getBindPose(){return this.getBindMatrix()}setBindMatrix(R){this.Cj(R)}setBindPose(R){this.setBindMatrix(R)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const R=B.h.o[0],q=B.h.Quaternion[0],L=B.h.o[1];this.getRestMatrix().decompose(R,q,L),this._linkedTransformNode.position.p(L),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??B.d.Identity(),this._linkedTransformNode.rotationQuaternion.p(q),this._linkedTransformNode.Ud.p(R)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(R){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=R,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Qd}set position(R){this._decompose(),this.Qd.p(R),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(R){this.setRotation(R)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(R){this.setRotationQuaternion(R)}get Ud(){return this.getScale()}set Ud(R){this.setScale(R)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=B.m.Zero(),this._localRotation=B.d.Zero(),this.Qd=B.m.Zero()),this.Lj.decompose(this._localScaling,this._localRotation,this.Qd))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,B.c.ComposeToRef(this._localScaling,this._localRotation,this.Qd,this.Lj)):this._needToCompose=!1)}Cj(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(R),q&&this._updateAbsoluteBindMatrices(),L?this._matrix=R:this.Ag()}_updateAbsoluteBindMatrices(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R||(R=this._bindMatrix),this.parent?R.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(R),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),q)for(let L=0;L<this.children.length;L++)this.children[L]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ag(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ag(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ag(),this._needToDecompose=!0}_updatePosition(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=this.getLocalMatrix();if(0==q)N?(h.addAtIndex(12,R.x),h.addAtIndex(13,R.y),h.addAtIndex(14,R.z)):h.setTranslationFromFloats(R.x,R.y,R.z);else{let q=null;L&&(q=L.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=Z._TmpMats[0],Y=Z._TmpVecs[0];this.parent?L&&q?(z.p(this.parent.getAbsoluteMatrix()),z.multiplyToRef(q,z)):z.p(this.parent.getAbsoluteMatrix()):B.c.IdentityToRef(z),N&&z.setTranslationFromFloats(0,0,0),z.invert(),B.m.TransformCoordinatesToRef(R,z,Y),N?(h.addAtIndex(12,Y.x),h.addAtIndex(13,Y.y),h.addAtIndex(14,Y.z)):h.setTranslationFromFloats(Y.x,Y.y,Y.z)}this._markAsDirtyAndDecompose()}translate(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,q,L,!0)}setPosition(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,q,L,!1)}setAbsolutePosition(R,q){this.setPosition(R,1,q)}scale(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=this.getLocalMatrix(),z=Z._TmpMats[0];B.c.ScalingToRef(R,q,L,z),z.multiplyToRef(h,h),z.invert();for(const B of this.children){const N=B.getLocalMatrix();N.multiplyToRef(z,N),N.multiplyAtIndex(12,R),N.multiplyAtIndex(13,q),N.multiplyAtIndex(14,L),B._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),N)for(const B of this.children)B.scale(R,q,L,N)}setScale(R){this._decompose(),this._localScaling.p(R),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(R){this._decompose(),R.p(this._localScaling)}setYawPitchRoll(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4?arguments[4]:void 0;if(0===N){const z=Z._TmpQuat;return B.d.RotationYawPitchRollToRef(R,q,L,z),void this.setRotationQuaternion(z,N,h)}const z=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,h))return;const Y=Z._TmpMats[1];B.c.RotationYawPitchRollToRef(R,q,L,Y),z.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,N,h)}rotate(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;const h=Z._TmpMats[0];h.setTranslationFromFloats(0,0,0),B.c.RotationAxisToRef(R,q,h),this._rotateWithMatrix(h,L,N)}setAxisAngle(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;if(0===L){const h=Z._TmpQuat;return B.d.RotationAxisToRef(R,q,h),void this.setRotationQuaternion(h,L,N)}const h=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,N))return;const z=Z._TmpMats[1];B.c.RotationAxisToRef(R,q,z),h.multiplyToRef(z,z),this._rotateWithMatrix(z,L,N)}setRotation(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(R.y,R.x,R.z,q,L)}setRotationQuaternion(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;if(0===q)return this._decompose(),this._localRotation.p(R),void this._markAsDirtyAndCompose();const N=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,L))return;const h=Z._TmpMats[1];B.c.FromQuaternionToRef(R,h),N.multiplyToRef(h,h),this._rotateWithMatrix(h,q,L)}setRotationMatrix(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;if(0===q){const N=Z._TmpQuat;return B.d.FromRotationMatrixToRef(R,N),void this.setRotationQuaternion(N,q,L)}const N=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,L))return;const h=Z._TmpMats[1];h.p(R),N.multiplyToRef(R,h),this._rotateWithMatrix(h,q,L)}_rotateWithMatrix(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;const B=this.getLocalMatrix(),N=B.m[12],h=B.m[13],z=B.m[14],Y=this.getParent(),F=Z._TmpMats[3],C=Z._TmpMats[4];Y&&1==q?(L?(F.p(L.getWorldMatrix()),Y.getAbsoluteMatrix().multiplyToRef(F,F)):F.p(Y.getAbsoluteMatrix()),C.p(F),C.invert(),B.multiplyToRef(F,B),B.multiplyToRef(R,B),B.multiplyToRef(C,B)):1==q&&L?(F.p(L.getWorldMatrix()),C.p(F),C.invert(),B.multiplyToRef(F,B),B.multiplyToRef(R,B),B.multiplyToRef(C,B)):B.multiplyToRef(R,B),B.setTranslationFromFloats(N,h,z),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(R,q){const L=Z._TmpMats[2];return R.p(this.getAbsoluteMatrix()),q?(R.multiplyToRef(q.getWorldMatrix(),R),B.c.ScalingToRef(q.Ud.x,q.Ud.y,q.Ud.z,L)):B.c.IdentityToRef(L),R.invert(),!isNaN(R.m[0])&&(L.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyToRef(L,R),!0)}cb(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=B.m.Zero();return this.getPositionToRef(R,q,L),L}getPositionToRef(){let R=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const R=this.getLocalMatrix();q.x=R.m[12],q.y=R.m[13],q.z=R.m[14]}else{let L=null;R&&(L=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let B=Z._TmpMats[0];R&&L?(B.p(this.getAbsoluteMatrix()),B.multiplyToRef(L,B)):B=this.getAbsoluteMatrix(),q.x=B.m[12],q.y=B.m[13],q.z=B.m[14]}}getAbsolutePosition(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=B.m.Zero();return this.getPositionToRef(1,R,q),q}getAbsolutePositionToRef(R,q){this.getPositionToRef(1,R,q)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Lj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Lj);const R=this._skeleton.getPoseMatrix();R&&this._absoluteMatrix.multiplyToRef(R,this._absoluteMatrix)}const R=this.children,q=R.length;for(let L=0;L<q;L++)R[L].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Le(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=B.m.Zero();return this.getDirectionToRef(R,q,L),L}getDirectionToRef(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,N=null;q&&(N=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=Z._TmpMats[0];h.p(this.getAbsoluteMatrix()),q&&N&&h.multiplyToRef(N,h),B.m.TransformNormalToRef(R,h,L),L.normalize()}getRotation(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=B.m.Zero();return this.getRotationToRef(R,q,L),L}getRotationToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;const B=Z._TmpQuat;this.getRotationQuaternionToRef(R,q,B),B.toEulerAnglesToRef(L)}getRotationQuaternion(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=B.d.Identity();return this.getRotationQuaternionToRef(R,q,L),L}getRotationQuaternionToRef(){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),q.p(this._localRotation);else{const L=Z._TmpMats[0],B=this.getAbsoluteMatrix();R?B.multiplyToRef(R.getWorldMatrix(),L):L.p(B),L.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyAtIndex(1,this._scalingDeterminant),L.multiplyAtIndex(2,this._scalingDeterminant),L.decompose(void 0,q,void 0)}}getRotationMatrix(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0;const L=B.c.Identity();return this.getRotationMatrixToRef(R,q,L),L}getRotationMatrixToRef(){let R=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(q);else{const L=Z._TmpMats[0],B=this.getAbsoluteMatrix();R?B.multiplyToRef(R.getWorldMatrix(),L):L.p(B),L.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyAtIndex(1,this._scalingDeterminant),L.multiplyAtIndex(2,this._scalingDeterminant),L.getRotationMatrixToRef(q)}}getAbsolutePositionFromLocal(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=B.m.Zero();return this.getAbsolutePositionFromLocalToRef(R,q,L),L}getAbsolutePositionFromLocalToRef(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,N=null;q&&(N=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=Z._TmpMats[0];h.p(this.getAbsoluteMatrix()),q&&N&&h.multiplyToRef(N,h),B.m.TransformCoordinatesToRef(R,h,L)}getLocalPositionFromAbsolute(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=B.m.Zero();return this.getLocalPositionFromAbsoluteToRef(R,q,L),L}getLocalPositionFromAbsoluteToRef(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,N=null;q&&(N=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=Z._TmpMats[0];h.p(this.getAbsoluteMatrix()),q&&N&&h.multiplyToRef(N,h),h.invert(),B.m.TransformCoordinatesToRef(R,h,L)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}Z._TmpVecs=(0,N.e)(2,B.m.Zero),Z._TmpQuat=B.d.Identity(),Z._TmpMats=(0,N.e)(5,B.c.Identity)},11136:(R,q,L)=>{"use strict";L.d(q,{d:()=>h,e:()=>Z});var B=L(11144),N=L(10767);class h{get u(){return this._isDisposed}constructor(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0,F=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,R&&R.va?this._engine=R.va().getEngine():this._engine=R,this._updatable=L,this._instanced=Z,this._divisor=Y||1,this._label=F,q instanceof B.c?(this._data=null,this._buffer=q):(this._data=q,this._buffer=null),this.byteStride=z?N:N*Float32Array.BYTES_PER_ELEMENT,h||this.create()}createVertexBuffer(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6?arguments[6]:void 0;const Y=h?q:q*Float32Array.BYTES_PER_ELEMENT,F=B?h?B:B*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Z(this._engine,this,R,this._updatable,!0,F,void 0===N?this._instanced:N,Y,L,void 0,void 0,!0,this._divisor||z)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!R&&this._buffer||(R=R||this._data,R&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,R),this._data=R):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(R,this._label),this._data=R):this._buffer=this._engine.createVertexBuffer(R,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.nb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.nb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.nb,void 0,this._label));N.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(R){this.create(R)}updateDirectly(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,R,B?q:q*Float32Array.BYTES_PER_ELEMENT,L?L*this.byteStride:void 0),this._data=0===q&&void 0===L?R:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class Z{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(R){const q=0!=R;this._instanceDivisor=R,q!==this._instanced&&(this._instanced=q,this._computeHashCode())}get _maxVerticesCount(){const R=this.getData();return R?Array.isArray(R)?R.length/(this.byteStride/4)-this.byteOffset/4:(R.byteLength-this.byteOffset)/this.byteStride:0}constructor(R,q,L,B,N,z,Y,F,C,e){let y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],U=arguments.length>11&&void 0!==arguments[11]&&arguments[11],n=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,r=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let p=!1;if(this.hd=R,"object"===typeof B&&null!==B?(p=B.updatable??!1,N=B.postponeInternalCreation,z=B.stride,Y=B.instanced,F=B.offset,C=B.size,e=B.type,y=B.normalized??!1,U=B.useBytes??!1,n=B.divisor??1,r=B.takeBufferOwnership??!1,this._label=B.label):p=!!B,q instanceof h?(this._buffer=q,this._ownsBuffer=r):(this._buffer=new h(R,q,p,z,N,Y,U,n,this._label),this._ownsBuffer=!0),this.uniqueId=Z._Counter++,this._kind=L,void 0===e){const R=this.getData();this.type=R?Z.GetDataType(R):Z.FLOAT}else this.type=e;const c=Z.GetTypeByteLength(this.type);U?(this._size=C||(z?z/c:Z.DeduceStride(L)),this.byteStride=z||this._buffer.byteStride||this._size*c,this.byteOffset=F||0):(this._size=C||z||Z.DeduceStride(L),this.byteStride=z?z*c:this._buffer.byteStride||this._size*c,this.byteOffset=(F||0)*c),this.normalized=y,this._instanced=void 0!==Y&&Y,this._instanceDivisor=Y?n:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var R;null===(R=this._buffer)||void 0===R||R._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(R,q){const L=this.getData();return L?Z.GetFloatData(L,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,R,q):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Z.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/Z.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*Z.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(R){this._buffer.create(R),this._alignBuffer()}update(R){this._buffer.update(R),this._alignBuffer()}updateDirectly(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(R,q,void 0,L),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(R,q){Z.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,R,this.normalized,q)}_alignBuffer(){}static DeduceStride(R){switch(R){case Z.UVKind:case Z.UV2Kind:case Z.UV3Kind:case Z.UV4Kind:case Z.UV5Kind:case Z.UV6Kind:return 2;case Z.NormalKind:case Z.PositionKind:return 3;case Z.ColorKind:case Z.ColorInstanceKind:case Z.MatricesIndicesKind:case Z.MatricesIndicesExtraKind:case Z.MatricesWeightsKind:case Z.MatricesWeightsExtraKind:case Z.TangentKind:return 4;default:throw new Error("Invalid kind '"+R+"'")}}static GetDataType(R){return R instanceof Int8Array?Z.BYTE:R instanceof Uint8Array?Z.UNSIGNED_BYTE:R instanceof Int16Array?Z.SHORT:R instanceof Uint16Array?Z.UNSIGNED_SHORT:R instanceof Int32Array?Z.INT:R instanceof Uint32Array?Z.UNSIGNED_INT:Z.FLOAT}static GetTypeByteLength(R){switch(R){case Z.BYTE:case Z.UNSIGNED_BYTE:return 1;case Z.SHORT:case Z.UNSIGNED_SHORT:return 2;case Z.INT:case Z.UNSIGNED_INT:case Z.FLOAT:return 4;default:throw new Error(`Invalid type '${R}'`)}}static ForEach(R,q,L,B,N,h,z,Y){if(R instanceof Array){let N=q/4;const Z=L/4;for(let q=0;q<h;q+=B){for(let L=0;L<B;L++)Y(R[N+L],q+L);N+=Z}}else{const F=R instanceof ArrayBuffer?new DataView(R):new DataView(R.buffer,R.byteOffset,R.byteLength),C=Z.GetTypeByteLength(N);for(let R=0;R<h;R+=B){let h=q;for(let q=0;q<B;q++){Y(Z._GetFloatValue(F,N,h,z),R+q),h+=C}q+=L}}}static _GetFloatValue(R,q,L,B){switch(q){case Z.BYTE:{let q=R.getInt8(L);return B&&(q=Math.max(q/127,-1)),q}case Z.UNSIGNED_BYTE:{let q=R.getUint8(L);return B&&(q/=255),q}case Z.SHORT:{let q=R.getInt16(L,!0);return B&&(q=Math.max(q/32767,-1)),q}case Z.UNSIGNED_SHORT:{let q=R.getUint16(L,!0);return B&&(q/=65535),q}case Z.INT:return R.getInt32(L,!0);case Z.UNSIGNED_INT:return R.getUint32(L,!0);case Z.FLOAT:return R.getFloat32(L,!0);default:throw new Error(`Invalid component type ${q}`)}}static GetFloatData(R,q,L,B,h,z,Y,F){const C=q*Z.GetTypeByteLength(L),e=Y*q;if(L!==Z.FLOAT||h!==C){const N=new Float32Array(e);return Z.ForEach(R,B,h,q,L,e,z,((R,q)=>N[q]=R)),N}if(!(R instanceof Array||R instanceof Float32Array)||0!==B||R.length!==e){if(R instanceof Array){const q=B/4;return R.slice(q,q+e)}if(R instanceof ArrayBuffer)return new Float32Array(R,B,e);{const q=R.byteOffset+B;if(0!==(3&q)&&(N.d.Warn("Float array must be aligned to 4-bytes border"),F=!0),F){const L=new Uint8Array(e*Float32Array.BYTES_PER_ELEMENT),B=new Uint8Array(R.buffer,q,L.length);return L.set(B),new Float32Array(L.buffer)}return new Float32Array(R.buffer,q,e)}}return F?R.slice():R}}Z._Counter=0,Z.BYTE=5120,Z.UNSIGNED_BYTE=5121,Z.SHORT=5122,Z.UNSIGNED_SHORT=5123,Z.INT=5124,Z.UNSIGNED_INT=5125,Z.FLOAT=5126,Z.PositionKind="position",Z.NormalKind="normal",Z.TangentKind="tangent",Z.UVKind="uv",Z.UV2Kind="uv2",Z.UV3Kind="uv3",Z.UV4Kind="uv4",Z.UV5Kind="uv5",Z.UV6Kind="uv6",Z.ColorKind="color",Z.ColorInstanceKind="instanceColor",Z.MatricesIndicesKind="matricesIndices",Z.MatricesWeightsKind="matricesWeights",Z.MatricesIndicesExtraKind="matricesIndicesExtra",Z.MatricesWeightsExtraKind="matricesWeightsExtra"},11144:(R,q,L)=>{"use strict";L.d(q,{c:()=>B});class B{get underlyingResource(){return null}constructor(){this.references=0,this.nb=0,this.is32Bits=!1,this.uniqueId=B._Counter++}}B._Counter=0},12435:(R,q,L)=>{"use strict";L.d(q,{e:()=>W});var B=L(11053),N=L(11058),h=L(10760),Z=L(11081),z=L(11345),Y=L(11329),F=L(11168),C=L(10778),e=L(11088);class y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(R){this._idleRotationSpeed=R}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(R){this._idleRotationWaitTime=R}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(R){this._idleRotationSpinupTime=R}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(R){this._attachedCamera=R;const q=this._attachedCamera.va();this._onPrePointerObservableObserver=q.onPrePointerObservable.add((R=>{R.type!==F.e.POINTERDOWN?R.type===F.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const R=C.c.Now;let q=0;null!=this._lastFrameTime&&(q=R-this._lastFrameTime),this._lastFrameTime=R,this._applyUserInteraction();const L=R-this._lastInteractionTime-this._idleRotationWaitTime,B=Math.max(Math.min(L/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*B,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(q/1e3))}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.va();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(R){this._lastInteractionTime=R??C.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<e.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let R=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(R=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?R:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=C.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}L(11579);class U{constructor(){this._easingMode=U.EASINGMODE_EASEIN}setEasingMode(R){const q=Math.min(Math.max(R,0),2);this._easingMode=q}getEasingMode(){return this._easingMode}easeInCore(R){throw new Error("You must implement this method")}ease(R){switch(this._easingMode){case U.EASINGMODE_EASEIN:return this.easeInCore(R);case U.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-R)}return R>=.5?.5*(1-this.easeInCore(2*(1-R)))+.5:.5*this.easeInCore(2*R)}}U.EASINGMODE_EASEIN=0,U.EASINGMODE_EASEOUT=1,U.EASINGMODE_EASEINOUT=2;var n=L(12047);class r{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(R){if(this._autoTransitionRange===R)return;this._autoTransitionRange=R;const q=this._attachedCamera;q&&(R?this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((R=>{if(R&&(R.Jj(!0),R.getBoundingInfo)){const q=R.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*q,this.upperRadiusTransitionRange=.05*q}})):this._onMeshTargetChangedObserver&&q.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(R){this._attachedCamera=R,this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(R){return!!this._attachedCamera&&(this._attachedCamera.radius===R&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(R){if(!this._attachedCamera)return;this._radiusBounceTransition||(r.EasingFunction.setEasingMode(r.EasingMode),this._radiusBounceTransition=n.b.CreateAnimation("radius",n.b.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const q=n.b.TransitionTo("radius",this._attachedCamera.radius+R,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));q&&this._animatables.push(q)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}r.EasingFunction=new class extends U{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=R}easeInCore(R){const q=Math.max(0,this.amplitude);return Math.pow(R,3)-R*q*Math.sin(3.141592653589793*R)}}(.3),r.EasingMode=U.EASINGMODE_EASEOUT;class p{constructor(){this.onTargetFramingAnimationEndObservable=new h.b,this._mode=p.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(R){this._mode=R}get mode(){return this._mode}set radiusScale(R){this._radiusScale=R}get radiusScale(){return this._radiusScale}set positionScale(R){this._positionScale=R}get positionScale(){return this._positionScale}set defaultElevation(R){this._defaultElevation=R}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(R){this._elevationReturnTime=R}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(R){this._elevationReturnWaitTime=R}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(R){this._framingTime=R}get framingTime(){return this._framingTime}init(){}attach(R){this._attachedCamera=R;const q=this._attachedCamera.va();p.EasingFunction.setEasingMode(p.EasingMode),this._onPrePointerObservableObserver=q.onPrePointerObservable.add((R=>{R.type!==F.e.POINTERDOWN?R.type===F.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=R.onMeshTargetChangedObservable.add((R=>{R&&R.getBoundingInfo&&this.zoomOnMesh(R,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.va();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.Jj(!0);const B=R.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(B.minimumWorld,B.maximumWorld,q,L)}zoomOnMeshHierarchy(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.Jj(!0);const B=R.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(B.min,B.max,q,L)}zoomOnMeshesHierarchy(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new Z.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new Z.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let h=0;h<R.length;h++){const q=R[h].getHierarchyBoundingVectors(!0);Z.m.CheckExtends(q.min,B,N),Z.m.CheckExtends(q.max,B,N)}this.zoomOnBoundingInfo(B,N,q,L)}zoomOnBoundingInfo(R,q){let L,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const h=R.y,z=h+(q.y-h)*this._positionScale,Y=q.Bc(R).scale(.5);if(B)L=new Z.m(0,z,0);else{const q=R.add(Y);L=new Z.m(q.x,z,q.z)}this._vectorTransition||(this._vectorTransition=n.b.CreateAnimation("target",n.b.ANIMATIONTYPE_VECTOR3,60,p.EasingFunction)),this._betaIsAnimating=!0;let F=n.b.TransitionTo("target",L,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);F&&this._animatables.push(F);let C=0;if(this._mode===p.FitFrustumSidesMode){const L=this._calculateLowerRadiusFromModelBoundingSphere(R,q);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=Y.length()+this._attachedCamera.Ri),C=L}else this._mode===p.IgnoreBoundsSizeMode&&(C=this._calculateLowerRadiusFromModelBoundingSphere(R,q),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ri));if(this.autoCorrectCameraLimitsAndSensibility){const L=q.Bc(R).length();this._attachedCamera.panningSensibility=5e3/L,this._attachedCamera.wheelPrecision=100/C}return this._radiusTransition||(this._radiusTransition=n.b.CreateAnimation("radius",n.b.ANIMATIONTYPE_FLOAT,60,p.EasingFunction)),F=n.b.TransitionTo("radius",C,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),N&&N(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),F&&this._animatables.push(F),!0}_calculateLowerRadiusFromModelBoundingSphere(R,q){const L=this._attachedCamera;if(!L)return 0;let B=L._calculateLowerRadiusFromModelBoundingSphere(R,q,this._radiusScale);return L.lowerRadiusLimit&&this._mode===p.IgnoreBoundsSizeMode&&(B=B<L.lowerRadiusLimit?L.lowerRadiusLimit:B),L.upperRadiusLimit&&(B=B>L.upperRadiusLimit?L.upperRadiusLimit:B),B}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const R=C.c.Now-this._lastInteractionTime,q=.5*Math.PI-this._defaultElevation,L=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>L&&R>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=n.b.CreateAnimation("beta",n.b.ANIMATIONTYPE_FLOAT,60,p.EasingFunction));const R=n.b.TransitionTo("beta",q,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));R&&this._animatables.push(R)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=C.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}p.EasingFunction=new class extends U{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=R}easeInCore(R){return this.exponent<=0?R:(Math.exp(this.exponent*R)-1)/(Math.exp(this.exponent)-1)}},p.EasingMode=U.EASINGMODE_EASEINOUT,p.IgnoreBoundsSizeMode=0,p.FitFrustumSidesMode=1;var c=L(11337),d=L(12027),f=L(12031),v=L(10757);class T{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(R){R=v.f.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),L=q.getInputElement();let B=0,N=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=h=>{var Z,z;const Y=h.event,C="touch"===Y.pointerType;if(h.type!==F.e.POINTERMOVE&&-1===this.buttons.indexOf(Y.button))return;const e=Y.target;if(this._altKey=Y.altKey,this._ctrlKey=Y.ctrlKey,this._metaKey=Y.metaKey,this._shiftKey=Y.shiftKey,this._buttonsPressed=Y.buttons,q.isPointerLock){const R=Y.movementX,q=Y.movementY;this.onTouch(null,R,q),this._pointA=null,this._pointB=null}else{if(h.type!==F.e.POINTERDOWN&&h.type!==F.e.POINTERDOUBLETAP&&C&&(null===(Z=this._pointA)||void 0===Z?void 0:Z.pointerId)!==Y.pointerId&&(null===(z=this._pointB)||void 0===z?void 0:z.pointerId)!==Y.pointerId)return;if(h.type!==F.e.POINTERDOWN||-1!==this._currentActiveButton&&!C)if(h.type===F.e.POINTERDOUBLETAP)this.onDoubleTap(Y.pointerType);else if(h.type!==F.e.POINTERUP||this._currentActiveButton!==Y.button&&!C){if(h.type===F.e.POINTERMOVE)if(R||Y.preventDefault(),this._pointA&&null===this._pointB){const R=Y.clientX-this._pointA.x,q=Y.clientY-this._pointA.y;this._pointA.x=Y.clientX,this._pointA.y=Y.clientY,this.onTouch(this._pointA,R,q)}else if(this._pointA&&this._pointB){const R=this._pointA.pointerId===Y.pointerId?this._pointA:this._pointB;R.x=Y.clientX,R.y=Y.clientY;const q=this._pointA.x-this._pointB.x,L=this._pointA.y-this._pointB.y,Z=q*q+L*L,z={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:Y.pointerId,type:h.type};this.onMultiTouch(this._pointA,this._pointB,B,Z,N,z),N=z,B=Z}}else{try{null===e||void 0===e||e.releasePointerCapture(Y.pointerId)}catch(y){}C||(this._pointB=null),q._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==Y.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==Y.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==B||N)&&(this.onMultiTouch(this._pointA,this._pointB,B,0,N,null),B=0,N=null),this._currentActiveButton=-1,this.onButtonUp(Y),R||Y.preventDefault()}else{try{null===e||void 0===e||e.setPointerCapture(Y.pointerId)}catch(y){}if(null===this._pointA)this._pointA={x:Y.clientX,y:Y.clientY,pointerId:Y.pointerId,type:Y.pointerType};else{if(null!==this._pointB)return;this._pointB={x:Y.clientX,y:Y.clientY,pointerId:Y.pointerId,type:Y.pointerType}}-1!==this._currentActiveButton||C||(this._currentActiveButton=Y.button),this.onButtonDown(Y),R||(Y.preventDefault(),L&&L.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.e.POINTERDOWN|F.e.POINTERUP|F.e.POINTERMOVE|F.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,B=0,N=null,this.onLostFocus()},this._contextMenuBind=R=>this.onContextMenu(R),L&&L.addEventListener("contextmenu",this._contextMenuBind,!1);const h=this.camera.va().getEngine().getHostWindow();h&&v.f.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}Ni(){if(this._onLostFocus){const R=this.camera.va().getEngine().getHostWindow();R&&v.f.UnregisterTopRootEvents(R,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const R=this.camera.va().getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(R){}onTouch(R,q,L){}onMultiTouch(R,q,L,B,N,h){}onContextMenu(R){R.preventDefault()}onButtonDown(R){}onButtonUp(R){}onLostFocus(){}}(0,B.d)([(0,N.K)()],T.prototype,"buttons",void 0);class t extends T{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(R,q){if(0!==this.panningSensibility&&R&&q){const L=q.x-R.x,B=q.y-R.y;this.camera.inertialPanningX+=-L/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility}}_computePinchZoom(R,q){const L=this.camera.radius||t.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=L*Math.sqrt(R)/Math.sqrt(q):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(q-R)*L*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(q-R)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(R,q,L){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-q/this.panningSensibility,this.camera.inertialPanningY+=L/this.panningSensibility):(this.camera.inertialAlphaOffset-=q/this.angularSensibilityX,this.camera.inertialBetaOffset-=L/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(R,q,L,B,N,h){0===L&&null===N||0===B&&null===h||(this.multiTouchPanAndZoom?(this._computePinchZoom(L,B),this._computeMultiTouchPanning(N,h)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(B)-Math.sqrt(L))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(L,B),this._isPinching=!0):this._computeMultiTouchPanning(N,h)):this.multiTouchPanning?this._computeMultiTouchPanning(N,h):this.pinchZoom&&this._computePinchZoom(L,B))}onButtonDown(R){this._isPanClick=R.button===this.camera._panningMouseButton}onButtonUp(R){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}t.MinimumRadiusForPinch=.001,(0,B.d)([(0,N.K)()],t.prototype,"buttons",void 0),(0,B.d)([(0,N.K)()],t.prototype,"angularSensibilityX",void 0),(0,B.d)([(0,N.K)()],t.prototype,"angularSensibilityY",void 0),(0,B.d)([(0,N.K)()],t.prototype,"pinchPrecision",void 0),(0,B.d)([(0,N.K)()],t.prototype,"pinchDeltaPercentage",void 0),(0,B.d)([(0,N.K)()],t.prototype,"useNaturalPinchZoom",void 0),(0,B.d)([(0,N.K)()],t.prototype,"pinchZoom",void 0),(0,B.d)([(0,N.K)()],t.prototype,"panningSensibility",void 0),(0,B.d)([(0,N.K)()],t.prototype,"multiTouchPanning",void 0),(0,B.d)([(0,N.K)()],t.prototype,"multiTouchPanAndZoom",void 0),f.e.ArcRotateCameraPointersInput=t;var D=L(11176);class S{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(R){R=v.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const L=q.event;if(!L.metaKey)if(q.type===D.b.KEYDOWN){if(this._ctrlPressed=L.ctrlKey,this._altPressed=L.altKey,-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysReset.indexOf(L.keyCode)){-1===this._keys.indexOf(L.keyCode)&&this._keys.push(L.keyCode),L.preventDefault&&(R||L.preventDefault())}}else if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysReset.indexOf(L.keyCode)){const q=this._keys.indexOf(L.keyCode);q>=0&&this._keys.splice(q,1),L.preventDefault&&(R||L.preventDefault())}})))}Ni(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let q=0;q<this._keys.length;q++){const L=this._keys[q];-1!==this.keysLeft.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX-=1/this.panningSensibility:R.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset+=1/this.zoomingSensibility:R.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX+=1/this.panningSensibility:R.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset-=1/this.zoomingSensibility:R.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(L)&&R.useInputToRestoreState&&R.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,B.d)([(0,N.K)()],S.prototype,"keysUp",void 0),(0,B.d)([(0,N.K)()],S.prototype,"keysDown",void 0),(0,B.d)([(0,N.K)()],S.prototype,"keysLeft",void 0),(0,B.d)([(0,N.K)()],S.prototype,"keysRight",void 0),(0,B.d)([(0,N.K)()],S.prototype,"keysReset",void 0),(0,B.d)([(0,N.K)()],S.prototype,"panningSensibility",void 0),(0,B.d)([(0,N.K)()],S.prototype,"zoomingSensibility",void 0),(0,B.d)([(0,N.K)()],S.prototype,"useAltToZoom",void 0),(0,B.d)([(0,N.K)()],S.prototype,"angularSpeed",void 0),f.e.ArcRotateCameraKeyboardMoveInput=S;var I=L(11198),K=L(11182),m=L(11099);class o{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Z.m(0,0,0),this._globalOffset=new Z.m(0,0,0),this._inertialPanning=Z.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(R,q){let L=0;const B=.01*R*this.wheelDeltaPercentage*q;return L=R>0?B/(1+this.wheelDeltaPercentage):B*(1+this.wheelDeltaPercentage),L}attachControl(R){R=v.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==F.e.POINTERWHEEL)return;const L=q.event;let B=0;const N=L.deltaMode===K.e.DOM_DELTA_LINE?40:1,h=-L.deltaY*N;if(this.customComputeDeltaFromMouseWheel)B=this.customComputeDeltaFromMouseWheel(h,this,L);else if(this.wheelDeltaPercentage){if(B=this._computeDeltaFromMouseWheelLegacyEvent(h,this.camera.radius),B>0){let R=this.camera.radius,q=this.camera.inertialRadiusOffset+B;for(let L=0;L<20&&Math.abs(q)>.001;L++)R-=q,q*=this.camera.inertia;R=(0,m.b)(R,0,Number.MAX_VALUE),B=this._computeDeltaFromMouseWheelLegacyEvent(h,R)}}else B=h/(40*this.wheelPrecision);B&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(B)):this.camera.inertialRadiusOffset+=B),L.preventDefault&&(R||L.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,F.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Rd(0)}Ni(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const R=this.camera;0+R.inertialAlphaOffset+R.inertialBetaOffset+R.inertialRadiusOffset&&(this._updateHitPlane(),R.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(R.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const R=this.camera,q=R.target.Bc(R.position);this._hitPlane=I.e.FromPositionAndNormal(R.target,q)}_getPosition(){const R=this.camera,q=R.va(),L=q.createPickingRay(q.pointerX,q.pointerY,Z.c.Identity(),R,!1);0===R.targetScreenOffset.x&&0===R.targetScreenOffset.y||(this._viewOffset.set(R.targetScreenOffset.x,R.targetScreenOffset.y,0),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),this._globalOffset=Z.m.TransformNormal(this._viewOffset,R._cameraTransformMatrix),L.origin.addInPlace(this._globalOffset));let B=0;return this._hitPlane&&(B=L.intersectsPlane(this._hitPlane)??0),L.origin.addInPlace(L.direction.scaleInPlace(B))}_zoomToMouse(R){const q=this.camera,L=1-q.inertia;if(q.lowerRadiusLimit){const B=q.lowerRadiusLimit??0;q.radius-(q.inertialRadiusOffset+R)/L<B&&(R=(q.radius-B)*L-q.inertialRadiusOffset)}if(q.upperRadiusLimit){const B=q.upperRadiusLimit??0;q.radius-(q.inertialRadiusOffset+R)/L>B&&(R=(q.radius-B)*L-q.inertialRadiusOffset)}const B=R/L/q.radius,N=this._getPosition(),h=Z.h.o[6];N.subtractToRef(q.target,h),h.scaleInPlace(B),h.scaleInPlace(L),this._inertialPanning.addInPlace(h),q.inertialRadiusOffset+=R}_zeroIfClose(R){Math.abs(R.x)<e.e&&(R.x=0),Math.abs(R.y)<e.e&&(R.y=0),Math.abs(R.z)<e.e&&(R.z=0)}}(0,B.d)([(0,N.K)()],o.prototype,"wheelPrecision",void 0),(0,B.d)([(0,N.K)()],o.prototype,"zoomToMouseLocation",void 0),(0,B.d)([(0,N.K)()],o.prototype,"wheelDeltaPercentage",void 0),f.e.ArcRotateCameraMouseWheelInput=o;class l extends f.g{constructor(R){super(R)}addMouseWheel(){return this.add(new o),this}addPointers(){return this.add(new t),this}addKeyboard(){return this.add(new S),this}}var G=L(10889);z.d.AddNodeConstructor("ArcRotateCamera",((R,q)=>()=>new W(R,0,0,1,Z.m.Zero(),q)));class W extends d.b{get target(){return this._target}set target(R){this.setTarget(R)}get targetHost(){return this._targetHost}set targetHost(R){R&&this.setTarget(R)}getTarget(){return this.target}get position(){return this._position}set position(R){this.setPosition(R)}set upVector(R){this._upToYMatrix||(this._yToUpMatrix=new Z.c,this._upToYMatrix=new Z.c,this._upVector=Z.m.Zero()),R.normalize(),this._upVector.p(R),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Z.c.RotationAlignToRef(Z.m.UpReadOnly,this._upVector,this._yToUpMatrix),Z.c.RotationAlignToRef(this._upVector,Z.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityX:0}set angularSensibilityX(R){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityX=R)}get angularSensibilityY(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityY:0}set angularSensibilityY(R){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityY=R)}get pinchPrecision(){const R=this.inputs.attached.pointers;return R?R.pinchPrecision:0}set pinchPrecision(R){const q=this.inputs.attached.pointers;q&&(q.pinchPrecision=R)}get pinchDeltaPercentage(){const R=this.inputs.attached.pointers;return R?R.pinchDeltaPercentage:0}set pinchDeltaPercentage(R){const q=this.inputs.attached.pointers;q&&(q.pinchDeltaPercentage=R)}get useNaturalPinchZoom(){const R=this.inputs.attached.pointers;return!!R&&R.useNaturalPinchZoom}set useNaturalPinchZoom(R){const q=this.inputs.attached.pointers;q&&(q.useNaturalPinchZoom=R)}get panningSensibility(){const R=this.inputs.attached.pointers;return R?R.panningSensibility:0}set panningSensibility(R){const q=this.inputs.attached.pointers;q&&(q.panningSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const q=this.inputs.attached.keyboard;q&&(q.keysUp=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const q=this.inputs.attached.keyboard;q&&(q.keysDown=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const q=this.inputs.attached.keyboard;q&&(q.keysRight=R)}get wheelPrecision(){const R=this.inputs.attached.mousewheel;return R?R.wheelPrecision:0}set wheelPrecision(R){const q=this.inputs.attached.mousewheel;q&&(q.wheelPrecision=R)}get zoomToMouseLocation(){const R=this.inputs.attached.mousewheel;return!!R&&R.zoomToMouseLocation}set zoomToMouseLocation(R){const q=this.inputs.attached.mousewheel;q&&(q.zoomToMouseLocation=R)}get wheelDeltaPercentage(){const R=this.inputs.attached.mousewheel;return R?R.wheelDeltaPercentage:0}set wheelDeltaPercentage(R){const q=this.inputs.attached.mousewheel;q&&(q.wheelDeltaPercentage=R)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(R){R!==this.useBouncingBehavior&&(R?(this._bouncingBehavior=new r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(R){R!==this.useFramingBehavior&&(R?(this._framingBehavior=new p,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(R){R!==this.useAutoRotationBehavior&&(R?(this._autoRotationBehavior=new y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(R,q,L,B,N,z){var Y;let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(R,Z.m.Zero(),z,F),Y=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Z.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Z.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new Z.c,this.panningAxis=new Z.m(1,1,0),this._transformedDirection=new Z.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new h.b,this.checkCollisions=!1,this.collisionRadius=new Z.m(.5,.5,.5),this._previousPosition=Z.m.Zero(),this._collisionVelocity=Z.m.Zero(),this._newPosition=Z.m.Zero(),this._computationVector=Z.m.Zero(),this._onCollisionPositionChange=function(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L?(Y.setPosition(q),Y.Dk&&Y.Dk(L)):Y._previousPosition.p(Y._position);const B=Math.cos(Y.alpha),N=Math.sin(Y.alpha),h=Math.cos(Y.beta);let Z=Math.sin(Y.beta);0===Z&&(Z=1e-4);const z=Y._getTargetPosition();Y._computationVector.Td(Y.radius*B*Z,Y.radius*h,Y.radius*N*Z),z.addToRef(Y._computationVector,Y._newPosition),Y._position.p(Y._newPosition);let F=Y.upVector;Y.allowUpsideDown&&Y.beta<0&&(F=F.clone(),F=F.negate()),Y._computeViewMatrix(Y._position,z,F),Y._viewMatrix.addAtIndex(12,Y.targetScreenOffset.x),Y._viewMatrix.addAtIndex(13,Y.targetScreenOffset.y),Y._collisionTriggered=!1},this._target=Z.m.Zero(),N&&this.setTarget(N),this.alpha=q,this.beta=L,this.radius=B,this.getViewMatrix(),this.inputs=new l(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Z.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Z.i.Zero()}_updateCache(R){R||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const R=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?R.addToRef(this._targetBoundingCenter,this._target):this._target.p(R)}const R=this._getLockedTargetPosition();return R||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>e.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const N=arguments;q=v.f.BackCompatCameraNoPreventDefault(N),this._useCtrlForPanning=L,this._panningMouseButton=B,"boolean"===typeof N[0]&&(N.length>1&&(this._useCtrlForPanning=N[1]),N.length>2&&(this._panningMouseButton=N[2])),this.inputs.attachElement(q),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ni(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const R=this._scene.getEngine().getDeltaTime()/1e3,q=1-Math.pow(2,-R/this.restoreStateInterpolationFactor);this.setTarget(Z.m.Lerp(this.getTarget(),this._storedTarget,q)),Z.d.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,Z.h.Quaternion[0]),Z.d.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Z.h.Quaternion[1]),Z.d.SlerpToRef(Z.h.Quaternion[1],Z.h.Quaternion[0],q,Z.h.Quaternion[2]),Z.h.Quaternion[2].normalize(),Z.h.Quaternion[2].toAlphaBetaGammaToRef(Z.h.o[0]),this.alpha=Z.h.o[0].x,this.beta=Z.h.o[0].y,this.radius+=(this._storedRadius-this.radius)*q,Z.i.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,q,this.targetScreenOffset),(Z.m.DistanceSquared(this.getTarget(),this._storedTarget)<e.e&&Z.h.Quaternion[2].equalsWithEpsilon(Z.h.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<e.e&&Z.i.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<e.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const R=this.invertRotation?-1:1,q=this._calculateHandednessMultiplier();let L=this.inertialAlphaOffset*q;this.beta<0&&(L*=-1),this.alpha+=L*R,this.beta+=this.inertialBetaOffset*R,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const R=new Z.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),R.multiplyInPlace(this.panningAxis),Z.m.TransformNormalToRef(R,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const R=this.upVector,q=Z.m.CrossToRef(this._transformedDirection,R,this._transformedDirection);Z.m.CrossToRef(R,q,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Z.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const R=Z.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.transposeToRef(R),Z.m.TransformCoordinatesToRef(this._transformedDirection,R,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Z.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const R=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const q=Math.round((R-this.alpha)/(2*Math.PI));this.alpha+=2*q*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(R){this._position.equals(R)||(this._position.p(R),this.rebuildAnglesAndRadius())}setTarget(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(B=this.overrideCloneAlphaBetaRadius??B,R.Jj)q&&R.getBoundingInfo?this._targetBoundingCenter=R.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,R.Jj(),this._targetHost=R,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const q=R,B=this._getTargetPosition();if(B&&!L&&B.equals(q))return;this._targetHost=null,this._target=q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}B||this.rebuildAnglesAndRadius()}_getViewMatrix(){const R=Math.cos(this.alpha),q=Math.sin(this.alpha),L=Math.cos(this.beta);let B=Math.sin(this.beta);0===B&&(B=1e-4),0===this.radius&&(this.radius=1e-4);const N=this._getTargetPosition();if(this._computationVector.Td(this.radius*R*B,this.radius*L,this.radius*q*B),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Z.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),N.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const R=this.va().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,R.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let R=this.upVector;this.allowUpsideDown&&B<0&&(R=R.negate()),this._computeViewMatrix(this._position,N,R),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=N,this._viewMatrix}zoomOn(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R=R||this.va().meshes;const L=Y.d.MinMax(R);let B=this._calculateLowerRadiusFromModelBoundingSphere(L.min,L.max);B=Math.max(Math.min(B,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=B*this.zoomOnFactor,this.focusOn({min:L.min,max:L.max,distance:B},q)}focusOn(R){let q,L,B=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===R.min){const B=R||this.va().meshes;q=Y.d.MinMax(B),L=Z.m.Distance(q.min,q.max)}else{q=R,L=R.distance}this._target=Y.d.Center(q),B||(this.maxZ=2*L)}createRigCamera(R,q){let L=0;switch(this.cameraRigMode){case c.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.d.RIG_MODE_VR:L=this._cameraRigParams.stereoHalfAngle*(0===q?1:-1);break;case c.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:L=this._cameraRigParams.stereoHalfAngle*(0===q?-1:1)}const B=new W(R,this.alpha+L,this.beta,this.radius,this._target,this.va());return B._cameraRigParams={},B.isRigCamera=!0,B.rigParent=this,B.upVector=this.upVector,B.mode=this.mode,B.orthoLeft=this.orthoLeft,B.orthoRight=this.orthoRight,B.orthoBottom=this.orthoBottom,B.orthoTop=this.orthoTop,B}_updateRigCameras(){const R=this._rigCameras[0],q=this._rigCameras[1];switch(R.beta=q.beta=this.beta,this.cameraRigMode){case c.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.d.RIG_MODE_VR:R.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case c.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:R.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const B=Z.m.Distance(R,q),N=this.va().getEngine().getAspectRatio(this),h=Math.tan(this.fov/2),z=h*N,Y=.5*B*L,F=Y*Math.sqrt(1+1/(z*z)),C=Y*Math.sqrt(1+1/(h*h));return Math.max(F,C)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,B.d)([(0,N.K)()],W.prototype,"alpha",void 0),(0,B.d)([(0,N.K)()],W.prototype,"beta",void 0),(0,B.d)([(0,N.K)()],W.prototype,"radius",void 0),(0,B.d)([(0,N.K)()],W.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,B.d)([(0,N.G)("target")],W.prototype,"_target",void 0),(0,B.d)([(0,N.x)("targetHost")],W.prototype,"_targetHost",void 0),(0,B.d)([(0,N.K)()],W.prototype,"inertialAlphaOffset",void 0),(0,B.d)([(0,N.K)()],W.prototype,"inertialBetaOffset",void 0),(0,B.d)([(0,N.K)()],W.prototype,"inertialRadiusOffset",void 0),(0,B.d)([(0,N.K)()],W.prototype,"lowerAlphaLimit",void 0),(0,B.d)([(0,N.K)()],W.prototype,"upperAlphaLimit",void 0),(0,B.d)([(0,N.K)()],W.prototype,"lowerBetaLimit",void 0),(0,B.d)([(0,N.K)()],W.prototype,"upperBetaLimit",void 0),(0,B.d)([(0,N.K)()],W.prototype,"lowerRadiusLimit",void 0),(0,B.d)([(0,N.K)()],W.prototype,"upperRadiusLimit",void 0),(0,B.d)([(0,N.K)()],W.prototype,"inertialPanningX",void 0),(0,B.d)([(0,N.K)()],W.prototype,"inertialPanningY",void 0),(0,B.d)([(0,N.K)()],W.prototype,"pinchToPanMaxDistance",void 0),(0,B.d)([(0,N.K)()],W.prototype,"panningDistanceLimit",void 0),(0,B.d)([(0,N.G)()],W.prototype,"panningOriginTarget",void 0),(0,B.d)([(0,N.K)()],W.prototype,"panningInertia",void 0),(0,B.d)([(0,N.K)()],W.prototype,"zoomToMouseLocation",null),(0,B.d)([(0,N.K)()],W.prototype,"zoomOnFactor",void 0),(0,B.d)([(0,N.E)()],W.prototype,"targetScreenOffset",void 0),(0,B.d)([(0,N.K)()],W.prototype,"allowUpsideDown",void 0),(0,B.d)([(0,N.K)()],W.prototype,"useInputToRestoreState",void 0),(0,B.d)([(0,N.K)()],W.prototype,"restoreStateInterpolationFactor",void 0),(0,G.f)("BABYLON.ArcRotateCamera",W)},11337:(R,q,L)=>{"use strict";L.d(q,{d:()=>p});var B=L(11053),N=L(11058),h=L(11065),Z=L(10757),z=L(10760),Y=L(11081),F=L(11345),C=L(10767),e=L(10889),y=L(10785),U=L(11352),n=L(11196),r=L(11117);class p extends F.d{get position(){return this._position}set position(R){this._position=R}set upVector(R){this._upVector=R}get upVector(){return this._upVector}get screenArea(){let R=0,q=0;if(this.mode===p.PERSPECTIVE_CAMERA)this.fovMode===p.FOVMODE_VERTICAL_FIXED?(q=2*this.Ri*Math.tan(this.fov/2),R=this.getEngine().getAspectRatio(this)*q):(R=2*this.Ri*Math.tan(this.fov/2),q=R/this.getEngine().getAspectRatio(this));else{const L=this.getEngine().getRenderWidth()/2,B=this.getEngine().getRenderHeight()/2;R=(this.orthoRight??L)-(this.orthoLeft??-L),q=(this.orthoTop??B)-(this.orthoBottom??-B)}return R*q}set orthoLeft(R){this._orthoLeft=R;for(const q of this._rigCameras)q.orthoLeft=R}get orthoLeft(){return this._orthoLeft}set orthoRight(R){this._orthoRight=R;for(const q of this._rigCameras)q.orthoRight=R}get orthoRight(){return this._orthoRight}set orthoBottom(R){this._orthoBottom=R;for(const q of this._rigCameras)q.orthoBottom=R}get orthoBottom(){return this._orthoBottom}set orthoTop(R){this._orthoTop=R;for(const q of this._rigCameras)q.orthoTop=R}get orthoTop(){return this._orthoTop}set mode(R){this._mode=R;for(const q of this._rigCameras)q.mode=R}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(R,q,L){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(R,L,!1),this._position=Y.m.Zero(),this._upVector=Y.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Ri=1,this.maxZ=1e4,this.inertia=.9,this._mode=p.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new U.e(0,0,1,1),this.layerMask=268435455,this.fovMode=p.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=p.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new z.b,this.onProjectionMatrixChangedObservable=new z.b,this.onAfterCheckInputsObservable=new z.b,this.onRestoreStateObservable=new z.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new Y.c,this._postProcesses=new Array,this._activeMeshes=new h.h(256),this._globalPosition=Y.m.Zero(),this._computedViewMatrix=Y.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=Y.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=Y.d.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),B&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=q,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${R}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"gh"}toString(R){let q="Name: "+this.name;if(q+=", type: "+this.getClassName(),this.animations)for(let L=0;L<this.animations.length;L++)q+=", animation[0]: "+this.animations[L].toString(R);return q}applyVerticalCorrection(){const R=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-R.x:R.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(R){return-1!==this._activeMeshes.indexOf(R)}isReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(R)for(const q of this._postProcesses)if(q&&!q.isReady())return!1;return super.isReady(R)}_initCache(){super._initCache(),this._cache.position=new Y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new Y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Ri=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(R){R||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let R=this._cache.mode===this.mode&&this._cache.Ri===this.Ri&&this._cache.maxZ===this.maxZ;if(!R)return!1;const q=this.getEngine();return this.mode===p.PERSPECTIVE_CAMERA?R=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===q.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(R=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===q.getRenderWidth()&&this._cache.renderHeight===q.getRenderHeight(),this.oblique&&(R=R&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),R}attachControl(R,q){}Ni(R){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==p.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let R=0;R<this._postProcesses.length;R++)if(null!==this._postProcesses[R])return this._postProcesses[R];return null}_cascadePostProcessesToRigCams(){const R=this._getFirstPostProcess();R&&R.markTextureDirty();for(let q=0,L=this._rigCameras.length;q<L;q++){const R=this._rigCameras[q],L=R._rigPostProcess;if(L){"pass"===L.getEffectName()&&(R.isIntermediate=0===this._postProcesses.length),R._postProcesses=this._postProcesses.slice(0).concat(L),L.markTextureDirty()}else R._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!R.isReusable()&&this._postProcesses.indexOf(R)>-1?(C.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==q||q<0?this._postProcesses.push(R):null===this._postProcesses[q]?this._postProcesses[q]=R:this._postProcesses.splice(q,0,R),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Ag(),this._postProcesses.indexOf(R))}detachPostProcess(R){const q=this._postProcesses.indexOf(R);-1!==q&&(this._postProcesses[q]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Ag(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return Y.c.Identity()}getViewMatrix(R){return!R&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(R){this._doNotComputeProjectionMatrix=!0,void 0!==R&&(this._projectionMatrix=R)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(R){if(this._doNotComputeProjectionMatrix||!R&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Ri=this.Ri,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const q=this.getEngine(),L=this.va(),B=q.useReverseDepthBuffer;if(this.mode===p.PERSPECTIVE_CAMERA){let R;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=q.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Ri<=0&&(this.Ri=.1),R=L.useRightHandedSystem?Y.c.PerspectiveFovRHToRef:Y.c.PerspectiveFovLHToRef,R(this.fov,q.getAspectRatio(this),B?this.maxZ:this.Ri,B?this.Ri:this.maxZ,this._projectionMatrix,this.fovMode===p.FOVMODE_VERTICAL_FIXED,q.isNDCHalfZRange,this.projectionPlaneTilt,B)}else{var N,h,Z;const R=q.getRenderWidth()/2,z=q.getRenderHeight()/2;L.useRightHandedSystem?this.oblique?Y.c.ObliqueOffCenterRHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-z,this.orthoTop??z,B?this.maxZ:this.Ri,B?this.Ri:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,q.isNDCHalfZRange):Y.c.OrthoOffCenterRHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-z,this.orthoTop??z,B?this.maxZ:this.Ri,B?this.Ri:this.maxZ,this._projectionMatrix,q.isNDCHalfZRange):this.oblique?Y.c.ObliqueOffCenterLHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-z,this.orthoTop??z,B?this.maxZ:this.Ri,B?this.Ri:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,q.isNDCHalfZRange):Y.c.OrthoOffCenterLHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-z,this.orthoTop??z,B?this.maxZ:this.Ri,B?this.Ri:this.maxZ,this._projectionMatrix,q.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(N=this.oblique)||void 0===N?void 0:N.angle,this._cache.obliqueLength=null===(h=this.oblique)||void 0===h?void 0:h.length,this._cache.obliqueOffset=null===(Z=this.oblique)||void 0===Z?void 0:Z.offset,this._cache.renderWidth=q.getRenderWidth(),this._cache.renderHeight=q.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(R){return(this.radius||(this.target?Y.m.Distance(this.position,this.target):this.position.length()))+R}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?n.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=n.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),q&&this.rigCameras.length>0){let q=!1;return this.rigCameras.forEach((L=>{L._updateFrustumPlanes(),q=q||R.isInFrustum(L._frustumPlanes)})),q}return R.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(R){return this._updateFrustumPlanes(),R.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,y.d)("Ray")}getForwardRayToRef(R){throw(0,y.d)("Ray")}dispose(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const R=this._rigCameras.pop();R&&R.dispose()}if(this._parentContainer){const R=this._parentContainer.cameras.indexOf(this);R>-1&&this._parentContainer.cameras.splice(R,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==p.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let R=this._postProcesses.length;for(;--R>=0;){const q=this._postProcesses[R];q&&q.dispose(this)}}let L=this.customRenderTargets.length;for(;--L>=0;)this.customRenderTargets[L].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(R,q)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(R,q){if(this.cameraRigMode!==R){for(;this._rigCameras.length>0;){const R=this._rigCameras.pop();R&&R.dispose()}if(this.cameraRigMode=R,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=q.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=Z.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==p.RIG_MODE_NONE){const R=this.createRigCamera(this.name+"_L",0);R&&(R._isLeftCamera=!0);const q=this.createRigCamera(this.name+"_R",1);q&&(q._isRightCamera=!0),R&&q&&(this._rigCameras.push(R),this._rigCameras.push(q))}this._setRigMode(q),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(R){}_getVRProjectionMatrix(){return Y.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Ri,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(R,q){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[R]=q,"interaxialDistance"===R&&(this._cameraRigParams.stereoHalfAngle=Z.f.ToRadians(q/.0637))}createRigCamera(R,q){return null}_updateRigCameras(){for(let R=0;R<this._rigCameras.length;R++)this._rigCameras[R].Ri=this.Ri,this._rigCameras[R].maxZ=this.maxZ,this._rigCameras[R].fov=this.fov,this._rigCameras[R].upVector.p(this.upVector);this.cameraRigMode===p.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const R=r.b.Serialize(this);return R.uniqueId=this.uniqueId,R.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(R),this.inputs&&this.inputs.serialize(R),r.b.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.isEnabled=this.isEnabled(),R}clone(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=r.b.Clone(p.GetConstructorFromName(this.getClassName(),R,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return L.name=R,L.parent=q,this.onClonedObservable.notifyObservers(L),L}Le(R){const q=Y.m.Zero();return this.getDirectionToRef(R,q),q}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(R,q){Y.m.TransformNormalToRef(R,this.getWorldMatrix(),q)}static GetConstructorFromName(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const h=F.d.Construct(R,q,L,{interaxial_distance:B,isStereoscopicSideBySide:N});return h||(()=>p._CreateDefaultParsedCamera(q,L))}Jj(){return this.getWorldMatrix()}static Parse(R,q){const L=R.type,B=p.GetConstructorFromName(L,R.name,q,R.interaxial_distance,R.isStereoscopicSideBySide),N=r.b.Parse(B,R,q);if(void 0!==R.parentId&&(N._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(N._waitingParentInstanceIndex=R.parentInstanceIndex),N.inputs&&(N.inputs.parse(R),N._setupInputs()),R.upVector&&(N.upVector=Y.m.Ig(R.upVector)),N.setPosition&&(N.position.Td(0,0,0),N.setPosition(Y.m.Ig(R.position))),R.target&&N.setTarget&&N.setTarget(Y.m.Ig(R.target)),R.cameraRigMode){const q=R.interaxial_distance?{interaxialDistance:R.interaxial_distance}:{};N.setCameraRigMode(R.cameraRigMode,q)}if(R.animations){for(let q=0;q<R.animations.length;q++){const L=R.animations[q],B=(0,e.d)("BABYLON.Animation");B&&N.animations.push(B.Parse(L))}F.d.ParseAnimationRanges(N,R,q)}return R.autoAnimate&&q.beginAnimation(N,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),void 0!==R.isEnabled&&N.xb(R.isEnabled),N}_calculateHandednessMultiplier(){let R=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(R*=-1),R}}p._CreateDefaultParsedCamera=(R,q)=>{throw(0,y.d)("UniversalCamera")},p.PERSPECTIVE_CAMERA=0,p.ORTHOGRAPHIC_CAMERA=1,p.FOVMODE_VERTICAL_FIXED=0,p.FOVMODE_HORIZONTAL_FIXED=1,p.RIG_MODE_NONE=0,p.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,p.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,p.RIG_MODE_STEREOSCOPIC_INTERLACED=14,p.RIG_MODE_VR=20,p.RIG_MODE_CUSTOM=22,p.ForceAttachControlToAlwaysPreventDefault=!1,(0,B.d)([(0,N.G)("position")],p.prototype,"_position",void 0),(0,B.d)([(0,N.G)("upVector")],p.prototype,"_upVector",void 0),(0,B.d)([(0,N.K)()],p.prototype,"orthoLeft",null),(0,B.d)([(0,N.K)()],p.prototype,"orthoRight",null),(0,B.d)([(0,N.K)()],p.prototype,"orthoBottom",null),(0,B.d)([(0,N.K)()],p.prototype,"orthoTop",null),(0,B.d)([(0,N.K)()],p.prototype,"fov",void 0),(0,B.d)([(0,N.K)()],p.prototype,"projectionPlaneTilt",void 0),(0,B.d)([(0,N.K)()],p.prototype,"Ri",void 0),(0,B.d)([(0,N.K)()],p.prototype,"maxZ",void 0),(0,B.d)([(0,N.K)()],p.prototype,"inertia",void 0),(0,B.d)([(0,N.K)()],p.prototype,"mode",null),(0,B.d)([(0,N.K)()],p.prototype,"layerMask",void 0),(0,B.d)([(0,N.K)()],p.prototype,"fovMode",void 0),(0,B.d)([(0,N.K)()],p.prototype,"cameraRigMode",void 0),(0,B.d)([(0,N.K)()],p.prototype,"interaxialDistance",void 0),(0,B.d)([(0,N.K)()],p.prototype,"isStereoscopicSideBySide",void 0)},12031:(R,q,L)=>{"use strict";L.d(q,{e:()=>Z,g:()=>z});var B=L(10767),N=L(11117),h=L(11337),Z={};class z{constructor(R){this.attachedToElement=!1,this.attached={},this.camera=R,this.checkInputs=()=>{}}add(R){const q=R.getSimpleName();this.attached[q]?B.d.Warn("camera input of type "+q+" already exists on camera"):(this.attached[q]=R,R.camera=this.camera,R.checkInputs&&(this.checkInputs=this._addCheckInputs(R.checkInputs.bind(R))),this.attachedToElement&&R.attachControl(this.noPreventDefault))}remove(R){for(const q in this.attached){const L=this.attached[q];if(L===R)return L.Ni(),L.camera=null,delete this.attached[q],void this.rebuildInputCheck()}}removeByType(R){for(const q in this.attached){const L=this.attached[q];L.getClassName()===R&&(L.Ni(),L.camera=null,delete this.attached[q],this.rebuildInputCheck())}}_addCheckInputs(R){const q=this.checkInputs;return()=>{q(),R()}}attachInput(R){this.attachedToElement&&R.attachControl(this.noPreventDefault)}attachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){R=!h.d.ForceAttachControlToAlwaysPreventDefault&&R,this.attachedToElement=!0,this.noPreventDefault=R;for(const q in this.attached)this.attached[q].attachControl(R)}}detachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const q in this.attached)this.attached[q].Ni(),R&&(this.attached[q].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const R in this.attached){const q=this.attached[R];q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(R){const q={};for(const L in this.attached){const R=this.attached[L],B=N.b.Serialize(R);q[R.getClassName()]=B}R.inputsmgr=q}parse(R){const q=R.inputsmgr;if(q){this.clear();for(const R in q){const L=Z[R];if(L){const B=q[R],h=N.b.Parse((()=>new L),B,null);this.add(h)}}}else for(const L in this.attached){const q=Z[this.attached[L].getClassName()];if(q){const B=N.b.Parse((()=>new q),R,null);this.remove(this.attached[L]),this.add(B)}}}}},12022:(R,q,L)=>{"use strict";L.d(q,{b:()=>t});var B=L(11053),N=L(11058),h=L(11081),Z=L(12027),z=L(12031),Y=L(11176),F=L(10757);class C{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(R){R=F.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const L=q.event;if(!L.metaKey)if(q.type===Y.b.KEYDOWN){if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysUpward.indexOf(L.keyCode)||-1!==this.keysDownward.indexOf(L.keyCode)||-1!==this.keysRotateLeft.indexOf(L.keyCode)||-1!==this.keysRotateRight.indexOf(L.keyCode)||-1!==this.keysRotateUp.indexOf(L.keyCode)||-1!==this.keysRotateDown.indexOf(L.keyCode)){-1===this._keys.indexOf(L.keyCode)&&this._keys.push(L.keyCode),R||L.preventDefault()}}else if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysUpward.indexOf(L.keyCode)||-1!==this.keysDownward.indexOf(L.keyCode)||-1!==this.keysRotateLeft.indexOf(L.keyCode)||-1!==this.keysRotateRight.indexOf(L.keyCode)||-1!==this.keysRotateUp.indexOf(L.keyCode)||-1!==this.keysRotateDown.indexOf(L.keyCode)){const q=this._keys.indexOf(L.keyCode);q>=0&&this._keys.splice(q,1),R||L.preventDefault()}})))}Ni(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let q=0;q<this._keys.length;q++){const L=this._keys[q],B=R._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(L)?R._localDirection.Td(-B,0,0):-1!==this.keysUp.indexOf(L)?R._localDirection.Td(0,0,B):-1!==this.keysRight.indexOf(L)?R._localDirection.Td(B,0,0):-1!==this.keysDown.indexOf(L)?R._localDirection.Td(0,0,-B):-1!==this.keysUpward.indexOf(L)?R._localDirection.Td(0,B,0):-1!==this.keysDownward.indexOf(L)?R._localDirection.Td(0,-B,0):-1!==this.keysRotateLeft.indexOf(L)?(R._localDirection.Td(0,0,0),R.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(L)?(R._localDirection.Td(0,0,0),R.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(L)?(R._localDirection.Td(0,0,0),R.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(L)&&(R._localDirection.Td(0,0,0),R.cameraRotation.x+=this._getLocalRotation()),R.va().useRightHandedSystem&&(R._localDirection.z*=-1),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),h.m.TransformNormalToRef(R._localDirection,R._cameraTransformMatrix,R._transformedDirection),R.cameraDirection.addInPlace(R._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const R=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*R}}(0,B.d)([(0,N.K)()],C.prototype,"keysUp",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysUpward",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysDown",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysDownward",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysLeft",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysRight",void 0),(0,B.d)([(0,N.K)()],C.prototype,"rotationSpeed",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysRotateLeft",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysRotateRight",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysRotateUp",void 0),(0,B.d)([(0,N.K)()],C.prototype,"keysRotateDown",void 0),z.e.FreeCameraKeyboardMoveInput=C;var e=L(10760),y=L(11168);class U{constructor(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=R,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new e.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(R){R=F.f.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),L=q.getInputElement();this._pointerInput||(this._pointerInput=B=>{const N=B.event,h="touch"===N.pointerType;if(!this.touchEnabled&&h)return;if(B.type!==y.e.POINTERMOVE&&-1===this.buttons.indexOf(N.button))return;const Z=N.target;if(B.type===y.e.POINTERDOWN){if(h&&-1!==this._activePointerId||!h&&-1!==this._currentActiveButton)return;this._activePointerId=N.pointerId;try{null===Z||void 0===Z||Z.setPointerCapture(N.pointerId)}catch(z){}-1===this._currentActiveButton&&(this._currentActiveButton=N.button),this._previousPosition={x:N.clientX,y:N.clientY},R||(N.preventDefault(),L&&L.focus()),q.isPointerLock&&this._onMouseMove&&this._onMouseMove(B.event)}else if(B.type===y.e.POINTERUP){if(h&&this._activePointerId!==N.pointerId||!h&&this._currentActiveButton!==N.button)return;try{null===Z||void 0===Z||Z.releasePointerCapture(N.pointerId)}catch(z){}this._currentActiveButton=-1,this._previousPosition=null,R||N.preventDefault(),this._activePointerId=-1}else if(B.type===y.e.POINTERMOVE&&(this._activePointerId===N.pointerId||!h))if(q.isPointerLock&&this._onMouseMove)this._onMouseMove(B.event);else if(this._previousPosition){const q=this.camera._calculateHandednessMultiplier(),L=(N.clientX-this._previousPosition.x)*q,B=N.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=L/this.angularSensibility,this.camera.cameraRotation.x+=B/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:L,offsetY:B}),this._previousPosition={x:N.clientX,y:N.clientY},R||N.preventDefault()}}),this._onMouseMove=L=>{if(!q.isPointerLock)return;const B=this.camera._calculateHandednessMultiplier(),N=L.movementX*B;this.camera.cameraRotation.y+=N/this.angularSensibility;const h=L.movementY;this.camera.cameraRotation.x+=h/this.angularSensibility,this._previousPosition=null,R||L.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE),L&&(this._contextMenuBind=R=>this.onContextMenu(R),L.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(R){R.preventDefault()}Ni(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,B.d)([(0,N.K)()],U.prototype,"buttons",void 0),(0,B.d)([(0,N.K)()],U.prototype,"angularSensibility",void 0),z.e.FreeCameraMouseInput=U;var n,r=L(11182);class p{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new e.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(R){R=F.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==y.e.POINTERWHEEL)return;const L=q.event,B=L.deltaMode===r.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*B*L.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*B*L.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*B*L.deltaZ/this._normalize,L.preventDefault&&(R||L.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,y.e.POINTERWHEEL)}Ni(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,B.d)([(0,N.K)()],p.prototype,"wheelPrecisionX",void 0),(0,B.d)([(0,N.K)()],p.prototype,"wheelPrecisionY",void 0),(0,B.d)([(0,N.K)()],p.prototype,"wheelPrecisionZ",void 0),function(R){R[R.MoveRelative=0]="MoveRelative",R[R.RotateRelative=1]="RotateRelative",R[R.MoveScene=2]="MoveScene"}(n||(n={}));class c extends p{constructor(){super(...arguments),this._moveRelative=h.m.Zero(),this._rotateRelative=h.m.Zero(),this._moveScene=h.m.Zero(),this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(R){null===R&&this._wheelXAction!==n.MoveRelative||(this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=R)}get wheelXMoveRelative(){return this._wheelXAction!==n.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(R){null===R&&this._wheelYAction!==n.MoveRelative||(this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=R)}get wheelYMoveRelative(){return this._wheelYAction!==n.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(R){null===R&&this._wheelZAction!==n.MoveRelative||(this._wheelZAction=n.MoveRelative,this._wheelZActionCoordinate=R)}get wheelZMoveRelative(){return this._wheelZAction!==n.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(R){null===R&&this._wheelXAction!==n.RotateRelative||(this._wheelXAction=n.RotateRelative,this._wheelXActionCoordinate=R)}get wheelXRotateRelative(){return this._wheelXAction!==n.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(R){null===R&&this._wheelYAction!==n.RotateRelative||(this._wheelYAction=n.RotateRelative,this._wheelYActionCoordinate=R)}get wheelYRotateRelative(){return this._wheelYAction!==n.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(R){null===R&&this._wheelZAction!==n.RotateRelative||(this._wheelZAction=n.RotateRelative,this._wheelZActionCoordinate=R)}get wheelZRotateRelative(){return this._wheelZAction!==n.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(R){null===R&&this._wheelXAction!==n.MoveScene||(this._wheelXAction=n.MoveScene,this._wheelXActionCoordinate=R)}get wheelXMoveScene(){return this._wheelXAction!==n.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(R){null===R&&this._wheelYAction!==n.MoveScene||(this._wheelYAction=n.MoveScene,this._wheelYActionCoordinate=R)}get wheelYMoveScene(){return this._wheelYAction!==n.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(R){null===R&&this._wheelZAction!==n.MoveScene||(this._wheelZAction=n.MoveScene,this._wheelZActionCoordinate=R)}get wheelZMoveScene(){return this._wheelZAction!==n.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Rd(0),this._rotateRelative.Rd(0),this._moveScene.Rd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const R=h.c.Zero();this.camera.getViewMatrix().invertToRef(R);const q=h.m.Zero();h.m.TransformNormalToRef(this._moveRelative,R,q),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(q),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(R,q,L){if(0===R)return;if(null===q||null===L)return;let B=null;switch(q){case n.MoveRelative:B=this._moveRelative;break;case n.RotateRelative:B=this._rotateRelative;break;case n.MoveScene:B=this._moveScene}switch(L){case 0:B.set(R,0,0);break;case 1:B.set(0,R,0);break;case 2:B.set(0,0,R)}}}(0,B.d)([(0,N.K)()],c.prototype,"wheelXMoveRelative",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelYMoveRelative",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelZMoveRelative",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelXRotateRelative",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelYRotateRelative",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelZRotateRelative",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelXMoveScene",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelYMoveScene",null),(0,B.d)([(0,N.K)()],c.prototype,"wheelZMoveScene",null),z.e.FreeCameraMouseWheelInput=c;class d{constructor(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=R,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=F.f.IsSafari()}attachControl(R){R=F.f.BackCompatCameraNoPreventDefault(arguments);let q=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=L=>{const B=L.event,N="mouse"===B.pointerType||this._isSafari&&"undefined"===typeof B.pointerType;if(this.allowMouse||!N)if(L.type===y.e.POINTERDOWN){if(R||B.preventDefault(),this._pointerPressed.push(B.pointerId),1!==this._pointerPressed.length)return;q={x:B.clientX,y:B.clientY}}else if(L.type===y.e.POINTERUP){R||B.preventDefault();const L=this._pointerPressed.indexOf(B.pointerId);if(-1===L)return;if(this._pointerPressed.splice(L,1),0!=L)return;q=null,this._offsetX=null,this._offsetY=null}else if(L.type===y.e.POINTERMOVE){if(R||B.preventDefault(),!q)return;if(0!=this._pointerPressed.indexOf(B.pointerId))return;this._offsetX=B.clientX-q.x,this._offsetY=-(B.clientY-q.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.addEventListener("blur",this._onLostFocus)}}Ni(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const R=this.camera,q=R._calculateHandednessMultiplier();R.cameraRotation.y=q*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)R.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const q=R._computeLocalCameraSpeed(),L=new h.m(0,0,0!==this.touchMoveSensibility?q*this._offsetY/this.touchMoveSensibility:0);h.c.RotationYawPitchRollToRef(R.rotation.y,R.rotation.x,0,R._cameraRotationMatrix),R.cameraDirection.addInPlace(h.m.TransformCoordinates(L,R._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,B.d)([(0,N.K)()],d.prototype,"touchAngularSensibility",void 0),(0,B.d)([(0,N.K)()],d.prototype,"touchMoveSensibility",void 0),z.e.FreeCameraTouchInput=d;class f extends z.g{constructor(R){super(R),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new C),this}addMouse(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new U(R),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new c,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new d),this}clear(){super.clear(),this._mouseInput=null}}var v=L(10889),T=L(10834);class t extends Z.b{get angularSensibility(){const R=this.inputs.attached.mouse;return R?R.angularSensibility:0}set angularSensibility(R){const q=this.inputs.attached.mouse;q&&(q.angularSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const q=this.inputs.attached.keyboard;q&&(q.keysUp=R)}get keysUpward(){const R=this.inputs.attached.keyboard;return R?R.keysUpward:[]}set keysUpward(R){const q=this.inputs.attached.keyboard;q&&(q.keysUpward=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const q=this.inputs.attached.keyboard;q&&(q.keysDown=R)}get keysDownward(){const R=this.inputs.attached.keyboard;return R?R.keysDownward:[]}set keysDownward(R){const q=this.inputs.attached.keyboard;q&&(q.keysDownward=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const q=this.inputs.attached.keyboard;q&&(q.keysRight=R)}get keysRotateLeft(){const R=this.inputs.attached.keyboard;return R?R.keysRotateLeft:[]}set keysRotateLeft(R){const q=this.inputs.attached.keyboard;q&&(q.keysRotateLeft=R)}get keysRotateRight(){const R=this.inputs.attached.keyboard;return R?R.keysRotateRight:[]}set keysRotateRight(R){const q=this.inputs.attached.keyboard;q&&(q.keysRotateRight=R)}get keysRotateUp(){const R=this.inputs.attached.keyboard;return R?R.keysRotateUp:[]}set keysRotateUp(R){const q=this.inputs.attached.keyboard;q&&(q.keysRotateUp=R)}get keysRotateDown(){const R=this.inputs.attached.keyboard;return R?R.keysRotateDown:[]}set keysRotateDown(R){const q=this.inputs.attached.keyboard;q&&(q.keysRotateDown=R)}constructor(R,q,L){var B;super(R,q,L,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),B=this,this.ellipsoid=new h.m(.5,1,.5),this.ellipsoidOffset=new h.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=h.m.Zero(),this._diffPosition=h.m.Zero(),this._newPosition=h.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B._newPosition.p(q),B._newPosition.subtractToRef(B._oldPosition,B._diffPosition),B._diffPosition.length()>T.e.CollisionsEpsilon&&(B.position.addToRef(B._diffPosition,B._deferredPositionUpdate),B._deferOnly?B._deferredUpdated=!0:B.position.p(B._deferredPositionUpdate),B.Dk&&L&&B.Dk(L))},this.inputs=new f(this),this.inputs.addKeyboard().addMouse()}attachControl(R,q){q=F.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(q)}Ni(){this.inputs.detachElement(),this.cameraDirection=new h.m(0,0,0),this.cameraRotation=new h.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(R){this._collisionMask=isNaN(R)?-1:R}_collideWithWorld(R){let q;q=this.parent?h.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,q.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const L=this.va().collisionCoordinator;this._collider||(this._collider=L.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let B=R;this.applyGravity&&(B=R.add(this.va().gravity)),L.getNewPosition(this._oldPosition,B,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=h.m.Zero(),this._transformedDirection=h.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(R){this._needMoveForGravity=R}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,B.d)([(0,N.G)()],t.prototype,"ellipsoid",void 0),(0,B.d)([(0,N.G)()],t.prototype,"ellipsoidOffset",void 0),(0,B.d)([(0,N.K)()],t.prototype,"checkCollisions",void 0),(0,B.d)([(0,N.K)()],t.prototype,"applyGravity",void 0),(0,v.f)("BABYLON.FreeCamera",t)},12027:(R,q,L)=>{"use strict";L.d(q,{b:()=>F});var B=L(11053),N=L(11058),h=L(11337),Z=L(11081),z=L(11088),Y=L(11382);L(11345).d.AddNodeConstructor("TargetCamera",((R,q)=>()=>new F(R,Z.m.Zero(),q)));class F extends h.d{constructor(R,q,L){super(R,q,L,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=Z.m.Zero(),this._tmpTargetVector=Z.m.Zero(),this.cameraDirection=new Z.m(0,0,0),this.cameraRotation=new Z.i(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new Z.d,this.rotation=new Z.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=Z.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=Z.c.Zero(),this._camMatrix=Z.c.Zero(),this._cameraTransformMatrix=Z.c.Zero(),this._cameraRotationMatrix=Z.c.Zero(),this._referencePoint=new Z.m(0,0,1),this._transformedReferencePoint=Z.m.Zero(),this._deferredPositionUpdate=new Z.m,this._deferredRotationQuaternionUpdate=new Z.d,this._deferredRotationUpdate=new Z.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=Z.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(R){this.getWorldMatrix();const q=this.getTarget().Bc(this.position);return q.normalize(),q.scaleInPlace(R),this.globalPosition.add(q)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const R=this.lockedTarget;R.Jj().getTranslationToRef(R.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Td(0,0,0),this.cameraRotation.Td(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new Z.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new Z.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Z.d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(R){R||super._updateCache();const q=this._getLockedTargetPosition();q?this._cache.lockedTarget?this._cache.lockedTarget.p(q):this._cache.lockedTarget=q.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const R=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(R):!R)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const R=this.getEngine();return this.speed*Math.sqrt(R.getDeltaTime()/(100*R.getFps()))}setTarget(R){this.upVector.normalize(),this._initialFocalDistance=R.Bc(this.position).length(),this.position.z===R.z&&(this.position.z+=z.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),Z.c.LookAtLHToRef(this.position,R,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const q=R.Bc(this.position);q.x>=0?this.rotation.y=-Math.atan(q.z/q.x)+Math.PI/2:this.rotation.y=-Math.atan(q.z/q.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&Z.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(R){this.setTarget(R)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(Z.h.Matrix[0]),Z.m.TransformNormalToRef(this.cameraDirection,Z.h.Matrix[0],Z.h.o[0]),this._deferredPositionUpdate.addInPlace(Z.h.o[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const R=this.invertRotation?-this.inverseRotationSpeed:1,q=this._decideIfNeedsToMove(),L=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),q&&this._updatePosition(),L){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*R,this._deferredRotationUpdate.y+=this.cameraRotation.y*R,!this.noRotationConstraint){const R=1.570796;this._deferredRotationUpdate.x>R&&(this._deferredRotationUpdate.x=R),this._deferredRotationUpdate.x<-R&&(this._deferredRotationUpdate.x=-R)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(Z.d.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}q&&(Math.abs(this.cameraDirection.x)<this.speed*z.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*z.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*z.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),L&&(Math.abs(this.cameraRotation.x)<this.speed*z.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*z.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Z.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return Z.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),Z.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Y.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Z.d.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Y.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(R,q,L){if(this.ignoreParentScaling){if(this.parent){const B=this.parent.getWorldMatrix();Z.m.TransformCoordinatesToRef(R,B,this._globalPosition),Z.m.TransformCoordinatesToRef(q,B,this._tmpTargetVector),Z.m.TransformNormalToRef(L,B,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(R),this._tmpTargetVector.p(q),this._tmpUpVector.p(L);this.va().useRightHandedSystem?Z.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):Z.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?Z.c.LookAtRHToRef(R,q,L,this._viewMatrix):Z.c.LookAtLHToRef(R,q,L,this._viewMatrix),this.parent){const R=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(R,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(R)}createRigCamera(R,q){if(this.cameraRigMode!==h.d.RIG_MODE_NONE){const q=new F(R,this.position.clone(),this.va());return q.isRigCamera=!0,q.rigParent=this,this.cameraRigMode===h.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new Z.d),q._cameraRigParams={},q.rotationQuaternion=new Z.d),q.mode=this.mode,q.orthoLeft=this.orthoLeft,q.orthoRight=this.orthoRight,q.orthoTop=this.orthoTop,q.orthoBottom=this.orthoBottom,q}return null}_updateRigCameras(){const R=this._rigCameras[0],q=this._rigCameras[1];switch(this.Jj(),this.cameraRigMode){case h.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case h.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const L=this.cameraRigMode===h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,B=this.cameraRigMode===h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*L,R),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*B,q);break}case h.d.RIG_MODE_VR:R.rotationQuaternion?(R.rotationQuaternion.p(this.rotationQuaternion),q.rotationQuaternion.p(this.rotationQuaternion)):(R.rotation.p(this.rotation),q.rotation.p(this.rotation)),R.position.p(this.position),q.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(R,q){this.getTarget().subtractToRef(this.position,F._TargetFocalPoint),F._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const L=F._TargetFocalPoint.addInPlace(this.position);Z.c.TranslationToRef(-L.x,-L.y,-L.z,F._TargetTransformMatrix),F._TargetTransformMatrix.multiplyToRef(Z.c.RotationAxis(q.upVector,R),F._RigCamTransformMatrix),Z.c.TranslationToRef(L.x,L.y,L.z,F._TargetTransformMatrix),F._RigCamTransformMatrix.multiplyToRef(F._TargetTransformMatrix,F._RigCamTransformMatrix),Z.m.TransformCoordinatesToRef(this.position,F._RigCamTransformMatrix,q.position),q.setTarget(L)}getClassName(){return"TargetCamera"}}F._RigCamTransformMatrix=new Z.c,F._TargetTransformMatrix=new Z.c,F._TargetFocalPoint=new Z.m,(0,B.d)([(0,N.G)()],F.prototype,"rotation",void 0),(0,B.d)([(0,N.K)()],F.prototype,"speed",void 0),(0,B.d)([(0,N.x)("lockedTargetId")],F.prototype,"lockedTarget",void 0)},11226:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{constructor(R,q,L){this.bu=R,this.bv=q,this.distance=L,this.faceId=0,this.subMeshId=0}}},11134:(R,q,L)=>{"use strict";L.d(q,{c:()=>h});var B=L(11081),N=L(11136);class h{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var R;let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||L&&!this.pickedMesh.isVerticesDataPresent(N.e.NormalKind))return null;let h,Z=this.pickedMesh.Sf();0===(null===(R=Z)||void 0===R?void 0:R.length)&&(Z=null);const z=B.h.o[0],Y=B.h.o[1],F=B.h.o[2];if(L){const R=this.pickedMesh.getVerticesData(N.e.NormalKind);let q=Z?B.m.FromArrayToRef(R,3*Z[3*this.faceId],z):z.Td(R[3*this.faceId*3],R[3*this.faceId*3+1],R[3*this.faceId*3+2]),L=Z?B.m.FromArrayToRef(R,3*Z[3*this.faceId+1],Y):Y.Td(R[3*(3*this.faceId+1)],R[3*(3*this.faceId+1)+1],R[3*(3*this.faceId+1)+2]),C=Z?B.m.FromArrayToRef(R,3*Z[3*this.faceId+2],F):F.Td(R[3*(3*this.faceId+2)],R[3*(3*this.faceId+2)+1],R[3*(3*this.faceId+2)+2]);q=q.scale(this.bu),L=L.scale(this.bv),C=C.scale(1-this.bu-this.bv),h=new B.m(q.x+L.x+C.x,q.y+L.y+C.y,q.z+L.z+C.z)}else{const R=this.pickedMesh.getVerticesData(N.e.PositionKind),q=Z?B.m.FromArrayToRef(R,3*Z[3*this.faceId],z):z.Td(R[3*this.faceId*3],R[3*this.faceId*3+1],R[3*this.faceId*3+2]),L=Z?B.m.FromArrayToRef(R,3*Z[3*this.faceId+1],Y):Y.Td(R[3*(3*this.faceId+1)],R[3*(3*this.faceId+1)+1],R[3*(3*this.faceId+1)+2]),C=Z?B.m.FromArrayToRef(R,3*Z[3*this.faceId+2],F):F.Td(R[3*(3*this.faceId+2)],R[3*(3*this.faceId+2)+1],R[3*(3*this.faceId+2)+2]),e=q.Bc(L),y=C.Bc(L);h=B.m.Cross(e,y)}const C=(R,q)=>{let L=R.getWorldMatrix();R.nonUniformScaling&&(B.h.Matrix[0].p(L),L=B.h.Matrix[0],L.setTranslationFromFloats(0,0,0),L.invert(),L.transposeToRef(B.h.Matrix[1]),L=B.h.Matrix[1]),B.m.TransformNormalToRef(q,L,q)};if(q&&C(this.pickedMesh,h),this.ray){const R=B.h.o[0].p(h);q||C(this.pickedMesh,R),B.m.Dot(R,this.ray.direction)>0&&h.negateInPlace()}return h.normalize(),h}getTextureCoordinates(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.e.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(R))return null;const q=this.pickedMesh.Sf();if(!q)return null;const L=this.pickedMesh.getVerticesData(R);if(!L)return null;let h=B.i.Ig(L,2*q[3*this.faceId]),Z=B.i.Ig(L,2*q[3*this.faceId+1]),z=B.i.Ig(L,2*q[3*this.faceId+2]);return h=h.scale(this.bu),Z=Z.scale(this.bv),z=z.scale(1-this.bu-this.bv),new B.i(h.x+Z.x+z.x,h.y+Z.y+z.y)}}},11292:(R,q,L)=>{"use strict";L.d(q,{e:()=>B});let B=!1},12497:(R,q,L)=>{"use strict";L.d(q,{c:()=>h});var B=L(11065),N=L(12506);class h{constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=L,this.hi=[],this._maxBlockCapacity=q||64,this._selectionContent=new B.d(1024),this._creationFunc=R}update(R,q,L){N.d._CreateBlocks(R,q,L,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}gi(R){for(let q=0;q<this.oh.length;q++){this.oh[q].addEntry(R)}}Fc(R){for(let q=0;q<this.oh.length;q++){this.oh[q].removeEntry(R)}}select(R,q){this._selectionContent.reset();for(let L=0;L<this.oh.length;L++){this.oh[L].select(R,this._selectionContent,q)}return q?this._selectionContent.concat(this.hi):this._selectionContent.concatWithNoDuplicate(this.hi),this._selectionContent}intersects(R,q,L){this._selectionContent.reset();for(let B=0;B<this.oh.length;B++){this.oh[B].intersects(R,q,this._selectionContent,L)}return L?this._selectionContent.concat(this.hi):this._selectionContent.concatWithNoDuplicate(this.hi),this._selectionContent}intersectsRay(R){this._selectionContent.reset();for(let q=0;q<this.oh.length;q++){this.oh[q].intersectsRay(R,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.hi),this._selectionContent}}h.CreationFuncForMeshes=(R,q)=>{const L=R.getBoundingInfo();!R.isBlocked&&L.boundingBox.intersectsMinMax(q.li,q.mi)&&q.entries.push(R)},h.CreationFuncForSubMeshes=(R,q)=>{R.getBoundingInfo().boundingBox.intersectsMinMax(q.li,q.mi)&&q.entries.push(R)}},12506:(R,q,L)=>{"use strict";L.d(q,{d:()=>h});var B=L(11081),N=L(11234);class h{constructor(R,q,L,B,N,h){this.entries=[],this.ni=new Array,this._capacity=L,this._depth=B,this._maxDepth=N,this._creationFunc=h,this._minPoint=R,this._maxPoint=q,this.ni.push(R.clone()),this.ni.push(q.clone()),this.ni.push(R.clone()),this.ni[2].x=q.x,this.ni.push(R.clone()),this.ni[3].y=q.y,this.ni.push(R.clone()),this.ni[4].z=q.z,this.ni.push(q.clone()),this.ni[5].z=R.z,this.ni.push(q.clone()),this.ni[6].x=R.x,this.ni.push(q.clone()),this.ni[7].y=R.y}get nb(){return this._capacity}get li(){return this._minPoint}get mi(){return this._maxPoint}addEntry(R){if(this.oh)for(let q=0;q<this.oh.length;q++){this.oh[q].addEntry(R)}else this._creationFunc(R,this),this.entries.length>this.nb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(R){if(this.oh){for(let q=0;q<this.oh.length;q++){this.oh[q].removeEntry(R)}return}const q=this.entries.indexOf(R);q>-1&&this.entries.splice(q,1)}addEntries(R){for(let q=0;q<R.length;q++){const L=R[q];this.addEntry(L)}}select(R,q,L){if(N.b.IsInFrustum(this.ni,R)){if(this.oh){for(let B=0;B<this.oh.length;B++){this.oh[B].select(R,q,L)}return}L?q.concat(this.entries):q.concatWithNoDuplicate(this.entries)}}intersects(R,q,L,B){if(N.b.IntersectsSphere(this._minPoint,this._maxPoint,R,q)){if(this.oh){for(let N=0;N<this.oh.length;N++){this.oh[N].intersects(R,q,L,B)}return}B?L.concat(this.entries):L.concatWithNoDuplicate(this.entries)}}intersectsRay(R,q){if(R.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.oh){for(let L=0;L<this.oh.length;L++){this.oh[L].intersectsRay(R,q)}return}q.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){h._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(R,q,L,N,Z,z,Y,F){Y.oh=new Array;const C=new B.m((q.x-R.x)/2,(q.y-R.y)/2,(q.z-R.z)/2);for(let B=0;B<2;B++)for(let q=0;q<2;q++)for(let e=0;e<2;e++){const y=R.add(C.multiplyByFloats(B,q,e)),U=R.add(C.multiplyByFloats(B+1,q+1,e+1)),n=new h(y,U,N,Z+1,z,F);n.addEntries(L),Y.oh.push(n)}}}},12512:(R,q,L)=>{"use strict";L.d(q,{d:()=>C});var B=L(11071),N=L(11081),h=L(11375),Z=L(11751),z=L(11160),Y=L(12497),F=L(10797);B.b.prototype.createOrUpdateSelectionOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,L=this._getComponent(z.d.NAME_OCTREE);L||(L=new C(this),this.fb(L)),this.ei||(this.ei=new Y.c(Y.c.CreationFuncForMeshes,R,q));const B=this.getWorldExtends();return this.ei.update(B.min,B.max,this.meshes),this.ei},Object.defineProperty(B.b.prototype,"selectionOctree",{get:function(){return this.ei},enumerable:!0,configurable:!0}),h.c.prototype.createOrUpdateSubmeshesOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const L=this.va();let B=L._getComponent(z.d.NAME_OCTREE);B||(B=new C(L),L.fb(B)),this._submeshesOctree||(this._submeshesOctree=new Y.c(Y.c.CreationFuncForSubMeshes,R,q)),this.Jj(!0);const N=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(N.minimumWorld,N.maximumWorld,this.Zf),this._submeshesOctree};class C{constructor(R){this.name=z.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Z.d(N.m.Zero(),new N.m(1,1,1)),(R=R||F.b.LastCreatedScene)&&(this.Nc=R,this.Nc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Nc.getActiveSubMeshCandidates=R=>this.getActiveSubMeshCandidates(R),this.Nc.getCollidingSubMeshCandidates=(R,q)=>this.getCollidingSubMeshCandidates(R,q),this.Nc.getIntersectingSubMeshCandidates=(R,q)=>this.getIntersectingSubMeshCandidates(R,q))}register(){this.Nc.onMeshRemovedObservable.add((R=>{const q=this.Nc.selectionOctree;if(void 0!==q&&null!==q){const L=q.hi.indexOf(R);-1!==L&&q.hi.splice(L,1)}})),this.Nc.onMeshImportedObservable.add((R=>{const q=this.Nc.selectionOctree;void 0!==q&&null!==q&&q.gi(R)}))}getActiveMeshCandidates(){var R;return(null===(R=this.Nc.ei)||void 0===R?void 0:R.select(this.Nc.frustumPlanes))||this.Nc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(R){if(R._submeshesOctree&&R.useOctreeForRenderingSelection){return R._submeshesOctree.select(this.Nc.frustumPlanes)}return this.Nc._getDefaultSubMeshCandidates(R)}getIntersectingSubMeshCandidates(R,q){if(R._submeshesOctree&&R.useOctreeForPicking){Z.d.TransformToRef(q,R.getWorldMatrix(),this._tempRay);return R._submeshesOctree.intersectsRay(this._tempRay)}return this.Nc._getDefaultSubMeshCandidates(R)}getCollidingSubMeshCandidates(R,q){if(R._submeshesOctree&&R.useOctreeForCollisions){const L=q._velocityWorldLength+Math.max(q._radius.x,q._radius.y,q._radius.z);return R._submeshesOctree.intersects(q._basePointWorld,L)}return this.Nc._getDefaultSubMeshCandidates(R)}rebuild(){}dispose(){}}},11234:(R,q,L)=>{"use strict";L.d(q,{b:()=>Z});var B=L(11092),N=L(11081),h=L(11088);class Z{constructor(R,q,L){this.vectors=(0,B.e)(8,N.m.Zero),this.center=N.m.Zero(),this.centerWorld=N.m.Zero(),this.extendSize=N.m.Zero(),this.extendSizeWorld=N.m.Zero(),this.directions=(0,B.e)(3,N.m.Zero),this.vectorsWorld=(0,B.e)(8,N.m.Zero),this.minimumWorld=N.m.Zero(),this.maximumWorld=N.m.Zero(),this.minimum=N.m.Zero(),this.maximum=N.m.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(R,q,L)}reConstruct(R,q,L){const B=R.x,h=R.y,Z=R.z,z=q.x,Y=q.y,F=q.z,C=this.vectors;this.minimum.Td(B,h,Z),this.maximum.Td(z,Y,F),C[0].Td(B,h,Z),C[1].Td(z,Y,F),C[2].Td(z,h,Z),C[3].Td(B,Y,Z),C[4].Td(B,h,F),C[5].Td(z,Y,Z),C[6].Td(B,Y,F),C[7].Td(z,h,F),q.addToRef(R,this.center).scaleInPlace(.5),q.subtractToRef(R,this.extendSize).scaleInPlace(.5),this._worldMatrix=L||N.c.IdentityReadOnly,this._update(this._worldMatrix)}scale(R){const q=Z._TmpVector3,L=this.maximum.subtractToRef(this.minimum,q[0]),B=L.length();L.normalizeFromLength(B);const N=B*R,h=L.scaleInPlace(.5*N),z=this.center.subtractToRef(h,q[1]),Y=this.center.addToRef(h,q[2]);return this.reConstruct(z,Y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(R){const q=this.minimumWorld,L=this.maximumWorld,B=this.directions,h=this.vectorsWorld,Z=this.vectors;if(R.isIdentity()){q.p(this.minimum),L.p(this.maximum);for(let R=0;R<8;++R)h[R].p(Z[R]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{q.Rd(Number.MAX_VALUE),L.Rd(-Number.MAX_VALUE);for(let B=0;B<8;++B){const z=h[B];N.m.TransformCoordinatesToRef(Z[B],R,z),q.minimizeInPlace(z),L.maximizeInPlace(z)}L.subtractToRef(q,this.extendSizeWorld).scaleInPlace(.5),L.addToRef(q,this.centerWorld).scaleInPlace(.5)}N.m.FromArrayToRef(R.m,0,B[0]),N.m.FromArrayToRef(R.m,4,B[1]),N.m.FromArrayToRef(R.m,8,B[2]),this._worldMatrix=R}isInFrustum(R){return Z.IsInFrustum(this.vectorsWorld,R)}isCompletelyInFrustum(R){return Z.IsCompletelyInFrustum(this.vectorsWorld,R)}intersectsPoint(R){const q=this.minimumWorld,L=this.maximumWorld,B=q.x,N=q.y,Z=q.z,z=L.x,Y=L.y,F=L.z,C=R.x,e=R.y,y=R.z,U=-h.e;return!(z-C<U||U>C-B)&&(!(Y-e<U||U>e-N)&&!(F-y<U||U>y-Z))}intersectsSphere(R){return Z.IntersectsSphere(this.minimumWorld,this.maximumWorld,R.centerWorld,R.radiusWorld)}intersectsMinMax(R,q){const L=this.minimumWorld,B=this.maximumWorld,N=L.x,h=L.y,Z=L.z,z=B.x,Y=B.y,F=B.z,C=R.x,e=R.y,y=R.z,U=q.x,n=q.y,r=q.z;return!(z<C||N>U)&&(!(Y<e||h>n)&&!(F<y||Z>r))}dispose(){var R,q;null===(R=this._drawWrapperFront)||void 0===R||R.dispose(),null===(q=this._drawWrapperBack)||void 0===q||q.dispose()}static Intersects(R,q){return R.intersectsMinMax(q.minimumWorld,q.maximumWorld)}static IntersectsSphere(R,q,L,B){const h=Z._TmpVector3[0];N.m.ClampToRef(L,R,q,h);return N.m.DistanceSquared(L,h)<=B*B}static IsCompletelyInFrustum(R,q){for(let L=0;L<6;++L){const B=q[L];for(let q=0;q<8;++q)if(B.dotCoordinate(R[q])<0)return!1}return!0}static IsInFrustum(R,q){for(let L=0;L<6;++L){let B=!0;const N=q[L];for(let q=0;q<8;++q)if(N.dotCoordinate(R[q])>=0){B=!1;break}if(B)return!1}return!0}}Z._TmpVector3=(0,B.e)(3,N.m.Zero)},11228:(R,q,L)=>{"use strict";L.d(q,{b:()=>e});var B=L(11092),N=L(11081),h=L(11234),Z=L(11236);const z={min:0,max:0},Y={min:0,max:0},F=(R,q,L)=>{const B=N.m.Dot(q.centerWorld,R),h=Math.abs(N.m.Dot(q.directions[0],R))*q.extendSize.x+Math.abs(N.m.Dot(q.directions[1],R))*q.extendSize.y+Math.abs(N.m.Dot(q.directions[2],R))*q.extendSize.z;L.min=B-h,L.max=B+h},C=(R,q,L)=>(F(R,q,z),F(R,L,Y),!(z.min>Y.max||Y.min>z.max));class e{constructor(R,q,L){this._isLocked=!1,this.boundingBox=new h.b(R,q,L),this.boundingSphere=new Z.d(R,q,L)}reConstruct(R,q,L){this.boundingBox.reConstruct(R,q,L),this.boundingSphere.reConstruct(R,q,L)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(R){this._isLocked=R}update(R){this._isLocked||(this.boundingBox._update(R),this.boundingSphere._update(R))}centerOn(R,q){const L=e._TmpVector3[0].p(R).ki(q),B=e._TmpVector3[1].p(R).addInPlace(q);return this.boundingBox.reConstruct(L,B,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(L,B,this.boundingBox.getWorldMatrix()),this}encapsulate(R){const q=N.m.Minimize(this.minimum,R),L=N.m.Maximize(this.maximum,R);return this.reConstruct(q,L,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(R){const q=N.h.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(q);const L=N.h.o[0];return N.m.TransformCoordinatesToRef(R.boundingBox.minimumWorld,q,L),this.encapsulate(L),N.m.TransformCoordinatesToRef(R.boundingBox.maximumWorld,q,L),this.encapsulate(L),this}scale(R){return this.boundingBox.scale(R),this.boundingSphere.scale(R),this}isInFrustum(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===q||3===q)&&this.boundingSphere.isCenterInFrustum(R))return!0;if(!this.boundingSphere.isInFrustum(R))return!1;return!(1!==q&&3!==q)||this.boundingBox.isInFrustum(R)}get diagonalLength(){const R=this.boundingBox;return R.maximumWorld.subtractToRef(R.minimumWorld,e._TmpVector3[0]).length()}isCompletelyInFrustum(R){return this.boundingBox.isCompletelyInFrustum(R)}_checkCollision(R){return R._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(R){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(R)&&!!this.boundingBox.intersectsPoint(R))}intersects(R,q){if(!Z.d.Intersects(this.boundingSphere,R.boundingSphere))return!1;if(!h.b.Intersects(this.boundingBox,R.boundingBox))return!1;if(!q)return!0;const L=this.boundingBox,B=R.boundingBox;return!!C(L.directions[0],L,B)&&(!!C(L.directions[1],L,B)&&(!!C(L.directions[2],L,B)&&(!!C(B.directions[0],L,B)&&(!!C(B.directions[1],L,B)&&(!!C(B.directions[2],L,B)&&(!!C(N.m.Cross(L.directions[0],B.directions[0]),L,B)&&(!!C(N.m.Cross(L.directions[0],B.directions[1]),L,B)&&(!!C(N.m.Cross(L.directions[0],B.directions[2]),L,B)&&(!!C(N.m.Cross(L.directions[1],B.directions[0]),L,B)&&(!!C(N.m.Cross(L.directions[1],B.directions[1]),L,B)&&(!!C(N.m.Cross(L.directions[1],B.directions[2]),L,B)&&(!!C(N.m.Cross(L.directions[2],B.directions[0]),L,B)&&(!!C(N.m.Cross(L.directions[2],B.directions[1]),L,B)&&!!C(N.m.Cross(L.directions[2],B.directions[2]),L,B))))))))))))))}}e._TmpVector3=(0,B.e)(2,N.m.Zero)},11236:(R,q,L)=>{"use strict";L.d(q,{d:()=>h});var B=L(11092),N=L(11081);class h{constructor(R,q,L){this.center=N.m.Zero(),this.centerWorld=N.m.Zero(),this.minimum=N.m.Zero(),this.maximum=N.m.Zero(),this.reConstruct(R,q,L)}reConstruct(R,q,L){this.minimum.p(R),this.maximum.p(q);const B=N.m.Distance(R,q);q.addToRef(R,this.center).scaleInPlace(.5),this.radius=.5*B,this._update(L||N.c.IdentityReadOnly)}scale(R){const q=this.radius*R,L=h._TmpVector3,B=L[0].Rd(q),N=this.center.subtractToRef(B,L[1]),Z=this.center.addToRef(B,L[2]);return this.reConstruct(N,Z,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(R){if(R.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{N.m.TransformCoordinatesToRef(this.center,R,this.centerWorld);const q=h._TmpVector3[0];N.m.TransformNormalFromFloatsToRef(1,1,1,R,q),this.radiusWorld=Math.max(Math.abs(q.x),Math.abs(q.y),Math.abs(q.z))*this.radius}}isInFrustum(R){const q=this.centerWorld,L=this.radiusWorld;for(let B=0;B<6;B++)if(R[B].dotCoordinate(q)<=-L)return!1;return!0}isCenterInFrustum(R){const q=this.centerWorld;for(let L=0;L<6;L++)if(R[L].dotCoordinate(q)<0)return!1;return!0}intersectsPoint(R){const q=N.m.DistanceSquared(this.centerWorld,R);return!(this.radiusWorld*this.radiusWorld<q)}static Intersects(R,q){const L=N.m.DistanceSquared(R.centerWorld,q.centerWorld),B=R.radiusWorld+q.radiusWorld;return!(B*B<L)}static CreateFromCenterAndRadius(R,q,L){this._TmpVector3[0].p(R),this._TmpVector3[1].Td(0,0,q),this._TmpVector3[2].p(R),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ki(this._TmpVector3[1]);const B=new h(this._TmpVector3[0],this._TmpVector3[2]);return B._worldMatrix=L||N.c.Identity(),B}}h._TmpVector3=(0,B.e)(3,N.m.Zero)},11751:(R,q,L)=>{"use strict";L.d(q,{d:()=>U});var B=L(11071),N=L(11337),h=L(11088),Z=L(11081),z=L(11092),Y=L(11226),F=L(11134),C=L(10797),e=L(11189);const y={internalPickerForMesh:void 0};class U{constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.e;this.origin=R,this.direction=q,this.length=L,this.epsilon=B}clone(){return new U(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=U._TmpVector3[0].Td(R.x-L,R.y-L,R.z-L),N=U._TmpVector3[1].Td(q.x+L,q.y+L,q.z+L);let h,Z,z,Y,F=0,C=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<B.x||this.origin.x>N.x)return!1}else if(h=1/this.direction.x,Z=(B.x-this.origin.x)*h,z=(N.x-this.origin.x)*h,z===-1/0&&(z=1/0),Z>z&&(Y=Z,Z=z,z=Y),F=Math.max(Z,F),C=Math.min(z,C),F>C)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<B.y||this.origin.y>N.y)return!1}else if(h=1/this.direction.y,Z=(B.y-this.origin.y)*h,z=(N.y-this.origin.y)*h,z===-1/0&&(z=1/0),Z>z&&(Y=Z,Z=z,z=Y),F=Math.max(Z,F),C=Math.min(z,C),F>C)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<B.z||this.origin.z>N.z)return!1}else if(h=1/this.direction.z,Z=(B.z-this.origin.z)*h,z=(N.z-this.origin.z)*h,z===-1/0&&(z=1/0),Z>z&&(Y=Z,Z=z,z=Y),F=Math.max(Z,F),C=Math.min(z,C),F>C)return!1;return!0}intersectsBox(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(R.minimum,R.maximum,q)}intersectsSphere(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=R.center.x-this.origin.x,B=R.center.y-this.origin.y,N=R.center.z-this.origin.z,h=L*L+B*B+N*N,Z=R.radius+q,z=Z*Z;if(h<=z)return!0;const Y=L*this.direction.x+B*this.direction.y+N*this.direction.z;if(Y<0)return!1;return h-Y*Y<=z}intersectsTriangle(R,q,L){const B=U._TmpVector3[0],N=U._TmpVector3[1],h=U._TmpVector3[2],z=U._TmpVector3[3],F=U._TmpVector3[4];q.subtractToRef(R,B),L.subtractToRef(R,N),Z.m.CrossToRef(this.direction,N,h);const C=Z.m.Dot(B,h);if(0===C)return null;const e=1/C;this.origin.subtractToRef(R,z);const y=Z.m.Dot(z,h)*e;if(y<-this.epsilon||y>1+this.epsilon)return null;Z.m.CrossToRef(z,B,F);const n=Z.m.Dot(this.direction,F)*e;if(n<-this.epsilon||y+n>1+this.epsilon)return null;const r=Z.m.Dot(N,F)*e;return r>this.length?null:new Y.b(1-y-n,y,r)}intersectsPlane(R){let q;const L=Z.m.Dot(R.k,this.direction);if(Math.abs(L)<9.99999997475243e-7)return null;{const B=Z.m.Dot(R.k,this.origin);return q=(-R.d-B)/L,q<0?q<-9.99999997475243e-7?null:0:q}}intersectsAxis(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(R){case"y":{const R=(this.origin.y-q)/this.direction.y;return R>0?null:new Z.m(this.origin.x+this.direction.x*-R,q,this.origin.z+this.direction.z*-R)}case"x":{const R=(this.origin.x-q)/this.direction.x;return R>0?null:new Z.m(q,this.origin.y+this.direction.y*-R,this.origin.z+this.direction.z*-R)}case"z":{const R=(this.origin.z-q)/this.direction.z;return R>0?null:new Z.m(this.origin.x+this.direction.x*-R,this.origin.y+this.direction.y*-R,q)}default:return null}}intersectsMesh(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=Z.h.Matrix[0];return R.getWorldMatrix().invertToRef(z),this._tmpRay?U.TransformToRef(this,z,this._tmpRay):this._tmpRay=U.Transform(this,z),R.intersects(this._tmpRay,q,L,B,N,h)}intersectsMeshes(R,q,L){L?L.length=0:L=[];for(let B=0;B<R.length;B++){const N=this.intersectsMesh(R[B],q);N.hit&&L.push(N)}return L.sort(this._comparePickingInfo),L}_comparePickingInfo(R,q){return R.distance<q.distance?-1:R.distance>q.distance?1:0}intersectionSegment(R,q,L){const B=this.origin,N=Z.h.o[0],h=Z.h.o[1],z=Z.h.o[2],Y=Z.h.o[3];q.subtractToRef(R,N),this.direction.scaleToRef(U._Rayl,z),B.addToRef(z,h),R.subtractToRef(B,Y);const F=Z.m.Dot(N,N),C=Z.m.Dot(N,z),e=Z.m.Dot(z,z),y=Z.m.Dot(N,Y),n=Z.m.Dot(z,Y),r=F*e-C*C;let p,c,d=r,f=r;r<U._Smallnum?(p=0,d=1,c=n,f=e):(p=C*n-e*y,c=F*n-C*y,p<0?(p=0,c=n,f=e):p>d&&(p=d,c=n+C,f=e)),c<0?(c=0,-y<0?p=0:-y>F?p=d:(p=-y,d=F)):c>f&&(c=f,-y+C<0?p=0:-y+C>F?p=d:(p=-y+C,d=F));const v=Math.abs(p)<U._Smallnum?0:p/d,T=Math.abs(c)<U._Smallnum?0:c/f,t=Z.h.o[4];z.scaleToRef(T,t);const D=Z.h.o[5];N.scaleToRef(v,D),D.addInPlace(Y);const S=Z.h.o[6];D.subtractToRef(t,S);return T>0&&T<=this.length&&S.lengthSquared()<L*L?D.length():-1}update(R,q,L,B,N,h,z){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){U._RayDistant||(U._RayDistant=U.Zero()),U._RayDistant.unprojectRayToRef(R,q,L,B,Z.c.IdentityReadOnly,h,z);const Y=Z.h.Matrix[0];N.invertToRef(Y),U.TransformToRef(U._RayDistant,Y,this)}else this.unprojectRayToRef(R,q,L,B,N,h,z);return this}static Zero(){return new U(Z.m.Zero(),Z.m.Zero())}static CreateNew(R,q,L,B,N,h,Z){return U.Zero().update(R,q,L,B,N,h,Z)}static CreateNewFromTo(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.c.IdentityReadOnly;const B=new U(new Z.m(0,0,0),new Z.m(0,0,0));return U.CreateFromToToRef(R,q,B,L)}static CreateFromToToRef(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.c.IdentityReadOnly;L.origin.p(R);const N=q.subtractToRef(R,L.direction),h=Math.sqrt(N.x*N.x+N.y*N.y+N.z*N.z);return L.length=h,L.direction.normalize(),U.TransformToRef(L,B,L)}static Transform(R,q){const L=new U(new Z.m(0,0,0),new Z.m(0,0,0));return U.TransformToRef(R,q,L),L}static TransformToRef(R,q,L){Z.m.TransformCoordinatesToRef(R.origin,q,L.origin),Z.m.TransformNormalToRef(R.direction,q,L.direction),L.length=R.length,L.epsilon=R.epsilon;const B=L.direction,N=B.length();if(0!==N&&1!==N){const R=1/N;B.x*=R,B.y*=R,B.z*=R,L.length*=N}return L}unprojectRayToRef(R,q,L,B,N,h,z){const Y=Z.h.Matrix[0];N.multiplyToRef(h,Y),Y.multiplyToRef(z,Y),Y.invert();const F=C.b.LastCreatedEngine,e=Z.h.o[0];e.x=R/L*2-1,e.y=-(q/B*2-1),e.z=null!==F&&void 0!==F&&F.useReverseDepthBuffer?1:null!==F&&void 0!==F&&F.isNDCHalfZRange?0:-1;const y=Z.h.o[1].Td(e.x,e.y,1-1e-8),U=Z.h.o[2],n=Z.h.o[3];Z.m._UnprojectFromInvertedMatrixToRef(e,Y,U),Z.m._UnprojectFromInvertedMatrixToRef(y,Y,n),this.origin.p(U),n.subtractToRef(U,this.direction),this.direction.normalize()}}function n(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Z=U.Zero();return r(R,q,L,B,Z,N,h),Z}function r(R,q,L,B,N,h){let z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const F=R.getEngine();if(!h&&!(h=R.activeCamera))return R;const C=h.viewport,e=F.getRenderHeight(),{x:y,y:U,width:n,height:r}=C.toGlobal(F.getRenderWidth(),e),p=1/F.getHardwareScalingLevel();return q=q*p-y,L=L*p-(e-U-r),N.update(q,L,n,r,B||Z.c.IdentityReadOnly,z?Z.c.IdentityReadOnly:h.getViewMatrix(),h.getProjectionMatrix(),Y),R}function p(R,q,L,B,N){if(!F.c)return R;const h=R.getEngine();if(!N&&!(N=R.activeCamera))throw new Error("Active camera not set");const z=N.viewport,Y=h.getRenderHeight(),{x:C,y:e,width:y,height:U}=z.toGlobal(h.getRenderWidth(),Y),n=Z.c.Identity(),r=1/h.getHardwareScalingLevel();return q=q*r-C,L=L*r-(Y-e-U),B.update(q,L,y,U,n,n,N.getProjectionMatrix()),R}function c(R,q,L,B,N,h,Z,z){const Y=q(B,L.enableDistantPicking),F=L.intersects(Y,N,Z,h,B,z);return F&&F.hit?!N&&null!=R&&F.distance>=R.distance?null:F:null}function d(R,q,L,B,N,h){let z=null;const Y=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),C=R.cameraToUseForPointers||R.activeCamera,e=y.internalPickerForMesh||c;for(let F=0;F<R.meshes.length;F++){const y=R.meshes[F];if(L){if(!L(y,-1))continue}else if(!y.isEnabled()||!y.isVisible||!y.ub)continue;const U=Y&&y.isWorldMatrixCameraDependent(),n=y.Jj(U,C);if(y.hasThinInstances&&y.thinInstanceEnablePicking){const R=e(z,q,y,n,!0,!0,h);if(R){if(N)return R;const Y=Z.h.Matrix[1],F=y.thinInstanceGetWorldMatrices();for(let R=0;R<F.length;R++){if(L&&!L(y,R))continue;F[R].multiplyToRef(n,Y);const Z=e(z,q,y,Y,B,N,h,!0);if(Z&&(z=Z,z.thinInstanceIndex=R,B))return z}}}else{const R=e(z,q,y,n,B,N,h);if(R&&(z=R,B))return z}}return z||new F.c}function f(R,q,L,B){if(!F.c)return null;const N=[],h=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),z=R.cameraToUseForPointers||R.activeCamera,Y=y.internalPickerForMesh||c;for(let F=0;F<R.meshes.length;F++){const C=R.meshes[F];if(L){if(!L(C,-1))continue}else if(!C.isEnabled()||!C.isVisible||!C.ub)continue;const e=h&&C.isWorldMatrixCameraDependent(),y=C.Jj(e,z);if(C.hasThinInstances&&C.thinInstanceEnablePicking){if(Y(null,q,C,y,!0,!0,B)){const R=Z.h.Matrix[1],h=C.thinInstanceGetWorldMatrices();for(let Z=0;Z<h.length;Z++){if(L&&!L(C,Z))continue;h[Z].multiplyToRef(y,R);const z=Y(null,q,C,R,!1,!1,B,!0);z&&(z.thinInstanceIndex=Z,N.push(z))}}}else{const R=Y(null,q,C,y,!1,!1,B);R&&N.push(R)}}return N}function v(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;B||(B=R.getWorldMatrix()),q.length=L,N?q.origin.p(N):q.origin.p(R.position);const h=Z.h.o[2];h.set(0,0,R._scene.useRightHandedSystem?-1:1);const z=Z.h.o[3];return Z.m.TransformNormalToRef(h,B,z),Z.m.NormalizeToRef(z,q.direction),q}var T,t;U._TmpVector3=(0,z.e)(6,Z.m.Zero),U._RayDistant=U.Zero(),U._Smallnum=1e-8,U._Rayl=1e9,T=B.b,(t=N.d)&&(t.prototype.getForwardRay=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;return v(this,new U(Z.m.Zero(),Z.m.Zero(),R),R,q,L)},t.prototype.getForwardRayToRef=function(R){return v(this,R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),T&&(e.d._IsPickingAvailable=!0,T.prototype.createPickingRay=function(R,q,L,B){return n(this,R,q,L,B,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),B.b.prototype.createPickingRayToRef=function(R,q,L,B,N){return r(this,R,q,L,B,N,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},B.b.prototype.createPickingRayInCameraSpace=function(R,q,L){return function(R,q,L,B){const N=U.Zero();return p(R,q,L,N,B),N}(this,R,q,L)},B.b.prototype.createPickingRayInCameraSpaceToRef=function(R,q,L,B){return p(this,R,q,L,B)},B.b.prototype.pickWithBoundingInfo=function(R,q,L,B,N){return function(R,q,L,B,N,h){if(!F.c)return null;const z=d(R,(B=>(R._tempPickingRay||(R._tempPickingRay=U.Zero()),r(R,q,L,B,R._tempPickingRay,h||null),R._tempPickingRay)),B,N,!0);return z&&(z.ray=n(R,q,L,Z.c.Identity(),h||null)),z}(this,R,q,L,B,N)},B.b.prototype.yc=function(R,q,L,B,N,h){return function(R,q,L,B,N,h,z){const Y=d(R,((B,N)=>(R._tempPickingRay||(R._tempPickingRay=U.Zero()),r(R,q,L,B,R._tempPickingRay,h||null,!1,N),R._tempPickingRay)),B,N,!1,z);return Y&&(Y.ray=n(R,q,L,Z.c.Identity(),h||null)),Y}(this,R,q,L,B,N,h)},B.b.prototype.pickWithRay=function(R,q,L,B){return function(R,q,L,B,N){const h=d(R,(L=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=Z.c.Identity()),L.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=U.Zero()),U.TransformToRef(q,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),L,B,!1,N);return h&&(h.ray=q),h}(this,R,q,L,B)},B.b.prototype.multiPick=function(R,q,L,B,N){return function(R,q,L,B,N,h){return f(R,(B=>n(R,q,L,B,N||null)),B,h)}(this,R,q,L,B,N)},B.b.prototype.multiPickWithRay=function(R,q,L){return function(R,q,L,B){return f(R,(L=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=Z.c.Identity()),L.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=U.Zero()),U.TransformToRef(q,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),L,B)}(this,R,q,L)}},11636:(R,q,L)=>{"use strict";var B=L(10867),N=L(10767),h=L(10805),Z=L(10898),z=L(10834),Y=L(10880);z.e.prototype._partialLoadFile=function(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(R,(R=>{L[q]=R,L._internalCount++,6===L._internalCount&&B(L)}),void 0,void 0,!0,((R,q)=>{N&&R&&N(R.status+" "+R.statusText,q)}))},z.e.prototype._cascadeLoadFiles=function(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=[];N._internalCount=0;for(let h=0;h<6;h++)this._partialLoadFile(L[h],h,N,q,B)},z.e.prototype._cascadeLoadImgs=function(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5?arguments[5]:void 0;const Z=[];Z._internalCount=0;for(let z=0;z<6;z++)this._partialLoadImg(B[z],z,Z,R,q,L,N,h)},z.e.prototype._partialLoadImg=function(R,q,L,B,N,z){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7?arguments[7]:void 0;const C=(0,Z.e)();(0,h.u)(R,(R=>{L[q]=R,L._internalCount++,B&&B.removePendingData(C),6===L._internalCount&&z&&z(N,L)}),((R,q)=>{B&&B.removePendingData(C),Y&&Y(R,q)}),B?B.offlineProvider:null,F),B&&B.addPendingData(C)},z.e.prototype.createCubeTextureBase=function(R,q,L,h){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,c=arguments.length>14&&void 0!==arguments[14]&&arguments[14],d=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const f=n||new B.b(this,7);f.isCube=!0,f.url=R,f.generateMipMaps=!h,f._lodGenerationScale=y,f._lodGenerationOffset=U,f._useSRGBBuffer=!!c&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!h),f!==n&&(f.label=R.substring(0,60)),this._doNotHandleContextLost||(f._extension=C,f._files=L,f._buffer=d);const v=R;this._transformTextureUrl&&!n&&(R=this._transformTextureUrl(R));const T=R.split("?")[0],t=T.lastIndexOf("."),D=C||(t>-1?T.substring(t).toLowerCase():""),S=(0,Y.c)(D),I=(B,Y)=>{R===v?z&&B&&z(B.status+" "+B.statusText,Y):(N.d.Warn(`Failed to load ${R}, falling back to the ${v}`),this.createCubeTextureBase(v,q,L,!!h,Z,z,F,C,e,y,U,f,r,p,c,d))};if(S)S.then((B=>{const h=R=>{r&&r(f,R),B.loadCubeData(R,f,e,Z,z)};d?h(d):L&&6===L.length?B.supportCascades?this._cascadeLoadFiles(q,(R=>h(R.map((R=>new Uint8Array(R))))),L,z):z?z("Textures type does not support cascades."):N.d.Warn("Texture loader does not support cascades."):this._loadFile(R,(R=>h(new Uint8Array(R))),void 0,void 0,!0,I)}));else{if(!L||0===L.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(q,f,((R,q)=>{p&&p(R,q)}),L,z)}return this._internalTexturesCache.push(f),f}},11557:(R,q,L)=>{"use strict";L(10834).e.prototype.createDepthStencilTexture=function(R,q,L){if(q.isCube){const L=R.width||R;return this._createDepthStencilCubeTexture(L,q)}return this._createDepthStencilTexture(R,q,L)}},11529:(R,q,L)=>{"use strict";L(11495).ThinEngine.prototype.setAlphaMode=function(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==R){switch(R){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}q||(this.depthCullingState.depthMask=0===R),this._alphaMode=R}else if(!q){const q=0===R;this.depthCullingState.depthMask!==q&&(this.depthCullingState.depthMask=q)}}},11488:(R,q,L)=>{"use strict";var B=L(11495);B.ThinEngine.prototype.updateDynamicIndexBuffer=function(R,q){let L;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(R),L=R.is32Bits?q instanceof Uint32Array?q:new Uint32Array(q):q instanceof Uint16Array?q:new Uint16Array(q),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,L,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},B.ThinEngine.prototype.updateDynamicVertexBuffer=function(R,q,L,B){this.bindArrayBuffer(R),void 0===L&&(L=0);const N=q.byteLength||q.length;void 0===B||B>=N&&0===L?q instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,L,new Float32Array(q)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,L,q):q instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(q).subarray(L,L+B)):(q=q instanceof ArrayBuffer?new Uint8Array(q,L,B):new Uint8Array(q.buffer,q.byteOffset+L,B),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,q)),this._resetVertexBufferBinding()}},11542:(R,q,L)=>{"use strict";var B=L(10867),N=L(10767),h=L(11495),Z=L(11548);class z extends Z.e{constructor(R,q,L,B,N){super(R,q,L,B),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=N}_cloneRenderTargetWrapper(){let R=null;return this._colorTextureArray&&this._depthStencilTextureArray?(R=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),R.texture.isReady=!0):R=super._cloneRenderTargetWrapper(),R}_swapRenderTargetWrapper(R){super._swapRenderTargetWrapper(R),R._framebuffer=this._framebuffer,R._depthStencilBuffer=this._depthStencilBuffer,R._MSAAFramebuffer=this._MSAAFramebuffer,R._colorTextureArray=this._colorTextureArray,R._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,h=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const R=this._engine,q=R._currentFramebuffer,L=this._context;R._bindUnboundFramebuffer(this._framebuffer),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_STENCIL_ATTACHMENT,L.RENDERBUFFER,null),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_ATTACHMENT,L.RENDERBUFFER,null),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.STENCIL_ATTACHMENT,L.RENDERBUFFER,null),R._bindUnboundFramebuffer(q),L.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(R,q,L,B,N,h)}shareDepth(R){super.shareDepth(R);const q=this._context,L=this._depthStencilBuffer,B=R._MSAAFramebuffer||R._framebuffer,N=this._engine;R._depthStencilBuffer&&R._depthStencilBuffer!==L&&q.deleteRenderbuffer(R._depthStencilBuffer),R._depthStencilBuffer=L;const h=R._generateStencilBuffer?q.DEPTH_STENCIL_ATTACHMENT:q.DEPTH_ATTACHMENT;N._bindUnboundFramebuffer(B),q.framebufferRenderbuffer(q.FRAMEBUFFER,h,q.RENDERBUFFER,L),N._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!R._hardwareTexture)return;const N=this._framebuffer,h=this._engine,Z=h._currentFramebuffer;if(h._bindUnboundFramebuffer(N),h.webGLVersion>1){const N=this._context,h=N["COLOR_ATTACHMENT"+q];var z;if(R.is2DArray||R.is3D)L=L??(null===(z=this.layerIndices)||void 0===z?void 0:z[q])??0,N.framebufferTextureLayer(N.FRAMEBUFFER,h,R._hardwareTexture.underlyingResource,B,L);else if(R.isCube){var Y;L=L??(null===(Y=this.faceIndices)||void 0===Y?void 0:Y[q])??0,N.framebufferTexture2D(N.FRAMEBUFFER,h,N.TEXTURE_CUBE_MAP_POSITIVE_X+L,R._hardwareTexture.underlyingResource,B)}else N.framebufferTexture2D(N.FRAMEBUFFER,h,N.TEXTURE_2D,R._hardwareTexture.underlyingResource,B)}else{const N=this._context,h=N["COLOR_ATTACHMENT"+q+"_WEBGL"],Z=void 0!==L?N.TEXTURE_CUBE_MAP_POSITIVE_X+L:N.TEXTURE_2D;N.framebufferTexture2D(N.FRAMEBUFFER,h,Z,R._hardwareTexture.underlyingResource,B)}h._bindUnboundFramebuffer(Z)}setTexture(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(R,q,L),this._bindTextureRenderTarget(R,q)}setLayerAndFaceIndices(R,q){var L;if(super.setLayerAndFaceIndices(R,q),!this.textures||!this.layerIndices||!this.faceIndices)return;const B=(null===(L=this._attachments)||void 0===L?void 0:L.length)??this.textures.length;for(let N=0;N<B;N++){const R=this.textures[N];R&&(R.is2DArray||R.is3D?this._bindTextureRenderTarget(R,N,this.layerIndices[N]):R.isCube?this._bindTextureRenderTarget(R,N,this.faceIndices[N]):this._bindTextureRenderTarget(R,N))}}setLayerAndFaceIndex(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(R,q,L),!this.textures||!this.layerIndices||!this.faceIndices)return;const B=this.textures[R];B.is2DArray||B.is3D?this._bindTextureRenderTarget(this.textures[R],R,this.layerIndices[R]):B.isCube&&this._bindTextureRenderTarget(this.textures[R],R,this.faceIndices[R])}dispose(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const q=this._context;R||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(q.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(q.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(q.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(R)}}L(11557);h.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(R,q,L){const B=new z(R,q,L,this,this._gl);return this._renderTargetWrapperCache.push(B),B},h.ThinEngine.prototype.createRenderTargetTexture=function(R,q){const L=this._createHardwareRenderTargetWrapper(!1,!1,R);let B,N,h=!0,Z=!1,z=!1,Y=1;void 0!==q&&"object"===typeof q&&(h=q.generateDepthBuffer??!0,Z=!!q.generateStencilBuffer,z=!!q.noColorAttachment,B=q.colorAttachment,Y=q.samples??1,N=q.label);const F=B||(z?null:this._createInternalTexture(R,q,!0,5)),C=R.width||R,e=R.height||R,y=this._currentFramebuffer,U=this._gl,n=U.createFramebuffer();if(this._bindUnboundFramebuffer(n),L._depthStencilBuffer=this._setupFramebufferDepthAttachments(Z,h,C,e),!F||F.is2DArray||F.is3D||U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,F._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(y),L.label=N??"RenderTargetWrapper",L._framebuffer=n,L._generateDepthBuffer=h,L._generateStencilBuffer=Z,L.setTextures(F),B){if(L._samples=B.samples,B.samples>1){const R=B._hardwareTexture.getMSAARenderBuffer(0);L._MSAAFramebuffer=U.createFramebuffer(),this._bindUnboundFramebuffer(L._MSAAFramebuffer),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.RENDERBUFFER,R),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(L,Y);return L},h.ThinEngine.prototype._createDepthStencilTexture=function(R,q,L){const h=this._gl,Z=R.layers||0,z=R.depth||0;let Y=h.TEXTURE_2D;0!==Z?Y=h.TEXTURE_2D_ARRAY:0!==z&&(Y=h.TEXTURE_3D);const F=new B.b(this,12);if(F.label=q.label,!this._caps.depthTextureExtension)return N.d.Error("Depth texture is not supported by your browser or hardware."),F;const C={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...q};if(this._bindTextureDirectly(Y,F,!0),this._setupDepthStencilTexture(F,R,0!==C.comparisonFunction&&C.bilinearFiltering,C.comparisonFunction,C.samples),void 0!==C.depthTextureFormat){if(15!==C.depthTextureFormat&&16!==C.depthTextureFormat&&17!==C.depthTextureFormat&&13!==C.depthTextureFormat&&14!==C.depthTextureFormat&&18!==C.depthTextureFormat)return N.d.Error(`Depth texture ${C.depthTextureFormat} format is not supported.`),F;F.format=C.depthTextureFormat}else F.format=C.generateStencil?13:16;const e=17===F.format||13===F.format||18===F.format;let y=h.UNSIGNED_INT;15===F.format?y=h.UNSIGNED_SHORT:17===F.format||13===F.format?y=h.UNSIGNED_INT_24_8:14===F.format?y=h.FLOAT:18===F.format&&(y=h.FLOAT_32_UNSIGNED_INT_24_8_REV);const U=e?h.DEPTH_STENCIL:h.DEPTH_COMPONENT,n=this._getInternalFormatFromDepthTextureFormat(F.format,!0,e);return F.is2DArray?h.texImage3D(Y,0,n,F.width,F.height,Z,0,U,y,null):F.is3D?h.texImage3D(Y,0,n,F.width,F.height,z,0,U,y,null):h.texImage2D(Y,0,n,F.width,F.height,0,U,y,null),this._bindTextureDirectly(Y,null),this._internalTexturesCache.push(F),L._depthStencilBuffer&&(h.deleteRenderbuffer(L._depthStencilBuffer),L._depthStencilBuffer=null),this._bindUnboundFramebuffer(L._MSAAFramebuffer??L._framebuffer),L._generateStencilBuffer=e,L._depthStencilTextureWithStencil=e,L._depthStencilBuffer=this._setupFramebufferDepthAttachments(L._generateStencilBuffer,L._generateDepthBuffer,L.width,L.height,L.samples,F.format),this._bindUnboundFramebuffer(null),F},h.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(R,q){var L;if(this.webGLVersion<2||!R)return 1;if(R.samples===q)return q;const B=this._gl;q=Math.min(q,this.getCaps().maxMSAASamples),R._depthStencilBuffer&&(B.deleteRenderbuffer(R._depthStencilBuffer),R._depthStencilBuffer=null),R._MSAAFramebuffer&&(B.deleteFramebuffer(R._MSAAFramebuffer),R._MSAAFramebuffer=null);const N=null===(L=R.texture)||void 0===L?void 0:L._hardwareTexture;if(null===N||void 0===N||N.releaseMSAARenderBuffers(),R.texture&&q>1&&"function"===typeof B.renderbufferStorageMultisample){const L=B.createFramebuffer();if(!L)throw new Error("Unable to create multi sampled framebuffer");R._MSAAFramebuffer=L,this._bindUnboundFramebuffer(R._MSAAFramebuffer);const h=this._createRenderBuffer(R.texture.width,R.texture.height,q,-1,this._getRGBABufferInternalSizedFormat(R.texture.type,R.texture.format,R.texture._useSRGBBuffer),B.COLOR_ATTACHMENT0,!1);if(!h)throw new Error("Unable to create multi sampled framebuffer");null===N||void 0===N||N.addMSAARenderBuffer(h)}this._bindUnboundFramebuffer(R._MSAAFramebuffer??R._framebuffer),R.texture&&(R.texture.samples=q),R._samples=q;const h=R._depthStencilTexture?R._depthStencilTexture.format:void 0;return R._depthStencilBuffer=this._setupFramebufferDepthAttachments(R._generateStencilBuffer,R._generateDepthBuffer,R.width,R.height,q,h),this._bindUnboundFramebuffer(null),q},h.ThinEngine.prototype._setupDepthStencilTexture=function(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const h=q.width??q,Z=q.height??q,z=q.layers||0,Y=q.depth||0;R.baseWidth=h,R.baseHeight=Z,R.width=h,R.height=Z,R.is2DArray=z>0,R.depth=z||Y,R.isReady=!0,R.samples=N,R.generateMipMaps=!1,R.samplingMode=L?2:1,R.type=0,R._comparisonFunction=B;const F=this._gl,C=this._getTextureTarget(R),e=this._getSamplingParameters(R.samplingMode,!1);F.texParameteri(C,F.TEXTURE_MAG_FILTER,e.mag),F.texParameteri(C,F.TEXTURE_MIN_FILTER,e.min),F.texParameteri(C,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(C,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===B?(F.texParameteri(C,F.TEXTURE_COMPARE_FUNC,515),F.texParameteri(C,F.TEXTURE_COMPARE_MODE,F.NONE)):(F.texParameteri(C,F.TEXTURE_COMPARE_FUNC,B),F.texParameteri(C,F.TEXTURE_COMPARE_MODE,F.COMPARE_REF_TO_TEXTURE)))}},10821:(R,q,L)=>{"use strict";L.d(q,{d:()=>S,g:()=>t,k:()=>D,m:()=>W,n:()=>H});class B{constructor(){this.children=[]}isValid(R){return!0}process(R,q){let L="";if(this.line){let F=this.line;const C=q.processor;if(C){var B,N,h,Z,z,Y;C.lineProcessor&&(F=C.lineProcessor(F,q.isFragment,q.processingContext));const L=(null===(B=q.processor)||void 0===B?void 0:B.attributeKeywordName)??"attribute",e=q.isFragment&&null!==(N=q.processor)&&void 0!==N&&N.varyingFragmentKeywordName?null===(h=q.processor)||void 0===h?void 0:h.varyingFragmentKeywordName:!q.isFragment&&null!==(Z=q.processor)&&void 0!==Z&&Z.varyingVertexKeywordName?null===(z=q.processor)||void 0===z?void 0:z.varyingVertexKeywordName:"varying";if(!q.isFragment&&C.attributeProcessor&&this.line.startsWith(L))F=C.attributeProcessor(this.line,R,q.processingContext);else if(C.varyingProcessor&&(null!==(Y=C.varyingCheck)&&void 0!==Y&&Y.call(C,this.line,q.isFragment)||!C.varyingCheck&&this.line.startsWith(e)))F=C.varyingProcessor(this.line,q.isFragment,R,q.processingContext);else if(C.uniformProcessor&&C.uniformRegexp&&C.uniformRegexp.test(this.line))q.lookForClosingBracketForUniformBuffer||(F=C.uniformProcessor(this.line,q.isFragment,R,q.processingContext));else if(C.uniformBufferProcessor&&C.uniformBufferRegexp&&C.uniformBufferRegexp.test(this.line))q.lookForClosingBracketForUniformBuffer||(F=C.uniformBufferProcessor(this.line,q.isFragment,q.processingContext),q.lookForClosingBracketForUniformBuffer=!0);else if(C.textureProcessor&&C.textureRegexp&&C.textureRegexp.test(this.line))F=C.textureProcessor(this.line,q.isFragment,R,q.processingContext);else if((C.uniformProcessor||C.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!q.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?C.uniformProcessor&&(F=C.uniformProcessor(this.line,q.isFragment,R,q.processingContext)):C.uniformBufferProcessor&&(F=C.uniformBufferProcessor(this.line,q.isFragment,q.processingContext),q.lookForClosingBracketForUniformBuffer=!0)}q.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(q.lookForClosingBracketForUniformBuffer=!1,C.endOfUniformBufferProcessor&&(F=C.endOfUniformBufferProcessor(this.line,q.isFragment,q.processingContext)))}L+=F+"\n"}return this.children.forEach((B=>{L+=B.process(R,q)})),this.additionalDefineKey&&(R[this.additionalDefineKey]=this.additionalDefineValue||"true"),L}}class N{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(R){this._lines.length=0;for(const q of R){if(!q||"\r"===q)continue;if("#"===q[0]){this._lines.push(q);continue}const R=q.trim();if(!R)continue;if(R.startsWith("//")){this._lines.push(q);continue}const L=R.indexOf(";");if(-1===L)this._lines.push(R);else if(L===R.length-1)R.length>1&&this._lines.push(R);else{const R=q.split(";");for(let q=0;q<R.length;q++){let L=R[q];L&&(L=L.trim(),L&&this._lines.push(L+(q!==R.length-1?";":"")))}}}}}class h extends B{process(R,q){for(let L=0;L<this.children.length;L++){const B=this.children[L];if(B.isValid(R))return B.process(R,q)}return""}}class Z extends B{isValid(R){return this.testExpression.isTrue(R)}}class z{isTrue(R){return!0}static postfixToInfix(R){const q=[];for(const L of R)if(void 0===z._OperatorPriority[L])q.push(L);else{const R=q[q.length-1],B=q[q.length-2];q.length-=2,q.push(`(${B}${L}${R})`)}return q[q.length-1]}static infixToPostfix(R){const q=z._InfixToPostfixCache.get(R);if(q)return q.accessTime=Date.now(),q.result;if(!R.includes("&&")&&!R.includes("||")&&!R.includes(")")&&!R.includes("("))return[R];const L=[];let B=-1;const N=()=>{C=C.trim(),""!==C&&(L.push(C),C="")},h=R=>{B<z._Stack.length-1&&(z._Stack[++B]=R)},Z=()=>z._Stack[B],Y=()=>-1===B?"!!INVALID EXPRESSION!!":z._Stack[B--];let F=0,C="";for(;F<R.length;){const q=R.charAt(F),e=F<R.length-1?R.substring(F,2+F):"";if("("===q)C="",h(q);else if(")"===q){for(N();-1!==B&&"("!==Z();)L.push(Y());Y()}else if(z._OperatorPriority[e]>1){for(N();-1!==B&&z._OperatorPriority[Z()]>=z._OperatorPriority[e];)L.push(Y());h(e),F++}else C+=q;F++}for(N();-1!==B;)"("===Z()?Y():L.push(Y());return z._InfixToPostfixCache.size>=z.InfixToPostfixCacheLimitSize&&z.ClearCache(),z._InfixToPostfixCache.set(R,{result:L,accessTime:Date.now()}),L}static ClearCache(){const R=Array.from(z._InfixToPostfixCache.entries()).sort(((R,q)=>R[1].accessTime-q[1].accessTime));for(let q=0;q<z.InfixToPostfixCacheCleanupSize;q++)z._InfixToPostfixCache.delete(R[q][0])}}z.InfixToPostfixCacheLimitSize=5e4,z.InfixToPostfixCacheCleanupSize=25e3,z._InfixToPostfixCache=new Map,z._OperatorPriority={")":0,"(":1,"||":2,"&&":3},z._Stack=["","","","","","","","","","","","","","","","","","","",""];class Y extends z{constructor(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=R,this.not=q}isTrue(R){let q=void 0!==R[this.define];return this.not&&(q=!q),q}}class F extends z{isTrue(R){return this.leftOperand.isTrue(R)||this.rightOperand.isTrue(R)}}class C extends z{isTrue(R){return this.leftOperand.isTrue(R)&&this.rightOperand.isTrue(R)}}class e extends z{constructor(R,q,L){super(),this.define=R,this.operand=q,this.testValue=L}isTrue(R){let q=R[this.define];void 0===q&&(q=this.define);let L=!1;const B=parseInt(q),N=parseInt(this.testValue);switch(this.operand){case">":L=B>N;break;case"<":L=B<N;break;case"<=":L=B<=N;break;case">=":L=B>=N;break;case"==":L=B===N;break;case"!=":L=B!==N}return L}}var y=L(10785),U=L(10829);const n=/defined\s*?\((.+?)\)/g,r=/defined\s*?\[(.+?)\]/g,p=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,c=/__decl__/,d=/light\{X\}.(\w*)/g,f=/\{X\}/g,v=[],T=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function t(R){R.processor&&R.processor.initializeShaders&&R.processor.initializeShaders(R.processingContext)}function D(R,q,L,B){var N;null!==(N=q.processor)&&void 0!==N&&N.preProcessShaderCode&&(R=q.processor.preProcessShaderCode(R,q.isFragment)),W(R,q,(R=>{q.processCodeAfterIncludes&&(R=q.processCodeAfterIncludes(q.isFragment?"fragment":"vertex",R,q.defines));const N=function(R,q,L){let B=function(R,q){var L;if(null!==(L=q.processor)&&void 0!==L&&L.noPrecision)return R;const B=q.shouldUseHighPrecisionShader;-1===R.indexOf("precision highp float")?R=B?"precision highp float;\n"+R:"precision mediump float;\n"+R:B||(R=R.replace("precision highp float","precision mediump float"));return R}(R,q);if(!q.processor)return B;if(0===q.processor.shaderLanguage&&-1!==B.indexOf("#version 3")&&(B=B.replace("#version 300 es",""),!q.processor.parseGLES3))return B;const N=q.defines,h=G(q,L);q.processor.preProcessor&&(B=q.processor.preProcessor(B,N,h,q.isFragment,q.processingContext));B=l(B,h,q),q.processor.postProcessor&&(B=q.processor.postProcessor(B,N,q.isFragment,q.processingContext,L?{drawBuffersExtensionDisabled:!L.getCaps().drawBuffersExtension}:{}));null!==L&&void 0!==L&&L._features.needShaderCodeInlining&&(B=L.inlineShaderCode(B));return B}(R,q,B);L(N,R)}))}function S(R,q,L){return L.processor&&L.processor.finalizeShaders?L.processor.finalizeShaders(R,q,L.processingContext):{vertexCode:R,fragmentCode:q}}function I(R){const q=/defined\((.+)\)/.exec(R);if(q&&q.length)return new Y(q[1].trim(),"!"===R[0]);const L=["==","!=",">=","<=","<",">"];let B="",N=0;for(B of L)if(N=R.indexOf(B),N>-1)break;if(-1===N)return new Y(R);const h=R.substring(0,N).trim(),Z=R.substring(N+B.length).trim();return new e(h,B,Z)}function K(R,q){const L=new Z,B=R.substring(0,q);let N=R.substring(q);return N=N.substring(0,(N.indexOf("//")+1||N.length+1)-1).trim(),L.testExpression="#ifdef"===B?new Y(N):"#ifndef"===B?new Y(N,!0):function(R){R=R.replace(n,"defined[$1]");const q=z.infixToPostfix(R),L=[];for(const N of q)if("||"!==N&&"&&"!==N)L.push(N);else if(L.length>=2){let R=L[L.length-1],q=L[L.length-2];L.length-=2;const B="&&"==N?new C:new F;"string"===typeof R&&(R=R.replace(r,"defined($1)")),"string"===typeof q&&(q=q.replace(r,"defined($1)")),B.leftOperand="string"===typeof q?I(q):q,B.rightOperand="string"===typeof R?I(R):R,L.push(B)}let B=L[L.length-1];return"string"===typeof B&&(B=B.replace(r,"defined($1)")),"string"===typeof B?I(B):B}(N),L}function m(R,q,L){let N=R.currentLine;for(;o(R,L);){N=R.currentLine;const h=N.substring(0,5).toLowerCase();if("#else"===h){const L=new B;return q.children.push(L),void o(R,L)}if("#elif"===h){const R=K(N,5);q.children.push(R),L=R}}}function o(R,q){for(;R.canRead;){R.lineIndex++;const L=R.currentLine;if(L.indexOf("#")>=0){const B=T.exec(L);if(B&&B.length){switch(B[0]){case"#ifdef":{const B=new h;q.children.push(B);const N=K(L,6);B.children.push(N),m(R,B,N);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const B=new h;q.children.push(B);const N=K(L,7);B.children.push(N),m(R,B,N);break}case"#if":{const B=new h,N=K(L,3);q.children.push(B),B.children.push(N),m(R,B,N);break}}continue}}const N=new B;if(N.line=L,q.children.push(N),"#"===L[0]&&"d"===L[1]){const R=L.replace(";","").split(" ");N.additionalDefineKey=R[1],3===R.length&&(N.additionalDefineValue=R[2])}}return!1}function l(R,q,L){const h=new B,Z=new N;return Z.lineIndex=-1,Z.lines=R.split("\n"),o(Z,h),h.process(q,L)}function G(R,q){var L;const B=R.defines,N={};for(const h of B){const R=h.replace("#define","").replace(";","").trim().split(" ");N[R[0]]=R.length>1?R[1]:""}return 0===(null===(L=R.processor)||void 0===L?void 0:L.shaderLanguage)&&(N.GL_ES="true"),N.__VERSION__=R.version,N[R.platformName]="true",(0,U.m)(N,null===q||void 0===q?void 0:q.isNDCHalfZRange,null===q||void 0===q?void 0:q.useReverseDepthBuffer,null===q||void 0===q?void 0:q.useExactSrgbConversions),N}function W(R,q,L){let B;for(v.length=0;null!==(B=p.exec(R));)v.push(B);let N=String(R),h=[R],Z=!1;for(const z of v){let R=z[1];if(-1!==R.indexOf("__decl__")&&(R=R.replace(c,""),q.supportsUniformBuffers&&(R=R.replace("Vertex","Ubo").replace("Fragment","Ubo")),R+="Declaration"),!q.includesShadersStore[R]){const B=q.shadersRepository+"ShadersInclude/"+R+".fx";return void H.loadFile(B,(B=>{q.includesShadersStore[R]=B,W(h.join(""),q,L)}))}{let L=q.includesShadersStore[R];if(z[2]){const R=z[3].split(",");for(let q=0;q<R.length;q+=2){const B=new RegExp(R[q],"g"),N=R[q+1];L=L.replace(B,N)}}if(z[4]){const R=z[5];if(-1!==R.indexOf("..")){const B=R.split(".."),N=parseInt(B[0]);let h=parseInt(B[1]),Z=L.slice(0);L="",isNaN(h)&&(h=q.indexParameters[B[1]]);for(let R=N;R<h;R++)q.supportsUniformBuffers||(Z=Z.replace(d,((R,q)=>q+"{X}"))),L+=Z.replace(f,R.toString())+"\n"}else q.supportsUniformBuffers||(L=L.replace(d,((R,q)=>q+"{X}"))),L=L.replace(f,R)}const B=[];for(const R of h){const q=R.split(z[0]);for(let R=0;R<q.length-1;R++)B.push(q[R]),B.push(L);B.push(q[q.length-1])}h=B,Z=Z||L.indexOf("#include<")>=0||L.indexOf("#include <")>=0}}v.length=0,N=h.join(""),Z?W(N.toString(),q,L):L(N)}const H={loadFile:(R,q,L,B,N,h)=>{throw(0,y.d)("FileTools")}}},11517:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});class B{get underlyingResource(){return this._webGLTexture}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=q,!R&&(R=q.createTexture(),!R))throw new Error("Unable to create webGL texture");this.set(R)}setUsage(){}set(R){this._webGLTexture=R}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(R){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(R)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const R of this._MSAARenderBuffers)this._context.deleteRenderbuffer(R);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var R;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._MSAARenderBuffers)||void 0===R?void 0:R[q])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10829:(R,q,L)=>{"use strict";L.d(q,{e:()=>N,i:()=>h,m:()=>z,q:()=>Z,s:()=>Y});var B=L(10785);L(10763);const N={};function h(R,q){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(q?q+"\n":"")+R}function Z(R,q,L,h,Z,z,Y){const F=Y||N.loadFile;if(F){return F(R,q,L,h,Z,z)}throw(0,B.d)("FileTools")}function z(R,q,L,B){if(R)return q?R.IS_NDC_HALF_ZRANGE="":delete R.IS_NDC_HALF_ZRANGE,L?R.USE_REVERSE_DEPTHBUFFER="":delete R.USE_REVERSE_DEPTHBUFFER,void(B?R.USE_EXACT_SRGB_CONVERSIONS="":delete R.USE_EXACT_SRGB_CONVERSIONS);{let R="";return q&&(R+="#define IS_NDC_HALF_ZRANGE"),L&&(R&&(R+="\n"),R+="#define USE_REVERSE_DEPTHBUFFER"),B&&(R&&(R+="\n"),R+="#define USE_EXACT_SRGB_CONVERSIONS"),R}}function Y(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;switch(R){case 3:{const R=(ArrayBuffer,new Int8Array(q));return B&&R.set(new Int8Array(B)),R}case 0:{const R=(ArrayBuffer,new Uint8Array(q));return B&&R.set(new Uint8Array(B)),R}case 4:{const R=q instanceof ArrayBuffer?new Int16Array(q):new Int16Array(L?q/2:q);return B&&R.set(new Int16Array(B)),R}case 5:case 8:case 9:case 10:case 2:{const R=q instanceof ArrayBuffer?new Uint16Array(q):new Uint16Array(L?q/2:q);return B&&R.set(new Uint16Array(B)),R}case 6:{const R=q instanceof ArrayBuffer?new Int32Array(q):new Int32Array(L?q/4:q);return B&&R.set(new Int32Array(B)),R}case 7:case 11:case 12:case 13:case 14:case 15:{const R=q instanceof ArrayBuffer?new Uint32Array(q):new Uint32Array(L?q/4:q);return B&&R.set(new Uint32Array(B)),R}case 1:{const R=q instanceof ArrayBuffer?new Float32Array(q):new Float32Array(L?q/4:q);return B&&R.set(new Float32Array(B)),R}}const N=(ArrayBuffer,new Uint8Array(q));return B&&N.set(new Uint8Array(B)),N}},10834:(R,q,L)=>{"use strict";L.d(q,{e:()=>f});var B=L(10797),N=L(10767),h=L(10837),Z=L(10864),z=L(10778);class Y{constructor(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,R&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(R){this._zOffset!==R&&(this._zOffset=R,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(R){this._zOffsetUnits!==R&&(this._zOffsetUnits=R,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(R){this._cullFace!==R&&(this._cullFace=R,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(R){this._cull!==R&&(this._cull=R,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(R){this._depthFunc!==R&&(this._depthFunc=R,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(R){this._depthMask!==R&&(this._depthMask=R,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(R){this._depthTest!==R&&(this._depthTest=R,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(R){this._frontFace!==R&&(this._frontFace=R,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(R){this.isDirty&&(this._isCullDirty&&(this.cull?R.enable(R.CULL_FACE):R.disable(R.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(R.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(R.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?R.enable(R.DEPTH_TEST):R.disable(R.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(R.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(R.enable(R.POLYGON_OFFSET_FILL),R.polygonOffset(this.zOffset,this.zOffsetUnits)):R.disable(R.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(R.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class F{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(R){this._func!==R&&(this._func=R,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(R){this._funcRef!==R&&(this._funcRef=R,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(R){this._funcMask!==R&&(this._funcMask=R,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(R){this._opStencilFail!==R&&(this._opStencilFail=R,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(R){this._opDepthFail!==R&&(this._opDepthFail=R,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(R){this._opStencilDepthPass!==R&&(this._opStencilDepthPass=R,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(R){this._mask!==R&&(this._mask=R,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(R){this._enabled!==R&&(this._enabled=R,this._isStencilTestDirty=!0)}constructor(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,R&&this.reset()}reset(){var R;this.stencilMaterial=void 0,null===(R=this.stencilGlobal)||void 0===R||R.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(R){var q;if(!R)return;const L=!this.useStencilGlobalOnly&&!(null===(q=this.stencilMaterial)||void 0===q||!q.enabled);this.enabled=L?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=L?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=L?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=L?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=L?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=L?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=L?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=L?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?R.enable(R.STENCIL_TEST):R.disable(R.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(R.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(R.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(R.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class C{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=C.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=C.KEEP,this.opDepthFail=C.KEEP,this.opStencilDepthPass=C.REPLACE}get stencilFunc(){return this.func}set stencilFunc(R){this.func=R}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(R){this.funcRef=R}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(R){this.funcMask=R}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(R){this.opStencilFail=R}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(R){this.opDepthFail=R}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(R){this.opStencilDepthPass=R}get stencilMask(){return this.mask}set stencilMask(R){this.mask=R}get stencilTest(){return this.enabled}set stencilTest(R){this.enabled=R}}C.ALWAYS=519,C.KEEP=7680,C.REPLACE=7681;class e{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(R){this._alphaBlend!==R&&(this._alphaBlend=R,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(R,q,L,B){this._blendConstants[0]===R&&this._blendConstants[1]===q&&this._blendConstants[2]===L&&this._blendConstants[3]===B||(this._blendConstants[0]=R,this._blendConstants[1]=q,this._blendConstants[2]=L,this._blendConstants[3]=B,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(R,q,L,B){this._blendFunctionParameters[0]===R&&this._blendFunctionParameters[1]===q&&this._blendFunctionParameters[2]===L&&this._blendFunctionParameters[3]===B||(this._blendFunctionParameters[0]=R,this._blendFunctionParameters[1]=q,this._blendFunctionParameters[2]=L,this._blendFunctionParameters[3]=B,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(R,q){this._blendEquationParameters[0]===R&&this._blendEquationParameters[1]===q||(this._blendEquationParameters[0]=R,this._blendEquationParameters[1]=q,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(R){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?R.enable(R.BLEND):R.disable(R.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(R.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(R.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(R.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var y=L(10785),U=L(10867),n=L(10763),r=L(10760),p=L(10829),c=L(10880);function d(R,q){if((0,n.i)()){const{requestAnimationFrame:L}=q||window;if("function"===typeof L)return L(R)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(R);return setTimeout(R,16)}class f{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(R){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(R){R!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=R,this._depthCullingState.depthFunc=R?518:515)}setColorWrite(R){R!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=R)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(R){if(R)return this.isNDCHalfZRange?R.IS_NDC_HALF_ZRANGE="":delete R.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?R.USE_REVERSE_DEPTHBUFFER="":delete R.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?R.USE_EXACT_SRGB_CONVERSIONS="":delete R.USE_EXACT_SRGB_CONVERSIONS);{let R="";return this.isNDCHalfZRange&&(R+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(R&&(R+="\n"),R+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(R&&(R+="\n"),R+="#define USE_EXACT_SRGB_CONVERSIONS"),R}}_rebuildInternalTextures(){const R=this._internalTexturesCache.slice();for(const q of R)q._rebuild()}_rebuildRenderTargetWrappers(){const R=this._renderTargetWrapperCache.slice();for(const q of R)q._rebuild()}_rebuildEffects(){for(const R in this._compiledEffects){const q=this._compiledEffects[R];q._pipelineContext=null,q._prepareEffect()}h.c.ResetCache()}_rebuildGraphicsResources(){var R;this.wipeCaches(!0),this._rebuildEffects(),null===(R=this._rebuildComputeEffects)||void 0===R||R.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){N.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(R){setTimeout((async()=>{this._clearEmptyResources();const q=this._depthCullingState.depthTest,L=this._depthCullingState.depthFunc,B=this._depthCullingState.depthMask,N=this._stencilState.stencilTest;await R(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=q,this._depthCullingState.depthFunc=L,this._depthCullingState.depthMask=B,this._stencilState.stencilTest=N,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(R){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(R){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const R=new Uint8Array(4),q=[R,R,R,R,R,R];this._emptyCubeTexture=this.createRawCubeTexture(q,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(R){if(!R)return this._activeRenderLoops.length=0,void this._cancelFrame();const q=this._activeRenderLoops.indexOf(R);q>=0&&(this._activeRenderLoops.splice(q,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const R=this._frameHandler;if(this._frameHandler=0,(0,n.i)()){const{cancelAnimationFrame:q}=this.getHostWindow()||window;if("function"===typeof q)return q(R)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(R);return clearTimeout(R)}}_i(){this.onBeginFrameObservable.notifyObservers(this)}aj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let R=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(R=!1),R&&(this._i(),this._renderViews()||this._renderFrame(),this.aj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let R=0;R<this._activeRenderLoops.length;R++){(0,this._activeRenderLoops[R])()}}_renderViews(){return!1}_queueNewFrame(R,q){return d(R,q)}runRenderLoop(R){-1===this._activeRenderLoops.indexOf(R)&&(this._activeRenderLoops.push(R),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(R){this._depthCullingState.depthTest=R}setZOffset(R){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-R:R}getZOffset(){const R=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-R:R}setZOffsetUnits(R){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-R:R}getZOffsetUnits(){const R=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-R:R}getHostWindow(){return(0,n.i)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(R){this._compatibilityMode=!0}_rebuildTextures(){for(const R of this.scenes)R._rebuildTextures();for(const R of this._virtualScenes)R._rebuildTextures()}_releaseRenderTargetWrapper(R){const q=this._renderTargetWrapperCache.indexOf(R);-1!==q&&this._renderTargetWrapperCache.splice(q,1)}get currentViewport(){return this._cachedViewport}setViewport(R,q,L){const B=q||this.getRenderWidth(),N=L||this.getRenderHeight(),h=R.x||0,Z=R.y||0;this._cachedViewport=R,this._viewport(h*B,Z*N,B*R.width,N*R.height)}createCanvasImage(){return document.createElement("img")}get description(){let R=this.name+this.version;return this._caps.parallelShaderCompile&&(R+=" - Parallel shader compilation"),R}_createTextureBase(R,q,L,h){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,p=arguments.length>13?arguments[13]:void 0,d=arguments.length>14?arguments[14]:void 0,v=arguments.length>15?arguments[15]:void 0;const T="data:"===(R=R||"").substr(0,5),t="blob:"===R.substr(0,5),D=T&&-1!==R.indexOf(";base64,"),S=y||new U.b(this,1);S!==y&&(S.label=R.substring(0,60));const I=R;!this._transformTextureUrl||D||y||e||(R=this._transformTextureUrl(R)),I!==R&&(S._originalUrl=I);const K=R.lastIndexOf(".");let m=r||(K>-1?R.substring(K).toLowerCase():"");m.indexOf("?")>-1&&(m=m.split("?")[0]);const o=(0,c.c)(m,p);h&&h.addPendingData(S),S.url=R,S.generateMipMaps=!q,S.samplingMode=Z,S.invertY=L,S._useSRGBBuffer=this._getUseSRGBBuffer(!!v,q),this._doNotHandleContextLost||(S._buffer=e);let l=null;z&&!y&&(l=S.onLoadedObservable.add(z)),y||this._internalTexturesCache.push(S);const G=(L,y)=>{h&&h.removePendingData(S),R===I?(l&&S.onLoadedObservable.remove(l),B.b.UseFallbackTexture&&R!==B.b.FallbackTexture&&this._createTextureBase(B.b.FallbackTexture,q,S.invertY,h,Z,null,Y,F,C,e,S),L=(L||"Unknown error")+(B.b.UseFallbackTexture?" - Fallback texture was used":""),S.onErrorObservable.notifyObservers({message:L,exception:y}),Y&&Y(L,y)):(N.d.Warn(`Failed to load ${R}, falling back to ${I}`),this._createTextureBase(I,q,S.invertY,h,Z,z,Y,F,C,e,S,n,r,p,d,v))};if(o){const q=async R=>{(await o).loadData(R,S,((R,q,L,B,N,z)=>{z?G("TextureLoader failed to load data"):F(S,m,h,{width:R,height:q},S.invertY,!L,B,(()=>(N(),!1)),Z)}),d)};e?e instanceof ArrayBuffer?q(new Uint8Array(e)):ArrayBuffer.isView(e)?q(e):Y&&Y("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(R,(R=>q(new Uint8Array(R))),void 0,h?h.offlineProvider:void 0,!0,((R,q)=>{G("Unable to load "+(R&&R.responseURL,q))}))}else{const L=R=>{t&&!this._doNotHandleContextLost&&(S._buffer=R),F(S,m,h,R,S.invertY,q,!1,C,Z)};!T||D?e&&("string"===typeof e.decoding||e.close)?L(e):f._FileToolsLoadImage(R||"",L,G,h?h.offlineProvider:null,p,S.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof e||e instanceof ArrayBuffer||ArrayBuffer.isView(e)||e instanceof Blob?f._FileToolsLoadImage(e,L,G,h?h.offlineProvider:null,p,S.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):e&&L(e)}return S}_rebuildBuffers(){for(const R of this._uniformBuffers)R._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,n.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const R in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,R)&&(this._boundTexturesCache[R]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(R){this._name=R}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(R){this._hardwareScalingLevel=R,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(R){this._doNotHandleContextLost=R}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(R,q,L){var N,h;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Y,this._stencilStateComposer=new F,this._stencilState=new C,this._alphaState=new e,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new r.b,this.onCanvasFocusObservable=new r.b,this.onNewSceneAddedObservable=new r.b,this.onResizeObservable=new r.b,this.onCanvasPointerOutObservable=new r.b,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new r.b,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new r.b,this.onAfterShaderCompilationObservable=new r.b,this.onBeginFrameObservable=new r.b,this.onEndFrameObservable=new r.b,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new r.b,this.onContextRestoredObservable=new r.b,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.ej=new r.b,B.b.Instances.push(this),this.startTime=z.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,Z.d.SetMatrixPrecision(!!q.useHighPrecisionMatrix),(0,n.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=L??!1,q.antialias=R??q.antialias,q.deterministicLockstep=q.deterministicLockstep??!1,q.lockstepMaxSteps=q.lockstepMaxSteps??4,q.timeStep=q.timeStep??1/60,q.audioEngine=q.audioEngine??!0,q.stencil=q.stencil??!0,this._audioContext=(null===(N=q.audioEngineOptions)||void 0===N?void 0:N.audioContext)??null,this._audioDestination=(null===(h=q.audioEngineOptions)||void 0===h?void 0:h.audioDestination)??null,this.premultipliedAlpha=q.premultipliedAlpha??!0,this._doNotHandleContextLost=!!q.doNotHandleContextLost,this._isStencilEnable=!!q.stencil,this.useExactSrgbConversions=q.useExactSrgbConversions??!1;const y=(0,n.i)()&&window.devicePixelRatio||1,U=q.limitDeviceRatio||y;L=L||q.adaptToDeviceRatio||!1,this._hardwareScalingLevel=L?1/Math.min(U,y):1,this._lastDevicePixelRatio=y,this._creationOptions=q}resize(){let R,q,L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const R=(0,n.i)()&&window.devicePixelRatio||1,q=this._lastDevicePixelRatio/R;this._lastDevicePixelRatio=R,this._hardwareScalingLevel*=q}if((0,n.i)()&&(0,n.f)())if(this._renderingCanvas){const L=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};R=this._renderingCanvas.clientWidth||L.width||this._renderingCanvas.width||100,q=this._renderingCanvas.clientHeight||L.height||this._renderingCanvas.height||100}else R=window.innerWidth,q=window.innerHeight;else R=this._renderingCanvas?this._renderingCanvas.width:100,q=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(R/this._hardwareScalingLevel,q/this._hardwareScalingLevel,L)}setSize(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(R|=0,q|=0,!L&&this._renderingCanvas.width===R&&this._renderingCanvas.height===q)return!1;if(this._renderingCanvas.width=R,this._renderingCanvas.height=q,this.scenes){for(let R=0;R<this.scenes.length;R++){const q=this.scenes[R];for(let R=0;R<q.cameras.length;R++){q.cameras[R]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(R,q,L,B,N,h,Z,z,Y,F,C){throw(0,y.d)("engine.rawTexture")}createRawCubeTexture(R,q,L,B,N,h,Z,z){throw(0,y.d)("engine.rawTexture")}createRawTexture3D(R,q,L,B,N,h,Z,z,Y,F,C){throw(0,y.d)("engine.rawTexture")}createRawTexture2DArray(R,q,L,B,N,h,Z,z,Y,F,C){throw(0,y.d)("engine.rawTexture")}_sharedInit(R){this._renderingCanvas=R}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const R=navigator.userAgent;this.hostInformation.isMobile=-1!==R.indexOf("Mobile")||-1!==R.indexOf("Mac")&&(0,n.f)()&&"ontouchend"in document},this._checkForMobile(),(0,n.i)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(R){return document.createElement("video")}_reportDrawCall(){var R;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(R=this._drawCalls)||void 0===R||R.addCount(q,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(R,q){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(R,q){return createImageBitmap(R,q)}resizeImageBitmap(R,q,L){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(R){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(R,q){if("undefined"===typeof document)return new OffscreenCanvas(R,q);const L=document.createElement("canvas");return L.width=R,L.height=q,L}createCanvas(R,q){return f._CreateCanvas(R,q)}static _FileToolsLoadImage(R,q,L,B,N,h){throw(0,y.d)("FileTools")}_loadFile(R,q,L,B,N,h){const Z=(0,p.q)(R,q,L,B,N,h);return this._activeRequests.push(Z),Z.onCompleteObservable.add((()=>{const R=this._activeRequests.indexOf(Z);-1!==R&&this._activeRequests.splice(R,1)})),Z}static _FileToolsLoadFile(R,q,L,B,N,h){if(p.e.loadFile)return p.e.loadFile(R,q,L,B,N,h);throw(0,y.d)("FileTools")}dispose(){var R;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(R=this.releaseComputeEffects)||void 0===R||R.call(this),h.c.ResetCache();for(const L of this._activeRequests)L.abort();this._boundRenderFunction=null,this.ej.notifyObservers(this),this.ej.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,n.i)()&&window.removeEventListener("resize",this._checkForMobile);const q=B.b.Instances.indexOf(this);q>=0&&B.b.Instances.splice(q,1),B.b.Instances.length||(B.b.OnEnginesDisposedObservable.notifyObservers(this),B.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(R){throw(0,y.d)("LoadingScreen")}static MarkAllMaterialsAsDirty(R,q){for(let L=0;L<B.b.Instances.length;L++){const N=B.b.Instances[L];for(let L=0;L<N.scenes.length;L++)N.scenes[L].markAllMaterialsAsDirty(R,q)}}}f._RenderPassIdCounter=0,f._RescalePostProcessFactory=null,f.CollisionsEpsilon=.001,f.QueueNewFrame=d},11537:(R,q,L)=>{"use strict";L.d(q,{d:()=>S});var B=L(10867),N=L(10797),h=L(11495),Z=L(10778);class z{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new Y(R)}sampleFrame(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const q=R-this._lastFrameTimeMs;this._rollingFrameTime.add(q)}this._lastFrameTimeMs=R}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const R=this._rollingFrameTime.history(0);return 0===R?0:1e3/R}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class Y{constructor(R){this._samples=new Array(R),this.reset()}add(R){let q;if(this.isSaturated()){const R=this._samples[this._pos];q=R-this.average,this.average-=q/(this._sampleCount-1),this._m2-=q*(R-this.average)}else this._sampleCount++;q=R-this.average,this.average+=q/this._sampleCount,this._m2+=q*(R-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=R,this._pos++,this._pos%=this._samples.length}history(R){if(R>=this._sampleCount||R>=this._samples.length)return 0;const q=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(q-R)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(R){const q=this._samples.length;return(R%q+q)%q}}var F=L(11511),C=L(10767),e=L(11517),y=(L(11529),L(10900));function U(R,q,L,B){let N,h=1;1===B?N=new Float32Array(q*L*4):2===B?(N=new Uint16Array(q*L*4),h=15360):N=7===B?new Uint32Array(q*L*4):new Uint8Array(q*L*4);for(let Z=0;Z<q;Z++)for(let B=0;B<L;B++){const L=3*(B*q+Z),z=4*(B*q+Z);N[z+0]=R[L+0],N[z+1]=R[L+1],N[z+2]=R[L+2],N[z+3]=h}return N}function n(R){return function(q,L,N,h,Z,z,Y,F){let C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const y=R?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,U=R?10:11,n=new B.b(this,U);n.baseWidth=L,n.baseHeight=N,n.baseDepth=h,n.width=L,n.height=N,n.depth=h,n.format=Z,n.type=e,n.generateMipMaps=z,n.samplingMode=F,R?n.is3D=!0:n.is2DArray=!0,this._doNotHandleContextLost||(n._bufferView=q),R?this.updateRawTexture3D(n,q,Z,Y,C,e):this.updateRawTexture2DArray(n,q,Z,Y,C,e),this._bindTextureDirectly(y,n,!0);const r=this._getSamplingParameters(F,z);return this._gl.texParameteri(y,this._gl.TEXTURE_MAG_FILTER,r.mag),this._gl.texParameteri(y,this._gl.TEXTURE_MIN_FILTER,r.min),z&&this._gl.generateMipmap(y),this._bindTextureDirectly(y,null),this._internalTexturesCache.push(n),n}}function r(R){return function(q,L,B,N){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const z=R?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,Y=this._getWebGLTextureType(Z),F=this._getInternalFormat(B),C=this._getRGBABufferInternalSizedFormat(Z,B);this._bindTextureDirectly(z,q,!0),this._unpackFlipY(void 0===N||!!N),this._doNotHandleContextLost||(q._bufferView=L,q.format=B,q.invertY=N,q._compression=h),q.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),h&&L?this._gl.compressedTexImage3D(z,0,this.getCaps().s3tc[h],q.width,q.height,q.depth,0,L):this._gl.texImage3D(z,0,C,q.width,q.height,q.depth,0,F,Y,L),q.generateMipMaps&&this._gl.generateMipmap(z),this._bindTextureDirectly(z,null),q.isReady=!0}}h.ThinEngine.prototype.updateRawTexture=function(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!R)return;const z=this._getRGBABufferInternalSizedFormat(h,L,Z),Y=this._getInternalFormat(L),F=this._getWebGLTextureType(h);this._bindTextureDirectly(this._gl.TEXTURE_2D,R,!0),this._unpackFlipY(void 0===B||!!B),this._doNotHandleContextLost||(R._bufferView=q,R.format=L,R.type=h,R.invertY=B,R._compression=N),R.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),N&&q?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[N],R.width,R.height,0,q):this._gl.texImage2D(this._gl.TEXTURE_2D,0,z,R.width,R.height,0,Y,F,q),R.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),R.isReady=!0},h.ThinEngine.prototype.createRawTexture=function(R,q,L,N,h,Z,z){let Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const e=new B.b(this,3);e.baseWidth=q,e.baseHeight=L,e.width=q,e.height=L,e.format=N,e.generateMipMaps=h,e.samplingMode=z,e.invertY=Z,e._compression=Y,e.type=F,e._useSRGBBuffer=this._getUseSRGBBuffer(C,!h),this._doNotHandleContextLost||(e._bufferView=R),this.updateRawTexture(e,R,N,Z,Y,F,e._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);const y=this._getSamplingParameters(z,h);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,y.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,y.min),h&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(e),e},h.ThinEngine.prototype.createRawCubeTexture=function(R,q,L,N,h,Z,z){let Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const F=this._gl,e=new B.b(this,8);e.isCube=!0,e.format=L,e.type=N,this._doNotHandleContextLost||(e._bufferViewArray=R);const U=this._getWebGLTextureType(N);let n=this._getInternalFormat(L);n===F.RGB&&(n=F.RGBA),U!==F.FLOAT||this._caps.textureFloatLinearFiltering?U!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?U!==F.FLOAT||this._caps.textureFloatRender?U!==F.HALF_FLOAT||this._caps.colorBufferFloat||(h=!1,C.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(h=!1,C.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(h=!1,z=1,C.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(h=!1,z=1,C.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const r=q,p=r;e.width=r,e.height=p,e.invertY=Z,e._compression=Y;if(!this.needPOTTextures||(0,y.f)(e.width)&&(0,y.f)(e.height)||(h=!1),R)this.updateRawCubeTexture(e,R,L,N,Z,Y);else{const R=this._getRGBABufferInternalSizedFormat(N),q=0;this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,e,!0);for(let L=0;L<6;L++)Y?F.compressedTexImage2D(F.TEXTURE_CUBE_MAP_POSITIVE_X+L,q,this.getCaps().s3tc[Y],e.width,e.height,0,void 0):F.texImage2D(F.TEXTURE_CUBE_MAP_POSITIVE_X+L,q,R,e.width,e.height,0,n,U,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),R&&h&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const c=this._getSamplingParameters(z,h);return F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MAG_FILTER,c.mag),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MIN_FILTER,c.min),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null),e.generateMipMaps=h,e.samplingMode=z,e.isReady=!0,e},h.ThinEngine.prototype.updateRawCubeTexture=function(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;R._bufferViewArray=q,R.format=L,R.type=B,R.invertY=N,R._compression=h;const z=this._gl,Y=this._getWebGLTextureType(B);let F=this._getInternalFormat(L);const C=this._getRGBABufferInternalSizedFormat(B);let e=!1;F===z.RGB&&(F=z.RGBA,e=!0),this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,R,!0),this._unpackFlipY(void 0===N||!!N),R.width%4!==0&&z.pixelStorei(z.UNPACK_ALIGNMENT,1);for(let y=0;y<6;y++){let L=q[y];h?z.compressedTexImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+y,Z,this.getCaps().s3tc[h],R.width,R.height,0,L):(e&&(L=U(L,R.width,R.height,B)),z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+y,Z,C,R.width,R.height,0,F,Y,L))}(!this.needPOTTextures||(0,y.f)(R.width)&&(0,y.f)(R.height))&&R.generateMipMaps&&0===Z&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),R.isReady=!0},h.ThinEngine.prototype.createRawCubeTextureFromUrl=function(R,q,L,B,N,h,Z,z){let Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,e=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const y=this._gl,n=this.createRawCubeTexture(null,L,B,N,!h,e,C,null);null===q||void 0===q||q.addPendingData(n),n.url=R,n.isReady=!1,this._internalTexturesCache.push(n);const r=R=>{const L=n.width,h=Z(R);if(h){if(z){const R=this._getWebGLTextureType(N);let q=this._getInternalFormat(B);const Z=this._getRGBABufferInternalSizedFormat(N);let Y=!1;q===y.RGB&&(q=y.RGBA,Y=!0),this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,n,!0),this._unpackFlipY(!1);const F=z(h);for(let B=0;B<F.length;B++){const h=L>>B;for(let L=0;L<6;L++){let z=F[B][L];Y&&(z=U(z,h,h,N)),y.texImage2D(L,B,Z,h,h,0,q,R,z)}}this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(n,h,B,N,e);n.isReady=!0,null===q||void 0===q||q.removePendingData(n),n.onLoadedObservable.notifyObservers(n),n.onLoadedObservable.clear(),Y&&Y()}};return this._loadFile(R,(R=>{r(R)}),void 0,null===q||void 0===q?void 0:q.offlineProvider,!0,((R,L)=>{null===q||void 0===q||q.removePendingData(n),F&&R&&F(R.status+" "+R.statusText,L)})),n},h.ThinEngine.prototype.createRawTexture2DArray=n(!1),h.ThinEngine.prototype.createRawTexture3D=n(!0),h.ThinEngine.prototype.updateRawTexture2DArray=r(!1),h.ThinEngine.prototype.updateRawTexture3D=r(!0);var p=L(10829);h.ThinEngine.prototype._readTexturePixelsSync=function(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const C=this._gl;if(!C)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const R=C.createFramebuffer();if(!R)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=R}var e,y;(C.bindFramebuffer(C.FRAMEBUFFER,this._dummyFramebuffer),B>-1)?C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+B,null===(e=R._hardwareTexture)||void 0===e?void 0:e.underlyingResource,N):C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,null===(y=R._hardwareTexture)||void 0===y?void 0:y.underlyingResource,N);let U=void 0!==R.type?this._getWebGLTextureType(R.type):C.UNSIGNED_BYTE;if(z)h||(h=(0,p.s)(R.type,4*q*L));else if(U===C.UNSIGNED_BYTE)h||(h=new Uint8Array(4*q*L)),U=C.UNSIGNED_BYTE;else h||(h=new Float32Array(4*q*L)),U=C.FLOAT;return Z&&this.flushFramebuffer(),C.readPixels(Y,F,q,L,C.RGBA,U,h),C.bindFramebuffer(C.FRAMEBUFFER,this._currentFramebuffer),h},h.ThinEngine.prototype._readTexturePixels=function(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(R,q,L,B,N,h,Z,z,Y,F))};L(11488);h.ThinEngine.prototype._createDepthStencilCubeTexture=function(R,q){const L=new B.b(this,12);if(L.isCube=!0,1===this.webGLVersion)return C.d.Error("Depth cube texture is not supported by WebGL 1."),L;const N={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...q},h=this._gl;this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,L,!0),this._setupDepthStencilTexture(L,R,N.bilinearFiltering,N.comparisonFunction);for(let B=0;B<6;B++)N.generateStencil?h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,h.DEPTH24_STENCIL8,R,R,0,h.DEPTH_STENCIL,h.UNSIGNED_INT_24_8,null):h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,h.DEPTH_COMPONENT24,R,R,0,h.DEPTH_COMPONENT,h.UNSIGNED_INT,null);return this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(L),L},h.ThinEngine.prototype._setCubeMapTextureParams=function(R,q,L){const B=this._gl;B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,q?B.LINEAR_MIPMAP_LINEAR:B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),R.samplingMode=q?3:2,q&&this.getCaps().textureMaxLevel&&void 0!==L&&L>0&&(B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAX_LEVEL,L),R._maxLodLevel=L),this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,null)},h.ThinEngine.prototype.createCubeTexture=function(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,n=arguments.length>13&&void 0!==arguments[13]&&arguments[13],r=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const p=this._gl;return this.createCubeTextureBase(R,q,L,!!B,N,h,Z,z,Y,F,e,U,(R=>this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,R,!0)),((R,q)=>{const L=this.needPOTTextures?(0,y.e)(q[0].width,this._caps.maxCubemapTextureSize):q[0].width,h=L,z=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,R,!0),this._unpackFlipY(!1);const Y=Z?this._getInternalFormat(Z,R._useSRGBBuffer):R._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:p.RGBA;let F=Z?this._getInternalFormat(Z):p.RGBA;R._useSRGBBuffer&&1===this.webGLVersion&&(F=Y);for(let B=0;B<z.length;B++)if(q[B].width!==L||q[B].height!==h){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void C.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=L,this._workingCanvas.height=h,this._workingContext.drawImage(q[B],0,0,q[B].width,q[B].height,0,0,L,h),p.texImage2D(z[B],0,Y,F,p.UNSIGNED_BYTE,this._workingCanvas)}else p.texImage2D(z[B],0,Y,F,p.UNSIGNED_BYTE,q[B]);B||p.generateMipmap(p.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(R,!B),R.width=L,R.height=h,R.isReady=!0,Z&&(R.format=Z),R.onLoadedObservable.notifyObservers(R),R.onLoadedObservable.clear(),N&&N()}),!!n,r)},h.ThinEngine.prototype.generateMipMapsForCubemap=function(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R.generateMipMaps){const L=this._gl;this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,R,!0),L.generateMipmap(L.TEXTURE_CUBE_MAP),q&&this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null)}};L(11542);h.ThinEngine.prototype.setDepthStencilTexture=function(R,q,L,B){void 0!==R&&(q&&(this._boundUniforms[R]=q),L&&L.depthStencilTexture?this._setTexture(R,L,!1,!0,B):this._setTexture(R,null,void 0,void 0,B))},h.ThinEngine.prototype.createRenderTargetCubeTexture=function(R,q){const L=this._createHardwareRenderTargetWrapper(!1,!0,R),N={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...q};N.generateStencilBuffer=N.generateDepthBuffer&&N.generateStencilBuffer,(1!==N.type||this._caps.textureFloatLinearFiltering)&&(2!==N.type||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=1);const h=this._gl,Z=new B.b(this,5);this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,Z,!0);const z=this._getSamplingParameters(N.samplingMode,N.generateMipMaps);1!==N.type||this._caps.textureFloat||(N.type=0,C.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,z.mag),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,z.min),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);for(let B=0;B<6;B++)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,this._getRGBABufferInternalSizedFormat(N.type,N.format),R,R,0,this._getInternalFormat(N.format),this._getWebGLTextureType(N.type),null);const Y=h.createFramebuffer();return this._bindUnboundFramebuffer(Y),L._depthStencilBuffer=this._setupFramebufferDepthAttachments(N.generateStencilBuffer,N.generateDepthBuffer,R,R),N.generateMipMaps&&h.generateMipmap(h.TEXTURE_CUBE_MAP),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),L._framebuffer=Y,L._generateDepthBuffer=N.generateDepthBuffer,L._generateStencilBuffer=N.generateStencilBuffer,Z.width=R,Z.height=R,Z.isReady=!0,Z.isCube=!0,Z.samples=1,Z.generateMipMaps=N.generateMipMaps,Z.samplingMode=N.samplingMode,Z.type=N.type,Z.format=N.format,this._internalTexturesCache.push(Z),L.setTextures(Z),L};var c=L(11562),d=L(11283),f=L(11587);h.ThinEngine.prototype.createPrefilteredCubeTexture=function(R,q,L,N){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(R,q,null,!1,(R=>{if(!R)return void(h&&h(null));const Z=R.texture;if(F?R.info.sphericalPolynomial&&(Z._sphericalPolynomial=R.info.sphericalPolynomial):Z._sphericalPolynomial=new c.d,Z._source=9,this.getCaps().textureLOD)return void(h&&h(Z));const z=this._gl,Y=R.width;if(!Y)return;const e=[];for(let h=0;h<3;h++){const F=1-h/2,y=N,U=Math.log2(Y)*L+N,n=y+(U-y)*F,r=Math.round(Math.min(Math.max(n,0),U)),p=new B.b(this,2);if(p.type=Z.type,p.format=Z.format,p.width=Math.pow(2,Math.max(Math.log2(Y)-r,0)),p.height=p.width,p.isCube=!0,p._cachedWrapU=0,p._cachedWrapV=0,this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,p,!0),p.samplingMode=2,z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),R.isDDS){const q=R.info,L=R.data;this._unpackFlipY(q.isCompressed),f.b.UploadDDSLevels(this,p,L,q,!0,6,r)}else C.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null);const c=new d.d(q);c._isCube=!0,c._texture=p,p.isReady=!0,e.push(c)}Z._lodTextureHigh=e[2],Z._lodTextureMid=e[1],Z._lodTextureLow=e[0],h&&h(Z)}),Z,z,Y,F,L,N)},h.ThinEngine.prototype.createUniformBuffer=function(R,q){const L=this._gl.createBuffer();if(!L)throw new Error("Unable to create uniform buffer");const B=new F.d(L);return this.bindUniformBuffer(B),R instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,R,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(R),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),B.references=1,B},h.ThinEngine.prototype.createDynamicUniformBuffer=function(R,q){const L=this._gl.createBuffer();if(!L)throw new Error("Unable to create dynamic uniform buffer");const B=new F.d(L);return this.bindUniformBuffer(B),R instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,R,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(R),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),B.references=1,B},h.ThinEngine.prototype.updateUniformBuffer=function(R,q,L,B){this.bindUniformBuffer(R),void 0===L&&(L=0),void 0===B?q instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,L,q):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,L,new Float32Array(q)):q instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,q.subarray(L,L+B)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(q).subarray(L,L+B)),this.bindUniformBuffer(null)},h.ThinEngine.prototype.bindUniformBuffer=function(R){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,R?R.underlyingResource:null)},h.ThinEngine.prototype.bindUniformBufferBase=function(R,q,L){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,q,R?R.underlyingResource:null)},h.ThinEngine.prototype.bindUniformBlock=function(R,q,L){const B=R.program,N=this._gl.getUniformBlockIndex(B,q);4294967295!==N&&this._gl.uniformBlockBinding(B,N,L)};var v=L(10763),T=L(10834);T.e.prototype.displayLoadingUI=function(){if(!(0,v.i)())return;const R=this.loadingScreen;R&&R.displayLoadingUI()},T.e.prototype.hideLoadingUI=function(){if(!(0,v.i)())return;const R=this._loadingScreen;R&&R.hideLoadingUI()},Object.defineProperty(T.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=T.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(R){this._loadingScreen=R},enumerable:!0,configurable:!0}),Object.defineProperty(T.e.prototype,"loadingUIText",{set:function(R){this.loadingScreen.loadingUIText=R},enumerable:!0,configurable:!0}),Object.defineProperty(T.e.prototype,"loadingUIBackgroundColor",{set:function(R){this.loadingScreen.loadingUIBackgroundColor=R},enumerable:!0,configurable:!0}),T.e.prototype.getInputElement=function(){return this._renderingCanvas},T.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},T.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},T.e.prototype.getAspectRatio=function(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=R.viewport;return this.getRenderWidth(q)*L.width/(this.getRenderHeight(q)*L.height)},T.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},T.e.prototype._verifyPointerLock=function(){var R;null===(R=this._onPointerLockChange)||void 0===R||R.call(this)},T.e.prototype.setAlphaEquation=function(R){if(this._alphaEquation!==R){switch(R){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=R}},T.e.prototype.getInputElement=function(){return this._renderingCanvas},T.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},T.e.prototype.setDepthFunction=function(R){this._depthCullingState.depthFunc=R},T.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},T.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},T.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},T.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},T.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},T.e.prototype.setDepthWrite=function(R){this._depthCullingState.depthMask=R},T.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},T.e.prototype.setStencilBuffer=function(R){this._stencilState.stencilTest=R},T.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},T.e.prototype.setStencilMask=function(R){this._stencilState.stencilMask=R},T.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},T.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},T.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},T.e.prototype.setStencilFunction=function(R){this._stencilState.stencilFunc=R},T.e.prototype.setStencilFunctionReference=function(R){this._stencilState.stencilFuncRef=R},T.e.prototype.setStencilFunctionMask=function(R){this._stencilState.stencilFuncMask=R},T.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},T.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},T.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},T.e.prototype.setStencilOperationFail=function(R){this._stencilState.stencilOpStencilFail=R},T.e.prototype.setStencilOperationDepthFail=function(R){this._stencilState.stencilOpDepthFail=R},T.e.prototype.setStencilOperationPass=function(R){this._stencilState.stencilOpStencilDepthPass=R},T.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},T.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},T.e.prototype.setAlphaConstants=function(R,q,L,B){this._alphaState.setAlphaBlendConstants(R,q,L,B)},T.e.prototype.getAlphaMode=function(){return this._alphaMode},T.e.prototype.getAlphaEquation=function(){return this._alphaEquation},T.e.prototype.getRenderPassNames=function(){return this._renderPassNames},T.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},T.e.prototype.createRenderPassId=function(R){const q=++T.e._RenderPassIdCounter;return this._renderPassNames[q]=R??"NONAME",q},T.e.prototype.releaseRenderPassId=function(R){this._renderPassNames[R]=void 0;for(let q=0;q<this.scenes.length;++q){const L=this.scenes[q];for(let q=0;q<L.meshes.length;++q){const B=L.meshes[q];if(B.Zf)for(let q=0;q<B.Zf.length;++q){B.Zf[q]._removeDrawWrapper(R)}}}};L(11557);function t(R){if(R.requestPointerLock){const q=R.requestPointerLock();q instanceof Promise?q.then((()=>{R.focus()})).catch((()=>{})):R.focus()}}var D=L(10909);L(11645);class S extends h.ThinEngine{static get NpmPackage(){return T.e.NpmPackage}static get Version(){return T.e.Version}static get Instances(){return N.b.Instances}static get LastCreatedEngine(){return N.b.LastCreatedEngine}static get LastCreatedScene(){return N.b.LastCreatedScene}static DefaultLoadingScreenFactory(R){return T.e.DefaultLoadingScreenFactory(R)}get _supportsHardwareTextureRescaling(){return!!S._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(R,q,L){if(super(R,q,L,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new z,this._drawCalls=new D.d,R&&(this._features.supportRenderPasses=!0,L=this._creationOptions,R.getContext)){const q=R;this._sharedInit(q)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(R){super._sharedInit(R),function(R,q,L){R._onCanvasFocus=()=>{R.onCanvasFocusObservable.notifyObservers(R)},R._onCanvasBlur=()=>{R.onCanvasBlurObservable.notifyObservers(R)},R._onCanvasContextMenu=q=>{R.disableContextMenu&&q.preventDefault()},q.addEventListener("focus",R._onCanvasFocus),q.addEventListener("blur",R._onCanvasBlur),q.addEventListener("contextmenu",R._onCanvasContextMenu),R._onBlur=()=>{R.disablePerformanceMonitorInBackground&&R.performanceMonitor.disable(),R._windowIsBackground=!0},R._onFocus=()=>{R.disablePerformanceMonitorInBackground&&R.performanceMonitor.enable(),R._windowIsBackground=!1},R._onCanvasPointerOut=L=>{document.elementFromPoint(L.clientX,L.clientY)!==q&&R.onCanvasPointerOutObservable.notifyObservers(L)};const B=R.getHostWindow();B&&"function"===typeof B.addEventListener&&(B.addEventListener("blur",R._onBlur),B.addEventListener("focus",R._onFocus)),q.addEventListener("pointerout",R._onCanvasPointerOut),L.doNotHandleTouchAction||function(R){R&&R.setAttribute&&(R.setAttribute("touch-action","none"),R.style.touchAction="none",R.style.webkitTapHighlightColor="transparent")}(q),!T.e.audioEngine&&L.audioEngine&&T.e.AudioEngineFactory&&(T.e.audioEngine=T.e.AudioEngineFactory(R.getRenderingCanvas(),R.getAudioContext(),R.getAudioDestination())),(0,v.f)()&&(R._onFullscreenChange=()=>{R.isFullscreen=!!document.fullscreenElement,R.isFullscreen&&R._pointerLockRequested&&q&&t(q)},document.addEventListener("fullscreenchange",R._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",R._onFullscreenChange,!1),R._onPointerLockChange=()=>{R.isPointerLock=document.pointerLockElement===q},document.addEventListener("pointerlockchange",R._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",R._onPointerLockChange,!1)),R.enableOfflineSupport=void 0!==T.e.OfflineProviderFactory,R._deterministicLockstep=!!L.deterministicLockstep,R._lockstepMaxSteps=L.lockstepMaxSteps||0,R._timeStep=L.timeStep||1/60}(this,R,this._creationOptions)}resizeImageBitmap(R,q,L){return function(R,q,L,B){const N=R.createCanvas(L,B).getContext("2d");if(!N)throw new Error("Unable to get 2d context for resizeImageBitmap");return N.drawImage(q,0,0),N.getImageData(0,0,L,B).data}(this,R,q,L)}_createImageBitmapFromSource(R,q){return function(R,q,L){return new Promise(((B,N)=>{const h=new Image;h.onload=()=>{h.decode().then((()=>{R.createImageBitmap(h,L).then((R=>{B(R)}))}))},h.onerror=()=>{N(`Error loading image ${h.src}`)},h.src=q}))}(this,R,q)}switchFullscreen(R){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(R)}enterFullscreen(R){this.isFullscreen||(this._pointerLockRequested=R,this._renderingCanvas&&function(R){const q=R.requestFullscreen||R.webkitRequestFullscreen;q&&q.call(R)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const R=document;document.exitFullscreen?document.exitFullscreen():R.webkitCancelFullScreen&&R.webkitCancelFullScreen()}()}setDitheringState(R){R?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(R){R?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(R,q,L,B){const N=this._cachedViewport;return this._cachedViewport=null,this._viewport(R,q,L,B),N}scissorClear(R,q,L,B,N){this.enableScissor(R,q,L,B),this.clear(N,!0,!0,!0),this.disableScissor()}enableScissor(R,q,L,B){const N=this._gl;N.enable(N.SCISSOR_TEST),N.scissor(R,q,L,B)}disableScissor(){const R=this._gl;R.disable(R.SCISSOR_TEST)}_loadFileAsync(R,q,L){return new Promise(((B,N)=>{this._loadFile(R,(R=>{B(R)}),void 0,q,L,((R,q)=>{N(q)}))}))}getVertexShaderSource(R){const q=this._gl.getAttachedShaders(R);return q?this._gl.getShaderSource(q[0]):null}getFragmentShaderSource(R){const q=this._gl.getAttachedShaders(R);return q?this._gl.getShaderSource(q[1]):null}set framebufferDimensionsObject(R){this._framebufferDimensionsObject=R,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const R of this.scenes)R.resetCachedMaterial(),R._rebuildGeometries();for(const R of this._virtualScenes)R.resetCachedMaterial(),R._rebuildGeometries();super._rebuildBuffers()}getFontOffset(R){return function(R){const q=document.createElement("span");q.textContent="Hg",q.style.font=R;const L=document.createElement("div");L.style.display="inline-block",L.style.width="1px",L.style.height="0px",L.style.verticalAlign="bottom";const B=document.createElement("div");B.style.whiteSpace="nowrap",B.appendChild(q),B.appendChild(L),document.body.appendChild(B);let N=0,h=0;try{h=L.getBoundingClientRect().top-q.getBoundingClientRect().top,L.style.verticalAlign="baseline",N=L.getBoundingClientRect().top-q.getBoundingClientRect().top}finally{document.body.removeChild(B)}return{ascent:N,height:h,descent:h-N}}(R)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:R}=this.customAnimationFrameRequester;R&&R(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let R=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(R=!1),R&&(this._i(),this._renderViews()||this._renderFrame(),this.aj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&t(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}_i(){this._measureFps(),super._i()}_deletePipelineContext(R){const q=R;q&&q.program&&q.transformFeedback&&(this.deleteTransformFeedback(q.transformFeedback),q.transformFeedback=null),super._deletePipelineContext(R)}createShaderProgram(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;N=N||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const Z=super.createShaderProgram(R,q,L,B,N,h);return this.onAfterShaderCompilationObservable.notifyObservers(this),Z}_createShaderProgram(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=B.createProgram();if(R.program=h,!h)throw new Error("Unable to create program");if(B.attachShader(h,q),B.attachShader(h,L),this.webGLVersion>1&&N){const q=this.createTransformFeedback();this.bindTransformFeedback(q),this.setTranformFeedbackVaryings(h,N),R.transformFeedback=q}return B.linkProgram(h),this.webGLVersion>1&&N&&this.bindTransformFeedback(null),R.context=B,R.vertexShader=q,R.fragmentShader=L,R.isParallelCompiled||this._finalizePipelineContext(R),h}_releaseTexture(R){super._releaseTexture(R)}_releaseRenderTargetWrapper(R){super._releaseRenderTargetWrapper(R),this.scenes.forEach((q=>{q.postProcesses.forEach((q=>{q._outputTexture===R&&(q._outputTexture=null)})),q.cameras.forEach((q=>{q._postProcesses.forEach((q=>{q&&q._outputTexture===R&&(q._outputTexture=null)}))}))}))}_rescaleTexture(R,q,L,B,N){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const h=this.createRenderTargetTexture({width:q.width,height:q.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&S._RescalePostProcessFactory&&(this._rescalePostProcess=S._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const Z=()=>{this._rescalePostProcess.onApply=function(q){q._bindTexture("textureSampler",R)};let Z=L;Z||(Z=this.scenes[this.scenes.length-1]),Z.postProcessManager.directRender([this._rescalePostProcess],h,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,B,0,0,q.width,q.height,0),this.unBindFramebuffer(h),h.dispose(),N&&N()},z=this._rescalePostProcess.getEffect();z?z.executeWhenCompiled(Z):this._rescalePostProcess.onEffectCreatedObservable.addOnce((R=>{R.executeWhenCompiled(Z)}))}}wrapWebGLTexture(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const Z=new e.d(R,this._gl),z=new B.b(this,0,!0);return z._hardwareTexture=Z,z.baseWidth=N,z.baseHeight=h,z.width=N,z.height=h,z.isReady=!0,z.useMipMaps=q,this.updateTextureSamplingMode(L,z),z}_uploadImageToTexture(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=this._gl,h=this._getWebGLTextureType(R.type),Z=this._getInternalFormat(R.format),z=this._getRGBABufferInternalSizedFormat(R.type,Z),Y=R.isCube?N.TEXTURE_CUBE_MAP:N.TEXTURE_2D;this._bindTextureDirectly(Y,R,!0),this._unpackFlipY(R.invertY);let F=N.TEXTURE_2D;R.isCube&&(F=N.TEXTURE_CUBE_MAP_POSITIVE_X+L),N.texImage2D(F,B,z,Z,h,q),this._bindTextureDirectly(Y,null,!0)}updateTextureComparisonFunction(R,q){if(1===this.webGLVersion)return void C.d.Error("WebGL 1 does not support texture comparison.");const L=this._gl;R.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,R,!0),0===q?(L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_FUNC,515),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_MODE,L.NONE)):(L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_FUNC,q),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_MODE,L.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,R,!0),0===q?(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_FUNC,515),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_MODE,L.NONE)):(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_FUNC,q),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_MODE,L.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),R._comparisonFunction=q}createInstancesBuffer(R){const q=this._gl.createBuffer();if(!q)throw new Error("Unable to create instance buffer");const L=new F.d(q);return L.nb=R,this.bindArrayBuffer(L),this._gl.bufferData(this._gl.ARRAY_BUFFER,R,this._gl.DYNAMIC_DRAW),L.references=1,L}deleteInstancesBuffer(R){this._gl.deleteBuffer(R)}_clientWaitAsync(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const B=this._gl;return new Promise(((N,h)=>{const Z=()=>{const z=B.clientWaitSync(R,q,0);z!=B.WAIT_FAILED?z!=B.TIMEOUT_EXPIRED?N():setTimeout(Z,L):h()};Z()}))}_readPixelsAsync(R,q,L,B,N,h,Z){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const z=this._gl,Y=z.createBuffer();z.bindBuffer(z.PIXEL_PACK_BUFFER,Y),z.bufferData(z.PIXEL_PACK_BUFFER,Z.byteLength,z.STREAM_READ),z.readPixels(R,q,L,B,N,h,0),z.bindBuffer(z.PIXEL_PACK_BUFFER,null);const F=z.fenceSync(z.SYNC_GPU_COMMANDS_COMPLETE,0);return F?(z.flush(),this._clientWaitAsync(F,0,10).then((()=>(z.deleteSync(F),z.bindBuffer(z.PIXEL_PACK_BUFFER,Y),z.getBufferSubData(z.PIXEL_PACK_BUFFER,0,Z),z.bindBuffer(z.PIXEL_PACK_BUFFER,null),z.deleteBuffer(Y),Z)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(R,q){1===N.b.Instances.length&&T.e.audioEngine&&(T.e.audioEngine.dispose(),T.e.audioEngine=null);const L=R.getHostWindow();L&&"function"===typeof L.removeEventListener&&(L.removeEventListener("blur",R._onBlur),L.removeEventListener("focus",R._onFocus)),q&&(q.removeEventListener("focus",R._onCanvasFocus),q.removeEventListener("blur",R._onCanvasBlur),q.removeEventListener("pointerout",R._onCanvasPointerOut),q.removeEventListener("contextmenu",R._onCanvasContextMenu)),(0,v.f)()&&(document.removeEventListener("fullscreenchange",R._onFullscreenChange),document.removeEventListener("mozfullscreenchange",R._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",R._onFullscreenChange),document.removeEventListener("msfullscreenchange",R._onFullscreenChange),document.removeEventListener("pointerlockchange",R._onPointerLockChange),document.removeEventListener("mspointerlockchange",R._onPointerLockChange),document.removeEventListener("mozpointerlockchange",R._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",R._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}S.ALPHA_DISABLE=0,S.ALPHA_ADD=1,S.ALPHA_COMBINE=2,S.ALPHA_SUBTRACT=3,S.ALPHA_MULTIPLY=4,S.ALPHA_MAXIMIZED=5,S.ALPHA_ONEONE=6,S.ALPHA_PREMULTIPLIED=7,S.ALPHA_PREMULTIPLIED_PORTERDUFF=8,S.ALPHA_INTERPOLATE=9,S.ALPHA_SCREENMODE=10,S.DELAYLOADSTATE_NONE=0,S.DELAYLOADSTATE_LOADED=1,S.DELAYLOADSTATE_LOADING=2,S.DELAYLOADSTATE_NOTLOADED=4,S.NEVER=512,S.ALWAYS=519,S.LESS=513,S.EQUAL=514,S.LEQUAL=515,S.GREATER=516,S.GEQUAL=518,S.NOTEQUAL=517,S.KEEP=7680,S.REPLACE=7681,S.INCR=7682,S.DECR=7683,S.INVERT=5386,S.INCR_WRAP=34055,S.DECR_WRAP=34056,S.TEXTURE_CLAMP_ADDRESSMODE=0,S.TEXTURE_WRAP_ADDRESSMODE=1,S.TEXTURE_MIRROR_ADDRESSMODE=2,S.TEXTUREFORMAT_ALPHA=0,S.TEXTUREFORMAT_LUMINANCE=1,S.TEXTUREFORMAT_LUMINANCE_ALPHA=2,S.TEXTUREFORMAT_RGB=4,S.TEXTUREFORMAT_RGBA=5,S.TEXTUREFORMAT_RED=6,S.TEXTUREFORMAT_R=6,S.TEXTUREFORMAT_RG=7,S.TEXTUREFORMAT_RED_INTEGER=8,S.TEXTUREFORMAT_R_INTEGER=8,S.TEXTUREFORMAT_RG_INTEGER=9,S.TEXTUREFORMAT_RGB_INTEGER=10,S.TEXTUREFORMAT_RGBA_INTEGER=11,S.TEXTURETYPE_UNSIGNED_BYTE=0,S.TEXTURETYPE_UNSIGNED_INT=0,S.TEXTURETYPE_FLOAT=1,S.TEXTURETYPE_HALF_FLOAT=2,S.TEXTURETYPE_BYTE=3,S.TEXTURETYPE_SHORT=4,S.TEXTURETYPE_UNSIGNED_SHORT=5,S.TEXTURETYPE_INT=6,S.TEXTURETYPE_UNSIGNED_INTEGER=7,S.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,S.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,S.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,S.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,S.TEXTURETYPE_UNSIGNED_INT_24_8=12,S.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,S.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,S.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,S.TEXTURE_NEAREST_SAMPLINGMODE=1,S.TEXTURE_BILINEAR_SAMPLINGMODE=2,S.TEXTURE_TRILINEAR_SAMPLINGMODE=3,S.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,S.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,S.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,S.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,S.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,S.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,S.TEXTURE_NEAREST_LINEAR=7,S.TEXTURE_NEAREST_NEAREST=1,S.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,S.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,S.TEXTURE_LINEAR_LINEAR=2,S.TEXTURE_LINEAR_NEAREST=12,S.TEXTURE_EXPLICIT_MODE=0,S.TEXTURE_SPHERICAL_MODE=1,S.TEXTURE_PLANAR_MODE=2,S.TEXTURE_CUBIC_MODE=3,S.TEXTURE_PROJECTION_MODE=4,S.TEXTURE_SKYBOX_MODE=5,S.TEXTURE_INVCUBIC_MODE=6,S.TEXTURE_EQUIRECTANGULAR_MODE=7,S.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,S.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,S.SCALEMODE_FLOOR=1,S.SCALEMODE_NEAREST=2,S.SCALEMODE_CEILING=3},10797:(R,q,L)=>{"use strict";L.d(q,{b:()=>N});var B=L(10760);class N{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}N.Instances=[],N.OnEnginesDisposedObservable=new B.b,N._LastCreatedScene=null,N.UseFallbackTexture=!0,N.FallbackTexture=""},12521:(R,q,L)=>{"use strict";L(10767);var B=L(11537);L(10867),L(11144),L(10864),L(11548),L(11504);B.d},10864:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});class B{static SetMatrixPrecision(R){if(B.MatrixTrackPrecisionChange=!1,R&&!B.MatrixUse64Bits&&B.MatrixTrackedMatrices)for(let q=0;q<B.MatrixTrackedMatrices.length;++q){const R=B.MatrixTrackedMatrices[q],L=R.Kj;R.Kj=new Array(16);for(let q=0;q<16;++q)R.Kj[q]=L[q]}B.MatrixUse64Bits=R,B.MatrixCurrentType=B.MatrixUse64Bits?Array:Float32Array,B.MatrixTrackedMatrices=null}}B.MatrixUse64Bits=!1,B.MatrixTrackPrecisionChange=!0,B.MatrixCurrentType=Float32Array,B.MatrixTrackedMatrices=[]},11548:(R,q,L)=>{"use strict";L.d(q,{e:()=>B});class B{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var R;return(null===(R=this._textures)||void 0===R?void 0:R[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(R){var q,L;if(!this._textures)return-1;const B=this._textures[R],N=(null===(q=this._layerIndices)||void 0===q?void 0:q[R])??0,h=(null===(L=this._faceIndices)||void 0===L?void 0:L[R])??0;return B.isCube?6*N+h:B.is3D?0:N}get samples(){return this._samples}setSamples(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===R&&!L)return R;const B=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,R,q):this._engine.updateRenderTargetTextureSampleCount(this,R);return this._samples=R,B}constructor(R,q,L,B,N){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=R,this._isCube=q,this._size=L,this._engine=B,this._depthStencilTexture=null,this.label=N}setTextures(R){Array.isArray(R)?this._textures=R:this._textures=R?[R]:null}setTexture(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[q]!==R&&(this._textures[q]&&L&&this._textures[q].dispose(),this._textures[q]=R)}setLayerAndFaceIndices(R,q){this._layerIndices=R,this._faceIndices=q}setLayerAndFaceIndex(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==q&&q>=0&&(this._layerIndices[R]=q),void 0!==L&&L>=0&&(this._faceIndices[R]=L)}createDepthStencilTexture(){var R;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,Z=arguments.length>5?arguments[5]:void 0;return null===(R=this._depthStencilTexture)||void 0===R||R.dispose(),this._depthStencilTextureWithStencil=B,this._depthStencilTextureLabel=Z,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:L,comparisonFunction:q,generateStencil:B,isCube:this._isCube,samples:N,depthTextureFormat:h,label:Z},this),this._depthStencilTexture}_shareDepth(R){this.shareDepth(R)}shareDepth(R){this._depthStencilTexture&&(R._depthStencilTexture&&R._depthStencilTexture.dispose(),R._depthStencilTexture=this._depthStencilTexture,R._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(R){this.texture&&this.texture._swapAndDie(R),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let R=null;if(this._isMulti){const q=this.textures;if(q&&q.length>0){let L=!1,B=q.length,N=-1;const h=q[q.length-1]._source;14!==h&&12!==h||(L=!0,N=q[q.length-1].format,B--);const Z=[],z=[],Y=[],F=[],C=[],e=[],y=[],U={};for(let R=0;R<B;++R){const L=q[R];Z.push(L.samplingMode),z.push(L.type),Y.push(L.format);void 0!==U[L.uniqueId]?(F.push(-1),y.push(0)):(U[L.uniqueId]=R,L.is2DArray?(F.push(35866),y.push(L.depth)):L.isCube?(F.push(34067),y.push(0)):L.is3D?(F.push(32879),y.push(L.depth)):(F.push(3553),y.push(0))),this._faceIndices&&C.push(this._faceIndices[R]??0),this._layerIndices&&e.push(this._layerIndices[R]??0)}const n={samplingModes:Z,generateMipMaps:q[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:L,depthTextureFormat:N,types:z,formats:Y,textureCount:B,targetTypes:F,faceIndex:C,layerIndex:e,layerCounts:y,label:this.label},r={width:this.width,height:this.height,depth:this.depth};R=this._engine.createMultipleRenderTarget(r,n);for(let p=0;p<B;++p){if(-1!==F[p])continue;const L=U[q[p].uniqueId];R.setTexture(R.textures[L],p)}}}else{var q,L,B,N;const Z={};if(Z.generateDepthBuffer=this._generateDepthBuffer,Z.generateMipMaps=(null===(q=this.texture)||void 0===q?void 0:q.generateMipMaps)??!1,Z.generateStencilBuffer=this._generateStencilBuffer,Z.samplingMode=null===(L=this.texture)||void 0===L?void 0:L.samplingMode,Z.type=null===(B=this.texture)||void 0===B?void 0:B.type,Z.format=null===(N=this.texture)||void 0===N?void 0:N.format,Z.noColorAttachment=!this._textures,Z.label=this.label,this.isCube)R=this._engine.createRenderTargetCubeTexture(this.width,Z);else{var h;const q={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(h=this.texture)||void 0===h?void 0:h.depth:void 0};R=this._engine.createRenderTargetTexture(q,Z)}R.texture&&(R.texture.isReady=!0)}return R}_swapRenderTargetWrapper(R){if(this._textures&&R._textures)for(let q=0;q<this._textures.length;++q)this._textures[q]._swapAndDie(R._textures[q],!1),R._textures[q].isReady=!0;this._depthStencilTexture&&R._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(R._depthStencilTexture),R._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const R=this._cloneRenderTargetWrapper();if(R){if(this._depthStencilTexture){const q=this._depthStencilTexture.samplingMode,L=this._depthStencilTexture.format,B=2===q||3===q||11===q;R.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,B,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,L,this._depthStencilTextureLabel)}this.samples>1&&R.setSamples(this.samples),R._swapRenderTargetWrapper(this),R.dispose()}}releaseTextures(){if(this._textures)for(let q=0;q<(null===(R=this._textures)||void 0===R?void 0:R.length);++q){var R;this._textures[q].dispose()}this._textures=null}dispose(){var R;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(R=this._depthStencilTexture)||void 0===R||R.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10841:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersRepository:B.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersStore:B.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.IncludesShadersStore:B.IncludesShadersStoreWGSL}}B.ShadersRepository="src/Shaders/",B.ShadersStore={},B.IncludesShadersStore={},B.ShadersRepositoryWGSL="src/ShadersWGSL/",B.ShadersStoreWGSL={},B.IncludesShadersStoreWGSL={}},10856:(R,q,L)=>{"use strict";L.d(q,{d:()=>y,g:()=>d,k:()=>U,l:()=>n,m:()=>c,q:()=>e,u:()=>F,w:()=>C,z:()=>Y,B:()=>z});class B{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.hd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(R){R&&this.program&&R(this.program)}setEngine(R){this.hd=R}_fillEffectInformation(R,q,L,B,N,h,Z,z){const Y=this.hd;if(Y.supportsUniformBuffers)for(const C in q)R.bindUniformBlock(C,q[C]);let F;for(this.hd.getUniforms(this,L).forEach(((R,q)=>{B[L[q]]=R})),this._uniforms=B,F=0;F<N.length;F++){null==R.getUniform(N[F])&&(N.splice(F,1),F--)}N.forEach(((R,q)=>{h[R]=q}));for(const C of Y.getAttributes(this,Z))z.push(C)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(R,q){const L=this._valueCache[R],B=q.updateFlag;return(void 0===L||L!==B)&&(this._valueCache[R]=B,!0)}_cacheFloat2(R,q,L){let B=this._valueCache[R];if(!B||2!==B.length)return B=[q,L],this._valueCache[R]=B,!0;let N=!1;return B[0]!==q&&(B[0]=q,N=!0),B[1]!==L&&(B[1]=L,N=!0),N}_cacheFloat3(R,q,L,B){let N=this._valueCache[R];if(!N||3!==N.length)return N=[q,L,B],this._valueCache[R]=N,!0;let h=!1;return N[0]!==q&&(N[0]=q,h=!0),N[1]!==L&&(N[1]=L,h=!0),N[2]!==B&&(N[2]=B,h=!0),h}_cacheFloat4(R,q,L,B,N){let h=this._valueCache[R];if(!h||4!==h.length)return h=[q,L,B,N],this._valueCache[R]=h,!0;let Z=!1;return h[0]!==q&&(h[0]=q,Z=!0),h[1]!==L&&(h[1]=L,Z=!0),h[2]!==B&&(h[2]=B,Z=!0),h[3]!==N&&(h[3]=N,Z=!0),Z}setInt(R,q){const L=this._valueCache[R];void 0!==L&&L===q||this.hd.setInt(this._uniforms[R],q)&&(this._valueCache[R]=q)}setInt2(R,q,L){this._cacheFloat2(R,q,L)&&(this.hd.setInt2(this._uniforms[R],q,L)||(this._valueCache[R]=null))}setInt3(R,q,L,B){this._cacheFloat3(R,q,L,B)&&(this.hd.setInt3(this._uniforms[R],q,L,B)||(this._valueCache[R]=null))}setInt4(R,q,L,B,N){this._cacheFloat4(R,q,L,B,N)&&(this.hd.setInt4(this._uniforms[R],q,L,B,N)||(this._valueCache[R]=null))}setIntArray(R,q){this._valueCache[R]=null,this.hd.setIntArray(this._uniforms[R],q)}setIntArray2(R,q){this._valueCache[R]=null,this.hd.setIntArray2(this._uniforms[R],q)}setIntArray3(R,q){this._valueCache[R]=null,this.hd.setIntArray3(this._uniforms[R],q)}setIntArray4(R,q){this._valueCache[R]=null,this.hd.setIntArray4(this._uniforms[R],q)}setUInt(R,q){const L=this._valueCache[R];void 0!==L&&L===q||this.hd.setUInt(this._uniforms[R],q)&&(this._valueCache[R]=q)}setUInt2(R,q,L){this._cacheFloat2(R,q,L)&&(this.hd.setUInt2(this._uniforms[R],q,L)||(this._valueCache[R]=null))}setUInt3(R,q,L,B){this._cacheFloat3(R,q,L,B)&&(this.hd.setUInt3(this._uniforms[R],q,L,B)||(this._valueCache[R]=null))}setUInt4(R,q,L,B,N){this._cacheFloat4(R,q,L,B,N)&&(this.hd.setUInt4(this._uniforms[R],q,L,B,N)||(this._valueCache[R]=null))}setUIntArray(R,q){this._valueCache[R]=null,this.hd.setUIntArray(this._uniforms[R],q)}setUIntArray2(R,q){this._valueCache[R]=null,this.hd.setUIntArray2(this._uniforms[R],q)}setUIntArray3(R,q){this._valueCache[R]=null,this.hd.setUIntArray3(this._uniforms[R],q)}setUIntArray4(R,q){this._valueCache[R]=null,this.hd.setUIntArray4(this._uniforms[R],q)}setArray(R,q){this._valueCache[R]=null,this.hd.setArray(this._uniforms[R],q)}setArray2(R,q){this._valueCache[R]=null,this.hd.setArray2(this._uniforms[R],q)}setArray3(R,q){this._valueCache[R]=null,this.hd.setArray3(this._uniforms[R],q)}setArray4(R,q){this._valueCache[R]=null,this.hd.setArray4(this._uniforms[R],q)}setMatrices(R,q){q&&(this._valueCache[R]=null,this.hd.setMatrices(this._uniforms[R],q))}setMatrix(R,q){this._cacheMatrix(R,q)&&(this.hd.setMatrices(this._uniforms[R],q.dj())||(this._valueCache[R]=null))}setMatrix3x3(R,q){this._valueCache[R]=null,this.hd.setMatrix3x3(this._uniforms[R],q)}setMatrix2x2(R,q){this._valueCache[R]=null,this.hd.setMatrix2x2(this._uniforms[R],q)}setFloat(R,q){const L=this._valueCache[R];void 0!==L&&L===q||this.hd.setFloat(this._uniforms[R],q)&&(this._valueCache[R]=q)}setVector2(R,q){this._cacheFloat2(R,q.x,q.y)&&(this.hd.setFloat2(this._uniforms[R],q.x,q.y)||(this._valueCache[R]=null))}setFloat2(R,q,L){this._cacheFloat2(R,q,L)&&(this.hd.setFloat2(this._uniforms[R],q,L)||(this._valueCache[R]=null))}setVector3(R,q){this._cacheFloat3(R,q.x,q.y,q.z)&&(this.hd.setFloat3(this._uniforms[R],q.x,q.y,q.z)||(this._valueCache[R]=null))}setFloat3(R,q,L,B){this._cacheFloat3(R,q,L,B)&&(this.hd.setFloat3(this._uniforms[R],q,L,B)||(this._valueCache[R]=null))}setVector4(R,q){this._cacheFloat4(R,q.x,q.y,q.z,q.w)&&(this.hd.setFloat4(this._uniforms[R],q.x,q.y,q.z,q.w)||(this._valueCache[R]=null))}setQuaternion(R,q){this._cacheFloat4(R,q.x,q.y,q.z,q.w)&&(this.hd.setFloat4(this._uniforms[R],q.x,q.y,q.z,q.w)||(this._valueCache[R]=null))}setFloat4(R,q,L,B,N){this._cacheFloat4(R,q,L,B,N)&&(this.hd.setFloat4(this._uniforms[R],q,L,B,N)||(this._valueCache[R]=null))}setColor3(R,q){this._cacheFloat3(R,q.r,q.g,q.b)&&(this.hd.setFloat3(this._uniforms[R],q.r,q.g,q.b)||(this._valueCache[R]=null))}setColor4(R,q,L){this._cacheFloat4(R,q.r,q.g,q.b,L)&&(this.hd.setFloat4(this._uniforms[R],q.r,q.g,q.b,L)||(this._valueCache[R]=null))}setDirectColor4(R,q){this._cacheFloat4(R,q.r,q.g,q.b,q.a)&&(this.hd.setFloat4(this._uniforms[R],q.r,q.g,q.b,q.a)||(this._valueCache[R]=null))}_getVertexShaderCode(){return this.vertexShader?this.hd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.hd._getShaderSource(this.fragmentShader):null}}var N=L(10829);const h=new WeakMap,Z={_webGLVersion:2,cachedPipelines:{}};function z(R){let q=h.get(R);if(!q){if(!R)return Z;q={_webGLVersion:R.TEXTURE_BINDING_3D?2:1,_context:R,cachedPipelines:{}},h.set(R,q)}return q}function Y(R){h.delete(R)}function F(R,q,L,B,N,h){const Z=z(B);h||(h=Z._createShaderProgramInjection??y);return h(R,p(q,"vertex",B,Z._contextWasLost),p(L,"fragment",B,Z._contextWasLost),B,N,Z.validateShaderPrograms)}function C(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6?arguments[6]:void 0;const Y=z(N);Z||(Z=Y._createShaderProgramInjection??y);const F=Y._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Z(R,r(q,"vertex",B,F,N,Y._contextWasLost),r(L,"fragment",B,F,N,Y._contextWasLost),N,h,Y.validateShaderPrograms)}function e(R,q){const L=new B,N=z(R);return N.parallelShaderCompile&&(L.isParallelCompiled=!0),L.context=N._context,L}function y(R,q,L,B){let N=arguments.length>5?arguments[5]:void 0;const h=B.createProgram();if(R.program=h,!h)throw new Error("Unable to create program");return B.attachShader(h,q),B.attachShader(h,L),B.linkProgram(h),R.context=B,R.vertexShader=q,R.fragmentShader=L,R.isParallelCompiled||U(R,B,N),h}function U(R,q,L){const B=R.context,N=R.vertexShader,h=R.fragmentShader,Z=R.program;if(!B.getProgramParameter(Z,B.LINK_STATUS)){if(!q.getShaderParameter(N,q.COMPILE_STATUS)){const L=q.getShaderInfoLog(N);if(L)throw R.vertexCompilationError=L,new Error("VERTEX SHADER "+L)}if(!q.getShaderParameter(h,q.COMPILE_STATUS)){const L=q.getShaderInfoLog(h);if(L)throw R.fragmentCompilationError=L,new Error("FRAGMENT SHADER "+L)}const L=B.getProgramInfoLog(Z);if(L)throw R.programLinkError=L,new Error(L)}if(L){B.validateProgram(Z);if(!B.getProgramParameter(Z,B.VALIDATE_STATUS)){const q=B.getProgramInfoLog(Z);if(q)throw R.programValidationError=q,new Error(q)}}B.deleteShader(N),B.deleteShader(h),R.vertexShader=void 0,R.fragmentShader=void 0,R.onCompiled&&(R.onCompiled(),R.onCompiled=void 0)}function n(R,q,L,B,N,h,Z,Y,e){let y=arguments.length>10?arguments[10]:void 0,U=arguments.length>11?arguments[11]:void 0,n=arguments.length>12?arguments[12]:void 0;const r=z(R.context);U||(U=r.createRawShaderProgramInjection??F),n||(n=r.createShaderProgramInjection??C);const p=R;p.program=B?U(p,q,L,p.context,e):n(p,q,L,Y,p.context,e),p.program.__SPECTOR_rebuildProgram=Z,y()}function r(R,q,L,B,h,Z){return p((0,N.i)(R,L,B),q,h,Z)}function p(R,q,L,B){const N=L.createShader("vertex"===q?L.VERTEX_SHADER:L.FRAGMENT_SHADER);if(!N){let R=L.NO_ERROR,N=L.NO_ERROR;for(;(N=L.getError())!==L.NO_ERROR;)R=N;throw new Error(`Something went wrong while creating a gl ${q} shader object. gl error=${R}, gl isContextLost=${L.isContextLost()}, _contextWasLost=${B}`)}return L.shaderSource(N,R),L.compileShader(N),N}function c(R,q){q.useProgram(R)}function d(R,q){const L=R;if(!L.isParallelCompiled)return void q(R);const B=L.onCompiled;L.onCompiled=()=>{null===B||void 0===B||B(),q(R)}}},11495:(R,q,L)=>{"use strict";L.r(q),L.d(q,{ThinEngine:()=>f});var B=L(10856),N=L(11504),h=L(10767),Z=L(10763);class z{constructor(){this.shaderLanguage=0}postProcessor(R,q,L,B,N){if(N.drawBuffersExtensionDisabled){const q=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;R=R.replace(q,"")}return R}}const Y=/(flat\s)?\s*varying\s*.*/;class F{constructor(){this.shaderLanguage=0}attributeProcessor(R){return R.replace("attribute","in")}varyingCheck(R,q){return Y.test(R)}varyingProcessor(R,q){return R.replace("varying",q?"in":"out")}postProcessor(R,q,L){const B=-1!==R.search(/#extension.+GL_EXT_draw_buffers.+require/);if(R=(R=R.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),L){const q=-1!==R.search(/layout *\(location *= *0\) *out/g);R=(R=(R=(R=(R=(R=(R=R.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(B||q?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==q.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+R}return R}}var C=L(11511),e=L(10900),y=L(10834),U=L(11517),n=L(10867),r=L(10837),p=L(10829),c=L(10847);class d{}class f extends y.e{get name(){return this._name}set name(R){this._name=R}get version(){return this._webGLVersion}static get ShadersRepository(){return r.c.ShadersRepository}static set ShadersRepository(R){r.c.ShadersRepository=R}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(R){this._framebufferDimensionsObject=R}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(R,q,L,N){if(L=L||{},super(q??L.antialias,L,N),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!R)return;let Z=null;if(R.getContext){if(Z=R,this._renderingCanvas=Z,void 0===L.fh&&(L.fh=!1),void 0===L.xrCompatible&&(L.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const R=navigator.userAgent;for(const q of f.ExceptionList){const B=q.key,N=q.targets;if(new RegExp(B).test(R)){if(q.capture&&q.captureConstraint){const L=q.capture,B=q.captureConstraint,N=new RegExp(L).exec(R);if(N&&N.length>0){if(parseInt(N[N.length-1])>=B)continue}}for(const R of N)switch(R){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":L.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=R=>{R.preventDefault(),this._contextWasLost=!0,h.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},Z.addEventListener("webglcontextlost",this._onContextLost,!1),Z.addEventListener("webglcontextrestored",this._onContextRestored,!1),L.powerPreference=L.powerPreference||"high-performance"),this._badDesktopOS&&(L.xrCompatible=!1),!L.disableWebGL2Support)try{this._gl=Z.getContext("webgl2",L)||Z.getContext("experimental-webgl2",L),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!Z)throw new Error("The provided canvas is null or undefined.");try{this._gl=Z.getContext("webgl",L)||Z.getContext("experimental-webgl",L)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=R,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const q=this._gl.getContextAttributes();q&&(L.stencil=q.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==L.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=L.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let B=0;B<this._caps.maxVertexAttribs;B++)this._currentBufferPointers[B]=new d;this._shaderProcessor=this.webGLVersion>1?new F:new z;const Y=`Babylon.js v${f.Version}`;h.d.Log(Y+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",Y);const C=(0,B.B)(this._gl);C.validateShaderPrograms=this.validateShaderPrograms,C.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(R){return null}areAllEffectsReady(){for(const R in this._compiledEffects){if(!this._compiledEffects[R].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const R=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=R&&(this._glRenderer=this._gl.getParameter(R.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(R.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const R=this._gl.getExtension("WEBGL_draw_buffers");if(null!==R){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=R.drawBuffersWEBGL.bind(R),this._caps.maxDrawBuffers=this._gl.getParameter(R.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let q=0;q<16;q++)this._gl["COLOR_ATTACHMENT"+q+"_WEBGL"]=R["COLOR_ATTACHMENT"+q+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const R=this._gl.getExtension("WEBGL_depth_texture");null!=R&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=R.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const R=this._gl.getExtension("OES_vertex_array_object");null!=R&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=R.createVertexArrayOES.bind(R),this._gl.bindVertexArray=R.bindVertexArrayOES.bind(R),this._gl.deleteVertexArray=R.deleteVertexArrayOES.bind(R))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const R=this._gl.getExtension("ANGLE_instanced_arrays");null!=R?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=R.drawArraysInstancedANGLE.bind(R),this._gl.drawElementsInstanced=R.drawElementsInstancedANGLE.bind(R),this._gl.vertexAttribDivisor=R.vertexAttribDivisorANGLE.bind(R)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const R=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),q=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);R&&q&&(this._caps.highPrecisionShaderSupported=0!==R.precision&&0!==q.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const R=this._gl.getExtension("EXT_blend_minmax");null!=R&&(this._caps.blendMinMax=!0,this._gl.MAX=R.MAX_EXT,this._gl.MIN=R.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const R=this._gl.getExtension("EXT_sRGB");null!=R&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:R.SRGB_EXT,SRGB8:R.SRGB_ALPHA_EXT,SRGB8_ALPHA8:R.SRGB_ALPHA_EXT})}if(this._creationOptions){const R=this._creationOptions.forceSRGBBufferSupportState;void 0!==R&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&R)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let q=0;q<this._maxSimultaneousTextures;q++)this._nextFreeTextureSlots.push(q);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const R=this._workingCanvas.getContext("2d");R&&(this._workingContext=R)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const R=this.getGlInfo();return R&&R.renderer?R.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=N;let h=0;if(q&&R){let q=!0;if(this._currentRenderTarget){var Z;const L=null===(Z=this._currentRenderTarget.texture)||void 0===Z?void 0:Z.format;if(8===L||9===L||10===L||11===L){var z;const L=null===(z=this._currentRenderTarget.texture)||void 0===z?void 0:z.type;7===L||5===L?(f._TempClearColorUint32[0]=255*R.r,f._TempClearColorUint32[1]=255*R.g,f._TempClearColorUint32[2]=255*R.b,f._TempClearColorUint32[3]=255*R.a,this._gl.clearBufferuiv(this._gl.COLOR,0,f._TempClearColorUint32),q=!1):(f._TempClearColorInt32[0]=255*R.r,f._TempClearColorInt32[1]=255*R.g,f._TempClearColorInt32[2]=255*R.b,f._TempClearColorInt32[3]=255*R.a,this._gl.clearBufferiv(this._gl.COLOR,0,f._TempClearColorInt32),q=!1)}}q&&(this._gl.clearColor(R.r,R.g,R.b,void 0!==R.a?R.a:1),h|=this._gl.COLOR_BUFFER_BIT)}L&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),h|=this._gl.DEPTH_BUFFER_BIT),B&&(this._gl.clearStencil(0),h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}_viewport(R,q,L,B){R===this._viewportCached.x&&q===this._viewportCached.y&&L===this._viewportCached.z&&B===this._viewportCached.w||(this._viewportCached.x=R,this._viewportCached.y=q,this._viewportCached.z=L,this._viewportCached.w=B,this._gl.viewport(R,q,L,B))}aj(){super.aj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const Y=R;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=R,this._bindUnboundFramebuffer(Y._framebuffer);const F=this._gl;var C;if(!R.isMulti)if(R.is2DArray||R.is3D)F.framebufferTextureLayer(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,null===(C=R.texture._hardwareTexture)||void 0===C?void 0:C.underlyingResource,Z,z),Y._currentLOD=Z;else if(R.isCube){var e;F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_CUBE_MAP_POSITIVE_X+q,null===(e=R.texture._hardwareTexture)||void 0===e?void 0:e.underlyingResource,Z)}else if(Y._currentLOD!==Z){var y;F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,null===(y=R.texture._hardwareTexture)||void 0===y?void 0:y.underlyingResource,Z),Y._currentLOD=Z}const U=R._depthStencilTexture;if(U){R.is3D&&(R.texture.width===U.width&&R.texture.height===U.height&&R.texture.depth===U.depth||h.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const L=R._depthStencilTextureWithStencil?F.DEPTH_STENCIL_ATTACHMENT:F.DEPTH_ATTACHMENT;var n;if(R.is2DArray||R.is3D)F.framebufferTextureLayer(F.FRAMEBUFFER,L,null===(n=U._hardwareTexture)||void 0===n?void 0:n.underlyingResource,Z,z);else if(R.isCube){var r;F.framebufferTexture2D(F.FRAMEBUFFER,L,F.TEXTURE_CUBE_MAP_POSITIVE_X+q,null===(r=U._hardwareTexture)||void 0===r?void 0:r.underlyingResource,Z)}else{var p;F.framebufferTexture2D(F.FRAMEBUFFER,L,F.TEXTURE_2D,null===(p=U._hardwareTexture)||void 0===p?void 0:p.underlyingResource,Z)}}Y._MSAAFramebuffer&&this._bindUnboundFramebuffer(Y._MSAAFramebuffer),this._cachedViewport&&!N?this.setViewport(this._cachedViewport,L,B):(L||(L=R.width,Z&&(L/=Math.pow(2,Z))),B||(B=R.height,Z&&(B/=Math.pow(2,Z))),this._viewport(0,0,L,B)),this.wipeCaches()}setState(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==R||L)&&(this._depthCullingState.cull=R);const z=this.cullBackFaces??N??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==z||L)&&(this._depthCullingState.cullFace=z),this.setZOffset(q),this.setZOffsetUnits(Z);const Y=B?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==Y||L)&&(this._depthCullingState.frontFace=Y),this._stencilStateComposer.stencilMaterial=h}_bindUnboundFramebuffer(R){this._currentFramebuffer!==R&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,R),this._currentFramebuffer=R)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(R){const q=this._getTextureTarget(R);this._bindTextureDirectly(q,R,!0),this._gl.generateMipmap(q),this._bindTextureDirectly(q,null)}unBindFramebuffer(R){var q;let L=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2?arguments[2]:void 0;const N=R;this._currentRenderTarget=null;const h=this._gl;if(N._MSAAFramebuffer){if(R.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(R,L,B);h.bindFramebuffer(h.READ_FRAMEBUFFER,N._MSAAFramebuffer),h.bindFramebuffer(h.DRAW_FRAMEBUFFER,N._framebuffer),h.blitFramebuffer(0,0,R.width,R.height,0,0,R.width,R.height,h.COLOR_BUFFER_BIT,h.NEAREST)}null===(q=R.texture)||void 0===q||!q.generateMipMaps||L||R.isCube||this.generateMipmaps(R.texture),B&&(N._MSAAFramebuffer&&this._bindUnboundFramebuffer(N._framebuffer),B()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(R,q,L){return this._createVertexBuffer(R,this._gl.STATIC_DRAW)}_createVertexBuffer(R,q){const L=this._gl.createBuffer();if(!L)throw new Error("Unable to create vertex buffer");const B=new C.d(L);return this.bindArrayBuffer(B),"number"!==typeof R?R instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(R),q),B.nb=4*R.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,R,q),B.nb=R.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(R),q),B.nb=R),this._resetVertexBufferBinding(),B.references=1,B}createDynamicVertexBuffer(R,q){return this._createVertexBuffer(R,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(R,q,L){const B=this._gl.createBuffer(),N=new C.d(B);if(!B)throw new Error("Unable to create index buffer");this.bindIndexBuffer(N);const h=this._normalizeIndexData(R);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,h,q?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),N.references=1,N.is32Bits=4===h.BYTES_PER_ELEMENT,N}_normalizeIndexData(R){if(2===R.BYTES_PER_ELEMENT)return R;if(this._caps.uintIndices){if(R instanceof Uint32Array)return R;for(let q=0;q<R.length;q++)if(R[q]>=65535)return new Uint32Array(R);return new Uint16Array(R)}return new Uint16Array(R)}bindArrayBuffer(R){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(R,this._gl.ARRAY_BUFFER)}bindUniformBlock(R,q,L){const B=R.program,N=this._gl.getUniformBlockIndex(B,q);this._gl.uniformBlockBinding(B,N,L)}bindIndexBuffer(R){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(R,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(R,q){(this._vaoRecordInProgress||this._currentBoundBuffer[q]!==R)&&(this._gl.bindBuffer(q,R?R.underlyingResource:null),this._currentBoundBuffer[q]=R)}updateArrayBuffer(R){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,R)}_vertexAttribPointer(R,q,L,B,N,h,Z){const z=this._currentBufferPointers[q];if(!z)return;let Y=!1;z.active?(z.buffer!==R&&(z.buffer=R,Y=!0),z.size!==L&&(z.size=L,Y=!0),z.type!==B&&(z.type=B,Y=!0),z.normalized!==N&&(z.normalized=N,Y=!0),z.stride!==h&&(z.stride=h,Y=!0),z.offset!==Z&&(z.offset=Z,Y=!0)):(Y=!0,z.active=!0,z.index=q,z.size=L,z.type=B,z.normalized=N,z.stride=h,z.offset=Z,z.buffer=R),(Y||this._vaoRecordInProgress)&&(this.bindArrayBuffer(R),B===this._gl.UNSIGNED_INT||B===this._gl.INT?this._gl.vertexAttribIPointer(q,L,B,h,Z):this._gl.vertexAttribPointer(q,L,B,N,h,Z))}_bindIndexBufferWithCache(R){null!=R&&this._cachedIndexBuffer!==R&&(this._cachedIndexBuffer=R,this.bindIndexBuffer(R),this._uintIndicesCurrentlySet=R.is32Bits)}_bindVertexBuffersAttributes(R,q,L){const B=q.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let N=0;N<B.length;N++){const h=q.getAttributeLocation(N);if(h>=0){const q=B[N];let Z=null;if(L&&(Z=L[q]),Z||(Z=R[q]),!Z)continue;this._gl.enableVertexAttribArray(h),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[h]=!0);const z=Z.getBuffer();z&&(this._vertexAttribPointer(z,h,Z.getSize(),Z.type,Z.normalized,Z.byteStride,Z.byteOffset),Z.getIsInstanced()&&(this._gl.vertexAttribDivisor(h,Z.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(h),this._currentInstanceBuffers.push(z))))}}}recordVertexArrayObject(R,q,L,B){const N=this._gl.createVertexArray();if(!N)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(N),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(R,L,B),this.bindIndexBuffer(q),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),N}bindVertexArrayObject(R,q){this._cachedVertexArrayObject!==R&&(this._cachedVertexArrayObject=R,this._gl.bindVertexArray(R),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=q&&q.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(R,q,L,B,N){if(this._cachedVertexBuffers!==R||this._cachedEffectForVertexBuffers!==N){this._cachedVertexBuffers=R,this._cachedEffectForVertexBuffers=N;const q=N.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let h=0;for(let Z=0;Z<q;Z++)if(Z<L.length){const q=N.getAttributeLocation(Z);q>=0&&(this._gl.enableVertexAttribArray(q),this._vertexAttribArraysEnabled[q]=!0,this._vertexAttribPointer(R,q,L[Z],this._gl.FLOAT,!1,B,h)),h+=4*L[Z]}}this._bindIndexBufferWithCache(q)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(R,q,L,B){this._cachedVertexBuffers===R&&this._cachedEffectForVertexBuffers===L||(this._cachedVertexBuffers=R,this._cachedEffectForVertexBuffers=L,this._bindVertexBuffersAttributes(R,L,B)),this._bindIndexBufferWithCache(q)}unbindInstanceAttributes(){let R;for(let q=0,L=this._currentInstanceLocations.length;q<L;q++){const L=this._currentInstanceBuffers[q];R!=L&&L.references&&(R=L,this.bindArrayBuffer(L));const B=this._currentInstanceLocations[q];this._gl.vertexAttribDivisor(B,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(R){this._gl.deleteVertexArray(R)}_releaseBuffer(R){return R.references--,0===R.references&&(this._deleteBuffer(R),!0)}_deleteBuffer(R){this._gl.deleteBuffer(R.underlyingResource)}updateAndBindInstancesBuffer(R,q,L){if(this.bindArrayBuffer(R),q&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,q),void 0!==L[0].index)this.bindInstancesBuffer(R,L,!0);else for(let B=0;B<4;B++){const q=L[B];this._vertexAttribArraysEnabled[q]||(this._gl.enableVertexAttribArray(q),this._vertexAttribArraysEnabled[q]=!0),this._vertexAttribPointer(R,q,4,this._gl.FLOAT,!1,64,16*B),this._gl.vertexAttribDivisor(q,1),this._currentInstanceLocations.push(q),this._currentInstanceBuffers.push(R)}}bindInstancesBuffer(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(R);let B=0;if(L)for(let N=0;N<q.length;N++){B+=4*q[N].attributeSize}for(let N=0;N<q.length;N++){const L=q[N];void 0===L.index&&(L.index=this._currentEffect.getAttributeLocationByName(L.attributeName)),L.index<0||(this._vertexAttribArraysEnabled[L.index]||(this._gl.enableVertexAttribArray(L.index),this._vertexAttribArraysEnabled[L.index]=!0),this._vertexAttribPointer(R,L.index,L.attributeSize,L.attributeType||this._gl.FLOAT,L.normalized||!1,B,L.offset),this._gl.vertexAttribDivisor(L.index,void 0===L.divisor?1:L.divisor),this._currentInstanceLocations.push(L.index),this._currentInstanceBuffers.push(R))}}disableInstanceAttributeByName(R){if(!this._currentEffect)return;const q=this._currentEffect.getAttributeLocationByName(R);this.disableInstanceAttribute(q)}disableInstanceAttribute(R){let q,L=!1;for(;-1!==(q=this._currentInstanceLocations.indexOf(R));)this._currentInstanceLocations.splice(q,1),this._currentInstanceBuffers.splice(q,1),L=!0,q=this._currentInstanceLocations.indexOf(R);L&&(this._gl.vertexAttribDivisor(R,0),this.disableAttributeByIndex(R))}disableAttributeByIndex(R){this._gl.disableVertexAttribArray(R),this._vertexAttribArraysEnabled[R]=!1,this._currentBufferPointers[R].active=!1}draw(R,q,L,B){this.drawElementsType(R?0:1,q,L,B)}drawPointClouds(R,q,L){this.drawArraysType(2,R,q,L)}drawUnIndexed(R,q,L,B){this.drawArraysType(R?0:1,q,L,B)}drawElementsType(R,q,L,B){this.applyStates(),this._reportDrawCall();const N=this._drawMode(R),h=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,Z=this._uintIndicesCurrentlySet?4:2;B?this._gl.drawElementsInstanced(N,L,h,q*Z,B):this._gl.drawElements(N,L,h,q*Z)}drawArraysType(R,q,L,B){this.applyStates(),this._reportDrawCall();const N=this._drawMode(R);B?this._gl.drawArraysInstanced(N,q,L,B):this._gl.drawArrays(N,q,L)}_drawMode(R){switch(R){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(R){this._compiledEffects[R._key]&&delete this._compiledEffects[R._key];const q=R.getPipelineContext();q&&this._deletePipelineContext(q)}_deletePipelineContext(R){const q=R;q&&q.program&&(q.program.__SPECTOR_rebuildProgram=null,(0,c.l)(q),this._gl.deleteProgram(q.program))}_getGlobalDefines(R){return(0,p.m)(R,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(R,q,L,N,h,Z,z,Y,F){let C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10?arguments[10]:void 0;const y="string"===typeof R?R:R.vertexToken||R.vertexSource||R.vertexElement||R.vertex,U="string"===typeof R?R:R.fragmentToken||R.fragmentSource||R.fragmentElement||R.fragment,n=this._getGlobalDefines();let p=h??q.defines??"";n&&(p+=n);const c=y+"+"+U+"@"+p;if(this._compiledEffects[c]){const R=this._compiledEffects[c];return z&&R.isReady()&&z(R),R._refCount++,R}this._gl&&(0,B.B)(this._gl);const d=new r.c(R,q,L,N,this,h,Z,z,Y,F,c,q.shaderLanguage??C,q.extraInitializationsAsync??e);return this._compiledEffects[c]=d,d}_getShaderSource(R){return this._gl.getShaderSource(R)}createRawShaderProgram(R,q,L,N){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Z=(0,B.B)(this._gl);return Z._contextWasLost=this._contextWasLost,Z.validateShaderPrograms=this.validateShaderPrograms,(0,B.u)(R,q,L,N||this._gl,h)}createShaderProgram(R,q,L,N,h){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const z=(0,B.B)(this._gl);return z._contextWasLost=this._contextWasLost,z.validateShaderPrograms=this.validateShaderPrograms,(0,B.w)(R,q,L,N,h||this._gl,Z)}inlineShaderCode(R){return R}createPipelineContext(R){if(this._gl){(0,B.B)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const q=(0,B.q)(this._gl,R);return q.hd=this,q}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(R){return(0,B.k)(R,this._gl,this.validateShaderPrograms)}_preparePipelineContext(R,q,L,N,h,Z,z,Y,F,C,e){const y=(0,B.B)(this._gl);return y._contextWasLost=this._contextWasLost,y.validateShaderPrograms=this.validateShaderPrograms,y._createShaderProgramInjection=this._createShaderProgram.bind(this),y.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),y.createShaderProgramInjection=this.createShaderProgram.bind(this),y.loadFileInjection=this._loadFile.bind(this),(0,B.l)(R,q,L,N,h,Z,z,Y,F,C,e)}_createShaderProgram(R,q,L,N){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,B.d)(R,q,L,N,h)}_isRenderingStateCompiled(R){const q=R;return!this._isDisposed&&!q._isDisposed&&(!!this._gl.getProgramParameter(q.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(q),!0))}_executeWhenRenderingStateIsCompiled(R,q){(0,B.g)(R,q)}getUniforms(R,q){const L=new Array,B=R;for(let N=0;N<q.length;N++)L.push(this._gl.getUniformLocation(B.program,q[N]));return L}getAttributes(R,q){const L=[],B=R;for(let h=0;h<q.length;h++)try{L.push(this._gl.getAttribLocation(B.program,q[h]))}catch(N){L.push(-1)}return L}enableEffect(R){(R=null!==R&&(0,N.c)(R)?R.effect:R)&&R!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(R),this._currentEffect=R,R.onBind&&R.onBind(R),R._onBindObservable&&R._onBindObservable.notifyObservers(R))}setInt(R,q){return!!R&&(this._gl.uniform1i(R,q),!0)}setInt2(R,q,L){return!!R&&(this._gl.uniform2i(R,q,L),!0)}setInt3(R,q,L,B){return!!R&&(this._gl.uniform3i(R,q,L,B),!0)}setInt4(R,q,L,B,N){return!!R&&(this._gl.uniform4i(R,q,L,B,N),!0)}setIntArray(R,q){return!!R&&(this._gl.uniform1iv(R,q),!0)}setIntArray2(R,q){return!(!R||q.length%2!==0)&&(this._gl.uniform2iv(R,q),!0)}setIntArray3(R,q){return!(!R||q.length%3!==0)&&(this._gl.uniform3iv(R,q),!0)}setIntArray4(R,q){return!(!R||q.length%4!==0)&&(this._gl.uniform4iv(R,q),!0)}setUInt(R,q){return!!R&&(this._gl.uniform1ui(R,q),!0)}setUInt2(R,q,L){return!!R&&(this._gl.uniform2ui(R,q,L),!0)}setUInt3(R,q,L,B){return!!R&&(this._gl.uniform3ui(R,q,L,B),!0)}setUInt4(R,q,L,B,N){return!!R&&(this._gl.uniform4ui(R,q,L,B,N),!0)}setUIntArray(R,q){return!!R&&(this._gl.uniform1uiv(R,q),!0)}setUIntArray2(R,q){return!(!R||q.length%2!==0)&&(this._gl.uniform2uiv(R,q),!0)}setUIntArray3(R,q){return!(!R||q.length%3!==0)&&(this._gl.uniform3uiv(R,q),!0)}setUIntArray4(R,q){return!(!R||q.length%4!==0)&&(this._gl.uniform4uiv(R,q),!0)}setArray(R,q){return!!R&&(!(q.length<1)&&(this._gl.uniform1fv(R,q),!0))}setArray2(R,q){return!(!R||q.length%2!==0)&&(this._gl.uniform2fv(R,q),!0)}setArray3(R,q){return!(!R||q.length%3!==0)&&(this._gl.uniform3fv(R,q),!0)}setArray4(R,q){return!(!R||q.length%4!==0)&&(this._gl.uniform4fv(R,q),!0)}setMatrices(R,q){return!!R&&(this._gl.uniformMatrix4fv(R,!1,q),!0)}setMatrix3x3(R,q){return!!R&&(this._gl.uniformMatrix3fv(R,!1,q),!0)}setMatrix2x2(R,q){return!!R&&(this._gl.uniformMatrix2fv(R,!1,q),!0)}setFloat(R,q){return!!R&&(this._gl.uniform1f(R,q),!0)}setFloat2(R,q,L){return!!R&&(this._gl.uniform2f(R,q,L),!0)}setFloat3(R,q,L,B){return!!R&&(this._gl.uniform3f(R,q,L,B),!0)}setFloat4(R,q,L,B,N){return!!R&&(this._gl.uniform4f(R,q,L,B,N),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const R=this._colorWrite;this._gl.colorMask(R,R,R,R)}}wipeCaches(R){this.preventCacheWipeBetweenFrames&&!R||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),R&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(R,q){const L=this._gl;let B=L.NEAREST,N=L.NEAREST;switch(R){case 11:B=L.LINEAR,N=q?L.LINEAR_MIPMAP_NEAREST:L.LINEAR;break;case 3:B=L.LINEAR,N=q?L.LINEAR_MIPMAP_LINEAR:L.LINEAR;break;case 8:B=L.NEAREST,N=q?L.NEAREST_MIPMAP_LINEAR:L.NEAREST;break;case 4:B=L.NEAREST,N=q?L.NEAREST_MIPMAP_NEAREST:L.NEAREST;break;case 5:B=L.NEAREST,N=q?L.LINEAR_MIPMAP_NEAREST:L.LINEAR;break;case 6:B=L.NEAREST,N=q?L.LINEAR_MIPMAP_LINEAR:L.LINEAR;break;case 7:B=L.NEAREST,N=L.LINEAR;break;case 1:B=L.NEAREST,N=L.NEAREST;break;case 9:B=L.LINEAR,N=q?L.NEAREST_MIPMAP_NEAREST:L.NEAREST;break;case 10:B=L.LINEAR,N=q?L.NEAREST_MIPMAP_LINEAR:L.NEAREST;break;case 2:B=L.LINEAR,N=L.LINEAR;break;case 12:B=L.LINEAR,N=L.NEAREST}return{min:N,mag:B}}_createTexture(){const R=this._gl.createTexture();if(!R)throw new Error("Unable to create texture");return R}_createHardwareTexture(){return new U.d(this._createTexture(),this._gl)}_createInternalTexture(R,q){let L,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=!1,Z=0,z=3,Y=5,F=!1,C=1;void 0!==q&&"object"===typeof q?(N=!!q.generateMipMaps,Z=void 0===q.type?0:q.type,z=void 0===q.samplingMode?3:q.samplingMode,Y=void 0===q.format?5:q.format,F=void 0!==q.useSRGBBuffer&&q.useSRGBBuffer,C=q.samples??1,L=q.label):N=!!q,F&&(F=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==Z||this._caps.textureFloatLinearFiltering)&&(2!==Z||this._caps.textureHalfFloatLinearFiltering)||(z=1),1!==Z||this._caps.textureFloat||(Z=0,h.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const e=this._gl,y=new n.b(this,B),U=R.width||R,r=R.height||R,p=R.depth||0,c=R.layers||0,d=this._getSamplingParameters(z,N),f=0!==c?e.TEXTURE_2D_ARRAY:0!==p?e.TEXTURE_3D:e.TEXTURE_2D,v=this._getRGBABufferInternalSizedFormat(Z,Y,F),T=this._getInternalFormat(Y),t=this._getWebGLTextureType(Z);return this._bindTextureDirectly(f,y),0!==c?(y.is2DArray=!0,e.texImage3D(f,0,v,U,r,c,0,T,t,null)):0!==p?(y.is3D=!0,e.texImage3D(f,0,v,U,r,p,0,T,t,null)):e.texImage2D(f,0,v,U,r,0,T,t,null),e.texParameteri(f,e.TEXTURE_MAG_FILTER,d.mag),e.texParameteri(f,e.TEXTURE_MIN_FILTER,d.min),e.texParameteri(f,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(f,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),N&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null),y._useSRGBBuffer=F,y.baseWidth=U,y.baseHeight=r,y.width=U,y.height=r,y.depth=c,y.isReady=!0,y.samples=C,y.generateMipMaps=N,y.samplingMode=z,y.type=Z,y.format=Y,y.label=L,this._internalTexturesCache.push(y),y}_getUseSRGBBuffer(R,q){return R&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||q)}createTexture(R,q,L,B){var N=this;let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,y=arguments.length>11?arguments[11]:void 0,U=arguments.length>12?arguments[12]:void 0,r=arguments.length>13?arguments[13]:void 0,p=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(R,q,L,B,h,Z,z,(function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];return N._prepareWebGLTexture(...q,C)}),((R,q,L,N,h,Z)=>{const z=this._gl,Y=L.width===R&&L.height===q;h._creationFlags=r??0;const F=this._getTexImageParametersForCreateTexture(h.format,h._useSRGBBuffer);if(Y)return z.texImage2D(z.TEXTURE_2D,0,F.internalFormat,F.format,F.type,L),!1;const C=this._caps.maxTextureSize;if(L.width>C||L.height>C||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=R,this._workingCanvas.height=q,this._workingContext.drawImage(L,0,0,L.width,L.height,0,0,R,q),z.texImage2D(z.TEXTURE_2D,0,F.internalFormat,F.format,F.type,this._workingCanvas),h.width=R,h.height=q,!1);{const R=new n.b(this,2);this._bindTextureDirectly(z.TEXTURE_2D,R,!0),z.texImage2D(z.TEXTURE_2D,0,F.internalFormat,F.format,F.type,L),this._rescaleTexture(R,h,B,F.format,(()=>{this._releaseTexture(R),this._bindTextureDirectly(z.TEXTURE_2D,h,!0),Z()}))}return!0}),Y,F,C,e,y,U,p)}_getTexImageParametersForCreateTexture(R,q){let L,B;return 1===this.webGLVersion?(L=this._getInternalFormat(R,q),B=L):(L=this._getInternalFormat(R,!1),B=this._getRGBABufferInternalSizedFormat(0,R,q)),{internalFormat:B,format:L,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(R,q,L,B,N){}_unpackFlipY(R){this._unpackFlipYCached!==R&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,R?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=R))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(R){return R.isCube?this._gl.TEXTURE_CUBE_MAP:R.is3D?this._gl.TEXTURE_3D:R.is2DArray||R.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this._getTextureTarget(q),N=this._getSamplingParameters(R,q.useMipMaps||L);this._setTextureParameterInteger(B,this._gl.TEXTURE_MAG_FILTER,N.mag,q),this._setTextureParameterInteger(B,this._gl.TEXTURE_MIN_FILTER,N.min),L&&(q.generateMipMaps=!0,this._gl.generateMipmap(B)),this._bindTextureDirectly(B,null),q.samplingMode=R}updateTextureDimensions(R,q,L){}updateTextureWrappingMode(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=this._getTextureTarget(R);null!==q&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(q),R),R._cachedWrapU=q),null!==L&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(L),R),R._cachedWrapV=L),(R.is2DArray||R.is3D)&&null!==B&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(B),R),R._cachedWrapR=B),this._bindTextureDirectly(N,null)}_uploadCompressedDataToTextureDirectly(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const z=this._gl;let Y=z.TEXTURE_2D;if(R.isCube&&(Y=z.TEXTURE_CUBE_MAP_POSITIVE_X+h),R._useSRGBBuffer)switch(q){case 37492:case 36196:this._caps.etc2?q=z.COMPRESSED_SRGB8_ETC2:R._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?q=z.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:R._useSRGBBuffer=!1;break;case 36492:q=z.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:q=z.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?q=z.COMPRESSED_SRGB_S3TC_DXT1_EXT:R._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?q=z.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:R._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?q=z.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:R._useSRGBBuffer=!1;break;default:R._useSRGBBuffer=!1}this._gl.compressedTexImage2D(Y,Z,q,L,B,0,N)}_uploadDataToTextureDirectly(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Z=this._gl,z=this._getWebGLTextureType(R.type),Y=this._getInternalFormat(R.format),F=void 0===N?this._getRGBABufferInternalSizedFormat(R.type,R.format,R._useSRGBBuffer):this._getInternalFormat(N,R._useSRGBBuffer);this._unpackFlipY(R.invertY);let C=Z.TEXTURE_2D;R.isCube&&(C=Z.TEXTURE_CUBE_MAP_POSITIVE_X+L);const e=Math.round(Math.log(R.width)*Math.LOG2E),y=Math.round(Math.log(R.height)*Math.LOG2E),U=h?R.width:Math.pow(2,Math.max(e-B,0)),n=h?R.height:Math.pow(2,Math.max(y-B,0));Z.texImage2D(C,B,F,U,n,0,Y,z,q)}updateTextureData(R,q,L,B,N,h){let Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const F=this._gl,C=this._getWebGLTextureType(R.type),e=this._getInternalFormat(R.format);this._unpackFlipY(R.invertY);let y=F.TEXTURE_2D,U=F.TEXTURE_2D;R.isCube&&(U=F.TEXTURE_CUBE_MAP_POSITIVE_X+Z,y=F.TEXTURE_CUBE_MAP),this._bindTextureDirectly(y,R,!0),F.texSubImage2D(U,z,L,B,N,h,e,C,q),Y&&this._gl.generateMipmap(U),this._bindTextureDirectly(y,null)}_uploadArrayBufferViewToTexture(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=this._gl,h=R.isCube?N.TEXTURE_CUBE_MAP:N.TEXTURE_2D;this._bindTextureDirectly(h,R,!0),this._uploadDataToTextureDirectly(R,q,L,B),this._bindTextureDirectly(h,null,!0)}_prepareWebGLTextureContinuation(R,q,L,B,N){const h=this._gl;if(!h)return;const Z=this._getSamplingParameters(N,!L);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,Z.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,Z.min),L||B||h.generateMipmap(h.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),q&&q.removePendingData(R),R.onLoadedObservable.notifyObservers(R),R.onLoadedObservable.clear()}_prepareWebGLTexture(R,q,L,B,N,h,Z,z,Y,F){const C=this.getCaps().maxTextureSize,y=Math.min(C,this.needPOTTextures?(0,e.e)(B.width,C):B.width),U=Math.min(C,this.needPOTTextures?(0,e.e)(B.height,C):B.height),n=this._gl;n&&(R._hardwareTexture?(this._bindTextureDirectly(n.TEXTURE_2D,R,!0),this._unpackFlipY(void 0===N||!!N),R.baseWidth=B.width,R.baseHeight=B.height,R.width=y,R.height=U,R.isReady=!0,R.type=-1!==R.type?R.type:0,R.format=-1!==R.format?R.format:F??(".jpg"!==q||R._useSRGBBuffer?5:4),z(y,U,B,q,R,(()=>{this._prepareWebGLTextureContinuation(R,L,h,Z,Y)}))||this._prepareWebGLTextureContinuation(R,L,h,Z,Y)):L&&L.removePendingData(R))}_getInternalFormatFromDepthTextureFormat(R,q,L){const B=this._gl;if(!q)return B.STENCIL_INDEX8;let N=L?B.DEPTH_STENCIL:B.DEPTH_COMPONENT;return this.webGLVersion>1?15===R?N=B.DEPTH_COMPONENT16:16===R?N=B.DEPTH_COMPONENT24:17===R||13===R?N=L?B.DEPTH24_STENCIL8:B.DEPTH_COMPONENT24:14===R?N=B.DEPTH_COMPONENT32F:18===R&&(N=L?B.DEPTH32F_STENCIL8:B.DEPTH_COMPONENT32F):N=B.DEPTH_COMPONENT16,N}_setupFramebufferDepthAttachments(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,h=arguments.length>5?arguments[5]:void 0;const Z=this._gl;h=h??(R?13:14);const z=this._getInternalFormatFromDepthTextureFormat(h,q,R);return R&&q?this._createRenderBuffer(L,B,N,Z.DEPTH_STENCIL,z,Z.DEPTH_STENCIL_ATTACHMENT):q?this._createRenderBuffer(L,B,N,z,z,Z.DEPTH_ATTACHMENT):R?this._createRenderBuffer(L,B,N,z,z,Z.STENCIL_ATTACHMENT):null}_createRenderBuffer(R,q,L,B,N,h){let Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const z=this._gl.createRenderbuffer();return this._updateRenderBuffer(z,R,q,L,B,N,h,Z)}_updateRenderBuffer(R,q,L,B,N,h,Z){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const Y=this._gl;return Y.bindRenderbuffer(Y.RENDERBUFFER,R),B>1&&Y.renderbufferStorageMultisample?Y.renderbufferStorageMultisample(Y.RENDERBUFFER,B,h,q,L):Y.renderbufferStorage(Y.RENDERBUFFER,N,q,L),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Z,Y.RENDERBUFFER,R),z&&Y.bindRenderbuffer(Y.RENDERBUFFER,null),R}_releaseTexture(R){this._deleteTexture(R._hardwareTexture),this.unbindAllTextures();const q=this._internalTexturesCache.indexOf(R);-1!==q&&this._internalTexturesCache.splice(q,1),R._lodTextureHigh&&R._lodTextureHigh.dispose(),R._lodTextureMid&&R._lodTextureMid.dispose(),R._lodTextureLow&&R._lodTextureLow.dispose(),R._irradianceTexture&&R._irradianceTexture.dispose()}_deleteTexture(R){null===R||void 0===R||R.release()}_setProgram(R){this._currentProgram!==R&&((0,B.m)(R,this._gl),this._currentProgram=R)}bindSamplers(R){const q=R.getPipelineContext();this._setProgram(q.program);const L=R.getSamplers();for(let B=0;B<L.length;B++){const q=R.getUniform(L[B]);q&&(this._boundUniforms[B]=q)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=!1;const Z=q&&q._associatedChannel>-1;L&&Z&&(this._activeChannel=q._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==q||B){if(this._activateCurrentTexture(),q&&q.isMultiview)throw h.d.Error(["_bindTextureDirectly called with a multiview texture!",R,q]),"_bindTextureDirectly called with a multiview texture!";var z;this._gl.bindTexture(R,(null===q||void 0===q||null===(z=q._hardwareTexture)||void 0===z?void 0:z.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=q,q&&(q._associatedChannel=this._activeChannel)}else L&&(N=!0,this._activateCurrentTexture());return Z&&!L&&this._bindSamplerUniformToChannel(q._associatedChannel,this._activeChannel),N}_bindTexture(R,q,L){if(void 0===R)return;q&&(q._associatedChannel=R),this._activeChannel=R;const B=q?this._getTextureTarget(q):this._gl.TEXTURE_2D;this._bindTextureDirectly(B,q)}unbindAllTextures(){for(let R=0;R<this._maxSimultaneousTextures;R++)this._activeChannel=R,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(R,q,L,B){void 0!==R&&(q&&(this._boundUniforms[R]=q),this._setTexture(R,L))}_bindSamplerUniformToChannel(R,q){const L=this._boundUniforms[R];L&&L._currentState!==q&&(this._gl.uniform1i(L,q),L._currentState=q)}_getTextureWrapMode(R){switch(R){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(R,q){let L,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!q)return null!=this._boundTexturesCache[R]&&(this._activeChannel=R,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(q.video){this._activeChannel=R;const L=q.getInternalTexture();L&&(L._associatedChannel=R),q.update()}else if(4===q.delayLoadState)return q.delayLoad(),!1;L=N?q.depthStencilTexture:q.isReady()?q.getInternalTexture():q.isCube?this.emptyCubeTexture:q.is3D?this.emptyTexture3D:q.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!B&&L&&(L._associatedChannel=R);let h=!0;this._boundTexturesCache[R]===L&&(B||this._bindSamplerUniformToChannel(L._associatedChannel,R),h=!1),this._activeChannel=R;const Z=this._getTextureTarget(L);if(h&&this._bindTextureDirectly(Z,L,B),L&&!L.isMultiview){if(L.isCube&&L._cachedCoordinatesMode!==q.coordinatesMode){L._cachedCoordinatesMode=q.coordinatesMode;const R=3!==q.coordinatesMode&&5!==q.coordinatesMode?1:0;q.wrapU=R,q.wrapV=R}L._cachedWrapU!==q.wrapU&&(L._cachedWrapU=q.wrapU,this._setTextureParameterInteger(Z,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(q.wrapU),L)),L._cachedWrapV!==q.wrapV&&(L._cachedWrapV=q.wrapV,this._setTextureParameterInteger(Z,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(q.wrapV),L)),L.is3D&&L._cachedWrapR!==q.wrapR&&(L._cachedWrapR=q.wrapR,this._setTextureParameterInteger(Z,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(q.wrapR),L)),this._setAnisotropicLevel(Z,L,q.anisotropicFilteringLevel)}return!0}setTextureArray(R,q,L,B){if(void 0!==R&&q){this._textureUnits&&this._textureUnits.length===L.length||(this._textureUnits=new Int32Array(L.length));for(let q=0;q<L.length;q++){const B=L[q].getInternalTexture();B?(this._textureUnits[q]=R+q,B._associatedChannel=R+q):this._textureUnits[q]=-1}this._gl.uniform1iv(q,this._textureUnits);for(let R=0;R<L.length;R++)this._setTexture(this._textureUnits[R],L[R],!0)}}_setAnisotropicLevel(R,q,L){const B=this._caps.textureAnisotropicFilterExtension;11!==q.samplingMode&&3!==q.samplingMode&&2!==q.samplingMode&&(L=1),B&&q._cachedAnisotropicFilteringLevel!==L&&(this._setTextureParameterFloat(R,B.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L,this._caps.maxAnisotropy),q),q._cachedAnisotropicFilteringLevel=L)}_setTextureParameterFloat(R,q,L,B){this._bindTextureDirectly(R,B,!0,!0),this._gl.texParameterf(R,q,L)}_setTextureParameterInteger(R,q,L,B){B&&this._bindTextureDirectly(R,B,!0,!0),this._gl.texParameteri(R,q,L)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let R=0;R<this._caps.maxVertexAttribs;R++)this.disableAttributeByIndex(R)}else for(let R=0,q=this._vertexAttribArraysEnabled.length;R<q;R++)R>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[R]||this.disableAttributeByIndex(R)}releaseEffects(){const R=Object.keys(this._compiledEffects);for(const q of R){this._compiledEffects[q].dispose()}this._compiledEffects={}}dispose(){var R;((0,Z.i)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(R=this._gl.getExtension("WEBGL_lose_context"))||void 0===R||R.loseContext());(0,B.z)(this._gl)}attachContextLostEvent(R){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",R,!1)}attachContextRestoredEvent(R){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",R,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(R){const q=this._gl;for(;q.getError()!==q.NO_ERROR;);let L=!0;const B=q.createTexture();q.bindTexture(q.TEXTURE_2D,B),q.texImage2D(q.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(R),1,1,0,q.RGBA,this._getWebGLTextureType(R),null),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.NEAREST);const N=q.createFramebuffer();q.bindFramebuffer(q.FRAMEBUFFER,N),q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,B,0);const h=q.checkFramebufferStatus(q.FRAMEBUFFER);if(L=L&&h===q.FRAMEBUFFER_COMPLETE,L=L&&q.getError()===q.NO_ERROR,L&&(q.clear(q.COLOR_BUFFER_BIT),L=L&&q.getError()===q.NO_ERROR),L){q.bindFramebuffer(q.FRAMEBUFFER,null);const R=q.RGBA,B=q.UNSIGNED_BYTE,N=new Uint8Array(4);q.readPixels(0,0,1,1,R,B,N),L=L&&q.getError()===q.NO_ERROR}for(q.deleteTexture(B),q.deleteFramebuffer(N),q.bindFramebuffer(q.FRAMEBUFFER,null);!L&&q.getError()!==q.NO_ERROR;);return L}_getWebGLTextureType(R){if(1===this._webGLVersion){switch(R){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(R){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=q?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(R){case 0:L=this._gl.ALPHA;break;case 1:L=this._gl.LUMINANCE;break;case 2:L=this._gl.LUMINANCE_ALPHA;break;case 6:L=this._gl.RED;break;case 7:L=this._gl.RG;break;case 4:L=q?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:L=q?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(R){case 8:L=this._gl.RED_INTEGER;break;case 9:L=this._gl.RG_INTEGER;break;case 10:L=this._gl.RGB_INTEGER;break;case 11:L=this._gl.RGBA_INTEGER}return L}_getRGBABufferInternalSizedFormat(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==q)switch(q){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return L?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(R){case 3:switch(q){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(q){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return L?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return L?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(q){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(q){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(q){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(q){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(q){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(q){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(q){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return L?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(R,q,L,B){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const Z=N?4:3,z=N?this._gl.RGBA:this._gl.RGB,Y=new Uint8Array(B*L*Z);return h&&this.flushFramebuffer(),this._gl.readPixels(R,q,L,B,z,this._gl.UNSIGNED_BYTE,Y),Promise.resolve(Y)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const R=y.e._CreateCanvas(1,1),q=R.getContext("webgl")||R.getContext("experimental-webgl");this._IsSupported=null!=q&&!!window.WebGLRenderingContext}catch(R){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const R=y.e._CreateCanvas(1,1),q=R.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||R.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!q}catch(R){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}f._TempClearColorUint32=new Uint32Array(4),f._TempClearColorInt32=new Int32Array(4),f.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],f._ConcatenateShader=p.i,f._IsSupported=null,f._HasMajorPerformanceCaveat=null},11182:(R,q,L)=>{"use strict";var B;L.d(q,{e:()=>N}),function(R){R[R.PointerMove=0]="PointerMove",R[R.PointerDown=1]="PointerDown",R[R.PointerUp=2]="PointerUp"}(B||(B={}));class N{}N.DOM_DELTA_PIXEL=0,N.DOM_DELTA_LINE=1,N.DOM_DELTA_PAGE=2},11176:(R,q,L)=>{"use strict";L.d(q,{b:()=>B,c:()=>h,g:()=>N});class B{}B.KEYDOWN=1,B.KEYUP=2;class N{constructor(R,q){this.type=R,this.event=q}}class h extends N{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(R){this.skipOnKeyboardObservable=R}constructor(R,q){super(R,q),this.type=R,this.event=q,this.skipOnKeyboardObservable=!1}}},11168:(R,q,L)=>{"use strict";L.d(q,{e:()=>N,i:()=>Z,k:()=>z});var B=L(11081);class N{}N.POINTERDOWN=1,N.POINTERUP=2,N.POINTERMOVE=4,N.POINTERWHEEL=8,N.POINTERPICK=16,N.POINTERTAP=32,N.POINTERDOUBLETAP=64;class h{constructor(R,q){this.type=R,this.event=q}}class Z extends h{constructor(R,q,L,N){super(R,q),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new B.i(L,N)}}class z extends h{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(R,q),this._pickInfo=L,this._inputManager=B}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10755:(R,q,L)=>{"use strict";L.r(q),L.d(q,{SceneInstrumentation:()=>h});var B=L(10757),N=L(10909);class h{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(R){R!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=R,R?(this._onBeforeActiveMeshesEvaluationObserver=this.Nc.onBeforeActiveMeshesEvaluationObservable.add((()=>{B.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Nc.onAfterActiveMeshesEvaluationObservable.add((()=>{B.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Nc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Nc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(R){R!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=R,R?(this._onBeforeRenderTargetsRenderObserver=this.Nc.onBeforeRenderTargetsRenderObservable.add((()=>{B.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Nc.onAfterRenderTargetsRenderObservable.add((()=>{B.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Nc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Nc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(R){R!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=R,R?(this._onBeforeParticlesRenderingObserver=this.Nc.onBeforeParticlesRenderingObservable.add((()=>{B.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Nc.onAfterParticlesRenderingObservable.add((()=>{B.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Nc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Nc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(R){R!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=R,this.Nc.spriteManagers&&(R?(this._onBeforeSpritesRenderingObserver=this.Nc.onBeforeSpritesRenderingObservable.add((()=>{B.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Nc.onAfterSpritesRenderingObservable.add((()=>{B.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Nc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Nc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(R){R!==this._capturePhysicsTime&&this.Nc.onBeforePhysicsObservable&&(this._capturePhysicsTime=R,R?(this._onBeforePhysicsObserver=this.Nc.onBeforePhysicsObservable.add((()=>{B.f.StartPerformanceCounter("ib"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Nc.onAfterPhysicsObservable.add((()=>{B.f.EndPerformanceCounter("ib"),this._physicsTime.endMonitoring()}))):(this.Nc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Nc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(R){R!==this._captureAnimationsTime&&(this._captureAnimationsTime=R,R?this._onAfterAnimationsObserver=this.Nc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Nc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(R){this._captureFrameTime=R}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(R){this._captureInterFrameTime=R}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(R){R!==this._captureRenderTime&&(this._captureRenderTime=R,R?(this._onBeforeDrawPhaseObserver=this.Nc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),B.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Nc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),B.f.EndPerformanceCounter("Main render")}))):(this.Nc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Nc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(R){R!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=R,R?(this._onBeforeCameraRenderObserver=this.Nc.onBeforeCameraRenderObservable.add((R=>{this._cameraRenderTime.beginMonitoring(),B.f.StartPerformanceCounter(`Rendering camera ${R.name}`)})),this._onAfterCameraRenderObserver=this.Nc.onAfterCameraRenderObservable.add((R=>{this._cameraRenderTime.endMonitoring(!1),B.f.EndPerformanceCounter(`Rendering camera ${R.name}`)}))):(this.Nc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Nc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Nc.getEngine()._drawCalls}constructor(R){this.Nc=R,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new N.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new N.d,this._captureFrameTime=!1,this._frameTime=new N.d,this._captureRenderTime=!1,this._renderTime=new N.d,this._captureInterFrameTime=!1,this._interFrameTime=new N.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new N.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new N.d,this._capturePhysicsTime=!1,this._physicsTime=new N.d,this._captureAnimationsTime=!1,this._animationsTime=new N.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new N.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=R.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(B.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Nc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=R.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(B.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.aj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.aj(),this._captureParticlesRenderTime&&this._particlesRenderTime.aj(),this._captureSpritesRenderTime&&this._spritesRenderTime.aj(),this._captureRenderTime&&this._renderTime.aj(),this._captureCameraRenderTime&&this._cameraRenderTime.aj()}))}dispose(){this.Nc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Nc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Nc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Nc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Nc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Nc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Nc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Nc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Nc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Nc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Nc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Nc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Nc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Nc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Nc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Nc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Nc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Nc=null}}},12120:(R,q,L)=>{"use strict";L.d(q,{c:()=>C});var B=L(11053),N=L(11058),h=L(11081),Z=L(11345),z=L(12085),Y=L(12122),F=L(10889);Z.d.AddNodeConstructor("Light_Type_1",((R,q)=>()=>new C(R,h.m.Zero(),q)));class C extends Y.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(R){this._shadowFrustumSize=R,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(R){this._shadowOrthoScale=R,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(R){this._orthoLeft=R}get orthoRight(){return this._orthoRight}set orthoRight(R){this._orthoRight=R}get orthoTop(){return this._orthoTop}set orthoTop(R){this._orthoTop=R}get orthoBottom(){return this._orthoBottom}set orthoBottom(R){this._orthoBottom=R}constructor(R,q,L){super(R,L),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=q.scale(-1),this.direction=q}getClassName(){return"jb"}getTypeID(){return z.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(R,q,L){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(R):this._setDefaultAutoExtendShadowProjectionMatrix(R,q,L)}_setDefaultFixedFrustumShadowProjectionMatrix(R){const q=this.va().activeCamera;q&&h.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:q.Ri,void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,R,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(R,q,L){const B=this.va().activeCamera;if(!B)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const R=h.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let B=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let Z=0;Z<L.length;Z++){const z=L[Z];if(!z)continue;const Y=z.getBoundingInfo().boundingBox;for(let L=0;L<Y.vectorsWorld.length;L++)h.m.TransformCoordinatesToRef(Y.vectorsWorld[L],q,R),R.x<this._orthoLeft&&(this._orthoLeft=R.x),R.y<this._orthoBottom&&(this._orthoBottom=R.y),R.x>this._orthoRight&&(this._orthoRight=R.x),R.y>this._orthoTop&&(this._orthoTop=R.y),this.autoCalcShadowZBounds&&(R.z<B&&(B=R.z),R.z>N&&(N=R.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=B,this._shadowMaxZ=N)}const N=this._orthoRight-this._orthoLeft,Z=this._orthoTop-this._orthoBottom,z=void 0!==this.shadowMinZ?this.shadowMinZ:B.Ri,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,F=this.va().getEngine().useReverseDepthBuffer;h.c.OrthoOffCenterLHToRef(this._orthoLeft-N*this.shadowOrthoScale,this._orthoRight+N*this.shadowOrthoScale,this._orthoBottom-Z*this.shadowOrthoScale,this._orthoTop+Z*this.shadowOrthoScale,F?Y:z,F?z:Y,R,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,q){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,q),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,q),this)}transferToNodeMaterialEffect(R,q){return this.computeTransformedInformation()?(R.setFloat3(q,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(R.setFloat3(q,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(R){const q=this._scene.getEngine();return!q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}getDepthMaxZ(R){const q=this._scene.getEngine();return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}prepareLightSpecificDefines(R,q){R["DIRLIGHT"+q]=!0}}(0,B.d)([(0,N.K)()],C.prototype,"shadowFrustumSize",null),(0,B.d)([(0,N.K)()],C.prototype,"shadowOrthoScale",null),(0,B.d)([(0,N.K)()],C.prototype,"autoUpdateExtends",void 0),(0,B.d)([(0,N.K)()],C.prototype,"autoCalcShadowZBounds",void 0),(0,B.d)([(0,N.K)("orthoLeft")],C.prototype,"_orthoLeft",void 0),(0,B.d)([(0,N.K)("orthoRight")],C.prototype,"_orthoRight",void 0),(0,B.d)([(0,N.K)("orthoTop")],C.prototype,"_orthoTop",void 0),(0,B.d)([(0,N.K)("orthoBottom")],C.prototype,"_orthoBottom",void 0),(0,F.f)("BABYLON.DirectionalLight",C)},12440:(R,q,L)=>{"use strict";L.d(q,{b:()=>C});var B=L(11053),N=L(11058),h=L(11081),Z=L(11112),z=L(11345),Y=L(12085),F=L(10889);z.d.AddNodeConstructor("Light_Type_3",((R,q)=>()=>new C(R,h.m.Zero(),q)));class C extends Y.e{constructor(R,q,L){super(R,L),this.groundColor=new Z.e(0,0,0),this.direction=q||h.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"kb"}setDirectionToTarget(R){return this.direction=h.m.Normalize(R.Bc(h.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(R,q){const L=h.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",L.x,L.y,L.z,0,q),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Vi),q),this}transferToNodeMaterialEffect(R,q){const L=h.m.Normalize(this.direction);return R.setFloat3(q,L.x,L.y,L.z),this}Jj(){return this._worldMatrix||(this._worldMatrix=h.c.Identity()),this._worldMatrix}getTypeID(){return Y.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(R,q){R["HEMILIGHT"+q]=!0}}(0,B.d)([(0,N.k)()],C.prototype,"groundColor",void 0),(0,B.d)([(0,N.G)()],C.prototype,"direction",void 0),(0,F.f)("BABYLON.HemisphericLight",C)},12085:(R,q,L)=>{"use strict";L.d(q,{e:()=>y});var B=L(11053),N=L(11058),h=L(11081),Z=L(11112),z=L(11345),Y=L(11132),F=L(10889),C=L(11207),e=L(11117);class y extends z.d{get range(){return this._range}set range(R){this._range=R,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(R){this._intensityMode=R,this._computePhotometricScale()}get radius(){return this._radius}set radius(R){this._radius=R,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(R){this._shadowEnabled!==R&&(this._shadowEnabled=R,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(R){this._includedOnlyMeshes=R,this._hookArrayForIncludedOnly(R)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(R){this._excludedMeshes=R,this._hookArrayForExcluded(R)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(R){this._excludeWithLayerMask=R,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(R){this._includeOnlyWithLayerMask=R,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(R){this._lightmapMode!==R&&(this._lightmapMode=R,this._markMeshesAsLightDirty())}getViewMatrix(R){return null}getProjectionMatrix(R,q){return null}constructor(R,q){super(R,q,!1),this.hh=new Z.e(1,1,1),this.jh=new Z.e(1,1,1),this.falloffType=y.FALLOFF_DEFAULT,this.Vi=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=y.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new Y.d(this.va().getEngine(),void 0,void 0,R),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(R,q){return this}_bindLight(R,q,L,B){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const h=R.toString();let z=!1;if(this._uniformBuffer.bindToEffect(L,"Light"+h),this._renderId!==q.getRenderId()||this._lastUseSpecular!==B||!this._uniformBuffer.useUbo){this._renderId=q.getRenderId(),this._lastUseSpecular=B;const R=this.getScaledIntensity();this.transferToEffect(L,h),this.hh.scaleToRef(R,Z.i.gb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",Z.i.gb[0],this.range,h),B&&(this.jh.scaleToRef(R,Z.i.gb[1]),this._uniformBuffer.updateColor4("vLightSpecular",Z.i.gb[1],this.radius,h)),z=!0}if(this.transferTexturesToEffect(L,h),q.shadowsEnabled&&this.shadowEnabled&&N){const R=this.getShadowGenerator(q.activeCamera)??this.getShadowGenerator();R&&(R.bindShadowLight(h,L),z=!0)}z?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(R){let q="Name: "+this.name;if(q+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let L=0;L<this.animations.length;L++)q+=", animation[0]: "+this.animations[L].toString(R);return q}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}xb(R){super.xb(R),this._resyncMeshes()}getShadowGenerator(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(R)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return h.m.Zero()}canAffectMesh(R){return!R||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(R))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(R))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&R.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&R.layerMask)))}dispose(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const R=this._shadowGenerators.values();for(let q=R.next();!0!==q.done;q=R.next()){q.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const R=this._parentContainer.lights.indexOf(this);R>-1&&this._parentContainer.lights.splice(R,1),this._parentContainer=null}for(const L of this.va().meshes)L._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(R,q)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Vi}clone(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=y.GetConstructorFromName(this.getTypeID(),R,this.va());if(!L)return null;const B=e.b.Clone(L,this);return R&&(B.name=R),q&&(B.parent=q),B.xb(this.isEnabled()),this.onClonedObservable.notifyObservers(B),B}serialize(){const R=e.b.Serialize(this);return R.uniqueId=this.uniqueId,R.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(R),this.excludedMeshes.length>0&&(R.excludedMeshesIds=[],this.excludedMeshes.forEach((q=>{R.excludedMeshesIds.push(q.id)}))),this.includedOnlyMeshes.length>0&&(R.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((q=>{R.includedOnlyMeshesIds.push(q.id)}))),e.b.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.isEnabled=this.isEnabled(),R}static GetConstructorFromName(R,q,L){const B=z.d.Construct("Light_Type_"+R,q,L);return B||null}static Parse(R,q){const L=y.GetConstructorFromName(R.type,R.name,q);if(!L)return null;const B=e.b.Parse(L,R,q);if(R.excludedMeshesIds&&(B._excludedMeshesIds=R.excludedMeshesIds),R.includedOnlyMeshesIds&&(B._includedOnlyMeshesIds=R.includedOnlyMeshesIds),void 0!==R.parentId&&(B._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(B._waitingParentInstanceIndex=R.parentInstanceIndex),void 0!==R.falloffType&&(B.falloffType=R.falloffType),void 0!==R.lightmapMode&&(B.lightmapMode=R.lightmapMode),R.animations){for(let q=0;q<R.animations.length;q++){const L=R.animations[q],N=(0,F.d)("BABYLON.Animation");N&&B.animations.push(N.Parse(L))}z.d.ParseAnimationRanges(B,R,q)}return R.autoAnimate&&q.beginAnimation(B,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),void 0!==R.isEnabled&&B.xb(R.isEnabled),B}_hookArrayForExcluded(R){var q=this;const L=R.push;R.push=function(){for(var B=arguments.length,N=new Array(B),h=0;h<B;h++)N[h]=arguments[h];const Z=L.apply(R,N);for(const R of N)R._resyncLightSource(q);return Z};const B=R.splice;R.splice=(q,L)=>{const N=B.apply(R,[q,L]);for(const R of N)R._resyncLightSource(this);return N};for(const N of R)N._resyncLightSource(this)}_hookArrayForIncludedOnly(R){var q=this;const L=R.push;R.push=function(){for(var B=arguments.length,N=new Array(B),h=0;h<B;h++)N[h]=arguments[h];const Z=L.apply(R,N);return q._resyncMeshes(),Z};const B=R.splice;R.splice=(q,L)=>{const N=B.apply(R,[q,L]);return this._resyncMeshes(),N},this._resyncMeshes()}_resyncMeshes(){for(const R of this.va().meshes)R._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const R of this.va().meshes)-1!==R.lightSources.indexOf(this)&&R._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let R=0;const q=this.getTypeID();let L=this.intensityMode;switch(L===y.INTENSITYMODE_AUTOMATIC&&(L=q===y.LIGHTTYPEID_DIRECTIONALLIGHT?y.INTENSITYMODE_ILLUMINANCE:y.INTENSITYMODE_LUMINOUSINTENSITY),q){case y.LIGHTTYPEID_POINTLIGHT:case y.LIGHTTYPEID_SPOTLIGHT:switch(L){case y.INTENSITYMODE_LUMINOUSPOWER:R=1/(4*Math.PI);break;case y.INTENSITYMODE_LUMINOUSINTENSITY:R=1;break;case y.INTENSITYMODE_LUMINANCE:R=this.radius*this.radius}break;case y.LIGHTTYPEID_DIRECTIONALLIGHT:switch(L){case y.INTENSITYMODE_ILLUMINANCE:R=1;break;case y.INTENSITYMODE_LUMINANCE:{let q=this.radius;q=Math.max(q,.001);R=2*Math.PI*(1-Math.cos(q));break}}break;case y.LIGHTTYPEID_HEMISPHERICLIGHT:R=1}return R}_reorderLightsInScene(){const R=this.va();0!=this._renderPriority&&(R.requireLightSorting=!0),this.va().sortLightsByPriority()}}y.FALLOFF_DEFAULT=C.e.FALLOFF_DEFAULT,y.FALLOFF_PHYSICAL=C.e.FALLOFF_PHYSICAL,y.FALLOFF_GLTF=C.e.FALLOFF_GLTF,y.FALLOFF_STANDARD=C.e.FALLOFF_STANDARD,y.LIGHTMAP_DEFAULT=C.e.LIGHTMAP_DEFAULT,y.LIGHTMAP_SPECULAR=C.e.LIGHTMAP_SPECULAR,y.LIGHTMAP_SHADOWSONLY=C.e.LIGHTMAP_SHADOWSONLY,y.INTENSITYMODE_AUTOMATIC=C.e.INTENSITYMODE_AUTOMATIC,y.INTENSITYMODE_LUMINOUSPOWER=C.e.INTENSITYMODE_LUMINOUSPOWER,y.INTENSITYMODE_LUMINOUSINTENSITY=C.e.INTENSITYMODE_LUMINOUSINTENSITY,y.INTENSITYMODE_ILLUMINANCE=C.e.INTENSITYMODE_ILLUMINANCE,y.INTENSITYMODE_LUMINANCE=C.e.INTENSITYMODE_LUMINANCE,y.LIGHTTYPEID_POINTLIGHT=C.e.LIGHTTYPEID_POINTLIGHT,y.LIGHTTYPEID_DIRECTIONALLIGHT=C.e.LIGHTTYPEID_DIRECTIONALLIGHT,y.LIGHTTYPEID_SPOTLIGHT=C.e.LIGHTTYPEID_SPOTLIGHT,y.LIGHTTYPEID_HEMISPHERICLIGHT=C.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,B.d)([(0,N.k)()],y.prototype,"diffuse",void 0),(0,B.d)([(0,N.k)()],y.prototype,"specular",void 0),(0,B.d)([(0,N.K)()],y.prototype,"falloffType",void 0),(0,B.d)([(0,N.K)()],y.prototype,"intensity",void 0),(0,B.d)([(0,N.K)()],y.prototype,"range",null),(0,B.d)([(0,N.K)()],y.prototype,"intensityMode",null),(0,B.d)([(0,N.K)()],y.prototype,"radius",null),(0,B.d)([(0,N.K)()],y.prototype,"_renderPriority",void 0),(0,B.d)([(0,N.c)("_reorderLightsInScene")],y.prototype,"renderPriority",void 0),(0,B.d)([(0,N.K)("shadowEnabled")],y.prototype,"_shadowEnabled",void 0),(0,B.d)([(0,N.K)("excludeWithLayerMask")],y.prototype,"_excludeWithLayerMask",void 0),(0,B.d)([(0,N.K)("includeOnlyWithLayerMask")],y.prototype,"_includeOnlyWithLayerMask",void 0),(0,B.d)([(0,N.K)("lightmapMode")],y.prototype,"_lightmapMode",void 0)},11207:(R,q,L)=>{"use strict";L.d(q,{e:()=>B});class B{static CompareLightsPriority(R,q){return R.shadowEnabled!==q.shadowEnabled?(q.shadowEnabled?1:0)-(R.shadowEnabled?1:0):q.renderPriority-R.renderPriority}}B.FALLOFF_DEFAULT=0,B.FALLOFF_PHYSICAL=1,B.FALLOFF_GLTF=2,B.FALLOFF_STANDARD=3,B.LIGHTMAP_DEFAULT=0,B.LIGHTMAP_SPECULAR=1,B.LIGHTMAP_SHADOWSONLY=2,B.INTENSITYMODE_AUTOMATIC=0,B.INTENSITYMODE_LUMINOUSPOWER=1,B.INTENSITYMODE_LUMINOUSINTENSITY=2,B.INTENSITYMODE_ILLUMINANCE=3,B.INTENSITYMODE_LUMINANCE=4,B.LIGHTTYPEID_POINTLIGHT=0,B.LIGHTTYPEID_DIRECTIONALLIGHT=1,B.LIGHTTYPEID_SPOTLIGHT=2,B.LIGHTTYPEID_HEMISPHERICLIGHT=3},12122:(R,q,L)=>{"use strict";L.d(q,{d:()=>Y});var B=L(11053),N=L(11058),h=L(11081),Z=L(12085),z=L(11382);class Y extends Z.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=h.c.Identity(),this._projectionMatrix=h.c.Identity()}_setPosition(R){this._position=R}get position(){return this._position}set position(R){this._setPosition(R)}_setDirection(R){this._direction=R}get direction(){return this._direction}set direction(R){this._setDirection(R)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(R){this._shadowMinZ=R,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(R){this._shadowMaxZ=R,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=h.m.Zero()),h.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=h.m.Zero()),h.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(R){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(R){return this.direction=h.m.Normalize(R.Bc(this.position)),this.direction}getRotation(){this.direction.normalize();const R=h.m.Cross(this.direction,z.e.Y),q=h.m.Cross(R,this.direction);return h.m.RotationFromAxis(R,q,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=h.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Jj(R){return!R&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=h.c.Identity()),h.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(R){return void 0!==this.shadowMinZ?this.shadowMinZ:R.Ri}getDepthMaxZ(R){return void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ}setShadowProjectionMatrix(R,q,L){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(q,L,R):this._setDefaultShadowProjectionMatrix(R,q,L),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(R){const q=h.h.o[0];let L=this.position;this.computeTransformedInformation()&&(L=this.transformedPosition),h.m.NormalizeToRef(this.getShadowDirection(R),q),1===Math.abs(h.m.Dot(q,h.m.Up()))&&(q.z=1e-13);const B=h.h.o[1];return L.addToRef(q,B),h.c.LookAtLHToRef(L,B,h.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(R,q){return this.setShadowProjectionMatrix(this._projectionMatrix,R??this._viewMatrix,q??[]),this._projectionMatrix}}(0,B.d)([(0,N.G)()],Y.prototype,"position",null),(0,B.d)([(0,N.G)()],Y.prototype,"direction",null),(0,B.d)([(0,N.K)()],Y.prototype,"shadowMinZ",null),(0,B.d)([(0,N.K)()],Y.prototype,"shadowMaxZ",null)},11738:(R,q,L)=>{"use strict";L.d(q,{d:()=>Z,g:()=>h,k:()=>z});const B={},N={};function h(R,q){B[R]=q}function Z(R,q){N[R]=q}function z(R){return N[R]?N[R]:null}},11435:(R,q,L)=>{"use strict";L.d(q,{b:()=>H,d:()=>t});var B,N=L(10757),h=L(10760),Z=L(11071),z=L(10797),Y=L(10767),F=L(11371),C=L(10805),e=L(10808),y=L(10898),U=L(10834);!function(R){R[R.Clean=0]="Clean",R[R.Stop=1]="Stop",R[R.Sync=2]="Sync",R[R.NoSync=3]="NoSync"}(B||(B={}));const n=new h.b,r={};let p=!1;function c(){return r[".babylon"]}function d(R){const q=r[R];return q||(Y.d.Warn("Unable to find a plugin to load "+R+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c())}function f(R,q,L){let B="Unable to load from "+(R.rawData?"binary data":R.url);return q?B+=`: ${q}`:L&&(B+=`: ${L}`),B}function v(R,q,L,B,N,h,Z,z,Y){var F;const e="data:"===(y=R.url).substring(0,5)?y.substring(5):null;var y;if(R.rawData&&!Z)throw"When using ArrayBufferView to load data the file extension must be provided.";const p=Z?d(Z):e?function(R){for(const q in r){const L=r[q].plugin;if(L.canDirectLoad&&L.canDirectLoad(R))return r[q]}return c()}(R.url):function(R){const q=R.indexOf("?");-1!==q&&(R=R.substring(0,q));const L=R.lastIndexOf(".");return d(R.substring(L,R.length).toLowerCase())}(R.url);if(!p)throw new Error(`No plugin or fallback for ${Z??R.url}`);if(!1===(null===Y||void 0===Y||null===(F=Y[p.plugin.name])||void 0===F?void 0:F.enabled))throw new Error(`The '${p.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(R.rawData&&!p.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(R=>{if(p.plugin.createPlugin){const q=p.plugin.createPlugin(Y??{});return q instanceof Promise?(q.then(R).catch((R=>{N("Error instantiating plugin.",R)})),null):(R(q),q)}return R(p.plugin),p.plugin})((Y=>{var F;if(!Y)throw`The loader plugin corresponding to the '${Z}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(n.notifyObservers(Y),e&&(Y.canDirectLoad&&Y.canDirectLoad(R.url)||!(0,C.m)(R.url))){if(Y.directLoad){const R=Y.directLoad(q,e);R instanceof Promise?R.then((R=>{L(Y,R)})).catch((R=>{N("Error in directLoad of _loadData: "+R,R)})):L(Y,R)}else L(Y,e);return}const y=p.isBinary,r=(R,B)=>{q.u?N("Scene has been disposed"):L(Y,R,B)};let c=null,d=!1;null===(F=Y.ej)||void 0===F||F.add((()=>{d=!0,c&&(c.abort(),c=null),h()}));const f=()=>{if(d)return;const L=(R,q)=>{N(null===R||void 0===R?void 0:R.statusText,q)};if(!Y.loadFile&&R.rawData)throw"Plugin does not support loading ArrayBufferView.";c=Y.loadFile?Y.loadFile(q,R.rawData||R.file||R.url,R.rootUrl,r,B,y,L,z):q._loadFile(R.file||R.url,r,B,!0,y,L)},v=q.getEngine();let T=v.enableOfflineSupport;if(T){let L=!1;for(const B of q.disableOfflineSupportExceptionRules)if(B.test(R.url)){L=!0;break}T=!L}T&&U.e.OfflineProviderFactory?q.offlineProvider=U.e.OfflineProviderFactory(R.url,f,v.disableManifestCheck):f()}))}function T(R,q){let L,B,h=null,Z=null;if(q)if(q.name)L=`file:${q.name}`,B=q.name,h=q;else if(ArrayBuffer.isView(q))L="",B=(0,y.e)(),Z=q;else if(q.startsWith("data:"))L=q,B="";else if(R){const h=q;if("/"===h.substring(0,1))return N.f.Error("Wrong sceneFilename parameter"),null;L=R+h,B=h}else L=q,B=N.f.GetFilename(q),R=N.f.GetFolderPath(q);else L=R,B=N.f.GetFilename(R),R=N.f.GetFolderPath(R);return{url:L,rootUrl:R,name:B,file:h,rawData:Z}}function t(R){if("string"===typeof R.extensions){const q=R.extensions;r[q.toLowerCase()]={plugin:R,isBinary:!1}}else{const q=R.extensions;Object.keys(q).forEach((L=>{r[L.toLowerCase()]={plugin:R,isBinary:q[L].isBinary}}))}}function D(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.b.LastCreatedScene,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!B)return Y.d.Error("No scene available to import mesh to"),null;const U=T(q,L);if(!U)return null;const n={};B.addPendingData(n);const r=()=>{B.removePendingData(n)},p=(R,q)=>{const L=f(U,R,q);Z?Z(B,L,new e.i(L,e.e.SceneLoaderError,q)):Y.d.Error(L),r()},c=h?R=>{try{h(R)}catch(q){p("Error in onProgress callback: "+q,q)}}:void 0,d=(R,q,L,h,Z,z,Y,F)=>{if(B.importedMeshesFiles.push(U.url),N)try{N(R,q,L,h,Z,z,Y,F)}catch(C){p("Error in onSuccess callback: "+C,C)}B.removePendingData(n)};return v(U,B,((q,L,N)=>{if(q.rewriteRootURL&&(U.rootUrl=q.rewriteRootURL(U.rootUrl,N)),q.importMesh){const N=[],h=[],Z=[];if(!q.importMesh(R,B,L,U.rootUrl,N,h,Z,p))return;B.loadingPluginName=q.name,d(N,h,Z,[],[],[],[],[])}else{q.importMeshAsync(R,B,L,U.rootUrl,c,U.name).then((R=>{B.loadingPluginName=q.name,d(R.meshes,R.lj,R.skeletons,R.animationGroups,R.transformNodes,R.geometries,R.lights,R.spriteManagers)})).catch((R=>{p(R.message,R)}))}}),c,p,r,F,C,y)}function S(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.b.LastCreatedEngine,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return L?K(R,q,new Z.b(L),B,h,Y,F,C,e):(N.f.Error("No engine available"),null)}function I(R,q,L,B,N,h,Z){return new Promise(((z,Y)=>{S(R,q,L,(R=>{z(R)}),B,((R,q,L)=>{Y(L||new Error(q))}),N,h,Z)}))}function K(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.b.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!L)return Y.d.Error("No scene available to append to"),null;const U=T(R,q);if(!U)return null;const n={};L.addPendingData(n);const r=()=>{L.removePendingData(n)};F.d.ShowLoadingScreen&&!p&&(p=!0,L.getEngine().displayLoadingUI(),L.executeWhenReady((()=>{L.getEngine().hideLoadingUI(),p=!1})));const c=(R,q)=>{const B=f(U,R,q);h?h(L,B,new e.i(B,e.e.SceneLoaderError,q)):Y.d.Error(B),r()},d=N?R=>{try{N(R)}catch(q){c("Error in onProgress callback",q)}}:void 0,t=()=>{if(B)try{B(L)}catch(R){c("Error in onSuccess callback",R)}L.removePendingData(n)};return v(U,L,((R,q)=>{if(R.load){if(!R.load(L,q,U.rootUrl,c))return;L.loadingPluginName=R.name,t()}else{R.loadAsync(L,q,U.rootUrl,d,U.name).then((()=>{L.loadingPluginName=R.name,t()})).catch((R=>{c(R.message,R)}))}}),d,c,r,Z,C,y)}function m(R,q,L,B,N,h,Z){return new Promise(((z,Y)=>{K(R,q,L,(R=>{z(R)}),B,((R,q,L)=>{Y(L||new Error(q))}),N,h,Z)}))}function o(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.b.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!L)return Y.d.Error("No scene available to load asset container to"),null;const y=T(R,q);if(!y)return null;const U={};L.addPendingData(U);const n=()=>{L.removePendingData(U)},r=(R,q)=>{const B=f(y,R,q);h?h(L,B,new e.i(B,e.e.SceneLoaderError,q)):Y.d.Error(B),n()},p=N?R=>{try{N(R)}catch(q){r("Error in onProgress callback",q)}}:void 0,c=R=>{if(B)try{B(R)}catch(q){r("Error in onSuccess callback",q)}L.removePendingData(U)};return v(y,L,((R,q)=>{if(R.loadAssetContainer){const B=R.loadAssetContainer(L,q,y.rootUrl,r);if(!B)return;B.populateRootNodes(),L.loadingPluginName=R.name,c(B)}else if(R.loadAssetContainerAsync){R.loadAssetContainerAsync(L,q,y.rootUrl,p,y.name).then((q=>{q.populateRootNodes(),L.loadingPluginName=R.name,c(q)})).catch((R=>{r(R.message,R)}))}else r("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),p,r,n,Z,F,C)}function l(R,q,L,B,N,h,Z){return new Promise(((z,Y)=>{o(R,q,L,(R=>{z(R)}),B,((R,q,L)=>{Y(L||new Error(q))}),N,h,Z)}))}function G(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.b.LastCreatedScene,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!L)return void Y.d.Error("No scene available to load animations to");if(B){for(const R of L.animatables)R.reset();L.stopAllAnimations(),L.animationGroups.slice().forEach((R=>{R.dispose()}));L.getNodes().forEach((R=>{R.animations&&(R.animations=[])}))}else switch(N){case 0:L.animationGroups.slice().forEach((R=>{R.dispose()}));break;case 1:L.animationGroups.forEach((R=>{R.stop()}));break;case 2:L.animationGroups.forEach((R=>{R.reset(),R.restart()}));break;case 3:break;default:return void Y.d.Error("Unknown animation group loading mode value '"+N+"'")}const n=L.animatables.length;o(R,q,L,(R=>{R.mergeAnimationsTo(L,L.animatables.slice(n),h),R.dispose(),L.onAnimationFileImportedObservable.notifyObservers(L),Z&&Z(L)}),F,C,e,y,U)}function W(R,q,L,B,N,h,Z,z,Y,F){return new Promise(((C,e)=>{G(R,q,L,B,N,h,(R=>{C(R)}),Z,((R,q,L)=>{e(L||new Error(q))}),z,Y,F)}))}class H{static get ForceFullSceneLoadingForIncremental(){return F.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(R){F.d.ForceFullSceneLoadingForIncremental=R}static get ShowLoadingScreen(){return F.d.ShowLoadingScreen}static set ShowLoadingScreen(R){F.d.ShowLoadingScreen=R}static get loggingLevel(){return F.d.loggingLevel}static set loggingLevel(R){F.d.loggingLevel=R}static get CleanBoneMatrixWeights(){return F.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(R){F.d.CleanBoneMatrixWeights=R}static GetDefaultPlugin(){return c()}static GetPluginForExtension(R){var q;return null===(q=d(R))||void 0===q?void 0:q.plugin}static IsPluginForExtensionAvailable(R){return function(R){return!!r[R]}(R)}static RegisterPlugin(R){t(R)}static ImportMesh(R,q,L,B,N,h,Z,z,Y){return D(R,q,L,B,N,h,Z,z,Y)}static ImportMeshAsync(R,q,L,B,N,h,Z){return function(R,q,L,B,N,h,Z,z){return new Promise(((Y,F)=>{D(R,q,L,B,((R,q,L,B,N,h,Z,z)=>{Y({meshes:R,lj:q,skeletons:L,animationGroups:B,transformNodes:N,geometries:h,lights:Z,spriteManagers:z})}),N,((R,q,L)=>{F(L||new Error(q))}),h,Z,z)}))}(R,q,L,B,N,h,Z)}static Load(R,q,L,B,N,h,Z,z){return S(R,q,L,B,N,h,Z,z)}static LoadAsync(R,q,L,B,N,h){return I(R,q,L,B,N,h)}static Append(R,q,L,B,N,h,Z,z){return K(R,q,L,B,N,h,Z,z)}static AppendAsync(R,q,L,B,N,h){return m(R,q,L,B,N,h)}static LoadAssetContainer(R,q,L,B,N,h,Z,z){return o(R,q,L,B,N,h,Z,z)}static LoadAssetContainerAsync(R,q,L,B,N,h){return l(R,q,L,B,N,h)}static ImportAnimations(R,q,L,B,N,h,Z,z,Y,F,C){G(R,q,L,B,N,h,Z,z,Y,F,C)}static ImportAnimationsAsync(R,q,L,B,N,h,Z,z,Y,F,C){return W(R,q,L,B,N,h,z,F,C)}}H.NO_LOGGING=0,H.MINIMAL_LOGGING=1,H.SUMMARY_LOGGING=2,H.DETAILED_LOGGING=3,H.OnPluginActivatedObservable=n},11371:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});class B{static get ForceFullSceneLoadingForIncremental(){return B._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(R){B._ForceFullSceneLoadingForIncremental=R}static get ShowLoadingScreen(){return B._ShowLoadingScreen}static set ShowLoadingScreen(R){B._ShowLoadingScreen=R}static get loggingLevel(){return B._LoggingLevel}static set loggingLevel(R){B._LoggingLevel=R}static get CleanBoneMatrixWeights(){return B._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(R){B._CleanBoneMatrixWeights=R}}B._ForceFullSceneLoadingForIncremental=!1,B._ShowLoadingScreen=!0,B._CleanBoneMatrixWeights=!1,B._LoggingLevel=0},12067:(R,q,L)=>{"use strict";L.d(q,{c:()=>i});var B=L(11053),N=L(11058),h=L(10767),Z=L(11065),z=L(12057),Y=L(11071),F=L(11081),C=L(11136),e=L(11263),y=L(11314);class U extends e.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class n extends y.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRBRDF",90,new U,q),this._useEnergyConservation=n.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=n.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=n.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=n.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=n.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=n.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=n.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=n.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=R._dirtyCallbacks[16],this._enable(!0)}prepareDefines(R){R.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,R.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,R.SPHERICAL_HARMONICS=this._useSphericalHarmonics,R.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}n.DEFAULT_USE_ENERGY_CONSERVATION=!0,n.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,n.DEFAULT_USE_SPHERICAL_HARMONICS=!0,n.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useEnergyConservation",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useSphericalHarmonics",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var r=L(11210),p=L(11112),c=L(11104),d=L(11216),f=L(11271),v=L(11277),T=L(11298),t=(L(12073),L(11303)),D=L(11248);class S extends e.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class I extends y.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRClearCoat",100,new S,q),this._isEnabled=!1,this.isEnabled=!1,this.Vi=1,this.roughness=0,this._indexOfRefraction=I._DefaultIndexOfRefraction,this.indexOfRefraction=I._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=p.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,q,L){if(!this._isEnabled)return!0;const B=this._material._disableBumpMap;if(R._areTexturesDirty&&q.texturesEnabled){if(this._texture&&T.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(L.getCaps().standardDerivatives&&this._bumpTexture&&T.e.ClearCoatBumpTextureEnabled&&!B&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&T.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,q){this._isEnabled?(R.CLEARCOAT=!0,R.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,R.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,R._areTexturesDirty&&q.texturesEnabled&&(this._texture&&T.e.ClearCoatTextureEnabled?(0,D.P)(this._texture,R,"CLEARCOAT_TEXTURE"):R.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&T.e.ClearCoatTextureEnabled?(0,D.P)(this._textureRoughness,R,"CLEARCOAT_TEXTURE_ROUGHNESS"):R.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&T.e.ClearCoatBumpTextureEnabled?(0,D.P)(this._bumpTexture,R,"CLEARCOAT_BUMP"):R.CLEARCOAT_BUMP=!1,R.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===I._DefaultIndexOfRefraction,this._isTintEnabled?(R.CLEARCOAT_TINT=!0,this._tintTexture&&T.e.ClearCoatTintTextureEnabled?((0,D.P)(this._tintTexture,R,"CLEARCOAT_TINT_TEXTURE"),R.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):R.CLEARCOAT_TINT_TEXTURE=!1):(R.CLEARCOAT_TINT=!1,R.CLEARCOAT_TINT_TEXTURE=!1))):(R.CLEARCOAT=!1,R.CLEARCOAT_TEXTURE=!1,R.CLEARCOAT_TEXTURE_ROUGHNESS=!1,R.CLEARCOAT_BUMP=!1,R.CLEARCOAT_TINT=!1,R.CLEARCOAT_TINT_TEXTURE=!1,R.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,R.CLEARCOAT_DEFAULTIOR=!1,R.CLEARCOAT_TEXTUREDIRECTUV=0,R.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,R.CLEARCOAT_BUMPDIRECTUV=0,R.CLEARCOAT_REMAP_F0=!1,R.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,R.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(R,q,L,B){if(!this._isEnabled)return;const N=B.materialDefines,h=this._material.isFrozen,Z=this._material._disableBumpMap,z=this._material._invertNormalMapX,Y=this._material._invertNormalMapY;if(!R.useUbo||!h||!R.isSync){var F,C,e,y;if((this._texture||this._textureRoughness)&&T.e.ClearCoatTextureEnabled)R.updateFloat4("vClearCoatInfos",(null===(F=this._texture)||void 0===F?void 0:F.coordinatesIndex)??0,(null===(C=this._texture)||void 0===C?void 0:C.level)??0,(null===(e=this._textureRoughness)||void 0===e?void 0:e.coordinatesIndex)??0,(null===(y=this._textureRoughness)||void 0===y?void 0:y.level)??0),this._texture&&(0,D.q)(this._texture,R,"clearCoat"),this._textureRoughness&&!N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,D.q)(this._textureRoughness,R,"clearCoatRoughness");this._bumpTexture&&L.getCaps().standardDerivatives&&T.e.ClearCoatTextureEnabled&&!Z&&(R.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,D.q)(this._bumpTexture,R,"clearCoatBump"),q._mirroredCameraPosition?R.updateFloat2("vClearCoatTangentSpaceParams",z?1:-1,Y?1:-1):R.updateFloat2("vClearCoatTangentSpaceParams",z?-1:1,Y?-1:1)),this._tintTexture&&T.e.ClearCoatTintTextureEnabled&&(R.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,D.q)(this._tintTexture,R,"clearCoatTint")),R.updateFloat2("vClearCoatParams",this.Vi,this.roughness);const B=1-this._indexOfRefraction,h=1+this._indexOfRefraction,U=Math.pow(-B/h,2),n=1/this._indexOfRefraction;R.updateFloat4("vClearCoatRefractionParams",U,n,B,h),this._isTintEnabled&&(R.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),R.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}q.texturesEnabled&&(this._texture&&T.e.ClearCoatTextureEnabled&&R.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.e.ClearCoatTextureEnabled&&R.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&L.getCaps().standardDerivatives&&T.e.ClearCoatBumpTextureEnabled&&!Z&&R.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&T.e.ClearCoatTintTextureEnabled&&R.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(R){return this._texture===R||(this._textureRoughness===R||(this._bumpTexture===R||this._tintTexture===R))}getActiveTextures(R){this._texture&&R.push(this._texture),this._textureRoughness&&R.push(this._textureRoughness),this._bumpTexture&&R.push(this._bumpTexture),this._tintTexture&&R.push(this._tintTexture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&R.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&R.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&R.push(this._tintTexture)}dispose(R){var q,L,B,N;R&&(null===(q=this._texture)||void 0===q||q.dispose(),null===(L=this._textureRoughness)||void 0===L||L.dispose(),null===(B=this._bumpTexture)||void 0===B||B.dispose(),null===(N=this._tintTexture)||void 0===N||N.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(R,q,L){return R.CLEARCOAT_BUMP&&q.addFallback(L++,"CLEARCOAT_BUMP"),R.CLEARCOAT_TINT&&q.addFallback(L++,"CLEARCOAT_TINT"),R.CLEARCOAT&&q.addFallback(L++,"CLEARCOAT"),L}getSamplers(R){R.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}I._DefaultIndexOfRefraction=1.5,(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),(0,B.d)([(0,N.K)()],I.prototype,"intensity",void 0),(0,B.d)([(0,N.K)()],I.prototype,"roughness",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"indexOfRefraction",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMainTexture",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"textureRoughness",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"remapF0OnInterfaceChange",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"bumpTexture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isTintEnabled",void 0),(0,B.d)([(0,N.k)()],I.prototype,"tintColor",void 0),(0,B.d)([(0,N.K)()],I.prototype,"tintColorAtDistance",void 0),(0,B.d)([(0,N.K)()],I.prototype,"tintThickness",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"tintTexture",void 0);class K extends e.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class m extends y.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRIridescence",110,new K,q),this._isEnabled=!1,this.isEnabled=!1,this.Vi=1,this.minimumThickness=m._DefaultMinimumThickness,this.maximumThickness=m._DefaultMaximumThickness,this.indexOfRefraction=m._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,q){if(!this._isEnabled)return!0;if(R._areTexturesDirty&&q.texturesEnabled){if(this._texture&&T.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&T.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,q){this._isEnabled?(R.IRIDESCENCE=!0,R._areTexturesDirty&&q.texturesEnabled&&(this._texture&&T.e.IridescenceTextureEnabled?(0,D.P)(this._texture,R,"IRIDESCENCE_TEXTURE"):R.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&T.e.IridescenceTextureEnabled?(0,D.P)(this._thicknessTexture,R,"IRIDESCENCE_THICKNESS_TEXTURE"):R.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(R.IRIDESCENCE=!1,R.IRIDESCENCE_TEXTURE=!1,R.IRIDESCENCE_THICKNESS_TEXTURE=!1,R.IRIDESCENCE_TEXTUREDIRECTUV=0,R.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(R,q){if(!this._isEnabled)return;const L=this._material.isFrozen;if(!R.useUbo||!L||!R.isSync){var B,N,h,Z;if((this._texture||this._thicknessTexture)&&T.e.IridescenceTextureEnabled)R.updateFloat4("vIridescenceInfos",(null===(B=this._texture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(N=this._texture)||void 0===N?void 0:N.level)??0,(null===(h=this._thicknessTexture)||void 0===h?void 0:h.coordinatesIndex)??0,(null===(Z=this._thicknessTexture)||void 0===Z?void 0:Z.level)??0),this._texture&&(0,D.q)(this._texture,R,"iridescence"),this._thicknessTexture&&(0,D.q)(this._thicknessTexture,R,"iridescenceThickness");R.updateFloat4("vIridescenceParams",this.Vi,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}q.texturesEnabled&&(this._texture&&T.e.IridescenceTextureEnabled&&R.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&T.e.IridescenceTextureEnabled&&R.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(R){return this._texture===R||this._thicknessTexture===R}getActiveTextures(R){this._texture&&R.push(this._texture),this._thicknessTexture&&R.push(this._thicknessTexture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&R.push(this._thicknessTexture)}dispose(R){var q,L;R&&(null===(q=this._texture)||void 0===q||q.dispose(),null===(L=this._thicknessTexture)||void 0===L||L.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(R,q,L){return R.IRIDESCENCE&&q.addFallback(L++,"IRIDESCENCE"),L}getSamplers(R){R.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}m._DefaultMinimumThickness=100,m._DefaultMaximumThickness=400,m._DefaultIndexOfRefraction=1.3,(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"isEnabled",void 0),(0,B.d)([(0,N.K)()],m.prototype,"intensity",void 0),(0,B.d)([(0,N.K)()],m.prototype,"minimumThickness",void 0),(0,B.d)([(0,N.K)()],m.prototype,"maximumThickness",void 0),(0,B.d)([(0,N.K)()],m.prototype,"indexOfRefraction",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"texture",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"thicknessTexture",void 0);class o extends e.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class l extends y.b{set angle(R){this.direction.x=Math.cos(R),this.direction.y=Math.sin(R)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRAnisotropic",110,new o,q),this._isEnabled=!1,this.isEnabled=!1,this.Vi=1,this.direction=new F.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=R._dirtyCallbacks[16]}isReadyForSubMesh(R,q){return!this._isEnabled||!(R._areTexturesDirty&&q.texturesEnabled&&this._texture&&T.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(R,q,L){this._isEnabled?(R.ANISOTROPIC=this._isEnabled,this._isEnabled&&!L.isVerticesDataPresent(C.e.TangentKind)&&(R._needUVs=!0,R.MAINUV1=!0),R._areTexturesDirty&&q.texturesEnabled&&(this._texture&&T.e.AnisotropicTextureEnabled?(0,D.P)(this._texture,R,"ANISOTROPIC_TEXTURE"):R.ANISOTROPIC_TEXTURE=!1),R._areMiscDirty&&(R.ANISOTROPIC_LEGACY=this._legacy)):(R.ANISOTROPIC=!1,R.ANISOTROPIC_TEXTURE=!1,R.ANISOTROPIC_TEXTUREDIRECTUV=0,R.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(R,q){if(!this._isEnabled)return;const L=this._material.isFrozen;R.useUbo&&L&&R.isSync||(this._texture&&T.e.AnisotropicTextureEnabled&&(R.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,D.q)(this._texture,R,"anisotropy")),R.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Vi)),q.texturesEnabled&&this._texture&&T.e.AnisotropicTextureEnabled&&R.setTexture("anisotropySampler",this._texture)}hasTexture(R){return this._texture===R}getActiveTextures(R){this._texture&&R.push(this._texture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture)}dispose(R){R&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(R,q,L){return R.ANISOTROPIC&&q.addFallback(L++,"ANISOTROPIC"),L}getSamplers(R){R.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(R,q,L){super.parse(R,q,L),void 0===R.legacy&&(this.legacy=!0)}}(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0),(0,B.d)([(0,N.K)()],l.prototype,"intensity",void 0),(0,B.d)([(0,N.E)()],l.prototype,"direction",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],l.prototype,"legacy",void 0);class G extends e.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class W extends y.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"Sheen",120,new G,q),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Vi=1,this.color=p.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,q){if(!this._isEnabled)return!0;if(R._areTexturesDirty&&q.texturesEnabled){if(this._texture&&T.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,q){this._isEnabled?(R.SHEEN=!0,R.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,R.SHEEN_ROUGHNESS=null!==this._roughness,R.SHEEN_ALBEDOSCALING=this._albedoScaling,R.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,R._areTexturesDirty&&q.texturesEnabled&&(this._texture&&T.e.SheenTextureEnabled?((0,D.P)(this._texture,R,"SHEEN_TEXTURE"),R.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):R.SHEEN_TEXTURE=!1,this._textureRoughness&&T.e.SheenTextureEnabled?(0,D.P)(this._textureRoughness,R,"SHEEN_TEXTURE_ROUGHNESS"):R.SHEEN_TEXTURE_ROUGHNESS=!1)):(R.SHEEN=!1,R.SHEEN_TEXTURE=!1,R.SHEEN_TEXTURE_ROUGHNESS=!1,R.SHEEN_LINKWITHALBEDO=!1,R.SHEEN_ROUGHNESS=!1,R.SHEEN_ALBEDOSCALING=!1,R.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,R.SHEEN_GAMMATEXTURE=!1,R.SHEEN_TEXTUREDIRECTUV=0,R.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(R,q,L,B){if(!this._isEnabled)return;const N=B.materialDefines,h=this._material.isFrozen;if(!R.useUbo||!h||!R.isSync){var Z,z,Y,F;if((this._texture||this._textureRoughness)&&T.e.SheenTextureEnabled)R.updateFloat4("vSheenInfos",(null===(Z=this._texture)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(z=this._texture)||void 0===z?void 0:z.level)??0,(null===(Y=this._textureRoughness)||void 0===Y?void 0:Y.coordinatesIndex)??0,(null===(F=this._textureRoughness)||void 0===F?void 0:F.level)??0),this._texture&&(0,D.q)(this._texture,R,"sheen"),this._textureRoughness&&!N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,D.q)(this._textureRoughness,R,"sheenRoughness");R.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Vi),null!==this._roughness&&R.updateFloat("vSheenRoughness",this._roughness)}q.texturesEnabled&&(this._texture&&T.e.SheenTextureEnabled&&R.setTexture("sheenSampler",this._texture),this._textureRoughness&&!N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.e.SheenTextureEnabled&&R.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(R){return this._texture===R||this._textureRoughness===R}getActiveTextures(R){this._texture&&R.push(this._texture),this._textureRoughness&&R.push(this._textureRoughness)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&R.push(this._textureRoughness)}dispose(R){var q,L;R&&(null===(q=this._texture)||void 0===q||q.dispose(),null===(L=this._textureRoughness)||void 0===L||L.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(R,q,L){return R.SHEEN&&q.addFallback(L++,"SHEEN"),L}getSamplers(R){R.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"isEnabled",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"linkSheenWithAlbedo",void 0),(0,B.d)([(0,N.K)()],W.prototype,"intensity",void 0),(0,B.d)([(0,N.k)()],W.prototype,"color",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"texture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useRoughnessFromMainTexture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"roughness",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"textureRoughness",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"albedoScaling",void 0);class H extends e.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class P extends y.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(R){this._scene.enableSubSurfaceForPrePass()&&R&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(R))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(R){this._volumeIndexOfRefraction=R>=1?R:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRSubSurface",130,new H,q),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=p.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=p.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=R.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=R._dirtyCallbacks[32]}isReadyForSubMesh(R,q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(R._areTexturesDirty&&q.texturesEnabled){if(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const R=this._getRefractionTexture(q);if(R&&T.e.RefractionTextureEnabled&&!R.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return R.SUBSURFACE=!1,R.SS_DISPERSION=!1,R.SS_TRANSLUCENCY=!1,R.SS_SCATTERING=!1,R.SS_REFRACTION=!1,R.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_THICKNESSANDMASK_TEXTURE=!1,R.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,R.SS_HAS_THICKNESS=!1,R.SS_REFRACTIONINTENSITY_TEXTURE=!1,R.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,R.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,R.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,R.SS_REFRACTIONMAP_3D=!1,R.SS_REFRACTIONMAP_OPPOSITEZ=!1,R.SS_LODINREFRACTIONALPHA=!1,R.SS_GAMMAREFRACTION=!1,R.SS_RGBDREFRACTION=!1,R.SS_LINEARSPECULARREFRACTION=!1,R.SS_LINKREFRACTIONTOTRANSPARENCY=!1,R.SS_ALBEDOFORREFRACTIONTINT=!1,R.SS_ALBEDOFORTRANSLUCENCYTINT=!1,R.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,R.SS_USE_THICKNESS_AS_DEPTH=!1,R.SS_USE_GLTF_TEXTURES=!1,R.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(R.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(R._areTexturesDirty){if(R.SUBSURFACE=!0,R.SS_DISPERSION=this._isDispersionEnabled,R.SS_TRANSLUCENCY=this._isTranslucencyEnabled,R.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_SCATTERING=this._isScatteringEnabled,R.SS_THICKNESSANDMASK_TEXTURE=!1,R.SS_REFRACTIONINTENSITY_TEXTURE=!1,R.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,R.SS_HAS_THICKNESS=!1,R.SS_USE_GLTF_TEXTURES=!1,R.SS_REFRACTION=!1,R.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_REFRACTIONMAP_3D=!1,R.SS_GAMMAREFRACTION=!1,R.SS_RGBDREFRACTION=!1,R.SS_LINEARSPECULARREFRACTION=!1,R.SS_REFRACTIONMAP_OPPOSITEZ=!1,R.SS_LODINREFRACTIONALPHA=!1,R.SS_LINKREFRACTIONTOTRANSPARENCY=!1,R.SS_ALBEDOFORREFRACTIONTINT=!1,R.SS_ALBEDOFORTRANSLUCENCYTINT=!1,R.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,R.SS_USE_THICKNESS_AS_DEPTH=!1,R.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,R._areTexturesDirty&&q.texturesEnabled&&(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&(0,D.P)(this._thicknessTexture,R,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&T.e.RefractionIntensityTextureEnabled&&(0,D.P)(this._refractionIntensityTexture,R,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&(0,D.P)(this._translucencyIntensityTexture,R,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&(0,D.P)(this._translucencyColorTexture,R,"SS_TRANSLUCENCYCOLOR_TEXTURE")),R.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,R.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,R.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,R.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&q.texturesEnabled){const L=this._getRefractionTexture(q);L&&T.e.RefractionTextureEnabled&&(R.SS_REFRACTION=!0,R.SS_REFRACTIONMAP_3D=L.isCube,R.SS_GAMMAREFRACTION=L.gammaSpace,R.SS_RGBDREFRACTION=L.isRGBD,R.SS_LINEARSPECULARREFRACTION=L.linearSpecularLOD,R.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&L.isCube?!L.invertZ:L.invertZ,R.SS_LODINREFRACTIONALPHA=L.lodLevelInAlpha,R.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,R.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,R.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=L.isCube&&L.boundingBoxSize,R.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(R.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(R,q,L,B){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)R.updateFloat2("vThicknessParam",0,0);else{B.getRenderingMesh().getWorldMatrix().decompose(F.h.o[0]);const q=Math.max(Math.abs(F.h.o[0].x),Math.abs(F.h.o[0].y),Math.abs(F.h.o[0].z));R.updateFloat2("vThicknessParam",this.minimumThickness*q,(this.maximumThickness-this.minimumThickness)*q)}}bindForSubMesh(R,q,L,B){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const N=B.materialDefines,h=this._material.isFrozen,Z=this._material.realTimeFiltering,z=N.LODBASEDMICROSFURACE,Y=this._getRefractionTexture(q);if(!R.useUbo||!h||!R.isSync){if(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&(R.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,D.q)(this._thicknessTexture,R,"thickness")),this._refractionIntensityTexture&&T.e.RefractionIntensityTextureEnabled&&N.SS_REFRACTIONINTENSITY_TEXTURE&&(R.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,D.q)(this._refractionIntensityTexture,R,"refractionIntensity")),this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&N.SS_TRANSLUCENCYCOLOR_TEXTURE&&(R.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,D.q)(this._translucencyColorTexture,R,"translucencyColor")),this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&N.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(R.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,D.q)(this._translucencyIntensityTexture,R,"translucencyIntensity")),Y&&T.e.RefractionTextureEnabled){R.Cj("refractionMatrix",Y.getRefractionTextureMatrix());let q=1;Y.isCube||Y.depth&&(q=Y.depth);const L=Y.getSize().width,B=this.volumeIndexOfRefraction;if(R.updateFloat4("vRefractionInfos",Y.level,1/B,q,this._invertRefractionY?-1:1),R.updateFloat4("vRefractionMicrosurfaceInfos",L,Y.lodGenerationScale,Y.lodGenerationOffset,1/this.indexOfRefraction),Z&&R.updateFloat2("vRefractionFilteringInfo",L,Math.log2(L)),Y.boundingBoxSize){const q=Y;R.updateVector3("vRefractionPosition",q.boundingBoxPosition),R.updateVector3("vRefractionSize",q.boundingBoxSize)}}this._isScatteringEnabled&&R.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),R.updateColor3("vDiffusionDistance",this.diffusionDistance),R.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),R.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),R.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),R.updateFloat("dispersion",this.dispersion)}q.texturesEnabled&&(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&R.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&T.e.RefractionIntensityTextureEnabled&&N.SS_REFRACTIONINTENSITY_TEXTURE&&R.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&N.SS_TRANSLUCENCYINTENSITY_TEXTURE&&R.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&N.SS_TRANSLUCENCYCOLOR_TEXTURE&&R.setTexture("translucencyColorSampler",this._translucencyColorTexture),Y&&T.e.RefractionTextureEnabled&&(z?R.setTexture("refractionSampler",Y):(R.setTexture("refractionSampler",Y._lodTextureMid||Y),R.setTexture("refractionSamplerLow",Y._lodTextureLow||Y),R.setTexture("refractionSamplerHigh",Y._lodTextureHigh||Y))))}_getRefractionTexture(R){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?R.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(R){T.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&R.push(this._refractionTexture)}hasTexture(R){return this._thicknessTexture===R||(this._refractionTexture===R||(this._refractionIntensityTexture===R||(this._translucencyIntensityTexture===R||this._translucencyColorTexture===R)))}hasRenderTargetTextures(){return!!(T.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(R){this._thicknessTexture&&R.push(this._thicknessTexture),this._refractionTexture&&R.push(this._refractionTexture),this._translucencyColorTexture&&R.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&R.push(this._translucencyIntensityTexture)}getAnimatables(R){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&R.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&R.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&R.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&R.push(this._translucencyIntensityTexture)}dispose(R){R&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(R,q,L){return R.SS_SCATTERING&&q.addFallback(L++,"SS_SCATTERING"),R.SS_TRANSLUCENCY&&q.addFallback(L++,"SS_TRANSLUCENCY"),L}getSamplers(R){R.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isRefractionEnabled",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isTranslucencyEnabled",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isDispersionEnabled",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markScenePrePassDirty")],P.prototype,"isScatteringEnabled",void 0),(0,B.d)([(0,N.K)()],P.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,B.d)([(0,N.K)()],P.prototype,"refractionIntensity",void 0),(0,B.d)([(0,N.K)()],P.prototype,"translucencyIntensity",void 0),(0,B.d)([(0,N.K)()],P.prototype,"useAlbedoToTintRefraction",void 0),(0,B.d)([(0,N.K)()],P.prototype,"useAlbedoToTintTranslucency",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"thicknessTexture",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"refractionTexture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"indexOfRefraction",void 0),(0,B.d)([(0,N.K)()],P.prototype,"_volumeIndexOfRefraction",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"volumeIndexOfRefraction",null),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"invertRefractionY",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkRefractionWithTransparency",void 0),(0,B.d)([(0,N.K)()],P.prototype,"minimumThickness",void 0),(0,B.d)([(0,N.K)()],P.prototype,"maximumThickness",void 0),(0,B.d)([(0,N.K)()],P.prototype,"useThicknessAsDepth",void 0),(0,B.d)([(0,N.k)()],P.prototype,"tintColor",void 0),(0,B.d)([(0,N.K)()],P.prototype,"tintColorAtDistance",void 0),(0,B.d)([(0,N.K)()],P.prototype,"dispersion",void 0),(0,B.d)([(0,N.k)()],P.prototype,"diffusionDistance",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useMaskFromThicknessTexture",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"refractionIntensityTexture",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"translucencyIntensityTexture",void 0),(0,B.d)([(0,N.k)()],P.prototype,"translucencyColor",void 0),(0,B.d)([(0,N.A)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"translucencyColorTexture",void 0),(0,B.d)([(0,N.K)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useGltfStyleTextures",void 0);var O=L(11305),E=L(11255),a=L(11322);const g={effect:null,subMesh:null};class Q extends e.b{constructor(R){super(R),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class i extends f.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(R){this._realTimeFiltering=R,this.Ag(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(R){this._realTimeFilteringQuality=R,this.Ag(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=R||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(R,q){super(R,q,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||i.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new F.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=p.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new p.e(0,0,0),this._albedoColor=new p.e(1,1,1),this._reflectivityColor=new p.e(1,1,1),this._reflectionColor=new p.e(1,1,1),this._emissiveColor=new p.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=i.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new Z.h(16),this._globalAmbientColor=new p.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new n(this),this.clearCoat=new I(this),this.iridescence=new m(this),this.anisotropy=new l(this),this.sheen=new W(this),this.subSurface=new P(this),this.detailMap=new O.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),T.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,z.b)(this.va()),this.prePassConfiguration=new r.e}get hasRenderTargetTextures(){return!!(T.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var R;return this._transparencyMode===i.PBRMATERIAL_OPAQUE||this._transparencyMode===i.PBRMATERIAL_ALPHATEST||(null===(R=this.subSurface)||void 0===R?void 0:R.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var R;return!!this._forceAlphaTest||(null===(R=this.subSurface)||void 0===R||!R.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===i.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.je&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==i.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.je||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(R,q,L){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const B=q._drawWrapper;if(B.effect&&this.isFrozen&&B._wasPreviouslyReady&&B._wasPreviouslyUsingInstances===L)return!0;q.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),q.materialDefines=new Q(this._eventInfo.defineNames));const N=q.materialDefines;if(this._isReadyForSubMesh(q))return!0;const Z=this.va(),z=Z.getEngine();if(N._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,Z.texturesEnabled)){if(this._albedoTexture&&T.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&T.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&T.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const R=this._getReflectionTexture();if(R&&T.e.ReflectionTextureEnabled){if(!R.isReadyOrNotBlocking())return!1;var Y;if(R.irradianceTexture){if(!R.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!R.sphericalPolynomial&&null!==(Y=R.getInternalTexture())&&void 0!==Y&&Y._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&T.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&T.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(T.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(z.getCaps().standardDerivatives&&this._bumpTexture&&T.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&T.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=N,this._eventInfo.subMesh=q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(N._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;z.getCaps().standardDerivatives||R.isVerticesDataPresent(C.e.NormalKind)||(R.createNormals(!0),h.d.Warn("PBRMaterial: Normals have been created for the mesh: "+R.name));const F=q.effect,e=N._areLightsDisposed;let y=this._prepareEffect(R,N,this.onCompiled,this.onError,L,null,q.getRenderingMesh().hasThinInstances),U=!1;if(y)if(this._onEffectCreatedObservable&&(g.effect=y,g.subMesh=q,this._onEffectCreatedObservable.notifyObservers(g)),this.allowShaderHotSwapping&&F&&!y.isReady()){if(y=F,N.markAsUnprocessed(),U=this.isFrozen,e)return N._areLightsDisposed=!0,!1}else Z.resetCachedMaterial(),q.setEffect(y,N,this._materialContext);return!(!q.effect||!q.effect.isReady())&&(N._renderId=Z.getRenderId(),B._wasPreviouslyReady=!U,B._wasPreviouslyUsingInstances=!!L,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(R,q){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(R,q,h,Z,z),!q.isDirty)return null;q.markAsProcessed();const Y=this.va().getEngine(),F=new t.b;let e=0;q.USESPHERICALINVERTEX&&F.addFallback(e++,"USESPHERICALINVERTEX"),q.FOG&&F.addFallback(e,"FOG"),q.SPECULARAA&&F.addFallback(e,"SPECULARAA"),q.POINTSIZE&&F.addFallback(e,"POINTSIZE"),q.LOGARITHMICDEPTH&&F.addFallback(e,"LOGARITHMICDEPTH"),q.PARALLAX&&F.addFallback(e,"PARALLAX"),q.PARALLAX_RHS&&F.addFallback(e,"PARALLAX_RHS"),q.PARALLAXOCCLUSION&&F.addFallback(e++,"PARALLAXOCCLUSION"),q.ENVIRONMENTBRDF&&F.addFallback(e++,"ENVIRONMENTBRDF"),q.TANGENT&&F.addFallback(e++,"TANGENT"),q.BUMP&&F.addFallback(e++,"BUMP"),e=(0,D.s)(q,F,this._maxSimultaneousLights,e++),q.SPECULARTERM&&F.addFallback(e++,"SPECULARTERM"),q.USESPHERICALFROMREFLECTIONMAP&&F.addFallback(e++,"USESPHERICALFROMREFLECTIONMAP"),q.USEIRRADIANCEMAP&&F.addFallback(e++,"USEIRRADIANCEMAP"),q.LIGHTMAP&&F.addFallback(e++,"LIGHTMAP"),q.NORMAL&&F.addFallback(e++,"NORMAL"),q.AMBIENT&&F.addFallback(e++,"AMBIENT"),q.EMISSIVE&&F.addFallback(e++,"EMISSIVE"),q.VERTEXCOLOR&&F.addFallback(e++,"VERTEXCOLOR"),q.MORPHTARGETS&&F.addFallback(e++,"MORPHTARGETS"),q.MULTIVIEW&&F.addFallback(0,"MULTIVIEW");const y=[C.e.PositionKind];q.NORMAL&&y.push(C.e.NormalKind),q.TANGENT&&y.push(C.e.TangentKind);for(let L=1;L<=6;++L)q["UV"+L]&&y.push(`uv${1===L?"":L}`);q.VERTEXCOLOR&&y.push(C.e.ColorKind),(0,D.y)(y,R,q,F),(0,D.C)(y,q),(0,D.F)(y,R,q),(0,D.w)(y,R,q);let U="pbr";const n=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],p=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],d=["Material","Scene","Mesh"],f={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:q.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=F,this._eventInfo.fallbackRank=e,this._eventInfo.defines=q,this._eventInfo.uniforms=n,this._eventInfo.attributes=y,this._eventInfo.samplers=p,this._eventInfo.uniformBuffersNames=d,this._eventInfo.customCode=void 0,this._eventInfo.mesh=R,this._eventInfo.indexParameters=f,this._callbackPluginEventGeneric(128,this._eventInfo),a.d.AddUniformsAndSamplers(n,p),r.e.AddUniforms(n),r.e.AddSamplers(p),(0,E.e)(n),c.d&&(c.d.PrepareUniforms(n,q),c.d.PrepareSamplers(p,q)),(0,D.cb)({uniformsNames:n,uniformBuffersNames:d,samplers:p,defines:q,maxSimultaneousLights:this._maxSimultaneousLights});const v={};this.customShaderNameResolve&&(U=this.customShaderNameResolve(U,n,d,p,q,y,v));const T=q.toString(),S=Y.createEffect(U,{attributes:y,uniformsNames:n,uniformBuffersNames:d,samplers:p,defines:T,fallbacks:F,onCompiled:B,onError:N,indexParameters:f,processFinalCode:v.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:q.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([L.e(21),L.e(43)]).then(L.bind(L,13286)),Promise.all([L.e(22),L.e(44)]).then(L.bind(L,13309))]):await Promise.all([Promise.all([L.e(25),L.e(45)]).then(L.bind(L,13318)),Promise.all([L.e(27),L.e(46)]).then(L.bind(L,13339))]),this._shadersLoaded=!0}},Y);return this._eventInfo.customCode=void 0,S}_prepareDefines(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=this.va(),Z=h.getEngine();(0,D.L)(h,R,q,!0,this._maxSimultaneousLights,this._disableLighting),q._needNormals=!0,(0,D.X)(h,q);const z=this.needAlphaBlendingForMesh(R)&&this.va().useOrderIndependentTransparency;if((0,D._)(h,q,this.canRenderToMRT&&!z),(0,D.Y)(h,q,z),a.d.PrepareDefines(Z.currentRenderPassId,R,q),q.METALLICWORKFLOW=this.isMetallicWorkflow(),q._areTexturesDirty){q._needUVs=!1;for(let R=1;R<=6;++R)q["MAINUV"+R]=!1;if(h.texturesEnabled){q.ALBEDODIRECTUV=0,q.AMBIENTDIRECTUV=0,q.OPACITYDIRECTUV=0,q.EMISSIVEDIRECTUV=0,q.REFLECTIVITYDIRECTUV=0,q.MICROSURFACEMAPDIRECTUV=0,q.METALLIC_REFLECTANCEDIRECTUV=0,q.REFLECTANCEDIRECTUV=0,q.BUMPDIRECTUV=0,q.LIGHTMAPDIRECTUV=0,Z.getCaps().textureLOD&&(q.LODBASEDMICROSFURACE=!0),this._albedoTexture&&T.e.DiffuseTextureEnabled?((0,D.P)(this._albedoTexture,q,"ALBEDO"),q.GAMMAALBEDO=this._albedoTexture.gammaSpace):q.ALBEDO=!1,this._ambientTexture&&T.e.AmbientTextureEnabled?((0,D.P)(this._ambientTexture,q,"AMBIENT"),q.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):q.AMBIENT=!1,this._opacityTexture&&T.e.OpacityTextureEnabled?((0,D.P)(this._opacityTexture,q,"OPACITY"),q.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):q.OPACITY=!1;const R=this._getReflectionTexture();if(R&&T.e.ReflectionTextureEnabled){switch(q.REFLECTION=!0,q.GAMMAREFLECTION=R.gammaSpace,q.RGBDREFLECTION=R.isRGBD,q.LODINREFLECTIONALPHA=R.lodLevelInAlpha,q.LINEARSPECULARREFLECTION=R.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(q.NUM_SAMPLES=""+this.realTimeFilteringQuality,Z._features.needTypeSuffixInShaderConstants&&(q.NUM_SAMPLES=q.NUM_SAMPLES+"u"),q.REALTIME_FILTERING=!0):q.REALTIME_FILTERING=!1,q.INVERTCUBICMAP=R.coordinatesMode===v.c.INVCUBIC_MODE,q.REFLECTIONMAP_3D=R.isCube,q.REFLECTIONMAP_OPPOSITEZ=q.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!R.invertZ:R.invertZ,q.REFLECTIONMAP_CUBIC=!1,q.REFLECTIONMAP_EXPLICIT=!1,q.REFLECTIONMAP_PLANAR=!1,q.REFLECTIONMAP_PROJECTION=!1,q.REFLECTIONMAP_SKYBOX=!1,q.REFLECTIONMAP_SPHERICAL=!1,q.REFLECTIONMAP_EQUIRECTANGULAR=!1,q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,R.coordinatesMode){case v.c.EXPLICIT_MODE:q.REFLECTIONMAP_EXPLICIT=!0;break;case v.c.PLANAR_MODE:q.REFLECTIONMAP_PLANAR=!0;break;case v.c.PROJECTION_MODE:q.REFLECTIONMAP_PROJECTION=!0;break;case v.c.SKYBOX_MODE:q.REFLECTIONMAP_SKYBOX=!0;break;case v.c.SPHERICAL_MODE:q.REFLECTIONMAP_SPHERICAL=!0;break;case v.c.EQUIRECTANGULAR_MODE:q.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case v.c.FIXED_EQUIRECTANGULAR_MODE:q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case v.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case v.c.CUBIC_MODE:case v.c.INVCUBIC_MODE:default:q.REFLECTIONMAP_CUBIC=!0,q.USE_LOCAL_REFLECTIONMAP_CUBIC=!!R.boundingBoxSize}R.coordinatesMode!==v.c.SKYBOX_MODE&&(R.irradianceTexture?(q.USEIRRADIANCEMAP=!0,q.USESPHERICALFROMREFLECTIONMAP=!1):R.isCube&&(q.USESPHERICALFROMREFLECTIONMAP=!0,q.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||Z.getCaps().maxVaryingVectors<=8?q.USESPHERICALINVERTEX=!1:q.USESPHERICALINVERTEX=!0))}else q.REFLECTION=!1,q.REFLECTIONMAP_3D=!1,q.REFLECTIONMAP_SPHERICAL=!1,q.REFLECTIONMAP_PLANAR=!1,q.REFLECTIONMAP_CUBIC=!1,q.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,q.REFLECTIONMAP_PROJECTION=!1,q.REFLECTIONMAP_SKYBOX=!1,q.REFLECTIONMAP_EXPLICIT=!1,q.REFLECTIONMAP_EQUIRECTANGULAR=!1,q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,q.INVERTCUBICMAP=!1,q.USESPHERICALFROMREFLECTIONMAP=!1,q.USEIRRADIANCEMAP=!1,q.USESPHERICALINVERTEX=!1,q.REFLECTIONMAP_OPPOSITEZ=!1,q.LODINREFLECTIONALPHA=!1,q.GAMMAREFLECTION=!1,q.RGBDREFLECTION=!1,q.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&T.e.LightmapTextureEnabled?((0,D.P)(this._lightmapTexture,q,"LIGHTMAP"),q.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,q.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,q.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):q.LIGHTMAP=!1,this._emissiveTexture&&T.e.EmissiveTextureEnabled?((0,D.P)(this._emissiveTexture,q,"EMISSIVE"),q.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):q.EMISSIVE=!1,T.e.SpecularTextureEnabled?(this._metallicTexture?((0,D.P)(this._metallicTexture,q,"REFLECTIVITY"),q.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,q.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,q.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,q.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,q.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,D.P)(this._reflectivityTexture,q,"REFLECTIVITY"),q.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,q.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,q.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):q.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(q.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,D.P)(this._metallicReflectanceTexture,q,"METALLIC_REFLECTANCE"),q.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):q.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,D.P)(this._reflectanceTexture,q,"REFLECTANCE"),q.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):q.REFLECTANCE=!1):(q.METALLIC_REFLECTANCE=!1,q.REFLECTANCE=!1),this._microSurfaceTexture?(0,D.P)(this._microSurfaceTexture,q,"MICROSURFACEMAP"):q.MICROSURFACEMAP=!1):(q.REFLECTIVITY=!1,q.MICROSURFACEMAP=!1),Z.getCaps().standardDerivatives&&this._bumpTexture&&T.e.BumpTextureEnabled&&!this._disableBumpMap?((0,D.P)(this._bumpTexture,q,"BUMP"),this._useParallax&&this._albedoTexture&&T.e.DiffuseTextureEnabled?(q.PARALLAX=!0,q.PARALLAX_RHS=h.useRightHandedSystem,q.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):q.PARALLAX=!1,q.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(q.BUMP=!1,q.PARALLAX=!1,q.PARALLAX_RHS=!1,q.PARALLAXOCCLUSION=!1,q.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&T.e.ReflectionTextureEnabled?(q.ENVIRONMENTBRDF=!0,q.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(q.ENVIRONMENTBRDF=!1,q.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?q.ALPHAFROMALBEDO=!0:q.ALPHAFROMALBEDO=!1}q.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===i.LIGHTFALLOFF_STANDARD?(q.USEPHYSICALLIGHTFALLOFF=!1,q.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===i.LIGHTFALLOFF_GLTF?(q.USEPHYSICALLIGHTFALLOFF=!1,q.USEGLTFLIGHTFALLOFF=!0):(q.USEPHYSICALLIGHTFALLOFF=!0,q.USEGLTFLIGHTFALLOFF=!1),q.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Pg&&this._twoSidedLighting?q.TWOSIDEDLIGHTING=!0:q.TWOSIDEDLIGHTING=!1,q.SPECULARAA=Z.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(q._areTexturesDirty||q._areMiscDirty)&&(q.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,q.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,q.ALPHABLEND=this.needAlphaBlendingForMesh(R),q.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,q.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),q._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(q),q.FORCENORMALFORWARD=this._forceNormalForward,q.RADIANCEOCCLUSION=this._useRadianceOcclusion,q.HORIZONOCCLUSION=this._useHorizonOcclusion,q._areMiscDirty&&((0,D.T)(R,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(R)||this._forceAlphaTest,q,this._applyDecalMapAfterDetailMap),q.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!R.isVerticesDataPresent(C.e.NormalKind),q.DEBUGMODE=this._debugMode),(0,D.K)(h,Z,this,q,!!L,B,N),this._eventInfo.defines=q,this._eventInfo.mesh=R,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,D.I)(R,q,!0,!0,!0,this._transparencyMode!==i.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(R,q,L){const B={clipPlane:!1,useInstances:!1,...L};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const L=new Q(this._eventInfo.defineNames),N=this._prepareEffect(R,L,void 0,void 0,B.useInstances,B.clipPlane,R.hasThinInstances);this._onEffectCreatedObservable&&(g.effect=N,g.subMesh=null,this._onEffectCreatedObservable.notifyObservers(g)),N.isReady()?q&&q(this):N.onCompileObservable.add((()=>{q&&q(this)}))})()}buildUniformLayout(){const R=this._uniformBuffer;R.addUniform("vAlbedoInfos",2),R.addUniform("vAmbientInfos",4),R.addUniform("vOpacityInfos",2),R.addUniform("vEmissiveInfos",2),R.addUniform("vLightmapInfos",2),R.addUniform("vReflectivityInfos",3),R.addUniform("vMicroSurfaceSamplerInfos",2),R.addUniform("vReflectionInfos",2),R.addUniform("vReflectionFilteringInfo",2),R.addUniform("vReflectionPosition",3),R.addUniform("vReflectionSize",3),R.addUniform("vBumpInfos",3),R.addUniform("albedoMatrix",16),R.addUniform("ambientMatrix",16),R.addUniform("opacityMatrix",16),R.addUniform("emissiveMatrix",16),R.addUniform("lightmapMatrix",16),R.addUniform("reflectivityMatrix",16),R.addUniform("microSurfaceSamplerMatrix",16),R.addUniform("bumpMatrix",16),R.addUniform("vTangentSpaceParams",2),R.addUniform("reflectionMatrix",16),R.addUniform("vReflectionColor",3),R.addUniform("vAlbedoColor",4),R.addUniform("vLightingIntensity",4),R.addUniform("vReflectionMicrosurfaceInfos",3),R.addUniform("pointSize",1),R.addUniform("vReflectivityColor",4),R.addUniform("vEmissiveColor",3),R.addUniform("vAmbientColor",3),R.addUniform("vDebugMode",2),R.addUniform("vMetallicReflectanceFactors",4),R.addUniform("vMetallicReflectanceInfos",2),R.addUniform("metallicReflectanceMatrix",16),R.addUniform("vReflectanceInfos",2),R.addUniform("reflectanceMatrix",16),R.addUniform("vSphericalL00",3),R.addUniform("vSphericalL1_1",3),R.addUniform("vSphericalL10",3),R.addUniform("vSphericalL11",3),R.addUniform("vSphericalL2_2",3),R.addUniform("vSphericalL2_1",3),R.addUniform("vSphericalL20",3),R.addUniform("vSphericalL21",3),R.addUniform("vSphericalL22",3),R.addUniform("vSphericalX",3),R.addUniform("vSphericalY",3),R.addUniform("vSphericalZ",3),R.addUniform("vSphericalXX_ZZ",3),R.addUniform("vSphericalYY_ZZ",3),R.addUniform("vSphericalZZ",3),R.addUniform("vSphericalXY",3),R.addUniform("vSphericalYZ",3),R.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(R,q,L){const B=this.va(),N=L.materialDefines;if(!N)return;const h=L.effect;if(!h)return;this._activeEffect=h,q.getMeshUniformBuffer().bindToEffect(h,"Mesh"),q.transferToEffect(R);const Z=B.getEngine();this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,B,q,R,this.isFrozen),a.d.Bind(Z.currentRenderPassId,this._activeEffect,q,R),this._eventInfo.subMesh=L,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),N.OBJECTSPACE_NORMALMAP&&(R.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const z=this._mustRebind(B,h,L,q.visibility);(0,D.d)(q,this._activeEffect,this.prePassConfiguration);let F=null;const C=this._uniformBuffer;if(z){if(this.bindViewProjection(h),F=this._getReflectionTexture(),!C.useUbo||!this.isFrozen||!C.isSync||L._drawWrapper._forceRebindOnNextCall){var e;if(B.texturesEnabled){if(this._albedoTexture&&T.e.DiffuseTextureEnabled&&(C.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,D.q)(this._albedoTexture,C,"albedo")),this._ambientTexture&&T.e.AmbientTextureEnabled&&(C.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,D.q)(this._ambientTexture,C,"ambient")),this._opacityTexture&&T.e.OpacityTextureEnabled&&(C.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,D.q)(this._opacityTexture,C,"opacity")),F&&T.e.ReflectionTextureEnabled){if(C.Cj("reflectionMatrix",F.getReflectionTextureMatrix()),C.updateFloat2("vReflectionInfos",F.level,0),F.boundingBoxSize){const R=F;C.updateVector3("vReflectionPosition",R.boundingBoxPosition),C.updateVector3("vReflectionSize",R.boundingBoxSize)}if(this.realTimeFiltering){const R=F.getSize().width;C.updateFloat2("vReflectionFilteringInfo",R,Math.log2(R))}if(!N.USEIRRADIANCEMAP){const R=F.sphericalPolynomial;if(N.USESPHERICALFROMREFLECTIONMAP&&R)if(N.SPHERICAL_HARMONICS){const q=R.preScaledHarmonics;C.updateVector3("vSphericalL00",q.l00),C.updateVector3("vSphericalL1_1",q.l1_1),C.updateVector3("vSphericalL10",q.l10),C.updateVector3("vSphericalL11",q.l11),C.updateVector3("vSphericalL2_2",q.l2_2),C.updateVector3("vSphericalL2_1",q.l2_1),C.updateVector3("vSphericalL20",q.l20),C.updateVector3("vSphericalL21",q.l21),C.updateVector3("vSphericalL22",q.l22)}else C.updateFloat3("vSphericalX",R.x.x,R.x.y,R.x.z),C.updateFloat3("vSphericalY",R.y.x,R.y.y,R.y.z),C.updateFloat3("vSphericalZ",R.z.x,R.z.y,R.z.z),C.updateFloat3("vSphericalXX_ZZ",R.xx.x-R.zz.x,R.xx.y-R.zz.y,R.xx.z-R.zz.z),C.updateFloat3("vSphericalYY_ZZ",R.yy.x-R.zz.x,R.yy.y-R.zz.y,R.yy.z-R.zz.z),C.updateFloat3("vSphericalZZ",R.zz.x,R.zz.y,R.zz.z),C.updateFloat3("vSphericalXY",R.xy.x,R.xy.y,R.xy.z),C.updateFloat3("vSphericalYZ",R.yz.x,R.yz.y,R.yz.z),C.updateFloat3("vSphericalZX",R.zx.x,R.zx.y,R.zx.z)}C.updateFloat3("vReflectionMicrosurfaceInfos",F.getSize().width,F.lodGenerationScale,F.lodGenerationOffset)}this._emissiveTexture&&T.e.EmissiveTextureEnabled&&(C.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,D.q)(this._emissiveTexture,C,"emissive")),this._lightmapTexture&&T.e.LightmapTextureEnabled&&(C.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,D.q)(this._lightmapTexture,C,"lightmap")),T.e.SpecularTextureEnabled&&(this._metallicTexture?(C.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,D.q)(this._metallicTexture,C,"reflectivity")):this._reflectivityTexture&&(C.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,D.q)(this._reflectivityTexture,C,"reflectivity")),this._metallicReflectanceTexture&&(C.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,D.q)(this._metallicReflectanceTexture,C,"metallicReflectance")),this._reflectanceTexture&&N.REFLECTANCE&&(C.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,D.q)(this._reflectanceTexture,C,"reflectance")),this._microSurfaceTexture&&(C.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,D.q)(this._microSurfaceTexture,C,"microSurfaceSampler"))),this._bumpTexture&&Z.getCaps().standardDerivatives&&T.e.BumpTextureEnabled&&!this._disableBumpMap&&(C.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,D.q)(this._bumpTexture,C,"bump"),B._mirroredCameraPosition?C.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):C.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&C.updateFloat("pointSize",this.pointSize),N.METALLICWORKFLOW){var y;p.i.gb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,p.i.gb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,C.updateColor4("vReflectivityColor",p.i.gb[0],1);const R=(null===(y=this.subSurface)||void 0===y?void 0:y._indexOfRefraction)??1.5,q=1,L=Math.pow((R-q)/(R+q),2);this._metallicReflectanceColor.scaleToRef(L*this._metallicF0Factor,p.i.gb[0]);const B=this._metallicF0Factor;C.updateColor4("vMetallicReflectanceFactors",p.i.gb[0],B)}else C.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);C.updateColor3("vEmissiveColor",T.e.EmissiveTextureEnabled?this._emissiveColor:p.e.BlackReadOnly),C.updateColor3("vReflectionColor",this._reflectionColor),!N.SS_REFRACTION&&null!==(e=this.subSurface)&&void 0!==e&&e._linkRefractionWithTransparency?C.updateColor4("vAlbedoColor",this._albedoColor,1):C.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*B.environmentIntensity,this._lightingInfos.w=this._specularIntensity,C.updateVector4("vLightingIntensity",this._lightingInfos),B.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),C.updateColor3("vAmbientColor",this._globalAmbientColor),C.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}B.texturesEnabled&&(this._albedoTexture&&T.e.DiffuseTextureEnabled&&C.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&T.e.AmbientTextureEnabled&&C.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&T.e.OpacityTextureEnabled&&C.setTexture("opacitySampler",this._opacityTexture),F&&T.e.ReflectionTextureEnabled&&(N.LODBASEDMICROSFURACE?C.setTexture("reflectionSampler",F):(C.setTexture("reflectionSampler",F._lodTextureMid||F),C.setTexture("reflectionSamplerLow",F._lodTextureLow||F),C.setTexture("reflectionSamplerHigh",F._lodTextureHigh||F)),N.USEIRRADIANCEMAP&&C.setTexture("irradianceSampler",F.irradianceTexture)),N.ENVIRONMENTBRDF&&C.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&T.e.EmissiveTextureEnabled&&C.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&T.e.LightmapTextureEnabled&&C.setTexture("lightmapSampler",this._lightmapTexture),T.e.SpecularTextureEnabled&&(this._metallicTexture?C.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&C.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&C.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&N.REFLECTANCE&&C.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&C.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&Z.getCaps().standardDerivatives&&T.e.BumpTextureEnabled&&!this._disableBumpMap&&C.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(q)&&this.va().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,E.f)(this._activeEffect,this,B),this.bindEyePosition(h)}else B.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(z||!this.isFrozen){var U;if(B.lightsEnabled&&!this._disableLighting&&(0,D.k)(B,q,this._activeEffect,N,this._maxSimultaneousLights),(B.fogEnabled&&q.applyFog&&B.fogMode!==Y.b.FOGMODE_NONE||F||this.subSurface.refractionTexture||q.receiveShadows||N.PREPASS)&&this.bindView(h),(0,D.g)(B,q,this._activeEffect,!0),N.NUM_MORPH_INFLUENCERS&&(0,D.n)(q,this._activeEffect),N.BAKED_VERTEX_ANIMATION_TEXTURE)null===(U=q.bakedVertexAnimationManager)||void 0===U||U.bind(h,N.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,D.l)(N,this._activeEffect,B)}this._afterBind(q,this._activeEffect,L),C.update()}getAnimatables(){const R=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&R.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&R.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&R.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&R.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&R.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?R.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&R.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&R.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&R.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&R.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&R.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&R.push(this._microSurfaceTexture),R}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const R=super.getActiveTextures();return this._albedoTexture&&R.push(this._albedoTexture),this._ambientTexture&&R.push(this._ambientTexture),this._opacityTexture&&R.push(this._opacityTexture),this._reflectionTexture&&R.push(this._reflectionTexture),this._emissiveTexture&&R.push(this._emissiveTexture),this._reflectivityTexture&&R.push(this._reflectivityTexture),this._metallicTexture&&R.push(this._metallicTexture),this._metallicReflectanceTexture&&R.push(this._metallicReflectanceTexture),this._reflectanceTexture&&R.push(this._reflectanceTexture),this._microSurfaceTexture&&R.push(this._microSurfaceTexture),this._bumpTexture&&R.push(this._bumpTexture),this._lightmapTexture&&R.push(this._lightmapTexture),R}hasTexture(R){return!!super.hasTexture(R)||(this._albedoTexture===R||(this._ambientTexture===R||(this._opacityTexture===R||(this._reflectionTexture===R||(this._emissiveTexture===R||(this._reflectivityTexture===R||(this._metallicTexture===R||(this._metallicReflectanceTexture===R||(this._reflectanceTexture===R||(this._microSurfaceTexture===R||(this._bumpTexture===R||this._lightmapTexture===R)))))))))))}setPrePassRenderer(){var R;if(null===(R=this.subSurface)||void 0===R||!R.isScatteringEnabled)return!1;const q=this.va().enableSubSurfaceForPrePass();return q&&(q.enabled=!0),!0}dispose(R,q){var L,B,N,h,Z,z,Y,F,C,e,y,U;(this._breakShaderLoadedCheck=!0,q)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(L=this._albedoTexture)||void 0===L||L.dispose(),null===(B=this._ambientTexture)||void 0===B||B.dispose(),null===(N=this._opacityTexture)||void 0===N||N.dispose(),null===(h=this._reflectionTexture)||void 0===h||h.dispose(),null===(Z=this._emissiveTexture)||void 0===Z||Z.dispose(),null===(z=this._metallicTexture)||void 0===z||z.dispose(),null===(Y=this._reflectivityTexture)||void 0===Y||Y.dispose(),null===(F=this._bumpTexture)||void 0===F||F.dispose(),null===(C=this._lightmapTexture)||void 0===C||C.dispose(),null===(e=this._metallicReflectanceTexture)||void 0===e||e.dispose(),null===(y=this._reflectanceTexture)||void 0===y||y.dispose(),null===(U=this._microSurfaceTexture)||void 0===U||U.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(R,q)}}i.PBRMATERIAL_OPAQUE=d.c.MATERIAL_OPAQUE,i.PBRMATERIAL_ALPHATEST=d.c.MATERIAL_ALPHATEST,i.PBRMATERIAL_ALPHABLEND=d.c.MATERIAL_ALPHABLEND,i.PBRMATERIAL_ALPHATESTANDBLEND=d.c.MATERIAL_ALPHATESTANDBLEND,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,i.LIGHTFALLOFF_PHYSICAL=0,i.LIGHTFALLOFF_GLTF=1,i.LIGHTFALLOFF_STANDARD=2,i.ForceGLSL=!1,(0,B.d)([(0,N.q)()],i.prototype,"_imageProcessingConfiguration",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsMiscDirty")],i.prototype,"debugMode",void 0)},10880:(R,q,L)=>{"use strict";L.d(q,{c:()=>Z});var B=L(10767);const N=new Map;function h(R,q){(function(R){return N.delete(R)})(R)&&B.d.Warn(`Extension with the name '${name}' already exists`),N.set(R,q)}function Z(R,q){"image/ktx"!==q&&"image/ktx2"!==q||(R=".ktx"),N.has(R)||(R.endsWith(".dds")&&h(".dds",(()=>L.e(12).then(L.bind(L,12730)).then((R=>new R._DDSTextureLoader)))),R.endsWith(".basis")&&h(".basis",(()=>L.e(13).then(L.bind(L,12738)).then((R=>new R._BasisTextureLoader)))),R.endsWith(".env")&&h(".env",(()=>L.e(14).then(L.bind(L,12743)).then((R=>new R._ENVTextureLoader)))),R.endsWith(".hdr")&&h(".hdr",(()=>L.e(15).then(L.bind(L,12750)).then((R=>new R._HDRTextureLoader)))),(R.endsWith(".ktx")||R.endsWith(".ktx2"))&&(h(".ktx",(()=>L.e(16).then(L.bind(L,12752)).then((R=>new R._KTXTextureLoader)))),h(".ktx2",(()=>L.e(16).then(L.bind(L,12752)).then((R=>new R._KTXTextureLoader))))),R.endsWith(".tga")&&h(".tga",(()=>L.e(17).then(L.bind(L,12761)).then((R=>new R._TGATextureLoader)))),R.endsWith(".exr")&&h(".exr",(()=>L.e(18).then(L.bind(L,12770)).then((R=>new R._ExrTextureLoader)))));const B=N.get(R);return B?Promise.resolve(B(q)):null}},11283:(R,q,L)=>{"use strict";L.d(q,{d:()=>y});var B=L(11053),N=L(11058),h=L(10760),Z=L(11081),z=L(10797),Y=L(10898),F=(L(10805),L(11287));class C{get wrapU(){return this._wrapU}set wrapU(R){this._wrapU=R}get wrapV(){return this._wrapV}set wrapV(R){this._wrapV=R}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(R){this._texture&&(this._texture.isCube=R)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(R){this._texture&&(this._texture.is3D=R)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(R){this._texture&&(this._texture.is2DArray=R)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(R){return void 0!==(null===R||void 0===R?void 0:R.shareDepth)}constructor(R){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=F.c.Zero(),this._cachedBaseSize=F.c.Zero(),this._initialSamplingMode=2,this._texture=C._IsRenderTargetWrapper(R)?R.texture:R,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(R){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(R,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var e=L(11117);class y extends C{set je(R){this._hasAlpha!==R&&(this._hasAlpha=R,this._scene&&this._scene.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))))}get je(){return this._hasAlpha}set getAlphaFromRGB(R){this._getAlphaFromRGB!==R&&(this._getAlphaFromRGB=R,this._scene&&this._scene.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(R){this._coordinatesIndex!==R&&(this._coordinatesIndex=R,this._scene&&this._scene.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(R){this._coordinatesMode!==R&&(this._coordinatesMode=R,this._scene&&this._scene.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(R){this._wrapU=R}get wrapV(){return this._wrapV}set wrapV(R){this._wrapV=R}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(R){this._texture?this._texture.isCube=R:this._isCube=R}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(R){this._texture&&(this._texture.is3D=R)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(R){this._texture&&(this._texture.is2DArray=R)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(R){var q;if(this._texture){if(this._texture._gammaSpace===R)return;this._texture._gammaSpace=R}else{if(this._gammaSpace===R)return;this._gammaSpace=R}null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(R){var q;R!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=R),null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(R){this._texture&&(this._texture._lodGenerationOffset=R)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(R){this._texture&&(this._texture._lodGenerationScale=R)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(R){this._texture&&(this._texture._linearSpecularLOD=R)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(R){this._texture&&(this._texture._irradianceTexture=R)}get uid(){return this._uid||(this._uid=(0,Y.e)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(R){this._onDisposeObserver&&this.ej.remove(this._onDisposeObserver),this._onDisposeObserver=this.ej.add(R)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=y.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.ej=new h.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,R?y._IsScene(R)?this._scene=R:this._engine=R:this._scene=z.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=q,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return Z.c.IdentityReadOnly}getReflectionTextureMatrix(){return Z.c.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(R){}get canRescale(){return!1}_getFromCache(R,q,L,B,N,h){const Z=this._getEngine();if(!Z)return null;const z=Z._getUseSRGBBuffer(!!N,q),Y=Z.getLoadedTexturesCache();for(let F=0;F<Y.length;F++){const Z=Y[F];if((void 0===N||z===Z._useSRGBBuffer)&&(void 0===B||B===Z.invertY)&&Z.url===R&&Z.generateMipMaps===!q&&(!L||L===Z.samplingMode)&&(void 0===h||h===Z.isCube))return Z.incrementReferences(),Z}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const R=this.va();R&&R.markAllMaterialsAsDirty(1)}readPixels(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const F=this._getEngine();if(!F)return null;const C=this.getSize();let e=C.width,y=C.height;0!==q&&(e/=Math.pow(2,q),y/=Math.pow(2,q),e=Math.round(e),y=Math.round(y)),z=Math.min(e,z),Y=Math.min(y,Y);try{return this._texture.isCube?F._readTexturePixels(this._texture,z,Y,R,q,L,B,N,h,Z):F._readTexturePixels(this._texture,z,Y,-1,q,L,B,N,h,Z)}catch(U){return null}}_readPixelsSync(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const h=this.getSize();let Z=h.width,z=h.height;const Y=this._getEngine();if(!Y)return null;0!=q&&(Z/=Math.pow(2,q),z/=Math.pow(2,q),Z=Math.round(Z),z=Math.round(z));try{return this._texture.isCube?Y._readTexturePixelsSync(this._texture,Z,z,R,q,L,B,N):Y._readTexturePixelsSync(this._texture,Z,z,-1,q,L,B,N)}catch(F){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const R=this._scene.textures.indexOf(this);if(R>=0&&this._scene.textures.splice(R,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const R=this._parentContainer.textures.indexOf(this);R>-1&&this._parentContainer.textures.splice(R,1),this._parentContainer=null}}this.ej.notifyObservers(this),this.ej.clear(),this.metadata=null,super.dispose()}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!R)return null;const q=e.b.Serialize(this);return e.b.AppendSerializedAnimations(this,q),q}static WhenAllReady(R,q){let L=R.length;if(0!==L)for(let B=0;B<R.length;B++){const N=R[B];if(N.isReady())0===--L&&q();else{const R=N.onLoadObservable;R?R.addOnce((()=>{0===--L&&q()})):0===--L&&q()}}else q()}static _IsScene(R){return"Scene"===R.getClassName()}}y.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,B.d)([(0,N.K)()],y.prototype,"uniqueId",void 0),(0,B.d)([(0,N.K)()],y.prototype,"name",void 0),(0,B.d)([(0,N.K)()],y.prototype,"metadata",void 0),(0,B.d)([(0,N.K)("je")],y.prototype,"_hasAlpha",void 0),(0,B.d)([(0,N.K)("getAlphaFromRGB")],y.prototype,"_getAlphaFromRGB",void 0),(0,B.d)([(0,N.K)()],y.prototype,"level",void 0),(0,B.d)([(0,N.K)("coordinatesIndex")],y.prototype,"_coordinatesIndex",void 0),(0,B.d)([(0,N.K)()],y.prototype,"optimizeUVAllocation",void 0),(0,B.d)([(0,N.K)("coordinatesMode")],y.prototype,"_coordinatesMode",void 0),(0,B.d)([(0,N.K)()],y.prototype,"wrapU",null),(0,B.d)([(0,N.K)()],y.prototype,"wrapV",null),(0,B.d)([(0,N.K)()],y.prototype,"wrapR",void 0),(0,B.d)([(0,N.K)()],y.prototype,"anisotropicFilteringLevel",void 0),(0,B.d)([(0,N.K)()],y.prototype,"isCube",null),(0,B.d)([(0,N.K)()],y.prototype,"is3D",null),(0,B.d)([(0,N.K)()],y.prototype,"is2DArray",null),(0,B.d)([(0,N.K)()],y.prototype,"gammaSpace",null),(0,B.d)([(0,N.K)()],y.prototype,"invertZ",void 0),(0,B.d)([(0,N.K)()],y.prototype,"lodLevelInAlpha",void 0),(0,B.d)([(0,N.K)()],y.prototype,"lodGenerationOffset",null),(0,B.d)([(0,N.K)()],y.prototype,"lodGenerationScale",null),(0,B.d)([(0,N.K)()],y.prototype,"linearSpecularLOD",null),(0,B.d)([(0,N.A)()],y.prototype,"irradianceTexture",null),(0,B.d)([(0,N.K)()],y.prototype,"isRenderTarget",void 0)},12073:(R,q,L)=>{"use strict";var B=L(11595),N=L(11283);N.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(N.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=B.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((R=>{this._texture._sphericalPolynomial=R,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(R){this._texture&&(this._texture._sphericalPolynomial=R)},enumerable:!0,configurable:!0})},12102:(R,q,L)=>{"use strict";L.d(q,{c:()=>y});var B=L(11053),N=L(11058),h=L(10757),Z=L(11081),z=L(11283),Y=L(11277),F=L(10889),C=L(10760),e=L(11117);L(11636);class y extends z.d{set boundingBoxSize(R){if(this._boundingBoxSize&&this._boundingBoxSize.equals(R))return;this._boundingBoxSize=R;const q=this.va();q&&q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(R){this._rotationY=R,this.setReflectionTextureMatrix(Z.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(R,q,L){let B="";return R.forEach((R=>B+=R)),new y(B,q,null,L,R)}static CreateFromPrefilteredData(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const h=new y(R,q,null,!1,null,null,null,void 0,!0,L,B);return q.useDelayedTextureLoading=N,h}constructor(R,q){var L;let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]&&arguments[10],r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,c=arguments.length>13?arguments[13]:void 0,d=arguments.length>14?arguments[14]:void 0;super(q),this.onLoadObservable=new C.b,this.boundingBoxPosition=Z.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Z.c,this._buffer=null,this.name=R,this.url=R,this._noMipmap=N,this.je=!1,this.isCube=!0,this._textureMatrix=Z.c.Identity(),this.coordinatesMode=Y.c.CUBIC_MODE;let f=null,v=null;null===B||Array.isArray(B)?(this._noMipmap=N,this._format=e,this._createPolynomials=n,f=B,this._loaderOptions=c,this._useSRGBBuffer=d,this._lodScale=r,this._lodOffset=p):(f=B.extensions??null,this._noMipmap=B.noMipmap??!1,h=B.files??null,v=B.buffer??null,this._format=B.format??5,y=B.prefiltered??!1,U=B.forcedExtension??null,this._createPolynomials=B.createPolynomials??!1,this._lodScale=B.lodScale??.8,this._lodOffset=B.lodOffset??0,this._loaderOptions=B.loaderOptions,this._useSRGBBuffer=B.useSRGBBuffer,z=B.X??null,F=B.onError??null),(R||h)&&this.updateURL(R,U,z,y,F,f,null===(L=this.va())||void 0===L?void 0:L.useDelayedTextureLoading,h,v)}getClassName(){return"CubeTexture"}updateURL(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=R),this.url=R,q&&(this._forcedExtension=q);const F=R.lastIndexOf("."),C=q||(F>-1?R.substring(F).toLowerCase():""),e=0===C.indexOf(".dds"),y=0===C.indexOf(".env"),U=0===C.indexOf(".basis");if(y?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=B,B&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),z)this._files=z;else if(U||y||e||h||(h=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,h){for(let q=0;q<h.length;q++)this._files.push(R+h[q]);this._extensions=h}this._buffer=Y,Z?(this.delayLoadState=4,this._delayedOnLoad=L,this._delayedOnError=N):this._loadTexture(L,N)}delayLoad(R){4===this.delayLoadState&&(R&&(this._forcedExtension=R),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(R){var q,L;if(R.updateFlag===this._textureMatrix.updateFlag)return;R.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(L=this.va())||void 0===L||L.markAllMaterialsAsDirty(1,(R=>-1!==R.getActiveTextures().indexOf(this))));if(this._textureMatrix=R,null===(q=this.va())||void 0===q||!q.useRightHandedSystem)return;const B=Z.h.o[0],N=Z.h.Quaternion[0],h=Z.h.o[1];this._textureMatrix.decompose(B,N,h),N.z*=-1,N.w*=-1,Z.c.ComposeToRef(B,N,h,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var R;return null!==(R=this.va())&&void 0!==R&&R.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this.va(),B=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const N=()=>{var q;(this.onLoadObservable.notifyObservers(this),B)&&(B.dispose(),null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1));R&&R()},Z=(R,L)=>{this._loadingError=!0,this._errorObject={message:R,exception:L},q&&q(R,L),Y.c.OnTextureLoadErrorObservable.notifyObservers(this)};var z;this._texture?this._texture.isReady?h.f.SetImmediate((()=>N())):this._texture.onLoadedObservable.add((()=>N())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,L,this._lodScale,this._lodOffset,R,Z,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,L,this._files,this._noMipmap,R,Z,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(z=this._texture)||void 0===z||z.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(R,q,L){const B=e.b.Parse((()=>{let B=!1;return R.prefiltered&&(B=R.prefiltered),new y(L+(R.url??R.name),q,R.extensions,!1,R.files||null,null,null,void 0,B,R.forcedExtension)}),R,q);if(R.boundingBoxPosition&&(B.boundingBoxPosition=Z.m.Ig(R.boundingBoxPosition)),R.boundingBoxSize&&(B.boundingBoxSize=Z.m.Ig(R.boundingBoxSize)),R.animations)for(let N=0;N<R.animations.length;N++){const q=R.animations[N],L=(0,F.d)("BABYLON.Animation");L&&B.animations.push(L.Parse(q))}return B}clone(){let R=0;const q=e.b.Clone((()=>{const q=new y(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return R=q.uniqueId,q}),this);return q.uniqueId=R,q}}(0,B.d)([(0,N.K)()],y.prototype,"url",void 0),(0,B.d)([(0,N.G)()],y.prototype,"boundingBoxPosition",void 0),(0,B.d)([(0,N.G)()],y.prototype,"boundingBoxSize",null),(0,B.d)([(0,N.K)("rotationY")],y.prototype,"rotationY",null),(0,B.d)([(0,N.K)("files")],y.prototype,"_files",void 0),(0,B.d)([(0,N.K)("forcedExtension")],y.prototype,"_forcedExtension",void 0),(0,B.d)([(0,N.K)("extensions")],y.prototype,"_extensions",void 0),(0,B.d)([(0,N.u)("textureMatrix")],y.prototype,"_textureMatrix",void 0),(0,B.d)([(0,N.u)("textureMatrixRefraction")],y.prototype,"_textureMatrixRefraction",void 0),Y.c._CubeTextureParser=y.Parse,(0,F.f)("BABYLON.CubeTexture",y)},12463:(R,q,L)=>{"use strict";L.d(q,{c:()=>Y});var B=L(10767),N=L(11277),h=L(10900),Z=L(11495),z=L(10867);Z.ThinEngine.prototype.createDynamicTexture=function(R,q,L,B){const N=new z.b(this,4);return N.baseWidth=R,N.baseHeight=q,L&&(R=this.needPOTTextures?(0,h.e)(R,this._caps.maxTextureSize):R,q=this.needPOTTextures?(0,h.e)(q,this._caps.maxTextureSize):q),N.width=R,N.height=q,N.isReady=!1,N.generateMipMaps=L,N.samplingMode=B,this.updateTextureSamplingMode(B,N),this._internalTexturesCache.push(N),N},Z.ThinEngine.prototype.updateDynamicTexture=function(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R)return;const Z=this._gl,z=Z.TEXTURE_2D,Y=this._bindTextureDirectly(z,R,!0,h);this._unpackFlipY(void 0===L?R.invertY:L),B&&Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const F=this._getWebGLTextureType(R.type),C=this._getInternalFormat(N||R.format),e=this._getRGBABufferInternalSizedFormat(R.type,C);Z.texImage2D(z,0,e,C,F,q),R.generateMipMaps&&Z.generateMipmap(z),Y||this._bindTextureDirectly(z,null),B&&Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),N&&(R.format=N),R._dynamicTextureSource=q,R._premulAlpha=B,R.invertY=L||!1,R.isReady=!0};class Y extends N.c{constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,z=arguments.length>6?arguments[6]:void 0;const Y=!L||L._isScene;super(null,Y?L:null===L||void 0===L?void 0:L.Nc,Y?!B:L,z,h,void 0,void 0,void 0,void 0,Z),this.name=R,this.wrapU=N.c.CLAMP_ADDRESSMODE,this.wrapV=N.c.CLAMP_ADDRESSMODE,this._generateMipMaps=B;const F=this._getEngine();if(!F)return;if(q.getContext)this._canvas=q,this._ownCanvas=!1,this._texture=F.createDynamicTexture(this._canvas.width,this._canvas.height,B,h);else{this._canvas=F.createCanvas(1,1),this._ownCanvas=!0;const R=q;R.width||0===R.width?this._texture=F.createDynamicTexture(R.width,R.height,B,h):this._texture=F.createDynamicTexture(q,q,B,h)}const C=this.getSize();this._canvas.width!==C.width&&(this._canvas.width=C.width),this._canvas.height!==C.height&&(this._canvas.height=C.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(R){this._canvas.width=R.width,this._canvas.height=R.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(R.width,R.height,this._generateMipMaps,this.samplingMode)}scale(R){const q=this.getSize();q.width*=R,q.height*=R,this._recreate(q)}scaleTo(R,q){const L=this.getSize();L.width=R,L.height=q,this._recreate(L)}getContext(){return this._context}clear(R){const q=this.getSize();R&&(this._context.fillStyle=R),this._context.clearRect(0,0,q.width,q.height)}update(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===R||R,q,this._format||void 0,void 0,L)}drawText(R,q,L,B,N,h,Z){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const Y=this.getSize();if(h&&(this._context.fillStyle=h,this._context.fillRect(0,0,Y.width,Y.height)),this._context.font=B,null===q||void 0===q){const L=this._context.measureText(R);q=(Y.width-L.width)/2}if(null===L||void 0===L){const R=parseInt(B.replace(/\D/g,""));L=Y.height/2+R/3.65}this._context.fillStyle=N||"",this._context.fillText(R,q,L),z&&this.update(Z)}dispose(){var R,q;(super.dispose(),this._ownCanvas)&&(null===(R=this._canvas)||void 0===R||null===(q=R.remove)||void 0===q||q.call(R));this._canvas=null,this._context=null}clone(){const R=this.va();if(!R)return this;const q=this.getSize(),L=new Y(this.name,q,R,this._generateMipMaps);return L.je=this.je,L.level=this.level,L.wrapU=this.wrapU,L.wrapV=this.wrapV,L}serialize(){const R=this.va();R&&!R.isReady()&&B.d.Warn("The scene must be ready before serializing the dynamic texture");const q=super.serialize();return Y._IsCanvasElement(this._canvas)&&(q.base64String=this._canvas.toDataURL()),q.invertY=this._invertY,q.samplingMode=this.samplingMode,q}static _IsCanvasElement(R){return void 0!==R.toDataURL}_rebuild(){this.update()}}},10867:(R,q,L)=>{"use strict";L.d(q,{b:()=>Z});var B,N=L(10760),h=L(10871);!function(R){R[R.Unknown=0]="Unknown",R[R.Url=1]="Url",R[R.Temp=2]="Temp",R[R.Raw=3]="Raw",R[R.Dynamic=4]="Dynamic",R[R.RenderTarget=5]="RenderTarget",R[R.MultiRenderTarget=6]="MultiRenderTarget",R[R.Cube=7]="Cube",R[R.CubeRaw=8]="CubeRaw",R[R.CubePrefiltered=9]="CubePrefiltered",R[R.Raw3D=10]="Raw3D",R[R.Raw2DArray=11]="Raw2DArray",R[R.DepthStencil=12]="DepthStencil",R[R.CubeRawRGBD=13]="CubeRawRGBD",R[R.Depth=14]="Depth"}(B||(B={}));class Z extends h.c{get useMipMaps(){return this.generateMipMaps}set useMipMaps(R){this.generateMipMaps=R}get uniqueId(){return this._uniqueId}_setUniqueId(R){this._uniqueId=R}getEngine(){return this._engine}get source(){return this._source}constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new N.b,this.onErrorObservable=new N.b,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=R,this._source=q,this._uniqueId=Z._Counter++,L||(this._hardwareTexture=R._createHardwareTexture())}incrementReferences(){this._references++}updateSize(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,R,q,L),this.width=R,this.height=q,this.depth=L,this.baseWidth=R,this.baseHeight=q,this.baseDepth=L,this._size=R*q*L}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const R=this.onRebuildCallback(this),q=q=>{q._swapAndDie(this,!1),this.isReady=R.isReady};return void(R.isAsync?R.proxy.then(q):q(R.proxy))}let R;switch(this.source){case 2:case 12:case 14:break;case 1:return void(R=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(R=>{R._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:R=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),R._swapAndDie(this,!1),this.isReady=!0;break;case 10:R=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),R._swapAndDie(this,!1),this.isReady=!0;break;case 11:R=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),R._swapAndDie(this,!1),this.isReady=!0;break;case 4:R=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),R._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(R=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{R._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:R=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),R._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return R=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(R=>{R&&R._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(R._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(R){var q;let L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(q=this._hardwareTexture)||void 0===q||q.setUsage(R._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),R._hardwareTexture=this._hardwareTexture,L&&(R._isRGBD=this._isRGBD),this._lodTextureHigh&&(R._lodTextureHigh&&R._lodTextureHigh.dispose(),R._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(R._lodTextureMid&&R._lodTextureMid.dispose(),R._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(R._lodTextureLow&&R._lodTextureLow.dispose(),R._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(R._irradianceTexture&&R._irradianceTexture.dispose(),R._irradianceTexture=this._irradianceTexture);const B=this._engine.getLoadedTexturesCache();let N=B.indexOf(this);-1!==N&&B.splice(N,1),N=B.indexOf(R),-1===N&&B.push(R)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}Z._Counter=0},11525:(R,q,L)=>{"use strict";L.d(q,{c:()=>N});var B=L(11277);class N extends B.c{constructor(R,q,L,N,h){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=arguments.length>9?arguments[9]:void 0,e=arguments.length>10?arguments[10]:void 0;super(null,h,!Z,z,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,C),this.format=N,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==F||(Y=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==F||(Y=1),this._texture=this._engine.createRawTexture(R,q,L,N,Z,z,Y,null,F,C??0,e??!1),this.wrapU=B.c.CLAMP_ADDRESSMODE,this.wrapV=B.c.CLAMP_ADDRESSMODE)}update(R){this._getEngine().updateRawTexture(this._texture,R,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const R=new N(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return R._texture=this._texture,this._texture.incrementReferences(),R}static CreateLuminanceTexture(R,q,L,B){return new N(R,q,L,1,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(R,q,L,B){return new N(R,q,L,2,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(R,q,L,B){return new N(R,q,L,0,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(R,q,L,B){return new N(R,q,L,4,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(R,q,L,B){return new N(R,q,L,5,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(R,q,L,B){return new N(R,q,L,5,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(R,q,L,h){let Z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.c.TRILINEAR_SAMPLINGMODE;return new N(R,q,L,6,h,Z,z,Y,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(R,q,L,h){let Z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.c.TRILINEAR_SAMPLINGMODE;return new N(R,q,L,6,h,Z,z,Y,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11925:(R,q,L)=>{"use strict";L.d(q,{e:()=>N});var B=L(11277);class N extends B.c{get depth(){return this._depth}constructor(R,q,L,N,h,Z){let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:B.c.TRILINEAR_SAMPLINGMODE,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10?arguments[10]:void 0;super(null,Z,!z,Y),this.format=h,this._texture=Z.getEngine().createRawTexture2DArray(R,q,L,N,h,z,Y,F,null,C,e),this._depth=N,this.is2DArray=!0}update(R){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,R,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(R,q,L,B,h){return new N(R,q,L,B,5,h,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11612:(R,q,L)=>{"use strict";L.d(q,{d:()=>y});var B=L(10760),N=L(11081),h=L(11277),Z=L(11150),z=L(11156),Y=L(11092),F=L(10900),C=L(10837),e=L(10767);C.c.prototype.setDepthStencilTexture=function(R,q){this._engine.setDepthStencilTexture(this._samplers[R],this._uniforms[R],q,R)};class y extends h.c{get renderList(){return this._renderList}set renderList(R){this._renderList!==R&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),R&&(this._unObserveRenderList=(0,Y.i)(R,this._renderListHasChanged)),this._renderList=R)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(R){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(R)}set onBeforeRender(R){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(R)}set onAfterRender(R){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(R)}set onClear(R){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(R)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(R,q){let L;L=Array.isArray(R)?R:[R];for(let B=0;B<L.length;++B)for(let R=0;R<this._renderPassIds.length;++R)L[B].setMaterialForRenderPass(this._renderPassIds[R],void 0!==q?Array.isArray(q)?q[R]:q:void 0)}get isMulti(){var R;return(null===(R=this._renderTarget)||void 0===R?void 0:R.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(R){if(this._boundingBoxSize&&this._boundingBoxSize.equals(R))return;this._boundingBoxSize=R;const q=this.va();q&&q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var R;return(null===(R=this._renderTarget)||void 0===R?void 0:R._depthStencilTexture)??null}constructor(R,q,L){let Z,Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:h.c.TRILINEAR_SAMPLINGMODE,U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],n=arguments.length>9&&void 0!==arguments[9]&&arguments[9],r=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,c=arguments.length>12&&void 0!==arguments[12]&&arguments[12],d=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0,v=arguments.length>15&&void 0!==arguments[15]&&arguments[15],T=arguments.length>16&&void 0!==arguments[16]&&arguments[16],t=!0;if("object"===typeof Y){const R=Y;Y=!!R.generateMipMaps,F=R.doNotChangeAspectRatio??!0,C=R.type??0,e=!!R.isCube,y=R.samplingMode??h.c.TRILINEAR_SAMPLINGMODE,U=R.generateDepthBuffer??!0,n=!!R.generateStencilBuffer,r=!!R.isMulti,p=R.format??5,c=!!R.delayAllocation,d=R.samples,f=R.creationFlags,v=!!R.noColorAttachment,T=!!R.useSRGBBuffer,Z=R.colorAttachment,t=R.gammaSpace??t}if(super(null,L,!Y,void 0,y,void 0,void 0,void 0,void 0,p),this._unObserveRenderList=null,this._renderListHasChanged=(R,q)=>{const L=this._renderList?this._renderList.length:0;var B;(0===q&&L>0||0===L)&&(null===(B=this.va())||void 0===B||B.meshes.forEach((R=>{R._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new B.b,this.onAfterUnbindObservable=new B.b,this.onBeforeRenderObservable=new B.b,this.onAfterRenderObservable=new B.b,this.onClearObservable=new B.b,this.onResizeObservable=new B.b,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=N.m.Zero(),this._dumpToolsLoading=!1,!(L=this.va()))return;const D=this.va().getEngine();this._gammaSpace=t,this._coordinatesMode=h.c.PROJECTION_MODE,this.renderList=[],this.name=R,this.isRenderTarget=!0,this._initialSizeParameter=q,this._renderPassIds=[],this._isCubeData=e,this._processSizeParameter(q),this.renderPassId=this._renderPassIds[0],this._resizeObserver=D.onResizeObservable.add((()=>{})),this._generateMipMaps=!!Y,this._doNotChangeAspectRatio=F,this._renderingManager=new z.e(L),this._renderingManager._useSceneAutoClearSetup=!0,r||(this._renderTargetOptions={generateMipMaps:Y,type:C,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:U,generateStencilBuffer:n,samples:d,creationFlags:f,noColorAttachment:v,useSRGBBuffer:T,colorAttachment:Z,label:this.name},this.samplingMode===h.c.NEAREST_SAMPLINGMODE&&(this.wrapU=h.c.CLAMP_ADDRESSMODE,this.wrapV=h.c.CLAMP_ADDRESSMODE),c||(e?(this._renderTarget=L.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=h.c.INVCUBIC_MODE,this._textureMatrix=N.c.Identity()):this._renderTarget=L.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==d&&(this.samples=d)))}createDepthStencilTexture(){var R;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,Z=arguments.length>5?arguments[5]:void 0;null===(R=this._renderTarget)||void 0===R||R.createDepthStencilTexture(q,L,B,N,h,Z)}_releaseRenderPassId(){if(this._scene){const R=this._scene.getEngine();for(let q=0;q<this._renderPassIds.length;++q)R.releaseRenderPassId(this._renderPassIds[q])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const R=this._scene.getEngine(),q=this._isCubeData?6:this.getRenderLayers()||1;for(let L=0;L<q;++L)this._renderPassIds[L]=R.createRenderPassId(`RenderTargetTexture - ${this.name}#${L}`)}_processSizeParameter(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R.ratio){this._sizeRatio=R.ratio;const q=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(q.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(q.getRenderHeight(),this._sizeRatio)}}else this._size=R;q&&this._createRenderPassId()}get samples(){var R;return(null===(R=this._renderTarget)||void 0===R?void 0:R.samples)??this._samples}set samples(R){this._renderTarget&&(this._samples=this._renderTarget.setSamples(R))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(R){this._refreshRate=R,this.resetRefreshCounter()}addPostProcess(R){if(!this._postProcessManager){const R=this.va();if(!R)return;this._postProcessManager=new Z.b(R),this._postProcesses=new Array}this._postProcesses.push(R),this._postProcesses[0].Oi=!1}clearPostProcesses(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(R)for(const R of this._postProcesses)R.dispose();this._postProcesses=[]}}removePostProcess(R){if(!this._postProcesses)return;const q=this._postProcesses.indexOf(R);-1!==q&&(this._postProcesses.splice(q,1),this._postProcesses.length>0&&(this._postProcesses[0].Oi=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const R=this._size.layers;if(R)return R;const q=this._size.depth;return q||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(R){const q=Math.max(1,this.getRenderSize()*R);this.resize(q)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(R){var q;const L=this.isCube;null===(q=this._renderTarget)||void 0===q||q.dispose(),this._renderTarget=null;const B=this.va();B&&(this._processSizeParameter(R,!1),this._renderTarget=L?B.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):B.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(R,q)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(L.bind(L,12095)).then((R=>this._dumpTools=R))),this._render(!1,!1,!0)}_render(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this.va();if(!B)return L;const N=B.getEngine();if(void 0!==this.useCameraPostProcesses&&(R=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let R=0;R<this._waitingRenderList.length;R++){const q=this._waitingRenderList[R],L=B.getMeshById(q);L&&this.renderList.push(L)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const R=this.va();if(!R)return L;const q=R.meshes;for(let L=0;L<q.length;L++){const R=q[L];this.renderListPredicate(R)&&this.renderList.push(R)}}const h=N.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const Z=this.activeCamera??B.activeCamera,z=B.activeCamera;Z&&(Z!==B.activeCamera&&(B.setTransformMatrix(Z.getViewMatrix(),Z.getProjectionMatrix(!0)),B.activeCamera=Z),N.setViewport(Z.rigParent?Z.rigParent.viewport:Z.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let Y=L;if(L){B.getViewMatrix()||B.updateTransformMatrix();const R=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let h=0;h<R&&Y;h++){let R=null;const q=this.renderList?this.renderList:B.getActiveMeshes().data,Z=this.renderList?this.renderList.length:B.getActiveMeshes().length;N.currentRenderPassId=this._renderPassIds[h],this.onBeforeRenderObservable.notifyObservers(h),this.getCustomRenderList&&(R=this.getCustomRenderList(h,q,Z)),R||(R=q),this._doNotChangeAspectRatio||B.updateTransformMatrix(!0);for(let B=0;B<R.length&&Y;++B){const q=R[B];if(q.isEnabled()&&!q.isBlocked&&q.isVisible&&q.Zf)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(q,this.refreshRate,L)){Y=!1;continue}}else if(!q.isReady(!0)){Y=!1;continue}}this.onAfterRenderObservable.notifyObservers(h),(this.is2DArray||this.is3D||this.isCube)&&(B.incrementRenderId(),B.resetCachedMaterial())}const q=this.particleSystemList||B.lj;for(const L of q)L.isReady()||(Y=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let F=0;F<6;F++)this._renderToTarget(F,R,q,void 0,Z),B.incrementRenderId(),B.resetCachedMaterial();else this._renderToTarget(0,R,q,void 0,Z);else for(let F=0;F<this.getRenderLayers();F++)this._renderToTarget(0,R,q,F,Z),B.incrementRenderId(),B.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),N.currentRenderPassId=h,B.activeCamera=z,z&&(this.activeCamera&&this.activeCamera!==B.activeCamera&&B.setTransformMatrix(z.getViewMatrix(),z.getProjectionMatrix(!0)),N.setViewport(z.viewport)),B.resetCachedMaterial(),Y}_bestReflectionRenderTargetDimension(R,q){const L=R*q,B=(0,F.m)(L+16384/(128+L));return Math.min((0,F.c)(R),B)}_prepareRenderingManager(R,q,L,B){const N=this.va();if(!N)return;this._renderingManager.reset();const h=N.getRenderId();for(let z=0;z<q;z++){const q=R[z];if(q&&!q.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(q,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!q.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!q._internalAbstractMeshDataInfo._currentLODIsUpToDate&&L&&(q._internalAbstractMeshDataInfo._currentLOD=N.customLODSelector?N.customLODSelector(q,L):q.getLOD(L),q._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!q._internalAbstractMeshDataInfo._currentLOD)continue;let R,Z=q._internalAbstractMeshDataInfo._currentLOD;if(Z!==q&&0!==Z.billboardMode&&Z.Jj(),Z._preActivateForIntermediateRendering(h),R=!(!B||!L)&&0===(q.layerMask&L.layerMask),q.isEnabled()&&q.isVisible&&q.Zf&&!R){if(Z!==q&&Z._activate(h,!0),q._activate(h,!0)&&q.Zf.length){q.isAnInstance?q._internalAbstractMeshDataInfo._actAsRegularMesh&&(Z=q):Z._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,Z._internalAbstractMeshDataInfo._isActiveIntermediate=!0,N._prepareSkeleton(Z);for(let R=0;R<Z.Zf.length;R++){const q=Z.Zf[R];this._renderingManager.dispatch(q,Z)}}q._postActivate()}}}const Z=this.particleSystemList||N.lj;for(let z=0;z<Z.length;z++){const R=Z[z],q=R.j;R.isStarted()&&q&&(!q.position||q.isEnabled())&&this._renderingManager.dispatchParticles(R)}}_bindFrameBuffer(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.va();if(!L)return;const B=L.getEngine();this._renderTarget&&B.bindFramebuffer(this._renderTarget,this.isCube?R:void 0,void 0,void 0,this.ignoreCameraViewport,0,q)}_unbindFrameBuffer(R,q){this._renderTarget&&R.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(q)}))}_prepareFrame(R,q,L,B){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):B&&R.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(q,L)}_renderToTarget(R,q,L){var B,N;let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const z=this.va();if(!z)return;const Y=z.getEngine();this._prepareFrame(z,R,h,q),null===(B=Y._debugPushGroup)||void 0===B||B.call(Y,`render to face #${R} layer #${h}`,2),this.is2DArray||this.is3D?(Y.currentRenderPassId=this._renderPassIds[h],this.onBeforeRenderObservable.notifyObservers(h)):(Y.currentRenderPassId=this._renderPassIds[R],this.onBeforeRenderObservable.notifyObservers(R));if(Y.snapshotRendering&&1===Y.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(Y):this.skipInitialClear||Y.clear(this.clearColor||z.clearColor,!0,!0,!0);else{var F;let B=null;const N=this.renderList?this.renderList:z.getActiveMeshes().data,C=this.renderList?this.renderList.length:z.getActiveMeshes().length;this.getCustomRenderList&&(B=this.getCustomRenderList(this.is2DArray||this.is3D?h:R,N,C)),B?this._prepareRenderingManager(B,B.length,Z,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(N,C,Z,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),B=N);for(const q of z._beforeRenderTargetClearStage)q.action(this,R,h);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(Y):this.skipInitialClear||Y.clear(this.clearColor||z.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||z.updateTransformMatrix(!0);for(const q of z._beforeRenderTargetDrawStage)q.action(this,R,h);this._renderingManager.render(this.customRenderFunction,B,this.renderParticles,this.renderSprites);for(const q of z._afterRenderTargetDrawStage)q.action(this,R,h);const y=(null===(F=this._texture)||void 0===F?void 0:F.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,R,this._postProcesses,this.ignoreCameraViewport):q&&z.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,R);for(const q of z._afterRenderTargetPostProcessStage)q.action(this,R,h);this._texture&&(this._texture.generateMipMaps=y),this._doNotChangeAspectRatio||z.updateTransformMatrix(!0),L&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),Y):e.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(N=Y._debugPopGroup)||void 0===N||N.call(Y,2),this._unbindFrameBuffer(Y,R),this._texture&&this.isCube&&5===R&&Y.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(R,q,L,B)}setRenderingAutoClearDepthStencil(R,q){this._renderingManager.setRenderingAutoClearDepthStencil(R,q),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const R=this.getSize(),q=new y(this.name,R,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return q.je=this.je,q.level=this.level,q.coordinatesMode=this.coordinatesMode,this.renderList&&(q.renderList=this.renderList.slice(0)),q}serialize(){if(!this.name)return null;const R=super.serialize();if(R.renderTargetSize=this.getRenderSize(),R.renderList=[],this.renderList)for(let q=0;q<this.renderList.length;q++)R.renderList.push(this.renderList[q].id);return R}disposeFramebufferObjects(){var R;null===(R=this._renderTarget)||void 0===R||R.dispose(!0)}releaseInternalTexture(){var R;null===(R=this._renderTarget)||void 0===R||R.releaseTextures(),this._texture=null}dispose(){var R;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const q=this.va();if(!q)return;let L=q.customRenderTargets.indexOf(this);L>=0&&q.customRenderTargets.splice(L,1);for(const B of q.cameras)L=B.customRenderTargets.indexOf(this),L>=0&&B.customRenderTargets.splice(L,1);null===(R=this._renderTarget)||void 0===R||R.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===y.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=y.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}y.REFRESHRATE_RENDER_ONCE=0,y.REFRESHRATE_RENDER_ONEVERYFRAME=1,y.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,h.c._CreateRenderTargetTexture=(R,q,L,B,N)=>new y(R,q,L,B)},11277:(R,q,L)=>{"use strict";L.d(q,{c:()=>f});var B=L(11053),N=L(11058),h=L(10760),Z=L(11081),z=L(11283),Y=L(10889),F=L(10785),C=L(10831),e=L(10883),y=L(11198),U=L(10815);function n(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=q.width,N=q.height;if(R instanceof Float32Array){let q=R.byteLength/R.BYTES_PER_ELEMENT;const L=new Uint8Array(q);for(;--q>=0;){let B=R[q];B<0?B=0:B>1&&(B=1),L[q]=255*B}R=L}const h=document.createElement("canvas");h.width=B,h.height=N;const Z=h.getContext("2d");if(!Z)return null;const z=Z.createImageData(B,N);if(z.data.set(R),Z.putImageData(z,0,0),L){const R=document.createElement("canvas");R.width=B,R.height=N;const q=R.getContext("2d");return q?(q.translate(0,N),q.scale(1,-1),q.drawImage(h,0,0),R.toDataURL("image/png")):null}return h.toDataURL("image/png")}function r(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=R.getInternalTexture();if(!B)return null;const N=R._readPixelsSync(q,L);return N?n(N,R.getSize(),B.invertY):null}async function p(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=R.getInternalTexture();if(!B)return null;const N=await R.readPixels(q,L);return N?n(N,R.getSize(),B.invertY):null}var c=L(11292),d=L(11117);class f extends z.d{static _CreateVideoTexture(R,q,L){arguments.length>5&&void 0!==arguments[5]||f.TRILINEAR_SAMPLINGMODE;throw(0,F.d)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(R){this._isBlocking=R}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(R,q,L,B){let N,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:f.TRILINEAR_SAMPLINGMODE,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9?arguments[9]:void 0,U=arguments.length>10?arguments[10]:void 0,n=arguments.length>11?arguments[11]:void 0,r=arguments.length>12?arguments[12]:void 0,p=arguments.length>13?arguments[13]:void 0;super(q),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new h.b,this._isBlocking=!0,this.name=R||"",this.url=R;let d=!1,v=null,T=!0;"object"===typeof L&&null!==L?(N=L.noMipmap??!1,B=L.invertY??!c.e,Z=L.samplingMode??f.TRILINEAR_SAMPLINGMODE,z=L.X??null,Y=L.onError??null,F=L.buffer??null,e=L.deleteBuffer??!1,y=L.format,U=L.mimeType,n=L.loaderOptions,r=L.creationFlags,d=L.useSRGBBuffer??!1,v=L.internalTexture??null,T=L.gammaSpace??T):N=!!L,this._gammaSpace=T,this._noMipmap=N,this._invertY=void 0===B?!c.e:B,this._initialSamplingMode=Z,this._buffer=F,this._deleteBuffer=e,this._mimeType=U,this._loaderOptions=n,this._creationFlags=r,this._useSRGBBuffer=d,this._forcedExtension=p,y&&(this._format=y);const t=this.va(),D=this._getEngine();if(!D)return;D.onBeforeTextureInitObservable.notifyObservers(this);const S=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),z&&z(),!this.isBlocking&&t&&t.resetCachedMaterial()},I=(R,q)=>{this._loadingError=!0,this._errorObject={message:R,exception:q},Y&&Y(R,q),f.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!v)return this._delayedOnLoad=S,void(this._delayedOnError=I);if(this._texture=v??this._getFromCache(this.url,N,Z,this._invertY,d,this.isCube),this._texture)if(this._texture.isReady)C.e.SetImmediate((()=>S()));else{const R=this._texture.onLoadedObservable.add(S);this._texture.onErrorObservable.add((q=>{var L;I(q.message,q.exception),null===(L=this._texture)||void 0===L||L.onLoadedObservable.remove(R)}))}else if(t&&t.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=S,this._delayedOnError=I;else{try{this._texture=D.createTexture(this.url,N,this._invertY,t,Z,S,I,this._buffer,void 0,this._format,this._forcedExtension,U,n,r,d)}catch(K){throw I("error loading",K),K}e&&(this._buffer=null)}}updateURL(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(R=>R.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=R),this.url=R,this._buffer=q,this._forcedExtension=B,this.delayLoadState=4,L&&(this._delayedOnLoad=L),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const R=this.va();R&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?C.e.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=R.getEngine().createTexture(this.url,this._noMipmap,this._invertY,R,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(R,q,L,B){R*=this._cachedUScale,q*=this._cachedVScale,R-=this.uRotationCenter*this._cachedUScale,q-=this.vRotationCenter*this._cachedVScale,L-=this.wRotationCenter,Z.m.TransformCoordinatesFromFloatsToRef(R,q,L,this._rowGenerationMatrix,B),B.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,B.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,B.z+=this.wRotationCenter}getTextureMatrix(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*R===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*R,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=Z.c.Zero(),this._rowGenerationMatrix=new Z.c,this._t0=Z.m.Zero(),this._t1=Z.m.Zero(),this._t2=Z.m.Zero()),Z.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(Z.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,Z.h.Matrix[0]),Z.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,Z.h.Matrix[1]),Z.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,Z.h.Matrix[2]),Z.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,Z.h.Matrix[3]),Z.h.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Z.h.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Z.h.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Z.h.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.ki(this._t0),this._t2.ki(this._t0),Z.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const q=this.va();if(!q)return this._cachedTextureMatrix;const L=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&L!==this._cachedIdentity3x2&&q.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const R=this.va();if(!R)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==f.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===R.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=Z.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=Z.c.Zero());const q=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case f.PLANAR_MODE:Z.c.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case f.PROJECTION_MODE:{Z.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const q=R.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=q.updateFlag,q.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:Z.c.IdentityToRef(this._cachedReflectionTextureMatrix)}return q&&R.markAllMaterialsAsDirty(1,(R=>R.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const R={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return d.b.Clone((()=>new f(this._texture?this._texture.url:null,this.va(),R)),this)}serialize(){var R;const q=this.name;f.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const L=super.serialize(f._SerializeInternalTextureUniqueId);if(!L)return null;var B;((f.SerializeBuffers||f.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(L.base64String=this._buffer,L.name=L.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?L.base64String="data:image/png;base64,"+(0,U.f)(this._buffer):(f.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(L.base64String=!this._engine||this._engine._features.supportSyncTextureRead?r(this):p(this))),L.invertY=this._invertY,L.samplingMode=this.samplingMode,L._creationFlags=this._creationFlags,L._useSRGBBuffer=this._useSRGBBuffer,f._SerializeInternalTextureUniqueId)&&(L.internalTextureUniqueId=null===(B=this._texture)||void 0===B?void 0:B.uniqueId);return L.internalTextureLabel=null===(R=this._texture)||void 0===R?void 0:R.label,L.noMipmap=this._noMipmap,this.name=q,L}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(R,q,L){if(R.customType){const B=e.e.Instantiate(R.customType).Parse(R,q,L);return R.samplingMode&&B.updateSamplingMode&&B._samplingMode&&B._samplingMode!==R.samplingMode&&B.updateSamplingMode(R.samplingMode),B}if(R.isCube&&!R.isRenderTarget)return f._CubeTextureParser(R,q,L);const B=void 0!==R.internalTextureUniqueId;if(!R.name&&!R.isRenderTarget&&!B)return null;let N;if(B){const L=q.getEngine().getLoadedTexturesCache();for(const q of L)if(q.uniqueId===R.internalTextureUniqueId){N=q;break}}const h=q=>{if(q&&q._texture&&(q._texture._cachedWrapU=null,q._texture._cachedWrapV=null,q._texture._cachedWrapR=null),R.samplingMode){const L=R.samplingMode;q&&q.samplingMode!==L&&q.updateSamplingMode(L)}if(q&&R.animations)for(let L=0;L<R.animations.length;L++){const B=R.animations[L],N=(0,Y.d)("BABYLON.Animation");N&&q.animations.push(N.Parse(B))}q&&q._texture&&(B&&!N&&q._texture._setUniqueId(R.internalTextureUniqueId),q._texture.label=R.internalTextureLabel)};return d.b.Parse((()=>{let B=!0;if(R.noMipmap&&(B=!1),R.mirrorPlane){const L=f._CreateMirror(R.name,R.renderTargetSize,q,B);return L._waitingRenderList=R.renderList,L.mirrorPlane=y.e.Ig(R.mirrorPlane),h(L),L}if(R.isRenderTarget){let L=null;if(R.isCube){if(q.reflectionProbes)for(let B=0;B<q.reflectionProbes.length;B++){const L=q.reflectionProbes[B];if(L.name===R.name)return L.cubeTexture}}else L=f._CreateRenderTargetTexture(R.name,R.renderTargetSize,q,B,R._creationFlags??0),L._waitingRenderList=R.renderList;return h(L),L}if(R.isVideo){const N=f._CreateVideoTexture(L+(R.url||R.name),L+(R.src||R.url),q,B,R.invertY,R.samplingMode,R.settings||{});return h(N),N}{let Z;if(R.base64String&&!N)Z=f.CreateFromBase64String(R.base64String,R.base64String,q,!B,R.invertY,R.samplingMode,(()=>{h(Z)}),R._creationFlags??0,R._useSRGBBuffer??!1),Z.name=R.name;else{let z;z=R.name&&(R.name.indexOf("://")>0||R.name.startsWith("data:"))?R.name:L+R.name,R.url&&(R.url.startsWith("data:")||f.UseSerializedUrlIfAny)&&(z=R.url);const Y={noMipmap:!B,invertY:R.invertY,samplingMode:R.samplingMode,X:()=>{h(Z)},internalTexture:N};Z=new f(z,q,Y)}return Z}}),R,q)}static CreateFromBase64String(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:f.TRILINEAR_SAMPLINGMODE;return new f("data:"+q,L,B,N,h,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:f.TRILINEAR_SAMPLINGMODE,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,C=arguments.length>10?arguments[10]:void 0,e=arguments.length>11?arguments[11]:void 0;return"data:"!==R.substring(0,5)&&(R="data:"+R),new f(R,L,N,h,Z,z,Y,q,B,F,void 0,void 0,C,e)}}f.SerializeBuffers=!0,f.ForceSerializeBuffers=!1,f.OnTextureLoadErrorObservable=new h.b,f._SerializeInternalTextureUniqueId=!1,f._CubeTextureParser=(R,q,L)=>{throw(0,F.d)("CubeTexture")},f._CreateMirror=(R,q,L,B)=>{throw(0,F.d)("MirrorTexture")},f._CreateRenderTargetTexture=(R,q,L,B,N)=>{throw(0,F.d)("RenderTargetTexture")},f.NEAREST_SAMPLINGMODE=1,f.NEAREST_NEAREST_MIPLINEAR=8,f.BILINEAR_SAMPLINGMODE=2,f.LINEAR_LINEAR_MIPNEAREST=11,f.TRILINEAR_SAMPLINGMODE=3,f.LINEAR_LINEAR_MIPLINEAR=3,f.NEAREST_NEAREST_MIPNEAREST=4,f.NEAREST_LINEAR_MIPNEAREST=5,f.NEAREST_LINEAR_MIPLINEAR=6,f.NEAREST_LINEAR=7,f.NEAREST_NEAREST=1,f.LINEAR_NEAREST_MIPNEAREST=9,f.LINEAR_NEAREST_MIPLINEAR=10,f.LINEAR_LINEAR=2,f.LINEAR_NEAREST=12,f.EXPLICIT_MODE=0,f.SPHERICAL_MODE=1,f.PLANAR_MODE=2,f.CUBIC_MODE=3,f.PROJECTION_MODE=4,f.SKYBOX_MODE=5,f.INVCUBIC_MODE=6,f.EQUIRECTANGULAR_MODE=7,f.FIXED_EQUIRECTANGULAR_MODE=8,f.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,f.CLAMP_ADDRESSMODE=0,f.WRAP_ADDRESSMODE=1,f.MIRROR_ADDRESSMODE=2,f.UseSerializedUrlIfAny=!1,(0,B.d)([(0,N.K)()],f.prototype,"url",void 0),(0,B.d)([(0,N.K)()],f.prototype,"uOffset",void 0),(0,B.d)([(0,N.K)()],f.prototype,"vOffset",void 0),(0,B.d)([(0,N.K)()],f.prototype,"uScale",void 0),(0,B.d)([(0,N.K)()],f.prototype,"vScale",void 0),(0,B.d)([(0,N.K)()],f.prototype,"uAng",void 0),(0,B.d)([(0,N.K)()],f.prototype,"vAng",void 0),(0,B.d)([(0,N.K)()],f.prototype,"wAng",void 0),(0,B.d)([(0,N.K)()],f.prototype,"uRotationCenter",void 0),(0,B.d)([(0,N.K)()],f.prototype,"vRotationCenter",void 0),(0,B.d)([(0,N.K)()],f.prototype,"wRotationCenter",void 0),(0,B.d)([(0,N.K)()],f.prototype,"homogeneousRotationInUVTransform",void 0),(0,B.d)([(0,N.K)()],f.prototype,"isBlocking",null),(0,Y.f)("BABYLON.Texture",f),d.b._TextureParser=f.Parse},10871:(R,q,L)=>{"use strict";L.d(q,{c:()=>B});class B{get wrapU(){return this._cachedWrapU}set wrapU(R){this._cachedWrapU=R}get wrapV(){return this._cachedWrapV}set wrapV(R){this._cachedWrapV=R}get wrapR(){return this._cachedWrapR}set wrapR(R){this._cachedWrapR=R}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(R){this._cachedAnisotropicFilteringLevel=R}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(R){this._comparisonFunction=R}get useMipMaps(){return this._useMipMaps}set useMipMaps(R){this._useMipMaps=R}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=R,this._cachedWrapV=q,this._cachedWrapR=L,this._cachedAnisotropicFilteringLevel=B,this.samplingMode=N,this._comparisonFunction=h,this}compareSampler(R){return this._cachedWrapU===R._cachedWrapU&&this._cachedWrapV===R._cachedWrapV&&this._cachedWrapR===R._cachedWrapR&&this._cachedAnisotropicFilteringLevel===R._cachedAnisotropicFilteringLevel&&this.samplingMode===R.samplingMode&&this._comparisonFunction===R._comparisonFunction&&this._useMipMaps===R._useMipMaps}}},11255:(R,q,L)=>{"use strict";function B(R){-1===R.indexOf("vClipPlane")&&R.push("vClipPlane"),-1===R.indexOf("vClipPlane2")&&R.push("vClipPlane2"),-1===R.indexOf("vClipPlane3")&&R.push("vClipPlane3"),-1===R.indexOf("vClipPlane4")&&R.push("vClipPlane4"),-1===R.indexOf("vClipPlane5")&&R.push("vClipPlane5"),-1===R.indexOf("vClipPlane6")&&R.push("vClipPlane6")}function N(R,q,L){const B=!!(R.clipPlane??q.clipPlane),N=!!(R.clipPlane2??q.clipPlane2),h=!!(R.clipPlane3??q.clipPlane3),Z=!!(R.clipPlane4??q.clipPlane4),z=!!(R.clipPlane5??q.clipPlane5),Y=!!(R.clipPlane6??q.clipPlane6);B&&L.push("#define CLIPPLANE"),N&&L.push("#define CLIPPLANE2"),h&&L.push("#define CLIPPLANE3"),Z&&L.push("#define CLIPPLANE4"),z&&L.push("#define CLIPPLANE5"),Y&&L.push("#define CLIPPLANE6")}function h(R,q,L){let B=!1;const N=!!(R.clipPlane??q.clipPlane),h=!!(R.clipPlane2??q.clipPlane2),Z=!!(R.clipPlane3??q.clipPlane3),z=!!(R.clipPlane4??q.clipPlane4),Y=!!(R.clipPlane5??q.clipPlane5),F=!!(R.clipPlane6??q.clipPlane6);return L.CLIPPLANE!==N&&(L.CLIPPLANE=N,B=!0),L.CLIPPLANE2!==h&&(L.CLIPPLANE2=h,B=!0),L.CLIPPLANE3!==Z&&(L.CLIPPLANE3=Z,B=!0),L.CLIPPLANE4!==z&&(L.CLIPPLANE4=z,B=!0),L.CLIPPLANE5!==Y&&(L.CLIPPLANE5=Y,B=!0),L.CLIPPLANE6!==F&&(L.CLIPPLANE6=F,B=!0),B}function Z(R,q,L){let B=q.clipPlane??L.clipPlane;z(R,"vClipPlane",B),B=q.clipPlane2??L.clipPlane2,z(R,"vClipPlane2",B),B=q.clipPlane3??L.clipPlane3,z(R,"vClipPlane3",B),B=q.clipPlane4??L.clipPlane4,z(R,"vClipPlane4",B),B=q.clipPlane5??L.clipPlane5,z(R,"vClipPlane5",B),B=q.clipPlane6??L.clipPlane6,z(R,"vClipPlane6",B)}function z(R,q,L){L&&R.setFloat4(q,L.k.x,L.k.y,L.k.z,L.d)}L.d(q,{e:()=>B,f:()=>Z,j:()=>h,k:()=>N})},11123:(R,q,L)=>{"use strict";function B(R){R.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}L.d(q,{c:()=>B})},11504:(R,q,L)=>{"use strict";function B(R){return void 0===R.getPipelineContext}L.d(q,{c:()=>B})},11246:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{static GetEffect(R){return void 0===R.getPipelineContext?R.effect:R}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=R.createDrawContext(),q&&(this.materialContext=R.createMaterialContext())}setEffect(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var B;(this.effect=R,void 0!==q&&(this.defines=q),L)&&(null===(B=this.drawContext)||void 0===B||B.reset())}dispose(){var R;null===(R=this.drawContext)||void 0===R||R.dispose()}}},10847:(R,q,L)=>{"use strict";L.d(q,{b:()=>e,f:()=>U,h:()=>F,l:()=>C});var B=L(10763),N=L(10856),h=L(10841),Z=L(10767),z=L(10821),Y=L(10829);function F(R,q){return(0,N.B)(q).cachedPipelines[R]}function C(R){const q=R._name,L=R.context;if(q&&L){const R=(0,N.B)(L),B=R.cachedPipelines[q];null===B||void 0===B||B.dispose(),delete R.cachedPipelines[q]}}function e(R,q,L,N,h,Z,Y){let F,C;const e=(0,B.i)()?null===Z||void 0===Z?void 0:Z.getHostDocument():null;F="string"===typeof q?q:q.vertexSource?"source:"+q.vertexSource:q.vertexElement?(null===e||void 0===e?void 0:e.getElementById(q.vertexElement))||q.vertexElement:q.vertex||q,C="string"===typeof q?q:q.fragmentSource?"source:"+q.fragmentSource:q.fragmentElement?(null===e||void 0===e?void 0:e.getElementById(q.fragmentElement))||q.fragmentElement:q.fragment||q;const U=[void 0,void 0],n=()=>{if(U[0]&&U[1]){R.isFragment=!0;const[B,F]=U;(0,z.k)(F,R,((Z,F)=>{Y&&(Y._fragmentSourceCodeBeforeMigration=F),L&&(Z=L("fragment",Z));const C=(0,z.d)(B,Z,R);R=null;const e=function(R,q,L,B){if(L){return{vertexSourceCode:(1===B?"//":"")+"#define SHADER_NAME vertex:"+(L.vertexElement||L.vertex||L.spectorName||L)+"\n"+R,fragmentSourceCode:(1===B?"//":"")+"#define SHADER_NAME fragment:"+(L.fragmentElement||L.fragment||L.spectorName||L)+"\n"+q}}return{vertexSourceCode:R,fragmentSourceCode:q}}(C.vertexCode,C.fragmentCode,q,h);null===N||void 0===N||N(e.vertexSourceCode,e.fragmentSourceCode)}),Z)}};y(F,"Vertex","",(q=>{(0,z.g)(R),(0,z.k)(q,R,((R,B)=>{Y&&(Y._rawVertexSourceCode=q,Y._vertexSourceCodeBeforeMigration=B),L&&(R=L("vertex",R)),U[0]=R,n()}),Z)}),h),y(C,"Fragment","Pixel",(R=>{Y&&(Y._rawFragmentSourceCode=R),U[1]=R,n()}),h)}function y(R,q,L,N,Z,z){if("undefined"!==typeof HTMLElement&&R instanceof HTMLElement){return void N((0,B.d)(R))}if("source:"===R.substring(0,7))return void N(R.substring(7));if("base64:"===R.substring(0,7)){return void N(window.atob(R.substring(7)))}const F=h.b.GetShadersStore(Z);if(F[R+q+"Shader"])return void N(F[R+q+"Shader"]);if(L&&F[R+L+"Shader"])return void N(F[R+L+"Shader"]);let C;if(C="."===R[0]||"/"===R[0]||R.indexOf("http")>-1?R:h.b.GetShadersRepository(Z)+R,!(z=z||Y.q))throw new Error("loadFileInjection is not defined");z(C+"."+q.toLowerCase()+".fx",N)}const U=(R,q,L,B)=>{try{const h=R.existingPipelineContext||q(R.shaderProcessingContext);if(h._name=R.name,R.name&&R.context){(0,N.B)(R.context).cachedPipelines[R.name]=h}return L(h,R.vertex,R.fragment,!!R.createAsRaw,"","",R.rebuildRebind,R.defines,R.transformFeedbackVaryings,"",(()=>{B(h,(()=>{var q;null===(q=R.onRenderingStateCompiled)||void 0===q||q.call(R,h)}))})),h}catch(h){throw Z.d.Error("Error compiling effect"),h}}},10837:(R,q,L)=>{"use strict";L.d(q,{c:()=>z});var B=L(10760),N=L(10767),h=L(10841),Z=L(10847);class z{static get ShadersRepository(){return h.b.ShadersRepository}static set ShadersRepository(R){h.b.ShadersRepository=R}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9?arguments[9]:void 0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,r=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new B.b,this.onErrorObservable=new B.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=R,this._key=U;const p=this._key.replace(/\r/g,"").replace(/\n/g,"|");let c;if(q.attributes){const R=q;if(this._engine=L,this._attributesNames=R.attributes,this._uniformsNames=R.uniformsNames.concat(R.samplers),this._samplerList=R.samplers.slice(),this.defines=R.defines,this.onError=R.onError,this.onCompiled=R.onCompiled,this._fallbacks=R.fallbacks,this._indexParameters=R.indexParameters,this._transformFeedbackVaryings=R.transformFeedbackVaryings||null,this._multiTarget=!!R.multiTarget,this._shaderLanguage=R.shaderLanguage??0,R.uniformBuffersNames){this._uniformBuffersNamesList=R.uniformBuffersNames.slice();for(let q=0;q<R.uniformBuffersNames.length;q++)this._uniformBuffersNames[R.uniformBuffersNames[q]]=q}this._processFinalCode=R.processFinalCode??null,this._processCodeAfterIncludes=R.processCodeAfterIncludes??void 0,c=R.existingPipelineContext}else this._engine=h,this.defines=null==Y?"":Y,this._uniformsNames=L.concat(N),this._samplerList=N?N.slice():[],this._attributesNames=q,this._uniformBuffersNamesList=[],this._shaderLanguage=n,this.onError=e,this.onCompiled=C,this._indexParameters=y,this._fallbacks=F;"WEBGL2"===this._engine.shaderPlatformName&&(c=(0,Z.h)(p,this._engine._gl)??c),this._attributeLocationByName={},this.uniqueId=z._UniqueIdSeed++,c?(this._pipelineContext=c,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,r)}async _processShaderCodeAsync(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0;B&&await B(),this._processingContext=L||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const N={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:R??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:h.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:h.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Z.b)(N,this.name,this._processFinalCode,((R,L)=>{this._vertexSourceCode=R,this._fragmentSourceCode=L,this._prepareEffect(q)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(R){return this._attributes[R]}getAttributeLocationByName(R){return this._attributeLocationByName[R]}getAttributesCount(){return this._attributes.length}getUniformIndex(R){return this._uniformsNames.indexOf(R)}getUniform(R){return this._uniforms[R]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(R){this.isReady()?R(this):(this.onCompileObservable.add((q=>{R(q)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(R){try{if(this._isReadyInternal())return}catch(q){return void this._processCompilationErrors(q,R)}this._isDisposed||setTimeout((()=>{this._checkIsReady(R)}),16)}get vertexSourceCode(){var R;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(R=this._pipelineContext)||void 0===R?void 0:R._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var R;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(R=this._pipelineContext)||void 0===R?void 0:R._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(R,q,L,B){this._isReady=!1,this._vertexSourceCodeOverride=R,this._fragmentSourceCodeOverride=q,this.onError=(R,q)=>{B&&B(q)},this.onCompiled=()=>{var R,q;const B=this.getEngine().scenes;if(B)for(let L=0;L<B.length;L++)B[L].markAllMaterialsAsDirty(63);null===(R=(q=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===R||R.call(q,L)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(R){if(this._pipelineContext=R,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let q=0;q<this._attributesNames.length;q++){const R=this._attributesNames[q];this._attributeLocationByName[R]=this._attributes[q]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),z.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this._pipelineContext;this._isReady=!1;try{const L=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),B=L?null:this.defines,N=L?this._vertexSourceCodeOverride:this._vertexSourceCode,h=L?this._fragmentSourceCodeOverride:this._fragmentSourceCode,z=this._engine;this._pipelineContext=(0,Z.f)({existingPipelineContext:R?q:null,vertex:N,fragment:h,context:"WEBGL2"===z.shaderPlatformName?z._gl:void 0,rebuildRebind:(R,q,L,B)=>this._rebuildProgram(R,q,L,B),defines:B,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:L,parallelShaderCompile:z._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:L=>{q&&!R&&this._engine._deletePipelineContext(q),L&&this._onRenderingStateCompiled(L)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(q)}catch(L){this._processCompilationErrors(L,q)}}_getShaderCodeAndErrorLine(R,q,L){const B=L?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let N=null;if(q&&R){const h=q.match(B);if(h&&2===h.length){const q=parseInt(h[1]),B=R.split("\n",-1);B.length>=q&&(N=`Offending line [${q}] in ${L?"fragment":"vertex"} code: ${B[q-1]}`)}}return[R,N]}_processCompilationErrors(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=R.message;const L=this._attributesNames,B=this._fallbacks;if(N.d.Error("Unable to compile effect:"),N.d.Error("Uniforms: "+this._uniformsNames.map((function(R){return" "+R}))),N.d.Error("Attributes: "+L.map((function(R){return" "+R}))),N.d.Error("Defines:\n"+this.defines),z.LogShaderCodeOnCompilationError){var h,Z;let R=null,q=null,L=null;var Y;if(null!==(h=this._pipelineContext)&&void 0!==h&&h._getVertexShaderCode()&&([L,R]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),L&&(N.d.Error("Vertex code:"),N.d.Error(L))),null!==(Z=this._pipelineContext)&&void 0!==Z&&Z._getFragmentShaderCode())[L,q]=this._getShaderCodeAndErrorLine(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getFragmentShaderCode(),this._compilationError,!0),L&&(N.d.Error("Fragment code:"),N.d.Error(L));R&&N.d.Error(R),q&&N.d.Error(q)}N.d.Error("Error: "+this._compilationError);const F=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};q&&(this._pipelineContext=q,this._isReady=!0,F()),B?(this._pipelineContext=null,B.hasMoreFallbacks?(this._allFallbacksProcessed=!1,N.d.Error("Trying next fallback."),this.defines=B.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,F(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,q||F())}get isSupported(){return""===this._compilationError}_bindTexture(R,q){this._engine._bindTexture(this._samplers[R],q,R)}setTexture(R,q){this._engine.setTexture(this._samplers[R],this._uniforms[R],q,R)}setTextureArray(R,q){const L=R+"Ex";if(-1===this._samplerList.indexOf(L+"0")){const B=this._samplerList.indexOf(R);for(let R=1;R<q.length;R++){const q=L+(R-1).toString();this._samplerList.splice(B+R,0,q)}let N=0;for(const R of this._samplerList)this._samplers[R]=N,N+=1}this._engine.setTextureArray(this._samplers[R],this._uniforms[R],q,R)}bindUniformBuffer(R,q){const L=this._uniformBuffersNames[q];void 0===L||z._BaseCache[L]===R&&this._engine._features.useUBOBindingCache||(z._BaseCache[L]=R,this._engine.bindUniformBufferBase(R,L,q))}bindUniformBlock(R,q){this._engine.bindUniformBlock(this._pipelineContext,R,q)}setInt(R,q){return this._pipelineContext.setInt(R,q),this}setInt2(R,q,L){return this._pipelineContext.setInt2(R,q,L),this}setInt3(R,q,L,B){return this._pipelineContext.setInt3(R,q,L,B),this}setInt4(R,q,L,B,N){return this._pipelineContext.setInt4(R,q,L,B,N),this}setIntArray(R,q){return this._pipelineContext.setIntArray(R,q),this}setIntArray2(R,q){return this._pipelineContext.setIntArray2(R,q),this}setIntArray3(R,q){return this._pipelineContext.setIntArray3(R,q),this}setIntArray4(R,q){return this._pipelineContext.setIntArray4(R,q),this}setUInt(R,q){return this._pipelineContext.setUInt(R,q),this}setUInt2(R,q,L){return this._pipelineContext.setUInt2(R,q,L),this}setUInt3(R,q,L,B){return this._pipelineContext.setUInt3(R,q,L,B),this}setUInt4(R,q,L,B,N){return this._pipelineContext.setUInt4(R,q,L,B,N),this}setUIntArray(R,q){return this._pipelineContext.setUIntArray(R,q),this}setUIntArray2(R,q){return this._pipelineContext.setUIntArray2(R,q),this}setUIntArray3(R,q){return this._pipelineContext.setUIntArray3(R,q),this}setUIntArray4(R,q){return this._pipelineContext.setUIntArray4(R,q),this}setFloatArray(R,q){return this._pipelineContext.setArray(R,q),this}setFloatArray2(R,q){return this._pipelineContext.setArray2(R,q),this}setFloatArray3(R,q){return this._pipelineContext.setArray3(R,q),this}setFloatArray4(R,q){return this._pipelineContext.setArray4(R,q),this}setArray(R,q){return this._pipelineContext.setArray(R,q),this}setArray2(R,q){return this._pipelineContext.setArray2(R,q),this}setArray3(R,q){return this._pipelineContext.setArray3(R,q),this}setArray4(R,q){return this._pipelineContext.setArray4(R,q),this}setMatrices(R,q){return this._pipelineContext.setMatrices(R,q),this}setMatrix(R,q){return this._pipelineContext.setMatrix(R,q),this}setMatrix3x3(R,q){return this._pipelineContext.setMatrix3x3(R,q),this}setMatrix2x2(R,q){return this._pipelineContext.setMatrix2x2(R,q),this}setFloat(R,q){return this._pipelineContext.setFloat(R,q),this}setBool(R,q){return this._pipelineContext.setInt(R,q?1:0),this}setVector2(R,q){return this._pipelineContext.setVector2(R,q),this}setFloat2(R,q,L){return this._pipelineContext.setFloat2(R,q,L),this}setVector3(R,q){return this._pipelineContext.setVector3(R,q),this}setFloat3(R,q,L,B){return this._pipelineContext.setFloat3(R,q,L,B),this}setVector4(R,q){return this._pipelineContext.setVector4(R,q),this}setQuaternion(R,q){return this._pipelineContext.setQuaternion(R,q),this}setFloat4(R,q,L,B,N){return this._pipelineContext.setFloat4(R,q,L,B,N),this}setColor3(R,q){return this._pipelineContext.setColor3(R,q),this}setColor4(R,q,L){return this._pipelineContext.setColor4(R,q,L),this}setDirectColor4(R,q){return this._pipelineContext.setDirectColor4(R,q),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,Z.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;q&&(h.b.GetShadersStore(B)[`${R}PixelShader`]=q),L&&(h.b.GetShadersStore(B)[`${R}VertexShader`]=L)}static ResetCache(){z._BaseCache={}}}z.LogShaderCodeOnCompilationError=!0,z.AutomaticallyClearCodeCache=!1,z._UniqueIdSeed=0,z._BaseCache={},z.ShadersStore=h.b.ShadersStore,z.IncludesShadersStore=h.b.IncludesShadersStore},11303:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(R,q){this._defines[R]||(R<this._currentRank&&(this._currentRank=R),R>this._maxRank&&(this._maxRank=R),this._defines[R]=new Array),this._defines[R].push(q)}addCPUSkinningFallback(R,q){this._mesh=q,R<this._currentRank&&(this._currentRank=R),R>this._maxRank&&(this._maxRank=R)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(R,q){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,R=R.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),q._bonesComputationForcedToCPU=!0;const L=this._mesh.va();for(let R=0;R<L.meshes.length;R++){const B=L.meshes[R];if(B.material){if(B.computeBonesUsingShaders&&0!==B.numBoneInfluencers)if(B.material.getEffect()===q)B.computeBonesUsingShaders=!1;else if(B.Zf)for(const R of B.Zf){if(R.effect===q){B.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&B.computeBonesUsingShaders&&B.numBoneInfluencers>0&&(B.computeBonesUsingShaders=!1)}}else{const q=this._defines[this._currentRank];if(q)for(let L=0;L<q.length;L++)R=R.replace("#define "+q[L],"");this._currentRank++}return R}}},11621:(R,q,L)=>{"use strict";L.d(q,{c:()=>F,d:()=>C});var B=L(11136),N=L(11352),h=L(10760),Z=L(10837),z=L(11246);L(11627);const Y={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class F{constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y;this._fullscreenViewport=new N.e(0,0,1,1);const L=q.xa??Y.xa,h=q.indices??Y.indices;this.hd=R,this._vertexBuffers={[B.e.PositionKind]:new B.e(R,L,B.e.PositionKind,!1,!1,2)},this._indexBuffer=R.createIndexBuffer(h),this._onContextRestoredObserver=R.onContextRestoredObservable.add((()=>{this._indexBuffer=R.createIndexBuffer(h);for(const R in this._vertexBuffers){this._vertexBuffers[R]._rebuild()}}))}setViewport(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.hd.setViewport(R)}bindBuffers(R){this.hd.bindBuffers(this._vertexBuffers,this._indexBuffer,R)}applyEffectWrapper(R){this.hd.setState(!0),this.hd.depthCullingState.depthTest=!1,this.hd.stencilState.stencilTest=!1,this.hd.enableEffect(R.drawWrapper),this.bindBuffers(R.effect),R.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.hd.depthCullingState.depthTest,this._savedStateStencilTest=this.hd.stencilState.stencilTest}restoreStates(){this.hd.depthCullingState.depthTest=this._savedStateDepthTest,this.hd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.hd.drawElementsType(0,0,6)}_isRenderTargetTexture(R){return void 0!==R.renderTarget}render(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!R.effect.isReady())return;this.saveStates(),this.setViewport();const L=null===q?null:this._isRenderTargetTexture(q)?q.renderTarget:q;L&&this.hd.bindFramebuffer(L),this.applyEffectWrapper(R),this.draw(),L&&this.hd.unBindFramebuffer(L),this.restoreStates()}dispose(){const R=this._vertexBuffers[B.e.PositionKind];R&&(R.dispose(),delete this._vertexBuffers[B.e.PositionKind]),this._indexBuffer&&this.hd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.hd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class C{static RegisterShaderCodeProcessing(R,q){q?C._CustomShaderCodeProcessing[R??""]=q:delete C._CustomShaderCodeProcessing[R??""]}static _GetShaderCodeProcessing(R){return C._CustomShaderCodeProcessing[R]??C._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(R){this.options.name=R}isReady(){var R;return(null===(R=this._drawWrapper.effect)||void 0===R?void 0:R.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(R){this._drawWrapper.effect=R}constructor(R){this.alphaMode=0,this.onEffectCreatedObservable=new h.b(void 0,!0),this.onApplyObservable=new h.b,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...R,name:R.name||"effectWrapper",hd:R.hd,uniforms:R.uniforms||R.uniformNames||[],uniformNames:void 0,samplers:R.samplers||R.samplerNames||[],samplerNames:void 0,attributeNames:R.attributeNames||["position"],uniformBuffers:R.uniformBuffers||[],defines:R.defines||"",useShaderStore:R.useShaderStore||!1,vertexUrl:R.vertexUrl||R.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:R.fragmentShader||"pass",indexParameters:R.indexParameters,blockCompilation:R.blockCompilation||!1,shaderLanguage:R.shaderLanguage||0,onCompiled:R.onCompiled||void 0,extraInitializations:R.extraInitializations||void 0,extraInitializationsAsync:R.extraInitializationsAsync||void 0,useAsPostProcess:R.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),R.vertexUrl||R.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.hd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new z.b(this.options.hd),this._webGPUReady=1===this.options.shaderLanguage;const q=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,q,this.options.extraInitializations)}_gatherImports(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(R&&this._webGPUReady?q.push(Promise.all([L.e(37).then(L.bind(L,13253))])):q.push(Promise.all([Promise.resolve().then(L.bind(L,11627))])))}_postConstructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,B&&this._importPromises.push(...B);const N=this.options.hd.isWebGPU&&!C.ForceGLSL;this._gatherImports(N,this._importPromises),void 0!==L&&L(N,this._importPromises),N&&this._webGPUReady&&(this.options.shaderLanguage=1),R||this.updateEffect(q)}updateEffect(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7?arguments[7]:void 0;const F=C._GetShaderCodeProcessing(this.name);if(null!==F&&void 0!==F&&F.defineCustomBindings){var e,y;const B=(null===(e=q)||void 0===e?void 0:e.slice())??[];B.push(...this.options.uniforms);const N=(null===(y=L)||void 0===y?void 0:y.slice())??[];N.push(...this.options.samplers),R=F.defineCustomBindings(this.name,R,B,N),q=B,L=N}this.options.defines=R||"";const U=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let n;n=this.options.extraInitializationsAsync?async()=>{null===U||void 0===U||U(),await this.options.extraInitializationsAsync}:U,this.options.useShaderStore?this._drawWrapper.effect=this.options.hd.createEffect({vertex:z??this._shaderPath.vertex,fragment:Y??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:q||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:L||this.options.samplers,defines:null!==R?R:"",fallbacks:null,onCompiled:N??this.options.onCompiled,onError:h??null,indexParameters:B||this.options.indexParameters,processCodeAfterIncludes:null!==F&&void 0!==F&&F.processCodeAfterIncludes?(R,q)=>F.processCodeAfterIncludes(this.name,R,q):null,processFinalCode:null!==F&&void 0!==F&&F.processFinalCode?(R,q)=>F.processFinalCode(this.name,R,q):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:n},this.options.hd):this._drawWrapper.effect=new Z.c(this._shaderPath,this.options.attributeNames,q||this.options.uniforms,L||this.options.samplerNames,this.options.hd,R,void 0,N||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,n),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var R,q;this.options.useAsPostProcess&&(this.options.hd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(R=C._GetShaderCodeProcessing(this.name))||void 0===R||null===(q=R.bindCustomBindings)||void 0===q||q.call(R,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}C.ForceGLSL=!1,C._CustomShaderCodeProcessing={}},11126:(R,q,L)=>{"use strict";L.d(q,{e:()=>h,f:()=>N});var B=L(11123);function N(R,q){q.EXPOSURE&&R.push("exposureLinear"),q.CONTRAST&&R.push("contrast"),q.COLORGRADING&&R.push("colorTransformSettings"),(q.VIGNETTE||q.DITHER)&&R.push("vInverseScreenSize"),q.VIGNETTE&&(R.push("vignetteSettings1"),R.push("vignetteSettings2")),q.COLORCURVES&&(0,B.c)(R),q.DITHER&&R.push("ditherIntensity")}function h(R,q){q.COLORGRADING&&R.push("txColorTransform")}},11104:(R,q,L)=>{"use strict";L.d(q,{d:()=>U});var B=L(11053),N=L(11058),h=L(10760),Z=L(11112),z=L(11117),Y=L(11123);class F{constructor(){this._dirty=!0,this._tempColor=new Z.g(0,0,0,0),this._globalCurve=new Z.g(0,0,0,0),this._highlightsCurve=new Z.g(0,0,0,0),this._midtonesCurve=new Z.g(0,0,0,0),this._shadowsCurve=new Z.g(0,0,0,0),this._positiveCurve=new Z.g(0,0,0,0),this._negativeCurve=new Z.g(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(R){this._globalHue=R,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(R){this._globalDensity=R,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(R){this._globalSaturation=R,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(R){this._globalExposure=R,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(R){this._highlightsHue=R,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(R){this._highlightsDensity=R,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(R){this._highlightsSaturation=R,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(R){this._highlightsExposure=R,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(R){this._midtonesHue=R,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(R){this._midtonesDensity=R,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(R){this._midtonesSaturation=R,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(R){this._midtonesExposure=R,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(R){this._shadowsHue=R,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(R){this._shadowsDensity=R,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(R){this._shadowsSaturation=R,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(R){this._shadowsExposure=R,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";R._dirty&&(R._dirty=!1,R._getColorGradingDataToRef(R._globalHue,R._globalDensity,R._globalSaturation,R._globalExposure,R._globalCurve),R._getColorGradingDataToRef(R._highlightsHue,R._highlightsDensity,R._highlightsSaturation,R._highlightsExposure,R._tempColor),R._tempColor.multiplyToRef(R._globalCurve,R._highlightsCurve),R._getColorGradingDataToRef(R._midtonesHue,R._midtonesDensity,R._midtonesSaturation,R._midtonesExposure,R._tempColor),R._tempColor.multiplyToRef(R._globalCurve,R._midtonesCurve),R._getColorGradingDataToRef(R._shadowsHue,R._shadowsDensity,R._shadowsSaturation,R._shadowsExposure,R._tempColor),R._tempColor.multiplyToRef(R._globalCurve,R._shadowsCurve),R._highlightsCurve.subtractToRef(R._midtonesCurve,R._positiveCurve),R._midtonesCurve.subtractToRef(R._shadowsCurve,R._negativeCurve)),q&&(q.setFloat4(L,R._positiveCurve.r,R._positiveCurve.g,R._positiveCurve.b,R._positiveCurve.a),q.setFloat4(B,R._midtonesCurve.r,R._midtonesCurve.g,R._midtonesCurve.b,R._midtonesCurve.a),q.setFloat4(N,R._negativeCurve.r,R._negativeCurve.g,R._negativeCurve.b,R._negativeCurve.a))}_getColorGradingDataToRef(R,q,L,B,N){null!=R&&(R=F._Clamp(R,0,360),q=F._Clamp(q,-100,100),L=F._Clamp(L,-100,100),B=F._Clamp(B,-100,100),q=F._ApplyColorGradingSliderNonlinear(q),q*=.5,B=F._ApplyColorGradingSliderNonlinear(B),q<0&&(q*=-1,R=(R+180)%360),F._FromHSBToRef(R,q,50+.25*B,N),N.scaleToRef(2,N),N.a=1+.01*L)}static _ApplyColorGradingSliderNonlinear(R){R/=100;let q=Math.abs(R);return q=Math.pow(q,2),R<0&&(q*=-1),q*=100,q}static _FromHSBToRef(R,q,L,B){let N=F._Clamp(R,0,360);const h=F._Clamp(q/100,0,1),Z=F._Clamp(L/100,0,1);if(0===h)B.r=Z,B.g=Z,B.b=Z;else{N/=60;const R=Math.floor(N),q=N-R,L=Z*(1-h),z=Z*(1-h*q),Y=Z*(1-h*(1-q));switch(R){case 0:B.r=Z,B.g=Y,B.b=L;break;case 1:B.r=z,B.g=Z,B.b=L;break;case 2:B.r=L,B.g=Z,B.b=Y;break;case 3:B.r=L,B.g=z,B.b=Z;break;case 4:B.r=Y,B.g=L,B.b=Z;break;default:B.r=Z,B.g=L,B.b=z}}B.a=1}static _Clamp(R,q,L){return Math.min(Math.max(R,q),L)}clone(){return z.b.Clone((()=>new F),this)}serialize(){return z.b.Serialize(this)}static Parse(R){return z.b.Parse((()=>new F),R,null,null)}}F.PrepareUniforms=Y.c,(0,B.d)([(0,N.K)()],F.prototype,"_globalHue",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_globalDensity",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_globalSaturation",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_globalExposure",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_highlightsHue",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_highlightsDensity",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_highlightsSaturation",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_highlightsExposure",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_midtonesHue",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_midtonesDensity",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_midtonesSaturation",void 0),(0,B.d)([(0,N.K)()],F.prototype,"_midtonesExposure",void 0),z.b._ColorCurvesParser=F.Parse;var C=L(10900),e=L(11126),y=L(10889);class U{constructor(){this.colorCurves=new F,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=U.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new Z.g(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=U.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new h.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(R){this._colorCurvesEnabled!==R&&(this._colorCurvesEnabled=R,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(R){this._colorGradingTexture!==R&&(this._colorGradingTexture=R,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(R){this._colorGradingEnabled!==R&&(this._colorGradingEnabled=R,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(R){this._colorGradingWithGreenDepth!==R&&(this._colorGradingWithGreenDepth=R,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(R){this._colorGradingBGR!==R&&(this._colorGradingBGR=R,this._updateParameters())}get exposure(){return this._exposure}set exposure(R){this._exposure!==R&&(this._exposure=R,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(R){this._toneMappingEnabled!==R&&(this._toneMappingEnabled=R,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(R){this._toneMappingType!==R&&(this._toneMappingType=R,this._updateParameters())}get contrast(){return this._contrast}set contrast(R){this._contrast!==R&&(this._contrast=R,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(R){this.vignetteCenterY=R}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(R){this.vignetteCenterX=R}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(R){this._vignetteBlendMode!==R&&(this._vignetteBlendMode=R,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(R){this._vignetteEnabled!==R&&(this._vignetteEnabled=R,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(R){this._ditheringEnabled!==R&&(this._ditheringEnabled=R,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(R){this._ditheringIntensity!==R&&(this._ditheringIntensity=R,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(R){this._skipFinalColorClamp!==R&&(this._skipFinalColorClamp=R,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(R){this._applyByPostProcess!==R&&(this._applyByPostProcess=R,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(R){this._isEnabled!==R&&(this._isEnabled=R,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(R){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return R.VIGNETTE=!1,R.TONEMAPPING=0,R.CONTRAST=!1,R.EXPOSURE=!1,R.COLORCURVES=!1,R.COLORGRADING=!1,R.COLORGRADING3D=!1,R.DITHER=!1,R.IMAGEPROCESSING=!1,R.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(R.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(R.VIGNETTE=this.vignetteEnabled,R.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===U._VIGNETTEMODE_MULTIPLY,R.VIGNETTEBLENDMODEOPAQUE=!R.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case U.TONEMAPPING_KHR_PBR_NEUTRAL:R.TONEMAPPING=3;break;case U.TONEMAPPING_ACES:R.TONEMAPPING=2;break;default:R.TONEMAPPING=1}else R.TONEMAPPING=0;R.CONTRAST=1!==this.contrast,R.EXPOSURE=1!==this.exposure,R.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,R.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,R.COLORGRADING?R.COLORGRADING3D=this.colorGradingTexture.is3D:R.COLORGRADING3D=!1,R.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,R.SAMPLER3DBGRMAP=this.colorGradingBGR,R.DITHER=this._ditheringEnabled,R.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,R.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,R.IMAGEPROCESSING=R.VIGNETTE||!!R.TONEMAPPING||R.CONTRAST||R.EXPOSURE||R.COLORCURVES||R.COLORGRADING||R.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(R,q){if(this._colorCurvesEnabled&&this.colorCurves&&F.Bind(this.colorCurves,R),this._vignetteEnabled||this._ditheringEnabled){const L=1/R.getEngine().getRenderWidth(),B=1/R.getEngine().getRenderHeight();if(R.setFloat2("vInverseScreenSize",L,B),this._ditheringEnabled&&R.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const N=null!=q?q:B/L;let h=Math.tan(.5*this.vignetteCameraFov),Z=h*N;const z=Math.sqrt(Z*h);Z=(0,C.i)(Z,z,this.vignetteStretch),h=(0,C.i)(h,z,this.vignetteStretch),R.setFloat4("vignetteSettings1",Z,h,-Z*this.vignetteCenterX,-h*this.vignetteCenterY);const Y=-2*this.vignetteWeight;R.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,Y)}}if(R.setFloat("exposureLinear",this.exposure),R.setFloat("contrast",this.contrast),this.colorGradingTexture){R.setTexture("txColorTransform",this.colorGradingTexture);const q=this.colorGradingTexture.getSize().height;R.setFloat4("colorTransformSettings",(q-1)/q,.5/q,q,this.colorGradingTexture.level)}}clone(){return z.b.Clone((()=>new U),this)}serialize(){return z.b.Serialize(this)}static Parse(R){const q=z.b.Parse((()=>new U),R,null,null);return void 0!==R.vignetteCentreX&&(q.vignetteCenterX=R.vignetteCentreX),void 0!==R.vignetteCentreY&&(q.vignetteCenterY=R.vignetteCentreY),q}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}U.TONEMAPPING_STANDARD=0,U.TONEMAPPING_ACES=1,U.TONEMAPPING_KHR_PBR_NEUTRAL=2,U.PrepareUniforms=e.f,U.PrepareSamplers=e.e,U._VIGNETTEMODE_MULTIPLY=0,U._VIGNETTEMODE_OPAQUE=1,(0,B.d)([(0,N.h)()],U.prototype,"colorCurves",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_colorCurvesEnabled",void 0),(0,B.d)([(0,N.A)("colorGradingTexture")],U.prototype,"_colorGradingTexture",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_colorGradingEnabled",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_colorGradingWithGreenDepth",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_colorGradingBGR",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_exposure",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_toneMappingEnabled",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_toneMappingType",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_contrast",void 0),(0,B.d)([(0,N.K)()],U.prototype,"vignetteStretch",void 0),(0,B.d)([(0,N.K)()],U.prototype,"vignetteCenterX",void 0),(0,B.d)([(0,N.K)()],U.prototype,"vignetteCenterY",void 0),(0,B.d)([(0,N.K)()],U.prototype,"vignetteWeight",void 0),(0,B.d)([(0,N.m)()],U.prototype,"vignetteColor",void 0),(0,B.d)([(0,N.K)()],U.prototype,"vignetteCameraFov",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_vignetteBlendMode",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_vignetteEnabled",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_ditheringEnabled",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_ditheringIntensity",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_skipFinalColorClamp",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_applyByPostProcess",void 0),(0,B.d)([(0,N.K)()],U.prototype,"_isEnabled",void 0),z.b._ImageProcessingConfigurationParser=U.Parse,(0,y.f)("BABYLON.ImageProcessingConfiguration",U)},11305:(R,q,L)=>{"use strict";L.d(q,{e:()=>e});var B=L(11053),N=L(11216),h=L(11058),Z=L(11298),z=L(11263),Y=L(11314),F=L(11248);class C extends z.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class e extends Y.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"DetailMap",140,new C,q),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=N.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,q,L){return!this._isEnabled||!(R._areTexturesDirty&&q.texturesEnabled&&L.getCaps().standardDerivatives&&this._texture&&Z.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(R,q){if(this._isEnabled){R.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const L=q.getEngine();R._areTexturesDirty&&(L.getCaps().standardDerivatives&&this._texture&&Z.e.DetailTextureEnabled&&this._isEnabled?((0,F.P)(this._texture,R,"DETAIL"),R.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):R.DETAIL=!1)}else R.DETAIL=!1}bindForSubMesh(R,q){if(!this._isEnabled)return;const L=this._material.isFrozen;R.useUbo&&L&&R.isSync||this._texture&&Z.e.DetailTextureEnabled&&(R.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,F.q)(this._texture,R,"detail")),q.texturesEnabled&&this._texture&&Z.e.DetailTextureEnabled&&R.setTexture("detailSampler",this._texture)}hasTexture(R){return this._texture===R}getActiveTextures(R){this._texture&&R.push(this._texture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture)}dispose(R){var q;R&&(null===(q=this._texture)||void 0===q||q.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(R){R.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,B.d)([(0,h.A)("detailTexture"),(0,h.c)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),(0,B.d)([(0,h.K)()],e.prototype,"diffuseBlendLevel",void 0),(0,B.d)([(0,h.K)()],e.prototype,"roughnessBlendLevel",void 0),(0,B.d)([(0,h.K)()],e.prototype,"bumpLevel",void 0),(0,B.d)([(0,h.K)(),(0,h.c)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"normalBlendMethod",void 0),(0,B.d)([(0,h.K)(),(0,h.c)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0)},11216:(R,q,L)=>{"use strict";L.d(q,{c:()=>p});var B=L(11053),N=L(11058),h=L(10757),Z=L(10760),z=L(10797),Y=L(11218),F=L(11132),C=L(10767),e=L(11198),y=L(11246),U=L(11117);class n{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(R){this._func=R}get funcRef(){return this._funcRef}set funcRef(R){this._funcRef=R}get funcMask(){return this._funcMask}set funcMask(R){this._funcMask=R}get opStencilFail(){return this._opStencilFail}set opStencilFail(R){this._opStencilFail=R}get opDepthFail(){return this._opDepthFail}set opDepthFail(R){this._opDepthFail=R}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(R){this._opStencilDepthPass=R}get mask(){return this._mask}set mask(R){this._mask=R}get enabled(){return this._enabled}set enabled(R){this._enabled=R}getClassName(){return"MaterialStencilState"}copyTo(R){U.b.Clone((()=>R),this)}serialize(){return U.b.Serialize(this)}parse(R,q,L){U.b.Parse((()=>this),R,q,L)}}(0,B.d)([(0,N.K)()],n.prototype,"func",null),(0,B.d)([(0,N.K)()],n.prototype,"funcRef",null),(0,B.d)([(0,N.K)()],n.prototype,"funcMask",null),(0,B.d)([(0,N.K)()],n.prototype,"opStencilFail",null),(0,B.d)([(0,N.K)()],n.prototype,"opDepthFail",null),(0,B.d)([(0,N.K)()],n.prototype,"opStencilDepthPass",null),(0,B.d)([(0,N.K)()],n.prototype,"mask",null),(0,B.d)([(0,N.K)()],n.prototype,"enabled",null);var r=L(11248);class p{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(R){if(this._alpha===R)return;const q=this._alpha;this._alpha=R,1!==q&&1!==R||this.Ag(p.MiscDirtyFlag+p.PrePassDirtyFlag)}get alpha(){return this._alpha}set Pg(R){this._backFaceCulling!==R&&(this._backFaceCulling=R,this.Ag(p.TextureDirtyFlag))}get Pg(){return this._backFaceCulling}set cullBackFaces(R){this._cullBackFaces!==R&&(this._cullBackFaces=R,this.Ag(p.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(R){this._blockDirtyMechanism!==R&&(this._blockDirtyMechanism=R,R||this.$i())}atomicMaterialsUpdate(R){this.blockDirtyMechanism=!0;try{R(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(R){this._onDisposeObserver&&this.ej.remove(this._onDisposeObserver),this._onDisposeObserver=this.ej.add(R)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Z.b),this._onBindObservable}set onBind(R){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(R)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Z.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Z.b),this._onEffectCreatedObservable}set alphaMode(R){this._alphaMode!==R&&(this._alphaMode=R,this.Ag(p.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(R){this._needDepthPrePass!==R&&(this._needDepthPrePass=R,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(R){this._fogEnabled!==R&&(this._fogEnabled=R,this.Ag(p.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case p.WireFrameFillMode:case p.LineListDrawMode:case p.LineLoopDrawMode:case p.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(R){this.fillMode=R?p.WireFrameFillMode:p.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case p.PointFillMode:case p.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(R){this.fillMode=R?p.PointFillMode:p.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(R){this._fillMode!==R&&(this._fillMode=R,this.Ag(p.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(R){const q=this.va().getEngine().getCaps().fragmentDepthSupported;R&&!q&&C.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=R&&q,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(R){this._drawWrapper=R}constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.ej=new Z.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new n,this._useUBO=!1,this._fillMode=p.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=R;const N=q||z.b.LastCreatedScene;N&&(this._scene=N,this._dirtyCallbacks={},this._forceGLSL=B,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=R||h.f.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new y.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new F.d(this._scene.getEngine(),void 0,void 0,R),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),L||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),p.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var R;const q=this.va().getEngine();null===(R=this._uniformBuffer)||void 0===R||R.dispose(),q.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new F.d(q,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new F.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(R){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.$i(),this.checkReadyOnlyOnce=!0}unfreeze(){this.$i(),this.checkReadyOnlyOnce=!1}isReady(R,q){return!0}isReadyForSubMesh(R,q,L){const B=q.materialDefines;return!!B&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=B,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(R){return null!==this.sideOrientation?this.sideOrientation:R.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(R){this._transparencyMode!==R&&(this._transparencyMode=R,this._forceAlphaTest=R===p.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===p.MATERIAL_OPAQUE||this._transparencyMode===p.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(R){return R.visibility<1||!this._disableAlphaBlending&&(R.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(R){return!this.needAlphaBlendingForMesh(R)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}$i(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this.va().meshes;for(const L of q)if(L.Zf)for(const q of L.Zf)if(q.Ha()===this)for(const L of q._drawWrappers)L&&this._materialContext===L.materialContext&&(L._wasPreviouslyReady=!1,L._wasPreviouslyUsingInstances=null,L._forceRebindOnNextCall=R);R&&this.Ag(p.AllDirtyFlag)}_preBind(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this._scene.getEngine(),B=(null==q?this.sideOrientation:q)===p.ClockWiseSideOrientation;return L.enableEffect(R||this._getDrawWrapper()),L.setState(this.Pg,this.zOffset,!1,B,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),B}bind(R,q){}buildUniformLayout(){const R=this._uniformBuffer;this._eventInfo.ubo=R,this._callbackPluginEventGeneric(8,this._eventInfo),R.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(R,q,L){const B=L._drawWrapper;this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),B._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(R){}bindView(R){this._useUBO?this._needToBindSceneUbo=!0:R.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(R){this._useUBO?this._needToBindSceneUbo=!0:(R.setMatrix("viewProjection",this.va().getTransformMatrix()),R.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(R,q){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(R,q)}_afterBind(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&q&&(this._needToBindSceneUbo=!1,(0,r.o)(q,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=R?R.visibility:1,this._onBindObservable&&R&&this._onBindObservable.notifyObservers(R),this.disableDepthWrite){const R=this._scene.getEngine();this._cachedDepthWriteState=R.getDepthWrite(),R.setDepthWrite(!1)}if(this.disableColorWrite){const R=this._scene.getEngine();this._cachedColorWriteState=R.getColorWrite(),R.setColorWrite(!1)}if(0!==this.depthFunction){const R=this._scene.getEngine();this._cachedDepthFunctionState=R.getDepthFunction()||0,R.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(R){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=R,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(R){return null}_clonePlugins(R,q){const L={};if(this._serializePlugins(L),p._ParsePlugins(L,R,this._scene,q),this.pluginManager)for(const B of this.pluginManager._plugins){const q=R.pluginManager.getPlugin(B.name);q&&B.copyTo(q)}}getBindedMeshes(){if(this.meshMap){const R=[];for(const q in this.meshMap){const L=this.meshMap[q];L&&R.push(L)}return R}return this._scene.meshes.filter((R=>R.material===this))}forceCompilation(R,q,L,B){const N={clipPlane:!1,useInstances:!1,...L},h=this.va(),Z=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const z=()=>{if(!this._scene||!this._scene.getEngine())return;const L=h.clipPlane;if(N.clipPlane&&(h.clipPlane=new e.e(0,0,0,1)),this._storeEffectOnSubMeshes){let L=!0,h=null;if(R.Zf){const q=new Y.c(0,0,0,0,0,R,void 0,!1,!1);q.materialDefines&&(q.materialDefines._renderId=-1),this.isReadyForSubMesh(R,q,N.useInstances)||(q.effect&&q.effect.getCompilationError()&&q.effect.allFallbacksProcessed()?h=q.effect.getCompilationError():(L=!1,setTimeout(z,16)))}L&&(this.allowShaderHotSwapping=Z,h&&B&&B(h),q&&q(this))}else this.isReady()?(this.allowShaderHotSwapping=Z,q&&q(this)):setTimeout(z,16);N.clipPlane&&(h.clipPlane=L)};z()}forceCompilationAsync(R,q){return new Promise(((L,B)=>{this.forceCompilation(R,(()=>{L()}),q,(R=>{B(R)}))}))}Ag(R){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(p._DirtyCallbackArray.length=0,R&p.TextureDirtyFlag&&p._DirtyCallbackArray.push(p._TextureDirtyCallBack),R&p.LightDirtyFlag&&p._DirtyCallbackArray.push(p._LightsDirtyCallBack),R&p.FresnelDirtyFlag&&p._DirtyCallbackArray.push(p._FresnelDirtyCallBack),R&p.AttributesDirtyFlag&&p._DirtyCallbackArray.push(p._AttributeDirtyCallBack),R&p.MiscDirtyFlag&&p._DirtyCallbackArray.push(p._MiscDirtyCallBack),R&p.PrePassDirtyFlag&&p._DirtyCallbackArray.push(p._PrePassDirtyCallBack),p._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(p._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const R=this.va().meshes;for(const q of R)if(q.Zf)for(const R of q.Zf)R.Ha()===this&&R.resetDrawCache()}_markAllSubMeshesAsDirty(R){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const q=this.va().meshes;for(const L of q)if(L.Zf)for(const q of L.Zf)if(q.Ha(!1)===this)for(const L of q._drawWrappers)L&&L.defines&&L.defines.markAllAsDirty&&this._materialContext===L.materialContext&&R(L.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const R=this.va().enablePrePassRenderer();R&&R.Ag()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(p._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(p._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(p._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(p._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(p._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(p._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(p._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(p._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(p._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(p._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const R=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.ej.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(R)}))}}setPrePassRenderer(R){return!1}dispose(R,q,L){const B=this.va();if(B.stopAnimation(this),B.freeProcessedMaterials(),B.removeMaterial(this),this._eventInfo.forceDisposeTextures=q,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const R=this._parentContainer.materials.indexOf(this);R>-1&&this._parentContainer.materials.splice(R,1),this._parentContainer=null}if(!0!==L)if(this.meshMap)for(const N in this.meshMap){const q=this.meshMap[N];q&&(q.material=null,this.releaseVertexArrayObject(q,R))}else{const q=B.meshes;for(const L of q)L.material!==this||L.sourceMesh||(L.material=null,this.releaseVertexArrayObject(L,R))}this._uniformBuffer.dispose(),R&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.ej.notifyObservers(this),this.ej.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(R,q){const L=R.yj;if(L)if(this._storeEffectOnSubMeshes){if(R.Zf)for(const B of R.Zf)L._releaseVertexArrayObject(B.effect),q&&B.effect&&B.effect.dispose()}else L._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const R=U.b.Serialize(this);return R.stencil=this.stencil.serialize(),R.uniqueId=this.uniqueId,this._serializePlugins(R),R}_serializePlugins(R){if(R.plugins={},this.pluginManager)for(const q of this.pluginManager._plugins)R.plugins[q.getClassName()]=q.serialize()}static Parse(R,q,L){if(R.customType){if("BABYLON.PBRMaterial"===R.customType&&R.overloadedAlbedo&&(R.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return C.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else R.customType="BABYLON.StandardMaterial";const B=h.f.Instantiate(R.customType).Parse(R,q,L);return B._loadedUniqueId=R.uniqueId,B}static _ParsePlugins(R,q,L,B){if(R.plugins)for(const z in R.plugins){var N,Z;const Y=R.plugins[z];let F=null===(N=q.pluginManager)||void 0===N?void 0:N.getPlugin(Y.name);if(!F){const R=h.f.Instantiate("BABYLON."+z);R&&(F=new R(q))}null===(Z=F)||void 0===Z||Z.parse(Y,L,B)}}}p.TriangleFillMode=0,p.WireFrameFillMode=1,p.PointFillMode=2,p.PointListDrawMode=3,p.LineListDrawMode=4,p.LineLoopDrawMode=5,p.LineStripDrawMode=6,p.TriangleStripDrawMode=7,p.TriangleFanDrawMode=8,p.ClockWiseSideOrientation=0,p.CounterClockWiseSideOrientation=1,p.TextureDirtyFlag=1,p.LightDirtyFlag=2,p.FresnelDirtyFlag=4,p.AttributesDirtyFlag=8,p.MiscDirtyFlag=16,p.PrePassDirtyFlag=32,p.AllDirtyFlag=63,p.MATERIAL_OPAQUE=0,p.MATERIAL_ALPHATEST=1,p.MATERIAL_ALPHABLEND=2,p.MATERIAL_ALPHATESTANDBLEND=3,p.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,p.MATERIAL_NORMALBLENDMETHOD_RNM=1,p.OnEventObservable=new Z.b,p._AllDirtyCallBack=R=>R.markAllAsDirty(),p._ImageProcessingDirtyCallBack=R=>R.markAsImageProcessingDirty(),p._TextureDirtyCallBack=R=>R.markAsTexturesDirty(),p._FresnelDirtyCallBack=R=>R.markAsFresnelDirty(),p._MiscDirtyCallBack=R=>R.markAsMiscDirty(),p._PrePassDirtyCallBack=R=>R.markAsPrePassDirty(),p._LightsDirtyCallBack=R=>R.markAsLightDirty(),p._AttributeDirtyCallBack=R=>R.markAsAttributesDirty(),p._FresnelAndMiscDirtyCallBack=R=>{p._FresnelDirtyCallBack(R),p._MiscDirtyCallBack(R)},p._TextureAndMiscDirtyCallBack=R=>{p._TextureDirtyCallBack(R),p._MiscDirtyCallBack(R)},p._DirtyCallbackArray=[],p._RunDirtyCallBacks=R=>{for(const q of p._DirtyCallbackArray)q(R)},(0,B.d)([(0,N.K)()],p.prototype,"id",void 0),(0,B.d)([(0,N.K)()],p.prototype,"uniqueId",void 0),(0,B.d)([(0,N.K)()],p.prototype,"name",void 0),(0,B.d)([(0,N.K)()],p.prototype,"metadata",void 0),(0,B.d)([(0,N.K)()],p.prototype,"checkReadyOnEveryCall",void 0),(0,B.d)([(0,N.K)()],p.prototype,"checkReadyOnlyOnce",void 0),(0,B.d)([(0,N.K)()],p.prototype,"state",void 0),(0,B.d)([(0,N.K)("alpha")],p.prototype,"_alpha",void 0),(0,B.d)([(0,N.K)("Pg")],p.prototype,"_backFaceCulling",void 0),(0,B.d)([(0,N.K)("cullBackFaces")],p.prototype,"_cullBackFaces",void 0),(0,B.d)([(0,N.K)()],p.prototype,"sideOrientation",void 0),(0,B.d)([(0,N.K)("alphaMode")],p.prototype,"_alphaMode",void 0),(0,B.d)([(0,N.K)()],p.prototype,"_needDepthPrePass",void 0),(0,B.d)([(0,N.K)()],p.prototype,"disableDepthWrite",void 0),(0,B.d)([(0,N.K)()],p.prototype,"disableColorWrite",void 0),(0,B.d)([(0,N.K)()],p.prototype,"forceDepthWrite",void 0),(0,B.d)([(0,N.K)()],p.prototype,"depthFunction",void 0),(0,B.d)([(0,N.K)()],p.prototype,"separateCullingPass",void 0),(0,B.d)([(0,N.K)("fogEnabled")],p.prototype,"_fogEnabled",void 0),(0,B.d)([(0,N.K)()],p.prototype,"pointSize",void 0),(0,B.d)([(0,N.K)()],p.prototype,"zOffset",void 0),(0,B.d)([(0,N.K)()],p.prototype,"zOffsetUnits",void 0),(0,B.d)([(0,N.K)()],p.prototype,"pointsCloud",null),(0,B.d)([(0,N.K)()],p.prototype,"fillMode",null),(0,B.d)([(0,N.K)()],p.prototype,"useLogarithmicDepth",null),(0,B.d)([(0,N.K)()],p.prototype,"transparencyMode",null)},11263:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{constructor(R){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=R,R)for(const q in R)Object.prototype.hasOwnProperty.call(R,q)&&this._setDefaultValue(q)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||R,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const R of Object.keys(this))"_"!==R[0]&&this._keys.push(R);if(this._externalProperties)for(const R in this._externalProperties)-1===this._keys.indexOf(R)&&this._keys.push(R)}isEqual(R){if(this._keys.length!==R._keys.length)return!1;for(let q=0;q<this._keys.length;q++){const L=this._keys[q];if(this[L]!==R[L])return!1}return!0}cloneTo(R){this._keys.length!==R._keys.length&&(R._keys=this._keys.slice(0));for(let q=0;q<this._keys.length;q++){const L=this._keys[q];R[L]=this[L]}}reset(){this._keys.forEach((R=>this._setDefaultValue(R)))}_setDefaultValue(R){var q,L,B,N;const h=(null===(q=this._externalProperties)||void 0===q||null===(L=q[R])||void 0===L?void 0:L.type)??typeof this[R],Z=null===(B=this._externalProperties)||void 0===B||null===(N=B[R])||void 0===N?void 0:N.default;switch(h){case"number":this[R]=Z??0;break;case"string":this[R]=Z??"";break;default:this[R]=Z??!1}}toString(){let R="";for(let q=0;q<this._keys.length;q++){const L=this._keys[q],B=this[L];switch(typeof B){case"number":case"string":R+="#define "+L+" "+B+"\n";break;default:B&&(R+="#define "+L+"\n")}}return R}}},11298:(R,q,L)=>{"use strict";L.d(q,{e:()=>N});var B=L(10834);class N{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(R){this._DiffuseTextureEnabled!==R&&(this._DiffuseTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(R){this._DetailTextureEnabled!==R&&(this._DetailTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(R){this._DecalMapEnabled!==R&&(this._DecalMapEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(R){this._AmbientTextureEnabled!==R&&(this._AmbientTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(R){this._OpacityTextureEnabled!==R&&(this._OpacityTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(R){this._ReflectionTextureEnabled!==R&&(this._ReflectionTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(R){this._EmissiveTextureEnabled!==R&&(this._EmissiveTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(R){this._SpecularTextureEnabled!==R&&(this._SpecularTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(R){this._BumpTextureEnabled!==R&&(this._BumpTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(R){this._LightmapTextureEnabled!==R&&(this._LightmapTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(R){this._RefractionTextureEnabled!==R&&(this._RefractionTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(R){this._ColorGradingTextureEnabled!==R&&(this._ColorGradingTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(R){this._FresnelEnabled!==R&&(this._FresnelEnabled=R,B.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(R){this._ClearCoatTextureEnabled!==R&&(this._ClearCoatTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(R){this._ClearCoatBumpTextureEnabled!==R&&(this._ClearCoatBumpTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(R){this._ClearCoatTintTextureEnabled!==R&&(this._ClearCoatTintTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(R){this._SheenTextureEnabled!==R&&(this._SheenTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(R){this._AnisotropicTextureEnabled!==R&&(this._AnisotropicTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(R){this._ThicknessTextureEnabled!==R&&(this._ThicknessTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(R){this._RefractionIntensityTextureEnabled!==R&&(this._RefractionIntensityTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(R){this._TranslucencyIntensityTextureEnabled!==R&&(this._TranslucencyIntensityTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(R){this._TranslucencyColorTextureEnabled!==R&&(this._TranslucencyColorTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(R){this._IridescenceTextureEnabled!==R&&(this._IridescenceTextureEnabled=R,B.e.MarkAllMaterialsAsDirty(1))}}N._DiffuseTextureEnabled=!0,N._DetailTextureEnabled=!0,N._DecalMapEnabled=!0,N._AmbientTextureEnabled=!0,N._OpacityTextureEnabled=!0,N._ReflectionTextureEnabled=!0,N._EmissiveTextureEnabled=!0,N._SpecularTextureEnabled=!0,N._BumpTextureEnabled=!0,N._LightmapTextureEnabled=!0,N._RefractionTextureEnabled=!0,N._ColorGradingTextureEnabled=!0,N._FresnelEnabled=!0,N._ClearCoatTextureEnabled=!0,N._ClearCoatBumpTextureEnabled=!0,N._ClearCoatTintTextureEnabled=!0,N._SheenTextureEnabled=!0,N._AnisotropicTextureEnabled=!0,N._ThicknessTextureEnabled=!0,N._RefractionIntensityTextureEnabled=!0,N._TranslucencyIntensityTextureEnabled=!0,N._TranslucencyColorTextureEnabled=!0,N._IridescenceTextureEnabled=!0},11248:(R,q,L)=>{"use strict";L.d(q,{C:()=>t,F:()=>e,I:()=>o,K:()=>m,L:()=>I,P:()=>r,T:()=>S,X:()=>l,Y:()=>G,_:()=>W,cb:()=>P,d:()=>d,db:()=>y,g:()=>C,k:()=>v,l:()=>F,n:()=>U,o:()=>n,q:()=>p,s:()=>D,w:()=>c,y:()=>T});var B=L(10767),N=L(11112),h=L(10797),Z=L(11207),z=L(11255);const Y=N.e.Black();function F(R,q,L){if(!R||R.LOGARITHMICDEPTH||R.indexOf&&R.indexOf("LOGARITHMICDEPTH")>=0){const R=L.activeCamera;1===R.mode&&B.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),q.setFloat("logarithmicDepthConstant",2/(Math.log(R.maxZ+1)/Math.LN2))}}function C(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];L&&R.fogEnabled&&(!q||q.applyFog)&&0!==R.fogMode&&(L.setFloat4("vFogInfos",R.fogMode,R.fogStart,R.fogEnd,R.fogDensity),B?(R.fogColor.toLinearSpaceToRef(Y,R.getEngine().useExactSrgbConversions),L.setColor3("vFogColor",Y)):L.setColor3("vFogColor",R.fogColor))}function e(R,q,L){const N=L.NUM_MORPH_INFLUENCERS;if(N>0&&h.b.LastCreatedEngine){const Z=h.b.LastCreatedEngine.getCaps().maxVertexAttribs,z=q.morphTargetManager;if(null!==z&&void 0!==z&&z.isUsingTextureForTargets)return;const Y=z&&z.supportsNormals&&L.NORMAL,F=z&&z.supportsTangents&&L.TANGENT,C=z&&z.supportsUVs&&L.UV1;for(let L=0;L<N;L++)R.push("position"+L),Y&&R.push("normal"+L),F&&R.push("tangent"+L),C&&R.push("uv_"+L),R.length>Z&&B.d.Error("Cannot add more vertex attributes for mesh "+q.name)}}function y(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R.push("world0"),R.push("world1"),R.push("world2"),R.push("world3"),q&&(R.push("previousWorld0"),R.push("previousWorld1"),R.push("previousWorld2"),R.push("previousWorld3"))}function U(R,q){const L=R.morphTargetManager;R&&L&&q.setFloatArray("morphTargetInfluences",L.influences)}function n(R,q){q.bindToEffect(R,"Scene")}function r(R,q,L){q._needUVs=!0,q[L]=!0,R.optimizeUVAllocation&&R.getTextureMatrix().isIdentityAs3x2()?(q[L+"DIRECTUV"]=R.coordinatesIndex+1,q["MAINUV"+(R.coordinatesIndex+1)]=!0):q[L+"DIRECTUV"]=0}function p(R,q,L){const B=R.getTextureMatrix();q.Cj(L+"Matrix",B)}function c(R,q,L){L.BAKED_VERTEX_ANIMATION_TEXTURE&&L.INSTANCES&&R.push("bakedVertexAnimationSettingsInstanced")}function d(R,q,L){var B;if(q&&R&&(R.computeBonesUsingShaders&&q._bonesComputationForcedToCPU&&(R.computeBonesUsingShaders=!1),R.useBones&&R.computeBonesUsingShaders&&R.skeleton)){const N=R.skeleton;if(N.isUsingTextureForMatrices&&q.getUniformIndex("boneTextureWidth")>-1){const L=N.getTransformMatrixTexture(R);q.setTexture("boneSampler",L),q.setFloat("boneTextureWidth",4*(N.bones.length+1))}else{const h=N.getTransformMatrices(R);h&&(q.setMatrices("mBones",h),L&&R.va().prePassRenderer&&R.va().prePassRenderer.getIndex(2)&&(L.previousBones[R.uniqueId]||(L.previousBones[R.uniqueId]=h.slice()),q.setMatrices("mPreviousBones",L.previousBones[R.uniqueId]),B=h,L.previousBones[R.uniqueId].set(B)))}}}function f(R,q,L,B,N){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];R._bindLight(q,L,B,N,h)}function v(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const h=Math.min(q.lightSources.length,N);for(let Z=0;Z<h;Z++){f(q.lightSources[Z],Z,R,L,"boolean"===typeof B?B:B.SPECULARTERM,q.receiveShadows)}}function T(R,q,L,B){L.NUM_BONE_INFLUENCERS>0&&(B.addCPUSkinningFallback(0,q),R.push("matricesIndices"),R.push("matricesWeights"),L.NUM_BONE_INFLUENCERS>4&&(R.push("matricesIndicesExtra"),R.push("matricesWeightsExtra")))}function t(R,q){(q.INSTANCES||q.THIN_INSTANCES)&&y(R,!!q.PREPASS_VELOCITY),q.INSTANCESCOLOR&&R.push("instanceColor")}function D(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=0;for(let h=0;h<L&&R["LIGHT"+h];h++)h>0&&(N=B+h,q.addFallback(N,"LIGHT"+h)),R.SHADOWS||(R["SHADOW"+h]&&q.addFallback(B,"SHADOW"+h),R["SHADOWPCF"+h]&&q.addFallback(B,"SHADOWPCF"+h),R["SHADOWPCSS"+h]&&q.addFallback(B,"SHADOWPCSS"+h),R["SHADOWPOISSON"+h]&&q.addFallback(B,"SHADOWPOISSON"+h),R["SHADOWESM"+h]&&q.addFallback(B,"SHADOWESM"+h),R["SHADOWCLOSEESM"+h]&&q.addFallback(B,"SHADOWCLOSEESM"+h));return N++}function S(R,q,L,B,N,h,Z){let z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Z._areMiscDirty&&(Z.LOGARITHMICDEPTH=L,Z.POINTSIZE=B,Z.FOG=N&&function(R,q){return q.fogEnabled&&R.applyFog&&0!==q.fogMode}(R,q),Z.NONUNIFORMSCALING=R.nonUniformScaling,Z.ALPHATEST=h,Z.DECAL_AFTER_DETAIL=z)}function I(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!L._areLightsDirty)return L._needNormals;let Z=0;const z={needNormals:L._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(R.lightsEnabled&&!h)for(const F of q.lightSources)if(K(R,q,F,Z,L,B,z),Z++,Z===N)break;L.SPECULARTERM=z.specularEnabled,L.SHADOWS=z.shadowEnabled;for(let F=Z;F<N;F++)void 0!==L["LIGHT"+F]&&(L["LIGHT"+F]=!1,L["HEMILIGHT"+F]=!1,L["POINTLIGHT"+F]=!1,L["DIRLIGHT"+F]=!1,L["SPOTLIGHT"+F]=!1,L["SHADOW"+F]=!1,L["SHADOWCSM"+F]=!1,L["SHADOWCSMDEBUG"+F]=!1,L["SHADOWCSMNUM_CASCADES"+F]=!1,L["SHADOWCSMUSESHADOWMAXZ"+F]=!1,L["SHADOWCSMNOBLEND"+F]=!1,L["SHADOWCSM_RIGHTHANDED"+F]=!1,L["SHADOWPCF"+F]=!1,L["SHADOWPCSS"+F]=!1,L["SHADOWPOISSON"+F]=!1,L["SHADOWESM"+F]=!1,L["SHADOWCLOSEESM"+F]=!1,L["SHADOWCUBE"+F]=!1,L["SHADOWLOWQUALITY"+F]=!1,L["SHADOWMEDIUMQUALITY"+F]=!1);const Y=R.getEngine().getCaps();return void 0===L.SHADOWFLOAT&&(z.needRebuild=!0),L.SHADOWFLOAT=z.shadowEnabled&&(Y.textureFloatRender&&Y.textureFloatLinearFiltering||Y.textureHalfFloatRender&&Y.textureHalfFloatLinearFiltering),L.LIGHTMAPEXCLUDED=z.lightmapMode,z.needRebuild&&L.rebuild(),z.needNormals}function K(R,q,L,B,N,h,z){switch(z.needNormals=!0,void 0===N["LIGHT"+B]&&(z.needRebuild=!0),N["LIGHT"+B]=!0,N["SPOTLIGHT"+B]=!1,N["HEMILIGHT"+B]=!1,N["POINTLIGHT"+B]=!1,N["DIRLIGHT"+B]=!1,L.prepareLightSpecificDefines(N,B),N["LIGHT_FALLOFF_PHYSICAL"+B]=!1,N["LIGHT_FALLOFF_GLTF"+B]=!1,N["LIGHT_FALLOFF_STANDARD"+B]=!1,L.falloffType){case Z.e.FALLOFF_GLTF:N["LIGHT_FALLOFF_GLTF"+B]=!0;break;case Z.e.FALLOFF_PHYSICAL:N["LIGHT_FALLOFF_PHYSICAL"+B]=!0;break;case Z.e.FALLOFF_STANDARD:N["LIGHT_FALLOFF_STANDARD"+B]=!0}if(h&&!L.jh.equalsFloats(0,0,0)&&(z.specularEnabled=!0),N["SHADOW"+B]=!1,N["SHADOWCSM"+B]=!1,N["SHADOWCSMDEBUG"+B]=!1,N["SHADOWCSMNUM_CASCADES"+B]=!1,N["SHADOWCSMUSESHADOWMAXZ"+B]=!1,N["SHADOWCSMNOBLEND"+B]=!1,N["SHADOWCSM_RIGHTHANDED"+B]=!1,N["SHADOWPCF"+B]=!1,N["SHADOWPCSS"+B]=!1,N["SHADOWPOISSON"+B]=!1,N["SHADOWESM"+B]=!1,N["SHADOWCLOSEESM"+B]=!1,N["SHADOWCUBE"+B]=!1,N["SHADOWLOWQUALITY"+B]=!1,N["SHADOWMEDIUMQUALITY"+B]=!1,q&&q.receiveShadows&&R.shadowsEnabled&&L.shadowEnabled){const q=L.getShadowGenerator(R.activeCamera)??L.getShadowGenerator();if(q){const R=q.getShadowMap();R&&R.renderList&&R.renderList.length>0&&(z.shadowEnabled=!0,q.prepareDefines(N,B))}}L.lightmapMode!=Z.e.LIGHTMAP_DEFAULT?(z.lightmapMode=!0,N["LIGHTMAPEXCLUDED"+B]=!0,N["LIGHTMAPNOSPECULAR"+B]=L.lightmapMode==Z.e.LIGHTMAP_SHADOWSONLY):(N["LIGHTMAPEXCLUDED"+B]=!1,N["LIGHTMAPNOSPECULAR"+B]=!1)}function m(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=function(R,q){let L=!1;if(R.activeCamera){const B=q.CAMERA_ORTHOGRAPHIC?1:0,N=q.CAMERA_PERSPECTIVE?1:0,h=1===R.activeCamera.mode?1:0,Z=0===R.activeCamera.mode?1:0;(B^h||N^Z)&&(q.CAMERA_ORTHOGRAPHIC=1===h,q.CAMERA_PERSPECTIVE=1===Z,L=!0)}return L}(R,B);!1!==h&&(Y=(0,z.j)(L,R,B)),B.DEPTHPREPASS!==!q.getColorWrite()&&(B.DEPTHPREPASS=!B.DEPTHPREPASS,Y=!0),B.INSTANCES!==N&&(B.INSTANCES=N,Y=!0),B.THIN_INSTANCES!==Z&&(B.THIN_INSTANCES=Z,Y=!0),Y&&B.markAsUnprocessed()}function o(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!q._areAttributesDirty&&q._needNormals===q._normals&&q._needUVs===q._uvs)return!1;q._normals=q._needNormals,q._uvs=q._needUVs,q.NORMAL=q._needNormals&&R.isVerticesDataPresent("normal"),q._needNormals&&R.isVerticesDataPresent("tangent")&&(q.TANGENT=!0);for(let z=1;z<=6;++z)q["UV"+z]=!!q._needUVs&&R.isVerticesDataPresent(`uv${1===z?"":z}`);if(L){const L=R.useVertexColors&&R.isVerticesDataPresent("color");q.VERTEXCOLOR=L,q.VERTEXALPHA=R.hasVertexAlpha&&L&&h}return R.isVerticesDataPresent("instanceColor")&&(R.hasInstances||R.hasThinInstances)&&(q.INSTANCESCOLOR=!0),B&&function(R,q){if(R.useBones&&R.computeBonesUsingShaders&&R.skeleton){q.NUM_BONE_INFLUENCERS=R.numBoneInfluencers;const L=void 0!==q.BONETEXTURE;if(R.skeleton.isUsingTextureForMatrices&&L)q.BONETEXTURE=!0;else{q.BonesPerMesh=R.skeleton.bones.length+1,q.BONETEXTURE=!L&&void 0;const B=R.va().prePassRenderer;if(B&&B.enabled){const L=-1===B.excludedSkinnedMesh.indexOf(R);q.BONES_VELOCITY_ENABLED=L}}}else q.NUM_BONE_INFLUENCERS=0,q.BonesPerMesh=0,void 0!==q.BONETEXTURE&&(q.BONETEXTURE=!1)}(R,q),N&&function(R,q){const L=R.morphTargetManager;L?(q.MORPHTARGETS_UV=L.supportsUVs&&q.UV1,q.MORPHTARGETS_TANGENT=L.supportsTangents&&q.TANGENT,q.MORPHTARGETS_NORMAL=L.supportsNormals&&q.NORMAL,q.NUM_MORPH_INFLUENCERS=L.numMaxInfluencers||L.numInfluencers,q.MORPHTARGETS=q.NUM_MORPH_INFLUENCERS>0,q.MORPHTARGETS_TEXTURE=L.isUsingTextureForTargets):(q.MORPHTARGETS_UV=!1,q.MORPHTARGETS_TANGENT=!1,q.MORPHTARGETS_NORMAL=!1,q.MORPHTARGETS=!1,q.NUM_MORPH_INFLUENCERS=0)}(R,q),Z&&function(R,q){const L=R.bakedVertexAnimationManager;q.BAKED_VERTEX_ANIMATION_TEXTURE=!(!L||!L.isEnabled)}(R,q),!0}function l(R,q){if(R.activeCamera){const L=q.MULTIVIEW;q.MULTIVIEW=null!==R.activeCamera.outputRenderTarget&&R.activeCamera.outputRenderTarget.getViewCount()>1,q.MULTIVIEW!=L&&q.markAsUnprocessed()}}function G(R,q,L){const B=q.ORDER_INDEPENDENT_TRANSPARENCY,N=q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;q.ORDER_INDEPENDENT_TRANSPARENCY=R.useOrderIndependentTransparency&&L,q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!R.getEngine().getCaps().textureFloatLinearFiltering,B===q.ORDER_INDEPENDENT_TRANSPARENCY&&N===q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||q.markAsUnprocessed()}function W(R,q,L){const B=q.PREPASS;if(!q._arePrePassDirty)return;const N=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(R.prePassRenderer&&R.prePassRenderer.enabled&&L){q.PREPASS=!0,q.SCENE_MRT_COUNT=R.prePassRenderer.mrtCount,q.PREPASS_NORMAL_WORLDSPACE=R.prePassRenderer.generateNormalsInWorldSpace,q.PREPASS_COLOR=!0,q.PREPASS_COLOR_INDEX=0;for(let L=0;L<N.length;L++){const B=R.prePassRenderer.getIndex(N[L].type);-1!==B?(q[N[L].define]=!0,q[N[L].index]=B):q[N[L].define]=!1}}else{q.PREPASS=!1;for(let R=0;R<N.length;R++)q[N[R].define]=!1}q.PREPASS!=B&&(q.markAsUnprocessed(),q.markAsImageProcessingDirty())}function H(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];N&&N.push("Light"+R),h||(q.push("vLightData"+R,"vLightDiffuse"+R,"vLightSpecular"+R,"vLightDirection"+R,"vLightFalloff"+R,"vLightGround"+R,"lightMatrix"+R,"shadowsInfo"+R,"depthValues"+R),L.push("shadowTexture"+R),L.push("depthTexture"+R),q.push("viewFrustumZ"+R,"cascadeBlendFactor"+R,"lightSizeUVCorrection"+R,"depthCorrection"+R,"penumbraDarkness"+R,"frustumLengths"+R),B&&(L.push("projectionLightTexture"+R),q.push("textureProjectionMatrix"+R)))}function P(R,q,L){let B,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,h=null;if(R.uniformsNames){const Z=R;B=Z.uniformsNames,h=Z.uniformBuffersNames,q=Z.samplers,L=Z.defines,N=Z.maxSimultaneousLights||0}else B=R,q||(q=[]);for(let Z=0;Z<N&&L["LIGHT"+Z];Z++)H(Z,B,q,L["PROJECTEDLIGHTTEXTURE"+Z],h);L.NUM_MORPH_INFLUENCERS&&(B.push("morphTargetInfluences"),B.push("morphTargetCount")),L.BAKED_VERTEX_ANIMATION_TEXTURE&&(B.push("bakedVertexAnimationSettings"),B.push("bakedVertexAnimationTextureSizeInverted"),B.push("bakedVertexAnimationTime"),q.push("bakedVertexAnimationTexture"))}},11322:(R,q,L)=>{"use strict";L.d(q,{d:()=>h});var B,N=L(11081);!function(R){R[R.Zero=0]="Zero",R[R.One=1]="One",R[R.MaxViewZ=2]="MaxViewZ"}(B||(B={}));class h{static CreateConfiguration(R){return h._Configurations[R]={defines:{},previousWorldMatrices:{},previousViewProjection:N.c.Zero(),currentViewProjection:N.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},h._Configurations[R]}static DeleteConfiguration(R){delete h._Configurations[R]}static GetConfiguration(R){return h._Configurations[R]}static AddUniformsAndSamplers(R,q){R.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(R,q){for(const L of q)if(L.Zf)for(const q of L.Zf)q._removeDrawWrapper(R)}static PrepareDefines(R,q,L){if(!L._arePrePassDirty)return;const B=h._Configurations[R];if(!B)return;L.PREPASS=!0,L.PREPASS_COLOR=!1,L.PREPASS_COLOR_INDEX=-1;let N=0;for(let Z=0;Z<h.GeometryTextureDescriptions.length;Z++){const R=h.GeometryTextureDescriptions[Z],q=R.define,z=R.defineIndex,Y=B.defines[z];void 0!==Y?(L[q]=!0,L[z]=Y,N++):(L[q]=!1,delete L[z])}L.SCENE_MRT_COUNT=N,L.BONES_VELOCITY_ENABLED=q.useBones&&q.computeBonesUsingShaders&&q.skeleton&&!q.skeleton.isUsingTextureForMatrices&&-1===B.excludedSkinnedMesh.indexOf(q)}static Bind(R,q,L,B){const N=h._Configurations[R];if(N&&(void 0!==N.defines.PREPASS_VELOCITY_INDEX||void 0!==N.defines.PREPASS_VELOCITY_LINEAR_INDEX)){N.previousWorldMatrices[L.uniqueId]||(N.previousWorldMatrices[L.uniqueId]=B.clone());const R=L.va();N.previousViewProjection||(N.previousViewProjection=R.getTransformMatrix().clone(),N.currentViewProjection=R.getTransformMatrix().clone());const h=R.getEngine();if(N.currentViewProjection.updateFlag!==R.getTransformMatrix().updateFlag?(N.lastUpdateFrameId=h.frameId,N.previousViewProjection.p(N.currentViewProjection),N.currentViewProjection.p(R.getTransformMatrix())):N.lastUpdateFrameId!==h.frameId&&(N.lastUpdateFrameId=h.frameId,N.previousViewProjection.p(N.currentViewProjection)),q.setMatrix("previousWorld",N.previousWorldMatrices[L.uniqueId]),q.setMatrix("previousViewProjection",N.previousViewProjection),N.previousWorldMatrices[L.uniqueId]=B.clone(),L.useBones&&L.computeBonesUsingShaders&&L.skeleton){const R=L.skeleton;if(!R.isUsingTextureForMatrices||-1===q.getUniformIndex("boneTextureWidth")){const B=R.getTransformMatrices(L);B&&(N.previousBones[L.uniqueId]||(N.previousBones[L.uniqueId]=B.slice()),q.setMatrices("mPreviousBones",N.previousBones[L.uniqueId]),N.previousBones[L.uniqueId].set(B))}}}}}h.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],h._Configurations={}},11314:(R,q,L)=>{"use strict";L.d(q,{b:()=>c});var B=L(11053),N=L(11058),h=L(11216),Z=L(10797),z=L(10821),Y=L(10841);const F=new RegExp("^([gimus]+)!");class C{constructor(R){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=R,this._scene=R.va(),this._engine=this._scene.getEngine()}_addPlugin(R){for(let B=0;B<this._plugins.length;++B)if(this._plugins[B].name===R.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!R.isCompatible(this._material.shaderLanguage))throw`The plugin "${R.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const q=R.getClassName();C._MaterialPluginClassToMainDefine[q]||(C._MaterialPluginClassToMainDefine[q]="MATERIALPLUGIN_"+ ++C._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(R,q)=>this._handlePluginEvent(R,q),this._plugins.push(R),this._plugins.sort(((R,q)=>R.priority-q.priority)),this._codeInjectionPoints={};const L={};L[C._MaterialPluginClassToMainDefine[q]]={type:"boolean",default:!0};for(const B of this._plugins)B.collectDefines(L),this._collectPointNames("vertex",B.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",B.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=L,!0}_activatePlugin(R){-1===this._activePlugins.indexOf(R)&&(this._activePlugins.push(R),this._activePlugins.sort(((R,q)=>R.priority-q.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),R.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(R),this._activePluginsForExtraEvents.sort(((R,q)=>R.priority-q.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(R){for(let q=0;q<this._plugins.length;++q)if(this._plugins[q].name===R)return this._plugins[q];return null}_handlePluginEventIsReadyForSubMesh(R){let q=!0;for(const L of this._activePlugins)q=q&&L.isReadyForSubMesh(R.defines,this._scene,this._engine,R.subMesh);R.isReadyForSubMesh=q}_handlePluginEventPrepareDefinesBeforeAttributes(R){for(const q of this._activePlugins)q.prepareDefinesBeforeAttributes(R.defines,this._scene,R.mesh)}_handlePluginEventPrepareDefines(R){for(const q of this._activePlugins)q.prepareDefines(R.defines,this._scene,R.mesh)}_handlePluginEventHardBindForSubMesh(R){for(const q of this._activePluginsForExtraEvents)q.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,R.subMesh)}_handlePluginEventBindForSubMesh(R){for(const q of this._activePlugins)q.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,R.subMesh)}_handlePluginEventHasRenderTargetTextures(R){let q=!1;for(const L of this._activePluginsForExtraEvents)if(q=L.hasRenderTargetTextures(),q)break;R.hasRenderTargetTextures=q}_handlePluginEventFillRenderTargetTextures(R){for(const q of this._activePluginsForExtraEvents)q.fillRenderTargetTextures(R.renderTargets)}_handlePluginEvent(R,q){switch(R){case 512:{const R=q;for(const q of this._activePlugins)q.getActiveTextures(R.activeTextures);break}case 256:{const R=q;for(const q of this._activePlugins)q.getAnimatables(R.animatables);break}case 1024:{const R=q;let L=!1;for(const q of this._activePlugins)if(L=q.hasTexture(R.texture),L)break;R.hasTexture=L;break}case 2:{const R=q;for(const q of this._plugins)q.dispose(R.forceDisposeTextures);break}case 4:q.defineNames=this._defineNamesFromPlugins;break;case 128:{const R=q;for(const q of this._activePlugins)R.fallbackRank=q.addFallbacks(R.defines,R.fallbacks,R.fallbackRank),q.getAttributes(R.attributes,this._scene,R.mesh);this._uniformList.length>0&&R.uniforms.push(...this._uniformList),this._samplerList.length>0&&R.samplers.push(...this._samplerList),this._uboList.length>0&&R.uniformBuffersNames.push(...this._uboList),R.customCode=this._injectCustomCode(R,R.customCode);break}case 8:{const R=q;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const L=1===this._material.shaderLanguage;for(const q of this._plugins){const B=q.getUniforms(this._material.shaderLanguage);if(B){if(B.ubo)for(const q of B.ubo){if(q.size&&q.type){const B=q.arraySize??0;if(R.ubo.addUniform(q.name,q.size,B),L){let R;switch(q.type){case"mat4":R="mat4x4f";break;case"float":R="f32";break;default:R=`${q.type}f`}this._uboDeclaration+=`uniform ${q.name}: ${R}${B>0?`[${B}]`:""};\n`}else this._uboDeclaration+=`${q.type} ${q.name}${B>0?`[${B}]`:""};\n`}this._uniformList.push(q.name)}B.vertex&&(this._vertexDeclaration+=B.vertex+"\n"),B.fragment&&(this._fragmentDeclaration+=B.fragment+"\n")}q.getSamplers(this._samplerList),q.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(R,q){if(q)for(const L in q)this._codeInjectionPoints[R]||(this._codeInjectionPoints[R]={}),this._codeInjectionPoints[R][L]=!0}_injectCustomCode(R,q){return(L,B)=>{var N;q&&(B=q(L,B)),this._uboDeclaration&&(B=B.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(B=B.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(B=B.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const h=null===(N=this._codeInjectionPoints)||void 0===N?void 0:N[L];if(!h)return B;let Z=null;for(let q in h){let N="";for(const B of this._activePlugins){var C;let h=null===(C=B.getCustomCode(L,this._material.shaderLanguage))||void 0===C?void 0:C[q];if(h){if(B.resolveIncludes){if(null===Z){const q=0;Z={defines:[],indexParameters:R.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Y.b.GetShadersRepository(q),includesShadersStore:Y.b.GetIncludesShadersStore(q),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}Z.isFragment="fragment"===L,(0,z.m)(h,Z,(R=>h=R))}N+=h+"\n"}}if(N.length>0)if("!"===q.charAt(0)){q=q.substring(1);let R="g";if("!"===q.charAt(0))R="",q=q.substring(1);else{const L=F.exec(q);L&&L.length>=2&&(R=L[1],q=q.substring(R.length+1))}R.indexOf("g")<0&&(R+="g");const L=B,h=new RegExp(q,R);let Z=h.exec(L);for(;null!==Z;){let R=N;for(let q=0;q<Z.length;++q)R=R.replace("$"+q,Z[q]);B=B.replace(Z[0],R),Z=h.exec(L)}}else{const R="#define "+q;B=B.replace(R,"\n"+N+"\n"+R)}}return B}}}C._MaterialPluginClassToMainDefine={},C._MaterialPluginCounter=0,Z.b.OnEnginesDisposedObservable.add((()=>{n()}));const e=[];let y=!1,U=null;function n(){e.length=0,y=!1,h.c.OnEventObservable.remove(U),U=null}var r=L(11117),p=L(10889);class c{isCompatible(R){return 0===R}_enable(R){R&&this._pluginManager._activatePlugin(this)}constructor(R,q,L,B){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=R,this.name=q,this.priority=L,this.resolveIncludes=Z,R.pluginManager||(R.pluginManager=new C(R),R.ej.add((()=>{R.pluginManager=void 0}))),this._pluginDefineNames=B,this._pluginManager=R.pluginManager,N&&this._pluginManager._addPlugin(this),h&&this._enable(!0),this.markAllDefinesAsDirty=R._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(R,q,L,B){return!0}hardBindForSubMesh(R,q,L,B){}bindForSubMesh(R,q,L,B){}dispose(R){}getCustomCode(R){return null}collectDefines(R){if(this._pluginDefineNames)for(const q of Object.keys(this._pluginDefineNames)){if("_"===q[0])continue;const L=typeof this._pluginDefineNames[q];R[q]={type:"number"===L?"number":"string"===L?"string":"boolean"===L?"boolean":"object",default:this._pluginDefineNames[q]}}}prepareDefinesBeforeAttributes(R,q,L){}prepareDefines(R,q,L){}hasTexture(R){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(R){}getActiveTextures(R){}getAnimatables(R){}addFallbacks(R,q,L){return L}getSamplers(R){}getAttributes(R,q,L){}getUniformBuffersNames(R){}getUniforms(){return{}}copyTo(R){r.b.Clone((()=>R),this)}serialize(){return r.b.Serialize(this)}parse(R,q,L){r.b.Parse((()=>this),R,q,L)}}(0,B.d)([(0,N.K)()],c.prototype,"name",void 0),(0,B.d)([(0,N.K)()],c.prototype,"priority",void 0),(0,B.d)([(0,N.K)()],c.prototype,"resolveIncludes",void 0),(0,B.d)([(0,N.K)()],c.prototype,"registerForExtraEvents",void 0),(0,p.f)("BABYLON.MaterialPluginBase",c)},11386:(R,q,L)=>{"use strict";L.d(q,{c:()=>Z});var B=L(11216),N=L(11074),h=L(10889);class Z extends B.c{get $f(){return this._subMaterials}set $f(R){this._subMaterials=R,this._hookArray(R)}getChildren(){return this.$f}constructor(R,q){super(R,q,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.$f=[],this._storeEffectOnSubMeshes=!0}_hookArray(R){var q=this;const L=R.push;R.push=function(){for(var B=arguments.length,N=new Array(B),h=0;h<B;h++)N[h]=arguments[h];const Z=L.apply(R,N);return q._markAllSubMeshesAsTexturesDirty(),Z};const B=R.splice;R.splice=(q,L)=>{const N=B.apply(R,[q,L]);return this._markAllSubMeshesAsTexturesDirty(),N}}getSubMaterial(R){return R<0||R>=this.$f.length?this.va().defaultMaterial:this.$f[R]}getActiveTextures(){return super.getActiveTextures().concat(...this.$f.map((R=>R?R.getActiveTextures():[])))}hasTexture(R){if(super.hasTexture(R))return!0;for(let L=0;L<this.$f.length;L++){var q;if(null!==(q=this.$f[L])&&void 0!==q&&q.hasTexture(R))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(R,q,L){for(let B=0;B<this.$f.length;B++){const N=this.$f[B];if(N){if(N._storeEffectOnSubMeshes){if(!N.isReadyForSubMesh(R,q,L))return!1;continue}if(!N.isReady(R))return!1}}return!0}clone(R,q){const L=new Z(R,this.va());for(let B=0;B<this.$f.length;B++){let N=null;const h=this.$f[B];N=q&&h?h.clone(R+"-"+h.name):this.$f[B],L.$f.push(N)}return L}serialize(){const R={};R.name=this.name,R.id=this.id,R.uniqueId=this.uniqueId,N.b&&(R.tags=N.b.GetTags(this)),R.materialsUniqueIds=[],R.materials=[];for(let q=0;q<this.$f.length;q++){const L=this.$f[q];L?(R.materialsUniqueIds.push(L.uniqueId),R.materials.push(L.id)):(R.materialsUniqueIds.push(null),R.materials.push(null))}return R}dispose(R,q,L){const B=this.va();if(!B)return;if(L)for(let h=0;h<this.$f.length;h++){const L=this.$f[h];L&&L.dispose(R,q)}const N=B.multiMaterials.indexOf(this);N>=0&&B.multiMaterials.splice(N,1),super.dispose(R,q)}static ParseMultiMaterial(R,q){const L=new Z(R.name,q);return L.id=R.id,L._loadedUniqueId=R.uniqueId,N.b&&N.b.AddTagsTo(L,R.tags),R.materialsUniqueIds?L._waitingSubMaterialsUniqueIds=R.materialsUniqueIds:R.materials.forEach((R=>L.$f.push(q.getLastMaterialById(R)))),L}}(0,h.f)("BABYLON.MultiMaterial",Z)},11210:(R,q,L)=>{"use strict";L.d(q,{e:()=>B});class B{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(R){R.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(R){}bindForSubMesh(R,q,L,B,N){if(q.prePassRenderer&&q.prePassRenderer.enabled&&q.prePassRenderer.currentRTisSceneRT&&(-1!==q.prePassRenderer.getIndex(2)||-1!==q.prePassRenderer.getIndex(11))){this.previousWorldMatrices[L.uniqueId]||(this.previousWorldMatrices[L.uniqueId]=B.clone()),this.previousViewProjection||(this.previousViewProjection=q.getTransformMatrix().clone(),this.currentViewProjection=q.getTransformMatrix().clone());const N=q.getEngine();this.currentViewProjection.updateFlag!==q.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=N.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(q.getTransformMatrix())):this._lastUpdateFrameId!==N.frameId&&(this._lastUpdateFrameId=N.frameId,this.previousViewProjection.p(this.currentViewProjection)),R.setMatrix("previousWorld",this.previousWorldMatrices[L.uniqueId]),R.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[L.uniqueId]=B.clone()}}}},11271:(R,q,L)=>{"use strict";L.d(q,{e:()=>h});var B=L(11081),N=L(11216);class h extends N.c{constructor(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(R,q,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new B.c,this._storeEffectOnSubMeshes=L}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(R,q){return!!R&&(!this._storeEffectOnSubMeshes||(!R.Zf||0===R.Zf.length||this.isReadyForSubMesh(R,R.Zf[0],q)))}_isReadyForSubMesh(R){const q=R.materialDefines;return!(this.checkReadyOnEveryCall||!R.effect||!q||q._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(R){this._activeEffect.setMatrix("world",R)}bindOnlyNormalMatrix(R){this._activeEffect.setMatrix("normalMatrix",R)}bind(R,q){q&&this.bindForSubMesh(R,q,q.Zf[0])}_afterBind(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;super._afterBind(R,q,L),this.va()._cachedEffect=q,L?L._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return L._drawWrapper._forceRebindOnNextCall||R.isCachedMaterialInvalid(this,q,B)}dispose(R,q,L){this._activeEffect=void 0,super.dispose(R,q,L)}}},11051:(R,q,L)=>{"use strict";L.d(q,{c:()=>K});var B=L(11053),N=L(11058),h=L(11065),Z=L(11071),z=L(11081),Y=L(11112),F=L(11136),C=L(11210),e=L(11104),y=L(11216),U=L(11263),n=L(11271),r=L(11277),p=L(10889),c=L(11298),d=L(11303),f=L(11305),v=L(11255),T=L(11248),t=L(11117),D=L(11322);const S={effect:null,subMesh:null};class I extends U.b{constructor(R){super(R),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(R){const q=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const L of q)this[L]=L===R}}class K extends n.e{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=R||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(R){this.imageProcessingConfiguration.colorCurvesEnabled=R}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(R){this.imageProcessingConfiguration.colorGradingEnabled=R}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(R){this._imageProcessingConfiguration.toneMappingEnabled=R}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(R){this._imageProcessingConfiguration.exposure=R}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(R){this._imageProcessingConfiguration.contrast=R}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(R){this._imageProcessingConfiguration.colorGradingTexture=R}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(R){this._imageProcessingConfiguration.colorCurves=R}get canRenderToMRT(){return!0}constructor(R,q){super(R,q,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||K.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new Y.e(0,0,0),this.diffuseColor=new Y.e(1,1,1),this.specularColor=new Y.e(1,1,1),this.emissiveColor=new Y.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new h.h(16),this._worldViewProjectionMatrix=z.c.Zero(),this._globalAmbientColor=new Y.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new f.e(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new C.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),K.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),K.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(K.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(K.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"mb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===y.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.je&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==y.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.je||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(R,q){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const N=q._drawWrapper;if(N.effect&&this.isFrozen&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===B)return!0;q.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),q.materialDefines=new I(this._eventInfo.defineNames));const h=this.va(),Z=q.materialDefines;if(this._isReadyForSubMesh(q))return!0;const z=h.getEngine();Z._needNormals=(0,T.L)(h,R,Z,!0,this._maxSimultaneousLights,this._disableLighting),(0,T.X)(h,Z);const Y=this.needAlphaBlendingForMesh(R)&&this.va().useOrderIndependentTransparency;if((0,T._)(h,Z,this.canRenderToMRT&&!Y),(0,T.Y)(h,Z,Y),D.d.PrepareDefines(z.currentRenderPassId,R,Z),Z._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,Z._needUVs=!1;for(let R=1;R<=6;++R)Z["MAINUV"+R]=!1;if(h.texturesEnabled){if(Z.DIFFUSEDIRECTUV=0,Z.BUMPDIRECTUV=0,Z.AMBIENTDIRECTUV=0,Z.OPACITYDIRECTUV=0,Z.EMISSIVEDIRECTUV=0,Z.SPECULARDIRECTUV=0,Z.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&K.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,T.P)(this._diffuseTexture,Z,"DIFFUSE")}else Z.DIFFUSE=!1;if(this._ambientTexture&&K.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,T.P)(this._ambientTexture,Z,"AMBIENT")}else Z.AMBIENT=!1;if(this._opacityTexture&&K.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,T.P)(this._opacityTexture,Z,"OPACITY"),Z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else Z.OPACITY=!1;if(this._reflectionTexture&&K.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(Z._needNormals=!0,Z.REFLECTION=!0,Z.ROUGHNESS=this._roughness>0,Z.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,Z.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===r.c.INVCUBIC_MODE,Z.REFLECTIONMAP_3D=this._reflectionTexture.isCube,Z.REFLECTIONMAP_OPPOSITEZ=Z.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,Z.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case r.c.EXPLICIT_MODE:Z.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case r.c.PLANAR_MODE:Z.setReflectionMode("REFLECTIONMAP_PLANAR");break;case r.c.PROJECTION_MODE:Z.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case r.c.SKYBOX_MODE:Z.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case r.c.SPHERICAL_MODE:Z.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case r.c.EQUIRECTANGULAR_MODE:Z.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case r.c.FIXED_EQUIRECTANGULAR_MODE:Z.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case r.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Z.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case r.c.CUBIC_MODE:case r.c.INVCUBIC_MODE:default:Z.setReflectionMode("REFLECTIONMAP_CUBIC")}Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else Z.REFLECTION=!1,Z.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&K.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,T.P)(this._emissiveTexture,Z,"EMISSIVE")}else Z.EMISSIVE=!1;if(this._lightmapTexture&&K.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,T.P)(this._lightmapTexture,Z,"LIGHTMAP"),Z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else Z.LIGHTMAP=!1;if(this._specularTexture&&K.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,T.P)(this._specularTexture,Z,"SPECULAR"),Z.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else Z.SPECULAR=!1;if(h.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&K.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,T.P)(this._bumpTexture,Z,"BUMP"),Z.PARALLAX=this._useParallax,Z.PARALLAX_RHS=h.useRightHandedSystem,Z.PARALLAXOCCLUSION=this._useParallaxOcclusion,Z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else Z.BUMP=!1,Z.PARALLAX=!1,Z.PARALLAX_RHS=!1,Z.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&K.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;Z._needUVs=!0,Z.REFRACTION=!0,Z.REFRACTIONMAP_3D=this._refractionTexture.isCube,Z.RGBDREFRACTION=this._refractionTexture.isRGBD,Z.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else Z.REFRACTION=!1;Z.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else Z.DIFFUSE=!1,Z.AMBIENT=!1,Z.OPACITY=!1,Z.REFLECTION=!1,Z.EMISSIVE=!1,Z.LIGHTMAP=!1,Z.BUMP=!1,Z.REFRACTION=!1;Z.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),Z.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,Z.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,Z.SPECULAROVERALPHA=this._useSpecularOverAlpha,Z.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Z.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,Z.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(R)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Z,this._eventInfo.subMesh=q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(Z._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(Z),Z.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,Z.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}Z._areFresnelDirty&&(K.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(Z.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,Z.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,Z.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,Z.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,Z.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,Z.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,Z._needNormals=!0,Z.FRESNEL=!0):Z.FRESNEL=!1),(0,T.T)(R,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(R)||this._forceAlphaTest,Z,this._applyDecalMapAfterDetailMap),(0,T.K)(h,z,this,Z,B,null,q.getRenderingMesh().hasThinInstances),this._eventInfo.defines=Z,this._eventInfo.mesh=R,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,T.I)(R,Z,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let y=!1;if(Z.isDirty){const B=Z._areLightsDisposed;Z.markAsProcessed();const N=new d.b;Z.REFLECTION&&N.addFallback(0,"REFLECTION"),Z.SPECULAR&&N.addFallback(0,"SPECULAR"),Z.BUMP&&N.addFallback(0,"BUMP"),Z.PARALLAX&&N.addFallback(1,"PARALLAX"),Z.PARALLAX_RHS&&N.addFallback(1,"PARALLAX_RHS"),Z.PARALLAXOCCLUSION&&N.addFallback(0,"PARALLAXOCCLUSION"),Z.SPECULAROVERALPHA&&N.addFallback(0,"SPECULAROVERALPHA"),Z.FOG&&N.addFallback(1,"FOG"),Z.POINTSIZE&&N.addFallback(0,"POINTSIZE"),Z.LOGARITHMICDEPTH&&N.addFallback(0,"LOGARITHMICDEPTH"),(0,T.s)(Z,N,this._maxSimultaneousLights),Z.SPECULARTERM&&N.addFallback(0,"SPECULARTERM"),Z.DIFFUSEFRESNEL&&N.addFallback(1,"DIFFUSEFRESNEL"),Z.OPACITYFRESNEL&&N.addFallback(2,"OPACITYFRESNEL"),Z.REFLECTIONFRESNEL&&N.addFallback(3,"REFLECTIONFRESNEL"),Z.EMISSIVEFRESNEL&&N.addFallback(4,"EMISSIVEFRESNEL"),Z.FRESNEL&&N.addFallback(4,"FRESNEL"),Z.MULTIVIEW&&N.addFallback(0,"MULTIVIEW");const Y=[F.e.PositionKind];Z.NORMAL&&Y.push(F.e.NormalKind),Z.TANGENT&&Y.push(F.e.TangentKind);for(let R=1;R<=6;++R)Z["UV"+R]&&Y.push(`uv${1===R?"":R}`);Z.VERTEXCOLOR&&Y.push(F.e.ColorKind),(0,T.y)(Y,R,Z,N),(0,T.C)(Y,Z),(0,T.F)(Y,R,Z),(0,T.w)(Y,R,Z);let U="default";const n=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],r=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],p=["Material","Scene","Mesh"],c={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Z.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=N,this._eventInfo.fallbackRank=0,this._eventInfo.defines=Z,this._eventInfo.uniforms=n,this._eventInfo.attributes=Y,this._eventInfo.samplers=r,this._eventInfo.uniformBuffersNames=p,this._eventInfo.customCode=void 0,this._eventInfo.mesh=R,this._eventInfo.indexParameters=c,this._callbackPluginEventGeneric(128,this._eventInfo),D.d.AddUniformsAndSamplers(n,r),C.e.AddUniforms(n),C.e.AddSamplers(r),e.d&&(e.d.PrepareUniforms(n,Z),e.d.PrepareSamplers(r,Z)),(0,T.cb)({uniformsNames:n,uniformBuffersNames:p,samplers:r,defines:Z,maxSimultaneousLights:this._maxSimultaneousLights}),(0,v.e)(n);const f={};this.customShaderNameResolve&&(U=this.customShaderNameResolve(U,n,p,r,Z,Y,f));const t=Z.toString(),I=q.effect;let K=h.getEngine().createEffect(U,{attributes:Y,uniformsNames:n,uniformBuffersNames:p,samplers:r,defines:t,fallbacks:N,onCompiled:this.onCompiled,onError:this.onError,indexParameters:c,processFinalCode:f.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Z.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([L.e(21),L.e(19)]).then(L.bind(L,12779)),Promise.all([L.e(22),L.e(20)]).then(L.bind(L,12920))]):await Promise.all([Promise.all([L.e(25),L.e(24)]).then(L.bind(L,12999)),Promise.all([L.e(27),L.e(26)]).then(L.bind(L,13129))]),this._shadersLoaded=!0}},z);if(this._eventInfo.customCode=void 0,K)if(this._onEffectCreatedObservable&&(S.effect=K,S.subMesh=q,this._onEffectCreatedObservable.notifyObservers(S)),this.allowShaderHotSwapping&&I&&!K.isReady()){if(K=I,Z.markAsUnprocessed(),y=this.isFrozen,B)return Z._areLightsDisposed=!0,!1}else h.resetCachedMaterial(),q.setEffect(K,Z,this._materialContext)}return!(!q.effect||!q.effect.isReady())&&(Z._renderId=h.getRenderId(),N._wasPreviouslyReady=!y,N._wasPreviouslyUsingInstances=B,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const R=this._uniformBuffer;R.addUniform("diffuseLeftColor",4),R.addUniform("diffuseRightColor",4),R.addUniform("opacityParts",4),R.addUniform("reflectionLeftColor",4),R.addUniform("reflectionRightColor",4),R.addUniform("refractionLeftColor",4),R.addUniform("refractionRightColor",4),R.addUniform("emissiveLeftColor",4),R.addUniform("emissiveRightColor",4),R.addUniform("vDiffuseInfos",2),R.addUniform("vAmbientInfos",2),R.addUniform("vOpacityInfos",2),R.addUniform("vReflectionInfos",2),R.addUniform("vReflectionPosition",3),R.addUniform("vReflectionSize",3),R.addUniform("vEmissiveInfos",2),R.addUniform("vLightmapInfos",2),R.addUniform("vSpecularInfos",2),R.addUniform("vBumpInfos",3),R.addUniform("diffuseMatrix",16),R.addUniform("ambientMatrix",16),R.addUniform("opacityMatrix",16),R.addUniform("reflectionMatrix",16),R.addUniform("emissiveMatrix",16),R.addUniform("lightmapMatrix",16),R.addUniform("specularMatrix",16),R.addUniform("bumpMatrix",16),R.addUniform("vTangentSpaceParams",2),R.addUniform("pointSize",1),R.addUniform("alphaCutOff",1),R.addUniform("refractionMatrix",16),R.addUniform("vRefractionInfos",4),R.addUniform("vRefractionPosition",3),R.addUniform("vRefractionSize",3),R.addUniform("vSpecularColor",4),R.addUniform("vEmissiveColor",3),R.addUniform("vDiffuseColor",4),R.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(R,q,L){const B=this.va(),N=L.materialDefines;if(!N)return;const h=L.effect;if(!h)return;this._activeEffect=h,q.getMeshUniformBuffer().bindToEffect(h,"Mesh"),q.transferToEffect(R),this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,B,q,R,this.isFrozen),D.d.Bind(B.getEngine().currentRenderPassId,this._activeEffect,q,R),this._eventInfo.subMesh=L,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),N.OBJECTSPACE_NORMALMAP&&(R.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const z=this._mustRebind(B,h,L,q.visibility);(0,T.d)(q,h);const F=this._uniformBuffer;if(z){if(this.bindViewProjection(h),!F.useUbo||!this.isFrozen||!F.isSync||L._drawWrapper._forceRebindOnNextCall){if(K.FresnelEnabled&&N.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(F.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),F.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&F.updateColor4("opacityParts",new Y.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(F.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),F.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(F.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),F.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(F.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),F.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),B.texturesEnabled){if(this._diffuseTexture&&K.DiffuseTextureEnabled&&(F.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,T.q)(this._diffuseTexture,F,"diffuse")),this._ambientTexture&&K.AmbientTextureEnabled&&(F.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,T.q)(this._ambientTexture,F,"ambient")),this._opacityTexture&&K.OpacityTextureEnabled&&(F.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,T.q)(this._opacityTexture,F,"opacity")),this._hasAlphaChannel()&&F.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&K.ReflectionTextureEnabled&&(F.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),F.Cj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const R=this._reflectionTexture;F.updateVector3("vReflectionPosition",R.boundingBoxPosition),F.updateVector3("vReflectionSize",R.boundingBoxSize)}if(this._emissiveTexture&&K.EmissiveTextureEnabled&&(F.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,T.q)(this._emissiveTexture,F,"emissive")),this._lightmapTexture&&K.LightmapTextureEnabled&&(F.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,T.q)(this._lightmapTexture,F,"lightmap")),this._specularTexture&&K.SpecularTextureEnabled&&(F.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,T.q)(this._specularTexture,F,"specular")),this._bumpTexture&&B.getEngine().getCaps().standardDerivatives&&K.BumpTextureEnabled&&(F.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,T.q)(this._bumpTexture,F,"bump"),B._mirroredCameraPosition?F.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):F.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&K.RefractionTextureEnabled){let R=1;if(this._refractionTexture.isCube||(F.Cj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(R=this._refractionTexture.depth)),F.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,R,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const R=this._refractionTexture;F.updateVector3("vRefractionPosition",R.boundingBoxPosition),F.updateVector3("vRefractionSize",R.boundingBoxSize)}}}this.pointsCloud&&F.updateFloat("pointSize",this.pointSize),F.updateColor4("vSpecularColor",this.specularColor,this.specularPower),F.updateColor3("vEmissiveColor",K.EmissiveTextureEnabled?this.emissiveColor:Y.e.BlackReadOnly),F.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),B.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),F.updateColor3("vAmbientColor",this._globalAmbientColor)}B.texturesEnabled&&(this._diffuseTexture&&K.DiffuseTextureEnabled&&h.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&K.AmbientTextureEnabled&&h.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&K.OpacityTextureEnabled&&h.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&K.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?h.setTexture("reflectionCubeSampler",this._reflectionTexture):h.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&K.EmissiveTextureEnabled&&h.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&K.LightmapTextureEnabled&&h.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&K.SpecularTextureEnabled&&h.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&B.getEngine().getCaps().standardDerivatives&&K.BumpTextureEnabled&&h.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&K.RefractionTextureEnabled&&(this._refractionTexture.isCube?h.setTexture("refractionCubeSampler",this._refractionTexture):h.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(q)&&this.va().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,v.f)(h,this,B),this.bindEyePosition(h)}else B.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(z||!this.isFrozen){var C;if(B.lightsEnabled&&!this._disableLighting&&(0,T.k)(B,q,h,N,this._maxSimultaneousLights),(B.fogEnabled&&q.applyFog&&B.fogMode!==Z.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||q.receiveShadows||N.PREPASS)&&this.bindView(h),(0,T.g)(B,q,h),N.NUM_MORPH_INFLUENCERS&&(0,T.n)(q,h),N.BAKED_VERTEX_ANIMATION_TEXTURE)null===(C=q.bakedVertexAnimationManager)||void 0===C||C.bind(h,N.INSTANCES);this.useLogarithmicDepth&&(0,T.l)(N,h,B),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(q,this._activeEffect,L),F.update()}getAnimatables(){const R=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&R.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&R.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&R.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&R.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&R.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&R.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&R.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&R.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&R.push(this._refractionTexture),R}getActiveTextures(){const R=super.getActiveTextures();return this._diffuseTexture&&R.push(this._diffuseTexture),this._ambientTexture&&R.push(this._ambientTexture),this._opacityTexture&&R.push(this._opacityTexture),this._reflectionTexture&&R.push(this._reflectionTexture),this._emissiveTexture&&R.push(this._emissiveTexture),this._specularTexture&&R.push(this._specularTexture),this._bumpTexture&&R.push(this._bumpTexture),this._lightmapTexture&&R.push(this._lightmapTexture),this._refractionTexture&&R.push(this._refractionTexture),R}hasTexture(R){return!!super.hasTexture(R)||(this._diffuseTexture===R||(this._ambientTexture===R||(this._opacityTexture===R||(this._reflectionTexture===R||(this._emissiveTexture===R||(this._specularTexture===R||(this._bumpTexture===R||(this._lightmapTexture===R||this._refractionTexture===R))))))))}dispose(R,q){var L,B,N,h,Z,z,Y,F,C;q&&(null===(L=this._diffuseTexture)||void 0===L||L.dispose(),null===(B=this._ambientTexture)||void 0===B||B.dispose(),null===(N=this._opacityTexture)||void 0===N||N.dispose(),null===(h=this._reflectionTexture)||void 0===h||h.dispose(),null===(Z=this._emissiveTexture)||void 0===Z||Z.dispose(),null===(z=this._specularTexture)||void 0===z||z.dispose(),null===(Y=this._bumpTexture)||void 0===Y||Y.dispose(),null===(F=this._lightmapTexture)||void 0===F||F.dispose(),null===(C=this._refractionTexture)||void 0===C||C.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(R,q)}clone(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const B=t.b.Clone((()=>new K(R,this.va())),this,{cloneTexturesOnlyOnce:q});return B.name=R,B.id=R,this.stencil.copyTo(B.stencil),this._clonePlugins(B,L),B}static Parse(R,q,L){const B=t.b.Parse((()=>new K(R.name,q)),R,q,L);return R.stencil&&B.stencil.parse(R.stencil,q,L),y.c._ParsePlugins(R,B,q,L),B}static get DiffuseTextureEnabled(){return c.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(R){c.e.DiffuseTextureEnabled=R}static get DetailTextureEnabled(){return c.e.DetailTextureEnabled}static set DetailTextureEnabled(R){c.e.DetailTextureEnabled=R}static get AmbientTextureEnabled(){return c.e.AmbientTextureEnabled}static set AmbientTextureEnabled(R){c.e.AmbientTextureEnabled=R}static get OpacityTextureEnabled(){return c.e.OpacityTextureEnabled}static set OpacityTextureEnabled(R){c.e.OpacityTextureEnabled=R}static get ReflectionTextureEnabled(){return c.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(R){c.e.ReflectionTextureEnabled=R}static get EmissiveTextureEnabled(){return c.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(R){c.e.EmissiveTextureEnabled=R}static get SpecularTextureEnabled(){return c.e.SpecularTextureEnabled}static set SpecularTextureEnabled(R){c.e.SpecularTextureEnabled=R}static get BumpTextureEnabled(){return c.e.BumpTextureEnabled}static set BumpTextureEnabled(R){c.e.BumpTextureEnabled=R}static get LightmapTextureEnabled(){return c.e.LightmapTextureEnabled}static set LightmapTextureEnabled(R){c.e.LightmapTextureEnabled=R}static get RefractionTextureEnabled(){return c.e.RefractionTextureEnabled}static set RefractionTextureEnabled(R){c.e.RefractionTextureEnabled=R}static get ColorGradingTextureEnabled(){return c.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(R){c.e.ColorGradingTextureEnabled=R}static get FresnelEnabled(){return c.e.FresnelEnabled}static set FresnelEnabled(R){c.e.FresnelEnabled=R}}K.ForceGLSL=!1,(0,B.d)([(0,N.A)("diffuseTexture")],K.prototype,"_diffuseTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],K.prototype,"diffuseTexture",void 0),(0,B.d)([(0,N.A)("ambientTexture")],K.prototype,"_ambientTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"ambientTexture",void 0),(0,B.d)([(0,N.A)("opacityTexture")],K.prototype,"_opacityTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],K.prototype,"opacityTexture",void 0),(0,B.d)([(0,N.A)("reflectionTexture")],K.prototype,"_reflectionTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"reflectionTexture",void 0),(0,B.d)([(0,N.A)("emissiveTexture")],K.prototype,"_emissiveTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"emissiveTexture",void 0),(0,B.d)([(0,N.A)("specularTexture")],K.prototype,"_specularTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"specularTexture",void 0),(0,B.d)([(0,N.A)("bumpTexture")],K.prototype,"_bumpTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"bumpTexture",void 0),(0,B.d)([(0,N.A)("lightmapTexture")],K.prototype,"_lightmapTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"lightmapTexture",void 0),(0,B.d)([(0,N.A)("refractionTexture")],K.prototype,"_refractionTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"refractionTexture",void 0),(0,B.d)([(0,N.k)("ambient")],K.prototype,"ambientColor",void 0),(0,B.d)([(0,N.k)("diffuse")],K.prototype,"diffuseColor",void 0),(0,B.d)([(0,N.k)("specular")],K.prototype,"specularColor",void 0),(0,B.d)([(0,N.k)("emissive")],K.prototype,"emissiveColor",void 0),(0,B.d)([(0,N.K)()],K.prototype,"specularPower",void 0),(0,B.d)([(0,N.K)("useAlphaFromDiffuseTexture")],K.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],K.prototype,"useAlphaFromDiffuseTexture",void 0),(0,B.d)([(0,N.K)("useEmissiveAsIllumination")],K.prototype,"_useEmissiveAsIllumination",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useEmissiveAsIllumination",void 0),(0,B.d)([(0,N.K)("linkEmissiveWithDiffuse")],K.prototype,"_linkEmissiveWithDiffuse",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"linkEmissiveWithDiffuse",void 0),(0,B.d)([(0,N.K)("useSpecularOverAlpha")],K.prototype,"_useSpecularOverAlpha",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useSpecularOverAlpha",void 0),(0,B.d)([(0,N.K)("useReflectionOverAlpha")],K.prototype,"_useReflectionOverAlpha",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useReflectionOverAlpha",void 0),(0,B.d)([(0,N.K)("disableLighting")],K.prototype,"_disableLighting",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsLightsDirty")],K.prototype,"disableLighting",void 0),(0,B.d)([(0,N.K)("useObjectSpaceNormalMap")],K.prototype,"_useObjectSpaceNormalMap",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useObjectSpaceNormalMap",void 0),(0,B.d)([(0,N.K)("useParallax")],K.prototype,"_useParallax",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useParallax",void 0),(0,B.d)([(0,N.K)("useParallaxOcclusion")],K.prototype,"_useParallaxOcclusion",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useParallaxOcclusion",void 0),(0,B.d)([(0,N.K)()],K.prototype,"parallaxScaleBias",void 0),(0,B.d)([(0,N.K)("roughness")],K.prototype,"_roughness",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"roughness",void 0),(0,B.d)([(0,N.K)()],K.prototype,"indexOfRefraction",void 0),(0,B.d)([(0,N.K)()],K.prototype,"invertRefractionY",void 0),(0,B.d)([(0,N.K)()],K.prototype,"alphaCutOff",void 0),(0,B.d)([(0,N.K)("useLightmapAsShadowmap")],K.prototype,"_useLightmapAsShadowmap",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useLightmapAsShadowmap",void 0),(0,B.d)([(0,N.n)("diffuseFresnelParameters")],K.prototype,"_diffuseFresnelParameters",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"diffuseFresnelParameters",void 0),(0,B.d)([(0,N.n)("opacityFresnelParameters")],K.prototype,"_opacityFresnelParameters",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],K.prototype,"opacityFresnelParameters",void 0),(0,B.d)([(0,N.n)("reflectionFresnelParameters")],K.prototype,"_reflectionFresnelParameters",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"reflectionFresnelParameters",void 0),(0,B.d)([(0,N.n)("refractionFresnelParameters")],K.prototype,"_refractionFresnelParameters",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"refractionFresnelParameters",void 0),(0,B.d)([(0,N.n)("emissiveFresnelParameters")],K.prototype,"_emissiveFresnelParameters",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"emissiveFresnelParameters",void 0),(0,B.d)([(0,N.K)("useReflectionFresnelFromSpecular")],K.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"useReflectionFresnelFromSpecular",void 0),(0,B.d)([(0,N.K)("useGlossinessFromSpecularMapAlpha")],K.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,B.d)([(0,N.K)("maxSimultaneousLights")],K.prototype,"_maxSimultaneousLights",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsLightsDirty")],K.prototype,"maxSimultaneousLights",void 0),(0,B.d)([(0,N.K)("invertNormalMapX")],K.prototype,"_invertNormalMapX",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"invertNormalMapX",void 0),(0,B.d)([(0,N.K)("invertNormalMapY")],K.prototype,"_invertNormalMapY",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"invertNormalMapY",void 0),(0,B.d)([(0,N.K)("twoSidedLighting")],K.prototype,"_twoSidedLighting",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"twoSidedLighting",void 0),(0,B.d)([(0,N.K)("applyDecalMapAfterDetailMap")],K.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,B.d)([(0,N.c)("_markAllSubMeshesAsMiscDirty")],K.prototype,"applyDecalMapAfterDetailMap",void 0),(0,p.f)("BABYLON.StandardMaterial",K),Z.b.DefaultMaterialFactory=R=>new K("default material",R)},11132:(R,q,L)=>{"use strict";L.d(q,{d:()=>h});var B=L(10767),N=L(10757);class h{constructor(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=R,this._noUBO=!R.supportsUniformBuffers||N,this._dynamic=L,this._name=B??"no-name",this._data=q||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Cj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Cj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(R){let q;if(q=R<=2?R:4,this._uniformLocationPointer%q!==0){const R=this._uniformLocationPointer;this._uniformLocationPointer+=q-this._uniformLocationPointer%q;const L=this._uniformLocationPointer-R;for(let q=0;q<L;q++)this._data.push(0)}}addUniform(R,q){let L,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[R]){if(B>0){if(q instanceof Array)throw"addUniform should not be use with Array in UBO: "+R;if(this._fillAlignment(4),this._uniformArraySizes[R]={strideSize:q,arraySize:B},16==q)q*=B;else{q=q*B+(4-q)*B}L=[];for(let R=0;R<q;R++)L.push(0)}else{if(q instanceof Array)L=q,q=L.length;else{L=[];for(let R=0;R<q;R++)L.push(0)}this._fillAlignment(q)}this._uniformSizes[R]=q,this._uniformLocations[R]=this._uniformLocationPointer,this._uniformLocationPointer+=q;for(let R=0;R<q;R++)this._data.push(L[R]);this._needSync=!0}}addMatrix(R,q){this.addUniform(R,Array.prototype.slice.call(q.dj()))}addFloat2(R,q,L){const B=[q,L];this.addUniform(R,B)}addFloat3(R,q,L,B){const N=[q,L,B];this.addUniform(R,N)}addColor3(R,q){const L=[q.r,q.g,q.b];this.addUniform(R,L)}addColor4(R,q,L){const B=[q.r,q.g,q.b,L];this.addUniform(R,B)}addVector3(R,q){const L=[q.x,q.y,q.z];this.addUniform(R,L)}addMatrix3x3(R){this.addUniform(R,12)}addMatrix2x2(R){this.addUniform(R,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const R=[];let q=0;for(const L in this._uniformLocations)if(R.push(L),10===++q)break;return R.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(R,q){for(let L=0;L<R.length;++L)if(R[L]!==q[L])return!1;return!0}_copyBuffer(R,q){for(let L=0;L<R.length;++L)q[L]=R[L]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(h._UpdatedUbosInFrame[this._name]||(h._UpdatedUbosInFrame[this._name]=0),h._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(R,q,L){this._checkNewFrame();let N=this._uniformLocations[R];if(void 0===N){if(this._buffer)return void B.d.Error("Cannot add an uniform after UBO has been created. uniformName="+R);this.addUniform(R,L),N=this._uniformLocations[R]}if(this._buffer||this.create(),this._dynamic)for(let B=0;B<L;B++)this._bufferData[N+B]=q[B];else{let R=!1;for(let B=0;B<L;B++)(16===L&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[N+B]!==Math.fround(q[B]))&&(R=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[N+B]=q[B]);this._needSync=this._needSync||R}}updateUniformArray(R,q,L){this._checkNewFrame();const h=this._uniformLocations[R];if(void 0===h)return void B.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const Z=this._uniformArraySizes[R];if(this._dynamic)for(let B=0;B<L;B++)this._bufferData[h+B]=q[B];else{let R=!1,B=0,z=0;for(let Y=0;Y<L;Y++)if(this._bufferData[h+4*z+B]!==N.f.FloatRound(q[Y])&&(R=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[h+4*z+B]=q[Y]),B++,B===Z.strideSize){for(;B<4;B++)this._bufferData[h+4*z+B]=0;B=0,z++}this._needSync=this._needSync||R}}_cacheMatrix(R,q){this._checkNewFrame();const L=this._valueCache[R],B=q.updateFlag;return(void 0===L||L!==B)&&(this._valueCache[R]=B,!0)}_updateMatrix3x3ForUniform(R,q){for(let L=0;L<3;L++)h._TempBuffer[4*L]=q[3*L],h._TempBuffer[4*L+1]=q[3*L+1],h._TempBuffer[4*L+2]=q[3*L+2],h._TempBuffer[4*L+3]=0;this.updateUniform(R,h._TempBuffer,12)}_updateMatrix3x3ForEffect(R,q){this._currentEffect.setMatrix3x3(R,q)}_updateMatrix2x2ForEffect(R,q){this._currentEffect.setMatrix2x2(R,q)}_updateMatrix2x2ForUniform(R,q){for(let L=0;L<2;L++)h._TempBuffer[4*L]=q[2*L],h._TempBuffer[4*L+1]=q[2*L+1],h._TempBuffer[4*L+2]=0,h._TempBuffer[4*L+3]=0;this.updateUniform(R,h._TempBuffer,8)}_updateFloatForEffect(R,q){this._currentEffect.setFloat(R,q)}_updateFloatForUniform(R,q){h._TempBuffer[0]=q,this.updateUniform(R,h._TempBuffer,1)}_updateFloat2ForEffect(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(R+B,q,L)}_updateFloat2ForUniform(R,q,L){h._TempBuffer[0]=q,h._TempBuffer[1]=L,this.updateUniform(R,h._TempBuffer,2)}_updateFloat3ForEffect(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(R+N,q,L,B)}_updateFloat3ForUniform(R,q,L,B){h._TempBuffer[0]=q,h._TempBuffer[1]=L,h._TempBuffer[2]=B,this.updateUniform(R,h._TempBuffer,3)}_updateFloat4ForEffect(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(R+h,q,L,B,N)}_updateFloat4ForUniform(R,q,L,B,N){h._TempBuffer[0]=q,h._TempBuffer[1]=L,h._TempBuffer[2]=B,h._TempBuffer[3]=N,this.updateUniform(R,h._TempBuffer,4)}_updateFloatArrayForEffect(R,q){this._currentEffect.setFloatArray(R,q)}_updateFloatArrayForUniform(R,q){this.updateUniformArray(R,q,q.length)}_updateArrayForEffect(R,q){this._currentEffect.setArray(R,q)}_updateArrayForUniform(R,q){this.updateUniformArray(R,q,q.length)}_updateIntArrayForEffect(R,q){this._currentEffect.setIntArray(R,q)}_updateIntArrayForUniform(R,q){h._TempBufferInt32View.set(q),this.updateUniformArray(R,h._TempBuffer,q.length)}_updateUIntArrayForEffect(R,q){this._currentEffect.setUIntArray(R,q)}_updateUIntArrayForUniform(R,q){h._TempBufferUInt32View.set(q),this.updateUniformArray(R,h._TempBuffer,q.length)}_updateMatrixForEffect(R,q){this._currentEffect.setMatrix(R,q)}_updateMatrixForUniform(R,q){this._cacheMatrix(R,q)&&this.updateUniform(R,q.dj(),16)}_updateMatricesForEffect(R,q){this._currentEffect.setMatrices(R,q)}_updateMatricesForUniform(R,q){this.updateUniform(R,q,q.length)}_updateVector3ForEffect(R,q){this._currentEffect.setVector3(R,q)}_updateVector3ForUniform(R,q){h._TempBuffer[0]=q.x,h._TempBuffer[1]=q.y,h._TempBuffer[2]=q.z,this.updateUniform(R,h._TempBuffer,3)}_updateVector4ForEffect(R,q){this._currentEffect.setVector4(R,q)}_updateVector4ForUniform(R,q){h._TempBuffer[0]=q.x,h._TempBuffer[1]=q.y,h._TempBuffer[2]=q.z,h._TempBuffer[3]=q.w,this.updateUniform(R,h._TempBuffer,4)}_updateColor3ForEffect(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(R+L,q)}_updateColor3ForUniform(R,q){h._TempBuffer[0]=q.r,h._TempBuffer[1]=q.g,h._TempBuffer[2]=q.b,this.updateUniform(R,h._TempBuffer,3)}_updateColor4ForEffect(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(R+B,q,L)}_updateDirectColor4ForEffect(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(R+L,q)}_updateColor4ForUniform(R,q,L){h._TempBuffer[0]=q.r,h._TempBuffer[1]=q.g,h._TempBuffer[2]=q.b,h._TempBuffer[3]=L,this.updateUniform(R,h._TempBuffer,4)}_updateDirectColor4ForUniform(R,q){h._TempBuffer[0]=q.r,h._TempBuffer[1]=q.g,h._TempBuffer[2]=q.b,h._TempBuffer[3]=q.a,this.updateUniform(R,h._TempBuffer,4)}_updateIntForEffect(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(R+L,q)}_updateIntForUniform(R,q){h._TempBufferInt32View[0]=q,this.updateUniform(R,h._TempBuffer,1)}_updateInt2ForEffect(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(R+B,q,L)}_updateInt2ForUniform(R,q,L){h._TempBufferInt32View[0]=q,h._TempBufferInt32View[1]=L,this.updateUniform(R,h._TempBuffer,2)}_updateInt3ForEffect(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(R+N,q,L,B)}_updateInt3ForUniform(R,q,L,B){h._TempBufferInt32View[0]=q,h._TempBufferInt32View[1]=L,h._TempBufferInt32View[2]=B,this.updateUniform(R,h._TempBuffer,3)}_updateInt4ForEffect(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(R+h,q,L,B,N)}_updateInt4ForUniform(R,q,L,B,N){h._TempBufferInt32View[0]=q,h._TempBufferInt32View[1]=L,h._TempBufferInt32View[2]=B,h._TempBufferInt32View[3]=N,this.updateUniform(R,h._TempBuffer,4)}_updateUIntForEffect(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(R+L,q)}_updateUIntForUniform(R,q){h._TempBufferUInt32View[0]=q,this.updateUniform(R,h._TempBuffer,1)}_updateUInt2ForEffect(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(R+B,q,L)}_updateUInt2ForUniform(R,q,L){h._TempBufferUInt32View[0]=q,h._TempBufferUInt32View[1]=L,this.updateUniform(R,h._TempBuffer,2)}_updateUInt3ForEffect(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(R+N,q,L,B)}_updateUInt3ForUniform(R,q,L,B){h._TempBufferUInt32View[0]=q,h._TempBufferUInt32View[1]=L,h._TempBufferUInt32View[2]=B,this.updateUniform(R,h._TempBuffer,3)}_updateUInt4ForEffect(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(R+h,q,L,B,N)}_updateUInt4ForUniform(R,q,L,B,N){h._TempBufferUInt32View[0]=q,h._TempBufferUInt32View[1]=L,h._TempBufferUInt32View[2]=B,h._TempBufferUInt32View[3]=N,this.updateUniform(R,h._TempBuffer,4)}setTexture(R,q){this._currentEffect.setTexture(R,q)}setTextureArray(R,q){this._currentEffect.setTextureArray(R,q)}bindTexture(R,q){this._currentEffect._bindTexture(R,q)}updateUniformDirectly(R,q){this.updateUniform(R,q,q.length),this.update()}bindToEffect(R,q){this._currentEffect=R,this._currentEffectName=q}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(R){if(!this._buffers)return this._buffer===R;for(let q=0;q<this._buffers.length;++q){if(this._buffers[q][0]===R)return this._bufferIndex=q,this._buffer=R,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const R=this._engine._uniformBuffers,q=R.indexOf(this);if(-1!==q&&(R[q]=R[R.length-1],R.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let L=0;L<this._buffers.length;++L){const R=this._buffers[L][0];this._engine._releaseBuffer(R)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}h._UpdatedUbosInFrame={},h._MAX_UNIFORM_SIZE=256,h._TempBuffer=new Float32Array(h._MAX_UNIFORM_SIZE),h._TempBufferInt32View=new Int32Array(h._TempBuffer.buffer),h._TempBufferUInt32View=new Uint32Array(h._TempBuffer.buffer)},11382:(R,q,L)=>{"use strict";L.d(q,{e:()=>Z,g:()=>B});var B,N,h=L(11081);!function(R){R[R.LOCAL=0]="LOCAL",R[R.WORLD=1]="WORLD",R[R.BONE=2]="BONE"}(B||(B={}));class Z{}Z.X=new h.m(1,0,0),Z.Y=new h.m(0,1,0),Z.Z=new h.m(0,0,1),function(R){R[R.X=0]="X",R[R.Y=1]="Y",R[R.Z=2]="Z"}(N||(N={}))},11112:(R,q,L)=>{"use strict";L.d(q,{e:()=>e,g:()=>y,i:()=>U});var B=L(11092),N=L(10889),h=L(11088),Z=L(11099);function z(R){return Math.pow(R,h.m)}function Y(R){return R<=.04045?.0773993808*R:Math.pow(.947867299*(R+.055),2.4)}function F(R){return Math.pow(R,h.k)}function C(R){return R<=.0031308?12.92*R:1.055*Math.pow(R,.41666)-.055}class e{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=R,this.g=q,this.b=L}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"gb"}getHashCode(){let R=255*this.r|0;return R=397*R^255*this.g,R=397*R^255*this.b,R}toArray(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return R[q]=this.r,R[q+1]=this.g,R[q+2]=this.b,this}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(R,q,this),this}toColor4(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new y(this.r,this.g,this.b,R)}dj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(R){return new e(this.r*R.r,this.g*R.g,this.b*R.b)}multiplyToRef(R,q){return q.r=this.r*R.r,q.g=this.g*R.g,q.b=this.b*R.b,q}multiplyInPlace(R){return this.r*=R.r,this.g*=R.g,this.b*=R.b,this}multiplyByFloats(R,q,L){return new e(this.r*R,this.g*q,this.b*L)}divide(R){throw new ReferenceError("Can not divide a color")}divideToRef(R,q){throw new ReferenceError("Can not divide a color")}divideInPlace(R){throw new ReferenceError("Can not divide a color")}minimizeInPlace(R){return this.minimizeInPlaceFromFloats(R.r,R.g,R.b)}maximizeInPlace(R){return this.maximizeInPlaceFromFloats(R.r,R.g,R.b)}minimizeInPlaceFromFloats(R,q,L){return this.r=Math.min(R,this.r),this.g=Math.min(q,this.g),this.b=Math.min(L,this.b),this}maximizeInPlaceFromFloats(R,q,L){return this.r=Math.max(R,this.r),this.g=Math.max(q,this.g),this.b=Math.max(L,this.b),this}floorToRef(R){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(R){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(R){return R&&this.r===R.r&&this.g===R.g&&this.b===R.b}equalsFloats(R,q,L){return this.equalsToFloats(R,q,L)}equalsToFloats(R,q,L){return this.r===R&&this.g===q&&this.b===L}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.e;return(0,Z.s)(this.r,R.r,q)&&(0,Z.s)(this.g,R.g,q)&&(0,Z.s)(this.b,R.b,q)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(R){throw new ReferenceError("Can not negate a color")}scale(R){return new e(this.r*R,this.g*R,this.b*R)}scaleInPlace(R){return this.r*=R,this.g*=R,this.b*=R,this}scaleToRef(R,q){return q.r=this.r*R,q.g=this.g*R,q.b=this.b*R,q}scaleAndAddToRef(R,q){return q.r+=this.r*R,q.g+=this.g*R,q.b+=this.b*R,q}clampToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;return L.r=(0,Z.b)(this.r,R,q),L.g=(0,Z.b)(this.g,R,q),L.b=(0,Z.b)(this.b,R,q),L}add(R){return new e(this.r+R.r,this.g+R.g,this.b+R.b)}addInPlace(R){return this.r+=R.r,this.g+=R.g,this.b+=R.b,this}addInPlaceFromFloats(R,q,L){return this.r+=R,this.g+=q,this.b+=L,this}addToRef(R,q){return q.r=this.r+R.r,q.g=this.g+R.g,q.b=this.b+R.b,q}Bc(R){return new e(this.r-R.r,this.g-R.g,this.b-R.b)}subtractToRef(R,q){return q.r=this.r-R.r,q.g=this.g-R.g,q.b=this.b-R.b,q}ki(R){return this.r-=R.r,this.g-=R.g,this.b-=R.b,this}subtractFromFloats(R,q,L){return new e(this.r-R,this.g-q,this.b-L)}subtractFromFloatsToRef(R,q,L,B){return B.r=this.r-R,B.g=this.g-q,B.b=this.b-L,B}clone(){return new e(this.r,this.g,this.b)}p(R){return this.r=R.r,this.g=R.g,this.b=R.b,this}Td(R,q,L){return this.r=R,this.g=q,this.b=L,this}set(R,q,L){return this.Td(R,q,L)}Rd(R){return this.r=this.g=this.b=R,this}toHexString(){const R=Math.round(255*this.r),q=Math.round(255*this.g),L=Math.round(255*this.b);return"#"+(0,Z.q)(R)+(0,Z.q)(q)+(0,Z.q)(L)}fromHexString(R){return"#"!==R.substring(0,1)||7!==R.length||(this.r=parseInt(R.substring(1,3),16)/255,this.g=parseInt(R.substring(3,5),16)/255,this.b=parseInt(R.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new e)}toHSVToRef(R){const q=this.r,L=this.g,B=this.b,N=Math.max(q,L,B),h=Math.min(q,L,B);let Z=0,z=0;const Y=N,F=N-h;return 0!==N&&(z=F/N),N!=h&&(N==q?(Z=(L-B)/F,L<B&&(Z+=6)):N==L?Z=(B-q)/F+2:N==B&&(Z=(q-L)/F+4),Z*=60),R.r=Z,R.g=z,R.b=Y,R}toLinearSpace(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new e;return this.toLinearSpaceToRef(q,R),q}toLinearSpaceToRef(R){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(R.r=Y(this.r),R.g=Y(this.g),R.b=Y(this.b)):(R.r=z(this.r),R.g=z(this.g),R.b=z(this.b)),this}toGammaSpace(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new e;return this.toGammaSpaceToRef(q,R),q}toGammaSpaceToRef(R){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(R.r=C(this.r),R.g=C(this.g),R.b=C(this.b)):(R.r=F(this.r),R.g=F(this.g),R.b=F(this.b)),this}static HSVtoRGBToRef(R,q,L,B){const N=L*q,h=R/60,Z=N*(1-Math.abs(h%2-1));let z=0,Y=0,F=0;h>=0&&h<=1?(z=N,Y=Z):h>=1&&h<=2?(z=Z,Y=N):h>=2&&h<=3?(Y=N,F=Z):h>=3&&h<=4?(Y=Z,F=N):h>=4&&h<=5?(z=Z,F=N):h>=5&&h<=6&&(z=N,F=Z);const C=L-N;return B.r=z+C,B.g=Y+C,B.b=F+C,B}static FromHSV(R,q,L){const B=new e(0,0,0);return e.HSVtoRGBToRef(R,q,L,B),B}static FromHexString(R){return new e(0,0,0).fromHexString(R)}static Ig(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(R[q],R[q+1],R[q+2])}static FromArrayToRef(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;L.r=R[q],L.g=R[q+1],L.b=R[q+2]}static FromInts(R,q,L){return new e(R/255,q/255,L/255)}static Lerp(R,q,L){const B=new e(0,0,0);return e.LerpToRef(R,q,L,B),B}static LerpToRef(R,q,L,B){B.r=R.r+(q.r-R.r)*L,B.g=R.g+(q.g-R.g)*L,B.b=R.b+(q.b-R.b)*L}static Hermite(R,q,L,B,N){const h=N*N,Z=N*h,z=2*Z-3*h+1,Y=-2*Z+3*h,F=Z-2*h+N,C=Z-h,y=R.r*z+L.r*Y+q.r*F+B.r*C,U=R.g*z+L.g*Y+q.g*F+B.g*C,n=R.b*z+L.b*Y+q.b*F+B.b*C;return new e(y,U,n)}static Hermite1stDerivative(R,q,L,B,N){const h=e.Black();return this.Hermite1stDerivativeToRef(R,q,L,B,N,h),h}static Hermite1stDerivativeToRef(R,q,L,B,N,h){const Z=N*N;h.r=6*(Z-N)*R.r+(3*Z-4*N+1)*q.r+6*(-Z+N)*L.r+(3*Z-2*N)*B.r,h.g=6*(Z-N)*R.g+(3*Z-4*N+1)*q.g+6*(-Z+N)*L.g+(3*Z-2*N)*B.g,h.b=6*(Z-N)*R.b+(3*Z-4*N+1)*q.b+6*(-Z+N)*L.b+(3*Z-2*N)*B.b}static Red(){return new e(1,0,0)}static Green(){return new e(0,1,0)}static Blue(){return new e(0,0,1)}static Black(){return new e(0,0,0)}static get BlackReadOnly(){return e._BlackReadOnly}static White(){return new e(1,1,1)}static Purple(){return new e(.5,0,.5)}static Magenta(){return new e(1,0,1)}static Yellow(){return new e(1,1,0)}static Gray(){return new e(.5,.5,.5)}static Teal(){return new e(0,1,1)}static Random(){return new e(Math.random(),Math.random(),Math.random())}}e._BlackReadOnly=e.Black(),Object.defineProperties(e.prototype,{dimension:{value:[3]},rank:{value:1}});class y{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=R,this.g=q,this.b=L,this.a=B}dj(){return[this.r,this.g,this.b,this.a]}toArray(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return R[q]=this.r,R[q+1]=this.g,R[q+2]=this.b,R[q+3]=this.a,this}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=R[q],this.g=R[q+1],this.b=R[q+2],this.a=R[q+3],this}equals(R){return R&&this.r===R.r&&this.g===R.g&&this.b===R.b&&this.a===R.a}add(R){return new y(this.r+R.r,this.g+R.g,this.b+R.b,this.a+R.a)}addToRef(R,q){return q.r=this.r+R.r,q.g=this.g+R.g,q.b=this.b+R.b,q.a=this.a+R.a,q}addInPlace(R){return this.r+=R.r,this.g+=R.g,this.b+=R.b,this.a+=R.a,this}addInPlaceFromFloats(R,q,L,B){return this.r+=R,this.g+=q,this.b+=L,this.a+=B,this}Bc(R){return new y(this.r-R.r,this.g-R.g,this.b-R.b,this.a-R.a)}subtractToRef(R,q){return q.r=this.r-R.r,q.g=this.g-R.g,q.b=this.b-R.b,q.a=this.a-R.a,q}ki(R){return this.r-=R.r,this.g-=R.g,this.b-=R.b,this.a-=R.a,this}subtractFromFloats(R,q,L,B){return new y(this.r-R,this.g-q,this.b-L,this.a-B)}subtractFromFloatsToRef(R,q,L,B,N){return N.r=this.r-R,N.g=this.g-q,N.b=this.b-L,N.a=this.a-B,N}scale(R){return new y(this.r*R,this.g*R,this.b*R,this.a*R)}scaleInPlace(R){return this.r*=R,this.g*=R,this.b*=R,this.a*=R,this}scaleToRef(R,q){return q.r=this.r*R,q.g=this.g*R,q.b=this.b*R,q.a=this.a*R,q}scaleAndAddToRef(R,q){return q.r+=this.r*R,q.g+=this.g*R,q.b+=this.b*R,q.a+=this.a*R,q}clampToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;return L.r=(0,Z.b)(this.r,R,q),L.g=(0,Z.b)(this.g,R,q),L.b=(0,Z.b)(this.b,R,q),L.a=(0,Z.b)(this.a,R,q),L}multiply(R){return new y(this.r*R.r,this.g*R.g,this.b*R.b,this.a*R.a)}multiplyToRef(R,q){return q.r=this.r*R.r,q.g=this.g*R.g,q.b=this.b*R.b,q.a=this.a*R.a,q}multiplyInPlace(R){return this.r*=R.r,this.g*=R.g,this.b*=R.b,this.a*=R.a,this}multiplyByFloats(R,q,L,B){return new y(this.r*R,this.g*q,this.b*L,this.a*B)}divide(R){throw new ReferenceError("Can not divide a color")}divideToRef(R,q){throw new ReferenceError("Can not divide a color")}divideInPlace(R){throw new ReferenceError("Can not divide a color")}minimizeInPlace(R){return this.r=Math.min(this.r,R.r),this.g=Math.min(this.g,R.g),this.b=Math.min(this.b,R.b),this.a=Math.min(this.a,R.a),this}maximizeInPlace(R){return this.r=Math.max(this.r,R.r),this.g=Math.max(this.g,R.g),this.b=Math.max(this.b,R.b),this.a=Math.max(this.a,R.a),this}minimizeInPlaceFromFloats(R,q,L,B){return this.r=Math.min(R,this.r),this.g=Math.min(q,this.g),this.b=Math.min(L,this.b),this.a=Math.min(B,this.a),this}maximizeInPlaceFromFloats(R,q,L,B){return this.r=Math.max(R,this.r),this.g=Math.max(q,this.g),this.b=Math.max(L,this.b),this.a=Math.max(B,this.a),this}floorToRef(R){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(R){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(R){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.e;return(0,Z.s)(this.r,R.r,q)&&(0,Z.s)(this.g,R.g,q)&&(0,Z.s)(this.b,R.b,q)&&(0,Z.s)(this.a,R.a,q)}equalsToFloats(R,q,L,B){return this.r===R&&this.g===q&&this.b===L&&this.a===B}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let R=255*this.r|0;return R=397*R^255*this.g,R=397*R^255*this.b,R=397*R^255*this.a,R}clone(){return(new y).p(this)}p(R){return this.r=R.r,this.g=R.g,this.b=R.b,this.a=R.a,this}Td(R,q,L,B){return this.r=R,this.g=q,this.b=L,this.a=B,this}set(R,q,L,B){return this.Td(R,q,L,B)}Rd(R){return this.r=this.g=this.b=this.a=R,this}toHexString(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=Math.round(255*this.r),L=Math.round(255*this.g),B=Math.round(255*this.b);if(R)return"#"+(0,Z.q)(q)+(0,Z.q)(L)+(0,Z.q)(B);const N=Math.round(255*this.a);return"#"+(0,Z.q)(q)+(0,Z.q)(L)+(0,Z.q)(B)+(0,Z.q)(N)}fromHexString(R){return"#"!==R.substring(0,1)||9!==R.length&&7!==R.length||(this.r=parseInt(R.substring(1,3),16)/255,this.g=parseInt(R.substring(3,5),16)/255,this.b=parseInt(R.substring(5,7),16)/255,9===R.length&&(this.a=parseInt(R.substring(7,9),16)/255)),this}toLinearSpace(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new y;return this.toLinearSpaceToRef(q,R),q}toLinearSpaceToRef(R){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(R.r=Y(this.r),R.g=Y(this.g),R.b=Y(this.b)):(R.r=z(this.r),R.g=z(this.g),R.b=z(this.b)),R.a=this.a,this}toGammaSpace(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=new y;return this.toGammaSpaceToRef(q,R),q}toGammaSpaceToRef(R){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(R.r=C(this.r),R.g=C(this.g),R.b=C(this.b)):(R.r=F(this.r),R.g=F(this.g),R.b=F(this.b)),R.a=this.a,this}static FromHexString(R){return"#"!==R.substring(0,1)||9!==R.length&&7!==R.length?new y(0,0,0,0):new y(0,0,0,1).fromHexString(R)}static Lerp(R,q,L){return y.LerpToRef(R,q,L,new y)}static LerpToRef(R,q,L,B){return B.r=R.r+(q.r-R.r)*L,B.g=R.g+(q.g-R.g)*L,B.b=R.b+(q.b-R.b)*L,B.a=R.a+(q.a-R.a)*L,B}static Hermite(R,q,L,B,N){const h=N*N,Z=N*h,z=2*Z-3*h+1,Y=-2*Z+3*h,F=Z-2*h+N,C=Z-h,e=R.r*z+L.r*Y+q.r*F+B.r*C,U=R.g*z+L.g*Y+q.g*F+B.g*C,n=R.b*z+L.b*Y+q.b*F+B.b*C,r=R.a*z+L.a*Y+q.a*F+B.a*C;return new y(e,U,n,r)}static Hermite1stDerivative(R,q,L,B,N){const h=new y;return this.Hermite1stDerivativeToRef(R,q,L,B,N,h),h}static Hermite1stDerivativeToRef(R,q,L,B,N,h){const Z=N*N;h.r=6*(Z-N)*R.r+(3*Z-4*N+1)*q.r+6*(-Z+N)*L.r+(3*Z-2*N)*B.r,h.g=6*(Z-N)*R.g+(3*Z-4*N+1)*q.g+6*(-Z+N)*L.g+(3*Z-2*N)*B.g,h.b=6*(Z-N)*R.b+(3*Z-4*N+1)*q.b+6*(-Z+N)*L.b+(3*Z-2*N)*B.b,h.a=6*(Z-N)*R.a+(3*Z-4*N+1)*q.a+6*(-Z+N)*L.a+(3*Z-2*N)*B.a}static FromColor3(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new y(R.r,R.g,R.b,q)}static Ig(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new y(R[q],R[q+1],R[q+2],R[q+3])}static FromArrayToRef(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;L.r=R[q],L.g=R[q+1],L.b=R[q+2],L.a=R[q+3]}static FromInts(R,q,L,B){return new y(R/255,q/255,L/255,B/255)}static CheckColors4(R,q){if(R.length===3*q){const q=[];for(let L=0;L<R.length;L+=3){const B=L/3*4;q[B]=R[L],q[B+1]=R[L+1],q[B+2]=R[L+2],q[B+3]=1}return q}return R}}Object.defineProperties(y.prototype,{dimension:{value:[4]},rank:{value:1}});class U{}U.gb=(0,B.e)(3,e.Black),U.ob=(0,B.e)(3,(()=>new y(0,0,0,0))),(0,N.f)("BABYLON.Color3",e),(0,N.f)("BABYLON.Color4",y)},11088:(R,q,L)=>{"use strict";L.d(q,{e:()=>Z,g:()=>h,k:()=>B,m:()=>N});const B=1/2.2,N=2.2,h=(1+Math.sqrt(5))/2,Z=.001},11196:(R,q,L)=>{"use strict";L.d(q,{b:()=>N});var B=L(11198);class N{static GetPlanes(R){const q=[];for(let L=0;L<6;L++)q.push(new B.e(0,0,0,0));return N.GetPlanesToRef(R,q),q}static GetNearPlaneToRef(R,q){const L=R.m;q.k.x=L[3]+L[2],q.k.y=L[7]+L[6],q.k.z=L[11]+L[10],q.d=L[15]+L[14],q.normalize()}static GetFarPlaneToRef(R,q){const L=R.m;q.k.x=L[3]-L[2],q.k.y=L[7]-L[6],q.k.z=L[11]-L[10],q.d=L[15]-L[14],q.normalize()}static GetLeftPlaneToRef(R,q){const L=R.m;q.k.x=L[3]+L[0],q.k.y=L[7]+L[4],q.k.z=L[11]+L[8],q.d=L[15]+L[12],q.normalize()}static GetRightPlaneToRef(R,q){const L=R.m;q.k.x=L[3]-L[0],q.k.y=L[7]-L[4],q.k.z=L[11]-L[8],q.d=L[15]-L[12],q.normalize()}static GetTopPlaneToRef(R,q){const L=R.m;q.k.x=L[3]-L[1],q.k.y=L[7]-L[5],q.k.z=L[11]-L[9],q.d=L[15]-L[13],q.normalize()}static GetBottomPlaneToRef(R,q){const L=R.m;q.k.x=L[3]+L[1],q.k.y=L[7]+L[5],q.k.z=L[11]+L[9],q.d=L[15]+L[13],q.normalize()}static GetPlanesToRef(R,q){N.GetNearPlaneToRef(R,q[0]),N.GetFarPlaneToRef(R,q[1]),N.GetLeftPlaneToRef(R,q[2]),N.GetRightPlaneToRef(R,q[3]),N.GetTopPlaneToRef(R,q[4]),N.GetBottomPlaneToRef(R,q[5])}static IsPointInFrustum(R,q){for(let L=0;L<6;L++)if(q[L].dotCoordinate(R)<0)return!1;return!0}}},11239:(R,q,L)=>{"use strict";L.d(q,{d:()=>z,e:()=>Y});var B=L(11053),N=L(11081),h=L(11058);class Z{static extractMinAndMaxIndexed(R,q,L,B,N,h){for(let Z=L;Z<L+B;Z++){const L=3*q[Z],B=R[L],z=R[L+1],Y=R[L+2];N.minimizeInPlaceFromFloats(B,z,Y),h.maximizeInPlaceFromFloats(B,z,Y)}}static extractMinAndMax(R,q,L,B,N,h){for(let Z=q,z=q*B;Z<q+L;Z++,z+=B){const q=R[z],L=R[z+1],B=R[z+2];N.minimizeInPlaceFromFloats(q,L,B),h.maximizeInPlaceFromFloats(q,L,B)}}}function z(R,q,L,B){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const z=new N.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Y=new N.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Z.extractMinAndMaxIndexed(R,q,L,B,z,Y),h&&(z.x-=z.x*h.x+h.y,z.y-=z.y*h.x+h.y,z.z-=z.z*h.x+h.y,Y.x+=Y.x*h.x+h.y,Y.y+=Y.y*h.x+h.y,Y.z+=Y.z*h.x+h.y),{minimum:z,maximum:Y}}function Y(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;const z=new N.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Y=new N.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return h||(h=3),Z.extractMinAndMax(R,q,L,h,z,Y),B&&(z.x-=z.x*B.x+B.y,z.y-=z.y*B.x+B.y,z.z-=z.z*B.x+B.y,Y.x+=Y.x*B.x+B.y,Y.y+=Y.y*B.x+B.y,Y.z+=Y.z*B.x+B.y),{minimum:z,maximum:Y}}(0,B.d)([h.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B,N]=q;return!Array.isArray(B)&&!Array.isArray(N)}))],Z,"extractMinAndMaxIndexed",null),(0,B.d)([h.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B]=q;return!Array.isArray(B)}))],Z,"extractMinAndMax",null)},11570:(R,q,L)=>{"use strict";L.d(q,{d:()=>B.h});L(11382),L(11112),L(11088),L(11196),L(11579),L(11198),L(11287);var B=L(11081);L(11352)},11579:(R,q,L)=>{"use strict";L.d(q,{b:()=>z,d:()=>C,e:()=>e});var B,N=L(11099),h=L(11081),Z=L(11088);!function(R){R[R.CW=0]="CW",R[R.CCW=1]="CCW"}(B||(B={}));class z{static Interpolate(R,q,L,B,N){const h=1-3*B+3*q,Z=3*B-6*q,z=3*q;let Y=R;for(let F=0;F<5;F++){const q=Y*Y;Y-=(h*(q*Y)+Z*q+z*Y-R)*(1/(3*h*q+2*Z*Y+z)),Y=Math.min(1,Math.max(0,Y))}return 3*Math.pow(1-Y,2)*Y*L+3*(1-Y)*Math.pow(Y,2)*N+Math.pow(Y,3)}}class Y{constructor(R){this._radians=R,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(R,q){const L=q.Bc(R),B=Math.atan2(L.y,L.x);return new Y(B)}static BetweenTwoVectors(R,q){let L=R.lengthSquared()*q.lengthSquared();if(0===L)return new Y(Math.PI/2);L=Math.sqrt(L);let B=R.dot(q)/L;B=(0,N.b)(B,-1,1);const h=Math.acos(B);return new Y(h)}static FromRadians(R){return new Y(R)}static FromDegrees(R){return new Y(R*Math.PI/180)}}class F{constructor(R,q,L){this.startPoint=R,this.midPoint=q,this.endPoint=L;const B=Math.pow(q.x,2)+Math.pow(q.y,2),N=(Math.pow(R.x,2)+Math.pow(R.y,2)-B)/2,Z=(B-Math.pow(L.x,2)-Math.pow(L.y,2))/2,z=(R.x-q.x)*(q.y-L.y)-(q.x-L.x)*(R.y-q.y);this.centerPoint=new h.i((N*(q.y-L.y)-Z*(R.y-q.y))/z,((R.x-q.x)*Z-(q.x-L.x)*N)/z),this.radius=this.centerPoint.Bc(this.startPoint).length(),this.startAngle=Y.BetweenTwoPoints(this.centerPoint,this.startPoint);const F=this.startAngle.degrees();let C=Y.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),e=Y.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();C-F>180&&(C-=360),C-F<-180&&(C+=360),e-C>180&&(e-=360),e-C<-180&&(e+=360),this.orientation=C-F<0?0:1,this.angle=Y.FromDegrees(0===this.orientation?F-e:e-F)}}class C{constructor(R,q){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new h.i(R,q))}addLineTo(R,q){if(this.closed)return this;const L=new h.i(R,q),B=this._points[this._points.length-1];return this._points.push(L),this._length+=L.Bc(B).length(),this}addArcTo(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const Z=this._points[this._points.length-1],z=new h.i(R,q),Y=new h.i(L,B),C=new F(Z,z,Y);let e=C.angle.radians()/N;0===C.orientation&&(e*=-1);let y=C.startAngle.radians()+e;for(let h=0;h<N;h++){const R=Math.cos(y)*C.radius+C.centerPoint.x,q=Math.sin(y)*C.radius+C.centerPoint.y;this.addLineTo(R,q),y+=e}return this}addQuadraticCurveTo(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const h=(R,q,L,B)=>(1-R)*(1-R)*q+2*R*(1-R)*L+R*R*B,Z=this._points[this._points.length-1];for(let z=0;z<=N;z++){const Y=z/N,F=h(Y,Z.x,R,L),C=h(Y,Z.y,q,B);this.addLineTo(F,C)}return this}addBezierCurveTo(R,q,L,B,N,h){let Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const z=(R,q,L,B,N)=>(1-R)*(1-R)*(1-R)*q+3*R*(1-R)*(1-R)*L+3*R*R*(1-R)*B+R*R*R*N,Y=this._points[this._points.length-1];for(let F=0;F<=Z;F++){const C=F/Z,e=z(C,Y.x,R,L,N),y=z(C,Y.y,q,B,h);this.addLineTo(e,y)}return this}isPointInside(R){let q=!1;const L=this._points.length;for(let B=L-1,N=0;N<L;B=N++){let L=this._points[B],h=this._points[N],Z=h.x-L.x,z=h.y-L.y;if(Math.abs(z)>Number.EPSILON){if(z<0&&(L=this._points[N],Z=-Z,h=this._points[B],z=-z),R.y<L.y||R.y>h.y)continue;if(R.y===L.y&&R.x===L.x)return!0;{const B=z*(R.x-L.x)-Z*(R.y-L.y);if(0===B)return!0;if(B<0)continue;q=!q}}else{if(R.y!==L.y)continue;if(h.x<=R.x&&R.x<=L.x||L.x<=R.x&&R.x<=h.x)return!0}}return q}close(){return this.closed=!0,this}length(){let R=this._length;if(this.closed){const q=this._points[this._points.length-1];R+=this._points[0].Bc(q).length()}return R}area(){const R=this._points.length;let q=0;for(let L=R-1,B=0;B<R;L=B++)q+=this._points[L].x*this._points[B].y-this._points[B].x*this._points[L].y;return.5*q}getPoints(){return this._points}getPointAtLengthPosition(R){if(R<0||R>1)return h.i.Zero();const q=R*this.length();let L=0;for(let B=0;B<this._points.length;B++){const R=(B+1)%this._points.length,N=this._points[B],Z=this._points[R].Bc(N),z=Z.length()+L;if(q>=L&&q<=z){const R=Z.normalize(),B=q-L;return new h.i(N.x+R.x*B,N.y+R.y*B)}L=z}return h.i.Zero()}static StartingAt(R,q){return new C(R,q)}}class e{constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=R,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:h.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:h.c.Identity()};for(let N=0;N<R.length;N++)this._curve[N]=R[N].clone();this._raw=L||!1,this._alignTangentsWithPath=B,this._compute(q,B)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(R){return this._updatePointAtData(R).point}getTangentAt(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(R,q),q?h.m.TransformCoordinates(h.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(R,q),q?h.m.TransformCoordinates(h.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(R,q),q?h.m.TransformCoordinates(h.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(R){return this.length()*R}getPreviousPointIndexAt(R){return this._updatePointAtData(R),this._pointAtData.previousPointArrayIndex}getSubPositionAt(R){return this._updatePointAtData(R),this._pointAtData.subPosition}getClosestPositionTo(R){let q=Number.MAX_VALUE,L=0;for(let B=0;B<this._curve.length-1;B++){const N=this._curve[B+0],Z=this._curve[B+1].Bc(N).normalize(),z=this._distances[B+1]-this._distances[B+0],Y=Math.min(Math.max(h.m.Dot(Z,R.Bc(N).normalize()),0)*h.m.Distance(N,R)/z,1),F=h.m.Distance(N.add(Z.scale(Y*z)),R);F<q&&(q=F,L=(this._distances[B+0]+z*Y)/this.length())}return L}slice(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(R<0&&(R=1- -1*R%1),q<0&&(q=1- -1*q%1),R>q){const L=R;R=q,q=L}const L=this.getCurve(),B=this.getPointAt(R);let N=this.getPreviousPointIndexAt(R);const h=this.getPointAt(q),Z=this.getPreviousPointIndexAt(q)+1,z=[];return 0!==R&&(N++,z.push(B)),z.push(...L.slice(N,Z)),1===q&&1!==R||z.push(h),new e(z,this.getNormalAt(R),this._raw,this._alignTangentsWithPath)}update(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let B=0;B<R.length;B++)this._curve[B].x=R[B].x,this._curve[B].y=R[B].y,this._curve[B].z=R[B].z;return this._compute(q,L),this}_compute(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=this._curve.length;if(L<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[L-1]=this._curve[L-1].Bc(this._curve[L-2]),this._raw||this._tangents[L-1].normalize();const B=this._tangents[0],N=this._normalVector(B,R);let Z,z,Y,F,C;this._normals[0]=N,this._raw||this._normals[0].normalize(),this._binormals[0]=h.m.Cross(B,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<L;e++)Z=this._getLastNonNullVector(e),e<L-1&&(z=this._getFirstNonNullVector(e),this._tangents[e]=q?z:Z.add(z),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].Bc(this._curve[e-1]).length(),Y=this._tangents[e],C=this._binormals[e-1],this._normals[e]=h.m.Cross(C,Y),this._raw||(0===this._normals[e].length()?(F=this._normals[e-1],this._normals[e]=F.clone()):this._normals[e].normalize()),this._binormals[e]=h.m.Cross(Y,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(R){let q=1,L=this._curve[R+q].Bc(this._curve[R]);for(;0===L.length()&&R+q+1<this._curve.length;)q++,L=this._curve[R+q].Bc(this._curve[R]);return L}_getLastNonNullVector(R){let q=1,L=this._curve[R].Bc(this._curve[R-q]);for(;0===L.length()&&R>q+1;)q++,L=this._curve[R].Bc(this._curve[R-q]);return L}_normalVector(R,q){let L,B=R.length();if(0===B&&(B=1),void 0===q||null===q){let q;q=(0,N.s)(Math.abs(R.y)/B,1,Z.e)?(0,N.s)(Math.abs(R.x)/B,1,Z.e)?(0,N.s)(Math.abs(R.z)/B,1,Z.e)?h.m.Zero():new h.m(0,0,1):new h.m(1,0,0):new h.m(0,-1,0),L=h.m.Cross(R,q)}else L=h.m.Cross(R,q),h.m.CrossToRef(L,R,L);return L.normalize(),L}_updatePointAtData(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===R)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=R;const L=this.getPoints();if(R<=0)return this._setPointAtData(0,0,L[0],0,q);if(R>=1)return this._setPointAtData(1,1,L[L.length-1],L.length-1,q);let B,N=L[0],Z=0;const z=R*this.length();for(let Y=1;Y<L.length;Y++){B=L[Y];const F=h.m.Distance(N,B);if(Z+=F,Z===z)return this._setPointAtData(R,1,B,Y,q);if(Z>z){const L=(Z-z)/F,h=N.Bc(B),C=B.add(h.scaleInPlace(L));return this._setPointAtData(R,1-L,C,Y-1,q)}N=B}return this._pointAtData}_setPointAtData(R,q,L,B,N){return this._pointAtData.point=L,this._pointAtData.position=R,this._pointAtData.subPosition=q,this._pointAtData.previousPointArrayIndex=B,this._pointAtData.interpolateReady=N,N&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=h.c.Identity();const R=this._pointAtData.previousPointArrayIndex;if(R!==this._tangents.length-1){const q=R+1,L=this._tangents[R].clone(),B=this._normals[R].clone(),N=this._binormals[R].clone(),Z=this._tangents[q].clone(),z=this._normals[q].clone(),Y=this._binormals[q].clone(),F=h.d.RotationQuaternionFromAxis(B,N,L),C=h.d.RotationQuaternionFromAxis(z,Y,Z);h.d.Slerp(F,C,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11198:(R,q,L)=>{"use strict";L.d(q,{e:()=>N});var B=L(11081);class N{constructor(R,q,L,N){this.k=new B.m(R,q,L),this.d=N}dj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new N(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let R=this.k.getHashCode();return R=397*R^this.d,R}normalize(){const R=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let q=0;return 0!==R&&(q=1/R),this.k.x*=q,this.k.y*=q,this.k.z*=q,this.d*=q,this}transform(R){const q=N._TmpMatrix;R.invertToRef(q);const L=q.m,B=this.k.x,h=this.k.y,Z=this.k.z,z=this.d,Y=B*L[0]+h*L[1]+Z*L[2]+z*L[3],F=B*L[4]+h*L[5]+Z*L[6]+z*L[7],C=B*L[8]+h*L[9]+Z*L[10]+z*L[11],e=B*L[12]+h*L[13]+Z*L[14]+z*L[15];return new N(Y,F,C,e)}dotCoordinate(R){return this.k.x*R.x+this.k.y*R.y+this.k.z*R.z+this.d}copyFromPoints(R,q,L){const B=q.x-R.x,N=q.y-R.y,h=q.z-R.z,Z=L.x-R.x,z=L.y-R.y,Y=L.z-R.z,F=N*Y-h*z,C=h*Z-B*Y,e=B*z-N*Z,y=Math.sqrt(F*F+C*C+e*e);let U;return U=0!==y?1/y:0,this.k.x=F*U,this.k.y=C*U,this.k.z=e*U,this.d=-(this.k.x*R.x+this.k.y*R.y+this.k.z*R.z),this}isFrontFacingTo(R,q){return B.m.Dot(this.k,R)<=q}signedDistanceTo(R){return B.m.Dot(R,this.k)+this.d}static Ig(R){return new N(R[0],R[1],R[2],R[3])}static FromPoints(R,q,L){const B=new N(0,0,0,0);return B.copyFromPoints(R,q,L),B}static FromPositionAndNormal(R,q){const L=new N(0,0,0,0);return this.FromPositionAndNormalToRef(R,q,L)}static FromPositionAndNormalToRef(R,q,L){return L.k.p(q),L.k.normalize(),L.d=-R.dot(L.k),L}static SignedDistanceToPlaneFromPositionAndNormal(R,q,L){const N=-(q.x*R.x+q.y*R.y+q.z*R.z);return B.m.Dot(L,q)+N}}N._TmpMatrix=B.c.Identity()},11099:(R,q,L)=>{"use strict";function B(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(R-q)<=L}function N(R,q){return R===q?R:Math.random()*(q-R)+R}function h(R,q,L){return R+(q-R)*L}function Z(R,q,L,B,N){const h=N*N,Z=N*h;return R*(2*Z-3*h+1)+L*(-2*Z+3*h)+q*(Z-2*h+N)+B*(Z-h)}function z(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(L,Math.max(q,R))}function Y(R){return R-=2*Math.PI*Math.floor((R+Math.PI)/(2*Math.PI))}function F(R){const q=R.toString(16);return R<=15?("0"+q).toUpperCase():q.toUpperCase()}function C(R){if(Math.log2)return Math.floor(Math.log2(R));if(R<0)return NaN;if(0===R)return-1/0;let q=0;if(R<1){for(;R<1;)q++,R*=2;q=-q}else if(R>1)for(;R>1;)q++,R=Math.floor(R/2);return q}function e(R,q){const L=R%q;return 0===L?q:e(q,L)}L.d(q,{b:()=>z,c:()=>Z,d:()=>e,g:()=>C,h:()=>h,k:()=>Y,m:()=>N,q:()=>F,s:()=>B})},11287:(R,q,L)=>{"use strict";L.d(q,{c:()=>B});class B{constructor(R,q){this.width=R,this.height=q}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let R=0|this.width;return R=397*R^this.height,R}p(R){this.width=R.width,this.height=R.height}Td(R,q){return this.width=R,this.height=q,this}set(R,q){return this.Td(R,q)}multiplyByFloats(R,q){return new B(this.width*R,this.height*q)}clone(){return new B(this.width,this.height)}equals(R){return!!R&&(this.width===R.width&&this.height===R.height)}get surface(){return this.width*this.height}static Zero(){return new B(0,0)}add(R){return new B(this.width+R.width,this.height+R.height)}Bc(R){return new B(this.width-R.width,this.height-R.height)}scale(R){return new B(this.width*R,this.height*R)}static Lerp(R,q,L){const N=R.width+(q.width-R.width)*L,h=R.height+(q.height-R.height)*L;return new B(N,h)}}},11081:(R,q,L)=>{"use strict";L.d(q,{c:()=>n,d:()=>U,h:()=>p,i:()=>C,m:()=>e,q:()=>y});var B=L(11088),N=L(11092),h=L(10889),Z=L(10864),z=L(10797),Y=L(11099);const F=R=>parseInt(R.toString().replace(/\W/g,""));class C{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=R,this.y=q}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let R=F(this.x);return R=397*R^F(this.y),R}toArray(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return R[q]=this.x,R[q+1]=this.y,this}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return C.FromArrayToRef(R,q,this),this}dj(){return[this.x,this.y]}p(R){return this.x=R.x,this.y=R.y,this}Td(R,q){return this.x=R,this.y=q,this}set(R,q){return this.Td(R,q)}Rd(R){return this.Td(R,R)}add(R){return new C(this.x+R.x,this.y+R.y)}addToRef(R,q){return q.x=this.x+R.x,q.y=this.y+R.y,q}addInPlace(R){return this.x+=R.x,this.y+=R.y,this}addInPlaceFromFloats(R,q){return this.x+=R,this.y+=q,this}addVector3(R){return new C(this.x+R.x,this.y+R.y)}Bc(R){return new C(this.x-R.x,this.y-R.y)}subtractToRef(R,q){return q.x=this.x-R.x,q.y=this.y-R.y,q}ki(R){return this.x-=R.x,this.y-=R.y,this}multiplyInPlace(R){return this.x*=R.x,this.y*=R.y,this}multiply(R){return new C(this.x*R.x,this.y*R.y)}multiplyToRef(R,q){return q.x=this.x*R.x,q.y=this.y*R.y,q}multiplyByFloats(R,q){return new C(this.x*R,this.y*q)}divide(R){return new C(this.x/R.x,this.y/R.y)}divideToRef(R,q){return q.x=this.x/R.x,q.y=this.y/R.y,q}divideInPlace(R){return this.x=this.x/R.x,this.y=this.y/R.y,this}minimizeInPlace(R){return this.minimizeInPlaceFromFloats(R.x,R.y)}maximizeInPlace(R){return this.maximizeInPlaceFromFloats(R.x,R.y)}minimizeInPlaceFromFloats(R,q){return this.x=Math.min(R,this.x),this.y=Math.min(q,this.y),this}maximizeInPlaceFromFloats(R,q){return this.x=Math.max(R,this.x),this.y=Math.max(q,this.y),this}subtractFromFloats(R,q){return new C(this.x-R,this.y-q)}subtractFromFloatsToRef(R,q,L){return L.x=this.x-R,L.y=this.y-q,L}negate(){return new C(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(R){return R.x=-this.x,R.y=-this.y,R}scaleInPlace(R){return this.x*=R,this.y*=R,this}scale(R){return new C(this.x*R,this.y*R)}scaleToRef(R,q){return q.x=this.x*R,q.y=this.y*R,q}scaleAndAddToRef(R,q){return q.x+=this.x*R,q.y+=this.y*R,q}equals(R){return R&&this.x===R.x&&this.y===R.y}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;return R&&(0,Y.s)(this.x,R.x,q)&&(0,Y.s)(this.y,R.y,q)}equalsToFloats(R,q){return this.x===R&&this.y===q}floor(){return new C(Math.floor(this.x),Math.floor(this.y))}floorToRef(R){return R.x=Math.floor(this.x),R.y=Math.floor(this.y),R}fract(){return new C(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(R){return R.x=this.x-Math.floor(this.x),R.y=this.y-Math.floor(this.y),R}rotateToRef(R,q){const L=Math.cos(R),B=Math.sin(R),N=L*this.x-B*this.y,h=B*this.x+L*this.y;return q.x=N,q.y=h,q}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(R){return 0===R||1===R?this:this.scaleInPlace(1/R)}normalizeToNew(){const R=new C;return this.normalizeToRef(R),R}normalizeToRef(R){const q=this.length();return 0===q&&(R.x=this.x,R.y=this.y),this.scaleToRef(1/q,R)}clone(){return new C(this.x,this.y)}dot(R){return this.x*R.x+this.y*R.y}static Zero(){return new C(0,0)}static One(){return new C(1,1)}static Random(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new C((0,Y.m)(R,q),(0,Y.m)(R,q))}static RandomToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Td((0,Y.m)(R,q),(0,Y.m)(R,q))}static get ZeroReadOnly(){return C._ZeroReadOnly}static Ig(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new C(R[q],R[q+1])}static FromArrayToRef(R,q,L){return L.x=R[q],L.y=R[q+1],L}static FromFloatsToRef(R,q,L){return L.Td(R,q),L}static CatmullRom(R,q,L,B,N){const h=N*N,Z=N*h,z=.5*(2*q.x+(-R.x+L.x)*N+(2*R.x-5*q.x+4*L.x-B.x)*h+(-R.x+3*q.x-3*L.x+B.x)*Z),Y=.5*(2*q.y+(-R.y+L.y)*N+(2*R.y-5*q.y+4*L.y-B.y)*h+(-R.y+3*q.y-3*L.y+B.y)*Z);return new C(z,Y)}static ClampToRef(R,q,L,B){return B.x=(0,Y.b)(R.x,q.x,L.x),B.y=(0,Y.b)(R.y,q.y,L.y),B}static Clamp(R,q,L){const B=(0,Y.b)(R.x,q.x,L.x),N=(0,Y.b)(R.y,q.y,L.y);return new C(B,N)}static Hermite(R,q,L,B,N){const h=N*N,Z=N*h,z=2*Z-3*h+1,Y=-2*Z+3*h,F=Z-2*h+N,e=Z-h,y=R.x*z+L.x*Y+q.x*F+B.x*e,U=R.y*z+L.y*Y+q.y*F+B.y*e;return new C(y,U)}static Hermite1stDerivative(R,q,L,B,N){return this.Hermite1stDerivativeToRef(R,q,L,B,N,new C)}static Hermite1stDerivativeToRef(R,q,L,B,N,h){const Z=N*N;return h.x=6*(Z-N)*R.x+(3*Z-4*N+1)*q.x+6*(-Z+N)*L.x+(3*Z-2*N)*B.x,h.y=6*(Z-N)*R.y+(3*Z-4*N+1)*q.y+6*(-Z+N)*L.y+(3*Z-2*N)*B.y,h}static Lerp(R,q,L){return C.LerpToRef(R,q,L,new C)}static LerpToRef(R,q,L,B){return B.x=R.x+(q.x-R.x)*L,B.y=R.y+(q.y-R.y)*L,B}static Dot(R,q){return R.x*q.x+R.y*q.y}static Normalize(R){return C.NormalizeToRef(R,new C)}static NormalizeToRef(R,q){return R.normalizeToRef(q),q}static Minimize(R,q){const L=R.x<q.x?R.x:q.x,B=R.y<q.y?R.y:q.y;return new C(L,B)}static Maximize(R,q){const L=R.x>q.x?R.x:q.x,B=R.y>q.y?R.y:q.y;return new C(L,B)}static Transform(R,q){return C.TransformToRef(R,q,new C)}static TransformToRef(R,q,L){const B=q.m,N=R.x*B[0]+R.y*B[4]+B[12],h=R.x*B[1]+R.y*B[5]+B[13];return L.x=N,L.y=h,L}static PointInTriangle(R,q,L,B){const N=.5*(-L.y*B.x+q.y*(-L.x+B.x)+q.x*(L.y-B.y)+L.x*B.y),h=N<0?-1:1,Z=(q.y*B.x-q.x*B.y+(B.y-q.y)*R.x+(q.x-B.x)*R.y)*h,z=(q.x*L.y-q.y*L.x+(q.y-L.y)*R.x+(L.x-q.x)*R.y)*h;return Z>0&&z>0&&Z+z<2*N*h}static Distance(R,q){return Math.sqrt(C.DistanceSquared(R,q))}static DistanceSquared(R,q){const L=R.x-q.x,B=R.y-q.y;return L*L+B*B}static Center(R,q){return C.CenterToRef(R,q,new C)}static CenterToRef(R,q,L){return L.Td((R.x+q.x)/2,(R.y+q.y)/2)}static DistanceOfPointFromSegment(R,q,L){const B=C.DistanceSquared(q,L);if(0===B)return C.Distance(R,q);const N=L.Bc(q),h=Math.max(0,Math.min(1,C.Dot(R.Bc(q),N)/B)),Z=q.add(N.multiplyByFloats(h,h));return C.Distance(R,Z)}}C._ZeroReadOnly=C.Zero(),Object.defineProperties(C.prototype,{dimension:{value:[2]},rank:{value:1}});class e{get x(){return this._x}set x(R){this._x=R,this._isDirty=!0}get y(){return this._y}set y(R){this._y=R,this._isDirty=!0}get z(){return this._z}set z(R){this._z=R,this._isDirty=!0}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=R,this._y=q,this._z=L}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"o"}getHashCode(){let R=F(this._x);return R=397*R^F(this._y),R=397*R^F(this._z),R}dj(){return[this._x,this._y,this._z]}toArray(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return R[q]=this._x,R[q+1]=this._y,R[q+2]=this._z,this}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(R,q,this),this}toQuaternion(){return U.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(R){return this._x+=R._x,this._y+=R._y,this._z+=R._z,this._isDirty=!0,this}addInPlaceFromFloats(R,q,L){return this._x+=R,this._y+=q,this._z+=L,this._isDirty=!0,this}add(R){return new e(this._x+R._x,this._y+R._y,this._z+R._z)}addToRef(R,q){return q._x=this._x+R._x,q._y=this._y+R._y,q._z=this._z+R._z,q._isDirty=!0,q}ki(R){return this._x-=R._x,this._y-=R._y,this._z-=R._z,this._isDirty=!0,this}Bc(R){return new e(this._x-R._x,this._y-R._y,this._z-R._z)}subtractToRef(R,q){return this.subtractFromFloatsToRef(R._x,R._y,R._z,q)}subtractFromFloats(R,q,L){return new e(this._x-R,this._y-q,this._z-L)}subtractFromFloatsToRef(R,q,L,B){return B._x=this._x-R,B._y=this._y-q,B._z=this._z-L,B._isDirty=!0,B}negate(){return new e(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(R){return R._x=-1*this._x,R._y=-1*this._y,R._z=-1*this._z,R._isDirty=!0,R}scaleInPlace(R){return this._x*=R,this._y*=R,this._z*=R,this._isDirty=!0,this}scale(R){return new e(this._x*R,this._y*R,this._z*R)}scaleToRef(R,q){return q._x=this._x*R,q._y=this._y*R,q._z=this._z*R,q._isDirty=!0,q}getNormalToRef(R){const q=this.length();let L=Math.acos(this.y/q);const B=Math.atan2(this.z,this.x);L>Math.PI/2?L-=Math.PI/2:L+=Math.PI/2;const N=q*Math.sin(L)*Math.cos(B),h=q*Math.cos(L),Z=q*Math.sin(L)*Math.sin(B);return R.set(N,h,Z),R}applyRotationQuaternionToRef(R,q){const L=this._x,B=this._y,N=this._z,h=R._x,Z=R._y,z=R._z,Y=R._w,F=2*(Z*N-z*B),C=2*(z*L-h*N),e=2*(h*B-Z*L);return q._x=L+Y*F+Z*e-z*C,q._y=B+Y*C+z*F-h*e,q._z=N+Y*e+h*C-Z*F,q._isDirty=!0,q}applyRotationQuaternionInPlace(R){return this.applyRotationQuaternionToRef(R,this)}applyRotationQuaternion(R){return this.applyRotationQuaternionToRef(R,new e)}scaleAndAddToRef(R,q){return q._x+=this._x*R,q._y+=this._y*R,q._z+=this._z*R,q._isDirty=!0,q}projectOnPlane(R,q){return this.projectOnPlaneToRef(R,q,new e)}projectOnPlaneToRef(R,q,L){const B=R.k,N=R.d,h=r.o[0];this.subtractToRef(q,h),h.normalize();const Z=e.Dot(h,B);if(Math.abs(Z)<1e-10)L.Rd(1/0);else{const R=-(e.Dot(q,B)+N)/Z,z=h.scaleInPlace(R);q.addToRef(z,L)}return L}equals(R){return R&&this._x===R._x&&this._y===R._y&&this._z===R._z}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;return R&&(0,Y.s)(this._x,R._x,q)&&(0,Y.s)(this._y,R._y,q)&&(0,Y.s)(this._z,R._z,q)}equalsToFloats(R,q,L){return this._x===R&&this._y===q&&this._z===L}multiplyInPlace(R){return this._x*=R._x,this._y*=R._y,this._z*=R._z,this._isDirty=!0,this}multiply(R){return this.multiplyByFloats(R._x,R._y,R._z)}multiplyToRef(R,q){return q._x=this._x*R._x,q._y=this._y*R._y,q._z=this._z*R._z,q._isDirty=!0,q}multiplyByFloats(R,q,L){return new e(this._x*R,this._y*q,this._z*L)}divide(R){return new e(this._x/R._x,this._y/R._y,this._z/R._z)}divideToRef(R,q){return q._x=this._x/R._x,q._y=this._y/R._y,q._z=this._z/R._z,q._isDirty=!0,q}divideInPlace(R){return this._x=this._x/R._x,this._y=this._y/R._y,this._z=this._z/R._z,this._isDirty=!0,this}minimizeInPlace(R){return this.minimizeInPlaceFromFloats(R._x,R._y,R._z)}maximizeInPlace(R){return this.maximizeInPlaceFromFloats(R._x,R._y,R._z)}minimizeInPlaceFromFloats(R,q,L){return R<this._x&&(this.x=R),q<this._y&&(this.y=q),L<this._z&&(this.z=L),this}maximizeInPlaceFromFloats(R,q,L){return R>this._x&&(this.x=R),q>this._y&&(this.y=q),L>this._z&&(this.z=L),this}isNonUniformWithinEpsilon(R){const q=Math.abs(this._x),L=Math.abs(this._y);if(!(0,Y.s)(q,L,R))return!0;const B=Math.abs(this._z);return!(0,Y.s)(q,B,R)||!(0,Y.s)(L,B,R)}get isNonUniform(){const R=Math.abs(this._x);if(R!==Math.abs(this._y))return!0;return R!==Math.abs(this._z)}floorToRef(R){return R._x=Math.floor(this._x),R._y=Math.floor(this._y),R._z=Math.floor(this._z),R._isDirty=!0,R}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(R){return R._x=this.x-Math.floor(this._x),R._y=this.y-Math.floor(this._y),R._z=this.z-Math.floor(this._z),R._isDirty=!0,R}fract(){return new e(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(R){if("xyz"===(R=R.toLowerCase()))return this;const q=r.o[0].p(this);return this.x=q[R[0]],this.y=q[R[1]],this.z=q[R[2]],this}rotateByQuaternionToRef(R,q){return R.toRotationMatrix(r.Matrix[0]),e.TransformCoordinatesToRef(this,r.Matrix[0],q),q}rotateByQuaternionAroundPointToRef(R,q,L){return this.subtractToRef(q,r.o[0]),r.o[0].rotateByQuaternionToRef(R,r.o[0]),q.addToRef(r.o[0],L),L}cross(R){return e.CrossToRef(this,R,new e)}normalizeFromLength(R){return 0===R||1===R?this:this.scaleInPlace(1/R)}normalizeToNew(){return this.normalizeToRef(new e)}normalizeToRef(R){const q=this.length();return 0===q||1===q?(R._x=this._x,R._y=this._y,R._z=this._z,R._isDirty=!0,R):this.scaleToRef(1/q,R)}clone(){return new e(this._x,this._y,this._z)}p(R){return this.Td(R._x,R._y,R._z)}Td(R,q,L){return this._x=R,this._y=q,this._z=L,this._isDirty=!0,this}set(R,q,L){return this.Td(R,q,L)}Rd(R){return this._x=this._y=this._z=R,this._isDirty=!0,this}static GetClipFactor(R,q,L,B){const N=e.Dot(R,L);return(N-B)/(N-e.Dot(q,L))}static GetAngleBetweenVectors(R,q,L){const B=R.normalizeToRef(r.o[1]),N=q.normalizeToRef(r.o[2]);let h=e.Dot(B,N);h=(0,Y.b)(h,-1,1);const Z=Math.acos(h),z=r.o[3];return e.CrossToRef(B,N,z),e.Dot(z,L)>0?isNaN(Z)?0:Z:isNaN(Z)?-Math.PI:-Math.acos(h)}static GetAngleBetweenVectorsOnPlane(R,q,L){r.o[0].p(R);const B=r.o[0];r.o[1].p(q);const N=r.o[1];r.o[2].p(L);const h=r.o[2],Z=r.o[3],z=r.o[4];B.normalize(),N.normalize(),h.normalize(),e.CrossToRef(h,B,Z),e.CrossToRef(Z,h,z);const F=Math.atan2(e.Dot(N,Z),e.Dot(N,z));return(0,Y.k)(F)}static PitchYawRollToMoveBetweenPointsToRef(R,q,L){const B=p.o[0];return q.subtractToRef(R,B),L._y=Math.atan2(B.x,B.z)||0,L._x=Math.atan2(Math.sqrt(B.x**2+B.z**2),B.y)||0,L._z=0,L._isDirty=!0,L}static PitchYawRollToMoveBetweenPoints(R,q){const L=e.Zero();return e.PitchYawRollToMoveBetweenPointsToRef(R,q,L)}static SlerpToRef(R,q,L,N){L=(0,Y.b)(L,0,1);const h=r.o[0],Z=r.o[1];h.p(R);const z=h.length();h.normalizeFromLength(z),Z.p(q);const F=Z.length();Z.normalizeFromLength(F);const C=e.Dot(h,Z);let y,U;if(C<1-B.e){const R=Math.acos(C),q=1/Math.sin(R);y=Math.sin((1-L)*R)*q,U=Math.sin(L*R)*q}else y=1-L,U=L;return h.scaleInPlace(y),Z.scaleInPlace(U),N.p(h).addInPlace(Z),N.scaleInPlace((0,Y.h)(z,F,L)),N}static SmoothToRef(R,q,L,B,N){return e.SlerpToRef(R,q,0===B?1:L/B,N),N}static Ig(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(R[q],R[q+1],R[q+2])}static FromFloatArray(R,q){return e.Ig(R,q)}static FromArrayToRef(R,q,L){return L._x=R[q],L._y=R[q+1],L._z=R[q+2],L._isDirty=!0,L}static FromFloatArrayToRef(R,q,L){return e.FromArrayToRef(R,q,L)}static FromFloatsToRef(R,q,L,B){return B.Td(R,q,L),B}static Zero(){return new e(0,0,0)}static One(){return new e(1,1,1)}static Up(){return new e(0,1,0)}static get UpReadOnly(){return e._UpReadOnly}static get DownReadOnly(){return e._DownReadOnly}static get RightReadOnly(){return e._RightReadOnly}static get LeftReadOnly(){return e._LeftReadOnly}static get LeftHandedForwardReadOnly(){return e._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return e._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return e._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return e._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return e._ZeroReadOnly}static get OneReadOnly(){return e._OneReadOnly}static Down(){return new e(0,-1,0)}static Forward(){return new e(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new e(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new e(1,0,0)}static Left(){return new e(-1,0,0)}static Random(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new e((0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q))}static RandomToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Td((0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q))}static TransformCoordinates(R,q){const L=e.Zero();return e.TransformCoordinatesToRef(R,q,L),L}static TransformCoordinatesToRef(R,q,L){return e.TransformCoordinatesFromFloatsToRef(R._x,R._y,R._z,q,L),L}static TransformCoordinatesFromFloatsToRef(R,q,L,B,N){const h=B.m,Z=R*h[0]+q*h[4]+L*h[8]+h[12],z=R*h[1]+q*h[5]+L*h[9]+h[13],Y=R*h[2]+q*h[6]+L*h[10]+h[14],F=1/(R*h[3]+q*h[7]+L*h[11]+h[15]);return N._x=Z*F,N._y=z*F,N._z=Y*F,N._isDirty=!0,N}static TransformNormal(R,q){const L=e.Zero();return e.TransformNormalToRef(R,q,L),L}static TransformNormalToRef(R,q,L){return this.TransformNormalFromFloatsToRef(R._x,R._y,R._z,q,L),L}static TransformNormalFromFloatsToRef(R,q,L,B,N){const h=B.m;return N._x=R*h[0]+q*h[4]+L*h[8],N._y=R*h[1]+q*h[5]+L*h[9],N._z=R*h[2]+q*h[6]+L*h[10],N._isDirty=!0,N}static CatmullRom(R,q,L,B,N){const h=N*N,Z=N*h,z=.5*(2*q._x+(-R._x+L._x)*N+(2*R._x-5*q._x+4*L._x-B._x)*h+(-R._x+3*q._x-3*L._x+B._x)*Z),Y=.5*(2*q._y+(-R._y+L._y)*N+(2*R._y-5*q._y+4*L._y-B._y)*h+(-R._y+3*q._y-3*L._y+B._y)*Z),F=.5*(2*q._z+(-R._z+L._z)*N+(2*R._z-5*q._z+4*L._z-B._z)*h+(-R._z+3*q._z-3*L._z+B._z)*Z);return new e(z,Y,F)}static Clamp(R,q,L){const B=new e;return e.ClampToRef(R,q,L,B),B}static ClampToRef(R,q,L,B){let N=R._x;N=N>L._x?L._x:N,N=N<q._x?q._x:N;let h=R._y;h=h>L._y?L._y:h,h=h<q._y?q._y:h;let Z=R._z;return Z=Z>L._z?L._z:Z,Z=Z<q._z?q._z:Z,B.Td(N,h,Z),B}static CheckExtends(R,q,L){q.minimizeInPlace(R),L.maximizeInPlace(R)}static Hermite(R,q,L,B,N){const h=N*N,Z=N*h,z=2*Z-3*h+1,Y=-2*Z+3*h,F=Z-2*h+N,C=Z-h,y=R._x*z+L._x*Y+q._x*F+B._x*C,U=R._y*z+L._y*Y+q._y*F+B._y*C,n=R._z*z+L._z*Y+q._z*F+B._z*C;return new e(y,U,n)}static Hermite1stDerivative(R,q,L,B,N){const h=new e;return this.Hermite1stDerivativeToRef(R,q,L,B,N,h),h}static Hermite1stDerivativeToRef(R,q,L,B,N,h){const Z=N*N;return h._x=6*(Z-N)*R._x+(3*Z-4*N+1)*q._x+6*(-Z+N)*L._x+(3*Z-2*N)*B._x,h._y=6*(Z-N)*R._y+(3*Z-4*N+1)*q._y+6*(-Z+N)*L._y+(3*Z-2*N)*B._y,h._z=6*(Z-N)*R._z+(3*Z-4*N+1)*q._z+6*(-Z+N)*L._z+(3*Z-2*N)*B._z,h._isDirty=!0,h}static Lerp(R,q,L){const B=new e(0,0,0);return e.LerpToRef(R,q,L,B),B}static LerpToRef(R,q,L,B){return B._x=R._x+(q._x-R._x)*L,B._y=R._y+(q._y-R._y)*L,B._z=R._z+(q._z-R._z)*L,B._isDirty=!0,B}static Dot(R,q){return R._x*q._x+R._y*q._y+R._z*q._z}dot(R){return this._x*R._x+this._y*R._y+this._z*R._z}static Cross(R,q){const L=new e;return e.CrossToRef(R,q,L),L}static CrossToRef(R,q,L){const B=R._y*q._z-R._z*q._y,N=R._z*q._x-R._x*q._z,h=R._x*q._y-R._y*q._x;return L.Td(B,N,h),L}static Normalize(R){const q=e.Zero();return e.NormalizeToRef(R,q),q}static NormalizeToRef(R,q){return R.normalizeToRef(q),q}static Project(R,q,L,B){const N=new e;return e.ProjectToRef(R,q,L,B,N),N}static ProjectToRef(R,q,L,B,N){var h;const Z=B.width,Y=B.height,F=B.x,C=B.y,y=r.Matrix[1],U=null===(h=z.b.LastCreatedEngine)||void 0===h?void 0:h.isNDCHalfZRange,p=U?1:.5,c=U?0:.5;n.FromValuesToRef(Z/2,0,0,0,0,-Y/2,0,0,0,0,p,0,F+Z/2,Y/2+C,c,1,y);const d=r.Matrix[0];return q.multiplyToRef(L,d),d.multiplyToRef(y,d),e.TransformCoordinatesToRef(R,d,N),N}static Reflect(R,q){return this.ReflectToRef(R,q,new e)}static ReflectToRef(R,q,L){const B=p.o[0];return B.p(q).scaleInPlace(2*e.Dot(R,q)),L.p(R).ki(B)}static _UnprojectFromInvertedMatrixToRef(R,q,L){e.TransformCoordinatesToRef(R,q,L);const B=q.m,N=R._x*B[3]+R._y*B[7]+R._z*B[11]+B[15];return(0,Y.s)(N,1)&&L.scaleInPlace(1/N),L}static UnprojectFromTransform(R,q,L,B,N){return this.Unproject(R,q,L,B,N,n.IdentityReadOnly)}static Unproject(R,q,L,B,N,h){const Z=new e;return e.UnprojectToRef(R,q,L,B,N,h,Z),Z}static UnprojectToRef(R,q,L,B,N,h,Z){return e.UnprojectFloatsToRef(R._x,R._y,R._z,q,L,B,N,h,Z),Z}static UnprojectFloatsToRef(R,q,L,B,N,h,Z,Y,F){var C;const y=r.Matrix[0];h.multiplyToRef(Z,y),y.multiplyToRef(Y,y),y.invert();const U=r.o[0];return U.x=R/B*2-1,U.y=-(q/N*2-1),null!==(C=z.b.LastCreatedEngine)&&void 0!==C&&C.isNDCHalfZRange?U.z=L:U.z=2*L-1,e._UnprojectFromInvertedMatrixToRef(U,y,F),F}static Minimize(R,q){const L=new e;return L.p(R),L.minimizeInPlace(q),L}static Maximize(R,q){const L=new e;return L.p(R),L.maximizeInPlace(q),L}static Distance(R,q){return Math.sqrt(e.DistanceSquared(R,q))}static DistanceSquared(R,q){const L=R._x-q._x,B=R._y-q._y,N=R._z-q._z;return L*L+B*B+N*N}static ProjectOnTriangleToRef(R,q,L,N,h){const Z=r.o[0],z=r.o[1],F=r.o[2],C=r.o[3],y=r.o[4];L.subtractToRef(q,Z),N.subtractToRef(q,z),N.subtractToRef(L,F);const U=Z.length(),n=z.length(),p=F.length();if(U<B.e||n<B.e||p<B.e)return h.p(q),e.Distance(R,q);R.subtractToRef(q,y),e.CrossToRef(Z,z,C);const c=C.length();if(c<B.e)return h.p(q),e.Distance(R,q);C.normalizeFromLength(c);let d=y.length();if(d<B.e)return h.p(q),0;y.normalizeFromLength(d);const f=e.Dot(C,y),v=r.o[5],T=r.o[6];v.p(C).scaleInPlace(-d*f),T.p(R).addInPlace(v);const t=r.o[4],D=r.o[5],S=r.o[7],I=r.o[8];t.p(Z).scaleInPlace(1/U),I.p(z).scaleInPlace(1/n),t.addInPlace(I).scaleInPlace(-1),D.p(Z).scaleInPlace(-1/U),I.p(F).scaleInPlace(1/p),D.addInPlace(I).scaleInPlace(-1),S.p(F).scaleInPlace(-1/p),I.p(z).scaleInPlace(-1/n),S.addInPlace(I).scaleInPlace(-1);const K=r.o[9];let m;K.p(T).ki(q),e.CrossToRef(t,K,I),m=e.Dot(I,C);const o=m;K.p(T).ki(L),e.CrossToRef(D,K,I),m=e.Dot(I,C);const l=m;K.p(T).ki(N),e.CrossToRef(S,K,I),m=e.Dot(I,C);const G=m,W=r.o[10];let H,P;o>0&&l<0?(W.p(Z),H=q,P=L):l>0&&G<0?(W.p(F),H=L,P=N):(W.p(z).scaleInPlace(-1),H=N,P=q);const O=r.o[9],E=r.o[4];H.subtractToRef(T,I),P.subtractToRef(T,O),e.CrossToRef(I,O,E);if(!(e.Dot(E,C)<0))return h.p(T),Math.abs(d*f);const a=r.o[5];e.CrossToRef(W,E,a),a.normalize();const g=r.o[9];g.p(H).ki(T);const Q=g.length();if(Q<B.e)return h.p(H),e.Distance(R,H);g.normalizeFromLength(Q);const i=e.Dot(a,g),k=r.o[7];k.p(T).addInPlace(a.scaleInPlace(Q*i)),I.p(k).ki(H),d=W.length(),W.normalizeFromLength(d);let V=e.Dot(I,W)/Math.max(d,B.e);return V=(0,Y.b)(V,0,1),k.p(H).addInPlace(W.scaleInPlace(V*d)),h.p(k),e.Distance(R,k)}static Center(R,q){return e.CenterToRef(R,q,e.Zero())}static CenterToRef(R,q,L){return L.Td((R._x+q._x)/2,(R._y+q._y)/2,(R._z+q._z)/2)}static RotationFromAxis(R,q,L){const B=new e;return e.RotationFromAxisToRef(R,q,L,B),B}static RotationFromAxisToRef(R,q,L,B){const N=r.Quaternion[0];return U.RotationQuaternionFromAxisToRef(R,q,L,N),N.toEulerAnglesToRef(B),B}}e._UpReadOnly=e.Up(),e._DownReadOnly=e.Down(),e._LeftHandedForwardReadOnly=e.Forward(!1),e._RightHandedForwardReadOnly=e.Forward(!0),e._LeftHandedBackwardReadOnly=e.Backward(!1),e._RightHandedBackwardReadOnly=e.Backward(!0),e._RightReadOnly=e.Right(),e._LeftReadOnly=e.Left(),e._ZeroReadOnly=e.Zero(),e._OneReadOnly=e.One(),Object.defineProperties(e.prototype,{dimension:{value:[3]},rank:{value:1}});class y{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=R,this.y=q,this.z=L,this.w=B}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let R=F(this.x);return R=397*R^F(this.y),R=397*R^F(this.z),R=397*R^F(this.w),R}dj(){return[this.x,this.y,this.z,this.w]}toArray(R,q){return void 0===q&&(q=0),R[q]=this.x,R[q+1]=this.y,R[q+2]=this.z,R[q+3]=this.w,this}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y.FromArrayToRef(R,q,this),this}addInPlace(R){return this.x+=R.x,this.y+=R.y,this.z+=R.z,this.w+=R.w,this}addInPlaceFromFloats(R,q,L,B){return this.x+=R,this.y+=q,this.z+=L,this.w+=B,this}add(R){return new y(this.x+R.x,this.y+R.y,this.z+R.z,this.w+R.w)}addToRef(R,q){return q.x=this.x+R.x,q.y=this.y+R.y,q.z=this.z+R.z,q.w=this.w+R.w,q}ki(R){return this.x-=R.x,this.y-=R.y,this.z-=R.z,this.w-=R.w,this}Bc(R){return new y(this.x-R.x,this.y-R.y,this.z-R.z,this.w-R.w)}subtractToRef(R,q){return q.x=this.x-R.x,q.y=this.y-R.y,q.z=this.z-R.z,q.w=this.w-R.w,q}subtractFromFloats(R,q,L,B){return new y(this.x-R,this.y-q,this.z-L,this.w-B)}subtractFromFloatsToRef(R,q,L,B,N){return N.x=this.x-R,N.y=this.y-q,N.z=this.z-L,N.w=this.w-B,N}negate(){return new y(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(R){return R.x=-this.x,R.y=-this.y,R.z=-this.z,R.w=-this.w,R}scaleInPlace(R){return this.x*=R,this.y*=R,this.z*=R,this.w*=R,this}scale(R){return new y(this.x*R,this.y*R,this.z*R,this.w*R)}scaleToRef(R,q){return q.x=this.x*R,q.y=this.y*R,q.z=this.z*R,q.w=this.w*R,q}scaleAndAddToRef(R,q){return q.x+=this.x*R,q.y+=this.y*R,q.z+=this.z*R,q.w+=this.w*R,q}equals(R){return R&&this.x===R.x&&this.y===R.y&&this.z===R.z&&this.w===R.w}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;return R&&(0,Y.s)(this.x,R.x,q)&&(0,Y.s)(this.y,R.y,q)&&(0,Y.s)(this.z,R.z,q)&&(0,Y.s)(this.w,R.w,q)}equalsToFloats(R,q,L,B){return this.x===R&&this.y===q&&this.z===L&&this.w===B}multiplyInPlace(R){return this.x*=R.x,this.y*=R.y,this.z*=R.z,this.w*=R.w,this}multiply(R){return new y(this.x*R.x,this.y*R.y,this.z*R.z,this.w*R.w)}multiplyToRef(R,q){return q.x=this.x*R.x,q.y=this.y*R.y,q.z=this.z*R.z,q.w=this.w*R.w,q}multiplyByFloats(R,q,L,B){return new y(this.x*R,this.y*q,this.z*L,this.w*B)}divide(R){return new y(this.x/R.x,this.y/R.y,this.z/R.z,this.w/R.w)}divideToRef(R,q){return q.x=this.x/R.x,q.y=this.y/R.y,q.z=this.z/R.z,q.w=this.w/R.w,q}divideInPlace(R){return this.divideToRef(R,this)}minimizeInPlace(R){return R.x<this.x&&(this.x=R.x),R.y<this.y&&(this.y=R.y),R.z<this.z&&(this.z=R.z),R.w<this.w&&(this.w=R.w),this}maximizeInPlace(R){return R.x>this.x&&(this.x=R.x),R.y>this.y&&(this.y=R.y),R.z>this.z&&(this.z=R.z),R.w>this.w&&(this.w=R.w),this}minimizeInPlaceFromFloats(R,q,L,B){return this.x=Math.min(R,this.x),this.y=Math.min(q,this.y),this.z=Math.min(L,this.z),this.w=Math.min(B,this.w),this}maximizeInPlaceFromFloats(R,q,L,B){return this.x=Math.max(R,this.x),this.y=Math.max(q,this.y),this.z=Math.max(L,this.z),this.w=Math.max(B,this.w),this}floorToRef(R){return R.x=Math.floor(this.x),R.y=Math.floor(this.y),R.z=Math.floor(this.z),R.w=Math.floor(this.w),R}floor(){return new y(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(R){return R.x=this.x-Math.floor(this.x),R.y=this.y-Math.floor(this.y),R.z=this.z-Math.floor(this.z),R.w=this.w-Math.floor(this.w),R}fract(){return new y(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(R){return 0===R||1===R?this:this.scaleInPlace(1/R)}normalizeToNew(){return this.normalizeToRef(new y)}normalizeToRef(R){const q=this.length();return 0===q||1===q?(R.x=this.x,R.y=this.y,R.z=this.z,R.w=this.w,R):this.scaleToRef(1/q,R)}toVector3(){return new e(this.x,this.y,this.z)}clone(){return new y(this.x,this.y,this.z,this.w)}p(R){return this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w,this}Td(R,q,L,B){return this.x=R,this.y=q,this.z=L,this.w=B,this}set(R,q,L,B){return this.Td(R,q,L,B)}Rd(R){return this.x=this.y=this.z=this.w=R,this}dot(R){return this.x*R.x+this.y*R.y+this.z*R.z+this.w*R.w}static Ig(R,q){return q||(q=0),new y(R[q],R[q+1],R[q+2],R[q+3])}static FromArrayToRef(R,q,L){return L.x=R[q],L.y=R[q+1],L.z=R[q+2],L.w=R[q+3],L}static FromFloatArrayToRef(R,q,L){return y.FromArrayToRef(R,q,L),L}static FromFloatsToRef(R,q,L,B,N){return N.x=R,N.y=q,N.z=L,N.w=B,N}static Zero(){return new y(0,0,0,0)}static One(){return new y(1,1,1,1)}static Random(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new y((0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q))}static RandomToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;return L.x=(0,Y.m)(R,q),L.y=(0,Y.m)(R,q),L.z=(0,Y.m)(R,q),L.w=(0,Y.m)(R,q),L}static Clamp(R,q,L){return y.ClampToRef(R,q,L,new y)}static ClampToRef(R,q,L,B){return B.x=(0,Y.b)(R.x,q.x,L.x),B.y=(0,Y.b)(R.y,q.y,L.y),B.z=(0,Y.b)(R.z,q.z,L.z),B.w=(0,Y.b)(R.w,q.w,L.w),B}static CheckExtends(R,q,L){q.minimizeInPlace(R),L.maximizeInPlace(R)}static get ZeroReadOnly(){return y._ZeroReadOnly}static Normalize(R){return y.NormalizeToRef(R,new y)}static NormalizeToRef(R,q){return R.normalizeToRef(q),q}static Minimize(R,q){const L=new y;return L.p(R),L.minimizeInPlace(q),L}static Maximize(R,q){const L=new y;return L.p(R),L.maximizeInPlace(q),L}static Distance(R,q){return Math.sqrt(y.DistanceSquared(R,q))}static DistanceSquared(R,q){const L=R.x-q.x,B=R.y-q.y,N=R.z-q.z,h=R.w-q.w;return L*L+B*B+N*N+h*h}static Center(R,q){return y.CenterToRef(R,q,new y)}static CenterToRef(R,q,L){return L.x=(R.x+q.x)/2,L.y=(R.y+q.y)/2,L.z=(R.z+q.z)/2,L.w=(R.w+q.w)/2,L}static TransformCoordinates(R,q){return y.TransformCoordinatesToRef(R,q,new y)}static TransformCoordinatesToRef(R,q,L){return y.TransformCoordinatesFromFloatsToRef(R._x,R._y,R._z,q,L),L}static TransformCoordinatesFromFloatsToRef(R,q,L,B,N){const h=B.m,Z=R*h[0]+q*h[4]+L*h[8]+h[12],z=R*h[1]+q*h[5]+L*h[9]+h[13],Y=R*h[2]+q*h[6]+L*h[10]+h[14],F=R*h[3]+q*h[7]+L*h[11]+h[15];return N.x=Z,N.y=z,N.z=Y,N.w=F,N}static TransformNormal(R,q){return y.TransformNormalToRef(R,q,new y)}static TransformNormalToRef(R,q,L){const B=q.m,N=R.x*B[0]+R.y*B[4]+R.z*B[8],h=R.x*B[1]+R.y*B[5]+R.z*B[9],Z=R.x*B[2]+R.y*B[6]+R.z*B[10];return L.x=N,L.y=h,L.z=Z,L.w=R.w,L}static TransformNormalFromFloatsToRef(R,q,L,B,N,h){const Z=N.m;return h.x=R*Z[0]+q*Z[4]+L*Z[8],h.y=R*Z[1]+q*Z[5]+L*Z[9],h.z=R*Z[2]+q*Z[6]+L*Z[10],h.w=B,h}static FromVector3(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new y(R._x,R._y,R._z,q)}static Dot(R,q){return R.x*q.x+R.y*q.y+R.z*q.z+R.w*q.w}}y._ZeroReadOnly=y.Zero(),Object.defineProperties(y.prototype,{dimension:{value:[4]},rank:{value:1}});class U{get x(){return this._x}set x(R){this._x=R,this._isDirty=!0}get y(){return this._y}set y(R){this._y=R,this._isDirty=!0}get z(){return this._z}set z(R){this._z=R,this._isDirty=!0}get w(){return this._w}set w(R){this._w=R,this._isDirty=!0}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=R,this._y=q,this._z=L,this._w=B}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let R=F(this._x);return R=397*R^F(this._y),R=397*R^F(this._z),R=397*R^F(this._w),R}dj(){return[this._x,this._y,this._z,this._w]}toArray(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return R[q]=this._x,R[q+1]=this._y,R[q+2]=this._z,R[q+3]=this._w,this}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return U.FromArrayToRef(R,q,this)}equals(R){return R&&this._x===R._x&&this._y===R._y&&this._z===R._z&&this._w===R._w}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;return R&&(0,Y.s)(this._x,R._x,q)&&(0,Y.s)(this._y,R._y,q)&&(0,Y.s)(this._z,R._z,q)&&(0,Y.s)(this._w,R._w,q)}clone(){return new U(this._x,this._y,this._z,this._w)}p(R){return this._x=R._x,this._y=R._y,this._z=R._z,this._w=R._w,this._isDirty=!0,this}Td(R,q,L,B){return this._x=R,this._y=q,this._z=L,this._w=B,this._isDirty=!0,this}set(R,q,L,B){return this.Td(R,q,L,B)}Rd(R){return this.Td(R,R,R,R)}add(R){return new U(this._x+R._x,this._y+R._y,this._z+R._z,this._w+R._w)}addInPlace(R){return this._x+=R._x,this._y+=R._y,this._z+=R._z,this._w+=R._w,this._isDirty=!0,this}addToRef(R,q){return q._x=this._x+R._x,q._y=this._y+R._y,q._z=this._z+R._z,q._w=this._w+R._w,q._isDirty=!0,q}addInPlaceFromFloats(R,q,L,B){return this._x+=R,this._y+=q,this._z+=L,this._w+=B,this._isDirty=!0,this}subtractToRef(R,q){return q._x=this._x-R._x,q._y=this._y-R._y,q._z=this._z-R._z,q._w=this._w-R._w,q._isDirty=!0,q}subtractFromFloats(R,q,L,B){return this.subtractFromFloatsToRef(R,q,L,B,new U)}subtractFromFloatsToRef(R,q,L,B,N){return N._x=this._x-R,N._y=this._y-q,N._z=this._z-L,N._w=this._w-B,N._isDirty=!0,N}Bc(R){return new U(this._x-R._x,this._y-R._y,this._z-R._z,this._w-R._w)}ki(R){return this._x-=R._x,this._y-=R._y,this._z-=R._z,this._w-=R._w,this._isDirty=!0,this}scale(R){return new U(this._x*R,this._y*R,this._z*R,this._w*R)}scaleToRef(R,q){return q._x=this._x*R,q._y=this._y*R,q._z=this._z*R,q._w=this._w*R,q._isDirty=!0,q}scaleInPlace(R){return this._x*=R,this._y*=R,this._z*=R,this._w*=R,this._isDirty=!0,this}scaleAndAddToRef(R,q){return q._x+=this._x*R,q._y+=this._y*R,q._z+=this._z*R,q._w+=this._w*R,q._isDirty=!0,q}multiply(R){const q=new U(0,0,0,1);return this.multiplyToRef(R,q),q}multiplyToRef(R,q){const L=this._x*R._w+this._y*R._z-this._z*R._y+this._w*R._x,B=-this._x*R._z+this._y*R._w+this._z*R._x+this._w*R._y,N=this._x*R._y-this._y*R._x+this._z*R._w+this._w*R._z,h=-this._x*R._x-this._y*R._y-this._z*R._z+this._w*R._w;return q.Td(L,B,N,h),q}multiplyInPlace(R){return this.multiplyToRef(R,this)}multiplyByFloats(R,q,L,B){return this._x*=R,this._y*=q,this._z*=L,this._w*=B,this._isDirty=!0,this}divide(R){throw new ReferenceError("Can not divide a quaternion")}divideToRef(R,q){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(R){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new U)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(R){return R._x=-this._x,R._y=-this._y,R._z=-this._z,R._w=-this._w,R._isDirty=!0,R}equalsToFloats(R,q,L,B){return this._x===R&&this._y===q&&this._z===L&&this._w===B}floorToRef(R){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(R){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(R){return R.Td(-this._x,-this._y,-this._z,this._w),R}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new U(-this._x,-this._y,-this._z,this._w)}invert(){const R=this.conjugate(),q=this.lengthSquared();return 0==q||1==q||R.scaleInPlace(1/q),R}invertInPlace(){this.conjugateInPlace();const R=this.lengthSquared();return 0==R||1==R||this.scaleInPlace(1/R),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(R){return 0===R||1===R?this:this.scaleInPlace(1/R)}normalizeToNew(){const R=new U(0,0,0,1);return this.normalizeToRef(R),R}normalizeToRef(R){const q=this.length();return 0===q||1===q?R.Td(this._x,this._y,this._z,this._w):this.scaleToRef(1/q,R)}toEulerAngles(){const R=e.Zero();return this.toEulerAnglesToRef(R),R}toEulerAnglesToRef(R){const q=this._z,L=this._x,B=this._y,N=this._w,h=B*q-L*N,Z=.4999999;if(h<-Z)R._y=2*Math.atan2(B,N),R._x=Math.PI/2,R._z=0,R._isDirty=!0;else if(h>Z)R._y=2*Math.atan2(B,N),R._x=-Math.PI/2,R._z=0,R._isDirty=!0;else{const Z=N*N,z=q*q,Y=L*L,F=B*B;R._z=Math.atan2(2*(L*B+q*N),-z-Y+F+Z),R._x=Math.asin(-2*h),R._y=Math.atan2(2*(q*L+B*N),z-Y-F+Z),R._isDirty=!0}return R}toAlphaBetaGammaToRef(R){const q=this._z,L=this._x,B=this._y,N=this._w,h=Math.sqrt(L*L+B*B),Z=Math.sqrt(q*q+N*N),z=2*Math.atan2(h,Z),Y=2*Math.atan2(q,N),F=2*Math.atan2(B,L),C=(Y+F)/2,e=(Y-F)/2;return R.set(e,z,C),R}toRotationMatrix(R){return n.FromQuaternionToRef(this,R),R}fromRotationMatrix(R){return U.FromRotationMatrixToRef(R,this),this}dot(R){return this._x*R._x+this._y*R._y+this._z*R._z+this._w*R._w}static FromRotationMatrix(R){const q=new U;return U.FromRotationMatrixToRef(R,q),q}static FromRotationMatrixToRef(R,q){const L=R.m,B=L[0],N=L[4],h=L[8],Z=L[1],z=L[5],Y=L[9],F=L[2],C=L[6],e=L[10],y=B+z+e;let U;return y>0?(U=.5/Math.sqrt(y+1),q._w=.25/U,q._x=(C-Y)*U,q._y=(h-F)*U,q._z=(Z-N)*U,q._isDirty=!0):B>z&&B>e?(U=2*Math.sqrt(1+B-z-e),q._w=(C-Y)/U,q._x=.25*U,q._y=(N+Z)/U,q._z=(h+F)/U,q._isDirty=!0):z>e?(U=2*Math.sqrt(1+z-B-e),q._w=(h-F)/U,q._x=(N+Z)/U,q._y=.25*U,q._z=(Y+C)/U,q._isDirty=!0):(U=2*Math.sqrt(1+e-B-z),q._w=(Z-N)/U,q._x=(h+F)/U,q._y=(Y+C)/U,q._z=.25*U,q._isDirty=!0),q}static Dot(R,q){return R._x*q._x+R._y*q._y+R._z*q._z+R._w*q._w}static AreClose(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const B=U.Dot(R,q);return 1-B*B<=L}static SmoothToRef(R,q,L,B,N){let h=0===B?1:L/B;return h=(0,Y.b)(h,0,1),U.SlerpToRef(R,q,h,N),N}static Zero(){return new U(0,0,0,0)}static Inverse(R){return new U(-R._x,-R._y,-R._z,R._w)}static InverseToRef(R,q){return q.set(-R._x,-R._y,-R._z,R._w),q}static Identity(){return new U(0,0,0,1)}static IsIdentity(R){return R&&0===R._x&&0===R._y&&0===R._z&&1===R._w}static RotationAxis(R,q){return U.RotationAxisToRef(R,q,new U)}static RotationAxisToRef(R,q,L){L._w=Math.cos(q/2);const B=Math.sin(q/2)/R.length();return L._x=R._x*B,L._y=R._y*B,L._z=R._z*B,L._isDirty=!0,L}static Ig(R,q){return q||(q=0),new U(R[q],R[q+1],R[q+2],R[q+3])}static FromArrayToRef(R,q,L){return L._x=R[q],L._y=R[q+1],L._z=R[q+2],L._w=R[q+3],L._isDirty=!0,L}static FromFloatsToRef(R,q,L,B,N){return N.Td(R,q,L,B),N}static FromEulerAngles(R,q,L){const B=new U;return U.RotationYawPitchRollToRef(q,R,L,B),B}static FromEulerAnglesToRef(R,q,L,B){return U.RotationYawPitchRollToRef(q,R,L,B),B}static FromEulerVector(R){const q=new U;return U.RotationYawPitchRollToRef(R._y,R._x,R._z,q),q}static FromEulerVectorToRef(R,q){return U.RotationYawPitchRollToRef(R._y,R._x,R._z,q),q}static FromUnitVectorsToRef(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.e;const h=e.Dot(R,q)+1;return h<N?Math.abs(R.x)>Math.abs(R.z)?L.set(-R.y,R.x,0,0):L.set(0,-R.z,R.y,0):(e.CrossToRef(R,q,p.o[0]),L.set(p.o[0].x,p.o[0].y,p.o[0].z,h)),L.normalize()}static RotationYawPitchRoll(R,q,L){const B=new U;return U.RotationYawPitchRollToRef(R,q,L,B),B}static RotationYawPitchRollToRef(R,q,L,B){const N=.5*L,h=.5*q,Z=.5*R,z=Math.sin(N),Y=Math.cos(N),F=Math.sin(h),C=Math.cos(h),e=Math.sin(Z),y=Math.cos(Z);return B._x=y*F*Y+e*C*z,B._y=e*C*Y-y*F*z,B._z=y*C*z-e*F*Y,B._w=y*C*Y+e*F*z,B._isDirty=!0,B}static RotationAlphaBetaGamma(R,q,L){const B=new U;return U.RotationAlphaBetaGammaToRef(R,q,L,B),B}static RotationAlphaBetaGammaToRef(R,q,L,B){const N=.5*(L+R),h=.5*(L-R),Z=.5*q;return B._x=Math.cos(h)*Math.sin(Z),B._y=Math.sin(h)*Math.sin(Z),B._z=Math.sin(N)*Math.cos(Z),B._w=Math.cos(N)*Math.cos(Z),B._isDirty=!0,B}static RotationQuaternionFromAxis(R,q,L){const B=new U(0,0,0,0);return U.RotationQuaternionFromAxisToRef(R,q,L,B),B}static RotationQuaternionFromAxisToRef(R,q,L,B){const N=r.Matrix[0];return R=R.normalizeToRef(r.o[0]),q=q.normalizeToRef(r.o[1]),L=L.normalizeToRef(r.o[2]),n.FromXYZAxesToRef(R,q,L,N),U.FromRotationMatrixToRef(N,B),B}static FromLookDirectionLH(R,q){const L=new U;return U.FromLookDirectionLHToRef(R,q,L),L}static FromLookDirectionLHToRef(R,q,L){const B=r.Matrix[0];return n.LookDirectionLHToRef(R,q,B),U.FromRotationMatrixToRef(B,L),L}static FromLookDirectionRH(R,q){const L=new U;return U.FromLookDirectionRHToRef(R,q,L),L}static FromLookDirectionRHToRef(R,q,L){const B=r.Matrix[0];return n.LookDirectionRHToRef(R,q,B),U.FromRotationMatrixToRef(B,L)}static Slerp(R,q,L){const B=U.Identity();return U.SlerpToRef(R,q,L,B),B}static SlerpToRef(R,q,L,B){let N,h,Z=R._x*q._x+R._y*q._y+R._z*q._z+R._w*q._w,z=!1;if(Z<0&&(z=!0,Z=-Z),Z>.999999)h=1-L,N=z?-L:L;else{const R=Math.acos(Z),q=1/Math.sin(R);h=Math.sin((1-L)*R)*q,N=z?-Math.sin(L*R)*q:Math.sin(L*R)*q}return B._x=h*R._x+N*q._x,B._y=h*R._y+N*q._y,B._z=h*R._z+N*q._z,B._w=h*R._w+N*q._w,B._isDirty=!0,B}static Hermite(R,q,L,B,N){const h=N*N,Z=N*h,z=2*Z-3*h+1,Y=-2*Z+3*h,F=Z-2*h+N,C=Z-h,e=R._x*z+L._x*Y+q._x*F+B._x*C,y=R._y*z+L._y*Y+q._y*F+B._y*C,n=R._z*z+L._z*Y+q._z*F+B._z*C,r=R._w*z+L._w*Y+q._w*F+B._w*C;return new U(e,y,n,r)}static Hermite1stDerivative(R,q,L,B,N){const h=new U;return this.Hermite1stDerivativeToRef(R,q,L,B,N,h),h}static Hermite1stDerivativeToRef(R,q,L,B,N,h){const Z=N*N;return h._x=6*(Z-N)*R._x+(3*Z-4*N+1)*q._x+6*(-Z+N)*L._x+(3*Z-2*N)*B._x,h._y=6*(Z-N)*R._y+(3*Z-4*N+1)*q._y+6*(-Z+N)*L._y+(3*Z-2*N)*B._y,h._z=6*(Z-N)*R._z+(3*Z-4*N+1)*q._z+6*(-Z+N)*L._z+(3*Z-2*N)*B._z,h._w=6*(Z-N)*R._w+(3*Z-4*N+1)*q._w+6*(-Z+N)*L._w+(3*Z-2*N)*B._w,h._isDirty=!0,h}static Normalize(R){const q=U.Zero();return U.NormalizeToRef(R,q),q}static NormalizeToRef(R,q){return R.normalizeToRef(q),q}static Clamp(R,q,L){const B=new U;return U.ClampToRef(R,q,L,B),B}static ClampToRef(R,q,L,B){return B.Td((0,Y.b)(R.x,q.x,L.x),(0,Y.b)(R.y,q.y,L.y),(0,Y.b)(R.z,q.z,L.z),(0,Y.b)(R.w,q.w,L.w))}static Random(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new U((0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q))}static RandomToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Td((0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q),(0,Y.m)(R,q))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(R,q){return Math.sqrt(U.DistanceSquared(R,q))}static DistanceSquared(R,q){const L=R.x-q.x,B=R.y-q.y,N=R.z-q.z,h=R.w-q.w;return L*L+B*B+N*N+h*h}static Center(R,q){return U.CenterToRef(R,q,U.Zero())}static CenterToRef(R,q,L){return L.Td((R.x+q.x)/2,(R.y+q.y)/2,(R.z+q.z)/2,(R.w+q.w)/2)}}Object.defineProperties(U.prototype,{dimension:{value:[4]},rank:{value:1}});class n{static get Use64Bits(){return Z.d.MatrixUse64Bits}get m(){return this.Kj}markAsUpdated(){this.updateFlag=n._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=R,this._isIdentity3x2=R||L,this._isIdentityDirty=!this._isIdentity&&q,this._isIdentity3x2Dirty=!this._isIdentity3x2&&B}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Z.d.MatrixTrackPrecisionChange&&Z.d.MatrixTrackedMatrices.push(this),this.Kj=new Z.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const R=this.Kj;this._isIdentity=1===R[0]&&0===R[1]&&0===R[2]&&0===R[3]&&0===R[4]&&1===R[5]&&0===R[6]&&0===R[7]&&0===R[8]&&0===R[9]&&1===R[10]&&0===R[11]&&0===R[12]&&0===R[13]&&0===R[14]&&1===R[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Kj[0]||1!==this.Kj[5]||1!==this.Kj[15]||0!==this.Kj[1]||0!==this.Kj[2]||0!==this.Kj[3]||0!==this.Kj[4]||0!==this.Kj[6]||0!==this.Kj[7]||0!==this.Kj[8]||0!==this.Kj[9]||0!==this.Kj[10]||0!==this.Kj[11]||0!==this.Kj[12]||0!==this.Kj[13]||0!==this.Kj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const R=this.Kj,q=R[0],L=R[1],B=R[2],N=R[3],h=R[4],Z=R[5],z=R[6],Y=R[7],F=R[8],C=R[9],e=R[10],y=R[11],U=R[12],n=R[13],r=R[14],p=R[15],c=e*p-r*y,d=C*p-n*y,f=C*r-n*e,v=F*p-U*y,T=F*r-e*U,t=F*n-U*C;return q*+(Z*c-z*d+Y*f)+L*-(h*c-z*v+Y*T)+B*+(h*d-Z*v+Y*t)+N*-(h*f-Z*T+z*t)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!R)return this.Kj;const L=this.Kj;for(let B=0;B<16;B++)R[q+B]=L[B];return this}dj(){return this.Kj}Lc(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return n.FromArrayToRef(R,q,this)}Td(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];return n.FromArrayToRef(q,0,this)}set(){const R=this.Kj;for(let q=0;q<16;q++)R[q]=q<0||arguments.length<=q?void 0:arguments[q];return this.markAsUpdated(),this}Rd(R){const q=this.Kj;for(let L=0;L<16;L++)q[L]=R;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return n.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(R){const q=new n;return this.addToRef(R,q),q}addToRef(R,q){const L=this.Kj,B=q.Kj,N=R.m;for(let h=0;h<16;h++)B[h]=L[h]+N[h];return q.markAsUpdated(),q}addToSelf(R){const q=this.Kj,L=R.m;return q[0]+=L[0],q[1]+=L[1],q[2]+=L[2],q[3]+=L[3],q[4]+=L[4],q[5]+=L[5],q[6]+=L[6],q[7]+=L[7],q[8]+=L[8],q[9]+=L[9],q[10]+=L[10],q[11]+=L[11],q[12]+=L[12],q[13]+=L[13],q[14]+=L[14],q[15]+=L[15],this.markAsUpdated(),this}addInPlace(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]+=L[B];return this.markAsUpdated(),this}addInPlaceFromFloats(){const R=this.Kj;for(let q=0;q<16;q++)R[q]+=q<0||arguments.length<=q?void 0:arguments[q];return this.markAsUpdated(),this}Bc(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]-=L[B];return this.markAsUpdated(),this}subtractToRef(R,q){const L=this.Kj,B=R.m,N=q.Kj;for(let h=0;h<16;h++)N[h]=L[h]-B[h];return q.markAsUpdated(),q}ki(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]-=L[B];return this.markAsUpdated(),this}subtractFromFloats(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];return this.subtractFromFloatsToRef(...q,new n)}subtractFromFloatsToRef(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];const B=q.pop(),N=this.Kj,h=B.Kj,Z=q;for(let z=0;z<16;z++)h[z]=N[z]-Z[z];return B.markAsUpdated(),B}invertToRef(R){if(!0===this._isIdentity)return n.IdentityToRef(R),R;const q=this.Kj,L=q[0],B=q[1],N=q[2],h=q[3],Z=q[4],z=q[5],Y=q[6],F=q[7],C=q[8],e=q[9],y=q[10],U=q[11],r=q[12],p=q[13],c=q[14],d=q[15],f=y*d-c*U,v=e*d-p*U,T=e*c-p*y,t=C*d-r*U,D=C*c-y*r,S=C*p-r*e,I=+(z*f-Y*v+F*T),K=-(Z*f-Y*t+F*D),m=+(Z*v-z*t+F*S),o=-(Z*T-z*D+Y*S),l=L*I+B*K+N*m+h*o;if(0===l)return R.p(this),R;const G=1/l,W=Y*d-c*F,H=z*d-p*F,P=z*c-p*Y,O=Z*d-r*F,E=Z*c-r*Y,a=Z*p-r*z,g=Y*U-y*F,Q=z*U-e*F,i=z*y-e*Y,k=Z*U-C*F,V=Z*y-C*Y,x=Z*e-C*z,w=-(B*f-N*v+h*T),j=+(L*f-N*t+h*D),J=-(L*v-B*t+h*S),s=+(L*T-B*D+N*S),A=+(B*W-N*H+h*P),M=-(L*W-N*O+h*E),b=+(L*H-B*O+h*a),X=-(L*P-B*E+N*a),u=-(B*g-N*Q+h*i),RR=+(L*g-N*k+h*V),qR=-(L*Q-B*k+h*x),LR=+(L*i-B*V+N*x);return n.FromValuesToRef(I*G,w*G,A*G,u*G,K*G,j*G,M*G,RR*G,m*G,J*G,b*G,qR*G,o*G,s*G,X*G,LR*G,R),R}addAtIndex(R,q){return this.Kj[R]+=q,this.markAsUpdated(),this}multiplyAtIndex(R,q){return this.Kj[R]*=q,this.markAsUpdated(),this}setTranslationFromFloats(R,q,L){return this.Kj[12]=R,this.Kj[13]=q,this.Kj[14]=L,this.markAsUpdated(),this}addTranslationFromFloats(R,q,L){return this.Kj[12]+=R,this.Kj[13]+=q,this.Kj[14]+=L,this.markAsUpdated(),this}setTranslation(R){return this.setTranslationFromFloats(R._x,R._y,R._z)}getTranslation(){return new e(this.Kj[12],this.Kj[13],this.Kj[14])}getTranslationToRef(R){return R.x=this.Kj[12],R.y=this.Kj[13],R.z=this.Kj[14],R}removeRotationAndScaling(){const R=this.m;return n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,R[12],R[13],R[14],R[15],this),this._updateIdentityStatus(0===R[12]&&0===R[13]&&0===R[14]&&1===R[15]),this}p(R){R.copyToArray(this.Kj);const q=R;return this.updateFlag=q.updateFlag,this._updateIdentityStatus(q._isIdentity,q._isIdentityDirty,q._isIdentity3x2,q._isIdentity3x2Dirty),this}copyToArray(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.Kj;return R[q]=L[0],R[q+1]=L[1],R[q+2]=L[2],R[q+3]=L[3],R[q+4]=L[4],R[q+5]=L[5],R[q+6]=L[6],R[q+7]=L[7],R[q+8]=L[8],R[q+9]=L[9],R[q+10]=L[10],R[q+11]=L[11],R[q+12]=L[12],R[q+13]=L[13],R[q+14]=L[14],R[q+15]=L[15],this}multiply(R){const q=new n;return this.multiplyToRef(R,q),q}multiplyInPlace(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]*=L[B];return this.markAsUpdated(),this}multiplyByFloats(){const R=this.Kj;for(let q=0;q<16;q++)R[q]*=q<0||arguments.length<=q?void 0:arguments[q];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];const B=q.pop(),N=this.Kj,h=B.Kj,Z=q;for(let z=0;z<16;z++)h[z]=N[z]*Z[z];return B.markAsUpdated(),B}multiplyToRef(R,q){return this._isIdentity?(q.p(R),q):R._isIdentity?(q.p(this),q):(this.multiplyToArray(R,q.Kj,0),q.markAsUpdated(),q)}multiplyToArray(R,q,L){const B=this.Kj,N=R.m,h=B[0],Z=B[1],z=B[2],Y=B[3],F=B[4],C=B[5],e=B[6],y=B[7],U=B[8],n=B[9],r=B[10],p=B[11],c=B[12],d=B[13],f=B[14],v=B[15],T=N[0],t=N[1],D=N[2],S=N[3],I=N[4],K=N[5],m=N[6],o=N[7],l=N[8],G=N[9],W=N[10],H=N[11],P=N[12],O=N[13],E=N[14],a=N[15];return q[L]=h*T+Z*I+z*l+Y*P,q[L+1]=h*t+Z*K+z*G+Y*O,q[L+2]=h*D+Z*m+z*W+Y*E,q[L+3]=h*S+Z*o+z*H+Y*a,q[L+4]=F*T+C*I+e*l+y*P,q[L+5]=F*t+C*K+e*G+y*O,q[L+6]=F*D+C*m+e*W+y*E,q[L+7]=F*S+C*o+e*H+y*a,q[L+8]=U*T+n*I+r*l+p*P,q[L+9]=U*t+n*K+r*G+p*O,q[L+10]=U*D+n*m+r*W+p*E,q[L+11]=U*S+n*o+r*H+p*a,q[L+12]=c*T+d*I+f*l+v*P,q[L+13]=c*t+d*K+f*G+v*O,q[L+14]=c*D+d*m+f*W+v*E,q[L+15]=c*S+d*o+f*H+v*a,this}divide(R){return this.divideToRef(R,new n)}divideToRef(R,q){const L=this.Kj,B=R.m,N=q.Kj;for(let h=0;h<16;h++)N[h]=L[h]/B[h];return q.markAsUpdated(),q}divideInPlace(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]/=L[B];return this.markAsUpdated(),this}minimizeInPlace(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]=Math.min(q[B],L[B]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const R=this.Kj;for(let q=0;q<16;q++)R[q]=Math.min(R[q],q<0||arguments.length<=q?void 0:arguments[q]);return this.markAsUpdated(),this}maximizeInPlace(R){const q=this.Kj,L=R.m;for(let B=0;B<16;B++)q[B]=Math.min(q[B],L[B]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const R=this.Kj;for(let q=0;q<16;q++)R[q]=Math.min(R[q],q<0||arguments.length<=q?void 0:arguments[q]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new n)}negateInPlace(){const R=this.Kj;for(let q=0;q<16;q++)R[q]=-R[q];return this.markAsUpdated(),this}negateToRef(R){const q=this.Kj,L=R.Kj;for(let B=0;B<16;B++)L[B]=-q[B];return R.markAsUpdated(),R}equals(R){const q=R;if(!q)return!1;if((this._isIdentity||q._isIdentity)&&!this._isIdentityDirty&&!q._isIdentityDirty)return this._isIdentity&&q._isIdentity;const L=this.m,B=q.m;return L[0]===B[0]&&L[1]===B[1]&&L[2]===B[2]&&L[3]===B[3]&&L[4]===B[4]&&L[5]===B[5]&&L[6]===B[6]&&L[7]===B[7]&&L[8]===B[8]&&L[9]===B[9]&&L[10]===B[10]&&L[11]===B[11]&&L[12]===B[12]&&L[13]===B[13]&&L[14]===B[14]&&L[15]===B[15]}equalsWithEpsilon(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.Kj,B=R.m;for(let N=0;N<16;N++)if(!(0,Y.s)(L[N],B[N],q))return!1;return!0}equalsToFloats(){const R=this.Kj;for(let q=0;q<16;q++)if(R[q]!=(q<0||arguments.length<=q?void 0:arguments[q]))return!1;return!0}floor(){return this.floorToRef(new n)}floorToRef(R){const q=this.Kj,L=R.Kj;for(let B=0;B<16;B++)L[B]=Math.floor(q[B]);return R.markAsUpdated(),R}fract(){return this.fractToRef(new n)}fractToRef(R){const q=this.Kj,L=R.Kj;for(let B=0;B<16;B++)L[B]=q[B]-Math.floor(q[B]);return R.markAsUpdated(),R}clone(){const R=new n;return R.p(this),R}getClassName(){return"Matrix"}getHashCode(){let R=F(this.Kj[0]);for(let q=1;q<16;q++)R=397*R^F(this.Kj[q]);return R}decomposeToTransformNode(R){return R.rotationQuaternion=R.rotationQuaternion||new U,this.decompose(R.Ud,R.rotationQuaternion,R.position)}decompose(R,q,L,B){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return L&&L.Rd(0),R&&R.Rd(1),q&&q.Td(0,0,0,1),!0;const h=this.Kj;if(L&&L.Td(h[12],h[13],h[14]),(R=R||r.o[0]).x=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),R.y=Math.sqrt(h[4]*h[4]+h[5]*h[5]+h[6]*h[6]),R.z=Math.sqrt(h[8]*h[8]+h[9]*h[9]+h[10]*h[10]),B){const q=(N?B.absoluteScaling.x:B.Ud.x)<0?-1:1,L=(N?B.absoluteScaling.y:B.Ud.y)<0?-1:1,h=(N?B.absoluteScaling.z:B.Ud.z)<0?-1:1;R.x*=q,R.y*=L,R.z*=h}else this.determinant()<=0&&(R.y*=-1);if(0===R._x||0===R._y||0===R._z)return q&&q.Td(0,0,0,1),!1;if(q){const L=1/R._x,B=1/R._y,N=1/R._z;n.FromValuesToRef(h[0]*L,h[1]*L,h[2]*L,0,h[4]*B,h[5]*B,h[6]*B,0,h[8]*N,h[9]*N,h[10]*N,0,0,0,0,1,r.Matrix[0]),U.FromRotationMatrixToRef(r.Matrix[0],q)}return!0}getRow(R){if(R<0||R>3)return null;const q=4*R;return new y(this.Kj[q+0],this.Kj[q+1],this.Kj[q+2],this.Kj[q+3])}getRowToRef(R,q){if(R>=0&&R<=3){const L=4*R;q.x=this.Kj[L+0],q.y=this.Kj[L+1],q.z=this.Kj[L+2],q.w=this.Kj[L+3]}return q}setRow(R,q){return this.setRowFromFloats(R,q.x,q.y,q.z,q.w)}transpose(){const R=new n;return n.TransposeToRef(this,R),R}transposeToRef(R){return n.TransposeToRef(this,R),R}setRowFromFloats(R,q,L,B,N){if(R<0||R>3)return this;const h=4*R;return this.Kj[h+0]=q,this.Kj[h+1]=L,this.Kj[h+2]=B,this.Kj[h+3]=N,this.markAsUpdated(),this}scale(R){const q=new n;return this.scaleToRef(R,q),q}scaleToRef(R,q){for(let L=0;L<16;L++)q.Kj[L]=this.Kj[L]*R;return q.markAsUpdated(),q}scaleAndAddToRef(R,q){for(let L=0;L<16;L++)q.Kj[L]+=this.Kj[L]*R;return q.markAsUpdated(),q}scaleInPlace(R){const q=this.Kj;for(let L=0;L<16;L++)q[L]*=R;return this.markAsUpdated(),this}toNormalMatrix(R){const q=r.Matrix[0];this.invertToRef(q),q.transposeToRef(R);const L=R.Kj;return n.FromValuesToRef(L[0],L[1],L[2],0,L[4],L[5],L[6],0,L[8],L[9],L[10],0,0,0,0,1,R),R}getRotationMatrix(){const R=new n;return this.getRotationMatrixToRef(R),R}getRotationMatrixToRef(R){const q=r.o[0];if(!this.decompose(q))return n.IdentityToRef(R),R;const L=this.Kj,B=1/q._x,N=1/q._y,h=1/q._z;return n.FromValuesToRef(L[0]*B,L[1]*B,L[2]*B,0,L[4]*N,L[5]*N,L[6]*N,0,L[8]*h,L[9]*h,L[10]*h,0,0,0,0,1,R),R}toggleModelMatrixHandInPlace(){const R=this.Kj;return R[2]*=-1,R[6]*=-1,R[8]*=-1,R[9]*=-1,R[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const R=this.Kj;return R[8]*=-1,R[9]*=-1,R[10]*=-1,R[11]*=-1,this.markAsUpdated(),this}static Ig(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=new n;return n.FromArrayToRef(R,q,L),L}static FromArrayToRef(R,q,L){for(let B=0;B<16;B++)L.Kj[B]=R[B+q];return L.markAsUpdated(),L}static FromFloat32ArrayToRefScaled(R,q,L,B){return B.Kj[0]=R[0+q]*L,B.Kj[1]=R[1+q]*L,B.Kj[2]=R[2+q]*L,B.Kj[3]=R[3+q]*L,B.Kj[4]=R[4+q]*L,B.Kj[5]=R[5+q]*L,B.Kj[6]=R[6+q]*L,B.Kj[7]=R[7+q]*L,B.Kj[8]=R[8+q]*L,B.Kj[9]=R[9+q]*L,B.Kj[10]=R[10+q]*L,B.Kj[11]=R[11+q]*L,B.Kj[12]=R[12+q]*L,B.Kj[13]=R[13+q]*L,B.Kj[14]=R[14+q]*L,B.Kj[15]=R[15+q]*L,B.markAsUpdated(),B}static get IdentityReadOnly(){return n._IdentityReadOnly}static FromValuesToRef(R,q,L,B,N,h,Z,z,Y,F,C,e,y,U,n,r,p){const c=p.Kj;c[0]=R,c[1]=q,c[2]=L,c[3]=B,c[4]=N,c[5]=h,c[6]=Z,c[7]=z,c[8]=Y,c[9]=F,c[10]=C,c[11]=e,c[12]=y,c[13]=U,c[14]=n,c[15]=r,p.markAsUpdated()}static FromValues(R,q,L,B,N,h,Z,z,Y,F,C,e,y,U,r,p){const c=new n,d=c.Kj;return d[0]=R,d[1]=q,d[2]=L,d[3]=B,d[4]=N,d[5]=h,d[6]=Z,d[7]=z,d[8]=Y,d[9]=F,d[10]=C,d[11]=e,d[12]=y,d[13]=U,d[14]=r,d[15]=p,c.markAsUpdated(),c}static Compose(R,q,L){const B=new n;return n.ComposeToRef(R,q,L,B),B}static ComposeToRef(R,q,L,B){const N=B.Kj,h=q._x,Z=q._y,z=q._z,Y=q._w,F=h+h,C=Z+Z,e=z+z,y=h*F,U=h*C,n=h*e,r=Z*C,p=Z*e,c=z*e,d=Y*F,f=Y*C,v=Y*e,T=R._x,t=R._y,D=R._z;return N[0]=(1-(r+c))*T,N[1]=(U+v)*T,N[2]=(n-f)*T,N[3]=0,N[4]=(U-v)*t,N[5]=(1-(y+c))*t,N[6]=(p+d)*t,N[7]=0,N[8]=(n+f)*D,N[9]=(p-d)*D,N[10]=(1-(y+r))*D,N[11]=0,N[12]=L._x,N[13]=L._y,N[14]=L._z,N[15]=1,B.markAsUpdated(),B}static Identity(){const R=n.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return R._updateIdentityStatus(!0),R}static IdentityToRef(R){return n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,R),R._updateIdentityStatus(!0),R}static Zero(){const R=n.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return R._updateIdentityStatus(!1),R}static RotationX(R){const q=new n;return n.RotationXToRef(R,q),q}static Invert(R){const q=new n;return R.invertToRef(q),q}static RotationXToRef(R,q){const L=Math.sin(R),B=Math.cos(R);return n.FromValuesToRef(1,0,0,0,0,B,L,0,0,-L,B,0,0,0,0,1,q),q._updateIdentityStatus(1===B&&0===L),q}static RotationY(R){const q=new n;return n.RotationYToRef(R,q),q}static RotationYToRef(R,q){const L=Math.sin(R),B=Math.cos(R);return n.FromValuesToRef(B,0,-L,0,0,1,0,0,L,0,B,0,0,0,0,1,q),q._updateIdentityStatus(1===B&&0===L),q}static RotationZ(R){const q=new n;return n.RotationZToRef(R,q),q}static RotationZToRef(R,q){const L=Math.sin(R),B=Math.cos(R);return n.FromValuesToRef(B,L,0,0,-L,B,0,0,0,0,1,0,0,0,0,1,q),q._updateIdentityStatus(1===B&&0===L),q}static RotationAxis(R,q){const L=new n;return n.RotationAxisToRef(R,q,L),L}static RotationAxisToRef(R,q,L){const B=Math.sin(-q),N=Math.cos(-q),h=1-N;R=R.normalizeToRef(r.o[0]);const Z=L.Kj;return Z[0]=R._x*R._x*h+N,Z[1]=R._x*R._y*h-R._z*B,Z[2]=R._x*R._z*h+R._y*B,Z[3]=0,Z[4]=R._y*R._x*h+R._z*B,Z[5]=R._y*R._y*h+N,Z[6]=R._y*R._z*h-R._x*B,Z[7]=0,Z[8]=R._z*R._x*h-R._y*B,Z[9]=R._z*R._y*h+R._x*B,Z[10]=R._z*R._z*h+N,Z[11]=0,Z[12]=0,Z[13]=0,Z[14]=0,Z[15]=1,L.markAsUpdated(),L}static RotationAlignToRef(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=e.Dot(q,R),Z=L.Kj;if(h<-1+B.e)Z[0]=-1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=N?1:-1,Z[6]=0,Z[7]=0,Z[8]=0,Z[9]=0,Z[10]=N?-1:1,Z[11]=0;else{const L=e.Cross(q,R),B=1/(1+h);Z[0]=L._x*L._x*B+h,Z[1]=L._y*L._x*B-L._z,Z[2]=L._z*L._x*B+L._y,Z[3]=0,Z[4]=L._x*L._y*B+L._z,Z[5]=L._y*L._y*B+h,Z[6]=L._z*L._y*B-L._x,Z[7]=0,Z[8]=L._x*L._z*B-L._y,Z[9]=L._y*L._z*B+L._x,Z[10]=L._z*L._z*B+h,Z[11]=0}return Z[12]=0,Z[13]=0,Z[14]=0,Z[15]=1,L.markAsUpdated(),L}static RotationYawPitchRoll(R,q,L){const B=new n;return n.RotationYawPitchRollToRef(R,q,L,B),B}static RotationYawPitchRollToRef(R,q,L,B){return U.RotationYawPitchRollToRef(R,q,L,r.Quaternion[0]),r.Quaternion[0].toRotationMatrix(B),B}static Scaling(R,q,L){const B=new n;return n.ScalingToRef(R,q,L,B),B}static ScalingToRef(R,q,L,B){return n.FromValuesToRef(R,0,0,0,0,q,0,0,0,0,L,0,0,0,0,1,B),B._updateIdentityStatus(1===R&&1===q&&1===L),B}static Translation(R,q,L){const B=new n;return n.TranslationToRef(R,q,L,B),B}static TranslationToRef(R,q,L,B){return n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,R,q,L,1,B),B._updateIdentityStatus(0===R&&0===q&&0===L),B}static Lerp(R,q,L){const B=new n;return n.LerpToRef(R,q,L,B),B}static LerpToRef(R,q,L,B){const N=B.Kj,h=R.m,Z=q.m;for(let z=0;z<16;z++)N[z]=h[z]*(1-L)+Z[z]*L;return B.markAsUpdated(),B}static DecomposeLerp(R,q,L){const B=new n;return n.DecomposeLerpToRef(R,q,L,B),B}static DecomposeLerpToRef(R,q,L,B){const N=r.o[0],h=r.Quaternion[0],Z=r.o[1];R.decompose(N,h,Z);const z=r.o[2],Y=r.Quaternion[1],F=r.o[3];q.decompose(z,Y,F);const C=r.o[4];e.LerpToRef(N,z,L,C);const y=r.Quaternion[2];U.SlerpToRef(h,Y,L,y);const p=r.o[5];return e.LerpToRef(Z,F,L,p),n.ComposeToRef(C,y,p,B),B}static LookAtLH(R,q,L){const B=new n;return n.LookAtLHToRef(R,q,L,B),B}static LookAtLHToRef(R,q,L,B){const N=r.o[0],h=r.o[1],Z=r.o[2];q.subtractToRef(R,Z),Z.normalize(),e.CrossToRef(L,Z,N);const z=N.lengthSquared();0===z?N.x=1:N.normalizeFromLength(Math.sqrt(z)),e.CrossToRef(Z,N,h),h.normalize();const Y=-e.Dot(N,R),F=-e.Dot(h,R),C=-e.Dot(Z,R);return n.FromValuesToRef(N._x,h._x,Z._x,0,N._y,h._y,Z._y,0,N._z,h._z,Z._z,0,Y,F,C,1,B),B}static LookAtRH(R,q,L){const B=new n;return n.LookAtRHToRef(R,q,L,B),B}static LookAtRHToRef(R,q,L,B){const N=r.o[0],h=r.o[1],Z=r.o[2];R.subtractToRef(q,Z),Z.normalize(),e.CrossToRef(L,Z,N);const z=N.lengthSquared();0===z?N.x=1:N.normalizeFromLength(Math.sqrt(z)),e.CrossToRef(Z,N,h),h.normalize();const Y=-e.Dot(N,R),F=-e.Dot(h,R),C=-e.Dot(Z,R);return n.FromValuesToRef(N._x,h._x,Z._x,0,N._y,h._y,Z._y,0,N._z,h._z,Z._z,0,Y,F,C,1,B),B}static LookDirectionLH(R,q){const L=new n;return n.LookDirectionLHToRef(R,q,L),L}static LookDirectionLHToRef(R,q,L){const B=r.o[0];B.p(R),B.scaleInPlace(-1);const N=r.o[1];return e.CrossToRef(q,B,N),n.FromValuesToRef(N._x,N._y,N._z,0,q._x,q._y,q._z,0,B._x,B._y,B._z,0,0,0,0,1,L),L}static LookDirectionRH(R,q){const L=new n;return n.LookDirectionRHToRef(R,q,L),L}static LookDirectionRHToRef(R,q,L){const B=r.o[2];return e.CrossToRef(q,R,B),n.FromValuesToRef(B._x,B._y,B._z,0,q._x,q._y,q._z,0,R._x,R._y,R._z,0,0,0,0,1,L),L}static OrthoLH(R,q,L,B,N){const h=new n;return n.OrthoLHToRef(R,q,L,B,h,N),h}static OrthoLHToRef(R,q,L,B,N,h){const Z=2/R,z=2/q,Y=2/(B-L),F=-(B+L)/(B-L);return n.FromValuesToRef(Z,0,0,0,0,z,0,0,0,0,Y,0,0,0,F,1,N),h&&N.multiplyToRef(c,N),N._updateIdentityStatus(1===Z&&1===z&&1===Y&&0===F),N}static OrthoOffCenterLH(R,q,L,B,N,h,Z){const z=new n;return n.OrthoOffCenterLHToRef(R,q,L,B,N,h,z,Z),z}static OrthoOffCenterLHToRef(R,q,L,B,N,h,Z,z){const Y=2/(q-R),F=2/(B-L),C=2/(h-N),e=-(h+N)/(h-N),y=(R+q)/(R-q),U=(B+L)/(L-B);return n.FromValuesToRef(Y,0,0,0,0,F,0,0,0,0,C,0,y,U,e,1,Z),z&&Z.multiplyToRef(c,Z),Z.markAsUpdated(),Z}static ObliqueOffCenterLHToRef(R,q,L,B,N,h,Z,z,Y,F,C){const e=-Z*Math.cos(z),y=-Z*Math.sin(z);return n.TranslationToRef(0,0,-Y,r.Matrix[1]),n.FromValuesToRef(1,0,0,0,0,1,0,0,e,y,1,0,0,0,0,1,r.Matrix[0]),r.Matrix[1].multiplyToRef(r.Matrix[0],r.Matrix[0]),n.TranslationToRef(0,0,Y,r.Matrix[1]),r.Matrix[0].multiplyToRef(r.Matrix[1],r.Matrix[0]),n.OrthoOffCenterLHToRef(R,q,L,B,N,h,F,C),r.Matrix[0].multiplyToRef(F,F),F}static OrthoOffCenterRH(R,q,L,B,N,h,Z){const z=new n;return n.OrthoOffCenterRHToRef(R,q,L,B,N,h,z,Z),z}static OrthoOffCenterRHToRef(R,q,L,B,N,h,Z,z){return n.OrthoOffCenterLHToRef(R,q,L,B,N,h,Z,z),Z.Kj[10]*=-1,Z}static ObliqueOffCenterRHToRef(R,q,L,B,N,h,Z,z,Y,F,C){const e=Z*Math.cos(z),y=Z*Math.sin(z);return n.TranslationToRef(0,0,Y,r.Matrix[1]),n.FromValuesToRef(1,0,0,0,0,1,0,0,e,y,1,0,0,0,0,1,r.Matrix[0]),r.Matrix[1].multiplyToRef(r.Matrix[0],r.Matrix[0]),n.TranslationToRef(0,0,-Y,r.Matrix[1]),r.Matrix[0].multiplyToRef(r.Matrix[1],r.Matrix[0]),n.OrthoOffCenterRHToRef(R,q,L,B,N,h,F,C),r.Matrix[0].multiplyToRef(F,F),F}static PerspectiveLH(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const Z=new n,z=2*L/R,Y=2*L/q,F=(B+L)/(B-L),C=-2*B*L/(B-L),e=Math.tan(h);return n.FromValuesToRef(z,0,0,0,0,Y,0,e,0,0,F,1,0,0,C,0,Z),N&&Z.multiplyToRef(c,Z),Z._updateIdentityStatus(!1),Z}static PerspectiveFovLH(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const z=new n;return n.PerspectiveFovLHToRef(R,q,L,B,z,!0,N,h,Z),z}static PerspectiveFovLHToRef(R,q,L,B,N){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const F=L,C=B,e=1/Math.tan(.5*R),y=h?e/q:e,U=h?e:e*q,r=Y&&0===F?-1:0!==C?(C+F)/(C-F):1,p=Y&&0===F?2*C:0!==C?-2*C*F/(C-F):-2*F,d=Math.tan(z);return n.FromValuesToRef(y,0,0,0,0,U,0,d,0,0,r,1,0,0,p,0,N),Z&&N.multiplyToRef(c,N),N._updateIdentityStatus(!1),N}static PerspectiveFovReverseLHToRef(R,q,L,B,N){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const Y=1/Math.tan(.5*R),F=h?Y/q:Y,C=h?Y:Y*q,e=Math.tan(z);return n.FromValuesToRef(F,0,0,0,0,C,0,e,0,0,-L,1,0,0,1,0,N),Z&&N.multiplyToRef(c,N),N._updateIdentityStatus(!1),N}static PerspectiveFovRH(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const z=new n;return n.PerspectiveFovRHToRef(R,q,L,B,z,!0,N,h,Z),z}static PerspectiveFovRHToRef(R,q,L,B,N){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const F=L,C=B,e=1/Math.tan(.5*R),y=h?e/q:e,U=h?e:e*q,r=Y&&0===F?1:0!==C?-(C+F)/(C-F):-1,p=Y&&0===F?2*C:0!==C?-2*C*F/(C-F):-2*F,d=Math.tan(z);return n.FromValuesToRef(y,0,0,0,0,U,0,d,0,0,r,-1,0,0,p,0,N),Z&&N.multiplyToRef(c,N),N._updateIdentityStatus(!1),N}static PerspectiveFovReverseRHToRef(R,q,L,B,N){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const Y=1/Math.tan(.5*R),F=h?Y/q:Y,C=h?Y:Y*q,e=Math.tan(z);return n.FromValuesToRef(F,0,0,0,0,C,0,e,0,0,-L,-1,0,0,-1,0,N),Z&&N.multiplyToRef(c,N),N._updateIdentityStatus(!1),N}static GetFinalMatrix(R,q,L,B,N,h){const Z=R.width,z=R.height,Y=R.x,F=R.y,C=n.FromValues(Z/2,0,0,0,0,-z/2,0,0,0,0,h-N,0,Y+Z/2,z/2+F,N,1),e=new n;return q.multiplyToRef(L,e),e.multiplyToRef(B,e),e.multiplyToRef(C,e)}static GetAsMatrix2x2(R){const q=R.m,L=[q[0],q[1],q[4],q[5]];return Z.d.MatrixUse64Bits?L:new Float32Array(L)}static GetAsMatrix3x3(R){const q=R.m,L=[q[0],q[1],q[2],q[4],q[5],q[6],q[8],q[9],q[10]];return Z.d.MatrixUse64Bits?L:new Float32Array(L)}static Transpose(R){const q=new n;return n.TransposeToRef(R,q),q}static TransposeToRef(R,q){const L=R.m,B=L[0],N=L[4],h=L[8],Z=L[12],z=L[1],Y=L[5],F=L[9],C=L[13],e=L[2],y=L[6],U=L[10],n=L[14],r=L[3],p=L[7],c=L[11],d=L[15],f=q.Kj;return f[0]=B,f[1]=N,f[2]=h,f[3]=Z,f[4]=z,f[5]=Y,f[6]=F,f[7]=C,f[8]=e,f[9]=y,f[10]=U,f[11]=n,f[12]=r,f[13]=p,f[14]=c,f[15]=d,q.markAsUpdated(),q._updateIdentityStatus(R._isIdentity,R._isIdentityDirty),q}static Reflection(R){const q=new n;return n.ReflectionToRef(R,q),q}static ReflectionToRef(R,q){R.normalize();const L=R.k.x,B=R.k.y,N=R.k.z,h=-2*L,Z=-2*B,z=-2*N;return n.FromValuesToRef(h*L+1,Z*L,z*L,0,h*B,Z*B+1,z*B,0,h*N,Z*N,z*N+1,0,h*R.d,Z*R.d,z*R.d,1,q),q}static FromXYZAxesToRef(R,q,L,B){return n.FromValuesToRef(R._x,R._y,R._z,0,q._x,q._y,q._z,0,L._x,L._y,L._z,0,0,0,0,1,B),B}static FromQuaternionToRef(R,q){const L=R._x*R._x,B=R._y*R._y,N=R._z*R._z,h=R._x*R._y,Z=R._z*R._w,z=R._z*R._x,Y=R._y*R._w,F=R._y*R._z,C=R._x*R._w;return q.Kj[0]=1-2*(B+N),q.Kj[1]=2*(h+Z),q.Kj[2]=2*(z-Y),q.Kj[3]=0,q.Kj[4]=2*(h-Z),q.Kj[5]=1-2*(N+L),q.Kj[6]=2*(F+C),q.Kj[7]=0,q.Kj[8]=2*(z+Y),q.Kj[9]=2*(F-C),q.Kj[10]=1-2*(B+L),q.Kj[11]=0,q.Kj[12]=0,q.Kj[13]=0,q.Kj[14]=0,q.Kj[15]=1,q.markAsUpdated(),q}}n._UpdateFlagSeed=0,n._IdentityReadOnly=n.Identity(),Object.defineProperties(n.prototype,{dimension:{value:[4,4]},rank:{value:2}});class r{}r.o=(0,N.g)(11,e.Zero),r.Matrix=(0,N.g)(2,n.Identity),r.Quaternion=(0,N.g)(3,U.Zero);class p{}p.Vector2=(0,N.g)(3,C.Zero),p.o=(0,N.g)(13,e.Zero),p.Vector4=(0,N.g)(3,y.Zero),p.Quaternion=(0,N.g)(3,U.Zero),p.Matrix=(0,N.g)(8,n.Identity),(0,h.f)("BABYLON.Vector2",C),(0,h.f)("BABYLON.Vector3",e),(0,h.f)("BABYLON.Vector4",y),(0,h.f)("BABYLON.Matrix",n);const c=n.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11352:(R,q,L)=>{"use strict";L.d(q,{e:()=>B});class B{constructor(R,q,L,B){this.x=R,this.y=q,this.width=L,this.height=B}toGlobal(R,q){return new B(this.x*R,this.y*q,this.width*R,this.height*q)}toGlobalToRef(R,q,L){return L.x=this.x*R,L.y=this.y*q,L.width=this.width*R,L.height=this.height*q,this}clone(){return new B(this.x,this.y,this.width,this.height)}}},11562:(R,q,L)=>{"use strict";L.d(q,{b:()=>F,d:()=>C});var B=L(11081),N=L(11570);const h=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],Z=[()=>1,R=>R.y,R=>R.z,R=>R.x,R=>R.x*R.y,R=>R.y*R.z,R=>3*R.z*R.z-1,R=>R.x*R.z,R=>R.x*R.x-R.y*R.y],z=(R,q)=>h[R]*Z[R](q),Y=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class F{constructor(){this.preScaled=!1,this.l00=B.m.Zero(),this.l1_1=B.m.Zero(),this.l10=B.m.Zero(),this.l11=B.m.Zero(),this.l2_2=B.m.Zero(),this.l2_1=B.m.Zero(),this.l20=B.m.Zero(),this.l21=B.m.Zero(),this.l22=B.m.Zero()}addLight(R,q,L){N.d.o[0].set(q.r,q.g,q.b);const B=N.d.o[0],h=N.d.o[1];B.scaleToRef(L,h),h.scaleToRef(z(0,R),N.d.o[2]),this.l00.addInPlace(N.d.o[2]),h.scaleToRef(z(1,R),N.d.o[2]),this.l1_1.addInPlace(N.d.o[2]),h.scaleToRef(z(2,R),N.d.o[2]),this.l10.addInPlace(N.d.o[2]),h.scaleToRef(z(3,R),N.d.o[2]),this.l11.addInPlace(N.d.o[2]),h.scaleToRef(z(4,R),N.d.o[2]),this.l2_2.addInPlace(N.d.o[2]),h.scaleToRef(z(5,R),N.d.o[2]),this.l2_1.addInPlace(N.d.o[2]),h.scaleToRef(z(6,R),N.d.o[2]),this.l20.addInPlace(N.d.o[2]),h.scaleToRef(z(7,R),N.d.o[2]),this.l21.addInPlace(N.d.o[2]),h.scaleToRef(z(8,R),N.d.o[2]),this.l22.addInPlace(N.d.o[2])}scaleInPlace(R){this.l00.scaleInPlace(R),this.l1_1.scaleInPlace(R),this.l10.scaleInPlace(R),this.l11.scaleInPlace(R),this.l2_2.scaleInPlace(R),this.l2_1.scaleInPlace(R),this.l20.scaleInPlace(R),this.l21.scaleInPlace(R),this.l22.scaleInPlace(R)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(Y[0]),this.l1_1.scaleInPlace(Y[1]),this.l10.scaleInPlace(Y[2]),this.l11.scaleInPlace(Y[3]),this.l2_2.scaleInPlace(Y[4]),this.l2_1.scaleInPlace(Y[5]),this.l20.scaleInPlace(Y[6]),this.l21.scaleInPlace(Y[7]),this.l22.scaleInPlace(Y[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(h[0]),this.l1_1.scaleInPlace(h[1]),this.l10.scaleInPlace(h[2]),this.l11.scaleInPlace(h[3]),this.l2_2.scaleInPlace(h[4]),this.l2_1.scaleInPlace(h[5]),this.l20.scaleInPlace(h[6]),this.l21.scaleInPlace(h[7]),this.l22.scaleInPlace(h[8])}updateFromArray(R){return B.m.FromArrayToRef(R[0],0,this.l00),B.m.FromArrayToRef(R[1],0,this.l1_1),B.m.FromArrayToRef(R[2],0,this.l10),B.m.FromArrayToRef(R[3],0,this.l11),B.m.FromArrayToRef(R[4],0,this.l2_2),B.m.FromArrayToRef(R[5],0,this.l2_1),B.m.FromArrayToRef(R[6],0,this.l20),B.m.FromArrayToRef(R[7],0,this.l21),B.m.FromArrayToRef(R[8],0,this.l22),this}updateFromFloatsArray(R){return B.m.FromFloatsToRef(R[0],R[1],R[2],this.l00),B.m.FromFloatsToRef(R[3],R[4],R[5],this.l1_1),B.m.FromFloatsToRef(R[6],R[7],R[8],this.l10),B.m.FromFloatsToRef(R[9],R[10],R[11],this.l11),B.m.FromFloatsToRef(R[12],R[13],R[14],this.l2_2),B.m.FromFloatsToRef(R[15],R[16],R[17],this.l2_1),B.m.FromFloatsToRef(R[18],R[19],R[20],this.l20),B.m.FromFloatsToRef(R[21],R[22],R[23],this.l21),B.m.FromFloatsToRef(R[24],R[25],R[26],this.l22),this}static Ig(R){return(new F).updateFromArray(R)}static FromPolynomial(R){const q=new F;return q.l00=R.xx.scale(.376127).add(R.yy.scale(.376127)).add(R.zz.scale(.376126)),q.l1_1=R.y.scale(.977204),q.l10=R.z.scale(.977204),q.l11=R.x.scale(.977204),q.l2_2=R.xy.scale(1.16538),q.l2_1=R.yz.scale(1.16538),q.l20=R.zz.scale(1.34567).Bc(R.xx.scale(.672834)).Bc(R.yy.scale(.672834)),q.l21=R.zx.scale(1.16538),q.l22=R.xx.scale(1.16538).Bc(R.yy.scale(1.16538)),q.l1_1.scaleInPlace(-1),q.l11.scaleInPlace(-1),q.l2_1.scaleInPlace(-1),q.l21.scaleInPlace(-1),q.scaleInPlace(Math.PI),q}}class C{constructor(){this.x=B.m.Zero(),this.y=B.m.Zero(),this.z=B.m.Zero(),this.xx=B.m.Zero(),this.yy=B.m.Zero(),this.zz=B.m.Zero(),this.xy=B.m.Zero(),this.yz=B.m.Zero(),this.zx=B.m.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=F.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(R){N.d.o[0].Td(R.r,R.g,R.b);const q=N.d.o[0];this.xx.addInPlace(q),this.yy.addInPlace(q),this.zz.addInPlace(q)}scaleInPlace(R){this.x.scaleInPlace(R),this.y.scaleInPlace(R),this.z.scaleInPlace(R),this.xx.scaleInPlace(R),this.yy.scaleInPlace(R),this.zz.scaleInPlace(R),this.yz.scaleInPlace(R),this.zx.scaleInPlace(R),this.xy.scaleInPlace(R)}updateFromHarmonics(R){return this._harmonics=R,this.x.p(R.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(R.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(R.l10),this.z.scaleInPlace(1.02333),this.xx.p(R.l00),N.d.o[0].p(R.l20).scaleInPlace(.247708),N.d.o[1].p(R.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).ki(N.d.o[0]).addInPlace(N.d.o[1]),this.yy.p(R.l00),this.yy.scaleInPlace(.886277).ki(N.d.o[0]).ki(N.d.o[1]),this.zz.p(R.l00),N.d.o[0].p(R.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(N.d.o[0]),this.yz.p(R.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(R.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(R.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(R){return(new C).updateFromHarmonics(R)}static Ig(R){const q=new C;return B.m.FromArrayToRef(R[0],0,q.x),B.m.FromArrayToRef(R[1],0,q.y),B.m.FromArrayToRef(R[2],0,q.z),B.m.FromArrayToRef(R[3],0,q.xx),B.m.FromArrayToRef(R[4],0,q.yy),B.m.FromArrayToRef(R[5],0,q.zz),B.m.FromArrayToRef(R[6],0,q.yz),B.m.FromArrayToRef(R[7],0,q.zx),B.m.FromArrayToRef(R[8],0,q.xy),q}}},11390:(R,q,L)=>{"use strict";L.d(q,{d:()=>F});var B=L(11081),N=L(11112),h=L(11329),Z=L(11357),z=L(11292);L(11393);function Y(R){let q=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const L=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],h=[];let Y=[];const F=R.width||R.size||1,C=R.height||R.size||1,e=R.depth||R.size||1,y=R.wrap||!1;let U=void 0===R.topBaseAt?1:R.topBaseAt,n=void 0===R.bottomBaseAt?0:R.bottomBaseAt;U=(U+4)%4,n=(n+4)%4;let r=[2,0,3,1][U],p=[2,0,1,3][n],c=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(y){q=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],c=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let R=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const B=[17,18,19,16],N=[22,23,20,21];for(;r>0;)R.unshift(R.pop()),B.unshift(B.pop()),r--;for(;p>0;)L.unshift(L.pop()),N.unshift(N.pop()),p--;R=R.flat(),L=L.flat(),c=c.concat(R).concat(L),q.push(B[0],B[2],B[3],B[0],B[1],B[2]),q.push(N[0],N[2],N[3],N[0],N[1],N[2])}const d=[F/2,C/2,e/2];Y=c.reduce(((R,q,L)=>R.concat(q*d[L%3])),[]);const f=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,v=R.faceUV||new Array(6),T=R.faceColors,t=[];for(let Z=0;Z<6;Z++)void 0===v[Z]&&(v[Z]=new B.q(0,0,1,1)),T&&void 0===T[Z]&&(T[Z]=new N.g(1,1,1,1));for(let B=0;B<6;B++)if(h.push(v[B].z,z.e?1-v[B].w:v[B].w),h.push(v[B].x,z.e?1-v[B].w:v[B].w),h.push(v[B].x,z.e?1-v[B].y:v[B].y),h.push(v[B].z,z.e?1-v[B].y:v[B].y),T)for(let R=0;R<4;R++)t.push(T[B].r,T[B].g,T[B].b,T[B].a);Z.d._ComputeSides(f,Y,q,L,h,R.frontUVs,R.backUVs);const D=new Z.d;if(D.indices=q,D.xa=Y,D.ya=L,D.Aa=h,T){const R=f===Z.d.DOUBLESIDE?t.concat(t):t;D.za=R}return D}function F(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new h.d(R,L);q.sideOrientation=h.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return Y(q).Ca(B,q.updatable),B}Z.d.CreateBox=Y,h.d.CreateBox=function(R,q){return F(R,{size:q,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11745:(R,q,L)=>{"use strict";L.d(q,{c:()=>z});var B=L(11329),N=L(11357),h=L(11292);function Z(R){const q=[],L=[],B=[],Z=[],z=R.radius||.5,Y=R.tessellation||64,F=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,C=0===R.sideOrientation?0:R.sideOrientation||N.d.DEFAULTSIDE;q.push(0,0,0),Z.push(.5,.5);const e=2*Math.PI*F,y=1===F?e/Y:e/(Y-1);let U=0;for(let N=0;N<Y;N++){const R=Math.cos(U),L=Math.sin(U),B=(R+1)/2,N=(1-L)/2;q.push(z*R,z*L,0),Z.push(B,h.e?1-N:N),U+=y}1===F&&(q.push(q[3],q[4],q[5]),Z.push(Z[2],h.e?1-Z[3]:Z[3]));const n=q.length/3;for(let N=1;N<n-1;N++)L.push(N+1,0,N);N.d.ComputeNormals(q,L,B),N.d._ComputeSides(C,q,L,B,Z,R.frontUVs,R.backUVs);const r=new N.d;return r.indices=L,r.xa=q,r.ya=B,r.Aa=Z,r}function z(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new B.d(R,L);q.sideOrientation=B.d._GetDefaultSideOrientation(q.sideOrientation),N._originalBuilderSideOrientation=q.sideOrientation;return Z(q).Ca(N,q.updatable),N}N.d.CreateDisc=Z,B.d.CreateDisc=function(R,q,L){return z(R,{radius:q,tessellation:L,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11393:(R,q,L)=>{"use strict";L.d(q,{d:()=>p,b:()=>d,g:()=>c});var B=L(11081),N=L(11112),h=L(11329),Z=L(11357),z=L(11136);h.d._GroundMeshParser=(R,q)=>Y.Parse(R,q);class Y extends h.d{constructor(R,q){super(R,q),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=R,this._subdivisionsY=R,this.subdivide(R);const L=this;L.createOrUpdateSubmeshesOctree&&L.createOrUpdateSubmeshesOctree(q)}getHeightAtCoordinates(R,q){const L=this.getWorldMatrix(),N=B.h.Matrix[5];L.invertToRef(N);const h=B.h.o[8];if(B.m.TransformCoordinatesFromFloatsToRef(R,0,q,N,h),R=h.x,q=h.z,R<this._minX||R>=this._maxX||q<=this._minZ||q>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Z=this._getFacetAt(R,q),z=-(Z.x*R+Z.z*q+Z.w)/Z.y;return B.m.TransformCoordinatesFromFloatsToRef(0,z,0,L,h),h.y}getNormalAtCoordinates(R,q){const L=new B.m(0,1,0);return this.getNormalAtCoordinatesToRef(R,q,L),L}getNormalAtCoordinatesToRef(R,q,L){const N=this.getWorldMatrix(),h=B.h.Matrix[5];N.invertToRef(h);const Z=B.h.o[8];if(B.m.TransformCoordinatesFromFloatsToRef(R,0,q,h,Z),R=Z.x,q=Z.z,R<this._minX||R>this._maxX||q<this._minZ||q>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const z=this._getFacetAt(R,q);return B.m.TransformNormalFromFloatsToRef(z.x,z.y,z.z,N,L),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(R,q){const L=Math.floor((R+this._maxX)*this._subdivisionsX/this._width),B=Math.floor(-(q+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),N=this._heightQuads[B*this._subdivisionsX+L];let h;return h=q<N.slope.x*R+N.slope.y?N.facet1:N.facet2,h}_initHeightQuads(){const R=this._subdivisionsX,q=this._subdivisionsY;this._heightQuads=new Array;for(let L=0;L<q;L++)for(let q=0;q<R;q++){const N={slope:B.i.Zero(),facet1:new B.q(0,0,0,0),facet2:new B.q(0,0,0,0)};this._heightQuads[L*R+q]=N}return this}_computeHeightQuads(){const R=this.getVerticesData(z.e.PositionKind);if(!R)return this;const q=B.h.o[3],L=B.h.o[2],N=B.h.o[1],h=B.h.o[0],Z=B.h.o[4],Y=B.h.o[5],F=B.h.o[6],C=B.h.o[7],e=B.h.o[8];let y=0,U=0,n=0,r=0,p=0,c=0,d=0;const f=this._subdivisionsX,v=this._subdivisionsY;for(let z=0;z<v;z++)for(let v=0;v<f;v++){y=3*v,U=z*(f+1)*3,n=(z+1)*(f+1)*3,q.x=R[U+y],q.y=R[U+y+1],q.z=R[U+y+2],L.x=R[U+y+3],L.y=R[U+y+4],L.z=R[U+y+5],N.x=R[n+y],N.y=R[n+y+1],N.z=R[n+y+2],h.x=R[n+y+3],h.y=R[n+y+4],h.z=R[n+y+5],r=(h.z-q.z)/(h.x-q.x),p=q.z-r*q.x,L.subtractToRef(q,Z),N.subtractToRef(q,Y),h.subtractToRef(q,F),B.m.CrossToRef(F,Y,C),B.m.CrossToRef(Z,F,e),C.normalize(),e.normalize(),c=-(C.x*q.x+C.y*q.y+C.z*q.z),d=-(e.x*L.x+e.y*L.y+e.z*L.z);const T=this._heightQuads[z*f+v];T.slope.Td(r,p),T.facet1.Td(C.x,C.y,C.z,c),T.facet2.Td(e.x,e.y,e.z,d)}return this}serialize(R){super.serialize(R),R.subdivisionsX=this._subdivisionsX,R.subdivisionsY=this._subdivisionsY,R.minX=this._minX,R.maxX=this._maxX,R.Ri=this._minZ,R.maxZ=this._maxZ,R.width=this._width,R.height=this._height}static Parse(R,q){const L=new Y(R.name,q);return L._subdivisionsX=R.subdivisionsX||1,L._subdivisionsY=R.subdivisionsY||1,L._minX=R.minX,L._maxX=R.maxX,L._minZ=R.Ri,L._maxZ=R.maxZ,L._width=R.width,L._height=R.height,L}}var F=L(10757),C=L(10797),e=L(11088),y=L(11292);function U(R){const q=[],L=[],N=[],h=[];let z,Y;const F=R.width||R.size||1,C=R.height||R.size||1,e=0|(R.subdivisionsX||R.subdivisions||1),U=0|(R.subdivisionsY||R.subdivisions||1);for(z=0;z<=U;z++)for(Y=0;Y<=e;Y++){const R=new B.m(Y*F/e-F/2,0,(U-z)*C/U-C/2),q=new B.m(0,1,0);L.push(R.x,R.y,R.z),N.push(q.x,q.y,q.z),h.push(Y/e,y.e?z/U:1-z/U)}for(z=0;z<U;z++)for(Y=0;Y<e;Y++)q.push(Y+1+(z+1)*(e+1)),q.push(Y+1+z*(e+1)),q.push(Y+z*(e+1)),q.push(Y+(z+1)*(e+1)),q.push(Y+1+(z+1)*(e+1)),q.push(Y+z*(e+1));const n=new Z.d;return n.indices=q,n.xa=L,n.ya=N,n.Aa=h,n}function n(R){const q=void 0!==R.xmin&&null!==R.xmin?R.xmin:-1,L=void 0!==R.zmin&&null!==R.zmin?R.zmin:-1,N=void 0!==R.xmax&&null!==R.xmax?R.xmax:1,h=void 0!==R.zmax&&null!==R.zmax?R.zmax:1,z=R.subdivisions||{w:1,h:1},Y=R.precision||{w:1,h:1},F=[],C=[],e=[],y=[];let U,n,r,p;z.h=z.h<1?1:z.h,z.w=z.w<1?1:z.w,Y.w=Y.w<1?1:Y.w,Y.h=Y.h<1?1:Y.h;const c=(N-q)/z.w,d=(h-L)/z.h;function f(R,q,L,N){const h=C.length/3,Z=Y.w+1;for(U=0;U<Y.h;U++)for(n=0;n<Y.w;n++){const R=[h+n+U*Z,h+(n+1)+U*Z,h+(n+1)+(U+1)*Z,h+n+(U+1)*Z];F.push(R[1]),F.push(R[2]),F.push(R[3]),F.push(R[0]),F.push(R[1]),F.push(R[3])}const z=B.m.Zero(),r=new B.m(0,1,0);for(U=0;U<=Y.h;U++)for(z.z=U*(N-q)/Y.h+q,n=0;n<=Y.w;n++)z.x=n*(L-R)/Y.w+R,z.y=0,C.push(z.x,z.y,z.z),e.push(r.x,r.y,r.z),y.push(n/Y.w,U/Y.h)}for(r=0;r<z.h;r++)for(p=0;p<z.w;p++)f(q+p*c,L+r*d,q+(p+1)*c,L+(r+1)*d);const v=new Z.d;return v.indices=F,v.xa=C,v.ya=e,v.Aa=y,v}function r(R){const q=[],L=[],h=[],z=[];let Y,F;const C=R.colorFilter||new N.e(.3,.59,.11),y=R.alphaFilter||0;let U=!1;if(R.minHeight>R.maxHeight){U=!0;const q=R.maxHeight;R.maxHeight=R.minHeight,R.minHeight=q}for(Y=0;Y<=R.subdivisions;Y++)for(F=0;F<=R.subdivisions;F++){const q=new B.m(F*R.width/R.subdivisions-R.width/2,0,(R.subdivisions-Y)*R.height/R.subdivisions-R.height/2),N=4*(((q.x+R.width/2)/R.width*(R.bufferWidth-1)|0)+((1-(q.z+R.height/2)/R.height)*(R.bufferHeight-1)|0)*R.bufferWidth);let Z=R.buffer[N]/255,n=R.buffer[N+1]/255,r=R.buffer[N+2]/255;const p=R.buffer[N+3]/255;U&&(Z=1-Z,n=1-n,r=1-r);const c=Z*C.r+n*C.g+r*C.b;q.y=p>=y?R.minHeight+(R.maxHeight-R.minHeight)*c:R.minHeight-e.e,R.heightBuffer&&(R.heightBuffer[Y*(R.subdivisions+1)+F]=q.y),L.push(q.x,q.y,q.z),h.push(0,0,0),z.push(F/R.subdivisions,1-Y/R.subdivisions)}for(Y=0;Y<R.subdivisions;Y++)for(F=0;F<R.subdivisions;F++){const B=F+1+(Y+1)*(R.subdivisions+1),N=F+1+Y*(R.subdivisions+1),h=F+Y*(R.subdivisions+1),Z=F+(Y+1)*(R.subdivisions+1),z=L[3*B+1]>=R.minHeight,C=L[3*N+1]>=R.minHeight,e=L[3*h+1]>=R.minHeight;z&&C&&e&&(q.push(B),q.push(N),q.push(h));L[3*Z+1]>=R.minHeight&&z&&e&&(q.push(Z),q.push(B),q.push(h))}Z.d.ComputeNormals(L,q,h);const n=new Z.d;return n.indices=q,n.xa=L,n.ya=h,n.Aa=z,n}function p(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const L=new Y(R,arguments.length>2?arguments[2]:void 0);L._setReady(!1),L._subdivisionsX=q.subdivisionsX||q.subdivisions||1,L._subdivisionsY=q.subdivisionsY||q.subdivisions||1,L._width=q.width||1,L._height=q.height||1,L._maxX=L._width/2,L._maxZ=L._height/2,L._minX=-L._maxX,L._minZ=-L._maxZ;return U(q).Ca(L,q.updatable),L._setReady(!0),L}function c(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new h.d(R,L);return n(q).Ca(B,q.updatable),B}function d(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=L.width||10,Z=L.height||10,z=L.subdivisions||1,e=L.minHeight||0,y=L.maxHeight||1,U=L.colorFilter||new N.e(.3,.59,.11),n=L.alphaFilter||0,p=L.updatable,c=L.onReady;B=B||C.b.LastCreatedScene;const d=new Y(R,B);let f;d._subdivisionsX=z,d._subdivisionsY=z,d._width=h,d._height=Z,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1),L.passHeightBufferInCallback&&(f=new Float32Array((z+1)*(z+1)));const v=(R,q,L)=>{r({width:h,height:Z,subdivisions:z,minHeight:e,maxHeight:y,colorFilter:U,buffer:R,bufferWidth:q,bufferHeight:L,alphaFilter:n,heightBuffer:f}).Ca(d,p),c&&c(d,f),d._setReady(!0)};if("string"===typeof q){const R=R=>{var q;const L=R.width,N=R.height;if(B.u)return;const h=null===(q=B)||void 0===q?void 0:q.getEngine().resizeImageBitmap(R,L,N);v(h,L,N)};F.f.LoadImage(q,R,L.onError?L.onError:()=>{},B.offlineProvider)}else v(q.data,q.width,q.height);return d}Z.d.CreateGround=U,Z.d.CreateTiledGround=n,Z.d.CreateGroundFromHeightMap=r,h.d.CreateGround=(R,q,L,B,N,h)=>p(R,{width:q,height:L,subdivisions:B,updatable:h},N),h.d.CreateTiledGround=(R,q,L,B,N,h,Z,z,Y)=>c(R,{xmin:q,zmin:L,xmax:B,zmax:N,subdivisions:h,precision:Z,updatable:Y},z),h.d.CreateGroundFromHeightMap=(R,q,L,B,N,h,Z,z,Y,F,C)=>d(R,q,{width:L,height:B,subdivisions:N,minHeight:h,maxHeight:Z,updatable:Y,onReady:F,alphaFilter:C},z)},12460:(R,q,L)=>{"use strict";L.d(q,{d:()=>l,f:()=>m,j:()=>o});var B=L(11081),N=L(11329),h=L(11357),Z=L(11112),z=L(11136),Y=L(12079),F=L(11216),C=L(11117),e=L(11071),y=L(11277),U=L(10889),n=L(11303),r=L(10791),p=L(11271),c=L(10797),d=L(11255),f=L(11248);const v={effect:null,subMesh:null};class T extends p.e{constructor(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(R,q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new B.c,this._cachedWorldViewProjectionMatrix=new B.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=L,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...N}}get shaderPath(){return this._shaderPath}set shaderPath(R){this._shaderPath=R}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(R){-1===this._options.uniforms.indexOf(R)&&this._options.uniforms.push(R)}setTexture(R,q){return-1===this._options.samplers.indexOf(R)&&this._options.samplers.push(R),this._textures[R]=q,this}removeTexture(R){delete this._textures[R]}setTextureArray(R,q){return-1===this._options.samplers.indexOf(R)&&this._options.samplers.push(R),this._checkUniform(R),this._textureArrays[R]=q,this}setExternalTexture(R,q){return-1===this._options.externalTextures.indexOf(R)&&this._options.externalTextures.push(R),this._externalTextures[R]=q,this}setFloat(R,q){return this._checkUniform(R),this._floats[R]=q,this}setInt(R,q){return this._checkUniform(R),this._ints[R]=q,this}setUInt(R,q){return this._checkUniform(R),this._uints[R]=q,this}setFloats(R,q){return this._checkUniform(R),this._floatsArrays[R]=q,this}setColor3(R,q){return this._checkUniform(R),this._colors3[R]=q,this}setColor3Array(R,q){return this._checkUniform(R),this._colors3Arrays[R]=q.reduce(((R,q)=>(q.toArray(R,R.length),R)),[]),this}setColor4(R,q){return this._checkUniform(R),this._colors4[R]=q,this}setColor4Array(R,q){return this._checkUniform(R),this._colors4Arrays[R]=q.reduce(((R,q)=>(q.toArray(R,R.length),R)),[]),this}setVector2(R,q){return this._checkUniform(R),this._vectors2[R]=q,this}setVector3(R,q){return this._checkUniform(R),this._vectors3[R]=q,this}setVector4(R,q){return this._checkUniform(R),this._vectors4[R]=q,this}setQuaternion(R,q){return this._checkUniform(R),this._quaternions[R]=q,this}setQuaternionArray(R,q){return this._checkUniform(R),this._quaternionsArrays[R]=q.reduce(((R,q)=>(q.toArray(R,R.length),R)),[]),this}setMatrix(R,q){return this._checkUniform(R),this._matrices[R]=q,this}setMatrices(R,q){this._checkUniform(R);const L=new Float32Array(16*q.length);for(let B=0;B<q.length;B++){q[B].copyToArray(L,16*B)}return this._matrixArrays[R]=L,this}setMatrix3x3(R,q){return this._checkUniform(R),this._matrices3x3[R]=q,this}setMatrix2x2(R,q){return this._checkUniform(R),this._matrices2x2[R]=q,this}setArray2(R,q){return this._checkUniform(R),this._vectors2Arrays[R]=q,this}setArray3(R,q){return this._checkUniform(R),this._vectors3Arrays[R]=q,this}setArray4(R,q){return this._checkUniform(R),this._vectors4Arrays[R]=q,this}setUniformBuffer(R,q){return-1===this._options.uniformBuffers.indexOf(R)&&this._options.uniformBuffers.push(R),this._uniformBuffers[R]=q,this}setTextureSampler(R,q){return-1===this._options.samplerObjects.indexOf(R)&&this._options.samplerObjects.push(R),this._textureSamplers[R]=q,this}setStorageBuffer(R,q){return-1===this._options.storageBuffers.indexOf(R)&&this._options.storageBuffers.push(R),this._storageBuffers[R]=q,this}setDefine(R,q){const L=R.trimEnd()+" ",B=this.options.defines.findIndex((q=>q===R||q.startsWith(L)));return B>=0&&this.options.defines.splice(B,1),("boolean"!==typeof q||q)&&this.options.defines.push(L+q),this}isReadyForSubMesh(R,q,L){return this.isReady(R,L,q)}isReady(R,q,L){var B;const N=L&&this._storeEffectOnSubMeshes;if(this.isFrozen){const R=N?L._drawWrapper:this._drawWrapper;if(R.effect&&R._wasPreviouslyReady&&R._wasPreviouslyUsingInstances===q)return!0}const h=this.va(),Z=h.getEngine(),Y=[],F=[],C=new n.b;let y=this._shaderPath,U=this._options.uniforms,r=this._options.uniformBuffers,p=this._options.samplers;Z.getCaps().multiview&&h.activeCamera&&h.activeCamera.outputRenderTarget&&h.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,Y.push("#define MULTIVIEW"),-1!==U.indexOf("viewProjection")&&-1===U.indexOf("viewProjectionR")&&U.push("viewProjectionR"));for(let z=0;z<this._options.defines.length;z++){const R=0===this._options.defines[z].indexOf("#define")?this._options.defines[z]:`#define ${this._options.defines[z]}`;Y.push(R)}for(let z=0;z<this._options.attributes.length;z++)F.push(this._options.attributes[z]);if(R&&R.isVerticesDataPresent(z.e.ColorKind)&&(-1===F.indexOf(z.e.ColorKind)&&F.push(z.e.ColorKind),Y.push("#define VERTEXCOLOR")),q&&(Y.push("#define INSTANCES"),(0,f.db)(F,this._materialHelperNeedsPreviousMatrices),null!==R&&void 0!==R&&R.hasThinInstances&&(Y.push("#define THIN_INSTANCES"),R&&R.isVerticesDataPresent(z.e.ColorInstanceKind)&&(F.push(z.e.ColorInstanceKind),Y.push("#define INSTANCESCOLOR")))),R&&R.useBones&&R.computeBonesUsingShaders&&R.skeleton){F.push(z.e.MatricesIndicesKind),F.push(z.e.MatricesWeightsKind),R.numBoneInfluencers>4&&(F.push(z.e.MatricesIndicesExtraKind),F.push(z.e.MatricesWeightsExtraKind));const q=R.skeleton;Y.push("#define NUM_BONE_INFLUENCERS "+R.numBoneInfluencers),C.addCPUSkinningFallback(0,R),q.isUsingTextureForMatrices?(Y.push("#define BONETEXTURE"),-1===U.indexOf("boneTextureWidth")&&U.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(Y.push("#define BonesPerMesh "+(q.bones.length+1)),-1===U.indexOf("mBones")&&U.push("mBones"))}else Y.push("#define NUM_BONE_INFLUENCERS 0");let c=0;const T=R?R.morphTargetManager:null;if(T){const R=T.supportsUVs&&-1!==Y.indexOf("#define UV1"),q=T.supportsTangents&&-1!==Y.indexOf("#define TANGENT"),L=T.supportsNormals&&-1!==Y.indexOf("#define NORMAL");c=T.numMaxInfluencers||T.numInfluencers,R&&Y.push("#define MORPHTARGETS_UV"),q&&Y.push("#define MORPHTARGETS_TANGENT"),L&&Y.push("#define MORPHTARGETS_NORMAL"),c>0&&Y.push("#define MORPHTARGETS"),T.isUsingTextureForTargets&&(Y.push("#define MORPHTARGETS_TEXTURE"),-1===U.indexOf("morphTargetTextureIndices")&&U.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),Y.push("#define NUM_MORPH_INFLUENCERS "+c);for(let B=0;B<c;B++)F.push(z.e.PositionKind+B),L&&F.push(z.e.NormalKind+B),q&&F.push(z.e.TangentKind+B),R&&F.push(z.e.UVKind+"_"+B);c>0&&(U=U.slice(),U.push("morphTargetInfluences"),U.push("morphTargetCount"),U.push("morphTargetTextureInfo"),U.push("morphTargetTextureIndices"))}else Y.push("#define NUM_MORPH_INFLUENCERS 0");if(R){const q=R.bakedVertexAnimationManager;q&&q.isEnabled&&(Y.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===U.indexOf("bakedVertexAnimationSettings")&&U.push("bakedVertexAnimationSettings"),-1===U.indexOf("bakedVertexAnimationTextureSizeInverted")&&U.push("bakedVertexAnimationTextureSizeInverted"),-1===U.indexOf("bakedVertexAnimationTime")&&U.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,f.w)(F,R,Y)}for(const z in this._textures)if(!this._textures[z].isReady())return!1;R&&this._shouldTurnAlphaTestOn(R)&&Y.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,d.e)(U),(0,d.k)(this,h,Y)),h.fogEnabled&&null!==R&&void 0!==R&&R.applyFog&&h.fogMode!==e.b.FOGMODE_NONE&&(Y.push("#define FOG"),-1===U.indexOf("view")&&U.push("view"),-1===U.indexOf("vFogInfos")&&U.push("vFogInfos"),-1===U.indexOf("vFogColor")&&U.push("vFogColor")),this._useLogarithmicDepth&&(Y.push("#define LOGARITHMICDEPTH"),-1===U.indexOf("logarithmicDepthConstant")&&U.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(U=U.slice(),r=r.slice(),p=p.slice(),y=this.customShaderNameResolve(this.name,U,r,p,Y,F));const t=N?L._getDrawWrapper(void 0,!0):this._drawWrapper,D=(null===t||void 0===t?void 0:t.effect)??null,S=(null===t||void 0===t?void 0:t.defines)??null,I=Y.join("\n");let K=D;return S!==I&&(K=Z.createEffect(y,{attributes:F,uniformsNames:U,uniformBuffersNames:r,samplers:p,defines:I,fallbacks:C,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:c},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},Z),N?L.setEffect(K,I,this._materialContext):t&&t.setEffect(K,I),this._onEffectCreatedObservable&&(v.effect=K,v.subMesh=L??(null===R||void 0===R?void 0:R.Zf[0])??null,this._onEffectCreatedObservable.notifyObservers(v))),t._wasPreviouslyUsingInstances=!!q,!((null===(B=K)||void 0===B||!B.isReady())??1)&&(D!==K&&h.resetCachedMaterial(),t._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(R,q){const L=this.va(),B=q??this.getEffect();B&&(-1!==this._options.uniforms.indexOf("world")&&B.setMatrix("world",R),-1!==this._options.uniforms.indexOf("worldView")&&(R.multiplyToRef(L.getViewMatrix(),this._cachedWorldViewMatrix),B.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(R.multiplyToRef(L.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),B.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&B.setMatrix("view",L.getViewMatrix()))}bindForSubMesh(R,q,L){var B;this.bind(R,q,null===(B=L._drawWrapperOverride)||void 0===B?void 0:B.effect,L)}bind(R,q,L,B){const N=B&&this._storeEffectOnSubMeshes,h=L??(N?B.effect:this.getEffect());if(!h)return;const Z=this.va();this._activeEffect=h,this.bindOnlyWorldMatrix(R,L);const z=this._options.uniformBuffers;let Y=!1;if(h&&z&&z.length>0&&Z.getEngine().supportsUniformBuffers)for(let e=0;e<z.length;++e){switch(z[e]){case"Mesh":q&&(q.getMeshUniformBuffer().bindToEffect(h,"Mesh"),q.transferToEffect(R));break;case"Scene":(0,f.o)(h,Z.getSceneUniformBuffer()),Z.finalizeSceneUbo(),Y=!0}}const F=q&&N?this._mustRebind(Z,h,B,q.visibility):Z.getCachedMaterial()!==this;if(h&&F){let R;for(R in Y||-1===this._options.uniforms.indexOf("view")||h.setMatrix("view",Z.getViewMatrix()),Y||-1===this._options.uniforms.indexOf("projection")||h.setMatrix("projection",Z.getProjectionMatrix()),Y||-1===this._options.uniforms.indexOf("viewProjection")||(h.setMatrix("viewProjection",Z.getTransformMatrix()),this._multiview&&h.setMatrix("viewProjectionR",Z._transformMatrixR)),Z.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&h.setVector3("cameraPosition",Z.activeCamera.globalPosition),(0,f.d)(q,h),(0,d.f)(h,this,Z),this._useLogarithmicDepth&&(0,f.l)(N?B.materialDefines:h.defines,h,Z),q&&(0,f.g)(Z,q,h),this._textures)h.setTexture(R,this._textures[R]);for(R in this._textureArrays)h.setTextureArray(R,this._textureArrays[R]);for(R in this._ints)h.setInt(R,this._ints[R]);for(R in this._uints)h.setUInt(R,this._uints[R]);for(R in this._floats)h.setFloat(R,this._floats[R]);for(R in this._floatsArrays)h.setArray(R,this._floatsArrays[R]);for(R in this._colors3)h.setColor3(R,this._colors3[R]);for(R in this._colors3Arrays)h.setArray3(R,this._colors3Arrays[R]);for(R in this._colors4){const q=this._colors4[R];h.setFloat4(R,q.r,q.g,q.b,q.a)}for(R in this._colors4Arrays)h.setArray4(R,this._colors4Arrays[R]);for(R in this._vectors2)h.setVector2(R,this._vectors2[R]);for(R in this._vectors3)h.setVector3(R,this._vectors3[R]);for(R in this._vectors4)h.setVector4(R,this._vectors4[R]);for(R in this._quaternions)h.setQuaternion(R,this._quaternions[R]);for(R in this._matrices)h.setMatrix(R,this._matrices[R]);for(R in this._matrixArrays)h.setMatrices(R,this._matrixArrays[R]);for(R in this._matrices3x3)h.setMatrix3x3(R,this._matrices3x3[R]);for(R in this._matrices2x2)h.setMatrix2x2(R,this._matrices2x2[R]);for(R in this._vectors2Arrays)h.setArray2(R,this._vectors2Arrays[R]);for(R in this._vectors3Arrays)h.setArray3(R,this._vectors3Arrays[R]);for(R in this._vectors4Arrays)h.setArray4(R,this._vectors4Arrays[R]);for(R in this._quaternionsArrays)h.setArray4(R,this._quaternionsArrays[R]);for(R in this._uniformBuffers){const q=this._uniformBuffers[R].getBuffer();q&&h.bindUniformBuffer(q,R)}const L=Z.getEngine(),z=L.setExternalTexture;if(z)for(R in this._externalTextures)z.call(L,R,this._externalTextures[R]);const F=L.setTextureSampler;if(F)for(R in this._textureSamplers)F.call(L,R,this._textureSamplers[R]);const C=L.setStorageBuffer;if(C)for(R in this._storageBuffers)C.call(L,R,this._storageBuffers[R])}if(h&&q&&(F||!this.isFrozen)){const R=q.morphTargetManager;R&&R.numInfluencers>0&&(0,f.n)(q,h);const L=q.bakedVertexAnimationManager;if(L&&L.isEnabled){var C;const R=N?B._drawWrapper:this._drawWrapper;null===(C=q.bakedVertexAnimationManager)||void 0===C||C.bind(h,!!R._wasPreviouslyUsingInstances)}}this._afterBind(q,h,B)}getActiveTextures(){const R=super.getActiveTextures();for(const q in this._textures)R.push(this._textures[q]);for(const q in this._textureArrays){const L=this._textureArrays[q];for(let q=0;q<L.length;q++)R.push(L[q])}return R}hasTexture(R){if(super.hasTexture(R))return!0;for(const q in this._textures)if(this._textures[q]===R)return!0;for(const q in this._textureArrays){const L=this._textureArrays[q];for(let q=0;q<L.length;q++)if(L[q]===R)return!0}return!1}clone(R){const q=C.b.Clone((()=>new T(R,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);q.name=R,q.id=R,"object"===typeof q._shaderPath&&(q._shaderPath={...q._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((R=>{const q=this._options[R];Array.isArray(q)&&(this._options[R]=q.slice(0))})),this.stencil.copyTo(q.stencil);for(const L in this._textures)q.setTexture(L,this._textures[L]);for(const L in this._textureArrays)q.setTextureArray(L,this._textureArrays[L]);for(const L in this._externalTextures)q.setExternalTexture(L,this._externalTextures[L]);for(const L in this._ints)q.setInt(L,this._ints[L]);for(const L in this._uints)q.setUInt(L,this._uints[L]);for(const L in this._floats)q.setFloat(L,this._floats[L]);for(const L in this._floatsArrays)q.setFloats(L,this._floatsArrays[L]);for(const L in this._colors3)q.setColor3(L,this._colors3[L]);for(const L in this._colors3Arrays)q._colors3Arrays[L]=this._colors3Arrays[L];for(const L in this._colors4)q.setColor4(L,this._colors4[L]);for(const L in this._colors4Arrays)q._colors4Arrays[L]=this._colors4Arrays[L];for(const L in this._vectors2)q.setVector2(L,this._vectors2[L]);for(const L in this._vectors3)q.setVector3(L,this._vectors3[L]);for(const L in this._vectors4)q.setVector4(L,this._vectors4[L]);for(const L in this._quaternions)q.setQuaternion(L,this._quaternions[L]);for(const L in this._quaternionsArrays)q._quaternionsArrays[L]=this._quaternionsArrays[L];for(const L in this._matrices)q.setMatrix(L,this._matrices[L]);for(const L in this._matrixArrays)q._matrixArrays[L]=this._matrixArrays[L].slice();for(const L in this._matrices3x3)q.setMatrix3x3(L,this._matrices3x3[L]);for(const L in this._matrices2x2)q.setMatrix2x2(L,this._matrices2x2[L]);for(const L in this._vectors2Arrays)q.setArray2(L,this._vectors2Arrays[L]);for(const L in this._vectors3Arrays)q.setArray3(L,this._vectors3Arrays[L]);for(const L in this._vectors4Arrays)q.setArray4(L,this._vectors4Arrays[L]);for(const L in this._uniformBuffers)q.setUniformBuffer(L,this._uniformBuffers[L]);for(const L in this._textureSamplers)q.setTextureSampler(L,this._textureSamplers[L]);for(const L in this._storageBuffers)q.setStorageBuffer(L,this._storageBuffers[L]);return q}dispose(R,q,L){if(q){let R;for(R in this._textures)this._textures[R].dispose();for(R in this._textureArrays){const q=this._textureArrays[R];for(let R=0;R<q.length;R++)q[R].dispose()}}this._textures={},super.dispose(R,q,L)}serialize(){const R=C.b.Serialize(this);let q;for(q in R.customType="BABYLON.ShaderMaterial",R.uniqueId=this.uniqueId,R.options=this._options,R.shaderPath=this._shaderPath,R.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,R.stencil=this.stencil.serialize(),R.textures={},this._textures)R.textures[q]=this._textures[q].serialize();for(q in R.textureArrays={},this._textureArrays){R.textureArrays[q]=[];const L=this._textureArrays[q];for(let B=0;B<L.length;B++)R.textureArrays[q].push(L[B].serialize())}for(q in R.ints={},this._ints)R.ints[q]=this._ints[q];for(q in R.uints={},this._uints)R.uints[q]=this._uints[q];for(q in R.floats={},this._floats)R.floats[q]=this._floats[q];for(q in R.floatsArrays={},this._floatsArrays)R.floatsArrays[q]=this._floatsArrays[q];for(q in R.colors3={},this._colors3)R.colors3[q]=this._colors3[q].dj();for(q in R.colors3Arrays={},this._colors3Arrays)R.colors3Arrays[q]=this._colors3Arrays[q];for(q in R.colors4={},this._colors4)R.colors4[q]=this._colors4[q].dj();for(q in R.colors4Arrays={},this._colors4Arrays)R.colors4Arrays[q]=this._colors4Arrays[q];for(q in R.vectors2={},this._vectors2)R.vectors2[q]=this._vectors2[q].dj();for(q in R.vectors3={},this._vectors3)R.vectors3[q]=this._vectors3[q].dj();for(q in R.vectors4={},this._vectors4)R.vectors4[q]=this._vectors4[q].dj();for(q in R.quaternions={},this._quaternions)R.quaternions[q]=this._quaternions[q].dj();for(q in R.matrices={},this._matrices)R.matrices[q]=this._matrices[q].dj();for(q in R.matrixArray={},this._matrixArrays)R.matrixArray[q]=this._matrixArrays[q];for(q in R.matrices3x3={},this._matrices3x3)R.matrices3x3[q]=this._matrices3x3[q];for(q in R.matrices2x2={},this._matrices2x2)R.matrices2x2[q]=this._matrices2x2[q];for(q in R.vectors2Arrays={},this._vectors2Arrays)R.vectors2Arrays[q]=this._vectors2Arrays[q];for(q in R.vectors3Arrays={},this._vectors3Arrays)R.vectors3Arrays[q]=this._vectors3Arrays[q];for(q in R.vectors4Arrays={},this._vectors4Arrays)R.vectors4Arrays[q]=this._vectors4Arrays[q];for(q in R.quaternionsArrays={},this._quaternionsArrays)R.quaternionsArrays[q]=this._quaternionsArrays[q];return R}static Parse(R,q,L){const N=C.b.Parse((()=>new T(R.name,q,R.shaderPath,R.options,R.storeEffectOnSubMeshes)),R,q,L);let h;for(h in R.stencil&&N.stencil.parse(R.stencil,q,L),R.textures)N.setTexture(h,y.c.Parse(R.textures[h],q,L));for(h in R.textureArrays){const B=R.textureArrays[h],Z=[];for(let R=0;R<B.length;R++)Z.push(y.c.Parse(B[R],q,L));N.setTextureArray(h,Z)}for(h in R.ints)N.setInt(h,R.ints[h]);for(h in R.uints)N.setUInt(h,R.uints[h]);for(h in R.floats)N.setFloat(h,R.floats[h]);for(h in R.floatsArrays)N.setFloats(h,R.floatsArrays[h]);for(h in R.colors3)N.setColor3(h,Z.e.Ig(R.colors3[h]));for(h in R.colors3Arrays){const q=R.colors3Arrays[h].reduce(((R,q,L)=>(L%3===0?R.push([q]):R[R.length-1].push(q),R)),[]).map((R=>Z.e.Ig(R)));N.setColor3Array(h,q)}for(h in R.colors4)N.setColor4(h,Z.g.Ig(R.colors4[h]));for(h in R.colors4Arrays){const q=R.colors4Arrays[h].reduce(((R,q,L)=>(L%4===0?R.push([q]):R[R.length-1].push(q),R)),[]).map((R=>Z.g.Ig(R)));N.setColor4Array(h,q)}for(h in R.vectors2)N.setVector2(h,B.i.Ig(R.vectors2[h]));for(h in R.vectors3)N.setVector3(h,B.m.Ig(R.vectors3[h]));for(h in R.vectors4)N.setVector4(h,B.q.Ig(R.vectors4[h]));for(h in R.quaternions)N.setQuaternion(h,B.d.Ig(R.quaternions[h]));for(h in R.matrices)N.setMatrix(h,B.c.Ig(R.matrices[h]));for(h in R.matrixArray)N._matrixArrays[h]=new Float32Array(R.matrixArray[h]);for(h in R.matrices3x3)N.setMatrix3x3(h,R.matrices3x3[h]);for(h in R.matrices2x2)N.setMatrix2x2(h,R.matrices2x2[h]);for(h in R.vectors2Arrays)N.setArray2(h,R.vectors2Arrays[h]);for(h in R.vectors3Arrays)N.setArray3(h,R.vectors3Arrays[h]);for(h in R.vectors4Arrays)N.setArray4(h,R.vectors4Arrays[h]);for(h in R.quaternionsArrays)N.setArray4(h,R.quaternionsArrays[h]);return N}static ParseFromFileAsync(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((N,h)=>{const Z=new r.b;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const q=JSON.parse(Z.responseText),h=this.Parse(q,L||c.b.LastCreatedScene,B);R&&(h.name=R),N(h)}else h("Unable to load the ShaderMaterial")})),Z.open("GET",q),Z.send()}))}static ParseFromSnippetAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((B,N)=>{const h=new r.b;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const N=JSON.parse(JSON.parse(h.responseText).jsonPayload),Z=JSON.parse(N.shaderMaterial),z=this.Parse(Z,q||c.b.LastCreatedScene,L);z.snippetId=R,B(z)}else N("Unable to load the snippet "+R)})),h.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),h.send()}))}}T.SnippetUrl="https://snippet.babylonjs.com",T.CreateFromSnippetAsync=T.ParseFromSnippetAsync,(0,U.f)("BABYLON.ShaderMaterial",T),N.d._LinesMeshParser=(R,q)=>t.Parse(R,q);class t extends N.d{_isShaderMaterial(R){return"ShaderMaterial"===R.getClassName()}constructor(R){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>5?arguments[5]:void 0,N=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0;super(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q,arguments.length>4?arguments[4]:void 0),this.useVertexColor=B,this.useVertexAlpha=N,this.color=new Z.e(1,1,1),this.alpha=1,this._shaderLanguage=0,q&&(this.color=q.color.clone(),this.alpha=q.alpha,this.useVertexColor=q.useVertexColor,this.useVertexAlpha=q.useVertexAlpha),this.intersectionThreshold=.1;const Y={attributes:[z.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===N?Y.needAlphaBlending=!1:Y.defines.push("#define VERTEXALPHA"),B?(Y.defines.push("#define VERTEXCOLOR"),Y.attributes.push(z.e.ColorKind)):(Y.uniforms.push("color"),this._color4=new Z.g),h)this.material=h;else{this.va().getEngine().isWebGPU&&!t.ForceGLSL&&(this._shaderLanguage=1),Y.shaderLanguage=this._shaderLanguage,Y.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([L.e(23).then(L.bind(L,13344)),L.e(47).then(L.bind(L,13352))]):await Promise.all([L.e(28).then(L.bind(L,13359)),L.e(48).then(L.bind(L,13365))])},this.material=new T("colorShader",this.va(),"color",Y,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(R){this._lineMaterial=R,this._lineMaterial.fillMode=F.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(R){}_bind(R,q){if(!this._geometry)return this;const L=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(q,L):this._geometry._bind(q,L,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:R,g:q,b:L}=this.color;this._color4.set(R,q,L,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(R,q,L){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const B=this.va().getEngine();return this._unIndexed?B.drawArraysType(F.c.LineListDrawMode,R.verticesStart,R.verticesCount,L):B.drawElementsType(F.c.LineListDrawMode,R.indexStart,R.indexCount,L),this}dispose(R){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(R)}clone(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;return new t(R,this.va(),q,this,L)}createInstance(R){const q=new D(R,this);if(this.instancedBuffers){q.instancedBuffers={};for(const R in this.instancedBuffers)q.instancedBuffers[R]=this.instancedBuffers[R]}return q}serialize(R){super.serialize(R),R.color=this.color.dj(),R.alpha=this.alpha}static Parse(R,q){const L=new t(R.name,q);return L.color=Z.e.Ig(R.color),L.alpha=R.alpha,L}}t.ForceGLSL=!1;class D extends Y.d{constructor(R,q){super(R,q),this.intersectionThreshold=q.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var S=L(10767);function I(R){const q=[],L=[],B=R.lines,N=R.za,Z=[];let z=0;for(let h=0;h<B.length;h++){const R=B[h];for(let B=0;B<R.length;B++){const{x:Y,y:F,z:C}=R[B];if(L.push(Y,F,C),N){const R=N[h],{r:q,g:L,b:z,a:Y}=R[B];Z.push(q,L,z,Y)}B>0&&(q.push(z-1),q.push(z)),z++}}const Y=new h.d;return Y.indices=q,Y.xa=L,N&&(Y.za=Z),Y}function K(R){const q=R.dashSize||3,L=R.gapSize||1,N=R.dashNb||200,Z=R.points,z=[],Y=[],F=B.m.Zero();let C=0,e=0,y=0,U=0,n=0,r=0,p=0;for(p=0;p<Z.length-1;p++)Z[p+1].subtractToRef(Z[p],F),C+=F.length();for(y=C/N,U=q*y/(q+L),p=0;p<Z.length-1;p++){Z[p+1].subtractToRef(Z[p],F),e=Math.floor(F.length()/y),F.normalize();for(let R=0;R<e;R++)n=y*R,z.push(Z[p].x+n*F.x,Z[p].y+n*F.y,Z[p].z+n*F.z),z.push(Z[p].x+(n+U)*F.x,Z[p].y+(n+U)*F.y,Z[p].z+(n+U)*F.z),Y.push(r,r+1),r+=2}const c=new h.d;return c.xa=z,c.indices=Y,c}function m(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.instance,N=q.lines,h=q.za;if(B){const R=B.getVerticesData(z.e.PositionKind);let q,L;h&&(q=B.getVerticesData(z.e.ColorKind));let Z=0,Y=0;for(let B=0;B<N.length;B++){const z=N[B];for(let N=0;N<z.length;N++)R[Z]=z[N].x,R[Z+1]=z[N].y,R[Z+2]=z[N].z,h&&q&&(L=h[B],q[Y]=L[N].r,q[Y+1]=L[N].g,q[Y+2]=L[N].b,q[Y+3]=L[N].a,Y+=4),Z+=3}return B.updateVerticesData(z.e.PositionKind,R,!1,!1),h&&q&&B.updateVerticesData(z.e.ColorKind,q,!1,!1),B.refreshBoundingInfo(),B}const Z=new t(R,L,null,void 0,void 0,!!h,q.useVertexAlpha,q.material);return I(q).Ca(Z,q.updatable),Z}function o(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.za?[q.za]:null;return m(R,{lines:[q.points],updatable:q.updatable,instance:q.instance,za:B,useVertexAlpha:q.useVertexAlpha,material:q.material},L)}function l(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=q.points,Z=q.instance,z=q.gapSize||1,Y=q.dashSize||3;if(Z){const R=R=>{const q=B.m.Zero(),L=R.length/6;let N=0,z=0,Y=0,F=0,C=0,e=0,y=0,U=0;for(y=0;y<h.length-1;y++)h[y+1].subtractToRef(h[y],q),N+=q.length();Y=N/L;const n=Z._creationDataStorage.dashSize;for(F=n*Y/(n+Z._creationDataStorage.gapSize),y=0;y<h.length-1;y++)for(h[y+1].subtractToRef(h[y],q),z=Math.floor(q.length()/Y),q.normalize(),U=0;U<z&&e<R.length;)C=Y*U,R[e]=h[y].x+C*q.x,R[e+1]=h[y].y+C*q.y,R[e+2]=h[y].z+C*q.z,R[e+3]=h[y].x+(C+F)*q.x,R[e+4]=h[y].y+(C+F)*q.y,R[e+5]=h[y].z+(C+F)*q.z,e+=6,U++;for(;e<R.length;)R[e]=h[y].x,R[e+1]=h[y].y,R[e+2]=h[y].z,e+=3};return(q.dashNb||q.dashSize||q.gapSize||q.useVertexAlpha||q.material)&&S.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),Z.updateMeshPositions(R,!1),Z}const F=new t(R,L,null,void 0,void 0,void 0,q.useVertexAlpha,q.material);return K(q).Ca(F,q.updatable),F._creationDataStorage=new N.f,F._creationDataStorage.dashSize=Y,F._creationDataStorage.gapSize=z,F}h.d.CreateLineSystem=I,h.d.CreateDashedLines=K,N.d.pb=function(R,q){return o(R,{points:q,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},N.d.CreateDashedLines=function(R,q,L,B,N){return l(R,{points:q,dashSize:L,gapSize:B,dashNb:N,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11440:(R,q,L)=>{"use strict";L.d(q,{b:()=>z,c:()=>Y});var B=L(11329),N=L(11357),h=L(11292);function Z(R){const q=[],L=[],B=[],Z=[],z=R.width||R.size||1,Y=R.height||R.size||1,F=0===R.sideOrientation?0:R.sideOrientation||N.d.DEFAULTSIDE,C=z/2,e=Y/2;L.push(-C,-e,0),B.push(0,0,-1),Z.push(0,h.e?1:0),L.push(C,-e,0),B.push(0,0,-1),Z.push(1,h.e?1:0),L.push(C,e,0),B.push(0,0,-1),Z.push(1,h.e?0:1),L.push(-C,e,0),B.push(0,0,-1),Z.push(0,h.e?0:1),q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),N.d._ComputeSides(F,L,q,B,Z,R.frontUVs,R.backUVs);const y=new N.d;return y.indices=q,y.xa=L,y.ya=B,y.Aa=Z,y}function z(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new B.d(R,L);q.sideOrientation=B.d._GetDefaultSideOrientation(q.sideOrientation),N._originalBuilderSideOrientation=q.sideOrientation;return Z(q).Ca(N,q.updatable),q.sourcePlane&&(N.translate(q.sourcePlane.k,-q.sourcePlane.d),N.setDirection(q.sourcePlane.k.scale(-1))),N}const Y={_f:z};N.d._f=Z,B.d._f=(R,q,L,B,N)=>z(R,{size:q,width:q,height:q,sideOrientation:N,updatable:B},L)},11733:(R,q,L)=>{"use strict";L.d(q,{e:()=>Y});var B=L(11081),N=L(11329),h=L(11357),Z=L(11292);function z(R){const q=0|(R.segments||32),L=R.diameterX||R.diameter||1,N=R.diameterY||R.diameter||1,z=R.diameterZ||R.diameter||1,Y=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,F=R.slice&&R.slice<=0?1:R.slice||1,C=0===R.sideOrientation?0:R.sideOrientation||h.d.DEFAULTSIDE,e=!!R.dedupTopBottomIndices,y=new B.m(L/2,N/2,z/2),U=2+q,n=2*U,r=[],p=[],c=[],d=[];for(let h=0;h<=U;h++){const R=h/U,q=R*Math.PI*F;for(let L=0;L<=n;L++){const N=L/n,h=N*Math.PI*2*Y,z=B.c.RotationZ(-q),F=B.c.RotationY(h),C=B.m.TransformCoordinates(B.m.Up(),z),e=B.m.TransformCoordinates(C,F),U=e.multiply(y),r=e.divide(y).normalize();p.push(U.x,U.y,U.z),c.push(r.x,r.y,r.z),d.push(N,Z.e?1-R:R)}if(h>0){const R=p.length/3;for(let q=R-2*(n+1);q+n+2<R;q++)e?(h>1&&(r.push(q),r.push(q+1),r.push(q+n+1)),(h<U||F<1)&&(r.push(q+n+1),r.push(q+1),r.push(q+n+2))):(r.push(q),r.push(q+1),r.push(q+n+1),r.push(q+n+1),r.push(q+1),r.push(q+n+2))}}h.d._ComputeSides(C,p,r,c,d,R.frontUVs,R.backUVs);const f=new h.d;return f.indices=r,f.xa=p,f.ya=c,f.Aa=d,f}function Y(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return z(q).Ca(B,q.updatable),B}h.d.CreateSphere=z,N.d.CreateSphere=(R,q,L,B,N,h)=>Y(R,{segments:q,diameterX:L,diameterY:L,diameterZ:L,sideOrientation:h,updatable:N},B)},12113:(R,q,L)=>{"use strict";L.d(q,{b:()=>e});var B=L(10757),N=L(12118),h=L(11364),Z=L(11136),z=L(11357),Y=L(10767);function F(R,q,L,B,N){let h=null,Z=null,z=null;try{let Y;h=new R.Decoder,Z=new R.DecoderBuffer,Z.Init(q,q.byteLength);const F=h.GetEncodedGeometryType(Z);switch(F){case R.TRIANGULAR_MESH:{const q=new R.Mesh;if(Y=h.DecodeBufferToMesh(Z,q),!Y.ok()||0===q.ptr)throw new Error(Y.error_msg());const L=3*q.num_faces(),N=4*L,F=R._malloc(N);try{h.GetTrianglesUInt32Array(q,N,F);const Z=new Uint32Array(L);Z.set(new Uint32Array(R.HEAPF32.buffer,F,L)),B(Z)}finally{R._free(F)}z=q;break}case R.POINT_CLOUD:{const q=new R.PointCloud;if(Y=h.DecodeBufferToPointCloud(Z,q),!Y.ok()||!q.ptr)throw new Error(Y.error_msg());z=q;break}default:throw new Error(`Invalid geometry type ${F}`)}const C=z.num_points(),e=(q,L,B,h)=>{const Z=h.data_type(),z=h.num_components(),Y=h.normalized(),F=h.byte_stride(),e=h.byte_offset(),y={[R.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:R.HEAPF32},[R.DT_INT8]:{typedArrayConstructor:Int8Array,heap:R.HEAP8},[R.DT_INT16]:{typedArrayConstructor:Int16Array,heap:R.HEAP16},[R.DT_INT32]:{typedArrayConstructor:Int32Array,heap:R.HEAP32},[R.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:R.HEAPU8},[R.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:R.HEAPU16},[R.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:R.HEAPU32}}[Z];if(!y)throw new Error(`Invalid data type ${Z}`);const U=C*z,n=U*y.typedArrayConstructor.BYTES_PER_ELEMENT,r=R._malloc(n);try{q.GetAttributeDataArrayForAllPoints(L,h,Z,n,r);const R=new y.typedArrayConstructor(y.heap.buffer,r,U);N(B,R.slice(),z,e,F,Y)}finally{R._free(r)}};if(L)for(const R in L){const q=L[R],B=h.GetAttributeByUniqueId(z,q);e(h,z,R,B)}else{const q={position:R.POSITION,k:R.NORMAL,color:R.COLOR,uv:R.TEX_COORD};for(const R in q){const L=h.GetAttributeId(z,q[R]);if(-1!==L){const q=h.GetAttribute(z,L);e(h,z,R,q)}}}return C}finally{z&&R.destroy(z),Z&&R.destroy(Z),h&&R.destroy(h)}}function C(){let R;onmessage=q=>{const L=q.data;switch(L.id){case"init":{const q=L.decoder;q.url&&importScripts(q.url);const B=q.wasmBinary?{wasmBinary:q.wasmBinary}:{};R=DracoDecoderModule(B),postMessage({id:"initDone"});break}case"decodeMesh":if(!R)throw new Error("Draco decoder module is not available");R.then((R=>{const q=F(R,L.dataView,L.attributes,(R=>{postMessage({id:"indices",data:R},[R.buffer])}),((R,q,L,B,N,h)=>{postMessage({id:"attribute",kind:R,data:q,size:L,byteOffset:B,byteStride:N,normalized:h},[q.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:q})}))}}}class e{static get DecoderAvailable(){const R=e.Configuration.decoder;return!!(R.wasmUrl&&R.wasmBinaryUrl&&"object"===typeof WebAssembly||R.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return e._Default||(e._Default=new e),e._Default}static ResetDefault(R){e._Default&&(R||e._Default.dispose(),e._Default=null)}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DefaultNumWorkers;const q=e.Configuration.decoder;if(q.workerPool||"object"===typeof R&&R.workerPool)this._workerPoolPromise=Promise.resolve(q.workerPool||R.workerPool);else{const L=q.wasmBinary||"object"===typeof R&&R.wasmBinary,h="number"===typeof R?R:R.numWorkers,Z=h&&"function"===typeof Worker&&"function"===typeof URL,z=Z||!Z&&!q.jsModule,Y=q.wasmUrl&&q.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:z?B.f.GetBabylonScriptURL(q.wasmUrl,!0):"",wasmBinaryPromise:L?Promise.resolve(L):B.f.LoadFileAsync(B.f.GetBabylonScriptURL(q.wasmBinaryUrl,!0))}:{url:z?B.f.GetBabylonScriptURL(q.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};Z?this._workerPoolPromise=Y.wasmBinaryPromise.then((R=>{const q=`${F}(${C})()`,L=URL.createObjectURL(new Blob([q],{type:"application/javascript"}));return new N.d(h,(()=>function(R,q,L){return new Promise(((B,N)=>{const h=q=>{R.removeEventListener("error",h),R.removeEventListener("message",Z),N(q)},Z=q=>{"initDone"===q.data.id&&(R.removeEventListener("error",h),R.removeEventListener("message",Z),B(R))};if(R.addEventListener("error",h),R.addEventListener("message",Z),q){const B=q.slice(0);R.postMessage({id:"init",decoder:{url:L,wasmBinary:B}},[B])}else R.postMessage({id:"init",decoder:{url:L}})}))}(new Worker(L),R,Y.url)))})):this._decoderModulePromise=Y.wasmBinaryPromise.then((async R=>{if("undefined"===typeof DracoDecoderModule&&!q.jsModule){if(!Y.url)throw new Error("Draco decoder module is not available");await B.f.LoadBabylonScriptAsync(Y.url)}return await(L=R,N=q.jsModule,new Promise((R=>{(N||DracoDecoderModule)({wasmBinary:L}).then((q=>{R({module:q})}))})));var L,N}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((R=>{R.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(R,q,L){const B=R instanceof ArrayBuffer?new Int8Array(R):new Int8Array(R.buffer,R.byteOffset,R.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((R=>new Promise(((N,h)=>{R.push(((R,Z)=>{let z=null;const F=[],C=q=>{R.removeEventListener("error",C),R.removeEventListener("message",e),h(q),Z()},e=q=>{const B=q.data;switch(B.id){case"decodeMeshDone":R.removeEventListener("error",C),R.removeEventListener("message",e),N({indices:z,attributes:F,totalVertices:B.totalVertices}),Z();break;case"indices":z=B.data;break;case"attribute":F.push({kind:B.kind,data:B.data,size:B.size,byteOffset:B.byteOffset,byteStride:B.byteStride,normalized:(h=B.kind,y=B.normalized,L&&void 0!==L[h]?(y!==L[h]&&Y.d.Warn(`Normalized flag from Draco data (${y}) does not match normalized flag from glTF accessor (${L[h]}). Using flag from glTF accessor.`),L[h]):y)})}var h,y};R.addEventListener("error",C),R.addEventListener("message",e);const y=B.slice();R.postMessage({id:"decodeMesh",dataView:y,attributes:q},[y.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((R=>{let L=null;const N=[],h=F(R.module,B,q,(R=>{L=R}),((R,q,L,B,h,Z)=>{N.push({kind:R,data:q,size:L,byteOffset:B,byteStride:h,normalized:Z})}));return{indices:L,attributes:N,totalVertices:h}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(R,q,L,B){const N=await this.decodeMeshToMeshDataAsync(L,B),z=new h.b(R,q);N.indices&&z.setIndices(N.indices);for(const h of N.attributes)z.setVerticesBuffer(new Z.e(q.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),N.totalVertices);return z}async _decodeMeshToGeometryForGltfAsync(R,q,L,B,N){const z=await this.decodeMeshToMeshDataAsync(L,B,N),Y=new h.b(R,q);z.indices&&Y.setIndices(z.indices);for(const h of z.attributes)Y.setVerticesBuffer(new Z.e(q.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),z.totalVertices);return Y}async decodeMeshAsync(R,q){const L=await this.decodeMeshToMeshDataAsync(R,q),B=new z.d;L.indices&&(B.indices=L.indices);for(const N of L.attributes){const R=Z.e.GetFloatData(N.data,N.size,Z.e.GetDataType(N.data),N.byteOffset,N.byteStride,N.normalized,L.totalVertices);B.set(R,N.kind)}return B}}e.Configuration={decoder:{wasmUrl:`${B.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},e.DefaultNumWorkers=e.GetDefaultNumWorkers(),e._Default=null},11511:(R,q,L)=>{"use strict";L.d(q,{d:()=>N});var B=L(11144);class N extends B.c{constructor(R){super(),this._buffer=R}get underlyingResource(){return this._buffer}}},11375:(R,q,L)=>{"use strict";L.d(q,{c:()=>D});var B=L(11053),N=L(10760),h=L(11081),Z=L(11136),z=L(11357),Y=L(11379),F=L(11134),C=L(11228),e=L(11132);class y{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new h.m(0,0,0),this._diffPositionForCollisions=new h.m(0,0,0),this._collisionResponse=!0}}var U=L(10785),n=L(11239),r=L(11112),p=L(11088),c=L(11382),d=L(10889),f=L(11058),v=L(10834);class T{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=h.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class t{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new T,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new y,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class D extends Y.e{static get BILLBOARDMODE_NONE(){return Y.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return Y.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return Y.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return Y.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return Y.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return Y.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(R){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=R}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(R){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=R}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(R){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=R}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(R){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=R}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(R){this._internalAbstractMeshDataInfo._collisionRetryCount=R}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(R){this._internalAbstractMeshDataInfo._morphTargetManager!==R&&(this._internalAbstractMeshDataInfo._morphTargetManager=R,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(R){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==R&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=R,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(R){return!!super._updateNonUniformScalingState(R)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(R){this._internalAbstractMeshDataInfo._rawBoundingInfo=R}set Dk(R){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(R)}set onCollisionPositionChange(R){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(R)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(R){if(this._internalAbstractMeshDataInfo._visibility===R)return;const q=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=R,(1===q&&1!==R||1!==q&&1===R)&&this._markSubMeshesAsDirty((R=>{R.markAsMiscDirty(),R.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(R){this._internalAbstractMeshDataInfo._inheritVisibility=R}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let R=this._parentNode;for(;R;){const q=R.isVisible;if("undefined"!==typeof q)return q;R=R.parent}}return this._isVisible}set isVisible(R){this._isVisible=R}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(R){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=R}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(R){this._internalAbstractMeshDataInfo._renderingGroupId=R}get material(){return this._internalAbstractMeshDataInfo._material}set material(R){this._setMaterial(R)}_setMaterial(R){this._internalAbstractMeshDataInfo._material!==R&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=R,R&&R.meshMap&&(R.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Zf&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(R){var q;return null===(q=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===q?void 0:q[R]}setMaterialForRenderPass(R,q){this.resetDrawCache(R),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[R]=q}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(R){this._internalAbstractMeshDataInfo._receiveShadows!==R&&(this._internalAbstractMeshDataInfo._receiveShadows=R,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(R){this._internalAbstractMeshDataInfo._hasVertexAlpha!==R&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=R,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(R){this._internalAbstractMeshDataInfo._useVertexColors!==R&&(this._internalAbstractMeshDataInfo._useVertexColors=R,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(R){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==R&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=R,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(R){this._internalAbstractMeshDataInfo._numBoneInfluencers!==R&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=R,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(R){this._internalAbstractMeshDataInfo._applyFog!==R&&(this._internalAbstractMeshDataInfo._applyFog=R,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(R){this._internalAbstractMeshDataInfo._enableDistantPicking=R}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(R){R!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=R,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(R){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(R)?-1:R}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(R){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=R}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(R){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(R)?-1:R}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(R){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=R}get lightSources(){return this._lightSources}set skeleton(R){const q=this._internalAbstractMeshDataInfo._skeleton;q&&q.needInitialSkinMatrix&&q._unregisterMeshWithPoseMatrix(this),R&&R.needInitialSkinMatrix&&R._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=R,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(R){var q;let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(R,L,!1),q=this,this._internalAbstractMeshDataInfo=new t,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.yi=D.zi,this.onCollideObservable=new N.b,this.onCollisionPositionChangeObservable=new N.b,this.onMaterialChangedObservable=new N.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.ub=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=r.e.Red(),this.outlineWidth=.02,this.overlayColor=r.e.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.sb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new h.m(.5,1,.5),this.ellipsoidOffset=new h.m(0,0,0),this.edgesWidth=1,this.edgesColor=new r.g(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Yb:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new N.b,this._onCollisionPositionChange=function(R,L){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.subtractToRef(q._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>v.e.CollisionsEpsilon&&q.position.addInPlace(q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),B&&q.onCollideObservable.notifyObservers(B),q.onCollisionPositionChangeObservable.notifyObservers(q.position)},L=this.va(),L.gi(this),this._resyncLightSources(),this._uniformBuffer=new e.d(this.va().getEngine(),void 0,void 0,R,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),L.performancePriority){case 2:this.Da=!0;case 1:this.sb=!0,this.ub=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(R){const q=this._uniformBuffer;q.Cj("world",R),q.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),q.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(R){let q="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");q+=", # of submeshes: "+(this.Zf?this.Zf.length:0);const L=this._internalAbstractMeshDataInfo._skeleton;return L&&(q+=", skeleton: "+L.name),R&&(q+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],q+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Yb?"YES":"NO")),q}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==Y.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(q||this.actionManager.isRecursive)){if(!R)return this.actionManager;if(this.actionManager.hasSpecificTrigger(R))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(R,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Zf){for(const R of this.Zf)R._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const R of this.va().lights)R.isEnabled()&&R.canAffectMesh(this)&&this._lightSources.push(R);this._markSubMeshesAsLightDirty()}_resyncLightSource(R){const q=R.isEnabled()&&R.canAffectMesh(this),L=this._lightSources.indexOf(R);let B=!1;if(-1===L){if(!q)return;this._lightSources.push(R)}else{if(q)return;B=!0,this._lightSources.splice(L,1)}this._markSubMeshesAsLightDirty(B)}_unBindEffect(){for(const R of this.Zf)R.setEffect(null)}_removeLightSource(R,q){const L=this._lightSources.indexOf(R);-1!==L&&(this._lightSources.splice(L,1),this._markSubMeshesAsLightDirty(q))}_markSubMeshesAsDirty(R){if(this.Zf)for(const q of this.Zf)for(let L=0;L<q._drawWrappers.length;++L){const B=q._drawWrappers[L];B&&B.defines&&B.defines.markAllAsDirty&&R(B.defines)}}_markSubMeshesAsLightDirty(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((q=>q.markAsLightDirty(R)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((R=>R.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((R=>R.markAsMiscDirty()))}Ag(R){return this._currentRenderId=Number.MAX_VALUE,super.Ag(R),this._isDirty=!0,this}resetDrawCache(R){if(this.Zf)for(const q of this.Zf)q.resetDrawCache(R)}get isBlocked(){return!1}getLOD(R){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Sf(){return null}getVerticesData(R){return null}Ga(R,q,L,B){return this}updateVerticesData(R,q,L,B){return this}setIndices(R,q){return this}isVerticesDataPresent(R){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(R){return this._boundingInfo=R,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(R,q,L){return this._boundingInfo=new C.b(R,q,L),this._boundingInfo}normalizeToUnitCube(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(R,q,L)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(Z.e.MatricesIndicesKind)&&this.isVerticesDataPresent(Z.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(R){}_activate(R,q){return this._renderId=R,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===Y.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(R,q,L){return this.position.addInPlace(this.calcMovePOV(R,q,L)),this}calcMovePOV(R,q,L){const B=new h.c;(this.rotationQuaternion?this.rotationQuaternion:h.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(B);const N=h.m.Zero(),Z=this.definedFacingForward?-1:1;return h.m.TransformCoordinatesFromFloatsToRef(R*Z,q,L*Z,B,N),N}rotatePOV(R,q,L){return this.rotation.addInPlace(this.calcRotatePOV(R,q,L)),this}calcRotatePOV(R,q,L){const B=this.definedFacingForward?1:-1;return new h.m(R*B,q,L*B)}Fa(R,q){if(R){const L=(0,n.e)(R,0,this.getTotalVertices(),q);this._boundingInfo?this._boundingInfo.reConstruct(L.minimum,L.maximum):this._boundingInfo=new C.b(L.minimum,L.maximum)}if(this.Zf)for(let L=0;L<this.Zf.length;L++)this.Zf[L].refreshBoundingInfo(R);this.Ea()}_refreshBoundingInfoDirect(R){if(this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new C.b(R.minimum,R.maximum),this.Zf)for(let q=0;q<this.Zf.length;q++)this.Zf[q].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(R,q,L,B,N,z,Y){!function(R,q,L,B,N,z,Y){const F=h.h.o[0],C=h.h.Matrix[0],e=h.h.Matrix[1],y=q===Z.e.NormalKind?h.m.TransformNormalFromFloatsToRef:h.m.TransformCoordinatesFromFloatsToRef;for(let Z=0,U=0;Z<R.length;Z+=3,U+=4){let q,n;for(C.reset(),q=0;q<4;q++)n=N[U+q],n>0&&(h.c.FromFloat32ArrayToRefScaled(L,Math.floor(16*B[U+q]),n,e),C.addToSelf(e));if(z&&Y)for(q=0;q<4;q++)n=Y[U+q],n>0&&(h.c.FromFloat32ArrayToRefScaled(L,Math.floor(16*z[U+q]),n,e),C.addToSelf(e));y(R[Z],R[Z+1],R[Z+2],C,F),F.toArray(R,Z)}}(R,q,L,B,N,z,Y)}_getData(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.e.PositionKind;const B=R.cache,N=R=>{if(B){const q=B._vertexData||(B._vertexData={});return q[R]||this.copyVerticesData(R,q),q[R]}return this.getVerticesData(R)};if(q||(q=N(L)),!q)return null;if(B?(B._outputData?B._outputData.set(q):B._outputData=new Float32Array(q),q=B._outputData):(R.applyMorph&&this.morphTargetManager||R.applySkeleton&&this.skeleton)&&(q=q.slice()),R.applyMorph&&this.morphTargetManager&&function(R,q,L){let B=null;switch(q){case Z.e.PositionKind:B=R=>R.getPositions();break;case Z.e.NormalKind:B=R=>R.getNormals();break;case Z.e.TangentKind:B=R=>R.getTangents();break;case Z.e.UVKind:B=R=>R.getUVs();break;default:return}for(let N=0;N<R.length;N++){let q=R[N];for(let h=0;h<L.numTargets;h++){const Z=L.getTarget(h),z=Z.influence;if(0!==z){const L=B(Z);L&&(q+=(L[N]-R[N])*z)}}R[N]=q}}(q,L,this.morphTargetManager),R.applySkeleton&&this.skeleton){const R=N(Z.e.MatricesIndicesKind),B=N(Z.e.MatricesWeightsKind);if(B&&R){const h=this.numBoneInfluencers>4,z=h?N(Z.e.MatricesIndicesExtraKind):null,Y=h?N(Z.e.MatricesWeightsExtraKind):null,F=this.skeleton.getTransformMatrices(this);D._ApplySkeleton(q,L,F,R,B,z,Y)}}if(!1!==R.updatePositionsArray&&L===Z.e.PositionKind){const R=this._internalAbstractMeshDataInfo._positions||[],L=R.length;if(R.length=q.length/3,L<R.length)for(let q=L;q<R.length;q++)R[q]=new h.m;for(let B=0,N=0;B<R.length;B++,N+=3)R[B].Td(q[N],q[N+1],q[N+2]);this._internalAbstractMeshDataInfo._positions=R}return q}getNormalsData(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:R,applyMorph:q,updatePositionsArray:!1},null,Z.e.NormalKind)}Dd(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:R,applyMorph:q,updatePositionsArray:!1},L,Z.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new C.b(h.m.Zero(),h.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(R){if(!this.Zf)return this;const q=this.Zf.length;for(let L=0;L<q;L++){const B=this.Zf[L];(q>1||!B.IsGlobal)&&B.updateBoundingInfo(R)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(R){return this.getBoundingInfo().isInFrustum(R,this.yi)}isCompletelyInFrustum(R){return this.getBoundingInfo().isCompletelyInFrustum(R)}intersectsMesh(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;const B=this.getBoundingInfo(),N=R.getBoundingInfo();if(B.intersects(N,q))return!0;if(L)for(const h of this.getChildMeshes())if(h.intersectsMesh(R,q,!0))return!0;return!1}intersectsPoint(R){return this.getBoundingInfo().intersectsPoint(R)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(R){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=R}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(R){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const q=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=q.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,q.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,R,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(R,q,L){var B;if(this._generatePointsArray(),!this._positions)return this;if(!R._lastColliderWorldVertices||!R._lastColliderTransformMatrix.equals(q)){R._lastColliderTransformMatrix=q.clone(),R._lastColliderWorldVertices=[],R._trianglePlanes=[];const L=R.verticesStart,B=R.verticesStart+R.verticesCount;for(let N=L;N<B;N++)R._lastColliderWorldVertices.push(h.m.TransformCoordinates(this._positions[N],q))}return L._collide(R._trianglePlanes,R._lastColliderWorldVertices,this.Sf(),R.indexStart,R.indexStart+R.indexCount,R.verticesStart,!!R.Ha(),this,this._shouldConvertRHS(),7===(null===(B=R.Ha())||void 0===B?void 0:B.fillMode)),this}_processCollisionsForSubMeshes(R,q){const L=this._scene.getCollidingSubMeshCandidates(this,R),B=L.length;for(let N=0;N<B;N++){const h=L.data[N];B>1&&!h._checkCollision(R)||this._collideForSubMesh(h,q,R)}return this}_shouldConvertRHS(){return!1}_checkCollision(R){if(!this.getBoundingInfo()._checkCollision(R))return this;const q=h.h.Matrix[0],L=h.h.Matrix[1];return h.c.ScalingToRef(1/R._radius.x,1/R._radius.y,1/R._radius.z,q),this.worldMatrixFromCache.multiplyToRef(q,L),this._processCollisionsForSubMeshes(R,L),this}_generatePointsArray(){return!1}intersects(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=new F.c,Y=this.getClassName(),C="InstancedLinesMesh"===Y||"LinesMesh"===Y||"GreasedLineMesh"===Y?this.intersectionThreshold:0,e=this.getBoundingInfo();if(!this.Zf)return z;if(!Z&&(!R.intersectsSphere(e.boundingSphere,C)||!R.intersectsBox(e.boundingBox,C)))return z;if(B)return z.hit=!Z,z.pickedMesh=Z?null:this,z.distance=Z?0:h.m.Distance(R.origin,e.boundingSphere.center),z.subMeshId=0,z;if(!this._generatePointsArray())return z;let y=null;const U=this._scene.getIntersectingSubMeshCandidates(this,R),n=U.length;let r=!1;for(let h=0;h<n;h++){const R=U.data[h].Ha();if(R&&(7==R.fillMode||0==R.fillMode||1==R.fillMode||2==R.fillMode||4==R.fillMode)){r=!0;break}}if(!r)return z.hit=!0,z.pickedMesh=this,z.distance=h.m.Distance(R.origin,e.boundingSphere.center),z.subMeshId=-1,z;for(let h=0;h<n;h++){const B=U.data[h];if(n>1&&!Z&&!B.canIntersects(R))continue;const N=B.intersects(R,this._positions,this.Sf(),q,L);if(N&&(q||!y||N.distance<y.distance)&&(y=N,y.subMeshId=h,q))break}if(y){const q=N??this.getWorldMatrix(),L=h.h.o[0],B=h.h.o[1];h.m.TransformCoordinatesToRef(R.origin,q,L),R.direction.scaleToRef(y.distance,B);const Z=h.m.TransformNormal(B,q).addInPlace(L);return z.hit=!0,z.distance=h.m.Distance(L,Z),z.pickedPoint=Z,z.pickedMesh=this,z.bu=y.bu||0,z.bv=y.bv||0,z.subMeshFaceId=y.faceId,z.faceId=y.faceId+U.data[y.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),z.subMeshId=y.subMeshId,z}return z}clone(R,q,L){return null}releaseSubMeshes(){if(this.Zf)for(;this.Zf.length;)this.Zf[0].dispose();else this.Zf=[];return this}dispose(R){let q,L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const B=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),B.freeActiveMeshes(),B.freeRenderingGroups(),B.renderingManager.maintainStateBetweenFrames&&B.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((R=>R!==this&&R.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),q=0;q<this._intersectionsInProgress.length;q++){const R=this._intersectionsInProgress[q],L=R._intersectionsInProgress.indexOf(this);R._intersectionsInProgress.splice(L,1)}this._intersectionsInProgress.length=0;B.lights.forEach((R=>{let q=R.includedOnlyMeshes.indexOf(this);-1!==q&&R.includedOnlyMeshes.splice(q,1),q=R.excludedMeshes.indexOf(this),-1!==q&&R.excludedMeshes.splice(q,1);const L=R.getShadowGenerators();if(L){const R=L.values();for(let L=R.next();!0!==L.done;L=R.next()){const R=L.value.getShadowMap();R&&R.renderList&&(q=R.renderList.indexOf(this),-1!==q&&R.renderList.splice(q,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const N=B.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,N.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),N.wipeCaches(),B.Fc(this),this._parentContainer){const R=this._parentContainer.meshes.indexOf(this);R>-1&&this._parentContainer.meshes.splice(R,1),this._parentContainer=null}if(L&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!R)for(q=0;q<B.lj.length;q++)B.lj[q].j===this&&(B.lj[q].dispose(),q--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(R,L)}_initFacetData(){const R=this._internalAbstractMeshDataInfo._facetData;R.facetNormals||(R.facetNormals=[]),R.facetPositions||(R.facetPositions=[]),R.facetPartitioning||(R.facetPartitioning=new Array),R.facetNb=this.Sf().length/3|0,R.partitioningSubdivisions=R.partitioningSubdivisions?R.partitioningSubdivisions:10,R.partitioningBBoxRatio=R.partitioningBBoxRatio?R.partitioningBBoxRatio:1.01;for(let q=0;q<R.facetNb;q++)R.facetNormals[q]=h.m.Zero(),R.facetPositions[q]=h.m.Zero();return R.facetDataEnabled=!0,this}updateFacetData(){const R=this._internalAbstractMeshDataInfo._facetData;R.facetDataEnabled||this._initFacetData();const q=this.getVerticesData(Z.e.PositionKind),L=this.Sf(),B=this.getVerticesData(Z.e.NormalKind),N=this.getBoundingInfo();if(R.facetDepthSort&&!R.facetDepthSortEnabled){if(R.facetDepthSortEnabled=!0,L instanceof Uint16Array)R.depthSortedIndices=new Uint16Array(L);else if(L instanceof Uint32Array)R.depthSortedIndices=new Uint32Array(L);else{let q=!1;for(let R=0;R<L.length;R++)if(L[R]>65535){q=!0;break}R.depthSortedIndices=q?new Uint32Array(L):new Uint16Array(L)}if(R.facetDepthSortFunction=function(R,q){return q.sqDistance-R.sqDistance},!R.facetDepthSortFrom){const q=this.va().activeCamera;R.facetDepthSortFrom=q?q.position:h.m.Zero()}R.depthSortedFacets=[];for(let q=0;q<R.facetNb;q++){const L={ind:3*q,sqDistance:0};R.depthSortedFacets.push(L)}R.invertedMatrix=h.c.Identity(),R.facetDepthSortOrigin=h.m.Zero()}R.bbSize.x=N.maximum.x-N.minimum.x>p.e?N.maximum.x-N.minimum.x:p.e,R.bbSize.y=N.maximum.y-N.minimum.y>p.e?N.maximum.y-N.minimum.y:p.e,R.bbSize.z=N.maximum.z-N.minimum.z>p.e?N.maximum.z-N.minimum.z:p.e;let Y=R.bbSize.x>R.bbSize.y?R.bbSize.x:R.bbSize.y;if(Y=Y>R.bbSize.z?Y:R.bbSize.z,R.subDiv.max=R.partitioningSubdivisions,R.subDiv.X=Math.floor(R.subDiv.max*R.bbSize.x/Y),R.subDiv.Y=Math.floor(R.subDiv.max*R.bbSize.y/Y),R.subDiv.Z=Math.floor(R.subDiv.max*R.bbSize.z/Y),R.subDiv.X=R.subDiv.X<1?1:R.subDiv.X,R.subDiv.Y=R.subDiv.Y<1?1:R.subDiv.Y,R.subDiv.Z=R.subDiv.Z<1?1:R.subDiv.Z,R.facetParameters.facetNormals=this.getFacetLocalNormals(),R.facetParameters.facetPositions=this.getFacetLocalPositions(),R.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),R.facetParameters.bInfo=N,R.facetParameters.bbSize=R.bbSize,R.facetParameters.subDiv=R.subDiv,R.facetParameters.ratio=this.partitioningBBoxRatio,R.facetParameters.depthSort=R.facetDepthSort,R.facetDepthSort&&R.facetDepthSortEnabled&&(this.Jj(!0),this._worldMatrix.invertToRef(R.invertedMatrix),h.m.TransformCoordinatesToRef(R.facetDepthSortFrom,R.invertedMatrix,R.facetDepthSortOrigin),R.facetParameters.distanceTo=R.facetDepthSortOrigin),R.facetParameters.depthSortedFacets=R.depthSortedFacets,B&&z.d.ComputeNormals(q,L,B,R.facetParameters),R.facetDepthSort&&R.facetDepthSortEnabled){R.depthSortedFacets.sort(R.facetDepthSortFunction);const q=R.depthSortedIndices.length/3|0;for(let B=0;B<q;B++){const q=R.depthSortedFacets[B].ind;R.depthSortedIndices[3*B]=L[q],R.depthSortedIndices[3*B+1]=L[q+1],R.depthSortedIndices[3*B+2]=L[q+2]}this.updateIndices(R.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetNormals||this.updateFacetData(),R.facetNormals}getFacetLocalPositions(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetPositions||this.updateFacetData(),R.facetPositions}getFacetLocalPartitioning(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetPartitioning||this.updateFacetData(),R.facetPartitioning}getFacetPosition(R){const q=h.m.Zero();return this.getFacetPositionToRef(R,q),q}getFacetPositionToRef(R,q){const L=this.getFacetLocalPositions()[R],B=this.getWorldMatrix();return h.m.TransformCoordinatesToRef(L,B,q),this}getFacetNormal(R){const q=h.m.Zero();return this.getFacetNormalToRef(R,q),q}getFacetNormalToRef(R,q){const L=this.getFacetLocalNormals()[R];return h.m.TransformNormalToRef(L,this.getWorldMatrix(),q),this}getFacetsAtLocalCoordinates(R,q,L){const B=this.getBoundingInfo(),N=this._internalAbstractMeshDataInfo._facetData,h=Math.floor((R-B.minimum.x*N.partitioningBBoxRatio)*N.subDiv.X*N.partitioningBBoxRatio/N.bbSize.x),Z=Math.floor((q-B.minimum.y*N.partitioningBBoxRatio)*N.subDiv.Y*N.partitioningBBoxRatio/N.bbSize.y),z=Math.floor((L-B.minimum.z*N.partitioningBBoxRatio)*N.subDiv.Z*N.partitioningBBoxRatio/N.bbSize.z);return h<0||h>N.subDiv.max||Z<0||Z>N.subDiv.max||z<0||z>N.subDiv.max?null:N.facetPartitioning[h+N.subDiv.max*Z+N.subDiv.max*N.subDiv.max*z]}getClosestFacetAtCoordinates(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const z=this.getWorldMatrix(),Y=h.h.Matrix[5];z.invertToRef(Y);const F=h.h.o[8];h.m.TransformCoordinatesFromFloatsToRef(R,q,L,Y,F);const C=this.getClosestFacetAtLocalCoordinates(F.x,F.y,F.z,B,N,Z);return B&&h.m.TransformCoordinatesFromFloatsToRef(B.x,B.y,B.z,z,B),C}getClosestFacetAtLocalCoordinates(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=null,z=0,Y=0,F=0,C=0,e=0,y=0,U=0,n=0;const r=this.getFacetLocalPositions(),p=this.getFacetLocalNormals(),c=this.getFacetsAtLocalCoordinates(R,q,L);if(!c)return null;let d,f,v,T=Number.MAX_VALUE,t=T;for(let D=0;D<c.length;D++)d=c[D],f=p[d],v=r[d],C=(R-v.x)*f.x+(q-v.y)*f.y+(L-v.z)*f.z,(!N||N&&h&&C>=0||N&&!h&&C<=0)&&(C=f.x*v.x+f.y*v.y+f.z*v.z,e=-(f.x*R+f.y*q+f.z*L-C)/(f.x*f.x+f.y*f.y+f.z*f.z),y=R+f.x*e,U=q+f.y*e,n=L+f.z*e,z=y-R,Y=U-q,F=n-L,t=z*z+Y*Y+F*F,t<T&&(T=t,Z=d,B&&(B.x=y,B.y=U,B.z=n)));return Z}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetDataEnabled&&(R.facetDataEnabled=!1,R.facetPositions=[],R.facetNormals=[],R.facetPartitioning=new Array,R.facetParameters=null,R.depthSortedIndices=new Uint32Array(0)),this}updateIndices(R,q){return this}createNormals(R){const q=this.getVerticesData(Z.e.PositionKind),L=this.Sf();let B;return B=this.isVerticesDataPresent(Z.e.NormalKind)?this.getVerticesData(Z.e.NormalKind):[],z.d.ComputeNormals(q,L,B,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(Z.e.NormalKind,B,R),this}alignWithNormal(R,q){q||(q=c.e.Y);const L=h.h.o[0],B=h.h.o[1];return h.m.CrossToRef(q,R,B),h.m.CrossToRef(R,B,L),this.rotationQuaternion?h.d.RotationQuaternionFromAxisToRef(L,R,B,this.rotationQuaternion):h.m.RotationFromAxisToRef(L,R,B,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,U.d)("EdgesRenderer")}enableEdgesRendering(R,q,L){throw(0,U.d)("EdgesRenderer")}mj(){return this._scene.lj.filter((R=>R.j===this))}}D.OCCLUSION_TYPE_NONE=0,D.OCCLUSION_TYPE_OPTIMISTIC=1,D.OCCLUSION_TYPE_STRICT=2,D.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,D.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,D.CULLINGSTRATEGY_STANDARD=0,D.zi=1,D.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,D.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,B.d)([f.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B,N,h,Z,z]=q;return!Array.isArray(B)&&!Array.isArray(N)&&!Array.isArray(h)&&!Array.isArray(Z)&&!Array.isArray(z)}))],D,"_ApplySkeleton",null),(0,d.f)("BABYLON.AbstractMesh",D)},11364:(R,q,L)=>{"use strict";L.d(q,{b:()=>p});var B=L(11081),N=L(11112),h=L(11357),Z=L(11136),z=L(11218),Y=L(11371),F=L(11228),C=L(10757),e=L(11074),y=L(11239),U=L(10797),n=L(11292),r=L(10767);class p{get boundingBias(){return this._boundingBias}set boundingBias(R){this._boundingBias?this._boundingBias.p(R):this._boundingBias=R.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(R){const q=new p(p.RandomId(),R.va());return q.Ca(R),q}get meshes(){return this._meshes}constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=q||U.b.LastCreatedScene,this._scene&&(this.id=R,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=B,L?this.setAllVerticesData(L,B):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),N&&(this.Ca(N),N.Jj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let R=0;R<this._meshes.length;R++)if(!this._meshes[R].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const R=new Set;for(const q in this._vertexBuffers)R.add(this._vertexBuffers[q].getWrapperBuffer());R.forEach((R=>{R._rebuild()}))}setAllVerticesData(R,q){R.applyToGeometry(this,q),this._notifyUpdate()}Ga(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;L&&Array.isArray(q)&&(q=new Float32Array(q));const N=new Z.e(this._engine,q,R,{updatable:L,postponeInternalCreation:0===this._meshes.length,stride:B,label:"Geometry_"+this.id+"_"+R});this.setVerticesBuffer(N)}removeVerticesData(R){this._vertexBuffers[R]&&(this._vertexBuffers[R].dispose(),delete this._vertexBuffers[R]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=R.getKind();this._vertexBuffers[N]&&L&&this._vertexBuffers[N].dispose(),R._buffer&&R._buffer._increaseReferences(),this._vertexBuffers[N]=R;const h=this._meshes,z=h.length;if(N===Z.e.PositionKind){this._totalVertices=q??R._maxVerticesCount,this._updateExtend(R.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const L=this._extend&&this._extend.minimum||new B.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),N=this._extend&&this._extend.maximum||new B.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let R=0;R<z;R++){const q=h[R];q.buildBoundingInfo(L,N),q._createGlobalSubMesh(q.isUnIndexed),q.Jj(!0),q.synchronizeInstances()}}this._notifyUpdate(N)}updateVerticesDataDirectly(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getVertexBuffer(R);N&&(N.updateDirectly(q,L,B),this._notifyUpdate(R))}updateVerticesData(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this.getVertexBuffer(R);B&&(B.update(q),R===Z.e.PositionKind&&this.Ea(L,q),this._notifyUpdate(R))}Ea(R,q){if(R&&this._updateExtend(q),this._resetPointsArrayCache(),R){const R=this._meshes;for(const q of R){q.hasBoundingInfo?q.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):q.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const R=q.Zf;for(const q of R)q.refreshBoundingInfo()}}}_bind(R,q,L,B){if(!R)return;void 0===q&&(q=this._indexBuffer);const N=this.getVertexBuffers();if(!N)return;if(q!=this._indexBuffer||!this._vertexArrayObjects&&!B)return void this._engine.bindBuffers(N,q,R,L);const h=B||this._vertexArrayObjects,Z=this._engine;h[R.key]||(h[R.key]=Z.recordVertexArrayObject(N,q,R,L)),Z.bindVertexArrayObject(h[R.key],q)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(R,q,L){const B=this.getVertexBuffer(R);return B?B.getFloatData(this._totalVertices,L||q&&1!==this._meshes.length):null}copyVerticesData(R,q){const L=this.getVertexBuffer(R);if(!L)return;q[R]||(q[R]=new Float32Array(this._totalVertices*L.getSize()));const B=L.getData();B&&function(R,q,L,B,N,h,z,Y){const F=q*Z.e.GetTypeByteLength(L),C=z*q;if(Y.length!==C)throw new Error("Output length is not valid");if(L===Z.e.FLOAT&&N===F)if(R instanceof Array){const q=B/4;Y.set(R,q)}else if(R instanceof ArrayBuffer){const q=new Float32Array(R,B,C);Y.set(q)}else{const q=R.byteOffset+B;if(q%4)return r.d.Warn("CopyFloatData: copied misaligned data."),void Y.set(new Float32Array(R.buffer.slice(q,q+4*C)));const L=new Float32Array(R.buffer,q,C);Y.set(L)}else Z.e.ForEach(R,B,N,q,L,C,h,((R,q)=>Y[q]=R))}(B,L.getSize(),L.type,L.byteOffset,L.byteStride,L.normalized,this._totalVertices,q[R])}isVertexBufferUpdatable(R){const q=this._vertexBuffers[R];return!!q&&q.isUpdatable()}getVertexBuffer(R){return this.isReady()?this._vertexBuffers[R]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(R){return this._vertexBuffers?void 0!==this._vertexBuffers[R]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(R)}getVerticesDataKinds(){const R=[];let q;if(!this._vertexBuffers&&this._delayInfo)for(q in this._delayInfo)R.push(q);else for(q in this._vertexBuffers)R.push(q);return R}updateIndices(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const B=R.length!==this._indices.length;if(L||(this._indices=R.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,R,q),B)for(const R of this._meshes)R._createGlobalSubMesh(!0)}else this.setIndices(R,null,!0)}setIndexBuffer(R,q,L){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=R,this._totalVertices=q,this._totalIndices=L,R.is32Bits||(R.is32Bits=this._totalIndices>65535);for(const B of this._meshes)B._createGlobalSubMesh(!0),B.synchronizeInstances();this._notifyUpdate()}setIndices(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=R,this._indexBufferIsUpdatable=L,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,L,"Geometry_"+this.id+"_IndexBuffer")),void 0!=q&&(this._totalVertices=q);for(const N of this._meshes)N._createGlobalSubMesh(!B),N.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Sf(R,q){if(!this.isReady())return null;const L=this._indices;return q||R&&1!==this._meshes.length?L.slice():L}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;R&&this._vertexArrayObjects&&this._vertexArrayObjects[R.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[R.key]),delete this._vertexArrayObjects[R.key])}releaseForMesh(R,q){const L=this._meshes,B=L.indexOf(R);-1!==B&&(L.splice(B,1),this._vertexArrayObjects&&R._invalidateInstanceVertexArrayObject(),R._geometry=null,0===L.length&&q&&this.dispose())}Ca(R){if(R._geometry===this)return;const q=R._geometry;q&&q.releaseForMesh(R),this._vertexArrayObjects&&R._invalidateInstanceVertexArrayObject();const L=this._meshes;R._geometry=this,R._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),L.push(R),this.isReady()?this._applyToMesh(R):this._boundingInfo&&R.setBoundingInfo(this._boundingInfo)}_updateExtend(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!R&&(R=this.getVerticesData(Z.e.PositionKind),!R))return;this._extend=(0,y.e)(R,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(R){const q=this._meshes.length;for(const L in this._vertexBuffers)1===q&&this._vertexBuffers[L].create(),L===Z.e.PositionKind&&(this._extend||this._updateExtend(),R.buildBoundingInfo(this._extend.minimum,this._extend.maximum),R._createGlobalSubMesh(R.isUnIndexed),R.Ea());1===q&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),R._syncGeometryWithMorphTargetManager(),R.synchronizeInstances()}_notifyUpdate(R){this.onGeometryUpdated&&this.onGeometryUpdated(this,R),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const q of this._meshes)q._markSubMeshesAsAttributesDirty()}load(R,q){2!==this.delayLoadState&&(this.isReady()?q&&q():(this.delayLoadState=2,this._queueLoad(R,q)))}_queueLoad(R,q){this.delayLoadingFile&&(R.addPendingData(this),R._loadFile(this.delayLoadingFile,(L=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(L),this),this.delayLoadState=1,this._delayInfo=[],R.removePendingData(this);const B=this._meshes,N=B.length;for(let R=0;R<N;R++)this._applyToMesh(B[R]);q&&q()}),void 0,!0))}toLeftHanded(){const R=this.Sf(!1);if(null!=R&&R.length>0){for(let q=0;q<R.length;q+=3){const L=R[q+0];R[q+0]=R[q+2],R[q+2]=L}this.setIndices(R)}const q=this.getVerticesData(Z.e.PositionKind,!1);if(null!=q&&q.length>0){for(let R=0;R<q.length;R+=3)q[R+2]=-q[R+2];this.Ga(Z.e.PositionKind,q,!1)}const L=this.getVerticesData(Z.e.NormalKind,!1);if(null!=L&&L.length>0){for(let R=0;R<L.length;R+=3)L[R+2]=-L[R+2];this.Ga(Z.e.NormalKind,L,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const R=this.getVerticesData(Z.e.PositionKind);if(!R||0===R.length)return!1;for(let q=3*this._positionsCache.length,L=this._positionsCache.length;q<R.length;q+=3,++L)this._positionsCache[L]=B.m.Ig(R,q);for(let q=0,L=0;q<R.length;q+=3,++L)this._positionsCache[L].set(R[0+q],R[1+q],R[2+q]);return this._positionsCache.length=R.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const L in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[L]);this._vertexArrayObjects={};const R=this._meshes,q=R.length;for(let L=0;L<q;L++)R[L]._invalidateInstanceVertexArrayObject()}}dispose(){const R=this._meshes,q=R.length;let L;for(L=0;L<q;L++)this.releaseForMesh(R[L]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const B in this._vertexBuffers)this._vertexBuffers[B].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const R=this._parentContainer.geometries.indexOf(this);R>-1&&this._parentContainer.geometries.splice(R,1),this._parentContainer=null}this._isDisposed=!0}i(R){const q=new h.d;q.indices=[];const L=this.Sf();if(L)for(let h=0;h<L.length;h++)q.indices.push(L[h]);let B,N=!1,Z=!1;for(B in this._vertexBuffers){const R=this.getVerticesData(B);if(R&&(R instanceof Float32Array?q.set(new Float32Array(R),B):q.set(R.slice(0),B),!Z)){const R=this.getVertexBuffer(B);R&&(N=R.isUpdatable(),Z=!N)}}const z=new p(R,this._scene,q,N);for(B in z.delayLoadState=this.delayLoadState,z.delayLoadingFile=this.delayLoadingFile,z._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)z._delayInfo=z._delayInfo||[],z._delayInfo.push(B);return z._boundingInfo=new F.b(this._extend.minimum,this._extend.maximum),z}serialize(){const R={};return R.id=this.id,R.uniqueId=this.uniqueId,R.updatable=this._updatable,e.b&&e.b.HasTags(this)&&(R.tags=e.b.GetTags(this)),R}_toNumberArray(R){return Array.isArray(R)?R:Array.prototype.slice.call(R)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const R in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,R)&&(this._vertexBuffers[R]._buffer._data=null)}serializeVerticeData(){const R=this.serialize();return this.isVerticesDataPresent(Z.e.PositionKind)&&(R.xa=this._toNumberArray(this.getVerticesData(Z.e.PositionKind)),this.isVertexBufferUpdatable(Z.e.PositionKind)&&(R.xa._updatable=!0)),this.isVerticesDataPresent(Z.e.NormalKind)&&(R.ya=this._toNumberArray(this.getVerticesData(Z.e.NormalKind)),this.isVertexBufferUpdatable(Z.e.NormalKind)&&(R.ya._updatable=!0)),this.isVerticesDataPresent(Z.e.TangentKind)&&(R.tangents=this._toNumberArray(this.getVerticesData(Z.e.TangentKind)),this.isVertexBufferUpdatable(Z.e.TangentKind)&&(R.tangents._updatable=!0)),this.isVerticesDataPresent(Z.e.UVKind)&&(R.Aa=this._toNumberArray(this.getVerticesData(Z.e.UVKind)),this.isVertexBufferUpdatable(Z.e.UVKind)&&(R.Aa._updatable=!0)),this.isVerticesDataPresent(Z.e.UV2Kind)&&(R.uvs2=this._toNumberArray(this.getVerticesData(Z.e.UV2Kind)),this.isVertexBufferUpdatable(Z.e.UV2Kind)&&(R.uvs2._updatable=!0)),this.isVerticesDataPresent(Z.e.UV3Kind)&&(R.uvs3=this._toNumberArray(this.getVerticesData(Z.e.UV3Kind)),this.isVertexBufferUpdatable(Z.e.UV3Kind)&&(R.uvs3._updatable=!0)),this.isVerticesDataPresent(Z.e.UV4Kind)&&(R.uvs4=this._toNumberArray(this.getVerticesData(Z.e.UV4Kind)),this.isVertexBufferUpdatable(Z.e.UV4Kind)&&(R.uvs4._updatable=!0)),this.isVerticesDataPresent(Z.e.UV5Kind)&&(R.uvs5=this._toNumberArray(this.getVerticesData(Z.e.UV5Kind)),this.isVertexBufferUpdatable(Z.e.UV5Kind)&&(R.uvs5._updatable=!0)),this.isVerticesDataPresent(Z.e.UV6Kind)&&(R.uvs6=this._toNumberArray(this.getVerticesData(Z.e.UV6Kind)),this.isVertexBufferUpdatable(Z.e.UV6Kind)&&(R.uvs6._updatable=!0)),this.isVerticesDataPresent(Z.e.ColorKind)&&(R.za=this._toNumberArray(this.getVerticesData(Z.e.ColorKind)),this.isVertexBufferUpdatable(Z.e.ColorKind)&&(R.za._updatable=!0)),this.isVerticesDataPresent(Z.e.MatricesIndicesKind)&&(R.matricesIndices=this._toNumberArray(this.getVerticesData(Z.e.MatricesIndicesKind)),R.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(Z.e.MatricesIndicesKind)&&(R.matricesIndices._updatable=!0)),this.isVerticesDataPresent(Z.e.MatricesWeightsKind)&&(R.matricesWeights=this._toNumberArray(this.getVerticesData(Z.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(Z.e.MatricesWeightsKind)&&(R.matricesWeights._updatable=!0)),R.indices=this._toNumberArray(this.Sf()),R}static ExtractFromMesh(R,q){const L=R._geometry;return L?L.i(q):null}static RandomId(){return C.f.RandomId()}static _GetGeometryByLoadedUniqueId(R,q){for(let L=0;L<q.geometries.length;L++)if(q.geometries[L]._loadedUniqueId===R)return q.geometries[L];return null}static _ImportGeometry(R,q){const L=q.va(),B=R.geometryUniqueId,h=R.geometryId;if(B||h){const R=B?this._GetGeometryByLoadedUniqueId(B,L):L.getGeometryById(h);R&&R.Ca(q)}else if(R instanceof ArrayBuffer){const L=q._binaryInfo;if(L.positionsAttrDesc&&L.positionsAttrDesc.count>0){const B=new Float32Array(R,L.positionsAttrDesc.offset,L.positionsAttrDesc.count);q.Ga(Z.e.PositionKind,B,!1)}if(L.normalsAttrDesc&&L.normalsAttrDesc.count>0){const B=new Float32Array(R,L.normalsAttrDesc.offset,L.normalsAttrDesc.count);q.Ga(Z.e.NormalKind,B,!1)}if(L.tangetsAttrDesc&&L.tangetsAttrDesc.count>0){const B=new Float32Array(R,L.tangetsAttrDesc.offset,L.tangetsAttrDesc.count);q.Ga(Z.e.TangentKind,B,!1)}if(L.uvsAttrDesc&&L.uvsAttrDesc.count>0){const B=new Float32Array(R,L.uvsAttrDesc.offset,L.uvsAttrDesc.count);if(n.e)for(let R=1;R<B.length;R+=2)B[R]=1-B[R];q.Ga(Z.e.UVKind,B,!1)}if(L.uvs2AttrDesc&&L.uvs2AttrDesc.count>0){const B=new Float32Array(R,L.uvs2AttrDesc.offset,L.uvs2AttrDesc.count);if(n.e)for(let R=1;R<B.length;R+=2)B[R]=1-B[R];q.Ga(Z.e.UV2Kind,B,!1)}if(L.uvs3AttrDesc&&L.uvs3AttrDesc.count>0){const B=new Float32Array(R,L.uvs3AttrDesc.offset,L.uvs3AttrDesc.count);if(n.e)for(let R=1;R<B.length;R+=2)B[R]=1-B[R];q.Ga(Z.e.UV3Kind,B,!1)}if(L.uvs4AttrDesc&&L.uvs4AttrDesc.count>0){const B=new Float32Array(R,L.uvs4AttrDesc.offset,L.uvs4AttrDesc.count);if(n.e)for(let R=1;R<B.length;R+=2)B[R]=1-B[R];q.Ga(Z.e.UV4Kind,B,!1)}if(L.uvs5AttrDesc&&L.uvs5AttrDesc.count>0){const B=new Float32Array(R,L.uvs5AttrDesc.offset,L.uvs5AttrDesc.count);if(n.e)for(let R=1;R<B.length;R+=2)B[R]=1-B[R];q.Ga(Z.e.UV5Kind,B,!1)}if(L.uvs6AttrDesc&&L.uvs6AttrDesc.count>0){const B=new Float32Array(R,L.uvs6AttrDesc.offset,L.uvs6AttrDesc.count);if(n.e)for(let R=1;R<B.length;R+=2)B[R]=1-B[R];q.Ga(Z.e.UV6Kind,B,!1)}if(L.colorsAttrDesc&&L.colorsAttrDesc.count>0){const B=new Float32Array(R,L.colorsAttrDesc.offset,L.colorsAttrDesc.count);q.Ga(Z.e.ColorKind,B,!1,L.colorsAttrDesc.stride)}if(L.matricesIndicesAttrDesc&&L.matricesIndicesAttrDesc.count>0){const B=new Int32Array(R,L.matricesIndicesAttrDesc.offset,L.matricesIndicesAttrDesc.count),N=[];for(let R=0;R<B.length;R++){const q=B[R];N.push(255&q),N.push((65280&q)>>8),N.push((16711680&q)>>16),N.push(q>>24&255)}q.Ga(Z.e.MatricesIndicesKind,N,!1)}if(L.matricesIndicesExtraAttrDesc&&L.matricesIndicesExtraAttrDesc.count>0){const B=new Int32Array(R,L.matricesIndicesExtraAttrDesc.offset,L.matricesIndicesExtraAttrDesc.count),N=[];for(let R=0;R<B.length;R++){const q=B[R];N.push(255&q),N.push((65280&q)>>8),N.push((16711680&q)>>16),N.push(q>>24&255)}q.Ga(Z.e.MatricesIndicesExtraKind,N,!1)}if(L.matricesWeightsAttrDesc&&L.matricesWeightsAttrDesc.count>0){const B=new Float32Array(R,L.matricesWeightsAttrDesc.offset,L.matricesWeightsAttrDesc.count);q.Ga(Z.e.MatricesWeightsKind,B,!1)}if(L.indicesAttrDesc&&L.indicesAttrDesc.count>0){const B=new Int32Array(R,L.indicesAttrDesc.offset,L.indicesAttrDesc.count);q.setIndices(B,null)}if(L.subMeshesAttrDesc&&L.subMeshesAttrDesc.count>0){const B=new Int32Array(R,L.subMeshesAttrDesc.offset,5*L.subMeshesAttrDesc.count);q.Zf=[];for(let R=0;R<L.subMeshesAttrDesc.count;R++){const L=B[5*R+0],N=B[5*R+1],h=B[5*R+2],Z=B[5*R+3],Y=B[5*R+4];z.c.AddToMesh(L,N,h,Z,Y,q)}}}else if(R.xa&&R.ya&&R.indices){if(q.Ga(Z.e.PositionKind,R.xa,R.xa._updatable),q.Ga(Z.e.NormalKind,R.ya,R.ya._updatable),R.tangents&&q.Ga(Z.e.TangentKind,R.tangents,R.tangents._updatable),R.Aa&&q.Ga(Z.e.UVKind,R.Aa,R.Aa._updatable),R.uvs2&&q.Ga(Z.e.UV2Kind,R.uvs2,R.uvs2._updatable),R.uvs3&&q.Ga(Z.e.UV3Kind,R.uvs3,R.uvs3._updatable),R.uvs4&&q.Ga(Z.e.UV4Kind,R.uvs4,R.uvs4._updatable),R.uvs5&&q.Ga(Z.e.UV5Kind,R.uvs5,R.uvs5._updatable),R.uvs6&&q.Ga(Z.e.UV6Kind,R.uvs6,R.uvs6._updatable),R.za&&q.Ga(Z.e.ColorKind,N.g.CheckColors4(R.za,R.xa.length/3),R.za._updatable),R.matricesIndices)if(R.matricesIndices._isExpanded)delete R.matricesIndices._isExpanded,q.Ga(Z.e.MatricesIndicesKind,R.matricesIndices,R.matricesIndices._updatable);else{const L=[];for(let q=0;q<R.matricesIndices.length;q++){const B=R.matricesIndices[q];L.push(255&B),L.push((65280&B)>>8),L.push((16711680&B)>>16),L.push(B>>24&255)}q.Ga(Z.e.MatricesIndicesKind,L,R.matricesIndices._updatable)}if(R.matricesIndicesExtra)if(R.matricesIndicesExtra._isExpanded)delete R.matricesIndices._isExpanded,q.Ga(Z.e.MatricesIndicesExtraKind,R.matricesIndicesExtra,R.matricesIndicesExtra._updatable);else{const L=[];for(let q=0;q<R.matricesIndicesExtra.length;q++){const B=R.matricesIndicesExtra[q];L.push(255&B),L.push((65280&B)>>8),L.push((16711680&B)>>16),L.push(B>>24&255)}q.Ga(Z.e.MatricesIndicesExtraKind,L,R.matricesIndicesExtra._updatable)}R.matricesWeights&&(p._CleanMatricesWeights(R,q),q.Ga(Z.e.MatricesWeightsKind,R.matricesWeights,R.matricesWeights._updatable)),R.matricesWeightsExtra&&q.Ga(Z.e.MatricesWeightsExtraKind,R.matricesWeightsExtra,R.matricesWeights._updatable),q.setIndices(R.indices,null)}if(R.Zf){q.Zf=[];for(let L=0;L<R.Zf.length;L++){const B=R.Zf[L];z.c.AddToMesh(B.materialIndex,B.verticesStart,B.verticesCount,B.indexStart,B.indexCount,q)}}q._shouldGenerateFlatShading&&(q.convertToFlatShadedMesh(),q._shouldGenerateFlatShading=!1),q.Jj(!0),L.onMeshImportedObservable.notifyObservers(q)}static _CleanMatricesWeights(R,q){const L=.001;if(!Y.d.CleanBoneMatrixWeights)return;let B=0;if(!(R.skeletonId>-1))return;{const L=q.va().getLastSkeletonById(R.skeletonId);if(!L)return;B=L.bones.length}const N=q.getVerticesData(Z.e.MatricesIndicesKind),h=q.getVerticesData(Z.e.MatricesIndicesExtraKind),z=R.matricesWeights,F=R.matricesWeightsExtra,C=R.numBoneInfluencer,e=z.length;for(let Z=0;Z<e;Z+=4){let R=0,q=-1;for(let B=0;B<4;B++){const N=z[Z+B];R+=N,N<L&&q<0&&(q=B)}if(F)for(let B=0;B<4;B++){const N=F[Z+B];R+=N,N<L&&q<0&&(q=B+4)}if((q<0||q>C-1)&&(q=C-1),R>L){const q=1/R;for(let R=0;R<4;R++)z[Z+R]*=q;if(F)for(let R=0;R<4;R++)F[Z+R]*=q}else q>=4?(F[Z+q-4]=1-R,h[Z+q-4]=B):(z[Z+q]=1-R,N[Z+q]=B)}q.Ga(Z.e.MatricesIndicesKind,N),R.matricesWeightsExtra&&q.Ga(Z.e.MatricesIndicesExtraKind,h)}static Parse(R,q,L){const N=new p(R.id,q,void 0,R.updatable);return N._loadedUniqueId=R.uniqueId,e.b&&e.b.AddTagsTo(N,R.tags),R.delayLoadingFile?(N.delayLoadState=4,N.delayLoadingFile=L+R.delayLoadingFile,N._boundingInfo=new F.b(B.m.Ig(R.boundingBoxMinimum),B.m.Ig(R.boundingBoxMaximum)),N._delayInfo=[],R.hasUVs&&N._delayInfo.push(Z.e.UVKind),R.hasUVs2&&N._delayInfo.push(Z.e.UV2Kind),R.hasUVs3&&N._delayInfo.push(Z.e.UV3Kind),R.hasUVs4&&N._delayInfo.push(Z.e.UV4Kind),R.hasUVs5&&N._delayInfo.push(Z.e.UV5Kind),R.hasUVs6&&N._delayInfo.push(Z.e.UV6Kind),R.hasColors&&N._delayInfo.push(Z.e.ColorKind),R.hasMatricesIndices&&N._delayInfo.push(Z.e.MatricesIndicesKind),R.hasMatricesWeights&&N._delayInfo.push(Z.e.MatricesWeightsKind),N._delayLoadingFunction=h.d.ImportVertexData):h.d.ImportVertexData(R,N),q.pushGeometry(N,!0),N}}},12079:(R,q,L)=>{"use strict";L.d(q,{d:()=>y});var B=L(11081),N=L(10767),h=L(11375),Z=L(11329),z=L(10774),Y=L(11379),F=L(11136),C=L(10757),e=L(10889);Z.d._instancedMeshFactory=(R,q)=>{const L=new y(R,q);if(q.instancedBuffers){L.instancedBuffers={};for(const R in q.instancedBuffers)L.instancedBuffers[R]=q.instancedBuffers[R]}return L};class y extends h.c{constructor(R,q){super(R,q.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,q.Bj(this),this._sourceMesh=q,this._unIndexed=q._unIndexed,this.position.p(q.position),this.rotation.p(q.rotation),this.Ud.p(q.Ud),q.rotationQuaternion&&(this.rotationQuaternion=q.rotationQuaternion.clone()),this.animations=q.animations.slice();for(const L of q.getAnimationRanges())null!=L&&this.createAnimationRange(L.name,L.from,L.to);this.infiniteDistance=q.infiniteDistance,this.setPivotMatrix(q.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(R){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.receiveShadows)!==R&&C.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(R){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.material)!==R&&C.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(R){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.visibility)!==R&&C.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(R){var q;(null===(q=this._sourceMesh)||void 0===q?void 0:q.skeleton)!==R&&C.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(R){this._sourceMesh&&R!==this._sourceMesh.renderingGroupId&&N.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(R){return this._sourceMesh.createInstance(R)}isReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(R,!0)}getVerticesData(R,q,L){return this._sourceMesh.getVerticesData(R,q,L)}copyVerticesData(R,q){this._sourceMesh.copyVerticesData(R,q)}Ga(R,q,L,B){return this.sourceMesh&&this.sourceMesh.Ga(R,q,L,B),this.sourceMesh}updateVerticesData(R,q,L,B){return this.sourceMesh&&this.sourceMesh.updateVerticesData(R,q,L,B),this.sourceMesh}setIndices(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(R,q),this.sourceMesh}isVerticesDataPresent(R){return this._sourceMesh.isVerticesDataPresent(R)}Sf(){return this._sourceMesh.Sf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let R,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;R="object"===typeof q?q:{applySkeleton:q,applyMorph:L};const B=this._sourceMesh.yj?this._sourceMesh.yj.boundingBias:null;return this.Fa(this._sourceMesh._getData(R,null,F.e.PositionKind),B),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(R,q){if(super._activate(R,q),this._sourceMesh.Zf||N.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,R),q){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==Y.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new B.c);const R=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,B.h.o[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Jj(!0)),this._currentLOD.position.p(B.h.o[7]),this._currentLOD._masterMesh=R,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(R){if(!R)return this;const q=this.sourceMesh.getLODLevels();if(q&&0!==q.length){const q=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(R,q.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(R){return this.sourceMesh._preActivateForIntermediateRendering(R)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Zf)for(let R=0;R<this._sourceMesh.Zf.length;R++)this._sourceMesh.Zf[R].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;const B=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(R);if(z.e.DeepCopy(this,B,["name","Zf","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","kj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),q&&(B.parent=q),!L)for(let N=0;N<this.va().meshes.length;N++){const R=this.va().meshes[N];R.parent===this&&R.clone(R.name,B)}return B.Jj(!0),this.onClonedObservable.notifyObservers(B),B}dispose(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Aj(this),super.dispose(R,q)}_serializeAsParent(R){super._serializeAsParent(R),R.parentId=this._sourceMesh.uniqueId,R.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const B=this.clone("Clone of "+(this.name||this.id),R||this.parent,!0,q&&q.newSourcedMesh);B&&L&&L(this,B);for(const N of this.getChildTransformNodes(!0))N.instantiateHierarchy(B,q,L);return B}}Z.d.prototype.registerInstancedBuffer=function(R,q){var L,B;if(null===(L=this._userInstancedBuffersStorage)||void 0===L||null===(B=L.vertexBuffers[R])||void 0===B||B.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const R of this.instances)R.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[R]=null,this._userInstancedBuffersStorage.strides[R]=q,this._userInstancedBuffersStorage.sizes[R]=32*q,this._userInstancedBuffersStorage.data[R]=new Float32Array(this._userInstancedBuffersStorage.sizes[R]),this._userInstancedBuffersStorage.vertexBuffers[R]=new F.e(this.getEngine(),this._userInstancedBuffersStorage.data[R],R,!0,!1,q,!0);for(const N of this.instances)N.instancedBuffers[R]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Z.d.prototype._processInstancedBuffers=function(R,q){const L=R?R.length:0;for(const B in this.instancedBuffers){let N=this._userInstancedBuffersStorage.sizes[B];const h=this._userInstancedBuffersStorage.strides[B],Z=(L+1)*h;for(;N<Z;)N*=2;this._userInstancedBuffersStorage.data[B].length!=N&&(this._userInstancedBuffersStorage.data[B]=new Float32Array(N),this._userInstancedBuffersStorage.sizes[B]=N,this._userInstancedBuffersStorage.vertexBuffers[B]&&(this._userInstancedBuffersStorage.vertexBuffers[B].dispose(),this._userInstancedBuffersStorage.vertexBuffers[B]=null));const z=this._userInstancedBuffersStorage.data[B];let Y=0;if(q){const R=this.instancedBuffers[B];R.toArray?R.toArray(z,Y):R.copyToArray?R.copyToArray(z,Y):z[Y]=R,Y+=h}for(let q=0;q<L;q++){const L=R[q].instancedBuffers[B];L.toArray?L.toArray(z,Y):L.copyToArray?L.copyToArray(z,Y):z[Y]=L,Y+=h}this._userInstancedBuffersStorage.vertexBuffers[B]?this._userInstancedBuffersStorage.vertexBuffers[B].updateDirectly(z,0):(this._userInstancedBuffersStorage.vertexBuffers[B]=new F.e(this.getEngine(),this._userInstancedBuffersStorage.data[B],B,!0,!1,h,!0),this._invalidateInstanceVertexArrayObject())}},Z.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const R in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[R]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Z.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const R in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[R]&&this._userInstancedBuffersStorage.vertexBuffers[R].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,e.f)("BABYLON.InstancedMesh",y)},11329:(R,q,L)=>{"use strict";L.d(q,{d:()=>W,f:()=>K});var B=L(10760),N=L(10757),h=L(10774),Z=L(11074),z=L(11331),Y=L(11337),F=L(11081),C=L(11112),e=L(11345),y=L(11136),U=L(11357),n=L(11364),r=L(11375),p=L(11218),c=L(11216),d=L(11386),f=L(11371),v=L(11117),T=L(10767),t=L(10889),D=L(10785),S=L(11160);class I{constructor(R,q){this.distanceOrScreenCoverage=R,this.mesh=q}}class K{}class m{constructor(){this.visibleInstances={},this.batchCache=new o,this.batchCacheReplacementModeInFrozenMode=new o,this.instancesBufferSize=2048}}class o{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class l{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class G{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class W extends r.c{static _GetDefaultSideOrientation(R){return R||W.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(R){this._internalMeshDataInfo._useLODScreenCoverage=R,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(R){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==R&&(R&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(y.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(y.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=R,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new B.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new B.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new B.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new B.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new B.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(R){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(R)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(R){this._internalMeshDataInfo._forcedInstanceCount=R}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(R){this._internalMeshDataInfo._sideOrientation=R,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===R||!this._scene.useRightHandedSystem&&0===R}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(R){this.sideOrientation=R,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(R){this._internalMeshDataInfo._overrideRenderingFillMode=R}get material(){return this._internalAbstractMeshDataInfo._material}set material(R){R&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(R.sideOrientation=null),this._setMaterial(R)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(R){this._unIndexed!==R&&(this._unIndexed=R,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(R){this._instanceDataStorage.manualUpdate=R}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(R){this._instanceDataStorage.previousManualUpdate=R}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(R){this._instanceDataStorage.forceMatrixUpdates=R}_copySource(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this.va();if(R._geometry&&R._geometry.Ca(this),h.e.DeepCopy(R,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","yj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","kj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=R,B.useClonedMeshMap&&(R._internalMeshDataInfo.meshMap||(R._internalMeshDataInfo.meshMap={}),R._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=R._originalBuilderSideOrientation,this._creationDataStorage=R._creationDataStorage,R._ranges){const q=R._ranges;for(const R in q)Object.prototype.hasOwnProperty.call(q,R)&&q[R]&&this.createAnimationRange(R,q[R].from,q[R].to)}if(R.metadata&&R.metadata.clone?this.metadata=R.metadata.clone():this.metadata=R.metadata,this._internalMetadata=R._internalMetadata,Z.b&&Z.b.HasTags(R)&&Z.b.AddTagsTo(this,Z.b.GetTags(R,!0)),this.xb(R.isEnabled(!1)),this.parent=R.parent,this.setPivotMatrix(R.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+R.id,this.material=R.material,!q){const q=R.getDescendants(!0);for(let R=0;R<q.length;R++){const L=q[R];L.clone&&L.clone(this.name+"."+L.name,this)}}if(R.morphTargetManager&&(this.morphTargetManager=R.morphTargetManager),B.getPhysicsEngine){const q=B.getPhysicsEngine();if(L&&q)if(1===q.getPluginVersion()){const L=q.getImpostorForPhysicsObject(R);L&&(this.physicsImpostor=L.clone(this))}else 2===q.getPluginVersion()&&R.physicsBody&&R.physicsBody.clone(this)}for(let N=0;N<B.lj.length;N++){const q=B.lj[N];q.j===R&&q.clone(q.name,this)}this.skeleton=R.skeleton,this.refreshBoundingInfo(!0,!0),this.Jj(!0)}constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0,Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(R,q),this._internalMeshDataInfo=new G,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new m,this._thinInstanceDataStorage=new l,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=W.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,q=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(R,q,L)=>{R&&L&&(this._uniformBuffer?this.transferToEffect(q):L.bindOnlyWorldMatrix(q))},N&&this._copySource(N,h,Z),null!==L&&(this.parent=L),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=R=>{R.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new B.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),N&&N.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const B=0===this.getTotalVertices()||q&&q.doNotInstantiate&&(!0===q.doNotInstantiate||q.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),R||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));B.parent=R||this.parent,B.position=this.position.clone(),B.Ud=this.Ud.clone(),this.rotationQuaternion?B.rotationQuaternion=this.rotationQuaternion.clone():B.rotation=this.rotation.clone(),L&&L(this,B);for(const N of this.getChildTransformNodes(!0))"InstancedMesh"===N.getClassName()&&"Mesh"===B.getClassName()&&N.sourceMesh===this?N.instantiateHierarchy(B,{doNotInstantiate:q&&q.doNotInstantiate||!1,newSourcedMesh:B},L):N.instantiateHierarchy(B,q,L);return B}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(R){let q=super.toString(R);if(q+=", n vertices: "+this.getTotalVertices(),q+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let L=0;L<this.animations.length;L++)q+=", animation[0]: "+this.animations[L].toString(R);if(R)if(this._geometry){const R=this.Sf(),L=this.getVerticesData(y.e.PositionKind);L&&R&&(q+=", flat shading: "+(L.length/3===R.length?"YES":"NO"))}else q+=", flat shading: UNKNOWN";return q}_unBindEffect(){super._unBindEffect();for(const R of this.instances)R._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const R=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((q,L)=>q.distanceOrScreenCoverage<L.distanceOrScreenCoverage?R:q.distanceOrScreenCoverage>L.distanceOrScreenCoverage?-R:0))}addLODLevel(R,q){if(q&&q._masterMesh)return T.d.Warn("You cannot use a mesh as LOD level twice"),this;const L=new I(R,q);return this._internalMeshDataInfo._LODLevels.push(L),q&&(q._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(R){const q=this._internalMeshDataInfo;for(let L=0;L<q._LODLevels.length;L++){const B=q._LODLevels[L];if(B.distanceOrScreenCoverage===R)return B.mesh}return null}removeLODLevel(R){const q=this._internalMeshDataInfo;for(let L=0;L<q._LODLevels.length;L++)q._LODLevels[L].mesh===R&&(q._LODLevels.splice(L,1),R&&(R._masterMesh=null));return this._sortLODLevels(),this}getLOD(R,q){const L=this._internalMeshDataInfo;if(!L._LODLevels||0===L._LODLevels.length)return this;const B=q||this.getBoundingInfo().boundingSphere,N=R.mode===Y.d.ORTHOGRAPHIC_CAMERA?R.Ri:B.centerWorld.Bc(R.globalPosition).length();let h=N,Z=1;if(L._useLODScreenCoverage){const q=R.screenArea;let L=B.radiusWorld*R.Ri/N;L=L*L*Math.PI,h=L/q,Z=-1}if(Z*L._LODLevels[L._LODLevels.length-1].distanceOrScreenCoverage>Z*h)return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this;for(let z=0;z<L._LODLevels.length;z++){const R=L._LODLevels[z];if(Z*R.distanceOrScreenCoverage<Z*h){if(R.mesh){if(4===R.mesh.delayLoadState)return R.mesh._checkDelayState(),this;if(2===R.mesh.delayLoadState)return this;R.mesh._preActivate(),R.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,R.mesh),R.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this}get yj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(R,q,L,B){var N,h;if(!this._geometry)return null;let Z=B||null===(N=this._userInstancedBuffersStorage)||void 0===N||null===(h=N.vertexBuffers[R])||void 0===h?void 0:h.getFloatData(this.instances.length+1,L||q&&1!==this._geometry.meshes.length);return Z||(Z=this._geometry.getVerticesData(R,q,L)),Z}copyVerticesData(R,q){this._geometry&&this._geometry.copyVerticesData(R,q)}getVertexBuffer(R,q){var L;return this._geometry?(q||null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[R])??this._geometry.getVertexBuffer(R):null}isVerticesDataPresent(R,q){var L;return this._geometry?!q&&void 0!==(null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[R])||this._geometry.isVerticesDataPresent(R):!!this._delayInfo&&-1!==this._delayInfo.indexOf(R)}isVertexBufferUpdatable(R,q){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(R);if(!q){var L;const q=null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[R];if(q)return q.isUpdatable()}return this._geometry.isVertexBufferUpdatable(R)}getVerticesDataKinds(R){if(!this._geometry){const R=[];return this._delayInfo&&this._delayInfo.forEach((function(q){R.push(q)})),R}const q=this._geometry.getVerticesDataKinds();if(!R&&this._userInstancedBuffersStorage)for(const L in this._userInstancedBuffersStorage.vertexBuffers)-1===q.indexOf(L)&&q.push(L);return q}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Sf(R,q){return this._geometry?this._geometry.Sf(R,q):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(R))return!1;if(!this.Zf||0===this.Zf.length)return!0;if(!R)return!0;const L=this.getEngine(),B=this.va(),N=q||L.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Jj();const h=this.material||B.defaultMaterial;if(h)if(h._storeEffectOnSubMeshes)for(const y of this.Zf){const R=y.Ha();if(R)if(R._storeEffectOnSubMeshes){if(!R.isReadyForSubMesh(this,y,N))return!1}else if(!R.isReady(this,N))return!1}else if(!h.isReady(this,N))return!1;const Z=L.currentRenderPassId;for(const y of this.lightSources){const R=y.getShadowGenerators();if(!R)continue;const q=R.values();for(let B=q.next();!0!==B.done;B=q.next()){var z,Y,F,C;const R=B.value;if(R&&(null===(z=R.getShadowMap())||void 0===z||!z.renderList||null!==(Y=R.getShadowMap())&&void 0!==Y&&Y.renderList&&-1!==(null===(F=R.getShadowMap())||void 0===F||null===(C=F.renderList)||void 0===C?void 0:C.indexOf(this)))){const q=R.getShadowMap().renderPassIds??[L.currentRenderPassId];for(let B=0;B<q.length;++B){L.currentRenderPassId=q[B];for(const q of this.Zf){var e;if(!R.isReady(q,N,(null===(e=q.Ha())||void 0===e?void 0:e.needAlphaBlendingForMesh(this))??!1))return L.currentRenderPassId=Z,!1}}L.currentRenderPassId=Z}}}for(const y of this._internalMeshDataInfo._LODLevels)if(y.mesh&&!y.mesh.isReady(N))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Fh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(R){this._instanceDataStorage.overridenInstanceCount=R}_preActivate(){const R=this._internalMeshDataInfo,q=this.va().getRenderId();return R._preActivateId===q||(R._preActivateId=q,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(R){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=R),this}_registerInstanceForRenderId(R,q){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:q,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[q]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=q,this._instanceDataStorage.visibleInstances[q]=new Array),this._instanceDataStorage.visibleInstances[q].push(R),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let R,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;R="object"===typeof q?q:{applySkeleton:q,applyMorph:L};const B=this.yj?this.yj.boundingBias:null;return this.Fa(this._getData(R,null,y.e.PositionKind),B),this}_createGlobalSubMesh(R){const q=this.getTotalVertices();if(!q||!this.Sf())return null;if(this.Zf&&this.Zf.length>0){const L=this.Sf();if(!L)return null;const B=L.length;let N=!1;if(R)N=!0;else for(const R of this.Zf){if(R.indexStart+R.indexCount>B){N=!0;break}if(R.verticesStart+R.verticesCount>q){N=!0;break}}if(!N)return this.Zf[0]}return this.releaseSubMeshes(),new p.c(0,0,q,0,this.getTotalIndices(),this)}subdivide(R){if(R<1)return;const q=this.getTotalIndices();let L=q/R|0,B=0;for(;L%3!==0;)L++;this.releaseSubMeshes();for(let N=0;N<R&&!(B>=q);N++)p.c.CreateFromIndices(0,B,N===R-1?q-B:L,this,void 0,!1),B+=L;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(R,q,L,B);else{const B=new U.d;B.set(q,R);const N=this.va();new n.b(n.b.RandomId(),N,B,L,this)}return this}removeVerticesData(R){this._geometry&&this._geometry.removeVerticesData(R)}markVerticesDataAsUpdatable(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this.getVertexBuffer(R);L&&L.isUpdatable()!==q&&this.Ga(R,this.getVerticesData(R),q)}setVerticesBuffer(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=n.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(R,null,q),this}updateVerticesData(R,q,L,B){return this._geometry?(B?(this.makeGeometryUnique(),this.updateVerticesData(R,q,L,!1)):this._geometry.updateVerticesData(R,q,L),this):this}updateMeshPositions(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this.getVerticesData(y.e.PositionKind);if(!L)return this;if(R(L),this.updateVerticesData(y.e.PositionKind,L,!1,!1),q){const R=this.Sf(),q=this.getVerticesData(y.e.NormalKind);if(!q)return this;U.d.ComputeNormals(L,R,q),this.updateVerticesData(y.e.NormalKind,q,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const R=this._geometry,q=this._geometry.i(n.b.RandomId());return R.releaseForMesh(this,!0),q.Ca(this),this}setIndexBuffer(R,q,L){let B=this._geometry;B||(B=new n.b(n.b.RandomId(),this.va(),void 0,void 0,this)),B.setIndexBuffer(R,q,L)}setIndices(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(R,q,L,B);else{const q=new U.d;q.indices=R;const B=this.va();new n.b(n.b.RandomId(),B,q,L,this)}return this}updateIndices(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(R,q,L),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(R,q,L){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const N=this.va().getEngine();let h;if(this._unIndexed)if(this._getRenderingFillMode(L)===c.c.WireFrameFillMode)h=R._getLinesIndexBuffer(this.Sf(),N);else h=null;else switch(this._getRenderingFillMode(L)){case c.c.PointFillMode:h=null;break;case c.c.WireFrameFillMode:h=R._getLinesIndexBuffer(this.Sf(),N);break;default:case c.c.TriangleFillMode:h=this._geometry.getIndexBuffer()}return this._bindDirect(q,h,B)}_bindDirect(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(R),L&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(R,q,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(R,q),this):this}_draw(R,q,L){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const B=this.va().getEngine();return this._unIndexed&&q!==c.c.WireFrameFillMode||q==c.c.PointFillMode?B.drawArraysType(q,R.verticesStart,R.verticesCount,this.forcedInstanceCount||L):q==c.c.WireFrameFillMode?B.drawElementsType(q,0,R._linesIndexCount,this.forcedInstanceCount||L):B.drawElementsType(q,R.indexStart,R.indexCount,this.forcedInstanceCount||L),this}registerBeforeRender(R){return this.onBeforeRenderObservable.add(R),this}unregisterBeforeRender(R){return this.onBeforeRenderObservable.removeCallback(R),this}registerAfterRender(R){return this.onAfterRenderObservable.add(R),this}unregisterAfterRender(R){return this.onAfterRenderObservable.removeCallback(R),this}_getInstancesRenderList(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(q)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[R]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[R]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const L=this.va(),B=L._isInIntermediateRendering(),N=B?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,h=this._instanceDataStorage.batchCache;if(h.mustReturn=!1,h.renderSelf[R]=q||!N&&this.isEnabled()&&this.isVisible,h.visibleInstances[R]=null,this._instanceDataStorage.visibleInstances&&!q){const q=this._instanceDataStorage.visibleInstances,N=L.getRenderId(),Z=B?q.intermediateDefaultRenderId:q.defaultRenderId;h.visibleInstances[R]=q[N],!h.visibleInstances[R]&&Z&&(h.visibleInstances[R]=q[Z])}return h.hardwareInstancedRendering[R]=!q&&this._instanceDataStorage.hardwareInstancedRendering&&null!==h.visibleInstances[R]&&void 0!==h.visibleInstances[R],this._instanceDataStorage.previousBatch=h,h}_renderWithInstances(R,q,L,B,N){const h=L.visibleInstances[R._id],Z=h?h.length:0,z=this._instanceDataStorage,Y=z.instancesBufferSize;let C=z.instancesBuffer,e=z.instancesPreviousBuffer;const U=16*(Z+1)*4;for(;z.instancesBufferSize<U;)z.instancesBufferSize*=2;z.instancesData&&Y==z.instancesBufferSize||(z.instancesData=new Float32Array(z.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!z.instancesPreviousData||Y!=z.instancesBufferSize)&&(z.instancesPreviousData=new Float32Array(z.instancesBufferSize/4));let n=0,r=0;const p=L.renderSelf[R._id],c=!C||Y!==z.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!z.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||z.isFrozen&&!c)r=(p?1:0)+Z;else{const q=this.getWorldMatrix();if(p&&(this._scene.needsPreviousWorldMatrices&&(z.masterMeshPreviousWorldMatrix?(z.masterMeshPreviousWorldMatrix.copyToArray(z.instancesPreviousData,n),z.masterMeshPreviousWorldMatrix.p(q)):(z.masterMeshPreviousWorldMatrix=q.clone(),z.masterMeshPreviousWorldMatrix.copyToArray(z.instancesPreviousData,n))),q.copyToArray(z.instancesData,n),n+=16,r++),h){var d;if(W.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(d=R.Ha())&&void 0!==d&&d.needAlphaBlendingForMesh(R.getRenderingMesh())){const R=this._scene.activeCamera.globalPosition;for(let q=0;q<h.length;q++){const L=h[q];L._distanceToCamera=F.m.Distance(L.getBoundingInfo().boundingSphere.centerWorld,R)}h.sort(((R,q)=>R._distanceToCamera>q._distanceToCamera?-1:R._distanceToCamera<q._distanceToCamera?1:0))}for(let R=0;R<h.length;R++){const q=h[R],L=q.getWorldMatrix();L.copyToArray(z.instancesData,n),this._scene.needsPreviousWorldMatrices&&(q._previousWorldMatrix?(q._previousWorldMatrix.copyToArray(z.instancesPreviousData,n),q._previousWorldMatrix.p(L)):(q._previousWorldMatrix=L.clone(),q._previousWorldMatrix.copyToArray(z.instancesPreviousData,n))),n+=16,r++}}}return c?(C&&C.dispose(),e&&e.dispose(),C=new y.d(N,z.instancesData,!0,16,!1,!0),z.instancesBuffer=C,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=C.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=C.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=C.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=C.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(e=new y.d(N,z.instancesPreviousData,!0,16,!1,!0),z.instancesPreviousBuffer=e,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=e.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=e.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=e.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=e.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(C.updateDirectly(z.instancesData,0,r),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||e.updateDirectly(z.instancesPreviousData,0,r)),this._processInstancedBuffers(h,p),this.va()._activeIndices.addCount(R.indexCount*r,!1),N._currentDrawContext&&(N._currentDrawContext.useInstancing=!0),this._bind(R,B,q),this._draw(R,q,r),!this._scene.needsPreviousWorldMatrices||c||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||e.updateDirectly(z.instancesData,0,r),N.unbindInstanceAttributes(),this}_renderWithThinInstances(R,q,L,B){var N;const h=(null===(N=this._thinInstanceDataStorage)||void 0===N?void 0:N.instancesCount)??0;this.va()._activeIndices.addCount(R.indexCount*h,!1),B._currentDrawContext&&(B._currentDrawContext.useInstancing=!0),this._bind(R,L,q),this._draw(R,q,h),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,h):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),B.unbindInstanceAttributes()}_processInstancedBuffers(R,q){}_processRendering(R,q,L,B,N,h,Z,z){const Y=this.va(),F=Y.getEngine();if(B=this._getRenderingFillMode(B),h&&q.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(q,B,L,F),this;if(h)this._renderWithInstances(q,B,N,L,F);else{F._currentDrawContext&&(F._currentDrawContext.useInstancing=!1);let L=0;N.renderSelf[q._id]&&(Z&&Z(!1,R.getWorldMatrix(),z),L++,this._draw(q,B,this._instanceDataStorage.overridenInstanceCount));const h=N.visibleInstances[q._id];if(h){const R=h.length;L+=R;for(let L=0;L<R;L++){const R=h[L].getWorldMatrix();Z&&Z(!0,R,z),this._draw(q,B)}}Y._activeIndices.addCount(q.indexCount*L,!1)}return this}_rebuild(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(R&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const q in this._userInstancedBuffersStorage.vertexBuffers){const L=this._userInstancedBuffersStorage.vertexBuffers[q];L&&(R&&L.dispose(),this._userInstancedBuffersStorage.vertexBuffers[q]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(R)}_freeze(){if(this.Zf){for(let R=0;R<this.Zf.length;R++)this._getInstancesRenderList(R);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(R,q,L,B){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const h=this._scene.getEngine(),Z=h.currentRenderPassId;if(void 0!==R&&(h.currentRenderPassId=R),B)(!N||N&&B.isInFrustum(this._scene._frustumPlanes))&&this.render(B,!!q,L);else for(let z=0;z<this.Zf.length;z++){const R=this.Zf[z];(!N||N&&R.isInFrustum(this._scene._frustumPlanes))&&this.render(R,!!q,L)}return void 0!==R&&(h.currentRenderPassId=Z),this}directRender(){if(!this.Zf)return this;for(const R of this.Zf)this.render(R,!1);return this}render(R,q,L){var B,N,h;const Z=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const z=(null===(B=Z.activeCameras)||void 0===B?void 0:B.length)??0;if((z>1&&Z.activeCamera===Z.activeCameras[0]||z<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const Y=this._getInstancesRenderList(R._id,!!L);if(Y.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const F=Z.getEngine();let C=0,e=null;this.ignoreCameraMaxZ&&Z.activeCamera&&!Z._isInIntermediateRendering()&&(C=Z.activeCamera.maxZ,e=Z.activeCamera,Z.activeCamera.maxZ=0,Z.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const y=R.getRenderingMesh(),U=Y.hardwareInstancedRendering[R._id]||y.hasThinInstances||!!this._userInstancedBuffersStorage&&!R.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,n=this._instanceDataStorage,r=R.Ha();if(!r)return e&&(e.maxZ=C,Z.updateTransformMatrix(!0)),this;if(n.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===r){if(r._storeEffectOnSubMeshes&&(null===(N=R._drawWrapper)||void 0===N||!N._wasPreviouslyReady)||!r._storeEffectOnSubMeshes&&!r._getDrawWrapper()._wasPreviouslyReady)return e&&(e.maxZ=C,Z.updateTransformMatrix(!0)),this}else{if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(this,R,U))return e&&(e.maxZ=C,Z.updateTransformMatrix(!0)),this}else if(!r.isReady(this,U))return e&&(e.maxZ=C,Z.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=r}let p;q&&F.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),p=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?R._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const d=(null===(h=p)||void 0===h?void 0:h.effect)??null;for(const c of Z._beforeRenderingMeshStage)c.action(this,R,Y,d);if(!p||!d)return e&&(e.maxZ=C,Z.updateTransformMatrix(!0)),this;const f=L||this;let v;if(n.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Pg&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)v=n.sideOrientation;else{const R=f._getWorldMatrixDeterminant();v=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),R<0&&(v=v===c.c.ClockWiseSideOrientation?c.c.CounterClockWiseSideOrientation:c.c.ClockWiseSideOrientation),n.sideOrientation=v}const T=this._internalMeshDataInfo._effectiveMaterial._preBind(p,v);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&F.setDepthWrite(!0);const t=this._internalMeshDataInfo._effectiveMaterial,D=t.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),U||this._bind(R,d,D,!1);const S=f.getWorldMatrix();t._storeEffectOnSubMeshes?t.bindForSubMesh(S,this,R):t.bind(S,this),!t.Pg&&t.separateCullingPass&&(F.setState(!0,t.zOffset,!1,!T,t.cullBackFaces,t.stencil,t.zOffsetUnits),this._processRendering(this,R,d,D,Y,U,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),F.setState(!0,t.zOffset,!1,T,t.cullBackFaces,t.stencil,t.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(R)),this._processRendering(this,R,d,D,Y,U,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const c of Z._afterRenderingMeshStage)c.action(this,R,Y,d);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),e&&(e.maxZ=C,Z.updateTransformMatrix(!0)),2!==Z.performancePriority||n.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(y.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(y.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const R=this.getVerticesData(y.e.MatricesWeightsKind),q=R.length;for(let L=0;L<q;L+=4){const q=R[L]+R[L+1]+R[L+2]+R[L+3];if(0===q)R[L]=1;else{const B=1/q;R[L]*=B,R[L+1]*=B,R[L+2]*=B,R[L+3]*=B}}this.Ga(y.e.MatricesWeightsKind,R)}_normalizeSkinWeightsAndExtra(){const R=this.getVerticesData(y.e.MatricesWeightsExtraKind),q=this.getVerticesData(y.e.MatricesWeightsKind),L=q.length;for(let B=0;B<L;B+=4){let L=q[B]+q[B+1]+q[B+2]+q[B+3];if(L+=R[B]+R[B+1]+R[B+2]+R[B+3],0===L)q[B]=1;else{const N=1/L;q[B]*=N,q[B+1]*=N,q[B+2]*=N,q[B+3]*=N,R[B]*=N,R[B+1]*=N,R[B+2]*=N,R[B+3]*=N}}this.Ga(y.e.MatricesWeightsKind,q),this.Ga(y.e.MatricesWeightsKind,R)}validateSkinning(){const R=this.getVerticesData(y.e.MatricesWeightsExtraKind),q=this.getVerticesData(y.e.MatricesWeightsKind);if(null===q||null==this.skeleton)return{skinned:!1,valid:!0,dm:"not skinned"};const L=q.length;let B=0,N=0,h=0,Z=0;const z=null===R?4:8,Y=[];for(let y=0;y<=z;y++)Y[y]=0;for(let y=0;y<L;y+=4){let L=q[y],F=L,C=0===F?0:1;for(let N=1;N<z;N++){const h=N<4?q[y+N]:R[y+N-4];h>L&&B++,0!==h&&C++,F+=h,L=h}if(Y[C]++,C>h&&(h=C),0===F)N++;else{const L=1/F;let B=0;for(let N=0;N<z;N++)B+=N<4?Math.abs(q[y+N]-q[y+N]*L):Math.abs(R[y+N-4]-R[y+N-4]*L);B>.001&&Z++}}const F=this.skeleton.bones.length,C=this.getVerticesData(y.e.MatricesIndicesKind),e=this.getVerticesData(y.e.MatricesIndicesExtraKind);let U=0;for(let y=0;y<L;y+=4)for(let R=0;R<z;R++){const q=R<4?C[y+R]:e[y+R-4];(q>=F||q<0)&&U++}return{skinned:!0,valid:0===N&&0===Z&&0===U,dm:"Number of Weights = "+L/4+"\nMaximum influences = "+h+"\nMissing Weights = "+N+"\nNot Sorted = "+B+"\nNot Normalized = "+Z+"\nWeightCounts = ["+Y+"]\nNumber of bones = "+F+"\nBad Bone Indices = "+U}}_checkDelayState(){const R=this.va();return this._geometry?this._geometry.load(R):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(R)),this}_queueLoad(R){R.addPendingData(this);const q=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return N.f.LoadFile(this.delayLoadingFile,(q=>{q instanceof ArrayBuffer?this._delayLoadingFunction(q,this):this._delayLoadingFunction(JSON.parse(q),this),this.instances.forEach((R=>{R.refreshBoundingInfo(),R._syncSubMeshes()})),this.delayLoadState=1,R.removePendingData(this)}),(()=>{}),R.offlineProvider,q),this}isInFrustum(R){return 2!==this.delayLoadState&&(!!super.isInFrustum(R)&&(this._checkDelayState(),!0))}setMaterialById(R){const q=this.va().materials;let L;for(L=q.length-1;L>-1;L--)if(q[L].id===R)return this.material=q[L],this;const B=this.va().multiMaterials;for(L=B.length-1;L>-1;L--)if(B[L].id===R)return this.material=B[L],this;return this}getAnimatables(){const R=[];return this.material&&R.push(this.material),this.skeleton&&R.push(this.skeleton),R}bakeTransformIntoVertices(R){if(!this.isVerticesDataPresent(y.e.PositionKind))return this;const q=this.Zf.splice(0);this._resetPointsArrayCache();let L=this.getVerticesData(y.e.PositionKind);const B=F.m.Zero();let N;for(N=0;N<L.length;N+=3)F.m.TransformCoordinatesFromFloatsToRef(L[N],L[N+1],L[N+2],R,B).toArray(L,N);if(this.Ga(y.e.PositionKind,L,this.getVertexBuffer(y.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(y.e.NormalKind)){for(L=this.getVerticesData(y.e.NormalKind),N=0;N<L.length;N+=3)F.m.TransformNormalFromFloatsToRef(L[N],L[N+1],L[N+2],R,B).normalize().toArray(L,N);this.Ga(y.e.NormalKind,L,this.getVertexBuffer(y.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(y.e.TangentKind)){for(L=this.getVerticesData(y.e.TangentKind),N=0;N<L.length;N+=4)F.m.TransformNormalFromFloatsToRef(L[N],L[N+1],L[N+2],R,B).normalize().toArray(L,N);this.Ga(y.e.TangentKind,L,this.getVertexBuffer(y.e.TangentKind).isUpdatable())}return R.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Zf=q,this}bakeCurrentTransformIntoVertices(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Jj(!0)),this.resetLocalMatrix(R),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),R,this,q,L)}dispose(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const L=this._internalMeshDataInfo;if(L._onBeforeDrawObservable&&L._onBeforeDrawObservable.clear(),L._onBeforeBindObservable&&L._onBeforeBindObservable.clear(),L._onBeforeRenderObservable&&L._onBeforeRenderObservable.clear(),L._onAfterRenderObservable&&L._onAfterRenderObservable.clear(),L._onBetweenPassObservable&&L._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(L.meshMap)for(const R in L.meshMap){const q=L.meshMap[R];q&&(q._internalMeshDataInfo._source=null,L.meshMap[R]=void 0)}L._source&&L._source._internalMeshDataInfo.meshMap&&(L._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const R=this.va().meshes;for(const q of R){const R=q;R._internalMeshDataInfo&&R._internalMeshDataInfo._source&&R._internalMeshDataInfo._source===this&&(R._internalMeshDataInfo._source=null)}}L._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(R,q)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(R,q,L,B,h,Z){let z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0;const F=this.va();return N.f.LoadImage(R,(R=>{const N=R.width,Y=R.height,F=this.getEngine().createCanvas(N,Y).getContext("2d");F.drawImage(R,0,0);const C=F.getImageData(0,0,N,Y).data;this.applyDisplacementMapFromBuffer(C,N,Y,q,L,h,Z,z),B&&B(this)}),Y||(()=>{}),F.offlineProvider),this}applyDisplacementMapFromBuffer(R,q,L,B,N,h,Z){let z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(y.e.PositionKind)||!this.isVerticesDataPresent(y.e.NormalKind)||!this.isVerticesDataPresent(y.e.UVKind))return T.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const Y=this.getVerticesData(y.e.PositionKind,!0,!0),C=this.getVerticesData(y.e.NormalKind),e=this.getVerticesData(y.e.UVKind);let n=F.m.Zero();const r=F.m.Zero(),p=F.i.Zero();h=h||F.i.Zero(),Z=Z||new F.i(1,1);for(let y=0;y<Y.length;y+=3){F.m.FromArrayToRef(Y,y,n),F.m.FromArrayToRef(C,y,r),F.i.FromArrayToRef(e,y/3*2,p);const z=4*((Math.abs(p.x*Z.x+h.x%1)*(q-1)%q|0)+(Math.abs(p.y*Z.y+h.y%1)*(L-1)%L|0)*q),U=.3*(R[z]/255)+.59*(R[z+1]/255)+.11*(R[z+2]/255);r.normalize(),r.scaleInPlace(B+(N-B)*U),n=n.add(r),n.toArray(Y,y)}return U.d.ComputeNormals(Y,this.Sf(),C),z?(this.Ga(y.e.PositionKind,Y),this.Ga(y.e.NormalKind,C),this.Ga(y.e.UVKind,e)):(this.updateVerticesData(y.e.PositionKind,Y),this.updateVerticesData(y.e.NormalKind,C)),this}_getFlattenedNormals(R,q){const L=new Float32Array(3*R.length);let B=0;const N=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let h=0;h<R.length;h+=3){const Z=F.m.Ig(q,3*R[h]),z=F.m.Ig(q,3*R[h+1]),Y=F.m.Ig(q,3*R[h+2]),C=Z.Bc(z),e=Y.Bc(z),y=F.m.Normalize(F.m.Cross(C,e));N&&y.scaleInPlace(-1);for(let R=0;R<3;R++)L[B++]=y.x,L[B++]=y.y,L[B++]=y.z}return L}_convertToUnIndexedMesh(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this.getVerticesDataKinds().filter((R=>{var q;return!(null!==(q=this.getVertexBuffer(R))&&void 0!==q&&q.getIsInstanced())})),L=this.Sf(),B={},N=(R,q)=>{const B=new Float32Array(L.length*q);let N=0;for(let h=0;h<L.length;h++)for(let Z=0;Z<q;Z++)B[N++]=R[L[h]*q+Z];return B},h=this.getBoundingInfo(),Z=this.yj?this.Zf.slice(0):[];for(const z of q)B[z]=this.getVerticesData(z);for(const z of q){const q=this.getVertexBuffer(z),h=q.getSize();if(R&&z===y.e.NormalKind){const R=this._getFlattenedNormals(L,B[y.e.PositionKind]);this.Ga(y.e.NormalKind,R,q.isUpdatable(),h)}else this.Ga(z,N(B[z],h),q.isUpdatable(),h)}if(this.morphTargetManager){for(let q=0;q<this.morphTargetManager.numTargets;q++){const B=this.morphTargetManager.getTarget(q),h=B.getPositions();B.setPositions(N(h,3));const Z=B.getNormals();Z&&B.setNormals(R?this._getFlattenedNormals(L,h):N(Z,3));const z=B.getTangents();z&&B.setTangents(N(z,3));const Y=B.getUVs();Y&&B.setUVs(N(Y,2))}this.morphTargetManager.synchronize()}for(let z=0;z<L.length;z++)L[z]=z;this.setIndices(L),this._unIndexed=!0,this.releaseSubMeshes();for(const z of Z){const R=z.getBoundingInfo();p.c.AddToMesh(z.materialIndex,z.indexStart,z.indexCount,z.indexStart,z.indexCount,this).setBoundingInfo(R)}return this.setBoundingInfo(h),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=U.d.ExtractFromMesh(this);let L;if(R&&this.isVerticesDataPresent(y.e.NormalKind)&&q.ya){for(L=0;L<q.ya.length;L++)q.ya[L]*=-1;this.Ga(y.e.NormalKind,q.ya,this.isVertexBufferUpdatable(y.e.NormalKind))}if(q.indices){let R;for(L=0;L<q.indices.length;L+=3)R=q.indices[L+1],q.indices[L+1]=q.indices[L+2],q.indices[L+2]=R;this.setIndices(q.indices,null,this.isVertexBufferUpdatable(y.e.PositionKind),!0)}return this}increaseVertices(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const q=U.d.ExtractFromMesh(this),L=q.indices&&!Array.isArray(q.indices)&&Array.from?Array.from(q.indices):q.indices,B=q.xa&&!Array.isArray(q.xa)&&Array.from?Array.from(q.xa):q.xa,N=q.Aa&&!Array.isArray(q.Aa)&&Array.from?Array.from(q.Aa):q.Aa,h=q.ya&&!Array.isArray(q.ya)&&Array.from?Array.from(q.ya):q.ya;if(L&&B){q.indices=L,q.xa=B,N&&(q.Aa=N),h&&(q.ya=h);const Z=R+1,z=new Array;for(let R=0;R<Z+1;R++)z[R]=new Array;let Y,C;const e=new F.m(0,0,0),U=new F.m(0,0,0),n=new F.i(0,0),r=new Array,p=new Array,c=new Array;let d,f,v,T=B.length;N&&(f=N.length),h&&(v=h.length);for(let R=0;R<L.length;R+=3){p[0]=L[R],p[1]=L[R+1],p[2]=L[R+2];for(let R=0;R<3;R++)if(Y=p[R],C=p[(R+1)%3],void 0===c[Y]&&void 0===c[C]?(c[Y]=new Array,c[C]=new Array):(void 0===c[Y]&&(c[Y]=new Array),void 0===c[C]&&(c[C]=new Array)),void 0===c[Y][C]&&void 0===c[C][Y]){c[Y][C]=[],e.x=(B[3*C]-B[3*Y])/Z,e.y=(B[3*C+1]-B[3*Y+1])/Z,e.z=(B[3*C+2]-B[3*Y+2])/Z,h&&(U.x=(h[3*C]-h[3*Y])/Z,U.y=(h[3*C+1]-h[3*Y+1])/Z,U.z=(h[3*C+2]-h[3*Y+2])/Z),N&&(n.x=(N[2*C]-N[2*Y])/Z,n.y=(N[2*C+1]-N[2*Y+1])/Z),c[Y][C].push(Y);for(let R=1;R<Z;R++)c[Y][C].push(B.length/3),B[T++]=B[3*Y]+R*e.x,B[T++]=B[3*Y+1]+R*e.y,B[T++]=B[3*Y+2]+R*e.z,h&&(h[v++]=h[3*Y]+R*U.x,h[v++]=h[3*Y+1]+R*U.y,h[v++]=h[3*Y+2]+R*U.z),N&&(N[f++]=N[2*Y]+R*n.x,N[f++]=N[2*Y+1]+R*n.y);c[Y][C].push(C),c[C][Y]=new Array,d=c[Y][C].length;for(let R=0;R<d;R++)c[C][Y][R]=c[Y][C][d-1-R]}z[0][0]=L[R],z[1][0]=c[L[R]][L[R+1]][1],z[1][1]=c[L[R]][L[R+2]][1];for(let q=2;q<Z;q++){z[q][0]=c[L[R]][L[R+1]][q],z[q][q]=c[L[R]][L[R+2]][q],e.x=(B[3*z[q][q]]-B[3*z[q][0]])/q,e.y=(B[3*z[q][q]+1]-B[3*z[q][0]+1])/q,e.z=(B[3*z[q][q]+2]-B[3*z[q][0]+2])/q,h&&(U.x=(h[3*z[q][q]]-h[3*z[q][0]])/q,U.y=(h[3*z[q][q]+1]-h[3*z[q][0]+1])/q,U.z=(h[3*z[q][q]+2]-h[3*z[q][0]+2])/q),N&&(n.x=(N[2*z[q][q]]-N[2*z[q][0]])/q,n.y=(N[2*z[q][q]+1]-N[2*z[q][0]+1])/q);for(let R=1;R<q;R++)z[q][R]=B.length/3,B[T++]=B[3*z[q][0]]+R*e.x,B[T++]=B[3*z[q][0]+1]+R*e.y,B[T++]=B[3*z[q][0]+2]+R*e.z,h&&(h[v++]=h[3*z[q][0]]+R*U.x,h[v++]=h[3*z[q][0]+1]+R*U.y,h[v++]=h[3*z[q][0]+2]+R*U.z),N&&(N[f++]=N[2*z[q][0]]+R*n.x,N[f++]=N[2*z[q][0]+1]+R*n.y)}z[Z]=c[L[R+1]][L[R+2]],r.push(z[0][0],z[1][0],z[1][1]);for(let R=1;R<Z;R++){let q;for(q=0;q<R;q++)r.push(z[R][q],z[R+1][q],z[R+1][q+1]),r.push(z[R][q],z[R+1][q+1],z[R][q+1]);r.push(z[R][q],z[R+1][q],z[R+1][q+1])}}q.indices=r,q.Ca(this,this.isVertexBufferUpdatable(y.e.PositionKind))}else T.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const R=U.d.ExtractFromMesh(this),q=R.Aa,L=R.indices,B=R.xa,N=R.za,h=R.matricesIndices,Z=R.matricesWeights,z=R.matricesIndicesExtra,Y=R.matricesWeightsExtra;if(void 0===L||void 0===B||null===L||null===B)T.d.Warn("VertexData contains empty entries");else{const F=new Array,C=new Array,e=new Array,n=new Array,r=new Array,p=new Array,c=new Array,d=new Array;let f=new Array,v=0;const T={};let t,D;for(let R=0;R<L.length;R+=3){D=[L[R],L[R+1],L[R+2]],f=[];for(let R=0;R<3;R++){f[R]="";for(let q=0;q<3;q++)Math.abs(B[3*D[R]+q])<1e-8&&(B[3*D[R]+q]=0),f[R]+=B[3*D[R]+q]+"|"}if(f[0]!=f[1]&&f[0]!=f[2]&&f[1]!=f[2])for(let R=0;R<3;R++){if(t=T[f[R]],void 0===t){T[f[R]]=v,t=v++;for(let q=0;q<3;q++)F.push(B[3*D[R]+q]);if(null!==N&&void 0!==N)for(let q=0;q<4;q++)n.push(N[4*D[R]+q]);if(null!==q&&void 0!==q)for(let L=0;L<2;L++)e.push(q[2*D[R]+L]);if(null!==h&&void 0!==h)for(let q=0;q<4;q++)r.push(h[4*D[R]+q]);if(null!==Z&&void 0!==Z)for(let q=0;q<4;q++)p.push(Z[4*D[R]+q]);if(null!==z&&void 0!==z)for(let q=0;q<4;q++)c.push(z[4*D[R]+q]);if(null!==Y&&void 0!==Y)for(let q=0;q<4;q++)d.push(Y[4*D[R]+q])}C.push(t)}}const S=new Array;U.d.ComputeNormals(F,C,S),R.xa=F,R.indices=C,R.ya=S,null!==q&&void 0!==q&&(R.Aa=e),null!==N&&void 0!==N&&(R.za=n),null!==h&&void 0!==h&&(R.matricesIndices=r),null!==Z&&void 0!==Z&&(R.matricesWeights=p),null!==z&&void 0!==z&&(R.matricesIndicesExtra=c),null!==Z&&void 0!==Z&&(R.matricesWeightsExtra=d),R.Ca(this,this.isVertexBufferUpdatable(y.e.PositionKind))}}static _instancedMeshFactory(R,q){throw(0,D.d)("InstancedMesh")}static _PhysicsImpostorParser(R,q,L){throw(0,D.d)("PhysicsImpostor")}createInstance(R){const q=W._instancedMeshFactory(R,this);return q.parent=this.parent,q}synchronizeInstances(){for(let R=0;R<this.instances.length;R++){this.instances[R]._syncSubMeshes()}return this}optimizeIndices(R){const q=this.Sf(),L=this.getVerticesData(y.e.PositionKind);if(!L||!q)return this;const B=[];for(let N=0;N<L.length;N+=3)B.push(F.m.Ig(L,N));const h=[];return N.e.SyncAsyncForLoop(B.length,40,(R=>{const q=B.length-1-R,L=B[q];for(let N=0;N<q;++N){const R=B[N];if(L.equals(R)){h[q]=N;break}}}),(()=>{for(let R=0;R<q.length;++R)q[R]=h[q[R]]||q[R];const L=this.Zf.slice(0);this.setIndices(q),this.Zf=L,R&&R(this)})),this}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.name=this.name,R.id=this.id,R.uniqueId=this.uniqueId,R.type=this.getClassName(),Z.b&&Z.b.HasTags(this)&&(R.tags=Z.b.GetTags(this)),R.position=this.position.dj(),this.rotationQuaternion?R.rotationQuaternion=this.rotationQuaternion.dj():this.rotation&&(R.rotation=this.rotation.dj()),R.Ud=this.Ud.dj(),this._postMultiplyPivotMatrix?R.pivotMatrix=this.getPivotMatrix().dj():R.localMatrix=this.getPivotMatrix().dj(),R.isEnabled=this.isEnabled(!1),R.isVisible=this.isVisible,R.infiniteDistance=this.infiniteDistance,R.pickable=this.ub,R.receiveShadows=this.receiveShadows,R.billboardMode=this.billboardMode,R.visibility=this.visibility,R.sb=this.sb,R.checkCollisions=this.checkCollisions,R.ellipsoid=this.ellipsoid.dj(),R.ellipsoidOffset=this.ellipsoidOffset.dj(),R.Da=this.Da,R.isBlocker=this.isBlocker,R.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(R),R.isUnIndexed=this.isUnIndexed;const q=this._geometry;if(q&&this.Zf){R.geometryUniqueId=q.uniqueId,R.geometryId=q.id,R.Zf=[];for(let q=0;q<this.Zf.length;q++){const L=this.Zf[q];R.Zf.push({materialIndex:L.materialIndex,verticesStart:L.verticesStart,verticesCount:L.verticesCount,indexStart:L.indexStart,indexCount:L.indexCount})}}if(this.material?this.material.doNotSerialize||(R.materialUniqueId=this.material.uniqueId,R.materialId=this.material.id):(this.material=null,R.materialUniqueId=this._scene.defaultMaterial.uniqueId,R.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(R.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(R.skeletonId=this.skeleton.id,R.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(S.d.NAME_PHYSICSENGINE)){const q=this.getPhysicsImpostor();q&&(R.physicsMass=q.getParam("mass"),R.physicsFriction=q.getParam("friction"),R.physicsRestitution=q.getParam("mass"),R.physicsImpostor=q.type)}this.metadata&&(R.metadata=this.metadata),R.instances=[];for(let L=0;L<this.instances.length;L++){const q=this.instances[L];if(q.doNotSerialize)continue;const B={name:q.name,id:q.id,isEnabled:q.isEnabled(!1),isVisible:q.isVisible,ub:q.ub,checkCollisions:q.checkCollisions,position:q.position.dj(),Ud:q.Ud.dj()};if(q.parent&&q.parent._serializeAsParent(B),q.rotationQuaternion?B.rotationQuaternion=q.rotationQuaternion.dj():q.rotation&&(B.rotation=q.rotation.dj()),this.va()._getComponent(S.d.NAME_PHYSICSENGINE)){const R=q.getPhysicsImpostor();R&&(B.physicsMass=R.getParam("mass"),B.physicsFriction=R.getParam("friction"),B.physicsRestitution=R.getParam("mass"),B.physicsImpostor=R.type)}q.metadata&&(B.metadata=q.metadata),q.actionManager&&(B.actions=q.actionManager.serialize(q.name)),R.instances.push(B),v.b.AppendSerializedAnimations(q,B),B.ranges=q.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(R.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const q={data:{},sizes:{},strides:{}};for(const R in this._userThinInstanceBuffersStorage.data)q.data[R]=Array.from(this._userThinInstanceBuffersStorage.data[R]),q.sizes[R]=this._userThinInstanceBuffersStorage.sizes[R],q.strides[R]=this._userThinInstanceBuffersStorage.strides[R];R.thinInstances.userThinInstance=q}return v.b.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.layerMask=this.layerMask,R.alphaIndex=this.alphaIndex,R.hasVertexAlpha=this.hasVertexAlpha,R.overlayAlpha=this.overlayAlpha,R.overlayColor=this.overlayColor.dj(),R.renderOverlay=this.renderOverlay,R.applyFog=this.applyFog,this.actionManager&&(R.actions=this.actionManager.serialize(this.name)),R}_syncGeometryWithMorphTargetManager(){if(!this.yj)return;this._markSubMeshesAsAttributesDirty();const R=this._internalAbstractMeshDataInfo._morphTargetManager;if(R&&R.vertexCount){if(R.vertexCount!==this.getTotalVertices())return T.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(R.isUsingTextureForTargets)return;for(let q=0;q<R.numInfluencers;q++){const L=R.getActiveTarget(q),B=L.getPositions();if(!B)return void T.d.Error("Invalid morph target. Target must have positions.");this.yj.Ga(y.e.PositionKind+q,B,!1,3);const N=L.getNormals();N&&this.yj.Ga(y.e.NormalKind+q,N,!1,3);const h=L.getTangents();h&&this.yj.Ga(y.e.TangentKind+q,h,!1,3);const Z=L.getUVs();Z&&this.yj.Ga(y.e.UVKind+"_"+q,Z,!1,2)}}else{let R=0;for(;this.yj.isVerticesDataPresent(y.e.PositionKind+R);)this.yj.removeVerticesData(y.e.PositionKind+R),this.yj.isVerticesDataPresent(y.e.NormalKind+R)&&this.yj.removeVerticesData(y.e.NormalKind+R),this.yj.isVerticesDataPresent(y.e.TangentKind+R)&&this.yj.removeVerticesData(y.e.TangentKind+R),this.yj.isVerticesDataPresent(y.e.UVKind+R)&&this.yj.removeVerticesData(y.e.UVKind+"_"+R),R++}}static Parse(R,q,L){let B;if(B=R.type&&"LinesMesh"===R.type?W._LinesMeshParser(R,q):R.type&&"GroundMesh"===R.type?W._GroundMeshParser(R,q):R.type&&"GoldbergMesh"===R.type?W._GoldbergMeshParser(R,q):R.type&&"GreasedLineMesh"===R.type?W._GreasedLineMeshParser(R,q):R.type&&"TrailMesh"===R.type?W._TrailMeshParser(R,q):new W(R.name,q),B.id=R.id,B._waitingParsedUniqueId=R.uniqueId,Z.b&&Z.b.AddTagsTo(B,R.tags),B.position=F.m.Ig(R.position),void 0!==R.metadata&&(B.metadata=R.metadata),R.rotationQuaternion?B.rotationQuaternion=F.d.Ig(R.rotationQuaternion):R.rotation&&(B.rotation=F.m.Ig(R.rotation)),B.Ud=F.m.Ig(R.Ud),R.localMatrix?B.setPreTransformMatrix(F.c.Ig(R.localMatrix)):R.pivotMatrix&&B.setPivotMatrix(F.c.Ig(R.pivotMatrix)),B.xb(R.isEnabled),B.isVisible=R.isVisible,B.infiniteDistance=R.infiniteDistance,B.sb=!!R.sb,B.showBoundingBox=R.showBoundingBox,B.showSubMeshesBoundingBox=R.showSubMeshesBoundingBox,void 0!==R.applyFog&&(B.applyFog=R.applyFog),void 0!==R.pickable&&(B.ub=R.pickable),void 0!==R.alphaIndex&&(B.alphaIndex=R.alphaIndex),B.receiveShadows=R.receiveShadows,void 0!==R.billboardMode&&(B.billboardMode=R.billboardMode),void 0!==R.visibility&&(B.visibility=R.visibility),B.checkCollisions=R.checkCollisions,B.Da=!!R.Da,R.ellipsoid&&(B.ellipsoid=F.m.Ig(R.ellipsoid)),R.ellipsoidOffset&&(B.ellipsoidOffset=F.m.Ig(R.ellipsoidOffset)),null!=R.overrideMaterialSideOrientation&&(B.sideOrientation=R.overrideMaterialSideOrientation),void 0!==R.sideOrientation&&(B.sideOrientation=R.sideOrientation),void 0!==R.isBlocker&&(B.isBlocker=R.isBlocker),B._shouldGenerateFlatShading=R.useFlatShading,R.Yb&&(B._waitingData.Yb=R.Yb),void 0!==R.parentId&&(B._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(B._waitingParentInstanceIndex=R.parentInstanceIndex),void 0!==R.actions&&(B._waitingData.actions=R.actions),void 0!==R.overlayAlpha&&(B.overlayAlpha=R.overlayAlpha),void 0!==R.overlayColor&&(B.overlayColor=C.e.Ig(R.overlayColor)),void 0!==R.renderOverlay&&(B.renderOverlay=R.renderOverlay),B.isUnIndexed=!!R.isUnIndexed,B.hasVertexAlpha=R.hasVertexAlpha,R.delayLoadingFile?(B.delayLoadState=4,B.delayLoadingFile=L+R.delayLoadingFile,B.buildBoundingInfo(F.m.Ig(R.boundingBoxMinimum),F.m.Ig(R.boundingBoxMaximum)),R._binaryInfo&&(B._binaryInfo=R._binaryInfo),B._delayInfo=[],R.hasUVs&&B._delayInfo.push(y.e.UVKind),R.hasUVs2&&B._delayInfo.push(y.e.UV2Kind),R.hasUVs3&&B._delayInfo.push(y.e.UV3Kind),R.hasUVs4&&B._delayInfo.push(y.e.UV4Kind),R.hasUVs5&&B._delayInfo.push(y.e.UV5Kind),R.hasUVs6&&B._delayInfo.push(y.e.UV6Kind),R.hasColors&&B._delayInfo.push(y.e.ColorKind),R.hasMatricesIndices&&B._delayInfo.push(y.e.MatricesIndicesKind),R.hasMatricesWeights&&B._delayInfo.push(y.e.MatricesWeightsKind),B._delayLoadingFunction=n.b._ImportGeometry,f.d.ForceFullSceneLoadingForIncremental&&B._checkDelayState()):n.b._ImportGeometry(R,B),R.materialUniqueId?B._waitingMaterialId=R.materialUniqueId:R.materialId&&(B._waitingMaterialId=R.materialId),R.morphTargetManagerId>-1&&(B._waitingMorphTargetManagerId=R.morphTargetManagerId),void 0!==R.skeletonId&&null!==R.skeletonId&&(B.skeleton=q.getLastSkeletonById(R.skeletonId),R.numBoneInfluencers&&(B.numBoneInfluencers=R.numBoneInfluencers)),R.animations){for(let q=0;q<R.animations.length;q++){const L=R.animations[q],N=(0,t.d)("BABYLON.Animation");N&&B.animations.push(N.Parse(L))}e.d.ParseAnimationRanges(B,R,q)}if(R.autoAnimate&&q.beginAnimation(B,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),R.layerMask&&!isNaN(R.layerMask)?B.layerMask=Math.abs(parseInt(R.layerMask)):B.layerMask=268435455,R.physicsImpostor&&(B.physicsImpostor=W._PhysicsImpostorParser(q,B,R)),R.lodMeshIds&&(B._waitingData.lods={ids:R.lodMeshIds,distances:R.lodDistances?R.lodDistances:null,coverages:R.lodCoverages?R.lodCoverages:null}),R.instances)for(let N=0;N<R.instances.length;N++){const L=R.instances[N],h=B.createInstance(L.name);if(L.id&&(h.id=L.id),Z.b&&(L.tags?Z.b.AddTagsTo(h,L.tags):Z.b.AddTagsTo(h,R.tags)),h.position=F.m.Ig(L.position),void 0!==L.metadata&&(h.metadata=L.metadata),void 0!==L.parentId&&(h._waitingParentId=L.parentId),void 0!==L.parentInstanceIndex&&(h._waitingParentInstanceIndex=L.parentInstanceIndex),void 0!==L.isEnabled&&null!==L.isEnabled&&h.xb(L.isEnabled),void 0!==L.isVisible&&null!==L.isVisible&&(h.isVisible=L.isVisible),void 0!==L.ub&&null!==L.ub&&(h.ub=L.ub),L.rotationQuaternion?h.rotationQuaternion=F.d.Ig(L.rotationQuaternion):L.rotation&&(h.rotation=F.m.Ig(L.rotation)),h.Ud=F.m.Ig(L.Ud),void 0!=L.checkCollisions&&null!=L.checkCollisions&&(h.checkCollisions=L.checkCollisions),void 0!=L.pickable&&null!=L.pickable&&(h.ub=L.pickable),void 0!=L.showBoundingBox&&null!=L.showBoundingBox&&(h.showBoundingBox=L.showBoundingBox),void 0!=L.showSubMeshesBoundingBox&&null!=L.showSubMeshesBoundingBox&&(h.showSubMeshesBoundingBox=L.showSubMeshesBoundingBox),void 0!=L.alphaIndex&&null!=L.showSubMeshesBoundingBox&&(h.alphaIndex=L.alphaIndex),L.physicsImpostor&&(h.physicsImpostor=W._PhysicsImpostorParser(q,h,L)),void 0!==L.actions&&(h._waitingData.actions=L.actions),L.animations){for(let R=0;R<L.animations.length;R++){const q=L.animations[R],B=(0,t.d)("BABYLON.Animation");B&&h.animations.push(B.Parse(q))}e.d.ParseAnimationRanges(h,L,q),L.autoAnimate&&q.beginAnimation(h,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1)}}if(R.thinInstances){const q=R.thinInstances;if(B.thinInstanceEnablePicking=!!q.enablePicking,q.matrixData?(B.Cb("matrix",new Float32Array(q.matrixData),16,!1),B._thinInstanceDataStorage.matrixBufferSize=q.matrixBufferSize,B._thinInstanceDataStorage.instancesCount=q.instancesCount):B._thinInstanceDataStorage.matrixBufferSize=q.matrixBufferSize,R.thinInstances.userThinInstance){const q=R.thinInstances.userThinInstance;for(const R in q.data)B.Cb(R,new Float32Array(q.data[R]),q.strides[R],!1),B._userThinInstanceBuffersStorage.sizes[R]=q.sizes[R]}}return B}setPositionsForCPUSkinning(){const R=this._internalMeshDataInfo;if(!R._sourcePositions){const q=this.getVerticesData(y.e.PositionKind);if(!q)return R._sourcePositions;R._sourcePositions=new Float32Array(q),this.isVertexBufferUpdatable(y.e.PositionKind)||this.Ga(y.e.PositionKind,q,!0)}return R._sourcePositions}setNormalsForCPUSkinning(){const R=this._internalMeshDataInfo;if(!R._sourceNormals){const q=this.getVerticesData(y.e.NormalKind);if(!q)return R._sourceNormals;R._sourceNormals=new Float32Array(q),this.isVertexBufferUpdatable(y.e.NormalKind)||this.Ga(y.e.NormalKind,q,!0)}return R._sourceNormals}applySkeleton(R){if(!this.yj)return this;if(this.yj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.yj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(y.e.PositionKind))return this;if(!this.isVerticesDataPresent(y.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(y.e.MatricesWeightsKind))return this;const q=this.isVerticesDataPresent(y.e.NormalKind),L=this._internalMeshDataInfo;if(!L._sourcePositions){const R=this.Zf.slice();this.setPositionsForCPUSkinning(),this.Zf=R}q&&!L._sourceNormals&&this.setNormalsForCPUSkinning();let B=this.getVerticesData(y.e.PositionKind);if(!B)return this;B instanceof Float32Array||(B=new Float32Array(B));let N=this.getVerticesData(y.e.NormalKind);if(q){if(!N)return this;N instanceof Float32Array||(N=new Float32Array(N))}const h=this.getVerticesData(y.e.MatricesIndicesKind),Z=this.getVerticesData(y.e.MatricesWeightsKind);if(!Z||!h)return this;const z=this.numBoneInfluencers>4,Y=z?this.getVerticesData(y.e.MatricesIndicesExtraKind):null,C=z?this.getVerticesData(y.e.MatricesWeightsExtraKind):null,e=R.getTransformMatrices(this),U=F.m.Zero(),n=new F.c,r=new F.c;let p,c=0;for(let y=0;y<B.length;y+=3,c+=4){let R;for(p=0;p<4;p++)R=Z[c+p],R>0&&(F.c.FromFloat32ArrayToRefScaled(e,Math.floor(16*h[c+p]),R,r),n.addToSelf(r));if(z)for(p=0;p<4;p++)R=C[c+p],R>0&&(F.c.FromFloat32ArrayToRefScaled(e,Math.floor(16*Y[c+p]),R,r),n.addToSelf(r));F.m.TransformCoordinatesFromFloatsToRef(L._sourcePositions[y],L._sourcePositions[y+1],L._sourcePositions[y+2],n,U),U.toArray(B,y),q&&(F.m.TransformNormalFromFloatsToRef(L._sourceNormals[y],L._sourceNormals[y+1],L._sourceNormals[y+2],n,U),U.toArray(N,y)),n.reset()}return this.updateVerticesData(y.e.PositionKind,B),q&&this.updateVerticesData(y.e.NormalKind,N),this}static MinMax(R){let q=null,L=null;return R.forEach((function(R){const B=R.getBoundingInfo().boundingBox;q&&L?(q.minimizeInPlace(B.minimumWorld),L.maximizeInPlace(B.maximumWorld)):(q=B.minimumWorld,L=B.maximumWorld)})),q&&L?{min:q,max:L}:{min:F.m.Zero(),max:F.m.Zero()}}static Center(R){const q=R instanceof Array?W.MinMax(R):R;return F.m.Center(q.min,q.max)}static MergeMeshes(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;return(0,z.o)(W._MergeMeshesCoroutine(R,q,L,B,N,h,!1))}static MergeMeshesAsync(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;return(0,z.k)(W._MergeMeshesCoroutine(R,q,L,B,N,h,!0),(0,z.e)())}static*_MergeMeshesCoroutine(R){let q,L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;if(0===(R=R.filter(Boolean)).length)return null;if(!B){let L=0;for(q=0;q<R.length;q++)if(L+=R[q].getTotalVertices(),L>=65536)return T.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}Z&&(h=!1);const Y=new Array,F=new Array,C=new Array,e=R[0].sideOrientation;for(q=0;q<R.length;q++){const L=R[q];if(L.isAnInstance)return T.d.Warn("Cannot merge instance meshes."),null;if(e!==L.sideOrientation)return T.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(h&&C.push(L.getTotalIndices()),Z)if(L.material){const R=L.material;if(R instanceof d.c){for(let q=0;q<R.$f.length;q++)Y.indexOf(R.$f[q])<0&&Y.push(R.$f[q]);for(let q=0;q<L.Zf.length;q++)F.push(Y.indexOf(R.$f[L.Zf[q].materialIndex])),C.push(L.Zf[q].indexCount)}else{Y.indexOf(R)<0&&Y.push(R);for(let q=0;q<L.Zf.length;q++)F.push(Y.indexOf(R)),C.push(L.Zf[q].indexCount)}}else for(let R=0;R<L.Zf.length;R++)F.push(0),C.push(L.Zf[R].indexCount)}const y=R[0],n=R=>{const q=R.Jj(!0);return{vertexData:U.d.ExtractFromMesh(R,!1,!1),transform:q}},{vertexData:r,transform:c}=n(y);z&&(yield);const f=new Array(R.length-1);for(let U=1;U<R.length;U++)f[U-1]=n(R[U]),z&&(yield);const v=r._mergeCoroutine(c,f,B,z,!L);let t=v.next();for(;!t.done;)z&&(yield),t=v.next();const D=t.value;N||(N=new W(y.name+"_merged",y.va()));const S=D._applyToCoroutine(N,void 0,z);let I=S.next();for(;!I.done;)z&&(yield),I=S.next();if(N.checkCollisions=y.checkCollisions,N.sideOrientation=y.sideOrientation,L)for(q=0;q<R.length;q++)R[q].dispose();if(h||Z){N.releaseSubMeshes(),q=0;let R=0;for(;q<C.length;)p.c.CreateFromIndices(0,R,C[q],N,void 0,!1),R+=C[q],q++;for(const q of N.Zf)q.refreshBoundingInfo();N.Jj(!0)}if(Z){const R=new d.c(y.name+"_merged",y.va());R.$f=Y;for(let q=0;q<N.Zf.length;q++)N.Zf[q].materialIndex=F[q];N.material=R}else N.material=y.material;return N}Bj(R){R._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(R)}Aj(R){const q=R._indexInSourceMeshInstanceArray;if(-1!=q){if(q!==this.instances.length-1){const R=this.instances[this.instances.length-1];this.instances[q]=R,R._indexInSourceMeshInstanceArray=q}R._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===c.c.CounterClockWiseSideOrientation}_getRenderingFillMode(R){const q=this.va();return q.forcePointsCloud?c.c.PointFillMode:q.forceWireframe?c.c.WireFrameFillMode:this.overrideRenderingFillMode??R}setMaterialByID(R){return this.setMaterialById(R)}static CreateRibbon(R,q,L,B,N,h,Z,z,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(R,q,L,B,N,h){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(R,q,L,B,N){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(R,q,L,B,N,h){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(R,q,L,B){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(R,q,L,B,N,h,Z,z,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(R,q,L,B,N,h,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(R,q,L,B,N,h,Z,z,Y,F){throw new Error("Import MeshBuilder to populate this function")}static pb(R,q,L,B,N){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(R,q,L,B,N,h,Z,z){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(R,q,L,B,N,h,Z){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(R,q,L,B,N,h,Z,z){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(R,q,L,B,N,h,Z,z,Y,F){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(R,q,L,B,N,h,Z,z,Y,F,C,e){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(R,q,L,B,N,h,Z){throw new Error("Import MeshBuilder to populate this function")}static _f(R,q,L,B,N){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(R,q,L,B,N,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(R,q,L,B,N,h,Z,z,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(R,q,L,B,N,h,Z,z,Y,F,C){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(R,q,L,B,N,h,Z,z,Y,F){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(R,q,L){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(R,q,L){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(R,q,L,B,N,h){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(R,q,L){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(R){throw new Error("Import MeshBuilder to populate this function")}}W.FRONTSIDE=U.d.FRONTSIDE,W.BACKSIDE=U.d.BACKSIDE,W.DOUBLESIDE=U.d.DOUBLESIDE,W.DEFAULTSIDE=U.d.DEFAULTSIDE,W.NO_CAP=0,W.CAP_START=1,W.CAP_END=2,W.CAP_ALL=3,W.NO_FLIP=0,W.FLIP_TILE=1,W.ROTATE_TILE=2,W.FLIP_ROW=3,W.ROTATE_ROW=4,W.FLIP_N_ROTATE_TILE=5,W.FLIP_N_ROTATE_ROW=6,W.CENTER=0,W.LEFT=1,W.RIGHT=2,W.TOP=3,W.BOTTOM=4,W.INSTANCEDMESH_SORT_TRANSPARENT=!1,W._GroundMeshParser=(R,q)=>{throw(0,D.d)("GroundMesh")},W._GoldbergMeshParser=(R,q)=>{throw(0,D.d)("GoldbergMesh")},W._LinesMeshParser=(R,q)=>{throw(0,D.d)("LinesMesh")},W._GreasedLineMeshParser=(R,q)=>{throw(0,D.d)("GreasedLineMesh")},W._GreasedLineRibbonMeshParser=(R,q)=>{throw(0,D.d)("GreasedLineRibbonMesh")},W._TrailMeshParser=(R,q)=>{throw(0,D.d)("TrailMesh")},(0,t.f)("BABYLON.Mesh",W)},11357:(R,q,L)=>{"use strict";L.d(q,{d:()=>n});var B=L(11053),N=L(11081),h=L(11136),Z=L(10785),z=L(11112),Y=L(10767),F=L(11058),C=L(11331),e=L(10808),y=L(11218);class U{}class n{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,C.i)(this._applyToCoroutine.bind(this)),this.uniqueId=n._UniqueIDGenerator,n._UniqueIDGenerator++}set(R,q){switch(R.length||Y.d.Warn(`Setting vertex data kind '${q}' with an empty array`),q){case h.e.PositionKind:this.xa=R;break;case h.e.NormalKind:this.ya=R;break;case h.e.TangentKind:this.tangents=R;break;case h.e.UVKind:this.Aa=R;break;case h.e.UV2Kind:this.uvs2=R;break;case h.e.UV3Kind:this.uvs3=R;break;case h.e.UV4Kind:this.uvs4=R;break;case h.e.UV5Kind:this.uvs5=R;break;case h.e.UV6Kind:this.uvs6=R;break;case h.e.ColorKind:this.za=R;break;case h.e.MatricesIndicesKind:this.matricesIndices=R;break;case h.e.MatricesWeightsKind:this.matricesWeights=R;break;case h.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=R;break;case h.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=R}}Ca(R,q){return this._applyTo(R,q,!1),this}applyToGeometry(R,q){return this._applyTo(R,q,!1),this}updateMesh(R){return this._update(R),this}updateGeometry(R){return this._update(R),this}*_applyToCoroutine(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;if(this.xa&&(R.Ga(h.e.PositionKind,this.xa,q),L&&(yield)),this.ya&&(R.Ga(h.e.NormalKind,this.ya,q),L&&(yield)),this.tangents&&(R.Ga(h.e.TangentKind,this.tangents,q),L&&(yield)),this.Aa&&(R.Ga(h.e.UVKind,this.Aa,q),L&&(yield)),this.uvs2&&(R.Ga(h.e.UV2Kind,this.uvs2,q),L&&(yield)),this.uvs3&&(R.Ga(h.e.UV3Kind,this.uvs3,q),L&&(yield)),this.uvs4&&(R.Ga(h.e.UV4Kind,this.uvs4,q),L&&(yield)),this.uvs5&&(R.Ga(h.e.UV5Kind,this.uvs5,q),L&&(yield)),this.uvs6&&(R.Ga(h.e.UV6Kind,this.uvs6,q),L&&(yield)),this.za&&(R.Ga(h.e.ColorKind,this.za,q),this.hasVertexAlpha&&void 0!==R.hasVertexAlpha&&(R.hasVertexAlpha=!0),L&&(yield)),this.matricesIndices&&(R.Ga(h.e.MatricesIndicesKind,this.matricesIndices,q),L&&(yield)),this.matricesWeights&&(R.Ga(h.e.MatricesWeightsKind,this.matricesWeights,q),L&&(yield)),this.matricesIndicesExtra&&(R.Ga(h.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,q),L&&(yield)),this.matricesWeightsExtra&&(R.Ga(h.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,q),L&&(yield)),this.indices?(R.setIndices(this.indices,null,q),L&&(yield)):R.setIndices([],null),R.Zf&&this.materialInfos&&this.materialInfos.length>1){const q=R;q.Zf=[];for(const R of this.materialInfos)new y.c(R.materialIndex,R.verticesStart,R.verticesCount,R.indexStart,R.indexCount,q)}return this}_update(R,q,L){return this.xa&&R.updateVerticesData(h.e.PositionKind,this.xa,q,L),this.ya&&R.updateVerticesData(h.e.NormalKind,this.ya,q,L),this.tangents&&R.updateVerticesData(h.e.TangentKind,this.tangents,q,L),this.Aa&&R.updateVerticesData(h.e.UVKind,this.Aa,q,L),this.uvs2&&R.updateVerticesData(h.e.UV2Kind,this.uvs2,q,L),this.uvs3&&R.updateVerticesData(h.e.UV3Kind,this.uvs3,q,L),this.uvs4&&R.updateVerticesData(h.e.UV4Kind,this.uvs4,q,L),this.uvs5&&R.updateVerticesData(h.e.UV5Kind,this.uvs5,q,L),this.uvs6&&R.updateVerticesData(h.e.UV6Kind,this.uvs6,q,L),this.za&&R.updateVerticesData(h.e.ColorKind,this.za,q,L),this.matricesIndices&&R.updateVerticesData(h.e.MatricesIndicesKind,this.matricesIndices,q,L),this.matricesWeights&&R.updateVerticesData(h.e.MatricesWeightsKind,this.matricesWeights,q,L),this.matricesIndicesExtra&&R.updateVerticesData(h.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,q,L),this.matricesWeightsExtra&&R.updateVerticesData(h.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,q,L),this.indices&&R.setIndices(this.indices,null),this}static _TransformVector3Coordinates(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.length;const h=N.h.o[0],Z=N.h.o[1];for(let z=L;z<L+B;z+=3)N.m.FromArrayToRef(R,z,h),N.m.TransformCoordinatesToRef(h,q,Z),R[z]=Z.x,R[z+1]=Z.y,R[z+2]=Z.z}static _TransformVector3Normals(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.length;const h=N.h.o[0],Z=N.h.o[1];for(let z=L;z<L+B;z+=3)N.m.FromArrayToRef(R,z,h),N.m.TransformNormalToRef(h,q,Z),R[z]=Z.x,R[z+1]=Z.y,R[z+2]=Z.z}static _TransformVector4Normals(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.length;const h=N.h.Vector4[0],Z=N.h.Vector4[1];for(let z=L;z<L+B;z+=4)N.q.FromArrayToRef(R,z,h),N.q.TransformNormalToRef(h,q,Z),R[z]=Z.x,R[z+1]=Z.y,R[z+2]=Z.z,R[z+3]=Z.w}static _FlipFaces(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.length;for(let B=q;B<q+L;B+=3){const q=R[B+1];R[B+1]=R[B+2],R[B+2]=q}}transform(R){const q=R.determinant()<0;return this.xa&&n._TransformVector3Coordinates(this.xa,R),this.ya&&n._TransformVector3Normals(this.ya,R),this.tangents&&n._TransformVector4Normals(this.tangents,R),q&&this.indices&&n._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const R=[];for(const q of this.materialInfos){const L=new n;if(this.xa&&(L.xa=this.xa.slice(3*q.verticesStart,3*(q.verticesCount+q.verticesStart))),this.ya&&(L.ya=this.ya.slice(3*q.verticesStart,3*(q.verticesCount+q.verticesStart))),this.tangents&&(L.tangents=this.tangents.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.za&&(L.za=this.za.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.Aa&&(L.Aa=this.Aa.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs2&&(L.uvs2=this.uvs2.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs3&&(L.uvs3=this.uvs3.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs4&&(L.uvs4=this.uvs4.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs5&&(L.uvs5=this.uvs5.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.uvs6&&(L.uvs6=this.uvs6.slice(2*q.verticesStart,2*(q.verticesCount+q.verticesStart))),this.matricesIndices&&(L.matricesIndices=this.matricesIndices.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.matricesIndicesExtra&&(L.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.matricesWeights&&(L.matricesWeights=this.matricesWeights.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.matricesWeightsExtra&&(L.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*q.verticesStart,4*(q.verticesCount+q.verticesStart))),this.indices){L.indices=[];for(let R=q.indexStart;R<q.indexStart+q.indexCount;R++)L.indices.push(this.indices[R]-q.verticesStart)}const B=new U;B.indexStart=0,B.indexCount=L.indices?L.indices.length:0,B.materialIndex=q.materialIndex,B.verticesStart=0,B.verticesCount=(L.xa?L.xa.length:0)/3,L.materialInfos=[B],R.push(L)}return R}merge(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=Array.isArray(R)?R.map((R=>({vertexData:R}))):[{vertexData:R}];return(0,C.o)(this._mergeCoroutine(void 0,h,q,!1,L,B,N))}*_mergeCoroutine(R,q){var L,B;let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let C=q.map((R=>R.vertexData)),e=this;if(F)for(const h of C)h&&(h._validate(),!this.ya&&h.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&h.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&h.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&h.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&h.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&h.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&h.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&h.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&h.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&h.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&h.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&h.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&h.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const h of C)if(h)if(F)this.ya&&!h.ya&&(h.ya=new Float32Array(h.xa.length)),this.tangents&&!h.tangents&&(h.tangents=new Float32Array(h.xa.length/3*4)),this.Aa&&!h.Aa&&(h.Aa=new Float32Array(h.xa.length/3*2)),this.uvs2&&!h.uvs2&&(h.uvs2=new Float32Array(h.xa.length/3*2)),this.uvs3&&!h.uvs3&&(h.uvs3=new Float32Array(h.xa.length/3*2)),this.uvs4&&!h.uvs4&&(h.uvs4=new Float32Array(h.xa.length/3*2)),this.uvs5&&!h.uvs5&&(h.uvs5=new Float32Array(h.xa.length/3*2)),this.uvs6&&!h.uvs6&&(h.uvs6=new Float32Array(h.xa.length/3*2)),this.za&&!h.za&&(h.za=new Float32Array(h.xa.length/3*4),h.za.fill(1)),this.matricesIndices&&!h.matricesIndices&&(h.matricesIndices=new Float32Array(h.xa.length/3*4)),this.matricesWeights&&!h.matricesWeights&&(h.matricesWeights=new Float32Array(h.xa.length/3*4)),this.matricesIndicesExtra&&!h.matricesIndicesExtra&&(h.matricesIndicesExtra=new Float32Array(h.xa.length/3*4)),this.matricesWeightsExtra&&!h.matricesWeightsExtra&&(h.matricesWeightsExtra=new Float32Array(h.xa.length/3*4));else if(h._validate(),!this.ya!==!h.ya||!this.tangents!==!h.tangents||!this.Aa!==!h.Aa||!this.uvs2!==!h.uvs2||!this.uvs3!==!h.uvs3||!this.uvs4!==!h.uvs4||!this.uvs5!==!h.uvs5||!this.uvs6!==!h.uvs6||!this.za!==!h.za||!this.matricesIndices!==!h.matricesIndices||!this.matricesWeights!==!h.matricesWeights||!this.matricesIndicesExtra!==!h.matricesIndicesExtra||!this.matricesWeightsExtra!==!h.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(Y){let L=0,B=0,N=0;const h=[];let Z=null;const z=[];for(const q of this.splitBasedOnMaterialID())z.push({vertexData:q,transform:R});for(const R of q)if(R.vertexData)for(const q of R.vertexData.splitBasedOnMaterialID())z.push({vertexData:q,transform:R.transform});z.sort(((R,q)=>{const L=R.vertexData.materialInfos?R.vertexData.materialInfos[0].materialIndex:0,B=q.vertexData.materialInfos?q.vertexData.materialInfos[0].materialIndex:0;return L>B?1:L===B?0:-1}));for(const R of z){const q=R.vertexData;if(L=q.materialInfos?q.materialInfos[0].materialIndex:0,Z&&Z.materialIndex===L)Z.indexCount+=q.indices.length,Z.verticesCount+=q.xa.length/3;else{const R=new U;R.materialIndex=L,R.indexStart=B,R.indexCount=q.indices.length,R.verticesStart=N,R.verticesCount=q.xa.length/3,h.push(R),Z=R}B+=q.indices.length,N+=q.xa.length/3}const Y=z.splice(0,1)[0];e=Y.vertexData,R=Y.transform,C=z.map((R=>R.vertexData)),q=z,this.materialInfos=h}const y=C.reduce(((R,q)=>{var L;return R+((null===(L=q.indices)||void 0===L?void 0:L.length)??0)}),(null===(L=e.indices)||void 0===L?void 0:L.length)??0);let r=z||C.some((R=>R.indices===e.indices))?null===(B=e.indices)||void 0===B?void 0:B.slice():e.indices;if(y>0){var p;let L=(null===(p=r)||void 0===p?void 0:p.length)??0;if(r||(r=new Array(y)),r.length!==y){if(Array.isArray(r))r.length=y;else{const R=N||r instanceof Uint32Array?new Uint32Array(y):new Uint16Array(y);R.set(r),r=R}R&&R.determinant()<0&&n._FlipFaces(r,0,L)}let B=e.xa?e.xa.length/3:0;for(const{vertexData:R,transform:N}of q)if(R.indices){for(let q=0;q<R.indices.length;q++)r[L+q]=R.indices[q]+B;N&&N.determinant()<0&&n._FlipFaces(r,L,R.indices.length),B+=R.xa.length/3,L+=R.indices.length,Z&&(yield)}}return this.indices=r,this.xa=n._MergeElement(h.e.PositionKind,e.xa,R,q.map((R=>[R.vertexData.xa,R.transform]))),Z&&(yield),e.ya&&(this.ya=n._MergeElement(h.e.NormalKind,e.ya,R,q.map((R=>[R.vertexData.ya,R.transform]))),Z&&(yield)),e.tangents&&(this.tangents=n._MergeElement(h.e.TangentKind,e.tangents,R,q.map((R=>[R.vertexData.tangents,R.transform]))),Z&&(yield)),e.Aa&&(this.Aa=n._MergeElement(h.e.UVKind,e.Aa,R,q.map((R=>[R.vertexData.Aa,R.transform]))),Z&&(yield)),e.uvs2&&(this.uvs2=n._MergeElement(h.e.UV2Kind,e.uvs2,R,q.map((R=>[R.vertexData.uvs2,R.transform]))),Z&&(yield)),e.uvs3&&(this.uvs3=n._MergeElement(h.e.UV3Kind,e.uvs3,R,q.map((R=>[R.vertexData.uvs3,R.transform]))),Z&&(yield)),e.uvs4&&(this.uvs4=n._MergeElement(h.e.UV4Kind,e.uvs4,R,q.map((R=>[R.vertexData.uvs4,R.transform]))),Z&&(yield)),e.uvs5&&(this.uvs5=n._MergeElement(h.e.UV5Kind,e.uvs5,R,q.map((R=>[R.vertexData.uvs5,R.transform]))),Z&&(yield)),e.uvs6&&(this.uvs6=n._MergeElement(h.e.UV6Kind,e.uvs6,R,q.map((R=>[R.vertexData.uvs6,R.transform]))),Z&&(yield)),e.za&&(this.za=n._MergeElement(h.e.ColorKind,e.za,R,q.map((R=>[R.vertexData.za,R.transform]))),(void 0!==e.hasVertexAlpha||q.some((R=>void 0!==R.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=e.hasVertexAlpha||q.some((R=>R.vertexData.hasVertexAlpha))),Z&&(yield)),e.matricesIndices&&(this.matricesIndices=n._MergeElement(h.e.MatricesIndicesKind,e.matricesIndices,R,q.map((R=>[R.vertexData.matricesIndices,R.transform]))),Z&&(yield)),e.matricesWeights&&(this.matricesWeights=n._MergeElement(h.e.MatricesWeightsKind,e.matricesWeights,R,q.map((R=>[R.vertexData.matricesWeights,R.transform]))),Z&&(yield)),e.matricesIndicesExtra&&(this.matricesIndicesExtra=n._MergeElement(h.e.MatricesIndicesExtraKind,e.matricesIndicesExtra,R,q.map((R=>[R.vertexData.matricesIndicesExtra,R.transform]))),Z&&(yield)),e.matricesWeightsExtra&&(this.matricesWeightsExtra=n._MergeElement(h.e.MatricesWeightsExtraKind,e.matricesWeightsExtra,R,q.map((R=>[R.vertexData.matricesWeightsExtra,R.transform])))),this}static _MergeElement(R,q,L,B){const N=B.filter((R=>null!==R[0]&&void 0!==R[0]));if(!q&&0==N.length)return q;if(!q)return this._MergeElement(R,N[0][0],N[0][1],N.slice(1));const Z=N.reduce(((R,q)=>R+q[0].length),q.length),z=R===h.e.PositionKind?n._TransformVector3Coordinates:R===h.e.NormalKind?n._TransformVector3Normals:R===h.e.TangentKind?n._TransformVector4Normals:()=>{};if(q instanceof Float32Array){const R=new Float32Array(Z);R.set(q),L&&z(R,L,0,q.length);let B=q.length;for(const[q,L]of N)R.set(q,B),L&&z(R,L,B,q.length),B+=q.length;return R}{const R=new Array(Z);for(let L=0;L<q.length;L++)R[L]=q[L];L&&z(R,L,0,q.length);let B=q.length;for(const[q,L]of N){for(let L=0;L<q.length;L++)R[B+L]=q[L];L&&z(R,L,B,q.length),B+=q.length}return R}}_validate(){if(!this.xa)throw new e.i("Positions are required",e.e.MeshInvalidPositionsError);const R=(R,q)=>{const L=h.e.DeduceStride(R);if(q.length%L!==0)throw new Error("The "+R+"s array count must be a multiple of "+L);return q.length/L},q=R(h.e.PositionKind,this.xa),L=(L,B)=>{const N=R(L,B);if(N!==q)throw new Error("The "+L+"s element count ("+N+") does not match the positions count ("+q+")")};this.ya&&L(h.e.NormalKind,this.ya),this.tangents&&L(h.e.TangentKind,this.tangents),this.Aa&&L(h.e.UVKind,this.Aa),this.uvs2&&L(h.e.UV2Kind,this.uvs2),this.uvs3&&L(h.e.UV3Kind,this.uvs3),this.uvs4&&L(h.e.UV4Kind,this.uvs4),this.uvs5&&L(h.e.UV5Kind,this.uvs5),this.uvs6&&L(h.e.UV6Kind,this.uvs6),this.za&&L(h.e.ColorKind,this.za),this.matricesIndices&&L(h.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&L(h.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&L(h.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&L(h.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const R=this.serialize();return n.Parse(R)}serialize(){const R={};if(this.xa&&(R.xa=Array.from(this.xa)),this.ya&&(R.ya=Array.from(this.ya)),this.tangents&&(R.tangents=Array.from(this.tangents)),this.Aa&&(R.Aa=Array.from(this.Aa)),this.uvs2&&(R.uvs2=Array.from(this.uvs2)),this.uvs3&&(R.uvs3=Array.from(this.uvs3)),this.uvs4&&(R.uvs4=Array.from(this.uvs4)),this.uvs5&&(R.uvs5=Array.from(this.uvs5)),this.uvs6&&(R.uvs6=Array.from(this.uvs6)),this.za&&(R.za=Array.from(this.za),R.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(R.matricesIndices=Array.from(this.matricesIndices),R.matricesIndices._isExpanded=!0),this.matricesWeights&&(R.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(R.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),R.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(R.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),R.indices=Array.from(this.indices),this.materialInfos){R.materialInfos=[];for(const q of this.materialInfos){const L={indexStart:q.indexStart,indexCount:q.indexCount,materialIndex:q.materialIndex,verticesStart:q.verticesStart,verticesCount:q.verticesCount};R.materialInfos.push(L)}}return R}static ExtractFromMesh(R,q,L){return n._ExtractFrom(R,q,L)}static ExtractFromGeometry(R,q,L){return n._ExtractFrom(R,q,L)}static _ExtractFrom(R,q,L){const B=new n;if(R.isVerticesDataPresent(h.e.PositionKind)&&(B.xa=R.getVerticesData(h.e.PositionKind,q,L)),R.isVerticesDataPresent(h.e.NormalKind)&&(B.ya=R.getVerticesData(h.e.NormalKind,q,L)),R.isVerticesDataPresent(h.e.TangentKind)&&(B.tangents=R.getVerticesData(h.e.TangentKind,q,L)),R.isVerticesDataPresent(h.e.UVKind)&&(B.Aa=R.getVerticesData(h.e.UVKind,q,L)),R.isVerticesDataPresent(h.e.UV2Kind)&&(B.uvs2=R.getVerticesData(h.e.UV2Kind,q,L)),R.isVerticesDataPresent(h.e.UV3Kind)&&(B.uvs3=R.getVerticesData(h.e.UV3Kind,q,L)),R.isVerticesDataPresent(h.e.UV4Kind)&&(B.uvs4=R.getVerticesData(h.e.UV4Kind,q,L)),R.isVerticesDataPresent(h.e.UV5Kind)&&(B.uvs5=R.getVerticesData(h.e.UV5Kind,q,L)),R.isVerticesDataPresent(h.e.UV6Kind)&&(B.uvs6=R.getVerticesData(h.e.UV6Kind,q,L)),R.isVerticesDataPresent(h.e.ColorKind)){const N=R.yj||R,Z=N.getVertexBuffer(h.e.ColorKind),z=N.getVerticesData(h.e.ColorKind,q,L);if(3===Z.getSize()){const R=new Float32Array(4*z.length/3);for(let q=0,L=0;q<z.length;q+=3,L+=4)R[L]=z[q],R[L+1]=z[q+1],R[L+2]=z[q+2],R[L+3]=1;B.za=R}else{if(4!==Z.getSize())throw new Error(`Unexpected number of color components: ${Z.getSize()}`);B.za=z}}return R.isVerticesDataPresent(h.e.MatricesIndicesKind)&&(B.matricesIndices=R.getVerticesData(h.e.MatricesIndicesKind,q,L)),R.isVerticesDataPresent(h.e.MatricesWeightsKind)&&(B.matricesWeights=R.getVerticesData(h.e.MatricesWeightsKind,q,L)),R.isVerticesDataPresent(h.e.MatricesIndicesExtraKind)&&(B.matricesIndicesExtra=R.getVerticesData(h.e.MatricesIndicesExtraKind,q,L)),R.isVerticesDataPresent(h.e.MatricesWeightsExtraKind)&&(B.matricesWeightsExtra=R.getVerticesData(h.e.MatricesWeightsExtraKind,q,L)),B.indices=R.Sf(q,L),B}static CreateRibbon(R){throw(0,Z.d)("ribbonBuilder")}static CreateBox(R){throw(0,Z.d)("boxBuilder")}static CreateTiledBox(R){throw(0,Z.d)("tiledBoxBuilder")}static CreateTiledPlane(R){throw(0,Z.d)("tiledPlaneBuilder")}static CreateSphere(R){throw(0,Z.d)("sphereBuilder")}static CreateCylinder(R){throw(0,Z.d)("cylinderBuilder")}static CreateTorus(R){throw(0,Z.d)("torusBuilder")}static CreateLineSystem(R){throw(0,Z.d)("linesBuilder")}static CreateDashedLines(R){throw(0,Z.d)("linesBuilder")}static CreateGround(R){throw(0,Z.d)("groundBuilder")}static CreateTiledGround(R){throw(0,Z.d)("groundBuilder")}static CreateGroundFromHeightMap(R){throw(0,Z.d)("groundBuilder")}static _f(R){throw(0,Z.d)("planeBuilder")}static CreateDisc(R){throw(0,Z.d)("discBuilder")}static CreatePolygon(R,q,L,B,N,h,z){throw(0,Z.d)("polygonBuilder")}static CreateIcoSphere(R){throw(0,Z.d)("icoSphereBuilder")}static CreatePolyhedron(R){throw(0,Z.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||N.m.Up();throw(0,Z.d)("capsuleBuilder")}static CreateTorusKnot(R){throw(0,Z.d)("torusKnotBuilder")}static ComputeNormals(R,q,L,B){let h=0,Z=0,z=0,Y=0,F=0,C=0,e=0,y=0,U=0,n=0,r=0,p=0,c=0,d=0,f=0,v=0,T=0,t=0,D=0,S=0,I=!1,K=!1,m=!1,o=!1,l=1,G=0,W=null;B&&(I=!!B.facetNormals,K=!!B.facetPositions,m=!!B.facetPartitioning,l=!0===B.useRightHandedSystem?-1:1,G=B.ratio||0,o=!!B.depthSort,W=B.distanceTo,o&&void 0===W&&(W=N.m.Zero()));let H=0,P=0,O=0,E=0;for(m&&B&&B.bbSize&&(H=B.subDiv.X*G/B.bbSize.x,P=B.subDiv.Y*G/B.bbSize.y,O=B.subDiv.Z*G/B.bbSize.z,E=B.subDiv.max*B.subDiv.max,B.facetPartitioning.length=0),h=0;h<R.length;h++)L[h]=0;const a=q.length/3|0;for(h=0;h<a;h++){if(p=3*q[3*h],c=p+1,d=p+2,f=3*q[3*h+1],v=f+1,T=f+2,t=3*q[3*h+2],D=t+1,S=t+2,Z=R[p]-R[f],z=R[c]-R[v],Y=R[d]-R[T],F=R[t]-R[f],C=R[D]-R[v],e=R[S]-R[T],y=l*(z*e-Y*C),U=l*(Y*F-Z*e),n=l*(Z*C-z*F),r=Math.sqrt(y*y+U*U+n*n),r=0===r?1:r,y/=r,U/=r,n/=r,I&&B&&(B.facetNormals[h].x=y,B.facetNormals[h].y=U,B.facetNormals[h].z=n),K&&B&&(B.facetPositions[h].x=(R[p]+R[f]+R[t])/3,B.facetPositions[h].y=(R[c]+R[v]+R[D])/3,B.facetPositions[h].z=(R[d]+R[T]+R[S])/3),m&&B){const q=Math.floor((B.facetPositions[h].x-B.bInfo.minimum.x*G)*H),L=Math.floor((B.facetPositions[h].y-B.bInfo.minimum.y*G)*P),N=Math.floor((B.facetPositions[h].z-B.bInfo.minimum.z*G)*O),Z=Math.floor((R[p]-B.bInfo.minimum.x*G)*H),z=Math.floor((R[c]-B.bInfo.minimum.y*G)*P),Y=Math.floor((R[d]-B.bInfo.minimum.z*G)*O),F=Math.floor((R[f]-B.bInfo.minimum.x*G)*H),C=Math.floor((R[v]-B.bInfo.minimum.y*G)*P),e=Math.floor((R[T]-B.bInfo.minimum.z*G)*O),y=Math.floor((R[t]-B.bInfo.minimum.x*G)*H),U=Math.floor((R[D]-B.bInfo.minimum.y*G)*P),n=Math.floor((R[S]-B.bInfo.minimum.z*G)*O),r=Z+B.subDiv.max*z+E*Y,I=F+B.subDiv.max*C+E*e,K=y+B.subDiv.max*U+E*n,m=q+B.subDiv.max*L+E*N;B.facetPartitioning[m]=B.facetPartitioning[m]?B.facetPartitioning[m]:new Array,B.facetPartitioning[r]=B.facetPartitioning[r]?B.facetPartitioning[r]:new Array,B.facetPartitioning[I]=B.facetPartitioning[I]?B.facetPartitioning[I]:new Array,B.facetPartitioning[K]=B.facetPartitioning[K]?B.facetPartitioning[K]:new Array,B.facetPartitioning[r].push(h),I!=r&&B.facetPartitioning[I].push(h),K!=I&&K!=r&&B.facetPartitioning[K].push(h),m!=r&&m!=I&&m!=K&&B.facetPartitioning[m].push(h)}if(o&&B&&B.facetPositions){const R=B.depthSortedFacets[h];R.ind=3*h,R.sqDistance=N.m.DistanceSquared(B.facetPositions[h],W)}L[p]+=y,L[c]+=U,L[d]+=n,L[f]+=y,L[v]+=U,L[T]+=n,L[t]+=y,L[D]+=U,L[S]+=n}for(h=0;h<L.length/3;h++)y=L[3*h],U=L[3*h+1],n=L[3*h+2],r=Math.sqrt(y*y+U*U+n*n),r=0===r?1:r,y/=r,U/=r,n/=r,L[3*h]=y,L[3*h+1]=U,L[3*h+2]=n}static _ComputeSides(R,q,L,B,h,Z,z){const Y=L.length,F=B.length;let C,e;switch(R=R||n.DEFAULTSIDE){case n.FRONTSIDE:break;case n.BACKSIDE:for(C=0;C<Y;C+=3){const R=L[C];L[C]=L[C+2],L[C+2]=R}for(e=0;e<F;e++)B[e]=-B[e];break;case n.DOUBLESIDE:{const R=q.length,y=R/3;for(let L=0;L<R;L++)q[R+L]=q[L];for(C=0;C<Y;C+=3)L[C+Y]=L[C+2]+y,L[C+1+Y]=L[C+1]+y,L[C+2+Y]=L[C]+y;for(e=0;e<F;e++)B[F+e]=-B[e];const U=h.length;let n=0;for(n=0;n<U;n++)h[n+U]=h[n];for(Z=Z||new N.q(0,0,1,1),z=z||new N.q(0,0,1,1),n=0,C=0;C<U/2;C++)h[n]=Z.x+(Z.z-Z.x)*h[n],h[n+1]=Z.y+(Z.w-Z.y)*h[n+1],h[n+U]=z.x+(z.z-z.x)*h[n+U],h[n+U+1]=z.y+(z.w-z.y)*h[n+U+1],n+=2;break}}}static Parse(R){const q=new n,L=R.xa;L&&q.set(L,h.e.PositionKind);const B=R.ya;B&&q.set(B,h.e.NormalKind);const N=R.tangents;N&&q.set(N,h.e.TangentKind);const Z=R.Aa;Z&&q.set(Z,h.e.UVKind);const Y=R.uvs2;Y&&q.set(Y,h.e.UV2Kind);const F=R.uvs3;F&&q.set(F,h.e.UV3Kind);const C=R.uvs4;C&&q.set(C,h.e.UV4Kind);const e=R.uvs5;e&&q.set(e,h.e.UV5Kind);const y=R.uvs6;y&&q.set(y,h.e.UV6Kind);const r=R.za;r&&(q.set(z.g.CheckColors4(r,L.length/3),h.e.ColorKind),void 0!==R.hasVertexAlpha&&(q.hasVertexAlpha=R.hasVertexAlpha));const p=R.matricesIndices;p&&q.set(p,h.e.MatricesIndicesKind);const c=R.matricesWeights;c&&q.set(c,h.e.MatricesWeightsKind);const d=R.indices;d&&(q.indices=d);const f=R.materialInfos;if(f){q.materialInfos=[];for(const R of f){const L=new U;L.indexCount=R.indexCount,L.indexStart=R.indexStart,L.verticesCount=R.verticesCount,L.verticesStart=R.verticesStart,L.materialIndex=R.materialIndex,q.materialInfos.push(L)}}return q}static ImportVertexData(R,q){const L=n.Parse(R);q.setAllVerticesData(L,R.updatable)}}n.FRONTSIDE=0,n.BACKSIDE=1,n.DOUBLESIDE=2,n.DEFAULTSIDE=0,n._UniqueIDGenerator=0,(0,B.d)([F.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B]=q;return!Array.isArray(B)}))],n,"_TransformVector3Coordinates",null),(0,B.d)([F.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B]=q;return!Array.isArray(B)}))],n,"_TransformVector3Normals",null),(0,B.d)([F.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B]=q;return!Array.isArray(B)}))],n,"_TransformVector4Normals",null),(0,B.d)([F.f.filter((function(){for(var R=arguments.length,q=new Array(R),L=0;L<R;L++)q[L]=arguments[L];let[B]=q;return!Array.isArray(B)}))],n,"_FlipFaces",null)},12453:(R,q,L)=>{"use strict";L.d(q,{b:()=>rR});var B=L(11081),N=L(11329),h=L(11136),Z=L(11357),z=L(11292);function Y(R){let q=R.pathArray;const L=R.closeArray||!1,B=R.closePath||!1,N=R.invertUV||!1,Y=Math.floor(q[0].length/2);let F=R.offset||Y;F=F>Y?Y:Math.floor(F);const C=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,e=R.Aa,y=R.za,U=[],n=[],r=[],p=[],c=[],d=[],f=[],v=[];let T;const t=[],D=[];let S,I,K;if(q.length<2){const R=[],L=[];for(I=0;I<q[0].length-F;I++)R.push(q[0][I]),L.push(q[0][I+F]);q=[R,L]}let m=0;const o=B?1:0,l=L?1:0;let G,W,H,P,O,E;for(T=q[0].length,S=0;S<q.length+l;S++){for(f[S]=0,c[S]=[0],G=S===q.length?q[0]:q[S],W=G.length,T=T<W?T:W,K=0;K<W;)U.push(G[K].x,G[K].y,G[K].z),K>0&&(H=G[K].Bc(G[K-1]).length(),P=H+f[S],c[S].push(P),f[S]=P),K++;B&&(K--,U.push(G[0].x,G[0].y,G[0].z),H=G[K].Bc(G[0]).length(),P=H+f[S],c[S].push(P),f[S]=P),t[S]=W+o,D[S]=m,m+=W+o}let a,g,Q=null,i=null;for(I=0;I<T+o;I++)for(v[I]=0,d[I]=[0],S=0;S<q.length-1+l;S++)O=q[S],E=S===q.length-1?q[0]:q[S+1],I===T?(Q=O[0],i=E[0]):(Q=O[I],i=E[I]),H=i.Bc(Q).length(),P=H+v[I],d[I].push(P),v[I]=P;if(e)for(S=0;S<e.length;S++)p.push(e[S].x,z.e?1-e[S].y:e[S].y);else for(S=0;S<q.length+l;S++)for(I=0;I<T+o;I++)a=0!=f[S]?c[S][I]/f[S]:0,g=0!=v[I]?d[I][S]/v[I]:0,N?p.push(g,a):p.push(a,z.e?1-g:g);S=0;let k=0,V=t[S]-1,x=t[S+1]-1,w=V<x?V:x,j=D[1]-D[0];const J=t.length-1;for(;k<=w&&S<J;)n.push(k,k+j,k+1),n.push(k+j+1,k+1,k+j),k+=1,k===w&&(S++,j=D[S+1]-D[S],V=t[S]-1,x=t[S+1]-1,k=D[S],w=V<x?V+k:x+k);if(Z.d.ComputeNormals(U,n,r),B){let R=0,L=0;for(S=0;S<q.length;S++){R=3*D[S],L=S+1<q.length?3*(D[S+1]-1):r.length-3,r[R]=.5*(r[R]+r[L]),r[R+1]=.5*(r[R+1]+r[L+1]),r[R+2]=.5*(r[R+2]+r[L+2]);const B=Math.sqrt(r[R]*r[R]+r[R+1]*r[R+1]+r[R+2]*r[R+2]);r[R]/=B,r[R+1]/=B,r[R+2]/=B,r[L]=r[R],r[L+1]=r[R+1],r[L+2]=r[R+2]}}if(L){let R=3*D[0],L=3*D[q.length];for(I=0;I<T+o;I++){r[R]=.5*(r[R]+r[L]),r[R+1]=.5*(r[R+1]+r[L+1]),r[R+2]=.5*(r[R+2]+r[L+2]);const q=Math.sqrt(r[R]*r[R]+r[R+1]*r[R+1]+r[R+2]*r[R+2]);r[R]/=q,r[R+1]/=q,r[R+2]/=q,r[L]=r[R],r[L+1]=r[R+1],r[L+2]=r[R+2],R+=3,L+=3}}Z.d._ComputeSides(C,U,n,r,p,R.frontUVs,R.backUVs);let s=null;if(y){s=new Float32Array(4*y.length);for(let R=0;R<y.length;R++)s[4*R]=y[R].r,s[4*R+1]=y[R].g,s[4*R+2]=y[R].b,s[4*R+3]=y[R].a}const A=new Z.d,M=new Float32Array(U),b=new Float32Array(r),X=new Float32Array(p);return A.indices=n,A.xa=M,A.ya=b,A.Aa=X,s&&A.set(s,h.e.ColorKind),B&&(A._idx=D),A}function F(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=q.pathArray,C=q.closeArray,e=q.closePath,y=N.d._GetDefaultSideOrientation(q.sideOrientation),U=q.instance,n=q.updatable;if(U){const R=B.h.o[0].Rd(Number.MAX_VALUE),L=B.h.o[1].Rd(-Number.MAX_VALUE),Y=q=>{let B=F[0].length;const h=U;let Z=0;const z=h._originalBuilderSideOrientation===N.d.DOUBLESIDE?2:1;for(let N=1;N<=z;++N)for(let z=0;z<F.length;++z){const N=F[z],Y=N.length;B=B<Y?B:Y;for(let h=0;h<B;++h){const B=N[h];q[Z]=B.x,q[Z+1]=B.y,q[Z+2]=B.z,R.minimizeInPlaceFromFloats(B.x,B.y,B.z),L.maximizeInPlaceFromFloats(B.x,B.y,B.z),Z+=3}if(h._creationDataStorage&&h._creationDataStorage.closePath){const R=N[0];q[Z]=R.x,q[Z+1]=R.y,q[Z+2]=R.z,Z+=3}}},C=U.getVerticesData(h.e.PositionKind);if(Y(C),U.hasBoundingInfo?U.getBoundingInfo().reConstruct(R,L,U._worldMatrix):U.buildBoundingInfo(R,L,U._worldMatrix),U.updateVerticesData(h.e.PositionKind,C,!1,!1),q.za){const R=U.getVerticesData(h.e.ColorKind);for(let L=0,B=0;L<q.za.length;L++,B+=4){const N=q.za[L];R[B]=N.r,R[B+1]=N.g,R[B+2]=N.b,R[B+3]=N.a}U.updateVerticesData(h.e.ColorKind,R,!1,!1)}if(q.Aa){const R=U.getVerticesData(h.e.UVKind);for(let L=0;L<q.Aa.length;L++)R[2*L]=q.Aa[L].x,R[2*L+1]=z.e?1-q.Aa[L].y:q.Aa[L].y;U.updateVerticesData(h.e.UVKind,R,!1,!1)}if(!U.areNormalsFrozen||U.isFacetDataEnabled){const R=U.Sf(),q=U.getVerticesData(h.e.NormalKind),L=U.isFacetDataEnabled?U.getFacetDataParameters():null;if(Z.d.ComputeNormals(C,R,q,L),U._creationDataStorage&&U._creationDataStorage.closePath){let R=0,L=0;for(let B=0;B<F.length;B++)R=3*U._creationDataStorage.idx[B],L=B+1<F.length?3*(U._creationDataStorage.idx[B+1]-1):q.length-3,q[R]=.5*(q[R]+q[L]),q[R+1]=.5*(q[R+1]+q[L+1]),q[R+2]=.5*(q[R+2]+q[L+2]),q[L]=q[R],q[L+1]=q[R+1],q[L+2]=q[R+2]}U.areNormalsFrozen||U.updateVerticesData(h.e.NormalKind,q,!1,!1)}return U}{const B=new N.d(R,L);B._originalBuilderSideOrientation=y,B._creationDataStorage=new N.f;const h=Y(q);return e&&(B._creationDataStorage.idx=h._idx),B._creationDataStorage.closePath=e,B._creationDataStorage.closeArray=C,h.Ca(B,n),B}}Z.d.CreateRibbon=Y,N.d.CreateRibbon=function(R,q){return F(R,{pathArray:q,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var C=L(11745),e=L(11390),y=L(11112);function U(R){const q=R.pattern||N.d.NO_FLIP,L=R.tileWidth||R.tileSize||1,B=R.tileHeight||R.tileSize||1,h=R.alignHorizontal||0,z=R.alignVertical||0,Y=R.width||R.size||1,F=Math.floor(Y/L);let C=Y-F*L;const e=R.height||R.size||1,y=Math.floor(e/B);let U=e-y*B;const n=L*F/2,r=B*y/2;let p=0,c=0,d=0,f=0,v=0,T=0;if(C>0||U>0){switch(d=-n,f=-r,v=n,T=r,h){case N.d.CENTER:C/=2,d-=C,v+=C;break;case N.d.LEFT:v+=C,p=-C/2;break;case N.d.RIGHT:d-=C,p=C/2}switch(z){case N.d.CENTER:U/=2,f-=U,T+=U;break;case N.d.BOTTOM:T+=U,c=-U/2;break;case N.d.TOP:f-=U,c=U/2}}const t=[],D=[],S=[];S[0]=[0,0,1,0,1,1,0,1],S[1]=[0,0,1,0,1,1,0,1],q!==N.d.ROTATE_TILE&&q!==N.d.ROTATE_ROW||(S[1]=[1,1,0,1,0,0,1,0]),q!==N.d.FLIP_TILE&&q!==N.d.FLIP_ROW||(S[1]=[1,0,0,0,0,1,1,1]),q!==N.d.FLIP_N_ROTATE_TILE&&q!==N.d.FLIP_N_ROTATE_ROW||(S[1]=[0,1,1,1,1,0,0,0]);let I=[];const K=[],m=[];let o=0;for(let Z=0;Z<y;Z++)for(let R=0;R<F;R++)t.push(R*L-n+p,Z*B-r+c,0),t.push((R+1)*L-n+p,Z*B-r+c,0),t.push((R+1)*L-n+p,(Z+1)*B-r+c,0),t.push(R*L-n+p,(Z+1)*B-r+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),I=q===N.d.FLIP_TILE||q===N.d.ROTATE_TILE||q===N.d.FLIP_N_ROTATE_TILE?I.concat(S[(R%2+Z%2)%2]):q===N.d.FLIP_ROW||q===N.d.ROTATE_ROW||q===N.d.FLIP_N_ROTATE_ROW?I.concat(S[Z%2]):I.concat(S[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),o+=4;if(C>0||U>0){const R=U>0&&(z===N.d.CENTER||z===N.d.TOP),Z=U>0&&(z===N.d.CENTER||z===N.d.BOTTOM),Y=C>0&&(h===N.d.CENTER||h===N.d.RIGHT),e=C>0&&(h===N.d.CENTER||h===N.d.LEFT);let S,l,G,W,H=[];if(R&&Y&&(t.push(d+p,f+c,0),t.push(-n+p,f+c,0),t.push(-n+p,f+U+c,0),t.push(d+p,f+U+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,S=1-C/L,l=1-U/B,G=1,W=1,H=[S,l,G,l,G,W,S,W],q===N.d.ROTATE_ROW&&(H=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),q===N.d.FLIP_ROW&&(H=[1-S,l,1-G,l,1-G,W,1-S,W]),q===N.d.FLIP_N_ROTATE_ROW&&(H=[S,1-l,G,1-l,G,1-W,S,1-W]),I=I.concat(H),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R&&e&&(t.push(n+p,f+c,0),t.push(v+p,f+c,0),t.push(v+p,f+U+c,0),t.push(n+p,f+U+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,S=0,l=1-U/B,G=C/L,W=1,H=[S,l,G,l,G,W,S,W],(q===N.d.ROTATE_ROW||q===N.d.ROTATE_TILE&&F%2===0)&&(H=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),(q===N.d.FLIP_ROW||q===N.d.FLIP_TILE&&F%2===0)&&(H=[1-S,l,1-G,l,1-G,W,1-S,W]),(q===N.d.FLIP_N_ROTATE_ROW||q===N.d.FLIP_N_ROTATE_TILE&&F%2===0)&&(H=[S,1-l,G,1-l,G,1-W,S,1-W]),I=I.concat(H),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&Y&&(t.push(d+p,r+c,0),t.push(-n+p,r+c,0),t.push(-n+p,T+c,0),t.push(d+p,T+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,S=1-C/L,l=0,G=1,W=U/B,H=[S,l,G,l,G,W,S,W],(q===N.d.ROTATE_ROW&&y%2===1||q===N.d.ROTATE_TILE&&y%1===0)&&(H=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),(q===N.d.FLIP_ROW&&y%2===1||q===N.d.FLIP_TILE&&y%2===0)&&(H=[1-S,l,1-G,l,1-G,W,1-S,W]),(q===N.d.FLIP_N_ROTATE_ROW&&y%2===1||q===N.d.FLIP_N_ROTATE_TILE&&y%2===0)&&(H=[S,1-l,G,1-l,G,1-W,S,1-W]),I=I.concat(H),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&e&&(t.push(n+p,r+c,0),t.push(v+p,r+c,0),t.push(v+p,T+c,0),t.push(n+p,T+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,S=0,l=0,G=C/L,W=U/B,H=[S,l,G,l,G,W,S,W],(q===N.d.ROTATE_ROW&&y%2===1||q===N.d.ROTATE_TILE&&(y+F)%2===1)&&(H=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),(q===N.d.FLIP_ROW&&y%2===1||q===N.d.FLIP_TILE&&(y+F)%2===1)&&(H=[1-S,l,1-G,l,1-G,W,1-S,W]),(q===N.d.FLIP_N_ROTATE_ROW&&y%2===1||q===N.d.FLIP_N_ROTATE_TILE&&(y+F)%2===1)&&(H=[S,1-l,G,1-l,G,1-W,S,1-W]),I=I.concat(H),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R){const R=[];S=0,l=1-U/B,G=1,W=1,R[0]=[S,l,G,l,G,W,S,W],R[1]=[S,l,G,l,G,W,S,W],q!==N.d.ROTATE_TILE&&q!==N.d.ROTATE_ROW||(R[1]=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),q!==N.d.FLIP_TILE&&q!==N.d.FLIP_ROW||(R[1]=[1-S,l,1-G,l,1-G,W,1-S,W]),q!==N.d.FLIP_N_ROTATE_TILE&&q!==N.d.FLIP_N_ROTATE_ROW||(R[1]=[S,1-l,G,1-l,G,1-W,S,1-W]);for(let B=0;B<F;B++)t.push(B*L-n+p,f+c,0),t.push((B+1)*L-n+p,f+c,0),t.push((B+1)*L-n+p,f+U+c,0),t.push(B*L-n+p,f+U+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=q===N.d.FLIP_TILE||q===N.d.ROTATE_TILE||q===N.d.FLIP_N_ROTATE_TILE?I.concat(R[(B+1)%2]):q===N.d.FLIP_ROW||q===N.d.ROTATE_ROW||q===N.d.FLIP_N_ROTATE_ROW?I.concat(R[1]):I.concat(R[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const R=[];S=0,l=0,G=1,W=U/B,R[0]=[S,l,G,l,G,W,S,W],R[1]=[S,l,G,l,G,W,S,W],q!==N.d.ROTATE_TILE&&q!==N.d.ROTATE_ROW||(R[1]=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),q!==N.d.FLIP_TILE&&q!==N.d.FLIP_ROW||(R[1]=[1-S,l,1-G,l,1-G,W,1-S,W]),q!==N.d.FLIP_N_ROTATE_TILE&&q!==N.d.FLIP_N_ROTATE_ROW||(R[1]=[S,1-l,G,1-l,G,1-W,S,1-W]);for(let B=0;B<F;B++)t.push(B*L-n+p,T-U+c,0),t.push((B+1)*L-n+p,T-U+c,0),t.push((B+1)*L-n+p,T+c,0),t.push(B*L-n+p,T+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=q===N.d.FLIP_TILE||q===N.d.ROTATE_TILE||q===N.d.FLIP_N_ROTATE_TILE?I.concat(R[(B+y)%2]):q===N.d.FLIP_ROW||q===N.d.ROTATE_ROW||q===N.d.FLIP_N_ROTATE_ROW?I.concat(R[y%2]):I.concat(R[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const R=[];S=1-C/L,l=0,G=1,W=1,R[0]=[S,l,G,l,G,W,S,W],R[1]=[S,l,G,l,G,W,S,W],q!==N.d.ROTATE_TILE&&q!==N.d.ROTATE_ROW||(R[1]=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),q!==N.d.FLIP_TILE&&q!==N.d.FLIP_ROW||(R[1]=[1-S,l,1-G,l,1-G,W,1-S,W]),q!==N.d.FLIP_N_ROTATE_TILE&&q!==N.d.FLIP_N_ROTATE_ROW||(R[1]=[S,1-l,G,1-l,G,1-W,S,1-W]);for(let L=0;L<y;L++)t.push(d+p,L*B-r+c,0),t.push(d+C+p,L*B-r+c,0),t.push(d+C+p,(L+1)*B-r+c,0),t.push(d+p,(L+1)*B-r+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=q===N.d.FLIP_TILE||q===N.d.ROTATE_TILE||q===N.d.FLIP_N_ROTATE_TILE?I.concat(R[(L+1)%2]):q===N.d.FLIP_ROW||q===N.d.ROTATE_ROW||q===N.d.FLIP_N_ROTATE_ROW?I.concat(R[L%2]):I.concat(R[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const R=[];S=0,l=0,G=C/B,W=1,R[0]=[S,l,G,l,G,W,S,W],R[1]=[S,l,G,l,G,W,S,W],q!==N.d.ROTATE_TILE&&q!==N.d.ROTATE_ROW||(R[1]=[1-S,1-l,1-G,1-l,1-G,1-W,1-S,1-W]),q!==N.d.FLIP_TILE&&q!==N.d.FLIP_ROW||(R[1]=[1-S,l,1-G,l,1-G,W,1-S,W]),q!==N.d.FLIP_N_ROTATE_TILE&&q!==N.d.FLIP_N_ROTATE_ROW||(R[1]=[S,1-l,G,1-l,G,1-W,S,1-W]);for(let L=0;L<y;L++)t.push(v-C+p,L*B-r+c,0),t.push(v+p,L*B-r+c,0),t.push(v+p,(L+1)*B-r+c,0),t.push(v-C+p,(L+1)*B-r+c,0),m.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=q===N.d.FLIP_TILE||q===N.d.ROTATE_TILE||q===N.d.FLIP_N_ROTATE_TILE?I.concat(R[(L+F)%2]):q===N.d.FLIP_ROW||q===N.d.ROTATE_ROW||q===N.d.FLIP_N_ROTATE_ROW?I.concat(R[L%2]):I.concat(R[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const l=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE;Z.d._ComputeSides(l,t,m,D,I,R.frontUVs,R.backUVs);const G=new Z.d;G.indices=m,G.xa=t,G.ya=D,G.Aa=I;const W=l===Z.d.DOUBLESIDE?K.concat(K):K;return G.za=W,G}function n(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return U(q).Ca(B,q.updatable),B}function r(R){const q=R.faceUV||new Array(6),L=R.faceColors,h=R.pattern||N.d.NO_FLIP,Y=R.width||R.size||1,F=R.height||R.size||1,C=R.depth||R.size||1,e=R.tileWidth||R.tileSize||1,n=R.tileHeight||R.tileSize||1,r=R.alignHorizontal||0,p=R.alignVertical||0,c=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE;for(let N=0;N<6;N++)void 0===q[N]&&(q[N]=new B.q(0,0,1,1)),L&&void 0===L[N]&&(L[N]=new y.g(1,1,1,1));const d=Y/2,f=F/2,v=C/2,T=[];for(let B=0;B<2;B++)T[B]=U({pattern:h,tileWidth:e,tileHeight:n,width:Y,height:F,alignVertical:p,alignHorizontal:r,sideOrientation:c});for(let B=2;B<4;B++)T[B]=U({pattern:h,tileWidth:e,tileHeight:n,width:C,height:F,alignVertical:p,alignHorizontal:r,sideOrientation:c});let t=p;p===N.d.BOTTOM?t=N.d.TOP:p===N.d.TOP&&(t=N.d.BOTTOM);for(let B=4;B<6;B++)T[B]=U({pattern:h,tileWidth:e,tileHeight:n,width:Y,height:C,alignVertical:t,alignHorizontal:r,sideOrientation:c});let D=[],S=[],I=[],K=[];const m=[],o=[],l=[],G=[];let W=0,H=0;for(let N=0;N<6;N++){const R=T[N].xa.length;o[N]=[],l[N]=[];for(let q=0;q<R/3;q++)o[N].push(new B.m(T[N].xa[3*q],T[N].xa[3*q+1],T[N].xa[3*q+2])),l[N].push(new B.m(T[N].ya[3*q],T[N].ya[3*q+1],T[N].ya[3*q+2]));W=T[N].Aa.length,G[N]=[];for(let L=0;L<W;L+=2)G[N][L]=q[N].x+(q[N].z-q[N].x)*T[N].Aa[L],G[N][L+1]=q[N].y+(q[N].w-q[N].y)*T[N].Aa[L+1],z.e&&(G[N][L+1]=1-G[N][L+1]);if(I=I.concat(G[N]),K=K.concat(T[N].indices.map((R=>R+H))),H+=o[N].length,L)for(let q=0;q<4;q++)m.push(L[N].r,L[N].g,L[N].b,L[N].a)}const P=new B.m(0,0,v),O=B.c.RotationY(Math.PI);D=o[0].map((R=>B.m.TransformNormal(R,O).add(P))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[]),S=l[0].map((R=>B.m.TransformNormal(R,O))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[]),D=D.concat(o[1].map((R=>R.Bc(P))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[])),S=S.concat(l[1].map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[]));const E=new B.m(d,0,0),a=B.c.RotationY(-Math.PI/2);D=D.concat(o[2].map((R=>B.m.TransformNormal(R,a).add(E))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[])),S=S.concat(l[2].map((R=>B.m.TransformNormal(R,a))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[]));const g=B.c.RotationY(Math.PI/2);D=D.concat(o[3].map((R=>B.m.TransformNormal(R,g).Bc(E))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[])),S=S.concat(l[3].map((R=>B.m.TransformNormal(R,g))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[]));const Q=new B.m(0,f,0),i=B.c.RotationX(Math.PI/2);D=D.concat(o[4].map((R=>B.m.TransformNormal(R,i).add(Q))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[])),S=S.concat(l[4].map((R=>B.m.TransformNormal(R,i))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[]));const k=B.c.RotationX(-Math.PI/2);D=D.concat(o[5].map((R=>B.m.TransformNormal(R,k).Bc(Q))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[])),S=S.concat(l[5].map((R=>B.m.TransformNormal(R,k))).map((R=>[R.x,R.y,R.z])).reduce(((R,q)=>R.concat(q)),[])),Z.d._ComputeSides(c,D,K,S,I);const V=new Z.d;if(V.indices=K,V.xa=D,V.ya=S,V.Aa=I,L){const R=c===Z.d.DOUBLESIDE?m.concat(m):m;V.za=R}return V}function p(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return r(q).Ca(B,q.updatable),B}Z.d.CreateTiledPlane=U;Z.d.CreateTiledBox=r;var c=L(11733),d=L(11071),f=L(11382);function v(R){const q=R.height||2;let L=0===R.diameterTop?0:R.diameterTop||R.diameter||1,h=0===R.diameterBottom?0:R.diameterBottom||R.diameter||1;L=L||1e-5,h=h||1e-5;const Y=0|(R.tessellation||24),F=0|(R.subdivisions||1),C=!!R.hasRings,e=!!R.enclose,U=0===R.cap?0:R.cap||N.d.CAP_ALL,n=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,r=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,p=R.faceUV||new Array(3),c=R.faceColors,d=2+(1+(1!==n&&e?2:0))*(C?F:1);let v;for(v=0;v<d;v++)c&&void 0===c[v]&&(c[v]=new y.g(1,1,1,1));for(v=0;v<d;v++)p&&void 0===p[v]&&(p[v]=new B.q(0,0,1,1));const T=[],t=[],D=[],S=[],I=[],K=2*Math.PI*n/Y;let m,o,l;const G=(h-L)/2/q,W=B.m.Zero(),H=B.m.Zero(),P=B.m.Zero(),O=B.m.Zero(),E=B.m.Zero(),a=f.e.Y;let g,Q,i,k=1,V=1,x=0,w=0;for(g=0;g<=F;g++)for(o=g/F,l=(o*(L-h)+h)/2,k=C&&0!==g&&g!==F?2:1,i=0;i<k;i++){for(C&&(V+=i),e&&(V+=2*i),Q=0;Q<=Y;Q++)m=Q*K,W.x=Math.cos(-m)*l,W.y=-q/2+o*q,W.z=Math.sin(-m)*l,0===L&&g===F?(H.x=D[D.length-3*(Y+1)],H.y=D[D.length-3*(Y+1)+1],H.z=D[D.length-3*(Y+1)+2]):(H.x=W.x,H.z=W.z,H.y=Math.sqrt(H.x*H.x+H.z*H.z)*G,H.normalize()),0===Q&&(P.p(W),O.p(H)),t.push(W.x,W.y,W.z),D.push(H.x,H.y,H.z),w=C?x!==V?p[V].y:p[V].w:p[V].y+(p[V].w-p[V].y)*o,S.push(p[V].x+(p[V].z-p[V].x)*Q/Y,z.e?1-w:w),c&&I.push(c[V].r,c[V].g,c[V].b,c[V].a);1!==n&&e&&(t.push(W.x,W.y,W.z),t.push(0,W.y,0),t.push(0,W.y,0),t.push(P.x,P.y,P.z),B.m.CrossToRef(a,H,E),E.normalize(),D.push(E.x,E.y,E.z,E.x,E.y,E.z),B.m.CrossToRef(O,a,E),E.normalize(),D.push(E.x,E.y,E.z,E.x,E.y,E.z),w=C?x!==V?p[V+1].y:p[V+1].w:p[V+1].y+(p[V+1].w-p[V+1].y)*o,S.push(p[V+1].x,z.e?1-w:w),S.push(p[V+1].z,z.e?1-w:w),w=C?x!==V?p[V+2].y:p[V+2].w:p[V+2].y+(p[V+2].w-p[V+2].y)*o,S.push(p[V+2].x,z.e?1-w:w),S.push(p[V+2].z,z.e?1-w:w),c&&(I.push(c[V+1].r,c[V+1].g,c[V+1].b,c[V+1].a),I.push(c[V+1].r,c[V+1].g,c[V+1].b,c[V+1].a),I.push(c[V+2].r,c[V+2].g,c[V+2].b,c[V+2].a),I.push(c[V+2].r,c[V+2].g,c[V+2].b,c[V+2].a))),x!==V&&(x=V)}const j=1!==n&&e?Y+4:Y;for(g=0,V=0;V<F;V++){let R=0,q=0,L=0,B=0;for(Q=0;Q<Y;Q++)R=g*(j+1)+Q,q=(g+1)*(j+1)+Q,L=g*(j+1)+(Q+1),B=(g+1)*(j+1)+(Q+1),T.push(R,q,L),T.push(B,L,q);1!==n&&e&&(T.push(R+2,q+2,L+2),T.push(B+2,L+2,q+2),T.push(R+4,q+4,L+4),T.push(B+4,L+4,q+4)),g=C?g+2:g+1}const J=R=>{const N=R?L/2:h/2;if(0===N)return;let Z,F,C;const e=R?p[d-1]:p[0];let y=null;c&&(y=R?c[d-1]:c[0]);const U=t.length/3,r=R?q/2:-q/2,f=new B.m(0,r,0);t.push(f.x,f.y,f.z),D.push(0,R?1:-1,0);const v=e.y+.5*(e.w-e.y);S.push(e.x+.5*(e.z-e.x),z.e?1-v:v),y&&I.push(y.r,y.g,y.b,y.a);const K=new B.i(.5,.5);for(C=0;C<=Y;C++){Z=2*Math.PI*C*n/Y;const q=Math.cos(-Z),L=Math.sin(-Z);F=new B.m(q*N,r,L*N);const h=new B.i(q*K.x+.5,L*K.y+.5);t.push(F.x,F.y,F.z),D.push(0,R?1:-1,0);const U=e.y+(e.w-e.y)*h.y;S.push(e.x+(e.z-e.x)*h.x,z.e?1-U:U),y&&I.push(y.r,y.g,y.b,y.a)}for(C=0;C<Y;C++)R?(T.push(U),T.push(U+(C+2)),T.push(U+(C+1))):(T.push(U),T.push(U+(C+1)),T.push(U+(C+2)))};U!==N.d.CAP_START&&U!==N.d.CAP_ALL||J(!1),U!==N.d.CAP_END&&U!==N.d.CAP_ALL||J(!0),Z.d._ComputeSides(r,t,T,D,S,R.frontUVs,R.backUVs);const s=new Z.d;return s.indices=T,s.xa=t,s.ya=D,s.Aa=S,c&&(s.za=I),s}function T(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return v(q).Ca(B,q.updatable),B}function t(R){const q=[],L=[],N=[],h=[],Y=R.diameter||1,F=R.thickness||.5,C=0|(R.tessellation||16),e=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,y=C+1;for(let Z=0;Z<=C;Z++){const R=Z/C,e=Z*Math.PI*2/C-Math.PI/2,U=B.c.Translation(Y/2,0,0).multiply(B.c.RotationY(e));for(let Y=0;Y<=C;Y++){const e=1-Y/C,n=Y*Math.PI*2/C+Math.PI,r=Math.cos(n),p=Math.sin(n);let c=new B.m(r,p,0),d=c.scale(F/2);const f=new B.i(R,e);d=B.m.TransformCoordinates(d,U),c=B.m.TransformNormal(c,U),L.push(d.x,d.y,d.z),N.push(c.x,c.y,c.z),h.push(f.x,z.e?1-f.y:f.y);const v=(Z+1)%y,T=(Y+1)%y;q.push(Z*y+Y),q.push(Z*y+T),q.push(v*y+Y),q.push(Z*y+T),q.push(v*y+T),q.push(v*y+Y)}}Z.d._ComputeSides(e,L,q,N,h,R.frontUVs,R.backUVs);const U=new Z.d;return U.indices=q,U.xa=L,U.ya=N,U.Aa=h,U}function D(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return t(q).Ca(B,q.updatable),B}Z.d.CreateCylinder=v,N.d.CreateCylinder=(R,q,L,B,h,Z,z,Y,F)=>{void 0!==z&&z instanceof d.b||(void 0!==z&&(F=Y||N.d.DEFAULTSIDE,Y=z),z=Z,Z=1);return T(R,{height:q,diameterTop:L,diameterBottom:B,tessellation:h,subdivisions:Z,sideOrientation:F,updatable:Y},z)};function S(R){const q=[],L=[],N=[],h=[],Y=R.radius||2,F=R.tube||.5,C=R.radialSegments||32,e=R.tubularSegments||32,y=R.p||2,U=R.q||3,n=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,r=R=>{const q=Math.cos(R),L=Math.sin(R),N=U/y*R,h=Math.cos(N),Z=Y*(2+h)*.5*q,z=Y*(2+h)*L*.5,F=Y*Math.sin(N)*.5;return new B.m(Z,z,F)};let p,c;for(p=0;p<=C;p++){const R=p%C/C*2*y*Math.PI,q=r(R),N=r(R+.01),Z=N.Bc(q);let Y=N.add(q);const U=B.m.Cross(Z,Y);for(Y=B.m.Cross(U,Z),U.normalize(),Y.normalize(),c=0;c<e;c++){const R=c%e/e*2*Math.PI,B=-F*Math.cos(R),N=F*Math.sin(R);L.push(q.x+B*Y.x+N*U.x),L.push(q.y+B*Y.y+N*U.y),L.push(q.z+B*Y.z+N*U.z),h.push(p/C),h.push(z.e?1-c/e:c/e)}}for(p=0;p<C;p++)for(c=0;c<e;c++){const R=(c+1)%e,L=p*e+c,B=(p+1)*e+c,N=(p+1)*e+R,h=p*e+R;q.push(h),q.push(B),q.push(L),q.push(h),q.push(N),q.push(B)}Z.d.ComputeNormals(L,q,N),Z.d._ComputeSides(n,L,q,N,h,R.frontUVs,R.backUVs);const d=new Z.d;return d.indices=q,d.xa=L,d.ya=N,d.Aa=h,d}function I(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return S(q).Ca(B,q.updatable),B}Z.d.CreateTorus=t,N.d.CreateTorus=(R,q,L,B,N,h,Z)=>D(R,{diameter:q,thickness:L,tessellation:B,sideOrientation:Z,updatable:h},N);Z.d.CreateTorusKnot=S,N.d.CreateTorusKnot=(R,q,L,B,N,h,Z,z,Y,F)=>I(R,{radius:q,tube:L,radialSegments:B,tubularSegments:N,p:h,q:Z,sideOrientation:F,updatable:Y},z);var K=L(12460),m=L(10767),o=L(11579),l=L(11088),G=L(10797);class W extends B.i{constructor(R,q){super(R.x,R.y),this.index=q}}class H{constructor(){this.elements=[]}add(R){const q=[];return R.forEach((R=>{const L=new W(R,this.elements.length);q.push(L),this.elements.push(L)})),q}computeBounds(){const R=new B.i(this.elements[0].x,this.elements[0].y),q=new B.i(this.elements[0].x,this.elements[0].y);return this.elements.forEach((L=>{L.x<R.x?R.x=L.x:L.x>q.x&&(q.x=L.x),L.y<R.y?R.y=L.y:L.y>q.y&&(q.y=L.y)})),{min:R,max:q,width:q.x-R.x,height:q.y-R.y}}}class P{_addToepoint(R){for(const q of R)this._epoints.push(q.x,q.y)}constructor(R,q,L){let B,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new H,this._outlinepoints=new H,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=N,this._name=R,this._scene=L||G.b.LastCreatedScene,B=q instanceof o.d?q.getPoints():q,this._addToepoint(B),this._points.add(B),this._outlinepoints.add(B),"undefined"===typeof this.bjsEarcut&&m.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(R){this._points.add(R);const q=new H;return q.add(R),this._holes.push(q),this._eholes.push(this._epoints.length/2),this._addToepoint(R),this}build(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const B=new N.d(this._name,this._scene),Z=this.buildVertexData(q,L);return B.Ga(h.e.PositionKind,Z.xa,R),B.Ga(h.e.NormalKind,Z.ya,R),B.Ga(h.e.UVKind,Z.Aa,R),B.setIndices(Z.indices),B}buildVertexData(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const L=new Z.d,B=[],N=[],h=[],z=this._points.computeBounds();this._points.elements.forEach((R=>{B.push(0,1,0),N.push(R.x,0,R.y),h.push((R.x-z.min.x)/z.width,(R.y-z.min.y)/z.height)}));const Y=[],F=this.bjsEarcut(this._epoints,this._eholes,2);for(let Z=0;Z<F.length;Z++)Y.push(F[Z]);if(R>0){const L=N.length/3;this._points.elements.forEach((q=>{B.push(0,-1,0),N.push(q.x,-R,q.y),h.push(1-(q.x-z.min.x)/z.width,1-(q.y-z.min.y)/z.height)}));const Z=Y.length;for(let R=0;R<Z;R+=3){const q=Y[R+0],B=Y[R+1],N=Y[R+2];Y.push(N+L),Y.push(B+L),Y.push(q+L)}this._addSide(N,B,h,Y,z,this._outlinepoints,R,!1,q),this._holes.forEach((L=>{this._addSide(N,B,h,Y,z,L,R,!0,q)}))}return L.indices=Y,L.xa=N,L.ya=B,L.Aa=h,L}_addSide(R,q,L,N,h,Z,z,Y,F){let C=R.length/3,e=0;for(let y=0;y<Z.elements.length;y++){const U=Z.elements[y],n=Z.elements[(y+1)%Z.elements.length];R.push(U.x,0,U.y),R.push(U.x,-z,U.y),R.push(n.x,0,n.y),R.push(n.x,-z,n.y);const r=Z.elements[(y+Z.elements.length-1)%Z.elements.length],p=Z.elements[(y+2)%Z.elements.length];let c=new B.m(-(n.y-U.y),0,n.x-U.x),d=new B.m(-(U.y-r.y),0,U.x-r.x),f=new B.m(-(p.y-n.y),0,p.x-n.x);Y||(c=c.scale(-1),d=d.scale(-1),f=f.scale(-1));const v=c.normalizeToNew();let T=d.normalizeToNew(),t=f.normalizeToNew();const D=B.m.Dot(T,v);T=D>F?D<l.e-1?new B.m(U.x,0,U.y).Bc(new B.m(n.x,0,n.y)).normalize():d.add(c).normalize():v;const S=B.m.Dot(f,c);t=S>F?S<l.e-1?new B.m(n.x,0,n.y).Bc(new B.m(U.x,0,U.y)).normalize():f.add(c).normalize():v,L.push(e/h.width,0),L.push(e/h.width,1),e+=c.length(),L.push(e/h.width,0),L.push(e/h.width,1),q.push(T.x,T.y,T.z),q.push(T.x,T.y,T.z),q.push(t.x,t.y,t.z),q.push(t.x,t.y,t.z),Y?(N.push(C),N.push(C+2),N.push(C+1),N.push(C+1),N.push(C+2),N.push(C+3)):(N.push(C),N.push(C+1),N.push(C+2),N.push(C+1),N.push(C+3),N.push(C+2)),C+=4}}}function O(R,q,L,N,Y,F,C){const e=L||new Array(3),U=N,n=[],r=C||!1;for(let h=0;h<3;h++)void 0===e[h]&&(e[h]=new B.q(0,0,1,1)),U&&void 0===U[h]&&(U[h]=new y.g(1,1,1,1));const p=R.getVerticesData(h.e.PositionKind),c=R.getVerticesData(h.e.NormalKind),d=R.getVerticesData(h.e.UVKind),f=R.Sf(),v=p.length/9;let T=0,t=0,D=0,S=0,I=0;const K=[0];if(r)for(let B=v;B<p.length/3;B+=4)t=p[3*(B+2)]-p[3*B],D=p[3*(B+2)+2]-p[3*B+2],S=Math.sqrt(t*t+D*D),I+=S,K.push(I);let m=0,o=0;for(let B=0;B<c.length;B+=3)Math.abs(c[B+1])<.001&&(o=1),Math.abs(c[B+1]-1)<.001&&(o=0),Math.abs(c[B+1]+1)<.001&&(o=2),m=B/3,1===o?(T=m-v,d[2*m]=T%4<1.5?r?e[o].x+(e[o].z-e[o].x)*K[Math.floor(T/4)]/I:e[o].x:r?e[o].x+(e[o].z-e[o].x)*K[Math.floor(T/4)+1]/I:e[o].z,d[2*m+1]=T%2===0?z.e?1-e[o].w:e[o].w:z.e?1-e[o].y:e[o].y):(d[2*m]=(1-d[2*m])*e[o].x+d[2*m]*e[o].z,d[2*m+1]=(1-d[2*m+1])*e[o].y+d[2*m+1]*e[o].w,z.e&&(d[2*m+1]=1-d[2*m+1])),U&&n.push(U[o].r,U[o].g,U[o].b,U[o].a);Z.d._ComputeSides(q,p,f,c,d,Y,F);const l=new Z.d;if(l.indices=f,l.xa=p,l.ya=c,l.Aa=d,U){const R=q===Z.d.DOUBLESIDE?n.concat(n):n;l.za=R}return l}function E(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation);const Z=q.shape,z=q.holes||[],Y=q.depth||0,F=q.smoothingThreshold||2,C=[];let e=[];for(let N=0;N<Z.length;N++)C[N]=new B.i(Z[N].x,Z[N].z);C[0].equalsWithEpsilon(C[C.length-1],1e-8)&&C.pop();const y=new P(R,C,L||G.b.LastCreatedScene,h);for(let N=0;N<z.length;N++){e=[];for(let R=0;R<z[N].length;R++)e.push(new B.i(z[N][R].x,z[N][R].z));y.addHole(e)}const U=y.build(!1,Y,F);U._originalBuilderSideOrientation=q.sideOrientation;return O(U,q.sideOrientation,q.faceUV,q.faceColors,q.frontUVs,q.backUVs,q.wrap).Ca(U,q.updatable),U}function a(R,q){return E(R,q,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function g(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.path,h=q.shape,Z=q.scale||1,z=q.rotation||0,Y=0===q.cap?0:q.cap||N.d.NO_CAP,F=q.updatable,C=N.d._GetDefaultSideOrientation(q.sideOrientation),e=q.instance||null,y=q.invertUV||!1,U=q.closeShape||!1;return i(R,h,B,Z,z,null,null,q.closePath||!1,U,Y,!1,L,!!F,C,e,y,q.frontUVs||null,q.backUVs||null,q.firstNormal||null,!!q.adjustFrame)}function Q(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=q.path,h=q.shape,Z=q.scaleFunction||(()=>1),z=q.rotationFunction||(()=>0),Y=q.closePath||q.ribbonCloseArray||!1,F=q.closeShape||q.ribbonClosePath||!1,C=0===q.cap?0:q.cap||N.d.NO_CAP,e=q.updatable,y=q.firstNormal||null,U=q.adjustFrame||!1;return i(R,h,B,null,null,Z,z,Y,F,C,!0,L,!!e,N.d._GetDefaultSideOrientation(q.sideOrientation),q.instance||null,q.invertUV||!1,q.frontUVs||null,q.backUVs||null,y,U)}function i(R,q,L,h,Z,z,Y,C,e,y,U,n,r,p,c,d,f,v,T,t){const D=(R,q,L,h,Z,z,Y,F,C,e,y)=>{const U=L.getTangents(),n=L.getNormals(),r=L.getBinormals(),p=L.getDistances();if(y)for(let N=0;N<U.length;N++)if(0==U[N].x&&0==U[N].y&&0==U[N].z&&U[N].p(U[N-1]),0==n[N].x&&0==n[N].y&&0==n[N].z&&n[N].p(n[N-1]),0==r[N].x&&0==r[N].y&&0==r[N].z&&r[N].p(r[N-1]),N>0){let R=U[N-1];B.m.Dot(R,U[N])<0&&U[N].scaleInPlace(-1),R=n[N-1],B.m.Dot(R,n[N])<0&&n[N].scaleInPlace(-1),R=r[N-1],B.m.Dot(R,r[N])<0&&r[N].scaleInPlace(-1)}let c=0;const d=e&&F?F:()=>null!==z?z:0,f=e&&Y?Y:()=>null!==Z?Z:1;let v=C===N.d.NO_CAP||C===N.d.CAP_END?0:2;const T=B.h.Matrix[0];for(let N=0;N<q.length;N++){const L=[],Z=d(N,p[N]),z=f(N,p[N]);B.c.RotationAxisToRef(U[N],c,T);for(let h=0;h<R.length;h++){const Z=U[N].scale(R[h].z).add(n[N].scale(R[h].x)).add(r[N].scale(R[h].y)),Y=B.m.Zero();B.m.TransformCoordinatesToRef(Z,T,Y),Y.scaleInPlace(z).addInPlace(q[N]),L[h]=Y}h[v]=L,c+=Z,v++}const t=R=>{const q=Array(),L=B.m.Zero();let N;for(N=0;N<R.length;N++)L.addInPlace(R[N]);for(L.scaleInPlace(1/R.length),N=0;N<R.length;N++)q.push(L);return q};switch(C){case N.d.NO_CAP:break;case N.d.CAP_START:h[0]=t(h[2]),h[1]=h[2];break;case N.d.CAP_END:h[v]=h[v-1],h[v+1]=t(h[v-1]);break;case N.d.CAP_ALL:h[0]=t(h[2]),h[1]=h[2],h[v]=h[v-1],h[v+1]=t(h[v-1])}return h};let S,I;if(c){const R=c._creationDataStorage;return S=T?R.path3D.update(L,T):R.path3D.update(L),I=D(q,L,R.path3D,R.pathArray,h,Z,z,Y,R.cap,U,t),c=F("",{pathArray:I,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:c},n||void 0)}S=T?new o.e(L,T):new o.e(L);I=D(q,L,S,new Array,h,Z,z,Y,y=y<0||y>3?0:y,U,t);const K=F(R,{pathArray:I,closeArray:C,closePath:e,updatable:r,sideOrientation:p,invertUV:d,frontUVs:f||void 0,backUVs:v||void 0},n);return K._creationDataStorage.pathArray=I,K._creationDataStorage.path3D=S,K._creationDataStorage.cap=y,K}Z.d.CreatePolygon=O,N.d.CreatePolygon=function(R,q,L,B,N,h){return E(R,{shape:q,holes:B,updatable:N,sideOrientation:h},L,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},N.d.ExtrudePolygon=function(R,q,L,B,N,h,Z){return a(R,{shape:q,holes:N,depth:L,updatable:h,sideOrientation:Z},B,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function k(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=q.arc?q.arc<=0||q.arc>1?1:q.arc:1,Z=void 0===q.closed||q.closed,z=q.shape,Y=q.radius||1,C=q.tessellation||64,e=q.clip||0,y=q.updatable,U=N.d._GetDefaultSideOrientation(q.sideOrientation),n=q.cap||N.d.NO_CAP,r=2*Math.PI,p=[],c=q.invertUV||!1;let d=0,f=0;const v=r/C*h;let T,t;for(d=0;d<=C-e;d++){for(t=[],n!=N.d.CAP_START&&n!=N.d.CAP_ALL||(t.push(new B.m(0,z[0].y,0)),t.push(new B.m(Math.cos(d*v)*z[0].x*Y,z[0].y,Math.sin(d*v)*z[0].x*Y))),f=0;f<z.length;f++)T=new B.m(Math.cos(d*v)*z[f].x*Y,z[f].y,Math.sin(d*v)*z[f].x*Y),t.push(T);n!=N.d.CAP_END&&n!=N.d.CAP_ALL||(t.push(new B.m(Math.cos(d*v)*z[z.length-1].x*Y,z[z.length-1].y,Math.sin(d*v)*z[z.length-1].x*Y)),t.push(new B.m(0,z[z.length-1].y,0))),p.push(t)}return F(R,{pathArray:p,closeArray:Z,sideOrientation:U,updatable:y,invertUV:c,frontUVs:q.frontUVs,backUVs:q.backUVs},L)}N.d.ExtrudeShape=function(R,q,L,B,h,Z){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7?arguments[7]:void 0,F=arguments.length>8?arguments[8]:void 0,C=arguments.length>9?arguments[9]:void 0;return g(R,{shape:q,path:L,scale:B,rotation:h,cap:0===Z?0:Z||N.d.NO_CAP,sideOrientation:F,instance:C,updatable:Y},z)},N.d.ExtrudeShapeCustom=(R,q,L,B,h,Z,z,Y,F,C,e,y)=>Q(R,{shape:q,path:L,scaleFunction:B,rotationFunction:h,ribbonCloseArray:Z,ribbonClosePath:z,cap:0===Y?0:Y||N.d.NO_CAP,sideOrientation:e,instance:y,updatable:C},F);N.d.CreateLathe=(R,q,L,B,N,h,Z)=>k(R,{shape:q,radius:L,tessellation:B,sideOrientation:Z,updatable:h},N);var V=L(11440),x=L(11393);function w(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=q.path;let Z=q.instance,z=1;void 0!==q.radius?z=q.radius:Z&&(z=Z._creationDataStorage.radius);const Y=q.tessellation||64,C=q.radiusFunction||null;let e=q.cap||N.d.NO_CAP;const y=q.invertUV||!1,U=q.updatable,n=N.d._GetDefaultSideOrientation(q.sideOrientation);q.arc=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1;const r=(R,q,L,h,Z,z,Y,F)=>{const C=q.getTangents(),e=q.getNormals(),y=q.getDistances(),U=2*Math.PI/Z*F,n=z||(()=>h);let r,p,c,d;const f=B.h.Matrix[0];let v=Y===N.d.NO_CAP||Y===N.d.CAP_END?0:2;for(let N=0;N<R.length;N++){p=n(N,y[N]),r=Array(),c=e[N];for(let q=0;q<Z;q++)B.c.RotationAxisToRef(C[N],U*q,f),d=r[q]?r[q]:B.m.Zero(),B.m.TransformCoordinatesToRef(c,f,d),d.scaleInPlace(p).addInPlace(R[N]),r[q]=d;L[v]=r,v++}const T=(q,L)=>{const B=Array();for(let N=0;N<q;N++)B.push(R[L]);return B};switch(Y){case N.d.NO_CAP:break;case N.d.CAP_START:L[0]=T(Z,0),L[1]=L[2].slice(0);break;case N.d.CAP_END:L[v]=L[v-1].slice(0),L[v+1]=T(Z,R.length-1);break;case N.d.CAP_ALL:L[0]=T(Z,0),L[1]=L[2].slice(0),L[v]=L[v-1].slice(0),L[v+1]=T(Z,R.length-1)}return L};let p,c;if(Z){const R=Z._creationDataStorage,L=q.arc||R.arc;return p=R.path3D.update(h),c=r(h,p,R.pathArray,z,R.tessellation,C,R.cap,L),Z=F("",{pathArray:c,instance:Z}),R.path3D=p,R.pathArray=c,R.arc=L,R.radius=z,Z}p=new o.e(h);e=e<0||e>3?0:e,c=r(h,p,new Array,z,Y,C,e,q.arc);const d=F(R,{pathArray:c,closePath:!0,closeArray:!1,updatable:U,sideOrientation:n,invertUV:y,frontUVs:q.frontUVs,backUVs:q.backUVs},L);return d._creationDataStorage.pathArray=c,d._creationDataStorage.path3D=p,d._creationDataStorage.tessellation=Y,d._creationDataStorage.cap=e,d._creationDataStorage.arc=q.arc,d._creationDataStorage.radius=z,d}function j(R){const q=[];q[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},q[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},q[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},q[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},q[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},q[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},q[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},q[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},q[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},q[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},q[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},q[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},q[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},q[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},q[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const L=R.type&&(R.type<0||R.type>=q.length)?0:R.type||0,N=R.size,h=R.sizeX||N||1,Y=R.sizeY||N||1,F=R.sizeZ||N||1,C=R.custom||q[L],e=C.face.length,U=R.faceUV||new Array(e),n=R.faceColors,r=void 0===R.flat||R.flat,p=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,c=[],d=[],f=[],v=[],T=[];let t=0,D=0;const S=[];let I,K,m,o,l,G,W=0,H=0;if(r)for(H=0;H<e;H++)n&&void 0===n[H]&&(n[H]=new y.g(1,1,1,1)),U&&void 0===U[H]&&(U[H]=new B.q(0,0,1,1));if(r)for(H=0;H<e;H++){const R=C.face[H].length;for(m=2*Math.PI/R,o=.5*Math.tan(m/2),l=.5,W=0;W<R;W++)c.push(C.vertex[C.face[H][W]][0]*h,C.vertex[C.face[H][W]][1]*Y,C.vertex[C.face[H][W]][2]*F),S.push(t),t++,I=U[H].x+(U[H].z-U[H].x)*(.5+o),K=U[H].y+(U[H].w-U[H].y)*(l-.5),v.push(I,z.e?1-K:K),G=o*Math.cos(m)-l*Math.sin(m),l=o*Math.sin(m)+l*Math.cos(m),o=G,n&&T.push(n[H].r,n[H].g,n[H].b,n[H].a);for(W=0;W<R-2;W++)d.push(S[0+D],S[W+2+D],S[W+1+D]);D+=R}else{for(W=0;W<C.vertex.length;W++)c.push(C.vertex[W][0]*h,C.vertex[W][1]*Y,C.vertex[W][2]*F),v.push(0,z.e?1:0);for(H=0;H<e;H++)for(W=0;W<C.face[H].length-2;W++)d.push(C.face[H][0],C.face[H][W+2],C.face[H][W+1])}Z.d.ComputeNormals(c,d,f),Z.d._ComputeSides(p,c,d,f,v,R.frontUVs,R.backUVs);const P=new Z.d;return P.xa=c,P.indices=d,P.ya=f,P.Aa=v,n&&r&&(P.za=T),P}function J(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return j(q).Ca(B,q.updatable),B}N.d.CreateTube=(R,q,L,B,N,h,Z,z,Y,F)=>w(R,{path:q,radius:L,tessellation:B,radiusFunction:N,arc:1,cap:h,updatable:z,sideOrientation:Y,instance:F},Z);function s(R){const q=R.sideOrientation||Z.d.DEFAULTSIDE,L=R.radius||1,N=void 0===R.flat||R.flat,h=0|(R.subdivisions||4),Y=R.radiusX||L,F=R.radiusY||L,C=R.radiusZ||L,e=(1+Math.sqrt(5))/2,y=[-1,e,-0,1,e,0,-1,-e,0,1,-e,0,0,-1,-e,0,1,-e,0,-1,e,0,1,e,e,0,1,e,0,-1,-e,0,1,-e,0,-1],U=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],n=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],r=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],p=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],c=[],d=[],f=[],v=[];let T=0;const t=new Array(3),D=new Array(3);let S;for(S=0;S<3;S++)t[S]=B.m.Zero(),D[S]=B.i.Zero();for(let Z=0;Z<20;Z++){for(S=0;S<3;S++){const R=U[3*Z+S];t[S].Td(y[3*n[R]],y[3*n[R]+1],y[3*n[R]+2]),t[S].normalize(),D[S].Td(.134765625*r[2*R]+.05859375+-.0390625*p[Z],.2333984375*r[2*R+1]+.025390625+.01953125*p[Z])}const R=(R,q,L,Z)=>{const e=B.m.Lerp(t[0],t[2],q/h),y=B.m.Lerp(t[1],t[2],q/h),U=h===q?t[2]:B.m.Lerp(e,y,R/(h-q));let n;if(U.normalize(),N){const R=B.m.Lerp(t[0],t[2],Z/h),q=B.m.Lerp(t[1],t[2],Z/h);n=B.m.Lerp(R,q,L/(h-Z))}else n=new B.m(U.x,U.y,U.z);n.x/=Y,n.y/=F,n.z/=C,n.normalize();const r=B.i.Lerp(D[0],D[2],q/h),p=B.i.Lerp(D[1],D[2],q/h),S=h===q?D[2]:B.i.Lerp(r,p,R/(h-q));d.push(U.x*Y,U.y*F,U.z*C),f.push(n.x,n.y,n.z),v.push(S.x,z.e?1-S.y:S.y),c.push(T),T++};for(let q=0;q<h;q++)for(let L=0;L+q<h;L++)R(L,q,L+1/3,q+1/3),R(L+1,q,L+1/3,q+1/3),R(L,q+1,L+1/3,q+1/3),L+q+1<h&&(R(L+1,q,L+2/3,q+2/3),R(L+1,q+1,L+2/3,q+2/3),R(L,q+1,L+2/3,q+2/3))}Z.d._ComputeSides(q,d,c,f,v,R.frontUVs,R.backUVs);const I=new Z.d;return I.indices=c,I.xa=d,I.ya=f,I.Aa=v,I}function A(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new N.d(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return s(q).Ca(B,q.updatable),B}Z.d.CreatePolyhedron=j,N.d.CreatePolyhedron=(R,q,L)=>J(R,q,L);Z.d.CreateIcoSphere=s,N.d.CreateIcoSphere=(R,q,L)=>A(R,q,L);var M=L(11099);const b=new B.m(1,0,0),X=new B.m(-1,0,0),u=new B.m(0,1,0),RR=new B.m(0,-1,0),qR=new B.m(0,0,1),LR=new B.m(0,0,-1);class BR{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.m.Zero(),q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.m.Up(),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.i.Zero(),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=R,this.k=q,this.uv=L,this.vertexIdx=N,this.vertexIdxForBones=h,this.localPositionOverride=Z,this.localNormalOverride=z,this.matrixIndicesOverride=Y,this.matrixWeightsOverride=F}clone(){var R,q,L,B;return new BR(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(R=this.localPositionOverride)||void 0===R?void 0:R.slice(),null===(q=this.localNormalOverride)||void 0===q?void 0:q.slice(),null===(L=this.matrixIndicesOverride)||void 0===L?void 0:L.slice(),null===(B=this.matrixWeightsOverride)||void 0===B?void 0:B.slice())}}function NR(R,q,L){var Y,F,C,e;const y=!!q.skeleton,U=L.localMode||y,n=q.Sf(),r=y?q.Dd(!0,!0):q.getVerticesData(h.e.PositionKind),p=y?q.getNormalsData(!0,!0):q.getVerticesData(h.e.NormalKind),c=U?y?q.getVerticesData(h.e.PositionKind):r:null,d=U?y?q.getVerticesData(h.e.NormalKind):p:null,f=q.getVerticesData(h.e.UVKind),v=y?q.getVerticesData(h.e.MatricesIndicesKind):null,T=y?q.getVerticesData(h.e.MatricesWeightsKind):null,t=y?q.getVerticesData(h.e.MatricesIndicesExtraKind):null,D=y?q.getVerticesData(h.e.MatricesWeightsExtraKind):null,S=L.position||B.m.Zero();let I=L.k||B.m.Up();const K=L.size||B.m.One(),m=L.angle||0;if(!I){const R=new B.m(0,0,1),L=q.va().activeCamera,N=B.m.TransformCoordinates(R,L.getWorldMatrix());I=L.globalPosition.Bc(N)}const o=-Math.atan2(I.z,I.x)-Math.PI/2,l=Math.sqrt(I.x*I.x+I.z*I.z),G=Math.atan2(I.y,l),W=new Z.d;W.indices=[],W.xa=[],W.ya=[],W.Aa=[],W.matricesIndices=y?[]:null,W.matricesWeights=y?[]:null,W.matricesIndicesExtra=t?[]:null,W.matricesWeightsExtra=D?[]:null;let H=0;const P=(R,q)=>{const N=new BR;if(!n||!r||!p)return N;const h=n[R];if(N.vertexIdx=3*h,N.vertexIdxForBones=4*h,N.position=new B.m(r[3*h],r[3*h+1],r[3*h+2]),B.m.TransformCoordinatesToRef(N.position,q,N.position),N.k=new B.m(p[3*h],p[3*h+1],p[3*h+2]),B.m.TransformNormalToRef(N.k,q,N.k),L.captureUVS&&f){const R=f[2*h+1];N.uv=new B.i(f[2*h],z.e?1-R:R)}return N},O=[0,0,0,0],E=(R,q)=>{if(0===R.length)return R;const L=.5*Math.abs(B.m.Dot(K,q)),N=(R,q,L,B)=>{for(let N=0;N<B;++N)if(R[L+N]===q)return L+N;return-1},h=(R,h)=>{const Z=B.m.GetClipFactor(R.position,h.position,q,L);let z=O,Y=O;if(v&&T){const q=R.matrixIndicesOverride?0:R.vertexIdxForBones,L=R.matrixIndicesOverride??v,B=R.matrixWeightsOverride??T,F=h.matrixIndicesOverride?0:h.vertexIdxForBones,C=h.matrixIndicesOverride??v,e=h.matrixWeightsOverride??T;z=[0,0,0,0],Y=[0,0,0,0];let y=0;for(let R=0;R<4;++R)if(B[q+R]>0){const h=N(C,L[q+R],F,4);z[y]=L[q+R],Y[y]=(0,M.h)(B[q+R],h>=0?e[h]:0,Z),y++}for(let R=0;R<4&&y<4;++R){const B=C[F+R];-1===N(L,B,q,4)&&(z[y]=B,Y[y]=(0,M.h)(0,e[F+R],Z),y++)}const U=Y[0]+Y[1]+Y[2]+Y[3];Y[0]/=U,Y[1]/=U,Y[2]/=U,Y[3]/=U}const F=R.localPositionOverride?R.localPositionOverride[0]:(null===c||void 0===c?void 0:c[R.vertexIdx])??0,C=R.localPositionOverride?R.localPositionOverride[1]:(null===c||void 0===c?void 0:c[R.vertexIdx+1])??0,e=R.localPositionOverride?R.localPositionOverride[2]:(null===c||void 0===c?void 0:c[R.vertexIdx+2])??0,y=h.localPositionOverride?h.localPositionOverride[0]:(null===c||void 0===c?void 0:c[h.vertexIdx])??0,U=h.localPositionOverride?h.localPositionOverride[1]:(null===c||void 0===c?void 0:c[h.vertexIdx+1])??0,n=h.localPositionOverride?h.localPositionOverride[2]:(null===c||void 0===c?void 0:c[h.vertexIdx+2])??0,r=R.localNormalOverride?R.localNormalOverride[0]:(null===d||void 0===d?void 0:d[R.vertexIdx])??0,p=R.localNormalOverride?R.localNormalOverride[1]:(null===d||void 0===d?void 0:d[R.vertexIdx+1])??0,f=R.localNormalOverride?R.localNormalOverride[2]:(null===d||void 0===d?void 0:d[R.vertexIdx+2])??0,t=r+((h.localNormalOverride?h.localNormalOverride[0]:(null===d||void 0===d?void 0:d[h.vertexIdx])??0)-r)*Z,D=p+((h.localNormalOverride?h.localNormalOverride[1]:(null===d||void 0===d?void 0:d[h.vertexIdx+1])??0)-p)*Z,S=f+((h.localNormalOverride?h.localNormalOverride[2]:(null===d||void 0===d?void 0:d[h.vertexIdx+2])??0)-f)*Z,I=Math.sqrt(t*t+D*D+S*S);return new BR(B.m.Lerp(R.position,h.position,Z),B.m.Lerp(R.k,h.k,Z).normalize(),B.i.Lerp(R.uv,h.uv,Z),-1,-1,c?[F+(y-F)*Z,C+(U-C)*Z,e+(n-e)*Z]:null,d?[t/I,D/I,S/I]:null,z,Y)};let Z=null;R.length>3&&(Z=[]);for(let z=0;z<R.length;z+=3){let N=0,Y=null,F=null,C=null,e=null;const y=B.m.Dot(R[z].position,q)-L>0,U=B.m.Dot(R[z+1].position,q)-L>0,n=B.m.Dot(R[z+2].position,q)-L>0;switch(N=(y?1:0)+(U?1:0)+(n?1:0),N){case 0:R.length>3?(Z.push(R[z]),Z.push(R[z+1]),Z.push(R[z+2])):Z=R;break;case 1:if(Z=Z??new Array,y&&(Y=R[z+1],F=R[z+2],C=h(R[z],Y),e=h(R[z],F)),U){Y=R[z],F=R[z+2],C=h(R[z+1],Y),e=h(R[z+1],F),Z.push(C),Z.push(F.clone()),Z.push(Y.clone()),Z.push(F.clone()),Z.push(C.clone()),Z.push(e);break}n&&(Y=R[z],F=R[z+1],C=h(R[z+2],Y),e=h(R[z+2],F)),Y&&F&&C&&e&&(Z.push(Y.clone()),Z.push(F.clone()),Z.push(C),Z.push(e),Z.push(C.clone()),Z.push(F.clone()));break;case 2:Z=Z??new Array,y||(Y=R[z].clone(),F=h(Y,R[z+1]),C=h(Y,R[z+2]),Z.push(Y),Z.push(F),Z.push(C)),U||(Y=R[z+1].clone(),F=h(Y,R[z+2]),C=h(Y,R[z]),Z.push(Y),Z.push(F),Z.push(C)),n||(Y=R[z+2].clone(),F=h(Y,R[z]),C=h(Y,R[z+1]),Z.push(Y),Z.push(F),Z.push(C))}}return Z},a=q instanceof N.d?q:null,g=null===a||void 0===a?void 0:a._thinInstanceDataStorage.matrixData,Q=(null===a||void 0===a?void 0:a.Fb)||1,i=B.h.Matrix[0];i.p(B.c.IdentityReadOnly);for(let N=0;N<Q;++N){if(null!==a&&void 0!==a&&a.hasThinInstances&&g){const R=16*N;i.setRowFromFloats(0,g[R+0],g[R+1],g[R+2],g[R+3]),i.setRowFromFloats(1,g[R+4],g[R+5],g[R+6],g[R+7]),i.setRowFromFloats(2,g[R+8],g[R+9],g[R+10],g[R+11]),i.setRowFromFloats(3,g[R+12],g[R+13],g[R+14],g[R+15])}const R=B.c.RotationYawPitchRoll(o,G,m).multiply(B.c.Translation(S.x,S.y,S.z)),h=B.c.Invert(R),Z=q.getWorldMatrix(),Y=i.multiply(Z).multiply(h),F=new Array(3);for(let q=0;q<n.length;q+=3){let R=F;if(R[0]=P(q,Y),R[1]=P(q+1,Y),R[2]=P(q+2,Y),!(L.cullBackFaces&&-R[0].k.z<=0&&-R[1].k.z<=0&&-R[2].k.z<=0)&&(R=E(R,b),R&&(R=E(R,X),R&&(R=E(R,u),R&&(R=E(R,RR),R&&(R=E(R,qR),R&&(R=E(R,LR),R)))))))for(let q=0;q<R.length;q++){const B=R[q];if(W.indices.push(H),U?(B.localPositionOverride?(W.xa[3*H]=B.localPositionOverride[0],W.xa[3*H+1]=B.localPositionOverride[1],W.xa[3*H+2]=B.localPositionOverride[2]):c&&(W.xa[3*H]=c[B.vertexIdx],W.xa[3*H+1]=c[B.vertexIdx+1],W.xa[3*H+2]=c[B.vertexIdx+2]),B.localNormalOverride?(W.ya[3*H]=B.localNormalOverride[0],W.ya[3*H+1]=B.localNormalOverride[1],W.ya[3*H+2]=B.localNormalOverride[2]):d&&(W.ya[3*H]=d[B.vertexIdx],W.ya[3*H+1]=d[B.vertexIdx+1],W.ya[3*H+2]=d[B.vertexIdx+2])):(B.position.toArray(W.xa,3*H),B.k.toArray(W.ya,3*H)),W.matricesIndices&&W.matricesWeights&&(B.matrixIndicesOverride?(W.matricesIndices[4*H]=B.matrixIndicesOverride[0],W.matricesIndices[4*H+1]=B.matrixIndicesOverride[1],W.matricesIndices[4*H+2]=B.matrixIndicesOverride[2],W.matricesIndices[4*H+3]=B.matrixIndicesOverride[3]):(v&&(W.matricesIndices[4*H]=v[B.vertexIdxForBones],W.matricesIndices[4*H+1]=v[B.vertexIdxForBones+1],W.matricesIndices[4*H+2]=v[B.vertexIdxForBones+2],W.matricesIndices[4*H+3]=v[B.vertexIdxForBones+3]),t&&W.matricesIndicesExtra&&(W.matricesIndicesExtra[4*H]=t[B.vertexIdxForBones],W.matricesIndicesExtra[4*H+1]=t[B.vertexIdxForBones+1],W.matricesIndicesExtra[4*H+2]=t[B.vertexIdxForBones+2],W.matricesIndicesExtra[4*H+3]=t[B.vertexIdxForBones+3])),B.matrixWeightsOverride?(W.matricesWeights[4*H]=B.matrixWeightsOverride[0],W.matricesWeights[4*H+1]=B.matrixWeightsOverride[1],W.matricesWeights[4*H+2]=B.matrixWeightsOverride[2],W.matricesWeights[4*H+3]=B.matrixWeightsOverride[3]):(T&&(W.matricesWeights[4*H]=T[B.vertexIdxForBones],W.matricesWeights[4*H+1]=T[B.vertexIdxForBones+1],W.matricesWeights[4*H+2]=T[B.vertexIdxForBones+2],W.matricesWeights[4*H+3]=T[B.vertexIdxForBones+3]),D&&W.matricesWeightsExtra&&(W.matricesWeightsExtra[4*H]=D[B.vertexIdxForBones],W.matricesWeightsExtra[4*H+1]=D[B.vertexIdxForBones+1],W.matricesWeightsExtra[4*H+2]=D[B.vertexIdxForBones+2],W.matricesWeightsExtra[4*H+3]=D[B.vertexIdxForBones+3]))),L.captureUVS)B.uv.toArray(W.Aa,2*H);else{W.Aa.push(.5+B.position.x/K.x);const R=.5+B.position.y/K.y;W.Aa.push(z.e?1-R:R)}H++}}}0===W.indices.length&&(W.indices=null),0===W.xa.length&&(W.xa=null),0===W.ya.length&&(W.ya=null),0===W.Aa.length&&(W.Aa=null),0===(null===(Y=W.matricesIndices)||void 0===Y?void 0:Y.length)&&(W.matricesIndices=null),0===(null===(F=W.matricesWeights)||void 0===F?void 0:F.length)&&(W.matricesWeights=null),0===(null===(C=W.matricesIndicesExtra)||void 0===C?void 0:C.length)&&(W.matricesIndicesExtra=null),0===(null===(e=W.matricesWeightsExtra)||void 0===e?void 0:e.length)&&(W.matricesWeightsExtra=null);const k=new N.d(R,q.va());return W.Ca(k),U?(k.skeleton=q.skeleton,k.parent=q):(k.position=S.clone(),k.rotation=new B.m(G,o,m)),k.Jj(!0),k.refreshBoundingInfo(!0,!0),k}function hR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const q=0|Math.max(R.subdivisions?R.subdivisions:2,1),L=0|Math.max(R.tessellation?R.tessellation:16,3),N=Math.max(R.height?R.height:1,0),h=Math.max(R.radius?R.radius:.25,0),Y=0|Math.max(R.capSubdivisions?R.capSubdivisions:6,1),F=L,C=q,e=Math.max(R.radiusTop?R.radiusTop:h,0),y=Math.max(R.radiusBottom?R.radiusBottom:h,0),U=N-(e+y),n=2*Math.PI,r=Math.max(R.topCapSubdivisions?R.topCapSubdivisions:Y,1),p=Math.max(R.bottomCapSubdivisions?R.bottomCapSubdivisions:Y,1),c=Math.acos((y-e)/N);let d=[];const f=[],v=[],T=[];let t=0;const D=[],S=.5*U,I=.5*Math.PI;let K,m;const o=B.m.Zero(),l=B.m.Zero(),G=Math.cos(c),W=Math.sin(c),H=new B.i(e*W,S+e*G).Bc(new B.i(y*W,y*G-S)).length(),P=e*c+H+y*(I-c);let O=0;for(m=0;m<=r;m++){const R=[],q=I-c*(m/r);O+=e*c/r;const L=Math.cos(q),B=Math.sin(q),N=L*e;for(K=0;K<=F;K++){const q=K/F,h=q*n+0,Z=Math.sin(h),Y=Math.cos(h);l.x=N*Z,l.y=S+B*e,l.z=N*Y,f.push(l.x,l.y,l.z),o.set(L*Z,B,L*Y),v.push(o.x,o.y,o.z),T.push(q,z.e?O/P:1-O/P),R.push(t),t++}D.push(R)}const E=N-e-y+G*e-G*y,a=W*(y-e)/E;for(m=1;m<=C;m++){const R=[];O+=H/C;const q=W*(m*(y-e)/C+e);for(K=0;K<=F;K++){const L=K/F,B=L*n+0,N=Math.sin(B),h=Math.cos(B);l.x=q*N,l.y=S+G*e-m*E/C,l.z=q*h,f.push(l.x,l.y,l.z),o.set(N,a,h).normalize(),v.push(o.x,o.y,o.z),T.push(L,z.e?O/P:1-O/P),R.push(t),t++}D.push(R)}for(m=1;m<=p;m++){const R=[],q=I-c-(Math.PI-c)*(m/p);O+=y*c/p;const L=Math.cos(q),B=Math.sin(q),N=L*y;for(K=0;K<=F;K++){const q=K/F,h=q*n+0,Z=Math.sin(h),Y=Math.cos(h);l.x=N*Z,l.y=B*y-S,l.z=N*Y,f.push(l.x,l.y,l.z),o.set(L*Z,B,L*Y),v.push(o.x,o.y,o.z),T.push(q,z.e?O/P:1-O/P),R.push(t),t++}D.push(R)}for(K=0;K<F;K++)for(m=0;m<r+C+p;m++){const R=D[m][K],q=D[m+1][K],L=D[m+1][K+1],B=D[m][K+1];d.push(R),d.push(q),d.push(B),d.push(q),d.push(L),d.push(B)}if(d=d.reverse(),R.orientation&&!R.orientation.equals(B.m.Up())){const q=new B.c;R.orientation.clone().scale(.5*Math.PI).cross(B.m.Up()).toQuaternion().toRotationMatrix(q);const L=B.m.Zero();for(let R=0;R<f.length;R+=3)L.set(f[R],f[R+1],f[R+2]),B.m.TransformCoordinatesToRef(L.clone(),q,L),f[R]=L.x,f[R+1]=L.y,f[R+2]=L.z}const g=new Z.d;return g.xa=f,g.ya=v,g.Aa=T,g.indices=d,g}function ZR(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:B.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new N.d(R,L);return hR(q).Ca(h,q.updatable),h}N.d.CreateDecal=(R,q,L,B,N,h)=>NR(R,q,{position:L,k:B,size:N,angle:h});N.d.CreateCapsule=(R,q,L)=>ZR(R,q,L),Z.d.CreateCapsule=hR;class zR{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=R,this.y=q,R!==Math.floor(R)&&(R=Math.floor(R),m.d.Warn("x is not an integer, floor(x) used")),q!==Math.floor(q)&&(q=Math.floor(q),m.d.Warn("y is not an integer, floor(y) used"))}clone(){return new zR(this.x,this.y)}rotate60About(R){const q=this.x;return this.x=R.x+R.y-this.y,this.y=q+this.y-R.x,this}rotateNeg60About(R){const q=this.x;return this.x=q+this.y-R.y,this.y=R.x+R.y-q,this}rotate120(R,q){R!==Math.floor(R)&&(R=Math.floor(R),m.d.Warn("m not an integer only floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),m.d.Warn("n not an integer only floor(n) used"));const L=this.x;return this.x=R-L-this.y,this.y=q+L,this}rotateNeg120(R,q){R!==Math.floor(R)&&(R=Math.floor(R),m.d.Warn("m is not an integer, floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),m.d.Warn("n is not an integer,   floor(n) used"));const L=this.x;return this.x=this.y-q,this.y=R+q-L-this.y,this}toCartesianOrigin(R,q){const L=B.m.Zero();return L.x=R.x+2*this.x*q+this.y*q,L.y=R.y+Math.sqrt(3)*this.y*q,L}static Zero(){return new zR(0,0)}}class YR{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new FR("icosahedron","Regular",[[0,l.g,-1],[-l.g,1,0],[-1,0,-l.g],[1,0,-l.g],[l.g,1,0],[0,l.g,1],[-1,0,l.g],[-l.g,-1,0],[0,-l.g,-1],[l.g,-1,0],[1,0,l.g],[0,-l.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let R=12;const q={},L=this.m,B=this.n;let N,h,Z,z,Y,F=L,C=1,e=0;0!==B&&(F=(0,M.d)(L,B)),C=L/F,e=B/F;const y=zR.Zero(),U=new zR(L,B),n=new zR(-B,L+B),r=zR.Zero(),p=zR.Zero(),c=zR.Zero();let d,f,v,T,t=[];const D=[],S=this.vertByDist,I=(L,B,N,h)=>{d=L+"|"+N,f=B+"|"+h,d in q||f in q?d in q&&!(f in q)?q[f]=q[d]:f in q&&!(d in q)&&(q[d]=q[f]):(q[d]=R,q[f]=R,R++),S[N][0]>2?D[q[d]]=[-S[N][0],S[N][1],q[d]]:D[q[d]]=[t[S[N][0]],S[N][1],q[d]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(t=this.IDATA.face[K],Z=t[2],z=t[1],Y=t[0],v=y.x+"|"+y.y,d=K+"|"+v,d in q||(q[d]=Z,D[Z]=[t[S[v][0]],S[v][1]]),v=U.x+"|"+U.y,d=K+"|"+v,d in q||(q[d]=z,D[z]=[t[S[v][0]],S[v][1]]),v=n.x+"|"+n.y,d=K+"|"+v,d in q||(q[d]=Y,D[Y]=[t[S[v][0]],S[v][1]]),N=this.IDATA.edgematch[K][0],h=this.IDATA.edgematch[K][1],"B"===h)for(let R=1;R<F;R++)p.x=L-R*(C+e),p.y=B+R*C,c.x=-R*e,c.y=R*(C+e),v=p.x+"|"+p.y,T=c.x+"|"+c.y,I(K,N,v,T);if("O"===h)for(let R=1;R<F;R++)c.x=-R*e,c.y=R*(C+e),r.x=R*C,r.y=R*e,v=c.x+"|"+c.y,T=r.x+"|"+r.y,I(K,N,v,T);if(N=this.IDATA.edgematch[K][2],h=this.IDATA.edgematch[K][3],h&&"A"===h)for(let R=1;R<F;R++)r.x=R*C,r.y=R*e,p.x=L-(F-R)*(C+e),p.y=B+(F-R)*C,v=r.x+"|"+r.y,T=p.x+"|"+p.y,I(K,N,v,T);for(let L=0;L<this.vertices.length;L++)v=this.vertices[L].x+"|"+this.vertices[L].y,d=K+"|"+v,d in q||(q[d]=R++,S[v][0]>2?D[q[d]]=[-S[v][0],S[v][1],q[d]]:D[q[d]]=[t[S[v][0]],S[v][1],q[d]])}this.closestTo=D,this.vecToidx=q}calcCoeffs(){const R=this.m,q=this.n,L=Math.sqrt(3)/3,B=R*R+q*q+R*q;this.coau=(R+q)/B,this.cobu=-q/B,this.coav=-L*(R-q)/B,this.cobv=L*(2*R+q)/B}createInnerFacets(){const R=this.m,q=this.n;for(let L=0;L<q+R+1;L++)for(let R=this.min[L];R<this.max[L]+1;R++)R<this.max[L]&&R<this.max[L+1]+1&&this.innerFacets.push(["|"+R+"|"+L,"|"+R+"|"+(L+1),"|"+(R+1)+"|"+L]),L>0&&R<this.max[L-1]&&R+1<this.max[L]+1&&this.innerFacets.push(["|"+R+"|"+L,"|"+(R+1)+"|"+L,"|"+(R+1)+"|"+(L-1)])}edgeVecsABOB(){const R=this.m,q=this.n,L=new zR(-q,R+q);for(let B=1;B<R+q;B++){const R=new zR(this.min[B],B),q=new zR(this.min[B-1],B-1),N=new zR(this.min[B+1],B+1),h=R.clone(),Z=q.clone(),z=N.clone();h.rotate60About(L),Z.rotate60About(L),z.rotate60About(L);const Y=new zR(this.max[h.y],h.y),F=new zR(this.max[h.y-1],h.y-1),C=new zR(this.max[h.y-1]-1,h.y-1);h.x===Y.x&&h.y===Y.y||(h.x!==F.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,F,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,C,Y])):h.y===z.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,q,F]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([R,F,N])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,q,F]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,F,Y])))}}mapABOBtoOBOA(){const R=new zR(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const L=[];for(let B=0;B<3;B++)R.x=this.isoVecsABOB[q][B].x,R.y=this.isoVecsABOB[q][B].y,0===this.vertexTypes[q][B]&&R.rotateNeg120(this.m,this.n),L.push(R.clone());this.isoVecsOBOA.push(L)}}mapABOBtoBAOA(){const R=new zR(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const L=[];for(let B=0;B<3;B++)R.x=this.isoVecsABOB[q][B].x,R.y=this.isoVecsABOB[q][B].y,1===this.vertexTypes[q][B]&&R.rotate120(this.m,this.n),L.push(R.clone());this.isoVecsBAOA.push(L)}}MapToFace(R,q){const L=this.IDATA.face[R],N=L[2],h=L[1],Z=L[0],z=B.m.Ig(this.IDATA.vertex[N]),Y=B.m.Ig(this.IDATA.vertex[h]),F=B.m.Ig(this.IDATA.vertex[Z]),C=Y.Bc(z),e=F.Bc(z),y=C.scale(this.coau).add(e.scale(this.cobu)),U=C.scale(this.coav).add(e.scale(this.cobv)),n=[];let r,p=B.h.o[0];for(let B=0;B<this.cartesian.length;B++)p=y.scale(this.cartesian[B].x).add(U.scale(this.cartesian[B].y)).add(z),n[B]=[p.x,p.y,p.z],r=R+"|"+this.vertices[B].x+"|"+this.vertices[B].y,q.vertex[this.vecToidx[r]]=[p.x,p.y,p.z]}build(R,q){const L=[],B=zR.Zero(),N=new zR(R,q),h=new zR(-q,R+q);L.push(B,N,h);for(let v=q;v<R+1;v++)for(let q=0;q<R+1-v;q++)L.push(new zR(q,v));if(q>0){const B=(0,M.d)(R,q),N=R/B,h=q/B;for(let z=1;z<B;z++)L.push(new zR(z*N,z*h)),L.push(new zR(-z*h,z*(N+h))),L.push(new zR(R-z*(N+h),q+z*N));const Z=R/q;for(let z=1;z<q;z++)for(let B=0;B<z*Z;B++)L.push(new zR(B,z)),L.push(new zR(B,z).rotate120(R,q)),L.push(new zR(B,z).rotateNeg120(R,q))}L.sort(((R,q)=>R.x-q.x)),L.sort(((R,q)=>R.y-q.y));const Z=new Array(R+q+1),z=new Array(R+q+1);for(let v=0;v<Z.length;v++)Z[v]=1/0,z[v]=-1/0;let Y=0,F=0;const C=L.length;for(let v=0;v<C;v++)F=L[v].x,Y=L[v].y,Z[Y]=Math.min(F,Z[Y]),z[Y]=Math.max(F,z[Y]);const e=(L,B)=>{const N=L.clone();return"A"===B&&N.rotateNeg120(R,q),"B"===B&&N.rotate120(R,q),N.x<0?N.y:N.x+N.y},y=[],U=[],n=[],r=[],p={},c=[];let d=-1,f=-1;for(let v=0;v<C;v++)y[v]=L[v].toCartesianOrigin(new zR(0,0),.5),U[v]=e(L[v],"O"),n[v]=e(L[v],"A"),r[v]=e(L[v],"B"),U[v]===n[v]&&n[v]===r[v]?(d=3,f=U[v]):U[v]===n[v]?(d=4,f=U[v]):n[v]===r[v]?(d=5,f=n[v]):r[v]===U[v]&&(d=6,f=U[v]),U[v]<n[v]&&U[v]<r[v]&&(d=2,f=U[v]),n[v]<U[v]&&n[v]<r[v]&&(d=1,f=n[v]),r[v]<n[v]&&r[v]<U[v]&&(d=0,f=r[v]),c.push([d,f,L[v].x,L[v].y]);c.sort(((R,q)=>R[2]-q[2])),c.sort(((R,q)=>R[3]-q[3])),c.sort(((R,q)=>R[1]-q[1])),c.sort(((R,q)=>R[0]-q[0]));for(let v=0;v<c.length;v++)p[c[v][2]+"|"+c[v][3]]=[c[v][0],c[v][1],v];return this.m=R,this.n=q,this.vertices=L,this.vertByDist=p,this.cartesian=y,this.min=Z,this.max=z,this}}class FR{constructor(R,q,L,B){this.name=R,this.category=q,this.vertex=L,this.face=B}}class CR extends FR{innerToData(R,q){for(let L=0;L<q.innerFacets.length;L++)this.face.push(q.innerFacets[L].map((L=>q.vecToidx[R+L])))}mapABOBtoDATA(R,q){const L=q.IDATA.edgematch[R][0];for(let B=0;B<q.isoVecsABOB.length;B++){const N=[];for(let h=0;h<3;h++)0===q.vertexTypes[B][h]?N.push(R+"|"+q.isoVecsABOB[B][h].x+"|"+q.isoVecsABOB[B][h].y):N.push(L+"|"+q.isoVecsABOB[B][h].x+"|"+q.isoVecsABOB[B][h].y);this.face.push([q.vecToidx[N[0]],q.vecToidx[N[1]],q.vecToidx[N[2]]])}}mapOBOAtoDATA(R,q){const L=q.IDATA.edgematch[R][0];for(let B=0;B<q.isoVecsOBOA.length;B++){const N=[];for(let h=0;h<3;h++)1===q.vertexTypes[B][h]?N.push(R+"|"+q.isoVecsOBOA[B][h].x+"|"+q.isoVecsOBOA[B][h].y):N.push(L+"|"+q.isoVecsOBOA[B][h].x+"|"+q.isoVecsOBOA[B][h].y);this.face.push([q.vecToidx[N[0]],q.vecToidx[N[1]],q.vecToidx[N[2]]])}}mapBAOAtoDATA(R,q){const L=q.IDATA.edgematch[R][2];for(let B=0;B<q.isoVecsBAOA.length;B++){const N=[];for(let h=0;h<3;h++)1===q.vertexTypes[B][h]?N.push(R+"|"+q.isoVecsBAOA[B][h].x+"|"+q.isoVecsBAOA[B][h].y):N.push(L+"|"+q.isoVecsBAOA[B][h].x+"|"+q.isoVecsBAOA[B][h].y);this.face.push([q.vecToidx[N[0]],q.vecToidx[N[1]],q.vecToidx[N[2]]])}}orderData(R){const q=[];for(let h=0;h<13;h++)q[h]=[];const L=R.closestTo;for(let h=0;h<L.length;h++)L[h][0]>-1?L[h][1]>0&&q[L[h][0]].push([h,L[h][1]]):q[12].push([h,L[h][0]]);const B=[];for(let h=0;h<12;h++)B[h]=h;let N=12;for(let h=0;h<12;h++){q[h].sort(((R,q)=>R[1]-q[1]));for(let R=0;R<q[h].length;R++)B[q[h][R][0]]=N++}for(let h=0;h<q[12].length;h++)B[q[12][h][0]]=N++;for(let h=0;h<this.vertex.length;h++)this.vertex[h].push(B[h]);this.vertex.sort(((R,q)=>R[3]-q[3]));for(let h=0;h<this.vertex.length;h++)this.vertex[h].pop();for(let h=0;h<this.face.length;h++)for(let R=0;R<this.face[h].length;R++)this.face[h][R]=B[this.face[h][R]];this.sharedNodes=q[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(R,q){const L=[],B=[];let N=q.pop();B.push(N);let h=this.face[N].indexOf(R);h=(h+2)%3;let Z=this.face[N][h];L.push(Z);let z=0;for(;q.length>0;)N=q[z],this.face[N].indexOf(Z)>-1?(h=(this.face[N].indexOf(Z)+1)%3,Z=this.face[N][h],L.push(Z),B.push(N),q.splice(z,1),z=0):z++;return this.adjacentFaces.push(L),B}toGoldbergPolyhedronData(){const R=new FR("GeoDual","Goldberg",[],[]);R.name="GD dual";const q=this.vertex.length,L=new Array(q);for(let Y=0;Y<q;Y++)L[Y]=[];for(let Y=0;Y<this.face.length;Y++)for(let R=0;R<3;R++)L[this.face[Y][R]].push(Y);let B=0,N=0,h=0,Z=[],z=[];this.adjacentFaces=[];for(let Y=0;Y<L.length;Y++)R.face[Y]=this.setOrder(Y,L[Y].concat([])),L[Y].forEach((q=>{B=0,N=0,h=0,Z=this.face[q];for(let R=0;R<3;R++)z=this.vertex[Z[R]],B+=z[0],N+=z[1],h+=z[2];R.vertex[q]=[B/3,N/3,h/3]}));return R}static BuildGeodesicData(R){const q=new CR("Geodesic-m-n","Geodesic",[[0,l.g,-1],[-l.g,1,0],[-1,0,-l.g],[1,0,-l.g],[l.g,1,0],[0,l.g,1],[-1,0,l.g],[-l.g,-1,0],[0,-l.g,-1],[l.g,-1,0],[1,0,l.g],[0,-l.g,1]],[]);R.setIndices(),R.calcCoeffs(),R.createInnerFacets(),R.edgeVecsABOB(),R.mapABOBtoOBOA(),R.mapABOBtoBAOA();for(let L=0;L<R.IDATA.face.length;L++)R.MapToFace(L,q),q.innerToData(L,R),"B"===R.IDATA.edgematch[L][1]&&q.mapABOBtoDATA(L,R),"O"===R.IDATA.edgematch[L][1]&&q.mapOBOAtoDATA(L,R),"A"===R.IDATA.edgematch[L][3]&&q.mapBAOAtoDATA(L,R);q.orderData(R);return q.vertex=q.vertex.map((function(R){const q=R[0],L=R[1],B=R[2],N=Math.sqrt(q*q+L*L+B*B);return R[0]*=1/N,R[1]*=1/N,R[2]*=1/N,R})),q}}N.d._GoldbergMeshParser=(R,q)=>eR.Parse(R,q);class eR extends N.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(R,q){return void 0===q?(R>this.goldbergData.nbUnsharedFaces-1&&(m.d.Warn("Maximum number of unshared faces used"),R=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+R):(R>11&&(m.d.Warn("Last pole used"),R=11),q>this.goldbergData.nbFacesAtPole-1&&(m.d.Warn("Maximum number of faces at a pole used"),q=this.goldbergData.nbFacesAtPole-1),12+R*this.goldbergData.nbFacesAtPole+q)}_changeGoldbergFaceColors(R){for(let L=0;L<R.length;L++){const q=R[L][0],B=R[L][1],N=R[L][2];for(let R=q;R<B+1;R++)this.goldbergData.faceColors[R]=N}const q=[];for(let L=0;L<12;L++)for(let R=0;R<5;R++)q.push(this.goldbergData.faceColors[L].r,this.goldbergData.faceColors[L].g,this.goldbergData.faceColors[L].b,this.goldbergData.faceColors[L].a);for(let L=12;L<this.goldbergData.faceColors.length;L++)for(let R=0;R<6;R++)q.push(this.goldbergData.faceColors[L].r,this.goldbergData.faceColors[L].g,this.goldbergData.faceColors[L].b,this.goldbergData.faceColors[L].a);return q}setGoldbergFaceColors(R){const q=this._changeGoldbergFaceColors(R);this.Ga(h.e.ColorKind,q)}updateGoldbergFaceColors(R){const q=this._changeGoldbergFaceColors(R);this.updateVerticesData(h.e.ColorKind,q)}_changeGoldbergFaceUVs(R){const q=this.getVerticesData(h.e.UVKind);for(let L=0;L<R.length;L++){const B=R[L][0],N=R[L][1],h=R[L][2],Z=R[L][3],z=R[L][4],Y=[],F=[];let C,e;for(let R=0;R<5;R++)C=h.x+Z*Math.cos(z+R*Math.PI/2.5),e=h.y+Z*Math.sin(z+R*Math.PI/2.5),C<0&&(C=0),C>1&&(C=1),Y.push(C,e);for(let R=0;R<6;R++)C=h.x+Z*Math.cos(z+R*Math.PI/3),e=h.y+Z*Math.sin(z+R*Math.PI/3),C<0&&(C=0),C>1&&(C=1),F.push(C,e);for(let R=B;R<Math.min(12,N+1);R++)for(let L=0;L<5;L++)q[10*R+2*L]=Y[2*L],q[10*R+2*L+1]=Y[2*L+1];for(let R=Math.max(12,B);R<N+1;R++)for(let L=0;L<6;L++)q[12*R-24+2*L]=F[2*L],q[12*R-23+2*L]=F[2*L+1]}return q}setGoldbergFaceUVs(R){const q=this._changeGoldbergFaceUVs(R);this.Ga(h.e.UVKind,q)}updateGoldbergFaceUVs(R){const q=this._changeGoldbergFaceUVs(R);this.updateVerticesData(h.e.UVKind,q)}placeOnGoldbergFaceAt(R,q,L){const N=B.m.RotationFromAxis(this.goldbergData.faceXaxis[q],this.goldbergData.faceYaxis[q],this.goldbergData.faceZaxis[q]);R.rotation=N,R.position=this.goldbergData.faceCenters[q].add(this.goldbergData.faceXaxis[q].scale(L.x)).add(this.goldbergData.faceYaxis[q].scale(L.y)).add(this.goldbergData.faceZaxis[q].scale(L.z))}serialize(R){super.serialize(R),R.type="GoldbergMesh";const q={};if(q.adjacentFaces=this.goldbergData.adjacentFaces,q.nbSharedFaces=this.goldbergData.nbSharedFaces,q.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,q.nbFaces=this.goldbergData.nbFaces,q.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){q.faceColors=[];for(const R of this.goldbergData.faceColors)q.faceColors.push(R.dj())}if(this.goldbergData.faceCenters){q.faceCenters=[];for(const R of this.goldbergData.faceCenters)q.faceCenters.push(R.dj())}if(this.goldbergData.faceZaxis){q.faceZaxis=[];for(const R of this.goldbergData.faceZaxis)q.faceZaxis.push(R.dj())}if(this.goldbergData.faceYaxis){q.faceYaxis=[];for(const R of this.goldbergData.faceYaxis)q.faceYaxis.push(R.dj())}if(this.goldbergData.faceXaxis){q.faceXaxis=[];for(const R of this.goldbergData.faceXaxis)q.faceXaxis.push(R.dj())}R.goldbergData=q}static Parse(R,q){const L=R.goldbergData;L.faceColors=L.faceColors.map((R=>y.g.Ig(R))),L.faceCenters=L.faceCenters.map((R=>B.m.Ig(R))),L.faceZaxis=L.faceZaxis.map((R=>B.m.Ig(R))),L.faceXaxis=L.faceXaxis.map((R=>B.m.Ig(R))),L.faceYaxis=L.faceYaxis.map((R=>B.m.Ig(R)));const N=new eR(R.name,q);return N.goldbergData=L,N}}var yR=L(11379);class UR{constructor(R){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=R}moveTo(R,q){this._currentPath=new o.d(R,q),this._tempPaths.push(this._currentPath)}lineTo(R,q){this._currentPath.addLineTo(R,q)}quadraticCurveTo(R,q,L,B){this._currentPath.addQuadraticCurveTo(R,q,L,B,this._resolution)}bezierCurveTo(R,q,L,B,N,h){this._currentPath.addBezierCurveTo(R,q,L,B,N,h,this._resolution)}extractHoles(){for(const R of this._tempPaths)R.area()>0?this._holes.push(R):this._paths.push(R);if(!this._paths.length&&this._holes.length){const R=this._holes;this._holes=this._paths,this._paths=R}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function nR(R,q,L,B,N,h){const Z=h.glyphs[R]||h.glyphs["?"];if(!Z)return null;const z=new UR(N);if(Z.o){const R=Z.o.split(" ");for(let N=0,h=R.length;N<h;){switch(R[N++]){case"m":{const h=parseInt(R[N++])*q+L,Z=parseInt(R[N++])*q+B;z.moveTo(h,Z);break}case"l":{const h=parseInt(R[N++])*q+L,Z=parseInt(R[N++])*q+B;z.lineTo(h,Z);break}case"q":{const h=parseInt(R[N++])*q+L,Z=parseInt(R[N++])*q+B,Y=parseInt(R[N++])*q+L,F=parseInt(R[N++])*q+B;z.quadraticCurveTo(Y,F,h,Z);break}case"b":{const h=parseInt(R[N++])*q+L,Z=parseInt(R[N++])*q+B,Y=parseInt(R[N++])*q+L,F=parseInt(R[N++])*q+B,C=parseInt(R[N++])*q+L,e=parseInt(R[N++])*q+B;z.bezierCurveTo(Y,F,C,e,h,Z);break}}}}return z.extractHoles(),{offsetX:Z.ha*q,shapePath:z}}const rR={CreateBox:e.d,CreateTiledBox:p,CreateSphere:c.e,CreateDisc:C.c,CreateIcoSphere:A,CreateRibbon:F,CreateCylinder:T,CreateTorus:D,CreateTorusKnot:I,CreateLineSystem:K.f,pb:K.j,CreateDashedLines:K.d,ExtrudeShape:g,ExtrudeShapeCustom:Q,CreateLathe:k,CreateTiledPlane:n,_f:V.b,CreateGround:x.d,CreateTiledGround:x.g,CreateGroundFromHeightMap:x.b,CreatePolygon:E,ExtrudePolygon:a,CreateTube:w,CreatePolyhedron:J,CreateGeodesic:function(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=q.m||1;B!==Math.floor(B)&&(B=Math.floor(B),m.d.Warn("m not an integer only floor(m) used"));let N=q.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),m.d.Warn("n not an integer only floor(n) used")),N>B){const R=N;N=B,B=R,m.d.Warn("n > m therefore m and n swapped")}const h=new YR;return h.build(B,N),J(R,{custom:CR.BuildGeodesicData(h),size:q.size,sizeX:q.sizeX,sizeY:q.sizeY,sizeZ:q.sizeZ,faceUV:q.faceUV,faceColors:q.faceColors,flat:q.flat,updatable:q.updatable,sideOrientation:q.sideOrientation,frontUVs:q.frontUVs,backUVs:q.backUVs},L)},CreateGoldberg:function(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=q.size,Y=q.sizeX||h||1,F=q.sizeY||h||1,C=q.sizeZ||h||1;let e=q.m||1;e!==Math.floor(e)&&(e=Math.floor(e),m.d.Warn("m not an integer only floor(m) used"));let U=q.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),m.d.Warn("n not an integer only floor(n) used")),U>e){const R=U;U=e,e=R,m.d.Warn("n > m therefore m and n swapped")}const n=new YR;n.build(e,U);const r=CR.BuildGeodesicData(n),p=r.toGoldbergPolyhedronData(),c=new eR(R,L);q.sideOrientation=N.d._GetDefaultSideOrientation(q.sideOrientation),c._originalBuilderSideOrientation=q.sideOrientation;(function(R,q){const L=R.size,N=R.sizeX||L||1,h=R.sizeY||L||1,Y=R.sizeZ||L||1,F=0===R.sideOrientation?0:R.sideOrientation||Z.d.DEFAULTSIDE,C=[],e=[],y=[],U=[];let n=1/0,r=-1/0,p=1/0,c=-1/0;for(let B=0;B<q.vertex.length;B++)n=Math.min(n,q.vertex[B][0]*N),r=Math.max(r,q.vertex[B][0]*N),p=Math.min(p,q.vertex[B][1]*h),c=Math.max(c,q.vertex[B][1]*h);let d=0;for(let Z=0;Z<q.face.length;Z++){const R=q.face[Z],L=B.m.Ig(q.vertex[R[0]]),F=B.m.Ig(q.vertex[R[2]]),f=B.m.Ig(q.vertex[R[1]]),v=F.Bc(L),T=f.Bc(L),t=B.m.Cross(T,v).normalize();for(let B=0;B<R.length;B++){y.push(t.x,t.y,t.z);const L=q.vertex[R[B]];C.push(L[0]*N,L[1]*h,L[2]*Y);const Z=(L[1]*h-p)/(c-p);U.push((L[0]*N-n)/(r-n),z.e?1-Z:Z)}for(let q=0;q<R.length-2;q++)e.push(d,d+q+2,d+q+1);d+=R.length}Z.d._ComputeSides(F,C,e,y,U);const f=new Z.d;return f.xa=C,f.indices=e,f.ya=y,f.Aa=U,f})(q,p).Ca(c,q.updatable),c.goldbergData.nbSharedFaces=r.sharedNodes,c.goldbergData.nbUnsharedFaces=r.poleNodes,c.goldbergData.adjacentFaces=r.adjacentFaces,c.goldbergData.nbFaces=c.goldbergData.nbSharedFaces+c.goldbergData.nbUnsharedFaces,c.goldbergData.nbFacesAtPole=(c.goldbergData.nbUnsharedFaces-12)/12;for(let N=0;N<r.vertex.length;N++)c.goldbergData.faceCenters.push(B.m.Ig(r.vertex[N])),c.goldbergData.faceCenters[N].x*=Y,c.goldbergData.faceCenters[N].y*=F,c.goldbergData.faceCenters[N].z*=C,c.goldbergData.faceColors.push(new y.g(1,1,1,1));for(let N=0;N<p.face.length;N++){const R=p.face[N],q=B.m.Ig(p.vertex[R[0]]),L=B.m.Ig(p.vertex[R[2]]),h=B.m.Ig(p.vertex[R[1]]),Z=L.Bc(q),z=h.Bc(q),Y=B.m.Cross(z,Z).normalize(),F=B.m.Cross(z,Y).normalize();c.goldbergData.faceXaxis.push(z.normalize()),c.goldbergData.faceYaxis.push(Y),c.goldbergData.faceZaxis.push(F)}return c},CreateDecal:NR,CreateCapsule:ZR,CreateText:function(R,q,L){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const Y=function(R,q,L,B){const N=Array.from(R),h=q/B.resolution,Z=(B.boundingBox.yMax-B.boundingBox.yMin+B.underlineThickness)*h,z=[];let Y=0,F=0;for(let C=0;C<N.length;C++){const R=N[C];if("\n"===R)Y=0,F-=Z;else{const q=nR(R,h,Y,F,L,B);q&&(Y+=q.offsetX,z.push(q.shapePath))}}return z}(q,h.size||50,h.resolution||8,L),F=[];let C=0;for(const n of Y){if(!n.paths.length)continue;const q=n.holes.slice();for(const L of n.paths){var e,y;const Y=[],U=[],n=L.getPoints();for(const R of n)U.push(new B.m(R.x,0,R.y));const r=q.slice();for(const R of r){const N=R.getPoints();let h=!1;for(const R of N)if(L.isPointInside(R)){h=!0;break}if(!h)continue;const Z=[];for(const R of N)Z.push(new B.m(R.x,0,R.y));Y.push(Z),q.splice(q.indexOf(R),1)}if(!Y.length&&q.length)for(const R of q){const q=R.getPoints(),L=[];for(const R of q)L.push(new B.m(R.x,0,R.y));Y.push(L)}const p=a(R,{shape:U,holes:Y.length?Y:void 0,depth:h.depth||1,faceUV:h.faceUV||(null===(e=h.perLetterFaceUV)||void 0===e?void 0:e.call(h,C)),faceColors:h.faceColors||(null===(y=h.perLetterFaceColors)||void 0===y?void 0:y.call(h,C)),sideOrientation:N.d._GetDefaultSideOrientation(h.sideOrientation||N.d.DOUBLESIDE)},Z,z);F.push(p),C++}}const U=N.d.MergeMeshes(F,!0,!0);if(U){const q=U.getBoundingInfo().boundingBox;U.position.x+=-(q.minimumWorld.x+q.maximumWorld.x)/2,U.position.y+=-(q.minimumWorld.y+q.maximumWorld.y)/2,U.position.z+=-(q.minimumWorld.z+q.maximumWorld.z)/2+q.extendSize.z,U.name=R;const L=new yR.e("pivot",Z);L.rotation.x=-Math.PI/2,U.parent=L,U.bakeCurrentTransformIntoVertices(),U.parent=null,L.dispose()}return U}}},11218:(R,q,L)=>{"use strict";L.d(q,{c:()=>Y});var B=L(11136),N=L(11226),h=L(11228),Z=L(11239),z=L(11246);class Y{get materialDefines(){var R;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(R=this._getDrawWrapper())||void 0===R?void 0:R.defines}set materialDefines(R){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=R}_getDrawWrapper(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R=R??this._engine.currentRenderPassId;let L=this._drawWrappers[R];return!L&&q&&(this._drawWrappers[R]=L=new z.b(this._mesh.va().getEngine())),L}_removeDrawWrapper(R){var q;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(q=this._drawWrappers[R])||void 0===q||q.dispose());this._drawWrappers[R]=void 0}get effect(){var R;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(R=this._getDrawWrapper())||void 0===R?void 0:R.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(R){this._mainDrawWrapperOverride=R}setEffect(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this._drawWrapper;N.setEffect(R,q,B),void 0!==L&&(N.materialContext=L),R||(N.defines=null,N.materialContext=void 0)}resetDrawCache(R){if(this._drawWrappers){if(void 0!==R)return void this._removeDrawWrapper(R);for(const R of this._drawWrappers)null===R||void 0===R||R.dispose()}this._drawWrappers=[]}static AddToMesh(R,q,L,B,N,h,Z){return new Y(R,q,L,B,N,h,Z,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(R,q,L,B,N,h,Z){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],Y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=R,this.verticesStart=q,this.verticesCount=L,this.indexStart=B,this.indexCount=N,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=h,this._renderingMesh=Z||h,Y&&h.Zf.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=h.Zf.length-1,z&&(this.refreshBoundingInfo(),h.Jj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(R){return this._boundingInfo=R,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const R=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return R||this._renderingMesh}Ha(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const q=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!q)return R?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(q)){const R=q.getSubMaterial(this.materialIndex);return this._currentMaterial!==R&&(this._currentMaterial=R,this.resetDrawCache()),R}return q}_isMultiMaterial(R){return void 0!==R.getSubMaterial}refreshBoundingInfo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.yj)return this;if(R||(R=this._renderingMesh.getVerticesData(B.e.PositionKind)),!R)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const q=this._renderingMesh.Sf();let L;if(0===this.indexStart&&this.indexCount===q.length){const R=this._renderingMesh.getBoundingInfo();L={minimum:R.minimum.clone(),maximum:R.maximum.clone()}}else L=(0,Z.d)(R,q,this.indexStart,this.indexCount,this._renderingMesh.yj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(L.minimum,L.maximum):this._boundingInfo=new h.b(L.minimum,L.maximum),this}_checkCollision(R){return this.getBoundingInfo()._checkCollision(R)}updateBoundingInfo(R){let q=this.getBoundingInfo();return q||(this.refreshBoundingInfo(),q=this.getBoundingInfo()),q&&q.update(R),this}isInFrustum(R){const q=this.getBoundingInfo();return!!q&&q.isInFrustum(R,this._mesh.yi)}isCompletelyInFrustum(R){const q=this.getBoundingInfo();return!!q&&q.isCompletelyInFrustum(R)}render(R){return this._renderingMesh.render(this,R,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(R,q){if(!this._linesIndexBuffer){const L=[];for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=3)L.push(R[q],R[q+1],R[q+1],R[q+2],R[q+2],R[q]);this._linesIndexBuffer=q.createIndexBuffer(L),this._linesIndexCount=L.length}return this._linesIndexBuffer}canIntersects(R){const q=this.getBoundingInfo();return!!q&&R.intersectsBox(q.boundingBox)}intersects(R,q,L,B,N){const h=this.Ha();if(!h)return null;let Z=3,z=!1;switch(h.fillMode){case 3:case 5:case 6:case 8:return null;case 7:Z=1,z=!0}return 4===h.fillMode?L.length?this._intersectLines(R,q,L,this._mesh.intersectionThreshold,B):this._intersectUnIndexedLines(R,q,L,this._mesh.intersectionThreshold,B):!L.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(R,q,L,B,N):this._intersectTriangles(R,q,L,Z,z,B,N)}_intersectLines(R,q,L,B,h){let Z=null;for(let z=this.indexStart;z<this.indexStart+this.indexCount;z+=2){const Y=q[L[z]],F=q[L[z+1]],C=R.intersectionSegment(Y,F,B);if(!(C<0)&&((h||!Z||C<Z.distance)&&(Z=new N.b(null,null,C),Z.faceId=z/2,h)))break}return Z}_intersectUnIndexedLines(R,q,L,B,h){let Z=null;for(let z=this.verticesStart;z<this.verticesStart+this.verticesCount;z+=2){const L=q[z],Y=q[z+1],F=R.intersectionSegment(L,Y,B);if(!(F<0)&&((h||!Z||F<Z.distance)&&(Z=new N.b(null,null,F),Z.faceId=z/2,h)))break}return Z}_intersectTriangles(R,q,L,B,N,h,Z){let z=null,Y=-1;for(let F=this.indexStart;F<this.indexStart+this.indexCount-(3-B);F+=B){Y++;const B=L[F],C=L[F+1],e=L[F+2];if(N&&4294967295===e){F+=2;continue}const y=q[B],U=q[C],n=q[e];if(!y||!U||!n)continue;if(Z&&!Z(y,U,n,R,B,C,e))continue;const r=R.intersectsTriangle(y,U,n);if(r){if(r.distance<0)continue;if((h||!z||r.distance<z.distance)&&(z=r,z.faceId=Y,h))break}}return z}_intersectUnIndexedTriangles(R,q,L,B,N){let h=null;for(let Z=this.verticesStart;Z<this.verticesStart+this.verticesCount;Z+=3){const L=q[Z],z=q[Z+1],Y=q[Z+2];if(N&&!N(L,z,Y,R,-1,-1,-1))continue;const F=R.intersectsTriangle(L,z,Y);if(F){if(F.distance<0)continue;if((B||!h||F.distance<h.distance)&&(h=F,h.faceId=Z/3,B))break}}return h}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(R,q){const L=new Y(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,R,q,!1);if(!this.IsGlobal){const R=this.getBoundingInfo();if(!R)return L;L._boundingInfo=new h.b(R.minimum,R.maximum)}return L}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const R=this._mesh.Zf.indexOf(this);this._mesh.Zf.splice(R,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(R,q,L,B,N){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=Number.MAX_VALUE,z=-Number.MAX_VALUE;const F=(N||B).Sf();for(let Y=q;Y<q+L;Y++){const R=F[Y];R<Z&&(Z=R),R>z&&(z=R)}return new Y(R,Z,z-Z+1,q,L,B,N,h)}}},12107:(R,q,L)=>{"use strict";var B=L(11329),N=L(11136),h=L(11081),Z=L(10767),z=L(11228);B.d.prototype.thinInstanceAdd=function(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return Z.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(R)?R.length:1);const L=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(R))for(let B=0;B<R.length;++B)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,R[B],B===R.length-1&&q);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,R,q);return L},B.d.prototype.thinInstanceAddSelf=function(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(h.c.IdentityReadOnly,R)},B.d.prototype.thinInstanceRegisterAttribute=function(R,q){R===N.e.ColorKind&&(R=N.e.ColorInstanceKind),this.removeVerticesData(R),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[R]=q,this._userThinInstanceBuffersStorage.sizes[R]=q*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[R]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[R]),this._userThinInstanceBuffersStorage.vertexBuffers[R]=new N.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[R],R,!0,!1,q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])},B.d.prototype.thinInstanceSetMatrixAt=function(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||R>=this._thinInstanceDataStorage.instancesCount)return!1;const B=this._thinInstanceDataStorage.matrixData;return q.copyToArray(B,16*R),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[R]=q),L&&(this.Lb("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},B.d.prototype.thinInstanceSetAttributeAt=function(R,q,L){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return R===N.e.ColorKind&&(R=N.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[R]||q>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(R,0),this._userThinInstanceBuffersStorage.data[R].set(L,q*this._userThinInstanceBuffersStorage.strides[R]),B&&this.Lb(R),!0)},Object.defineProperty(B.d.prototype,"Fb",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(R){var q;const L=this._thinInstanceDataStorage.matrixData??(null===(q=this.source)||void 0===q?void 0:q._thinInstanceDataStorage.matrixData);R<=(L?L.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=R)},enumerable:!0,configurable:!0}),B.d.prototype._thinInstanceCreateMatrixBuffer=function(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=new N.d(this.getEngine(),q,!L,16,!1,!0);for(let N=0;N<4;N++)this.setVerticesBuffer(B.createVertexBuffer(R+N,4*N,4));return B},B.d.prototype.Cb=function(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var h;if(L=L||16,"matrix"===R)null===(h=this._thinInstanceDataStorage.matrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=q?q.length:32*L,this._thinInstanceDataStorage.matrixData=q,this._thinInstanceDataStorage.worldMatrices=null,null!==q?(this._thinInstanceDataStorage.instancesCount=q.length/L,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",q,B),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===R){var Z;null===(Z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Z||Z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=q,null!==q&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",q,B))}else{var z;if(R===N.e.ColorKind&&(R=N.e.ColorInstanceKind),null===q)null!==(z=this._userThinInstanceBuffersStorage)&&void 0!==z&&z.data[R]&&(this.removeVerticesData(R),delete this._userThinInstanceBuffersStorage.data[R],delete this._userThinInstanceBuffersStorage.strides[R],delete this._userThinInstanceBuffersStorage.sizes[R],delete this._userThinInstanceBuffersStorage.vertexBuffers[R]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[R]=q,this._userThinInstanceBuffersStorage.strides[R]=L,this._userThinInstanceBuffersStorage.sizes[R]=q.length,this._userThinInstanceBuffersStorage.vertexBuffers[R]=new N.e(this.getEngine(),q,R,!B,!1,L,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])}},B.d.prototype.Lb=function(R){var q;if("matrix"===R)this.Hj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(R),null===(q=this._thinInstanceDataStorage.matrixBuffer)||void 0===q||q.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===R){var L;this.Hj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(R),null===(L=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===L||L.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var B;R===N.e.ColorKind&&(R=N.e.ColorInstanceKind),null!==(B=this._userThinInstanceBuffersStorage)&&void 0!==B&&B.vertexBuffers[R]&&(this.Hj&&!this._userThinInstanceBuffersStorage.vertexBuffers[R].isUpdatable()&&this._thinInstanceRecreateBuffer(R),this._userThinInstanceBuffersStorage.vertexBuffers[R].updateDirectly(this._userThinInstanceBuffersStorage.data[R],0))}},B.d.prototype.thinInstancePartialBufferUpdate=function(R,q,L){var B;"matrix"===R?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(q,L):(R===N.e.ColorKind&&(R=N.e.ColorInstanceKind),null!==(B=this._userThinInstanceBuffersStorage)&&void 0!==B&&B.vertexBuffers[R]&&this._userThinInstanceBuffersStorage.vertexBuffers[R].updateDirectly(q,L))},B.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const R=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let q=0;q<this._thinInstanceDataStorage.instancesCount;++q)this._thinInstanceDataStorage.worldMatrices[q]=h.c.Ig(R,16*q)}return this._thinInstanceDataStorage.worldMatrices},B.d.prototype.thinInstanceRefreshBoundingInfo=function(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const B=this._thinInstanceDataStorage.boundingVectors;if(R||!this.rawBoundingInfo){B.length=0,this.refreshBoundingInfo(q,L);const R=this.getBoundingInfo();this.rawBoundingInfo=new z.b(R.minimum,R.maximum)}const N=this.getBoundingInfo(),Z=this._thinInstanceDataStorage.matrixData;if(0===B.length)for(let h=0;h<N.boundingBox.vectors.length;++h)B.push(N.boundingBox.vectors[h].clone());h.h.o[0].Rd(Number.POSITIVE_INFINITY),h.h.o[1].Rd(Number.NEGATIVE_INFINITY);for(let z=0;z<this._thinInstanceDataStorage.instancesCount;++z){h.c.FromArrayToRef(Z,16*z,h.h.Matrix[0]);for(let R=0;R<B.length;++R)h.m.TransformCoordinatesToRef(B[R],h.h.Matrix[0],h.h.o[2]),h.h.o[0].minimizeInPlace(h.h.o[2]),h.h.o[1].maximizeInPlace(h.h.o[2])}N.reConstruct(h.h.o[0],h.h.o[1]),this.Ea()},B.d.prototype._thinInstanceRecreateBuffer=function(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var L;if("matrix"===R)null===(L=this._thinInstanceDataStorage.matrixBuffer)||void 0===L||L.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,q);else if("previousMatrix"===R){var B;if(this._scene.needsPreviousWorldMatrices)null===(B=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,q)}else{var h;R===N.e.ColorKind&&(R=N.e.ColorInstanceKind),null===(h=this._userThinInstanceBuffersStorage.vertexBuffers[R])||void 0===h||h.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[R]=new N.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[R],R,!q,!1,this._userThinInstanceBuffersStorage.strides[R],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])}},B.d.prototype._thinInstanceUpdateBufferSize=function(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;R===N.e.ColorKind&&(R=N.e.ColorInstanceKind);const L="matrix"===R;if(!L&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[R]))return;const B=L?16:this._userThinInstanceBuffersStorage.strides[R],h=L?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[R];let Z=L?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[R];const z=(this._thinInstanceDataStorage.instancesCount+q)*B;let Y=h;for(;Y<z;)Y*=2;if(!Z||h!=Y){if(Z){const R=new Float32Array(Y);R.set(Z,0),Z=R}else Z=new Float32Array(Y);var F,C,e;if(L){if(null===(F=this._thinInstanceDataStorage.matrixBuffer)||void 0===F||F.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",Z,!1),this._thinInstanceDataStorage.matrixData=Z,this._thinInstanceDataStorage.matrixBufferSize=Y,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(C=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===C||C.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",Z,!1)}else null===(e=this._userThinInstanceBuffersStorage.vertexBuffers[R])||void 0===e||e.dispose(),this._userThinInstanceBuffersStorage.data[R]=Z,this._userThinInstanceBuffersStorage.sizes[R]=Y,this._userThinInstanceBuffersStorage.vertexBuffers[R]=new N.e(this.getEngine(),Z,R,!0,!1,B,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])}},B.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},B.d.prototype._disposeThinInstanceSpecificData=function(){var R;null!==(R=this._thinInstanceDataStorage)&&void 0!==R&&R.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11379:(R,q,L)=>{"use strict";L.d(q,{e:()=>e});var B=L(11053),N=L(11058),h=L(11117),Z=L(10760),z=L(11081),Y=L(11345),F=L(10889);const C=z.c.Compose(z.m.One(),z.d.FromEulerAngles(0,Math.PI,0),z.m.Zero());class e extends Y.d{get billboardMode(){return this._billboardMode}set billboardMode(R){this._billboardMode!==R&&(this._billboardMode=R,this._cache.useBillboardPosition=0!==(this._billboardMode&e.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(R){R!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=R,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(R){this._infiniteDistance!==R&&(this._infiniteDistance=R)}constructor(R){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new z.m(0,0,1),this._up=new z.m(0,1,0),this._right=new z.m(1,0,0),this._position=z.m.Zero(),this._rotation=z.m.Zero(),this._rotationQuaternion=null,this._scaling=z.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=e.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Lj=z.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=z.m.Zero(),this._absoluteScaling=z.m.Zero(),this._absoluteRotationQuaternion=z.d.Identity(),this._pivotMatrix=z.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new Z.b,this._nonUniformScaling=!1,q&&this.va().addTransformNode(this)}getClassName(){return"qb"}get position(){return this._position}set position(R){this._position=R,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(R){this._rotation=R,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Ud(){return this._scaling}set Ud(R){this._scaling=R,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(R){this._rotationQuaternion=R,R&&this._rotation.Rd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return z.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return z.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return z.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(R){return this._poseMatrix?(this._poseMatrix.p(R),this):(this._poseMatrix=R.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=z.c.Identity()),this._poseMatrix}_isSynchronized(){const R=this._cache;return this._billboardMode===R.billboardMode&&this._billboardMode===e.BILLBOARDMODE_NONE&&(!R.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const R=this._cache;R.localMatrixUpdated=!1,R.billboardMode=-1,R.infiniteDistance=!1,R.useBillboardPosition=!1,R.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(R){return this.setPivotMatrix(R,!1)}setPivotMatrix(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(R),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=q,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=z.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const B=this.clone("Clone of "+(this.name||this.id),R||this.parent,!0);B&&L&&L(this,B);for(const N of this.getChildTransformNodes(!0))N.instantiateHierarchy(B,q,L);return B}Yb(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return R?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Rd(0),this._rotationQuaternion=this._rotationQuaternion||z.d.Identity(),R.decompose(this._scaling,this._rotationQuaternion,this._position),this.Jj(!0)):(this._worldMatrix=R,this._absolutePosition.Td(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Jj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Jj(!0),this}get kj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Jj(),this._absolutePosition}setAbsolutePosition(R){if(!R)return this;let q,L,B;if(void 0===R.x){if(arguments.length<3)return this;q=arguments[0],L=arguments[1],B=arguments[2]}else q=R.x,L=R.y,B=R.z;if(this.parent){const R=z.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(R),z.m.TransformCoordinatesFromFloatsToRef(q,L,B,R,this.position)}else this.position.x=q,this.position.y=L,this.position.z=B;return this._absolutePosition.p(R),this}setPositionWithLocalVector(R){return this.Jj(),this.position=z.m.TransformNormal(R,this.Lj),this}getPositionExpressedInLocalSpace(){this.Jj();const R=z.h.Matrix[0];return this.Lj.invertToRef(R),z.m.TransformNormal(this.position,R)}locallyTranslate(R){return this.Jj(!0),this.position=z.m.TransformCoordinates(R,this.Lj),this}lookAt(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const h=e._LookAtVectorCache,Z=0===N?this.position:this.getAbsolutePosition();if(R.subtractToRef(Z,h),this.setDirection(h,q,L,B),1===N&&this.parent)if(this.rotationQuaternion){const R=z.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(R);const q=z.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.invert(),R.multiplyToRef(q,R),this.rotationQuaternion.fromRotationMatrix(R)}else{const R=z.h.Quaternion[0];z.d.FromEulerVectorToRef(this.rotation,R);const q=z.h.Matrix[0];R.toRotationMatrix(q);const L=z.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(L),L.invert(),q.multiplyToRef(L,q),R.fromRotationMatrix(q),R.toEulerAnglesToRef(this.rotation)}return this}Le(R){const q=z.m.Zero();return this.getDirectionToRef(R,q),q}getDirectionToRef(R,q){return z.m.TransformNormalToRef(R,this.getWorldMatrix(),q),this}setDirection(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=-Math.atan2(R.z,R.x)+Math.PI/2,h=Math.sqrt(R.x*R.x+R.z*R.z),Z=-Math.atan2(R.y,h);return this.rotationQuaternion?z.d.RotationYawPitchRollToRef(N+q,Z+L,B,this.rotationQuaternion):(this.rotation.x=Z+L,this.rotation.y=N+q,this.rotation.z=B),this}setPivotPoint(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Jj(!0);const L=this.getWorldMatrix();if(1==q){const q=z.h.Matrix[0];L.invertToRef(q),R=z.m.TransformCoordinates(R,q)}return this.setPivotMatrix(z.c.Translation(-R.x,-R.y,-R.z),!0)}getPivotPoint(){const R=z.m.Zero();return this.getPivotPointToRef(R),R}getPivotPointToRef(R){return R.x=-this._pivotMatrix.m[12],R.y=-this._pivotMatrix.m[13],R.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const R=z.m.Zero();return this.getAbsolutePivotPointToRef(R),R}getAbsolutePivotPointToRef(R){return this.getPivotPointToRef(R),z.m.TransformCoordinatesToRef(R,this.getWorldMatrix(),R),this}Ag(R){if(this._isDirty)return this;if(this._children)for(const q of this._children)q.Ag(R);return super.Ag(R)}setParent(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!R&&!this.parent)return this;const B=z.h.Quaternion[0],N=z.h.o[0],h=z.h.o[1],Z=z.h.Matrix[1];z.c.IdentityToRef(Z);const Y=z.h.Matrix[0];this.Jj(!0);let F=this.rotationQuaternion;return F||(F=e._TmpRotation,z.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,F)),z.c.ComposeToRef(this.Ud,F,this.position,Y),this.parent&&Y.multiplyToRef(this.parent.Jj(!0),Y),R&&(R.Jj(!0).invertToRef(Z),Y.multiplyToRef(Z,Y)),Y.decompose(h,B,N,q?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(B):B.toEulerAnglesToRef(this.rotation),this.Ud.p(h),this.position.p(N),this.parent=R,L&&this.setPivotMatrix(z.c.Identity()),this}addChild(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return R.setParent(this,q),this}removeChild(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return R.setParent(null,q),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(R){return this._nonUniformScaling!==R&&(this._nonUniformScaling=R,!0)}attachToBone(R,q){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=q,this.parent=R,R.getSkeleton().prepare(!0),R.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=R?this._currentParentWhenAttachingToBone:null,this):(R&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(R,q,L){let B;if(R.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Rd(0)),L&&0!==L){if(this.parent){const L=this.parent.getWorldMatrix(),B=z.h.Matrix[0];L.invertToRef(B),R=z.m.TransformNormal(R,B),L.determinant()<0&&(q*=-1)}B=z.d.RotationAxisToRef(R,q,e._RotationAxisCache),B.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else B=z.d.RotationAxisToRef(R,q,e._RotationAxisCache),this.rotationQuaternion.multiplyToRef(B,this.rotationQuaternion);return this}rotateAround(R,q,L){q.normalize(),this.rotationQuaternion||(this.rotationQuaternion=z.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Rd(0));const B=z.h.o[0],N=z.h.o[1],h=z.h.o[2],Z=z.h.Quaternion[0],Y=z.h.Matrix[0],F=z.h.Matrix[1],C=z.h.Matrix[2],e=z.h.Matrix[3];return R.subtractToRef(this.position,B),z.c.TranslationToRef(B.x,B.y,B.z,Y),z.c.TranslationToRef(-B.x,-B.y,-B.z,F),z.c.RotationAxisToRef(q,L,C),F.multiplyToRef(C,e),e.multiplyToRef(Y,e),e.decompose(N,Z,h),this.position.addInPlace(h),Z.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(R,q,L){const B=R.scale(q);if(L&&0!==L)this.setAbsolutePosition(this.getAbsolutePosition().add(B));else{const R=this.getPositionExpressedInLocalSpace().add(B);this.setPositionWithLocalVector(R)}return this}addRotation(R,q,L){let B;this.rotationQuaternion?B=this.rotationQuaternion:(B=z.h.Quaternion[1],z.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,B));const N=z.h.Quaternion[0];return z.d.RotationYawPitchRollToRef(q,R,L,N),B.multiplyInPlace(N),this.rotationQuaternion||B.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Jj(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const L=this.va().getRenderId();if(!this._isDirty&&!R&&(this._currentRenderId===L||this.isSynchronized()))return this._currentRenderId=L,this._worldMatrix;q=q||this.va().activeCamera,this._updateCache();const B=this._cache;B.pivotMatrixUpdated=!1,B.billboardMode=this.billboardMode,B.infiniteDistance=this.infiniteDistance,B.parent=this._parentNode,this._currentRenderId=L,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const N=this._getEffectiveParent(),h=e._TmpScaling;let Z,Y=this._position;if(this._infiniteDistance&&!this.parent&&q){const R=q.getWorldMatrix(),L=new z.m(R.m[12],R.m[13],R.m[14]);Y=e._TmpTranslation,Y.Td(this._position.x+L.x,this._position.y+L.y,this._position.z+L.z)}if(h.Td(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,Z=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(z.d.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Td(0,0,0))}}else Z=e._TmpRotation,z.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Z);if(this._usePivotMatrix){const R=z.h.Matrix[1];z.c.ScalingToRef(h.x,h.y,h.z,R);const q=z.h.Matrix[0];Z.toRotationMatrix(q),this._pivotMatrix.multiplyToRef(R,z.h.Matrix[4]),z.h.Matrix[4].multiplyToRef(q,this.Lj),this._postMultiplyPivotMatrix&&this.Lj.multiplyToRef(this._pivotMatrixInverse,this.Lj),this.Lj.addTranslationFromFloats(Y.x,Y.y,Y.z)}else z.c.ComposeToRef(h,Z,Y,this.Lj);if(N&&N.getWorldMatrix){if(R&&N.Jj(R),B.useBillboardPath){if(this._transformToBoneReferal){const R=this.parent;R.getSkeleton().prepare(),R.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),z.h.Matrix[7])}else z.h.Matrix[7].p(N.getWorldMatrix());const R=z.h.o[5],q=z.h.o[6],L=z.h.Quaternion[0];z.h.Matrix[7].decompose(q,L,R),z.c.ScalingToRef(q.x,q.y,q.z,z.h.Matrix[7]),z.h.Matrix[7].setTranslation(R),e.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(L,R),this.Lj.setTranslation(R)),this.Lj.multiplyToRef(z.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const R=this.parent;R.getSkeleton().prepare(),this.Lj.multiplyToRef(R.getFinalMatrix(),z.h.Matrix[6]),z.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Lj.multiplyToRef(N.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Lj);if(B.useBillboardPath&&q&&this.billboardMode&&!B.useBillboardPosition){const R=z.h.o[0];if(this._worldMatrix.getTranslationToRef(R),z.h.Matrix[1].p(q.getViewMatrix()),this._scene.useRightHandedSystem&&z.h.Matrix[1].multiplyToRef(C,z.h.Matrix[1]),z.h.Matrix[1].setTranslationFromFloats(0,0,0),z.h.Matrix[1].invertToRef(z.h.Matrix[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){z.h.Matrix[0].decompose(void 0,z.h.Quaternion[0],void 0);const R=z.h.o[1];z.h.Quaternion[0].toEulerAnglesToRef(R),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(R.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(R.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(R.z=0),z.c.RotationYawPitchRollToRef(R.y,R.x,R.z,z.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(z.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(z.h.o[0])}else if(B.useBillboardPath&&q&&B.useBillboardPosition){const R=z.h.o[0];this._worldMatrix.getTranslationToRef(R);const L=q.globalPosition;this._worldMatrix.invertToRef(z.h.Matrix[1]);const B=z.h.o[1];z.m.TransformCoordinatesToRef(L,z.h.Matrix[1],B),B.normalize();const N=-Math.atan2(B.z,B.x)+Math.PI/2,h=Math.sqrt(B.x*B.x+B.z*B.z),Z=-Math.atan2(B.y,h);if(z.d.RotationYawPitchRollToRef(N,Z,0,z.h.Quaternion[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){const R=z.h.o[1];z.h.Quaternion[0].toEulerAnglesToRef(R),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(R.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(R.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(R.z=0),z.c.RotationYawPitchRollToRef(R.y,R.x,R.z,z.h.Matrix[0])}else z.c.FromQuaternionToRef(z.h.Quaternion[0],z.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(z.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(z.h.o[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):N&&N._nonUniformScaling?this._updateNonUniformScalingState(N._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Td(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=z.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Jj(),R){const R=this.getChildren();for(let q=0;q<R.length;++q){const L=R[q];if(L){L.Jj();const R=z.h.Matrix[0];L.Lj.multiplyToRef(this.Lj,R);const q=z.h.Quaternion[0];R.decompose(L.Ud,q,L.position),L.rotationQuaternion?L.rotationQuaternion.p(q):q.toEulerAnglesToRef(L.rotation)}}}this.Ud.Td(1,1,1),this.position.Td(0,0,0),this.rotation.Td(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=z.d.Identity()),this._worldMatrix=z.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(R){return this.onAfterWorldMatrixUpdateObservable.add(R),this}unregisterAfterWorldMatrixUpdate(R){return this.onAfterWorldMatrixUpdateObservable.removeCallback(R),this}getPositionInCameraSpace(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return R||(R=this.va().activeCamera),z.m.TransformCoordinates(this.getAbsolutePosition(),R.getViewMatrix())}getDistanceToCamera(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return R||(R=this.va().activeCamera),this.getAbsolutePosition().Bc(R.globalPosition).length()}clone(R,q,L){const B=h.b.Clone((()=>new e(R,this.va())),this);if(B.name=R,B.id=R,q&&(B.parent=q),!L){const q=this.getDescendants(!0);for(let L=0;L<q.length;L++){const N=q[L];N.clone&&N.clone(R+"."+N.name,B)}}return B}serialize(R){const q=h.b.Serialize(this,R);return q.type=this.getClassName(),q.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(q),q.localMatrix=this.getPivotMatrix().dj(),q.isEnabled=this.isEnabled(),h.b.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q}static Parse(R,q,L){const B=h.b.Parse((()=>new e(R.name,q)),R,q,L);if(R.localMatrix?B.setPreTransformMatrix(z.c.Ig(R.localMatrix)):R.pivotMatrix&&B.setPivotMatrix(z.c.Ig(R.pivotMatrix)),B.xb(R.isEnabled),B._waitingParsedUniqueId=R.uniqueId,void 0!==R.parentId&&(B._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(B._waitingParentInstanceIndex=R.parentInstanceIndex),R.animations){for(let q=0;q<R.animations.length;q++){const L=R.animations[q],N=(0,F.d)("BABYLON.Animation");N&&B.animations.push(N.Parse(L))}Y.d.ParseAnimationRanges(B,R,q)}return R.autoAnimate&&q.beginAnimation(B,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),B}getChildTransformNodes(R,q){const L=[];return this._getDescendants(L,R,(R=>(!q||q(R))&&R instanceof e)),L}dispose(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const R=this._parentContainer.transformNodes.indexOf(this);R>-1&&this._parentContainer.transformNodes.splice(R,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),R){const R=this.getChildTransformNodes(!0);for(const q of R)q.parent=null,q.Jj(!0)}super.dispose(R,q)}normalizeToUnitCube(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0,B=null,N=null;q&&(this.rotationQuaternion?(N=this.rotationQuaternion.clone(),this.rotationQuaternion.Td(0,0,0,1)):this.rotation&&(B=this.rotation.clone(),this.rotation.Td(0,0,0)));const h=this.getHierarchyBoundingVectors(R,L),Z=h.max.Bc(h.min),z=Math.max(Z.x,Z.y,Z.z);if(0===z)return this;const Y=1/z;return this.Ud.scaleInPlace(Y),q&&(this.rotationQuaternion&&N?this.rotationQuaternion.p(N):this.rotation&&B&&this.rotation.p(B)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}e.BILLBOARDMODE_NONE=0,e.BILLBOARDMODE_X=1,e.BILLBOARDMODE_Y=2,e.BILLBOARDMODE_Z=4,e.BILLBOARDMODE_ALL=7,e.BILLBOARDMODE_USE_POSITION=128,e.BillboardUseParentOrientation=!1,e._TmpRotation=z.d.Zero(),e._TmpScaling=z.m.Zero(),e._TmpTranslation=z.m.Zero(),e._LookAtVectorCache=new z.m(0,0,0),e._RotationAxisCache=new z.d,(0,B.d)([(0,N.G)("position")],e.prototype,"_position",void 0),(0,B.d)([(0,N.G)("rotation")],e.prototype,"_rotation",void 0),(0,B.d)([(0,N.z)("rotationQuaternion")],e.prototype,"_rotationQuaternion",void 0),(0,B.d)([(0,N.G)("Ud")],e.prototype,"_scaling",void 0),(0,B.d)([(0,N.K)("billboardMode")],e.prototype,"_billboardMode",void 0),(0,B.d)([(0,N.K)()],e.prototype,"scalingDeterminant",void 0),(0,B.d)([(0,N.K)("infiniteDistance")],e.prototype,"_infiniteDistance",void 0),(0,B.d)([(0,N.K)()],e.prototype,"ignoreNonUniformScaling",void 0),(0,B.d)([(0,N.K)()],e.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11595:(R,q,L)=>{"use strict";L.d(q,{e:()=>F});var B=L(11081),N=L(11099),h=L(11562),Z=L(11088),z=L(11112);class Y{constructor(R,q,L,B){this.name=R,this.worldAxisForNormal=q,this.worldAxisForFileX=L,this.worldAxisForFileY=B}}class F{static ConvertCubeMapTextureToSphericalPolynomial(R){var q;if(!R.isCube)return null;null===(q=R.va())||void 0===q||q.getEngine().flushFramebuffer();const L=R.getSize().width,B=R.readPixels(0,void 0,void 0,!1),N=R.readPixels(1,void 0,void 0,!1);let h,Z;R.isRenderTarget?(h=R.readPixels(3,void 0,void 0,!1),Z=R.readPixels(2,void 0,void 0,!1)):(h=R.readPixels(2,void 0,void 0,!1),Z=R.readPixels(3,void 0,void 0,!1));const z=R.readPixels(4,void 0,void 0,!1),Y=R.readPixels(5,void 0,void 0,!1),F=R.gammaSpace;let C=0;return 1!=R.textureType&&2!=R.textureType||(C=1),new Promise((R=>{Promise.all([N,B,h,Z,z,Y]).then((q=>{let[B,N,h,Z,z,Y]=q;const e={size:L,right:N,left:B,up:h,down:Z,front:z,back:Y,format:5,type:C,gammaSpace:F};R(this.ConvertCubeMapToSphericalPolynomial(e))}))}))}static _AreaElement(R,q){return Math.atan2(R*q,Math.sqrt(R*R+q*q+1))}static ConvertCubeMapToSphericalPolynomial(R){const q=new h.b;let L=0;const B=2/R.size,Y=B,F=.5*B,C=F-1;for(let h=0;h<6;h++){const e=this._FileFaces[h],y=R[e.name];let U=C;const n=5===R.format?4:3;for(let h=0;h<R.size;h++){let r=C;for(let Y=0;Y<R.size;Y++){const C=e.worldAxisForFileX.scale(r).add(e.worldAxisForFileY.scale(U)).add(e.worldAxisForNormal);C.normalize();const p=this._AreaElement(r-F,U-F)-this._AreaElement(r-F,U+F)-this._AreaElement(r+F,U-F)+this._AreaElement(r+F,U+F);let c=y[h*R.size*n+Y*n+0],d=y[h*R.size*n+Y*n+1],f=y[h*R.size*n+Y*n+2];isNaN(c)&&(c=0),isNaN(d)&&(d=0),isNaN(f)&&(f=0),0===R.type&&(c/=255,d/=255,f/=255),R.gammaSpace&&(c=Math.pow((0,N.b)(c),Z.m),d=Math.pow((0,N.b)(d),Z.m),f=Math.pow((0,N.b)(f),Z.m));const v=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const R=Math.max(c,d,f);if(R>v){const q=v/R;c*=q,d*=q,f*=q}}else c=(0,N.b)(c,0,v),d=(0,N.b)(d,0,v),f=(0,N.b)(f,0,v);const T=new z.e(c,d,f);q.addLight(C,T,p),L+=p,r+=B}U+=Y}}const e=6*(4*Math.PI)/6/L;return q.scaleInPlace(e),q.convertIncidentRadianceToIrradiance(),q.convertIrradianceToLambertianRadiance(),h.d.FromHarmonics(q)}}F._FileFaces=[new Y("right",new B.m(1,0,0),new B.m(0,0,-1),new B.m(0,-1,0)),new Y("left",new B.m(-1,0,0),new B.m(0,0,1),new B.m(0,-1,0)),new Y("up",new B.m(0,1,0),new B.m(1,0,0),new B.m(0,0,1)),new Y("down",new B.m(0,-1,0),new B.m(1,0,0),new B.m(0,0,-1)),new Y("front",new B.m(0,0,1),new B.m(1,0,0),new B.m(0,-1,0)),new Y("back",new B.m(0,0,-1),new B.m(-1,0,0),new B.m(0,-1,0))],F.MAX_HDRI_VALUE=4096,F.PRESERVE_CLAMPED_COLORS=!1},11092:(R,q,L)=>{"use strict";function B(R,q){const L=[];for(let B=0;B<R;++B)L.push(q());return L}function N(R,q){return B(R,q)}L.d(q,{e:()=>B,g:()=>N,i:()=>Z});const h=["push","splice","pop","shift","unshift"];function Z(R,q){const L=h.map((L=>function(R,q,L){const B=R[q];if("function"!==typeof B)return null;const N=function(){const B=R.length,h=N.previous.apply(R,arguments);return L(q,B),h};return B.next=N,N.previous=B,R[q]=N,()=>{const L=N.previous;if(!L)return;const B=N.next;B?(L.next=B,B.previous=L):(L.next=void 0,R[q]=L),N.next=void 0,N.previous=void 0}}(R,L,q)));return()=>{L.forEach((R=>{null===R||void 0===R||R()}))}}},12057:(R,q,L)=>{"use strict";L.d(q,{b:()=>Z});var B=L(11277),N=L(12064);let h=0;const Z=R=>{if(!R.environmentBRDFTexture){const q=R.useDelayedTextureLoading;R.useDelayedTextureLoading=!1;const L=R._blockEntityCollection;R._blockEntityCollection=!1;const Z=B.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+h++,R,!0,!1,B.c.BILINEAR_SAMPLINGMODE);R._blockEntityCollection=L;const z=R.getEngine().getLoadedTexturesCache(),Y=z.indexOf(Z.getInternalTexture());-1!==Y&&z.splice(Y,1),Z.isRGBD=!0,Z.wrapU=B.c.CLAMP_ADDRESSMODE,Z.wrapV=B.c.CLAMP_ADDRESSMODE,R.environmentBRDFTexture=Z,R.useDelayedTextureLoading=q,N.e.ExpandRGBDTexture(Z);const F=R.getEngine().onContextRestoredObservable.add((()=>{Z.isRGBD=!0;const q=R.onBeforeRenderObservable.add((()=>{Z.isReady()&&(R.onBeforeRenderObservable.remove(q),N.e.ExpandRGBDTexture(Z))}))}));R.ej.add((()=>{R.getEngine().onContextRestoredObservable.remove(F)}))}return R.environmentBRDFTexture}},11331:(R,q,L)=>{"use strict";function B(R,q,L){try{const B=R.next();B.done?q(B):B.value?B.value.then((()=>{B.value=void 0,q(B)}),L):q(B)}catch(B){L(B)}}function N(){let R,q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(L,N,h)=>{const Z=performance.now();void 0===R||Z-R>q?(R=Z,setTimeout((()=>{B(L,N,h)}),0)):B(L,N,h)}}function h(R,q,L,B,N){const h=()=>{let Z;const z=R=>{R.done?L(R.value):void 0===Z?Z=!0:h()};do{Z=void 0,N&&N.aborted?B(new Error("Aborted")):q(R,z,B),void 0===Z&&(Z=!1)}while(Z)};h()}function Z(R,q){let L;return h(R,B,(R=>L=R),(R=>{throw R}),q),L}function z(R,q,L){return new Promise(((B,N)=>{h(R,q,B,N,L)}))}function Y(R,q){return function(){return Z(R(...arguments),q)}}L.d(q,{e:()=>N,i:()=>Y,k:()=>z,o:()=>Z})},11587:(R,q,L)=>{"use strict";L.d(q,{b:()=>n});var B=L(11099),N=L(10767),h=L(11595),Z=L(11604);L(11636);const z=131072,Y=131072;function F(R){return R.charCodeAt(0)+(R.charCodeAt(1)<<8)+(R.charCodeAt(2)<<16)+(R.charCodeAt(3)<<24)}const C=F("DXT1"),e=F("DXT3"),y=F("DXT5"),U=F("DX10");class n{static GetDDSInfo(R){const q=new Int32Array(R.buffer,R.byteOffset,31),L=new Int32Array(R.buffer,R.byteOffset,35);let B=1;q[2]&z&&(B=Math.max(1,q[7]));const N=q[21],h=N===U?L[32]:0;let Z=0;switch(N){case 113:Z=2;break;case 116:Z=1;break;case U:if(10===h){Z=2;break}if(2===h){Z=1;break}}return{width:q[4],height:q[3],mipmapCount:B,isFourCC:4===(4&q[20]),isRGB:64===(64&q[20]),isLuminance:(q[20]&Y)===Y,isCube:512===(512&q[28]),isCompressed:N===C||N===e||N===y,dxgiFormat:h,textureType:Z}}static _GetHalfFloatAsFloatRGBAArrayBuffer(R,q,L,B,N,h){const z=new Float32Array(B),Y=new Uint16Array(N,L);let F=0;for(let C=0;C<q;C++)for(let q=0;q<R;q++){const L=4*(q+C*R);z[F]=(0,Z.d)(Y[L]),z[F+1]=(0,Z.d)(Y[L+1]),z[F+2]=(0,Z.d)(Y[L+2]),n.StoreLODInAlphaChannel?z[F+3]=h:z[F+3]=(0,Z.d)(Y[L+3]),F+=4}return z}static _GetHalfFloatRGBAArrayBuffer(R,q,L,B,N,h){if(n.StoreLODInAlphaChannel){const z=new Uint16Array(B),Y=new Uint16Array(N,L);let F=0;for(let L=0;L<q;L++)for(let q=0;q<R;q++){const B=4*(q+L*R);z[F]=Y[B],z[F+1]=Y[B+1],z[F+2]=Y[B+2],z[F+3]=(0,Z.g)(h),F+=4}return z}return new Uint16Array(N,L,B)}static _GetFloatRGBAArrayBuffer(R,q,L,B,N,h){if(n.StoreLODInAlphaChannel){const Z=new Float32Array(B),z=new Float32Array(N,L);let Y=0;for(let L=0;L<q;L++)for(let q=0;q<R;q++){const B=4*(q+L*R);Z[Y]=z[B],Z[Y+1]=z[B+1],Z[Y+2]=z[B+2],Z[Y+3]=h,Y+=4}return Z}return new Float32Array(N,L,B)}static _GetFloatAsHalfFloatRGBAArrayBuffer(R,q,L,B,N,h){const z=new Uint16Array(B),Y=new Float32Array(N,L);let F=0;for(let C=0;C<q;C++)for(let q=0;q<R;q++)z[F]=(0,Z.g)(Y[F]),z[F+1]=(0,Z.g)(Y[F+1]),z[F+2]=(0,Z.g)(Y[F+2]),n.StoreLODInAlphaChannel?z[F+3]=(0,Z.g)(h):z[F+3]=(0,Z.g)(Y[F+3]),F+=4;return z}static _GetFloatAsUIntRGBAArrayBuffer(R,q,L,N,h,Z){const z=new Uint8Array(N),Y=new Float32Array(h,L);let F=0;for(let C=0;C<q;C++)for(let q=0;q<R;q++){const L=4*(q+C*R);z[F]=255*(0,B.b)(Y[L]),z[F+1]=255*(0,B.b)(Y[L+1]),z[F+2]=255*(0,B.b)(Y[L+2]),n.StoreLODInAlphaChannel?z[F+3]=Z:z[F+3]=255*(0,B.b)(Y[L+3]),F+=4}return z}static _GetHalfFloatAsUIntRGBAArrayBuffer(R,q,L,N,h,z){const Y=new Uint8Array(N),F=new Uint16Array(h,L);let C=0;for(let e=0;e<q;e++)for(let q=0;q<R;q++){const L=4*(q+e*R);Y[C]=255*(0,B.b)((0,Z.d)(F[L])),Y[C+1]=255*(0,B.b)((0,Z.d)(F[L+1])),Y[C+2]=255*(0,B.b)((0,Z.d)(F[L+2])),n.StoreLODInAlphaChannel?Y[C+3]=z:Y[C+3]=255*(0,B.b)((0,Z.d)(F[L+3])),C+=4}return Y}static _GetRGBAArrayBuffer(R,q,L,B,N,h,Z,z,Y){const F=new Uint8Array(B),C=new Uint8Array(N,L);let e=0;for(let y=0;y<q;y++)for(let q=0;q<R;q++){const L=4*(q+y*R);F[e]=C[L+h],F[e+1]=C[L+Z],F[e+2]=C[L+z],F[e+3]=C[L+Y],e+=4}return F}static _ExtractLongWordOrder(R){return 0===R||255===R||-16777216===R?0:1+n._ExtractLongWordOrder(R>>8)}static _GetRGBArrayBuffer(R,q,L,B,N,h,Z,z){const Y=new Uint8Array(B),F=new Uint8Array(N,L);let C=0;for(let e=0;e<q;e++)for(let q=0;q<R;q++){const L=3*(q+e*R);Y[C]=F[L+h],Y[C+1]=F[L+Z],Y[C+2]=F[L+z],C+=3}return Y}static _GetLuminanceArrayBuffer(R,q,L,B,N){const h=new Uint8Array(B),Z=new Uint8Array(N,L);let z=0;for(let Y=0;Y<q;Y++)for(let q=0;q<R;q++){const L=q+Y*R;h[z]=Z[L],z++}return h}static UploadDDSLevels(R,q,L,B,Z,Y){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,r=arguments.length>7?arguments[7]:void 0,p=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=null;B.sphericalPolynomial&&(c=[]);const d=!!R.getCaps().s3tc;q.generateMipMaps=Z;const f=new Int32Array(L.buffer,L.byteOffset,31);let v,T,t,D,S,I,K,m=0,o=0,l=1;if(542327876!==f[0])return void N.d.Error("Invalid magic number in DDS header");if(!B.isFourCC&&!B.isRGB&&!B.isLuminance)return void N.d.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(B.isCompressed&&!d)return void N.d.Error("Compressed textures are not supported on this platform.");let G=f[22];D=f[1]+4;let W=!1;if(B.isFourCC)switch(v=f[21],v){case C:l=8,o=33777;break;case e:l=16,o=33778;break;case y:l=16,o=33779;break;case 113:W=!0,G=64;break;case 116:W=!0,G=128;break;case U:{D+=20;let R=!1;switch(B.dxgiFormat){case 10:W=!0,G=64,R=!0;break;case 2:W=!0,G=128,R=!0;break;case 88:B.isRGB=!0,B.isFourCC=!1,G=32,R=!0}if(R)break}default:return void N.d.Error(["Unsupported FourCC code:",(H=v,String.fromCharCode(255&H,H>>8&255,H>>16&255,H>>24&255))])}var H;const P=n._ExtractLongWordOrder(f[23]),O=n._ExtractLongWordOrder(f[24]),E=n._ExtractLongWordOrder(f[25]),a=n._ExtractLongWordOrder(f[26]);W&&(o=R._getRGBABufferInternalSizedFormat(B.textureType)),I=1,f[2]&z&&!1!==Z&&(I=Math.max(1,f[7]));const g=r||0,Q=R.getCaps();for(let N=g;N<Y;N++){for(T=f[4],t=f[3],K=0;K<I;++K){if(-1===F||F===K){const h=-1===F?K:0;if(!B.isCompressed&&B.isFourCC){q.format=5,m=T*t*4;let B=null;if(R._badOS||R._badDesktopOS||!Q.textureHalfFloat&&!Q.textureFloat)128===G?(B=n._GetFloatAsUIntRGBAArrayBuffer(T,t,L.byteOffset+D,m,L.buffer,h),c&&0==h&&c.push(n._GetFloatRGBAArrayBuffer(T,t,L.byteOffset+D,m,L.buffer,h))):64===G&&(B=n._GetHalfFloatAsUIntRGBAArrayBuffer(T,t,L.byteOffset+D,m,L.buffer,h),c&&0==h&&c.push(n._GetHalfFloatAsFloatRGBAArrayBuffer(T,t,L.byteOffset+D,m,L.buffer,h))),q.type=0;else{const R=Q.textureFloat&&(p&&Q.textureFloatLinearFiltering||!p),N=Q.textureHalfFloat&&(p&&Q.textureHalfFloatLinearFiltering||!p),Z=(128===G||64===G&&!N)&&R?1:(64===G||128===G&&!R)&&N?2:0;let z,Y=null;if(128===G)switch(Z){case 1:z=n._GetFloatRGBAArrayBuffer,Y=null;break;case 2:z=n._GetFloatAsHalfFloatRGBAArrayBuffer,Y=n._GetFloatRGBAArrayBuffer;break;case 0:z=n._GetFloatAsUIntRGBAArrayBuffer,Y=n._GetFloatRGBAArrayBuffer}else switch(Z){case 1:z=n._GetHalfFloatAsFloatRGBAArrayBuffer,Y=null;break;case 2:z=n._GetHalfFloatRGBAArrayBuffer,Y=n._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:z=n._GetHalfFloatAsUIntRGBAArrayBuffer,Y=n._GetHalfFloatAsFloatRGBAArrayBuffer}q.type=Z,B=z(T,t,L.byteOffset+D,m,L.buffer,h),c&&0==h&&c.push(Y?Y(T,t,L.byteOffset+D,m,L.buffer,h):B)}B&&R._uploadDataToTextureDirectly(q,B,N,h)}else if(B.isRGB)q.type=0,24===G?(q.format=4,m=T*t*3,S=n._GetRGBArrayBuffer(T,t,L.byteOffset+D,m,L.buffer,P,O,E),R._uploadDataToTextureDirectly(q,S,N,h)):(q.format=5,m=T*t*4,S=n._GetRGBAArrayBuffer(T,t,L.byteOffset+D,m,L.buffer,P,O,E,a),R._uploadDataToTextureDirectly(q,S,N,h));else if(B.isLuminance){const B=R._getUnpackAlignement(),Z=T;m=Math.floor((T+B-1)/B)*B*(t-1)+Z,S=n._GetLuminanceArrayBuffer(T,t,L.byteOffset+D,m,L.buffer),q.format=1,q.type=0,R._uploadDataToTextureDirectly(q,S,N,h)}else m=Math.max(4,T)/4*Math.max(4,t)/4*l,S=new Uint8Array(L.buffer,L.byteOffset+D,m),q.type=0,R._uploadCompressedDataToTextureDirectly(q,o,T,t,S,N,h)}D+=G?T*t*(G/8):m,T*=.5,t*=.5,T=Math.max(1,T),t=Math.max(1,t)}if(void 0!==r)break}c&&c.length>0?B.sphericalPolynomial=h.e.ConvertCubeMapToSphericalPolynomial({size:f[4],right:c[0],left:c[1],up:c[2],down:c[3],front:c[4],back:c[5],format:5,type:1,gammaSpace:!1}):B.sphericalPolynomial=void 0}}n.StoreLODInAlphaChannel=!1},11061:(R,q,L)=>{"use strict";L.d(q,{d:()=>h,h:()=>Z});const B={},N={};function h(R){const q=R.getClassName();return N[q]||(N[q]={}),N[q]}function Z(R){const q=R.getClassName();if(B[q])return B[q];B[q]={};const L=B[q];let h=R,Z=q;for(;Z;){const R=N[Z];for(const N in R)L[N]=R[N];let q,B=!1;do{if(q=Object.getPrototypeOf(h),!q.getClassName){B=!0;break}if(q.getClassName()!==Z)break;h=q}while(q);if(B)break;Z=q.getClassName(),h=q}return L}},11058:(R,q,L)=>{"use strict";L.d(q,{A:()=>z,E:()=>C,G:()=>e,K:()=>Z,c:()=>h,f:()=>d,h:()=>U,k:()=>Y,m:()=>n,n:()=>F,q:()=>r,u:()=>c,x:()=>y,z:()=>p});var B=L(11061);function N(R,q){return(L,N)=>{const h=(0,B.d)(L);h[N]||(h[N]={type:R,sourceName:q})}}function h(R){return function(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(L,B)=>{const N=q||"_"+B;Object.defineProperty(L,B,{get:function(){return this[N]},set:function(q){"function"===typeof this.equals&&this.equals(q)||this[N]!==q&&(this[N]=q,L[R].apply(this))},enumerable:!0,configurable:!0})}}(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function Z(R){return N(0,R)}function z(R){return N(1,R)}function Y(R){return N(2,R)}function F(R){return N(3,R)}function C(R){return N(4,R)}function e(R){return N(5,R)}function y(R){return N(6,R)}function U(R){return N(7,R)}function n(R){return N(8,R)}function r(R){return N(9,R)}function p(R){return N(10,R)}function c(R){return N(12,R)}function d(R,q,L,B){const N=L.value;L.value=function(){let L=N;if("undefined"!==typeof _native&&_native[q]){const R=_native[q];L=B?function(){return B(...arguments)?R(...arguments):N(...arguments)}:R}return R[q]=L,L(...arguments)}}d.filter=function(R){return(q,L,B)=>d(q,L,B,R)}},11117:(R,q,L)=>{"use strict";L.d(q,{b:()=>F});var B=L(10785),N=L(11074),h=L(11112),Z=L(11081),z=L(11061);const Y=function(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const h=R();N.b&&N.b.HasTags(q)&&N.b.AddTagsTo(h,N.b.GetTags(q,!0));const Z=(0,z.h)(h),Y={};for(const N in Z){const R=Z[N],z=q[N],C=R.type;if(void 0!==z&&null!==z&&("uniqueId"!==N||F.AllowLoadingUniqueId))switch(C){case 0:case 6:case 11:h[N]=z;break;case 1:B.cloneTexturesOnlyOnce&&Y[z.uniqueId]?h[N]=Y[z.uniqueId]:(h[N]=L||z.isRenderTarget?z:z.clone(),Y[z.uniqueId]=h[N]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:h[N]=L?z:z.clone()}}return h};class F{static AppendSerializedAnimations(R,q){if(R.animations){q.animations=[];for(let L=0;L<R.animations.length;L++){const B=R.animations[L];q.animations.push(B.serialize())}}}static Serialize(R,q){q||(q={}),N.b&&(q.tags=N.b.GetTags(R));const L=(0,z.h)(R);for(const B in L){const N=L[B],h=N.sourceName||B,Z=N.type,z=R[B];if(void 0!==z&&null!==z&&("uniqueId"!==B||F.AllowLoadingUniqueId))switch(Z){case 0:q[h]=z;break;case 1:case 3:case 7:case 9:q[h]=z.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:q[h]=z.dj();break;case 6:case 11:q[h]=z.id}}return q}static ParseProperties(R,q,L,B){B||(B="");const N=(0,z.h)(q);for(const z in N){const Y=N[z],C=R[Y.sourceName||z],e=Y.type;if(void 0!==C&&null!==C&&("uniqueId"!==z||F.AllowLoadingUniqueId)){const R=q;switch(e){case 0:R[z]=C;break;case 1:L&&(R[z]=F._TextureParser(C,L,B));break;case 2:R[z]=h.e.Ig(C);break;case 3:R[z]=F._FresnelParametersParser(C);break;case 4:R[z]=Z.i.Ig(C);break;case 5:R[z]=Z.m.Ig(C);break;case 6:L&&(R[z]=L.getLastMeshById(C));break;case 7:R[z]=F._ColorCurvesParser(C);break;case 8:R[z]=h.g.Ig(C);break;case 9:R[z]=F._ImageProcessingConfigurationParser(C);break;case 10:R[z]=Z.d.Ig(C);break;case 11:L&&(R[z]=L.getCameraById(C));break;case 12:R[z]=Z.c.Ig(C)}}}}static Parse(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=R();return N.b&&N.b.AddTagsTo(h,q.tags),F.ParseProperties(q,h,L,B),h}static Clone(R,q){return Y(R,q,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(R,q){return Y(R,q,!0)}}F.AllowLoadingUniqueId=!1,F._ImageProcessingConfigurationParser=R=>{throw(0,B.d)("ImageProcessingConfiguration")},F._FresnelParametersParser=R=>{throw(0,B.d)("FresnelParameters")},F._ColorCurvesParser=R=>{throw(0,B.d)("ColorCurves")},F._TextureParser=(R,q,L)=>{throw(0,B.d)("Texture")}},10774:(R,q,L)=>{"use strict";L.d(q,{e:()=>h});var B=L(10767);const N=(R,q,L)=>R?R.getClassName&&"Mesh"===R.getClassName()?null:!R.getClassName||"SubMesh"!==R.getClassName()&&"PhysicsBody"!==R.getClassName()?R.clone?R.clone():Array.isArray(R)?R.slice():L&&"object"===typeof R?{...R}:null:R.clone(q):null;class h{static DeepCopy(R,q,L,h){let Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=function(R){const q=[];do{Object.getOwnPropertyNames(R).forEach((function(R){-1===q.indexOf(R)&&q.push(R)}))}while(R=Object.getPrototypeOf(R));return q}(R);for(const F of z){if("_"===F[0]&&(!h||-1===h.indexOf(F)))continue;if(F.endsWith("Observable"))continue;if(L&&-1!==L.indexOf(F))continue;const z=R[F],C=typeof z;if("function"!==C)try{if("object"===C)if(z instanceof Uint8Array)q[F]=Uint8Array.from(z);else if(z instanceof Array){if(q[F]=[],z.length>0)if("object"==typeof z[0])for(let R=0;R<z.length;R++){const L=N(z[R],q,Z);-1===q[F].indexOf(L)&&q[F].push(L)}else q[F]=z.slice(0)}else q[F]=N(z,q,Z);else q[F]=z}catch(Y){B.d.Warn(Y.message)}}}}},10785:(R,q,L)=>{"use strict";L.d(q,{d:()=>N});const B={};function N(R){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!B[R])return B[R]=!0,`${R} needs to be imported before as it contains a side-effect required by your code.`}},10763:(R,q,L)=>{"use strict";function B(){return"undefined"!==typeof window}function N(){return"undefined"!==typeof navigator}function h(){return"undefined"!==typeof document}function Z(R){let q="",L=R.firstChild;for(;L;)3===L.nodeType&&(q+=L.textContent),L=L.nextSibling;return q}L.d(q,{d:()=>Z,f:()=>h,g:()=>N,i:()=>B})},12095:(R,q,L)=>{"use strict";L.r(q),L.d(q,{Dispose:()=>y,DumpData:()=>e,DumpDataAsync:()=>C,DumpFramebuffer:()=>F,DumpTools:()=>U});var B=L(11621),N=L(10757),h=L(11099),Z=L(10797);let z,Y=null;async function F(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6?arguments[6]:void 0;const z=await L.readPixels(0,0,R,q);e(R,q,new Uint8Array(z.buffer),B,N,h,!0,void 0,Z)}function C(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return new Promise((Y=>{e(R,q,L,(R=>Y(R)),B,N,h,Z,z)}))}function e(R,q,F,C){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8?arguments[8]:void 0;(async function(){return Y||(Y=new Promise(((R,q)=>{let N,h=null;const Y={fh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(L.bind(L,11495)).then((F=>{let{ThinEngine:C}=F;try{N=new OffscreenCanvas(100,100),h=new C(N,!1,Y)}catch(U){N=document.createElement("canvas"),h=new C(N,!1,Y)}Z.b.Instances.pop(),Z.b.OnEnginesDisposedObservable.add((R=>{h&&R!==h&&!h.u&&0===Z.b.Instances.length&&y()})),h.getCaps().parallelShaderCompile=void 0;const e=new B.c(h);L.e(34).then(L.bind(L,13242)).then((L=>{let{passPixelShader:Z}=L;if(!h)return void q("Engine is not defined");const Y=new B.d({hd:h,name:Z.name,fragmentShader:Z.shader,samplerNames:["textureSampler"]});z={canvas:N,hd:h,renderer:e,wrapper:Y},R(z)}))})).catch(q)}))),await Y})().then((L=>{if(L.hd.setSize(R,q,!0),F instanceof Float32Array){const R=new Uint8Array(F.length);let q=F.length;for(;q--;){const L=F[q];R[q]=Math.round(255*(0,h.b)(L))}F=R}const B=L.hd.createRawTexture(F,R,q,5,!1,!n,1);L.renderer.setViewport(),L.renderer.applyEffectWrapper(L.wrapper),L.wrapper.effect._bindTexture("textureSampler",B),L.renderer.draw(),r?N.f.ToBlob(L.canvas,(R=>{const q=new FileReader;q.onload=R=>{const q=R.target.result;C&&C(q)},q.readAsArrayBuffer(R)}),e,p):N.f.EncodeScreenshotCanvasData(L.canvas,C,e,U,p),B.dispose()}))}function y(){var R;z?(z.wrapper.dispose(),z.renderer.dispose(),z.hd.dispose()):null===(R=Y)||void 0===R||R.then((R=>{R.wrapper.dispose(),R.renderer.dispose(),R.hd.dispose()}));Y=null,z=null}const U={DumpData:e,DumpDataAsync:C,DumpFramebuffer:F,Dispose:y};N.f.DumpData=e,N.f.DumpDataAsync=C,N.f.DumpFramebuffer=F},12093:(R,q,L)=>{"use strict";L.d(q,{b:()=>n,e:()=>c,i:()=>v,j:()=>T});var B=L(10757),N=L(11081),h=L(11099),Z=L(11562),z=L(10867),Y=L(11283),F=(L(11071),L(11618)),C=L(10767);L(12064),L(12073),L(12095);const e="image/png",y=2,U=[134,22,135,150,246,214,150,54];function n(R){const q=new DataView(R.buffer,R.byteOffset,R.byteLength);let L=0;for(let Z=0;Z<U.length;Z++)if(q.getUint8(L++)!==U[Z])return C.d.Error("Not a babylon environment map"),null;let B="",N=0;for(;N=q.getUint8(L++);)B+=String.fromCharCode(N);let h=JSON.parse(B);return h=r(h),h.jh&&(h.jh.specularDataPosition=L,h.jh.lodGenerationScale=h.jh.lodGenerationScale||.8),h}function r(R){if(R.version>y)throw new Error(`Unsupported babylon environment map version "${R.version}". Latest supported version is "${y}".`);return 2===R.version?R:R={...R,version:2,imageType:e}}function p(R,q){const L=(q=r(q)).jh;let B=Math.log2(q.width);if(B=Math.round(B)+1,L.mipmaps.length!==6*B)throw new Error(`Unsupported specular mipmaps number "${L.mipmaps.length}"`);const N=new Array(B);for(let h=0;h<B;h++){N[h]=new Array(6);for(let q=0;q<6;q++){const B=L.mipmaps[6*h+q];N[h][q]=new Uint8Array(R.buffer,R.byteOffset+L.specularDataPosition+B.position,B.length)}}return N}function c(R,q,L){const B=(L=r(L)).jh;if(!B)return Promise.resolve();R._lodGenerationScale=B.lodGenerationScale;return f(R,p(q,L),L.imageType)}function d(R,q,L,B,N,h,Z,z,Y,F,C){return new Promise(((e,y)=>{if(L){const L=q.createTexture(null,!0,!0,null,1,null,(R=>{y(R)}),R);null===B||void 0===B||B.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled((()=>{B.externalTextureSamplerBinding=!0,B.onApply=B=>{B._bindTexture("textureSampler",L),B.setFloat2("scale",1,q._features.needsInvertingBitmap&&R instanceof ImageBitmap?-1:1)},q.scenes.length&&(q.scenes[0].postProcessManager.directRender([B],F,!0,h,Z),q.restoreDefaultFramebuffer(),L.dispose(),URL.revokeObjectURL(N),e())}))}))}else{if(q._uploadImageToTexture(C,R,h,Z),z){const L=Y[Z];L&&q._uploadImageToTexture(L._texture,R,h,0)}e()}}))}async function f(R,q){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(!B.f.IsExponentOfTwo(R.width))throw new Error("Texture size must be a power of two");const Z=(0,h.g)(R.width)+1,C=R.getEngine();let y=!1,U=!1,n=null,r=null,p=null;const c=C.getCaps();R.format=5,R.type=0,R.generateMipMaps=!0,R._cachedAnisotropicFilteringLevel=null,C.updateTextureSamplingMode(3,R),c.textureLOD?C._features.supportRenderAndCopyToLodForFloatTextures?c.textureHalfFloatRender&&c.textureHalfFloatLinearFiltering?(y=!0,R.type=2):c.textureFloatRender&&c.textureFloatLinearFiltering&&(y=!0,R.type=1):y=!1:(y=!1,U=!0,p={});let f=0;if(y)C.isWebGPU?(f=1,await L.e(39).then(L.bind(L,13266))):await L.e(41).then(L.bind(L,13278)),n=new F.e("rgbdDecode","rgbdDecode",null,null,1,null,3,C,!1,void 0,R.type,void 0,null,!1,void 0,f),R._isRGBD=!1,R.invertY=!1,r=C.createRenderTargetCubeTexture(R.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:R.type,format:5});else if(R._isRGBD=!0,R.invertY=!0,U){const q=3,L=R._lodGenerationScale,B=R._lodGenerationOffset;for(let N=0;N<q;N++){const h=(Z-1)*L+B,F=B+(h-B)*(1-N/(q-1)),e=Math.round(Math.min(Math.max(F,0),h)),y=new z.b(C,2);y.isCube=!0,y.invertY=!0,y.generateMipMaps=!1,C.updateTextureSamplingMode(2,y);const U=new Y.d(null);switch(U._isCube=!0,U._texture=y,p[e]=U,N){case 0:R._lodTextureLow=U;break;case 1:R._lodTextureMid=U;break;case 2:R._lodTextureHigh=U}}}const v=[];for(let L=0;L<q.length;L++)for(let B=0;B<6;B++){const h=q[L][B],Z=new Blob([h],{type:N}),z=URL.createObjectURL(Z);let Y;if(C._features.forceBitmapOverHTMLImageElement)Y=C.createImageBitmap(Z,{premultiplyAlpha:"none"}).then((q=>d(q,C,y,n,z,B,L,U,p,r,R)));else{const q=new Image;q.src=z,Y=new Promise(((N,h)=>{q.onload=()=>{d(q,C,y,n,z,B,L,U,p,r,R).then((()=>N())).catch((R=>{h(R)}))},q.onerror=R=>{h(R)}}))}v.push(Y)}if(q.length<Z){let L;const B=Math.pow(2,Z-1-q.length),N=B*B*4;switch(R.type){case 0:L=new Uint8Array(N);break;case 2:L=new Uint16Array(N);break;case 1:L=new Float32Array(N)}for(let h=q.length;h<Z;h++)for(let q=0;q<6;q++)C._uploadArrayBufferViewToTexture(R,L,q,h)}return Promise.all(v).then((()=>{r&&(C._releaseTexture(R),r._swapAndDie(R)),n&&n.dispose(),U&&(R._lodTextureHigh&&R._lodTextureHigh._texture&&(R._lodTextureHigh._texture.isReady=!0),R._lodTextureMid&&R._lodTextureMid._texture&&(R._lodTextureMid._texture.isReady=!0),R._lodTextureLow&&R._lodTextureLow._texture&&(R._lodTextureLow._texture.isReady=!0))}))}function v(R,q){const L=(q=r(q)).irradiance;if(!L)return;const B=new Z.d;N.m.FromArrayToRef(L.x,0,B.x),N.m.FromArrayToRef(L.y,0,B.y),N.m.FromArrayToRef(L.z,0,B.z),N.m.FromArrayToRef(L.xx,0,B.xx),N.m.FromArrayToRef(L.yy,0,B.yy),N.m.FromArrayToRef(L.zz,0,B.zz),N.m.FromArrayToRef(L.yz,0,B.yz),N.m.FromArrayToRef(L.zx,0,B.zx),N.m.FromArrayToRef(L.xy,0,B.xy),R._sphericalPolynomial=B}function T(R,q,L,B,N){const h=f(R.getEngine().createRawCubeTexture(null,R.width,R.format,R.type,R.generateMipMaps,R.invertY,R.samplingMode,R._compression),q).then((()=>R));return R.onRebuildCallback=R=>({proxy:h,isReady:!0,isAsync:!0}),R._source=13,R._bufferViewArrayArray=q,R._lodGenerationScale=B,R._lodGenerationOffset=N,R._sphericalPolynomial=L,f(R,q).then((()=>(R.isReady=!0,R)))}},10808:(R,q,L)=>{"use strict";L.d(q,{b:()=>B,e:()=>N,i:()=>h});class B extends Error{}B._setPrototypeOf=Object.setPrototypeOf||((R,q)=>(R.__proto__=q,R));const N={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class h extends B{constructor(R,q,L){super(R),this.errorCode=q,this.innerError=L,this.name="RuntimeError",B._setPrototypeOf(this,h.prototype)}}},10805:(R,q,L)=>{"use strict";L.d(q,{e:()=>l,i:()=>f,m:()=>m,r:()=>S,p:()=>p,u:()=>t,y:()=>D,B:()=>I,F:()=>v});var B=L(10791),N=L(10763),h=L(10760);class Z{}Z.FilesToLoad={};var z=L(10808),Y=L(10815),F=L(10821),C=L(10797),e=L(10767),y=L(10831),U=L(10829),n=L(10834);const r=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class p extends z.i{constructor(R,q){super(R,z.e.LoadFileError),this.name="LoadFileError",z.b._setPrototypeOf(this,p.prototype),q instanceof B.b?this.request=q:this.file=q}}class c extends z.i{constructor(R,q){super(R,z.e.RequestFileError),this.request=q,this.name="RequestFileError",z.b._setPrototypeOf(this,c.prototype)}}class d extends z.i{constructor(R,q){super(R,z.e.ReadFileError),this.file=q,this.name="ReadFileError",z.b._setPrototypeOf(this,d.prototype)}}const f={DefaultRetryStrategy:class{static ExponentialBackoff(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(L,B,N)=>0!==B.status||N>=R||-1!==L.indexOf("file:")?-1:Math.pow(2,N)*q}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:R=>R,ScriptBaseUrl:"",ScriptPreprocessUrl:R=>R,CleanUrl:R=>R=R.replace(/#/gm,"%23")},v=(R,q)=>{if((!R||0!==R.indexOf("data:"))&&f.CorsBehavior)if("string"===typeof f.CorsBehavior||f.CorsBehavior instanceof String)q.crossOrigin=f.CorsBehavior;else{const L=f.CorsBehavior(R);L&&(q.crossOrigin=L)}},T={getRequiredSize:null},t=function(R,q,L,N){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",z=arguments.length>5?arguments[5]:void 0;const F=C.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===F||void 0===F||!F._features.forceBitmapOverHTMLImageElement))return L("LoadImage is only supported in web or BabylonNative environments."),null;let e,y=!1;R instanceof ArrayBuffer||ArrayBuffer.isView(R)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(e=URL.createObjectURL(new Blob([R],{type:h})),y=!0):e=`data:${h};base64,`+(0,Y.f)(R):R instanceof Blob?(e=URL.createObjectURL(R),y=!0):(e=f.CleanUrl(R),e=f.PreprocessUrl(e));const U=q=>{if(L){const B=e||R.toString();L(`Error while trying to load image: ${0===B.indexOf("http")||B.length<=128?B:B.slice(0,128)+"..."}`,q)}};if(null!==F&&void 0!==F&&F._features.forceBitmapOverHTMLImageElement)return S(e,(B=>{F.createImageBitmap(new Blob([B],{type:h}),{premultiplyAlpha:"none",...z}).then((R=>{q(R),y&&URL.revokeObjectURL(e)})).catch((q=>{L&&L("Error while trying to load image: "+R,q)}))}),void 0,N||void 0,!0,((R,q)=>{U(q)})),null;const n=new Image;if(T.getRequiredSize){const q=T.getRequiredSize(R);q.width&&(n.width=q.width),q.height&&(n.height=q.height)}v(e,n);const r=[],p=()=>{r.forEach((R=>{R.target.removeEventListener(R.name,R.handler)})),r.length=0};r.push({target:n,name:"load",handler:()=>{p(),q(n),y&&n.src&&URL.revokeObjectURL(n.src)}}),r.push({target:n,name:"error",handler:R=>{p(),U(R),y&&n.src&&URL.revokeObjectURL(n.src)}}),r.push({target:document,name:"securitypolicyviolation",handler:R=>{if(R.blockedURI!==n.src||"dm"===R.disposition)return;p();const q=new Error(`CSP violation of policy ${R.effectiveDirective} ${R.blockedURI}. Current policy is ${R.originalPolicy}`);C.b.UseFallbackTexture=!1,U(q),y&&n.src&&URL.revokeObjectURL(n.src),n.src=""}}),r.forEach((R=>{R.target.addEventListener(R.name,R.handler)}));const c="blob:"===e.substring(0,5),d="data:"===e.substring(0,5),t=()=>{c||d||!B.b.IsCustomRequestAvailable?n.src=e:S(e,((R,q,L)=>{const B=new Blob([R],{type:!h&&L?L:h}),N=URL.createObjectURL(B);y=!0,n.src=N}),void 0,N||void 0,!0,((R,q)=>{U(q)}))},D=()=>{N&&N.loadImage(e,n)};if(!c&&!d&&N&&N.enableTexturesOffline)N.open(D,t);else{if(-1!==e.indexOf("file:")){const R=decodeURIComponent(e.substring(5).toLowerCase());if(Z.FilesToLoad[R]&&"undefined"!==typeof URL){try{let q;try{q=URL.createObjectURL(Z.FilesToLoad[R])}catch(I){q=URL.createObjectURL(Z.FilesToLoad[R])}n.src=q,y=!0}catch(K){n.src=""}return n}}t()}return n},D=(R,q,L,B,N)=>{const Z=new FileReader,z={onCompleteObservable:new h.b,abort:()=>Z.abort()};return Z.onloadend=()=>z.onCompleteObservable.notifyObservers(z),N&&(Z.onerror=()=>{N(new d(`Unable to read ${R.name}`,R))}),Z.onload=R=>{q(R.target.result)},L&&(Z.onprogress=L),B?Z.readAsArrayBuffer(R):Z.readAsText(R),z},S=(R,q,L,B,N,Y,F)=>{if(R.name)return D(R,q,L,N,Y?R=>{Y(void 0,R)}:void 0);const C=R;if(-1!==C.indexOf("file:")){let R=decodeURIComponent(C.substring(5).toLowerCase());0===R.indexOf("./")&&(R=R.substring(2));const B=Z.FilesToLoad[R];if(B)return D(B,q,L,N,Y?R=>Y(void 0,new p(R.message,R.file)):void 0)}const{match:U,type:n}=o(C);if(U){const R={onCompleteObservable:new h.b,abort:()=>()=>{}};try{const R=N?l(C):G(C);q(R,void 0,n)}catch(z){Y?Y(void 0,z):e.d.Error(z.message||"Failed to parse the Data URL")}return y.e.SetImmediate((()=>{R.onCompleteObservable.notifyObservers(R)})),R}return I(C,((R,L)=>{q(R,null===L||void 0===L?void 0:L.responseURL,null===L||void 0===L?void 0:L.getResponseHeader("content-type"))}),L,B,N,Y?R=>{Y(R.request,new p(R.message,R.request))}:void 0,F)},I=(R,q,L,Z,z,Y,F)=>{R=f.CleanUrl(R),R=f.PreprocessUrl(R);const C=f.BaseUrl+R;let y=!1;const U={onCompleteObservable:new h.b,abort:()=>y=!0},n=()=>{let R,h=new B.b,Z=null;const n=()=>{h&&(L&&h.removeEventListener("progress",L),R&&h.removeEventListener("readystatechange",R),h.removeEventListener("loadend",r))};let r=()=>{n(),U.onCompleteObservable.notifyObservers(U),U.onCompleteObservable.clear(),L=void 0,R=null,r=null,Y=void 0,F=void 0,q=void 0};U.abort=()=>{y=!0,r&&r(),h&&h.readyState!==(XMLHttpRequest.DONE||4)&&h.abort(),null!==Z&&(clearTimeout(Z),Z=null),h=null};const p=R=>{const q=R.message||"Unknown error";Y&&h?Y(new c(q,h)):e.d.Error(q)},d=e=>{if(h){if(h.open("GET",C),F)try{F(h)}catch(U){return void p(U)}z&&(h.responseType="arraybuffer"),L&&h.addEventListener("progress",L),r&&h.addEventListener("loadend",r),R=()=>{if(!y&&h&&h.readyState===(XMLHttpRequest.DONE||4)){if(R&&h.removeEventListener("readystatechange",R),h.status>=200&&h.status<300||0===h.status&&(!(0,N.i)()||K())){try{q&&q(z?h.response:h.responseText,h)}catch(U){p(U)}return}const L=f.DefaultRetryStrategy;if(L){const R=L(C,h,e);if(-1!==R)return n(),h=new B.b,void(Z=setTimeout((()=>d(e+1)),R))}const F=new c("Error status: "+h.status+" "+h.statusText+" - Unable to load "+C,h);Y&&Y(F)}},h.addEventListener("readystatechange",R),h.send()}};d(0)};if(Z&&Z.enableSceneOffline){const B=R=>{R&&R.status>400?Y&&Y(R):n()},N=()=>{Z&&Z.loadFile(f.BaseUrl+R,(R=>{!y&&q&&q(R),U.onCompleteObservable.notifyObservers(U)}),L?R=>{!y&&L&&L(R)}:void 0,B,z)};Z.open(N,B)}else n();return U},K=()=>"undefined"!==typeof location&&"file:"===location.protocol,m=R=>r.test(R),o=R=>{const q=r.exec(R);if(null===q||0===q.length)return{match:!1,type:""};return{match:!0,type:q[0].replace("data:","").replace("base64,","")}};function l(R){return(0,Y.b)(R.split(",")[1])}const G=R=>(0,Y.c)(R.split(",")[1]);let W;n.e._FileToolsLoadImage=t,U.e.loadFile=S,F.n.loadFile=S;((R,q,L,B,N,h,Z,z,Y,F)=>{W={DecodeBase64UrlToBinary:R,DecodeBase64UrlToString:q,DefaultRetryStrategy:L.DefaultRetryStrategy,BaseUrl:L.BaseUrl,CorsBehavior:L.CorsBehavior,PreprocessUrl:L.PreprocessUrl,IsBase64DataUrl:B,IsFileURL:N,LoadFile:h,LoadImage:Z,ReadFile:z,RequestFile:Y,SetCorsBehavior:F},Object.defineProperty(W,"DefaultRetryStrategy",{get:function(){return L.DefaultRetryStrategy},set:function(R){L.DefaultRetryStrategy=R}}),Object.defineProperty(W,"BaseUrl",{get:function(){return L.BaseUrl},set:function(R){L.BaseUrl=R}}),Object.defineProperty(W,"PreprocessUrl",{get:function(){return L.PreprocessUrl},set:function(R){L.PreprocessUrl=R}}),Object.defineProperty(W,"CorsBehavior",{get:function(){return L.CorsBehavior},set:function(R){L.CorsBehavior=R}})})(l,G,f,m,K,S,t,D,I,v)},10898:(R,q,L)=>{"use strict";function B(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(R=>{const q=16*Math.random()|0;return("x"===R?q:3&q|8).toString(16)}))}L.d(q,{e:()=>B})},10883:(R,q,L)=>{"use strict";L.d(q,{e:()=>h});var B=L(10767),N=L(10889);class h{static Instantiate(R){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[R])return this.RegisteredExternalClasses[R];const q=(0,N.d)(R);if(q)return q;B.d.Warn(R+" not found, you may have missed an import.");const L=R.split(".");let h=window||this;for(let B=0,N=L.length;B<N;B++)h=h[L[B]];return"function"!==typeof h?null:h}}h.RegisteredExternalClasses={}},10767:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});class B{static _CheckLimit(R,q){let L=B._LogLimitOutputs[R];return L?L.current++:(L={limit:q,current:1},B._LogLimitOutputs[R]=L),L.current<=L.limit}static _GenerateLimitMessage(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const L=B._LogLimitOutputs[R];if(!L||!B.MessageLimitReached)return;const N=this._Levels[q];L.current===L.limit&&B[N.name](B.MessageLimitReached.replace(/%LIMIT%/g,""+L.limit).replace(/%TYPE%/g,N.name??""))}static _AddLogEntry(R){B._LogCache=R+B._LogCache,B.OnNewCacheEntry&&B.OnNewCacheEntry(R)}static _FormatMessage(R){const q=R=>R<10?"0"+R:""+R,L=new Date;return"["+q(L.getHours())+":"+q(L.getMinutes())+":"+q(L.getSeconds())+"]: "+R}static _LogDisabled(R,q){}static _LogEnabled(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const N=Array.isArray(q)?q[0]:q;if(void 0!==L&&!B._CheckLimit(N,L))return;const h=B._FormatMessage(N),Z=this._Levels[R],z=Array.isArray(q)?q.slice(1):[];Z.logFunc&&Z.logFunc("BJS - "+h,...z);const Y=`<div style='color:${Z.color}'>${h}</div><br>`;B._AddLogEntry(Y),B._GenerateLimitMessage(N,R)}static get LogCache(){return B._LogCache}static ClearLogCache(){B._LogCache="",B._LogLimitOutputs={},B.errorsCount=0}static set LogLevels(R){B.Log=B._LogDisabled,B.Warn=B._LogDisabled,B.Error=B._LogDisabled,[B.MessageLogLevel,B.WarningLogLevel,B.ErrorLogLevel].forEach((q=>{if((R&q)===q){const R=this._Levels[q];B[R.name]=B._LogEnabled.bind(B,q)}}))}}B.NoneLogLevel=0,B.MessageLogLevel=1,B.WarningLogLevel=2,B.ErrorLogLevel=4,B.AllLogLevel=7,B.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",B._LogCache="",B._LogLimitOutputs={},B._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],B.errorsCount=0,B.Log=B._LogEnabled.bind(B,B.MessageLogLevel),B.Warn=B._LogEnabled.bind(B,B.WarningLogLevel),B.Error=B._LogEnabled.bind(B,B.ErrorLogLevel)},10760:(R,q,L)=>{"use strict";L.d(q,{b:()=>h});class B{constructor(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.initialize(R,q,L,B)}initialize(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;return this.mask=R,this.skipNextObservers=q,this.target=L,this.currentTarget=B,this}}class N{constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=R,this.mask=q,this.scope=L,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class h{static FromPromise(R,q){const L=new h;return R.then((R=>{L.notifyObservers(R)})).catch((R=>{if(!q)throw R;q.notifyObservers(R)})),L}get observers(){return this._observers}constructor(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=q,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new B(0),R&&(this._onObserverAdded=R)}add(R){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!R)return null;const B=new N(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return B.unregisterOnNextCall=L,q?this._observers.unshift(B):this._observers.push(B),this._onObserverAdded&&this._onObserverAdded(B),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(B,this._lastNotifiedValue),B._remove=()=>{this.remove(B)},B}addOnce(R){return this.add(R,void 0,void 0,void 0,!0)}remove(R){if(!R)return!1;R._remove=null;return-1!==this._observers.indexOf(R)&&(this._deferUnregister(R),!0)}removeCallback(R,q){for(let L=0;L<this._observers.length;L++){const B=this._observers[L];if(!B._willBeUnregistered&&(B.callback===R&&(!q||q===B.scope)))return this._deferUnregister(B),!0}return!1}_deferUnregister(R){R._willBeUnregistered||(this._numObserversMarkedAsDeleted++,R.unregisterOnNextCall=!1,R._willBeUnregistered=!0,setTimeout((()=>{this._remove(R)}),0))}_remove(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!R)return!1;const L=this._observers.indexOf(R);return-1!==L&&(q&&this._numObserversMarkedAsDeleted--,this._observers.splice(L,1),!0)}makeObserverTopPriority(R){this._remove(R,!1),this._observers.unshift(R)}makeObserverBottomPriority(R){this._remove(R,!1),this._observers.push(R)}notifyObservers(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=R),!this._observers.length)return!0;const h=this._eventState;h.mask=q,h.target=L,h.currentTarget=B,h.skipNextObservers=!1,h.lastReturnValue=R,h.userInfo=N;for(const Z of this._observers)if(!Z._willBeUnregistered&&(Z.mask&q&&(Z.unregisterOnNextCall&&this._deferUnregister(Z),Z.scope?h.lastReturnValue=Z.callback.apply(Z.scope,[R,h]):h.lastReturnValue=Z.callback(R,h)),h.skipNextObservers))return!1;return!0}notifyObserver(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=q),R._willBeUnregistered)return;const B=this._eventState;B.mask=L,B.skipNextObservers=!1,R.unregisterOnNextCall&&this._deferUnregister(R),R.callback(q,B)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const R=this._observers.pop();R&&(R._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const R=new h;return R._observers=this._observers.slice(0),R}hasSpecificMask(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const q of this._observers)if(q.mask&R||q.mask===R)return!0;return!1}}},10909:(R,q,L)=>{"use strict";L.d(q,{d:()=>N});var B=L(10778);class N{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(R,q){N.Enabled&&(this._current+=R,q&&this._fetchResult())}beginMonitoring(){N.Enabled&&(this._startMonitoringTime=B.c.Now)}endMonitoring(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!N.Enabled)return;R&&this.fetchNewFrame();const q=B.c.Now;this._current=q-this._startMonitoringTime,R&&this._fetchResult()}aj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const R=B.c.Now;R-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=R,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}N.Enabled=!0},10778:(R,q,L)=>{"use strict";L.d(q,{c:()=>N});var B=L(10763);class N{static get Now(){return(0,B.i)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12064:(R,q,L)=>{"use strict";L.d(q,{e:()=>h});var B=L(11618),N=L(11604);class h{static ExpandRGBDTexture(R){const q=R._texture;if(!q||!R.isRGBD)return;const N=q.getEngine(),h=N.getCaps(),Z=q.isReady;let z=!1;h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(z=!0,q.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(z=!0,q.type=1),z&&(q.isReady=!1,q._isRGBD=!1,q.invertY=!1);const Y=async()=>{const h=N.isWebGPU,Z=h?1:0;q.isReady=!1,h?await Promise.all([L.e(39).then(L.bind(L,13266)),L.e(40).then(L.bind(L,13269))]):await Promise.all([L.e(41).then(L.bind(L,13278)),L.e(42).then(L.bind(L,13282))]);const z=new B.e("rgbdDecode","rgbdDecode",null,null,1,null,3,N,!1,void 0,q.type,void 0,null,!1,void 0,Z);z.externalTextureSamplerBinding=!0;const Y=N.createRenderTargetTexture(q.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:q.samplingMode,type:q.type,format:5});z.onEffectCreatedObservable.addOnce((L=>{L.executeWhenCompiled((()=>{z.onApply=R=>{R._bindTexture("textureSampler",q),R.setFloat2("scale",1,1)},R.va().postProcessManager.directRender([z],Y,!0),N.restoreDefaultFramebuffer(),N._releaseTexture(q),z&&z.dispose(),Y._swapAndDie(q),q.isReady=!0}))}))};z&&(Z?Y():R.onLoadObservable.addOnce(Y))}static EncodeTextureToRGBD(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,N.c)("rgbdEncode",R,q,L,1,5)}}},11065:(R,q,L)=>{"use strict";L.d(q,{d:()=>N,h:()=>B});class B{constructor(R){this.length=0,this.data=new Array(R),this._id=B._GlobalId++}push(R){this.data[this.length++]=R,this.length>this.data.length&&(this.data.length*=2)}forEach(R){for(let q=0;q<this.length;q++)R(this.data[q])}sort(R){this.data.sort(R)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(R){if(0!==R.length){this.length+R.length>this.data.length&&(this.data.length=2*(this.length+R.length));for(let q=0;q<R.length;q++)this.data[this.length++]=(R.data||R)[q]}}indexOf(R){const q=this.data.indexOf(R);return q>=this.length?-1:q}contains(R){return-1!==this.indexOf(R)}}B._GlobalId=0;class N extends B{constructor(){super(...arguments),this._duplicateId=0}push(R){super.push(R),R.__smartArrayFlags||(R.__smartArrayFlags={}),R.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(R){return(!R.__smartArrayFlags||R.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(R),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(R){if(0!==R.length){this.length+R.length>this.data.length&&(this.data.length=2*(this.length+R.length));for(let q=0;q<R.length;q++){const L=(R.data||R)[q];this.pushNoDuplicate(L)}}}}},10815:(R,q,L)=>{"use strict";L.d(q,{b:()=>Z,c:()=>h,d:()=>B,f:()=>N});const B=R=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(R);let q="";for(let L=0;L<R.byteLength;L++)q+=String.fromCharCode(R[L]);return q},N=R=>{const q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let L,B,N,h,Z,z,Y,F="",C=0;const e=ArrayBuffer.isView(R)?new Uint8Array(R.buffer,R.byteOffset,R.byteLength):new Uint8Array(R);for(;C<e.length;)L=e[C++],B=C<e.length?e[C++]:Number.NaN,N=C<e.length?e[C++]:Number.NaN,h=L>>2,Z=(3&L)<<4|B>>4,z=(15&B)<<2|N>>6,Y=63&N,isNaN(B)?z=Y=64:isNaN(N)&&(Y=64),F+=q.charAt(h)+q.charAt(Z)+q.charAt(z)+q.charAt(Y);return F},h=R=>atob(R),Z=R=>{const q=h(R),L=q.length,B=new Uint8Array(new ArrayBuffer(L));for(let N=0;N<L;N++)B[N]=q.charCodeAt(N);return B.buffer}},11074:(R,q,L)=>{"use strict";L.d(q,{b:()=>N});class B{static Eval(R,q){return"true"===(R=R.match(/\([^()]*\)/g)?R.replace(/\([^()]*\)/g,(R=>(R=R.slice(1,R.length-1),B._HandleParenthesisContent(R,q)))):B._HandleParenthesisContent(R,q))||"false"!==R&&B.Eval(R,q)}static _HandleParenthesisContent(R,q){let L;q=q||(R=>"true"===R);const N=R.split("||");for(const h in N)if(Object.prototype.hasOwnProperty.call(N,h)){let R=B._SimplifyNegation(N[h].trim());const Z=R.split("&&");if(Z.length>1)for(let N=0;N<Z.length;++N){const h=B._SimplifyNegation(Z[N].trim());if(L="true"!==h&&"false"!==h?"!"===h[0]?!q(h.substring(1)):q(h):"true"===h,!L){R="false";break}}if(L||"true"===R){L=!0;break}L="true"!==R&&"false"!==R?"!"===R[0]?!q(R.substring(1)):q(R):"true"===R}return L?"true":"false"}static _SimplifyNegation(R){return"!true"===(R=(R=R.replace(/^[\s!]+/,(R=>(R=R.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?R="false":"!false"===R&&(R="true"),R}}class N{static EnableFor(R){R._tags=R._tags||{},R.hasTags=()=>N.HasTags(R),R.addTags=q=>N.AddTagsTo(R,q),R.removeTags=q=>N.RemoveTagsFrom(R,q),R.matchesTagsQuery=q=>N.MatchesQuery(R,q)}static DisableFor(R){delete R._tags,delete R.hasTags,delete R.addTags,delete R.removeTags,delete R.matchesTagsQuery}static HasTags(R){if(!R._tags)return!1;const q=R._tags;for(const L in q)if(Object.prototype.hasOwnProperty.call(q,L))return!0;return!1}static GetTags(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!R._tags)return null;if(q){const q=[];for(const L in R._tags)Object.prototype.hasOwnProperty.call(R._tags,L)&&!0===R._tags[L]&&q.push(L);return q.join(" ")}return R._tags}static AddTagsTo(R,q){if(!q)return;if("string"!==typeof q)return;q.split(" ").forEach((function(q){N._AddTagTo(R,q)}))}static _AddTagTo(R,q){""!==(q=q.trim())&&"true"!==q&&"false"!==q&&(q.match(/[\s]/)||q.match(/^([!]|([|]|[&]){2})/)||(N.EnableFor(R),R._tags[q]=!0))}static RemoveTagsFrom(R,q){if(!N.HasTags(R))return;const L=q.split(" ");for(const B in L)N._RemoveTagFrom(R,L[B])}static _RemoveTagFrom(R,q){delete R._tags[q]}static MatchesQuery(R,q){return void 0===q||(""===q?N.HasTags(R):B.Eval(q,(q=>N.HasTags(R)&&R._tags[q])))}}},11604:(R,q,L)=>{"use strict";L.d(q,{c:()=>Y,d:()=>y,g:()=>e});L(11277),L(11612);var B=L(11618),N=L(10834),h=L(10889),Z=L(11117);class z extends B.e{getClassName(){return"PassPostProcess"}constructor(R,q){super(R,"pass",null,null,q,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(R,q){R?(this._webGPUReady=!0,q.push(Promise.all([L.e(33).then(L.bind(L,13238))]))):q.push(Promise.all([L.e(34).then(L.bind(L,13242))])),super._gatherImports(R,q)}static _Parse(R,q,L,B){return Z.b.Parse((()=>new z(R.name,R.options,q,R.renderTargetSamplingMode,R._engine,R.reusable)),R,L,B)}}(0,h.f)("BABYLON.PassPostProcess",z);B.e;function Y(R,q,L,N,h,Z,z,Y){const F=q.getEngine();return q.isReady=!1,h=h??q.samplingMode,N=N??q.type,Z=Z??q.format,z=z??q.width,Y=Y??q.height,-1===N&&(N=0),new Promise((C=>{const e=new B.e("postprocess",R,null,null,1,null,h,F,!1,void 0,N,void 0,null,!1,Z);e.externalTextureSamplerBinding=!0;const y=F.createRenderTargetTexture({width:z,height:Y},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:h,type:N,format:Z});e.onEffectCreatedObservable.addOnce((R=>{R.executeWhenCompiled((()=>{e.onApply=R=>{R._bindTexture("textureSampler",q),R.setFloat2("scale",1,1)},L.postProcessManager.directRender([e],y,!0),F.restoreDefaultFramebuffer(),F._releaseTexture(q),e&&e.dispose(),y._swapAndDie(q),q.type=N,q.format=5,q.isReady=!0,C(q)}))}))}))}let F,C;function e(R){F||(F=new Float32Array(1),C=new Int32Array(F.buffer)),F[0]=R;const q=C[0];let L=q>>16&32768,B=q>>12&2047;const N=q>>23&255;return N<103?L:N>142?(L|=31744,L|=(255==N?0:1)&&8388607&q,L):N<113?(B|=2048,L|=(B>>114-N)+(B>>113-N&1),L):(L|=N-112<<10|B>>1,L+=1&B,L)}function y(R){const q=(32768&R)>>15,L=(31744&R)>>10,B=1023&R;return 0===L?(q?-1:1)*Math.pow(2,-14)*(B/Math.pow(2,10)):31==L?B?NaN:1/0*(q?-1:1):(q?-1:1)*Math.pow(2,L-15)*(1+B/Math.pow(2,10))}N.e._RescalePostProcessFactory=R=>new z("rescale",1,null,2,R,!1,0)},10831:(R,q,L)=>{"use strict";L.d(q,{e:()=>N});var B=L(10763);class N{static SetImmediate(R){(0,B.i)()&&window.setImmediate?window.setImmediate(R):setTimeout(R,1)}}},10900:(R,q,L)=>{"use strict";function B(R){let q=1;do{q*=2}while(q<R);return q===R}function N(R,q,L){return R*(1-L)+q*L}function h(R){const q=Z(R),L=z(R);return q-R>R-L?L:q}function Z(R){return R--,R|=R>>1,R|=R>>2,R|=R>>4,R|=R>>8,R|=R>>16,++R}function z(R){return R|=R>>1,R|=R>>2,R|=R>>4,R|=R>>8,(R|=R>>16)-(R>>1)}function Y(R,q){let L;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:L=z(R);break;case 2:L=h(R);break;default:L=Z(R)}return Math.min(L,q)}L.d(q,{c:()=>z,e:()=>Y,f:()=>B,i:()=>N,m:()=>h})},10757:(R,q,L)=>{"use strict";L.d(q,{e:()=>c,f:()=>p});var B=L(10760),N=L(10763),h=L(10767),Z=L(10774),z=L(10778),Y=L(10785),F=L(10791),C=L(10797),e=L(10805),y=L(10831),U=L(10883),n=L(10898),r=L(10900);class p{static get BaseUrl(){return e.i.BaseUrl}static set BaseUrl(R){e.i.BaseUrl=R}static get CleanUrl(){return e.i.CleanUrl}static set CleanUrl(R){e.i.CleanUrl=R}static IsAbsoluteUrl(R){return 0===R.indexOf("//")||-1!==R.indexOf("://")&&(-1!==R.indexOf(".")&&(-1!==R.indexOf("/")&&(!(R.indexOf(":")>R.indexOf("/"))&&(R.indexOf("://")<R.indexOf(".")||(0===R.indexOf("data:")||0===R.indexOf("blob:"))))))}static set ScriptBaseUrl(R){e.i.ScriptBaseUrl=R}static get ScriptBaseUrl(){return e.i.ScriptBaseUrl}static set ScriptPreprocessUrl(R){e.i.ScriptPreprocessUrl=R}static get ScriptPreprocessUrl(){return e.i.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return e.i.DefaultRetryStrategy}static set DefaultRetryStrategy(R){e.i.DefaultRetryStrategy=R}static get CorsBehavior(){return e.i.CorsBehavior}static set CorsBehavior(R){e.i.CorsBehavior=R}static get UseFallbackTexture(){return C.b.UseFallbackTexture}static set UseFallbackTexture(R){C.b.UseFallbackTexture=R}static get RegisteredExternalClasses(){return U.e.RegisteredExternalClasses}static set RegisteredExternalClasses(R){U.e.RegisteredExternalClasses=R}static get fallbackTexture(){return C.b.FallbackTexture}static set fallbackTexture(R){C.b.FallbackTexture=R}static FetchToRef(R,q,L,B,N,h){const Z=4*((Math.abs(R)*L%L|0)+(Math.abs(q)*B%B|0)*L);h.r=N[Z]/255,h.g=N[Z+1]/255,h.b=N[Z+2]/255,h.a=N[Z+3]/255}static Mix(R,q,L){return 0}static Instantiate(R){return U.e.Instantiate(R)}static SetImmediate(R){y.e.SetImmediate(R)}static IsExponentOfTwo(R){return!0}static FloatRound(R){return Math.fround(R)}static GetFilename(R){const q=R.lastIndexOf("/");return q<0?R:R.substring(q+1)}static GetFolderPath(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=R.lastIndexOf("/");return L<0?q?R:"":R.substring(0,L+1)}static ToDegrees(R){return 180*R/Math.PI}static ToRadians(R){return R*Math.PI/180}static SmoothAngleChange(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const B=this.ToRadians(R),N=this.ToRadians(q);return this.ToDegrees(Math.atan2((1-L)*Math.sin(N)+L*Math.sin(B),(1-L)*Math.cos(N)+L*Math.cos(B)))}static MakeArray(R,q){return!0===q||void 0!==R&&null!=R?Array.isArray(R)?R:[R]:null}static GetPointerPrefix(R){return(0,N.i)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(R,q){(0,e.F)(R,q)}static SetReferrerPolicyBehavior(R,q){q.referrerPolicy=R}static get PreprocessUrl(){return e.i.PreprocessUrl}static set PreprocessUrl(R){e.i.PreprocessUrl=R}static LoadImage(R,q,L,B,N,h){return(0,e.u)(R,q,L,B,N,h)}static LoadFile(R,q,L,B,N,h){return(0,e.r)(R,q,L,B,N,h)}static LoadFileAsync(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((L,B)=>{(0,e.r)(R,(R=>{L(R)}),void 0,void 0,q,((R,q)=>{B(q)}))}))}static GetBabylonScriptURL(R,q){if(!R)return"";if(p.ScriptBaseUrl&&R.startsWith(p._DefaultCdnUrl)){const q="/"===p.ScriptBaseUrl[p.ScriptBaseUrl.length-1]?p.ScriptBaseUrl.substring(0,p.ScriptBaseUrl.length-1):p.ScriptBaseUrl;R=R.replace(p._DefaultCdnUrl,q)}return R=p.ScriptPreprocessUrl(R),q&&(R=p.GetAbsoluteUrl(R)),R}static LoadBabylonScript(R,q,L,B){R=p.GetBabylonScriptURL(R),p.LoadScript(R,q,L)}static LoadBabylonScriptAsync(R){return R=p.GetBabylonScriptURL(R),p.LoadScriptAsync(R)}static LoadScript(R,q,L,B){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(R),q&&q()}catch(Y){null===L||void 0===L||L(`Unable to load script '${R}' in worker`,Y)}return}if(!(0,N.i)())return void(null===L||void 0===L||L(`Cannot load script '${R}' outside of a window or a worker`));const Z=document.getElementsByTagName("head")[0],z=document.createElement("script");h?(z.setAttribute("type","module"),z.innerText=R):(z.setAttribute("type","text/javascript"),z.setAttribute("src",R)),B&&(z.id=B),z.onload=()=>{q&&q()},z.onerror=q=>{L&&L(`Unable to load script '${R}'`,q)},Z.appendChild(z)}static LoadScriptAsync(R,q){return new Promise(((L,B)=>{this.LoadScript(R,(()=>{L()}),((R,q)=>{B(q||new Error(R))}),q)}))}static ReadFileAsDataURL(R,q,L){const N=new FileReader,h={onCompleteObservable:new B.b,abort:()=>N.abort()};return N.onloadend=()=>{h.onCompleteObservable.notifyObservers(h)},N.onload=R=>{q(R.target.result)},N.onprogress=L,N.readAsDataURL(R),h}static ReadFile(R,q,L,B,N){return(0,e.y)(R,q,L,B,N)}static FileAsURL(R){const q=new Blob([R]);return window.URL.createObjectURL(q)}static Format(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return R.toFixed(q)}static DeepCopy(R,q,L,B){Z.e.DeepCopy(R,q,L,B)}static IsEmpty(R){for(const q in R)if(Object.prototype.hasOwnProperty.call(R,q))return!1;return!0}static RegisterTopRootEvents(R,q){for(let B=0;B<q.length;B++){const N=q[B];R.addEventListener(N.name,N.handler,!1);try{window.parent&&window.parent.addEventListener(N.name,N.handler,!1)}catch(L){}}}static UnregisterTopRootEvents(R,q){for(let B=0;B<q.length;B++){const N=q[B];R.removeEventListener(N.name,N.handler);try{R.parent&&R.parent.removeEventListener(N.name,N.handler)}catch(L){}}}static async DumpFramebuffer(R,q,L,B){throw(0,Y.d)("DumpTools")}static DumpData(R,q,L,B){throw(0,Y.d)("DumpTools")}static DumpDataAsync(R,q,L){throw(0,Y.d)("DumpTools")}static _IsOffScreenCanvas(R){return void 0!==R.convertToBlob}static ToBlob(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",B=arguments.length>3?arguments[3]:void 0;p._IsOffScreenCanvas(R)||R.toBlob||(R.toBlob=function(R,q,L){setTimeout((()=>{const B=atob(this.toDataURL(q,L).split(",")[1]),N=B.length,h=new Uint8Array(N);for(let R=0;R<N;R++)h[R]=B.charCodeAt(R);R(new Blob([h]))}))}),p._IsOffScreenCanvas(R)?R.convertToBlob({type:L,quality:B}).then((R=>q(R))):R.toBlob((function(R){q(R)}),L,B)}static DownloadBlob(R,q){if("download"in document.createElement("a")){if(!q){const R=new Date;q="screenshot_"+((R.getFullYear()+"-"+(R.getMonth()+1)).slice(2)+"-"+R.getDate()+"_"+R.getHours()+"-"+("0"+R.getMinutes()).slice(-2))+".png"}p.Download(R,q)}else if(R&&"undefined"!==typeof URL){const q=URL.createObjectURL(R),L=window.open("");if(!L)return;const B=L.document.createElement("img");B.onload=function(){URL.revokeObjectURL(q)},B.src=q,L.document.body.appendChild(B)}}static EncodeScreenshotCanvasData(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if("string"!==typeof B&&q){if(q){if(p._IsOffScreenCanvas(R))return void R.convertToBlob({type:L,quality:N}).then((R=>{const L=new FileReader;L.readAsDataURL(R),L.onloadend=()=>{const R=L.result;q(R)}}));const B=R.toDataURL(L,N);q(B)}}else this.ToBlob(R,(function(R){R&&p.DownloadBlob(R,B),q&&q("")}),L,N)}static Download(R,q){if("undefined"===typeof URL)return;const L=window.URL.createObjectURL(R),B=document.createElement("a");document.body.appendChild(B),B.style.display="none",B.href=L,B.download=q,B.addEventListener("click",(()=>{B.parentElement&&B.parentElement.removeChild(B)})),B.click(),window.URL.revokeObjectURL(L)}static BackCompatCameraNoPreventDefault(R){return"boolean"===typeof R[0]?R[0]:"boolean"===typeof R[1]&&R[1]}static CreateScreenshot(R,q,L,B){throw(0,Y.d)("ScreenshotTools")}static CreateScreenshotAsync(R,q,L){throw(0,Y.d)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(R,q,L,B){throw(0,Y.d)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(R,q,L){throw(0,Y.d)("ScreenshotTools")}static RandomId(){return(0,n.e)()}static IsBase64(R){return(0,e.m)(R)}static DecodeBase64(R){return(0,e.e)(R)}static get errorsCount(){return h.d.errorsCount}static Log(R){h.d.Log(R)}static Warn(R){h.d.Warn(R)}static Error(R){h.d.Error(R)}static get LogCache(){return h.d.LogCache}static ClearLogCache(){h.d.ClearLogCache()}static set LogLevels(R){h.d.LogLevels=R}static set PerformanceLogLevel(R){return(R&p.PerformanceUserMarkLogLevel)===p.PerformanceUserMarkLogLevel?(p.StartPerformanceCounter=p._StartUserMark,void(p.EndPerformanceCounter=p._EndUserMark)):(R&p.PerformanceConsoleLogLevel)===p.PerformanceConsoleLogLevel?(p.StartPerformanceCounter=p._StartPerformanceConsole,void(p.EndPerformanceCounter=p._EndPerformanceConsole)):(p.StartPerformanceCounter=p._StartPerformanceCounterDisabled,void(p.EndPerformanceCounter=p._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(R,q){}static _EndPerformanceCounterDisabled(R,q){}static _StartUserMark(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!p._Performance){if(!(0,N.i)())return;p._Performance=window.performance}q&&p._Performance.mark&&p._Performance.mark(R+"-Begin")}static _EndUserMark(R){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&p._Performance.mark&&(p._Performance.mark(R+"-End"),p._Performance.measure(R,R+"-Begin",R+"-End"))}static _StartPerformanceConsole(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];q&&(p._StartUserMark(R,q),console.time&&console.time(R))}static _EndPerformanceConsole(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];q&&(p._EndUserMark(R,q),console.timeEnd(R))}static get Now(){return z.c.Now}static GetClassName(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=null;if(!q&&R.getClassName)L=R.getClassName();else{if(R instanceof Object){L=(q?R:Object.getPrototypeOf(R)).constructor.__bjsclassName__}L||(L=typeof R)}return L}static First(R,q){for(const L of R)if(q(L))return L;return null}static getFullClassName(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=null,B=null;if(!q&&R.getClassName)L=R.getClassName();else{if(R instanceof Object){const N=q?R:Object.getPrototypeOf(R);L=N.constructor.__bjsclassName__,B=N.constructor.__bjsmoduleName__}L||(L=typeof R)}return L?(null!=B?B+".":"")+L:null}static DelayAsync(R){return new Promise((q=>{setTimeout((()=>{q()}),R)}))}static IsSafari(){return!!(0,N.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}p.UseCustomRequestHeaders=!1,p.CustomRequestHeaders=F.b.CustomRequestHeaders,p.GetDOMTextContent=N.d,p._DefaultCdnUrl="https://cdn.babylonjs.com",p.GetAbsoluteUrl="object"===typeof document?R=>{const q=document.createElement("a");return q.href=R,q.href}:"function"===typeof URL&&"object"===typeof location?R=>new URL(R,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},p.NoneLogLevel=h.d.NoneLogLevel,p.MessageLogLevel=h.d.MessageLogLevel,p.WarningLogLevel=h.d.WarningLogLevel,p.ErrorLogLevel=h.d.ErrorLogLevel,p.AllLogLevel=h.d.AllLogLevel,p.IsWindowObjectExist=N.i,p.PerformanceNoneLogLevel=0,p.PerformanceUserMarkLogLevel=1,p.PerformanceConsoleLogLevel=2,p.StartPerformanceCounter=p._StartPerformanceCounterDisabled,p.EndPerformanceCounter=p._EndPerformanceCounterDisabled;class c{constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=R,this.index=B-1,this._done=!1,this._fn=q,this._successCallback=L}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(R,q,L){const B=new c(R,q,L,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return B.executeNext(),B}static SyncAsyncForLoop(R,q,L,B,N){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return c.Run(Math.ceil(R/q),(B=>{N&&N()?B.breakLoop():setTimeout((()=>{for(let h=0;h<q;++h){const Z=B.index*q+h;if(Z>=R)break;if(L(Z),N&&N()){B.breakLoop();break}}B.executeNext()}),h)}),B)}}p.Mix=r.i,p.IsExponentOfTwo=r.f,C.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10889:(R,q,L)=>{"use strict";L.d(q,{d:()=>h,f:()=>N});const B={};function N(R,q){B[R]=q}function h(R){return B[R]}},11204:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});class B{static get UniqueId(){const R=this._UniqueIdCounter;return this._UniqueIdCounter++,R}}B._UniqueIdCounter=1},10791:(R,q,L)=>{"use strict";L.d(q,{b:()=>B});class B{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(B.CustomRequestHeaders).length>0||B.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const R in B.CustomRequestHeaders){const q=B.CustomRequestHeaders[R];q&&this._xhr.setRequestHeader(R,q)}}_shouldSkipRequestModifications(R){return B.SkipRequestModificationForBabylonCDN&&(R.includes("preview.babylonjs.com")||R.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(R){this._xhr.onprogress=R}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(R){this._xhr.responseType=R}get timeout(){return this._xhr.timeout}set timeout(R){this._xhr.timeout=R}addEventListener(R,q,L){this._xhr.addEventListener(R,q,L)}removeEventListener(R,q,L){this._xhr.removeEventListener(R,q,L)}abort(){this._xhr.abort()}send(R){B.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(R)}open(R,q){for(const L of B.CustomRequestModifiers){if(this._shouldSkipRequestModifications(q))return;L(this._xhr,q)}q=(q=q.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=q,this._xhr.open(R,q,!0)}setRequestHeader(R,q){this._xhr.setRequestHeader(R,q)}getResponseHeader(R){return this._xhr.getResponseHeader(R)}}B.CustomRequestHeaders={},B.CustomRequestModifiers=new Array,B.SkipRequestModificationForBabylonCDN=!0},12118:(R,q,L)=>{"use strict";L.d(q,{d:()=>N});class B{constructor(R){this._pendingActions=new Array,this._workerInfos=R.map((R=>({workerPromise:Promise.resolve(R),idle:!0})))}dispose(){for(const R of this._workerInfos)R.workerPromise.then((R=>{R.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(R){this._executeOnIdleWorker(R)||this._pendingActions.push(R)}_executeOnIdleWorker(R){for(const q of this._workerInfos)if(q.idle)return this._execute(q,R),!0;return!1}_execute(R,q){R.idle=!1,R.workerPromise.then((L=>{q(L,(()=>{const q=this._pendingActions.shift();q?this._execute(R,q):R.idle=!0}))}))}}class N extends B{constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.DefaultOptions;super([]),this._maxWorkers=R,this._createWorkerAsync=q,this._options=L}push(R){if(!this._executeOnIdleWorker(R))if(this._workerInfos.length<this._maxWorkers){const q={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(q),this._execute(q,R)}else this._pendingActions.push(R)}_execute(R,q){R.timeoutId&&(clearTimeout(R.timeoutId),delete R.timeoutId),super._execute(R,((L,B)=>{q(L,(()=>{B(),R.idle&&(R.timeoutId=setTimeout((()=>{R.workerPromise.then((R=>{R.terminate()}));const q=this._workerInfos.indexOf(R);-1!==q&&this._workerInfos.splice(q,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}N.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11481:(R,q,L)=>{"use strict";L.d(q,{d:()=>cR});var B=L(11081),N=L(11263);class h extends N.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Z=L(11112),z=(L(11488),L(10889));class Y{get noiseTexture(){return this._noiseTexture}set noiseTexture(R){this._noiseTexture!==R&&(this._noiseTexture=R,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(R){this._isAnimationSheetEnabled!=R&&(this._isAnimationSheetEnabled=R,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(R){this._useLogarithmicDepth=R&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:B.m.Zero()}set direction1(R){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=R)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:B.m.Zero()}set direction2(R){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=R)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:B.m.Zero()}set minEmitBox(R){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=R)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:B.m.Zero()}set maxEmitBox(R){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=R)}get billboardMode(){return this._billboardMode}set billboardMode(R){this._billboardMode!==R&&(this._billboardMode=R,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(R){this._isBillboardBased!==R&&(this._isBillboardBased=R,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R)}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(!R&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=R)}_reset(){}_removeGradientAndTexture(R,q,L){if(!q)return this;let B=0;for(const N of q){if(N.gradient===R){q.splice(B,1);break}B++}return L&&L.dispose(),this}constructor(R){this.animations=[],this.renderingGroupId=0,this.j=B.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new B.m(10,10,10),this.onAnimationEnd=null,this.blendMode=Y.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new B.i(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Rf=new B.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=B.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Z.g(1,1,1,1),this.color2=new Z.g(1,1,1,1),this.colorDead=new Z.g(0,0,0,1),this.textureMask=new Z.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new h,this.id=R,this.name=R}createPointEmitter(R,q){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new B.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new B.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new B.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new B.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new B.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new B.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(R,q,L,B){throw new Error("Method not implemented.")}}Y.BLENDMODE_ONEONE=0,Y.BLENDMODE_STANDARD=1,Y.BLENDMODE_ADD=2,Y.BLENDMODE_MULTIPLY=3,Y.BLENDMODE_MULTIPLYADD=4,(0,z.f)("BABYLON.BaseParticleSystem",Y);var F=L(11099),C=L(10774);class e{constructor(){this.direction1=new B.m(0,1,0),this.direction2=new B.m(0,1,0),this.minEmitBox=new B.m(-.5,-.5,-.5),this.maxEmitBox=new B.m(.5,.5,.5)}startDirectionFunction(R,q,L,N){const h=(0,F.m)(this.direction1.x,this.direction2.x),Z=(0,F.m)(this.direction1.y,this.direction2.y),z=(0,F.m)(this.direction1.z,this.direction2.z);if(N)return q.x=h,q.y=Z,void(q.z=z);B.m.TransformNormalFromFloatsToRef(h,Z,z,R,q)}startPositionFunction(R,q,L,N){const h=(0,F.m)(this.minEmitBox.x,this.maxEmitBox.x),Z=(0,F.m)(this.minEmitBox.y,this.maxEmitBox.y),z=(0,F.m)(this.minEmitBox.z,this.maxEmitBox.z);if(N)return q.x=h,q.y=Z,void(q.z=z);B.m.TransformCoordinatesFromFloatsToRef(h,Z,z,R,q)}clone(){const R=new e;return C.e.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2),R.setVector3("minEmitBox",this.minEmitBox),R.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3),R.addUniform("minEmitBox",3),R.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.dj(),R.direction2=this.direction2.dj(),R.minEmitBox=this.minEmitBox.dj(),R.maxEmitBox=this.maxEmitBox.dj(),R}parse(R){B.m.FromArrayToRef(R.direction1,0,this.direction1),B.m.FromArrayToRef(R.direction2,0,this.direction2),B.m.FromArrayToRef(R.minEmitBox,0,this.minEmitBox),B.m.FromArrayToRef(R.maxEmitBox,0,this.maxEmitBox)}}class y{get radius(){return this._radius}set radius(R){this._radius=R,this._buildHeight()}get angle(){return this._angle}set angle(R){this._angle=R,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=L,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=q,this.radius=R}startDirectionFunction(R,q,L,N){N?B.h.o[0].p(L.Qd).normalize():L.position.subtractToRef(R.getTranslation(),B.h.o[0]).normalize();const h=(0,F.m)(0,this.directionRandomizer),Z=(0,F.m)(0,this.directionRandomizer),z=(0,F.m)(0,this.directionRandomizer);q.x=B.h.o[0].x+h,q.y=B.h.o[0].y+Z,q.z=B.h.o[0].z+z,q.normalize()}startPositionFunction(R,q,L,N){const h=(0,F.m)(0,2*Math.PI);let Z;this.emitFromSpawnPointOnly?Z=1e-4:(Z=(0,F.m)(0,this.heightRange),Z=1-Z*Z);let z=this._radius-(0,F.m)(0,this._radius*this.radiusRange);z*=Z;const Y=z*Math.sin(h),C=z*Math.cos(h),e=Z*this._height;if(N)return q.x=Y,q.y=e,void(q.z=C);B.m.TransformCoordinatesFromFloatsToRef(Y,e,C,R,q)}clone(){const R=new y(this._radius,this._angle,this.directionRandomizer);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat2("radius",this._radius,this.radiusRange),R.setFloat("coneAngle",this._angle),R.setFloat2("height",this._height,this.heightRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",2),R.addUniform("coneAngle",1),R.addUniform("height",2),R.addUniform("directionRandomizer",1)}getEffectDefines(){let R="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(R+="\n#define CONEEMITTERSPAWNPOINT"),R}getClassName(){return"ConeParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this._radius,R.angle=this._angle,R.directionRandomizer=this.directionRandomizer,R.radiusRange=this.radiusRange,R.heightRange=this.heightRange,R.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,R}parse(R){this.radius=R.radius,this.angle=R.angle,this.directionRandomizer=R.directionRandomizer,this.radiusRange=void 0!==R.radiusRange?R.radiusRange:1,this.heightRange=void 0!==R.radiusRange?R.heightRange:1,this.emitFromSpawnPointOnly=void 0!==R.emitFromSpawnPointOnly&&R.emitFromSpawnPointOnly}}class U extends y{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0);super(R,q),this.direction1=L,this.direction2=N}startDirectionFunction(R,q){const L=(0,F.m)(this.direction1.x,this.direction2.x),N=(0,F.m)(this.direction1.y,this.direction2.y),h=(0,F.m)(this.direction1.z,this.direction2.z);B.m.TransformNormalFromFloatsToRef(L,N,h,R,q)}clone(){const R=new U(this.radius,this.angle,this.direction1,this.direction2);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.dj(),R.direction2=this.direction2.dj(),R}parse(R){super.parse(R),this.direction1.p(R.direction1),this.direction2.p(R.direction2)}}class n{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=R,this.height=q,this.radiusRange=L,this.directionRandomizer=N,this._tempVector=B.m.Zero()}startDirectionFunction(R,q,L,N,h){L.position.subtractToRef(R.getTranslation(),this._tempVector),this._tempVector.normalize(),B.m.TransformNormalToRef(this._tempVector,h,this._tempVector);const Z=(0,F.m)(-this.directionRandomizer/2,this.directionRandomizer/2);let z=Math.atan2(this._tempVector.x,this._tempVector.z);z+=(0,F.m)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Z,this._tempVector.x=Math.sin(z),this._tempVector.z=Math.cos(z),this._tempVector.normalize(),N?q.p(this._tempVector):B.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,R,q)}startPositionFunction(R,q,L,N){const h=(0,F.m)(-this.height/2,this.height/2),Z=(0,F.m)(0,2*Math.PI),z=(0,F.m)((1-this.radiusRange)*(1-this.radiusRange),1),Y=Math.sqrt(z)*this.radius,C=Y*Math.cos(Z),e=Y*Math.sin(Z);N?q.Td(C,h,e):B.m.TransformCoordinatesFromFloatsToRef(C,h,e,R,q)}clone(){const R=new n(this.radius,this.directionRandomizer);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.height=this.height,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.height=R.height,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class r extends n{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.m(0,1,0);super(R,q,L),this.direction1=N,this.direction2=h}startDirectionFunction(R,q,L,N){const h=(0,F.m)(this.direction1.x,this.direction2.x),Z=(0,F.m)(this.direction1.y,this.direction2.y),z=(0,F.m)(this.direction1.z,this.direction2.z);N?q.Td(h,Z,z):B.m.TransformNormalFromFloatsToRef(h,Z,z,R,q)}clone(){const R=new r(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.dj(),R.direction2=this.direction2.dj(),R}parse(R){super.parse(R),B.m.FromArrayToRef(R.direction1,0,this.direction1),B.m.FromArrayToRef(R.direction2,0,this.direction2)}}class p{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=R,this.radiusRange=q,this.directionRandomizer=L}startDirectionFunction(R,q,L,N){const h=L.position.Bc(R.getTranslation()).normalize(),Z=(0,F.m)(0,this.directionRandomizer),z=(0,F.m)(0,this.directionRandomizer),Y=(0,F.m)(0,this.directionRandomizer);h.x+=Z,h.y+=z,h.z+=Y,h.normalize(),N?q.p(h):B.m.TransformNormalFromFloatsToRef(h.x,h.y,h.z,R,q)}startPositionFunction(R,q,L,N){const h=this.radius-(0,F.m)(0,this.radius*this.radiusRange),Z=(0,F.m)(0,1),z=(0,F.m)(0,2*Math.PI),Y=Math.acos(2*Z-1),C=h*Math.cos(z)*Math.sin(Y),e=h*Math.cos(Y),y=h*Math.sin(z)*Math.sin(Y);N?q.Td(C,Math.abs(e),y):B.m.TransformCoordinatesFromFloatsToRef(C,Math.abs(e),y,R,q)}clone(){const R=new p(this.radius,this.directionRandomizer);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class c{constructor(){this.direction1=new B.m(0,1,0),this.direction2=new B.m(0,1,0)}startDirectionFunction(R,q,L,N){const h=(0,F.m)(this.direction1.x,this.direction2.x),Z=(0,F.m)(this.direction1.y,this.direction2.y),z=(0,F.m)(this.direction1.z,this.direction2.z);N?q.Td(h,Z,z):B.m.TransformNormalFromFloatsToRef(h,Z,z,R,q)}startPositionFunction(R,q,L,N){N?q.Td(0,0,0):B.m.TransformCoordinatesFromFloatsToRef(0,0,0,R,q)}clone(){const R=new c;return C.e.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.dj(),R.direction2=this.direction2.dj(),R}parse(R){B.m.FromArrayToRef(R.direction1,0,this.direction1),B.m.FromArrayToRef(R.direction2,0,this.direction2)}}class d{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=R,this.radiusRange=q,this.directionRandomizer=L}startDirectionFunction(R,q,L,N){const h=L.position.Bc(R.getTranslation()).normalize(),Z=(0,F.m)(0,this.directionRandomizer),z=(0,F.m)(0,this.directionRandomizer),Y=(0,F.m)(0,this.directionRandomizer);h.x+=Z,h.y+=z,h.z+=Y,h.normalize(),N?q.p(h):B.m.TransformNormalFromFloatsToRef(h.x,h.y,h.z,R,q)}startPositionFunction(R,q,L,N){const h=this.radius-(0,F.m)(0,this.radius*this.radiusRange),Z=(0,F.m)(0,1),z=(0,F.m)(0,2*Math.PI),Y=Math.acos(2*Z-1),C=h*Math.cos(z)*Math.sin(Y),e=h*Math.cos(Y),y=h*Math.sin(z)*Math.sin(Y);N?q.Td(C,e,y):B.m.TransformCoordinatesFromFloatsToRef(C,e,y,R,q)}clone(){const R=new d(this.radius,this.directionRandomizer);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class f extends d{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.m(0,1,0),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0);super(R),this.direction1=q,this.direction2=L}startDirectionFunction(R,q){const L=(0,F.m)(this.direction1.x,this.direction2.x),N=(0,F.m)(this.direction1.y,this.direction2.y),h=(0,F.m)(this.direction1.z,this.direction2.z);B.m.TransformNormalFromFloatsToRef(L,N,h,R,q)}clone(){const R=new f(this.radius,this.direction1,this.direction2);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.dj(),R.direction2=this.direction2.dj(),R}parse(R){super.parse(R),this.direction1.p(R.direction1),this.direction2.p(R.direction2)}}class v{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(R,q,L,N){const h=B.h.o[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,L,h);const R=B.h.o[1];h.subtractToRef(L.position,R),R.scaleToRef(1/L.lifeTime,h)}else h.set(0,0,0);N?q.p(h):B.m.TransformNormalToRef(h,R,q)}startPositionFunction(R,q,L,N){const h=B.h.o[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,L,h):h.set(0,0,0),N?q.p(h):B.m.TransformCoordinatesToRef(h,R,q)}clone(){const R=new v;return C.e.DeepCopy(this,R),R}applyToShader(R){}buildUniformLayout(R){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.particlePositionGenerator=this.particlePositionGenerator,R.particleDestinationGenerator=this.particleDestinationGenerator,R}parse(R){R.particlePositionGenerator&&(this.particlePositionGenerator=R.particlePositionGenerator),R.particleDestinationGenerator&&(this.particleDestinationGenerator=R.particleDestinationGenerator)}}var T=L(11136);class t{get mesh(){return this._mesh}set mesh(R){this._mesh!==R&&(this._mesh=R,R?(this._indices=R.Sf(),this._positions=R.getVerticesData(T.e.PositionKind),this._normals=R.getVerticesData(T.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=B.m.Zero(),this._mesh=null,this.direction1=new B.m(0,1,0),this.direction2=new B.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=R}startDirectionFunction(R,q,L,N){if(this.useMeshNormalsForDirection&&this._normals)return void B.m.TransformNormalToRef(this._storedNormal,R,q);const h=(0,F.m)(this.direction1.x,this.direction2.x),Z=(0,F.m)(this.direction1.y,this.direction2.y),z=(0,F.m)(this.direction1.z,this.direction2.z);N?q.Td(h,Z,z):B.m.TransformNormalFromFloatsToRef(h,Z,z,R,q)}startPositionFunction(R,q,L,N){if(!this._indices||!this._positions)return;const h=3*Math.random()*(this._indices.length/3)|0,Z=Math.random(),z=Math.random()*(1-Z),Y=1-Z-z,F=this._indices[h],C=this._indices[h+1],e=this._indices[h+2],y=B.h.o[0],U=B.h.o[1],n=B.h.o[2],r=B.h.o[3];B.m.FromArrayToRef(this._positions,3*F,y),B.m.FromArrayToRef(this._positions,3*C,U),B.m.FromArrayToRef(this._positions,3*e,n),r.x=Z*y.x+z*U.x+Y*n.x,r.y=Z*y.y+z*U.y+Y*n.y,r.z=Z*y.z+z*U.z+Y*n.z,N?q.Td(r.x,r.y,r.z):B.m.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,R,q),this.useMeshNormalsForDirection&&this._normals&&(B.m.FromArrayToRef(this._normals,3*F,y),B.m.FromArrayToRef(this._normals,3*C,U),B.m.FromArrayToRef(this._normals,3*e,n),this._storedNormal.x=Z*y.x+z*U.x+Y*n.x,this._storedNormal.y=Z*y.y+z*U.y+Y*n.y,this._storedNormal.z=Z*y.z+z*U.z+Y*n.z)}clone(){const R=new t(this.mesh);return C.e.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var R;const q={};return q.type=this.getClassName(),q.direction1=this.direction1.dj(),q.direction2=this.direction2.dj(),q.meshId=null===(R=this.mesh)||void 0===R?void 0:R.id,q.useMeshNormalsForDirection=this.useMeshNormalsForDirection,q}parse(R,q){B.m.FromArrayToRef(R.direction1,0,this.direction1),B.m.FromArrayToRef(R.direction2,0,this.direction2),R.meshId&&q&&(this.mesh=q.getLastMeshById(R.meshId)),this.useMeshNormalsForDirection=R.useMeshNormalsForDirection}}var D=L(10837);class S{_isUbo(R){return void 0!==R.addUniform}constructor(R){this._isUbo(R)?(this.setMatrix3x3=R.updateMatrix3x3.bind(R),this.setMatrix2x2=R.updateMatrix2x2.bind(R),this.setFloat=R.updateFloat.bind(R),this.setFloat2=R.updateFloat2.bind(R),this.setFloat3=R.updateFloat3.bind(R),this.setFloat4=R.updateFloat4.bind(R),this.setFloatArray=R.updateFloatArray.bind(R),this.setArray=R.updateArray.bind(R),this.setIntArray=R.updateIntArray.bind(R),this.setMatrix=R.Cj.bind(R),this.setMatrices=R.updateMatrices.bind(R),this.setVector3=R.updateVector3.bind(R),this.setVector4=R.updateVector4.bind(R),this.setColor3=R.updateColor3.bind(R),this.setColor4=R.updateColor4.bind(R),this.setDirectColor4=R.updateDirectColor4.bind(R),this.setInt=R.updateInt.bind(R),this.setInt2=R.updateInt2.bind(R),this.setInt3=R.updateInt3.bind(R),this.setInt4=R.updateInt4.bind(R)):(this.setMatrix3x3=R.setMatrix3x3.bind(R),this.setMatrix2x2=R.setMatrix2x2.bind(R),this.setFloat=R.setFloat.bind(R),this.setFloat2=R.setFloat2.bind(R),this.setFloat3=R.setFloat3.bind(R),this.setFloat4=R.setFloat4.bind(R),this.setFloatArray=R.setFloatArray.bind(R),this.setArray=R.setArray.bind(R),this.setIntArray=R.setIntArray.bind(R),this.setMatrix=R.setMatrix.bind(R),this.setMatrices=R.setMatrices.bind(R),this.setVector3=R.setVector3.bind(R),this.setVector4=R.setVector4.bind(R),this.setColor3=R.setColor3.bind(R),this.setColor4=R.setColor4.bind(R),this.setDirectColor4=R.setDirectColor4.bind(R),this.setInt=R.setInt.bind(R),this.setInt2=R.setInt2.bind(R),this.setInt3=R.setInt3.bind(R),this.setInt4=R.setInt4.bind(R))}}var I=L(10841);const K="gpuUpdateParticlesPixelShader",m="#version 300 es\nvoid main() {discard;}\n";I.b.ShadersStore[K]=m;const o="gpuUpdateParticlesVertexShader",l="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";I.b.ShadersStore[o]=l;(0,z.f)("BABYLON.WebGL2ParticleSystem",class{constructor(R,q){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=R,this._engine=q,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var R;return(null===(R=this._updateEffect)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof v&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=R,this._updateEffect=new D.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new S(this._updateEffect)}createVertexBuffers(R,q){this._updateVAO.push(this._createUpdateVAO(R)),this._renderVAO.push(this._engine.recordVertexArrayObject(q,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=q}createParticleBuffer(R){return R}bindDrawBuffers(R,q,L){L?this._engine.bindBuffers(this._renderVertexBuffers,L,q):this._engine.bindVertexArrayObject(this._renderVAO[R],null)}preUpdateParticleBuffer(){const R=this._engine;if(this._engine.enableEffect(this._updateEffect),!R.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(R,q,L){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[R],null);const B=this._engine;B.bindTransformFeedbackBuffer(q.getBuffer()),B.setRasterizerState(!1),B.beginTransformFeedback(!0),B.drawArraysType(3,0,L),B.endTransformFeedback(),B.setRasterizerState(!0),B.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let R=0;R<this._updateVAO.length;R++)this._engine.releaseVertexArrayObject(this._updateVAO[R]);this._updateVAO.length=0;for(let R=0;R<this._renderVAO.length;R++)this._engine.releaseVertexArrayObject(this._renderVAO[R]);this._renderVAO.length=0}_createUpdateVAO(R){const q={};q.position=R.createVertexBuffer("position",0,3);let L=3;q.age=R.createVertexBuffer("age",L,1),L+=1,q.size=R.createVertexBuffer("size",L,3),L+=3,q.life=R.createVertexBuffer("life",L,1),L+=1,q.seed=R.createVertexBuffer("seed",L,4),L+=4,q.direction=R.createVertexBuffer("direction",L,3),L+=3,this._parent.particleEmitterType instanceof v&&(q.initialPosition=R.createVertexBuffer("initialPosition",L,3),L+=3),this._parent._colorGradientsTexture||(q.color=R.createVertexBuffer("color",L,4),L+=4),this._parent._isBillboardBased||(q.initialDirection=R.createVertexBuffer("initialDirection",L,3),L+=3),this._parent.noiseTexture&&(q.noiseCoordinates1=R.createVertexBuffer("noiseCoordinates1",L,3),L+=3,q.noiseCoordinates2=R.createVertexBuffer("noiseCoordinates2",L,3),L+=3),this._parent._angularSpeedGradientsTexture?(q.angle=R.createVertexBuffer("angle",L,1),L+=1):(q.angle=R.createVertexBuffer("angle",L,2),L+=2),this._parent._isAnimationSheetEnabled&&(q.cellIndex=R.createVertexBuffer("cellIndex",L,1),L+=1,this._parent.spriteRandomStartCell&&(q.cellStartOffset=R.createVertexBuffer("cellStartOffset",L,1),L+=1));const B=this._engine.recordVertexArrayObject(q,null,this._updateEffect);return this._engine.bindArrayBuffer(null),B}});class G{constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,B=arguments.length>3?arguments[3]:void 0;this._engine=R,this._label=B,this._engine._storageBuffers.push(this),this._create(q,L)}_create(R,q){this._bufferSize=R,this._creationFlags=q,this._buffer=this._engine.createStorageBuffer(R,q,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(R,q,L){this._buffer&&this._engine.updateStorageBuffer(this._buffer,R,q,L)}read(R,q,L,B){return this._engine.readFromStorageBuffer(this._buffer,R,q,L,B)}dispose(){const R=this._engine._storageBuffers,q=R.indexOf(this);-1!==q&&(R[q]=R[R.length-1],R.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var W=L(11053),H=L(11058),P=L(11117),O=L(11277),E=L(11204),a=L(10767),g=L(10871),Q=L(10909);class i{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Q.d}_addDuration(R,q){R<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==R?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(q,!1),this._gpuTimeInFrameId=R):this.counter.addCount(q,!1))}}class k{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=R,this._engine=q,this.uniqueId=E.d.UniqueId,q.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new i),this._engine.getCaps().supportComputeShaders?B.bindingsMapping?(this._context=q.createComputeContext(),this._shaderPath=L,this._options={bindingsMapping:{},defines:[],...B}):a.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):a.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this._bindings[R];this._bindings[R]={type:L?0:4,object:q,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!B||B.object!==q||B.type!==this._bindings[R].type)}setStorageTexture(R,q){const L=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==q),this._bindings[R]={type:1,object:q,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setExternalTexture(R,q){const L=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==q),this._bindings[R]={type:6,object:q,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setVideoTexture(R,q){return!!q.externalTexture&&(this.setExternalTexture(R,q.externalTexture),!0)}setUniformBuffer(R,q){const L=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==q),this._bindings[R]={type:k._BufferIsDataBuffer(q)?7:2,object:q,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setStorageBuffer(R,q){const L=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==q),this._bindings[R]={type:k._BufferIsDataBuffer(q)?7:3,object:q,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setTextureSampler(R,q){const L=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!L||!q.compareSampler(L.object)),this._bindings[R]={type:5,object:q,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}isReady(){let R=this._effect;for(const N in this._bindings){const R=this._bindings[N],q=R.type,L=R.object;switch(q){case 0:case 4:case 1:if(!L.isReady())return!1;break;case 6:if(!L.isReady())return!1;break}}const q=[],L=this._shaderPath;if(this._options.defines)for(let N=0;N<this._options.defines.length;N++)q.push(this._options.defines[N]);const B=q.join("\n");return this._cachedDefines!==B&&(this._cachedDefines=B,R=this._engine.createComputeEffect(L,{defines:B,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=R),!!R.isReady()}dispatch(R,q,L){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,R,q,L,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const L=k._BufferIsDataBuffer(R)?R:R.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,L,q,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const q in this._bindings){const L=this._bindings[q];if(!this._options.bindingsMapping[q])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+q+"'");switch(L.type){case 0:{const B=this._samplers[q],N=L.object;var R;if(!B||!N._texture||!B.compareSampler(N._texture))this._samplers[q]=(new g.c).setParameters(N.wrapU,N.wrapV,N.wrapR,N.anisotropicFilteringLevel,N._texture.samplingMode,null===(R=N._texture)||void 0===R?void 0:R._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const R=L.object;R.getBuffer()!==L.buffer&&(L.buffer=R.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((N=>{const h=()=>{this.dispatch(R,q,L)?N():setTimeout(h,B)};h()}))}serialize(){const R=P.b.Serialize(this);R.options=this._options,R.shaderPath=this._shaderPath,R.sj={},R.textures={};for(const q in this._bindings){const L=this._bindings[q],B=L.object;switch(L.type){case 0:case 4:case 1:{const N=B.serialize();N&&(R.textures[q]=N,R.sj[q]={type:L.type});break}}}return R}static Parse(R,q,L){const B=P.b.Parse((()=>new k(R.name,q.getEngine(),R.shaderPath,R.options)),R,q,L);for(const N in R.textures){const h=R.sj[N],Z=O.c.Parse(R.textures[N],q,L);0===h.type?B.setTexture(N,Z):4===h.type?B.setTexture(N,Z,!1):B.setStorageTexture(N,Z)}return B}static _BufferIsDataBuffer(R){return void 0!==R.underlyingResource}}(0,W.d)([(0,H.K)()],k.prototype,"name",void 0),(0,W.d)([(0,H.K)()],k.prototype,"fastMode",void 0),(0,z.f)("BABYLON.ComputeShader",k);var V=L(11132);const x="gpuUpdateParticlesComputeShader",w="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";I.b.ShadersStoreWGSL[x]=w;(0,z.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(R,q){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=R,this._engine=q}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var R;return(null===(R=this._updateComputeShader)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){var q;const L={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(L.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(L.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(L.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(L.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(L.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(L.noiseTexture={group:1,binding:11}),this._updateComputeShader=new k("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:L,defines:R.split("\n")}),null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=new V.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new S(this._simParamsComputeShader)}createVertexBuffers(R,q){this._renderVertexBuffers.push(q)}createParticleBuffer(R){const q=new G(this._engine,4*R.length,11,"ComputeShaderParticleSystemBuffer");return q.update(R),this._bufferComputeShader.push(q),q.getBuffer()}bindDrawBuffers(R,q,L){this._engine.bindBuffers(this._renderVertexBuffers[R],L,q)}preUpdateParticleBuffer(){}updateParticleBuffer(R,q,L){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[R]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^R]),this._updateComputeShader.dispatch(Math.ceil(L/64))}releaseBuffers(){var R;for(let q=0;q<this._bufferComputeShader.length;++q)this._bufferComputeShader[q].dispose();this._bufferComputeShader.length=0,null===(R=this._simParamsComputeShader)||void 0===R||R.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class j{constructor(R,q,L){this.gradient=R,this.color1=q,this.color2=L}getColorToRef(R){this.color2?Z.g.LerpToRef(this.color1,this.color2,Math.random(),R):R.p(this.color1)}}class J{constructor(R,q){this.gradient=R,this.color=q}}class s{constructor(R,q,L){this.gradient=R,this.factor1=q,this.factor2=L}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class A{static GetCurrentGradient(R,q,L){if(q[0].gradient>R)return void L(q[0],q[0],1);for(let N=0;N<q.length-1;N++){const B=q[N],h=q[N+1];if(R>=B.gradient&&R<=h.gradient){return void L(B,h,(R-B.gradient)/(h.gradient-B.gradient))}}const B=q.length-1;L(q[B],q[B],1)}}var M=L(10760),b=L(11525),X=L(10797);class u{constructor(R){this.particleSystem=R,this.position=B.m.Zero(),this.direction=B.m.Zero(),this.color=new Z.g(0,0,0,0),this.colorStep=new Z.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new B.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Z.g(0,0,0,0),this._currentColor2=new Z.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=u._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let R=this.age,q=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===q?(q=1,R=this._randomCellOffset):R+=this._randomCellOffset);const L=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let B;B=this._initialSpriteCellLoop?(0,F.b)(R*q%this.lifeTime/this.lifeTime):(0,F.b)(R*q/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+B*L|0}_inheritParticleInfoToSubEmitter(R){if(R.particleSystem.j.position){const q=R.particleSystem.j;if(q.position.p(this.position),R.inheritDirection){const R=B.h.o[0];this.direction.normalizeToRef(R),q.setDirection(R,0,Math.PI/2)}}else{R.particleSystem.j.p(this.position)}this.direction.scaleToRef(R.inheritedVelocityAmount/2,B.h.o[0]),R.particleSystem._inheritedVelocityOffset.p(B.h.o[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((R=>{this._inheritParticleInfoToSubEmitter(R)}))}_reset(){this.age=0,this.id=u._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(R){R.position.p(this.position),this._initialDirection?R._initialDirection?R._initialDirection.p(this._initialDirection):R._initialDirection=this._initialDirection.clone():R._initialDirection=null,R.direction.p(this.direction),this.Qd&&(R.Qd?R.Qd.p(this.Qd):R.Qd=this.Qd.clone()),R.color.p(this.color),R.colorStep.p(this.colorStep),R.lifeTime=this.lifeTime,R.age=this.age,R._randomCellOffset=this._randomCellOffset,R.size=this.size,R.scale.p(this.scale),R.angle=this.angle,R.angularSpeed=this.angularSpeed,R.particleSystem=this.particleSystem,R.cellIndex=this.cellIndex,R.id=this.id,R._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(R._currentColorGradient=this._currentColorGradient,R._currentColor1.p(this._currentColor1),R._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(R._currentSizeGradient=this._currentSizeGradient,R._currentSize1=this._currentSize1,R._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(R._currentAngularSpeedGradient=this._currentAngularSpeedGradient,R._currentAngularSpeed1=this._currentAngularSpeed1,R._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(R._currentVelocityGradient=this._currentVelocityGradient,R._currentVelocity1=this._currentVelocity1,R._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(R._currentLimitVelocityGradient=this._currentLimitVelocityGradient,R._currentLimitVelocity1=this._currentLimitVelocity1,R._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(R._currentDragGradient=this._currentDragGradient,R._currentDrag1=this._currentDrag1,R._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(R._initialStartSpriteCellID=this._initialStartSpriteCellID,R._initialEndSpriteCellID=this._initialEndSpriteCellID,R._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(R.remapData&&this.remapData?R.remapData.p(this.remapData):R.remapData=new B.q(0,0,0,0)),this._randomNoiseCoordinates1&&(R._randomNoiseCoordinates1?(R._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),R._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(R._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),R._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}u._Count=0;var RR=L(11246),qR=(L(11529),L(11255)),LR=L(11248),BR=L(11126);class NR extends Y{set onDispose(R){this._onDisposeObserver&&this.ej.remove(this._onDisposeObserver),this._onDisposeObserver=this.ej.add(R)}get useRampGradients(){return this._useRampGradients}set useRampGradients(R){this._useRampGradients!==R&&(this._useRampGradients=R,this._resetEffect())}get particles(){return this.nj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.nj.length}getClassName(){return"rb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var R;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[q])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new RR.b(this._engine),this._customWrappers[q].effect=R,this._customWrappers[q].drawContext&&(this._customWrappers[q].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(R),this._emitterInverseWorldMatrix=B.c.Identity(),this._inheritedVelocityOffset=new B.m,this.ej=new M.b,this.onStoppedObservable=new M.b,this.nj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Z.g(0,0,0,0),this._colorDiff=new Z.g(0,0,0,0),this._scaledDirection=B.m.Zero(),this._scaledGravity=B.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=R=>{},this.recycleParticle=R=>{const q=this.nj.pop();q!==R&&q.copyTo(R),this._stockParticles.push(q)},this._createParticle=()=>{let R;return 0!==this._stockParticles.length?(R=this._stockParticles.pop(),R._reset()):R=new u(this),this._prepareParticle(R),R},this._shadersLoaded=!1,this._capacity=q,this._epsilon=z,this._isAnimationSheetEnabled=h,L&&"Scene"!==L.getClassName()?(this._engine=L,this.defaultProjectionMatrix=B.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=L||X.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.lj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new RR.b(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new e;let Y=null;this.updateFunction=R=>{let q=null;var L;this.noiseTexture&&(q=this.noiseTexture.getSize(),null===(L=this.noiseTexture.getContent())||void 0===L||L.then((R=>{Y=R})));const N=R===this.nj;for(let h=0;h<R.length;h++){const L=R[h];let z=this._scaledUpdateSpeed;const C=L.age;if(L.age+=z,L.age>L.lifeTime){const R=L.age-C;z=(L.lifeTime-C)*z/R,L.age=L.lifeTime}const e=L.age/L.lifeTime;this._colorGradients&&this._colorGradients.length>0?A.GetCurrentGradient(e,this._colorGradients,((R,q,B)=>{R!==L._currentColorGradient&&(L._currentColor1.p(L._currentColor2),q.getColorToRef(L._currentColor2),L._currentColorGradient=R),Z.g.LerpToRef(L._currentColor1,L._currentColor2,B,L.color)})):(L.colorStep.scaleToRef(z,this._scaledColorStep),L.color.addInPlace(this._scaledColorStep),L.color.a<0&&(L.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&A.GetCurrentGradient(e,this._angularSpeedGradients,((R,q,B)=>{R!==L._currentAngularSpeedGradient&&(L._currentAngularSpeed1=L._currentAngularSpeed2,L._currentAngularSpeed2=q.getFactor(),L._currentAngularSpeedGradient=R),L.angularSpeed=(0,F.h)(L._currentAngularSpeed1,L._currentAngularSpeed2,B)})),L.angle+=L.angularSpeed*z;let y=z;if(this._velocityGradients&&this._velocityGradients.length>0&&A.GetCurrentGradient(e,this._velocityGradients,((R,q,B)=>{R!==L._currentVelocityGradient&&(L._currentVelocity1=L._currentVelocity2,L._currentVelocity2=q.getFactor(),L._currentVelocityGradient=R),y*=(0,F.h)(L._currentVelocity1,L._currentVelocity2,B)})),L.direction.scaleToRef(y,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&A.GetCurrentGradient(e,this._limitVelocityGradients,((R,q,B)=>{R!==L._currentLimitVelocityGradient&&(L._currentLimitVelocity1=L._currentLimitVelocity2,L._currentLimitVelocity2=q.getFactor(),L._currentLimitVelocityGradient=R);const N=(0,F.h)(L._currentLimitVelocity1,L._currentLimitVelocity2,B);L.direction.length()>N&&L.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&A.GetCurrentGradient(e,this._dragGradients,((R,q,B)=>{R!==L._currentDragGradient&&(L._currentDrag1=L._currentDrag2,L._currentDrag2=q.getFactor(),L._currentDragGradient=R);const N=(0,F.h)(L._currentDrag1,L._currentDrag2,B);this._scaledDirection.scaleInPlace(1-N)})),this.isLocal&&L.Qd?(L.Qd.addInPlace(this._scaledDirection),B.m.TransformCoordinatesToRef(L.Qd,this._emitterWorldMatrix,L.position)):L.position.addInPlace(this._scaledDirection),Y&&q&&L._randomNoiseCoordinates1){const R=this._fetchR(L._randomNoiseCoordinates1.x,L._randomNoiseCoordinates1.y,q.width,q.height,Y),N=this._fetchR(L._randomNoiseCoordinates1.z,L._randomNoiseCoordinates2.x,q.width,q.height,Y),h=this._fetchR(L._randomNoiseCoordinates2.y,L._randomNoiseCoordinates2.z,q.width,q.height,Y),Z=B.h.o[0],F=B.h.o[1];Z.Td((2*R-1)*this.noiseStrength.x,(2*N-1)*this.noiseStrength.y,(2*h-1)*this.noiseStrength.z),Z.scaleToRef(z,F),L.direction.addInPlace(F)}this.gravity.scaleToRef(z,this._scaledGravity),L.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&A.GetCurrentGradient(e,this._sizeGradients,((R,q,B)=>{R!==L._currentSizeGradient&&(L._currentSize1=L._currentSize2,L._currentSize2=q.getFactor(),L._currentSizeGradient=R),L.size=(0,F.h)(L._currentSize1,L._currentSize2,B)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&A.GetCurrentGradient(e,this._colorRemapGradients,((R,q,B)=>{const N=(0,F.h)(R.factor1,q.factor1,B),h=(0,F.h)(R.factor2,q.factor2,B);L.remapData.x=N,L.remapData.y=h-N})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&A.GetCurrentGradient(e,this._alphaRemapGradients,((R,q,B)=>{const N=(0,F.h)(R.factor1,q.factor1,B),h=(0,F.h)(R.factor2,q.factor2,B);L.remapData.z=N,L.remapData.w=h-N}))),this._isAnimationSheetEnabled&&L.updateCellIndex(),L._inheritParticleInfoToSubEmitters(),L.age>=L.lifeTime&&(this._emitFromParticle(L),L._attachedSubEmitters&&(L._attachedSubEmitters.forEach((R=>{R.particleSystem.disposeOnStop=!0,R.particleSystem.stop()})),L._attachedSubEmitters=null),this.recycleParticle(L),N&&h--)}}}serialize(R){throw new Error("Method not implemented.")}clone(R,q){throw new Error("Method not implemented.")}_addFactorGradient(R,q,L,B){const N=new s(q,L,B);R.push(N),R.sort(((R,q)=>R.gradient<q.gradient?-1:R.gradient>q.gradient?1:0))}_removeFactorGradient(R,q){if(!R)return;let L=0;for(const B of R){if(B.gradient===q){R.splice(L,1);break}L++}}addLifeTimeGradient(R,q,L){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,R,q,L),this}removeLifeTimeGradient(R){return this._removeFactorGradient(this._lifeTimeGradients,R),this}addSizeGradient(R,q,L){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,R,q,L),this}removeSizeGradient(R){return this._removeFactorGradient(this._sizeGradients,R),this}addColorRemapGradient(R,q,L){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,R,q,L),this}removeColorRemapGradient(R){return this._removeFactorGradient(this._colorRemapGradients,R),this}addAlphaRemapGradient(R,q,L){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,R,q,L),this}removeAlphaRemapGradient(R){return this._removeFactorGradient(this._alphaRemapGradients,R),this}addAngularSpeedGradient(R,q,L){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,R,q,L),this}removeAngularSpeedGradient(R){return this._removeFactorGradient(this._angularSpeedGradients,R),this}addVelocityGradient(R,q,L){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,R,q,L),this}removeVelocityGradient(R){return this._removeFactorGradient(this._velocityGradients,R),this}addLimitVelocityGradient(R,q,L){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,R,q,L),this}removeLimitVelocityGradient(R){return this._removeFactorGradient(this._limitVelocityGradients,R),this}addDragGradient(R,q,L){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,R,q,L),this}removeDragGradient(R){return this._removeFactorGradient(this._dragGradients,R),this}addEmitRateGradient(R,q,L){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,R,q,L),this}removeEmitRateGradient(R){return this._removeFactorGradient(this._emitRateGradients,R),this}addStartSizeGradient(R,q,L){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,R,q,L),this}removeStartSizeGradient(R){return this._removeFactorGradient(this._startSizeGradients,R),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const R=new Uint8Array(4*this._rawTextureWidth),q=Z.i.gb[0];for(let L=0;L<this._rawTextureWidth;L++){const B=L/this._rawTextureWidth;A.GetCurrentGradient(B,this._rampGradients,((B,N,h)=>{Z.e.LerpToRef(B.color,N.color,h,q),R[4*L]=255*q.r,R[4*L+1]=255*q.g,R[4*L+2]=255*q.b,R[4*L+3]=255}))}this._rampGradientsTexture=b.c.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((R,q)=>R.gradient<q.gradient?-1:R.gradient>q.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(R,q){this._rampGradients||(this._rampGradients=[]);const L=new J(R,q);return this._rampGradients.push(L),this._syncRampGradientTexture(),this}removeRampGradient(R){return this._removeGradientAndTexture(R,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(R,q,L){this._colorGradients||(this._colorGradients=[]);const B=new j(R,q,L);return this._colorGradients.push(B),this._colorGradients.sort(((R,q)=>R.gradient<q.gradient?-1:R.gradient>q.gradient?1:0)),this}removeColorGradient(R){if(!this._colorGradients)return this;let q=0;for(const L of this._colorGradients){if(L.gradient===R){this._colorGradients.splice(q,1);break}q++}return this}resetDrawCache(){for(const R of this._drawWrappers)if(R)for(const q of R)null===q||void 0===q||q.dispose();this._drawWrappers=[]}_fetchR(R,q,L,B,N){return N[4*(((R=.5*Math.abs(R)+.5)*L%L|0)+((q=.5*Math.abs(q)+.5)*B%B|0)*L)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const R=this._engine,q=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*q),this._vertexBuffer=new T.d(R,this._vertexData,!0,q);let L=0;const B=this._vertexBuffer.createVertexBuffer(T.e.PositionKind,L,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.e.PositionKind]=B,L+=3;const N=this._vertexBuffer.createVertexBuffer(T.e.ColorKind,L,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.e.ColorKind]=N,L+=4;const h=this._vertexBuffer.createVertexBuffer("angle",L,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=h,L+=1;const Z=this._vertexBuffer.createVertexBuffer("size",L,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Z,L+=2,this._isAnimationSheetEnabled){const R=this._vertexBuffer.createVertexBuffer("cellIndex",L,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=R,L+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const R=this._vertexBuffer.createVertexBuffer("direction",L,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=R,L+=3}if(this._useRampGradients){const R=this._vertexBuffer.createVertexBuffer("remapData",L,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=R,L+=4}let z;if(this._useInstancing){const q=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new T.d(R,q,!1,2),z=this._spriteBuffer.createVertexBuffer("offset",0,2)}else z=this._vertexBuffer.createVertexBuffer("offset",L,2,this._vertexBufferSize,this._useInstancing),L+=2;this._vertexBuffers.offset=z,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const R=[],q=[];let L=0;for(let B=0;B<this._capacity;B++)R.push(L),R.push(L+1),R.push(L+2),R.push(L),R.push(L+2),R.push(L+3),q.push(L,L+1,L+1,L+2,L+2,L+3,L+3,L,L,L+3),L+=4;this._indexBuffer=this._engine.createIndexBuffer(R),this._linesIndexBuffer=this._engine.createIndexBuffer(q)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(R)setTimeout((()=>{this.start(0)}),R);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var q;-1!==(null===(q=this.j)||void 0===q?void 0:q.getClassName().indexOf("Mesh"))&&this.j.Jj(!0);const R=this.noiseTexture;if(R&&R.onGeneratedObservable)R.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),R.render()}))}));else for(let q=0;q<this.preWarmCycles;q++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(R))}_postStop(R){}reset(){this._stockParticles.length=0,this.nj.length=0}_appendParticleVertex(R,q,L,N){let h=R*this._vertexBufferSize;if(this._vertexData[h++]=q.position.x+this.Rf.x,this._vertexData[h++]=q.position.y+this.Rf.y,this._vertexData[h++]=q.position.z+this.Rf.z,this._vertexData[h++]=q.color.r,this._vertexData[h++]=q.color.g,this._vertexData[h++]=q.color.b,this._vertexData[h++]=q.color.a,this._vertexData[h++]=q.angle,this._vertexData[h++]=q.scale.x*q.size,this._vertexData[h++]=q.scale.y*q.size,this._isAnimationSheetEnabled&&(this._vertexData[h++]=q.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[h++]=q.direction.x,this._vertexData[h++]=q.direction.y,this._vertexData[h++]=q.direction.z);else if(q._initialDirection){let R=q._initialDirection;this.isLocal&&(B.m.TransformNormalToRef(R,this._emitterWorldMatrix,B.h.o[0]),R=B.h.o[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[h++]=R.x,this._vertexData[h++]=R.y,this._vertexData[h++]=R.z}else{let R=q.direction;this.isLocal&&(B.m.TransformNormalToRef(R,this._emitterWorldMatrix,B.h.o[0]),R=B.h.o[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[h++]=R.x,this._vertexData[h++]=R.y,this._vertexData[h++]=R.z}this._useRampGradients&&q.remapData&&(this._vertexData[h++]=q.remapData.x,this._vertexData[h++]=q.remapData.y,this._vertexData[h++]=q.remapData.z,this._vertexData[h++]=q.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===L?L=this._epsilon:1===L&&(L=1-this._epsilon),0===N?N=this._epsilon:1===N&&(N=1-this._epsilon)),this._vertexData[h++]=L,this._vertexData[h++]=N)}_prepareParticle(R){}_update(R){if(this._alive=this.nj.length>0,this.j.position){const R=this.j;this._emitterWorldMatrix=R.getWorldMatrix()}else{const R=this.j;this._emitterWorldMatrix=B.c.Translation(R.x,R.y,R.z)}let q;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.nj);for(let L=0;L<R&&this.nj.length!==this._capacity;L++){if(q=this._createParticle(),this.nj.push(q),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const R=(0,F.b)(this._actualFrame/this.targetStopDuration);A.GetCurrentGradient(R,this._lifeTimeGradients,((L,B)=>{const N=L,h=B,Z=N.getFactor(),z=h.getFactor(),Y=(R-N.gradient)/(h.gradient-N.gradient);q.lifeTime=(0,F.h)(Z,z,Y)}))}else q.lifeTime=(0,F.m)(this.minLifeTime,this.maxLifeTime);const R=(0,F.m)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,q.position,q,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,q.position,q,this.isLocal),this.isLocal&&(q.Qd?q.Qd.p(q.position):q.Qd=q.position.clone(),B.m.TransformCoordinatesToRef(q.Qd,this._emitterWorldMatrix,q.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,q.direction,q,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,q.direction,q,this.isLocal,this._emitterInverseWorldMatrix),0===R?q._initialDirection?q._initialDirection.p(q.direction):q._initialDirection=q.direction.clone():q._initialDirection=null,q.direction.scaleInPlace(R),this._sizeGradients&&0!==this._sizeGradients.length?(q._currentSizeGradient=this._sizeGradients[0],q._currentSize1=q._currentSizeGradient.getFactor(),q.size=q._currentSize1,this._sizeGradients.length>1?q._currentSize2=this._sizeGradients[1].getFactor():q._currentSize2=q._currentSize1):q.size=(0,F.m)(this.minSize,this.maxSize),q.scale.Td((0,F.m)(this.minScaleX,this.maxScaleX),(0,F.m)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const R=this._actualFrame/this.targetStopDuration;A.GetCurrentGradient(R,this._startSizeGradients,((R,L,B)=>{R!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=L.getFactor(),this._currentStartSizeGradient=R);const N=(0,F.h)(this._currentStartSize1,this._currentStartSize2,B);q.scale.scaleInPlace(N)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(q._currentAngularSpeedGradient=this._angularSpeedGradients[0],q.angularSpeed=q._currentAngularSpeedGradient.getFactor(),q._currentAngularSpeed1=q.angularSpeed,this._angularSpeedGradients.length>1?q._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():q._currentAngularSpeed2=q._currentAngularSpeed1):q.angularSpeed=(0,F.m)(this.minAngularSpeed,this.maxAngularSpeed),q.angle=(0,F.m)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(q._currentVelocityGradient=this._velocityGradients[0],q._currentVelocity1=q._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?q._currentVelocity2=this._velocityGradients[1].getFactor():q._currentVelocity2=q._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(q._currentLimitVelocityGradient=this._limitVelocityGradients[0],q._currentLimitVelocity1=q._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?q._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():q._currentLimitVelocity2=q._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(q._currentDragGradient=this._dragGradients[0],q._currentDrag1=q._currentDragGradient.getFactor(),this._dragGradients.length>1?q._currentDrag2=this._dragGradients[1].getFactor():q._currentDrag2=q._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)q._currentColorGradient=this._colorGradients[0],q._currentColorGradient.getColorToRef(q.color),q._currentColor1.p(q.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(q._currentColor2):q._currentColor2.p(q.color);else{const R=(0,F.m)(0,1);Z.g.LerpToRef(this.color1,this.color2,R,q.color),this.colorDead.subtractToRef(q.color,this._colorDiff),this._colorDiff.scaleToRef(1/q.lifeTime,q.colorStep)}this._isAnimationSheetEnabled&&(q._initialStartSpriteCellID=this.startSpriteCellID,q._initialEndSpriteCellID=this.endSpriteCellID,q._initialSpriteCellLoop=this.spriteCellLoop),q.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(q.remapData=new B.q(0,1,0,1)),this.noiseTexture&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.Td(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2.Td(Math.random(),Math.random(),Math.random())):(q._randomNoiseCoordinates1=new B.m(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2=new B.m(Math.random(),Math.random(),Math.random()))),q._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=[T.e.PositionKind,T.e.ColorKind,"angle","offset","size"];return R&&B.push("cellIndex"),q||B.push("direction"),L&&B.push("remapData"),B}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,qR.e)(B),R&&B.push("particlesInfos"),q&&B.push("logarithmicDepthConstant"),L&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qR.k)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&R.push("#define FOG")),this._isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),q===Y.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&R.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case 2:R.push("#define BILLBOARDY");break;case 8:case 9:R.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&R.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:R.push("#define BILLBOARDMODE_ALL")}L&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,q,L){q.push(...NR._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),R.push(...NR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),L.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,BR.f)(R,this._imageProcessingConfigurationDefines),(0,BR.e)(L,this._imageProcessingConfigurationDefines))}_getWrapper(R){const q=this._getCustomDrawWrapper(R);if(null!==q&&void 0!==q&&q.effect)return q;const L=[];this.fillDefines(L,R);const B=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let N=this._drawWrappers[B];N||(N=this._drawWrappers[B]=[]);let h=N[R];h||(h=new RR.b(this._engine),h.drawContext&&(h.drawContext.useInstancing=this._useInstancing),N[R]=h);const Z=L.join("\n");if(h.defines!==Z){const R=[],q=[],L=[];this.fillUniformsAttributesAndSamplerNames(q,R,L),h.setEffect(this._engine.createEffect("particles",R,q,L,Z,void 0,void 0,void 0,void 0,this._shaderLanguage),Z)}return h}animate(){var R;let q,L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!L&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(L?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this.manualEmitCount>-1)q=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let R=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const q=this._actualFrame/this.targetStopDuration;A.GetCurrentGradient(q,this._emitRateGradients,((q,L,B)=>{q!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=L.getFactor(),this._currentEmitRateGradient=q),R=(0,F.h)(this._currentEmitRate1,this._currentEmitRate2,B)}))}q=R*this._scaledUpdateSpeed|0,this._newPartsExcess+=R*this._scaledUpdateSpeed-q}if(this._newPartsExcess>1&&(q+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?q=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(q),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!L){let R=0;for(let q=0;q<this.nj.length;q++){const L=this.nj[q];this._appendParticleVertices(R,L),R+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.nj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(R,q){this._appendParticleVertex(R++,q,0,0),this._useInstancing||(this._appendParticleVertex(R++,q,1,0),this._appendParticleVertex(R++,q,1,1),this._appendParticleVertex(R++,q,0,1))}rebuild(){var R;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(R=this._spriteBuffer)||void 0===R||R._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!NR.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(L.bind(L,11825)),Promise.resolve().then(L.bind(L,11772))])):await Promise.all([Promise.resolve().then(L.bind(L,11762)),Promise.resolve().then(L.bind(L,11756))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==Y.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Y.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Y.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(R){const q=this._getWrapper(R),L=q.effect,N=this._engine;N.enableEffect(q);const h=this.defaultViewMatrix??this._scene.getViewMatrix();if(L.setTexture("diffuseSampler",this.particleTexture),L.setMatrix("view",h),L.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();L.setFloat3("particlesInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,this.spriteCellWidth/R.width)}if(L.setVector2("translationPivot",this.translationPivot),L.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;L.setVector3("eyePosition",R.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),L.setTexture("rampSampler",this._rampGradientsTexture));const Z=L.defines;var z,F,C,e,y,U;(this._scene&&((0,qR.f)(L,this,this._scene),this.applyFog&&(0,LR.g)(this._scene,void 0,L)),Z.indexOf("#define BILLBOARDMODE_ALL")>=0&&(h.invertToRef(B.h.Matrix[0]),L.setMatrix("invView",B.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?N.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,L):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,L)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?N.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,L):N.bindBuffers(this._vertexBuffers,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:null,L);switch(this.useLogarithmicDepth&&this._scene&&(0,LR.l)(Z,L,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(L),R){case Y.BLENDMODE_ADD:N.setAlphaMode(1);break;case Y.BLENDMODE_ONEONE:N.setAlphaMode(6);break;case Y.BLENDMODE_STANDARD:N.setAlphaMode(2);break;case Y.BLENDMODE_MULTIPLY:N.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(L),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?N.drawElementsType(6,0,10,this.nj.length):N.drawArraysType(7,0,4,this.nj.length):null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?N.drawElementsType(1,0,10*this.nj.length):N.drawElementsType(0,0,6*this.nj.length);return this.nj.length}render(){if(!this.isReady()||!this.nj.length)return 0;const R=this._engine;R.setState&&(R.setState(!1),this.forceDepthWrite&&R.setDepthWrite(!0));let q=0;return q=this.blendMode===Y.BLENDMODE_MULTIPLYADD?this._render(Y.BLENDMODE_MULTIPLY)+this._render(Y.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),q}_onDispose(){}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(q,L),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const R=this._scene.lj.indexOf(this);R>-1&&this._scene.lj.splice(R,1),this._scene._activeParticleSystems.dispose()}this.ej.notifyObservers(this),this.ej.clear(),this.onStoppedObservable.clear(),this.reset()}}NR.ForceGLSL=!1;var hR,ZR=L(10785);!function(R){R[R.ATTACHED=0]="ATTACHED",R[R.END=1]="END"}(hR||(hR={}));class zR{constructor(R){if(this.particleSystem=R,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!R.j||!R.j.dispose){const q=(0,z.d)("BABYLON.AbstractMesh");R.j=new q("SubemitterSystemEmitter",R.va()),R._disposeEmitterOnDispose=!0}}clone(){let R=this.particleSystem.j;if(R){if(R instanceof B.m)R=R.clone();else if(-1!==R.getClassName().indexOf("Mesh")){R=new((0,z.d)("BABYLON.Mesh"))("",R.va()),R.isVisible=!1}}else R=new B.m;const q=new zR(this.particleSystem.clone(this.particleSystem.name,R));return q.particleSystem.name+="Clone",q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem._disposeEmitterOnDispose=!0,q.particleSystem.disposeOnStop=!0,q}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem=this.particleSystem.serialize(R),q}static _ParseParticleSystem(R,q,L){throw(0,ZR.d)("ParseParticle")}static Parse(R,q,L){const B=R.particleSystem,N=new zR(zR._ParseParticleSystem(B,q,L,!0));return N.type=R.type,N.inheritDirection=R.inheritDirection,N.inheritedVelocityAmount=R.inheritedVelocityAmount,N.particleSystem._isSubEmitter=!0,N}dispose(){this.particleSystem.dispose()}}var YR=L(10834);function FR(R,q){const L=new c;return L.direction1=R,L.direction2=q,L}function CR(){return new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function eR(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function yR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.m(0,1,0),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0);return new f(R,q,L)}function UR(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function nR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.m(0,1,0);return new r(R,q,L,N,h)}function rR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new y(R,q)}function pR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0);return new U(R,q,L,N)}class cR extends NR{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=R=>{if(!this._subEmitters||0===this._subEmitters.length)return;const q=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[q].forEach((q=>{if(1===q.type){const L=q.clone();R._inheritParticleInfoToSubEmitter(L),L.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(L.particleSystem),L.particleSystem.start()}}))}}createPointEmitter(R,q){const L=FR(R,q);return this.particleEmitterType=L,L}createHemisphericEmitter(){const R=CR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=eR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=yR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=UR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=nR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.m(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=rR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=pR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,q,L,B){const N=new e;return this.particleEmitterType=N,this.direction1=R,this.direction2=q,this.minEmitBox=L,this.maxEmitBox=B,N}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((R=>{R instanceof cR?this._subEmitters.push([new zR(R)]):R instanceof zR?this._subEmitters.push([R]):R instanceof Array&&this._subEmitters.push(R)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((R=>{R.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const R=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==R&&this._rootParticleSystem.activeSubSystems.splice(R,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(R){R&&this._stopSubEmitters()}_prepareParticle(R){if(this._subEmitters&&this._subEmitters.length>0){const q=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];R._attachedSubEmitters=[],q.forEach((q=>{if(0===q.type){const L=q.clone();R._attachedSubEmitters.push(L),L.particleSystem.start()}}))}}_onDispose(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var L;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),R)&&(null===(L=this.particles)||void 0===L||L.forEach((R=>{if(R._attachedSubEmitters)for(let q=R._attachedSubEmitters.length-1;q>=0;q-=1)R._attachedSubEmitters[q].dispose()})));if(q&&this.activeSubSystems)for(let B=this.activeSubSystems.length-1;B>=0;B-=1)this.activeSubSystems[B].dispose();if(this._subEmitters&&this._subEmitters.length){for(let R=0;R<this._subEmitters.length;R++)for(const q of this._subEmitters[R])q.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(R,q,L,N){let h;h=L instanceof YR.e?null:L;const Y=(0,z.d)("BABYLON.Texture");if(Y&&h&&(R.texture?q.particleTexture=Y.Parse(R.texture,h,N):R.textureName&&(q.particleTexture=new Y(N+R.textureName,h,!1,void 0===R.invertY||R.invertY),q.particleTexture.name=R.textureName)),R.emitterId||0===R.emitterId||void 0!==R.j?R.emitterId&&h?q.j=h.getLastMeshById(R.emitterId):q.j=B.m.Ig(R.j):q.j=B.m.Zero(),q.isLocal=!!R.isLocal,void 0!==R.renderingGroupId&&(q.renderingGroupId=R.renderingGroupId),void 0!==R.isBillboardBased&&(q.isBillboardBased=R.isBillboardBased),void 0!==R.billboardMode&&(q.billboardMode=R.billboardMode),void 0!==R.useLogarithmicDepth&&(q.useLogarithmicDepth=R.useLogarithmicDepth),R.animations){for(let L=0;L<R.animations.length;L++){const B=R.animations[L],N=(0,z.d)("BABYLON.Animation");N&&q.animations.push(N.Parse(B))}q.beginAnimationOnStart=R.beginAnimationOnStart,q.beginAnimationFrom=R.beginAnimationFrom,q.beginAnimationTo=R.beginAnimationTo,q.beginAnimationLoop=R.beginAnimationLoop}if(R.autoAnimate&&h&&h.beginAnimation(q,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),q.startDelay=0|R.startDelay,q.minAngularSpeed=R.minAngularSpeed,q.maxAngularSpeed=R.maxAngularSpeed,q.minSize=R.minSize,q.maxSize=R.maxSize,R.minScaleX&&(q.minScaleX=R.minScaleX,q.maxScaleX=R.maxScaleX,q.minScaleY=R.minScaleY,q.maxScaleY=R.maxScaleY),void 0!==R.preWarmCycles&&(q.preWarmCycles=R.preWarmCycles,q.preWarmStepOffset=R.preWarmStepOffset),void 0!==R.minInitialRotation&&(q.minInitialRotation=R.minInitialRotation,q.maxInitialRotation=R.maxInitialRotation),q.minLifeTime=R.minLifeTime,q.maxLifeTime=R.maxLifeTime,q.minEmitPower=R.minEmitPower,q.maxEmitPower=R.maxEmitPower,q.emitRate=R.emitRate,q.gravity=B.m.Ig(R.gravity),R.noiseStrength&&(q.noiseStrength=B.m.Ig(R.noiseStrength)),q.color1=Z.g.Ig(R.color1),q.color2=Z.g.Ig(R.color2),q.colorDead=Z.g.Ig(R.colorDead),q.updateSpeed=R.updateSpeed,q.targetStopDuration=R.targetStopDuration,q.blendMode=R.blendMode,R.colorGradients)for(const B of R.colorGradients)q.addColorGradient(B.gradient,Z.g.Ig(B.color1),B.color2?Z.g.Ig(B.color2):void 0);if(R.rampGradients){for(const L of R.rampGradients)q.addRampGradient(L.gradient,Z.e.Ig(L.color));q.useRampGradients=R.useRampGradients}if(R.colorRemapGradients)for(const B of R.colorRemapGradients)q.addColorRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.alphaRemapGradients)for(const B of R.alphaRemapGradients)q.addAlphaRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.sizeGradients)for(const B of R.sizeGradients)q.addSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.angularSpeedGradients)for(const B of R.angularSpeedGradients)q.addAngularSpeedGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.velocityGradients)for(const B of R.velocityGradients)q.addVelocityGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.dragGradients)for(const B of R.dragGradients)q.addDragGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.emitRateGradients)for(const B of R.emitRateGradients)q.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.startSizeGradients)for(const B of R.startSizeGradients)q.addStartSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.lifeTimeGradients)for(const B of R.lifeTimeGradients)q.addLifeTimeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(R.limitVelocityGradients){for(const L of R.limitVelocityGradients)q.addLimitVelocityGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);q.limitVelocityDamping=R.limitVelocityDamping}if(R.noiseTexture&&h){const L=(0,z.d)("BABYLON.ProceduralTexture");q.noiseTexture=L.Parse(R.noiseTexture,h,N)}let F;if(R.particleEmitterType){switch(R.particleEmitterType.type){case"SphereParticleEmitter":F=new d;break;case"SphereDirectedParticleEmitter":F=new f;break;case"ConeEmitter":case"ConeParticleEmitter":F=new y;break;case"ConeDirectedParticleEmitter":F=new U;break;case"CylinderParticleEmitter":F=new n;break;case"CylinderDirectedParticleEmitter":F=new r;break;case"HemisphericParticleEmitter":F=new p;break;case"PointParticleEmitter":F=new c;break;case"MeshParticleEmitter":F=new t;break;case"CustomParticleEmitter":F=new v;break;default:F=new e}F.parse(R.particleEmitterType,h)}else F=new e,F.parse(R,h);q.particleEmitterType=F,q.startSpriteCellID=R.startSpriteCellID,q.endSpriteCellID=R.endSpriteCellID,q.spriteCellLoop=R.spriteCellLoop??!0,q.spriteCellWidth=R.spriteCellWidth,q.spriteCellHeight=R.spriteCellHeight,q.spriteCellChangeSpeed=R.spriteCellChangeSpeed,q.spriteRandomStartCell=R.spriteRandomStartCell,q.disposeOnStop=R.disposeOnStop??!1,q.manualEmitCount=R.manualEmitCount??-1}static Parse(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const z=R.name;let Y,F,C=null,e=null;if(q instanceof YR.e?Y=q:(F=q,Y=F.getEngine()),R.customShader&&Y.createEffectForParticles){e=R.customShader;const q=e.shaderOptions.defines.length>0?e.shaderOptions.defines.join("\n"):"";C=Y.createEffectForParticles(e.shaderPath.fragmentElement,e.shaderOptions.uniforms,e.shaderOptions.samplers,q)}const y=new cR(z,h||R.nb,q,C,R.isAnimationSheetEnabled);if(y.customShader=e,y._rootUrl=L,R.id&&(y.id=R.id),R.subEmitters){y.subEmitters=[];for(const B of R.subEmitters){const R=[];for(const N of B)R.push(zR.Parse(N,q,L));y.subEmitters.push(R)}}return cR._Parse(R,y,q,L),R.textureMask&&(y.textureMask=Z.g.Ig(R.textureMask)),R.Rf&&(y.Rf=B.m.Ig(R.Rf)),R.preventAutoStart&&(y.preventAutoStart=R.preventAutoStart),N||y.preventAutoStart||y.start(),y}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};if(cR._Serialize(q,this,R),q.textureMask=this.textureMask.dj(),q.customShader=this.customShader,q.preventAutoStart=this.preventAutoStart,q.Rf=this.Rf.dj(),this.subEmitters){q.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const L of this._subEmitters){const B=[];for(const q of L)B.push(q.serialize(R));q.subEmitters.push(B)}}return q}static _Serialize(R,q,L){if(R.name=q.name,R.id=q.id,R.nb=q.getCapacity(),R.disposeOnStop=q.disposeOnStop,R.manualEmitCount=q.manualEmitCount,q.j.position){const L=q.j;R.emitterId=L.id}else{const L=q.j;R.j=L.dj()}q.particleEmitterType&&(R.particleEmitterType=q.particleEmitterType.serialize()),q.particleTexture&&(L?R.texture=q.particleTexture.serialize():(R.textureName=q.particleTexture.name,R.invertY=!!q.particleTexture._invertY)),R.isLocal=q.isLocal,P.b.AppendSerializedAnimations(q,R),R.beginAnimationOnStart=q.beginAnimationOnStart,R.beginAnimationFrom=q.beginAnimationFrom,R.beginAnimationTo=q.beginAnimationTo,R.beginAnimationLoop=q.beginAnimationLoop,R.startDelay=q.startDelay,R.renderingGroupId=q.renderingGroupId,R.isBillboardBased=q.isBillboardBased,R.billboardMode=q.billboardMode,R.minAngularSpeed=q.minAngularSpeed,R.maxAngularSpeed=q.maxAngularSpeed,R.minSize=q.minSize,R.maxSize=q.maxSize,R.minScaleX=q.minScaleX,R.maxScaleX=q.maxScaleX,R.minScaleY=q.minScaleY,R.maxScaleY=q.maxScaleY,R.minEmitPower=q.minEmitPower,R.maxEmitPower=q.maxEmitPower,R.minLifeTime=q.minLifeTime,R.maxLifeTime=q.maxLifeTime,R.emitRate=q.emitRate,R.gravity=q.gravity.dj(),R.noiseStrength=q.noiseStrength.dj(),R.color1=q.color1.dj(),R.color2=q.color2.dj(),R.colorDead=q.colorDead.dj(),R.updateSpeed=q.updateSpeed,R.targetStopDuration=q.targetStopDuration,R.blendMode=q.blendMode,R.preWarmCycles=q.preWarmCycles,R.preWarmStepOffset=q.preWarmStepOffset,R.minInitialRotation=q.minInitialRotation,R.maxInitialRotation=q.maxInitialRotation,R.startSpriteCellID=q.startSpriteCellID,R.spriteCellLoop=q.spriteCellLoop,R.endSpriteCellID=q.endSpriteCellID,R.spriteCellChangeSpeed=q.spriteCellChangeSpeed,R.spriteCellWidth=q.spriteCellWidth,R.spriteCellHeight=q.spriteCellHeight,R.spriteRandomStartCell=q.spriteRandomStartCell,R.isAnimationSheetEnabled=q.isAnimationSheetEnabled,R.useLogarithmicDepth=q.useLogarithmicDepth;const B=q.getColorGradients();if(B){R.colorGradients=[];for(const q of B){const L={gradient:q.gradient,color1:q.color1.dj()};q.color2?L.color2=q.color2.dj():L.color2=q.color1.dj(),R.colorGradients.push(L)}}const N=q.getRampGradients();if(N){R.rampGradients=[];for(const q of N){const L={gradient:q.gradient,color:q.color.dj()};R.rampGradients.push(L)}R.useRampGradients=q.useRampGradients}const h=q.getColorRemapGradients();if(h){R.colorRemapGradients=[];for(const q of h){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.colorRemapGradients.push(L)}}const Z=q.getAlphaRemapGradients();if(Z){R.alphaRemapGradients=[];for(const q of Z){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.alphaRemapGradients.push(L)}}const z=q.getSizeGradients();if(z){R.sizeGradients=[];for(const q of z){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.sizeGradients.push(L)}}const Y=q.getAngularSpeedGradients();if(Y){R.angularSpeedGradients=[];for(const q of Y){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.angularSpeedGradients.push(L)}}const F=q.getVelocityGradients();if(F){R.velocityGradients=[];for(const q of F){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.velocityGradients.push(L)}}const C=q.getDragGradients();if(C){R.dragGradients=[];for(const q of C){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.dragGradients.push(L)}}const e=q.getEmitRateGradients();if(e){R.emitRateGradients=[];for(const q of e){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.emitRateGradients.push(L)}}const y=q.getStartSizeGradients();if(y){R.startSizeGradients=[];for(const q of y){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.startSizeGradients.push(L)}}const U=q.getLifeTimeGradients();if(U){R.lifeTimeGradients=[];for(const q of U){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.lifeTimeGradients.push(L)}}const n=q.getLimitVelocityGradients();if(n){R.limitVelocityGradients=[];for(const q of n){const L={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?L.factor2=q.factor2:L.factor2=q.factor1,R.limitVelocityGradients.push(L)}R.limitVelocityDamping=q.limitVelocityDamping}q.noiseTexture&&(R.noiseTexture=q.noiseTexture.serialize())}clone(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let N=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){N=this.customShader;const R=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"",q=h.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,R);B[0]?B[0].effect=q:this.setCustomEffect(q,0)}const Z=this.serialize(L),z=cR.Parse(Z,this._scene||this._engine,this._rootUrl);return z.name=R,z.customShader=N,z._customWrappers=B,void 0===q&&(q=this.j),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.j=q,this.preventAutoStart||z.start(),z}}cR.BILLBOARDMODE_Y=2,cR.BILLBOARDMODE_ALL=7,cR.BILLBOARDMODE_STRETCHED=8,cR.BILLBOARDMODE_STRETCHED_LOCAL=9,zR._ParseParticleSystem=cR.Parse;var dR=L(11104),fR=L(11071),vR=L(11537);vR.d.prototype.createTransformFeedback=function(){const R=this._gl.createTransformFeedback();if(!R)throw new Error("Unable to create Transform Feedback");return R},vR.d.prototype.deleteTransformFeedback=function(R){this._gl.deleteTransformFeedback(R)},vR.d.prototype.bindTransformFeedback=function(R){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,R)},vR.d.prototype.beginTransformFeedback=function(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(R?this._gl.POINTS:this._gl.TRIANGLES)},vR.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},vR.d.prototype.setTranformFeedbackVaryings=function(R,q){this._gl.transformFeedbackVaryings(R,q,this._gl.INTERLEAVED_ATTRIBS)},vR.d.prototype.bindTransformFeedbackBuffer=function(R){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R?R.underlyingResource:null)},vR.d.prototype.readTransformFeedbackBuffer=function(R){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R)};const TR="clipPlaneFragmentDeclaration2",tR="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";I.b.IncludesShadersStore[TR]=tR;L(11654),L(11661),L(11665),L(11673),L(11677),L(11681),L(11690),L(11697);const DR="gpuRenderParticlesPixelShader",SR="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";I.b.ShadersStore[DR]=SR;const IR="clipPlaneVertexDeclaration2",KR="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";I.b.IncludesShadersStore[IR]=KR;L(11706),L(11710),L(11718),L(11725);const mR="gpuRenderParticlesVertexShader",oR="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";I.b.ShadersStore[mR]=oR;class lR extends Y{static get IsSupported(){if(!X.b.LastCreatedEngine)return!1;const R=X.b.LastCreatedEngine.getCaps();return R.supportTransformFeedbacks||R.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(R){this._maxActiveParticleCount=Math.min(R,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(R){this.maxActiveParticleCount=R}createPointEmitter(R,q){const L=FR(R,q);return this.particleEmitterType=L,L}createHemisphericEmitter(){const R=CR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=eR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=yR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=UR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=nR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.m(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=rR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=pR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.m(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,q,L,B){const N=new e;return this.particleEmitterType=N,this.direction1=R,this.direction2=q,this.minEmitBox=L,this.maxEmitBox=B,N}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==cR.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(cR.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(cR.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";R?setTimeout((()=>{this.start(0)}),R):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var R;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[q])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new RR.b(this._engine),this._customWrappers[q].effect=R}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(R,q,L){return super._removeGradientAndTexture(R,q,L),this._releaseBuffers(),this}addColorGradient(R,q){this._colorGradients||(this._colorGradients=[]);const L=new j(R,q);return this._colorGradients.push(L),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(R&&this._colorGradients.sort(((R,q)=>R.gradient<q.gradient?-1:R.gradient>q.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(R){return this._removeGradientAndTexture(R,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const q in this._drawWrappers){var R;null===(R=this._drawWrappers[q].drawContext)||void 0===R||R.reset()}}_addFactorGradient(R,q,L){const B=new s(q,L);R.push(B),this._releaseBuffers()}addSizeGradient(R,q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,R,q),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(R){return this._removeGradientAndTexture(R,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(R,q){if(!R)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&R.sort(((R,q)=>R.gradient<q.gradient?-1:R.gradient>q.gradient?1:0));const L=this;L[q]&&(L[q].dispose(),L[q]=null)}addAngularSpeedGradient(R,q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,R,q),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(R){return this._removeGradientAndTexture(R,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(R,q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,R,q),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(R){return this._removeGradientAndTexture(R,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(R,q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,R,q),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(R){return this._removeGradientAndTexture(R,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(R,q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,R,q),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(R){return this._removeGradientAndTexture(R,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(R){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(R),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ej=new M.b,this.onStoppedObservable=new M.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,L&&"Scene"!==L.getClassName()?(this._engine=L,this.defaultProjectionMatrix=B.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=L||X.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.lj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,z.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,z.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new RR.b(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers={0:new RR.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(q=q??{}).randomTextureSize||delete q.randomTextureSize;const Z={nb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...q},Y=q;isFinite(Y)&&(Z.nb=Y),this._capacity=Z.nb,this._maxActiveParticleCount=Z.nb,this._currentActiveCount=0,this._isAnimationSheetEnabled=h,this.particleEmitterType=new e;const F=Math.min(this._engine.getCaps().maxTextureSize,Z.randomTextureSize);let C=[];for(let B=0;B<F;++B)C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random());this._randomTexture=new b.c(new Float32Array(C),F,1,5,L,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,C=[];for(let B=0;B<F;++B)C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random());this._randomTexture2=new b.c(new Float32Array(C),F,1,5,L,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=F}_reset(){this._releaseBuffers()}_createVertexBuffers(R,q,L){const B={};B.position=q.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let N=3;B.age=q.createVertexBuffer("age",N,1,this._attributesStrideSize,!0),N+=1,B.size=q.createVertexBuffer("size",N,3,this._attributesStrideSize,!0),N+=3,B.life=q.createVertexBuffer("life",N,1,this._attributesStrideSize,!0),N+=1,N+=4,this.billboardMode===cR.BILLBOARDMODE_STRETCHED&&(B.direction=q.createVertexBuffer("direction",N,3,this._attributesStrideSize,!0)),N+=3,this._platform.alignDataInBuffer&&(N+=1),this.particleEmitterType instanceof v&&(N+=3,this._platform.alignDataInBuffer&&(N+=1)),this._colorGradientsTexture||(B.color=q.createVertexBuffer("color",N,4,this._attributesStrideSize,!0),N+=4),this._isBillboardBased||(B.initialDirection=q.createVertexBuffer("initialDirection",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),this.noiseTexture&&(B.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1),B.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),B.angle=q.createVertexBuffer("angle",N,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?N++:N+=2,this._isAnimationSheetEnabled&&(B.cellIndex=q.createVertexBuffer("cellIndex",N,1,this._attributesStrideSize,!0),N+=1,this.spriteRandomStartCell&&(B.cellStartOffset=q.createVertexBuffer("cellStartOffset",N,1,this._attributesStrideSize,!0),N+=1)),B.offset=L.createVertexBuffer("offset",0,2),B.uv=L.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(B),this._platform.createVertexBuffers(R,B),this.resetDrawCache()}_initialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!R)return;const q=this._engine,L=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof v&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const N=this.particleEmitterType instanceof v,h=B.h.o[0];let Z=0;for(let B=0;B<this._capacity;B++)if(L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),N?(this.particleEmitterType.particleDestinationGenerator(B,null,h),L.push(h.x),L.push(h.y),L.push(h.z)):(L.push(0),L.push(0),L.push(0)),this._platform.alignDataInBuffer&&L.push(0),Z+=16,N&&(this.particleEmitterType.particlePositionGenerator(B,null,h),L.push(h.x),L.push(h.y),L.push(h.z),this._platform.alignDataInBuffer&&L.push(0),Z+=4),this._colorGradientsTexture||(L.push(0),L.push(0),L.push(0),L.push(0),Z+=4),this.isBillboardBased||(L.push(0),L.push(0),L.push(0),this._platform.alignDataInBuffer&&L.push(0),Z+=4),this.noiseTexture&&(L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),Z+=8),L.push(0),Z+=1,this._angularSpeedGradientsTexture||(L.push(0),Z+=1),this._isAnimationSheetEnabled&&(L.push(0),Z+=1,this.spriteRandomStartCell&&(L.push(0),Z+=1)),this._platform.alignDataInBuffer){let R=3-(Z+3&3);for(Z+=R;R-- >0;)L.push(0)}const z=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),Y=this._platform.createParticleBuffer(L),F=this._platform.createParticleBuffer(L);this._buffer0=new T.d(q,Y,!1,this._attributesStrideSize),this._buffer1=new T.d(q,F,!1,this._attributesStrideSize),this._spriteBuffer=new T.d(q,z,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let R=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(R+="\n#define BILLBOARD"),this._colorGradientsTexture&&(R+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(R+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(R+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(R+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(R+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(R+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(R+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(R+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(R+="\n#define NOISE"),this.isLocal&&(R+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===R||(this._cachedUpdateDefines=R,this._updateBuffer=this._platform.createUpdateBuffer(R)),this._platform.isUpdateBufferReady()}_getWrapper(R){const q=this._getCustomDrawWrapper(R);if(null!==q&&void 0!==q&&q.effect)return q;const L=[];this.fillDefines(L,R);let B=this._drawWrappers[R];B||(B=new RR.b(this._engine),B.drawContext&&(B.drawContext.useInstancing=!0),this._drawWrappers[R]=B);const N=L.join("\n");if(B.defines!==N){const R=[],q=[],L=[];this.fillUniformsAttributesAndSamplerNames(q,R,L),B.setEffect(this._engine.createEffect("gpuRenderParticles",R,q,L,N),N)}return B}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=[T.e.PositionKind,"age","life","size","angle"];return R||N.push(T.e.ColorKind),q&&N.push("cellIndex"),L||N.push("initialDirection"),B&&N.push("direction"),N.push("offset",T.e.UVKind),N}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["emitterWM","Rf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,qR.e)(B),R&&B.push("sheetInfos"),q&&B.push("logarithmicDepthConstant"),L&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qR.k)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==fR.b.FOGMODE_NONE&&R.push("#define FOG")),q===cR.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this.isLocal&&R.push("#define LOCAL"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case cR.BILLBOARDMODE_Y:R.push("#define BILLBOARDY");break;case cR.BILLBOARDMODE_STRETCHED:R.push("#define BILLBOARDSTRETCHED");break;case cR.BILLBOARDMODE_ALL:R.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&R.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),L&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,q,L){q.push(...lR._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===cR.BILLBOARDMODE_STRETCHED)),R.push(...lR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),L.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(dR.d.PrepareUniforms(R,this._imageProcessingConfigurationDefines),dR.d.PrepareSamplers(L,this._imageProcessingConfigurationDefines))}animate(){var R;let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(q?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(R,q){const L=this[q];if(!R||!R.length||L)return;const B=new Float32Array(this._rawTextureWidth);for(let N=0;N<this._rawTextureWidth;N++){const q=N/this._rawTextureWidth;A.GetCurrentGradient(q,R,((R,q,L)=>{B[N]=(0,F.h)(R.factor1,q.factor1,L)}))}this[q]=b.c.CreateRTexture(B,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[q].name=q.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const R=new Uint8Array(4*this._rawTextureWidth),q=Z.i.ob[0];for(let L=0;L<this._rawTextureWidth;L++){const B=L/this._rawTextureWidth;A.GetCurrentGradient(B,this._colorGradients,((B,N,h)=>{Z.g.LerpToRef(B.color1,N.color1,h,q),R[4*L]=255*q.r,R[4*L+1]=255*q.g,R[4*L+2]=255*q.b,R[4*L+3]=255*q.a}))}this._colorGradientsTexture=b.c.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(R,q){var L,N,h,Z;const z=this._getWrapper(R),Y=z.effect;this._engine.enableEffect(z);const F=(null===(L=this._scene)||void 0===L?void 0:L.getViewMatrix())||B.c.IdentityReadOnly;if(Y.setMatrix("view",F),Y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),Y.setTexture("diffuseSampler",this.particleTexture),Y.setVector2("translationPivot",this.translationPivot),Y.setVector3("Rf",this.Rf),this.isLocal&&Y.setMatrix("emitterWM",q),this._colorGradientsTexture?Y.setTexture("colorGradientSampler",this._colorGradientsTexture):Y.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();Y.setFloat3("sheetInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,R.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;Y.setVector3("eyePosition",R.globalPosition)}const C=Y.defines;if(this._scene&&((0,qR.f)(Y,this,this._scene),this.applyFog&&(0,LR.g)(this._scene,void 0,Y)),C.indexOf("#define BILLBOARDMODE_ALL")>=0){const R=F.clone();R.invert(),Y.setMatrix("invView",R)}switch(this.useLogarithmicDepth&&this._scene&&(0,LR.l)(C,Y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Y),R){case cR.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case cR.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case cR.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case cR.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,Y,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Y),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(R){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!R)if(this.j.position){R=this.j.getWorldMatrix()}else{const q=this.j;R=B.h.Matrix[0],B.c.TranslationToRef(q.x,q.y,q.z,R)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",R),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q}render(){let R,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!q&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let R=0;R<this.preWarmCycles;R++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const R=0|this._accumulatedCount;this._accumulatedCount-=R,this._currentActiveCount+=R}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){R=this.j.getWorldMatrix()}else{const q=this.j;R=B.h.Matrix[0],B.c.TranslationToRef(q.x,q.y,q.z,R)}const N=this._engine;this.updateInAnimate||this._update(R);let h=0;return q||L||(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0),h=this.blendMode===cR.BLENDMODE_MULTIPLYADD?this._render(cR.BLENDMODE_MULTIPLY,R)+this._render(cR.BLENDMODE_ADD,R):this._render(this.blendMode,R),this._engine.setAlphaMode(0)),h}rebuild(){const R=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(R,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,R()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const q in this._drawWrappers){this._drawWrappers[q].dispose()}if(this._drawWrappers={},this._scene){const R=this._scene.lj.indexOf(this);R>-1&&this._scene.lj.splice(R,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let q=0;q<this._renderVertexBuffers.length;++q){const R=this._renderVertexBuffers[q];for(const q in R)R[q].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ej.notifyObservers(this),this.ej.clear()}clone(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let N=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){N=this.customShader;const R=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";B[0]=h.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,R,void 0,void 0,void 0,this)}const Z=this.serialize(L),z=lR.Parse(Z,this._scene||this._engine,this._rootUrl);return z.name=R,z.customShader=N,z._customWrappers=B,void 0===q&&(q=this.j),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.j=q,z}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return cR._Serialize(q,this,R),q.activeParticleCount=this.activeParticleCount,q.randomTextureSize=this._randomTextureSize,q.customShader=this.customShader,q}static Parse(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const h=R.name;let Z,z;q instanceof YR.e?Z=q:(z=q,Z=z.getEngine());const Y=new lR(h,{nb:N||R.nb,randomTextureSize:R.randomTextureSize},q,null,R.isAnimationSheetEnabled);if(Y._rootUrl=L,R.customShader&&Z.createEffectForParticles){const q=R.customShader,L=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",B=Z.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,L,void 0,void 0,void 0,Y);Y.setCustomEffect(B,0),Y.customShader=q}return R.id&&(Y.id=R.id),R.activeParticleCount&&(Y.activeParticleCount=R.activeParticleCount),cR._Parse(R,Y,q,L),R.preventAutoStart&&(Y.preventAutoStart=R.preventAutoStart),B||Y.preventAutoStart||Y.start(),Y}}var GR=L(10757),WR=L(11733),HR=L(11051);class PR{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(R){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const q of this.systems)q.j=R;this._emitterNode=R}setEmitterAsSphere(R,q,L){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:R,renderingGroupId:q};const B=(0,WR.e)("emitterSphere",{diameter:R.diameter,segments:R.segments},L);B.renderingGroupId=q;const N=new HR.c("emitterSphereMaterial",L);N.emissiveColor=R.color,B.material=N;for(const h of this.systems)h.j=B;this._emitterNode=B}start(R){for(const q of this.systems)R&&(q.j=R),q.start()}dispose(){for(const R of this.systems)R.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={systems:[]};for(const L of this.systems)q.systems.push(L.serialize(R));return this._emitterNode&&(q.j=this._emitterCreationOptions),q}static Parse(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;const N=new PR,h=this.BaseAssetsUrl+"/textures/";q=q||X.b.LastCreatedScene;for(const Z of R.systems)N.systems.push(L?lR.Parse(Z,q,h,!0,B):cR.Parse(Z,q,h,!0,B));if(R.j){const L=R.j.options;if("Sphere"===R.j.kind)N.setEmitterAsSphere({diameter:L.diameter,segments:L.segments,color:Z.e.Ig(L.color)},R.j.renderingGroupId,q)}return N}}PR.BaseAssetsUrl="https://assets.babylonjs.com/particles";var OR=L(10791);class ER{static CreateDefault(R){let q,L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,B=arguments.length>2?arguments[2]:void 0;return q=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new lR("default system",{nb:L},B):new cR("default system",L,B),q.j=R,q.particleTexture=new O.c("https://assets.babylonjs.com/textures/flare.png",q.va()),q.createConeEmitter(.1,Math.PI/4),q.color1=new Z.g(1,1,1,1),q.color2=new Z.g(1,1,1,1),q.colorDead=new Z.g(1,1,1,0),q.minSize=.1,q.maxSize=.1,q.minEmitPower=2,q.maxEmitPower=2,q.updateSpeed=1/60,q.emitRate=30,q}static CreateAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;q||(q=X.b.LastCreatedScene);const N={};return q.addPendingData(N),new Promise(((h,Z)=>{if(L&&!lR.IsSupported)return q.removePendingData(N),Z("Particle system with GPU is not supported.");GR.f.LoadFile(`${ER.BaseAssetsUrl}/systems/${R}.json`,(R=>{q.removePendingData(N);const Z=JSON.parse(R.toString());return h(PR.Parse(Z,q,L,B))}),void 0,void 0,void 0,(()=>(q.removePendingData(N),Z(`An error occurred with the creation of your particle system. Check if your type '${R}' exists.`))))}))}static ExportSet(R){const q=new PR;for(const L of R)q.systems.push(L);return q}static ParseFromFileAsync(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",h=arguments.length>5?arguments[5]:void 0;return new Promise(((Z,z)=>{const Y=new OR.b;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const q=JSON.parse(Y.responseText);let z;z=B?lR.Parse(q,L,N,!1,h):cR.Parse(q,L,N,!1,h),R&&(z.name=R),Z(z)}else z("Unable to load the particle system")})),Y.open("GET",q),Y.send()}))}static ParseFromSnippetAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0;if("_BLANK"===R){const R=this.CreateDefault(null);return R.start(),Promise.resolve(R)}return new Promise(((h,Z)=>{const z=new OR.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const Z=JSON.parse(JSON.parse(z.responseText).jsonPayload),Y=JSON.parse(Z.particleSystem);let F;F=L?lR.Parse(Y,q,B,!1,N):cR.Parse(Y,q,B,!1,N),F.snippetId=R,h(F)}else Z("Unable to load the snippet "+R)})),z.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),z.send()}))}}ER.BaseAssetsUrl=PR.BaseAssetsUrl,ER.SnippetUrl="https://snippet.babylonjs.com",ER.CreateFromSnippetAsync=ER.ParseFromSnippetAsync;var aR=L(11329),gR=L(11160),QR=L(11738);(0,QR.g)(gR.d.NAME_PARTICLESYSTEM,((R,q,L,B)=>{const N=(0,QR.k)(gR.d.NAME_PARTICLESYSTEM);if(N&&void 0!==R.lj&&null!==R.lj)for(let h=0,Z=R.lj.length;h<Z;h++){const Z=R.lj[h];L.lj.push(N(Z,q,B))}})),(0,QR.d)(gR.d.NAME_PARTICLESYSTEM,((R,q,L)=>{if(R.activeParticleCount){return lR.Parse(R,q,L)}return cR.Parse(R,q,L)})),YR.e.prototype.createEffectForParticles=function(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7?arguments[7]:void 0,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=[],e=[];const y=[];return Y?Y.fillUniformsAttributesAndSamplerNames(e,C,y):(C=cR._GetAttributeNamesOrOptions(),e=cR._GetEffectCreationOptions()),-1===N.indexOf(" BILLBOARD")&&(N+="\n#define BILLBOARD\n"),null!==Y&&void 0!==Y&&Y.isAnimationSheetEnabled&&-1===N.indexOf(" ANIMATESHEET")&&(N+="\n#define ANIMATESHEET\n"),-1===B.indexOf("diffuseSampler")&&B.push("diffuseSampler"),this.createEffect({vertex:(null===Y||void 0===Y?void 0:Y.vertexShaderName)??"particles",fragmentElement:R},C,e.concat(q),y.concat(B),N,h,Z,z,void 0,F,(async()=>{0===F?await Promise.resolve().then(L.bind(L,11762)):await Promise.resolve().then(L.bind(L,11825))}))},aR.d.prototype.getEmittedParticleSystems=function(){const R=[];for(let q=0;q<this.va().lj.length;q++){const L=this.va().lj[q];L.j===this&&R.push(L)}return R},aR.d.prototype.getHierarchyEmittedParticleSystems=function(){const R=[],q=this.getDescendants();q.push(this);for(let L=0;L<this.va().lj.length;L++){const B=this.va().lj[L],N=B.j;N.position&&-1!==q.indexOf(N)&&R.push(B)}return R};L(11228),L(11236),L(11375);L(11357),L(11745),L(11382),L(11218),L(11386);L(11570);var iR;L(11751),L(11283);!function(R){R[R.Color=2]="Color",R[R.UV=1]="UV",R[R.Random=0]="Random",R[R.Stated=3]="Stated"}(iR||(iR={}));L(11756),L(11762),L(11772),L(11825)},11618:(R,q,L)=>{"use strict";L.d(q,{e:()=>n});var B=L(11053),N=L(11065),h=L(10760),Z=L(11081),z=L(10837),Y=L(11058),F=L(11117),C=L(10889),e=L(10834),y=L(10900),U=L(11621);e.e.prototype.setTextureFromPostProcess=function(R,q,L){var B;let N=null;q&&(q._forcedOutputTexture?N=q._forcedOutputTexture:q._textures.data[q._currentRenderTextureInd]&&(N=q._textures.data[q._currentRenderTextureInd])),this._bindTexture(R,(null===(B=N)||void 0===B?void 0:B.texture)??null,L)},e.e.prototype.setTextureFromPostProcessOutput=function(R,q,L){var B;this._bindTexture(R,(null===q||void 0===q||null===(B=q._outputTexture)||void 0===B?void 0:B.texture)??null,L)},z.c.prototype.setTextureFromPostProcess=function(R,q){this._engine.setTextureFromPostProcess(this._samplers[R],q,R)},z.c.prototype.setTextureFromPostProcessOutput=function(R,q){this._engine.setTextureFromPostProcessOutput(this._samplers[R],q,R)};class n{static get ForceGLSL(){return U.d.ForceGLSL}static set ForceGLSL(R){U.d.ForceGLSL=R}static RegisterShaderCodeProcessing(R,q){U.d.RegisterShaderCodeProcessing(R,q)}get name(){return this._effectWrapper.name}set name(R){this._effectWrapper.name=R}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(R){this._effectWrapper.alphaMode=R}get samples(){return this._samples}set samples(R){this._samples=Math.min(R,this._engine.getCaps().maxMSAASamples),this._textures.forEach((R=>{R.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(R){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),R&&(this._onActivateObserver=this.onActivateObservable.add(R))}set onSizeChanged(R){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(R)}set onApply(R){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(R)}set onBeforeRender(R){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(R)}set onAfterRender(R){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(R)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(R){this._forcedOutputTexture=R}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Td(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(R,q,L,B,z,Y){var F;let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,e=arguments.length>7?arguments[7]:void 0,y=arguments.length>8?arguments[8]:void 0,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",d=arguments.length>12?arguments[12]:void 0,f=arguments.length>13&&void 0!==arguments[13]&&arguments[13],v=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,T=arguments.length>15?arguments[15]:void 0,t=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Oi=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new N.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new Z.i(1,1),this._texelSize=Z.i.Zero(),this.onActivateObservable=new h.b,this.onSizeChangedObservable=new h.b,this.onApplyObservable=new h.b,this.onBeforeRenderObservable=new h.b,this.onAfterRenderObservable=new h.b;let D,S=1,I=null;if(L&&!Array.isArray(L)){const R=L;L=R.uniforms??null,B=R.samplers??null,S=R.size??1,Y=R.camera??null,C=R.samplingMode??1,e=R.hd,y=R.reusable,r=Array.isArray(R.defines)?R.defines.join("\n"):R.defines??null,p=R.textureType??0,c=R.vertexUrl??"postprocess",d=R.indexParameters,f=R.blockCompilation??!1,v=R.textureFormat??5,T=R.shaderLanguage??0,I=R.uniformBuffers??null,t=R.extraInitializations,D=R.effectWrapper}else z&&(S="number"===typeof z?z:{width:z.width,height:z.height});const K=!!D;if(this._effectWrapper=D??new U.d({name:R,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:q,hd:e||(null===(F=Y)||void 0===F?void 0:F.va().getEngine()),uniforms:L,samplers:B,uniformBuffers:I,defines:r,vertexUrl:c,indexParameters:d,blockCompilation:f,shaderLanguage:T,extraInitializations:t}),this.name=R,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=Y?(this._camera=Y,this._scene=Y.va(),Y.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):e&&(this._engine=e,this._engine.postProcesses.push(this)),this._options=S,this.renderTargetSamplingMode=C||1,this._reusable=y||!1,this._textureType=p,this._textureFormat=v,this._shaderLanguage=T||0,this._samplers=B||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=q,this._vertexUrl=c,this._parameters=L||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=I||[],this._indexParameters=d,!K){this._webGPUReady=1===this._shaderLanguage;const R=[];this._gatherImports(this._engine.isWebGPU&&!n.ForceGLSL,R),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(f,r,t,R)}}_gatherImports(){let R=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?R.push(Promise.all([L.e(37).then(L.bind(L,13253))])):R.push(Promise.all([Promise.resolve().then(L.bind(L,11627))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(R){return this._disposeTextures(),this._shareOutputWithPostProcess=R,this}useOwnOutput(){0==this._textures.length&&(this._textures=new N.h(2)),this._shareOutputWithPostProcess=null}updateEffect(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6?arguments[6]:void 0,z=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(R,q,L,B,N,h,Z,z),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let N=0;N<this._textureCache.length;N++)if(this._textureCache[N].texture.width===R.width&&this._textureCache[N].texture.height===R.height&&this._textureCache[N].postProcessChannel===L&&this._textureCache[N].texture._generateDepthBuffer===q.generateDepthBuffer&&this._textureCache[N].texture.samples===q.samples)return this._textureCache[N].texture;const B=this._engine.createRenderTargetTexture(R,q);return this._textureCache.push({texture:B,postProcessChannel:L,lastUsedRenderId:-1}),B}_flushTextureCache(){const R=this._renderId;for(let q=this._textureCache.length-1;q>=0;q--)if(R-this._textureCache[q].lastUsedRenderId>100){let R=!1;for(let L=0;L<this._textures.length;L++)if(this._textures.data[L]===this._textureCache[q].texture){R=!0;break}R||(this._textureCache[q].texture.dispose(),this._textureCache.splice(q,1))}}resize(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=R,this.height=q;let h=null;if(L)for(let Y=0;Y<L._postProcesses.length;Y++)if(null!==L._postProcesses[Y]){h=L._postProcesses[Y];break}const Z={width:this.width,height:this.height},z={generateMipMaps:B,generateDepthBuffer:N||h===this,generateStencilBuffer:(N||h===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(Z,z,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(Z,z,1)),this._texelSize.Td(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let R;if(this._shareOutputWithPostProcess)R=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)R=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let q;R=this.inputTexture;for(let L=0;L<this._textureCache.length;L++)if(this._textureCache[L].texture===R){q=this._textureCache[L];break}q&&(q.lastUsedRenderId=this._renderId)}return R}activate(R){var q,L;let B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;const h=(R=R||this._camera).va(),Z=h.getEngine(),z=Z.getCaps().maxTextureSize,Y=(B?B.width:this._engine.getRenderWidth(!0))*this._options|0,F=(B?B.height:this._engine.getRenderHeight(!0))*this._options|0;let C=this._options.width||Y,e=this._options.height||F;const U=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let n=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const R=Z.currentViewport;R&&(C*=R.width,e*=R.height)}(U||this.alwaysForcePOT)&&(this._options.width||(C=Z.needPOTTextures?(0,y.e)(C,z,this.scaleMode):C),this._options.height||(e=Z.needPOTTextures?(0,y.e)(e,z,this.scaleMode):e)),this.width===C&&this.height===e&&(n=this._getTarget())||this.resize(C,e,R,U,N),this._textures.forEach((R=>{R.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(R,this.samples)})),this._flushTextureCache(),this._renderId++}return n||(n=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Td(Y/C,F/e),this._engine.bindFramebuffer(n,0,Y,F,this.forceFullscreenViewport)):(this._scaleRatio.Td(1,1),this._engine.bindFramebuffer(n,0,void 0,void 0,this.forceFullscreenViewport)),null===(q=(L=this._engine)._debugInsertMarker)||void 0===q||q.call(L,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(R),this.Oi&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:h.clearColor,h._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),n}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let R;var q;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),R=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(q=R)||void 0===q?void 0:q.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let R=this._textureCache.length-1;R>=0;R--)this._textureCache[R].texture.dispose();this._textureCache.length=0}setPrePassRenderer(R){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=R.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(R){let q;if(R=R||this._camera,this._disposeTextures(),this._scene&&(q=this._scene.postProcesses.indexOf(this),-1!==q&&this._scene.postProcesses.splice(q,1)),this._parentContainer){const R=this._parentContainer.postProcesses.indexOf(this);R>-1&&this._parentContainer.postProcesses.splice(R,1),this._parentContainer=null}if(q=this._engine.postProcesses.indexOf(this),-1!==q&&this._engine.postProcesses.splice(q,1),R){if(R.detachPostProcess(this),q=R._postProcesses.indexOf(this),0===q&&R._postProcesses.length>0){const R=this._camera._getFirstPostProcess();R&&R.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const R=F.b.Serialize(this),q=this.getCamera()||this._scene&&this._scene.activeCamera;return R.customType="BABYLON."+this.getClassName(),R.cameraId=q?q.id:null,R.reusable=this._reusable,R.textureType=this._textureType,R.fragmentUrl=this._fragmentUrl,R.parameters=this._parameters,R.samplers=this._samplers,R.uniformBuffers=this._uniformBuffers,R.options=this._options,R.defines=this._postProcessDefines,R.textureFormat=this._textureFormat,R.vertexUrl=this._vertexUrl,R.indexParameters=this._indexParameters,R}clone(){const R=this.serialize();R._engine=this._engine,R.cameraId=null;const q=n.Parse(R,this._scene,"");return q?(q.onActivateObservable=this.onActivateObservable.clone(),q.onSizeChangedObservable=this.onSizeChangedObservable.clone(),q.onApplyObservable=this.onApplyObservable.clone(),q.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),q.onAfterRenderObservable=this.onAfterRenderObservable.clone(),q._prePassEffectConfiguration=this._prePassEffectConfiguration,q):null}static Parse(R,q,L){const B=(0,C.d)(R.customType);if(!B||!B._Parse)return null;const N=q?q.getCameraById(R.cameraId):null;return B._Parse(R,N,q,L)}static _Parse(R,q,L,B){return F.b.Parse((()=>new n(R.name,R.fragmentUrl,R.parameters,R.samplers,R.options,q,R.renderTargetSamplingMode,R._engine,R.reusable,R.defines,R.textureType,R.vertexUrl,R.indexParameters,!1,R.textureFormat)),R,L,B)}}(0,B.d)([(0,Y.K)()],n.prototype,"uniqueId",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"name",null),(0,B.d)([(0,Y.K)()],n.prototype,"width",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"height",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"renderTargetSamplingMode",void 0),(0,B.d)([(0,Y.m)()],n.prototype,"clearColor",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"Oi",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"forceAutoClearInAlphaMode",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"alphaMode",null),(0,B.d)([(0,Y.K)()],n.prototype,"alphaConstants",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"enablePixelPerfectMode",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"forceFullscreenViewport",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"scaleMode",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"alwaysForcePOT",void 0),(0,B.d)([(0,Y.K)("samples")],n.prototype,"_samples",void 0),(0,B.d)([(0,Y.K)()],n.prototype,"adaptScaleToCurrentViewport",void 0),(0,C.f)("BABYLON.PostProcess",n)},11150:(R,q,L)=>{"use strict";L.d(q,{b:()=>h});var B=L(11136),N=L(10760);class h{constructor(R){this._vertexBuffers={},this.onBeforeRenderObservable=new N.b,this._scene=R}_prepareBuffers(){if(this._vertexBuffers[B.e.PositionKind])return;const R=[];R.push(1,1),R.push(-1,1),R.push(-1,-1),R.push(1,-1),this._vertexBuffers[B.e.PositionKind]=new B.e(this._scene.getEngine(),R,B.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const R=[];R.push(0),R.push(1),R.push(2),R.push(0),R.push(2),R.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(R)}_rebuild(){const R=this._vertexBuffers[B.e.PositionKind];R&&(R._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this._scene.activeCamera;return!!L&&(q=q||L._postProcesses.filter((R=>null!=R)),!(!q||0===q.length||!this._scene.postProcessesEnabled)&&(q[0].activate(L,R,null!==q&&void 0!==q),!0))}directRender(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Z=this._scene.getEngine();for(let Y=0;Y<R.length;Y++){var z;if(Y<R.length-1)R[Y+1].activate(this._scene.activeCamera,null===q||void 0===q?void 0:q.texture);else q?Z.bindFramebuffer(q,B,void 0,void 0,L,N):h||Z.restoreDefaultFramebuffer(),null===(z=Z._debugInsertMarker)||void 0===z||z.call(Z,`post process ${R[Y].name} output`);const F=R[Y],C=F.apply();C&&(F.onBeforeRenderObservable.notifyObservers(C),this._prepareBuffers(),Z.bindBuffers(this._vertexBuffers,this._indexBuffer,C),Z.drawElementsType(0,0,6),F.onAfterRenderObservable.notifyObservers(C))}Z.setDepthBuffer(!0),Z.setDepthWrite(!0)}_finalizeFrame(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=this._scene.activeCamera;if(!h)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(B=B||h._postProcesses.filter((R=>null!=R))).length||!this._scene.postProcessesEnabled)return;const Z=this._scene.getEngine();for(let Y=0,F=B.length;Y<F;Y++){const C=B[Y];var z;if(Y<F-1)C._outputTexture=B[Y+1].activate(h,null===q||void 0===q?void 0:q.texture);else q?(Z.bindFramebuffer(q,L,void 0,void 0,N),C._outputTexture=q):(Z.restoreDefaultFramebuffer(),C._outputTexture=null),null===(z=Z._debugInsertMarker)||void 0===z||z.call(Z,`post process ${B[Y].name} output`);if(R)break;const e=C.apply();e&&(C.onBeforeRenderObservable.notifyObservers(e),this._prepareBuffers(),Z.bindBuffers(this._vertexBuffers,this._indexBuffer,e),Z.drawElementsType(0,0,6),C.onAfterRenderObservable.notifyObservers(e))}Z.setDepthBuffer(!0),Z.setDepthWrite(!0),Z.setAlphaMode(0)}dispose(){const R=this._vertexBuffers[B.e.PositionKind];R&&(R.dispose(),this._vertexBuffers[B.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11156:(R,q,L)=>{"use strict";L.d(q,{e:()=>z});var B=L(11065),N=L(11081);class h{set opaqueSortCompareFn(R){this._opaqueSortCompareFn=R||h.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(R){this._alphaTestSortCompareFn=R||h.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(R){this._transparentSortCompareFn=R||h.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=R,this._opaqueSubMeshes=new B.h(256),this._transparentSubMeshes=new B.h(256),this._alphaTestSubMeshes=new B.h(256),this._depthOnlySubMeshes=new B.h(256),this._particleSystems=new B.h(256),this._spriteManagers=new B.h(256),this._empty=!0,this._edgesRenderers=new B.d(16),this._scene=q,this.opaqueSortCompareFn=L,this.alphaTestSortCompareFn=N,this.transparentSortCompareFn=h}render(R,q,L,B){if(R)return void R(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const N=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(N.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),N.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const h=N.getStencilBuffer();if(N.setStencilBuffer(!1),q&&this._renderSprites(),L&&this._renderParticles(B),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(N.setStencilBuffer(h),this._scene.useOrderIndependentTransparency){const R=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);R.length&&this._renderTransparent(R)}else this._renderTransparent(this._transparentSubMeshes);N.setAlphaMode(0)}if(N.setStencilBuffer(!1),this._edgesRenderers.length){for(let R=0;R<this._edgesRenderers.length;R++)this._edgesRenderers.data[R].render();N.setAlphaMode(0)}N.setStencilBuffer(h)}_renderOpaqueSorted(R){h._RenderSorted(R,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(R){h._RenderSorted(R,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(R){h._RenderSorted(R,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(R,q,L,B){let Z,z=0;const Y=L?L.globalPosition:h._ZeroVector;if(B)for(;z<R.length;z++)Z=R.data[z],Z._alphaIndex=Z.getMesh().alphaIndex,Z._distanceToCamera=N.m.Distance(Z.getBoundingInfo().boundingSphere.centerWorld,Y);const F=R.length===R.data.length?R.data:R.data.slice(0,R.length);q&&F.sort(q);const C=F[0].getMesh().va();for(z=0;z<F.length;z++)if(Z=F[z],!C._activeMeshesFrozenButKeepClipping||Z.isInFrustum(C._frustumPlanes)){if(B){const R=Z.Ha();if(R&&R.needDepthPrePass){const q=R.va().getEngine();q.setColorWrite(!1),q.setAlphaMode(0),Z.render(!1),q.setColorWrite(!0)}}Z.render(B)}}static defaultTransparentSortCompare(R,q){return R._alphaIndex>q._alphaIndex?1:R._alphaIndex<q._alphaIndex?-1:h.backToFrontSortCompare(R,q)}static backToFrontSortCompare(R,q){return R._distanceToCamera<q._distanceToCamera?1:R._distanceToCamera>q._distanceToCamera?-1:0}static frontToBackSortCompare(R,q){return R._distanceToCamera<q._distanceToCamera?-1:R._distanceToCamera>q._distanceToCamera?1:0}static PainterSortCompare(R,q){const L=R.getMesh(),B=q.getMesh();return L.material&&B.material?L.material.uniqueId-B.material.uniqueId:L.uniqueId-B.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(R,q,L){void 0===q&&(q=R.getMesh()),void 0===L&&(L=R.Ha()),null!==L&&void 0!==L&&(L.needAlphaBlendingForMesh(q)?this._transparentSubMeshes.push(R):L.needAlphaTesting()?(L.needDepthPrePass&&this._depthOnlySubMeshes.push(R),this._alphaTestSubMeshes.push(R)):(L.needDepthPrePass&&this._depthOnlySubMeshes.push(R),this._opaqueSubMeshes.push(R)),q._renderingGroup=this,q._edgesRenderer&&q.isEnabled()&&q.isVisible&&q._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(q._edgesRenderer),this._empty=!1)}dispatchSprites(R){this._spriteManagers.push(R),this._empty=!1}dispatchParticles(R){this._particleSystems.push(R),this._empty=!1}_renderParticles(R){if(0===this._particleSystems.length)return;const q=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let L=0;L<this._particleSystems.length;L++){const B=this._particleSystems.data[L];if(0===(q&&q.layerMask&B.layerMask))continue;const N=B.j;N.position&&R&&-1===R.indexOf(N)||this._scene._activeParticles.addCount(B.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const R=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let q=0;q<this._spriteManagers.length;q++){const L=this._spriteManagers.data[q];0!==(R&&R.layerMask&L.layerMask)&&L.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}h._ZeroVector=N.m.Zero();class Z{}class z{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(R){R!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=R,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const R of this._scene.meshes)if(R.Zf)for(const q of R.Zf)q._wasDispatched=!1;if(this._scene.spriteManagers)for(const R of this._scene.spriteManagers)R._wasDispatched=!1;for(const R of this._scene.lj)R._wasDispatched=!1}constructor(R){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Z,this._maintainStateBetweenFrames=!1,this._scene=R;for(let q=z.MIN_RENDERINGGROUPS;q<z.MAX_RENDERINGGROUPS;q++)this._autoClearDepthStencil[q]={Oi:!0,depth:!0,stencil:!0}}getRenderingGroup(R){const q=R||0;return this._prepareRenderingGroup(q),this._renderingGroups[q]}_clearDepthStencilBuffer(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,R,q),this._depthStencilBufferAlreadyCleaned=!0)}render(R,q,L,B){const N=this._renderingGroupInfo;if(N.Nc=this._scene,N.camera=this._scene.activeCamera,this._scene.spriteManagers&&B)for(let h=0;h<this._scene.spriteManagers.length;h++){const R=this._scene.spriteManagers[h];this.dispatchSprites(R)}for(let h=z.MIN_RENDERINGGROUPS;h<z.MAX_RENDERINGGROUPS;h++){this._depthStencilBufferAlreadyCleaned=h===z.MIN_RENDERINGGROUPS;const Z=this._renderingGroups[h];if(!Z||Z._empty)continue;const Y=1<<h;if(N.renderingGroupId=h,this._scene.onBeforeRenderingGroupObservable.notifyObservers(N,Y),z.AUTOCLEAR){const R=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(h):this._autoClearDepthStencil[h];R&&R.Oi&&this._clearDepthStencilBuffer(R.depth,R.stencil)}for(const R of this._scene._beforeRenderingGroupDrawStage)R.action(h);Z.render(R,B,L,q);for(const R of this._scene._afterRenderingGroupDrawStage)R.action(h);this._scene.onAfterRenderingGroupObservable.notifyObservers(N,Y)}}reset(){if(!this.maintainStateBetweenFrames)for(let R=z.MIN_RENDERINGGROUPS;R<z.MAX_RENDERINGGROUPS;R++){const q=this._renderingGroups[R];q&&q.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let R=z.MIN_RENDERINGGROUPS;R<z.MAX_RENDERINGGROUPS;R++){const q=this._renderingGroups[R];q&&q.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let R=z.MIN_RENDERINGGROUPS;R<z.MAX_RENDERINGGROUPS;R++){const q=this._renderingGroups[R];q&&q.dispose()}}_prepareRenderingGroup(R){void 0===this._renderingGroups[R]&&(this._renderingGroups[R]=new h(R,this._scene,this._customOpaqueSortCompareFn[R],this._customAlphaTestSortCompareFn[R],this._customTransparentSortCompareFn[R]))}dispatchSprites(R){this.maintainStateBetweenFrames&&R._wasDispatched||(R._wasDispatched=!0,this.getRenderingGroup(R.renderingGroupId).dispatchSprites(R))}dispatchParticles(R){this.maintainStateBetweenFrames&&R._wasDispatched||(R._wasDispatched=!0,this.getRenderingGroup(R.renderingGroupId).dispatchParticles(R))}dispatch(R,q,L){void 0===q&&(q=R.getMesh()),this.maintainStateBetweenFrames&&R._wasDispatched||(R._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatch(R,q,L))}setRenderingOrder(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[R]=q,this._customAlphaTestSortCompareFn[R]=L,this._customTransparentSortCompareFn[R]=B,this._renderingGroups[R]){const q=this._renderingGroups[R];q.opaqueSortCompareFn=this._customOpaqueSortCompareFn[R],q.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[R],q.transparentSortCompareFn=this._customTransparentSortCompareFn[R]}}setRenderingAutoClearDepthStencil(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[R]={Oi:q,depth:L,stencil:B}}getAutoClearDepthStencilSetup(R){return this._autoClearDepthStencil[R]}}z.MAX_RENDERINGGROUPS=4,z.MIN_RENDERINGGROUPS=0,z.AUTOCLEAR=!0},11804:(R,q,L)=>{"use strict";const B="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11775:(R,q,L)=>{"use strict";const B="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11844:(R,q,L)=>{"use strict";const B="clipPlaneVertex",N="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11828:(R,q,L)=>{"use strict";const B="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11822:(R,q,L)=>{"use strict";const B="fogFragment",N="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11799:(R,q,L)=>{"use strict";const B="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11846:(R,q,L)=>{"use strict";const B="fogVertex",N="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11835:(R,q,L)=>{"use strict";const B="fogVertexDeclaration",N="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11790:(R,q,L)=>{"use strict";const B="helperFunctions",N="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11779:(R,q,L)=>{"use strict";const B="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11792:(R,q,L)=>{"use strict";const B="imageProcessingFunctions",N="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";L(10841).b.IncludesShadersStoreWGSL[B]=N},11783:(R,q,L)=>{"use strict";const B="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11813:(R,q,L)=>{"use strict";const B="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11850:(R,q,L)=>{"use strict";const B="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";L(10841).b.IncludesShadersStoreWGSL[B]=N},11772:(R,q,L)=>{"use strict";L.r(q),L.d(q,{particlesPixelShaderWGSL:()=>Z});var B=L(10841);L(11775),L(11779),L(11783),L(11790),L(11792),L(11799),L(11804),L(11813),L(11822);const N="particlesPixelShader",h="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.b.ShadersStoreWGSL[N]=h;const Z={name:N,shader:h}},11825:(R,q,L)=>{"use strict";L.r(q),L.d(q,{particlesVertexShaderWGSL:()=>Z});var B=L(10841);L(11828),L(11835),L(11783),L(11844),L(11846),L(11850);const N="particlesVertexShader",h="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.b.ShadersStoreWGSL[N]=h;const Z={name:N,shader:h}},11681:(R,q,L)=>{"use strict";const B="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11759:(R,q,L)=>{"use strict";const B="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11710:(R,q,L)=>{"use strict";const B="clipPlaneVertex",N="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11767:(R,q,L)=>{"use strict";const B="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11697:(R,q,L)=>{"use strict";const B="fogFragment",N="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11677:(R,q,L)=>{"use strict";const B="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11718:(R,q,L)=>{"use strict";const B="fogVertex",N="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11706:(R,q,L)=>{"use strict";const B="fogVertexDeclaration",N="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11665:(R,q,L)=>{"use strict";const B="helperFunctions",N="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";L(10841).b.IncludesShadersStore[B]=N},11654:(R,q,L)=>{"use strict";const B="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11673:(R,q,L)=>{"use strict";const B="imageProcessingFunctions",N="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";L(10841).b.IncludesShadersStore[B]=N},11661:(R,q,L)=>{"use strict";const B="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11690:(R,q,L)=>{"use strict";const B="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11725:(R,q,L)=>{"use strict";const B="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";L(10841).b.IncludesShadersStore[B]=N},11756:(R,q,L)=>{"use strict";L.r(q),L.d(q,{particlesPixelShader:()=>Z});var B=L(10841);L(11759),L(11654),L(11661),L(11665),L(11673),L(11677),L(11681),L(11690),L(11697);const N="particlesPixelShader",h="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.b.ShadersStore[N]=h;const Z={name:N,shader:h}},11762:(R,q,L)=>{"use strict";L.r(q),L.d(q,{particlesVertexShader:()=>Z});var B=L(10841);L(11767),L(11706),L(11661),L(11710),L(11718),L(11725);const N="particlesVertexShader",h="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.b.ShadersStore[N]=h;const Z={name:N,shader:h}},11627:(R,q,L)=>{"use strict";L.r(q),L.d(q,{postprocessVertexShader:()=>h});const B="postprocessVertexShader",N="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";L(10841).b.ShadersStore[B]=N;const h={name:B,shader:N}},11189:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});class B{}B._IsPickingAvailable=!1},11345:(R,q,L)=>{"use strict";L.d(q,{d:()=>e});var B=L(11053),N=L(11081),h=L(11058),Z=L(10760),z=L(10797),Y=L(10785),F=L(11117);class C{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new Z.b,this._onClonedObservable=new Z.b}}class e{static AddNodeConstructor(R,q){this._NodeConstructors[R]=q}static Construct(R,q,L,B){const N=this._NodeConstructors[R];return N?N(q,L,B):null}set accessibilityTag(R){this._accessibilityTag=R,this.onAccessibilityTagChangedObservable.notifyObservers(R)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(R){this._nodeDataStorage._doNotSerialize=R}u(){return this._nodeDataStorage._isDisposed}set parent(R){if(this._parentNode===R)return;const q=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const q=this._parentNode._children.indexOf(this);-1!==q&&this._parentNode._children.splice(q,1),R||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=R,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),q||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(R){R.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const R=this._scene.rootNodes,q=R.length-1;R[this._nodeDataStorage._sceneRootNodesIndex]=R[q],R[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}getClassName(){return"Node"}set onDispose(R){this._onDisposeObserver&&this.ej.remove(this._onDisposeObserver),this._onDisposeObserver=this.ej.add(R)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new C,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new Z.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=N.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.ej=new Z.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=R,this.id=R,this._scene=q||z.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),L&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(R)||(R.init(),this._scene.isLoading&&!q?this._scene.onDataLoadedObservable.addOnce((()=>{R.attach(this)})):R.attach(this),this._behaviors.push(R)),this}removeBehavior(R){const q=this._behaviors.indexOf(R);return-1===q||(this._behaviors[q].detach(),this._behaviors.splice(q,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(R){for(const q of this._behaviors)if(q.name===R)return q;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Jj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(R){!R&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(R){return this.parent?this.parent._getActionManagerForTrigger(R,!1):null}_updateCache(R){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Ag(R){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((R=>{R._syncParentEnabledState()}))}xb(R){this._nodeDataStorage._isEnabled!==R&&(this._nodeDataStorage._isEnabled=R,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(R))}isDescendantOf(R){return!!this.parent&&(this.parent===R||this.parent.isDescendantOf(R))}_getDescendants(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;if(this._children)for(let B=0;B<this._children.length;B++){const N=this._children[B];L&&!L(N)||R.push(N),q||N._getDescendants(R,!1,L)}}getDescendants(R,q){const L=[];return this._getDescendants(L,R,q),L}getChildMeshes(R,q){const L=[];return this._getDescendants(L,R,(R=>(!q||q(R))&&void 0!==R.yi)),L}getChildren(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(q,R)}_setReady(R){R!==this._nodeDataStorage._isReady&&(R?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(R){for(let q=0;q<this.animations.length;q++){const L=this.animations[q];if(L.name===R)return L}return null}createAnimationRange(R,q,L){if(!this._ranges[R]){this._ranges[R]=e._AnimationRangeFactory(R,q,L);for(let B=0,N=this.animations.length;B<N;B++)this.animations[B]&&this.animations[B].createRange(R,q,L)}}deleteAnimationRange(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let L=0,B=this.animations.length;L<B;L++)this.animations[L]&&this.animations[L].deleteRange(R,q);this._ranges[R]=null}getAnimationRange(R){return this._ranges[R]||null}clone(R,q,L){const B=F.b.Clone((()=>new e(R,this.va())),this);if(q&&(B.parent=q),!L){const q=this.getDescendants(!0);for(let L=0;L<q.length;L++){const N=q[L];N.clone(R+"."+N.name,B)}}return B}getAnimationRanges(){const R=[];let q;for(q in this._ranges)R.push(this._ranges[q]);return R}beginAnimation(R,q,L,B){const N=this.getAnimationRange(R);return N?this._scene.beginAnimation(this,N.from,N.to,q,L,B):null}serializeAnimationRanges(){const R=[];for(const q in this._ranges){const L=this._ranges[q];if(!L)continue;const B={};B.name=q,B.from=L.from,B.to=L.to,R.push(B)}return R}Jj(R){return this._worldMatrix||(this._worldMatrix=N.c.Identity()),this._worldMatrix}dispose(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!R){const L=this.getDescendants(!0);for(const B of L)B.dispose(R,q)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.ej.notifyObservers(this),this.ej.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const L of this._behaviors)L.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(R,q,L){if(q.ranges)for(let B=0;B<q.ranges.length;B++){const L=q.ranges[B];R.createAnimationRange(L.name,L.from,L.to)}}getHierarchyBoundingVectors(){let R,q,L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Jj(!0);const h=this;if(h.getBoundingInfo&&h.Zf){const L=h.getBoundingInfo();R=L.boundingBox.minimumWorld.clone(),q=L.boundingBox.maximumWorld.clone()}else R=new N.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new N.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(L){const L=this.getDescendants(!1);for(const h of L){const L=h;if(L.Jj(!0),B&&!B(L))continue;if(!L.getBoundingInfo||0===L.getTotalVertices())continue;const Z=L.getBoundingInfo().boundingBox,z=Z.minimumWorld,Y=Z.maximumWorld;N.m.CheckExtends(z,R,q),N.m.CheckExtends(Y,R,q)}}return{min:R,max:q}}}e._AnimationRangeFactory=(R,q,L)=>{throw(0,Y.d)("AnimationRange")},e._NodeConstructors={},(0,B.d)([(0,h.K)()],e.prototype,"name",void 0),(0,B.d)([(0,h.K)()],e.prototype,"id",void 0),(0,B.d)([(0,h.K)()],e.prototype,"uniqueId",void 0),(0,B.d)([(0,h.K)()],e.prototype,"state",void 0),(0,B.d)([(0,h.K)()],e.prototype,"metadata",void 0)},11071:(R,q,L)=>{"use strict";L.d(q,{b:()=>RR});var B=L(10757),N=L(10778),h=L(10760),Z=L(11065);class z{constructor(){this._count=0,this._data={}}p(R){this.clear(),R.forEach(((R,q)=>this.add(R,q)))}get(R){const q=this._data[R];if(void 0!==q)return q}getOrAddWithFactory(R,q){let L=this.get(R);return void 0!==L||(L=q(R),L&&this.add(R,L)),L}getOrAdd(R,q){const L=this.get(R);return void 0!==L?L:(this.add(R,q),q)}contains(R){return void 0!==this._data[R]}add(R,q){return void 0===this._data[R]&&(this._data[R]=q,++this._count,!0)}set(R,q){return void 0!==this._data[R]&&(this._data[R]=q,!0)}getAndRemove(R){const q=this.get(R);return void 0!==q?(delete this._data[R],--this._count,q):null}remove(R){return!!this.contains(R)&&(delete this._data[R],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(R){for(const q in this._data){R(q,this._data[q])}}first(R){for(const q in this._data){const L=R(q,this._data[q]);if(L)return L}return null}}var Y=L(11074),F=L(11081),C=L(11104),e=L(11132),y=L(11134);class U{constructor(R,q,L,B,N,h){this.source=R,this.pointerX=q,this.pointerY=L,this.meshUnderPointer=B,this.sourceEvent=N,this.additionalData=h}static CreateNew(R,q,L){const B=R.va();return new U(R,B.pointerX,B.pointerY,B.meshUnderPointer||R,q,L)}static CreateNewFromSprite(R,q,L,B){return new U(R,q.pointerX,q.pointerY,q.meshUnderPointer,L,B)}static CreateNewFromScene(R,q){return new U(null,R.pointerX,R.pointerY,R.meshUnderPointer,q)}static CreateNewFromPrimitive(R,q,L,B){return new U(R,q.x,q.y,null,L,B)}}var n=L(11150),r=L(11156),p=L(11160),c=L(10763),d=L(10797),f=L(10785),v=L(11168);class T{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const R in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,R))return!0;return!1}static get HasPickTriggers(){for(const R in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,R)){const q=parseInt(R);if(q>=1&&q<=7)return!0}return!1}static HasSpecificTrigger(R){for(const q in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,q)){if(parseInt(q)===R)return!0}return!1}}T.Triggers={};var t,D,S,I,K,m,o,l=L(11176);!function(R){R[R.Generic=0]="Generic",R[R.Keyboard=1]="Keyboard",R[R.Mouse=2]="Mouse",R[R.Touch=3]="Touch",R[R.DualShock=4]="DualShock",R[R.Xbox=5]="Xbox",R[R.Switch=6]="Switch",R[R.DualSense=7]="DualSense"}(t||(t={})),function(R){R[R.Horizontal=0]="Horizontal",R[R.Vertical=1]="Vertical",R[R.LeftClick=2]="LeftClick",R[R.MiddleClick=3]="MiddleClick",R[R.RightClick=4]="RightClick",R[R.BrowserBack=5]="BrowserBack",R[R.BrowserForward=6]="BrowserForward",R[R.MouseWheelX=7]="MouseWheelX",R[R.MouseWheelY=8]="MouseWheelY",R[R.MouseWheelZ=9]="MouseWheelZ",R[R.Move=12]="Move"}(D||(D={})),function(R){R[R.Horizontal=0]="Horizontal",R[R.Vertical=1]="Vertical",R[R.LeftClick=2]="LeftClick",R[R.MiddleClick=3]="MiddleClick",R[R.RightClick=4]="RightClick",R[R.BrowserBack=5]="BrowserBack",R[R.BrowserForward=6]="BrowserForward",R[R.MouseWheelX=7]="MouseWheelX",R[R.MouseWheelY=8]="MouseWheelY",R[R.MouseWheelZ=9]="MouseWheelZ",R[R.DeltaHorizontal=10]="DeltaHorizontal",R[R.DeltaVertical=11]="DeltaVertical"}(S||(S={})),function(R){R[R.Cross=0]="Cross",R[R.Circle=1]="Circle",R[R.Square=2]="Square",R[R.Triangle=3]="Triangle",R[R.L1=4]="L1",R[R.R1=5]="R1",R[R.L2=6]="L2",R[R.R2=7]="R2",R[R.Share=8]="Share",R[R.Options=9]="Options",R[R.L3=10]="L3",R[R.R3=11]="R3",R[R.DPadUp=12]="DPadUp",R[R.DPadDown=13]="DPadDown",R[R.DPadLeft=14]="DPadLeft",R[R.DPadRight=15]="DPadRight",R[R.Home=16]="Home",R[R.TouchPad=17]="TouchPad",R[R.LStickXAxis=18]="LStickXAxis",R[R.LStickYAxis=19]="LStickYAxis",R[R.RStickXAxis=20]="RStickXAxis",R[R.RStickYAxis=21]="RStickYAxis"}(I||(I={})),function(R){R[R.Cross=0]="Cross",R[R.Circle=1]="Circle",R[R.Square=2]="Square",R[R.Triangle=3]="Triangle",R[R.L1=4]="L1",R[R.R1=5]="R1",R[R.L2=6]="L2",R[R.R2=7]="R2",R[R.Create=8]="Create",R[R.Options=9]="Options",R[R.L3=10]="L3",R[R.R3=11]="R3",R[R.DPadUp=12]="DPadUp",R[R.DPadDown=13]="DPadDown",R[R.DPadLeft=14]="DPadLeft",R[R.DPadRight=15]="DPadRight",R[R.Home=16]="Home",R[R.TouchPad=17]="TouchPad",R[R.LStickXAxis=18]="LStickXAxis",R[R.LStickYAxis=19]="LStickYAxis",R[R.RStickXAxis=20]="RStickXAxis",R[R.RStickYAxis=21]="RStickYAxis"}(K||(K={})),function(R){R[R.A=0]="A",R[R.B=1]="B",R[R.X=2]="X",R[R.Y=3]="Y",R[R.LB=4]="LB",R[R.RB=5]="RB",R[R.LT=6]="LT",R[R.RT=7]="RT",R[R.Back=8]="Back",R[R.Start=9]="Start",R[R.LS=10]="LS",R[R.RS=11]="RS",R[R.DPadUp=12]="DPadUp",R[R.DPadDown=13]="DPadDown",R[R.DPadLeft=14]="DPadLeft",R[R.DPadRight=15]="DPadRight",R[R.Home=16]="Home",R[R.LStickXAxis=17]="LStickXAxis",R[R.LStickYAxis=18]="LStickYAxis",R[R.RStickXAxis=19]="RStickXAxis",R[R.RStickYAxis=20]="RStickYAxis"}(m||(m={})),function(R){R[R.B=0]="B",R[R.A=1]="A",R[R.Y=2]="Y",R[R.X=3]="X",R[R.L=4]="L",R[R.R=5]="R",R[R.ZL=6]="ZL",R[R.ZR=7]="ZR",R[R.Minus=8]="Minus",R[R.Plus=9]="Plus",R[R.LS=10]="LS",R[R.RS=11]="RS",R[R.DPadUp=12]="DPadUp",R[R.DPadDown=13]="DPadDown",R[R.DPadLeft=14]="DPadLeft",R[R.DPadRight=15]="DPadRight",R[R.Home=16]="Home",R[R.Capture=17]="Capture",R[R.LStickXAxis=18]="LStickXAxis",R[R.LStickYAxis=19]="LStickYAxis",R[R.RStickXAxis=20]="RStickXAxis",R[R.RStickYAxis=21]="RStickYAxis"}(o||(o={}));var G=L(11182);class W{static CreateDeviceEvent(R,q,L,B,N,h,Z){switch(R){case t.Keyboard:return this._CreateKeyboardEvent(L,B,N,h);case t.Mouse:if(L===D.MouseWheelX||L===D.MouseWheelY||L===D.MouseWheelZ)return this._CreateWheelEvent(R,q,L,B,N,h);case t.Touch:return this._CreatePointerEvent(R,q,L,B,N,h,Z);default:throw`Unable to generate event for device ${t[R]}`}}static _CreatePointerEvent(R,q,L,B,N,h,Z){const z=this._CreateMouseEvent(R,q,L,B,N,h);R===t.Mouse?(z.deviceType=t.Mouse,z.pointerId=1,z.pointerType="mouse"):(z.deviceType=t.Touch,z.pointerId=Z??q,z.pointerType="touch");let Y=0;return Y+=N.pollInput(R,q,D.LeftClick),Y+=2*N.pollInput(R,q,D.RightClick),Y+=4*N.pollInput(R,q,D.MiddleClick),z.buttons=Y,L===D.Move?z.type="pointermove":L>=D.LeftClick&&L<=D.RightClick&&(z.type=1===B?"pointerdown":"pointerup",z.button=L-2),z}static _CreateWheelEvent(R,q,L,B,N,h){const Z=this._CreateMouseEvent(R,q,L,B,N,h);switch(Z.pointerId=1,Z.type="wheel",Z.deltaMode=G.e.DOM_DELTA_PIXEL,Z.deltaX=0,Z.deltaY=0,Z.deltaZ=0,L){case D.MouseWheelX:Z.deltaX=B;break;case D.MouseWheelY:Z.deltaY=B;break;case D.MouseWheelZ:Z.deltaZ=B}return Z}static _CreateMouseEvent(R,q,L,B,N,h){const Z=this._CreateEvent(h),z=N.pollInput(R,q,D.Horizontal),Y=N.pollInput(R,q,D.Vertical);return h?(Z.movementX=0,Z.movementY=0,Z.offsetX=Z.movementX-h.getBoundingClientRect().x,Z.offsetY=Z.movementY-h.getBoundingClientRect().y):(Z.movementX=N.pollInput(R,q,10),Z.movementY=N.pollInput(R,q,11),Z.offsetX=0,Z.offsetY=0),this._CheckNonCharacterKeys(Z,N),Z.clientX=z,Z.clientY=Y,Z.x=z,Z.y=Y,Z.deviceType=R,Z.deviceSlot=q,Z.inputIndex=L,Z}static _CreateKeyboardEvent(R,q,L,B){const N=this._CreateEvent(B);return this._CheckNonCharacterKeys(N,L),N.deviceType=t.Keyboard,N.deviceSlot=0,N.inputIndex=R,N.type=1===q?"keydown":"keyup",N.key=String.fromCharCode(R),N.keyCode=R,N}static _CheckNonCharacterKeys(R,q){const L=q.isDeviceAvailable(t.Keyboard),B=L&&1===q.pollInput(t.Keyboard,0,18),N=L&&1===q.pollInput(t.Keyboard,0,17),h=L&&(1===q.pollInput(t.Keyboard,0,91)||1===q.pollInput(t.Keyboard,0,92)||1===q.pollInput(t.Keyboard,0,93)),Z=L&&1===q.pollInput(t.Keyboard,0,16);R.altKey=B,R.ctrlKey=N,R.metaKey=h,R.shiftKey=Z}static _CreateEvent(R){const q={preventDefault:()=>{}};return q.target=R,q}}class H{constructor(R,q,L){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(R,q,((R,q,B,N)=>{const h=W.CreateDeviceEvent(R,q,B,N,this);L(R,q,h)})):this._createDummyNativeInput()}pollInput(R,q,L){return this._nativeInput.pollInput(R,q,L)}isDeviceAvailable(R){return R===t.Mouse||R===t.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const P=Object.keys(D).length/2;class O{constructor(R,q,L,N){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=B.f.IsSafari(),this._usingMacOS=(0,c.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=R=>{},this._keyboardUpEvent=R=>{},this._keyboardBlurEvent=R=>{},this._pointerMoveEvent=R=>{},this._pointerDownEvent=R=>{},this._pointerUpEvent=R=>{},this._pointerCancelEvent=R=>{},this._pointerWheelEvent=R=>{},this._pointerBlurEvent=R=>{},this._pointerMacOSChromeOutEvent=R=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,c.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,c.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=R=>{},this._gamepadDisconnectedEvent=R=>{},this._eventPrefix=B.f.GetPointerPrefix(R),this._engine=R,this._onDeviceConnected=q,this._onDeviceDisconnected=L,this._onInputChanged=N,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(R,q,L){const N=this._inputs[R][q];if(!N)throw`Unable to find device ${t[R]}`;R>=t.DualShock&&R<=t.DualSense&&this._updateDevice(R,q,L);const h=N[L];if(void 0===h)throw`Unable to find input ${L} for device ${t[R]} in slot ${q}`;return L===D.Move&&B.f.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),h}isDeviceAvailable(R){return void 0!==this._inputs[R]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const R=null===this||void 0===this?void 0:this._engine.getInputElement();if(R&&(!this._eventsAttached||this._elementToAttachTo!==R)){if(this._disableEvents(),this._inputs)for(const R of this._inputs)if(R)for(const q in R){const L=R[+q];if(L)for(let R=0;R<L.length;R++)L[R]=0}this._elementToAttachTo=R,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const R=navigator.getGamepads();for(const q of R)q&&this._addGamePad(q)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(t.Mouse,0,0,0)}_addGamePad(R){const q=this._getGamepadDeviceType(R.id),L=R.index;this._gamepads=this._gamepads||new Array(R.index+1),this._registerDevice(q,L,R.buttons.length+R.axes.length),this._gamepads[L]=q}_addPointerDevice(R,q,L,B){this._pointerActive||(this._pointerActive=!0),this._registerDevice(R,q,P);const N=this._inputs[R][q];N[0]=L,N[1]=B}_registerDevice(R,q,L){if(void 0===q)throw`Unable to register device ${t[R]} to undefined slot.`;if(this._inputs[R]||(this._inputs[R]={}),!this._inputs[R][q]){const B=new Array(L);B.fill(0),this._inputs[R][q]=B,this._onDeviceConnected(R,q)}}_unregisterDevice(R,q){this._inputs[R][q]&&(delete this._inputs[R][q],this._onDeviceDisconnected(R,q))}_handleKeyActions(){this._keyboardDownEvent=R=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(t.Keyboard,0,255));const q=this._inputs[t.Keyboard][0];if(q){q[R.keyCode]=1;const L=R;L.inputIndex=R.keyCode,this._usingMacOS&&R.metaKey&&"Meta"!==R.key&&(this._metaKeys.includes(R.keyCode)||this._metaKeys.push(R.keyCode)),this._onInputChanged(t.Keyboard,0,L)}},this._keyboardUpEvent=R=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(t.Keyboard,0,255));const q=this._inputs[t.Keyboard][0];if(q){q[R.keyCode]=0;const L=R;if(L.inputIndex=R.keyCode,this._usingMacOS&&"Meta"===R.key&&this._metaKeys.length>0){for(const R of this._metaKeys){const L=W.CreateDeviceEvent(t.Keyboard,0,R,0,this,this._elementToAttachTo);q[R]=0,this._onInputChanged(t.Keyboard,0,L)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(t.Keyboard,0,L)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const R=this._inputs[t.Keyboard][0];for(let q=0;q<R.length;q++)if(0!==R[q]){R[q]=0;const L=W.CreateDeviceEvent(t.Keyboard,0,q,0,this,this._elementToAttachTo);this._onInputChanged(t.Keyboard,0,L)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,c.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let B=0;B<this._maxTouchPoints;B++)this._activeTouchIds[B]=-1;this._pointerMoveEvent=R=>{const q=this._getPointerType(R);let L=q===t.Mouse?0:this._activeTouchIds.indexOf(R.pointerId);if(q===t.Touch&&-1===L){const N=this._activeTouchIds.indexOf(-1);if(!(N>=0))return void B.f.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);L=N,this._activeTouchIds[N]=R.pointerId,this._onDeviceConnected(q,L)}this._inputs[q]||(this._inputs[q]={}),this._inputs[q][L]||this._addPointerDevice(q,L,R.clientX,R.clientY);const N=this._inputs[q][L];if(N){const B=R;B.inputIndex=D.Move,N[D.Horizontal]=R.clientX,N[D.Vertical]=R.clientY,q===t.Touch&&0===N[D.LeftClick]&&(N[D.LeftClick]=1),void 0===R.pointerId&&(R.pointerId=this._mouseId),this._onInputChanged(q,L,B),this._usingSafari||-1===R.button||(B.inputIndex=R.button+2,N[R.button+2]=N[R.button+2]?0:1,this._onInputChanged(q,L,B))}},this._pointerDownEvent=R=>{const q=this._getPointerType(R);let L=q===t.Mouse?0:R.pointerId;if(q===t.Touch){let q=this._activeTouchIds.indexOf(R.pointerId);if(-1===q&&(q=this._activeTouchIds.indexOf(-1)),!(q>=0))return void B.f.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);L=q,this._activeTouchIds[q]=R.pointerId}this._inputs[q]||(this._inputs[q]={}),this._inputs[q][L]?q===t.Touch&&this._onDeviceConnected(q,L):this._addPointerDevice(q,L,R.clientX,R.clientY);const N=this._inputs[q][L];if(N){const B=N[D.Horizontal],Z=N[D.Vertical];if(q===t.Mouse){if(void 0===R.pointerId&&(R.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(h){}}else if(R.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(R.pointerId)}catch(h){}N[D.Horizontal]=R.clientX,N[D.Vertical]=R.clientY,N[R.button+2]=1;const z=R;z.inputIndex=R.button+2,this._onInputChanged(q,L,z),B===R.clientX&&Z===R.clientY||(z.inputIndex=D.Move,this._onInputChanged(q,L,z))}},this._pointerUpEvent=R=>{var q;const L=this._getPointerType(R),B=L===t.Mouse?0:this._activeTouchIds.indexOf(R.pointerId);if(L===t.Touch){if(-1===B)return;this._activeTouchIds[B]=-1}const N=null===(q=this._inputs[L])||void 0===q?void 0:q[B];if(N&&0!==N[R.button+2]){var h,Z,z,Y;const q=N[D.Horizontal],F=N[D.Vertical];N[D.Horizontal]=R.clientX,N[D.Vertical]=R.clientY,N[R.button+2]=0;const C=R;void 0===R.pointerId&&(R.pointerId=this._mouseId),q===R.clientX&&F===R.clientY||(C.inputIndex=D.Move,this._onInputChanged(L,B,C)),C.inputIndex=R.button+2,L===t.Mouse&&this._mouseId>=0&&null!==(h=(Z=this._elementToAttachTo).hasPointerCapture)&&void 0!==h&&h.call(Z,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):R.pointerId&&null!==(z=(Y=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(Y,R.pointerId)&&this._elementToAttachTo.releasePointerCapture(R.pointerId),this._onInputChanged(L,B,C),L===t.Touch&&this._onDeviceDisconnected(L,B)}},this._pointerCancelEvent=R=>{if("mouse"===R.pointerType){var q,L;const R=this._inputs[t.Mouse][0];this._mouseId>=0&&null!==(q=(L=this._elementToAttachTo).hasPointerCapture)&&void 0!==q&&q.call(L,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let q=D.LeftClick;q<=D.BrowserForward;q++)if(1===R[q]){R[q]=0;const L=W.CreateDeviceEvent(t.Mouse,0,q,0,this,this._elementToAttachTo);this._onInputChanged(t.Mouse,0,L)}}else{var B,N;const q=this._activeTouchIds.indexOf(R.pointerId);if(-1===q)return;null!==(B=(N=this._elementToAttachTo).hasPointerCapture)&&void 0!==B&&B.call(N,R.pointerId)&&this._elementToAttachTo.releasePointerCapture(R.pointerId),this._inputs[t.Touch][q][D.LeftClick]=0;const L=W.CreateDeviceEvent(t.Touch,q,D.LeftClick,0,this,this._elementToAttachTo,R.pointerId);this._onInputChanged(t.Touch,q,L),this._activeTouchIds[q]=-1,this._onDeviceDisconnected(t.Touch,q)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let R=!1;const q=function(){};try{const L=Object.defineProperty({},"passive",{get:function(){R=!0}});this._elementToAttachTo.addEventListener("test",q,L),this._elementToAttachTo.removeEventListener("test",q,L)}catch(L){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(t.Mouse)){var R,q;const L=this._inputs[t.Mouse][0];this._mouseId>=0&&null!==(R=(q=this._elementToAttachTo).hasPointerCapture)&&void 0!==R&&R.call(q,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let R=D.LeftClick;R<=D.BrowserForward;R++)if(1===L[R]){L[R]=0;const q=W.CreateDeviceEvent(t.Mouse,0,R,0,this,this._elementToAttachTo);this._onInputChanged(t.Mouse,0,q)}}if(this.isDeviceAvailable(t.Touch)){const R=this._inputs[t.Touch];for(let q=0;q<this._activeTouchIds.length;q++){var L,B,N;const h=this._activeTouchIds[q];if(null!==(L=(B=this._elementToAttachTo).hasPointerCapture)&&void 0!==L&&L.call(B,h)&&this._elementToAttachTo.releasePointerCapture(h),-1!==h&&1===(null===(N=R[q])||void 0===N?void 0:N[D.LeftClick])){R[q][D.LeftClick]=0;const L=W.CreateDeviceEvent(t.Touch,q,D.LeftClick,0,this,this._elementToAttachTo,h);this._onInputChanged(t.Touch,q,L),this._activeTouchIds[q]=-1,this._onDeviceDisconnected(t.Touch,q)}}}},this._pointerWheelEvent=R=>{const q=t.Mouse;this._inputs[q]||(this._inputs[q]=[]),this._inputs[q][0]||(this._pointerActive=!0,this._registerDevice(q,0,P));const L=this._inputs[q][0];if(L){L[D.MouseWheelX]=R.deltaX||0,L[D.MouseWheelY]=R.deltaY||R.wheelDelta||0,L[D.MouseWheelZ]=R.deltaZ||0;const B=R;void 0===R.pointerId&&(R.pointerId=this._mouseId),0!==L[D.MouseWheelX]&&(B.inputIndex=D.MouseWheelX,this._onInputChanged(q,0,B)),0!==L[D.MouseWheelY]&&(B.inputIndex=D.MouseWheelY,this._onInputChanged(q,0,B)),0!==L[D.MouseWheelZ]&&(B.inputIndex=D.MouseWheelZ,this._onInputChanged(q,0,B))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=R=>{R.buttons>1&&this._pointerCancelEvent(R)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!R&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(t.Mouse)){const R=this._inputs[t.Mouse][0];R[D.MouseWheelX]=0,R[D.MouseWheelY]=0,R[D.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=R=>{this._addGamePad(R.gamepad)},this._gamepadDisconnectedEvent=R=>{if(this._gamepads){const q=this._getGamepadDeviceType(R.gamepad.id),L=R.gamepad.index;this._unregisterDevice(q,L),delete this._gamepads[L]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(R,q,L){const B=navigator.getGamepads()[q];if(B&&R===this._gamepads[q]){const N=this._inputs[R][q];L>=B.buttons.length?N[L]=B.axes[L-B.buttons.length].valueOf():N[L]=B.buttons[L].value}}_getGamepadDeviceType(R){return-1!==R.indexOf("054c")?-1!==R.indexOf("0ce6")?t.DualSense:t.DualShock:-1!==R.indexOf("Xbox One")||-1!==R.search("Xbox 360")||-1!==R.search("xinput")?t.Xbox:-1!==R.indexOf("057e")?t.Switch:t.Generic}_getPointerType(R){let q=t.Mouse;return("touch"===R.pointerType||"pen"===R.pointerType||R.touches)&&(q=t.Touch),q}}class E{constructor(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=q,this.deviceSlot=L,this.onInputChangedObservable=new h.b,this._deviceInputSystem=R}getInput(R){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,R)}}class a{constructor(R){this._registeredManagers=new Array,this._refCount=0,this.registerManager=R=>{for(let q=0;q<this._devices.length;q++){const L=this._devices[q];for(const B in L){const L=+B;R._addDevice(new E(this._deviceInputSystem,q,L))}}this._registeredManagers.push(R)},this.unregisterManager=R=>{const q=this._registeredManagers.indexOf(R);q>-1&&this._registeredManagers.splice(q,1)};const q=Object.keys(t).length/2;this._devices=new Array(q);const L=(R,q)=>{this._devices[R]||(this._devices[R]=new Array),this._devices[R][q]||(this._devices[R][q]=q);for(const L of this._registeredManagers){const B=new E(this._deviceInputSystem,R,q);L._addDevice(B)}},B=(R,q)=>{var L;null!==(L=this._devices[R])&&void 0!==L&&L[q]&&delete this._devices[R][q];for(const B of this._registeredManagers)B._removeDevice(R,q)},N=(R,q,L)=>{if(L)for(const B of this._registeredManagers)B._onInputChanged(R,q,L)};"undefined"!==typeof _native?this._deviceInputSystem=new H(L,B,N):this._deviceInputSystem=new O(R,L,B,N)}dispose(){this._deviceInputSystem.dispose()}}class g{getDeviceSource(R,q){if(void 0===q){if(void 0===this._firstDevice[R])return null;q=this._firstDevice[R]}return this._devices[R]&&void 0!==this._devices[R][q]?this._devices[R][q]:null}getDeviceSources(R){return this._devices[R]?this._devices[R].filter((R=>!!R)):[]}constructor(R){const q=Object.keys(t).length/2;this._devices=new Array(q),this._firstDevice=new Array(q),this._engine=R,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new a(R)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new h.b((R=>{for(const q of this._devices)if(q)for(const L of q)L&&this.onDeviceConnectedObservable.notifyObserver(R,L)})),this.onDeviceDisconnectedObservable=new h.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=R.ej.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.ej.remove(this._onDisposeObserver)}_addDevice(R){this._devices[R.deviceType]||(this._devices[R.deviceType]=new Array),this._devices[R.deviceType][R.deviceSlot]||(this._devices[R.deviceType][R.deviceSlot]=R,this._updateFirstDevices(R.deviceType)),this.onDeviceConnectedObservable.notifyObservers(R)}_removeDevice(R,q){var L,B;const N=null===(L=this._devices[R])||void 0===L?void 0:L[q];this.onDeviceDisconnectedObservable.notifyObservers(N),null!==(B=this._devices[R])&&void 0!==B&&B[q]&&delete this._devices[R][q],this._updateFirstDevices(R)}_onInputChanged(R,q,L){var B,N;null===(B=this._devices[R])||void 0===B||null===(N=B[q])||void 0===N||N.onInputChangedObservable.notifyObservers(L)}_updateFirstDevices(R){switch(R){case t.Keyboard:case t.Mouse:this._firstDevice[R]=0;break;case t.Touch:case t.DualSense:case t.DualShock:case t.Xbox:case t.Switch:case t.Generic:{delete this._firstDevice[R];const q=this._devices[R];if(q)for(let L=0;L<q.length;L++)if(q[L]){this._firstDevice[R]=L;break}break}}}}var Q=L(11189);class i{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(R){this._singleClick=R}set doubleClick(R){this._doubleClick=R}set hasSwiped(R){this._hasSwiped=R}set ignore(R){this._ignore=R}}class k{constructor(R){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new F.i(0,0),this._previousStartingPointerPosition=new F.i(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=R||d.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(R){return this._meshUnderPointerId[R]||null}get unTranslatedPointer(){return new F.i(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(R){this._pointerX=R}get pointerY(){return this._pointerY}set pointerY(R){this._pointerY=R}_updatePointerPosition(R){const q=this._scene.getEngine().getInputElementClientRect();q&&(this._pointerX=R.clientX-q.left,this._pointerY=R.clientY-q.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(R,q){const L=this._scene,B=L.getEngine(),N=B.getInputElement();N&&(N.tabIndex=B.canvasTabIndex,L.doNotHandleCursors||(N.style.cursor=L.defaultCursor)),this._setCursorAndPointerOverMesh(R,q,L);for(const Y of L._pointerMoveStage){var h;const L=!(null===(h=R=R||this._pickMove(q))||void 0===h||!h.pickedMesh);R=Y.action(this._unTranslatedPointerX,this._unTranslatedPointerY,R,L,N)}const Z=q.inputIndex>=D.MouseWheelX&&q.inputIndex<=D.MouseWheelZ?v.e.POINTERWHEEL:v.e.POINTERMOVE;let z;L.onPointerMove&&(R=R||this._pickMove(q),L.onPointerMove(q,R,Z)),R?(z=new v.k(Z,q,R),this._setRayOnPointerInfo(R,q)):(z=new v.k(Z,q,null,this),this._movePointerInfo=z),L.onPointerObservable.hasObservers()&&L.onPointerObservable.notifyObservers(z,Z)}_setRayOnPointerInfo(R,q){const L=this._scene;R&&Q.d._IsPickingAvailable&&(R.ray||(R.ray=L.createPickingRay(q.offsetX,q.offsetY,F.c.Identity(),L.activeCamera)))}_addCameraPointerObserver(R,q){return this._cameraObserverCount++,this._scene.onPointerObservable.add(R,q)}_removeCameraPointerObserver(R){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(R)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(R,q,L){const B=this._scene,N=new v.i(L,q,this._unTranslatedPointerX,this._unTranslatedPointerY);return R&&(N.originalPickingInfo=R,N.ray=R.ray,"xr-near"===q.pointerType&&R.originMesh&&(N.nearInteractionPickingInfo=R)),B.onPrePointerObservable.notifyObservers(N,L),!!N.skipOnPointerObservable}_pickMove(R){const q=this._scene,L=q.yc(this._unTranslatedPointerX,this._unTranslatedPointerY,q.pointerMovePredicate,q.pointerMoveFastCheck,q.cameraToUseForPointers,q.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(L,R,q),L}_setCursorAndPointerOverMesh(R,q,L){const B=L.getEngine().getInputElement();if(null!==R&&void 0!==R&&R.pickedMesh){if(this.setPointerOverMesh(R.pickedMesh,q.pointerId,R,q),!L.doNotHandleCursors&&B&&this._pointerOverMesh){const R=this._pointerOverMesh._getActionManagerForTrigger();R&&R.hasPointerTriggers&&(B.style.cursor=R.hoverCursor||L.hoverCursor)}}else this.setPointerOverMesh(null,q.pointerId,R,q)}simulatePointerMove(R,q){const L=new PointerEvent("pointermove",q);L.inputIndex=D.Move,this._checkPrePointerObservable(R,L,v.e.POINTERMOVE)||this._processPointerMove(R,L)}simulatePointerDown(R,q){const L=new PointerEvent("pointerdown",q);L.inputIndex=L.button+2,this._checkPrePointerObservable(R,L,v.e.POINTERDOWN)||this._processPointerDown(R,L)}_processPointerDown(R,q){var L;const B=this._scene;if(null!==(L=R)&&void 0!==L&&L.pickedMesh){this._pickedDownMesh=R.pickedMesh;const L=R.pickedMesh._getActionManagerForTrigger();if(L){if(L.hasPickTriggers)switch(L.processTrigger(5,U.CreateNew(R.pickedMesh,q,R)),q.button){case 0:L.processTrigger(2,U.CreateNew(R.pickedMesh,q,R));break;case 1:L.processTrigger(4,U.CreateNew(R.pickedMesh,q,R));break;case 2:L.processTrigger(3,U.CreateNew(R.pickedMesh,q,R))}L.hasSpecificTrigger(8)&&window.setTimeout((()=>{const R=B.yc(this._unTranslatedPointerX,this._unTranslatedPointerY,(R=>R.ub&&R.isVisible&&R.isReady()&&R.actionManager&&R.actionManager.hasSpecificTrigger(8)&&R===this._pickedDownMesh),!1,B.cameraToUseForPointers);null!==R&&void 0!==R&&R.pickedMesh&&L&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>k.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,L.processTrigger(8,U.CreateNew(R.pickedMesh,q)))}),k.LongPressDelay)}}else for(const Z of B._pointerDownStage)R=Z.action(this._unTranslatedPointerX,this._unTranslatedPointerY,R,q,!1);let N;const h=v.e.POINTERDOWN;R?(B.onPointerDown&&B.onPointerDown(q,R,h),N=new v.k(h,q,R),this._setRayOnPointerInfo(R,q)):N=new v.k(h,q,null,this),B.onPointerObservable.hasObservers()&&B.onPointerObservable.notifyObservers(N,h)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(R,q,L){const B=new PointerEvent("pointerup",q);B.inputIndex=D.Move;const N=new i;L?N.doubleClick=!0:N.singleClick=!0,this._checkPrePointerObservable(R,B,v.e.POINTERUP)||this._processPointerUp(R,B,N)}_processPointerUp(R,q,L){var B;const N=this._scene;if(null!==(B=R)&&void 0!==B&&B.pickedMesh){if(this._pickedUpMesh=R.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(N.onPointerPick&&N.onPointerPick(q,R),L.singleClick&&!L.ignore&&N.onPointerObservable.observers.length>this._cameraObserverCount)){const L=v.e.POINTERPICK,B=new v.k(L,q,R);this._setRayOnPointerInfo(R,q),N.onPointerObservable.notifyObservers(B,L)}const B=R.pickedMesh._getActionManagerForTrigger();if(B&&!L.ignore){B.processTrigger(7,U.CreateNew(R.pickedMesh,q,R)),!L.hasSwiped&&L.singleClick&&B.processTrigger(1,U.CreateNew(R.pickedMesh,q,R));const N=R.pickedMesh._getActionManagerForTrigger(6);L.doubleClick&&N&&N.processTrigger(6,U.CreateNew(R.pickedMesh,q,R))}}else if(!L.ignore)for(const h of N._pointerUpStage)R=h.action(this._unTranslatedPointerX,this._unTranslatedPointerY,R,q,L.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const R=this._pickedDownMesh._getActionManagerForTrigger(16);R&&R.processTrigger(16,U.CreateNew(this._pickedDownMesh,q))}if(!L.ignore){const B=new v.k(v.e.POINTERUP,q,R);if(this._setRayOnPointerInfo(R,q),N.onPointerObservable.notifyObservers(B,v.e.POINTERUP),N.onPointerUp&&N.onPointerUp(q,R,v.e.POINTERUP),!L.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let B=0;if(L.singleClick?B=v.e.POINTERTAP:L.doubleClick&&(B=v.e.POINTERDOUBLETAP),B){const L=new v.k(B,q,R);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(B)&&N.onPointerObservable.notifyObservers(L,B)}}}}isPointerCaptured(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[R]}attachControl(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=this._scene,h=N.getEngine();B||(B=h.getInputElement()),this._alreadyAttached&&this.Ni(),B&&(this._alreadyAttachedTo=B),this._deviceSourceManager=new g(h),this._initActionManager=R=>{if(!this._meshPickProceed){const q=N.skipPointerUpPicking||0===N._registeredActions&&!this._checkForPicking()&&!N.onPointerUp?null:N.yc(this._unTranslatedPointerX,this._unTranslatedPointerY,N.pointerUpPredicate,N.pointerUpFastCheck,N.cameraToUseForPointers,N.pointerUpTrianglePredicate);this._currentPickResult=q,q&&(R=q.hit&&q.pickedMesh?q.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return R},this._delayedSimpleClick=(R,q,L)=>{if((Date.now()-this._previousStartingPointerTime>k.DoubleClickDelay&&!this._doubleClickOccured||R!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,q.singleClick=!0,q.ignore=!1,this._delayedClicks[R])){const q=this._delayedClicks[R].evt,L=v.e.POINTERTAP,B=new v.k(L,q,this._currentPickResult);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(L)&&N.onPointerObservable.notifyObservers(B,L),this._delayedClicks[R]=null}},this._initClickEvent=(R,q,L,B)=>{const N=new i;this._currentPickResult=null;let h=null,Z=R.hasSpecificMask(v.e.POINTERPICK)||q.hasSpecificMask(v.e.POINTERPICK)||R.hasSpecificMask(v.e.POINTERTAP)||q.hasSpecificMask(v.e.POINTERTAP)||R.hasSpecificMask(v.e.POINTERDOUBLETAP)||q.hasSpecificMask(v.e.POINTERDOUBLETAP);!Z&&T&&(h=this._initActionManager(h,N),h&&(Z=h.hasPickTriggers));let z=!1;if(Z){const Z=L.button;if(N.hasSwiped=this._isPointerSwiping(),!N.hasSwiped){let C=!k.ExclusiveDoubleClickMode;if(C||(C=!R.hasSpecificMask(v.e.POINTERDOUBLETAP)&&!q.hasSpecificMask(v.e.POINTERDOUBLETAP),C&&!T.HasSpecificTrigger(6)&&(h=this._initActionManager(h,N),h&&(C=!h.hasSpecificTrigger(6)))),C)(Date.now()-this._previousStartingPointerTime>k.DoubleClickDelay||Z!==this._previousButtonPressed)&&(N.singleClick=!0,B(N,this._currentPickResult),z=!0);else{const R={evt:L,clickInfo:N,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,Z,N,B),k.DoubleClickDelay)};this._delayedClicks[Z]=R}let e=R.hasSpecificMask(v.e.POINTERDOUBLETAP)||q.hasSpecificMask(v.e.POINTERDOUBLETAP);if(!e&&T.HasSpecificTrigger(6)&&(h=this._initActionManager(h,N),h&&(e=h.hasSpecificTrigger(6))),e)if(Z===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<k.DoubleClickDelay&&!this._doubleClickOccured){if(N.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=Z,k.ExclusiveDoubleClickMode){var Y;if(this._delayedClicks[Z])clearTimeout(null===(Y=this._delayedClicks[Z])||void 0===Y?void 0:Y.timeoutId),this._delayedClicks[Z]=null;B(N,this._previousPickResult)}else B(N,this._currentPickResult);else{var F;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,N.doubleClick=!0,N.ignore=!1,k.ExclusiveDoubleClickMode&&this._delayedClicks[Z])clearTimeout(null===(F=this._delayedClicks[Z])||void 0===F?void 0:F.timeoutId),this._delayedClicks[Z]=null;B(N,this._currentPickResult)}z=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=Z}}z||B(N,this._currentPickResult)},this._onPointerMove=R=>{if(this._updatePointerPosition(R),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>k.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>k.DragMovementThreshold),h.isPointerLock&&h._verifyPointerLock(),this._checkPrePointerObservable(null,R,R.inputIndex>=D.MouseWheelX&&R.inputIndex<=D.MouseWheelZ?v.e.POINTERWHEEL:v.e.POINTERMOVE))return;if(!N.cameraToUseForPointers&&!N.activeCamera)return;if(N.Wi)return void this._processPointerMove(new y.c,R);N.pointerMovePredicate||(N.pointerMovePredicate=R=>R.ub&&R.isVisible&&R.isReady()&&R.isEnabled()&&(R.enablePointerMoveEvents||N.constantlyUpdateMeshUnderPointer||null!==R._getActionManagerForTrigger())&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&R.layerMask)));const q=N._registeredActions>0||N.constantlyUpdateMeshUnderPointer?this._pickMove(R):null;this._processPointerMove(q,R)},this._onPointerDown=R=>{const q=this._activePointerIds.indexOf(-1);if(-1===q?this._activePointerIds.push(R.pointerId):this._activePointerIds[q]=R.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,k.ExclusiveDoubleClickMode)for(let B=0;B<this._delayedClicks.length;B++)if(this._delayedClicks[B])if(R.button===B){var L;clearTimeout(null===(L=this._delayedClicks[B])||void 0===L?void 0:L.timeoutId)}else{const R=this._delayedClicks[B].clickInfo;this._doubleClickOccured=!1,R.singleClick=!0,R.ignore=!1;const q=this._delayedClicks[B].evt,L=v.e.POINTERTAP,h=new v.k(L,q,this._currentPickResult);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(L)&&N.onPointerObservable.notifyObservers(h,L),this._delayedClicks[B]=null}if(this._updatePointerPosition(R),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=R.button),N.preventDefaultOnPointerDown&&B&&(R.preventDefault(),B.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,R,v.e.POINTERDOWN))return;if(!N.cameraToUseForPointers&&!N.activeCamera)return;let h;this._pointerCaptures[R.pointerId]=!0,N.pointerDownPredicate||(N.pointerDownPredicate=R=>R.ub&&R.isVisible&&R.isReady()&&R.isEnabled()&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&R.layerMask))),this._pickedDownMesh=null,h=N.skipPointerDownPicking||0===N._registeredActions&&!this._checkForPicking()&&!N.onPointerDown?new y.c:N.yc(this._unTranslatedPointerX,this._unTranslatedPointerY,N.pointerDownPredicate,N.pointerDownFastCheck,N.cameraToUseForPointers,N.pointerDownTrianglePredicate),this._processPointerDown(h,R)},this._onPointerUp=R=>{const q=this._activePointerIds.indexOf(R.pointerId);-1!==q&&(this._activePointerIds[q]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(R),N.preventDefaultOnPointerUp&&B&&(R.preventDefault(),B.focus()),this._initClickEvent(N.onPrePointerObservable,N.onPointerObservable,R,((q,L)=>{if(N.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!q.ignore)){if(this._checkPrePointerObservable(null,R,v.e.POINTERUP))return this._swipeButtonPressed===R.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===R.buttons&&(this._pointerCaptures[R.pointerId]=!1));q.hasSwiped||(q.singleClick&&N.onPrePointerObservable.hasSpecificMask(v.e.POINTERTAP)&&this._checkPrePointerObservable(null,R,v.e.POINTERTAP)&&(this._skipPointerTap=!0),q.doubleClick&&N.onPrePointerObservable.hasSpecificMask(v.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,R,v.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[R.pointerId]?(0===R.buttons&&(this._pointerCaptures[R.pointerId]=!1),(N.cameraToUseForPointers||N.activeCamera)&&(N.pointerUpPredicate||(N.pointerUpPredicate=R=>R.ub&&R.isVisible&&R.isReady()&&R.isEnabled()&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&R.layerMask))),!this._meshPickProceed&&(T&&T.HasTriggers||this._checkForPicking()||N.onPointerUp)&&this._initActionManager(null,q),L||(L=this._currentPickResult),this._processPointerUp(L,R,q),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===R.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===R.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=R=>{const q=l.b.KEYDOWN;if(N.onPreKeyboardObservable.hasObservers()){const L=new l.c(q,R);if(N.onPreKeyboardObservable.notifyObservers(L,q),L.skipOnKeyboardObservable)return}if(N.onKeyboardObservable.hasObservers()){const L=new l.g(q,R);N.onKeyboardObservable.notifyObservers(L,q)}N.actionManager&&N.actionManager.processTrigger(14,U.CreateNewFromScene(N,R))},this._onKeyUp=R=>{const q=l.b.KEYUP;if(N.onPreKeyboardObservable.hasObservers()){const L=new l.c(q,R);if(N.onPreKeyboardObservable.notifyObservers(L,q),L.skipOnKeyboardObservable)return}if(N.onKeyboardObservable.hasObservers()){const L=new l.g(q,R);N.onKeyboardObservable.notifyObservers(L,q)}N.actionManager&&N.actionManager.processTrigger(15,U.CreateNewFromScene(N,R))},this._deviceSourceManager.onDeviceConnectedObservable.add((B=>{B.deviceType===t.Mouse?B.onInputChangedObservable.add((N=>{this._originMouseEvent=N,N.inputIndex===D.LeftClick||N.inputIndex===D.MiddleClick||N.inputIndex===D.RightClick||N.inputIndex===D.BrowserBack||N.inputIndex===D.BrowserForward?q&&1===B.getInput(N.inputIndex)?this._onPointerDown(N):R&&0===B.getInput(N.inputIndex)&&this._onPointerUp(N):L&&(N.inputIndex===D.Move?this._onPointerMove(N):N.inputIndex!==D.MouseWheelX&&N.inputIndex!==D.MouseWheelY&&N.inputIndex!==D.MouseWheelZ||this._onPointerMove(N))})):B.deviceType===t.Touch?B.onInputChangedObservable.add((N=>{N.inputIndex===D.LeftClick&&(q&&1===B.getInput(N.inputIndex)?(this._onPointerDown(N),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):R&&0===B.getInput(N.inputIndex)&&(this._onPointerUp(N),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),L&&N.inputIndex===D.Move&&this._onPointerMove(N)})):B.deviceType===t.Keyboard&&B.onInputChangedObservable.add((R=>{"keydown"===R.type?this._onKeyDown(R):"keyup"===R.type&&this._onKeyUp(R)}))})),this._alreadyAttached=!0}Ni(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[q]===R&&(!R||!R._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const N=this._meshUnderPointerId[q];let h;N&&(h=N._getActionManagerForTrigger(10),h&&h.processTrigger(10,U.CreateNew(N,B,{pointerId:q}))),R?(this._meshUnderPointerId[q]=R,this._pointerOverMesh=R,h=R._getActionManagerForTrigger(9),h&&h.processTrigger(9,U.CreateNew(R,B,{pointerId:q,pickResult:L}))):(delete this._meshUnderPointerId[q],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(R){this._pointerOverMesh===R&&(this._pointerOverMesh=null),this._pickedDownMesh===R&&(this._pickedDownMesh=null),this._pickedUpMesh===R&&(this._pickedUpMesh=null);for(const q in this._meshUnderPointerId)this._meshUnderPointerId[q]===R&&delete this._meshUnderPointerId[q]}}k.DragMovementThreshold=10,k.LongPressDelay=500,k.DoubleClickDelay=300,k.ExclusiveDoubleClickMode=!1;var V=L(10909),x=L(11112),w=L(11196),j=L(11204),J=L(10805),s=L(11207),A=L(11092);class M{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Wi=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var b,X=L(10767),u=L(10889);!function(R){R[R.BackwardCompatible=0]="BackwardCompatible",R[R.Intermediate=1]="Intermediate",R[R.Aggressive=2]="Aggressive"}(b||(b={}));class RR{static DefaultMaterialFactory(R){throw(0,f.d)("mb")}static CollisionCoordinatorFactory(){throw(0,f.d)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(R){R!==this._clearColor&&(this._clearColor=R,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(R){if(R!==this._performancePriority){switch(this._performancePriority=R,R){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Wi=!1,this.Oi=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Wi=!0,this.Oi=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Wi=!0,this.Oi=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(R)}}set forceWireframe(R){this._forceWireframe!==R&&(this._forceWireframe=R,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(R){this._skipFrustumClipping!==R&&(this._skipFrustumClipping=R)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(R){this._forcePointsCloud!==R&&(this._forcePointsCloud=R,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(R){this._environmentTexture!==R&&(this._environmentTexture=R,this.markAllMaterialsAsDirty(1))}getNodes(){let R=[];return R=R.concat(this.meshes),R=R.concat(this.lights),R=R.concat(this.cameras),R=R.concat(this.transformNodes),this.skeletons.forEach((q=>R=R.concat(q.bones))),R}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}set onDispose(R){this._onDisposeObserver&&this.ej.remove(this._onDisposeObserver),this._onDisposeObserver=this.ej.add(R)}set beforeRender(R){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),R&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(R))}set afterRender(R){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),R&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(R))}set beforeCameraRender(R){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(R)}set afterCameraRender(R){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(R)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(R){this._pointerPickingConfiguration.pointerDownPredicate=R}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(R){this._pointerPickingConfiguration.pointerUpPredicate=R}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(R){this._pointerPickingConfiguration.pointerMovePredicate=R}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(R){this._pointerPickingConfiguration.pointerDownFastCheck=R}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(R){this._pointerPickingConfiguration.pointerUpFastCheck=R}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(R){this._pointerPickingConfiguration.pointerMoveFastCheck=R}get Wi(){return this._pointerPickingConfiguration.Wi}set Wi(R){this._pointerPickingConfiguration.Wi=R}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(R){this._pointerPickingConfiguration.skipPointerDownPicking=R}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(R){this._pointerPickingConfiguration.skipPointerUpPicking=R}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return k.DragMovementThreshold}static set DragMovementThreshold(R){k.DragMovementThreshold=R}static get LongPressDelay(){return k.LongPressDelay}static set LongPressDelay(R){k.LongPressDelay=R}static get DoubleClickDelay(){return k.DoubleClickDelay}static set DoubleClickDelay(R){k.DoubleClickDelay=R}static get ExclusiveDoubleClickMode(){return k.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(R){k.ExclusiveDoubleClickMode=R}bindEyePosition(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,N=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return F.h.Vector4[0].set(B.x,B.y,B.z,N?-1:1),R&&(L?R.setFloat3(q,F.h.Vector4[0].x,F.h.Vector4[0].y,F.h.Vector4[0].z):R.setVector4(q,F.h.Vector4[0])),F.h.Vector4[0]}finalizeSceneUbo(){const R=this.getSceneUniformBuffer(),q=this.bindEyePosition(null);return R.updateFloat4("vEyePosition",q.x,q.y,q.z,q.w),R.update(),R}set useRightHandedSystem(R){this._useRightHandedSystem!==R&&(this._useRightHandedSystem=R,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(R){this._currentStepId=R}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(R){this._fogEnabled!==R&&(this._fogEnabled=R,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(R){this._fogMode!==R&&(this._fogMode=R,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(R){this._shadowsEnabled!==R&&(this._shadowsEnabled=R,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(R){this._lightsEnabled!==R&&(this._lightsEnabled=R,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(R){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),R&&(this._unObserveActiveCameras=(0,A.i)(R,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=R}get activeCamera(){return this._activeCamera}set activeCamera(R){R!==this._activeCamera&&(this._activeCamera=R,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.pi||(this.pi=RR.DefaultMaterialFactory(this)),this.pi}set defaultMaterial(R){this.pi=R}set texturesEnabled(R){this._texturesEnabled!==R&&(this._texturesEnabled=R,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(R){if(this._frameGraph)return this._frameGraph=R,void(R||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=R,R&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(R){this._skeletonsEnabled!==R&&(this._skeletonsEnabled=R,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=RR.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const R of this._transientComponents)R.register();this._transientComponents.length=0}}fb(R){this._components.push(R),this._transientComponents.push(R);const q=R;q.addFromContainer&&q.serialize&&this._serializableComponents.push(q)}_getComponent(R){for(const q of this._components)if(q.name===R)return q;return null}constructor(R,q){this._inputManager=new k(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Oi=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new x.g(.2,.2,.3,1),this.onClearColorChangedObservable=new h.b,this.ambientColor=new x.e(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new h.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.lj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Wj=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.ej=new h.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new h.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new h.b,this.onAfterRenderCameraObservable=new h.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new h.b,this.onAfterAnimationsObservable=new h.b,this.onBeforeDrawPhaseObservable=new h.b,this.onAfterDrawPhaseObservable=new h.b,this.onReadyObservable=new h.b,this.onBeforeCameraRenderObservable=new h.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new h.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new h.b,this.onAfterActiveMeshesEvaluationObservable=new h.b,this.onBeforeParticlesRenderingObservable=new h.b,this.onAfterParticlesRenderingObservable=new h.b,this.onDataLoadedObservable=new h.b,this.onNewCameraAddedObservable=new h.b,this.onCameraRemovedObservable=new h.b,this.onNewLightAddedObservable=new h.b,this.onLightRemovedObservable=new h.b,this.onNewGeometryAddedObservable=new h.b,this.onGeometryRemovedObservable=new h.b,this.onNewTransformNodeAddedObservable=new h.b,this.onTransformNodeRemovedObservable=new h.b,this.onNewMeshAddedObservable=new h.b,this.onMeshRemovedObservable=new h.b,this.onNewSkeletonAddedObservable=new h.b,this.onSkeletonRemovedObservable=new h.b,this.onNewMaterialAddedObservable=new h.b,this.onNewMultiMaterialAddedObservable=new h.b,this.onMaterialRemovedObservable=new h.b,this.onMultiMaterialRemovedObservable=new h.b,this.onNewTextureAddedObservable=new h.b,this.onTextureRemovedObservable=new h.b,this.onBeforeRenderTargetsRenderObservable=new h.b,this.onAfterRenderTargetsRenderObservable=new h.b,this.onBeforeStepObservable=new h.b,this.onAfterStepObservable=new h.b,this.onActiveCameraChanged=new h.b,this.onActiveCamerasChanged=new h.b,this.onBeforeRenderingGroupObservable=new h.b,this.onAfterRenderingGroupObservable=new h.b,this.onMeshImportedObservable=new h.b,this.onAnimationFileImportedObservable=new h.b,this._registeredForLateAnimationBindings=new Z.d(256),this._pointerPickingConfiguration=new M,this.onPrePointerObservable=new h.b,this.onPointerObservable=new h.b,this.onPreKeyboardObservable=new h.b,this.onKeyboardObservable=new h.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=RR.FOGMODE_NONE,this.fogColor=new x.e(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new F.m(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new Z.d(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new V.d,this._activeIndices=new V.d,this._activeParticles=new V.d,this._activeBones=new V.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new Z.h(256),this._processedMaterials=new Z.h(256),this._renderTargets=new Z.d(256),this._materialsRenderTargets=new Z.d(256),this._activeParticleSystems=new Z.h(256),this._activeSkeletons=new Z.d(32),this._softwareSkinnedMeshes=new Z.d(32),this._activeAnimatables=new Array,this._transformMatrix=F.c.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=p.f.Create(),this._beforeClearStage=p.f.Create(),this._beforeRenderTargetClearStage=p.f.Create(),this._gatherRenderTargetsStage=p.f.Create(),this._gatherActiveCameraRenderTargetsStage=p.f.Create(),this._isReadyForMeshStage=p.f.Create(),this._beforeEvaluateActiveMeshStage=p.f.Create(),this._evaluateSubMeshStage=p.f.Create(),this._preActiveMeshStage=p.f.Create(),this._cameraDrawRenderTargetStage=p.f.Create(),this._beforeCameraDrawStage=p.f.Create(),this._beforeRenderTargetDrawStage=p.f.Create(),this._beforeRenderingGroupDrawStage=p.f.Create(),this._beforeRenderingMeshStage=p.f.Create(),this._afterRenderingMeshStage=p.f.Create(),this._afterRenderingGroupDrawStage=p.f.Create(),this._afterCameraDrawStage=p.f.Create(),this._afterCameraPostProcessStage=p.f.Create(),this._afterRenderTargetDrawStage=p.f.Create(),this._afterRenderTargetPostProcessStage=p.f.Create(),this._afterRenderStage=p.f.Create(),this._pointerMoveStage=p.f.Create(),this._pointerDownStage=p.f.Create(),this._pointerUpStage=p.f.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const L={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...q};R=this._engine=R||d.b.LastCreatedEngine,L.virtual?R._virtualScenes.push(this):(d.b._LastCreatedScene=this,R.scenes.push(this)),this._uid=null,this._renderingManager=new r.e(this),n.b&&(this.postProcessManager=new n.b(this)),(0,c.i)()&&this.attachControl(),this._createUbo(),C.d&&(this._imageProcessingConfiguration=new C.d),this.setDefaultCandidateProviders(),L.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=L.useMaterialMeshMap,this.useClonedMeshMap=L.useClonedMeshMap,q&&q.virtual||R.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(R){return this._defaultSubMeshCandidates.data=R.Zf,this._defaultSubMeshCandidates.length=R.Zf.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=R=>this._getDefaultSubMeshCandidates(R),this.getIntersectingSubMeshCandidates=(R,q)=>this._getDefaultSubMeshCandidates(R),this.getCollidingSubMeshCandidates=(R,q)=>this._getDefaultSubMeshCandidates(R)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(R){this._inputManager.pointerX=R}get pointerY(){return this._inputManager.pointerY}set pointerY(R){this._inputManager.pointerY=R}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==q||this._cachedMaterial!==R||this._cachedVisibility!==L}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(R,q){return this._inputManager.simulatePointerMove(R,q),this}simulatePointerDown(R,q){return this._inputManager.simulatePointerDown(R,q),this}simulatePointerUp(R,q,L){return this._inputManager.simulatePointerUp(R,q,L),this}isPointerCaptured(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(R)}attachControl(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(R,q,L)}Ni(){this._inputManager.Ni()}isReady(){var R,q;let L,B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const N=this.getEngine(),h=N.currentRenderPassId;N.currentRenderPassId=(null===(R=this.activeCamera)||void 0===R?void 0:R.renderPassId)??h;let Z=!0;for(this._pendingData.length>0&&(Z=!1),null===(q=this.prePassRenderer)||void 0===q||q.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&Z&&(Z=this.depthPeelingRenderer.isReady()),B&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),L=0;L<this.meshes.length;L++){const R=this.meshes[L];if(!R.Zf||0===R.Zf.length)continue;if(!R.isReady(!0)){Z=!1;continue}const q=R.hasThinInstances||"InstancedMesh"===R.getClassName()||"InstancedLinesMesh"===R.getClassName()||N.getCaps().instancedArrays&&R.instances.length>0;for(const L of this._isReadyForMeshStage)L.action(R,q)||(Z=!1);if(!B)continue;const h=R.material||this.defaultMaterial;if(h)if(h._storeEffectOnSubMeshes)for(const L of R.Zf){const R=L.Ha();R&&R.hasRenderTargetTextures&&null!=R.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(R)&&(this._processedMaterials.push(R),this._materialsRenderTargets.concatWithNoDuplicate(R.getRenderTargetTextures()))}else h.hasRenderTargetTextures&&null!=h.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(h)&&(this._processedMaterials.push(h),this._materialsRenderTargets.concatWithNoDuplicate(h.getRenderTargetTextures()))}if(B)for(L=0;L<this._materialsRenderTargets.length;++L){this._materialsRenderTargets.data[L].isReadyForRendering()||(Z=!1)}for(L=0;L<this.geometries.length;L++){2===this.geometries[L].delayLoadState&&(Z=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const z of this.activeCameras)z.isReady(!0)||(Z=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(Z=!1));for(const z of this.lj)z.isReady()||(Z=!1);if(this.layers)for(const z of this.layers)z.isReady()||(Z=!1);return N.areAllEffectsReady()||(Z=!1),N.currentRenderPassId=h,Z}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(R){this.onBeforeRenderObservable.add(R)}unregisterBeforeRender(R){this.onBeforeRenderObservable.removeCallback(R)}registerAfterRender(R){this.onAfterRenderObservable.add(R)}unregisterAfterRender(R){this.onAfterRenderObservable.removeCallback(R)}_executeOnceBeforeRender(R){const q=()=>{R(),setTimeout((()=>{this.unregisterBeforeRender(q)}))};this.registerBeforeRender(q)}executeOnceBeforeRender(R,q){void 0!==q?setTimeout((()=>{this._executeOnceBeforeRender(R)}),q):this._executeOnceBeforeRender(R)}addPendingData(R){this._pendingData.push(R)}removePendingData(R){const q=this.isLoading,L=this._pendingData.indexOf(R);-1!==L&&this._pendingData.splice(L,1),q&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(R),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(q)}whenReadyAsync(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((q=>{this.executeWhenReady((()=>{q()}),R)}))}_checkIsReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(R)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(R)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=N.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(R,q,L,B){L||B||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===R.updateFlag&&this._projectionUpdateFlag===q.updateFlag||(this._viewUpdateFlag=R.updateFlag,this._projectionUpdateFlag=q.updateFlag,this._viewMatrix=R,this._projectionMatrix=q,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?w.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=w.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(L,B):this._sceneUbo.useUbo&&(this._sceneUbo.Cj("viewProjection",this._transformMatrix),this._sceneUbo.Cj("view",this._viewMatrix),this._sceneUbo.Cj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(R){const q=new e.d(this._engine,void 0,!1,R??"Nc");return q.addUniform("viewProjection",16),q.addUniform("view",16),q.addUniform("projection",16),q.addUniform("vEyePosition",4),q}setSceneUniformBuffer(R){this._sceneUbo=R,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return j.d.UniqueId}gi(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(R),R._resyncLightSources(),R.parent||R._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(R),q&&R.getChildMeshes().forEach((R=>{this.gi(R)})))}Fc(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=this.meshes.indexOf(R);return-1!==L&&(this.meshes.splice(L,1),R.parent||R._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(R),this.onMeshRemovedObservable.notifyObservers(R),q&&R.getChildMeshes().forEach((R=>{this.Fc(R)})),L}addTransformNode(R){this._blockEntityCollection||R.va()===this&&-1!==R._indexInSceneTransformNodesArray||(R._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(R),R.parent||R._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(R))}removeTransformNode(R){const q=R._indexInSceneTransformNodesArray;if(-1!==q){if(q!==this.transformNodes.length-1){const R=this.transformNodes[this.transformNodes.length-1];this.transformNodes[q]=R,R._indexInSceneTransformNodesArray=q}R._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),R.parent||R._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(R),q}removeSkeleton(R){const q=this.skeletons.indexOf(R);return-1!==q&&(this.skeletons.splice(q,1),this.onSkeletonRemovedObservable.notifyObservers(R),this._executeActiveContainerCleanup(this._activeSkeletons)),q}removeMorphTargetManager(R){const q=this.morphTargetManagers.indexOf(R);return-1!==q&&this.morphTargetManagers.splice(q,1),q}removeLight(R){const q=this.lights.indexOf(R);if(-1!==q){for(const q of this.meshes)q._removeLightSource(R,!1);this.lights.splice(q,1),this.sortLightsByPriority(),R.parent||R._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(R),q}removeCamera(R){const q=this.cameras.indexOf(R);if(-1!==q&&(this.cameras.splice(q,1),R.parent||R._removeFromSceneRootNodes()),this.activeCameras){const q=this.activeCameras.indexOf(R);-1!==q&&this.activeCameras.splice(q,1)}return this.activeCamera===R&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(R),q}removeParticleSystem(R){const q=this.lj.indexOf(R);return-1!==q&&(this.lj.splice(q,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),q}removeAnimation(R){const q=this.animations.indexOf(R);return-1!==q&&this.animations.splice(q,1),q}stopAnimation(R,q,L){}removeAnimationGroup(R){const q=this.animationGroups.indexOf(R);return-1!==q&&this.animationGroups.splice(q,1),q}removeMultiMaterial(R){const q=this.multiMaterials.indexOf(R);return-1!==q&&this.multiMaterials.splice(q,1),this.onMultiMaterialRemovedObservable.notifyObservers(R),q}removeMaterial(R){const q=R._indexInSceneMaterialArray;if(-1!==q&&q<this.materials.length){if(q!==this.materials.length-1){const R=this.materials[this.materials.length-1];this.materials[q]=R,R._indexInSceneMaterialArray=q}R._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(R),q}removeActionManager(R){const q=this.actionManagers.indexOf(R);return-1!==q&&this.actionManagers.splice(q,1),q}removeTexture(R){const q=this.textures.indexOf(R);return-1!==q&&this.textures.splice(q,1),this.onTextureRemovedObservable.notifyObservers(R),q}addLight(R){if(!this._blockEntityCollection){this.lights.push(R),this.sortLightsByPriority(),R.parent||R._addToSceneRootNodes();for(const q of this.meshes)-1===q.lightSources.indexOf(R)&&(q.lightSources.push(R),q._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(R)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(s.e.CompareLightsPriority)}addCamera(R){this._blockEntityCollection||(this.cameras.push(R),this.onNewCameraAddedObservable.notifyObservers(R),R.parent||R._addToSceneRootNodes())}addSkeleton(R){this._blockEntityCollection||(this.skeletons.push(R),this.onNewSkeletonAddedObservable.notifyObservers(R))}addParticleSystem(R){this._blockEntityCollection||this.lj.push(R)}addAnimation(R){this._blockEntityCollection||this.animations.push(R)}addAnimationGroup(R){this._blockEntityCollection||this.animationGroups.push(R)}addMultiMaterial(R){this._blockEntityCollection||(this.multiMaterials.push(R),this.onNewMultiMaterialAddedObservable.notifyObservers(R))}addMaterial(R){this._blockEntityCollection||R.va()===this&&-1!==R._indexInSceneMaterialArray||(R._indexInSceneMaterialArray=this.materials.length,this.materials.push(R),this.onNewMaterialAddedObservable.notifyObservers(R))}addMorphTargetManager(R){this._blockEntityCollection||this.morphTargetManagers.push(R)}addGeometry(R){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[R.uniqueId]=this.geometries.length),this.geometries.push(R))}addActionManager(R){this.actionManagers.push(R)}addTexture(R){this._blockEntityCollection||(this.textures.push(R),this.onNewTextureAddedObservable.notifyObservers(R))}switchActiveCamera(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Ni(),this.activeCamera=R,q&&R.attachControl())}setActiveCameraById(R){const q=this.getCameraById(R);return q?(this.activeCamera=q,q):null}setActiveCameraByName(R){const q=this.getCameraByName(R);return q?(this.activeCamera=q,q):null}getAnimationGroupByName(R){for(let q=0;q<this.animationGroups.length;q++)if(this.animationGroups[q].name===R)return this.animationGroups[q];return null}_getMaterial(R,q){for(let L=0;L<this.materials.length;L++){const R=this.materials[L];if(q(R))return R}if(R)for(let L=0;L<this.multiMaterials.length;L++){const R=this.multiMaterials[L];if(q(R))return R}return null}getMaterialByUniqueID(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(q,(q=>q.uniqueId===R))}getMaterialById(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(q,(q=>q.id===R))}getMaterialByName(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(q,(q=>q.name===R))}getLastMaterialById(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let L=this.materials.length-1;L>=0;L--)if(this.materials[L].id===R)return this.materials[L];if(q)for(let L=this.multiMaterials.length-1;L>=0;L--)if(this.multiMaterials[L].id===R)return this.multiMaterials[L];return null}getTextureByUniqueId(R){for(let q=0;q<this.textures.length;q++)if(this.textures[q].uniqueId===R)return this.textures[q];return null}getTextureByName(R){for(let q=0;q<this.textures.length;q++)if(this.textures[q].name===R)return this.textures[q];return null}getCameraById(R){for(let q=0;q<this.cameras.length;q++)if(this.cameras[q].id===R)return this.cameras[q];return null}getCameraByUniqueId(R){for(let q=0;q<this.cameras.length;q++)if(this.cameras[q].uniqueId===R)return this.cameras[q];return null}getCameraByName(R){for(let q=0;q<this.cameras.length;q++)if(this.cameras[q].name===R)return this.cameras[q];return null}getBoneById(R){for(let q=0;q<this.skeletons.length;q++){const L=this.skeletons[q];for(let q=0;q<L.bones.length;q++)if(L.bones[q].id===R)return L.bones[q]}return null}getBoneByName(R){for(let q=0;q<this.skeletons.length;q++){const L=this.skeletons[q];for(let q=0;q<L.bones.length;q++)if(L.bones[q].name===R)return L.bones[q]}return null}getLightByName(R){for(let q=0;q<this.lights.length;q++)if(this.lights[q].name===R)return this.lights[q];return null}getLightById(R){for(let q=0;q<this.lights.length;q++)if(this.lights[q].id===R)return this.lights[q];return null}getLightByUniqueId(R){for(let q=0;q<this.lights.length;q++)if(this.lights[q].uniqueId===R)return this.lights[q];return null}getParticleSystemById(R){for(let q=0;q<this.lj.length;q++)if(this.lj[q].id===R)return this.lj[q];return null}getGeometryById(R){for(let q=0;q<this.geometries.length;q++)if(this.geometries[q].id===R)return this.geometries[q];return null}_getGeometryByUniqueId(R){if(this._geometriesByUniqueId){const q=this._geometriesByUniqueId[R];if(void 0!==q)return this.geometries[q]}else for(let q=0;q<this.geometries.length;q++)if(this.geometries[q].uniqueId===R)return this.geometries[q];return null}pushGeometry(R,q){return!(!q&&this._getGeometryByUniqueId(R.uniqueId))&&(this.addGeometry(R),this.onNewGeometryAddedObservable.notifyObservers(R),!0)}removeGeometry(R){let q;if(this._geometriesByUniqueId){if(q=this._geometriesByUniqueId[R.uniqueId],void 0===q)return!1}else if(q=this.geometries.indexOf(R),q<0)return!1;if(q!==this.geometries.length-1){const R=this.geometries[this.geometries.length-1];R&&(this.geometries[q]=R,this._geometriesByUniqueId&&(this._geometriesByUniqueId[R.uniqueId]=q))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[R.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(R),!0}getGeometries(){return this.geometries}getMeshById(R){for(let q=0;q<this.meshes.length;q++)if(this.meshes[q].id===R)return this.meshes[q];return null}getMeshesById(R){return this.meshes.filter((function(q){return q.id===R}))}getTransformNodeById(R){for(let q=0;q<this.transformNodes.length;q++)if(this.transformNodes[q].id===R)return this.transformNodes[q];return null}getTransformNodeByUniqueId(R){for(let q=0;q<this.transformNodes.length;q++)if(this.transformNodes[q].uniqueId===R)return this.transformNodes[q];return null}getTransformNodesById(R){return this.transformNodes.filter((function(q){return q.id===R}))}getMeshByUniqueId(R){for(let q=0;q<this.meshes.length;q++)if(this.meshes[q].uniqueId===R)return this.meshes[q];return null}getLastMeshById(R){for(let q=this.meshes.length-1;q>=0;q--)if(this.meshes[q].id===R)return this.meshes[q];return null}getLastTransformNodeById(R){for(let q=this.transformNodes.length-1;q>=0;q--)if(this.transformNodes[q].id===R)return this.transformNodes[q];return null}getLastEntryById(R){let q;for(q=this.meshes.length-1;q>=0;q--)if(this.meshes[q].id===R)return this.meshes[q];for(q=this.transformNodes.length-1;q>=0;q--)if(this.transformNodes[q].id===R)return this.transformNodes[q];for(q=this.cameras.length-1;q>=0;q--)if(this.cameras[q].id===R)return this.cameras[q];for(q=this.lights.length-1;q>=0;q--)if(this.lights[q].id===R)return this.lights[q];return null}getNodeById(R){const q=this.getMeshById(R);if(q)return q;const L=this.getTransformNodeById(R);if(L)return L;const B=this.getLightById(R);if(B)return B;const N=this.getCameraById(R);if(N)return N;const h=this.getBoneById(R);return h||null}getNodeByName(R){const q=this.getMeshByName(R);if(q)return q;const L=this.getTransformNodeByName(R);if(L)return L;const B=this.getLightByName(R);if(B)return B;const N=this.getCameraByName(R);if(N)return N;const h=this.getBoneByName(R);return h||null}getMeshByName(R){for(let q=0;q<this.meshes.length;q++)if(this.meshes[q].name===R)return this.meshes[q];return null}getTransformNodeByName(R){for(let q=0;q<this.transformNodes.length;q++)if(this.transformNodes[q].name===R)return this.transformNodes[q];return null}getLastSkeletonById(R){for(let q=this.skeletons.length-1;q>=0;q--)if(this.skeletons[q].id===R)return this.skeletons[q];return null}getSkeletonByUniqueId(R){for(let q=0;q<this.skeletons.length;q++)if(this.skeletons[q].uniqueId===R)return this.skeletons[q];return null}getSkeletonById(R){for(let q=0;q<this.skeletons.length;q++)if(this.skeletons[q].id===R)return this.skeletons[q];return null}getSkeletonByName(R){for(let q=0;q<this.skeletons.length;q++)if(this.skeletons[q].name===R)return this.skeletons[q];return null}getMorphTargetManagerById(R){for(let q=0;q<this.morphTargetManagers.length;q++)if(this.morphTargetManagers[q].uniqueId===R)return this.morphTargetManagers[q];return null}getMorphTargetById(R){for(let q=0;q<this.morphTargetManagers.length;++q){const L=this.morphTargetManagers[q];for(let q=0;q<L.numTargets;++q){const B=L.getTarget(q);if(B.id===R)return B}}return null}getMorphTargetByName(R){for(let q=0;q<this.morphTargetManagers.length;++q){const L=this.morphTargetManagers[q];for(let q=0;q<L.numTargets;++q){const B=L.getTarget(q);if(B.name===R)return B}}return null}getPostProcessByName(R){for(let q=0;q<this.postProcesses.length;++q){const L=this.postProcesses[q];if(L.name===R)return L}return null}isActiveMesh(R){return-1!==this._activeMeshes.indexOf(R)}get uid(){return this._uid||(this._uid=B.f.RandomId()),this._uid}addExternalData(R,q){return this._externalData||(this._externalData=new z),this._externalData.add(R,q)}getExternalData(R){return this._externalData?this._externalData.get(R):null}getOrAddExternalDataWithFactory(R,q){return this._externalData||(this._externalData=new z),this._externalData.getOrAddWithFactory(R,q)}removeExternalData(R){return this._externalData.remove(R)}_evaluateSubMesh(R,q,L,B){if(B||R.isInFrustum(this._frustumPlanes)){for(const B of this._evaluateSubMeshStage)B.action(q,R);const L=R.Ha();null!==L&&void 0!==L&&(L.hasRenderTargetTextures&&null!=L.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(L)&&(this._processedMaterials.push(L),this._materialsRenderTargets.concatWithNoDuplicate(L.getRenderTargetTextures())),this._renderingManager.dispatch(R,q,L))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(R){this._preventFreeActiveMeshesAndRenderingGroups!==R&&(R&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=R)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let R=0;R<this.activeCameras.length;R++){const q=this.activeCameras[R];q&&q._activeMeshes&&q._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let R=0;R<this.textures.length;R++){const q=this.textures[R];q&&q.renderList&&q.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=N,this._skipEvaluateActiveMeshesCompletely=R,B)for(let R=0;R<this._activeMeshes.length;R++)this._activeMeshes.data[R]._freeze();q&&q()}else L&&L("No active camera found")})),this}unfreezeActiveMeshes(){for(let R=0;R<this.meshes.length;R++){const q=this.meshes[R];q._internalAbstractMeshDataInfo&&(q._internalAbstractMeshDataInfo._isActive=!1)}for(let R=0;R<this._activeMeshes.length;R++)this._activeMeshes.data[R]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(R){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>R.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var R;if(this._activeMeshes.length>0)null===(R=this.activeCamera)||void 0===R||R._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const R=this._activeMeshes.length;for(let q=0;q<R;q++){this._activeMeshes.data[q].Jj()}}if(this._activeParticleSystems){const R=this._activeParticleSystems.length;for(let q=0;q<R;q++)this._activeParticleSystems.data[q].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const B of this._beforeEvaluateActiveMeshStage)B.action();const q=this.getActiveMeshCandidates(),L=q.length;for(let B=0;B<L;B++){const R=q.data[B];if(R._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,R.isBlocked)continue;if(this._totalVertices.addCount(R.getTotalVertices(),!1),!R.isReady()||!R.isEnabled()||R.Ud.hasAZeroComponent)continue;R.Jj(),R.actionManager&&R.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(R);let L=this.customLODSelector?this.customLODSelector(R,this.activeCamera):R.getLOD(this.activeCamera);if(R._internalAbstractMeshDataInfo._currentLOD=L,R._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==L&&null!==L&&(L!==R&&0!==L.billboardMode&&L.Jj(),R._preActivate(),R.isVisible&&R.visibility>0&&0!==(R.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||R.sb||R.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(R),this.activeCamera._activeMeshes.push(R),L!==R&&L._activate(this._renderId,!1);for(const q of this._preActiveMeshStage)q.action(R);R._activate(this._renderId,!1)&&(R.isAnInstance?R._internalAbstractMeshDataInfo._actAsRegularMesh&&(L=R):L._internalAbstractMeshDataInfo._onlyForInstances=!1,L._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(R,L)),R._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let R=0;R<this.lj.length;R++){const q=this.lj[R];if(!q.isStarted()||!q.j)continue;const L=q.j;L.position&&!L.isEnabled()||(this._activeParticleSystems.push(q),q.animate(),this._renderingManager.dispatchParticles(q))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(R){this._skeletonsEnabled&&R.skeleton&&(this._activeSkeletons.pushNoDuplicate(R.skeleton)&&(R.skeleton.prepare(),this._activeBones.addCount(R.skeleton.bones.length,!1)),R.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(R)&&this.frameGraph&&R.applySkeleton(R.skeleton))}_activeMesh(R,q){this._prepareSkeleton(q);let L=R.hasInstances||R.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||q.sb;if(q&&q.Zf&&q.Zf.length>0){const B=this.getActiveSubMeshCandidates(q),N=B.length;L=L||1===N;for(let h=0;h<N;h++){const N=B.data[h];this._evaluateSubMesh(N,q,R,L)}}}updateTransformMatrix(R){const q=this.activeCamera;if(q)if(q._renderingMultiview){const L=q._rigCameras[0],B=q._rigCameras[1];this.setTransformMatrix(L.getViewMatrix(),L.getProjectionMatrix(R),B.getViewMatrix(),B.getProjectionMatrix(R))}else this.setTransformMatrix(q.getViewMatrix(),q.getProjectionMatrix(R))}_bindFrameBuffer(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];R&&R._multiviewTexture?R._multiviewTexture._bindFrameBuffer():R&&R.outputRenderTarget?R.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),q&&this._clearFrameBuffer(R)}_clearFrameBuffer(R){if(R&&R._multiviewTexture);else if(R&&R.outputRenderTarget&&!R._renderingMultiview){const q=R.outputRenderTarget;q.onClearObservable.hasObservers()?q.onClearObservable.notifyObservers(this._engine):q.skipInitialClear||R.isRightCamera||(this.Oi&&this._engine.clear(q.clearColor||this._clearColor,!q._cleared,!0,!0),q._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(R,q){var L;let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(R&&R._skipRendering)return;const h=this._engine;if(this._activeCamera=R,!this.activeCamera)throw new Error("Active camera not set");if(h.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&N){let q=!0;R._renderingMultiview&&R.outputRenderTarget&&(q=R.outputRenderTarget.skipInitialClear,this.Oi&&(this._defaultFrameBufferCleared=!1,R.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),R._renderingMultiview&&R.outputRenderTarget&&(R.outputRenderTarget.skipInitialClear=q)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let B=0;B<this._softwareSkinnedMeshes.length;B++){const R=this._softwareSkinnedMeshes.data[B];R.applySkeleton(R.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),R.customRenderTargets&&R.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(R.customRenderTargets),q&&q.customRenderTargets&&q.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(q.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const B of this._gatherActiveCameraRenderTargetsStage)B.action(this._renderTargets);let Z=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){B.f.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let R=0;R<this._renderTargets.length;R++){const q=this._renderTargets.data[R];if(q._shouldRender()){this._renderId++;const R=q.activeCamera&&q.activeCamera!==this.activeCamera;q.render(R,this.dumpNextRenderTargets),Z=!0}}B.f.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const R of this._cameraDrawRenderTargetStage)Z=R.action(this.activeCamera)||Z;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(L=R.outputRenderTarget)||void 0===L?void 0:L.renderPassId)??R.renderPassId??0,Z&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||R._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const B of this._beforeCameraDrawStage)B.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),h.snapshotRendering&&1===h.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const B of this._afterCameraDrawStage)B.action(this.activeCamera);if(this.postProcessManager&&!R._multiviewTexture){const q=R.outputRenderTarget?R.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(R.isIntermediate,q)}for(const B of this._afterCameraPostProcessStage)B.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===R.cameraRigMode||R._renderingMultiview)return R._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(R,void 0,q),void this.onAfterRenderCameraObservable.notifyObservers(R);if(R._useMultiviewToSingleView)this._renderMultiviewToSingleView(R);else{this.onBeforeCameraRenderObservable.notifyObservers(R);for(let q=0;q<R._rigCameras.length;q++)this._renderForCamera(R._rigCameras[q],R)}this._activeCamera=R,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(R)}_checkIntersections(){for(let R=0;R<this._meshesForIntersections.length;R++){const q=this._meshesForIntersections.data[R];if(q.actionManager)for(let R=0;q.actionManager&&R<q.actionManager.actions.length;R++){const L=q.actionManager.actions[R];if(12===L.trigger||13===L.trigger){const R=L.getTriggerParameter(),B=R.mesh?R.mesh:R,N=B.intersectsMesh(q,R.usePreciseIntersection),h=q._intersectionsInProgress.indexOf(B);N&&-1===h?12===L.trigger?(L._executeCurrent(U.CreateNew(q,void 0,B)),q._intersectionsInProgress.push(B)):13===L.trigger&&q._intersectionsInProgress.push(B):!N&&h>-1&&(13===L.trigger&&L._executeCurrent(U.CreateNew(q,void 0,B)),q.actionManager.hasSpecificTrigger(13,(R=>{const q=R.mesh?R.mesh:R;return B===q}))&&13!==L.trigger||q._intersectionsInProgress.splice(h,1))}}}}_advancePhysicsEngineStep(R){}_animate(R){}animate(){if(this._engine.isDeterministicLockStep()){let R=Math.max(RR.MinDeltaTime,Math.min(this._engine.getDeltaTime(),RR.MaxDeltaTime))+this._timeAccumulator;const q=this._engine.getTimeStep(),L=1e3/q/1e3;let B=0;const N=this._engine.getLockstepMaxSteps();let h=Math.floor(R/q);for(h=Math.min(h,N);R>0&&B<h;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=q*L,this._animate(q),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(q),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,B++,R-=q;this._timeAccumulator=R<0?0:R}else{const R=this.useConstantAnimationDeltaTime?16:Math.max(RR.MinDeltaTime,Math.min(this._engine.getDeltaTime(),RR.MaxDeltaTime));this._animationRatio=.06*R,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(R)}}_clear(){(this.autoClearDepthAndStencil||this.Oi)&&this._engine.clear(this._clearColor,this.Oi||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(R){var q;if(null===R||void 0===R||!R.outputRenderTarget||null!==R&&void 0!==R&&R.isRigCamera||(R.outputRenderTarget._cleared=!1),null!==R&&void 0!==R&&null!==(q=R.rigCameras)&&void 0!==q&&q.length)for(let L=0;L<R.rigCameras.length;++L){const q=R.rigCameras[L].outputRenderTarget;q&&(q._cleared=!1)}}resetDrawCache(R){if(this.meshes)for(const q of this.meshes)q.resetDrawCache(R)}_renderWithFrameGraph(){var R;let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),q)for(const N of this.cameras)if(N.update(),0!==N.cameraRigMode)for(let R=0;R<N._rigCameras.length;R++)N._rigCameras[R].update();for(const N of this._beforeClearStage)N.action();const L=this.getActiveMeshCandidates(),B=L.length;for(let N=0;N<B;N++){const R=L.data[N];R.isBlocked||(this._totalVertices.addCount(R.getTotalVertices(),!1),R.isReady()&&R.isEnabled()&&!R.Ud.hasAZeroComponent&&(R.Jj(),R.actionManager&&R.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(R)))}if(this.particlesEnabled)for(let N=0;N<this.lj.length;N++){const R=this.lj[N];if(!R.isStarted()||!R.j)continue;const q=R.j;q.position&&!q.isEnabled()||(this._activeParticleSystems.push(R),R.animate())}null===(R=this.frameGraph)||void 0===R||R.execute()}render(){var R;let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(R=this.activeCameras)&&void 0!==R&&R.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),L||this.animate();for(const R of this._beforeCameraUpdateStage)R.action();if(q)if(this.activeCameras&&this.activeCameras.length>0)for(let R=0;R<this.activeCameras.length;R++){const q=this.activeCameras[R];if(q.update(),0!==q.cameraRigMode)for(let R=0;R<q._rigCameras.length;R++)q._rigCameras[R].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let R=0;R<this.activeCamera._rigCameras.length;R++)this.activeCamera._rigCameras[R].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(q,L);else{var N;const R=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const q=null!==(N=this.activeCameras)&&void 0!==N&&N.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){B.f.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let L=0;L<this.customRenderTargets.length;L++){const B=this.customRenderTargets[L];if(B._shouldRender()){if(this._renderId++,this.activeCamera=B.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");R.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),B.render(q!==this.activeCamera,this.dumpNextRenderTargets)}}B.f.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===q||void 0===q?void 0:q.renderPassId)??0,this.activeCamera=q,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const L of this._beforeClearStage)L.action();this._clearFrameBuffer(this.activeCamera);for(const L of this._gatherRenderTargetsStage)L.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let L=0;L<this.activeCameras.length;L++)this._processSubCameras(this.activeCameras[L],L>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const R of this._afterRenderStage)R.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let R=0;R<this._toBeDisposed.length;R++){const q=this._toBeDisposed[R];q&&q.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let R=0;R<this.materials.length;R++)this.materials[R].freeze()}unfreezeMaterials(){for(let R=0;R<this.materials.length;R++)this.materials[R].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((R=>{R.onAnimationEndObservable.clear(),R.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const R=this._activeRequests.slice();for(const N of R)N.abort();this._activeRequests.length=0;try{this.ej.notifyObservers(this)}catch(B){X.d.Error("An error occurred while calling onDisposeObservable!",B)}this.Ni();if(this._engine.getInputElement())for(let N=0;N<this.cameras.length;N++)this.cameras[N].Ni();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(R=>R.dispose(!0))),this._disposeList(this.transformNodes,(R=>R.dispose(!0)));const q=this.cameras;this._disposeList(q),this.pi&&this.pi.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.lj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let L=this._engine.scenes.indexOf(this);L>-1&&this._engine.scenes.splice(L,1),d.b._LastCreatedScene===this&&(this._engine.scenes.length>0?d.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:d.b._LastCreatedScene=null),L=this._engine._virtualScenes.indexOf(this),L>-1&&this._engine._virtualScenes.splice(L,1),this._engine.wipeCaches(!0),this.ej.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(R,q){const L=R.slice(0);q=q??(R=>R.dispose());for(const B of L)q(B);R.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let R=0;R<this.meshes.length;R++){const q=this.meshes[R].yj;q&&q.clearCachedData()}}cleanCachedTextureBuffer(){for(const R of this.textures){R._buffer&&(R._buffer=null)}}getWorldExtends(R){const q=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new F.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return R=R||(()=>!0),this.meshes.filter(R).forEach((R=>{if(R.Jj(!0),!R.Zf||0===R.Zf.length||R.infiniteDistance)return;const B=R.getBoundingInfo(),N=B.boundingBox.minimumWorld,h=B.boundingBox.maximumWorld;F.m.CheckExtends(N,q,L),F.m.CheckExtends(h,q,L)})),{min:q,max:L}}createPickingRay(R,q,L,B){throw(0,f.d)("Ray")}createPickingRayToRef(R,q,L,B,N){throw(0,f.d)("Ray")}createPickingRayInCameraSpace(R,q,L){throw(0,f.d)("Ray")}createPickingRayInCameraSpaceToRef(R,q,L,B){throw(0,f.d)("Ray")}yc(R,q,L,B,N,h){const Z=(0,f.d)("Ray",!0);return Z&&X.d.Warn(Z),new y.c}pickWithBoundingInfo(R,q,L,B,N){const h=(0,f.d)("Ray",!0);return h&&X.d.Warn(h),new y.c}pickWithRay(R,q,L,B){throw(0,f.d)("Ray")}multiPick(R,q,L,B,N){throw(0,f.d)("Ray")}multiPickWithRay(R,q,L){throw(0,f.d)("Ray")}setPointerOverMesh(R,q,L){this._inputManager.setPointerOverMesh(R,q,L)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const R of this.geometries)R._rebuild();for(const R of this.meshes)R._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const R of this._components)R.rebuild();for(const R of this.lj)R.rebuild();if(this.spriteManagers)for(const R of this.spriteManagers)R.rebuild()}_rebuildTextures(){for(const R of this.textures)R._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(R,q,L){if(void 0===q)return R;const B=[];for(const N in R){const h=R[N];Y.b&&Y.b.MatchesQuery(h,q)&&(!L||L(h))&&B.push(h)}return B}getMeshesByTags(R,q){return this._getByTags(this.meshes,R,q)}getCamerasByTags(R,q){return this._getByTags(this.cameras,R,q)}getLightsByTags(R,q){return this._getByTags(this.lights,R,q)}getMaterialByTags(R,q){return this._getByTags(this.materials,R,q).concat(this._getByTags(this.multiMaterials,R,q))}getTransformNodesByTags(R,q){return this._getByTags(this.transformNodes,R,q)}setRenderingOrder(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(R,q,L,B)}setRenderingAutoClearDepthStencil(R,q){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(R,q,L,B)}getAutoClearDepthStencilSetup(R){return this._renderingManager.getAutoClearDepthStencilSetup(R)}_forceBlockMaterialDirtyMechanism(R){this._blockMaterialDirtyMechanism=R}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(R){this._blockMaterialDirtyMechanism!==R&&(this._blockMaterialDirtyMechanism=R,R||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(R,q){if(!this._blockMaterialDirtyMechanism)for(const L of this.materials)q&&!q(L)||L.Ag(R)}_loadFile(R,q,L,B,N,h,Z){const z=(0,J.r)(R,q,L,B?this.offlineProvider:void 0,N,h,Z);return this._activeRequests.push(z),z.onCompleteObservable.add((R=>{this._activeRequests.splice(this._activeRequests.indexOf(R),1)})),z}_loadFileAsync(R,q,L,B,N){return new Promise(((h,Z)=>{this._loadFile(R,(R=>{h(R)}),q,L,B,((R,q)=>{Z(q)}),N)}))}_requestFile(R,q,L,B,N,h,Z){const z=(0,J.B)(R,q,L,B?this.offlineProvider:void 0,N,h,Z);return this._activeRequests.push(z),z.onCompleteObservable.add((R=>{this._activeRequests.splice(this._activeRequests.indexOf(R),1)})),z}_requestFileAsync(R,q,L,B,N){return new Promise(((h,Z)=>{this._requestFile(R,(R=>{h(R)}),q,L,B,(R=>{Z(R)}),N)}))}_readFile(R,q,L,B,N){const h=(0,J.y)(R,q,L,B,N);return this._activeRequests.push(h),h.onCompleteObservable.add((R=>{this._activeRequests.splice(this._activeRequests.indexOf(R),1)})),h}_readFileAsync(R,q,L){return new Promise(((B,N)=>{this._readFile(R,(R=>{B(R)}),q,L,(R=>{N(R)}))}))}getPerfCollector(){throw(0,f.d)("performanceViewerSceneExtension")}setActiveCameraByID(R){return this.setActiveCameraById(R)}getMaterialByID(R){return this.getMaterialById(R)}getLastMaterialByID(R){return this.getLastMaterialById(R)}getTextureByUniqueID(R){return this.getTextureByUniqueId(R)}getCameraByID(R){return this.getCameraById(R)}getCameraByUniqueID(R){return this.getCameraByUniqueId(R)}getBoneByID(R){return this.getBoneById(R)}getLightByID(R){return this.getLightById(R)}getLightByUniqueID(R){return this.getLightByUniqueId(R)}getParticleSystemByID(R){return this.getParticleSystemById(R)}getGeometryByID(R){return this.getGeometryById(R)}getMeshByID(R){return this.getMeshById(R)}getMeshByUniqueID(R){return this.getMeshByUniqueId(R)}getLastMeshByID(R){return this.getLastMeshById(R)}getMeshesByID(R){return this.getMeshesById(R)}getTransformNodeByID(R){return this.getTransformNodeById(R)}getTransformNodeByUniqueID(R){return this.getTransformNodeByUniqueId(R)}getTransformNodesByID(R){return this.getTransformNodesById(R)}getNodeByID(R){return this.getNodeById(R)}getLastEntryByID(R){return this.getLastEntryById(R)}getLastSkeletonByID(R){return this.getLastSkeletonById(R)}}RR.FOGMODE_NONE=0,RR.FOGMODE_EXP=1,RR.FOGMODE_EXP2=2,RR.FOGMODE_LINEAR=3,RR.MinDeltaTime=1,RR.MaxDeltaTime=1e3,(0,u.f)("BABYLON.Scene",RR)},11160:(R,q,L)=>{"use strict";L.d(q,{d:()=>B,f:()=>N});class B{}B.NAME_EFFECTLAYER="EffectLayer",B.NAME_LAYER="Layer",B.NAME_LENSFLARESYSTEM="LensFlareSystem",B.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",B.NAME_PARTICLESYSTEM="rb",B.NAME_GAMEPAD="Gamepad",B.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",B.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",B.NAME_PREPASSRENDERER="PrePassRenderer",B.NAME_DEPTHRENDERER="DepthRenderer",B.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",B.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",B.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",B.NAME_SPRITE="Sprite",B.NAME_SUBSURFACE="SubSurface",B.NAME_OUTLINERENDERER="Outline",B.NAME_PROCEDURALTEXTURE="ProceduralTexture",B.NAME_SHADOWGENERATOR="ShadowGenerator",B.NAME_OCTREE="tb",B.NAME_PHYSICSENGINE="PhysicsEngine",B.NAME_AUDIO="Audio",B.NAME_FLUIDRENDERER="FluidRenderer",B.STEP_ISREADYFORMESH_EFFECTLAYER=0,B.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,B.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,B.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,B.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,B.STEP_BEFORECAMERADRAW_PREPASS=0,B.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,B.STEP_BEFORECAMERADRAW_LAYER=2,B.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,B.STEP_BEFORERENDERTARGETDRAW_LAYER=1,B.STEP_BEFORERENDERINGMESH_PREPASS=0,B.STEP_BEFORERENDERINGMESH_OUTLINE=1,B.STEP_AFTERRENDERINGMESH_PREPASS=0,B.STEP_AFTERRENDERINGMESH_OUTLINE=1,B.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,B.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,B.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,B.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,B.STEP_BEFORECLEAR_PREPASS=1,B.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,B.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,B.STEP_AFTERRENDERTARGETDRAW_LAYER=1,B.STEP_AFTERCAMERADRAW_PREPASS=0,B.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,B.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,B.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,B.STEP_AFTERCAMERADRAW_LAYER=4,B.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,B.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,B.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,B.STEP_AFTERRENDER_AUDIO=0,B.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,B.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,B.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,B.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,B.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,B.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,B.STEP_POINTERMOVE_SPRITE=0,B.STEP_POINTERDOWN_SPRITE=0,B.STEP_POINTERUP_SPRITE=0;class N extends Array{constructor(R){super(...R)}static Create(){return Object.create(N.prototype)}registerStep(R,q,L){let B=0,N=Number.MAX_VALUE;for(;B<this.length;B++){if(N=this[B].index,R<N)break}this.splice(B,0,{index:R,component:q,action:L.bind(q)})}clear(){this.length=0}}},11053:(R,q,L)=>{"use strict";L.d(q,{d:()=>B});function B(R,q,L,B){var N,h=arguments.length,Z=h<3?q:null===B?B=Object.getOwnPropertyDescriptor(q,L):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Z=Reflect.decorate(R,q,L,B);else for(var z=R.length-1;z>=0;z--)(N=R[z])&&(Z=(h<3?N(Z):h>3?N(q,L,Z):N(q,L))||Z);return h>3&&Z&&Object.defineProperty(q,L,Z),Z}Object.create;Object.create},12016:(R,q,L)=>{"use strict";class B{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((R,q)=>{this._resolve=R,this._reject=q}))}}var N=L(11081),h=L(11112),Z=L(10757),z=L(11337),Y=L(12022),F=L(12039),C=L(10760),e=L(11525),y=L(12047),U=L(12051),n=L(10797),r=L(10767),p=L(10774);class c{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(R){this._useTextureToStoreBoneMatrices=R,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(R,q,L){this.name=R,this.id=q,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=N.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new C.b,this.bones=[],this._scene=L||n.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const B=this._scene.getEngine().getCaps();this._canUseTextureForBones=B.textureFloat&&B.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((R=>!R.getParent()))}getTransformMatrices(R){if(this.needInitialSkinMatrix){if(!R)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return R._bonesTransformMatrices||this.prepare(!0),R._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(R){return this.needInitialSkinMatrix&&R._transformMatrixTexture?R._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(R){let q=`Name: ${this.name}, nBones: ${this.bones.length}`;if(q+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,R){q+=", Ranges: {";let R=!0;for(const L in this._ranges)R&&(q+=", ",R=!1),q+=L;q+="}"}return q}getBoneIndexByName(R){for(let q=0,L=this.bones.length;q<L;q++)if(this.bones[q].name===R)return q;return-1}createAnimationRange(R,q,L){if(!this._ranges[R]){this._ranges[R]=new U.e(R,q,L);for(let B=0,N=this.bones.length;B<N;B++)this.bones[B].animations[0]&&this.bones[B].animations[0].createRange(R,q,L)}}deleteAnimationRange(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let L=0,B=this.bones.length;L<B;L++)this.bones[L].animations[0]&&this.bones[L].animations[0].deleteRange(R,q);this._ranges[R]=null}getAnimationRange(R){return this._ranges[R]||null}getAnimationRanges(){const R=[];let q;for(q in this._ranges)R.push(this._ranges[q]);return R}copyAnimationRange(R,q){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[q]||!R.getAnimationRange(q))return!1;let B=!0;const N=this._getHighestAnimationFrame()+1,h={},Z=R.bones;let z,Y;for(Y=0,z=Z.length;Y<z;Y++)h[Z[Y].name]=Z[Y];this.bones.length!==Z.length&&(r.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Z.length}`),B=!1);const F=L&&this.dimensionsAtRest&&R.dimensionsAtRest?this.dimensionsAtRest.divide(R.dimensionsAtRest):null;for(Y=0,z=this.bones.length;Y<z;Y++){const R=this.bones[Y].name,Z=h[R];Z?B=B&&this.bones[Y].copyAnimationRange(Z,q,N,L,F):(r.d.Warn("copyAnimationRange: not same rig, missing source bone "+R),B=!1)}const C=R.getAnimationRange(q);return C&&(this._ranges[q]=new U.e(q,C.from+N,C.to+N)),B}returnToRest(){for(const R of this.bones)-1!==R._index&&R.returnToRest()}_getHighestAnimationFrame(){let R=0;for(let q=0,L=this.bones.length;q<L;q++)if(this.bones[q].animations[0]){const L=this.bones[q].animations[0].getHighestFrame();R<L&&(R=L)}return R}beginAnimation(R,q,L,B){const N=this.getAnimationRange(R);return N?this._scene.beginAnimation(this,N.from,N.to,q,L,B):null}static MakeAnimationAdditive(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;const B=R.getAnimationRange(L);if(!B)return null;const N=R._scene.getAllAnimatablesByTarget(R);let h=null;for(let z=0;z<N.length;z++){const R=N[z];if(R.fromFrame===(null===B||void 0===B?void 0:B.from)&&R.toFrame===(null===B||void 0===B?void 0:B.to)){h=R;break}}const Z=R.getAnimatables();for(let z=0;z<Z.length;z++){const R=Z[z].animations;if(R)for(let B=0;B<R.length;B++)y.b.MakeAnimationAdditive(R[B],q,L)}return h&&(h.isAdditive=!0),R}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(R){this._meshesWithPoseMatrix.push(R)}_unregisterMeshWithPoseMatrix(R){const q=this._meshesWithPoseMatrix.indexOf(R);q>-1&&this._meshesWithPoseMatrix.splice(q,1)}_computeTransformMatrices(R,q){this.onBeforeComputeObservable.notifyObservers(this);for(let L=0;L<this.bones.length;L++){const B=this.bones[L];B._childUpdateId++;const N=B.getParent();if(N?B.getLocalMatrix().multiplyToRef(N.getFinalMatrix(),B.getFinalMatrix()):q?B.getLocalMatrix().multiplyToRef(q,B.getFinalMatrix()):B.getFinalMatrix().p(B.getLocalMatrix()),-1!==B._index){const q=null===B._index?L:B._index;B.getAbsoluteInverseBindMatrix().multiplyToArray(B.getFinalMatrix(),R,16*q)}}this._identity.copyToArray(R,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const R=this.va().getRenderId();if(this._currentRenderId===R)return;this._currentRenderId=R}if(this._numBonesWithLinkedTransformNode>0)for(const R of this.bones)if(R._linkedTransformNode){const q=R._linkedTransformNode;R.position=q.position,q.rotationQuaternion?R.rotationQuaternion=q.rotationQuaternion:R.rotation=q.rotation,R.Ud=q.Ud}if(this.needInitialSkinMatrix)for(const R of this._meshesWithPoseMatrix){const q=R.getPoseMatrix();let L=this._isDirty;if(R._bonesTransformMatrices&&R._bonesTransformMatrices.length===16*(this.bones.length+1)||(R._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),L=!0),L){if(this._synchronizedWithMesh!==R){this._synchronizedWithMesh=R;for(const R of this.bones)if(!R.getParent()){R.getBindMatrix().multiplyToRef(q,N.h.Matrix[1]),R._updateAbsoluteBindMatrices(N.h.Matrix[1])}if(this.isUsingTextureForMatrices){const q=4*(this.bones.length+1);R._transformMatrixTexture&&R._transformMatrixTexture.getSize().width===q||(R._transformMatrixTexture&&R._transformMatrixTexture.dispose(),R._transformMatrixTexture=e.c.CreateRGBATexture(R._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(R._bonesTransformMatrices,q),this.isUsingTextureForMatrices&&R._transformMatrixTexture&&R._transformMatrixTexture.update(R._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=e.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let R=0;R<this.bones.length;R++)this._animatables.push(this.bones[R])}return this._animatables}clone(R,q){const L=new c(R,q||R,this._scene);L.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let B=0;B<this.bones.length;B++){const R=this.bones[B];let q=null;const N=R.getParent();if(N){const R=this.bones.indexOf(N);q=L.bones[R]}const h=new F.d(R.name,L,q,R.getBindMatrix().clone(),R.getRestMatrix().clone());h._index=R._index,R._linkedTransformNode&&h.linkTransformNode(R._linkedTransformNode),p.e.DeepCopy(R.animations,h.animations)}if(this._ranges){L._ranges={};for(const R in this._ranges){const q=this._ranges[R];q&&(L._ranges[R]=q.clone())}}return this._isDirty=!0,L.prepare(!0),L}enableBlending(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((q=>{q.animations.forEach((q=>{q.enableBlending=!0,q.blendingSpeed=R}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const R=this._parentContainer.skeletons.indexOf(this);R>-1&&this._parentContainer.skeletons.splice(R,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const R={};R.name=this.name,R.id=this.id,this.dimensionsAtRest&&(R.dimensionsAtRest=this.dimensionsAtRest.dj()),R.bones=[],R.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let L=0;L<this.bones.length;L++){var q;const B=this.bones[L],N=B.getParent(),h={parentBoneIndex:N?this.bones.indexOf(N):-1,index:B.getIndex(),name:B.name,id:B.id,matrix:B.getBindMatrix().dj(),rest:B.getRestMatrix().dj(),linkedTransformNodeId:null===(q=B.getTransformNode())||void 0===q?void 0:q.id};R.bones.push(h),B.length&&(h.length=B.length),B.metadata&&(h.metadata=B.metadata),B.animations&&B.animations.length>0&&(h.animation=B.animations[0].serialize()),R.ranges=[];for(const q in this._ranges){const L=this._ranges[q];if(!L)continue;const B={};B.name=q,B.from=L.from,B.to=L.to,R.ranges.push(B)}}return R}static Parse(R,q){const L=new c(R.name,R.id,q);let B;for(R.dimensionsAtRest&&(L.dimensionsAtRest=N.m.Ig(R.dimensionsAtRest)),L.needInitialSkinMatrix=R.needInitialSkinMatrix,B=0;B<R.bones.length;B++){const q=R.bones[B],h=R.bones[B].index;let Z=null;q.parentBoneIndex>-1&&(Z=L.bones[q.parentBoneIndex]);const z=q.rest?N.c.Ig(q.rest):null,Y=new F.d(q.name,L,Z,N.c.Ig(q.matrix),z,null,h);void 0!==q.id&&null!==q.id&&(Y.id=q.id),q.length&&(Y.length=q.length),q.metadata&&(Y.metadata=q.metadata),q.animation&&Y.animations.push(y.b.Parse(q.animation)),void 0!==q.linkedTransformNodeId&&null!==q.linkedTransformNodeId&&(L._hasWaitingData=!0,Y._waitingTransformNodeId=q.linkedTransformNodeId)}if(R.ranges)for(B=0;B<R.ranges.length;B++){const q=R.ranges[B];L.createAnimationRange(q.name,q.from,q.to)}return L}computeAbsoluteMatrices(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||R)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(R)}getPoseMatrix(){let R=null;return this._meshesWithPoseMatrix.length>0&&(R=this._meshesWithPoseMatrix[0].getPoseMatrix()),R}sortBones(){const R=[],q=new Array(this.bones.length);for(let L=0;L<this.bones.length;L++)this._sortBones(L,R,q);this.bones=R}_sortBones(R,q,L){if(L[R])return;L[R]=!0;const B=this.bones[R];if(!B)return;void 0===B._index&&(B._index=R);const N=B.getParent();N&&this._sortBones(this.bones.indexOf(N),q,L),q.push(B)}setCurrentPoseAsRest(){this.bones.forEach((R=>{R.setCurrentPoseAsRest()}))}}var d=L(11216),f=L(11053),v=L(11058),T=L(12057),t=L(12067),D=L(10889),S=L(11117);class I extends t.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(R){this.subSurface.refractionTexture=R,R?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(R){this.subSurface.indexOfRefraction=R}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(R){this.subSurface.invertRefractionY=R}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(R){this.subSurface.linkRefractionWithTransparency=R,R&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===t.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(R){R!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=R?t.c.LIGHTFALLOFF_PHYSICAL:t.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===t.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(R){R!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=R?t.c.LIGHTFALLOFF_GLTF:t.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(R){this.imageProcessingConfiguration.colorCurvesEnabled=R}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(R){this.imageProcessingConfiguration.colorGradingEnabled=R}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(R){this._imageProcessingConfiguration.toneMappingEnabled=R}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(R){this._imageProcessingConfiguration.exposure=R}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(R){this._imageProcessingConfiguration.contrast=R}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(R){this._imageProcessingConfiguration.colorGradingTexture=R}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(R){this._imageProcessingConfiguration.colorCurves=R}constructor(R,q){super(R,q,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=I.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=h.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new h.e(0,0,0),this.albedoColor=new h.e(1,1,1),this.reflectivityColor=new h.e(1,1,1),this.reflectionColor=new h.e(1,1,1),this.emissiveColor=new h.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,T.b)(this.va())}getClassName(){return"PBRMaterial"}clone(R){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const B=S.b.Clone((()=>new I(R,this.va())),this,{cloneTexturesOnlyOnce:q});return B.id=R,B.name=R,this.stencil.copyTo(B.stencil),this._clonePlugins(B,L),B}serialize(){const R=super.serialize();return R.customType="BABYLON.PBRMaterial",R}static Parse(R,q,L){const B=S.b.Parse((()=>new I(R.name,q)),R,q,L);return R.stencil&&B.stencil.parse(R.stencil,q,L),d.c._ParsePlugins(R,B,q,L),R.clearCoat&&B.clearCoat.parse(R.clearCoat,q,L),R.anisotropy&&B.anisotropy.parse(R.anisotropy,q,L),R.brdf&&B.brdf.parse(R.brdf,q,L),R.sheen&&B.sheen.parse(R.sheen,q,L),R.subSurface&&B.subSurface.parse(R.subSurface,q,L),R.iridescence&&B.iridescence.parse(R.iridescence,q,L),B}}I.PBRMATERIAL_OPAQUE=t.c.PBRMATERIAL_OPAQUE,I.PBRMATERIAL_ALPHATEST=t.c.PBRMATERIAL_ALPHATEST,I.PBRMATERIAL_ALPHABLEND=t.c.PBRMATERIAL_ALPHABLEND,I.PBRMATERIAL_ALPHATESTANDBLEND=t.c.PBRMATERIAL_ALPHATESTANDBLEND,I.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=t.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"directIntensity",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveIntensity",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"environmentIntensity",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"specularIntensity",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"disableBumpMap",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"albedoTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTexture",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTextureStrength",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"opacityTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectionTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectivityTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicTexture",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallic",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"roughness",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicF0Factor",void 0),(0,f.d)([(0,v.k)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicReflectanceColor",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicReflectanceTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectanceTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"microSurfaceTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"bumpTexture",void 0),(0,f.d)([(0,v.A)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty",null)],I.prototype,"lightmapTexture",void 0),(0,f.d)([(0,v.k)("ambient"),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientColor",void 0),(0,f.d)([(0,v.k)("albedo"),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"albedoColor",void 0),(0,f.d)([(0,v.k)("reflectivity"),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectivityColor",void 0),(0,f.d)([(0,v.k)("reflection"),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectionColor",void 0),(0,f.d)([(0,v.k)("emissive"),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveColor",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"microSurface",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useLightmapAsShadowmap",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"useAlphaFromAlbedoTexture",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"forceAlphaTest",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"alphaCutOff",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useSpecularOverAlpha",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAmbientInGrayScale",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,f.d)([(0,v.K)()],I.prototype,"usePhysicalLightFalloff",null),(0,f.d)([(0,v.K)()],I.prototype,"useGLTFLightFalloff",null),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRadianceOverAlpha",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useObjectSpaceNormalMap",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useParallax",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useParallaxOcclusion",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"parallaxScaleBias",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsLightsDirty")],I.prototype,"disableLighting",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"forceIrradianceInFragment",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsLightsDirty")],I.prototype,"maxSimultaneousLights",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapX",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapY",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"twoSidedLighting",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAlphaFresnel",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useLinearAlphaFresnel",void 0),(0,f.d)([(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"environmentBRDFTexture",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"forceNormalForward",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"enableSpecularAntiAliasing",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useHorizonOcclusion",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRadianceOcclusion",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsMiscDirty")],I.prototype,"unlit",void 0),(0,f.d)([(0,v.K)(),(0,v.c)("_markAllSubMeshesAsMiscDirty")],I.prototype,"applyDecalMapAfterDetailMap",void 0),(0,D.f)("BABYLON.PBRMaterial",I);var K=L(11277),m=L(11379),o=L(11136),l=L(11364),G=L(11375),W=L(11329);class H{get influence(){return this._influence}set influence(R){if(this._influence===R)return;const q=this._influence;this._influence=R,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===q||0===R)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=R,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new C.b,this._onDataLayoutChanged=new C.b,this._animationPropertiesOverride=null,this.id=R,this._scene=L||n.b.LastCreatedScene,this.influence=q,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(R){const q=this.hasPositions;this._positions=R,q!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(R){const q=this.hasNormals;this._normals=R,q!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(R){const q=this.hasTangents;this._tangents=R,q!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(R){const q=this.hasUVs;this._uvs=R,q!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const R=S.b.Clone((()=>new H(this.name,this.influence,this._scene)),this);return R._positions=this._positions,R._normals=this._normals,R._tangents=this._tangents,R._uvs=this._uvs,R}serialize(){const R={};return R.name=this.name,R.influence=this.influence,R.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(R.id=this.id),this.hasNormals&&(R.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(R.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(R.Aa=Array.prototype.slice.call(this.getUVs())),S.b.AppendSerializedAnimations(this,R),R}getClassName(){return"MorphTarget"}static Parse(R,q){const L=new H(R.name,R.influence);if(L.setPositions(R.xa),null!=R.id&&(L.id=R.id),R.ya&&L.setNormals(R.ya),R.tangents&&L.setTangents(R.tangents),R.Aa&&L.setUVs(R.Aa),R.animations){for(let q=0;q<R.animations.length;q++){const B=R.animations[q],N=(0,D.d)("BABYLON.Animation");N&&L.animations.push(N.Parse(B))}R.autoAnimate&&q&&q.beginAnimation(L,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1)}return L}static FromMesh(R,q,L){q||(q=R.name);const B=new H(q,L,R.va());return B.setPositions(R.getVerticesData(o.e.PositionKind)),R.isVerticesDataPresent(o.e.NormalKind)&&B.setNormals(R.getVerticesData(o.e.NormalKind)),R.isVerticesDataPresent(o.e.TangentKind)&&B.setTangents(R.getVerticesData(o.e.TangentKind)),R.isVerticesDataPresent(o.e.UVKind)&&B.setUVs(R.getVerticesData(o.e.UVKind)),B}}(0,f.d)([(0,v.K)()],H.prototype,"id",void 0);var P=L(11065),O=L(11925);class E{set areUpdatesFrozen(R){R?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new P.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,R||(R=n.b.LastCreatedScene),this._scene=R,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const R=this._scene.getEngine().getCaps();this._canUseTextureForTargets=R.canUseGLVertexID&&R.textureFloat&&R.maxVertexTextureImageUnits>0&&R.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(R){this._numMaxInfluencers!==R&&(this._numMaxInfluencers=R,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(R){this._useTextureToStoreTargets=R}get isUsingTextureForTargets(){var R;return E.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(R=this._scene)&&void 0!==R&&R.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(R){return this._activeTargets.data[R]}getTarget(R){return this._targets[R]}getTargetByName(R){for(const q of this._targets)if(q.name===R)return q;return null}addTarget(R){this._targets.push(R),this._targetInfluenceChangedObservers.push(R.onInfluenceChanged.add((R=>{this._syncActiveTargets(R)}))),this._targetDataLayoutChangedObservers.push(R._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(R){const q=this._targets.indexOf(R);q>=0&&(this._targets.splice(q,1),R.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(q,1)[0]),R._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(q,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(R)}_bind(R){R.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),R.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),R.setTexture("morphTargets",this._targetStoreTexture),R.setInt("morphTargetCount",this.numInfluencers)}clone(){const R=new E(this._scene);for(const q of this._targets)R.addTarget(q.clone());return R.enableNormalMorphing=this.enableNormalMorphing,R.enableTangentMorphing=this.enableTangentMorphing,R.enableUVMorphing=this.enableUVMorphing,R}serialize(){const R={};R.id=this.uniqueId,R.targets=[];for(const q of this._targets)R.targets.push(q.serialize());return R}_syncActiveTargets(R){if(this.areUpdatesFrozen)return;let q=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let L=-1;for(const B of this._targets){if(L++,0===B.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=E.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(B),this._morphTargetTextureIndices[q]=L,this._tempInfluences[q++]=B.influence,this._supportsNormals=this._supportsNormals&&B.hasNormals,this._supportsTangents=this._supportsTangents&&B.hasTangents,this._supportsUVs=this._supportsUVs&&B.hasUVs;const R=B.getPositions();if(R){const q=R.length/3;if(0===this._vertexCount)this._vertexCount=q;else if(this._vertexCount!==q)return void r.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,q)),this._influences&&this._influences.length===q||(this._influences=new Float32Array(q));for(let B=0;B<q;B++)this._influences[B]=this._tempInfluences[B];R&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const R=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>R&&(this._textureHeight=Math.ceil(this._textureWidth/R),this._textureWidth=R);let q=!0;if(this._targetStoreTexture){const R=this._targetStoreTexture.getSize();R.width===this._textureWidth&&R.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(q=!1)}if(q){this._targetStoreTexture&&this._targetStoreTexture.dispose();const R=this._targets.length,q=new Float32Array(R*this._textureWidth*this._textureHeight*4);let L=0;for(let B=0;B<R;B++){const R=this._targets[B],N=R.getPositions(),h=R.getNormals(),Z=R.getUVs(),z=R.getTangents();if(!N)return void(0===B&&r.d.Error("Invalid morph target. Target must have positions."));L=B*this._textureWidth*this._textureHeight*4;for(let B=0;B<this._vertexCount;B++)q[L]=N[3*B],q[L+1]=N[3*B+1],q[L+2]=N[3*B+2],L+=4,this._supportsNormals&&h&&(q[L]=h[3*B],q[L+1]=h[3*B+1],q[L+2]=h[3*B+2],L+=4),this._supportsUVs&&Z&&(q[L]=Z[2*B],q[L+1]=Z[2*B+1],L+=4),this._supportsTangents&&z&&(q[L]=z[3*B],q[L+1]=z[3*B+1],q[L+2]=z[3*B+2],L+=4)}this._targetStoreTexture=O.e.CreateRGBATexture(q,this._textureWidth,this._textureHeight,R,this._scene,!1,!1,1,1)}}for(const R of this._scene.meshes)R.morphTargetManager===this&&R._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const R=this._parentContainer.morphTargetManagers.indexOf(this);R>-1&&this._parentContainer.morphTargetManagers.splice(R,1),this._parentContainer=null}for(const R of this._targets)this._scene.stopAnimation(R)}}static Parse(R,q){const L=new E(q);for(const B of R.targets)L.addTarget(H.Parse(B,q));return L}}E.EnableTextureStorage=!0,E.MaxActiveMorphTargetsInVertexAttributeMode=8;var a=L(12075),g=L(10805),Q=L(11228);function i(R,q,L,B){return N.m.Ig(q,L).scaleInPlace(B)}class k{constructor(R,q,L,B){this.type=R,this.name=q,this.getValue=L,this.getStride=B}_buildAnimation(R,q,L){const B=new y.b(R,this.name,q,this.type);return B.setKeys(L),B}}class V extends k{buildAnimations(R,q,L,B,N){N(R._babylonTransformNode,this._buildAnimation(q,L,B))}}const x={translation:[new V(y.b.ANIMATIONTYPE_VECTOR3,"position",i,(()=>3))],rotation:[new V(y.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(R,q,L,B){return N.d.Ig(q,L).scaleInPlace(B)}),(()=>4))],scale:[new V(y.b.ANIMATIONTYPE_VECTOR3,"Ud",i,(()=>3))],weights:[new class extends k{buildAnimations(R,q,L,B,N){if(R._numMorphTargets)for(let h=0;h<R._numMorphTargets;h++){const Z=new y.b(`${q}_${h}`,this.name,L,this.type);if(Z.setKeys(B.map((R=>({frame:R.frame,inTangent:R.inTangent?R.inTangent[h]:void 0,value:R.value[h],outTangent:R.outTangent?R.outTangent[h]:void 0,interpolation:R.interpolation})))),R._primitiveBabylonMeshes)for(const q of R._primitiveBabylonMeshes)if(q.morphTargetManager){const R=q.morphTargetManager.getTarget(h),L=Z.clone();R.animations.push(L),N(R,L)}}}}(y.b.ANIMATIONTYPE_FLOAT,"influence",(function(R,q,L,B){const N=new Array(R._numMorphTargets);for(let h=0;h<N.length;h++)N[h]=q[L++]*B;return N}),(R=>R._numMorphTargets))]},w=new Map,j=w;function J(R,q,L){s(R)&&r.d.Warn(`Extension with the name '${R}' already exists`),w.set(R,{isGLTFExtension:q,factory:L})}function s(R){return w.delete(R)}function A(){const R=R=>R&&"object"===typeof R;for(var q=arguments.length,L=new Array(q),B=0;B<q;B++)L[B]=arguments[B];return L.reduce(((q,L)=>(Object.keys(L).forEach((B=>{const N=q[B],h=L[B];Array.isArray(N)&&Array.isArray(h)?q[B]=N.concat(...h):R(N)&&R(h)?q[B]=A(N,h):q[B]=h})),q)),{})}class M{static Get(R,q,L){if(!q||void 0==L||!q[L])throw new Error(`${R}: Failed to find index (${L})`);return q[L]}static TryGet(R,q){return R&&void 0!=q&&R[q]?R[q]:null}static Assign(R){if(R)for(let q=0;q<R.length;q++)R[q].index=q}}class b{static RegisterExtension(R,q){J(R,!1,q)}static UnregisterExtension(R){return s(R)}get Ji(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(R){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=R}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((R=>R.dispose&&R.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(R,q,L,B,N,h){let Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=q,this._assetContainer=L,this._loadData(B);let h=null;if(R){const q={};if(this._gltf.nodes)for(const R of this._gltf.nodes)R.name&&(q[R.name]=R.index);h=(R instanceof Array?R:[R]).map((R=>{const L=q[R];if(void 0===L)throw new Error(`Failed to find node '${R}'`);return L}))}return this._loadAsync(N,Z,h,(()=>({meshes:this._getMeshes(),lj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=R,this._loadData(q),this._loadAsync(L,N,null,(()=>{})))))}_loadAsync(R,q,L,B){return Promise.resolve().then((async()=>{this._rootUrl=R,this._uniqueRootUrl=!R.startsWith("file:")&&q?R:`${R}${Date.now()}/`,this._fileName=q,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const N=`${a.n[a.n.LOADING]} => ${a.n[a.n.READY]}`,h=`${a.n[a.n.LOADING]} => ${a.n[a.n.COMPLETE]}`;this._parent._startPerformanceCounter(N),this._parent._startPerformanceCounter(h),this._parent._setState(a.n.LOADING),this._extensionsOnLoading();const z=new Array;if(!this.parent.loadOnlyMaterials)if(L)z.push(this.loadSceneAsync("/nodes",{nodes:L,index:-1}));else if(void 0!=this._gltf.Nc||this._gltf.scenes&&this._gltf.scenes[0]){const R=M.Get("/scene",this._gltf.scenes,this._gltf.Nc||0);z.push(this.loadSceneAsync(`/scenes/${R.index}`,R))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let R=0;R<this._gltf.materials.length;++R){const q=this._gltf.materials[R],L="/materials/"+R,B=d.c.TriangleFillMode;z.push(this._loadMaterialAsync(L,q,null,B,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&z.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&z.push(this._compileShadowGeneratorsAsync());return Promise.all(z).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.xb(!0),this._extensionsOnReady(),this._parent._setState(a.n.READY),this._startAnimations(),B()))).then((R=>(this._parent._endPerformanceCounter(N),Z.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(h),this._parent._setState(a.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(R=>{this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()}))})),R)))})).catch((R=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()),R}))}_loadData(R){if(this._gltf=R.json,this._setupData(),R.bin){const q=this._gltf.buffers;if(q&&q[0]&&!q[0].uri){const L=q[0];(L.byteLength<R.bin.byteLength-3||L.byteLength>R.bin.byteLength)&&r.d.Warn(`Binary buffer length (${L.byteLength}) from JSON does not match chunk length (${R.bin.byteLength})`),this._bin=R.bin}else r.d.Warn("Unexpected BIN chunk")}}_setupData(){if(M.Assign(this._gltf.accessors),M.Assign(this._gltf.animations),M.Assign(this._gltf.buffers),M.Assign(this._gltf.bufferViews),M.Assign(this._gltf.cameras),M.Assign(this._gltf.images),M.Assign(this._gltf.materials),M.Assign(this._gltf.meshes),M.Assign(this._gltf.nodes),M.Assign(this._gltf.samplers),M.Assign(this._gltf.scenes),M.Assign(this._gltf.skins),M.Assign(this._gltf.textures),this._gltf.nodes){const R={};for(const L of this._gltf.nodes)if(L.children)for(const q of L.children)R[q]=L.index;const q=this._createRootNode();for(const L of this._gltf.nodes){const B=R[L.index];L.parent=void 0===B?q:this._gltf.nodes[B]}}}async _loadExtensionsAsync(){const R=[];if(j.forEach(((q,L)=>{var B;!1===(null===(B=this.parent.extensionOptions[L])||void 0===B?void 0:B.enabled)?q.isGLTFExtension&&this.isExtensionUsed(L)&&r.d.Warn(`Extension ${L} is used but has been explicitly disabled.`):q.isGLTFExtension&&!this.isExtensionUsed(L)||R.push((async()=>{const R=await q.factory(this);return R.name!==L&&r.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${R.name} !== ${L}`),this._parent.onExtensionLoadedObservable.notifyObservers(R),R})())})),this._extensions.push(...await Promise.all(R)),this._extensions.sort(((R,q)=>(R.order||Number.MAX_VALUE)-(q.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const L of this._gltf.extensionsRequired){if(!this._extensions.some((R=>R.name===L&&R.enabled))){var q;if(!1===(null===(q=this.parent.extensionOptions[L])||void 0===q?void 0:q.enabled))throw new Error(`Required extension ${L} is disabled`);throw new Error(`Required extension ${L} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new W.d("__root__",this._babylonScene);this._rootBabylonMesh=R,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.xb(!1);const q={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case a.k.AUTO:this._babylonScene.useRightHandedSystem||(q.rotation=[0,1,0,0],q.scale=[1,1,-1],b._LoadTransform(q,this._rootBabylonMesh));break;case a.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(R),q}loadSceneAsync(R,q){const L=this._extensionsLoadSceneAsync(R,q);if(L)return L;const B=new Array;if(this.logOpen(`${R} ${q.name||""}`),q.nodes)for(const N of q.nodes){const q=M.Get(`${R}/nodes/${N}`,this._gltf.nodes,N);B.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(R=>{R.parent=this._rootBabylonMesh})))}for(const N of this._postSceneLoadActions)N();return B.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(B).then((()=>{}))}_forEachPrimitive(R,q){if(R._primitiveBabylonMeshes)for(const L of R._primitiveBabylonMeshes)q(L)}_getGeometries(){const R=[],q=this._gltf.nodes;if(q)for(const L of q)this._forEachPrimitive(L,(q=>{const L=q.yj;L&&-1===R.indexOf(L)&&R.push(L)}));return R}_getMeshes(){const R=[];this._rootBabylonMesh instanceof G.c&&R.push(this._rootBabylonMesh);const q=this._gltf.nodes;if(q)for(const L of q)this._forEachPrimitive(L,(q=>{R.push(q)}));return R}_getTransformNodes(){const R=[],q=this._gltf.nodes;if(q)for(const L of q)L._babylonTransformNode&&"qb"===L._babylonTransformNode.getClassName()&&R.push(L._babylonTransformNode),L._babylonTransformNodeForSkin&&R.push(L._babylonTransformNodeForSkin);return R}_getSkeletons(){const R=[],q=this._gltf.skins;if(q)for(const L of q)L._data&&R.push(L._data.babylonSkeleton);return R}_getAnimationGroups(){const R=[],q=this._gltf.animations;if(q)for(const L of q)L._babylonAnimationGroup&&R.push(L._babylonAnimationGroup);return R}_startAnimations(){switch(this._parent.animationStartMode){case a.i.NONE:break;case a.i.FIRST:{const R=this._getAnimationGroups();0!==R.length&&R[0].start(!0);break}case a.i.ALL:{const R=this._getAnimationGroups();for(const q of R)q.start(!0);break}default:return void r.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadNodeAsync(R,q,L);if(B)return B;if(q._babylonTransformNode)throw new Error(`${R}: Invalid recursive node hierarchy`);const N=new Array;this.logOpen(`${R} ${q.name||""}`);const h=B=>{if(b.AddPointerMetadata(B,R),b._LoadTransform(q,B),void 0!=q.camera){const L=M.Get(`${R}/camera`,this._gltf.cameras,q.camera);N.push(this.loadCameraAsync(`/cameras/${L.index}`,L,(R=>{R.parent=B})))}if(q.children)for(const L of q.children){const q=M.Get(`${R}/children/${L}`,this._gltf.nodes,L);N.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(R=>{R.parent=B})))}L(B)},Z=void 0!=q.mesh,z=this._parent.loadSkins&&void 0!=q.skin;if(!Z||z){const R=q.name||`node${q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new m.e(R,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==q.mesh?q._babylonTransformNode=L:q._babylonTransformNodeForSkin=L,h(L)}if(Z)if(z){const L=M.Get(`${R}/mesh`,this._gltf.meshes,q.mesh);N.push(this._loadMeshAsync(`/meshes/${L.index}`,q,L,(L=>{const B=q._babylonTransformNodeForSkin;L.metadata=A(B.metadata,L.metadata||{});const h=M.Get(`${R}/skin`,this._gltf.skins,q.skin);N.push(this._loadSkinAsync(`/skins/${h.index}`,q,h,(R=>{this._forEachPrimitive(q,(q=>{q.skeleton=R})),this._postSceneLoadActions.push((()=>{if(void 0!=h.skeleton){const R=M.Get(`/skins/${h.index}/skeleton`,this._gltf.nodes,h.skeleton).parent;q.index===R.index?L.parent=B.parent:L.parent=R._babylonTransformNode}else L.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:B,skinnedNode:L})}))})))})))}else{const L=M.Get(`${R}/mesh`,this._gltf.meshes,q.mesh);N.push(this._loadMeshAsync(`/meshes/${L.index}`,q,L,h))}return this.logClose(),Promise.all(N).then((()=>(this._forEachPrimitive(q,(R=>{R.yj&&R.yj.useBoundingInfoFromGeometry?R.Ea():R.refreshBoundingInfo(!0,!0)})),q._babylonTransformNode)))}_loadMeshAsync(R,q,L,B){const N=L.primitives;if(!N||!N.length)throw new Error(`${R}: Primitives are missing`);void 0==N[0].index&&M.Assign(N);const h=new Array;this.logOpen(`${R} ${L.name||""}`);const Z=q.name||`node${q.index}`;if(1===N.length){const B=L.primitives[0];h.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${B.index}`,Z,q,L,B,(R=>{q._babylonTransformNode=R,q._primitiveBabylonMeshes=[R]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,q._babylonTransformNode=new m.e(Z,this._babylonScene),q._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._primitiveBabylonMeshes=[];for(const B of N)h.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${B.index}`,`${Z}_primitive${B.index}`,q,L,B,(R=>{R.parent=q._babylonTransformNode,q._primitiveBabylonMeshes.push(R)})))}return B(q._babylonTransformNode),this.logClose(),Promise.all(h).then((()=>q._babylonTransformNode))}_loadMeshPrimitiveAsync(R,q,L,B,N,h){const Z=this._extensionsLoadMeshPrimitiveAsync(R,q,L,B,N,h);if(Z)return Z;this.logOpen(`${R}`);const z=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==L.skin&&!B.primitives[0].targets;let Y,F;if(z&&N._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,Y=N._instanceData.babylonSourceMesh.createInstance(q),Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F=N._instanceData.promise;else{const h=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new W.d(q,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.sideOrientation=this._babylonScene.useRightHandedSystem?d.c.CounterClockWiseSideOrientation:d.c.ClockWiseSideOrientation,this._createMorphTargets(R,L,B,N,Z),h.push(this._loadVertexDataAsync(R,N,Z).then((q=>this._loadMorphTargetsAsync(R,N,Z,q).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,q.Ca(Z),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const C=b._GetDrawMode(R,N.mode);if(void 0==N.material){let R=this._defaultBabylonMaterialData[C];R||(R=this._createDefaultMaterial("__GLTFLoader._default",C),this._parent.onMaterialLoadedObservable.notifyObservers(R),this._defaultBabylonMaterialData[C]=R),Z.material=R}else if(!this.parent.skipMaterials){const q=M.Get(`${R}/material`,this._gltf.materials,N.material);h.push(this._loadMaterialAsync(`/materials/${q.index}`,q,Z,C,(R=>{Z.material=R})))}F=Promise.all(h),z&&(N._instanceData={babylonSourceMesh:Z,promise:F}),Y=Z}return b.AddPointerMetadata(Y,R),this._parent.onMeshLoadedObservable.notifyObservers(Y),h(Y),this.logClose(),F.then((()=>Y))}_loadVertexDataAsync(R,q,L){const B=this._extensionsLoadVertexDataAsync(R,q,L);if(B)return B;const h=q.attributes;if(!h)throw new Error(`${R}: Attributes are missing`);const Z=new Array,z=new l.b(L.name,this._babylonScene);if(void 0==q.indices)L.isUnIndexed=!0;else{const L=M.Get(`${R}/indices`,this._gltf.accessors,q.indices);Z.push(this._loadIndicesAccessorAsync(`/accessors/${L.index}`,L).then((R=>{z.setIndices(R)})))}const Y=(q,B,Y)=>{if(void 0==h[q])return;L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(B)&&L._delayInfo.push(B);const F=M.Get(`${R}/attributes/${q}`,this._gltf.accessors,h[q]);Z.push(this._loadVertexAccessorAsync(`/accessors/${F.index}`,F,B).then((R=>{if(R.getKind()===o.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!L.skeleton&&F.min&&F.max){const R=N.h.o[0].Td(...F.min),q=N.h.o[1].Td(...F.max);if(F.normalized&&5126!==F.componentType){let L=1;switch(F.componentType){case 5120:L=127;break;case 5121:L=255;break;case 5122:L=32767;break;case 5123:L=65535}const B=1/L;R.scaleInPlace(B),q.scaleInPlace(B)}z._boundingInfo=new Q.b(R,q),z.useBoundingInfoFromGeometry=!0}z.setVerticesBuffer(R,F.count)}))),B==o.e.MatricesIndicesExtraKind&&(L.numBoneInfluencers=8),Y&&Y(F)};return Y("POSITION",o.e.PositionKind),Y("NORMAL",o.e.NormalKind),Y("TANGENT",o.e.TangentKind),Y("TEXCOORD_0",o.e.UVKind),Y("TEXCOORD_1",o.e.UV2Kind),Y("TEXCOORD_2",o.e.UV3Kind),Y("TEXCOORD_3",o.e.UV4Kind),Y("TEXCOORD_4",o.e.UV5Kind),Y("TEXCOORD_5",o.e.UV6Kind),Y("JOINTS_0",o.e.MatricesIndicesKind),Y("WEIGHTS_0",o.e.MatricesWeightsKind),Y("JOINTS_1",o.e.MatricesIndicesExtraKind),Y("WEIGHTS_1",o.e.MatricesWeightsExtraKind),Y("COLOR_0",o.e.ColorKind,(R=>{"VEC4"===R.type&&(L.hasVertexAlpha=!0)})),Promise.all(Z).then((()=>z))}_createMorphTargets(R,q,L,B,N){if(!B.targets||!this._parent.loadMorphTargets)return;if(void 0==q._numMorphTargets)q._numMorphTargets=B.targets.length;else if(B.targets.length!==q._numMorphTargets)throw new Error(`${R}: Primitives do not have the same number of targets`);const h=L.extras?L.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,N.morphTargetManager=new E(this._babylonScene),N.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.morphTargetManager.areUpdatesFrozen=!0;for(let Z=0;Z<B.targets.length;Z++){const R=q.weights?q.weights[Z]:L.weights?L.weights[Z]:0,B=h?h[Z]:`morphTarget${Z}`;N.morphTargetManager.addTarget(new H(B,R,N.va()))}}_loadMorphTargetsAsync(R,q,L,B){if(!q.targets||!this._parent.loadMorphTargets)return Promise.resolve();const N=new Array,h=L.morphTargetManager;for(let Z=0;Z<h.numTargets;Z++){const L=h.getTarget(Z);N.push(this._loadMorphTargetVertexDataAsync(`${R}/targets/${Z}`,B,q.targets[Z],L))}return Promise.all(N).then((()=>{h.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(R,q,L,B){const N=new Array,h=(B,h,Z)=>{if(void 0==L[B])return;const z=q.getVertexBuffer(h);if(!z)return;const Y=M.Get(`${R}/${B}`,this._gltf.accessors,L[B]);N.push(this._loadFloatAccessorAsync(`/accessors/${Y.index}`,Y).then((R=>{Z(z,R)})))};return h("POSITION",o.e.PositionKind,((R,q)=>{const L=new Float32Array(q.length);R.forEach(q.length,((R,B)=>{L[B]=q[B]+R})),B.setPositions(L)})),h("NORMAL",o.e.NormalKind,((R,q)=>{const L=new Float32Array(q.length);R.forEach(L.length,((R,B)=>{L[B]=q[B]+R})),B.setNormals(L)})),h("TANGENT",o.e.TangentKind,((R,q)=>{const L=new Float32Array(q.length/3*4);let N=0;R.forEach(q.length/3*4,((R,B)=>{(B+1)%4!==0&&(L[N]=q[N]+R,N++)})),B.setTangents(L)})),Promise.all(N).then((()=>{}))}static _LoadTransform(R,q){if(void 0!=R.skin)return;let L=N.m.Zero(),B=N.d.Identity(),h=N.m.One();if(R.matrix){N.c.Ig(R.matrix).decompose(h,B,L)}else R.translation&&(L=N.m.Ig(R.translation)),R.rotation&&(B=N.d.Ig(R.rotation)),R.scale&&(h=N.m.Ig(R.scale));q.position=L,q.rotationQuaternion=B,q.Ud=h}_loadSkinAsync(R,q,L,B){if(!this._parent.loadSkins)return Promise.resolve();const N=this._extensionsLoadSkinAsync(R,q,L);if(N)return N;if(L._data)return B(L._data.babylonSkeleton),L._data.promise;const h=`skeleton${L.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new c(L.name||h,h,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(R,L,Z);const z=this._loadSkinInverseBindMatricesDataAsync(R,L).then((R=>{this._updateBoneMatrices(Z,R)}));return L._data={babylonSkeleton:Z,promise:z},B(Z),z}_loadBones(R,q,L){if(void 0==q.skeleton||this._parent.alwaysComputeSkeletonRootNode){const L=this._findSkeletonRootNode(`${R}/joints`,q.joints);if(L)if(void 0===q.skeleton)q.skeleton=L.index;else{const B=(R,q)=>{for(;q.parent;q=q.parent)if(q.parent===R)return!0;return!1},N=M.Get(`${R}/skeleton`,this._gltf.nodes,q.skeleton);N===L||B(N,L)||(r.d.Warn(`${R}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),q.skeleton=L.index)}else r.d.Warn(`${R}: Failed to find common root`)}const B={};for(const N of q.joints){const h=M.Get(`${R}/joints/${N}`,this._gltf.nodes,N);this._loadBone(h,q,L,B)}}_findSkeletonRootNode(R,q){if(0===q.length)return null;const L={};for(const N of q){const q=[];let B=M.Get(`${R}/${N}`,this._gltf.nodes,N);for(;-1!==B.index;)q.unshift(B),B=B.parent;L[N]=q}let B=null;for(let N=0;;++N){let R=L[q[0]];if(N>=R.length)return B;const h=R[N];for(let Z=1;Z<q.length;++Z)if(R=L[q[Z]],N>=R.length||h!==R[N])return B;B=h}}_loadBone(R,q,L,B){R._isJoint=!0;let N=B[R.index];if(N)return N;let h=null;R.index!==q.skeleton&&(R.parent&&-1!==R.parent.index?h=this._loadBone(R.parent,q,L,B):void 0!==q.skeleton&&r.d.Warn(`/skins/${q.index}/skeleton: Skeleton node is not a common root`));const Z=q.joints.indexOf(R.index);return N=new F.d(R.name||`joint${R.index}`,L,h,this._getNodeMatrix(R),null,null,Z),B[R.index]=N,this._postSceneLoadActions.push((()=>{N.linkTransformNode(R._babylonTransformNode)})),N}_loadSkinInverseBindMatricesDataAsync(R,q){if(void 0==q.inverseBindMatrices)return Promise.resolve(null);const L=M.Get(`${R}/inverseBindMatrices`,this._gltf.accessors,q.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${L.index}`,L)}_updateBoneMatrices(R,q){for(const L of R.bones){const R=N.c.Identity(),B=L._index;q&&-1!==B&&(N.c.FromArrayToRef(q,16*B,R),R.invertToRef(R));const h=L.getParent();h&&R.multiplyToRef(h.getAbsoluteInverseBindMatrix(),R),L.Cj(R,!1,!1),L._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(R){return R.matrix?N.c.Ig(R.matrix):N.c.Compose(R.scale?N.m.Ig(R.scale):N.m.One(),R.rotation?N.d.Ig(R.rotation):N.d.Identity(),R.translation?N.m.Ig(R.translation):N.m.Zero())}loadCameraAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadCameraAsync(R,q,L);if(B)return B;const h=new Array;this.logOpen(`${R} ${q.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new Y.b(q.name||`camera${q.index}`,N.m.Zero(),this._babylonScene,!1);switch(Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.ignoreParentScaling=!0,q._babylonCamera=Z,Z.rotation.set(0,Math.PI,0),q.type){case"perspective":{const L=q.perspective;if(!L)throw new Error(`${R}: Camera perspective properties are missing`);Z.fov=L.yfov,Z.Ri=L.znear,Z.maxZ=L.zfar||0;break}case"orthographic":if(!q.orthographic)throw new Error(`${R}: Camera orthographic properties are missing`);Z.mode=z.d.ORTHOGRAPHIC_CAMERA,Z.orthoLeft=-q.orthographic.xmag,Z.orthoRight=q.orthographic.xmag,Z.orthoBottom=-q.orthographic.ymag,Z.orthoTop=q.orthographic.ymag,Z.Ri=q.orthographic.znear,Z.maxZ=q.orthographic.zfar;break;default:throw new Error(`${R}: Invalid camera type (${q.type})`)}return b.AddPointerMetadata(Z,R),this._parent.onCameraLoadedObservable.notifyObservers(Z),L(Z),this.logClose(),Promise.all(h).then((()=>Z))}_loadAnimationsAsync(){const R=this._gltf.animations;if(!R)return Promise.resolve();const q=new Array;for(let L=0;L<R.length;L++){const B=R[L];q.push(this.loadAnimationAsync(`/animations/${B.index}`,B).then((R=>{0===R.targetedAnimations.length&&R.dispose()})))}return Promise.all(q).then((()=>{}))}loadAnimationAsync(R,q){const B=this._extensionsLoadAnimationAsync(R,q);return B||L.e(38).then(L.bind(L,13262)).then((L=>{let{AnimationGroup:B}=L;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new B(q.name||`animation${q.index}`,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._babylonAnimationGroup=N;const h=new Array;M.Assign(q.channels),M.Assign(q.samplers);for(const Z of q.channels)h.push(this._loadAnimationChannelAsync(`${R}/channels/${Z.index}`,R,q,Z,((R,q)=>{R.animations=R.animations||[],R.animations.push(q),N.addTargetedAnimation(q,R)})));return Promise.all(h).then((()=>(N.normalize(0),N)))}))}_loadAnimationChannelAsync(R,q,L,B,N){const h=this._extensionsLoadAnimationChannelAsync(R,q,L,B,N);if(h)return h;if(void 0==B.target.node)return Promise.resolve();const Z=M.Get(`${R}/target/node`,this._gltf.nodes,B.target.node),z=B.target.path,Y="weights"===z;if(Y&&!Z._numMorphTargets||!Y&&!Z._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!Y&&!Z._isJoint)return Promise.resolve();let F;switch(z){case"translation":F=x.translation;break;case"rotation":F=x.rotation;break;case"scale":F=x.scale;break;case"weights":F=x.weights;break;default:throw new Error(`${R}/target/path: Invalid value (${B.target.path})`)}const C={object:Z,info:F};return this._loadAnimationChannelFromTargetInfoAsync(R,q,L,B,C,N)}_loadAnimationChannelFromTargetInfoAsync(R,q,L,B,N,h){const Z=this.parent.targetFps,z=1/Z,Y=M.Get(`${R}/sampler`,L.samplers,B.sampler);return this._loadAnimationSamplerAsync(`${q}/samplers/${B.sampler}`,Y).then((R=>{let q=0;const Y=N.object,F=N.info;for(const N of F){const F=N.getStride(Y),C=R.input,e=R.output,y=new Array(C.length);let U=0;switch(R.interpolation){case"STEP":for(let R=0;R<C.length;R++){const q=N.getValue(Y,e,U,1);U+=F,y[R]={frame:C[R]*Z,value:q,interpolation:1}}break;case"CUBICSPLINE":for(let R=0;R<C.length;R++){const q=N.getValue(Y,e,U,z);U+=F;const L=N.getValue(Y,e,U,1);U+=F;const B=N.getValue(Y,e,U,z);U+=F,y[R]={frame:C[R]*Z,inTangent:q,value:L,outTangent:B}}break;case"LINEAR":for(let R=0;R<C.length;R++){const q=N.getValue(Y,e,U,1);U+=F,y[R]={frame:C[R]*Z,value:q}}}if(U>0){const R=`${L.name||`animation${L.index}`}_channel${B.index}_${q}`;N.buildAnimations(Y,R,Z,y,((R,L)=>{++q,h(R,L)}))}}}))}_loadAnimationSamplerAsync(R,q){if(q._data)return q._data;const L=q.interpolation||"LINEAR";switch(L){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${R}/interpolation: Invalid value (${q.interpolation})`)}const B=M.Get(`${R}/input`,this._gltf.accessors,q.input),N=M.Get(`${R}/output`,this._gltf.accessors,q.output);return q._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${B.index}`,B),this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)]).then((R=>{let[q,B]=R;return{input:q,interpolation:L,output:B}})),q._data}loadBufferAsync(R,q,L,B){const N=this._extensionsLoadBufferAsync(R,q,L,B);if(N)return N;if(!q._data)if(q.uri)q._data=this.loadUriAsync(`${R}/uri`,q,q.uri);else{if(!this._bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);q._data=this._bin.readAsync(0,q.byteLength)}return q._data.then((q=>{try{return new Uint8Array(q.buffer,q.byteOffset+L,B)}catch(N){throw new Error(`${R}: ${N.message}`)}}))}loadBufferViewAsync(R,q){const L=this._extensionsLoadBufferViewAsync(R,q);if(L)return L;if(q._data)return q._data;const B=M.Get(`${R}/buffer`,this._gltf.buffers,q.buffer);return q._data=this.loadBufferAsync(`/buffers/${B.index}`,B,q.byteOffset||0,q.byteLength),q._data}_loadAccessorAsync(R,q,L){if(q._data)return q._data;const B=b._GetNumComponents(R,q.type),N=B*o.e.GetTypeByteLength(q.componentType),h=B*q.count;if(void 0==q.bufferView)q._data=Promise.resolve(new L(h));else{const Z=M.Get(`${R}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((z=>{if(5126!==q.componentType||q.normalized||Z.byteStride&&Z.byteStride!==N){const R=new L(h);return o.e.ForEach(z,q.byteOffset||0,Z.byteStride||N,B,q.componentType,R.length,q.normalized||!1,((q,L)=>{R[L]=q})),R}return b._GetTypedArray(R,q.componentType,z,q.byteOffset,h)}))}if(q.sparse){const h=q.sparse;q._data=q._data.then((Z=>{const z=Z,Y=M.Get(`${R}/sparse/indices/bufferView`,this._gltf.bufferViews,h.indices.bufferView),F=M.Get(`${R}/sparse/values/bufferView`,this._gltf.bufferViews,h.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y),this.loadBufferViewAsync(`/bufferViews/${F.index}`,F)]).then((Z=>{let[Y,F]=Z;const C=b._GetTypedArray(`${R}/sparse/indices`,h.indices.componentType,Y,h.indices.byteOffset,h.count),e=B*h.count;let y;if(5126!==q.componentType||q.normalized){const Z=b._GetTypedArray(`${R}/sparse/values`,q.componentType,F,h.values.byteOffset,e);y=new L(e),o.e.ForEach(Z,0,N,B,q.componentType,y.length,q.normalized||!1,((R,q)=>{y[q]=R}))}else y=b._GetTypedArray(`${R}/sparse/values`,q.componentType,F,h.values.byteOffset,e);let U=0;for(let R=0;R<C.length;R++){let q=C[R]*B;for(let R=0;R<B;R++)z[q++]=y[U++]}return z}))}))}return q._data}_loadFloatAccessorAsync(R,q){return this._loadAccessorAsync(R,q,Float32Array)}_loadIndicesAccessorAsync(R,q){if("SCALAR"!==q.type)throw new Error(`${R}/type: Invalid value ${q.type}`);if(5121!==q.componentType&&5123!==q.componentType&&5125!==q.componentType)throw new Error(`${R}/componentType: Invalid value ${q.componentType}`);if(q._data)return q._data;if(q.sparse){const L=b._GetTypedArrayConstructor(`${R}/componentType`,q.componentType);q._data=this._loadAccessorAsync(R,q,L)}else{const L=M.Get(`${R}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((L=>b._GetTypedArray(R,q.componentType,L,q.byteOffset,q.count)))}return q._data}_loadVertexBufferViewAsync(R){if(R._babylonBuffer)return R._babylonBuffer;const q=this._babylonScene.getEngine();return R._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R).then((R=>new o.d(q,R,!1))),R._babylonBuffer}_loadVertexAccessorAsync(R,q,L){var B;if(null!==(B=q._babylonVertexBuffer)&&void 0!==B&&B[L])return q._babylonVertexBuffer[L];q._babylonVertexBuffer||(q._babylonVertexBuffer={});const N=this._babylonScene.getEngine();if(q.sparse||void 0==q.bufferView)q._babylonVertexBuffer[L]=this._loadFloatAccessorAsync(R,q).then((R=>new o.e(N,R,L,!1)));else{const B=M.Get(`${R}/bufferView`,this._gltf.bufferViews,q.bufferView);q._babylonVertexBuffer[L]=this._loadVertexBufferViewAsync(B).then((h=>{const Z=b._GetNumComponents(R,q.type);return new o.e(N,h,L,!1,void 0,B.byteStride,void 0,q.byteOffset,Z,q.componentType,q.normalized,!0,void 0,!0)}))}return q._babylonVertexBuffer[L]}_loadMaterialMetallicRoughnessPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return q&&(q.baseColorFactor?(L.albedoColor=h.e.Ig(q.baseColorFactor),L.alpha=q.baseColorFactor[3]):L.albedoColor=h.e.White(),L.metallic=void 0==q.metallicFactor?1:q.metallicFactor,L.roughness=void 0==q.roughnessFactor?1:q.roughnessFactor,q.baseColorTexture&&B.push(this.loadTextureInfoAsync(`${R}/baseColorTexture`,q.baseColorTexture,(R=>{R.name=`${L.name} (Base Color)`,L.albedoTexture=R}))),q.metallicRoughnessTexture&&(q.metallicRoughnessTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${R}/metallicRoughnessTexture`,q.metallicRoughnessTexture,(R=>{R.name=`${L.name} (Metallic Roughness)`,L.metallicTexture=R}))),L.useMetallnessFromMetallicTextureBlue=!0,L.useRoughnessFromMetallicTextureGreen=!0,L.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(B).then((()=>{}))}_loadMaterialAsync(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const h=this._extensionsLoadMaterialAsync(R,q,L,B,N);if(h)return h;q._data=q._data||{};let Z=q._data[B];if(!Z){this.logOpen(`${R} ${q.name||""}`);const L=this.createMaterial(R,q,B);Z={babylonMaterial:L,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(R,q,L)},q._data[B]=Z,b.AddPointerMetadata(L,R),this._parent.onMaterialLoadedObservable.notifyObservers(L),this.logClose()}return L&&(Z.babylonMeshes.push(L),L.ej.addOnce((()=>{const R=Z.babylonMeshes.indexOf(L);-1!==R&&Z.babylonMeshes.splice(R,1)}))),N(Z.babylonMaterial),Z.promise.then((()=>Z.babylonMaterial))}_createDefaultMaterial(R,q){this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new I(R,this._babylonScene);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.fillMode=q,L.enableSpecularAntiAliasing=!0,L.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,L.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,L.transparencyMode=I.PBRMATERIAL_OPAQUE,L.metallic=1,L.roughness=1,L}createMaterial(R,q,L){const B=this._extensionsCreateMaterial(R,q,L);if(B)return B;const N=q.name||`material${q.index}`;return this._createDefaultMaterial(N,L)}loadMaterialPropertiesAsync(R,q,L){const B=this._extensionsLoadMaterialPropertiesAsync(R,q,L);if(B)return B;const N=new Array;return N.push(this.loadMaterialBasePropertiesAsync(R,q,L)),q.pbrMetallicRoughness&&N.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${R}/pbrMetallicRoughness`,q.pbrMetallicRoughness,L)),this.loadMaterialAlphaProperties(R,q,L),Promise.all(N).then((()=>{}))}loadMaterialBasePropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return L.emissiveColor=q.emissiveFactor?h.e.Ig(q.emissiveFactor):new h.e(0,0,0),q.doubleSided&&(L.Pg=!1,L.twoSidedLighting=!0),q.normalTexture&&(q.normalTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${R}/normalTexture`,q.normalTexture,(R=>{R.name=`${L.name} (Normal)`,L.bumpTexture=R}))),L.invertNormalMapX=!this._babylonScene.useRightHandedSystem,L.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=q.normalTexture.scale&&L.bumpTexture&&(L.bumpTexture.level=q.normalTexture.scale),L.forceIrradianceInFragment=!0),q.occlusionTexture&&(q.occlusionTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${R}/occlusionTexture`,q.occlusionTexture,(R=>{R.name=`${L.name} (Occlusion)`,L.ambientTexture=R}))),L.useAmbientInGrayScale=!0,void 0!=q.occlusionTexture.strength&&(L.ambientTextureStrength=q.occlusionTexture.strength)),q.emissiveTexture&&B.push(this.loadTextureInfoAsync(`${R}/emissiveTexture`,q.emissiveTexture,(R=>{R.name=`${L.name} (Emissive)`,L.emissiveTexture=R}))),Promise.all(B).then((()=>{}))}loadMaterialAlphaProperties(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);switch(q.alphaMode||"OPAQUE"){case"OPAQUE":L.transparencyMode=I.PBRMATERIAL_OPAQUE,L.alpha=1;break;case"MASK":L.transparencyMode=I.PBRMATERIAL_ALPHATEST,L.alphaCutOff=void 0==q.alphaCutoff?.5:q.alphaCutoff,L.albedoTexture&&(L.albedoTexture.je=!0);break;case"BLEND":L.transparencyMode=I.PBRMATERIAL_ALPHABLEND,L.albedoTexture&&(L.albedoTexture.je=!0,L.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${R}/alphaMode: Invalid value (${q.alphaMode})`)}}loadTextureInfoAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureInfoAsync(R,q,L);if(B)return B;if(this.logOpen(`${R}`),q.texCoord>=6)throw new Error(`${R}/texCoord: Invalid value (${q.texCoord})`);const N=M.Get(`${R}/index`,this._gltf.textures,q.index);N._textureInfo=q;const h=this._loadTextureAsync(`/textures/${q.index}`,N,(B=>{B.coordinatesIndex=q.texCoord||0,b.AddPointerMetadata(B,R),this._parent.onTextureLoadedObservable.notifyObservers(B),L(B)}));return this.logClose(),h}_loadTextureAsync(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureAsync(R,q,L);if(B)return B;this.logOpen(`${R} ${q.name||""}`);const N=void 0==q.sampler?b.DefaultSampler:M.Get(`${R}/sampler`,this._gltf.samplers,q.sampler),h=M.Get(`${R}/source`,this._gltf.images,q.source),Z=this._createTextureAsync(R,N,h,L,void 0,!q._textureInfo.nonColorData);return this.logClose(),Z}_createTextureAsync(R,q,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},h=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;const z=this._loadSampler(`/samplers/${q.index}`,q),Y=new Array,F=new B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C={noMipmap:z.noMipMaps,invertY:!1,samplingMode:z.samplingMode,X:()=>{this._disposed||F.resolve()},onError:(q,L)=>{this._disposed||F.reject(new Error(`${R}: ${L&&L.message?L.message:q||"Failed to load texture"}`))},mimeType:L.mimeType,loaderOptions:h,useSRGBBuffer:!!Z&&this._parent.useSRGBBuffers},e=new K.c(null,this._babylonScene,C);return e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.push(F.promise),Y.push(this.loadImageAsync(`/images/${L.index}`,L).then((R=>{const q=L.uri||`${this._fileName}#image${L.index}`,B=`data:${this._uniqueRootUrl}${q}`;e.updateURL(B,R);const N=e.getInternalTexture();N&&(N.label=L.name)}))),e.wrapU=z.wrapU,e.wrapV=z.wrapV,N(e),this._parent.useGltfTextureNames&&(e.name=L.name||L.uri||`image${L.index}`),Promise.all(Y).then((()=>e))}_loadSampler(R,q){return q._data||(q._data={noMipMaps:9728===q.minFilter||9729===q.minFilter,samplingMode:b._GetTextureSamplingMode(R,q),wrapU:b._GetTextureWrapMode(`${R}/wrapS`,q.wrapS),wrapV:b._GetTextureWrapMode(`${R}/wrapT`,q.wrapT)}),q._data}loadImageAsync(R,q){if(!q._data){if(this.logOpen(`${R} ${q.name||""}`),q.uri)q._data=this.loadUriAsync(`${R}/uri`,q,q.uri);else{const L=M.Get(`${R}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L)}this.logClose()}return q._data}loadUriAsync(R,q,L){const B=this._extensionsLoadUriAsync(R,q,L);if(B)return B;if(!b._ValidateUri(L))throw new Error(`${R}: '${L}' is invalid`);if((0,g.m)(L)){const q=new Uint8Array((0,g.e)(L));return this.log(`${R}: Decoded ${L.substring(0,64)}... (${q.length} bytes)`),Promise.resolve(q)}return this.log(`${R}: Loading ${L}`),this._parent.preprocessUrlAsync(this._rootUrl+L).then((q=>new Promise(((B,N)=>{this._parent._loadFile(this._babylonScene,q,(q=>{this._disposed||(this.log(`${R}: Loaded ${L} (${q.byteLength} bytes)`),B(new Uint8Array(q)))}),!0,(q=>{N(new g.p(`${R}: Failed to load '${L}'${q?": "+q.status+" "+q.statusText:""}`,q))}))}))))}static AddPointerMetadata(R,q){R.metadata=R.metadata||{};const L=R._internalMetadata=R._internalMetadata||{},B=L.Ji=L.Ji||{};(B.pointers=B.pointers||[]).push(q)}static _GetTextureWrapMode(R,q){switch(q=void 0==q?10497:q){case 33071:return K.c.CLAMP_ADDRESSMODE;case 33648:return K.c.MIRROR_ADDRESSMODE;case 10497:return K.c.WRAP_ADDRESSMODE;default:return r.d.Warn(`${R}: Invalid value (${q})`),K.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(R,q){const L=void 0==q.magFilter?9729:q.magFilter,B=void 0==q.minFilter?9987:q.minFilter;if(9729===L)switch(B){case 9728:return K.c.LINEAR_NEAREST;case 9729:return K.c.LINEAR_LINEAR;case 9984:return K.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return K.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return K.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return K.c.LINEAR_LINEAR_MIPLINEAR;default:return r.d.Warn(`${R}/minFilter: Invalid value (${B})`),K.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==L&&r.d.Warn(`${R}/magFilter: Invalid value (${L})`),B){case 9728:return K.c.NEAREST_NEAREST;case 9729:return K.c.NEAREST_LINEAR;case 9984:return K.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return K.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return K.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return K.c.NEAREST_LINEAR_MIPLINEAR;default:return r.d.Warn(`${R}/minFilter: Invalid value (${B})`),K.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(R,q){switch(q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${R}: Invalid component type ${q}`)}}static _GetTypedArray(R,q,L,B,N){const h=L.buffer;B=L.byteOffset+(B||0);const Z=b._GetTypedArrayConstructor(`${R}/componentType`,q),z=o.e.GetTypeByteLength(q);return B%z!==0?(r.d.Warn(`${R}: Copying buffer as byte offset (${B}) is not a multiple of component type byte length (${z})`),new Z(h.slice(B,B+N*z),0)):new Z(h,B,N)}static _GetNumComponents(R,q){switch(q){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${R}: Invalid type (${q})`)}static _ValidateUri(R){return Z.f.IsBase64(R)||-1===R.indexOf("..")}static _GetDrawMode(R,q){switch(void 0==q&&(q=4),q){case 0:return d.c.PointListDrawMode;case 1:return d.c.LineListDrawMode;case 2:return d.c.LineLoopDrawMode;case 3:return d.c.LineStripDrawMode;case 4:return d.c.TriangleFillMode;case 5:return d.c.TriangleStripDrawMode;case 6:return d.c.TriangleFanDrawMode}throw new Error(`${R}: Invalid mesh primitive mode (${q})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const R=new Array;if(this._gltf.materials)for(const q of this._gltf.materials)if(q._data)for(const L in q._data){const B=q._data[L];for(const q of B.babylonMeshes){q.Jj(!0);const L=B.babylonMaterial;R.push(L.forceCompilationAsync(q)),R.push(L.forceCompilationAsync(q,{useInstances:!0})),this._parent.useClipPlane&&(R.push(L.forceCompilationAsync(q,{clipPlane:!0})),R.push(L.forceCompilationAsync(q,{clipPlane:!0,useInstances:!0})))}}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const R=new Array,q=this._babylonScene.lights;for(const L of q){const q=L.getShadowGenerator();q&&R.push(q.forceCompilationAsync())}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(R){for(const q of this._extensions)q.enabled&&R(q)}_applyExtensions(R,q,L){for(const B of this._extensions)if(B.enabled){const N=`${B.name}.${q}`,h=R;h._activeLoaderExtensionFunctions=h._activeLoaderExtensionFunctions||{};const Z=h._activeLoaderExtensionFunctions;if(!Z[N]){Z[N]=!0;try{const R=L(B);if(R)return R}finally{delete Z[N]}}}return null}_extensionsOnLoading(){this._forEachExtensions((R=>R.onLoading&&R.onLoading()))}_extensionsOnReady(){this._forEachExtensions((R=>R.onReady&&R.onReady()))}_extensionsLoadSceneAsync(R,q){return this._applyExtensions(q,"loadScene",(L=>L.loadSceneAsync&&L.loadSceneAsync(R,q)))}_extensionsLoadNodeAsync(R,q,L){return this._applyExtensions(q,"loadNode",(B=>B.loadNodeAsync&&B.loadNodeAsync(R,q,L)))}_extensionsLoadCameraAsync(R,q,L){return this._applyExtensions(q,"loadCamera",(B=>B.loadCameraAsync&&B.loadCameraAsync(R,q,L)))}_extensionsLoadVertexDataAsync(R,q,L){return this._applyExtensions(q,"loadVertexData",(B=>B._loadVertexDataAsync&&B._loadVertexDataAsync(R,q,L)))}_extensionsLoadMeshPrimitiveAsync(R,q,L,B,N,h){return this._applyExtensions(N,"loadMeshPrimitive",(Z=>Z._loadMeshPrimitiveAsync&&Z._loadMeshPrimitiveAsync(R,q,L,B,N,h)))}_extensionsLoadMaterialAsync(R,q,L,B,N){return this._applyExtensions(q,"loadMaterial",(h=>h._loadMaterialAsync&&h._loadMaterialAsync(R,q,L,B,N)))}_extensionsCreateMaterial(R,q,L){return this._applyExtensions(q,"createMaterial",(B=>B.createMaterial&&B.createMaterial(R,q,L)))}_extensionsLoadMaterialPropertiesAsync(R,q,L){return this._applyExtensions(q,"loadMaterialProperties",(B=>B.loadMaterialPropertiesAsync&&B.loadMaterialPropertiesAsync(R,q,L)))}_extensionsLoadTextureInfoAsync(R,q,L){return this._applyExtensions(q,"loadTextureInfo",(B=>B.loadTextureInfoAsync&&B.loadTextureInfoAsync(R,q,L)))}_extensionsLoadTextureAsync(R,q,L){return this._applyExtensions(q,"loadTexture",(B=>B._loadTextureAsync&&B._loadTextureAsync(R,q,L)))}_extensionsLoadAnimationAsync(R,q){return this._applyExtensions(q,"loadAnimation",(L=>L.loadAnimationAsync&&L.loadAnimationAsync(R,q)))}_extensionsLoadAnimationChannelAsync(R,q,L,B,N){return this._applyExtensions(L,"loadAnimationChannel",(h=>h._loadAnimationChannelAsync&&h._loadAnimationChannelAsync(R,q,L,B,N)))}_extensionsLoadSkinAsync(R,q,L){return this._applyExtensions(L,"loadSkin",(B=>B._loadSkinAsync&&B._loadSkinAsync(R,q,L)))}_extensionsLoadUriAsync(R,q,L){return this._applyExtensions(q,"loadUri",(B=>B._loadUriAsync&&B._loadUriAsync(R,q,L)))}_extensionsLoadBufferViewAsync(R,q){return this._applyExtensions(q,"loadBufferView",(L=>L.loadBufferViewAsync&&L.loadBufferViewAsync(R,q)))}_extensionsLoadBufferAsync(R,q,L,B){return this._applyExtensions(q,"loadBuffer",(N=>N.loadBufferAsync&&N.loadBufferAsync(R,q,L,B)))}static LoadExtensionAsync(R,q,L,B){if(!q.extensions)return null;const N=q.extensions[L];return N?B(`${R}/extensions/${L}`,N):null}static LoadExtraAsync(R,q,L,B){if(!q.extras)return null;const N=q.extras[L];return N?B(`${R}/extras/${L}`,N):null}isExtensionUsed(R){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(R)}logOpen(R){this._parent._logOpen(R)}logClose(){this._parent._logClose()}log(R){this._parent._log(R)}startPerformanceCounter(R){this._parent._startPerformanceCounter(R)}endPerformanceCounter(R){this._parent._endPerformanceCounter(R)}}b.DefaultSampler={index:-1},a.e._CreateGLTF2Loader=R=>new b(R);var X=L(11562),u=L(12093),RR=L(12102);class qR extends RR.c{constructor(R,q,L){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",R),this._texture=R.getEngine().createRawCubeTexture(q,L,B,N,h,Z,z,Y)}update(R,q,L,B){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,R,q,L,B,N)}updateRGBDAsync(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,u.j)(this._texture,R,q,L,B).then((()=>{}))}clone(){return S.b.Clone((()=>{const R=this.va(),q=this._texture,L=new qR(R,q._bufferViewArray,q.width,q.format,q.type,q.generateMipMaps,q.invertY,q.samplingMode,q._compression);return 13===q.source&&L.updateRGBDAsync(q._bufferViewArrayArray,q._sphericalPolynomial,q._lodGenerationScale,q._lodGenerationOffset),L}),this)}}const LR="EXT_lights_image_based";class BR{constructor(R){this.name=LR,this._loader=R,this.enabled=this._loader.isExtensionUsed(LR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.Ji.extensions;if(R&&R[this.name]){const q=R[this.name];this._lights=q.lights}}loadSceneAsync(R,q){return b.LoadExtensionAsync(R,q,this.name,((L,B)=>{this._loader._allMaterialsDirtyRequired=!0;const N=new Array;N.push(this._loader.loadSceneAsync(R,q)),this._loader.logOpen(`${L}`);const h=M.Get(`${L}/light`,this._lights,B.eb);return N.push(this._loadLightAsync(`/extensions/${this.name}/lights/${B.eb}`,h).then((R=>{this._loader.babylonScene.environmentTexture=R}))),this._loader.logClose(),Promise.all(N).then((()=>{}))}))}_loadLightAsync(R,q){if(!q._loaded){const L=new Array;this._loader.logOpen(`${R}`);const B=new Array(q.specularImages.length);for(let N=0;N<q.specularImages.length;N++){const h=q.specularImages[N];B[N]=new Array(h.length);for(let q=0;q<h.length;q++){const Z=`${R}/specularImages/${N}/${q}`;this._loader.logOpen(`${Z}`);const z=h[q],Y=M.Get(Z,this._loader.Ji.images,z);L.push(this._loader.loadImageAsync(`/images/${z}`,Y).then((R=>{B[N][q]=R}))),this._loader.logClose()}}this._loader.logClose(),q._loaded=Promise.all(L).then((()=>{const L=new qR(this._loader.babylonScene,null,q.specularImageSize);if(L.name=q.name||"environment",q._babylonTexture=L,void 0!=q.Vi&&(L.level=q.Vi),q.rotation){let R=N.d.Ig(q.rotation);this._loader.babylonScene.useRightHandedSystem||(R=N.d.Inverse(R)),N.c.FromQuaternionToRef(R,L.getReflectionTextureMatrix())}if(!q.irradianceCoefficients)throw new Error(`${R}: Irradiance coefficients are missing`);const h=X.b.Ig(q.irradianceCoefficients);h.scaleInPlace(q.Vi),h.convertIrradianceToLambertianRadiance();const Z=X.d.FromHarmonics(h),z=(B.length-1)/Math.log2(q.specularImageSize);return L.updateRGBDAsync(B,Z,z)}))}return q._loaded.then((()=>q._babylonTexture))}}s(LR),J(LR,!0,(R=>new BR(R)));L(12107);const NR="EXT_mesh_gpu_instancing";class hR{constructor(R){this.name=NR,this._loader=R,this.enabled=this._loader.isExtensionUsed(NR)}dispose(){this._loader=null}loadNodeAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((R,B)=>{this._loader._disableInstancedMesh++;const h=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,L);if(this._loader._disableInstancedMesh--,!q._primitiveBabylonMeshes)return h;const Z=new Array;let z=0;const Y=q=>{if(void 0==B.attributes[q])return void Z.push(Promise.resolve(null));const L=M.Get(`${R}/attributes/${q}`,this._loader.Ji.accessors,B.attributes[q]);if(Z.push(this._loader._loadFloatAccessorAsync(`/accessors/${L.bufferView}`,L)),0===z)z=L.count;else if(z!==L.count)throw new Error(`${R}/attributes: Instance buffer accessors do not have the same count.`)};return Y("TRANSLATION"),Y("ROTATION"),Y("SCALE"),h.then((R=>Promise.all(Z).then((L=>{let[B,h,Z]=L;const Y=new Float32Array(16*z);N.h.o[0].Td(0,0,0),N.h.Quaternion[0].Td(0,0,0,1),N.h.o[1].Td(1,1,1);for(let R=0;R<z;++R)B&&N.m.FromArrayToRef(B,3*R,N.h.o[0]),h&&N.d.FromArrayToRef(h,4*R,N.h.Quaternion[0]),Z&&N.m.FromArrayToRef(Z,3*R,N.h.o[1]),N.c.ComposeToRef(N.h.o[1],N.h.Quaternion[0],N.h.o[0],N.h.Matrix[0]),N.h.Matrix[0].copyToArray(Y,16*R);for(const R of q._primitiveBabylonMeshes)R.Cb("matrix",Y,16,!0);return R}))))}))}}s(NR),J(NR,!0,(R=>new hR(R)));class ZR{static get Default(){return ZR._Default||(ZR._Default=new ZR),ZR._Default}constructor(){const R=ZR.Configuration.decoder;this._decoderModulePromise=Z.f.LoadBabylonScriptAsync(R.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(R,q,L,B,N){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const h=await MeshoptDecoder.decodeGltfBufferAsync(q,L,R,B,N);return MeshoptDecoder.useWorkers(0),h}))}}ZR.Configuration={decoder:{url:`${Z.f._DefaultCdnUrl}/meshopt_decoder.js`}},ZR._Default=null;const zR="EXT_meshopt_compression";class YR{constructor(R){this.name=zR,this.enabled=R.isExtensionUsed(zR),this._loader=R}dispose(){this._loader=null}loadBufferViewAsync(R,q){return b.LoadExtensionAsync(R,q,this.name,((L,B)=>{const N=q;if(N._meshOptData)return N._meshOptData;const h=M.Get(`${R}/buffer`,this._loader.Ji.buffers,B.buffer);return N._meshOptData=this._loader.loadBufferAsync(`/buffers/${h.index}`,h,B.byteOffset||0,B.byteLength).then((R=>ZR.Default.decodeGltfBufferAsync(R,B.count,B.byteStride,B.mode,B.filter))),N._meshOptData}))}}s(zR),J(zR,!0,(R=>new YR(R)));const FR="EXT_texture_webp";class CR{constructor(R){this.name=FR,this._loader=R,this.enabled=R.isExtensionUsed(FR)}dispose(){this._loader=null}_loadTextureAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=void 0==q.sampler?b.DefaultSampler:M.Get(`${R}/sampler`,this._loader.Ji.samplers,q.sampler),Z=M.Get(`${B}/source`,this._loader.Ji.images,N.source);return this._loader._createTextureAsync(R,h,Z,(R=>{L(R)}),void 0,!q._textureInfo.nonColorData)}))}}s(FR),J(FR,!0,(R=>new CR(R)));const eR="EXT_texture_avif";class yR{constructor(R){this.name=eR,this._loader=R,this.enabled=R.isExtensionUsed(eR)}dispose(){this._loader=null}_loadTextureAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=void 0==q.sampler?b.DefaultSampler:M.Get(`${R}/sampler`,this._loader.Ji.samplers,q.sampler),Z=M.Get(`${B}/source`,this._loader.Ji.images,N.source);return this._loader._createTextureAsync(R,h,Z,(R=>{L(R)}),void 0,!q._textureInfo.nonColorData)}))}}s(eR),J(eR,!0,(R=>new yR(R)));var UR=L(12113);const nR="KHR_draco_mesh_compression";class rR{constructor(R){this.name=nR,this.useNormalizedFlagFromAccessor=!0,this._loader=R,this.enabled=UR.b.DecoderAvailable&&this._loader.isExtensionUsed(nR)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{if(void 0!=q.mode&&4!==q.mode&&5!==q.mode)throw new Error(`${R}: Unsupported mode ${q.mode}`);const h={},Z={},z=(R,B)=>{const z=N.attributes[R];if(void 0!=z&&(L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(B)&&L._delayInfo.push(B),h[B]=z,this.useNormalizedFlagFromAccessor)){const L=M.TryGet(this._loader.Ji.accessors,q.attributes[R]);L&&(Z[B]=L.normalized||!1)}};z("POSITION",o.e.PositionKind),z("NORMAL",o.e.NormalKind),z("TANGENT",o.e.TangentKind),z("TEXCOORD_0",o.e.UVKind),z("TEXCOORD_1",o.e.UV2Kind),z("TEXCOORD_2",o.e.UV3Kind),z("TEXCOORD_3",o.e.UV4Kind),z("TEXCOORD_4",o.e.UV5Kind),z("TEXCOORD_5",o.e.UV6Kind),z("JOINTS_0",o.e.MatricesIndicesKind),z("WEIGHTS_0",o.e.MatricesWeightsKind),z("COLOR_0",o.e.ColorKind);const Y=M.Get(B,this._loader.Ji.bufferViews,N.bufferView);return Y._dracoBabylonGeometry||(Y._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((q=>(this.dracoCompression||UR.b.Default)._decodeMeshToGeometryForGltfAsync(L.name,this._loader.babylonScene,q,h,Z).catch((q=>{throw new Error(`${R}: ${q.message}`)}))))),Y._dracoBabylonGeometry}))}}s(nR),J(nR,!0,(R=>new rR(R)));var pR=L(12120),cR=L(11345),dR=L(12085),fR=L(12122);cR.d.AddNodeConstructor("Light_Type_0",((R,q)=>()=>new vR(R,N.m.Zero(),q)));class vR extends fR.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(R){this._shadowAngle=R,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(R){const q=this.needCube();if(this._direction=R,this.needCube()!==q&&this._shadowGenerators){const R=this._shadowGenerators.values();for(let q=R.next();!0!==q.done;q=R.next()){q.value.recreateShadowMap()}}}constructor(R,q,L){super(R,L),this._shadowAngle=Math.PI/2,this.position=q}getClassName(){return"PointLight"}getTypeID(){return dR.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(R){if(this.direction)return super.getShadowDirection(R);switch(R){case 0:return new N.m(1,0,0);case 1:return new N.m(-1,0,0);case 2:return new N.m(0,-1,0);case 3:return new N.m(0,1,0);case 4:return new N.m(0,0,1);case 5:return new N.m(0,0,-1)}return N.m.Zero()}_setDefaultShadowProjectionMatrix(R,q,L){const B=this.va().activeCamera;if(!B)return;const h=void 0!==this.shadowMinZ?this.shadowMinZ:B.Ri,Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,z=this.va().getEngine().useReverseDepthBuffer;N.c.PerspectiveFovLHToRef(this.shadowAngle,1,z?Z:h,z?h:Z,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,z)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,q){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,q):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,q),this}transferToNodeMaterialEffect(R,q){return this.computeTransformedInformation()?R.setFloat3(q,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):R.setFloat3(q,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(R,q){R["POINTLIGHT"+q]=!0}}(0,f.d)([(0,v.K)()],vR.prototype,"shadowAngle",null),(0,D.f)("BABYLON.PointLight",vR),cR.d.AddNodeConstructor("Light_Type_2",((R,q)=>()=>new TR(R,N.m.Zero(),N.m.Zero(),0,0,q)));class TR extends fR.d{get angle(){return this._angle}set angle(R){this._angle=R,this._cosHalfAngle=Math.cos(.5*R),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(R){this._innerAngle=R,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(R){this._shadowAngleScale=R,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(R){this._projectionTextureLightNear=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(R){this._projectionTextureLightFar=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(R){this._projectionTextureUpDirection=R,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(R){this._projectionTexture!==R&&(this._projectionTexture=R,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(TR._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):TR._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(R){return void 0!==R.onGeneratedObservable}static _IsTexture(R){return void 0!==R.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(R){this._projectionTextureProjectionLightMatrix=R,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(R,q,L,B,h,Z){super(R,Z),this._innerAngle=0,this._projectionTextureMatrix=N.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=N.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=N.m.Zero(),this._projectionTextureViewLightMatrix=N.c.Zero(),this._projectionTextureProjectionLightMatrix=N.c.Zero(),this._projectionTextureScalingMatrix=N.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=q,this.direction=L,this.angle=B,this.exponent=h}getClassName(){return"SpotLight"}getTypeID(){return dR.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(R){super._setDirection(R),this._projectionTextureViewLightDirty=!0}_setPosition(R){super._setPosition(R),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(R,q,L){const B=this.va().activeCamera;if(!B)return;this._shadowAngleScale=this._shadowAngleScale||1;const h=this._shadowAngleScale*this._angle,Z=void 0!==this.shadowMinZ?this.shadowMinZ:B.Ri,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,Y=this.va().getEngine().useReverseDepthBuffer;N.c.PerspectiveFovLHToRef(h,1,Y?z:Z,Y?Z:z,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Y)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),N.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const R=this.projectionTextureLightFar,q=this.projectionTextureLightNear,L=R/(R-q),B=-L*q,h=1/Math.tan(this._angle/2);N.c.FromValuesToRef(h/1,0,0,0,0,h,0,0,0,0,L,1,0,0,B,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof K.c){const R=this._projectionTexture.uScale/2,q=this._projectionTexture.vScale/2;N.c.FromValuesToRef(R,0,0,0,0,q,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(R,q){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),R.setMatrix("textureProjectionMatrix"+q,this._projectionTextureMatrix),R.setTexture("projectionLightTexture"+q,this.projectionTexture)),this}transferToEffect(R,q){let L;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,q),L=N.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,q),L=N.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",L.x,L.y,L.z,this._cosHalfAngle,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,q),this}transferToNodeMaterialEffect(R,q){let L;return L=this.computeTransformedInformation()?N.m.Normalize(this.transformedDirection):N.m.Normalize(this.direction),this.va().useRightHandedSystem?R.setFloat3(q,-L.x,-L.y,-L.z):R.setFloat3(q,L.x,L.y,L.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(R){const q=this._scene.getEngine(),L=void 0!==this.shadowMinZ?this.shadowMinZ:R.Ri;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?L:this._scene.getEngine().isNDCHalfZRange?0:L}getDepthMaxZ(R){const q=this._scene.getEngine(),L=void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:L}prepareLightSpecificDefines(R,q){R["SPOTLIGHT"+q]=!0,R["PROJECTEDLIGHTTEXTURE"+q]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,f.d)([(0,v.K)()],TR.prototype,"angle",null),(0,f.d)([(0,v.K)()],TR.prototype,"innerAngle",null),(0,f.d)([(0,v.K)()],TR.prototype,"shadowAngleScale",null),(0,f.d)([(0,v.K)()],TR.prototype,"exponent",void 0),(0,f.d)([(0,v.K)()],TR.prototype,"projectionTextureLightNear",null),(0,f.d)([(0,v.K)()],TR.prototype,"projectionTextureLightFar",null),(0,f.d)([(0,v.K)()],TR.prototype,"projectionTextureUpDirection",null),(0,f.d)([(0,v.A)("projectedLightTexture")],TR.prototype,"_projectionTexture",void 0),(0,D.f)("BABYLON.SpotLight",TR);const tR="KHR_lights_punctual";class DR{constructor(R){this.name=tR,this._loader=R,this.enabled=this._loader.isExtensionUsed(tR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.Ji.extensions;if(R&&R[this.name]){const q=R[this.name];this._lights=q.lights,M.Assign(this._lights)}}loadNodeAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,Z)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(R,q,(R=>{let q;const z=M.Get(B,this._lights,Z.eb),Y=z.name||R.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z.type){case"directional":{const R=new pR.c(Y,N.m.Backward(),this._loader.babylonScene);R.position.Rd(0),q=R;break}case"point":q=new vR(Y,N.m.Zero(),this._loader.babylonScene);break;case"spot":{const R=new TR(Y,N.m.Zero(),N.m.Backward(),0,1,this._loader.babylonScene);R.angle=2*(z.spot&&z.spot.outerConeAngle||Math.PI/4),R.innerAngle=2*(z.spot&&z.spot.innerConeAngle||0),q=R;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${B}: Invalid light type (${z.type})`)}q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,z._babylonLight=q,q.falloffType=dR.e.FALLOFF_GLTF,q.hh=z.color?h.e.Ig(z.color):h.e.White(),q.Vi=void 0==z.Vi?1:z.Vi,q.range=void 0==z.range?Number.MAX_VALUE:z.range,q.parent=R,this._loader._babylonLights.push(q),b.AddPointerMetadata(q,B),L(R)})))))}}s(tR),J(tR,!0,(R=>new DR(R)));const SR="KHR_materials_pbrSpecularGlossiness";class IR{constructor(R){this.name=SR,this.order=200,this._loader=R,this.enabled=this._loader.isExtensionUsed(SR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialBasePropertiesAsync(R,q,L)),h.push(this._loadSpecularGlossinessPropertiesAsync(B,N,L)),this._loader.loadMaterialAlphaProperties(R,q,L),Promise.all(h).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return L.metallic=null,L.roughness=null,q.diffuseFactor?(L.albedoColor=h.e.Ig(q.diffuseFactor),L.alpha=q.diffuseFactor[3]):L.albedoColor=h.e.White(),L.reflectivityColor=q.specularFactor?h.e.Ig(q.specularFactor):h.e.White(),L.microSurface=void 0==q.glossinessFactor?1:q.glossinessFactor,q.diffuseTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTexture`,q.diffuseTexture,(R=>{R.name=`${L.name} (Diffuse)`,L.albedoTexture=R}))),q.specularGlossinessTexture&&(B.push(this._loader.loadTextureInfoAsync(`${R}/specularGlossinessTexture`,q.specularGlossinessTexture,(R=>{R.name=`${L.name} (Specular Glossiness)`,L.reflectivityTexture=R,L.reflectivityTexture.je=!0}))),L.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(B).then((()=>{}))}}s(SR),J(SR,!0,(R=>new IR(R)));const KR="KHR_materials_unlit";class mR{constructor(R){this.name=KR,this.order=210,this._loader=R,this.enabled=this._loader.isExtensionUsed(KR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,(()=>this._loadUnlitPropertiesAsync(R,q,L)))}_loadUnlitPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;L.unlit=!0;const N=q.pbrMetallicRoughness;return N&&(N.baseColorFactor?(L.albedoColor=h.e.Ig(N.baseColorFactor),L.alpha=N.baseColorFactor[3]):L.albedoColor=h.e.White(),N.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/baseColorTexture`,N.baseColorTexture,(R=>{R.name=`${L.name} (Base Color)`,L.albedoTexture=R})))),q.doubleSided&&(L.Pg=!1,L.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(R,q,L),Promise.all(B).then((()=>{}))}}s(KR),J(KR,!0,(R=>new mR(R)));const oR="KHR_materials_clearcoat";class lR{constructor(R){this.name=oR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(oR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadClearCoatPropertiesAsync(B,N,L)),Promise.all(h).then((()=>{}))}))}_loadClearCoatPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return L.clearCoat.isEnabled=!0,L.clearCoat.useRoughnessFromMainTexture=!1,L.clearCoat.remapF0OnInterfaceChange=!1,void 0!=q.clearcoatFactor?L.clearCoat.Vi=q.clearcoatFactor:L.clearCoat.Vi=0,q.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatTexture`,q.clearcoatTexture,(R=>{R.name=`${L.name} (ClearCoat)`,L.clearCoat.texture=R}))),void 0!=q.clearcoatRoughnessFactor?L.clearCoat.roughness=q.clearcoatRoughnessFactor:L.clearCoat.roughness=0,q.clearcoatRoughnessTexture&&(q.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatRoughnessTexture`,q.clearcoatRoughnessTexture,(R=>{R.name=`${L.name} (ClearCoat Roughness)`,L.clearCoat.textureRoughness=R})))),q.clearcoatNormalTexture&&(q.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatNormalTexture`,q.clearcoatNormalTexture,(R=>{R.name=`${L.name} (ClearCoat Normal)`,L.clearCoat.bumpTexture=R}))),L.invertNormalMapX=!L.va().useRightHandedSystem,L.invertNormalMapY=L.va().useRightHandedSystem,void 0!=q.clearcoatNormalTexture.scale&&(L.clearCoat.bumpTexture.level=q.clearcoatNormalTexture.scale)),Promise.all(B).then((()=>{}))}}s(oR),J(oR,!0,(R=>new lR(R)));const GR="KHR_materials_iridescence";class WR{constructor(R){this.name=GR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(GR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadIridescencePropertiesAsync(B,N,L)),Promise.all(h).then((()=>{}))}))}_loadIridescencePropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return L.iridescence.isEnabled=!0,L.iridescence.Vi=q.iridescenceFactor??0,L.iridescence.indexOfRefraction=q.iridescenceIor??q.iridescenceIOR??1.3,L.iridescence.minimumThickness=q.iridescenceThicknessMinimum??100,L.iridescence.maximumThickness=q.iridescenceThicknessMaximum??400,q.iridescenceTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceTexture`,q.iridescenceTexture,(R=>{R.name=`${L.name} (Iridescence)`,L.iridescence.texture=R}))),q.iridescenceThicknessTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceThicknessTexture`,q.iridescenceThicknessTexture,(R=>{R.name=`${L.name} (Iridescence Thickness)`,L.iridescence.thicknessTexture=R}))),Promise.all(B).then((()=>{}))}}s(GR),J(GR,!0,(R=>new WR(R)));const HR="KHR_materials_anisotropy";class PR{constructor(R){this.name=HR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(HR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadIridescencePropertiesAsync(B,N,L)),Promise.all(h).then((()=>{}))}))}_loadIridescencePropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return L.anisotropy.isEnabled=!0,L.anisotropy.Vi=q.anisotropyStrength??0,L.anisotropy.angle=q.anisotropyRotation??0,q.anisotropyTexture&&(q.anisotropyTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${R}/anisotropyTexture`,q.anisotropyTexture,(R=>{R.name=`${L.name} (Anisotropy Intensity)`,L.anisotropy.texture=R})))),Promise.all(B).then((()=>{}))}}s(HR),J(HR,!0,(R=>new PR(R)));const OR="KHR_materials_emissive_strength";class ER{constructor(R){this.name=OR,this.order=170,this._loader=R,this.enabled=this._loader.isExtensionUsed(OR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>this._loader.loadMaterialPropertiesAsync(R,q,L).then((()=>{this._loadEmissiveProperties(B,N,L)}))))}_loadEmissiveProperties(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);void 0!==q.emissiveStrength&&(L.emissiveIntensity=q.emissiveStrength)}}s(OR),J(OR,!0,(R=>new ER(R)));const aR="KHR_materials_sheen";class gR{constructor(R){this.name=aR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(aR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadSheenPropertiesAsync(B,N,L)),Promise.all(h).then((()=>{}))}))}_loadSheenPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return L.sheen.isEnabled=!0,L.sheen.Vi=1,void 0!=q.sheenColorFactor?L.sheen.color=h.e.Ig(q.sheenColorFactor):L.sheen.color=h.e.Black(),q.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/sheenColorTexture`,q.sheenColorTexture,(R=>{R.name=`${L.name} (Sheen Color)`,L.sheen.texture=R}))),void 0!==q.sheenRoughnessFactor?L.sheen.roughness=q.sheenRoughnessFactor:L.sheen.roughness=0,q.sheenRoughnessTexture&&(q.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${R}/sheenRoughnessTexture`,q.sheenRoughnessTexture,(R=>{R.name=`${L.name} (Sheen Roughness)`,L.sheen.textureRoughness=R})))),L.sheen.albedoScaling=!0,L.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then((()=>{}))}}s(aR),J(aR,!0,(R=>new gR(R)));const QR="KHR_materials_specular";class iR{constructor(R){this.name=QR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(QR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadSpecularPropertiesAsync(B,N,L)),Promise.all(h).then((()=>{}))}))}_loadSpecularPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const B=new Array;return void 0!==q.specularFactor&&(L.metallicF0Factor=q.specularFactor),void 0!==q.specularColorFactor&&(L.metallicReflectanceColor=h.e.Ig(q.specularColorFactor)),q.specularTexture&&(q.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${R}/specularTexture`,q.specularTexture,(R=>{R.name=`${L.name} (Specular)`,L.metallicReflectanceTexture=R,L.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),q.specularColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${R}/specularColorTexture`,q.specularColorTexture,(R=>{R.name=`${L.name} (Specular Color)`,L.reflectanceTexture=R}))),Promise.all(B).then((()=>{}))}}s(QR),J(QR,!0,(R=>new iR(R)));const kR="KHR_materials_ior";class VR{constructor(R){this.name=kR,this.order=180,this._loader=R,this.enabled=this._loader.isExtensionUsed(kR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadIorPropertiesAsync(B,N,L)),Promise.all(h).then((()=>{}))}))}_loadIorPropertiesAsync(R,q,L){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);return void 0!==q.ior?L.indexOfRefraction=q.ior:L.indexOfRefraction=VR._DEFAULT_IOR,Promise.resolve()}}VR._DEFAULT_IOR=1.5,s(kR),J(kR,!0,(R=>new VR(R)));const xR="KHR_materials_variants";class wR{constructor(R){this.name=xR,this._loader=R,this.enabled=this._loader.isExtensionUsed(xR)}dispose(){this._loader=null}static GetAvailableVariants(R){const q=this._GetExtensionMetadata(R);return q?Object.keys(q.variants):[]}getAvailableVariants(R){return wR.GetAvailableVariants(R)}static SelectVariant(R,q){const L=this._GetExtensionMetadata(R);if(!L)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${xR} extension`);const B=R=>{const q=L.variants[R];if(q)for(const L of q)L.mesh.material=L.material};if(q instanceof Array)for(const N of q)B(N);else B(q);L.lastSelected=q}selectVariant(R,q){wR.SelectVariant(R,q)}static Reset(R){const q=this._GetExtensionMetadata(R);if(!q)throw new Error(`Cannot reset on a glTF mesh that does not have the ${xR} extension`);for(const L of q.original)L.mesh.material=L.material;q.lastSelected=null}reset(R){wR.Reset(R)}static GetLastSelectedVariant(R){const q=this._GetExtensionMetadata(R);if(!q)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${xR} extension`);return q.lastSelected}getLastSelectedVariant(R){return wR.GetLastSelectedVariant(R)}static _GetExtensionMetadata(R){var q,L;return(null===R||void 0===R||null===(q=R._internalMetadata)||void 0===q||null===(L=q.Ji)||void 0===L?void 0:L[xR])||null}onLoading(){const R=this._loader.Ji.extensions;if(R&&R[this.name]){const q=R[this.name];this._variants=q.variants}}_loadMeshPrimitiveAsync(R,q,L,B,N,h){return b.LoadExtensionAsync(R,N,this.name,((Z,z)=>{const Y=new Array;return Y.push(this._loader._loadMeshPrimitiveAsync(R,q,L,B,N,(q=>{if(h(q),q instanceof W.d){const L=b._GetDrawMode(R,N.mode),B=this._loader.rootBabylonMesh,h=B?B._internalMetadata=B._internalMetadata||{}:{},F=h.Ji=h.Ji||{},C=F[xR]=F[xR]||{lastSelected:null,original:[],variants:{}};C.original.push({mesh:q,material:q.material});for(let R=0;R<z.mappings.length;++R){const N=z.mappings[R],h=M.Get(`${Z}/mappings/${R}/material`,this._loader.Ji.materials,N.material);Y.push(this._loader._loadMaterialAsync(`#/materials/${N.material}`,h,q,L,(R=>{for(let L=0;L<N.variants.length;++L){const h=N.variants[L],Z=M.Get(`/extensions/${xR}/variants/${h}`,this._variants,h);C.variants[Z.name]=C.variants[Z.name]||[],C.variants[Z.name].push({mesh:q,material:R}),q.onClonedObservable.add((R=>{const L=R;let N=null,h=L;do{if(h=h.parent,!h)return;N=wR._GetExtensionMetadata(h)}while(null===N);if(B&&N===wR._GetExtensionMetadata(B)){h._internalMetadata={};for(const R in B._internalMetadata)h._internalMetadata[R]=B._internalMetadata[R];h._internalMetadata.Ji=[];for(const R in B._internalMetadata.Ji)h._internalMetadata.Ji[R]=B._internalMetadata.Ji[R];h._internalMetadata.Ji[xR]={lastSelected:null,original:[],variants:{}};for(const R of N.original)h._internalMetadata.Ji[xR].original.push({mesh:R.mesh,material:R.material});for(const R in N.variants)if(Object.prototype.hasOwnProperty.call(N.variants,R)){h._internalMetadata.Ji[xR].variants[R]=[];for(const q of N.variants[R])h._internalMetadata.Ji[xR].variants[R].push({mesh:q.mesh,material:q.material})}N=h._internalMetadata.Ji[xR]}for(const B of N.original)B.mesh===q&&(B.mesh=L);for(const B of N.variants[Z.name])B.mesh===q&&(B.mesh=L)}))}})))}}}))),Promise.all(Y).then((R=>{let[q]=R;return q}))}))}}s(xR),J(xR,!0,(R=>new wR(R)));var jR=L(11612);class JR{}JR.AUTOSAMPLERSUFFIX="Sampler",JR.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",JR.ALPHA_DISABLE=0,JR.ALPHA_ADD=1,JR.ALPHA_COMBINE=2,JR.ALPHA_SUBTRACT=3,JR.ALPHA_MULTIPLY=4,JR.ALPHA_MAXIMIZED=5,JR.ALPHA_ONEONE=6,JR.ALPHA_PREMULTIPLIED=7,JR.ALPHA_PREMULTIPLIED_PORTERDUFF=8,JR.ALPHA_INTERPOLATE=9,JR.ALPHA_SCREENMODE=10,JR.ALPHA_ONEONE_ONEONE=11,JR.ALPHA_ALPHATOCOLOR=12,JR.ALPHA_REVERSEONEMINUS=13,JR.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,JR.ALPHA_ONEONE_ONEZERO=15,JR.ALPHA_EXCLUSION=16,JR.ALPHA_LAYER_ACCUMULATE=17,JR.ALPHA_EQUATION_ADD=0,JR.ALPHA_EQUATION_SUBSTRACT=1,JR.ALPHA_EQUATION_REVERSE_SUBTRACT=2,JR.ALPHA_EQUATION_MAX=3,JR.ALPHA_EQUATION_MIN=4,JR.ALPHA_EQUATION_DARKEN=5,JR.DELAYLOADSTATE_NONE=0,JR.DELAYLOADSTATE_LOADED=1,JR.DELAYLOADSTATE_LOADING=2,JR.DELAYLOADSTATE_NOTLOADED=4,JR.NEVER=512,JR.ALWAYS=519,JR.LESS=513,JR.EQUAL=514,JR.LEQUAL=515,JR.GREATER=516,JR.GEQUAL=518,JR.NOTEQUAL=517,JR.KEEP=7680,JR.ZERO=0,JR.REPLACE=7681,JR.INCR=7682,JR.DECR=7683,JR.INVERT=5386,JR.INCR_WRAP=34055,JR.DECR_WRAP=34056,JR.TEXTURE_CLAMP_ADDRESSMODE=0,JR.TEXTURE_WRAP_ADDRESSMODE=1,JR.TEXTURE_MIRROR_ADDRESSMODE=2,JR.TEXTURE_CREATIONFLAG_STORAGE=1,JR.TEXTUREFORMAT_ALPHA=0,JR.TEXTUREFORMAT_LUMINANCE=1,JR.TEXTUREFORMAT_LUMINANCE_ALPHA=2,JR.TEXTUREFORMAT_RGB=4,JR.TEXTUREFORMAT_RGBA=5,JR.TEXTUREFORMAT_RED=6,JR.TEXTUREFORMAT_R=6,JR.TEXTUREFORMAT_RG=7,JR.TEXTUREFORMAT_RED_INTEGER=8,JR.TEXTUREFORMAT_R_INTEGER=8,JR.TEXTUREFORMAT_RG_INTEGER=9,JR.TEXTUREFORMAT_RGB_INTEGER=10,JR.TEXTUREFORMAT_RGBA_INTEGER=11,JR.TEXTUREFORMAT_BGRA=12,JR.TEXTUREFORMAT_DEPTH24_STENCIL8=13,JR.TEXTUREFORMAT_DEPTH32_FLOAT=14,JR.TEXTUREFORMAT_DEPTH16=15,JR.TEXTUREFORMAT_DEPTH24=16,JR.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,JR.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,JR.TEXTUREFORMAT_STENCIL8=19,JR.TEXTUREFORMAT_UNDEFINED=4294967295,JR.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,JR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,JR.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,JR.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,JR.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,JR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,JR.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,JR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,JR.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,JR.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,JR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,JR.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,JR.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,JR.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,JR.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,JR.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,JR.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,JR.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,JR.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,JR.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,JR.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,JR.TEXTURETYPE_UNSIGNED_BYTE=0,JR.TEXTURETYPE_UNSIGNED_INT=0,JR.TEXTURETYPE_FLOAT=1,JR.TEXTURETYPE_HALF_FLOAT=2,JR.TEXTURETYPE_BYTE=3,JR.TEXTURETYPE_SHORT=4,JR.TEXTURETYPE_UNSIGNED_SHORT=5,JR.TEXTURETYPE_INT=6,JR.TEXTURETYPE_UNSIGNED_INTEGER=7,JR.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,JR.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,JR.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,JR.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,JR.TEXTURETYPE_UNSIGNED_INT_24_8=12,JR.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,JR.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,JR.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,JR.TEXTURETYPE_UNDEFINED=16,JR.TEXTURE_2D=3553,JR.TEXTURE_2D_ARRAY=35866,JR.TEXTURE_CUBE_MAP=34067,JR.TEXTURE_CUBE_MAP_ARRAY=3735928559,JR.TEXTURE_3D=32879,JR.TEXTURE_NEAREST_SAMPLINGMODE=1,JR.TEXTURE_NEAREST_NEAREST=1,JR.TEXTURE_BILINEAR_SAMPLINGMODE=2,JR.TEXTURE_LINEAR_LINEAR=2,JR.TEXTURE_TRILINEAR_SAMPLINGMODE=3,JR.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,JR.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,JR.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,JR.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,JR.TEXTURE_NEAREST_LINEAR=7,JR.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,JR.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,JR.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,JR.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,JR.TEXTURE_LINEAR_NEAREST=12,JR.TEXTURE_EXPLICIT_MODE=0,JR.TEXTURE_SPHERICAL_MODE=1,JR.TEXTURE_PLANAR_MODE=2,JR.TEXTURE_CUBIC_MODE=3,JR.TEXTURE_PROJECTION_MODE=4,JR.TEXTURE_SKYBOX_MODE=5,JR.TEXTURE_INVCUBIC_MODE=6,JR.TEXTURE_EQUIRECTANGULAR_MODE=7,JR.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,JR.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,JR.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,JR.TEXTURE_FILTERING_QUALITY_HIGH=64,JR.TEXTURE_FILTERING_QUALITY_MEDIUM=16,JR.TEXTURE_FILTERING_QUALITY_LOW=8,JR.SCALEMODE_FLOOR=1,JR.SCALEMODE_NEAREST=2,JR.SCALEMODE_CEILING=3,JR.MATERIAL_TextureDirtyFlag=1,JR.MATERIAL_LightDirtyFlag=2,JR.MATERIAL_FresnelDirtyFlag=4,JR.MATERIAL_AttributesDirtyFlag=8,JR.MATERIAL_MiscDirtyFlag=16,JR.MATERIAL_PrePassDirtyFlag=32,JR.MATERIAL_AllDirtyFlag=63,JR.MATERIAL_TriangleFillMode=0,JR.MATERIAL_WireFrameFillMode=1,JR.MATERIAL_PointFillMode=2,JR.MATERIAL_PointListDrawMode=3,JR.MATERIAL_LineListDrawMode=4,JR.MATERIAL_LineLoopDrawMode=5,JR.MATERIAL_LineStripDrawMode=6,JR.MATERIAL_TriangleStripDrawMode=7,JR.MATERIAL_TriangleFanDrawMode=8,JR.MATERIAL_ClockWiseSideOrientation=0,JR.MATERIAL_CounterClockWiseSideOrientation=1,JR.ACTION_NothingTrigger=0,JR.ACTION_OnPickTrigger=1,JR.ACTION_OnLeftPickTrigger=2,JR.ACTION_OnRightPickTrigger=3,JR.ACTION_OnCenterPickTrigger=4,JR.ACTION_OnPickDownTrigger=5,JR.ACTION_OnDoublePickTrigger=6,JR.ACTION_OnPickUpTrigger=7,JR.ACTION_OnPickOutTrigger=16,JR.ACTION_OnLongPressTrigger=8,JR.ACTION_OnPointerOverTrigger=9,JR.ACTION_OnPointerOutTrigger=10,JR.ACTION_OnEveryFrameTrigger=11,JR.ACTION_OnIntersectionEnterTrigger=12,JR.ACTION_OnIntersectionExitTrigger=13,JR.ACTION_OnKeyDownTrigger=14,JR.ACTION_OnKeyUpTrigger=15,JR.PARTICLES_BILLBOARDMODE_Y=2,JR.PARTICLES_BILLBOARDMODE_ALL=7,JR.PARTICLES_BILLBOARDMODE_STRETCHED=8,JR.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,JR.MESHES_CULLINGSTRATEGY_STANDARD=0,JR.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,JR.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,JR.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,JR.SCENELOADER_NO_LOGGING=0,JR.SCENELOADER_MINIMAL_LOGGING=1,JR.SCENELOADER_SUMMARY_LOGGING=2,JR.SCENELOADER_DETAILED_LOGGING=3,JR.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,JR.PREPASS_POSITION_TEXTURE_TYPE=1,JR.PREPASS_VELOCITY_TEXTURE_TYPE=2,JR.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,JR.PREPASS_COLOR_TEXTURE_TYPE=4,JR.PREPASS_DEPTH_TEXTURE_TYPE=5,JR.PREPASS_NORMAL_TEXTURE_TYPE=6,JR.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,JR.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,JR.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,JR.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,JR.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,JR.PREPASS_ALBEDO_TEXTURE_TYPE=12,JR.BUFFER_CREATIONFLAG_READ=1,JR.BUFFER_CREATIONFLAG_WRITE=2,JR.BUFFER_CREATIONFLAG_READWRITE=3,JR.BUFFER_CREATIONFLAG_UNIFORM=4,JR.BUFFER_CREATIONFLAG_VERTEX=8,JR.BUFFER_CREATIONFLAG_INDEX=16,JR.BUFFER_CREATIONFLAG_STORAGE=32,JR.BUFFER_CREATIONFLAG_INDIRECT=64,JR.RENDERPASS_MAIN=0,JR.INPUT_ALT_KEY=18,JR.INPUT_CTRL_KEY=17,JR.INPUT_META_KEY1=91,JR.INPUT_META_KEY2=92,JR.INPUT_META_KEY3=93,JR.INPUT_SHIFT_KEY=16,JR.SNAPSHOTRENDERING_STANDARD=0,JR.SNAPSHOTRENDERING_FAST=1,JR.PERSPECTIVE_CAMERA=0,JR.ORTHOGRAPHIC_CAMERA=1,JR.FOVMODE_VERTICAL_FIXED=0,JR.FOVMODE_HORIZONTAL_FIXED=1,JR.RIG_MODE_NONE=0,JR.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,JR.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,JR.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,JR.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,JR.RIG_MODE_STEREOSCOPIC_INTERLACED=14,JR.RIG_MODE_VR=20,JR.RIG_MODE_CUSTOM=22,JR.MAX_SUPPORTED_UV_SETS=6,JR.GL_ALPHA_EQUATION_ADD=32774,JR.GL_ALPHA_EQUATION_MIN=32775,JR.GL_ALPHA_EQUATION_MAX=32776,JR.GL_ALPHA_EQUATION_SUBTRACT=32778,JR.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,JR.GL_ALPHA_FUNCTION_SRC=768,JR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,JR.GL_ALPHA_FUNCTION_SRC_ALPHA=770,JR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,JR.GL_ALPHA_FUNCTION_DST_ALPHA=772,JR.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,JR.GL_ALPHA_FUNCTION_DST_COLOR=774,JR.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,JR.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,JR.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,JR.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,JR.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,JR.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,JR.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,JR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,JR.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,JR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,JR.SnippetUrl="https://snippet.babylonjs.com",JR.FOGMODE_NONE=0,JR.FOGMODE_EXP=1,JR.FOGMODE_EXP2=2,JR.FOGMODE_LINEAR=3,JR.BYTE=5120,JR.UNSIGNED_BYTE=5121,JR.SHORT=5122,JR.UNSIGNED_SHORT=5123,JR.INT=5124,JR.UNSIGNED_INT=5125,JR.FLOAT=5126,JR.PositionKind="position",JR.NormalKind="k",JR.TangentKind="tangent",JR.UVKind="uv",JR.UV2Kind="uv2",JR.UV3Kind="uv3",JR.UV4Kind="uv4",JR.UV5Kind="uv5",JR.UV6Kind="uv6",JR.ColorKind="color",JR.ColorInstanceKind="instanceColor",JR.MatricesIndicesKind="matricesIndices",JR.MatricesWeightsKind="matricesWeights",JR.MatricesIndicesExtraKind="matricesIndicesExtra",JR.MatricesWeightsExtraKind="matricesWeightsExtra";class sR{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:JR.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(R,q){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...sR._GetDefaultOptions(),...R},this._scene=q,this._scene._transmissionHelper=this,this.onErrorObservable=new C.b,this._scene.ej.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(R){if(!Object.keys(R).filter((q=>this._options[q]!==R[q])).length)return;const q={...this._options,...R},L=this._options;this._options=q,q.renderSize===L.renderSize&&q.renderTargetTextureType===L.renderTargetTextureType&&q.generateMipmaps===L.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=q.samples,this._opaqueRenderTarget.lodGenerationScale=q.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=q.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(R){return!!R&&!!(R instanceof I&&R.subSurface.isRefractionEnabled)}_addMesh(R){this._materialObservers[R.uniqueId]=R.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Z.f.SetImmediate((()=>{this._shouldRenderAsTransmission(R.material)?(R.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(R)&&this._transparentMeshesCache.push(R)):-1===this._opaqueMeshesCache.indexOf(R)&&this._opaqueMeshesCache.push(R)}))}_removeMesh(R){R.onMaterialChangedObservable.remove(this._materialObservers[R.uniqueId]),delete this._materialObservers[R.uniqueId];let q=this._transparentMeshesCache.indexOf(R);-1!==q&&this._transparentMeshesCache.splice(q,1),q=this._opaqueMeshesCache.indexOf(R),-1!==q&&this._opaqueMeshesCache.splice(q,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(R){const q=this._transparentMeshesCache.indexOf(R),L=this._opaqueMeshesCache.indexOf(R);this._shouldRenderAsTransmission(R.material)?(R.material instanceof I&&(R.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==L?(this._opaqueMeshesCache.splice(L,1),this._transparentMeshesCache.push(R)):-1===q&&this._transparentMeshesCache.push(R)):-1!==q?(this._transparentMeshesCache.splice(q,1),this._opaqueMeshesCache.push(R)):-1===L&&this._opaqueMeshesCache.push(R)}_isRenderTargetValid(){var R;return null!==(null===(R=this._opaqueRenderTarget)||void 0===R?void 0:R.getInternalTexture())}_setupRenderTargets(){var R;let q,L;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new jR.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(R=this._options.clearColor)||void 0===R?void 0:R.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((R=>{L=this._scene.environmentIntensity,this._scene.environmentIntensity=1,q=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?R.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(R.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=L,this._scene.imageProcessingConfiguration._applyByPostProcess=q})),this._transparentMeshesCache.forEach((R=>{this._shouldRenderAsTransmission(R.material)&&(R.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const AR="KHR_materials_transmission";class MR{constructor(R){this.name=AR,this.order=175,this._loader=R,this.enabled=this._loader.isExtensionUsed(AR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadTransparentPropertiesAsync(B,q,L,N)),Promise.all(h).then((()=>{}))}))}_loadTransparentPropertiesAsync(R,q,L,B){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const N=L;if(N.subSurface.isRefractionEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.useAlbedoToTintRefraction=!0,void 0===B.transmissionFactor)return N.subSurface.refractionIntensity=0,N.subSurface.isRefractionEnabled=!1,Promise.resolve();{var h;N.subSurface.refractionIntensity=B.transmissionFactor;const R=N.va();if(N.subSurface.refractionIntensity&&!R._transmissionHelper)new sR({},N.va());else if(N.subSurface.refractionIntensity&&(null===(h=R._transmissionHelper)||void 0===h||!h._isRenderTargetValid())){var Z;null===(Z=R._transmissionHelper)||void 0===Z||Z._setupRenderTargets()}}return N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/transmissionTexture`,B.transmissionTexture,void 0).then((R=>{R.name=`${L.name} (Transmission)`,N.subSurface.refractionIntensityTexture=R,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}s(AR),J(AR,!0,(R=>new MR(R)));const bR="KHR_materials_diffuse_transmission";class XR{constructor(R){this.name=bR,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(bR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadTranslucentPropertiesAsync(B,q,L,N)),Promise.all(h).then((()=>{}))}))}_loadTranslucentPropertiesAsync(R,q,L,B){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);const N=L;if(N.subSurface.isTranslucencyEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,N.subSurface.useAlbedoToTintTranslucency=!1,void 0===B.diffuseTransmissionFactor)return N.subSurface.translucencyIntensity=0,N.subSurface.isTranslucencyEnabled=!1,Promise.resolve();N.subSurface.translucencyIntensity=B.diffuseTransmissionFactor;const Z=new Array;return N.subSurface.useGltfStyleTextures=!0,B.diffuseTransmissionTexture&&(B.diffuseTransmissionTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionTexture`,B.diffuseTransmissionTexture).then((R=>{R.name=`${L.name} (Diffuse Transmission)`,N.subSurface.translucencyIntensityTexture=R})))),void 0!==B.diffuseTransmissionColorFactor?N.subSurface.translucencyColor=h.e.Ig(B.diffuseTransmissionColorFactor):N.subSurface.translucencyColor=h.e.White(),B.diffuseTransmissionColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionColorTexture`,B.diffuseTransmissionColorTexture).then((R=>{R.name=`${L.name} (Diffuse Transmission Color)`,N.subSurface.translucencyColorTexture=R}))),Promise.all(Z).then((()=>{}))}}s(bR),J(bR,!0,(R=>new XR(R)));const uR="KHR_materials_volume";class Rq{constructor(R){this.name=uR,this.order=173,this._loader=R,this.enabled=this._loader.isExtensionUsed(uR),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadVolumePropertiesAsync(B,q,L,N)),Promise.all(h).then((()=>{}))}))}_loadVolumePropertiesAsync(R,q,L,B){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);if(!L.subSurface.isRefractionEnabled&&!L.subSurface.isTranslucencyEnabled||!B.thicknessFactor)return Promise.resolve();L.subSurface.volumeIndexOfRefraction=L.indexOfRefraction;const N=void 0!==B.attenuationDistance?B.attenuationDistance:Number.MAX_VALUE;return L.subSurface.tintColorAtDistance=N,void 0!==B.attenuationColor&&3==B.attenuationColor.length&&L.subSurface.tintColor.Td(B.attenuationColor[0],B.attenuationColor[1],B.attenuationColor[2]),L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=B.thicknessFactor,L.subSurface.useThicknessAsDepth=!0,B.thicknessTexture?(B.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/thicknessTexture`,B.thicknessTexture).then((R=>{R.name=`${L.name} (Thickness)`,L.subSurface.thicknessTexture=R,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}s(uR),J(uR,!0,(R=>new Rq(R)));const qq="KHR_materials_dispersion";class Lq{constructor(R){this.name=qq,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(qq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(R,q,L)),h.push(this._loadDispersionPropertiesAsync(B,q,L,N)),Promise.all(h).then((()=>{}))}))}_loadDispersionPropertiesAsync(R,q,L,B){if(!(L instanceof I))throw new Error(`${R}: Material type not supported`);return L.subSurface.isRefractionEnabled&&B.dispersion?(L.subSurface.isDispersionEnabled=!0,L.subSurface.dispersion=B.dispersion,Promise.resolve()):Promise.resolve()}}s(qq),J(qq,!0,(R=>new Lq(R)));const Bq="KHR_mesh_quantization";class Nq{constructor(R){this.name=Bq,this.enabled=R.isExtensionUsed(Bq)}dispose(){}}s(Bq),J(Bq,!0,(R=>new Nq(R)));const hq="KHR_texture_basisu";class Zq{constructor(R){this.name=hq,this._loader=R,this.enabled=R.isExtensionUsed(hq)}dispose(){this._loader=null}_loadTextureAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>{const h=void 0==q.sampler?b.DefaultSampler:M.Get(`${R}/sampler`,this._loader.Ji.samplers,q.sampler),Z=M.Get(`${B}/source`,this._loader.Ji.images,N.source);return this._loader._createTextureAsync(R,h,Z,(R=>{L(R)}),q._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!q._textureInfo.nonColorData)}))}}s(hq),J(hq,!0,(R=>new Zq(R)));const zq="KHR_texture_transform";class Yq{constructor(R){this.name=zq,this._loader=R,this.enabled=this._loader.isExtensionUsed(zq)}dispose(){this._loader=null}loadTextureInfoAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((B,N)=>this._loader.loadTextureInfoAsync(R,q,(R=>{if(!(R instanceof K.c))throw new Error(`${B}: Texture type not supported`);N.offset&&(R.uOffset=N.offset[0],R.vOffset=N.offset[1]),R.uRotationCenter=0,R.vRotationCenter=0,N.rotation&&(R.wAng=-N.rotation),N.scale&&(R.uScale=N.scale[0],R.vScale=N.scale[1]),void 0!=N.texCoord&&(R.coordinatesIndex=N.texCoord),L(R)}))))}}s(zq),J(zq,!0,(R=>new Yq(R)));const Fq="KHR_xmp_json_ld";class Cq{constructor(R){this.name=Fq,this.order=100,this._loader=R,this.enabled=this._loader.isExtensionUsed(Fq)}dispose(){this._loader=null}onLoading(){var R,q,L;if(null===this._loader.rootBabylonMesh)return;const B=null===(R=this._loader.Ji.extensions)||void 0===R?void 0:R.KHR_xmp_json_ld,N=null===(q=this._loader.Ji.asset)||void 0===q||null===(L=q.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld;if(B&&N){const R=+N.packet;B.packets&&R<B.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=B.packets[R])}}}function eq(R,q,L,B){return h.e.Ig(q,L).scale(B)}function yq(R,q,L,B){return q[L]*B}function Uq(R,q,L,B){return-q[L]*B}function nq(R,q,L,B){return q[L+1]*B}function rq(R,q,L,B){return q[L]*B*2}function pq(R){return{scale:[new dq(y.b.ANIMATIONTYPE_FLOAT,`${R}.uScale`,yq,(()=>2)),new dq(y.b.ANIMATIONTYPE_FLOAT,`${R}.vScale`,nq,(()=>2))],offset:[new dq(y.b.ANIMATIONTYPE_FLOAT,`${R}.uOffset`,yq,(()=>2)),new dq(y.b.ANIMATIONTYPE_FLOAT,`${R}.vOffset`,nq,(()=>2))],rotation:[new dq(y.b.ANIMATIONTYPE_FLOAT,`${R}.wAng`,Uq,(()=>1))]}}s(Fq),J(Fq,!0,(R=>new Cq(R)));class cq extends k{buildAnimations(R,q,L,B,N){N(R._babylonCamera,this._buildAnimation(q,L,B))}}class dq extends k{buildAnimations(R,q,L,B,N){for(const h in R._data)N(R._data[h].babylonMaterial,this._buildAnimation(q,L,B))}}class fq extends k{buildAnimations(R,q,L,B,N){N(R._babylonLight,this._buildAnimation(q,L,B))}}const vq={__array__:{__target__:!0,...x}},Tq={__array__:{__target__:!0,orthographic:{xmag:[new cq(y.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Uq,(()=>1)),new cq(y.b.ANIMATIONTYPE_FLOAT,"orthoRight",nq,(()=>1))],ymag:[new cq(y.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Uq,(()=>1)),new cq(y.b.ANIMATIONTYPE_FLOAT,"orthoTop",nq,(()=>1))],zfar:[new cq(y.b.ANIMATIONTYPE_FLOAT,"maxZ",yq,(()=>1))],znear:[new cq(y.b.ANIMATIONTYPE_FLOAT,"Ri",yq,(()=>1))]},perspective:{yfov:[new cq(y.b.ANIMATIONTYPE_FLOAT,"fov",yq,(()=>1))],zfar:[new cq(y.b.ANIMATIONTYPE_FLOAT,"maxZ",yq,(()=>1))],znear:[new cq(y.b.ANIMATIONTYPE_FLOAT,"Ri",yq,(()=>1))]}}},tq={nodes:vq,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new dq(y.b.ANIMATIONTYPE_COLOR3,"albedoColor",eq,(()=>4)),new dq(y.b.ANIMATIONTYPE_FLOAT,"alpha",(function(R,q,L,B){return q[L+3]*B}),(()=>4))],metallicFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"metallic",yq,(()=>1))],roughnessFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"roughness",yq,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:pq("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:pq("metallicTexture")}}},emissiveFactor:[new dq(y.b.ANIMATIONTYPE_COLOR3,"emissiveColor",eq,(()=>3))],normalTexture:{scale:[new dq(y.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",yq,(()=>1))],extensions:{KHR_texture_transform:pq("bumpTexture")}},occlusionTexture:{strength:[new dq(y.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",yq,(()=>1))],extensions:{KHR_texture_transform:pq("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:pq("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new dq(y.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",yq,(()=>1))],anisotropyRotation:[new dq(y.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",yq,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:pq("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",yq,(()=>1))],clearcoatRoughnessFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",yq,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:pq("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new dq(y.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",yq,(()=>1))],extensions:{KHR_texture_transform:pq("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:pq("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new dq(y.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",yq,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new dq(y.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",yq,(()=>1))]},KHR_materials_ior:{ior:[new dq(y.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",yq,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",yq,(()=>1))],iridescenceIor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",yq,(()=>1))],iridescenceThicknessMinimum:[new dq(y.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",yq,(()=>1))],iridescenceThicknessMaximum:[new dq(y.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",yq,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:pq("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:pq("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new dq(y.b.ANIMATIONTYPE_COLOR3,"sheen.color",eq,(()=>3))],sheenRoughnessFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",yq,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:pq("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:pq("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",yq,(()=>1))],specularColorFactor:[new dq(y.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",eq,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:pq("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:pq("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",yq,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:pq("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new dq(y.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",eq,(()=>3))],attenuationDistance:[new dq(y.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",yq,(()=>1))],thicknessFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",yq,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:pq("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new dq(y.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",yq,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:pq("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new dq(y.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",eq,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:pq("subSurface.translucencyColorTexture")}}}}}},cameras:Tq,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new fq(y.b.ANIMATIONTYPE_COLOR3,"diffuse",eq,(()=>3))],Vi:[new fq(y.b.ANIMATIONTYPE_FLOAT,"intensity",yq,(()=>1))],range:[new fq(y.b.ANIMATIONTYPE_FLOAT,"range",yq,(()=>1))],spot:{innerConeAngle:[new fq(y.b.ANIMATIONTYPE_FLOAT,"innerAngle",rq,(()=>1))],outerConeAngle:[new fq(y.b.ANIMATIONTYPE_FLOAT,"angle",rq,(()=>1))]}}}}}};class Dq{constructor(R,q){this._gltf=R,this._infoTree=q}convert(R){let q,L=this._gltf,B=this._infoTree;if(!R.startsWith("/"))throw new Error("Path must start with a /");const N=R.split("/");N.shift();for(const h of N){if(B.__array__)B=B.__array__;else if(B=B[h],!B)throw new Error(`Path ${R} is invalid`);if(void 0===L)throw new Error(`Path ${R} is invalid`);L=L[h],B.__target__&&(q=L)}return{object:q,info:B}}}const Sq="KHR_animation_pointer";class Iq extends Dq{constructor(R){super(R,tq)}}class Kq{constructor(R){this.name=Sq,this._loader=R,this._pathToObjectConverter=new Iq(this._loader.Ji)}get enabled(){return this._loader.isExtensionUsed(Sq)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(R,q,L,B,N){var h;const Z=null===(h=B.target.extensions)||void 0===h?void 0:h.KHR_animation_pointer;if(!Z||!this._pathToObjectConverter)return null;"pointer"!==B.target.path&&r.d.Warn(`${R}/target/path: Value (${B.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=B.target.node&&r.d.Warn(`${R}/target/node: Value (${B.target.node}) must not be present when using the ${this.name} extension`);const z=`${R}/extensions/${this.name}`,Y=Z.pointer;if(!Y)throw new Error(`${z}: Pointer is missing`);try{const h=this._pathToObjectConverter.convert(Y);return this._loader._loadAnimationChannelFromTargetInfoAsync(R,q,L,B,h,N)}catch(F){return r.d.Warn(`${z}/pointer: Invalid pointer (${Y}) skipped`),null}}}s(Sq),J(Sq,!0,(R=>new Kq(R)));class mq{constructor(R,q,L){this.frame=R,this.action=q,this.onlyOnce=L,this.isDone=!1}_clone(){return new mq(this.frame,this.action,this.onlyOnce)}}var oq=L(10785),lq=L(10834);class Gq{get loop(){return this._loop}set loop(R){R!==this._loop&&(this._loop=R,this.updateOptions({loop:R}))}get currentTime(){var R;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(R=lq.e.audioEngine)&&void 0!==R&&R.audioContext&&(this.isPlaying||this.isPaused)){const R=this.isPaused?0:lq.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+R}return 0}get spatialSound(){return this._spatialSound}set spatialSound(R){if(R==this._spatialSound)return;const q=this.isPlaying;this.pause(),R?(this._spatialSound=R,this._updateSpatialParameters()):this._disableSpatialSound(),q&&this.play()}constructor(R,q,L){var B;let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new C.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=N.m.Zero(),this._localDirection=new N.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=R,L=L||n.b.LastCreatedScene)if(this._scene=L,Gq._SceneComponentInitialization(L),this._readyToPlayCallback=h,this._customAttenuationFunction=(R,q,L,B,N)=>q<L?R*(1-q/L):0,z&&(this.autoplay=z.autoplay||!1,this._loop=z.loop||!1,void 0!==z.volume&&(this._volume=z.volume),this._spatialSound=z.spatialSound??!1,this.maxDistance=z.maxDistance??100,this.useCustomAttenuation=z.useCustomAttenuation??!1,this.rolloffFactor=z.rolloffFactor||1,this.refDistance=z.refDistance||1,this.distanceModel=z.distanceModel||"linear",this._playbackRate=z.playbackRate||1,this._streaming=z.streaming??!1,this._length=z.length,this._offset=z.offset),null!==(B=lq.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&lq.e.audioEngine.audioContext){this._soundGain=lq.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let R=!0;if(q)try{"string"===typeof q?(this._urlType="String",this._url=q):q instanceof ArrayBuffer?this._urlType="ArrayBuffer":q instanceof HTMLMediaElement?this._urlType="MediaElement":q instanceof MediaStream?this._urlType="MediaStream":q instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(q)&&(this._urlType="Array");let L=[],B=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lq.e.audioEngine.audioContext.createMediaElementSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lq.e.audioEngine.audioContext.createMediaStreamSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":q.byteLength>0&&(B=!0,this._soundLoaded(q));break;case"AudioBuffer":this._audioBufferLoaded(q);break;case"String":L.push(q);case"Array":0===L.length&&(L=q);for(let R=0;R<L.length;R++){const q=L[R];if(B=z&&z.skipCodecCheck||-1!==q.indexOf(".mp3",q.length-4)&&lq.e.audioEngine.isMP3supported||-1!==q.indexOf(".ogg",q.length-4)&&lq.e.audioEngine.isOGGsupported||-1!==q.indexOf(".wav",q.length-4)||-1!==q.indexOf(".m4a",q.length-4)||-1!==q.indexOf(".mp4",q.length-4)||-1!==q.indexOf("blob:"),B){this._streaming?(this._htmlAudioElement=new Audio(q),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Z.f.SetCorsBehavior(q,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(q,(R=>{this._soundLoaded(R)}),void 0,!0,!0,(R=>{R&&r.d.Error("XHR "+R.status+" error on: "+q+"."),r.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:R=!1}R?B||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):r.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(Y){r.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),lq.e.audioEngine&&!lq.e.audioEngine.WarnedWebAudioUnsupported&&(r.d.Error("Web Audio is not supported by your browser."),lq.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var R;null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(R){var q;null!==(q=lq.e.audioEngine)&&void 0!==q&&q.audioContext&&(this._audioBuffer=R,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(R){var q;null!==(q=lq.e.audioEngine)&&void 0!==q&&q.audioContext&&lq.e.audioEngine.audioContext.decodeAudioData(R,(R=>{this._audioBufferLoaded(R)}),(R=>{r.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+R)}))}setAudioBuffer(R){var q;null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this._audioBuffer=R,this._isReadyToPlay=!0)}updateOptions(R){R&&(this.loop=R.loop??this.loop,this.maxDistance=R.maxDistance??this.maxDistance,this.useCustomAttenuation=R.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=R.rolloffFactor??this.rolloffFactor,this.refDistance=R.refDistance??this.refDistance,this.distanceModel=R.distanceModel??this.distanceModel,this._playbackRate=R.playbackRate??this._playbackRate,this._length=R.length??void 0,this.spatialSound=R.spatialSound??this._spatialSound,this._setOffset(R.offset??void 0),this.setVolume(R.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var R;null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&lq.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??lq.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var R;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(R=this._soundPanner)||void 0===R||R.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var R;null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(R){var q;null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(R),this._isOutputConnected=!0)}setDirectionalCone(R,q,L){q<R?r.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=R,this._coneOuterAngle=q,this._coneOuterGain=L,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!=this._coneInnerAngle){var q;if(this._coneOuterAngle<R)return void r.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R,null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!=this._coneOuterAngle){var q;if(R<this._coneInnerAngle)return void r.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R,null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(R){var q;R.equals(this._position)||(this._position.p(R),null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(R){var q;this._localDirection=R,null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const R=this._connectedTransformNode.getWorldMatrix(),q=N.m.TransformNormal(this._localDirection,R);q.normalize(),this._soundPanner.orientationX.value=q.x,this._soundPanner.orientationY.value=q.y,this._soundPanner.orientationZ.value=q.z}updateDistanceFromListener(){var R;if(null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const R=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Bc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,R,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(R){this._customAttenuationFunction=R}play(R,q,L){var B;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(B=lq.e.audioEngine)&&void 0!==B&&B.audioContext)try{var N,h;this._clearTimeoutsAndObservers();let B=R?(null===(N=lq.e.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+R:null===(h=lq.e.audioEngine)||void 0===h?void 0:h.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=lq.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const R=()=>{var L;if(null!==(L=lq.e.audioEngine)&&void 0!==L&&L.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=q??0;const L=this._htmlAudioElement.play();void 0!==L&&L.catch((()=>{var q,L;(null===(q=lq.e.audioEngine)||void 0===q||q.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(L=lq.e.audioEngine)||void 0===L?void 0:L.onAudioUnlockedObservable.addOnce((()=>{R()})))}))}else{var B;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(B=lq.e.audioEngine)||void 0===B?void 0:B.onAudioUnlockedObservable.addOnce((()=>{R()}))}};R()}}else{var Z;const N=()=>{var N;if(null!==(N=lq.e.audioEngine)&&void 0!==N&&N.audioContext){var h;if(L=L||this._length,void 0!==q&&this._setOffset(q),this._soundSource){const R=this._soundSource;R.onended=()=>{R.disconnect()}}if(this._soundSource=null===(h=lq.e.audioEngine)||void 0===h?void 0:h.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Z;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==q&&(this._soundSource.loopStart=q),void 0!==L&&(this._soundSource.loopEnd=(0|q)+L),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},B=R?(null===(Z=lq.e.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime)+R:lq.e.audioEngine.audioContext.currentTime;const N=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(B,N,this.loop?void 0:L)}}};"suspended"===(null===(Z=lq.e.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var R;"suspended"===(null===(R=lq.e.audioEngine)||void 0===R?void 0:R.audioContext.state)?(lq.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=lq.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{N()})))):N()}),500):N()}this._startTime=B,this.isPlaying=!0,this.isPaused=!1}catch(z){r.d.Error("Error while trying to play audio: "+this.name+", "+z.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(R){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var L;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(L=this._streamingSource)||void 0===L||L.disconnect();this.isPlaying=!1}else if(null!==(q=lq.e.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource){const q=R?lq.e.audioEngine.audioContext.currentTime+R:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(q)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var R;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var q;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(q=this._streamingSource)||void 0===q||q.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(R=lq.e.audioEngine)&&void 0!==R&&R.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=lq.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(R,q){var L;null!==(L=lq.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._soundGain&&(q&&lq.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(lq.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,lq.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(R,lq.e.audioEngine.audioContext.currentTime+q)):this._soundGain.gain.value=R),this._volume=R}setPlaybackRate(R){this._playbackRate=R,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(R){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=R,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=R=>this._onRegisterAfterWorldMatrixUpdate(R),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(R){var q;if(R.getBoundingInfo){const q=R.getBoundingInfo();this.setPosition(q.boundingSphere.centerWorld)}else this.setPosition(R.absolutePosition);null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const R=()=>{this._isReadyToPlay?(L._audioBuffer=this.getAudioBuffer(),L._isReadyToPlay=!0,L.autoplay&&L.play(0,this._offset,this._length)):setTimeout(R,300)},q={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},L=new Gq(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,q);return this.useCustomAttenuation&&L.setAttenuationFunction(this._customAttenuationFunction),L.setPosition(this._position),L.setPlaybackRate(this._playbackRate),R(),L}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const R={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(R.connectedMeshId=this._connectedTransformNode.id),R.position=this._position.dj(),R.refDistance=this.refDistance,R.distanceModel=this.distanceModel,R.isDirectional=this._isDirectional,R.localDirectionToMesh=this._localDirection.dj(),R.coneInnerAngle=this._coneInnerAngle,R.coneOuterAngle=this._coneOuterAngle,R.coneOuterGain=this._coneOuterGain),R}static Parse(R,q,L,B){const h=R.name;let Z;Z=R.url?L+R.url:L+h;const z={autoplay:R.autoplay,loop:R.loop,volume:R.volume,spatialSound:R.spatialSound,maxDistance:R.maxDistance,rolloffFactor:R.rolloffFactor,refDistance:R.refDistance,distanceModel:R.distanceModel,playbackRate:R.playbackRate};let Y;if(B){const R=()=>{B._isReadyToPlay?(Y._audioBuffer=B.getAudioBuffer(),Y._isReadyToPlay=!0,Y.autoplay&&Y.play(0,Y._offset,Y._length)):setTimeout(R,300)};Y=new Gq(h,new ArrayBuffer(0),q,null,z),R()}else Y=new Gq(h,Z,q,(()=>{q.removePendingData(Y)}),z),q.addPendingData(Y);if(R.position){const q=N.m.Ig(R.position);Y.setPosition(q)}if(R.isDirectional&&(Y.setDirectionalCone(R.coneInnerAngle||360,R.coneOuterAngle||360,R.coneOuterGain||0),R.localDirectionToMesh)){const q=N.m.Ig(R.localDirectionToMesh);Y.setLocalDirectionToMesh(q)}if(R.connectedMeshId){const L=q.getMeshById(R.connectedMeshId);L&&Y.attachToMesh(L)}return R.metadata&&(Y.metadata=R.metadata),Y}_setOffset(R){this._offset!==R&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=R)}_clearTimeoutsAndObservers(){var R;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(R=lq.e.audioEngine)||void 0===R||R.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Gq._SceneComponentInitialization=R=>{throw(0,oq.d)("AudioSceneComponent")},(0,D.f)("BABYLON.Sound",Gq);class Wq{constructor(R,q,L){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],q.length!==L.length)throw new Error("Sounds length does not equal weights length");this.loop=R,this._weights=L;let B=0;for(const h of L)B+=h;const N=B>0?1/B:0;for(let h=0;h<this._weights.length;h++)this._weights[h]*=N;this._sounds=q;for(const h of this._sounds)h.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!==this._coneInnerAngle){if(this._coneOuterAngle<R)return void r.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R;for(const q of this._sounds)q.directionalConeInnerAngle=R}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!==this._coneOuterAngle){if(R<this._coneInnerAngle)return void r.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R;for(const q of this._sounds)q.directionalConeOuterAngle=R}}get volume(){return this._volume}set volume(R){if(R!==this._volume)for(const q of this._sounds)q.setVolume(R)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(R){if(!this.isPaused){this.stop();const R=Math.random();let q=0;for(let L=0;L<this._weights.length;L++)if(q+=this._weights[L],R<=q){this._currentIndex=L;break}}const q=this._sounds[this._currentIndex??0];q.isReady()?q.play(0,this.isPaused?void 0:R):q.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Hq{constructor(R){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(R=R||n.b.LastCreatedScene)&&(this._scene=R,this.soundCollection=[],this._options=q,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var R;null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&lq.e.audioEngine.audioContext&&(this._outputAudioNode=lq.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(lq.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(lq.e.audioEngine&&lq.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(R){var q;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&R.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==R.soundTrackId&&(-1===R.soundTrackId?this._scene.mainSoundTrack.removeSound(R):this._scene.soundTracks&&this._scene.soundTracks[R.soundTrackId].removeSound(R)),this.soundCollection.push(R),R.soundTrackId=this.id}removeSound(R){const q=this.soundCollection.indexOf(R);-1!==q&&this.soundCollection.splice(q,1)}setVolume(R){var q;null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=R)}switchPanningModelToHRTF(){var R;if(null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var R;if(null!==(R=lq.e.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToEqualPower()}connectToAnalyser(R){var q;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=R,null!==(q=lq.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,lq.e.audioEngine.masterGain))}}var Pq=L(11160),Oq=L(11071),Eq=(L(11645),L(10778));(0,L(11738).g)(Pq.d.NAME_AUDIO,((R,q,L,B)=>{let N,h=[];if(L.Wj=L.Wj||[],void 0!==R.Wj&&null!==R.Wj)for(let z=0,Y=R.Wj.length;z<Y;z++){var Z;const Y=R.Wj[z];null!==(Z=lq.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio?(Y.url||(Y.url=Y.name),h[Y.url]?L.Wj.push(Gq.Parse(Y,q,B,h[Y.url])):(N=Gq.Parse(Y,q,B),h[Y.url]=N,L.Wj.push(N))):L.Wj.push(new Gq(Y.name,null,q))}h=[]})),Object.defineProperty(Oq.b.prototype,"mainSoundTrack",{get:function(){let R=this._getComponent(Pq.d.NAME_AUDIO);return R||(R=new aq(this),this.fb(R)),this._mainSoundTrack||(this._mainSoundTrack=new Hq(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Oq.b.prototype.getSoundByName=function(R){let q;for(q=0;q<this.mainSoundTrack.soundCollection.length;q++)if(this.mainSoundTrack.soundCollection[q].name===R)return this.mainSoundTrack.soundCollection[q];if(this.soundTracks)for(let L=0;L<this.soundTracks.length;L++)for(q=0;q<this.soundTracks[L].soundCollection.length;q++)if(this.soundTracks[L].soundCollection[q].name===R)return this.soundTracks[L].soundCollection[q];return null},Object.defineProperty(Oq.b.prototype,"audioEnabled",{get:function(){let R=this._getComponent(Pq.d.NAME_AUDIO);return R||(R=new aq(this),this.fb(R)),R.audioEnabled},set:function(R){let q=this._getComponent(Pq.d.NAME_AUDIO);q||(q=new aq(this),this.fb(q)),R?q.enableAudio():q.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Oq.b.prototype,"headphone",{get:function(){let R=this._getComponent(Pq.d.NAME_AUDIO);return R||(R=new aq(this),this.fb(R)),R.headphone},set:function(R){let q=this._getComponent(Pq.d.NAME_AUDIO);q||(q=new aq(this),this.fb(q)),R?q.switchAudioModeForHeadphones():q.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Oq.b.prototype,"audioListenerPositionProvider",{get:function(){let R=this._getComponent(Pq.d.NAME_AUDIO);return R||(R=new aq(this),this.fb(R)),R.audioListenerPositionProvider},set:function(R){let q=this._getComponent(Pq.d.NAME_AUDIO);if(q||(q=new aq(this),this.fb(q)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");q.audioListenerPositionProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(Oq.b.prototype,"audioListenerRotationProvider",{get:function(){let R=this._getComponent(Pq.d.NAME_AUDIO);return R||(R=new aq(this),this.fb(R)),R.audioListenerRotationProvider},set:function(R){let q=this._getComponent(Pq.d.NAME_AUDIO);if(q||(q=new aq(this),this.fb(q)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");q.audioListenerRotationProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(Oq.b.prototype,"audioPositioningRefreshRate",{get:function(){let R=this._getComponent(Pq.d.NAME_AUDIO);return R||(R=new aq(this),this.fb(R)),R.audioPositioningRefreshRate},set:function(R){let q=this._getComponent(Pq.d.NAME_AUDIO);q||(q=new aq(this),this.fb(q)),q.audioPositioningRefreshRate=R},enumerable:!0,configurable:!0});class aq{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(R){this.name=Pq.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new N.m,this._cachedCameraPosition=new N.m,this._lastCheck=0,this._invertMatrixTemp=new N.c,this._cameraDirectionTemp=new N.m,(R=R||n.b.LastCreatedScene)&&(this.Nc=R,R.soundTracks=[],R.Wj=[])}register(){this.Nc._afterRenderStage.registerStep(Pq.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(R){if(R.Wj=[],this.Nc.soundTracks)for(let q=0;q<this.Nc.soundTracks.length;q++){const L=this.Nc.soundTracks[q];for(let q=0;q<L.soundCollection.length;q++)R.Wj.push(L.soundCollection[q].serialize())}}addFromContainer(R){R.Wj&&R.Wj.forEach((R=>{R.play(),R.autoplay=!0,this.Nc.mainSoundTrack.addSound(R)}))}removeFromContainer(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R.Wj&&R.Wj.forEach((R=>{R.stop(),R.autoplay=!1,this.Nc.mainSoundTrack.removeSound(R),q&&R.dispose()}))}dispose(){const R=this.Nc;if(R._mainSoundTrack&&R.mainSoundTrack.dispose(),R.soundTracks)for(let q=0;q<R.soundTracks.length;q++)R.soundTracks[q].dispose()}disableAudio(){const R=this.Nc;let q;for(this._audioEnabled=!1,lq.e.audioEngine&&lq.e.audioEngine.audioContext&&lq.e.audioEngine.audioContext.suspend(),q=0;q<R.mainSoundTrack.soundCollection.length;q++)R.mainSoundTrack.soundCollection[q].pause();if(R.soundTracks)for(q=0;q<R.soundTracks.length;q++)for(let L=0;L<R.soundTracks[q].soundCollection.length;L++)R.soundTracks[q].soundCollection[L].pause()}enableAudio(){const R=this.Nc;let q;for(this._audioEnabled=!0,lq.e.audioEngine&&lq.e.audioEngine.audioContext&&lq.e.audioEngine.audioContext.resume(),q=0;q<R.mainSoundTrack.soundCollection.length;q++)R.mainSoundTrack.soundCollection[q].isPaused&&R.mainSoundTrack.soundCollection[q].play();if(R.soundTracks)for(q=0;q<R.soundTracks.length;q++)for(let L=0;L<R.soundTracks[q].soundCollection.length;L++)R.soundTracks[q].soundCollection[L].isPaused&&R.soundTracks[q].soundCollection[L].play()}switchAudioModeForHeadphones(){const R=this.Nc;if(this._headphone=!0,R.mainSoundTrack.switchPanningModelToHRTF(),R.soundTracks)for(let q=0;q<R.soundTracks.length;q++)R.soundTracks[q].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const R=this.Nc;if(this._headphone=!1,R.mainSoundTrack.switchPanningModelToEqualPower(),R.soundTracks)for(let q=0;q<R.soundTracks.length;q++)R.soundTracks[q].switchPanningModelToEqualPower()}_afterRender(){const R=Eq.c.Now;if(this._lastCheck&&R-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=R;const q=this.Nc;if(!this._audioEnabled||!q._mainSoundTrack||!q.soundTracks||0===q._mainSoundTrack.soundCollection.length&&1===q.soundTracks.length)return;const L=lq.e.audioEngine;if(L&&L.audioContext){let R,B=q.activeCamera;if(q.activeCameras&&q.activeCameras.length>0&&(B=q.activeCameras[0]),this.audioListenerPositionProvider){const R=this.audioListenerPositionProvider();L.audioContext.listener.setPosition(R.x||0,R.y||0,R.z||0)}else B?this._cachedCameraPosition.equals(B.globalPosition)||(this._cachedCameraPosition.p(B.globalPosition),L.audioContext.listener.setPosition(B.globalPosition.x,B.globalPosition.y,B.globalPosition.z)):L.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const R=this.audioListenerRotationProvider();L.audioContext.listener.setOrientation(R.x||0,R.y||0,R.z||0,0,1,0)}else B?(B.rigCameras&&B.rigCameras.length>0&&(B=B.rigCameras[0]),B.getViewMatrix().invertToRef(this._invertMatrixTemp),N.m.TransformNormalToRef(aq._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),L.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):L.audioContext.listener.setOrientation(0,0,0,0,1,0);for(R=0;R<q.mainSoundTrack.soundCollection.length;R++){const L=q.mainSoundTrack.soundCollection[R];L.useCustomAttenuation&&L.updateDistanceFromListener()}if(q.soundTracks)for(R=0;R<q.soundTracks.length;R++)for(let L=0;L<q.soundTracks[R].soundCollection.length;L++){const B=q.soundTracks[R].soundCollection[L];B.useCustomAttenuation&&B.updateDistanceFromListener()}}}}aq._CameraDirection=new N.m(0,0,-1),Gq._SceneComponentInitialization=R=>{let q=R._getComponent(Pq.d.NAME_AUDIO);q||(q=new aq(R),R.fb(q))};const gq="MSFT_audio_emitter";class Qq{constructor(R){this.name=gq,this._loader=R,this.enabled=this._loader.isExtensionUsed(gq)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const R=this._loader.Ji.extensions;if(R&&R[this.name]){const q=R[this.name];this._clips=q.clips,this._emitters=q.emitters,M.Assign(this._clips),M.Assign(this._emitters)}}loadSceneAsync(R,q){return b.LoadExtensionAsync(R,q,this.name,((L,B)=>{const N=new Array;N.push(this._loader.loadSceneAsync(R,q));for(const R of B.emitters){const q=M.Get(`${L}/emitters`,this._emitters,R);if(void 0!=q.refDistance||void 0!=q.maxDistance||void 0!=q.rolloffFactor||void 0!=q.distanceModel||void 0!=q.innerAngle||void 0!=q.outerAngle)throw new Error(`${L}: Direction or Distance properties are not allowed on emitters attached to a scene`);N.push(this._loadEmitterAsync(`${L}/emitters/${q.index}`,q))}return Promise.all(N).then((()=>{}))}))}loadNodeAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((R,B)=>{const h=new Array;return this._loader.loadNodeAsync(R,q,(q=>{for(const L of B.emitters){const B=M.Get(`${R}/emitters`,this._emitters,L);h.push(this._loadEmitterAsync(`${R}/emitters/${B.index}`,B).then((()=>{for(const R of B._babylonSounds)R.attachToMesh(q),void 0==B.innerAngle&&void 0==B.outerAngle||(R.setLocalDirectionToMesh(N.m.Forward()),R.setDirectionalCone(2*Z.f.ToDegrees(void 0==B.innerAngle?Math.PI:B.innerAngle),2*Z.f.ToDegrees(void 0==B.outerAngle?Math.PI:B.outerAngle),0))})))}L(q)})).then((R=>Promise.all(h).then((()=>R))))}))}loadAnimationAsync(R,q){return b.LoadExtensionAsync(R,q,this.name,((L,B)=>this._loader.loadAnimationAsync(R,q).then((N=>{const h=new Array;M.Assign(B.events);for(const Z of B.events)h.push(this._loadAnimationEventAsync(`${L}/events/${Z.index}`,R,q,Z,N));return Promise.all(h).then((()=>N))}))))}_loadClipAsync(R,q){if(q._objectURL)return q._objectURL;let L;if(q.uri)L=this._loader.loadUriAsync(R,q,q.uri);else{const B=M.Get(`${R}/bufferView`,this._loader.Ji.bufferViews,q.bufferView);L=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B)}return q._objectURL=L.then((R=>URL.createObjectURL(new Blob([R],{type:q.mimeType})))),q._objectURL}_loadEmitterAsync(R,q){if(q._babylonSounds=q._babylonSounds||[],!q._babylonData){const R=new Array,L=q.name||`emitter${q.index}`,B={loop:!1,autoplay:!1,volume:void 0==q.volume?1:q.volume};for(let h=0;h<q.clips.length;h++){const N=`/extensions/${this.name}/clips`,Z=M.Get(N,this._clips,q.clips[h].clip);R.push(this._loadClipAsync(`${N}/${q.clips[h].clip}`,Z).then((R=>{const N=q._babylonSounds[h]=new Gq(L,R,this._loader.babylonScene,null,B);N.refDistance=q.refDistance||1,N.maxDistance=q.maxDistance||256,N.rolloffFactor=q.rolloffFactor||1,N.distanceModel=q.distanceModel||"exponential"})))}const N=Promise.all(R).then((()=>{const R=q.clips.map((R=>R.weight||1)),L=new Wq(q.loop||!1,q._babylonSounds,R);q.innerAngle&&(L.directionalConeInnerAngle=2*Z.f.ToDegrees(q.innerAngle)),q.outerAngle&&(L.directionalConeOuterAngle=2*Z.f.ToDegrees(q.outerAngle)),q.volume&&(L.volume=q.volume),q._babylonData.sound=L}));q._babylonData={loaded:N}}return q._babylonData.loaded}_getEventAction(R,q,L,B,N){switch(L){case"play":return R=>{const L=(N||0)+(R-B);q.play(L)};case"stop":return()=>{q.stop()};case"pause":return()=>{q.pause()};default:throw new Error(`${R}: Unsupported action ${L}`)}}_loadAnimationEventAsync(R,q,L,B,N){if(0==N.targetedAnimations.length)return Promise.resolve();const h=N.targetedAnimations[0],Z=B.j,z=M.Get(`/extensions/${this.name}/emitters`,this._emitters,Z);return this._loadEmitterAsync(R,z).then((()=>{const q=z._babylonData.sound;if(q){const L=new mq(B.time,this._getEventAction(R,q,B.action,B.time,B.startOffset));h.animation.addEvent(L),N.onAnimationGroupEndObservable.add((()=>{q.stop()})),N.onAnimationGroupPauseObservable.add((()=>{q.pause()}))}}))}}s(gq),J(gq,!0,(R=>new Qq(R)));const iq="MSFT_lod";class kq{constructor(R){var q;this.name=iq,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new C.b,this.onMaterialLODsLoadedObservable=new C.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=R,this.maxLODsToLoad=(null===(q=this._loader.parent.extensionOptions[iq])||void 0===q?void 0:q.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(iq)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let R=0;R<this._nodePromiseLODs.length;R++){const q=Promise.all(this._nodePromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Node LOD ${R}`),this._loader.log(`Loaded node LOD ${R}`)),this.onNodeLODsLoadedObservable.notifyObservers(R),R!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${R+1}`),this._loadBufferLOD(this._nodeBufferLODs,R+1),this._nodeSignalLODs[R]&&this._nodeSignalLODs[R].resolve())}));this._loader._completePromises.push(q)}for(let R=0;R<this._materialPromiseLODs.length;R++){const q=Promise.all(this._materialPromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Material LOD ${R}`),this._loader.log(`Loaded material LOD ${R}`)),this.onMaterialLODsLoadedObservable.notifyObservers(R),R!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${R+1}`),this._loadBufferLOD(this._materialBufferLODs,R+1),this._materialSignalLODs[R]&&this._materialSignalLODs[R].resolve())}));this._loader._completePromises.push(q)}}loadSceneAsync(R,q){const L=this._loader.loadSceneAsync(R,q);return this._loadBufferLOD(this._bufferLODs,0),L}loadNodeAsync(R,q,L){return b.LoadExtensionAsync(R,q,this.name,((R,N)=>{let h;const Z=this._getLODs(R,q,this._loader.Ji.nodes,N.ids);this._loader.logOpen(`${R}`);for(let q=0;q<Z.length;q++){const R=Z[q];0!==q&&(this._nodeIndexLOD=q,this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new B);const N=R=>{L(R),R.xb(!1)},z=this._loader.loadNodeAsync(`/nodes/${R.index}`,R,N).then((R=>{if(0!==q){const R=Z[q-1];R._babylonTransformNode&&(this._disposeTransformNode(R._babylonTransformNode),delete R._babylonTransformNode)}return R.xb(!0),R}));this._nodePromiseLODs[q]=this._nodePromiseLODs[q]||[],0===q?h=z:(this._nodeIndexLOD=null,this._nodePromiseLODs[q].push(z))}return this._loader.logClose(),h}))}_loadMaterialAsync(R,q,L,B,N){return this._nodeIndexLOD?null:b.LoadExtensionAsync(R,q,this.name,((R,h)=>{let Z;const z=this._getLODs(R,q,this._loader.Ji.materials,h.ids);this._loader.logOpen(`${R}`);for(let q=0;q<z.length;q++){const R=z[q];0!==q&&(this._materialIndexLOD=q);const h=this._loader._loadMaterialAsync(`/materials/${R.index}`,R,L,B,(R=>{0===q&&N(R)})).then((R=>{if(0!==q){N(R);const L=z[q-1]._data;L[B]&&(this._disposeMaterials([L[B].babylonMaterial]),delete L[B])}return R}));this._materialPromiseLODs[q]=this._materialPromiseLODs[q]||[],0===q?Z=h:(this._materialIndexLOD=null,this._materialPromiseLODs[q].push(h))}return this._loader.logClose(),Z}))}_loadUriAsync(R,q,L){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const N=this._nodeIndexLOD-1;return this._nodeSignalLODs[N]=this._nodeSignalLODs[N]||new B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(R,q,L)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const N=this._materialIndexLOD-1;return this._materialSignalLODs[N]=this._materialSignalLODs[N]||new B,this._materialSignalLODs[N].promise.then((()=>this._loader.loadUriAsync(R,q,L)))}return null}loadBufferAsync(R,q,L,N){if(this._loader.parent.useRangeRequests&&!q.uri){if(!this._loader.bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);const q=(R,q)=>{const h=L,Z=h+N-1;let z=R[q];return z?(z.start=Math.min(z.start,h),z.end=Math.max(z.end,Z)):(z={start:h,end:Z,loaded:new B},R[q]=z),z.loaded.promise.then((R=>new Uint8Array(R.buffer,R.byteOffset+L-z.start,N)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?q(this._materialBufferLODs,this._materialIndexLOD):q(this._bufferLODs,0)}return null}_loadBufferLOD(R,q){const L=R[q];L&&(this._loader.log(`Loading buffer range [${L.start}-${L.end}]`),this._loader.bin.readAsync(L.start,L.end-L.start+1).then((R=>{L.loaded.resolve(R)}),(R=>{L.loaded.reject(R)})))}_getLODs(R,q,L,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const N=[];for(let h=B.length-1;h>=0;h--)if(N.push(M.Get(`${R}/ids/${B[h]}`,L,B[h])),N.length===this.maxLODsToLoad)return N;return N.push(q),N}_disposeTransformNode(R){const q=[],L=R.material;L&&q.push(L);for(const N of R.getChildMeshes())N.material&&q.push(N.material);R.dispose();const B=q.filter((R=>this._loader.babylonScene.meshes.every((q=>q.material!=R))));this._disposeMaterials(B)}_disposeMaterials(R){const q={};for(const L of R){for(const R of L.getActiveTextures())q[R.uniqueId]=R;L.dispose()}for(const L in q)for(const R of this._loader.babylonScene.materials)R.hasTexture(q[L])&&delete q[L];for(const L in q)q[L].dispose()}}s(iq),J(iq,!0,(R=>new kq(R)));const Vq="MSFT_minecraftMesh";class xq{constructor(R){this.name=Vq,this._loader=R,this.enabled=this._loader.isExtensionUsed(Vq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtraAsync(R,q,this.name,((B,N)=>{if(N){if(!(L instanceof I))throw new Error(`${B}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(R,q,L);return L.needAlphaBlending()&&(L.forceDepthWrite=!0,L.separateCullingPass=!0),L.Pg=L.forceDepthWrite,L.twoSidedLighting=!0,N}return null}))}}s(Vq),J(Vq,!0,(R=>new xq(R)));const wq="MSFT_sRGBFactors";class jq{constructor(R){this.name=wq,this._loader=R,this.enabled=this._loader.isExtensionUsed(wq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,q,L){return b.LoadExtraAsync(R,q,this.name,((B,N)=>{if(N){if(!(L instanceof I))throw new Error(`${B}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(R,q,L),h=L.va().getEngine().useExactSrgbConversions;return L.albedoTexture||L.albedoColor.toLinearSpaceToRef(L.albedoColor,h),L.reflectivityTexture||L.reflectivityColor.toLinearSpaceToRef(L.reflectivityColor,h),N}return null}))}}s(wq),J(wq,!0,(R=>new jq(R)));var Jq,sq=L(10898);!function(R){R[R.Input=0]="Input",R[R.Output=1]="Output"}(Jq||(Jq={}));class Aq{constructor(R,q,L){this._ownerBlock=L,this._connectedPoint=[],this.uniqueId=(0,sq.e)(),this.connectedPointIds=[],this.name=R,this._connectionType=q}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(R){if(this._connectionType===R._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||R._isSingularConnection()&&R._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(R),R._connectedPoint.push(this)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.uniqueId=this.uniqueId,R.name=this.name,R._connectionType=this._connectionType,R.connectedPointIds=[],R.className=this.getClassName();for(const q of this._connectedPoint)R.connectedPointIds.push(q.uniqueId)}getClassName(){return"FGConnection"}deserialize(R){this.uniqueId=R.uniqueId,this.name=R.name,this._connectionType=R._connectionType,this.connectedPointIds=R.connectedPointIds}static Parse(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1?arguments[1]:void 0;const L=new(Z.f.Instantiate(R.className))(R.name,R._connectionType,q);return L.deserialize(R),L}}class Mq{constructor(R){this.value=this._toInt(R)}_toInt(R){return 0|R}add(R){return new Mq(this.value+R.value)}Bc(R){return new Mq(this.value-R.value)}multiply(R){return new Mq(Math.imul(this.value,R.value))}divide(R){return new Mq(this.value/R.value)}getClassName(){return Mq.ClassName}equals(R){return this.value===R.value}static Parse(R){return new Mq(R.value)}}Mq.ClassName="FlowGraphInteger",(0,D.f)("FlowGraphInteger",Mq);class bq{constructor(R,q){this.typeName=R,this.defaultValue=q}serialize(R){R.typeName=this.typeName,R.defaultValue=this.defaultValue}static Parse(R){return new bq(R.typeName,R.defaultValue)}}const Xq=new bq("any",void 0),uq=(new bq("string",""),new bq("number",0)),RL=new bq("boolean",!1),qL=new bq("Vector2",N.i.Zero()),LL=new bq("o",N.m.Zero()),BL=(new bq("Vector4",N.q.Zero()),new bq("Matrix",N.c.Identity())),NL=(new bq("gb",h.e.Black()),new bq("ob",new h.g(0,0,0,0)),new bq("Quaternion",N.d.Identity()),new bq("FlowGraphInteger",new Mq(0)));class hL extends Aq{constructor(R,q,L,B){super(R,q,L),this.richType=B}_isSingularConnection(){return 0===this.connectionType}setValue(R,q){q._setConnectionValue(this,R)}connectTo(R){super.connectTo(R)}_getValueOrDefault(R){return R._hasConnectionValue(this)?R._getConnectionValue(this):this.richType.defaultValue}getValue(R){return 1===this.connectionType?(R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(R),this._getValueOrDefault(R)):this.isConnected()?this._connectedPoint[0].getValue(R):this._getValueOrDefault(R)}getClassName(){return"FGDataConnection"}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.richType={},this.richType.serialize(R.richType)}static Parse(R,q){const L=Aq.Parse(R,q);return L.richType=bq.Parse(R.richType),L}}function ZL(R){return"Mesh"===R||"AbstractMesh"===R||"GroundMesh"===R||"InstanceMesh"===R||"LinesMesh"===R||"GoldbergMesh"===R||"GreasedLineMesh"===R||"TrailMesh"===R}function zL(R){return"Vector2"===R||"o"===R||"Vector4"===R||"Quaternion"===R||"gb"===R||"ob"===R}function YL(R,q,L){var B;const N=(null===q||void 0===q||null===(B=q.getClassName)||void 0===B?void 0:B.call(q))??"";ZL(N)?L[R]={name:q.name,className:N}:zL(N)?L[R]={value:q.dj(),className:N}:L[R]=q}function FL(R,q,L){const B=q[R];let Z;const z=null===B||void 0===B?void 0:B.className;return Z=ZL(z)?L.getMeshByName(B.name):zL(z)?function(R,q){if("Vector2"===R)return N.i.Ig(q);if("o"===R)return N.m.Ig(q);if("Vector4"===R)return N.q.Ig(q);if("Quaternion"===R)return N.d.Ig(q);if("gb"===R)return new h.e(q[0],q[1],q[2]);if("ob"===R)return new h.g(q[0],q[1],q[2],q[3]);throw new Error(`Unknown vector class name ${R}`)}(z,B.value):"Matrix"===z?N.c.Ig(B.value):z===Mq.ClassName?Mq.Parse(B):B&&void 0!==B.value?B.value:B,Z}(0,D.f)("FGDataConnection",hL);class CL{constructor(R){var q;this.config=R,this.uniqueId=(0,sq.e)(),this.name=(null===(q=this.config)||void 0===q?void 0:q.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(R){}registerDataInput(R,q){const L=new hL(R,0,this,q);return this.dataInputs.push(L),L}registerDataOutput(R,q){const L=new hL(R,1,this,q);return this.dataOutputs.push(L),L}getDataInput(R){return this.dataInputs.find((q=>q.name===R))}getDataOutput(R){return this.dataOutputs.find((q=>q.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.uniqueId=this.uniqueId,R.config={},this.config&&(R.config.name=this.config.name),R.dataInputs=[],R.dataOutputs=[],R.className=this.getClassName();for(const q of this.dataInputs){const L={};q.serialize(L),R.dataInputs.push(L)}for(const q of this.dataOutputs){const L={};q.serialize(L),R.dataOutputs.push(L)}}getClassName(){return"FGBlock"}static Parse(R,q){const L=Z.f.Instantiate(R.className),B={},N=q.valueParseFunction??FL;if(R.config)for(const Z in R.config)B[Z]=N(Z,R.config,q.Nc);var h;("FGSetPropertyBlock"===(h=R.className)||"FGGetPropertyBlock"===h||"FGPlayAnimationBlock"===h||"FGMeshPickEventBlock"===h)&&(B.pathConverter=q.pathConverter);const z=new L(B);z.uniqueId=R.uniqueId;for(let Z=0;Z<R.dataInputs.length;Z++){const q=z.getDataInput(R.dataInputs[Z].name);if(!q)throw new Error("Could not find data input with name "+R.dataInputs[Z].name+" in block "+R.className);q.deserialize(R.dataInputs[Z])}for(let Z=0;Z<R.dataOutputs.length;Z++){const q=z.getDataOutput(R.dataOutputs[Z].name);if(!q)throw new Error("Could not find data output with name "+R.dataOutputs[Z].name+" in block "+R.className);q.deserialize(R.dataOutputs[Z])}return z.metadata=R.metadata,z.deserialize&&z.deserialize(R),z}}class eL extends Aq{_isSingularConnection(){return 1===this.connectionType}_activateSignal(R){var q;0===this.connectionType?(R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(R,this),R._increaseExecutionId()):null===(q=this._connectedPoint[0])||void 0===q||q._activateSignal(R)}}(0,D.f)("FlowGraphSignalConnection",eL);class yL extends CL{constructor(R){super(R),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(R){const q=new eL(R,0,this);return this.signalInputs.push(q),q}_registerSignalOutput(R){const q=new eL(R,1,this);return this.signalOutputs.push(q),q}getSignalInput(R){return this.signalInputs.find((q=>q.name===R))}getSignalOutput(R){return this.signalOutputs.find((q=>q.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.signalInputs=[],R.signalOutputs=[];for(const q of this.signalInputs){const L={};q.serialize(L),R.signalInputs.push(L)}for(const q of this.signalOutputs){const L={};q.serialize(L),R.signalOutputs.push(L)}}deserialize(R){for(let q=0;q<R.signalInputs.length;q++){const L=this.getSignalInput(R.signalInputs[q].name);if(!L)throw new Error("Could not find signal input with name "+R.signalInputs[q].name+" in block "+R.className);L.deserialize(R.signalInputs[q])}for(let q=0;q<R.signalOutputs.length;q++){const L=this.getSignalOutput(R.signalOutputs[q].name);if(!L)throw new Error("Could not find signal output with name "+R.signalOutputs[q].name+" in block "+R.className);L.deserialize(R.signalOutputs[q])}}getClassName(){return"FGExecutionBlock"}}class UL extends yL{constructor(R){super(R),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(R){this._preparePendingTasks(R),R._addPendingBlock(this)}}class nL extends UL{_execute(R){R._notifyExecuteNode(this),this.out._activateSignal(R)}}class rL{constructor(R){this.uniqueId=(0,sq.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new C.b,this._configuration=R}hasVariable(R){return R in this._userVariables}setVariable(R,q){this._userVariables[R]=q}getVariable(R){return this._userVariables[R]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(R,q){return`${R.uniqueId}_${q}`}_setExecutionVariable(R,q,L){this._executionVariables[this._getUniqueIdPrefixedName(R,q)]=L}_getExecutionVariable(R,q,L){return this._hasExecutionVariable(R,q)?this._executionVariables[this._getUniqueIdPrefixedName(R,q)]:L}_deleteExecutionVariable(R,q){delete this._executionVariables[this._getUniqueIdPrefixedName(R,q)]}_hasExecutionVariable(R,q){return this._getUniqueIdPrefixedName(R,q)in this._executionVariables}_hasConnectionValue(R){return R.uniqueId in this._connectionValues}_setConnectionValue(R,q){this._connectionValues[R.uniqueId]=q}_getConnectionValue(R){return this._connectionValues[R.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(R){this._pendingBlocks.push(R)}_removePendingBlock(R){const q=this._pendingBlocks.indexOf(R);-1!==q&&this._pendingBlocks.splice(q,1)}_clearPendingBlocks(){for(const R of this._pendingBlocks)R._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(R){this.onNodeExecutedObservable.notifyObservers(R)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:YL;R.uniqueId=this.uniqueId,R._userVariables={};for(const L in this._userVariables)q(L,this._userVariables[L],R._userVariables);R._connectionValues={};for(const L in this._connectionValues)q(L,this._connectionValues[L],R._connectionValues)}getClassName(){return"FGContext"}static Parse(R,q){const L=q.graph.createContext(),B=q.valueParseFunction??FL;L.uniqueId=R.uniqueId;for(const N in R._userVariables){const q=B(N,R._userVariables,L._configuration.Nc);L._userVariables[N]=q}for(const N in R._connectionValues){const q=B(N,R._connectionValues,L._configuration.Nc);L._connectionValues[N]=q}return L}}(0,f.d)([(0,v.K)()],rL.prototype,"uniqueId",void 0);var pL,cL,dL=L(11168);function fL(R,q){return!(!R.parent||R.parent!==q&&!fL(R.parent,q))}class vL extends nL{constructor(R){super(R),this.config=R}_getReferencedMesh(){const R=this.config.pathConverter.convert(this.config.path),q=R.info.getObject(R.object);if(!q||!(q instanceof G.c))throw new Error("Mesh pick event block requires a valid mesh");return q}_preparePendingTasks(R){let q=R._getExecutionVariable(this,"meshPickObserver");if(!q){const L=this._getReferencedMesh();R._setExecutionVariable(this,"mesh",L),q=L.va().onPointerObservable.add((q=>{var B,N,h;q.type===dL.e.POINTERPICK&&null!==(B=q.pickInfo)&&void 0!==B&&B.pickedMesh&&((null===(N=q.pickInfo)||void 0===N?void 0:N.pickedMesh)===L||fL(null===(h=q.pickInfo)||void 0===h?void 0:h.pickedMesh,L))&&this._execute(R)}));const B=L.ej.add((()=>this._onDispose));R._setExecutionVariable(this,"meshPickObserver",q),R._setExecutionVariable(this,"meshDisposeObserver",B)}}_onDispose(R){this._cancelPendingTasks(R),R._removePendingBlock(this)}_cancelPendingTasks(R){const q=R._getExecutionVariable(this,"mesh"),L=R._getExecutionVariable(this,"meshPickObserver"),B=R._getExecutionVariable(this,"meshDisposeObserver");q.va().onPointerObservable.remove(L),q.ej.remove(B),R._deleteExecutionVariable(this,"mesh"),R._deleteExecutionVariable(this,"meshPickObserver"),R._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return vL.ClassName}serialize(R){super.serialize(R),R.config.path=this.config.path}}vL.ClassName="FGMeshPickEventBlock",(0,D.f)(vL.ClassName,vL),function(R){R[R.Stopped=0]="Stopped",R[R.Started=1]="Started"}(pL||(pL={}));class TL{constructor(R){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=R.Nc,this._coordinator=R.coordinator,this._sceneDisposeObserver=this._scene.ej.add((()=>this.dispose()))}createContext(){const R=new rL({Nc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(R),R}getContext(R){return this._executionContexts[R]}addEventBlock(R){this._eventBlocks.push(R)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const R of this._executionContexts){const q=this._getContextualOrder();for(const L of q)L._startPendingTasks(R)}}}_getContextualOrder(){const R=[];for(const q of this._eventBlocks)if(q.getClassName()===vL.ClassName){const L=q._getReferencedMesh();let B=0;for(;B<R.length;B++){const q=R[B]._getReferencedMesh();if(L&&q&&fL(L,q))break}R.splice(B,0,q)}else R.push(q);return R}dispose(){if(0!==this.state){this.state=0;for(const R of this._executionContexts)R._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.ej.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(R){const q=[],L=new Set;for(const B of this._eventBlocks)q.push(B),L.add(B.uniqueId);for(;q.length>0;){const B=q.pop();R(B);for(const R of B.dataInputs)for(const B of R._connectedPoint)L.has(B._ownerBlock.uniqueId)||(q.push(B._ownerBlock),L.add(B._ownerBlock.uniqueId));if(B instanceof yL)for(const R of B.signalOutputs)for(const B of R._connectedPoint)L.has(B._ownerBlock.uniqueId)||(q.push(B._ownerBlock),L.add(B._ownerBlock.uniqueId))}}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1?arguments[1]:void 0;R.allBlocks=[],this.visitAllBlocks((q=>{const L={};q.serialize(L),R.allBlocks.push(L)})),R.executionContexts=[];for(const L of this._executionContexts){const B={};L.serialize(B,q),R.executionContexts.push(B)}}static GetDataOutConnectionByUniqueId(R,q){for(const L of R)for(const R of L.dataOutputs)if(R.uniqueId===q)return R;throw new Error("Could not find data out connection with unique id "+q)}static GetSignalInConnectionByUniqueId(R,q){for(const L of R)if(L instanceof yL)for(const R of L.signalInputs)if(R.uniqueId===q)return R;throw new Error("Could not find signal in connection with unique id "+q)}static Parse(R,q){const L=q.coordinator.createGraph(),B=[],N=q.valueParseFunction??FL;for(const h of R.allBlocks){const R=CL.Parse(h,{Nc:q.coordinator.config.Nc,pathConverter:q.pathConverter,valueParseFunction:N});B.push(R),R instanceof nL&&L.addEventBlock(R)}for(const h of B){for(const R of h.dataInputs)for(const q of R.connectedPointIds){const L=TL.GetDataOutConnectionByUniqueId(B,q);R.connectTo(L)}if(h instanceof yL)for(const R of h.signalOutputs)for(const q of R.connectedPointIds){const L=TL.GetSignalInConnectionByUniqueId(B,q);R.connectTo(L)}}for(const h of R.executionContexts)rL.Parse(h,{graph:L,valueParseFunction:N});return L}}class tL{constructor(R){this.config=R,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Nc.ej.add((()=>{this.dispose()}));(tL.SceneCoordinators.get(this.config.Nc)??[]).push(this)}createGraph(){const R=new TL({Nc:this.config.Nc,coordinator:this});return this._flowGraphs.push(R),R}removeGraph(R){const q=this._flowGraphs.indexOf(R);-1!==q&&(R.dispose(),this._flowGraphs.splice(q,1))}start(){this._flowGraphs.forEach((R=>R.start()))}dispose(){this._flowGraphs.forEach((R=>R.dispose())),this._flowGraphs.length=0;const R=tL.SceneCoordinators.get(this.config.Nc)??[],q=R.indexOf(this);-1!==q&&R.splice(q,1)}serialize(R,q){R._flowGraphs=[],this._flowGraphs.forEach((L=>{const B={};L.serialize(B,q),R._flowGraphs.push(B)}))}static Parse(R,q){var L;const B=q.valueParseFunction??FL,N=new tL({Nc:q.Nc});return null===(L=R._flowGraphs)||void 0===L||L.forEach((R=>{TL.Parse(R,{coordinator:N,valueParseFunction:B,pathConverter:q.pathConverter})})),N}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(R){let q=this._customEventsMap.get(R);return q||(q=new C.b,this._customEventsMap.set(R,q)),q}notifyCustomEvent(R,q){const L=this._customEventsMap.get(R);L&&L.notifyObservers(q)}}tL.SceneCoordinators=new Map;class DL extends nL{_preparePendingTasks(R){if(!R._getExecutionVariable(this,"sceneReadyObserver")){const q=R.configuration.Nc.onReadyObservable.add((()=>{this._execute(R)}));R._setExecutionVariable(this,"sceneReadyObserver",q)}}_cancelPendingTasks(R){const q=R._getExecutionVariable(this,"sceneReadyObserver");R.configuration.Nc.onReadyObservable.remove(q),R._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return DL.ClassName}}DL.ClassName="FGSceneReadyEventBlock",(0,D.f)("FGSceneReadyEventBlock",DL);class SL extends nL{_preparePendingTasks(R){if(!R._getExecutionVariable(this,"sceneBeforeRender")){const q=R.configuration.Nc.onBeforeRenderObservable.add((()=>{this._execute(R)}));R._setExecutionVariable(this,"sceneBeforeRender",q)}}_cancelPendingTasks(R){const q=R._getExecutionVariable(this,"sceneBeforeRender");R.configuration.Nc.onBeforeRenderObservable.remove(q),R._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return SL.ClassName}}SL.ClassName="FGSceneTickEventBlock",(0,D.f)(SL.ClassName,SL);class IL extends yL{constructor(R){super(R),this.out=this._registerSignalOutput("out")}}class KL extends IL{constructor(R){super(R),this.message=this.registerDataInput("message",Xq)}_execute(R){const q=this.message.getValue(R);r.d.Log(q),this.out._activateSignal(R)}getClassName(){return KL.ClassName}}KL.ClassName="FGConsoleLogBlock",(0,D.f)(KL.ClassName,KL),function(R){R[R.INIT=0]="INIT",R[R.STARTED=1]="STARTED",R[R.ENDED=2]="ENDED"}(cL||(cL={}));class mL{constructor(R){this.onEachCountObservable=new C.b,this.onTimerAbortedObservable=new C.b,this.onTimerEndedObservable=new C.b,this.onStateChangedObservable=new C.b,this._observer=null,this._breakOnNextTick=!1,this._tick=R=>{const q=Date.now();this._timer=q-this._startTime;const L={startTime:this._startTime,currentTime:q,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:R},B=this._breakOnNextTick||this._breakCondition(L);B||this._timer>=this._timeToEnd?this._stop(L,B):this.onEachCountObservable.notifyObservers(L)},this._setState(0),this._contextObservable=R.contextObservable,this._observableParameters=R.observableParameters??{},this._breakCondition=R.breakCondition??(()=>!1),this._timeToEnd=R.timeout,R.onEnded&&this.onTimerEndedObservable.add(R.onEnded),R.Zh&&this.onEachCountObservable.add(R.Zh),R.onAborted&&this.onTimerAbortedObservable.add(R.onAborted)}set breakCondition(R){this._breakCondition=R}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=R,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(R){this._state=R,this.onStateChangedObservable.notifyObservers(this._state)}_stop(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),q?this.onTimerAbortedObservable.notifyObservers(R):this.onTimerEndedObservable.notifyObservers(R)}}class oL extends UL{constructor(R){super(R),this.timeout=this.registerDataInput("timeout",uq)}_preparePendingTasks(R){const q=this.timeout.getValue(R);if(void 0!==q&&q>=0){const L=R._getExecutionVariable(this,"runningTimers")||[],B=R.configuration.Nc,N=new mL({timeout:q,contextObservable:B.onBeforeRenderObservable,onEnded:()=>this._onEnded(N,R)});N.start(),L.push(N),R._setExecutionVariable(this,"runningTimers",L)}}_execute(R){this._startPendingTasks(R),this.out._activateSignal(R)}_onEnded(R,q){const L=q._getExecutionVariable(this,"runningTimers")||[],B=L.indexOf(R);-1!==B?L.splice(B,1):Z.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),q._removePendingBlock(this),this.done._activateSignal(q)}_cancelPendingTasks(R){const q=R._getExecutionVariable(this,"runningTimers")||[];for(const L of q)L.dispose();R._deleteExecutionVariable(this,"runningTimers")}getClassName(){return oL.ClassName}}oL.ClassName="FGTimerBlock",(0,D.f)("FGTimerBlock",oL);class lL extends IL{constructor(R){super(R),this.config=R;for(let q=0;q<this.config.eventData.length;q++){const R=this.config.eventData[q];this.registerDataInput(R,Xq)}}_execute(R){const q=this.config.eventId,L=this.dataInputs.map((q=>q.getValue(R)));R.configuration.coordinator.notifyCustomEvent(q,L),this.out._activateSignal(R)}getClassName(){return lL.ClassName}}lL.ClassName="FGSendCustomEventBlock",(0,D.f)("FGSendCustomEventBlock",lL);class GL extends nL{constructor(R){super(R),this.config=R;for(let q=0;q<this.config.eventData.length;q++){const R=this.config.eventData[q];this.registerDataOutput(R,Xq)}}_preparePendingTasks(R){const q=R.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=q.add((q=>{for(let L=0;L<q.length;L++)this.dataOutputs[L].setValue(q[L],R);this._execute(R)}))}_cancelPendingTasks(R){const q=R.configuration.coordinator.getCustomEventObservable(this.config.eventId);q?q.remove(this._eventObserver):Z.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return GL.ClassName}serialize(R){super.serialize(R),R.eventId=this.config.eventId,R.eventData=this.config.eventData}}GL.ClassName="FGReceiveCustomEventBlock",(0,D.f)(GL.ClassName,GL);class WL extends yL{constructor(R){super(R),this.config=R,this.outFlows=[];for(let q=0;q<this.config.numberOutputFlows;q++)this.outFlows.push(this._registerSignalOutput(`${q}`))}_execute(R){for(let q=0;q<this.config.numberOutputFlows;q++)this.outFlows[q]._activateSignal(R)}getClassName(){return WL.ClassName}}WL.ClassName="FGSequenceBlock",(0,D.f)(WL.ClassName,WL);const HL=new RegExp(/\{(\w+)\}/g);class PL{constructor(R,q){this.path=R,this.ownerBlock=q,this.templatedInputs=[];let L=HL.exec(R);for(;L;){const[,B]=L;this.templatedInputs.push(q.registerDataInput(B,NL)),L=HL.exec(R)}}getAccessor(R,q){let L=this.path;for(const B of this.templatedInputs){const R=B.getValue(q).value;L=L.replace(`{${B.name}}`,R.toString())}return R.convert(L)}}class OL extends CL{constructor(R){super(R),this.config=R,this.value=this.registerDataOutput("value",Xq),this.templateComponent=new PL(R.path,this)}_updateOutputs(R){const q=this.templateComponent.getAccessor(this.config.pathConverter,R),L=q.info.get(q.object);this.value.setValue(L,R)}getClassName(){return OL.ClassName}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.config.path=this.config.path}}OL.ClassName="FGGetPropertyBlock",(0,D.f)(OL.ClassName,OL);class EL extends IL{constructor(R){super(R),this.config=R,this.a=this.registerDataInput("a",Xq),this.templateComponent=new PL(R.path,this)}_execute(R){const q=this.a.getValue(R),L=this.templateComponent.getAccessor(this.config.pathConverter,R);L.info.set(q,L.object),this.out._activateSignal(R)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.config.path=this.config.path}getClassName(){return EL.ClassName}}EL.ClassName="FGSetPropertyBlock",(0,D.f)("FGSetPropertyBlock",EL);const aL="cachedOperationValue",gL="cachedExecutionId";class QL extends CL{constructor(R,q){super(q),this.value=this.registerDataOutput("value",R)}_updateOutputs(R){const q=R._getExecutionVariable(this,gL),L=R._getExecutionVariable(this,aL);if(void 0!==L&&q===R.executionId)this.value.setValue(L,R);else{const q=this._doOperation(R);R._setExecutionVariable(this,aL,q),R._setExecutionVariable(this,gL,R.executionId),this.value.setValue(q,R)}}}class iL extends QL{constructor(R,q,L,B,N,h){super(L,h),this._operation=B,this._className=N,this.a=this.registerDataInput("a",R),this.b=this.registerDataInput("b",q)}_doOperation(R){return this._operation(this.a.getValue(R),this.b.getValue(R))}getClassName(){return this._className}}class kL extends QL{constructor(R,q,L,B){super(R,B),this._operation=q,this._className=L}_doOperation(R){return this._operation()}getClassName(){return this._className}}class VL extends QL{constructor(R,q,L,B,N){super(q,N),this._operation=L,this._className=B,this.a=this.registerDataInput("a",R)}_doOperation(R){return this._operation(this.a.getValue(R))}getClassName(){return this._className}}class xL extends QL{constructor(R,q,L,B,N,h,Z){super(B,Z),this._operation=N,this._className=h,this.a=this.registerDataInput("a",R),this.b=this.registerDataInput("b",q),this.c=this.registerDataInput("c",L)}_doOperation(R){return this._operation(this.a.getValue(R),this.b.getValue(R),this.c.getValue(R))}getClassName(){return this._className}}function wL(R){return R.getClassName?R.getClassName():""}function jL(R,q){return"Vector2"===R&&"Vector2"===q||"o"===R&&"o"===q||"Vector4"===R&&"Vector4"===q}function JL(R,q){return"Matrix"===R&&"Matrix"===q}function sL(R,q){return"FlowGraphInteger"===R&&"FlowGraphInteger"===q}class AL extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicAdd(R,q)),AL.ClassName,R)}_polymorphicAdd(R,q){const L=wL(R),B=wL(q);return jL(L,B)||JL(L,B)||sL(L,B)?R.add(q):R+q}}AL.ClassName="FGAddBlock",(0,D.f)(AL.ClassName,AL);class ML extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicAdd(R,q)),ML.ClassName,R)}_polymorphicAdd(R,q){const L=wL(R),B=wL(q);return jL(L,B)||sL(L,B)?R.Bc(q):JL(L,B)?R.add(q.scale(-1)):R-q}}ML.ClassName="FGSubBlock",(0,D.f)(ML.ClassName,ML);class bL extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicMultiply(R,q)),bL.ClassName,R)}_polymorphicMultiply(R,q){const L=wL(R),B=wL(q);return jL(L,B)||sL(L,B)?R.multiply(q):JL(L,B)?N.c.FromValues(R.m[0]*q.m[0],R.m[4]*q.m[4],R.m[8]*q.m[8],R.m[12]*q.m[12],R.m[1]*q.m[1],R.m[5]*q.m[5],R.m[9]*q.m[9],R.m[13]*q.m[13],R.m[2]*q.m[2],R.m[6]*q.m[6],R.m[10]*q.m[10],R.m[14]*q.m[14],R.m[3]*q.m[3],R.m[7]*q.m[7],R.m[11]*q.m[11],R.m[15]*q.m[15]):R*q}}bL.ClassName="FGMultiplyBlock",(0,D.f)(bL.ClassName,bL);class XL extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicDivide(R,q)),XL.ClassName,R)}_polymorphicDivide(R,q){const L=wL(R),B=wL(q);return jL(L,B)||sL(L,B)?R.divide(q):JL(L,B)?N.c.FromValues(R.m[0]/q.m[0],R.m[4]/q.m[4],R.m[8]/q.m[8],R.m[12]/q.m[12],R.m[1]/q.m[1],R.m[5]/q.m[5],R.m[9]/q.m[9],R.m[13]/q.m[13],R.m[2]/q.m[2],R.m[6]/q.m[6],R.m[10]/q.m[10],R.m[14]/q.m[14],R.m[3]/q.m[3],R.m[7]/q.m[7],R.m[11]/q.m[11],R.m[15]/q.m[15]):R/q}}XL.ClassName="FGDivideBlock",(0,D.f)(XL.ClassName,XL);class uL extends kL{constructor(R){super(uq,(()=>Math.random()),uL.ClassName,R)}}uL.ClassName="FGRandomBlock",(0,D.f)(uL.ClassName,uL);class RB extends iL{constructor(R){super(Xq,Xq,uq,((R,q)=>this._polymorphicDot(R,q)),RB.ClassName,R)}_polymorphicDot(R,q){switch(wL(R)){case"Vector2":return N.i.Dot(R,q);case"o":return N.m.Dot(R,q);case"Vector4":return N.q.Dot(R,q);default:throw new Error(`Cannot get dot product of ${R} and ${q}`)}}}RB.ClassName="FGDotBlock",(0,D.f)(RB.ClassName,RB);class qB extends kL{constructor(R){super(uq,(()=>Math.E),qB.ClassName,R)}}qB.ClassName="FGEBlock",(0,D.f)(qB.ClassName,qB);class LB extends kL{constructor(R){super(uq,(()=>Math.PI),LB.ClassName,R)}}LB.ClassName="FGPIBlock",(0,D.f)(LB.ClassName,LB);class BB extends kL{constructor(R){super(uq,(()=>Number.POSITIVE_INFINITY),BB.ClassName,R)}}BB.ClassName="FGInfBlock",(0,D.f)(BB.ClassName,BB);class NB extends kL{constructor(R){super(uq,(()=>Number.NaN),NB.ClassName,R)}}function hB(R,q){switch(wL(R)){case"FlowGraphInteger":return new Mq(q(R.value));case"Vector2":return new N.i(q(R.x),q(R.y));case"o":return new N.m(q(R.x),q(R.y),q(R.z));case"Vector4":return new N.q(q(R.x),q(R.y),q(R.z),q(R.w));case"Matrix":return N.c.FromValues(q(R.m[0]),q(R.m[4]),q(R.m[8]),q(R.m[12]),q(R.m[1]),q(R.m[5]),q(R.m[9]),q(R.m[13]),q(R.m[2]),q(R.m[6]),q(R.m[10]),q(R.m[14]),q(R.m[3]),q(R.m[7]),q(R.m[11]),q(R.m[15]));default:return q(R)}}NB.ClassName="FGNaNBlock",(0,D.f)(NB.ClassName,NB);class ZB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicAbs(R)),ZB.ClassName,R)}_polymorphicAbs(R){return hB(R,Math.abs)}}ZB.ClassName="FGAbsBlock",(0,D.f)(ZB.ClassName,ZB);class zB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicSign(R)),zB.ClassName,R)}_polymorphicSign(R){return hB(R,Math.sign)}}zB.ClassName="FGSignBlock",(0,D.f)(zB.ClassName,zB);class YB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicTrunc(R)),YB.ClassName,R)}_polymorphicTrunc(R){return hB(R,Math.trunc)}}YB.ClassName="FGTruncBlock",(0,D.f)(YB.ClassName,YB);class FB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicFloor(R)),FB.ClassName,R)}_polymorphicFloor(R){return hB(R,Math.floor)}}FB.ClassName="FGFloorBlock",(0,D.f)(FB.ClassName,FB);class CB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicCeiling(R)),CB.ClassName,R)}_polymorphicCeiling(R){return hB(R,Math.ceil)}}CB.ClassName="FGCeilBlock",(0,D.f)(CB.ClassName,CB);class eB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicFract(R)),eB.ClassName,R)}_polymorphicFract(R){return hB(R,(R=>R-Math.floor(R)))}}eB.ClassName="FGFractBlock",(0,D.f)(eB.ClassName,eB);class yB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicNeg(R)),yB.ClassName,R)}_polymorphicNeg(R){return hB(R,(R=>-R))}}function UB(R,q,L){switch(wL(R)){case"FlowGraphInteger":return new Mq(L(R.value,q.value));case"Vector2":return new N.i(L(R.x,q.x),L(R.y,q.y));case"o":return new N.m(L(R.x,q.x),L(R.y,q.y),L(R.z,q.z));case"Vector4":return new N.q(L(R.x,q.x),L(R.y,q.y),L(R.z,q.z),L(R.w,q.w));case"Matrix":return N.c.FromValues(L(R.m[0],q.m[0]),L(R.m[4],q.m[4]),L(R.m[8],q.m[8]),L(R.m[12],q.m[12]),L(R.m[1],q.m[1]),L(R.m[5],q.m[5]),L(R.m[9],q.m[9]),L(R.m[13],q.m[13]),L(R.m[2],q.m[2]),L(R.m[6],q.m[6]),L(R.m[10],q.m[10]),L(R.m[14],q.m[14]),L(R.m[3],q.m[3]),L(R.m[7],q.m[7]),L(R.m[11],q.m[11]),L(R.m[15],q.m[15]));default:return L(R,q)}}yB.ClassName="FGNegBlock",(0,D.f)(yB.ClassName,yB);class nB extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicRemainder(R,q)),nB.ClassName,R)}_polymorphicRemainder(R,q){return UB(R,q,((R,q)=>R%q))}}nB.ClassName="FGRemainderBlock",(0,D.f)(nB.ClassName,nB);class rB extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicMin(R,q)),rB.ClassName,R)}_polymorphicMin(R,q){return UB(R,q,Math.min)}}rB.ClassName="FGMinBlock",(0,D.f)(rB.ClassName,rB);class pB extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicMax(R,q)),pB.ClassName,R)}_polymorphicMax(R,q){return UB(R,q,Math.max)}}function cB(R,q,L){return Math.min(Math.max(R,Math.min(q,L)),Math.max(q,L))}function dB(R,q,L,B){switch(wL(R)){case"FlowGraphInteger":return new Mq(B(R.value,q.value,L.value));case"Vector2":return new N.i(B(R.x,q.x,L.x),B(R.y,q.y,L.y));case"o":return new N.m(B(R.x,q.x,L.x),B(R.y,q.y,L.y),B(R.z,q.z,L.z));case"Vector4":return new N.q(B(R.x,q.x,L.x),B(R.y,q.y,L.y),B(R.z,q.z,L.z),B(R.w,q.w,L.w));case"Matrix":return N.c.FromValues(B(R.m[0],q.m[0],L.m[0]),B(R.m[4],q.m[4],L.m[4]),B(R.m[8],q.m[8],L.m[8]),B(R.m[12],q.m[12],L.m[12]),B(R.m[1],q.m[1],L.m[1]),B(R.m[5],q.m[5],L.m[5]),B(R.m[9],q.m[9],L.m[9]),B(R.m[13],q.m[13],L.m[13]),B(R.m[2],q.m[2],L.m[2]),B(R.m[6],q.m[6],L.m[6]),B(R.m[10],q.m[10],L.m[10]),B(R.m[14],q.m[14],L.m[14]),B(R.m[3],q.m[3],L.m[3]),B(R.m[7],q.m[7],L.m[7]),B(R.m[11],q.m[11],L.m[11]),B(R.m[15],q.m[15],L.m[15]));default:return B(R,q,L)}}pB.ClassName="FGMaxBlock",(0,D.f)(pB.ClassName,pB);class fB extends xL{constructor(R){super(Xq,Xq,Xq,Xq,((R,q,L)=>this._polymorphicClamp(R,q,L)),fB.ClassName,R)}_polymorphicClamp(R,q,L){return dB(R,q,L,cB)}}function vB(R){return Math.min(Math.max(R,0),1)}fB.ClassName="FGClampBlock",(0,D.f)(fB.ClassName,fB);class TB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicSaturate(R)),TB.ClassName,R)}_polymorphicSaturate(R){return hB(R,vB)}}TB.ClassName="FGSaturateBlock",(0,D.f)(TB.ClassName,TB);class tB extends xL{constructor(R){super(Xq,Xq,Xq,Xq,((R,q,L)=>this._polymorphicInterpolate(R,q,L)),tB.ClassName,R)}_interpolate(R,q,L){return(1-L)*R+L*q}_polymorphicInterpolate(R,q,L){return dB(R,q,L,this._interpolate)}}tB.ClassName="FGInterpolateBlock",(0,D.f)(tB.ClassName,tB);class DB extends iL{constructor(R){super(Xq,Xq,RL,((R,q)=>this._polymorphicEq(R,q)),DB.ClassName,R)}_polymorphicEq(R,q){const L=wL(R),B=wL(q);return jL(L,B)||JL(L,B)||sL(L,B)?R.equals(q):R===q}}function SB(R,q,L){const B=wL(R);if(B===wL(q)){if(""===B)return L(R,q);if("FlowGraphInteger"===B)return L(R.value,q.value);throw new Error(`Cannot compare ${R} and ${q}`)}throw new Error(`${R} and ${q} are of different types.`)}DB.ClassName="FGEqBlock",(0,D.f)(DB.ClassName,DB);class IB extends iL{constructor(R){super(Xq,Xq,RL,((R,q)=>this._polymorphicLessThan(R,q)),IB.ClassName,R)}_polymorphicLessThan(R,q){return SB(R,q,((R,q)=>R<q))}}IB.ClassName="FGLessThanBlock",(0,D.f)(IB.ClassName,IB);class KB extends iL{constructor(R){super(Xq,Xq,RL,((R,q)=>this._polymorphicLessThanOrEqual(R,q)),KB.ClassName,R)}_polymorphicLessThanOrEqual(R,q){return SB(R,q,((R,q)=>R<=q))}}KB.ClassName="FGLessThanOrEqualBlock";class mB extends iL{constructor(R){super(Xq,Xq,RL,((R,q)=>this._polymorphicGreaterThan(R,q)),mB.ClassName,R)}_polymorphicGreaterThan(R,q){return SB(R,q,((R,q)=>R>q))}}mB.ClassName="FGGreaterThanBlock",(0,D.f)(mB.ClassName,mB);class oB extends iL{constructor(R){super(Xq,Xq,RL,((R,q)=>this._polymorphicGreaterThanOrEqual(R,q)),oB.ClassName,R)}_polymorphicGreaterThanOrEqual(R,q){return SB(R,q,((R,q)=>R>=q))}}oB.ClassName="FGGreaterThanOrEqualBlock",(0,D.f)(oB.ClassName,oB);class lB extends VL{constructor(R){super(Xq,RL,(R=>this._polymorphicIsNan(R)),lB.ClassName,R)}_polymorphicIsNan(R){const q=wL(R);if(""===q)return isNaN(R);if("FlowGraphInteger"===q)return isNaN(R.value);throw new Error(`Cannot get NaN of ${R}`)}}lB.ClassName="FGIsNanBlock",(0,D.f)(lB.ClassName,lB);class GB extends VL{constructor(R){super(Xq,RL,(R=>this._polymorphicIsInf(R)),GB.ClassName,R)}_polymorphicIsInf(R){const q=wL(R);if(""===q)return!isFinite(R);if("FlowGraphInteger"===q)return!isFinite(R.value);throw new Error(`Cannot get isInf of ${R}`)}}GB.ClassName="FGIsInfBlock";class WB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicDegToRad(R)),WB.ClassName,R)}_degToRad(R){return R*Math.PI/180}_polymorphicDegToRad(R){return hB(R,this._degToRad)}}WB.ClassName="FGDegToRadBlock",(0,D.f)(WB.ClassName,WB);class HB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicRadToDeg(R)),HB.ClassName,R)}_radToDeg(R){return 180*R/Math.PI}_polymorphicRadToDeg(R){return hB(R,this._radToDeg)}}HB.ClassName="FGRadToDegBlock",(0,D.f)(HB.ClassName,HB);class PB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicSin(R)),PB.ClassName,R)}_polymorphicSin(R){return hB(R,Math.sin)}}PB.ClassName="FGSinBlock",(0,D.f)(PB.ClassName,PB);class OB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicCos(R)),OB.ClassName,R)}_polymorphicCos(R){return hB(R,Math.cos)}}OB.ClassName="FGCosBlock",(0,D.f)(OB.ClassName,OB);class EB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicTan(R)),EB.ClassName,R)}_polymorphicTan(R){return hB(R,Math.tan)}}EB.ClassName="FGTanBlock",(0,D.f)(EB.ClassName,EB);class aB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicAsin(R)),aB.ClassName,R)}_polymorphicAsin(R){return hB(R,Math.asin)}}aB.ClassName="FGAsinBlock",(0,D.f)(aB.ClassName,aB);class gB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicAcos(R)),gB.ClassName,R)}_polymorphicAcos(R){return hB(R,Math.acos)}}gB.ClassName="FGAcosBlock",(0,D.f)(gB.ClassName,gB);class QB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicAtan(R)),QB.ClassName,R)}_polymorphicAtan(R){return hB(R,Math.atan)}}QB.ClassName="FGAtanBlock",(0,D.f)(QB.ClassName,QB);class iB extends iL{constructor(R){super(Xq,Xq,Xq,((R,q)=>this._polymorphicAtan2(R,q)),iB.ClassName,R)}_polymorphicAtan2(R,q){return UB(R,q,Math.atan2)}}iB.ClassName="FGAtan2Block",(0,D.f)(iB.ClassName,iB);class kB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicSinh(R)),kB.ClassName,R)}_polymorphicSinh(R){return hB(R,Math.sinh)}}kB.ClassName="FGSinhBlock",(0,D.f)(kB.ClassName,kB);class VB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicCosh(R)),VB.ClassName,R)}_polymorphicCosh(R){return hB(R,Math.cosh)}}VB.ClassName="FGCoshBlock",(0,D.f)(VB.ClassName,VB);class xB extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicTanh(R)),xB.ClassName,R)}_polymorphicTanh(R){return hB(R,Math.tanh)}}xB.ClassName="FGTanhBlock",(0,D.f)(xB.ClassName,xB);class wB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicAsinh(R)),wB.ClassName,R)}_polymorphicAsinh(R){return hB(R,Math.asinh)}}wB.ClassName="FGAsinhBlock",(0,D.f)(wB.ClassName,wB);class jB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicAcosh(R)),jB.ClassName,R)}_polymorphicAcosh(R){return hB(R,Math.acosh)}}jB.ClassName="FGAcoshBlock",(0,D.f)(jB.ClassName,jB);class JB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicAtanh(R)),JB.ClassName,R)}_polymorphicAtanh(R){return hB(R,Math.atanh)}}JB.ClassName="FGAtanhBlock",(0,D.f)(JB.ClassName,JB);class sB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicExp(R)),sB.ClassName,R)}_polymorphicExp(R){return hB(R,Math.exp)}}sB.ClassName="FGExpBlock",(0,D.f)(sB.ClassName,sB);class AB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicLog(R)),AB.ClassName,R)}_polymorphicLog(R){return hB(R,Math.log)}}AB.ClassName="FGLogBlock",(0,D.f)(AB.ClassName,AB);class MB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicLog2(R)),MB.ClassName,R)}_polymorphicLog2(R){return hB(R,Math.log2)}}MB.ClassName="FGLog2Block",(0,D.f)(MB.ClassName,MB);class bB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicLog10(R)),bB.ClassName,R)}_polymorphicLog10(R){return hB(R,Math.log10)}}bB.ClassName="FGLog10Block",(0,D.f)(bB.ClassName,bB);class XB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicSqrt(R)),XB.ClassName,R)}_polymorphicSqrt(R){return hB(R,Math.sqrt)}}XB.ClassName="FGSqrtBlock",(0,D.f)(XB.ClassName,XB);class uB extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicCubeRoot(R)),uB.ClassName,R)}_polymorphicCubeRoot(R){return hB(R,Math.cbrt)}}uB.ClassName="FGCubeRootBlock",(0,D.f)(uB.ClassName,uB);class RN extends iL{constructor(R){super(Xq,uq,uq,((R,q)=>this._polymorphicPow(R,q)),RN.ClassName,R)}_polymorphicPow(R,q){return UB(R,q,Math.pow)}}RN.ClassName="FGPowBlock",(0,D.f)(RN.ClassName,RN);class qN extends VL{constructor(R){super(Xq,uq,(R=>this._polymorphicLength(R)),qN.ClassName,R)}_polymorphicLength(R){switch(wL(R)){case"Vector2":case"o":case"Vector4":return R.length();default:throw new Error(`Cannot compute length of value ${R}`)}}}qN.ClassName="FGLengthBlock",(0,D.f)(qN.ClassName,qN);class LN extends VL{constructor(R){super(Xq,Xq,(R=>this._polymorphicNormalize(R)),LN.ClassName,R)}_polymorphicNormalize(R){switch(wL(R)){case"Vector2":case"o":case"Vector4":return R.normalize();default:throw new Error(`Cannot normalize value ${R}`)}}}LN.ClassName="FGNormalizeBlock",(0,D.f)(LN.ClassName,LN);class BN extends iL{constructor(R){super(LL,LL,LL,((R,q)=>N.m.Cross(R,q)),BN.ClassName,R)}}BN.ClassName="FGCrossBlock",(0,D.f)(BN.ClassName,BN);class NN extends iL{constructor(R){super(qL,uq,qL,((R,q)=>N.i.Transform(R,N.c.RotationZ(q))),NN.ClassName,R)}}NN.ClassName="FGRotate2DBlock",(0,D.f)(NN.ClassName,NN);class hN extends xL{constructor(R){super(LL,LL,uq,LL,((R,q,L)=>N.m.TransformCoordinates(R,N.c.RotationAxis(q,L))),hN.ClassName,R)}}hN.ClassName="FGRotate3DBlock",(0,D.f)(hN.ClassName,hN);class ZN extends VL{constructor(R){super(BL,BL,(R=>N.c.Transpose(R)),ZN.ClassName,R)}}ZN.ClassName="FGTransposeBlock",(0,D.f)(ZN.ClassName,ZN);class zN extends VL{constructor(R){super(BL,uq,(R=>R.determinant()),zN.ClassName,R)}}zN.ClassName="FGDeterminantBlock",(0,D.f)(zN.ClassName,zN);class YN extends VL{constructor(R){super(BL,BL,(R=>N.c.Invert(R)),YN.ClassName,R)}}YN.ClassName="FGInvertMatrixBlock",(0,D.f)(YN.ClassName,YN);class FN extends iL{constructor(R){super(BL,BL,BL,((R,q)=>q.multiply(R)),FN.ClassName,R)}}FN.ClassName="FGMatMulBlock",(0,D.f)(FN.ClassName,FN);class CN extends VL{constructor(R){super(NL,NL,(R=>new Mq(~R.value)),CN.ClassName,R)}}CN.ClassName="FGBitwiseNotBlock",(0,D.f)(CN.ClassName,CN);class eN extends iL{constructor(R){super(NL,NL,NL,((R,q)=>new Mq(R.value&q.value)),eN.ClassName,R)}}eN.ClassName="FGBitwiseAndBlock",(0,D.f)(eN.ClassName,eN);class yN extends iL{constructor(R){super(NL,NL,NL,((R,q)=>new Mq(R.value|q.value)),yN.ClassName,R)}}yN.ClassName="FGBitwiseOrBlock",(0,D.f)(yN.ClassName,yN);class UN extends iL{constructor(R){super(NL,NL,NL,((R,q)=>new Mq(R.value^q.value)),UN.ClassName,R)}}UN.ClassName="FGBitwiseXorBlock",(0,D.f)(UN.ClassName,UN);class nN extends iL{constructor(R){super(NL,NL,NL,((R,q)=>new Mq(R.value<<q.value)),nN.ClassName,R)}}nN.ClassName="FGBitwiseLeftShiftBlock",(0,D.f)(nN.ClassName,nN);class rN extends iL{constructor(R){super(NL,NL,NL,((R,q)=>new Mq(R.value>>q.value)),rN.ClassName,R)}}rN.ClassName="FGBitwiseRightShiftBlock",(0,D.f)(rN.ClassName,rN);class pN extends VL{constructor(R){super(NL,NL,(R=>new Mq(Math.clz32(R.value))),pN.ClassName,R)}}pN.ClassName="FGCountLeadingZerosBlock",(0,D.f)(pN.ClassName,pN);class cN extends VL{constructor(R){super(NL,NL,(R=>new Mq(R.value?31-Math.clz32(R.value&-R.value):32)),cN.ClassName,R)}}cN.ClassName="FGCountTrailingZerosBlock",(0,D.f)(cN.ClassName,cN);class dN extends VL{constructor(R){super(NL,NL,(R=>new Mq(function(R){let q=0;for(;R;)q+=1&R,R>>=1;return q}(R.value))),dN.ClassName,R)}}dN.ClassName="FGCountOneBitsBlock",(0,D.f)(dN.ClassName,dN);class fN extends IL{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Mq(0)};super(R),this.config=R,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",NL),this.value=this.registerDataOutput("value",NL)}_execute(R,q){if(q===this.reset)this.value.setValue(this.config.startIndex,R);else{const q=this.value.getValue(R);q.value<this.n.getValue(R).value&&(this.value.setValue(new Mq(q.value+1),R),this.out._activateSignal(R))}}getClassName(){return fN.ClassName}}fN.ClassName="FGDoNBlock",(0,D.f)(fN.ClassName,fN);class vN extends CL{constructor(R){super(R),this.config=R,this.output=this.registerDataOutput(R.variableName,Xq)}_updateOutputs(R){const q=this.config.variableName;R.hasVariable(q)&&this.output.setValue(R.getVariable(q),R)}getClassName(){return vN.ClassName}serialize(R){super.serialize(R),R.config.variableName=this.config.variableName}}vN.ClassName="FGGetVariableBlock",(0,D.f)(vN.ClassName,vN);class TN extends IL{constructor(R){super(R),this.config=R,this.input=this.registerDataInput(R.variableName,Xq)}_execute(R){const q=this.config.variableName,L=this.input.getValue(R);R.setVariable(q,L),this.out._activateSignal(R)}getClassName(){return TN.ClassName}}TN.ClassName="FGSetVariableBlock",(0,D.f)(TN.ClassName,TN);class tN extends IL{constructor(R){super(R),this.config=R,this.condition=this.registerDataInput("condition",RL),this.loopBody=this._registerSignalOutput("loopBody")}_execute(R,q){var L;let B=this.condition.getValue(R);for(null!==(L=this.config)&&void 0!==L&&L.isDo&&!B&&this.loopBody._activateSignal(R);B;)this.loopBody._activateSignal(R),B=this.condition.getValue(R);this.out._activateSignal(R)}getClassName(){return tN.ClassName}serialize(R){var q;super.serialize(R),R.isDo=null===(q=this.config)||void 0===q?void 0:q.isDo}}tN.ClassName="FGWhileLoopBlock",(0,D.f)(tN.ClassName,tN);const DN={"lifecycle/onStart":DL.ClassName,"lifecycle/onTick":SL.ClassName,log:KL.ClassName,"flow/delay":oL.ClassName,"customEvent/send":lL.ClassName,"customEvent/receive":GL.ClassName,"flow/sequence":WL.ClassName,"world/get":OL.ClassName,"world/set":EL.ClassName,"flow/doN":fN.ClassName,"variable/get":vN.ClassName,"variable/set":TN.ClassName,"flow/whileLoop":tN.ClassName,"math/random":uL.ClassName,"math/e":qB.ClassName,"math/pi":LB.ClassName,"math/inf":BB.ClassName,"math/nan":NB.ClassName,"math/abs":ZB.ClassName,"math/sign":zB.ClassName,"math/trunc":YB.ClassName,"math/floor":FB.ClassName,"math/ceil":CB.ClassName,"math/fract":eB.ClassName,"math/neg":yB.ClassName,"math/add":AL.ClassName,"math/sub":ML.ClassName,"math/mul":bL.ClassName,"math/div":XL.ClassName,"math/rem":nB.ClassName,"math/min":rB.ClassName,"math/max":pB.ClassName,"math/clamp":fB.ClassName,"math/saturate":TB.ClassName,"math/mix":tB.ClassName,"math/eq":DB.ClassName,"math/lt":IB.ClassName,"math/le":KB.ClassName,"math/gt":mB.ClassName,"math/ge":oB.ClassName,"math/isnan":lB.ClassName,"math/isinf":GB.ClassName,"math/rad":WB.ClassName,"math/deg":HB.ClassName,"math/sin":PB.ClassName,"math/cos":OB.ClassName,"math/tan":EB.ClassName,"math/asin":aB.ClassName,"math/acos":gB.ClassName,"math/atan":QB.ClassName,"math/atan2":iB.ClassName,"math/sinh":kB.ClassName,"math/cosh":VB.ClassName,"math/tanh":xB.ClassName,"math/asinh":wB.ClassName,"math/acosh":jB.ClassName,"math/atanh":JB.ClassName,"math/exp":sB.ClassName,"math/log":AB.ClassName,"math/log2":MB.ClassName,"math/log10":bB.ClassName,"math/sqrt":XB.ClassName,"math/cbrt":uB.ClassName,"math/pow":RN.ClassName,"math/length":qN.ClassName,"math/normalize":LN.ClassName,"math/dot":RB.ClassName,"math/cross":BN.ClassName,"math/rotate2d":NN.ClassName,"math/rotate3d":hN.ClassName,"math/transpose":ZN.ClassName,"math/determinant":zN.ClassName,"math/inverse":YN.ClassName,"math/matmul":FN.ClassName,"math/not":CN.ClassName,"math/and":eN.ClassName,"math/or":yN.ClassName,"math/xor":UN.ClassName,"math/asr":rN.ClassName,"math/lsl":nN.ClassName,"math/clz":pN.ClassName,"math/ctz":cN.ClassName,"math/popcnt":dN.ClassName},SN={float2:"Vector2",float3:"o",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function IN(R,q,L){if(void 0!==R.type){const B=q.types&&q.types[R.type];if(!B)throw new Error(`${L}: Unknown type: ${R.type}`);const N=B.signature;if(!N)throw new Error(`${L}: Type ${R.type} has no signature`);const h=SN[N];return{value:R.value,className:h}}return R.value}function KN(R,q,L){const B=DN[q.type];if(!B)throw new Error(`/extensions/KHR_interactivity/nodes/${R}: Unknown block type: ${q.type}`);const N=R.toString(),h=function(R,q,L){const B={},N=R.configuration??[];for(const h of N)if("customEvent"===h.id){const R=q.customEvents&&q.customEvents[h.value];if(!R)throw new Error(`/extensions/KHR_interactivity/nodes/${L}: Unknown custom event: ${h.value}`);B.eventId=R.id,B.eventData=R.values.map((R=>R.id))}else if("variable"===h.id){const R=q.variables&&q.variables[h.value];if(!R)throw new Error(`/extensions/KHR_interactivity/nodes/${L}: Unknown variable: ${h.value}`);B.variableName=R.id}else if("path"===h.id){const R=h.value;B.path=R}else B[h.id]=IN(h,q,`/extensions/KHR_interactivity/nodes/${L}`);return B}(q,L,N);return{className:B,config:h,uniqueId:N,metadata:q.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class mN extends Dq{constructor(R){super(R,lN)}}const oN={__array__:{__target__:!0,translation:{type:"o",get:R=>R._babylonTransformNode.position,set:(R,q)=>{q._babylonTransformNode.position=R},getObject:R=>R._babylonTransformNode}}},lN={nodes:oN},GN="KHR_interactivity";class WN{constructor(R){this._loader=R,this.name=GN,this.enabled=this._loader.isExtensionUsed(GN),this._pathConverter=new mN(this._loader.Ji)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var R;if(!this._loader.babylonScene||!this._pathConverter)return;const q=this._loader.babylonScene,L=function(R){const q={uniqueId:(0,sq.e)(),_userVariables:{},_connectionValues:{}},L=[q],B=[];for(let h=0;h<R.nodes.length;h++){const q=KN(h,R.nodes[h],R);B.push(q)}for(let h=0;h<R.nodes.length;h++){const L=R.nodes[h],N=B[h],Z=L.flows??[];for(const R of Z){const q=R.id,L={uniqueId:(0,sq.e)(),name:q,_connectionType:1,connectedPointIds:[]};N.signalOutputs.push(L);const Z=R.node,z=R.socket,Y=B[Z];if(!Y)throw new Error(`/extensions/KHR_interactivity/nodes/${h}: Could not find node with id ${Z} that connects its input with with node ${h}'s output ${q}`);let F=Y.signalInputs.find((R=>R.name===z));F||(F={uniqueId:(0,sq.e)(),name:z,_connectionType:0,connectedPointIds:[]},Y.signalInputs.push(F)),F.connectedPointIds.push(L.uniqueId),L.connectedPointIds.push(F.uniqueId)}const z=L.values??[];for(const Y of z){const L=Y.id,Z={uniqueId:(0,sq.e)(),name:L,_connectionType:0,connectedPointIds:[]};if(N.dataInputs.push(Z),void 0!==Y.value){const L=IN(Y,R,`/extensions/KHR_interactivity/nodes/${h}`);q._connectionValues[Z.uniqueId]=L}else{if(void 0===Y.node||void 0===Y.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${h}: Invalid socket ${L} in node ${h}`);{const R=Y.node,q=Y.socket,N=B[R];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${h}: Could not find node with id ${R} that connects its output with node${h}'s input ${L}`);let z=N.dataOutputs.find((R=>R.name===q));z||(z={uniqueId:(0,sq.e)(),name:q,_connectionType:1,connectedPointIds:[]},N.dataOutputs.push(z)),Z.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(Z.uniqueId)}}}}const N=R.variables??[];for(let h=0;h<N.length;h++){const L=N[h],B=L.id;q._userVariables[B]=IN(L,R,`/extensions/KHR_interactivity/variables/${h}`)}return{allBlocks:B,executionContexts:L}}(null===(R=this._loader.Ji.extensions)||void 0===R?void 0:R.KHR_interactivity),B=new tL({Nc:q});TL.Parse(L,{coordinator:B,pathConverter:this._pathConverter}),B.start()}}s(GN),J(GN,!0,(R=>new WN(R)));const HN="KHR_node_visibility";class PN{constructor(R){this.name=HN,this._loader=R,this.enabled=R.isExtensionUsed(HN)}async onReady(){var R;null===(R=this._loader.Ji.nodes)||void 0===R||R.forEach((R=>{var q,L,B,N;(null===(q=R._primitiveBabylonMeshes)||void 0===q||q.forEach((R=>{R.inheritVisibility=!0})),null!==(L=R.extensions)&&void 0!==L&&L.KHR_node_visibility)&&(!1===(null===(B=R.extensions)||void 0===B?void 0:B.KHR_node_visibility.visible)&&(R._babylonTransformNode&&(R._babylonTransformNode.isVisible=!1),null===(N=R._primitiveBabylonMeshes)||void 0===N||N.forEach((R=>{R.isVisible=!1}))))}))}dispose(){this._loader=null}}s(HN),J(HN,!0,(R=>new PN(R)));const ON="ExtrasAsMetadata";class EN{_assignExtras(R,q){if(q.extras&&Object.keys(q.extras).length>0){const L=R.metadata=R.metadata||{};(L.Ji=L.Ji||{}).extras=q.extras}}constructor(R){this.name=ON,this.enabled=!0,this._loader=R}dispose(){this._loader=null}loadNodeAsync(R,q,L){return this._loader.loadNodeAsync(R,q,(R=>{this._assignExtras(R,q),L(R)}))}loadCameraAsync(R,q,L){return this._loader.loadCameraAsync(R,q,(R=>{this._assignExtras(R,q),L(R)}))}createMaterial(R,q,L){const B=this._loader.createMaterial(R,q,L);return this._assignExtras(B,q),B}}s(ON),J(ON,!1,(R=>new EN(R)))},12075:(R,q,L)=>{"use strict";L.d(q,{e:()=>G,i:()=>S,k:()=>D,n:()=>I});var B=L(10760),N=L(10757),h=L(11435),Z=L(11329),z=L(11379),Y=L(11375),F=L(10767),C=L(10797),e=L(12079),y=L(12085),U=L(11337);class n{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.lj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Wj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(R){this._environmentTexture=R}getNodes(){let R=[];return R=R.concat(this.meshes),R=R.concat(this.lights),R=R.concat(this.cameras),R=R.concat(this.transformNodes),this.skeletons.forEach((q=>R=R.concat(q.bones))),R}}class r extends n{}class p{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((R=>{R.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((R=>{R.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((R=>{R.dispose()})),this.animationGroups.length=0}}class c extends n{constructor(R){super(),this._wasAddedToScene=!1,(R=R||C.b.LastCreatedScene)&&(this.Nc=R,this.proceduralTextures=[],R.ej.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=R.getEngine().onContextRestoredObservable.add((()=>{for(const R of this.geometries)R._rebuild();for(const R of this.meshes)R._rebuild();for(const R of this.lj)R.rebuild();for(const R of this.textures)R._rebuild()})))}_topologicalSort(R){const q=new Map;for(const Z of R)q.set(Z.uniqueId,Z);const L={dependsOn:new Map,dependedBy:new Map};for(const Z of R){const R=Z.uniqueId;L.dependsOn.set(R,new Set),L.dependedBy.set(R,new Set)}for(const Z of R){const R=Z.uniqueId,B=L.dependsOn.get(R);if(Z instanceof e.d){const N=Z.sourceMesh;q.has(N.uniqueId)&&(B.add(N.uniqueId),L.dependedBy.get(N.uniqueId).add(R))}const N=L.dependedBy.get(R);for(const h of Z.getDescendants()){const B=h.uniqueId;if(q.has(B)){N.add(B);L.dependsOn.get(B).add(R)}}}const B=[],N=[];for(const Z of R){const R=Z.uniqueId;0===L.dependsOn.get(R).size&&(N.push(Z),q.delete(R))}const h=N;for(;h.length>0;){const R=h.shift();B.push(R);const N=L.dependedBy.get(R.uniqueId);for(const B of Array.from(N.values())){const N=L.dependsOn.get(B);N.delete(R.uniqueId),0===N.size&&q.get(B)&&(h.push(q.get(B)),q.delete(B))}}return q.size>0&&(F.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),q.forEach((R=>F.d.Error(R.name)))),B}_addNodeAndDescendantsToList(R,q,L,B){if(L&&(!B||B(L))&&!q.has(L.uniqueId)){R.push(L),q.add(L.uniqueId);for(const N of L.getDescendants(!0))this._addNodeAndDescendantsToList(R,q,N,B)}}_isNodeInContainer(R){return R instanceof Y.c&&-1!==this.meshes.indexOf(R)||(R instanceof z.e&&-1!==this.transformNodes.indexOf(R)||(R instanceof y.e&&-1!==this.lights.indexOf(R)||R instanceof U.d&&-1!==this.cameras.indexOf(R)))}_isValidHierarchy(){for(const R of this.meshes)if(R.parent&&!this._isNodeInContainer(R.parent))return F.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.transformNodes)if(R.parent&&!this._isNodeInContainer(R.parent))return F.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.lights)if(R.parent&&!this._isNodeInContainer(R.parent))return F.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.cameras)if(R.parent&&!this._isNodeInContainer(R.parent))return F.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(R){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||N.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const B={},h={},z=new p,Y=[],F=[],C={doNotInstantiate:!0,...L},e=[],y=new Set;for(const N of this.transformNodes)null===N.parent&&this._addNodeAndDescendantsToList(e,y,N,C.predicate);for(const N of this.meshes)null===N.parent&&this._addNodeAndDescendantsToList(e,y,N,C.predicate);const U=this._topologicalSort(e),n=(L,N)=>{if(((q,L)=>{if(B[q.uniqueId]=L.uniqueId,h[L.uniqueId]=L,R&&(L.name=R(q.name)),L instanceof Z.d){const R=L;if(R.morphTargetManager){const L=q.morphTargetManager;R.morphTargetManager=L.clone();for(let q=0;q<L.numTargets;q++){const N=L.getTarget(q),Z=R.morphTargetManager.getTarget(q);B[N.uniqueId]=Z.uniqueId,h[Z.uniqueId]=Z}}}})(L,N),L.parent){const R=B[L.parent.uniqueId],q=h[R];N.parent=q||L.parent}if(N.position&&L.position&&N.position.p(L.position),N.rotationQuaternion&&L.rotationQuaternion&&N.rotationQuaternion.p(L.rotationQuaternion),N.rotation&&L.rotation&&N.rotation.p(L.rotation),N.Ud&&L.Ud&&N.Ud.p(L.Ud),N.material){const Z=N;if(Z.material)if(q){const q=L.material;if(-1===F.indexOf(q)){let L=q.clone(R?R(q.name):"Clone of "+q.name);if(F.push(q),B[q.uniqueId]=L.uniqueId,h[L.uniqueId]=L,"MultiMaterial"===q.getClassName()){const N=q;for(const q of N.$f)q&&(L=q.clone(R?R(q.name):"Clone of "+q.name),F.push(q),B[q.uniqueId]=L.uniqueId,h[L.uniqueId]=L);N.$f=N.$f.map((R=>R&&h[B[R.uniqueId]]))}}"InstancedMesh"!==Z.getClassName()&&(Z.material=h[B[q.uniqueId]])}else"MultiMaterial"===Z.material.getClassName()?-1===this.Nc.multiMaterials.indexOf(Z.material)&&this.Nc.addMultiMaterial(Z.material):-1===this.Nc.materials.indexOf(Z.material)&&this.Nc.addMaterial(Z.material)}null===N.parent&&z.rootNodes.push(N)};return U.forEach((R=>{if("InstancedMesh"===R.getClassName()){const q=R,L=q.sourceMesh,N=B[L.uniqueId],Z=("number"===typeof N?h[N]:L).createInstance(q.name);n(q,Z)}else{let q=!0;"qb"===R.getClassName()||"Node"===R.getClassName()||R.skeleton||!R.getTotalVertices||0===R.getTotalVertices()?q=!1:C.doNotInstantiate&&(q="function"===typeof C.doNotInstantiate?!C.doNotInstantiate(R):!C.doNotInstantiate);const L=q?R.createInstance(`instance of ${R.name}`):R.clone(`Clone of ${R.name}`,null,!0);if(!L)throw new Error(`Could not clone or instantiate node on Asset Container ${R.name}`);n(R,L)}})),this.skeletons.forEach((q=>{if(C.predicate&&!C.predicate(q))return;const L=q.clone(R?R(q.name):"Clone of "+q.name);for(const R of this.meshes)if(R.skeleton===q&&!R.isAnInstance){const q=h[B[R.uniqueId]];if(!q||q.isAnInstance)continue;if(q.skeleton=L,-1!==Y.indexOf(L))continue;Y.push(L);for(const R of L.bones)R._linkedTransformNode&&(R._linkedTransformNode=h[B[R._linkedTransformNode.uniqueId]])}z.skeletons.push(L)})),this.animationGroups.forEach((q=>{if(C.predicate&&!C.predicate(q))return;const L=q.clone(R?R(q.name):"Clone of "+q.name,(R=>h[B[R.uniqueId]]||R));z.animationGroups.push(L)})),z}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||N.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Nc.environmentTexture=this.environmentTexture);for(const R of this.Nc._serializableComponents)R.addFromContainer(this);this.Nc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=[];this.cameras.forEach((L=>{R&&!R(L)||(this.Nc.addCamera(L),q.push(L))})),this.lights.forEach((L=>{R&&!R(L)||(this.Nc.addLight(L),q.push(L))})),this.meshes.forEach((L=>{R&&!R(L)||(this.Nc.gi(L),q.push(L))})),this.skeletons.forEach((q=>{R&&!R(q)||this.Nc.addSkeleton(q)})),this.animations.forEach((q=>{R&&!R(q)||this.Nc.addAnimation(q)})),this.animationGroups.forEach((q=>{R&&!R(q)||this.Nc.addAnimationGroup(q)})),this.multiMaterials.forEach((q=>{R&&!R(q)||this.Nc.addMultiMaterial(q)})),this.materials.forEach((q=>{R&&!R(q)||this.Nc.addMaterial(q)})),this.morphTargetManagers.forEach((q=>{R&&!R(q)||this.Nc.addMorphTargetManager(q)})),this.geometries.forEach((q=>{R&&!R(q)||this.Nc.addGeometry(q)})),this.transformNodes.forEach((L=>{R&&!R(L)||(this.Nc.addTransformNode(L),q.push(L))})),this.actionManagers.forEach((q=>{R&&!R(q)||this.Nc.addActionManager(q)})),this.textures.forEach((q=>{R&&!R(q)||this.Nc.addTexture(q)})),this.reflectionProbes.forEach((q=>{R&&!R(q)||this.Nc.addReflectionProbe(q)}));for(const L of q)L.parent&&-1===this.Nc.getNodes().indexOf(L.parent)&&(L.setParent?L.setParent(null):L.parent=null)}removeAllFromScene(){this._isValidHierarchy()||N.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Nc.environmentTexture&&(this.Nc.environmentTexture=null);for(const R of this.Nc._serializableComponents)R.removeFromContainer(this)}removeFromScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((q=>{R&&!R(q)||this.Nc.removeCamera(q)})),this.lights.forEach((q=>{R&&!R(q)||this.Nc.removeLight(q)})),this.meshes.forEach((q=>{R&&!R(q)||this.Nc.Fc(q,!0)})),this.skeletons.forEach((q=>{R&&!R(q)||this.Nc.removeSkeleton(q)})),this.animations.forEach((q=>{R&&!R(q)||this.Nc.removeAnimation(q)})),this.animationGroups.forEach((q=>{R&&!R(q)||this.Nc.removeAnimationGroup(q)})),this.multiMaterials.forEach((q=>{R&&!R(q)||this.Nc.removeMultiMaterial(q)})),this.materials.forEach((q=>{R&&!R(q)||this.Nc.removeMaterial(q)})),this.morphTargetManagers.forEach((q=>{R&&!R(q)||this.Nc.removeMorphTargetManager(q)})),this.geometries.forEach((q=>{R&&!R(q)||this.Nc.removeGeometry(q)})),this.transformNodes.forEach((q=>{R&&!R(q)||this.Nc.removeTransformNode(q)})),this.actionManagers.forEach((q=>{R&&!R(q)||this.Nc.removeActionManager(q)})),this.textures.forEach((q=>{R&&!R(q)||this.Nc.removeTexture(q)})),this.reflectionProbes.forEach((q=>{R&&!R(q)||this.Nc.removeReflectionProbe(q)}))}dispose(){this.cameras.slice(0).forEach((R=>{R.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((R=>{R.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((R=>{R.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((R=>{R.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((R=>{R.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((R=>{R.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((R=>{R.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((R=>{R.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((R=>{R.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((R=>{R.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((R=>{R.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((R=>{R.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((R=>{R.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const R of this.Nc._serializableComponents)R.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Nc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(R,q,L){if(R&&q)for(const B of R){let R=!0;if(L)for(const q of L)if(B===q){R=!1;break}R&&(q.push(B),B._parentContainer=this)}}moveAllFromScene(R){this._wasAddedToScene=!1,void 0===R&&(R=new r);for(const q in this)Object.prototype.hasOwnProperty.call(this,q)&&(this[q]=this[q]||("_environmentTexture"===q?null:[]),this._moveAssets(this.Nc[q],this[q],R[q]));this.environmentTexture=this.Nc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const R=new Z.d("assetContainerRootMesh",this.Nc);return this.meshes.forEach((q=>{q.parent||R.addChild(q)})),this.meshes.unshift(R),R}mergeAnimationsTo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.b.LastCreatedScene,q=arguments.length>1?arguments[1]:void 0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!R)return F.d.Error("No scene available to merge animations to"),[];const B=L||(q=>{let L=null;const B=q.animations.length?q.animations[0].targetProperty:"",N=q.name.split(".").join("").split("_primitive")[0];switch(B){case"position":case"rotationQuaternion":L=R.getTransformNodeByName(q.name)||R.getTransformNodeByName(N);break;case"influence":L=R.getMorphTargetByName(q.name)||R.getMorphTargetByName(N);break;default:L=R.getNodeByName(q.name)||R.getNodeByName(N)}return L});this.getNodes().forEach((R=>{const q=B(R);if(null!==q){for(const L of R.animations){const R=q.animations.filter((R=>R.targetProperty===L.targetProperty));for(const L of R){const R=q.animations.indexOf(L,0);R>-1&&q.animations.splice(R,1)}}q.animations=q.animations.concat(R.animations)}}));const N=[];return this.animationGroups.slice().forEach((R=>{N.push(R.clone(R.name,B)),R.animatables.forEach((R=>{R.stop()}))})),q.forEach((q=>{const L=B(q.target);L&&(R.beginAnimation(L,q.fromFrame,q.toFrame,q.loopAnimation,q.speedRatio,q.onAnimationEnd?q.onAnimationEnd:void 0,void 0,!0,void 0,q.onAnimationLoop?q.onAnimationLoop:void 0),R.stopAnimation(q.target))})),N}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)})),this.transformNodes.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)})),this.lights.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)})),this.cameras.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)}))}addAllAssetsToContainer(R){if(!R)return;const q=[],L=new Set;for(q.push(R);q.length>0;){const R=q.pop();if(R instanceof Z.d?(R.yj&&-1===this.geometries.indexOf(R.yj)&&this.geometries.push(R.yj),this.meshes.push(R)):R instanceof z.e?this.transformNodes.push(R):R instanceof y.e?this.lights.push(R):R instanceof U.d&&this.cameras.push(R),R instanceof Y.c){if(R.material&&-1===this.materials.indexOf(R.material)){this.materials.push(R.material);for(const q of R.material.getActiveTextures())-1===this.textures.indexOf(q)&&this.textures.push(q)}R.skeleton&&-1===this.skeletons.indexOf(R.skeleton)&&this.skeletons.push(R.skeleton),R.morphTargetManager&&-1===this.morphTargetManagers.indexOf(R.morphTargetManager)&&this.morphTargetManagers.push(R.morphTargetManager)}for(const B of R.getChildren())L.has(B)||q.push(B);L.add(R)}this.populateRootNodes()}}var d=L(10815);class f{constructor(R){this.byteOffset=0,this.buffer=R}loadAsync(R){return this.buffer.readAsync(this.byteOffset,R).then((R=>{this._dataView=new DataView(R.buffer,R.byteOffset,R.byteLength),this._dataByteOffset=0}))}readUint32(){const R=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,R}readUint8Array(R){const q=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,R);return this._dataByteOffset+=R,this.byteOffset+=R,q}readString(R){return(0,d.d)(this.readUint8Array(R))}skipBytes(R){this._dataByteOffset+=R,this.byteOffset+=R}}var v=L(12088);const T="Z2xURg",t={name:"Ji",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:R=>-1!==R.indexOf("asset")&&-1!==R.indexOf("version")||R.startsWith("data:base64,"+T)||R.startsWith("data:;base64,"+T)||R.startsWith("data:application/octet-stream;base64,"+T)||R.startsWith("data:model/gltf-binary;base64,"+T)};var D,S,I,K=L(10805),m=L(10808);function o(R,q,L){try{return Promise.resolve(new Uint8Array(R,q,L))}catch(B){return Promise.reject(B)}}!function(R){R[R.AUTO=0]="AUTO",R[R.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(D||(D={})),function(R){R[R.NONE=0]="NONE",R[R.FIRST=1]="FIRST",R[R.ALL=2]="ALL"}(S||(S={})),function(R){R[R.LOADING=0]="LOADING",R[R.READY=1]="READY",R[R.COMPLETE=2]="COMPLETE"}(I||(I={}));class l{constructor(){this.coordinateSystemMode=D.AUTO,this.animationStartMode=S.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=R=>Promise.resolve(R),this.extensionOptions={}}p(R){R&&(this.onParsed=R.onParsed,this.coordinateSystemMode=R.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=R.animationStartMode??this.animationStartMode,this.loadNodeAnimations=R.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=R.loadSkins??this.loadSkins,this.loadMorphTargets=R.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=R.compileMaterials??this.compileMaterials,this.useClipPlane=R.useClipPlane??this.useClipPlane,this.compileShadowGenerators=R.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=R.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=R.useRangeRequests??this.useRangeRequests,this.createInstances=R.createInstances??this.createInstances,this.alwaysComputeBoundingBox=R.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=R.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=R.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=R.skipMaterials??this.skipMaterials,this.useSRGBBuffers=R.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=R.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=R.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=R.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=R.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=R.customRootNode,this.onMeshLoaded=R.onMeshLoaded,this.onSkinLoaded=R.onSkinLoaded,this.onTextureLoaded=R.onTextureLoaded,this.onMaterialLoaded=R.onMaterialLoaded,this.onCameraLoaded=R.onCameraLoaded,this.extensionOptions=R.extensionOptions??this.extensionOptions)}}class G extends l{constructor(R){super(),this.onParsedObservable=new B.b,this.onMeshLoadedObservable=new B.b,this.onSkinLoadedObservable=new B.b,this.onTextureLoadedObservable=new B.b,this.onMaterialLoadedObservable=new B.b,this.onCameraLoadedObservable=new B.b,this.onCompleteObservable=new B.b,this.onErrorObservable=new B.b,this.ej=new B.b,this.onExtensionLoadedObservable=new B.b,this.validate=!1,this.onValidatedObservable=new B.b,this._loader=null,this._state=null,this._requests=new Array,this.name=t.name,this.extensions=t.extensions,this.onLoaderStateChangedObservable=new B.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(R)}set onParsed(R){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),R&&(this._onParsedObserver=this.onParsedObservable.add(R))}set onMeshLoaded(R){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),R&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(R))}set onSkinLoaded(R){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),R&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((q=>R(q.node,q.skinnedNode))))}set onTextureLoaded(R){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),R&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(R))}set onMaterialLoaded(R){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),R&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(R))}set onCameraLoaded(R){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),R&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(R))}set onComplete(R){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(R)}set onError(R){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(R)}set onDispose(R){this._onDisposeObserver&&this.ej.remove(this._onDisposeObserver),this._onDisposeObserver=this.ej.add(R)}set onExtensionLoaded(R){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(R)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(R){this._loggingEnabled!==R&&(this._loggingEnabled=R,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(R){this._capturePerformanceCounters!==R&&(this._capturePerformanceCounters=R,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(R){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(R)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const R of this._requests)R.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=R=>Promise.resolve(R),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ej.notifyObservers(void 0),this.ej.clear()}loadFile(R,q,L,h,Z,z,Y,C){if(ArrayBuffer.isView(q))return this._loadBinary(R,q,L,h,Y,C),null;this._progressCallback=Z;const e=q.name||N.f.GetFilename(q);if(z){if(this.useRangeRequests){this.validate&&F.d.Warn("glTF validation is not supported when range requests are enabled");const L={abort:()=>{},onCompleteObservable:new B.b},N={readAsync:(L,B)=>new Promise(((N,h)=>{this._loadFile(R,q,(R=>{N(new Uint8Array(R))}),!0,(R=>{h(R)}),(R=>{R.setRequestHeader("Range",`bytes=${L}-${L+B-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(N)).then((R=>{L.onCompleteObservable.notifyObservers(L),h(R)}),Y?R=>Y(void 0,R):void 0),L}return this._loadFile(R,q,(q=>{this._validate(R,new Uint8Array(q,0,q.byteLength),L,e),this._unpackBinaryAsync(new f({readAsync:(R,L)=>o(q,R,L),byteLength:q.byteLength})).then((R=>{h(R)}),Y?R=>Y(void 0,R):void 0)}),!0,Y)}return this._loadFile(R,q,(q=>{try{this._validate(R,q,L,e),h({json:this._parseJson(q)})}catch{Y&&Y()}}),!1,Y)}_loadBinary(R,q,L,B,N,h){this._validate(R,new Uint8Array(q.buffer,q.byteOffset,q.byteLength),L,h),this._unpackBinaryAsync(new f({readAsync:(R,L)=>function(R,q,L){try{if(q<0||q>=R.byteLength)throw new RangeError("Offset is out of range.");if(q+L>R.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(R.buffer,R.byteOffset+q,L))}catch(B){return Promise.reject(B)}}(q,R,L),byteLength:q.byteLength})).then((R=>{B(R)}),N?R=>N(void 0,R):void 0)}importMeshAsync(R,q,L,B,N,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(L),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(L),this._loader.importMeshAsync(R,q,null,L,B,N,h))))}loadAsync(R,q,L,B,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(q),this._loader.loadAsync(R,q,L,B,N))))}loadAssetContainerAsync(R,q,L,B,N){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(q);const h=new c(R),Z=[];this.onMaterialLoadedObservable.add((R=>{Z.push(R)}));const z=[];this.onTextureLoadedObservable.add((R=>{z.push(R)}));const Y=[];this.onCameraLoadedObservable.add((R=>{Y.push(R)}));const F=[];return this.onMeshLoadedObservable.add((R=>{R.morphTargetManager&&F.push(R.morphTargetManager)})),this._loader.importMeshAsync(null,R,h,q,L,B,N).then((R=>(Array.prototype.push.apply(h.geometries,R.geometries),Array.prototype.push.apply(h.meshes,R.meshes),Array.prototype.push.apply(h.lj,R.lj),Array.prototype.push.apply(h.skeletons,R.skeletons),Array.prototype.push.apply(h.animationGroups,R.animationGroups),Array.prototype.push.apply(h.materials,Z),Array.prototype.push.apply(h.textures,z),Array.prototype.push.apply(h.lights,R.lights),Array.prototype.push.apply(h.transformNodes,R.transformNodes),Array.prototype.push.apply(h.cameras,Y),Array.prototype.push.apply(h.morphTargetManagers,F),h)))}))}canDirectLoad(R){return t.canDirectLoad(R)}directLoad(R,q){if(q.startsWith("base64,"+T)||q.startsWith(";base64,"+T)||q.startsWith("application/octet-stream;base64,"+T)||q.startsWith("model/gltf-binary;base64,"+T)){const L=(0,K.e)(q);return this._validate(R,new Uint8Array(L,0,L.byteLength)),this._unpackBinaryAsync(new f({readAsync:(R,q)=>o(L,R,q),byteLength:L.byteLength}))}return this._validate(R,q),Promise.resolve({json:this._parseJson(q)})}createPlugin(R){return new G(R[t.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((R,q)=>{this.onCompleteObservable.addOnce((()=>{R()})),this.onErrorObservable.addOnce((R=>{q(R)}))}))}_setState(R){this._state!==R&&(this._state=R,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(I[this._state]))}_loadFile(R,q,L,B,N,h){const Z=R._loadFile(q,L,(R=>{this._onProgress(R,Z)}),!0,B,N,h);return Z.onCompleteObservable.add((()=>{Z._lengthComputable=!0,Z._total=Z._loaded})),this._requests.push(Z),Z}_onProgress(R,q){if(!this._progressCallback)return;q._lengthComputable=R.lengthComputable,q._loaded=R.loaded,q._total=R.total;let L=!0,B=0,N=0;for(const h of this._requests){if(void 0===h._lengthComputable||void 0===h._loaded||void 0===h._total)return;L=L&&h._lengthComputable,B+=h._loaded,N+=h._total}this._progressCallback({lengthComputable:L,loaded:B,total:L?N:0})}_validate(R,q){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),v.d.ValidateAsync(q,L,B,(q=>this.preprocessUrlAsync(L+q).then((q=>R._loadFileAsync(q,void 0,!0,!0).then((R=>new Uint8Array(R,0,R.byteLength))))))).then((R=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(R),this.onValidatedObservable.clear()}),(R=>{this._endPerformanceCounter("Validate JSON"),N.f.Warn(`Failed to validate: ${R.message}`),this.onValidatedObservable.clear()})))}_getLoader(R){const q=R.json.asset||{};this._log(`Asset version: ${q.version}`),q.minVersion&&this._log(`Asset minimum version: ${q.minVersion}`),q.generator&&this._log(`Asset generator: ${q.generator}`);const L=G._parseVersion(q.version);if(!L)throw new Error("Invalid version: "+q.version);if(void 0!==q.minVersion){const R=G._parseVersion(q.minVersion);if(!R)throw new Error("Invalid minimum version: "+q.minVersion);if(G._compareVersion(R,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+q.minVersion)}const B={1:G._CreateGLTF1Loader,2:G._CreateGLTF2Loader}[L.major];if(!B)throw new Error("Unsupported version: "+q.version);return B(this)}_parseJson(R){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${R.length}`);const q=JSON.parse(R);return this._endPerformanceCounter("Parse JSON"),q}_unpackBinaryAsync(R){return this._startPerformanceCounter("Unpack Binary"),R.loadAsync(20).then((()=>{const q=R.readUint32();if(1179937895!==q)throw new m.i("Unexpected magic: "+q,m.e.GLTFLoaderUnexpectedMagicError);const L=R.readUint32();this.loggingEnabled&&this._log(`Binary version: ${L}`);const B=R.readUint32();let N;switch(this.useRangeRequests||B===R.buffer.byteLength||F.d.Warn(`Length in header does not match actual data length: ${B} != ${R.buffer.byteLength}`),L){case 1:N=this._unpackBinaryV1Async(R,B);break;case 2:N=this._unpackBinaryV2Async(R,B);break;default:throw new Error("Unsupported version: "+L)}return this._endPerformanceCounter("Unpack Binary"),N}))}_unpackBinaryV1Async(R,q){const L=R.readUint32(),B=R.readUint32();if(0!==B)throw new Error(`Unexpected content format: ${B}`);const N=q-R.byteOffset,h={json:this._parseJson(R.readString(L)),bin:null};if(0!==N){const q=R.byteOffset;h.bin={readAsync:(L,B)=>R.buffer.readAsync(q+L,B),byteLength:N}}return Promise.resolve(h)}_unpackBinaryV2Async(R,q){const L=1313821514,B=5130562,N=R.readUint32();if(R.readUint32()!==L)throw new Error("First chunk format is not JSON");return R.byteOffset+N===q?R.loadAsync(N).then((()=>({json:this._parseJson(R.readString(N)),bin:null}))):R.loadAsync(N+8).then((()=>{const h={json:this._parseJson(R.readString(N)),bin:null},Z=()=>{const N=R.readUint32();switch(R.readUint32()){case L:throw new Error("Unexpected JSON chunk");case B:{const q=R.byteOffset;h.bin={readAsync:(L,B)=>R.buffer.readAsync(q+L,B),byteLength:N},R.skipBytes(N);break}default:R.skipBytes(N)}return R.byteOffset!==q?R.loadAsync(8).then(Z):Promise.resolve(h)};return Z()}))}static _parseVersion(R){if("1.0"===R||"1.0.1"===R)return{major:1,minor:0};const q=(R+"").match(/^(\d+)\.(\d+)/);return q?{major:parseInt(q[1]),minor:parseInt(q[2])}:null}static _compareVersion(R,q){return R.major>q.major?1:R.major<q.major?-1:R.minor>q.minor?1:R.minor<q.minor?-1:0}_logOpen(R){this._log(R),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(R){const q=G._logSpaces.substring(0,2*this._logIndentLevel);F.d.Log(`${q}${R}`)}_logDisabled(R){}_startPerformanceCounterEnabled(R){N.f.StartPerformanceCounter(R)}_startPerformanceCounterDisabled(R){}_endPerformanceCounterEnabled(R){N.f.EndPerformanceCounter(R)}_endPerformanceCounterDisabled(R){}}G.IncrementalLoading=!0,G.HomogeneousCoordinates=!1,G._logSpaces="                                ",(0,h.d)(new G)},12088:(R,q,L)=>{"use strict";L.d(q,{d:()=>Z});var B=L(10757);function N(R,q,L,B){const N={externalResourceFunction:B};return L&&(N.uri="file:"===q?L:q+L),ArrayBuffer.isView(R)?GLTFValidator.validateBytes(R,N):GLTFValidator.validateString(R,N)}function h(){const R=[];onmessage=q=>{const L=q.data;switch(L.id){case"init":importScripts(L.url);break;case"validate":N(L.data,L.rootUrl,L.fileName,(q=>new Promise(((L,B)=>{const N=R.length;R.push({resolve:L,reject:B}),postMessage({id:"getExternalResource",index:N,uri:q})})))).then((R=>{postMessage({id:"validate.resolve",value:R})}),(R=>{postMessage({id:"validate.reject",reason:R})}));break;case"getExternalResource.resolve":R[L.index].resolve(L.value);break;case"getExternalResource.reject":R[L.index].reject(L.reason)}}}class Z{static ValidateAsync(R,q,L,Z){return"function"===typeof Worker?new Promise(((z,Y)=>{const F=`${N}(${h})()`,C=URL.createObjectURL(new Blob([F],{type:"application/javascript"})),e=new Worker(C),y=R=>{e.removeEventListener("error",y),e.removeEventListener("message",U),Y(R)},U=R=>{const q=R.data;switch(q.id){case"getExternalResource":Z(q.uri).then((R=>{e.postMessage({id:"getExternalResource.resolve",index:q.index,value:R},[R.buffer])}),(R=>{e.postMessage({id:"getExternalResource.reject",index:q.index,reason:R})}));break;case"validate.resolve":e.removeEventListener("error",y),e.removeEventListener("message",U),z(q.value),e.terminate();break;case"validate.reject":e.removeEventListener("error",y),e.removeEventListener("message",U),Y(q.reason),e.terminate()}};if(e.addEventListener("error",y),e.addEventListener("message",U),e.postMessage({id:"init",url:B.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(R)){const B=R.slice();e.postMessage({id:"validate",data:B,rootUrl:q,fileName:L},[B.buffer])}else e.postMessage({id:"validate",data:R,rootUrl:q,fileName:L})})):(this._LoadScriptPromise||(this._LoadScriptPromise=B.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>N(R,q,L,Z))))}}Z.Configuration={url:`${B.f._DefaultCdnUrl}/gltf_validator.js`}},12468:(R,q,L)=>{"use strict";L.d(q,{c:()=>D});var B=L(11053),N=L(11058),h=L(11117),Z=L(11081),z=L(11263),Y=L(11271),F=L(11136),C=L(11071),e=L(10889),y=L(10841);L(11759),L(11661),L(11677),L(11665),L(11681),L(11690),L(11697);const U="imageProcessingCompatibility",n="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";y.b.IncludesShadersStore[U]=n;const r="skyPixelShader",p="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";y.b.ShadersStore[r]=p;L(11767),L(11706),L(11710),L(11725),L(11718);const c="skyVertexShader",d="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";y.b.ShadersStore[c]=d;var f=L(11303),v=L(11255),T=L(11248);class t extends z.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends Y.e{constructor(R,q){super(R,q),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Z.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=Z.m.Zero(),this.up=Z.m.Up(),this.dithering=!1,this._cameraPosition=Z.m.Zero(),this._skyOrientation=new Z.d}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(R,q){const L=q._drawWrapper;if(this.isFrozen&&L.effect&&L._wasPreviouslyReady)return!0;q.materialDefines||(q.materialDefines=new t);const B=q.materialDefines,N=this.va();if(this._isReadyForSubMesh(q))return!0;if((0,T.T)(R,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,B),(0,T.I)(R,B,!0,!1),B.IMAGEPROCESSINGPOSTPROCESS!==N.imageProcessingConfiguration.applyByPostProcess&&B.markAsMiscDirty(),B.DITHER!==this.dithering&&B.markAsMiscDirty(),B.isDirty){B.markAsProcessed(),N.resetCachedMaterial();const R=new f.b;B.FOG&&R.addFallback(1,"FOG"),B.IMAGEPROCESSINGPOSTPROCESS=N.imageProcessingConfiguration.applyByPostProcess,B.DITHER=this.dithering;const L=[F.e.PositionKind];B.VERTEXCOLOR&&L.push(F.e.ColorKind);const h="sky",Z=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,v.e)(Z);const z=B.toString();q.setEffect(N.getEngine().createEffect(h,L,Z,[],z,R,this.onCompiled,this.onError),B,this._materialContext)}return!(!q.effect||!q.effect.isReady())&&(B._renderId=N.getRenderId(),L._wasPreviouslyReady=!0,!0)}bindForSubMesh(R,q,L){const B=this.va(),N=L.materialDefines;if(!N)return;const h=L.effect;if(!h)return;this._activeEffect=h,this.bindOnlyWorldMatrix(R),this._activeEffect.setMatrix("viewProjection",B.getTransformMatrix()),this._mustRebind(B,h,L)&&((0,v.f)(h,this,B),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,T.l)(N,h,B)),B.fogEnabled&&q.applyFog&&B.fogMode!==C.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",B.getViewMatrix()),(0,T.g)(B,q,this._activeEffect);const z=B.activeCamera;if(z){const R=z.getWorldMatrix();this._cameraPosition.x=R.m[12],this._cameraPosition.y=R.m[13],this._cameraPosition.z=R.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const R=Math.PI*(this.inclination-.5),q=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(q)*Math.cos(R),this.sunPosition.y=this.distance*Math.sin(-R),this.sunPosition.z=this.distance*Math.sin(q)*Math.cos(R),Z.d.FromUnitVectorsToRef(Z.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(q,this._activeEffect,L)}getAnimatables(){return[]}dispose(R){super.dispose(R)}clone(R){return h.b.Clone((()=>new D(R,this.va())),this)}serialize(){const R=super.serialize();return R.customType="BABYLON.SkyMaterial",R}getClassName(){return"SkyMaterial"}static Parse(R,q,L){return h.b.Parse((()=>new D(R.name,q)),R,q,L)}}(0,B.d)([(0,N.K)()],D.prototype,"luminance",void 0),(0,B.d)([(0,N.K)()],D.prototype,"turbidity",void 0),(0,B.d)([(0,N.K)()],D.prototype,"rayleigh",void 0),(0,B.d)([(0,N.K)()],D.prototype,"mieCoefficient",void 0),(0,B.d)([(0,N.K)()],D.prototype,"mieDirectionalG",void 0),(0,B.d)([(0,N.K)()],D.prototype,"distance",void 0),(0,B.d)([(0,N.K)()],D.prototype,"inclination",void 0),(0,B.d)([(0,N.K)()],D.prototype,"azimuth",void 0),(0,B.d)([(0,N.G)()],D.prototype,"sunPosition",void 0),(0,B.d)([(0,N.K)()],D.prototype,"useSunPosition",void 0),(0,B.d)([(0,N.G)()],D.prototype,"cameraOffset",void 0),(0,B.d)([(0,N.G)()],D.prototype,"up",void 0),(0,B.d)([(0,N.K)()],D.prototype,"dithering",void 0),(0,e.f)("BABYLON.SkyMaterial",D)},10613:(R,q,L)=>{"use strict";function B(R,q){q.headers=R.headers||{},q.statusMessage=R.statusText,q.statusCode=R.status,q.data=R.response}function N(R,q,L){return new Promise((function(N,h){L=L||{};var Z,z,Y,F=new XMLHttpRequest,C=L.body,e=L.headers||{};for(Z in L.timeout&&(F.timeout=L.timeout),F.ontimeout=F.onerror=function(R){R.timeout="timeout"==R.type,h(R)},F.open(R,q.href||q),F.onload=function(){for(Y=F.getAllResponseHeaders().trim().split(/[\r\n]+/),B(F,F);z=Y.shift();)z=z.split(": "),F.headers[z.shift().toLowerCase()]=z.join(": ");if((z=F.headers["content-type"])&&~z.indexOf("application/json"))try{F.data=JSON.parse(F.data,L.reviver)}catch(R){return B(F,R),h(R)}(F.status>=400?h:N)(F)},typeof FormData<"u"&&C instanceof FormData||C&&"object"==typeof C&&(e["content-type"]="application/json",C=JSON.stringify(C)),F.withCredentials=!!L.withCredentials,e)F.setRequestHeader(Z,e[Z]);F.send(C)}))}L.r(q),L.d(q,{del:()=>Y,get:()=>h,patch:()=>z,post:()=>Z,put:()=>F,send:()=>N});var h=N.bind(N,"GET"),Z=N.bind(N,"POST"),z=N.bind(N,"PATCH"),Y=N.bind(N,"DELETE"),F=N.bind(N,"PUT")},12579:(R,q,L)=>{"use strict";L.d(q,{d:()=>e});const B=.5*(Math.sqrt(3)-1),N=(3-Math.sqrt(3))/6,h=1/3,Z=1/6,z=(Math.sqrt(5)-1)/4,Y=(5-Math.sqrt(5))/20,F=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),C=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const e=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const q="function"==typeof R?R:function(R){let q=0,L=0,B=0,N=1;const h=function(){let R=4022871197;return function(q){q=q.toString();for(let L=0;L<q.length;L++){R+=q.charCodeAt(L);let B=.02519603282416938*R;R=B>>>0,B-=R,B*=R,R=B>>>0,B-=R,R+=4294967296*B}return 2.3283064365386963e-10*(R>>>0)}}();q=h(" "),L=h(" "),B=h(" "),q-=h(R),q<0&&(q+=1);L-=h(R),L<0&&(L+=1);B-=h(R),B<0&&(B+=1);return function(){const R=2091639*q+2.3283064365386963e-10*N;return q=L,L=B,B=R-(N=0|R)}}(R);this.p=function(R){const q=new Uint8Array(256);for(let L=0;L<256;L++)q[L]=L;for(let L=0;L<255;L++){const B=L+~~(R()*(256-L)),N=q[L];q[L]=q[B],q[B]=N}return q}(q),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let L=0;L<512;L++)this.perm[L]=this.p[255&L],this.permMod12[L]=this.perm[L]%12}noise2D(R,q){const L=this.permMod12,h=this.perm;let Z=0,z=0,Y=0;const C=(R+q)*B,e=Math.floor(R+C),y=Math.floor(q+C),U=(e+y)*N,n=R-(e-U),r=q-(y-U);let p,c;n>r?(p=1,c=0):(p=0,c=1);const d=n-p+N,f=r-c+N,v=n-1+2*N,T=r-1+2*N,t=255&e,D=255&y;let S=.5-n*n-r*r;if(S>=0){const R=3*L[t+h[D]];S*=S,Z=S*S*(F[R]*n+F[R+1]*r)}let I=.5-d*d-f*f;if(I>=0){const R=3*L[t+p+h[D+c]];I*=I,z=I*I*(F[R]*d+F[R+1]*f)}let K=.5-v*v-T*T;if(K>=0){const R=3*L[t+1+h[D+1]];K*=K,Y=K*K*(F[R]*v+F[R+1]*T)}return 70*(Z+z+Y)}noise3D(R,q,L){const B=this.permMod12,N=this.perm;let z,Y,C,e;const y=(R+q+L)*h,U=Math.floor(R+y),n=Math.floor(q+y),r=Math.floor(L+y),p=(U+n+r)*Z,c=R-(U-p),d=q-(n-p),f=L-(r-p);let v,T,t,D,S,I;c>=d?d>=f?(v=1,T=0,t=0,D=1,S=1,I=0):c>=f?(v=1,T=0,t=0,D=1,S=0,I=1):(v=0,T=0,t=1,D=1,S=0,I=1):d<f?(v=0,T=0,t=1,D=0,S=1,I=1):c<f?(v=0,T=1,t=0,D=0,S=1,I=1):(v=0,T=1,t=0,D=1,S=1,I=0);const K=c-v+Z,m=d-T+Z,o=f-t+Z,l=c-D+2*Z,G=d-S+2*Z,W=f-I+2*Z,H=c-1+.5,P=d-1+.5,O=f-1+.5,E=255&U,a=255&n,g=255&r;let Q=.6-c*c-d*d-f*f;if(Q<0)z=0;else{const R=3*B[E+N[a+N[g]]];Q*=Q,z=Q*Q*(F[R]*c+F[R+1]*d+F[R+2]*f)}let i=.6-K*K-m*m-o*o;if(i<0)Y=0;else{const R=3*B[E+v+N[a+T+N[g+t]]];i*=i,Y=i*i*(F[R]*K+F[R+1]*m+F[R+2]*o)}let k=.6-l*l-G*G-W*W;if(k<0)C=0;else{const R=3*B[E+D+N[a+S+N[g+I]]];k*=k,C=k*k*(F[R]*l+F[R+1]*G+F[R+2]*W)}let V=.6-H*H-P*P-O*O;if(V<0)e=0;else{const R=3*B[E+1+N[a+1+N[g+1]]];V*=V,e=V*V*(F[R]*H+F[R+1]*P+F[R+2]*O)}return 32*(z+Y+C+e)}noise4D(R,q,L,B){const N=this.perm;let h,Z,F,e,y;const U=(R+q+L+B)*z,n=Math.floor(R+U),r=Math.floor(q+U),p=Math.floor(L+U),c=Math.floor(B+U),d=(n+r+p+c)*Y,f=R-(n-d),v=q-(r-d),T=L-(p-d),t=B-(c-d);let D=0,S=0,I=0,K=0;f>v?D++:S++,f>T?D++:I++,f>t?D++:K++,v>T?S++:I++,v>t?S++:K++,T>t?I++:K++;const m=D>=3?1:0,o=S>=3?1:0,l=I>=3?1:0,G=K>=3?1:0,W=D>=2?1:0,H=S>=2?1:0,P=I>=2?1:0,O=K>=2?1:0,E=D>=1?1:0,a=S>=1?1:0,g=I>=1?1:0,Q=K>=1?1:0,i=f-m+Y,k=v-o+Y,V=T-l+Y,x=t-G+Y,w=f-W+2*Y,j=v-H+2*Y,J=T-P+2*Y,s=t-O+2*Y,A=f-E+3*Y,M=v-a+3*Y,b=T-g+3*Y,X=t-Q+3*Y,u=f-1+4*Y,RR=v-1+4*Y,qR=T-1+4*Y,LR=t-1+4*Y,BR=255&n,NR=255&r,hR=255&p,ZR=255&c;let zR=.6-f*f-v*v-T*T-t*t;if(zR<0)h=0;else{const R=N[BR+N[NR+N[hR+N[ZR]]]]%32*4;zR*=zR,h=zR*zR*(C[R]*f+C[R+1]*v+C[R+2]*T+C[R+3]*t)}let YR=.6-i*i-k*k-V*V-x*x;if(YR<0)Z=0;else{const R=N[BR+m+N[NR+o+N[hR+l+N[ZR+G]]]]%32*4;YR*=YR,Z=YR*YR*(C[R]*i+C[R+1]*k+C[R+2]*V+C[R+3]*x)}let FR=.6-w*w-j*j-J*J-s*s;if(FR<0)F=0;else{const R=N[BR+W+N[NR+H+N[hR+P+N[ZR+O]]]]%32*4;FR*=FR,F=FR*FR*(C[R]*w+C[R+1]*j+C[R+2]*J+C[R+3]*s)}let CR=.6-A*A-M*M-b*b-X*X;if(CR<0)e=0;else{const R=N[BR+E+N[NR+a+N[hR+g+N[ZR+Q]]]]%32*4;CR*=CR,e=CR*CR*(C[R]*A+C[R+1]*M+C[R+2]*b+C[R+3]*X)}let eR=.6-u*u-RR*RR-qR*qR-LR*LR;if(eR<0)y=0;else{const R=N[BR+1+N[NR+1+N[hR+1+N[ZR+1]]]]%32*4;eR*=eR,y=eR*eR*(C[R]*u+C[R+1]*RR+C[R+2]*qR+C[R+3]*LR)}return 27*(h+Z+F+e+y)}}}}]);