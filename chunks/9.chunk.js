"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11015:(h,V,i)=>{i.d(V,{c:()=>O,e:()=>X,j:()=>D,f:()=>m,l:()=>G});class S{constructor(){this.children=[]}isValid(h){return!0}process(h,V,i){let S="";if(this.line){let i=this.line;const I=V.processor;if(I){var l,Y,g,q,B,J;I.lineProcessor&&(i=I.lineProcessor(i,V.isFragment,V.processingContext));const S=(null===(l=V.processor)||void 0===l?void 0:l.attributeKeywordName)??"attribute",v=V.isFragment&&null!==(Y=V.processor)&&void 0!==Y&&Y.varyingFragmentKeywordName?null===(g=V.processor)||void 0===g?void 0:g.varyingFragmentKeywordName:!V.isFragment&&null!==(q=V.processor)&&void 0!==q&&q.varyingVertexKeywordName?null===(B=V.processor)||void 0===B?void 0:B.varyingVertexKeywordName:"varying";if(!V.isFragment&&I.attributeProcessor&&this.line.startsWith(S))i=I.attributeProcessor(this.line,h,V.processingContext);else if(I.varyingProcessor&&(null!==(J=I.varyingCheck)&&void 0!==J&&J.call(I,this.line,V.isFragment)||!I.varyingCheck&&this.line.startsWith(v)))i=I.varyingProcessor(this.line,V.isFragment,h,V.processingContext);else if(I.uniformProcessor&&I.uniformRegexp&&I.uniformRegexp.test(this.line))V.lookForClosingBracketForUniformBuffer||(i=I.uniformProcessor(this.line,V.isFragment,h,V.processingContext));else if(I.uniformBufferProcessor&&I.uniformBufferRegexp&&I.uniformBufferRegexp.test(this.line))V.lookForClosingBracketForUniformBuffer||(i=I.uniformBufferProcessor(this.line,V.isFragment,V.processingContext),V.lookForClosingBracketForUniformBuffer=!0);else if(I.textureProcessor&&I.textureRegexp&&I.textureRegexp.test(this.line))i=I.textureProcessor(this.line,V.isFragment,h,V.processingContext);else if((I.uniformProcessor||I.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!V.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?I.uniformProcessor&&(i=I.uniformProcessor(this.line,V.isFragment,h,V.processingContext)):I.uniformBufferProcessor&&(i=I.uniformBufferProcessor(this.line,V.isFragment,V.processingContext),V.lookForClosingBracketForUniformBuffer=!0)}V.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(V.lookForClosingBracketForUniformBuffer=!1,I.endOfUniformBufferProcessor&&(i=I.endOfUniformBufferProcessor(this.line,V.isFragment,V.processingContext)))}S+=i+"\n"}for(const I of this.children)S+=I.process(h,V,i);return this.additionalDefineKey&&(h[this.additionalDefineKey]=this.additionalDefineValue||"true",i[this.additionalDefineKey]=h[this.additionalDefineKey]),S}}class l{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(h){this._lines.length=0;for(const V of h){if(!V||"\r"===V)continue;if("#"===V[0]){this._lines.push(V);continue}const h=V.trim();if(!h)continue;if(h.startsWith("//")){this._lines.push(V);continue}const i=h.indexOf(";");if(-1===i)this._lines.push(h);else if(i===h.length-1)h.length>1&&this._lines.push(h);else{const h=V.split(";");for(let V=0;V<h.length;V++){let i=h[V];i&&(i=i.trim(),i&&this._lines.push(i+(V!==h.length-1?";":"")))}}}}}class Y extends S{process(h,V,i){for(let S=0;S<this.children.length;S++){const l=this.children[S];if(l.isValid(h))return l.process(h,V,i)}return""}}class g extends S{isValid(h){return this.testExpression.isTrue(h)}}class q{isTrue(h){return!0}static postfixToInfix(h){const V=[];for(const i of h)if(void 0===q._OperatorPriority[i])V.push(i);else{const h=V[V.length-1],S=V[V.length-2];V.length-=2,V.push(`(${S}${i}${h})`)}return V[V.length-1]}static infixToPostfix(h){const V=q._InfixToPostfixCache.get(h);if(V)return V.accessTime=Date.now(),V.result;if(!h.includes("&&")&&!h.includes("||")&&!h.includes(")")&&!h.includes("("))return[h];const i=[];let S=-1;const l=()=>{I=I.trim(),""!==I&&(i.push(I),I="")},Y=h=>{S<q._Stack.length-1&&(q._Stack[++S]=h)},g=()=>q._Stack[S],B=()=>-1===S?"!!INVALID EXPRESSION!!":q._Stack[S--];let J=0,I="";for(;J<h.length;){const V=h.charAt(J),v=J<h.length-1?h.substring(J,2+J):"";if("("===V)I="",Y(V);else if(")"===V){for(l();-1!==S&&"("!==g();)i.push(B());B()}else if(q._OperatorPriority[v]>1){for(l();-1!==S&&q._OperatorPriority[g()]>=q._OperatorPriority[v];)i.push(B());Y(v),J++}else I+=V;J++}for(l();-1!==S;)"("===g()?B():i.push(B());return q._InfixToPostfixCache.size>=q.InfixToPostfixCacheLimitSize&&q.ClearCache(),q._InfixToPostfixCache.set(h,{result:i,accessTime:Date.now()}),i}static ClearCache(){const h=Array.from(q._InfixToPostfixCache.entries()).sort(((h,V)=>h[1].accessTime-V[1].accessTime));for(let V=0;V<q.InfixToPostfixCacheCleanupSize;V++)q._InfixToPostfixCache.delete(h[V][0])}}q.InfixToPostfixCacheLimitSize=5e4,q.InfixToPostfixCacheCleanupSize=25e3,q._InfixToPostfixCache=new Map,q._OperatorPriority={")":0,"(":1,"||":2,"&&":3},q._Stack=["","","","","","","","","","","","","","","","","","","",""];class B extends q{constructor(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=h,this.not=V}isTrue(h){let V=void 0!==h[this.define];return this.not&&(V=!V),V}}class J extends q{isTrue(h){return this.leftOperand.isTrue(h)||this.rightOperand.isTrue(h)}}class I extends q{isTrue(h){return this.leftOperand.isTrue(h)&&this.rightOperand.isTrue(h)}}class v extends q{constructor(h,V,i){super(),this.define=h,this.operand=V,this.testValue=i}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(h){let V=!1;const i=parseInt(void 0!=h[this.define]?h[this.define]:this.define),S=parseInt(void 0!=h[this.testValue]?h[this.testValue]:this.testValue);if(isNaN(i)||isNaN(S))return!1;switch(this.operand){case">":V=i>S;break;case"<":V=i<S;break;case"<=":V=i<=S;break;case">=":V=i>=S;break;case"==":V=i===S;break;case"!=":V=i!==S}return V}}var s=i(10980),t=i(11017);const T=/defined\s*?\((.+?)\)/g,e=/defined\s*?\[(.+?)\]/g,n=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,c=/__decl__/,f=/light\{X\}.(\w*)/g,P=/\{X\}/g,L=[],U=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function X(h){h.processor&&h.processor.initializeShaders&&h.processor.initializeShaders(h.processingContext)}function D(h,V,i,S){var l;null!==(l=V.processor)&&void 0!==l&&l.preProcessShaderCode&&(h=V.processor.preProcessShaderCode(h,V.isFragment)),m(h,V,(h=>{V.processCodeAfterIncludes&&(h=V.processCodeAfterIncludes(V.isFragment?"fragment":"vertex",h,V.defines));const l=function(h,V,i){let S=function(h,V){var i;if(null!==(i=V.processor)&&void 0!==i&&i.noPrecision)return h;const S=V.shouldUseHighPrecisionShader;-1===h.indexOf("precision highp float")?h=S?"precision highp float;\n"+h:"precision mediump float;\n"+h:S||(h=h.replace("precision highp float","precision mediump float"));return h}(h,V);if(!V.processor)return S;if(0===V.processor.shaderLanguage&&-1!==S.indexOf("#version 3")&&(S=S.replace("#version 300 es",""),!V.processor.parseGLES3))return S;const l=V.defines,Y=j(V,i);V.processor.preProcessor&&(S=V.processor.preProcessor(S,l,Y,V.isFragment,V.processingContext));const g={};S=H(S,Y,V,g),V.processor.postProcessor&&(S=V.processor.postProcessor(S,l,V.isFragment,V.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{},Y,g));null!==i&&void 0!==i&&i._features.needShaderCodeInlining&&(S=i.inlineShaderCode(S));return S}(h,V,S);i(l,h)}))}function O(h,V,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(h,V,i.processingContext):{vertexCode:h,fragmentCode:V}}function o(h){const V=/defined\((.+)\)/.exec(h);if(V&&V.length)return new B(V[1].trim(),"!"===h[0]);const i=["==","!=",">=","<=","<",">"];let S="",l=0;for(S of i)if(l=h.indexOf(S),l>-1)break;if(-1===l)return new B(h);const Y=h.substring(0,l).trim(),g=h.substring(l+S.length).trim();return new v(Y,S,g)}function M(h,V){const i=new g,S=h.substring(0,V);let l=h.substring(V);return l=l.substring(0,(l.indexOf("//")+1||l.length+1)-1).trim(),i.testExpression="#ifdef"===S?new B(l):"#ifndef"===S?new B(l,!0):function(h){h=h.replace(T,"defined[$1]");const V=q.infixToPostfix(h),i=[];for(const l of V)if("||"!==l&&"&&"!==l)i.push(l);else if(i.length>=2){let h=i[i.length-1],V=i[i.length-2];i.length-=2;const S="&&"==l?new I:new J;"string"===typeof h&&(h=h.replace(e,"defined($1)")),"string"===typeof V&&(V=V.replace(e,"defined($1)")),S.leftOperand="string"===typeof V?o(V):V,S.rightOperand="string"===typeof h?o(h):h,i.push(S)}let S=i[i.length-1];return"string"===typeof S&&(S=S.replace(e,"defined($1)")),"string"===typeof S?o(S):S}(l),i}function F(h,V,i,l){let Y=h.currentLine;for(;E(h,i,l);){Y=h.currentLine;const g=Y.substring(0,5).toLowerCase();if("#else"===g){const i=new S;return V.children.push(i),void E(h,i,l)}if("#elif"===g){const h=M(Y,5);V.children.push(h),i=h}}}function E(h,V,i){for(;h.canRead;){h.lineIndex++;const l=h.currentLine;if(l.indexOf("#")>=0){const S=U.exec(l);if(S&&S.length){switch(S[0]){case"#ifdef":{const S=new Y;V.children.push(S);const g=M(l,6);S.children.push(g),F(h,S,g,i);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const S=new Y;V.children.push(S);const g=M(l,7);S.children.push(g),F(h,S,g,i);break}case"#if":{const S=new Y,g=M(l,3);V.children.push(S),S.children.push(g),F(h,S,g,i);break}}continue}}const g=new S;if(g.line=l,V.children.push(g),"#"===l[0]&&"d"===l[1]){const h=l.replace(";","").split(" ");g.additionalDefineKey=h[1],3===h.length&&(g.additionalDefineValue=h[2])}}return!1}function H(h,V,i,Y){const g=new S,q=new l;return q.lineIndex=-1,q.lines=h.split("\n"),E(q,g,Y),g.process(V,i,Y)}function j(h,V){var i;const S=h.defines,l={};for(const Y of S){const h=Y.replace("#define","").replace(";","").trim().split(" ");l[h[0]]=h.length>1?h[1]:""}return 0===(null===(i=h.processor)||void 0===i?void 0:i.shaderLanguage)&&(l.GL_ES="true"),l.__VERSION__=h.version,l[h.platformName]="true",(0,t.j)(l,null===V||void 0===V?void 0:V.isNDCHalfZRange,null===V||void 0===V?void 0:V.useReverseDepthBuffer,null===V||void 0===V?void 0:V.useExactSrgbConversions),l}function m(h,V,i){let S;for(L.length=0;null!==(S=n.exec(h));)L.push(S);let l=String(h),Y=[h],g=!1;for(const q of L){let h=q[1];if(-1!==h.indexOf("__decl__")&&(h=h.replace(c,""),V.supportsUniformBuffers&&(h=h.replace("Vertex","Ubo").replace("Fragment","Ubo")),h+="Declaration"),!V.includesShadersStore[h]){const S=V.shadersRepository+"ShadersInclude/"+h+".fx";return void G.loadFile(S,(S=>{V.includesShadersStore[h]=S,m(Y.join(""),V,i)}))}{let i=V.includesShadersStore[h];if(q[2]){const h=q[3].split(",");for(let V=0;V<h.length;V+=2){const S=new RegExp(h[V],"g"),l=h[V+1];i=i.replace(S,l)}}if(q[4]){const h=q[5];if(-1!==h.indexOf("..")){const S=h.split(".."),l=parseInt(S[0]);let Y=parseInt(S[1]),g=i.slice(0);i="",isNaN(Y)&&(Y=V.indexParameters[S[1]]);for(let h=l;h<Y;h++)V.supportsUniformBuffers||(g=g.replace(f,((h,V)=>V+"{X}"))),i+=g.replace(P,h.toString())+"\n"}else V.supportsUniformBuffers||(i=i.replace(f,((h,V)=>V+"{X}"))),i=i.replace(P,h)}const S=[];for(const h of Y){const V=h.split(q[0]);for(let h=0;h<V.length-1;h++)S.push(V[h]),S.push(i);S.push(V[V.length-1])}Y=S,g=g||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}L.length=0,l=Y.join(""),g?m(l.toString(),V,i):i(l)}const G={loadFile:(h,V,i,S,l,Y)=>{throw(0,s.d)("FileTools")}}},11017:(h,V,i)=>{i.d(V,{d:()=>l,g:()=>Y,j:()=>q,m:()=>g,q:()=>B});var S=i(10980);i(10963);const l={};function Y(h,V){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(V?V+"\n":"")+h}function g(h,V,i,Y,g,q,B){const J=B||l.loadFile;if(J){return J(h,V,i,Y,g,q)}throw(0,S.d)("FileTools")}function q(h,V,i,S){if(h)return V?h.IS_NDC_HALF_ZRANGE="":delete h.IS_NDC_HALF_ZRANGE,i?h.USE_REVERSE_DEPTHBUFFER="":delete h.USE_REVERSE_DEPTHBUFFER,void(S?h.USE_EXACT_SRGB_CONVERSIONS="":delete h.USE_EXACT_SRGB_CONVERSIONS);{let h="";return V&&(h+="#define IS_NDC_HALF_ZRANGE"),i&&(h&&(h+="\n"),h+="#define USE_REVERSE_DEPTHBUFFER"),S&&(h&&(h+="\n"),h+="#define USE_EXACT_SRGB_CONVERSIONS"),h}}function B(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;switch(h){case 3:{const h=(ArrayBuffer,new Int8Array(V));return S&&h.set(new Int8Array(S)),h}case 0:{const h=(ArrayBuffer,new Uint8Array(V));return S&&h.set(new Uint8Array(S)),h}case 4:{const h=V instanceof ArrayBuffer?new Int16Array(V):new Int16Array(i?V/2:V);return S&&h.set(new Int16Array(S)),h}case 5:case 8:case 9:case 10:case 2:{const h=V instanceof ArrayBuffer?new Uint16Array(V):new Uint16Array(i?V/2:V);return S&&h.set(new Uint16Array(S)),h}case 6:{const h=V instanceof ArrayBuffer?new Int32Array(V):new Int32Array(i?V/4:V);return S&&h.set(new Int32Array(S)),h}case 7:case 11:case 12:case 13:case 14:case 15:{const h=V instanceof ArrayBuffer?new Uint32Array(V):new Uint32Array(i?V/4:V);return S&&h.set(new Uint32Array(S)),h}case 1:{const h=V instanceof ArrayBuffer?new Float32Array(V):new Float32Array(i?V/4:V);return S&&h.set(new Float32Array(S)),h}}const l=(ArrayBuffer,new Uint8Array(V));return S&&l.set(new Uint8Array(S)),l}},11042:(h,V,i)=>{i.d(V,{d:()=>S});class S{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersRepository:S.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersStore:S.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.IncludesShadersStore:S.IncludesShadersStoreWGSL}}S.ShadersRepository="src/Shaders/",S.ShadersStore={},S.IncludesShadersStore={},S.ShadersRepositoryWGSL="src/ShadersWGSL/",S.ShadersStoreWGSL={},S.IncludesShadersStoreWGSL={}},11049:(h,V,i)=>{i.d(V,{b:()=>s,e:()=>P,i:()=>T,k:()=>t,o:()=>e,p:()=>f,t:()=>v,u:()=>J,x:()=>I,z:()=>B,B:()=>q});class S{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.eV._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(h){h&&this.program&&h(this.program)}setEngine(h){this.eV=h}_fillEffectInformation(h,V,i,S,l,Y,g,q){const B=this.eV;if(B.supportsUniformBuffers)for(const I in V)h.bindUniformBlock(I,V[I]);let J;for(this.eV.getUniforms(this,i).forEach(((h,V)=>{S[i[V]]=h})),this._uniforms=S,J=0;J<l.length;J++){null==h.getUniform(l[J])&&(l.splice(J,1),J--)}l.forEach(((h,V)=>{Y[h]=V}));for(const I of B.getAttributes(this,g))q.push(I)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(h,V){const i=this._valueCache[h],S=V.updateFlag;return(void 0===i||i!==S)&&(this._valueCache[h]=S,!0)}_cacheFloat2(h,V,i){let S=this._valueCache[h];if(!S||2!==S.length)return S=[V,i],this._valueCache[h]=S,!0;let l=!1;return S[0]!==V&&(S[0]=V,l=!0),S[1]!==i&&(S[1]=i,l=!0),l}_cacheFloat3(h,V,i,S){let l=this._valueCache[h];if(!l||3!==l.length)return l=[V,i,S],this._valueCache[h]=l,!0;let Y=!1;return l[0]!==V&&(l[0]=V,Y=!0),l[1]!==i&&(l[1]=i,Y=!0),l[2]!==S&&(l[2]=S,Y=!0),Y}_cacheFloat4(h,V,i,S,l){let Y=this._valueCache[h];if(!Y||4!==Y.length)return Y=[V,i,S,l],this._valueCache[h]=Y,!0;let g=!1;return Y[0]!==V&&(Y[0]=V,g=!0),Y[1]!==i&&(Y[1]=i,g=!0),Y[2]!==S&&(Y[2]=S,g=!0),Y[3]!==l&&(Y[3]=l,g=!0),g}setInt(h,V){const i=this._valueCache[h];void 0!==i&&i===V||this.eV.setInt(this._uniforms[h],V)&&(this._valueCache[h]=V)}setInt2(h,V,i){this._cacheFloat2(h,V,i)&&(this.eV.setInt2(this._uniforms[h],V,i)||(this._valueCache[h]=null))}setInt3(h,V,i,S){this._cacheFloat3(h,V,i,S)&&(this.eV.setInt3(this._uniforms[h],V,i,S)||(this._valueCache[h]=null))}setInt4(h,V,i,S,l){this._cacheFloat4(h,V,i,S,l)&&(this.eV.setInt4(this._uniforms[h],V,i,S,l)||(this._valueCache[h]=null))}setIntArray(h,V){this._valueCache[h]=null,this.eV.setIntArray(this._uniforms[h],V)}setIntArray2(h,V){this._valueCache[h]=null,this.eV.setIntArray2(this._uniforms[h],V)}setIntArray3(h,V){this._valueCache[h]=null,this.eV.setIntArray3(this._uniforms[h],V)}setIntArray4(h,V){this._valueCache[h]=null,this.eV.setIntArray4(this._uniforms[h],V)}setUInt(h,V){const i=this._valueCache[h];void 0!==i&&i===V||this.eV.setUInt(this._uniforms[h],V)&&(this._valueCache[h]=V)}setUInt2(h,V,i){this._cacheFloat2(h,V,i)&&(this.eV.setUInt2(this._uniforms[h],V,i)||(this._valueCache[h]=null))}setUInt3(h,V,i,S){this._cacheFloat3(h,V,i,S)&&(this.eV.setUInt3(this._uniforms[h],V,i,S)||(this._valueCache[h]=null))}setUInt4(h,V,i,S,l){this._cacheFloat4(h,V,i,S,l)&&(this.eV.setUInt4(this._uniforms[h],V,i,S,l)||(this._valueCache[h]=null))}setUIntArray(h,V){this._valueCache[h]=null,this.eV.setUIntArray(this._uniforms[h],V)}setUIntArray2(h,V){this._valueCache[h]=null,this.eV.setUIntArray2(this._uniforms[h],V)}setUIntArray3(h,V){this._valueCache[h]=null,this.eV.setUIntArray3(this._uniforms[h],V)}setUIntArray4(h,V){this._valueCache[h]=null,this.eV.setUIntArray4(this._uniforms[h],V)}setArray(h,V){this._valueCache[h]=null,this.eV.setArray(this._uniforms[h],V)}setArray2(h,V){this._valueCache[h]=null,this.eV.setArray2(this._uniforms[h],V)}setArray3(h,V){this._valueCache[h]=null,this.eV.setArray3(this._uniforms[h],V)}setArray4(h,V){this._valueCache[h]=null,this.eV.setArray4(this._uniforms[h],V)}setMatrices(h,V){V&&(this._valueCache[h]=null,this.eV.setMatrices(this._uniforms[h],V))}setMatrix(h,V){this._cacheMatrix(h,V)&&(this.eV.setMatrices(this._uniforms[h],V.Ng())||(this._valueCache[h]=null))}setMatrix3x3(h,V){this._valueCache[h]=null,this.eV.setMatrix3x3(this._uniforms[h],V)}setMatrix2x2(h,V){this._valueCache[h]=null,this.eV.setMatrix2x2(this._uniforms[h],V)}setFloat(h,V){const i=this._valueCache[h];void 0!==i&&i===V||this.eV.setFloat(this._uniforms[h],V)&&(this._valueCache[h]=V)}setVector2(h,V){this._cacheFloat2(h,V.x,V.y)&&(this.eV.setFloat2(this._uniforms[h],V.x,V.y)||(this._valueCache[h]=null))}setFloat2(h,V,i){this._cacheFloat2(h,V,i)&&(this.eV.setFloat2(this._uniforms[h],V,i)||(this._valueCache[h]=null))}setVector3(h,V){this._cacheFloat3(h,V.x,V.y,V.z)&&(this.eV.setFloat3(this._uniforms[h],V.x,V.y,V.z)||(this._valueCache[h]=null))}setFloat3(h,V,i,S){this._cacheFloat3(h,V,i,S)&&(this.eV.setFloat3(this._uniforms[h],V,i,S)||(this._valueCache[h]=null))}setVector4(h,V){this._cacheFloat4(h,V.x,V.y,V.z,V.w)&&(this.eV.setFloat4(this._uniforms[h],V.x,V.y,V.z,V.w)||(this._valueCache[h]=null))}setQuaternion(h,V){this._cacheFloat4(h,V.x,V.y,V.z,V.w)&&(this.eV.setFloat4(this._uniforms[h],V.x,V.y,V.z,V.w)||(this._valueCache[h]=null))}setFloat4(h,V,i,S,l){this._cacheFloat4(h,V,i,S,l)&&(this.eV.setFloat4(this._uniforms[h],V,i,S,l)||(this._valueCache[h]=null))}setColor3(h,V){this._cacheFloat3(h,V.r,V.g,V.b)&&(this.eV.setFloat3(this._uniforms[h],V.r,V.g,V.b)||(this._valueCache[h]=null))}setColor4(h,V,i){this._cacheFloat4(h,V.r,V.g,V.b,i)&&(this.eV.setFloat4(this._uniforms[h],V.r,V.g,V.b,i)||(this._valueCache[h]=null))}setDirectColor4(h,V){this._cacheFloat4(h,V.r,V.g,V.b,V.a)&&(this.eV.setFloat4(this._uniforms[h],V.r,V.g,V.b,V.a)||(this._valueCache[h]=null))}_getVertexShaderCode(){return this.vertexShader?this.eV._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.eV._getShaderSource(this.fragmentShader):null}}var l=i(11017);const Y=new WeakMap,g={_webGLVersion:2,cachedPipelines:{}};function q(h){let V=Y.get(h);if(!V){if(!h)return g;V={_webGLVersion:h.TEXTURE_BINDING_3D?2:1,_context:h,parallelShaderCompile:h.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Y.set(h,V)}return V}function B(h){Y.delete(h)}function J(h,V,i,S,l,Y){const g=q(S);Y||(Y=g._createShaderProgramInjection??s);return Y(h,c(V,"vertex",S,g._contextWasLost),c(i,"fragment",S,g._contextWasLost),S,l,g.validateShaderPrograms)}function I(h,V,i,S,l){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0;const B=q(l);g||(g=B._createShaderProgramInjection??s);const J=B._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return g(h,n(V,"vertex",S,J,l,B._contextWasLost),n(i,"fragment",S,J,l,B._contextWasLost),l,Y,B.validateShaderPrograms)}function v(h,V){const i=new S,l=q(h);return l.parallelShaderCompile&&!l.disableParallelShaderCompile&&(i.isParallelCompiled=!0),i.context=l._context,i}function s(h,V,i,S){let l=arguments.length>5?arguments[5]:void 0;const Y=S.createProgram();if(h.program=Y,!Y)throw new Error("Unable to create program");return S.attachShader(Y,V),S.attachShader(Y,i),S.linkProgram(Y),h.context=S,h.vertexShader=V,h.fragmentShader=i,h.isParallelCompiled||T(h,S,l),Y}function t(h,V,i){const S=h;if(S._isDisposed)return!1;const l=q(V);return!!(l&&l.parallelShaderCompile&&l.parallelShaderCompile.COMPLETION_STATUS_KHR&&S.program&&V.getProgramParameter(S.program,l.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(T(S,V,i),!0)}function T(h,V,i){const S=h.context,l=h.vertexShader,Y=h.fragmentShader,g=h.program;if(!S.getProgramParameter(g,S.LINK_STATUS)){if(!V.getShaderParameter(l,V.COMPILE_STATUS)){const i=V.getShaderInfoLog(l);if(i)throw h.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!V.getShaderParameter(Y,V.COMPILE_STATUS)){const i=V.getShaderInfoLog(Y);if(i)throw h.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=S.getProgramInfoLog(g);if(i)throw h.programLinkError=i,new Error(i)}if(i){S.validateProgram(g);if(!S.getProgramParameter(g,S.VALIDATE_STATUS)){const V=S.getProgramInfoLog(g);if(V)throw h.programValidationError=V,new Error(V)}}S.deleteShader(l),S.deleteShader(Y),h.vertexShader=void 0,h.fragmentShader=void 0,h.onCompiled&&(h.onCompiled(),h.onCompiled=void 0)}function e(h,V,i,S,l,Y,g,B,v){let s=arguments.length>10?arguments[10]:void 0,t=arguments.length>11?arguments[11]:void 0,T=arguments.length>12?arguments[12]:void 0;const e=q(h.context);t||(t=e.createRawShaderProgramInjection??J),T||(T=e.createShaderProgramInjection??I);const n=h;n.program=S?t(n,V,i,n.context,v):T(n,V,i,B,n.context,v),n.program.__SPECTOR_rebuildProgram=g,s()}function n(h,V,i,S,Y,g){return c((0,l.g)(h,i,S),V,Y,g)}function c(h,V,i,S){const l=i.createShader("vertex"===V?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!l){let h=i.NO_ERROR,l=i.NO_ERROR;for(;(l=i.getError())!==i.NO_ERROR;)h=l;throw new Error(`Something went wrong while creating a gl ${V} shader object. gl error=${h}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${S}`)}return i.shaderSource(l,h),i.compileShader(l),l}function f(h,V){V.useProgram(h)}function P(h,V){const i=h;if(!i.isParallelCompiled)return void V(h);const S=i.onCompiled;i.onCompiled=()=>{null===S||void 0===S||S(),V(h)}}},11044:(h,V,i)=>{i.d(V,{e:()=>v,g:()=>t,j:()=>J,l:()=>I});var S=i(10963),l=i(11049),Y=i(11042),g=i(10967),q=i(11015),B=i(11017);function J(h,V){return(0,l.B)(V).cachedPipelines[h]}function I(h){const V=h._name,i=h.context;if(V&&i){const h=(0,l.B)(i),S=h.cachedPipelines[V];null===S||void 0===S||S.dispose(),delete h.cachedPipelines[V]}}function v(h,V,i,l,Y,g,B){let J,I;const v=(0,S.j)()?null===g||void 0===g?void 0:g.getHostDocument():null;J="string"===typeof V?V:V.vertexSource?"source:"+V.vertexSource:V.vertexElement?(null===v||void 0===v?void 0:v.getElementById(V.vertexElement))||V.vertexElement:V.vertex||V,I="string"===typeof V?V:V.fragmentSource?"source:"+V.fragmentSource:V.fragmentElement?(null===v||void 0===v?void 0:v.getElementById(V.fragmentElement))||V.fragmentElement:V.fragment||V;const t=[void 0,void 0],T=()=>{if(t[0]&&t[1]){h.isFragment=!0;const[S,J]=t;(0,q.j)(J,h,((g,J)=>{B&&(B._fragmentSourceCodeBeforeMigration=J),i&&(g=i("fragment",g));const I=(0,q.c)(S,g,h);h=null;const v=function(h,V,i,S){if(i){return{vertexSourceCode:(1===S?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+h,fragmentSourceCode:(1===S?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+V}}return{vertexSourceCode:h,fragmentSourceCode:V}}(I.vertexCode,I.fragmentCode,V,Y);null===l||void 0===l||l(v.vertexSourceCode,v.fragmentSourceCode)}),g)}};s(J,"Vertex","",(V=>{(0,q.e)(h),(0,q.j)(V,h,((h,S)=>{B&&(B._rawVertexSourceCode=V,B._vertexSourceCodeBeforeMigration=S),i&&(h=i("vertex",h)),t[0]=h,T()}),g)}),Y),s(I,"Fragment","Pixel",(h=>{B&&(B._rawFragmentSourceCode=h),t[1]=h,T()}),Y)}function s(h,V,i,l,g,q){if("undefined"!==typeof HTMLElement&&h instanceof HTMLElement){return void l((0,S.b)(h))}if("source:"===h.substring(0,7))return void l(h.substring(7));if("base64:"===h.substring(0,7)){return void l(window.atob(h.substring(7)))}const J=Y.d.GetShadersStore(g);if(J[h+V+"Shader"])return void l(J[h+V+"Shader"]);if(i&&J[h+i+"Shader"])return void l(J[h+i+"Shader"]);let I;if(I="."===h[0]||"/"===h[0]||h.indexOf("http")>-1?h:Y.d.GetShadersRepository(g)+h,!(q=q||B.m))throw new Error("loadFileInjection is not defined");q(I+"."+V.toLowerCase()+".fx",l)}const t=(h,V,i,S)=>{try{const Y=h.context?(0,l.B)(h.context):null;Y&&(Y.disableParallelShaderCompile=h.disableParallelCompilation);const g=h.existingPipelineContext||V(h.shaderProcessingContext);return g._name=h.name,h.name&&Y&&(Y.cachedPipelines[h.name]=g),i(g,h.vertex,h.fragment,!!h.createAsRaw,"","",h.rebuildRebind,h.defines,h.transformFeedbackVaryings,"",(()=>{S(g,(()=>{var V;null===(V=h.onRenderingStateCompiled)||void 0===V||V.call(h,g)}))})),g}catch(Y){throw g.d.Error("Error compiling effect"),Y}}},11037:(h,V,i)=>{i.r(V),i.d(V,{Effect:()=>B});var S=i(10960),l=i(10967),Y=i(11042),g=i(11044),q=i(11021);class B{static get ShadersRepository(){return Y.d.ShadersRepository}static set ShadersRepository(h){Y.d.ShadersRepository=h}get B(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,s=arguments.length>9?arguments[9]:void 0,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,e=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new S.d,this.onErrorObservable=new S.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=h,this._key=t;const n=this._key.replace(/\r/g,"").replace(/\n/g,"|");let c;if(V.attributes){const h=V;if(this._engine=i,this._attributesNames=h.attributes,this._uniformsNames=h.uniformsNames.concat(h.samplers),this._samplerList=h.samplers.slice(),this.defines=h.defines,this.onError=h.onError,this.onCompiled=h.onCompiled,this._fallbacks=h.fallbacks,this._indexParameters=h.indexParameters,this._transformFeedbackVaryings=h.transformFeedbackVaryings||null,this._multiTarget=!!h.multiTarget,this._shaderLanguage=h.shaderLanguage??0,this._disableParallelShaderCompilation=!!h.disableParallelShaderCompilation,h.uniformBuffersNames){this._uniformBuffersNamesList=h.uniformBuffersNames.slice();for(let V=0;V<h.uniformBuffersNames.length;V++)this._uniformBuffersNames[h.uniformBuffersNames[V]]=V}this._processFinalCode=h.processFinalCode??null,this._processCodeAfterIncludes=h.processCodeAfterIncludes??void 0,e=h.extraInitializationsAsync,c=h.existingPipelineContext}else this._engine=Y,this.defines=null==q?"":q,this._uniformsNames=i.concat(l),this._samplerList=l?l.slice():[],this._attributesNames=V,this._uniformBuffersNamesList=[],this._shaderLanguage=T,this.onError=v,this.onCompiled=I,this._indexParameters=s,this._fallbacks=J;"WEBGL2"===this._engine.shaderPlatformName&&(c=(0,g.j)(n,this._engine._gl)??c),this._attributeLocationByName={},this.uniqueId=B._UniqueIdSeed++,c?(this._pipelineContext=c,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,e),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.B||this.dispose(!0)}))}async _processShaderCodeAsync(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0;S&&await S(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const l={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:h??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Y.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:Y.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,g.e)(l,this.name,this._processFinalCode,((h,i)=>{this._vertexSourceCode=h,this._fragmentSourceCode=i,this._prepareEffect(V)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.B||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(h){return this._attributes[h]}getAttributeLocationByName(h){return this._attributeLocationByName[h]}getAttributesCount(){return this._attributes.length}getUniformIndex(h){return this._uniformsNames.indexOf(h)}getUniform(h){return this._uniforms[h]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((h=>{this.executeWhenCompiled(h)}))}executeWhenCompiled(h){this.isReady()?h(this):(this.onCompileObservable.add((V=>{h(V)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(h){(0,q.h)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(V=>{this._processCompilationErrors(V,h)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(h=this._pipelineContext)||void 0===h?void 0:h._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(h=this._pipelineContext)||void 0===h?void 0:h._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(h,V,i,S){this._isReady=!1,this._vertexSourceCodeOverride=h,this._fragmentSourceCodeOverride=V,this.onError=(h,V)=>{S&&S(V)},this.onCompiled=()=>{var h,V;const S=this.getEngine().scenes;if(S)for(let i=0;i<S.length;i++)S[i].markAllMaterialsAsDirty(127);null===(h=(V=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===h||h.call(V,i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(h){if(this._pipelineContext=h,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let V=0;V<this._attributesNames.length;V++){const h=this._attributesNames[V];this._attributeLocationByName[h]=this._attributes[V]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),B.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),S=i?null:this.defines,l=i?this._vertexSourceCodeOverride:this._vertexSourceCode,Y=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,q=this._engine;this._pipelineContext=(0,g.g)({existingPipelineContext:h?V:null,vertex:l,fragment:Y,context:"WEBGL2"===q.shaderPlatformName||"WEBGL1"===q.shaderPlatformName?q._gl:void 0,rebuildRebind:(h,V,i,S)=>this._rebuildProgram(h,V,i,S),defines:S,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{V&&!h&&this._engine._deletePipelineContext(V),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(V)}catch(i){this._processCompilationErrors(i,V)}}_getShaderCodeAndErrorLine(h,V,i){const S=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let l=null;if(V&&h){const Y=V.match(S);if(Y&&2===Y.length){const V=parseInt(Y[1]),S=h.split("\n",-1);S.length>=V&&(l=`Offending line [${V}] in ${i?"fragment":"vertex"} code: ${S[V-1]}`)}}return[h,l]}_processCompilationErrors(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=h.message;const i=this._attributesNames,S=this._fallbacks;if(l.d.Error("Unable to compile effect:"),l.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),l.d.Error(`Attributes: ${i.join(" ")}`),l.d.Error("Defines:\n"+this.defines),B.LogShaderCodeOnCompilationError){var Y,g;let h=null,V=null,i=null;var q;if(null!==(Y=this._pipelineContext)&&void 0!==Y&&Y._getVertexShaderCode()&&([i,h]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(l.d.Error("Vertex code:"),l.d.Error(i))),null!==(g=this._pipelineContext)&&void 0!==g&&g._getFragmentShaderCode())[i,V]=this._getShaderCodeAndErrorLine(null===(q=this._pipelineContext)||void 0===q?void 0:q._getFragmentShaderCode(),this._compilationError,!0),i&&(l.d.Error("Fragment code:"),l.d.Error(i));h&&l.d.Error(h),V&&l.d.Error(V)}l.d.Error("Error: "+this._compilationError);const J=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};V&&(this._pipelineContext=V,this._isReady=!0,J()),S?(this._pipelineContext=null,S.hasMoreFallbacks?(this._allFallbacksProcessed=!1,l.d.Error("Trying next fallback."),this.defines=S.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,J(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,V||J())}get isSupported(){return""===this._compilationError}_bindTexture(h,V){this._engine._bindTexture(this._samplers[h],V,h)}setTexture(h,V){this._engine.setTexture(this._samplers[h],this._uniforms[h],V,h)}setTextureArray(h,V){const i=h+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const S=this._samplerList.indexOf(h);for(let h=1;h<V.length;h++){const V=i+(h-1).toString();this._samplerList.splice(S+h,0,V)}let l=0;for(const h of this._samplerList)this._samplers[h]=l,l+=1}this._engine.setTextureArray(this._samplers[h],this._uniforms[h],V,h)}bindUniformBuffer(h,V){const i=this._uniformBuffersNames[V];void 0===i||B._BaseCache[i]===h&&this._engine._features.useUBOBindingCache||(B._BaseCache[i]=h,this._engine.bindUniformBufferBase(h,i,V))}bindUniformBlock(h,V){this._engine.bindUniformBlock(this._pipelineContext,h,V)}setInt(h,V){return this._pipelineContext.setInt(h,V),this}setInt2(h,V,i){return this._pipelineContext.setInt2(h,V,i),this}setInt3(h,V,i,S){return this._pipelineContext.setInt3(h,V,i,S),this}setInt4(h,V,i,S,l){return this._pipelineContext.setInt4(h,V,i,S,l),this}setIntArray(h,V){return this._pipelineContext.setIntArray(h,V),this}setIntArray2(h,V){return this._pipelineContext.setIntArray2(h,V),this}setIntArray3(h,V){return this._pipelineContext.setIntArray3(h,V),this}setIntArray4(h,V){return this._pipelineContext.setIntArray4(h,V),this}setUInt(h,V){return this._pipelineContext.setUInt(h,V),this}setUInt2(h,V,i){return this._pipelineContext.setUInt2(h,V,i),this}setUInt3(h,V,i,S){return this._pipelineContext.setUInt3(h,V,i,S),this}setUInt4(h,V,i,S,l){return this._pipelineContext.setUInt4(h,V,i,S,l),this}setUIntArray(h,V){return this._pipelineContext.setUIntArray(h,V),this}setUIntArray2(h,V){return this._pipelineContext.setUIntArray2(h,V),this}setUIntArray3(h,V){return this._pipelineContext.setUIntArray3(h,V),this}setUIntArray4(h,V){return this._pipelineContext.setUIntArray4(h,V),this}setFloatArray(h,V){return this._pipelineContext.setArray(h,V),this}setFloatArray2(h,V){return this._pipelineContext.setArray2(h,V),this}setFloatArray3(h,V){return this._pipelineContext.setArray3(h,V),this}setFloatArray4(h,V){return this._pipelineContext.setArray4(h,V),this}setArray(h,V){return this._pipelineContext.setArray(h,V),this}setArray2(h,V){return this._pipelineContext.setArray2(h,V),this}setArray3(h,V){return this._pipelineContext.setArray3(h,V),this}setArray4(h,V){return this._pipelineContext.setArray4(h,V),this}setMatrices(h,V){return this._pipelineContext.setMatrices(h,V),this}setMatrix(h,V){return this._pipelineContext.setMatrix(h,V),this}setMatrix3x3(h,V){return this._pipelineContext.setMatrix3x3(h,V),this}setMatrix2x2(h,V){return this._pipelineContext.setMatrix2x2(h,V),this}setFloat(h,V){return this._pipelineContext.setFloat(h,V),this}setBool(h,V){return this._pipelineContext.setInt(h,V?1:0),this}setVector2(h,V){return this._pipelineContext.setVector2(h,V),this}setFloat2(h,V,i){return this._pipelineContext.setFloat2(h,V,i),this}setVector3(h,V){return this._pipelineContext.setVector3(h,V),this}setFloat3(h,V,i,S){return this._pipelineContext.setFloat3(h,V,i,S),this}setVector4(h,V){return this._pipelineContext.setVector4(h,V),this}setQuaternion(h,V){return this._pipelineContext.setQuaternion(h,V),this}setFloat4(h,V,i,S,l){return this._pipelineContext.setFloat4(h,V,i,S,l),this}setColor3(h,V){return this._pipelineContext.setColor3(h,V),this}setColor4(h,V,i){return this._pipelineContext.setColor4(h,V,i),this}setDirectColor4(h,V){return this._pipelineContext.setDirectColor4(h,V),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(B.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,g.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;V&&(Y.d.GetShadersStore(S)[`${h}PixelShader`]=V),i&&(Y.d.GetShadersStore(S)[`${h}VertexShader`]=i)}static ResetCache(){B._BaseCache={}}}B.LogShaderCodeOnCompilationError=!0,B.PersistentMode=!1,B.AutomaticallyClearCodeCache=!1,B._UniqueIdSeed=0,B._BaseCache={},B.ShadersStore=Y.d.ShadersStore,B.IncludesShadersStore=Y.d.IncludesShadersStore},10980:(h,V,i)=>{i.d(V,{d:()=>l});const S={};function l(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!S[h])return S[h]=!0,`${h} needs to be imported before as it contains a side-effect required by your code.`}},10963:(h,V,i)=>{function S(){return"undefined"!==typeof window}function l(){return"undefined"!==typeof navigator}function Y(){return"undefined"!==typeof document}function g(h){let V="",i=h.firstChild;for(;i;)3===i.nodeType&&(V+=i.textContent),i=i.nextSibling;return V}i.d(V,{b:()=>g,e:()=>Y,h:()=>l,j:()=>S})},10967:(h,V,i)=>{i.d(V,{d:()=>S});class S{static _CheckLimit(h,V){let i=S._LogLimitOutputs[h];return i?i.current++:(i={limit:V,current:1},S._LogLimitOutputs[h]=i),i.current<=i.limit}static _GenerateLimitMessage(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=S._LogLimitOutputs[h];if(!i||!S.MessageLimitReached)return;const l=this._Levels[V];i.current===i.limit&&S[l.name](S.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,l.name??""))}static _AddLogEntry(h){S._LogCache=h+S._LogCache,S.OnNewCacheEntry&&S.OnNewCacheEntry(h)}static _FormatMessage(h){const V=h=>h<10?"0"+h:""+h,i=new Date;return"["+V(i.getHours())+":"+V(i.getMinutes())+":"+V(i.getSeconds())+"]: "+h}static _LogDisabled(h,V){}static _LogEnabled(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const l=Array.isArray(V)?V[0]:V;if(void 0!==i&&!S._CheckLimit(l,i))return;const Y=S._FormatMessage(l),g=this._Levels[h],q=Array.isArray(V)?V.slice(1):[];g.logFunc&&g.logFunc("BJS - "+Y,...q);const B=`<div style='color:${g.color}'>${Y}</div><br>`;S._AddLogEntry(B),S._GenerateLimitMessage(l,h)}static get LogCache(){return S._LogCache}static ClearLogCache(){S._LogCache="",S._LogLimitOutputs={},S.errorsCount=0}static set LogLevels(h){S.Log=S._LogDisabled,S.Warn=S._LogDisabled,S.Error=S._LogDisabled;const V=[S.MessageLogLevel,S.WarningLogLevel,S.ErrorLogLevel];for(const i of V)if((h&i)===i){const h=this._Levels[i];S[h.name]=S._LogEnabled.bind(S,i)}}}S.NoneLogLevel=0,S.MessageLogLevel=1,S.WarningLogLevel=2,S.ErrorLogLevel=4,S.AllLogLevel=7,S.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",S._LogCache="",S._LogLimitOutputs={},S._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],S.errorsCount=0,S.Log=S._LogEnabled.bind(S,S.MessageLogLevel),S.Warn=S._LogEnabled.bind(S,S.WarningLogLevel),S.Error=S._LogEnabled.bind(S,S.ErrorLogLevel)},10960:(h,V,i)=>{i.d(V,{d:()=>g});const S="undefined"!==typeof WeakRef;class l{constructor(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.initialize(h,V,i,S)}initialize(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;return this.mask=h,this.skipNextObservers=V,this.target=i,this.currentTarget=S,this}}class Y{constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=h,this.mask=V,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(h)}}class g{static FromPromise(h,V){const i=new g;return h.then((h=>{i.notifyObservers(h)})).catch((h=>{if(!V)throw h;V.notifyObservers(h)})),i}get observers(){return this._observers}constructor(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=V,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new l(0),h&&(this._onObserverAdded=h)}add(h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!h)return null;const l=new Y(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);l.unregisterOnNextCall=i,V?this._observers.unshift(l):this._observers.push(l),this._onObserverAdded&&this._onObserverAdded(l),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(l,this._lastNotifiedValue);const g=S?new WeakRef(this):{deref:()=>this};return l._remove=function(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=g.deref();V&&(h?V.remove(l):V._remove(l))},l}addOnce(h){return this.add(h,void 0,void 0,void 0,!0)}remove(h){if(!h)return!1;h._remove=null;return-1!==this._observers.indexOf(h)&&(this._deferUnregister(h),!0)}removeCallback(h,V){for(let i=0;i<this._observers.length;i++){const S=this._observers[i];if(!S._willBeUnregistered&&(S.callback===h&&(!V||V===S.scope)))return this._deferUnregister(S),!0}return!1}_deferUnregister(h){h._willBeUnregistered||(this._numObserversMarkedAsDeleted++,h.unregisterOnNextCall=!1,h._willBeUnregistered=!0,setTimeout((()=>{this._remove(h)}),0))}_remove(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h)return!1;const i=this._observers.indexOf(h);return-1!==i&&(V&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(h){this._remove(h,!1),this._observers.unshift(h)}makeObserverBottomPriority(h){this._remove(h,!1),this._observers.push(h)}notifyObservers(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=h),!this._observers.length)return!0;const Y=this._eventState;Y.mask=V,Y.target=i,Y.currentTarget=S,Y.skipNextObservers=!1,Y.lastReturnValue=h,Y.userInfo=l;for(const g of this._observers)if(!g._willBeUnregistered&&(g.mask&V&&(g.unregisterOnNextCall&&this._deferUnregister(g),g.scope?Y.lastReturnValue=g.callback.apply(g.scope,[h,Y]):Y.lastReturnValue=g.callback(h,Y)),Y.skipNextObservers))return!1;return!0}notifyObserver(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),h._willBeUnregistered)return;const S=this._eventState;S.mask=i,S.skipNextObservers=!1,h.unregisterOnNextCall&&this._deferUnregister(h),h.callback(V,S)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const h=this._observers.pop();h&&(h._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const h=new g;return h._observers=this._observers.slice(0),h}hasSpecificMask(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const V of this._observers)if(V.mask&h||V.mask===h)return!0;return!1}}},11021:(h,V,i)=>{i.d(V,{d:()=>l,h:()=>g});let S=[];class l{static SetImmediate(h){0===S.length&&setTimeout((()=>{const h=S;S=[];for(const V of h)V()}),1),S.push(h)}}function Y(h,V,i){try{if(h())return V(),!0}catch(S){return null===i||void 0===i||i(S),!0}return!1}const g=function(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,g=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&Y(h,V,i))return null;const q=setInterval((()=>{Y(h,V,i)?clearInterval(q):(l-=S,l<0&&(clearInterval(q),null===i||void 0===i||i(new Error("Operation timed out after maximum retries. "+(g||"")),!0)))}),S);return()=>clearInterval(q)}}}]);