"use strict";(self.pp3k1ov3ibi=self.pp3k1ov3ibi||[]).push([[9],{12249:(M,Z,P)=>{P.d(Z,{c:()=>l,g:()=>F,o:()=>D,k:()=>W,q:()=>k});class x{constructor(){this.children=[]}isValid(M){return!0}process(M,Z,P){let x="";if(this.line){let P=this.line;const d=Z.processor;if(d){var c,w,v,G,mM,K;d.lineProcessor&&(P=d.lineProcessor(P,Z.isFragment,Z.processingContext));const x=(null===(c=Z.processor)||void 0===c?void 0:c.attributeKeywordName)??"attribute",O=Z.isFragment&&null!==(w=Z.processor)&&void 0!==w&&w.varyingFragmentKeywordName?null===(v=Z.processor)||void 0===v?void 0:v.varyingFragmentKeywordName:!Z.isFragment&&null!==(G=Z.processor)&&void 0!==G&&G.varyingVertexKeywordName?null===(mM=Z.processor)||void 0===mM?void 0:mM.varyingVertexKeywordName:"varying";if(!Z.isFragment&&d.attributeProcessor&&this.line.startsWith(x))P=d.attributeProcessor(this.line,M,Z.processingContext);else if(d.varyingProcessor&&(null!==(K=d.varyingCheck)&&void 0!==K&&K.call(d,this.line,Z.isFragment)||!d.varyingCheck&&this.line.startsWith(O)))P=d.varyingProcessor(this.line,Z.isFragment,M,Z.processingContext);else if(d.uniformProcessor&&d.uniformRegexp&&d.uniformRegexp.test(this.line))Z.lookForClosingBracketForUniformBuffer||(P=d.uniformProcessor(this.line,Z.isFragment,M,Z.processingContext));else if(d.uniformBufferProcessor&&d.uniformBufferRegexp&&d.uniformBufferRegexp.test(this.line))Z.lookForClosingBracketForUniformBuffer||(P=d.uniformBufferProcessor(this.line,Z.isFragment,Z.processingContext),Z.lookForClosingBracketForUniformBuffer=!0);else if(d.textureProcessor&&d.textureRegexp&&d.textureRegexp.test(this.line))P=d.textureProcessor(this.line,Z.isFragment,M,Z.processingContext);else if((d.uniformProcessor||d.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!Z.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?d.uniformProcessor&&(P=d.uniformProcessor(this.line,Z.isFragment,M,Z.processingContext)):d.uniformBufferProcessor&&(P=d.uniformBufferProcessor(this.line,Z.isFragment,Z.processingContext),Z.lookForClosingBracketForUniformBuffer=!0)}Z.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(Z.lookForClosingBracketForUniformBuffer=!1,d.endOfUniformBufferProcessor&&(P=d.endOfUniformBufferProcessor(this.line,Z.isFragment,Z.processingContext)))}x+=P+"\n"}for(const d of this.children)x+=d.process(M,Z,P);return this.additionalDefineKey&&(M[this.additionalDefineKey]=this.additionalDefineValue||"true",P[this.additionalDefineKey]=M[this.additionalDefineKey]),x}}class c{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(M){this._lines.length=0;for(const Z of M){if(!Z||"\r"===Z)continue;if("#"===Z[0]){this._lines.push(Z);continue}const M=Z.trim();if(!M)continue;if(M.startsWith("//")){this._lines.push(Z);continue}const P=M.indexOf(";");if(-1===P)this._lines.push(M);else if(P===M.length-1)M.length>1&&this._lines.push(M);else{const M=Z.split(";");for(let Z=0;Z<M.length;Z++){let P=M[Z];P&&(P=P.trim(),P&&this._lines.push(P+(Z!==M.length-1?";":"")))}}}}}class w extends x{process(M,Z,P){for(let x=0;x<this.children.length;x++){const c=this.children[x];if(c.isValid(M))return c.process(M,Z,P)}return""}}class v extends x{isValid(M){return this.testExpression.isTrue(M)}}class G{isTrue(M){return!0}static postfixToInfix(M){const Z=[];for(const P of M)if(void 0===G._OperatorPriority[P])Z.push(P);else{const M=Z[Z.length-1],x=Z[Z.length-2];Z.length-=2,Z.push(`(${x}${P}${M})`)}return Z[Z.length-1]}static infixToPostfix(M){const Z=G._InfixToPostfixCache.get(M);if(Z)return Z.accessTime=Date.now(),Z.result;if(!M.includes("&&")&&!M.includes("||")&&!M.includes(")")&&!M.includes("("))return[M];const P=[];let x=-1;const c=()=>{d=d.trim(),""!==d&&(P.push(d),d="")},w=M=>{x<G._Stack.length-1&&(G._Stack[++x]=M)},v=()=>G._Stack[x],mM=()=>-1===x?"!!INVALID EXPRESSION!!":G._Stack[x--];let K=0,d="";for(;K<M.length;){const Z=M.charAt(K),O=K<M.length-1?M.substring(K,2+K):"";if("("===Z)d="",w(Z);else if(")"===Z){for(c();-1!==x&&"("!==v();)P.push(mM());mM()}else if(G._OperatorPriority[O]>1){for(c();-1!==x&&G._OperatorPriority[v()]>=G._OperatorPriority[O];)P.push(mM());w(O),K++}else d+=Z;K++}for(c();-1!==x;)"("===v()?mM():P.push(mM());return G._InfixToPostfixCache.size>=G.InfixToPostfixCacheLimitSize&&G.ClearCache(),G._InfixToPostfixCache.set(M,{result:P,accessTime:Date.now()}),P}static ClearCache(){const M=Array.from(G._InfixToPostfixCache.entries()).sort(((M,Z)=>M[1].accessTime-Z[1].accessTime));for(let Z=0;Z<G.InfixToPostfixCacheCleanupSize;Z++)G._InfixToPostfixCache.delete(M[Z][0])}}G.InfixToPostfixCacheLimitSize=5e4,G.InfixToPostfixCacheCleanupSize=25e3,G._InfixToPostfixCache=new Map,G._OperatorPriority={")":0,"(":1,"||":2,"&&":3},G._Stack=["","","","","","","","","","","","","","","","","","","",""];class mM extends G{constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=M,this.not=Z}isTrue(M){let Z=void 0!==M[this.define];return this.not&&(Z=!Z),Z}}class K extends G{isTrue(M){return this.leftOperand.isTrue(M)||this.rightOperand.isTrue(M)}}class d extends G{isTrue(M){return this.leftOperand.isTrue(M)&&this.rightOperand.isTrue(M)}}class O extends G{constructor(M,Z,P){super(),this.define=M,this.operand=Z,this.testValue=P}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(M){let Z=!1;const P=parseInt(void 0!=M[this.define]?M[this.define]:this.define),x=parseInt(void 0!=M[this.testValue]?M[this.testValue]:this.testValue);if(isNaN(P)||isNaN(x))return!1;switch(this.operand){case">":Z=P>x;break;case"<":Z=P<x;break;case"<=":Z=P<=x;break;case">=":Z=P>=x;break;case"==":Z=P===x;break;case"!=":Z=P!==x}return Z}}var H=P(12213),j=P(12254);const B=/defined\s*?\((.+?)\)/g,U=/defined\s*?\[(.+?)\]/g,n=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,L=/__decl__/,u=/light\{X\}.(\w*)/g,N=/\{X\}/g,J=[],t=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function F(M){M.processor&&M.processor.initializeShaders&&M.processor.initializeShaders(M.processingContext)}function D(M,Z,P,x){var c;null!==(c=Z.processor)&&void 0!==c&&c.preProcessShaderCode&&(M=Z.processor.preProcessShaderCode(M,Z.isFragment)),W(M,Z,(M=>{Z.processCodeAfterIncludes&&(M=Z.processCodeAfterIncludes(Z.isFragment?"fragment":"vertex",M,Z.defines));const c=function(M,Z,P){let x=function(M,Z){var P;if(null!==(P=Z.processor)&&void 0!==P&&P.noPrecision)return M;const x=Z.shouldUseHighPrecisionShader;-1===M.indexOf("precision highp float")?M=x?"precision highp float;\n"+M:"precision mediump float;\n"+M:x||(M=M.replace("precision highp float","precision mediump float"));return M}(M,Z);if(!Z.processor)return x;if(0===Z.processor.shaderLanguage&&-1!==x.indexOf("#version 3")&&(x=x.replace("#version 300 es",""),!Z.processor.parseGLES3))return x;const c=Z.defines,w=R(Z,P);Z.processor.preProcessor&&(x=Z.processor.preProcessor(x,c,w,Z.isFragment,Z.processingContext));const v={};x=C(x,w,Z,v),Z.processor.postProcessor&&(x=Z.processor.postProcessor(x,c,Z.isFragment,Z.processingContext,P?{drawBuffersExtensionDisabled:!P.getCaps().drawBuffersExtension}:{},w,v));null!==P&&void 0!==P&&P._features.needShaderCodeInlining&&(x=P.inlineShaderCode(x));return x}(M,Z,x);P(c,M)}))}function l(M,Z,P){return P.processor&&P.processor.finalizeShaders?P.processor.finalizeShaders(M,Z,P.processingContext):{vertexCode:M,fragmentCode:Z}}function h(M){const Z=/defined\((.+)\)/.exec(M);if(Z&&Z.length)return new mM(Z[1].trim(),"!"===M[0]);const P=["==","!=",">=","<=","<",">"];let x="",c=0;for(x of P)if(c=M.indexOf(x),c>-1)break;if(-1===c)return new mM(M);const w=M.substring(0,c).trim(),v=M.substring(c+x.length).trim();return new O(w,x,v)}function Q(M,Z){const P=new v,x=M.substring(0,Z);let c=M.substring(Z);return c=c.substring(0,(c.indexOf("//")+1||c.length+1)-1).trim(),P.testExpression="#ifdef"===x?new mM(c):"#ifndef"===x?new mM(c,!0):function(M){M=M.replace(B,"defined[$1]");const Z=G.infixToPostfix(M),P=[];for(const c of Z)if("||"!==c&&"&&"!==c)P.push(c);else if(P.length>=2){let M=P[P.length-1],Z=P[P.length-2];P.length-=2;const x="&&"==c?new d:new K;"string"===typeof M&&(M=M.replace(U,"defined($1)")),"string"===typeof Z&&(Z=Z.replace(U,"defined($1)")),x.leftOperand="string"===typeof Z?h(Z):Z,x.rightOperand="string"===typeof M?h(M):M,P.push(x)}let x=P[P.length-1];return"string"===typeof x&&(x=x.replace(U,"defined($1)")),"string"===typeof x?h(x):x}(c),P}function I(M,Z,P,c){let w=M.currentLine;for(;s(M,P,c);){w=M.currentLine;const v=w.substring(0,5).toLowerCase();if("#else"===v){const P=new x;return Z.children.push(P),void s(M,P,c)}if("#elif"===v){const M=Q(w,5);Z.children.push(M),P=M}}}function s(M,Z,P){for(;M.canRead;){M.lineIndex++;const c=M.currentLine;if(c.indexOf("#")>=0){const x=t.exec(c);if(x&&x.length){switch(x[0]){case"#ifdef":{const x=new w;Z.children.push(x);const v=Q(c,6);x.children.push(v),I(M,x,v,P);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const x=new w;Z.children.push(x);const v=Q(c,7);x.children.push(v),I(M,x,v,P);break}case"#if":{const x=new w,v=Q(c,3);Z.children.push(x),x.children.push(v),I(M,x,v,P);break}}continue}}const v=new x;if(v.line=c,Z.children.push(v),"#"===c[0]&&"d"===c[1]){const M=c.replace(";","").split(" ");v.additionalDefineKey=M[1],3===M.length&&(v.additionalDefineValue=M[2])}}return!1}function C(M,Z,P,w){const v=new x,G=new c;return G.lineIndex=-1,G.lines=M.split("\n"),s(G,v,w),v.process(Z,P,w)}function R(M,Z){var P;const x=M.defines,c={};for(const w of x){const M=w.replace("#define","").replace(";","").trim().split(" ");c[M[0]]=M.length>1?M[1]:""}return 0===(null===(P=M.processor)||void 0===P?void 0:P.shaderLanguage)&&(c.GL_ES="true"),c.__VERSION__=M.version,c[M.platformName]="true",(0,j.l)(c,null===Z||void 0===Z?void 0:Z.isNDCHalfZRange,null===Z||void 0===Z?void 0:Z.cc,null===Z||void 0===Z?void 0:Z.useExactSrgbConversions),c}function W(M,Z,P){let x;for(J.length=0;null!==(x=n.exec(M));)J.push(x);let c=String(M),w=[M],v=!1;for(const G of J){let M=G[1];if(-1!==M.indexOf("__decl__")&&(M=M.replace(L,""),Z.supportsUniformBuffers&&(M=M.replace("Vertex","Ubo").replace("Fragment","Ubo")),M+="Declaration"),!Z.includesShadersStore[M]){const x=Z.shadersRepository+"ShadersInclude/"+M+".fx";return void k.loadFile(x,(x=>{Z.includesShadersStore[M]=x,W(w.join(""),Z,P)}))}{let P=Z.includesShadersStore[M];if(G[2]){const M=G[3].split(",");for(let Z=0;Z<M.length;Z+=2){const x=new RegExp(M[Z],"g"),c=M[Z+1];P=P.replace(x,c)}}if(G[4]){const M=G[5];if(-1!==M.indexOf("..")){const x=M.split(".."),c=parseInt(x[0]);let w=parseInt(x[1]),v=P.slice(0);P="",isNaN(w)&&(w=Z.indexParameters[x[1]]);for(let M=c;M<w;M++)Z.supportsUniformBuffers||(v=v.replace(u,((M,Z)=>Z+"{X}"))),P+=v.replace(N,M.toString())+"\n"}else Z.supportsUniformBuffers||(P=P.replace(u,((M,Z)=>Z+"{X}"))),P=P.replace(N,M)}const x=[];for(const M of w){const Z=M.split(G[0]);for(let M=0;M<Z.length-1;M++)x.push(Z[M]),x.push(P);x.push(Z[Z.length-1])}w=x,v=v||P.indexOf("#include<")>=0||P.indexOf("#include <")>=0}}J.length=0,c=w.join(""),v?W(c.toString(),Z,P):P(c)}const k={loadFile:(M,Z,P,x,c,w)=>{throw(0,H.d)("FileTools")}}},12254:(M,Z,P)=>{P.d(Z,{e:()=>c,i:()=>w,l:()=>G,o:()=>v,s:()=>mM});var x=P(12213);P(12192);const c={};function w(M,Z){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(Z?Z+"\n":"")+M}function v(M,Z,P,w,v,G,mM){const K=mM||c.loadFile;if(K){return K(M,Z,P,w,v,G)}throw(0,x.d)("FileTools")}function G(M,Z,P,x){if(M)return Z?M.IS_NDC_HALF_ZRANGE="":delete M.IS_NDC_HALF_ZRANGE,P?M.USE_REVERSE_DEPTHBUFFER="":delete M.USE_REVERSE_DEPTHBUFFER,void(x?M.USE_EXACT_SRGB_CONVERSIONS="":delete M.USE_EXACT_SRGB_CONVERSIONS);{let M="";return Z&&(M+="#define IS_NDC_HALF_ZRANGE"),P&&(M&&(M+="\n"),M+="#define USE_REVERSE_DEPTHBUFFER"),x&&(M&&(M+="\n"),M+="#define USE_EXACT_SRGB_CONVERSIONS"),M}}function mM(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;switch(M){case 3:{const M=(ArrayBuffer,new Int8Array(Z));return x&&M.set(new Int8Array(x)),M}case 0:{const M=(ArrayBuffer,new Uint8Array(Z));return x&&M.set(new Uint8Array(x)),M}case 4:{const M=Z instanceof ArrayBuffer?new Int16Array(Z):new Int16Array(P?Z/2:Z);return x&&M.set(new Int16Array(x)),M}case 5:case 8:case 9:case 10:case 2:{const M=Z instanceof ArrayBuffer?new Uint16Array(Z):new Uint16Array(P?Z/2:Z);return x&&M.set(new Uint16Array(x)),M}case 6:{const M=Z instanceof ArrayBuffer?new Int32Array(Z):new Int32Array(P?Z/4:Z);return x&&M.set(new Int32Array(x)),M}case 7:case 11:case 12:case 13:case 14:case 15:{const M=Z instanceof ArrayBuffer?new Uint32Array(Z):new Uint32Array(P?Z/4:Z);return x&&M.set(new Uint32Array(x)),M}case 1:{const M=Z instanceof ArrayBuffer?new Float32Array(Z):new Float32Array(P?Z/4:Z);return x&&M.set(new Float32Array(x)),M}}const c=(ArrayBuffer,new Uint8Array(Z));return x&&c.set(new Uint8Array(x)),c}},12271:(M,Z,P)=>{P.d(Z,{c:()=>x});class x{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?x.ShadersRepository:x.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?x.ShadersStore:x.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?x.IncludesShadersStore:x.IncludesShadersStoreWGSL}}x.ShadersRepository="src/Shaders/",x.ShadersStore={},x.IncludesShadersStore={},x.ShadersRepositoryWGSL="src/ShadersWGSL/",x.ShadersStoreWGSL={},x.IncludesShadersStoreWGSL={}},12280:(M,Z,P)=>{P.d(Z,{e:()=>H,f:()=>N,h:()=>B,i:()=>j,k:()=>U,n:()=>u,r:()=>O,s:()=>K,w:()=>d,z:()=>mM,A:()=>G});class x{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.jZ._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(M){M&&this.program&&M(this.program)}setEngine(M){this.jZ=M}_fillEffectInformation(M,Z,P,x,c,w,v,G){const mM=this.jZ;if(mM.supportsUniformBuffers)for(const d in Z)M.bindUniformBlock(d,Z[d]);let K;for(this.jZ.getUniforms(this,P).forEach(((M,Z)=>{x[P[Z]]=M})),this._uniforms=x,K=0;K<c.length;K++){null==M.getUniform(c[K])&&(c.splice(K,1),K--)}c.forEach(((M,Z)=>{w[M]=Z}));for(const d of mM.getAttributes(this,v))G.push(d)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(M,Z){const P=this._valueCache[M],x=Z.updateFlag;return(void 0===P||P!==x)&&(this._valueCache[M]=x,!0)}_cacheFloat2(M,Z,P){let x=this._valueCache[M];if(!x||2!==x.length)return x=[Z,P],this._valueCache[M]=x,!0;let c=!1;return x[0]!==Z&&(x[0]=Z,c=!0),x[1]!==P&&(x[1]=P,c=!0),c}_cacheFloat3(M,Z,P,x){let c=this._valueCache[M];if(!c||3!==c.length)return c=[Z,P,x],this._valueCache[M]=c,!0;let w=!1;return c[0]!==Z&&(c[0]=Z,w=!0),c[1]!==P&&(c[1]=P,w=!0),c[2]!==x&&(c[2]=x,w=!0),w}_cacheFloat4(M,Z,P,x,c){let w=this._valueCache[M];if(!w||4!==w.length)return w=[Z,P,x,c],this._valueCache[M]=w,!0;let v=!1;return w[0]!==Z&&(w[0]=Z,v=!0),w[1]!==P&&(w[1]=P,v=!0),w[2]!==x&&(w[2]=x,v=!0),w[3]!==c&&(w[3]=c,v=!0),v}setInt(M,Z){const P=this._valueCache[M];void 0!==P&&P===Z||this.jZ.setInt(this._uniforms[M],Z)&&(this._valueCache[M]=Z)}setInt2(M,Z,P){this._cacheFloat2(M,Z,P)&&(this.jZ.setInt2(this._uniforms[M],Z,P)||(this._valueCache[M]=null))}setInt3(M,Z,P,x){this._cacheFloat3(M,Z,P,x)&&(this.jZ.setInt3(this._uniforms[M],Z,P,x)||(this._valueCache[M]=null))}setInt4(M,Z,P,x,c){this._cacheFloat4(M,Z,P,x,c)&&(this.jZ.setInt4(this._uniforms[M],Z,P,x,c)||(this._valueCache[M]=null))}setIntArray(M,Z){this._valueCache[M]=null,this.jZ.setIntArray(this._uniforms[M],Z)}setIntArray2(M,Z){this._valueCache[M]=null,this.jZ.setIntArray2(this._uniforms[M],Z)}setIntArray3(M,Z){this._valueCache[M]=null,this.jZ.setIntArray3(this._uniforms[M],Z)}setIntArray4(M,Z){this._valueCache[M]=null,this.jZ.setIntArray4(this._uniforms[M],Z)}setUInt(M,Z){const P=this._valueCache[M];void 0!==P&&P===Z||this.jZ.setUInt(this._uniforms[M],Z)&&(this._valueCache[M]=Z)}setUInt2(M,Z,P){this._cacheFloat2(M,Z,P)&&(this.jZ.setUInt2(this._uniforms[M],Z,P)||(this._valueCache[M]=null))}setUInt3(M,Z,P,x){this._cacheFloat3(M,Z,P,x)&&(this.jZ.setUInt3(this._uniforms[M],Z,P,x)||(this._valueCache[M]=null))}setUInt4(M,Z,P,x,c){this._cacheFloat4(M,Z,P,x,c)&&(this.jZ.setUInt4(this._uniforms[M],Z,P,x,c)||(this._valueCache[M]=null))}setUIntArray(M,Z){this._valueCache[M]=null,this.jZ.setUIntArray(this._uniforms[M],Z)}setUIntArray2(M,Z){this._valueCache[M]=null,this.jZ.setUIntArray2(this._uniforms[M],Z)}setUIntArray3(M,Z){this._valueCache[M]=null,this.jZ.setUIntArray3(this._uniforms[M],Z)}setUIntArray4(M,Z){this._valueCache[M]=null,this.jZ.setUIntArray4(this._uniforms[M],Z)}setArray(M,Z){this._valueCache[M]=null,this.jZ.setArray(this._uniforms[M],Z)}setArray2(M,Z){this._valueCache[M]=null,this.jZ.setArray2(this._uniforms[M],Z)}setArray3(M,Z){this._valueCache[M]=null,this.jZ.setArray3(this._uniforms[M],Z)}setArray4(M,Z){this._valueCache[M]=null,this.jZ.setArray4(this._uniforms[M],Z)}setMatrices(M,Z){Z&&(this._valueCache[M]=null,this.jZ.setMatrices(this._uniforms[M],Z))}setMatrix(M,Z){this._cacheMatrix(M,Z)&&(this.jZ.setMatrices(this._uniforms[M],Z.nc())||(this._valueCache[M]=null))}setMatrix3x3(M,Z){this._valueCache[M]=null,this.jZ.setMatrix3x3(this._uniforms[M],Z)}setMatrix2x2(M,Z){this._valueCache[M]=null,this.jZ.setMatrix2x2(this._uniforms[M],Z)}setFloat(M,Z){const P=this._valueCache[M];void 0!==P&&P===Z||this.jZ.setFloat(this._uniforms[M],Z)&&(this._valueCache[M]=Z)}setVector2(M,Z){this._cacheFloat2(M,Z.x,Z.y)&&(this.jZ.setFloat2(this._uniforms[M],Z.x,Z.y)||(this._valueCache[M]=null))}setFloat2(M,Z,P){this._cacheFloat2(M,Z,P)&&(this.jZ.setFloat2(this._uniforms[M],Z,P)||(this._valueCache[M]=null))}setVector3(M,Z){this._cacheFloat3(M,Z.x,Z.y,Z.z)&&(this.jZ.setFloat3(this._uniforms[M],Z.x,Z.y,Z.z)||(this._valueCache[M]=null))}setFloat3(M,Z,P,x){this._cacheFloat3(M,Z,P,x)&&(this.jZ.setFloat3(this._uniforms[M],Z,P,x)||(this._valueCache[M]=null))}setVector4(M,Z){this._cacheFloat4(M,Z.x,Z.y,Z.z,Z.w)&&(this.jZ.setFloat4(this._uniforms[M],Z.x,Z.y,Z.z,Z.w)||(this._valueCache[M]=null))}setQuaternion(M,Z){this._cacheFloat4(M,Z.x,Z.y,Z.z,Z.w)&&(this.jZ.setFloat4(this._uniforms[M],Z.x,Z.y,Z.z,Z.w)||(this._valueCache[M]=null))}setFloat4(M,Z,P,x,c){this._cacheFloat4(M,Z,P,x,c)&&(this.jZ.setFloat4(this._uniforms[M],Z,P,x,c)||(this._valueCache[M]=null))}setColor3(M,Z){this._cacheFloat3(M,Z.r,Z.g,Z.b)&&(this.jZ.setFloat3(this._uniforms[M],Z.r,Z.g,Z.b)||(this._valueCache[M]=null))}setColor4(M,Z,P){this._cacheFloat4(M,Z.r,Z.g,Z.b,P)&&(this.jZ.setFloat4(this._uniforms[M],Z.r,Z.g,Z.b,P)||(this._valueCache[M]=null))}setDirectColor4(M,Z){this._cacheFloat4(M,Z.r,Z.g,Z.b,Z.a)&&(this.jZ.setFloat4(this._uniforms[M],Z.r,Z.g,Z.b,Z.a)||(this._valueCache[M]=null))}_getVertexShaderCode(){return this.vertexShader?this.jZ._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.jZ._getShaderSource(this.fragmentShader):null}}var c=P(12254);const w=new WeakMap,v={_webGLVersion:2,cachedPipelines:{}};function G(M){let Z=w.get(M);if(!Z){if(!M)return v;Z={_webGLVersion:M.TEXTURE_BINDING_3D?2:1,_context:M,parallelShaderCompile:M.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},w.set(M,Z)}return Z}function mM(M){w.delete(M)}function K(M,Z,P,x,c,w){const v=G(x);w||(w=v._createShaderProgramInjection??H);return w(M,L(Z,"vertex",x,v._contextWasLost),L(P,"fragment",x,v._contextWasLost),x,c,v.validateShaderPrograms)}function d(M,Z,P,x,c){let w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6?arguments[6]:void 0;const mM=G(c);v||(v=mM._createShaderProgramInjection??H);const K=mM._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return v(M,n(Z,"vertex",x,K,c,mM._contextWasLost),n(P,"fragment",x,K,c,mM._contextWasLost),c,w,mM.validateShaderPrograms)}function O(M,Z){const P=new x,c=G(M);return c.parallelShaderCompile&&!c.disableParallelShaderCompile&&(P.isParallelCompiled=!0),P.context=c._context,P}function H(M,Z,P,x){let c=arguments.length>5?arguments[5]:void 0;const w=x.createProgram();if(M.program=w,!w)throw new Error("Unable to create program");return x.attachShader(w,Z),x.attachShader(w,P),x.linkProgram(w),M.context=x,M.vertexShader=Z,M.fragmentShader=P,M.isParallelCompiled||B(M,x,c),w}function j(M,Z,P){const x=M;if(x._isDisposed)return!1;const c=G(Z);return!!(c&&c.parallelShaderCompile&&c.parallelShaderCompile.COMPLETION_STATUS_KHR&&x.program&&Z.getProgramParameter(x.program,c.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(B(x,Z,P),!0)}function B(M,Z,P){const x=M.context,c=M.vertexShader,w=M.fragmentShader,v=M.program;if(!x.getProgramParameter(v,x.LINK_STATUS)){if(!Z.getShaderParameter(c,Z.COMPILE_STATUS)){const P=Z.getShaderInfoLog(c);if(P)throw M.vertexCompilationError=P,new Error("VERTEX SHADER "+P)}if(!Z.getShaderParameter(w,Z.COMPILE_STATUS)){const P=Z.getShaderInfoLog(w);if(P)throw M.fragmentCompilationError=P,new Error("FRAGMENT SHADER "+P)}const P=x.getProgramInfoLog(v);if(P)throw M.programLinkError=P,new Error(P)}if(P){x.validateProgram(v);if(!x.getProgramParameter(v,x.VALIDATE_STATUS)){const Z=x.getProgramInfoLog(v);if(Z)throw M.programValidationError=Z,new Error(Z)}}x.deleteShader(c),x.deleteShader(w),M.vertexShader=void 0,M.fragmentShader=void 0,M.onCompiled&&(M.onCompiled(),M.onCompiled=void 0)}function U(M,Z,P,x,c,w,v,mM,O){let H=arguments.length>10?arguments[10]:void 0,j=arguments.length>11?arguments[11]:void 0,B=arguments.length>12?arguments[12]:void 0;const U=G(M.context);j||(j=U.createRawShaderProgramInjection??K),B||(B=U.createShaderProgramInjection??d);const n=M;n.program=x?j(n,Z,P,n.context,O):B(n,Z,P,mM,n.context,O),n.program.__SPECTOR_rebuildProgram=v,H()}function n(M,Z,P,x,w,v){return L((0,c.i)(M,P,x),Z,w,v)}function L(M,Z,P,x){const c=P.createShader("vertex"===Z?P.VERTEX_SHADER:P.FRAGMENT_SHADER);if(!c){let M=P.NO_ERROR,c=P.NO_ERROR;for(;(c=P.getError())!==P.NO_ERROR;)M=c;throw new Error(`Something went wrong while creating a gl ${Z} shader object. gl error=${M}, gl isContextLost=${P.isContextLost()}, _contextWasLost=${x}`)}return P.shaderSource(c,M),P.compileShader(c),c}function u(M,Z){Z.useProgram(M)}function N(M,Z){const P=M;if(!P.isParallelCompiled)return void Z(M);const x=P.onCompiled;P.onCompiled=()=>{null===x||void 0===x||x(),Z(M)}}},12276:(M,Z,P)=>{P.d(Z,{c:()=>O,f:()=>j,g:()=>K,k:()=>d});var x=P(12192),c=P(12280),w=P(12271),v=P(12199),G=P(12249),mM=P(12254);function K(M,Z){return(0,c.A)(Z).cachedPipelines[M]}function d(M){const Z=M._name,P=M.context;if(Z&&P){const M=(0,c.A)(P),x=M.cachedPipelines[Z];null===x||void 0===x||x.dispose(),delete M.cachedPipelines[Z]}}function O(M,Z,P,c,w,v,mM){let K,d;const O=(0,x.p)()?null===v||void 0===v?void 0:v.getHostDocument():null;K="string"===typeof Z?Z:Z.vertexSource?"source:"+Z.vertexSource:Z.vertexElement?(null===O||void 0===O?void 0:O.getElementById(Z.vertexElement))||Z.vertexElement:Z.vertex||Z,d="string"===typeof Z?Z:Z.fragmentSource?"source:"+Z.fragmentSource:Z.fragmentElement?(null===O||void 0===O?void 0:O.getElementById(Z.fragmentElement))||Z.fragmentElement:Z.fragment||Z;const j=[void 0,void 0],B=()=>{if(j[0]&&j[1]){M.isFragment=!0;const[x,K]=j;(0,G.o)(K,M,((v,K)=>{mM&&(mM._fragmentSourceCodeBeforeMigration=K),P&&(v=P("fragment",v));const d=(0,G.c)(x,v,M);M=null;const O=function(M,Z,P,x){if(P){return{vertexSourceCode:(1===x?"//":"")+"#define SHADER_NAME vertex:"+(P.vertexElement||P.vertex||P.spectorName||P)+"\n"+M,fragmentSourceCode:(1===x?"//":"")+"#define SHADER_NAME fragment:"+(P.fragmentElement||P.fragment||P.spectorName||P)+"\n"+Z}}return{vertexSourceCode:M,fragmentSourceCode:Z}}(d.vertexCode,d.fragmentCode,Z,w);null===c||void 0===c||c(O.vertexSourceCode,O.fragmentSourceCode)}),v)}};H(K,"Vertex","",(Z=>{(0,G.g)(M),(0,G.o)(Z,M,((M,x)=>{mM&&(mM._rawVertexSourceCode=Z,mM._vertexSourceCodeBeforeMigration=x),P&&(M=P("vertex",M)),j[0]=M,B()}),v)}),w),H(d,"Fragment","Pixel",(M=>{mM&&(mM._rawFragmentSourceCode=M),j[1]=M,B()}),w)}function H(M,Z,P,c,v,G){if("undefined"!==typeof HTMLElement&&M instanceof HTMLElement){return void c((0,x.d)(M))}if("source:"===M.substring(0,7))return void c(M.substring(7));if("base64:"===M.substring(0,7)){return void c(window.atob(M.substring(7)))}const K=w.c.GetShadersStore(v);if(K[M+Z+"Shader"])return void c(K[M+Z+"Shader"]);if(P&&K[M+P+"Shader"])return void c(K[M+P+"Shader"]);let d;if(d="."===M[0]||"/"===M[0]||M.indexOf("http")>-1?M:w.c.GetShadersRepository(v)+M,!(G=G||mM.o))throw new Error("loadFileInjection is not defined");G(d+"."+Z.toLowerCase()+".fx",c)}const j=(M,Z,P,x)=>{try{const w=M.context?(0,c.A)(M.context):null;w&&(w.disableParallelShaderCompile=M.disableParallelCompilation);const v=M.existingPipelineContext||Z(M.shaderProcessingContext);return v._name=M.name,M.name&&w&&(w.cachedPipelines[M.name]=v),P(v,M.vertex,M.fragment,!!M.createAsRaw,"","",M.rebuildRebind,M.defines,M.transformFeedbackVaryings,"",(()=>{x(v,(()=>{var Z;null===(Z=M.onRenderingStateCompiled)||void 0===Z||Z.call(M,v)}))})),v}catch(w){throw v.d.Error("Error compiling effect"),w}}},12262:(M,Z,P)=>{P.r(Z),P.d(Z,{Effect:()=>mM});var x=P(12184),c=P(12199),w=P(12271),v=P(12276),G=P(12258);class mM{static get ShadersRepository(){return w.c.ShadersRepository}static set ShadersRepository(M){w.c.ShadersRepository=M}get K(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new x.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,H=arguments.length>9?arguments[9]:void 0,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,U=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new x.b,this.onErrorObservable=new x.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=M,this._key=j;const n=this._key.replace(/\r/g,"").replace(/\n/g,"|");let L;if(Z.attributes){const M=Z;if(this._engine=P,this._attributesNames=M.attributes,this._uniformsNames=M.uniformsNames.concat(M.samplers),this._samplerList=M.samplers.slice(),this.defines=M.defines,this.onError=M.onError,this.onCompiled=M.onCompiled,this._fallbacks=M.fallbacks,this._indexParameters=M.indexParameters,this._transformFeedbackVaryings=M.transformFeedbackVaryings||null,this._multiTarget=!!M.multiTarget,this._shaderLanguage=M.shaderLanguage??0,this._disableParallelShaderCompilation=!!M.disableParallelShaderCompilation,M.uniformBuffersNames){this._uniformBuffersNamesList=M.uniformBuffersNames.slice();for(let Z=0;Z<M.uniformBuffersNames.length;Z++)this._uniformBuffersNames[M.uniformBuffersNames[Z]]=Z}this._processFinalCode=M.processFinalCode??null,this._processCodeAfterIncludes=M.processCodeAfterIncludes??void 0,U=M.extraInitializationsAsync,L=M.existingPipelineContext}else this._engine=w,this.defines=null==G?"":G,this._uniformsNames=P.concat(c),this._samplerList=c?c.slice():[],this._attributesNames=Z,this._uniformBuffersNamesList=[],this._shaderLanguage=B,this.onError=O,this.onCompiled=d,this._indexParameters=H,this._fallbacks=K;"WEBGL2"===this._engine.shaderPlatformName&&(L=(0,v.g)(n,this._engine._gl)??L),this._attributeLocationByName={},this.uniqueId=mM._UniqueIdSeed++,L?(this._pipelineContext=L,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,U),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.K||this.dispose(!0)}))}async _processShaderCodeAsync(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3?arguments[3]:void 0;x&&await x(),this._processingContext=P||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const c={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:M??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:w.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:w.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,cc:this._engine.cc,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,v.c)(c,this.name,this._processFinalCode,((M,P)=>{this._vertexSourceCode=M,this._fragmentSourceCode=P,this._prepareEffect(Z)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.K||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(M){return this._attributes[M]}getAttributeLocationByName(M){return this._attributeLocationByName[M]}getAttributesCount(){return this._attributes.length}getUniformIndex(M){return this._uniformsNames.indexOf(M)}getUniform(M){return this._uniforms[M]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((M=>{this.executeWhenCompiled(M)}))}executeWhenCompiled(M){this.isReady()?M(this):(this.onCompileObservable.add((Z=>{M(Z)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(M){(0,G.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(Z=>{this._processCompilationErrors(Z,M)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var M;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(M=this._pipelineContext)||void 0===M?void 0:M._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var M;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(M=this._pipelineContext)||void 0===M?void 0:M._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,cc:this._engine.cc,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(M,Z,P,x){this._isReady=!1,this._vertexSourceCodeOverride=M,this._fragmentSourceCodeOverride=Z,this.onError=(M,Z)=>{x&&x(Z)},this.onCompiled=()=>{var M,Z;const x=this.getEngine().scenes;if(x)for(let P=0;P<x.length;P++)x[P].markAllMaterialsAsDirty(127);null===(M=(Z=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===M||M.call(Z,P)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(M){if(this._pipelineContext=M,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let Z=0;Z<this._attributesNames.length;Z++){const M=this._attributesNames[Z];this._attributeLocationByName[M]=this._attributes[Z]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),mM.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=this._pipelineContext;this._isReady=!1;try{const P=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),x=P?null:this.defines,c=P?this._vertexSourceCodeOverride:this._vertexSourceCode,w=P?this._fragmentSourceCodeOverride:this._fragmentSourceCode,G=this._engine;this._pipelineContext=(0,v.f)({existingPipelineContext:M?Z:null,vertex:c,fragment:w,context:"WEBGL2"===G.shaderPlatformName||"WEBGL1"===G.shaderPlatformName?G._gl:void 0,rebuildRebind:(M,Z,P,x)=>this._rebuildProgram(M,Z,P,x),defines:x,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:P,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:P=>{Z&&!M&&this._engine._deletePipelineContext(Z),P&&this._onRenderingStateCompiled(P)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(Z)}catch(P){this._processCompilationErrors(P,Z)}}_getShaderCodeAndErrorLine(M,Z,P){const x=P?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let c=null;if(Z&&M){const w=Z.match(x);if(w&&2===w.length){const Z=parseInt(w[1]),x=M.split("\n",-1);x.length>=Z&&(c=`Offending line [${Z}] in ${P?"fragment":"vertex"} code: ${x[Z-1]}`)}}return[M,c]}_processCompilationErrors(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=M.message;const P=this._attributesNames,x=this._fallbacks;if(c.d.Error("Unable to compile effect:"),c.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),c.d.Error(`Attributes: ${P.join(" ")}`),c.d.Error("Defines:\n"+this.defines),mM.LogShaderCodeOnCompilationError){var w,v;let M=null,Z=null,P=null;var G;if(null!==(w=this._pipelineContext)&&void 0!==w&&w._getVertexShaderCode()&&([P,M]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),P&&(c.d.Error("Vertex code:"),c.d.Error(P))),null!==(v=this._pipelineContext)&&void 0!==v&&v._getFragmentShaderCode())[P,Z]=this._getShaderCodeAndErrorLine(null===(G=this._pipelineContext)||void 0===G?void 0:G._getFragmentShaderCode(),this._compilationError,!0),P&&(c.d.Error("Fragment code:"),c.d.Error(P));M&&c.d.Error(M),Z&&c.d.Error(Z)}c.d.Error("Error: "+this._compilationError);const K=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};Z&&(this._pipelineContext=Z,this._isReady=!0,K()),x?(this._pipelineContext=null,x.hasMoreFallbacks?(this._allFallbacksProcessed=!1,c.d.Error("Trying next fallback."),this.defines=x.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,K(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,Z||K())}get isSupported(){return""===this._compilationError}_bindTexture(M,Z){this._engine._bindTexture(this._samplers[M],Z,M)}setTexture(M,Z){this._engine.setTexture(this._samplers[M],this._uniforms[M],Z,M)}setTextureArray(M,Z){const P=M+"Ex";if(-1===this._samplerList.indexOf(P+"0")){const x=this._samplerList.indexOf(M);for(let M=1;M<Z.length;M++){const Z=P+(M-1).toString();this._samplerList.splice(x+M,0,Z)}let c=0;for(const M of this._samplerList)this._samplers[M]=c,c+=1}this._engine.setTextureArray(this._samplers[M],this._uniforms[M],Z,M)}bindUniformBuffer(M,Z){const P=this._uniformBuffersNames[Z];void 0===P||mM._BaseCache[P]===M&&this._engine._features.useUBOBindingCache||(mM._BaseCache[P]=M,this._engine.bindUniformBufferBase(M,P,Z))}bindUniformBlock(M,Z){this._engine.bindUniformBlock(this._pipelineContext,M,Z)}setInt(M,Z){return this._pipelineContext.setInt(M,Z),this}setInt2(M,Z,P){return this._pipelineContext.setInt2(M,Z,P),this}setInt3(M,Z,P,x){return this._pipelineContext.setInt3(M,Z,P,x),this}setInt4(M,Z,P,x,c){return this._pipelineContext.setInt4(M,Z,P,x,c),this}setIntArray(M,Z){return this._pipelineContext.setIntArray(M,Z),this}setIntArray2(M,Z){return this._pipelineContext.setIntArray2(M,Z),this}setIntArray3(M,Z){return this._pipelineContext.setIntArray3(M,Z),this}setIntArray4(M,Z){return this._pipelineContext.setIntArray4(M,Z),this}setUInt(M,Z){return this._pipelineContext.setUInt(M,Z),this}setUInt2(M,Z,P){return this._pipelineContext.setUInt2(M,Z,P),this}setUInt3(M,Z,P,x){return this._pipelineContext.setUInt3(M,Z,P,x),this}setUInt4(M,Z,P,x,c){return this._pipelineContext.setUInt4(M,Z,P,x,c),this}setUIntArray(M,Z){return this._pipelineContext.setUIntArray(M,Z),this}setUIntArray2(M,Z){return this._pipelineContext.setUIntArray2(M,Z),this}setUIntArray3(M,Z){return this._pipelineContext.setUIntArray3(M,Z),this}setUIntArray4(M,Z){return this._pipelineContext.setUIntArray4(M,Z),this}setFloatArray(M,Z){return this._pipelineContext.setArray(M,Z),this}setFloatArray2(M,Z){return this._pipelineContext.setArray2(M,Z),this}setFloatArray3(M,Z){return this._pipelineContext.setArray3(M,Z),this}setFloatArray4(M,Z){return this._pipelineContext.setArray4(M,Z),this}setArray(M,Z){return this._pipelineContext.setArray(M,Z),this}setArray2(M,Z){return this._pipelineContext.setArray2(M,Z),this}setArray3(M,Z){return this._pipelineContext.setArray3(M,Z),this}setArray4(M,Z){return this._pipelineContext.setArray4(M,Z),this}setMatrices(M,Z){return this._pipelineContext.setMatrices(M,Z),this}setMatrix(M,Z){return this._pipelineContext.setMatrix(M,Z),this}setMatrix3x3(M,Z){return this._pipelineContext.setMatrix3x3(M,Z),this}setMatrix2x2(M,Z){return this._pipelineContext.setMatrix2x2(M,Z),this}setFloat(M,Z){return this._pipelineContext.setFloat(M,Z),this}setBool(M,Z){return this._pipelineContext.setInt(M,Z?1:0),this}setVector2(M,Z){return this._pipelineContext.setVector2(M,Z),this}setFloat2(M,Z,P){return this._pipelineContext.setFloat2(M,Z,P),this}setVector3(M,Z){return this._pipelineContext.setVector3(M,Z),this}setFloat3(M,Z,P,x){return this._pipelineContext.setFloat3(M,Z,P,x),this}setVector4(M,Z){return this._pipelineContext.setVector4(M,Z),this}setQuaternion(M,Z){return this._pipelineContext.setQuaternion(M,Z),this}setFloat4(M,Z,P,x,c){return this._pipelineContext.setFloat4(M,Z,P,x,c),this}setColor3(M,Z){return this._pipelineContext.setColor3(M,Z),this}setColor4(M,Z,P){return this._pipelineContext.setColor4(M,Z,P),this}setDirectColor4(M,Z){return this._pipelineContext.setDirectColor4(M,Z),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(mM.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,v.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Z&&(w.c.GetShadersStore(x)[`${M}PixelShader`]=Z),P&&(w.c.GetShadersStore(x)[`${M}VertexShader`]=P)}static ResetCache(){mM._BaseCache={}}}mM.LogShaderCodeOnCompilationError=!0,mM.PersistentMode=!1,mM.AutomaticallyClearCodeCache=!1,mM._UniqueIdSeed=0,mM._BaseCache={},mM.ShadersStore=w.c.ShadersStore,mM.IncludesShadersStore=w.c.IncludesShadersStore},12213:(M,Z,P)=>{P.d(Z,{d:()=>c});const x={};function c(M){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!x[M])return x[M]=!0,`${M} needs to be imported before as it contains a side-effect required by your code.`}},12192:(M,Z,P)=>{function x(){return"undefined"!==typeof window}function c(){return"undefined"!==typeof navigator}function w(){return"undefined"!==typeof document}function v(M){let Z="",P=M.firstChild;for(;P;)3===P.nodeType&&(Z+=P.textContent),P=P.nextSibling;return Z}P.d(Z,{d:()=>v,h:()=>w,l:()=>c,p:()=>x})},12199:(M,Z,P)=>{P.d(Z,{d:()=>x});class x{static _CheckLimit(M,Z){let P=x._LogLimitOutputs[M];return P?P.current++:(P={limit:Z,current:1},x._LogLimitOutputs[M]=P),P.current<=P.limit}static _GenerateLimitMessage(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const P=x._LogLimitOutputs[M];if(!P||!x.MessageLimitReached)return;const c=this._Levels[Z];P.current===P.limit&&x[c.name](x.MessageLimitReached.replace(/%LIMIT%/g,""+P.limit).replace(/%TYPE%/g,c.name??""))}static _AddLogEntry(M){x._LogCache=M+x._LogCache,x.OnNewCacheEntry&&x.OnNewCacheEntry(M)}static _FormatMessage(M){const Z=M=>M<10?"0"+M:""+M,P=new Date;return"["+Z(P.getHours())+":"+Z(P.getMinutes())+":"+Z(P.getSeconds())+"]: "+M}static _LogDisabled(M,Z){}static _LogEnabled(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;const c=Array.isArray(Z)?Z[0]:Z;if(void 0!==P&&!x._CheckLimit(c,P))return;const w=x._FormatMessage(c),v=this._Levels[M],G=Array.isArray(Z)?Z.slice(1):[];v.logFunc&&v.logFunc("BJS - "+w,...G);const mM=`<div style='color:${v.color}'>${w}</div><br>`;x._AddLogEntry(mM),x._GenerateLimitMessage(c,M)}static get LogCache(){return x._LogCache}static ClearLogCache(){x._LogCache="",x._LogLimitOutputs={},x.errorsCount=0}static set LogLevels(M){x.Log=x._LogDisabled,x.Warn=x._LogDisabled,x.Error=x._LogDisabled;const Z=[x.MessageLogLevel,x.WarningLogLevel,x.ErrorLogLevel];for(const P of Z)if((M&P)===P){const M=this._Levels[P];x[M.name]=x._LogEnabled.bind(x,P)}}}x.NoneLogLevel=0,x.MessageLogLevel=1,x.WarningLogLevel=2,x.ErrorLogLevel=4,x.AllLogLevel=7,x.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",x._LogCache="",x._LogLimitOutputs={},x._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],x.errorsCount=0,x.Log=x._LogEnabled.bind(x,x.MessageLogLevel),x.Warn=x._LogEnabled.bind(x,x.WarningLogLevel),x.Error=x._LogEnabled.bind(x,x.ErrorLogLevel)},12184:(M,Z,P)=>{P.d(Z,{b:()=>v});const x="undefined"!==typeof WeakRef;class c{constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0;this.initialize(M,Z,P,x)}initialize(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0;return this.mask=M,this.skipNextObservers=Z,this.target=P,this.currentTarget=x,this}}class w{constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=M,this.mask=Z,this.scope=P,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(M)}}class v{static FromPromise(M,Z){const P=new v;return M.then((M=>{P.notifyObservers(M)})).catch((M=>{if(!Z)throw M;Z.notifyObservers(M)})),P}get observers(){return this._observers}constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=Z,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new c(0),M&&(this._onObserverAdded=M)}add(M){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!M)return null;const c=new w(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);c.unregisterOnNextCall=P,Z?this._observers.unshift(c):this._observers.push(c),this._onObserverAdded&&this._onObserverAdded(c),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(c,this._lastNotifiedValue);const v=x?new WeakRef(this):{deref:()=>this};return c._remove=function(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=v.deref();Z&&(M?Z.remove(c):Z._remove(c))},c}addOnce(M){return this.add(M,void 0,void 0,void 0,!0)}remove(M){if(!M)return!1;M._remove=null;return-1!==this._observers.indexOf(M)&&(this._deferUnregister(M),!0)}removeCallback(M,Z){for(let P=0;P<this._observers.length;P++){const x=this._observers[P];if(!x._willBeUnregistered&&(x.callback===M&&(!Z||Z===x.scope)))return this._deferUnregister(x),!0}return!1}_deferUnregister(M){M._willBeUnregistered||(this._numObserversMarkedAsDeleted++,M.unregisterOnNextCall=!1,M._willBeUnregistered=!0,setTimeout((()=>{this._remove(M)}),0))}_remove(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!M)return!1;const P=this._observers.indexOf(M);return-1!==P&&(Z&&this._numObserversMarkedAsDeleted--,this._observers.splice(P,1),!0)}makeObserverTopPriority(M){this._remove(M,!1),this._observers.unshift(M)}makeObserverBottomPriority(M){this._remove(M,!1),this._observers.push(M)}notifyObservers(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,P=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=M),!this._observers.length)return!0;const w=this._eventState;w.mask=Z,w.target=P,w.currentTarget=x,w.skipNextObservers=!1,w.lastReturnValue=M,w.userInfo=c;for(const v of this._observers)if(!v._willBeUnregistered&&(v.mask&Z&&(v.unregisterOnNextCall&&this._deferUnregister(v),v.scope?w.lastReturnValue=v.callback.apply(v.scope,[M,w]):w.lastReturnValue=v.callback(M,w)),w.skipNextObservers))return!1;return!0}notifyObserver(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Z),M._willBeUnregistered)return;const x=this._eventState;x.mask=P,x.skipNextObservers=!1,M.unregisterOnNextCall&&this._deferUnregister(M),M.callback(Z,x)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const M=this._observers.pop();M&&(M._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const M=new v;return M._observers=this._observers.slice(0),M}hasSpecificMask(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const Z of this._observers)if(Z.mask&M||Z.mask===M)return!0;return!1}}},12258:(M,Z,P)=>{P.d(Z,{b:()=>c,d:()=>v});let x=[];class c{static SetImmediate(M){0===x.length&&setTimeout((()=>{const M=x;x=[];for(const Z of M)Z()}),1),x.push(M)}}function w(M,Z,P){try{if(M())return Z(),!0}catch(x){return null===P||void 0===P||P(x),!0}return!1}const v=function(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,v=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&w(M,Z,P))return null;const G=setInterval((()=>{w(M,Z,P)?clearInterval(G):(c-=x,c<0&&(clearInterval(G),null===P||void 0===P||P(new Error("Operation timed out after maximum retries. "+(v||"")),!0)))}),x);return()=>clearInterval(G)}}}]);