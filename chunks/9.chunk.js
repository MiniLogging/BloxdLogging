"use strict";(self["9jl1vn4ei5r"]=self["9jl1vn4ei5r"]||[]).push([[9],{11681:(M,p,b)=>{b.d(p,{e:()=>y,g:()=>f,l:()=>R,h:()=>w,n:()=>E});class Q{constructor(){this.children=[]}isValid(M){return!0}process(M,p,b){let Q="";if(this.line){let b=this.line;const H=p.processor;if(H){var q,B,k,u,T,O;H.lineProcessor&&(b=H.lineProcessor(b,p.isFragment,p.processingContext));const Q=(null===(q=p.processor)||void 0===q?void 0:q.attributeKeywordName)??"attribute",F=p.isFragment&&null!==(B=p.processor)&&void 0!==B&&B.varyingFragmentKeywordName?null===(k=p.processor)||void 0===k?void 0:k.varyingFragmentKeywordName:!p.isFragment&&null!==(u=p.processor)&&void 0!==u&&u.varyingVertexKeywordName?null===(T=p.processor)||void 0===T?void 0:T.varyingVertexKeywordName:"varying";if(!p.isFragment&&H.attributeProcessor&&this.line.startsWith(Q))b=H.attributeProcessor(this.line,M,p.processingContext);else if(H.varyingProcessor&&(null!==(O=H.varyingCheck)&&void 0!==O&&O.call(H,this.line,p.isFragment)||!H.varyingCheck&&this.line.startsWith(F)))b=H.varyingProcessor(this.line,p.isFragment,M,p.processingContext);else if(H.uniformProcessor&&H.uniformRegexp&&H.uniformRegexp.test(this.line))p.lookForClosingBracketForUniformBuffer||(b=H.uniformProcessor(this.line,p.isFragment,M,p.processingContext));else if(H.uniformBufferProcessor&&H.uniformBufferRegexp&&H.uniformBufferRegexp.test(this.line))p.lookForClosingBracketForUniformBuffer||(b=H.uniformBufferProcessor(this.line,p.isFragment,p.processingContext),p.lookForClosingBracketForUniformBuffer=!0);else if(H.textureProcessor&&H.textureRegexp&&H.textureRegexp.test(this.line))b=H.textureProcessor(this.line,p.isFragment,M,p.processingContext);else if((H.uniformProcessor||H.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!p.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?H.uniformProcessor&&(b=H.uniformProcessor(this.line,p.isFragment,M,p.processingContext)):H.uniformBufferProcessor&&(b=H.uniformBufferProcessor(this.line,p.isFragment,p.processingContext),p.lookForClosingBracketForUniformBuffer=!0)}p.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(p.lookForClosingBracketForUniformBuffer=!1,H.endOfUniformBufferProcessor&&(b=H.endOfUniformBufferProcessor(this.line,p.isFragment,p.processingContext)))}Q+=b+"\n"}for(const H of this.children)Q+=H.process(M,p,b);return this.additionalDefineKey&&(M[this.additionalDefineKey]=this.additionalDefineValue||"true",b[this.additionalDefineKey]=M[this.additionalDefineKey]),Q}}class q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(M){this._lines.length=0;for(const p of M){if(!p||"\r"===p)continue;if("#"===p[0]){this._lines.push(p);continue}const M=p.trim();if(!M)continue;if(M.startsWith("//")){this._lines.push(p);continue}const b=M.indexOf(";");if(-1===b)this._lines.push(M);else if(b===M.length-1)M.length>1&&this._lines.push(M);else{const M=p.split(";");for(let p=0;p<M.length;p++){let b=M[p];b&&(b=b.trim(),b&&this._lines.push(b+(p!==M.length-1?";":"")))}}}}}class B extends Q{process(M,p,b){for(let Q=0;Q<this.children.length;Q++){const q=this.children[Q];if(q.isValid(M))return q.process(M,p,b)}return""}}class k extends Q{isValid(M){return this.testExpression.isTrue(M)}}class u{isTrue(M){return!0}static postfixToInfix(M){const p=[];for(const b of M)if(void 0===u._OperatorPriority[b])p.push(b);else{const M=p[p.length-1],Q=p[p.length-2];p.length-=2,p.push(`(${Q}${b}${M})`)}return p[p.length-1]}static infixToPostfix(M){const p=u._InfixToPostfixCache.get(M);if(p)return p.accessTime=Date.now(),p.result;if(!M.includes("&&")&&!M.includes("||")&&!M.includes(")")&&!M.includes("("))return[M];const b=[];let Q=-1;const q=()=>{H=H.trim(),""!==H&&(b.push(H),H="")},B=M=>{Q<u._Stack.length-1&&(u._Stack[++Q]=M)},k=()=>u._Stack[Q],T=()=>-1===Q?"!!INVALID EXPRESSION!!":u._Stack[Q--];let O=0,H="";for(;O<M.length;){const p=M.charAt(O),F=O<M.length-1?M.substring(O,2+O):"";if("("===p)H="",B(p);else if(")"===p){for(q();-1!==Q&&"("!==k();)b.push(T());T()}else if(u._OperatorPriority[F]>1){for(q();-1!==Q&&u._OperatorPriority[k()]>=u._OperatorPriority[F];)b.push(T());B(F),O++}else H+=p;O++}for(q();-1!==Q;)"("===k()?T():b.push(T());return u._InfixToPostfixCache.size>=u.InfixToPostfixCacheLimitSize&&u.ClearCache(),u._InfixToPostfixCache.set(M,{result:b,accessTime:Date.now()}),b}static ClearCache(){const M=Array.from(u._InfixToPostfixCache.entries()).sort(((M,p)=>M[1].accessTime-p[1].accessTime));for(let p=0;p<u.InfixToPostfixCacheCleanupSize;p++)u._InfixToPostfixCache.delete(M[p][0])}}u.InfixToPostfixCacheLimitSize=5e4,u.InfixToPostfixCacheCleanupSize=25e3,u._InfixToPostfixCache=new Map,u._OperatorPriority={")":0,"(":1,"||":2,"&&":3},u._Stack=["","","","","","","","","","","","","","","","","","","",""];class T extends u{constructor(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=M,this.not=p}isTrue(M){let p=void 0!==M[this.define];return this.not&&(p=!p),p}}class O extends u{isTrue(M){return this.leftOperand.isTrue(M)||this.rightOperand.isTrue(M)}}class H extends u{isTrue(M){return this.leftOperand.isTrue(M)&&this.rightOperand.isTrue(M)}}class F extends u{constructor(M,p,b){super(),this.define=M,this.operand=p,this.testValue=b}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(M){let p=!1;const b=parseInt(void 0!=M[this.define]?M[this.define]:this.define),Q=parseInt(void 0!=M[this.testValue]?M[this.testValue]:this.testValue);if(isNaN(b)||isNaN(Q))return!1;switch(this.operand){case">":p=b>Q;break;case"<":p=b<Q;break;case"<=":p=b<=Q;break;case">=":p=b>=Q;break;case"==":p=b===Q;break;case"!=":p=b!==Q}return p}}var o=b(11651),W=b(11685);const i=/defined\s*?\((.+?)\)/g,A=/defined\s*?\[(.+?)\]/g,j=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,K=/__decl__/,D=/light\{X\}.(\w*)/g,a=/\{X\}/g,s=[],S=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function f(M){M.processor&&M.processor.initializeShaders&&M.processor.initializeShaders(M.processingContext)}function R(M,p,b,Q){var q;null!==(q=p.processor)&&void 0!==q&&q.preProcessShaderCode&&(M=p.processor.preProcessShaderCode(M,p.isFragment)),w(M,p,(M=>{p.processCodeAfterIncludes&&(M=p.processCodeAfterIncludes(p.isFragment?"fragment":"vertex",M,p.defines));const q=function(M,p,b){let Q=function(M,p){var b;if(null!==(b=p.processor)&&void 0!==b&&b.noPrecision)return M;const Q=p.shouldUseHighPrecisionShader;-1===M.indexOf("precision highp float")?M=Q?"precision highp float;\n"+M:"precision mediump float;\n"+M:Q||(M=M.replace("precision highp float","precision mediump float"));return M}(M,p);if(!p.processor)return Q;if(0===p.processor.shaderLanguage&&-1!==Q.indexOf("#version 3")&&(Q=Q.replace("#version 300 es",""),!p.processor.parseGLES3))return Q;const q=p.defines,B=Y(p,b);p.processor.preProcessor&&(Q=p.processor.preProcessor(Q,q,B,p.isFragment,p.processingContext));const k={};Q=r(Q,B,p,k),p.processor.postProcessor&&(Q=p.processor.postProcessor(Q,q,p.isFragment,p.processingContext,b?{drawBuffersExtensionDisabled:!b.getCaps().drawBuffersExtension}:{},B,k));null!==b&&void 0!==b&&b._features.needShaderCodeInlining&&(Q=b.inlineShaderCode(Q));return Q}(M,p,Q);b(q,M)}))}function y(M,p,b){return b.processor&&b.processor.finalizeShaders?b.processor.finalizeShaders(M,p,b.processingContext):{vertexCode:M,fragmentCode:p}}function x(M){const p=/defined\((.+)\)/.exec(M);if(p&&p.length)return new T(p[1].trim(),"!"===M[0]);const b=["==","!=",">=","<=","<",">"];let Q="",q=0;for(Q of b)if(q=M.indexOf(Q),q>-1)break;if(-1===q)return new T(M);const B=M.substring(0,q).trim(),k=M.substring(q+Q.length).trim();return new F(B,Q,k)}function P(M,p){const b=new k,Q=M.substring(0,p);let q=M.substring(p);return q=q.substring(0,(q.indexOf("//")+1||q.length+1)-1).trim(),b.testExpression="#ifdef"===Q?new T(q):"#ifndef"===Q?new T(q,!0):function(M){M=M.replace(i,"defined[$1]");const p=u.infixToPostfix(M),b=[];for(const q of p)if("||"!==q&&"&&"!==q)b.push(q);else if(b.length>=2){let M=b[b.length-1],p=b[b.length-2];b.length-=2;const Q="&&"==q?new H:new O;"string"===typeof M&&(M=M.replace(A,"defined($1)")),"string"===typeof p&&(p=p.replace(A,"defined($1)")),Q.leftOperand="string"===typeof p?x(p):p,Q.rightOperand="string"===typeof M?x(M):M,b.push(Q)}let Q=b[b.length-1];return"string"===typeof Q&&(Q=Q.replace(A,"defined($1)")),"string"===typeof Q?x(Q):Q}(q),b}function L(M,p,b,q){let B=M.currentLine;for(;N(M,b,q);){B=M.currentLine;const k=B.substring(0,5).toLowerCase();if("#else"===k){const b=new Q;return p.children.push(b),void N(M,b,q)}if("#elif"===k){const M=P(B,5);p.children.push(M),b=M}}}function N(M,p,b){for(;M.canRead;){M.lineIndex++;const q=M.currentLine;if(q.indexOf("#")>=0){const Q=S.exec(q);if(Q&&Q.length){switch(Q[0]){case"#ifdef":{const Q=new B;p.children.push(Q);const k=P(q,6);Q.children.push(k),L(M,Q,k,b);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Q=new B;p.children.push(Q);const k=P(q,7);Q.children.push(k),L(M,Q,k,b);break}case"#if":{const Q=new B,k=P(q,3);p.children.push(Q),Q.children.push(k),L(M,Q,k,b);break}}continue}}const k=new Q;if(k.line=q,p.children.push(k),"#"===q[0]&&"d"===q[1]){const M=q.replace(";","").split(" ");k.additionalDefineKey=M[1],3===M.length&&(k.additionalDefineValue=M[2])}}return!1}function r(M,p,b,B){const k=new Q,u=new q;return u.lineIndex=-1,u.lines=M.split("\n"),N(u,k,B),k.process(p,b,B)}function Y(M,p){var b;const Q=M.defines,q={};for(const B of Q){const M=B.replace("#define","").replace(";","").trim().split(" ");q[M[0]]=M.length>1?M[1]:""}return 0===(null===(b=M.processor)||void 0===b?void 0:b.shaderLanguage)&&(q.GL_ES="true"),q.__VERSION__=M.version,q[M.platformName]="true",(0,W.k)(q,null===p||void 0===p?void 0:p.isNDCHalfZRange,null===p||void 0===p?void 0:p.useReverseDepthBuffer,null===p||void 0===p?void 0:p.useExactSrgbConversions),q}function w(M,p,b){let Q;for(s.length=0;null!==(Q=j.exec(M));)s.push(Q);let q=String(M),B=[M],k=!1;for(const u of s){let M=u[1];if(-1!==M.indexOf("__decl__")&&(M=M.replace(K,""),p.supportsUniformBuffers&&(M=M.replace("Vertex","Ubo").replace("Fragment","Ubo")),M+="Declaration"),!p.includesShadersStore[M]){const Q=p.shadersRepository+"ShadersInclude/"+M+".fx";return void E.loadFile(Q,(Q=>{p.includesShadersStore[M]=Q,w(B.join(""),p,b)}))}{let b=p.includesShadersStore[M];if(u[2]){const M=u[3].split(",");for(let p=0;p<M.length;p+=2){const Q=new RegExp(M[p],"g"),q=M[p+1];b=b.replace(Q,q)}}if(u[4]){const M=u[5];if(-1!==M.indexOf("..")){const Q=M.split(".."),q=parseInt(Q[0]);let B=parseInt(Q[1]),k=b.slice(0);b="",isNaN(B)&&(B=p.indexParameters[Q[1]]);for(let M=q;M<B;M++)p.supportsUniformBuffers||(k=k.replace(D,((M,p)=>p+"{X}"))),b+=k.replace(a,M.toString())+"\n"}else p.supportsUniformBuffers||(b=b.replace(D,((M,p)=>p+"{X}"))),b=b.replace(a,M)}const Q=[];for(const M of B){const p=M.split(u[0]);for(let M=0;M<p.length-1;M++)Q.push(p[M]),Q.push(b);Q.push(p[p.length-1])}B=Q,k=k||b.indexOf("#include<")>=0||b.indexOf("#include <")>=0}}s.length=0,q=B.join(""),k?w(q.toString(),p,b):b(q)}const E={loadFile:(M,p,b,Q,q,B)=>{throw(0,o.c)("FileTools")}}},11685:(M,p,b)=>{b.d(p,{c:()=>q,g:()=>B,k:()=>u,n:()=>k,q:()=>T});var Q=b(11651);b(11632);const q={};function B(M,p){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(p?p+"\n":"")+M}function k(M,p,b,B,k,u,T){const O=T||q.loadFile;if(O){return O(M,p,b,B,k,u)}throw(0,Q.c)("FileTools")}function u(M,p,b,Q){if(M)return p?M.IS_NDC_HALF_ZRANGE="":delete M.IS_NDC_HALF_ZRANGE,b?M.USE_REVERSE_DEPTHBUFFER="":delete M.USE_REVERSE_DEPTHBUFFER,void(Q?M.USE_EXACT_SRGB_CONVERSIONS="":delete M.USE_EXACT_SRGB_CONVERSIONS);{let M="";return p&&(M+="#define IS_NDC_HALF_ZRANGE"),b&&(M&&(M+="\n"),M+="#define USE_REVERSE_DEPTHBUFFER"),Q&&(M&&(M+="\n"),M+="#define USE_EXACT_SRGB_CONVERSIONS"),M}}function T(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;switch(M){case 3:{const M=(ArrayBuffer,new Int8Array(p));return Q&&M.set(new Int8Array(Q)),M}case 0:{const M=(ArrayBuffer,new Uint8Array(p));return Q&&M.set(new Uint8Array(Q)),M}case 4:{const M=p instanceof ArrayBuffer?new Int16Array(p):new Int16Array(b?p/2:p);return Q&&M.set(new Int16Array(Q)),M}case 5:case 8:case 9:case 10:case 2:{const M=p instanceof ArrayBuffer?new Uint16Array(p):new Uint16Array(b?p/2:p);return Q&&M.set(new Uint16Array(Q)),M}case 6:{const M=p instanceof ArrayBuffer?new Int32Array(p):new Int32Array(b?p/4:p);return Q&&M.set(new Int32Array(Q)),M}case 7:case 11:case 12:case 13:case 14:case 15:{const M=p instanceof ArrayBuffer?new Uint32Array(p):new Uint32Array(b?p/4:p);return Q&&M.set(new Uint32Array(Q)),M}case 1:{const M=p instanceof ArrayBuffer?new Float32Array(p):new Float32Array(b?p/4:p);return Q&&M.set(new Float32Array(Q)),M}}const q=(ArrayBuffer,new Uint8Array(p));return Q&&q.set(new Uint8Array(Q)),q}},11709:(M,p,b)=>{b.d(p,{d:()=>Q});class Q{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.ShadersRepository:Q.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.ShadersStore:Q.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.IncludesShadersStore:Q.IncludesShadersStoreWGSL}}Q.ShadersRepository="src/Shaders/",Q.ShadersStore={},Q.IncludesShadersStore={},Q.ShadersRepositoryWGSL="src/ShadersWGSL/",Q.ShadersStoreWGSL={},Q.IncludesShadersStoreWGSL={}},11715:(M,p,b)=>{b.d(p,{d:()=>o,h:()=>a,j:()=>i,k:()=>W,l:()=>A,p:()=>D,s:()=>F,v:()=>O,y:()=>H,B:()=>T,D:()=>u});class Q{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Wp._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(M){M&&this.program&&M(this.program)}setEngine(M){this.Wp=M}_fillEffectInformation(M,p,b,Q,q,B,k,u){const T=this.Wp;if(T.supportsUniformBuffers)for(const H in p)M.bindUniformBlock(H,p[H]);let O;for(this.Wp.getUniforms(this,b).forEach(((M,p)=>{Q[b[p]]=M})),this._uniforms=Q,O=0;O<q.length;O++){null==M.getUniform(q[O])&&(q.splice(O,1),O--)}q.forEach(((M,p)=>{B[M]=p}));for(const H of T.getAttributes(this,k))u.push(H)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(M,p){const b=this._valueCache[M],Q=p.updateFlag;return(void 0===b||b!==Q)&&(this._valueCache[M]=Q,!0)}_cacheFloat2(M,p,b){let Q=this._valueCache[M];if(!Q||2!==Q.length)return Q=[p,b],this._valueCache[M]=Q,!0;let q=!1;return Q[0]!==p&&(Q[0]=p,q=!0),Q[1]!==b&&(Q[1]=b,q=!0),q}_cacheFloat3(M,p,b,Q){let q=this._valueCache[M];if(!q||3!==q.length)return q=[p,b,Q],this._valueCache[M]=q,!0;let B=!1;return q[0]!==p&&(q[0]=p,B=!0),q[1]!==b&&(q[1]=b,B=!0),q[2]!==Q&&(q[2]=Q,B=!0),B}_cacheFloat4(M,p,b,Q,q){let B=this._valueCache[M];if(!B||4!==B.length)return B=[p,b,Q,q],this._valueCache[M]=B,!0;let k=!1;return B[0]!==p&&(B[0]=p,k=!0),B[1]!==b&&(B[1]=b,k=!0),B[2]!==Q&&(B[2]=Q,k=!0),B[3]!==q&&(B[3]=q,k=!0),k}setInt(M,p){const b=this._valueCache[M];void 0!==b&&b===p||this.Wp.setInt(this._uniforms[M],p)&&(this._valueCache[M]=p)}setInt2(M,p,b){this._cacheFloat2(M,p,b)&&(this.Wp.setInt2(this._uniforms[M],p,b)||(this._valueCache[M]=null))}setInt3(M,p,b,Q){this._cacheFloat3(M,p,b,Q)&&(this.Wp.setInt3(this._uniforms[M],p,b,Q)||(this._valueCache[M]=null))}setInt4(M,p,b,Q,q){this._cacheFloat4(M,p,b,Q,q)&&(this.Wp.setInt4(this._uniforms[M],p,b,Q,q)||(this._valueCache[M]=null))}setIntArray(M,p){this._valueCache[M]=null,this.Wp.setIntArray(this._uniforms[M],p)}setIntArray2(M,p){this._valueCache[M]=null,this.Wp.setIntArray2(this._uniforms[M],p)}setIntArray3(M,p){this._valueCache[M]=null,this.Wp.setIntArray3(this._uniforms[M],p)}setIntArray4(M,p){this._valueCache[M]=null,this.Wp.setIntArray4(this._uniforms[M],p)}setUInt(M,p){const b=this._valueCache[M];void 0!==b&&b===p||this.Wp.setUInt(this._uniforms[M],p)&&(this._valueCache[M]=p)}setUInt2(M,p,b){this._cacheFloat2(M,p,b)&&(this.Wp.setUInt2(this._uniforms[M],p,b)||(this._valueCache[M]=null))}setUInt3(M,p,b,Q){this._cacheFloat3(M,p,b,Q)&&(this.Wp.setUInt3(this._uniforms[M],p,b,Q)||(this._valueCache[M]=null))}setUInt4(M,p,b,Q,q){this._cacheFloat4(M,p,b,Q,q)&&(this.Wp.setUInt4(this._uniforms[M],p,b,Q,q)||(this._valueCache[M]=null))}setUIntArray(M,p){this._valueCache[M]=null,this.Wp.setUIntArray(this._uniforms[M],p)}setUIntArray2(M,p){this._valueCache[M]=null,this.Wp.setUIntArray2(this._uniforms[M],p)}setUIntArray3(M,p){this._valueCache[M]=null,this.Wp.setUIntArray3(this._uniforms[M],p)}setUIntArray4(M,p){this._valueCache[M]=null,this.Wp.setUIntArray4(this._uniforms[M],p)}setArray(M,p){this._valueCache[M]=null,this.Wp.setArray(this._uniforms[M],p)}setArray2(M,p){this._valueCache[M]=null,this.Wp.setArray2(this._uniforms[M],p)}setArray3(M,p){this._valueCache[M]=null,this.Wp.setArray3(this._uniforms[M],p)}setArray4(M,p){this._valueCache[M]=null,this.Wp.setArray4(this._uniforms[M],p)}setMatrices(M,p){p&&(this._valueCache[M]=null,this.Wp.setMatrices(this._uniforms[M],p))}setMatrix(M,p){this._cacheMatrix(M,p)&&(this.Wp.setMatrices(this._uniforms[M],p.Ob())||(this._valueCache[M]=null))}setMatrix3x3(M,p){this._valueCache[M]=null,this.Wp.setMatrix3x3(this._uniforms[M],p)}setMatrix2x2(M,p){this._valueCache[M]=null,this.Wp.setMatrix2x2(this._uniforms[M],p)}setFloat(M,p){const b=this._valueCache[M];void 0!==b&&b===p||this.Wp.setFloat(this._uniforms[M],p)&&(this._valueCache[M]=p)}setVector2(M,p){this._cacheFloat2(M,p.x,p.y)&&(this.Wp.setFloat2(this._uniforms[M],p.x,p.y)||(this._valueCache[M]=null))}setFloat2(M,p,b){this._cacheFloat2(M,p,b)&&(this.Wp.setFloat2(this._uniforms[M],p,b)||(this._valueCache[M]=null))}setVector3(M,p){this._cacheFloat3(M,p.x,p.y,p.z)&&(this.Wp.setFloat3(this._uniforms[M],p.x,p.y,p.z)||(this._valueCache[M]=null))}setFloat3(M,p,b,Q){this._cacheFloat3(M,p,b,Q)&&(this.Wp.setFloat3(this._uniforms[M],p,b,Q)||(this._valueCache[M]=null))}setVector4(M,p){this._cacheFloat4(M,p.x,p.y,p.z,p.w)&&(this.Wp.setFloat4(this._uniforms[M],p.x,p.y,p.z,p.w)||(this._valueCache[M]=null))}setQuaternion(M,p){this._cacheFloat4(M,p.x,p.y,p.z,p.w)&&(this.Wp.setFloat4(this._uniforms[M],p.x,p.y,p.z,p.w)||(this._valueCache[M]=null))}setFloat4(M,p,b,Q,q){this._cacheFloat4(M,p,b,Q,q)&&(this.Wp.setFloat4(this._uniforms[M],p,b,Q,q)||(this._valueCache[M]=null))}setColor3(M,p){this._cacheFloat3(M,p.r,p.g,p.b)&&(this.Wp.setFloat3(this._uniforms[M],p.r,p.g,p.b)||(this._valueCache[M]=null))}setColor4(M,p,b){this._cacheFloat4(M,p.r,p.g,p.b,b)&&(this.Wp.setFloat4(this._uniforms[M],p.r,p.g,p.b,b)||(this._valueCache[M]=null))}setDirectColor4(M,p){this._cacheFloat4(M,p.r,p.g,p.b,p.a)&&(this.Wp.setFloat4(this._uniforms[M],p.r,p.g,p.b,p.a)||(this._valueCache[M]=null))}_getVertexShaderCode(){return this.vertexShader?this.Wp._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Wp._getShaderSource(this.fragmentShader):null}}var q=b(11685);const B=new WeakMap,k={_webGLVersion:2,cachedPipelines:{}};function u(M){let p=B.get(M);if(!p){if(!M)return k;p={_webGLVersion:M.TEXTURE_BINDING_3D?2:1,_context:M,parallelShaderCompile:M.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},B.set(M,p)}return p}function T(M){B.delete(M)}function O(M,p,b,Q,q,B){const k=u(Q);B||(B=k._createShaderProgramInjection??o);return B(M,K(p,"vertex",Q,k._contextWasLost),K(b,"fragment",Q,k._contextWasLost),Q,q,k.validateShaderPrograms)}function H(M,p,b,Q,q){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6?arguments[6]:void 0;const T=u(q);k||(k=T._createShaderProgramInjection??o);const O=T._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return k(M,j(p,"vertex",Q,O,q,T._contextWasLost),j(b,"fragment",Q,O,q,T._contextWasLost),q,B,T.validateShaderPrograms)}function F(M,p){const b=new Q,q=u(M);return q.parallelShaderCompile&&!q.disableParallelShaderCompile&&(b.isParallelCompiled=!0),b.context=q._context,b}function o(M,p,b,Q){let q=arguments.length>5?arguments[5]:void 0;const B=Q.createProgram();if(M.program=B,!B)throw new Error("Unable to create program");return Q.attachShader(B,p),Q.attachShader(B,b),Q.linkProgram(B),M.context=Q,M.vertexShader=p,M.fragmentShader=b,M.isParallelCompiled||i(M,Q,q),B}function W(M,p,b){const Q=M;if(Q._isDisposed)return!1;const q=u(p);return!!(q&&q.parallelShaderCompile&&q.parallelShaderCompile.COMPLETION_STATUS_KHR&&Q.program&&p.getProgramParameter(Q.program,q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(i(Q,p,b),!0)}function i(M,p,b){const Q=M.context,q=M.vertexShader,B=M.fragmentShader,k=M.program;if(!Q.getProgramParameter(k,Q.LINK_STATUS)){if(!p.getShaderParameter(q,p.COMPILE_STATUS)){const b=p.getShaderInfoLog(q);if(b)throw M.vertexCompilationError=b,new Error("VERTEX SHADER "+b)}if(!p.getShaderParameter(B,p.COMPILE_STATUS)){const b=p.getShaderInfoLog(B);if(b)throw M.fragmentCompilationError=b,new Error("FRAGMENT SHADER "+b)}const b=Q.getProgramInfoLog(k);if(b)throw M.programLinkError=b,new Error(b)}if(b){Q.validateProgram(k);if(!Q.getProgramParameter(k,Q.VALIDATE_STATUS)){const p=Q.getProgramInfoLog(k);if(p)throw M.programValidationError=p,new Error(p)}}Q.deleteShader(q),Q.deleteShader(B),M.vertexShader=void 0,M.fragmentShader=void 0,M.onCompiled&&(M.onCompiled(),M.onCompiled=void 0)}function A(M,p,b,Q,q,B,k,T,F){let o=arguments.length>10?arguments[10]:void 0,W=arguments.length>11?arguments[11]:void 0,i=arguments.length>12?arguments[12]:void 0;const A=u(M.context);W||(W=A.createRawShaderProgramInjection??O),i||(i=A.createShaderProgramInjection??H);const j=M;j.program=Q?W(j,p,b,j.context,F):i(j,p,b,T,j.context,F),j.program.__SPECTOR_rebuildProgram=k,o()}function j(M,p,b,Q,B,k){return K((0,q.g)(M,b,Q),p,B,k)}function K(M,p,b,Q){const q=b.createShader("vertex"===p?b.VERTEX_SHADER:b.FRAGMENT_SHADER);if(!q){let M=b.NO_ERROR,q=b.NO_ERROR;for(;(q=b.getError())!==b.NO_ERROR;)M=q;throw new Error(`Something went wrong while creating a gl ${p} shader object. gl error=${M}, gl isContextLost=${b.isContextLost()}, _contextWasLost=${Q}`)}return b.shaderSource(q,M),b.compileShader(q),q}function D(M,p){p.useProgram(M)}function a(M,p){const b=M;if(!b.isParallelCompiled)return void p(M);const Q=b.onCompiled;b.onCompiled=()=>{null===Q||void 0===Q||Q(),p(M)}}},11712:(M,p,b)=>{b.d(p,{b:()=>F,c:()=>W,e:()=>O,f:()=>H});var Q=b(11632),q=b(11715),B=b(11709),k=b(11637),u=b(11681),T=b(11685);function O(M,p){return(0,q.D)(p).cachedPipelines[M]}function H(M){const p=M._name,b=M.context;if(p&&b){const M=(0,q.D)(b),Q=M.cachedPipelines[p];null===Q||void 0===Q||Q.dispose(),delete M.cachedPipelines[p]}}function F(M,p,b,q,B,k,T){let O,H;const F=(0,Q.n)()?null===k||void 0===k?void 0:k.getHostDocument():null;O="string"===typeof p?p:p.vertexSource?"source:"+p.vertexSource:p.vertexElement?(null===F||void 0===F?void 0:F.getElementById(p.vertexElement))||p.vertexElement:p.vertex||p,H="string"===typeof p?p:p.fragmentSource?"source:"+p.fragmentSource:p.fragmentElement?(null===F||void 0===F?void 0:F.getElementById(p.fragmentElement))||p.fragmentElement:p.fragment||p;const W=[void 0,void 0],i=()=>{if(W[0]&&W[1]){M.isFragment=!0;const[Q,O]=W;(0,u.l)(O,M,((k,O)=>{T&&(T._fragmentSourceCodeBeforeMigration=O),b&&(k=b("fragment",k));const H=(0,u.e)(Q,k,M);M=null;const F=function(M,p,b,Q){if(b){return{vertexSourceCode:(1===Q?"//":"")+"#define SHADER_NAME vertex:"+(b.vertexElement||b.vertex||b.spectorName||b)+"\n"+M,fragmentSourceCode:(1===Q?"//":"")+"#define SHADER_NAME fragment:"+(b.fragmentElement||b.fragment||b.spectorName||b)+"\n"+p}}return{vertexSourceCode:M,fragmentSourceCode:p}}(H.vertexCode,H.fragmentCode,p,B);null===q||void 0===q||q(F.vertexSourceCode,F.fragmentSourceCode)}),k)}};o(O,"Vertex","",(p=>{(0,u.g)(M),(0,u.l)(p,M,((M,Q)=>{T&&(T._rawVertexSourceCode=p,T._vertexSourceCodeBeforeMigration=Q),b&&(M=b("vertex",M)),W[0]=M,i()}),k)}),B),o(H,"Fragment","Pixel",(M=>{T&&(T._rawFragmentSourceCode=M),W[1]=M,i()}),B)}function o(M,p,b,q,k,u){if("undefined"!==typeof HTMLElement&&M instanceof HTMLElement){return void q((0,Q.d)(M))}if("source:"===M.substring(0,7))return void q(M.substring(7));if("base64:"===M.substring(0,7)){return void q(window.atob(M.substring(7)))}const O=B.d.GetShadersStore(k);if(O[M+p+"Shader"])return void q(O[M+p+"Shader"]);if(b&&O[M+b+"Shader"])return void q(O[M+b+"Shader"]);let H;if(H="."===M[0]||"/"===M[0]||M.indexOf("http")>-1?M:B.d.GetShadersRepository(k)+M,!(u=u||T.n))throw new Error("loadFileInjection is not defined");u(H+"."+p.toLowerCase()+".fx",q)}const W=(M,p,b,Q)=>{try{const B=M.context?(0,q.D)(M.context):null;B&&(B.disableParallelShaderCompile=M.disableParallelCompilation);const k=M.existingPipelineContext||p(M.shaderProcessingContext);return k._name=M.name,M.name&&B&&(B.cachedPipelines[M.name]=k),b(k,M.vertex,M.fragment,!!M.createAsRaw,"","",M.rebuildRebind,M.defines,M.transformFeedbackVaryings,"",(()=>{Q(k,(()=>{var p;null===(p=M.onRenderingStateCompiled)||void 0===p||p.call(M,k)}))})),k}catch(B){throw k.c.Error("Error compiling effect"),B}}},11703:(M,p,b)=>{b.r(p),b.d(p,{Effect:()=>T});var Q=b(11624),q=b(11637),B=b(11709),k=b(11712),u=b(11693);class T{static get ShadersRepository(){return B.d.ShadersRepository}static set ShadersRepository(M){B.d.ShadersRepository=M}get O(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Q.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,o=arguments.length>9?arguments[9]:void 0,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,A=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Q.b,this.onErrorObservable=new Q.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=M,this._key=W;const j=this._key.replace(/\r/g,"").replace(/\n/g,"|");let K;if(p.attributes){const M=p;if(this._engine=b,this._attributesNames=M.attributes,this._uniformsNames=M.uniformsNames.concat(M.samplers),this._samplerList=M.samplers.slice(),this.defines=M.defines,this.onError=M.onError,this.onCompiled=M.onCompiled,this._fallbacks=M.fallbacks,this._indexParameters=M.indexParameters,this._transformFeedbackVaryings=M.transformFeedbackVaryings||null,this._multiTarget=!!M.multiTarget,this._shaderLanguage=M.shaderLanguage??0,this._disableParallelShaderCompilation=!!M.disableParallelShaderCompilation,M.uniformBuffersNames){this._uniformBuffersNamesList=M.uniformBuffersNames.slice();for(let p=0;p<M.uniformBuffersNames.length;p++)this._uniformBuffersNames[M.uniformBuffersNames[p]]=p}this._processFinalCode=M.processFinalCode??null,this._processCodeAfterIncludes=M.processCodeAfterIncludes??void 0,A=M.extraInitializationsAsync,K=M.existingPipelineContext}else this._engine=B,this.defines=null==u?"":u,this._uniformsNames=b.concat(q),this._samplerList=q?q.slice():[],this._attributesNames=p,this._uniformBuffersNamesList=[],this._shaderLanguage=i,this.onError=F,this.onCompiled=H,this._indexParameters=o,this._fallbacks=O;"WEBGL2"===this._engine.shaderPlatformName&&(K=(0,k.e)(j,this._engine._gl)??K),this._attributeLocationByName={},this.uniqueId=T._UniqueIdSeed++,K?(this._pipelineContext=K,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,A),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.O||this.dispose(!0)}))}async _processShaderCodeAsync(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3?arguments[3]:void 0;Q&&await Q(),this._processingContext=b||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:M??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:B.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:B.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,k.b)(q,this.name,this._processFinalCode,((M,b)=>{this._vertexSourceCode=M,this._fragmentSourceCode=b,this._prepareEffect(p)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.O||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(M){return this._attributes[M]}getAttributeLocationByName(M){return this._attributeLocationByName[M]}getAttributesCount(){return this._attributes.length}getUniformIndex(M){return this._uniformsNames.indexOf(M)}getUniform(M){return this._uniforms[M]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((M=>{this.executeWhenCompiled(M)}))}executeWhenCompiled(M){this.isReady()?M(this):(this.onCompileObservable.add((p=>{M(p)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(M){(0,u.i)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(p=>{this._processCompilationErrors(p,M)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var M;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(M=this._pipelineContext)||void 0===M?void 0:M._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var M;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(M=this._pipelineContext)||void 0===M?void 0:M._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(M,p,b,Q){this._isReady=!1,this._vertexSourceCodeOverride=M,this._fragmentSourceCodeOverride=p,this.onError=(M,p)=>{Q&&Q(p)},this.onCompiled=()=>{var M,p;const Q=this.getEngine().scenes;if(Q)for(let b=0;b<Q.length;b++)Q[b].markAllMaterialsAsDirty(127);null===(M=(p=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===M||M.call(p,b)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(M){if(this._pipelineContext=M,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let p=0;p<this._attributesNames.length;p++){const M=this._attributesNames[p];this._attributeLocationByName[M]=this._attributes[p]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),T.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this._pipelineContext;this._isReady=!1;try{const b=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Q=b?null:this.defines,q=b?this._vertexSourceCodeOverride:this._vertexSourceCode,B=b?this._fragmentSourceCodeOverride:this._fragmentSourceCode,u=this._engine;this._pipelineContext=(0,k.c)({existingPipelineContext:M?p:null,vertex:q,fragment:B,context:"WEBGL2"===u.shaderPlatformName||"WEBGL1"===u.shaderPlatformName?u._gl:void 0,rebuildRebind:(M,p,b,Q)=>this._rebuildProgram(M,p,b,Q),defines:Q,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:b,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:b=>{p&&!M&&this._engine._deletePipelineContext(p),b&&this._onRenderingStateCompiled(b)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(p)}catch(b){this._processCompilationErrors(b,p)}}_getShaderCodeAndErrorLine(M,p,b){const Q=b?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let q=null;if(p&&M){const B=p.match(Q);if(B&&2===B.length){const p=parseInt(B[1]),Q=M.split("\n",-1);Q.length>=p&&(q=`Offending line [${p}] in ${b?"fragment":"vertex"} code: ${Q[p-1]}`)}}return[M,q]}_processCompilationErrors(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=M.message;const b=this._attributesNames,Q=this._fallbacks;if(q.c.Error("Unable to compile effect:"),q.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),q.c.Error(`Attributes: ${b.join(" ")}`),q.c.Error("Defines:\n"+this.defines),T.LogShaderCodeOnCompilationError){var B,k;let M=null,p=null,b=null;var u;if(null!==(B=this._pipelineContext)&&void 0!==B&&B._getVertexShaderCode()&&([b,M]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),b&&(q.c.Error("Vertex code:"),q.c.Error(b))),null!==(k=this._pipelineContext)&&void 0!==k&&k._getFragmentShaderCode())[b,p]=this._getShaderCodeAndErrorLine(null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode(),this._compilationError,!0),b&&(q.c.Error("Fragment code:"),q.c.Error(b));M&&q.c.Error(M),p&&q.c.Error(p)}q.c.Error("Error: "+this._compilationError);const O=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};p&&(this._pipelineContext=p,this._isReady=!0,O()),Q?(this._pipelineContext=null,Q.hasMoreFallbacks?(this._allFallbacksProcessed=!1,q.c.Error("Trying next fallback."),this.defines=Q.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,O(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,p||O())}get isSupported(){return""===this._compilationError}_bindTexture(M,p){this._engine._bindTexture(this._samplers[M],p,M)}setTexture(M,p){this._engine.setTexture(this._samplers[M],this._uniforms[M],p,M)}setTextureArray(M,p){const b=M+"Ex";if(-1===this._samplerList.indexOf(b+"0")){const Q=this._samplerList.indexOf(M);for(let M=1;M<p.length;M++){const p=b+(M-1).toString();this._samplerList.splice(Q+M,0,p)}let q=0;for(const M of this._samplerList)this._samplers[M]=q,q+=1}this._engine.setTextureArray(this._samplers[M],this._uniforms[M],p,M)}bindUniformBuffer(M,p){const b=this._uniformBuffersNames[p];void 0===b||T._BaseCache[b]===M&&this._engine._features.useUBOBindingCache||(T._BaseCache[b]=M,this._engine.bindUniformBufferBase(M,b,p))}bindUniformBlock(M,p){this._engine.bindUniformBlock(this._pipelineContext,M,p)}setInt(M,p){return this._pipelineContext.setInt(M,p),this}setInt2(M,p,b){return this._pipelineContext.setInt2(M,p,b),this}setInt3(M,p,b,Q){return this._pipelineContext.setInt3(M,p,b,Q),this}setInt4(M,p,b,Q,q){return this._pipelineContext.setInt4(M,p,b,Q,q),this}setIntArray(M,p){return this._pipelineContext.setIntArray(M,p),this}setIntArray2(M,p){return this._pipelineContext.setIntArray2(M,p),this}setIntArray3(M,p){return this._pipelineContext.setIntArray3(M,p),this}setIntArray4(M,p){return this._pipelineContext.setIntArray4(M,p),this}setUInt(M,p){return this._pipelineContext.setUInt(M,p),this}setUInt2(M,p,b){return this._pipelineContext.setUInt2(M,p,b),this}setUInt3(M,p,b,Q){return this._pipelineContext.setUInt3(M,p,b,Q),this}setUInt4(M,p,b,Q,q){return this._pipelineContext.setUInt4(M,p,b,Q,q),this}setUIntArray(M,p){return this._pipelineContext.setUIntArray(M,p),this}setUIntArray2(M,p){return this._pipelineContext.setUIntArray2(M,p),this}setUIntArray3(M,p){return this._pipelineContext.setUIntArray3(M,p),this}setUIntArray4(M,p){return this._pipelineContext.setUIntArray4(M,p),this}setFloatArray(M,p){return this._pipelineContext.setArray(M,p),this}setFloatArray2(M,p){return this._pipelineContext.setArray2(M,p),this}setFloatArray3(M,p){return this._pipelineContext.setArray3(M,p),this}setFloatArray4(M,p){return this._pipelineContext.setArray4(M,p),this}setArray(M,p){return this._pipelineContext.setArray(M,p),this}setArray2(M,p){return this._pipelineContext.setArray2(M,p),this}setArray3(M,p){return this._pipelineContext.setArray3(M,p),this}setArray4(M,p){return this._pipelineContext.setArray4(M,p),this}setMatrices(M,p){return this._pipelineContext.setMatrices(M,p),this}setMatrix(M,p){return this._pipelineContext.setMatrix(M,p),this}setMatrix3x3(M,p){return this._pipelineContext.setMatrix3x3(M,p),this}setMatrix2x2(M,p){return this._pipelineContext.setMatrix2x2(M,p),this}setFloat(M,p){return this._pipelineContext.setFloat(M,p),this}setBool(M,p){return this._pipelineContext.setInt(M,p?1:0),this}setVector2(M,p){return this._pipelineContext.setVector2(M,p),this}setFloat2(M,p,b){return this._pipelineContext.setFloat2(M,p,b),this}setVector3(M,p){return this._pipelineContext.setVector3(M,p),this}setFloat3(M,p,b,Q){return this._pipelineContext.setFloat3(M,p,b,Q),this}setVector4(M,p){return this._pipelineContext.setVector4(M,p),this}setQuaternion(M,p){return this._pipelineContext.setQuaternion(M,p),this}setFloat4(M,p,b,Q,q){return this._pipelineContext.setFloat4(M,p,b,Q,q),this}setColor3(M,p){return this._pipelineContext.setColor3(M,p),this}setColor4(M,p,b){return this._pipelineContext.setColor4(M,p,b),this}setDirectColor4(M,p){return this._pipelineContext.setDirectColor4(M,p),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(T.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,k.f)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;p&&(B.d.GetShadersStore(Q)[`${M}PixelShader`]=p),b&&(B.d.GetShadersStore(Q)[`${M}VertexShader`]=b)}static ResetCache(){T._BaseCache={}}}T.LogShaderCodeOnCompilationError=!0,T.PersistentMode=!1,T.AutomaticallyClearCodeCache=!1,T._UniqueIdSeed=0,T._BaseCache={},T.ShadersStore=B.d.ShadersStore,T.IncludesShadersStore=B.d.IncludesShadersStore},11651:(M,p,b)=>{b.d(p,{c:()=>q});const Q={};function q(M){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Q[M])return Q[M]=!0,`${M} needs to be imported before as it contains a side-effect required by your code.`}},11632:(M,p,b)=>{function Q(){return"undefined"!==typeof window}function q(){return"undefined"!==typeof navigator}function B(){return"undefined"!==typeof document}function k(M){let p="",b=M.firstChild;for(;b;)3===b.nodeType&&(p+=b.textContent),b=b.nextSibling;return p}b.d(p,{d:()=>k,f:()=>B,j:()=>q,n:()=>Q})},11637:(M,p,b)=>{b.d(p,{c:()=>Q});class Q{static _CheckLimit(M,p){let b=Q._LogLimitOutputs[M];return b?b.current++:(b={limit:p,current:1},Q._LogLimitOutputs[M]=b),b.current<=b.limit}static _GenerateLimitMessage(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const b=Q._LogLimitOutputs[M];if(!b||!Q.MessageLimitReached)return;const q=this._Levels[p];b.current===b.limit&&Q[q.name](Q.MessageLimitReached.replace(/%LIMIT%/g,""+b.limit).replace(/%TYPE%/g,q.name??""))}static _AddLogEntry(M){Q._LogCache=M+Q._LogCache,Q.OnNewCacheEntry&&Q.OnNewCacheEntry(M)}static _FormatMessage(M){const p=M=>M<10?"0"+M:""+M,b=new Date;return"["+p(b.getHours())+":"+p(b.getMinutes())+":"+p(b.getSeconds())+"]: "+M}static _LogDisabled(M,p){}static _LogEnabled(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const q=Array.isArray(p)?p[0]:p;if(void 0!==b&&!Q._CheckLimit(q,b))return;const B=Q._FormatMessage(q),k=this._Levels[M],u=Array.isArray(p)?p.slice(1):[];k.logFunc&&k.logFunc("BJS - "+B,...u);const T=`<div style='color:${k.color}'>${B}</div><br>`;Q._AddLogEntry(T),Q._GenerateLimitMessage(q,M)}static get LogCache(){return Q._LogCache}static ClearLogCache(){Q._LogCache="",Q._LogLimitOutputs={},Q.errorsCount=0}static set LogLevels(M){Q.Log=Q._LogDisabled,Q.Warn=Q._LogDisabled,Q.Error=Q._LogDisabled;const p=[Q.MessageLogLevel,Q.WarningLogLevel,Q.ErrorLogLevel];for(const b of p)if((M&b)===b){const M=this._Levels[b];Q[M.name]=Q._LogEnabled.bind(Q,b)}}}Q.NoneLogLevel=0,Q.MessageLogLevel=1,Q.WarningLogLevel=2,Q.ErrorLogLevel=4,Q.AllLogLevel=7,Q.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Q._LogCache="",Q._LogLimitOutputs={},Q._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Q.errorsCount=0,Q.Log=Q._LogEnabled.bind(Q,Q.MessageLogLevel),Q.Warn=Q._LogEnabled.bind(Q,Q.WarningLogLevel),Q.Error=Q._LogEnabled.bind(Q,Q.ErrorLogLevel)},11624:(M,p,b)=>{b.d(p,{b:()=>k});const Q="undefined"!==typeof WeakRef;class q{constructor(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0;this.initialize(M,p,b,Q)}initialize(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0;return this.mask=M,this.skipNextObservers=p,this.target=b,this.currentTarget=Q,this}}class B{constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=M,this.mask=p,this.scope=b,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(M)}}class k{static FromPromise(M,p){const b=new k;return M.then((M=>{b.notifyObservers(M)})).catch((M=>{if(!p)throw M;p.notifyObservers(M)})),b}get observers(){return this._observers}constructor(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=p,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new q(0),M&&(this._onObserverAdded=M)}add(M){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!M)return null;const q=new B(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);q.unregisterOnNextCall=b,p?this._observers.unshift(q):this._observers.push(q),this._onObserverAdded&&this._onObserverAdded(q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(q,this._lastNotifiedValue);const k=Q?new WeakRef(this):{deref:()=>this};return q._remove=function(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=k.deref();p&&(M?p.remove(q):p._remove(q))},q}addOnce(M){return this.add(M,void 0,void 0,void 0,!0)}remove(M){if(!M)return!1;M._remove=null;return-1!==this._observers.indexOf(M)&&(this._deferUnregister(M),!0)}removeCallback(M,p){for(let b=0;b<this._observers.length;b++){const Q=this._observers[b];if(!Q._willBeUnregistered&&(Q.callback===M&&(!p||p===Q.scope)))return this._deferUnregister(Q),!0}return!1}_deferUnregister(M){M._willBeUnregistered||(this._numObserversMarkedAsDeleted++,M.unregisterOnNextCall=!1,M._willBeUnregistered=!0,setTimeout((()=>{this._remove(M)}),0))}_remove(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!M)return!1;const b=this._observers.indexOf(M);return-1!==b&&(p&&this._numObserversMarkedAsDeleted--,this._observers.splice(b,1),!0)}makeObserverTopPriority(M){this._remove(M,!1),this._observers.unshift(M)}makeObserverBottomPriority(M){this._remove(M,!1),this._observers.push(M)}notifyObservers(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,b=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=M),!this._observers.length)return!0;const B=this._eventState;B.mask=p,B.target=b,B.currentTarget=Q,B.skipNextObservers=!1,B.lastReturnValue=M,B.userInfo=q;for(const k of this._observers)if(!k._willBeUnregistered&&(k.mask&p&&(k.unregisterOnNextCall&&this._deferUnregister(k),k.scope?B.lastReturnValue=k.callback.apply(k.scope,[M,B]):B.lastReturnValue=k.callback(M,B)),B.skipNextObservers))return!1;return!0}notifyObserver(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=p),M._willBeUnregistered)return;const Q=this._eventState;Q.mask=b,Q.skipNextObservers=!1,M.unregisterOnNextCall&&this._deferUnregister(M),M.callback(p,Q)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const M=this._observers.pop();M&&(M._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const M=new k;return M._observers=this._observers.slice(0),M}hasSpecificMask(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const p of this._observers)if(p.mask&M||p.mask===M)return!0;return!1}}},11693:(M,p,b)=>{b.d(p,{e:()=>q,i:()=>k});let Q=[];class q{static SetImmediate(M){0===Q.length&&setTimeout((()=>{const M=Q;Q=[];for(const p of M)p()}),1),Q.push(M)}}function B(M,p,b){try{if(M())return p(),!0}catch(Q){return null===b||void 0===b||b(Q),!0}return!1}const k=function(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,k=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&B(M,p,b))return null;const u=setInterval((()=>{B(M,p,b)?clearInterval(u):(q-=Q,q<0&&(clearInterval(u),null===b||void 0===b||b(new Error("Operation timed out after maximum retries. "+(k||"")),!0)))}),Q);return()=>clearInterval(u)}}}]);