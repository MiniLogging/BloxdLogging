/*! For license information please see dr3w0o.9.a900f986.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{12537:(y,g,f)=>{"use strict";var p=f(12543),S=f(12552),k=f(12554);f.g.__TYPEDARRAY_POOL||(f.g.__TYPEDARRAY_POOL={UINT8:S([32,0]),UINT16:S([32,0]),UINT32:S([32,0]),INT8:S([32,0]),INT16:S([32,0]),INT32:S([32,0]),FLOAT:S([32,0]),DOUBLE:S([32,0]),DATA:S([32,0]),UINT8C:S([32,0]),BUFFER:S([32,0])});var i="undefined"!==typeof Uint8ClampedArray,H=f.g.__TYPEDARRAY_POOL;H.UINT8C||(H.UINT8C=S([32,0])),H.BUFFER||(H.BUFFER=S([32,0]));var U=H.DATA,l=H.BUFFER;function c(y){if(y){var g=y.length||y.byteLength,f=p.log2(g);U[f].push(y)}}function Z(y){y=p.nextPow2(y);var g=p.log2(y),f=U[g];return f.length>0?f.pop():new ArrayBuffer(y)}function C(y){return new Uint8Array(Z(y),0,y)}function q(y){return new Uint16Array(Z(2*y),0,y)}function W(y){return new Uint32Array(Z(4*y),0,y)}function j(y){return new Int8Array(Z(y),0,y)}function P(y){return new Int16Array(Z(2*y),0,y)}function B(y){return new Int32Array(Z(4*y),0,y)}function R(y){return new Float32Array(Z(4*y),0,y)}function G(y){return new Float64Array(Z(8*y),0,y)}function z(y){return i?new Uint8ClampedArray(Z(y),0,y):C(y)}function T(y){return new DataView(Z(y),0,y)}g.free=function(y){if(k(y))l[p.log2(y.length)].push(y);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(y)&&(y=y.buffer),!y)return;var g=y.length||y.byteLength,f=0|p.log2(g);U[f].push(y)}},g.freeUint8=g.freeUint16=g.freeUint32=g.freeInt8=g.freeInt16=g.freeInt32=g.freeFloat32=g.freeFloat=g.freeFloat64=g.freeDouble=g.freeUint8Clamped=g.freeDataView=function(y){c(y.buffer)},g.freeArrayBuffer=c,g.freeBuffer=function(y){l[p.log2(y.length)].push(y)},g.malloc=function(y,g){if(void 0===g||"arraybuffer"===g)return Z(y);switch(g){case"uint8":return C(y);case"uint16":return q(y);case"uint32":return W(y);case"int8":return j(y);case"int16":return P(y);case"int32":return B(y);case"float":case"float32":return R(y);case"double":case"float64":return G(y);case"uint8_clamped":return z(y);case"buffer":throw"Buffer not supported";case"data":case"dataview":return T(y);default:return null}return null},g.mallocArrayBuffer=Z,g.mallocUint8=C,g.mallocUint16=q,g.mallocUint32=W,g.mallocInt8=j,g.mallocInt16=P,g.mallocInt32=B,g.mallocFloat32=g.mallocFloat=R,g.mallocFloat64=g.mallocDouble=G,g.mallocUint8Clamped=z,g.mallocDataView=T,g.clearCache=function(){for(var y=0;y<32;++y)H.UINT8[y].length=0,H.UINT16[y].length=0,H.UINT32[y].length=0,H.INT8[y].length=0,H.INT16[y].length=0,H.INT32[y].length=0,H.FLOAT[y].length=0,H.DOUBLE[y].length=0,H.UINT8C[y].length=0,U[y].length=0,l[y].length=0}},12641:(y,g,f)=>{y.exports=S;var p=f(11978);function S(y,g){if(!(this instanceof S))return new S(y,g);var f=p.create();p.add(f,y,g),this.base=p.min(p.create(),y,f),this.hh=p.clone(g),this.max=p.max(p.create(),y,f),this.mag=p.length(this.hh)}var k=S.prototype;k.width=function(){return this.hh[0]},k.height=function(){return this.hh[1]},k.depth=function(){return this.hh[2]},k.x0=function(){return this.base[0]},k.y0=function(){return this.base[1]},k.z0=function(){return this.base[2]},k.x1=function(){return this.max[0]},k.y1=function(){return this.max[1]},k.z1=function(){return this.max[2]},k.translate=function(y){return p.add(this.max,this.max,y),p.add(this.base,this.base,y),this},k.setPosition=function(y){return p.add(this.max,y,this.hh),p.i(this.base,y),this},k.expand=function(y){var g=p.create(),f=p.create();return p.max(g,y.max,this.max),p.min(f,y.base,this.base),p.ed(g,g,f),new S(f,g)},k.intersects=function(y){return!(y.base[0]>this.max[0])&&(!(y.base[1]>this.max[1])&&(!(y.base[2]>this.max[2])&&(!(y.max[0]<this.base[0])&&(!(y.max[1]<this.base[1])&&!(y.max[2]<this.base[2])))))},k.touches=function(y){var g=this.union(y);return null!==g&&(0==g.width()||0==g.height()||0==g.depth())},k.union=function(y){if(!this.intersects(y))return null;var g=Math.max(y.base[0],this.base[0]),f=Math.max(y.base[1],this.base[1]),p=Math.max(y.base[2],this.base[2]);return new S([g,f,p],[Math.min(y.max[0],this.max[0])-g,Math.min(y.max[1],this.max[1])-f,Math.min(y.max[2],this.max[2])-p])}},12543:(y,g)=>{"use strict";function f(y){var g=32;return(y&=-y)&&g--,65535&y&&(g-=16),16711935&y&&(g-=8),252645135&y&&(g-=4),858993459&y&&(g-=2),1431655765&y&&(g-=1),g}g.INT_BITS=32,g.INT_MAX=2147483647,g.INT_MIN=-1<<31,g.sign=function(y){return(y>0)-(y<0)},g.abs=function(y){var g=y>>31;return(y^g)-g},g.min=function(y,g){return g^(y^g)&-(y<g)},g.max=function(y,g){return y^(y^g)&-(y<g)},g.isPow2=function(y){return!(y&y-1)&&!!y},g.log2=function(y){var g,f;return g=(y>65535)<<4,g|=f=((y>>>=g)>255)<<3,g|=f=((y>>>=f)>15)<<2,(g|=f=((y>>>=f)>3)<<1)|(y>>>=f)>>1},g.log10=function(y){return y>=1e9?9:y>=1e8?8:y>=1e7?7:y>=1e6?6:y>=1e5?5:y>=1e4?4:y>=1e3?3:y>=100?2:y>=10?1:0},g.popCount=function(y){return 16843009*((y=(858993459&(y-=y>>>1&1431655765))+(y>>>2&858993459))+(y>>>4)&252645135)>>>24},g.countTrailingZeros=f,g.nextPow2=function(y){return y+=0===y,--y,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)+1},g.prevPow2=function(y){return y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)-(y>>>1)},g.parity=function(y){return y^=y>>>16,y^=y>>>8,y^=y>>>4,27030>>>(y&=15)&1};var p=new Array(256);!function(y){for(var g=0;g<256;++g){var f=g,p=g,S=7;for(f>>>=1;f;f>>>=1)p<<=1,p|=1&f,--S;y[g]=p<<S&255}}(p),g.reverse=function(y){return p[255&y]<<24|p[y>>>8&255]<<16|p[y>>>16&255]<<8|p[y>>>24&255]},g.interleave2=function(y,g){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))|(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))<<1},g.deinterleave2=function(y,g){return(y=65535&((y=16711935&((y=252645135&((y=858993459&((y=y>>>g&1431655765)|y>>>1))|y>>>2))|y>>>4))|y>>>16))<<16>>16},g.interleave3=function(y,g,f){return y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2),(y|=(g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2))<<1)|(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<2},g.deinterleave3=function(y,g){return(y=1023&((y=4278190335&((y=251719695&((y=3272356035&((y=y>>>g&1227133513)|y>>>2))|y>>>4))|y>>>8))|y>>>16))<<22>>22},g.nextCombination=function(y){var g=y|y-1;return g+1|(~g&-~g)-1>>>f(y)+1}},12534:(y,g,f)=>{"use strict";y.exports=function(y,g,f){switch(arguments.length){case 1:return p=[],l(S=y,S,c,!0),p;case 2:return"function"===typeof g?l(y,y,g,!0):function(y,g){return p=[],l(y,g,c,!1),p}(y,g);case 3:return l(y,g,f,!1);default:throw new Error("box-intersect: Invalid arguments")}var S};var p,S=f(12537),k=f(12563),i=f(12572);function H(y,g){for(var f=0;f<y;++f)if(!(g[f]<=g[f+y]))return!0;return!1}function U(y,g,f,p){for(var S=0,k=0,i=0,U=y.length;i<U;++i){var l=y[i];if(!H(g,l)){for(var c=0;c<2*g;++c)f[S++]=l[c];p[k++]=i}}return k}function l(y,g,f,p){var H=y.length,l=g.length;if(!(H<=0||l<=0)){var c=y[0].length>>>1;if(!(c<=0)){var Z,C=S.mallocDouble(2*c*H),q=S.mallocInt32(H);if((H=U(y,c,C,q))>0){if(1===c&&p)k.init(H),Z=k.sweepComplete(c,f,0,H,C,q,0,H,C,q);else{var W=S.mallocDouble(2*c*l),j=S.mallocInt32(l);(l=U(g,c,W,j))>0&&(k.init(H+l),Z=1===c?k.sweepBipartite(c,f,0,H,C,q,0,l,W,j):i(c,f,p,H,C,q,l,W,j),S.free(W),S.free(j))}S.free(C),S.free(q)}return Z}}}function c(y,g){p.push([y,g])}},12580:(y,g)=>{"use strict";var f="d",p="ax",S="fp",k="es",i="rs",H="re",U="rb",l="bs",c="be",Z="bb",C=[f,p,"vv",i,H,U,"ri",l,c,Z,"bi"];function q(y){var g="bruteForce"+(y?"Full":"Partial"),p=[],i=C.slice();y||i.splice(3,0,S);var H=["function "+g+"("+i.join()+"){"];function U(g,S){var i=function(y,g,p){var S="bruteForce"+(y?"Red":"Blue")+(g?"Flip":"")+(p?"Full":""),i=["function ",S,"(",C.join(),"){","var ",k,"=2*",f,";"],H="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",U="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(p?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return y?i.push(H,"Q",":",U):i.push(U,"Q",":",H),p?i.push("if(y1<x0||x1<y0)continue;"):g?i.push("if(y0<=x0||x1<y0)continue;"):i.push("if(y0<x0||x1<y0)continue;"),i.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),g?i.push("yi,xi"):i.push("xi,yi"),i.push(");if(rv!==void 0)return rv;}}}"),{name:S,code:i.join("")}}(g,S,y);p.push(i.code),H.push("return "+i.name+"("+C.join()+");")}H.push("if(re-rs>be-bs){"),y?(U(!0,!1),H.push("}else{"),U(!1,!1)):(H.push("if(fp){"),U(!0,!0),H.push("}else{"),U(!0,!1),H.push("}}else{if(fp){"),U(!1,!0),H.push("}else{"),U(!1,!1),H.push("}")),H.push("}}return "+g);var l=p.join("")+H.join("");return new Function(l)()}g.partial=q(!1),g.full=q(!0)},12572:(y,g,f)=>{"use strict";y.exports=function(y,g,f,k,c,I,Y,n,M){!function(y,g){var f=8*S.log2(g+1)*(y+1)|0,k=S.nextPow2(z*f);Q.length<k&&(p.free(Q),Q=p.mallocInt32(k));var i=S.nextPow2(T*f);m.length<i&&(p.free(m),m=p.mallocDouble(i))}(y,k+Y);var r,N=0,b=2*y;a(N++,0,0,k,0,Y,f?16:0,-1/0,1/0),f||a(N++,0,0,Y,0,k,1,-1/0,1/0);for(;N>0;){var s=(N-=1)*z,u=Q[s],F=Q[s+1],A=Q[s+2],J=Q[s+3],V=Q[s+4],e=Q[s+5],h=N*T,D=m[h],K=m[h+1],X=1&e,E=!!(16&e),O=c,L=I,x=n,d=M;if(X&&(O=n,L=M,x=c,d=I),!(2&e&&F>=(A=P(y,u,F,A,O,L,K)))&&!(4&e&&(F=B(y,u,F,A,O,L,D))>=A)){var t=A-F,v=V-J;if(E){if(y*t*(t+v)<q){if(void 0!==(r=U.scanComplete(y,u,g,F,A,O,L,J,V,x,d)))return r;continue}}else{if(y*Math.min(t,v)<Z){if(void 0!==(r=i(y,u,g,X,F,A,O,L,J,V,x,d)))return r;continue}if(y*t*v<C){if(void 0!==(r=U.scanBipartite(y,u,g,X,F,A,O,L,J,V,x,d)))return r;continue}}var yy=W(y,u,F,A,O,L,D,K);if(F<yy)if(y*(yy-F)<Z){if(void 0!==(r=H(y,u+1,g,F,yy,O,L,J,V,x,d)))return r}else if(u===y-2){if(void 0!==(r=X?U.sweepBipartite(y,g,J,V,x,d,F,yy,O,L):U.sweepBipartite(y,g,F,yy,O,L,J,V,x,d)))return r}else a(N++,u+1,F,yy,J,V,X,-1/0,1/0),a(N++,u+1,J,V,F,yy,1^X,-1/0,1/0);if(yy<A){var gy=l(y,u,J,V,x,d),fy=x[b*gy+u],py=j(y,u,gy,V,x,d,fy);if(py<V&&a(N++,u,yy,A,py,V,(4|X)+(E?16:0),fy,K),J<gy&&a(N++,u,yy,A,J,gy,(2|X)+(E?16:0),D,fy),gy+1===py){if(void 0!==(r=E?o(y,u,g,yy,A,O,L,gy,x,d[gy]):w(y,u,g,X,yy,A,O,L,gy,x,d[gy])))return r}else if(gy<py){var Sy;if(E){if(yy<(Sy=R(y,u,yy,A,O,L,fy))){var ky=j(y,u,yy,Sy,O,L,fy);if(u===y-2){if(yy<ky&&void 0!==(r=U.sweepComplete(y,g,yy,ky,O,L,gy,py,x,d)))return r;if(ky<Sy&&void 0!==(r=U.sweepBipartite(y,g,ky,Sy,O,L,gy,py,x,d)))return r}else yy<ky&&a(N++,u+1,yy,ky,gy,py,16,-1/0,1/0),ky<Sy&&(a(N++,u+1,ky,Sy,gy,py,0,-1/0,1/0),a(N++,u+1,gy,py,ky,Sy,1,-1/0,1/0))}}else yy<(Sy=X?G(y,u,yy,A,O,L,fy):R(y,u,yy,A,O,L,fy))&&(u===y-2?r=X?U.sweepBipartite(y,g,gy,py,x,d,yy,Sy,O,L):U.sweepBipartite(y,g,yy,Sy,O,L,gy,py,x,d):(a(N++,u+1,yy,Sy,gy,py,X,-1/0,1/0),a(N++,u+1,gy,py,yy,Sy,1^X,-1/0,1/0)))}}}}};var p=f(12537),S=f(12543),k=f(12580),i=k.partial,H=k.full,U=f(12563),l=f(12589),c=f(12593),Z=128,C=1<<22,q=1<<22,W=c("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),j=c("lo===p0",["p0"]),P=c("lo<p0",["p0"]),B=c("hi<=p0",["p0"]),R=c("lo<=p0&&p0<=hi",["p0"]),G=c("lo<p0&&p0<=hi",["p0"]),z=6,T=2,Q=p.mallocInt32(1024),m=p.mallocDouble(1024);function a(y,g,f,p,S,k,i,H,U){var l=z*y;Q[l]=g,Q[l+1]=f,Q[l+2]=p,Q[l+3]=S,Q[l+4]=k,Q[l+5]=i;var c=T*y;m[c]=H,m[c+1]=U}function w(y,g,f,p,S,k,i,H,U,l,c){var Z=2*y,C=U*Z,q=l[C+g];y:for(var W=S,j=S*Z;W<k;++W,j+=Z){var P=i[j+g],B=i[j+g+y];if(!(q<P||B<q)&&(!p||q!==P)){for(var R,G=H[W],z=g+1;z<y;++z){P=i[j+z],B=i[j+z+y];var T=l[C+z],Q=l[C+z+y];if(B<T||Q<P)continue y}if(void 0!==(R=p?f(c,G):f(G,c)))return R}}}function o(y,g,f,p,S,k,i,H,U,l){var c=2*y,Z=H*c,C=U[Z+g];y:for(var q=p,W=p*c;q<S;++q,W+=c){var j=i[q];if(j!==l){var P=k[W+g],B=k[W+g+y];if(!(C<P||B<C)){for(var R=g+1;R<y;++R){P=k[W+R],B=k[W+R+y];var G=U[Z+R],z=U[Z+R+y];if(B<G||z<P)continue y}var T=f(j,l);if(void 0!==T)return T}}}}},12589:(y,g,f)=>{"use strict";y.exports=function(y,g,f,i,H,U){if(i<=f+1)return f;var l=f,c=i,Z=i+f>>>1,C=2*y,q=Z,W=H[C*Z+g];for(;l<c;){if(c-l<S){k(y,g,l,c,H,U),W=H[C*Z+g];break}var j=c-l,P=Math.random()*j+l|0,B=H[C*P+g],R=Math.random()*j+l|0,G=H[C*R+g],z=Math.random()*j+l|0,T=H[C*z+g];B<=G?T>=G?(q=R,W=G):B>=T?(q=P,W=B):(q=z,W=T):G>=T?(q=R,W=G):T>=B?(q=P,W=B):(q=z,W=T);for(var Q=C*(c-1),m=C*q,a=0;a<C;++a,++Q,++m){var w=H[Q];H[Q]=H[m],H[m]=w}var o=U[c-1];U[c-1]=U[q],U[q]=o;for(Q=C*(c-1),m=C*(q=p(y,g,l,c-1,H,U,W)),a=0;a<C;++a,++Q,++m){w=H[Q];H[Q]=H[m],H[m]=w}o=U[c-1];if(U[c-1]=U[q],U[q]=o,Z<q){for(c=q-1;l<c&&H[C*(c-1)+g]===W;)c-=1;c+=1}else{if(!(q<Z))break;for(l=q+1;l<c&&H[C*l+g]===W;)l+=1}}return p(y,g,f,Z,H,U,H[C*Z+g])};var p=f(12593)("lo<p0",["p0"]),S=8;function k(y,g,f,p,S,k){for(var i=2*y,H=i*(f+1)+g,U=f+1;U<p;++U,H+=i)for(var l=S[H],c=U,Z=i*(U-1);c>f&&S[Z+g]>l;--c,Z-=i){for(var C=Z,q=Z+i,W=0;W<i;++W,++C,++q){var j=S[C];S[C]=S[q],S[q]=j}var P=k[c];k[c]=k[c-1],k[c-1]=P}}},12593:y=>{"use strict";y.exports=function(y,f){var p="abcdef".split("").concat(f),S=[];y.indexOf("lo")>=0&&S.push("lo=e[k+n]");y.indexOf("hi")>=0&&S.push("hi=e[k+o]");return p.push(g.replace("_",S.join()).replace("$",y)),Function.apply(void 0,p)};var g="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12570:y=>{"use strict";y.exports=function(y,p){p<=4*g?f(0,p-1,y):l(0,p-1,y)};var g=32;function f(y,g,f){for(var p=2*(y+1),S=y+1;S<=g;++S){for(var k=f[p++],i=f[p++],H=S,U=p-2;H-- >y;){var l=f[U-2],c=f[U-1];if(l<k)break;if(l===k&&c<i)break;f[U]=l,f[U+1]=c,U-=2}f[U]=k,f[U+1]=i}}function p(y,g,f){g*=2;var p=f[y*=2],S=f[y+1];f[y]=f[g],f[y+1]=f[g+1],f[g]=p,f[g+1]=S}function S(y,g,f){g*=2,f[y*=2]=f[g],f[y+1]=f[g+1]}function k(y,g,f,p){g*=2,f*=2;var S=p[y*=2],k=p[y+1];p[y]=p[g],p[y+1]=p[g+1],p[g]=p[f],p[g+1]=p[f+1],p[f]=S,p[f+1]=k}function i(y,g,f,p,S){g*=2,S[y*=2]=S[g],S[g]=f,S[y+1]=S[g+1],S[g+1]=p}function H(y,g,f){g*=2;var p=f[y*=2],S=f[g];return!(p<S)&&(p!==S||f[y+1]>f[g+1])}function U(y,g,f,p){var S=p[y*=2];return S<g||S===g&&p[y+1]<f}function l(y,c,Z){var C=(c-y+1)/6|0,q=y+C,W=c-C,j=y+c>>1,P=j-C,B=j+C,R=q,G=P,z=j,T=B,Q=W,m=y+1,a=c-1,w=0;H(R,G,Z)&&(w=R,R=G,G=w),H(T,Q,Z)&&(w=T,T=Q,Q=w),H(R,z,Z)&&(w=R,R=z,z=w),H(G,z,Z)&&(w=G,G=z,z=w),H(R,T,Z)&&(w=R,R=T,T=w),H(z,T,Z)&&(w=z,z=T,T=w),H(G,Q,Z)&&(w=G,G=Q,Q=w),H(G,z,Z)&&(w=G,G=z,z=w),H(T,Q,Z)&&(w=T,T=Q,Q=w);for(var o=Z[2*G],I=Z[2*G+1],Y=Z[2*T],n=Z[2*T+1],M=2*R,r=2*z,N=2*Q,b=2*q,s=2*j,u=2*W,F=0;F<2;++F){var A=Z[M+F],J=Z[r+F],V=Z[N+F];Z[b+F]=A,Z[s+F]=J,Z[u+F]=V}S(P,y,Z),S(B,c,Z);for(var e=m;e<=a;++e)if(U(e,o,I,Z))e!==m&&p(e,m,Z),++m;else if(!U(e,Y,n,Z))for(;;){if(U(a,Y,n,Z)){U(a,o,I,Z)?(k(e,m,a,Z),++m,--a):(p(e,a,Z),--a);break}if(--a<e)break}i(y,m-1,o,I,Z),i(c,a+1,Y,n,Z),m-2-y<=g?f(y,m-2,Z):l(y,m-2,Z),c-(a+2)<=g?f(a+2,c,Z):l(a+2,c,Z),a-m<=g?f(m,a,Z):l(m,a,Z)}},12563:(y,g,f)=>{"use strict";y.exports={init:function(y){var g=S.nextPow2(y);U.length<g&&(p.free(U),U=p.mallocInt32(g));l.length<g&&(p.free(l),l=p.mallocInt32(g));c.length<g&&(p.free(c),c=p.mallocInt32(g));Z.length<g&&(p.free(Z),Z=p.mallocInt32(g));C.length<g&&(p.free(C),C=p.mallocInt32(g));q.length<g&&(p.free(q),q=p.mallocInt32(g));var f=8*g;W.length<f&&(p.free(W),W=p.mallocDouble(f))},sweepBipartite:function(y,g,f,p,S,H,C,q,B,R){for(var G=0,z=2*y,T=y-1,Q=z-1,m=f;m<p;++m){var a=H[m],w=z*m;W[G++]=S[w+T],W[G++]=-(a+1),W[G++]=S[w+Q],W[G++]=a}for(m=C;m<q;++m){a=R[m]+i;var o=z*m;W[G++]=B[o+T],W[G++]=-a,W[G++]=B[o+Q],W[G++]=a}var I=G>>>1;k(W,I);var Y=0,n=0;for(m=0;m<I;++m){var M=0|W[2*m+1];if(M>=i)j(c,Z,n--,M=M-i|0);else if(M>=0)j(U,l,Y--,M);else if(M<=-i){M=-M-i|0;for(var r=0;r<Y;++r){if(void 0!==(N=g(U[r],M)))return N}P(c,Z,n++,M)}else{M=-M-1|0;for(r=0;r<n;++r){var N;if(void 0!==(N=g(M,c[r])))return N}P(U,l,Y++,M)}}},sweepComplete:function(y,g,f,p,S,i,H,B,R,G){for(var z=0,T=2*y,Q=y-1,m=T-1,a=f;a<p;++a){var w=i[a]+1<<1,o=T*a;W[z++]=S[o+Q],W[z++]=-w,W[z++]=S[o+m],W[z++]=w}for(a=H;a<B;++a){w=G[a]+1<<1;var I=T*a;W[z++]=R[I+Q],W[z++]=1|-w,W[z++]=R[I+m],W[z++]=1|w}var Y=z>>>1;k(W,Y);var n=0,M=0,r=0;for(a=0;a<Y;++a){var N=0|W[2*a+1],b=1&N;if(a<Y-1&&N>>1===W[2*a+3]>>1&&(b=2,a+=1),N<0){for(var s=-(N>>1)-1,u=0;u<r;++u){if(void 0!==(F=g(C[u],s)))return F}if(0!==b)for(u=0;u<n;++u){if(void 0!==(F=g(U[u],s)))return F}if(1!==b)for(u=0;u<M;++u){var F;if(void 0!==(F=g(c[u],s)))return F}0===b?P(U,l,n++,s):1===b?P(c,Z,M++,s):2===b&&P(C,q,r++,s)}else{s=(N>>1)-1;0===b?j(U,l,n--,s):1===b?j(c,Z,M--,s):2===b&&j(C,q,r--,s)}}},scanBipartite:function(y,g,f,p,S,H,c,Z,C,q,B,R){var G=0,z=2*y,T=g,Q=g+y,m=1,a=1;p?a=i:m=i;for(var w=S;w<H;++w){var o=w+m,I=z*w;W[G++]=c[I+T],W[G++]=-o,W[G++]=c[I+Q],W[G++]=o}for(w=C;w<q;++w){o=w+a;var Y=z*w;W[G++]=B[Y+T],W[G++]=-o}var n=G>>>1;k(W,n);var M=0;for(w=0;w<n;++w){var r=0|W[2*w+1];if(r<0){var N=!1;if((o=-r)>=i?(N=!p,o-=i):(N=!!p,o-=1),N)P(U,l,M++,o);else{var b=R[o],s=z*o,u=B[s+g+1],F=B[s+g+1+y];y:for(var A=0;A<M;++A){var J=U[A],V=z*J;if(!(F<c[V+g+1]||c[V+g+1+y]<u)){for(var e=g+2;e<y;++e)if(B[s+e+y]<c[V+e]||c[V+e+y]<B[s+e])continue y;var h,D=Z[J];if(void 0!==(h=p?f(b,D):f(D,b)))return h}}}}else j(U,l,M--,r-m)}},scanComplete:function(y,g,f,p,S,H,l,c,Z,C,q){for(var j=0,P=2*y,B=g,R=g+y,G=p;G<S;++G){var z=G+i,T=P*G;W[j++]=H[T+B],W[j++]=-z,W[j++]=H[T+R],W[j++]=z}for(G=c;G<Z;++G){z=G+1;var Q=P*G;W[j++]=C[Q+B],W[j++]=-z}var m=j>>>1;k(W,m);var a=0;for(G=0;G<m;++G){var w=0|W[2*G+1];if(w<0){if((z=-w)>=i)U[a++]=z-i;else{var o=q[z-=1],I=P*z,Y=C[I+g+1],n=C[I+g+1+y];y:for(var M=0;M<a;++M){var r=U[M],N=l[r];if(N===o)break;var b=P*r;if(!(n<H[b+g+1]||H[b+g+1+y]<Y)){for(var s=g+2;s<y;++s)if(C[I+s+y]<H[b+s]||H[b+s+y]<C[I+s])continue y;var u=f(N,o);if(void 0!==u)return u}}}}else{for(z=w-i,M=a-1;M>=0;--M)if(U[M]===z){for(s=M+1;s<a;++s)U[s-1]=U[s];break}--a}}}};var p=f(12537),S=f(12543),k=f(12570),i=1<<28,H=1024,U=p.mallocInt32(H),l=p.mallocInt32(H),c=p.mallocInt32(H),Z=p.mallocInt32(H),C=p.mallocInt32(H),q=p.mallocInt32(H),W=p.mallocDouble(8192);function j(y,g,f,p){var S=g[p],k=y[f-1];y[S]=k,g[k]=S}function P(y,g,f,p){y[f]=p,g[p]=f}},12552:y=>{"use strict";function g(y,f,p){var S=0|y[p];if(S<=0)return[];var k,i=new Array(S);if(p===y.length-1)for(k=0;k<S;++k)i[k]=f;else for(k=0;k<S;++k)i[k]=g(y,f,p+1);return i}y.exports=function(y,f){switch("undefined"===typeof f&&(f=0),typeof y){case"number":if(y>0)return function(y,g){var f,p;for(f=new Array(y),p=0;p<y;++p)f[p]=g;return f}(0|y,f);break;case"object":if("number"===typeof y.length)return g(y,f,0)}return[]}},12496:(y,g,f)=>{y.exports=function(){var y=this;this.components={},this.comps=this.components;var g=this.components,f=1,S={},k=[],i=[],H={timeout:!1,removals:[],multiComps:[]};function U(y,f){var p=g[f],k=S[f],i=k.hash[y];i&&(k.remove(y),p.bb&&(p.multi?(i.forEach((g=>{g&&p.bb(y,g)})),i.length=0):p.bb(y,i)),H.removals.push(k),l())}function l(){H.timeout||(H.timeout=!0,setTimeout(c,1))}function c(){H.timeout=!1,Z()}function Z(){H.multiComps.length&&function(y){for(var g=0;g<y.length;g++){var{entID:f,data:p}=y[g],S=p.hash[f];if(S){for(var k=0;k<S.length;k++)S[k]||(S.splice(k,1),k--);0===S.length&&(p.remove(f),H.removals.push(p))}}y.length=0}(H.multiComps),H.removals.length&&function(y){for(var g=0;g<y.length;g++){y[g].flush()}y.length=0}(H.removals)}this.Gi=S,this._systems=k,this._renderSystems=i,this.nh=function(g){var p=f++;return Array.isArray(g)&&g.forEach((g=>y.if(p,g))),p},this.deleteEntity=function(g){return Object.keys(S).forEach((y=>{S[y].hash[g]&&U(g,y)})),y},this.Lh=function(y){if(!y)throw new Error("Missing component definition");var f=y.name;if(!f)throw new Error("Component definition must have a name property.");if("string"!==typeof f)throw new Error("Component name must be a string.");if(""===f)throw new Error("Component name must be a non-empty string.");if(S[f])throw new Error(`Component ${f} already exists.`);var H={};return H.name=f,H.multi=!!y.multi,H.order=isNaN(y.order)?99:y.order,H.stateConstructor=y.stateConstructor||null,H.state=y.state||{},H.sd=y.sd||null,H.bb=y.bb||null,H.system=y.system||null,H.ee=y.ee||null,g[f]=H,S[f]=new p,S[f]._pendingMultiCleanup=!1,S[f]._multiCleanupIDs=H.multi?[]:null,H.system&&(k.push(f),k.sort(((y,f)=>g[y].order-g[f].order))),H.ee&&(i.push(f),i.sort(((y,f)=>g[y].order-g[f].order))),f},this.overwriteComponent=function(y,f){var p=g[y];if(!p)throw new Error(`Unknown component: ${y}`);if(!f)throw new Error("Missing component definition");if(p.name!==f.name)throw new Error("Overwriting component must use the same name property.");var H={};H.name=y,H.multi=!!f.multi,H.order=isNaN(f.order)?99:f.order,H.state=f.state||{},H.sd=f.sd||null,H.bb=f.bb||null,H.system=f.system||null,H.ee=f.ee||null,g[y]=H,S[y]._pendingMultiCleanup=!1,S[y]._multiCleanupIDs=H.multi?[]:null;var U=k.indexOf(y);H.system&&U<0&&k.push(y),!H.system&&U>=0&&k.splice(U,1),k.sort(((y,f)=>g[y].order-g[f].order));var l=i.indexOf(y);H.ee&&l<0&&i.push(y),!H.ee&&l>=0&&i.splice(l,1),i.sort(((y,f)=>g[y].order-g[f].order));var c=H.state;return this.Mg(y).forEach((y=>{for(var g in c)g in y||(y[g]=c[g]);H.sd&&H.sd(y.be,y)})),y},this.deleteComponent=function(f){var p=S[f];if(!p)throw new Error(`Unknown component: ${f}`);p.flush(),p.list.forEach((y=>{y&&U(y.be||y[0].be,f)}));var H=k.indexOf(f),l=i.indexOf(f);return H>-1&&k.splice(H,1),l>-1&&i.splice(l,1),S[f].dispose(),delete S[f],delete g[f],y},this.if=function(y,f,p){var k,i=g[f],H=S[f];if(!H)throw new Error(`Unknown component: ${f}.`);if(H.hash[y]&&!i.multi)throw new Error(`Entity ${y} already has component: ${f}.`);if(i.stateConstructor){if(!(k=new i.stateConstructor).hasOwnProperty("be"))throw new Error(`Component ${i.name} stateConstructor type does not have property __id`)}else k=Object.assign({},{be:y},i.state,p);if(k.be=y,i.multi){var U=H.hash[y];U||(U=[],H.add(y,U)),U.push(k)}else H.add(y,k);return i.sd&&i.sd(y,k),this},this.Af=function(y,g){var f=S[g];if(!f)throw new Error(`Unknown component: ${g}.`);return!!f.hash[y]},this.qf=function(g,f){if(!S[f])throw new Error(`Unknown component: ${f}.`);return U(g,f),y},this.getState=function(y,g){var f=S[g];if(!f)throw new Error(`Unknown component: ${g}.`);return f.hash[y]},this.Mg=function(y){var g=S[y];if(!g)throw new Error(`Unknown component: ${y}.`);return Z(),g.list},this.Bk=function(y){if(!S[y])throw new Error(`Unknown component: ${y}.`);var g=S[y].hash;return y=>g[y]},this.Ek=function(y){if(!S[y])throw new Error(`Unknown component: ${y}.`);var g=S[y].hash;return y=>!!g[y]},this.Td=function(f){Z();for(var p=0;p<k.length;p++){var i=k[p],H=g[i],U=S[i];H.system(f,U.list),Z()}return y},this.render=function(f){Z();for(var p=0;p<i.length;p++){var k=i[p],H=g[k],U=S[k];H.ee(f,U.list),Z()}return y},this.removeMultiComponent=function(f,p,k){var i=g[p],U=S[p];if(!U)throw new Error(`Unknown component: ${p}.`);if(!i.multi)throw new Error("removeMultiComponent called on non-multi component");return function(y,g,f,p){var S=f.hash[y];if(S){var k=S[p];k&&(S[p]=null,g.bb&&g.bb(y,k),H.multiComps.push({entID:y,data:f}),l())}}(f,i,U,k),y}};var p=f(12505)},12505:y=>{function g(y,g){var f=y._map[g];if(delete y.hash[g],delete y._map[g],f===y.list.length-1)y.list.pop();else{var p=y.list.pop();if(y.list[f]=p,null===p||null===p[0]){var S=y.list.length;for(var k in y._map)if(y._map[k]===S)return void(y._map[k]=f)}else{var i=p.be||p[0].be;y._map[i]=f}}}y.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(y,g){if("number"===typeof this._map[y]){var f=this._map[y];this.hash[y]=g,this.list[f]=g}else this._map[y]=this.list.length,this.hash[y]=g,this.list.push(g)}remove(y){var g=this._map[y];this.hash[y]=null,this.list[g]=null,this._pendingRemovals.push(y)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var y=0;y<this._pendingRemovals.length;y++){var f=this._pendingRemovals[y];null===this.hash[f]&&g(this,f)}this._pendingRemovals.length=0}}},12452:y=>{"use strict";var g,f="object"===typeof Reflect?Reflect:null,p=function(y,g,f){return Function.prototype.apply.call(y,g,f)};g=f&&"function"===typeof f.ownKeys?f.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var S=Number.isNaN||function(y){return y!==y};function k(){k.init.call(this)}y.exports=k,y.exports.once=function(y,g){return new Promise((function(f,p){function S(f){y.removeListener(g,k),p(f)}function k(){"function"===typeof y.removeListener&&y.removeListener("error",S),f([].slice.call(arguments))}j(y,g,k,{once:!0}),"error"!==g&&function(y,g,f){"function"===typeof y.on&&j(y,"error",g,f)}(y,S,{once:!0})}))},k.EventEmitter=k,k.prototype._events=void 0,k.prototype._eventsCount=0,k.prototype._maxListeners=void 0;var i=10;function H(y){if("function"!==typeof y)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}function U(y){return void 0===y._maxListeners?k.defaultMaxListeners:y._maxListeners}function l(y,g,f,p){var S,k,i,l;if(H(f),void 0===(k=y._events)?(k=y._events=Object.create(null),y._eventsCount=0):(void 0!==k.newListener&&(y.emit("newListener",g,f.listener?f.listener:f),k=y._events),i=k[g]),void 0===i)i=k[g]=f,++y._eventsCount;else if("function"===typeof i?i=k[g]=p?[f,i]:[i,f]:p?i.unshift(f):i.push(f),(S=U(y))>0&&i.length>S&&!i.warned){i.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.j=y,c.type=g,c.count=i.length,l=c,console&&console.warn&&console.warn(l)}return y}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(y,g,f){var p={fired:!1,wrapFn:void 0,target:y,type:g,listener:f},S=c.bind(p);return S.listener=f,p.wrapFn=S,S}function C(y,g,f){var p=y._events;if(void 0===p)return[];var S=p[g];return void 0===S?[]:"function"===typeof S?f?[S.listener||S]:[S]:f?function(y){for(var g=new Array(y.length),f=0;f<g.length;++f)g[f]=y[f].listener||y[f];return g}(S):W(S,S.length)}function q(y){var g=this._events;if(void 0!==g){var f=g[y];if("function"===typeof f)return 1;if(void 0!==f)return f.length}return 0}function W(y,g){for(var f=new Array(g),p=0;p<g;++p)f[p]=y[p];return f}function j(y,g,f,p){if("function"===typeof y.on)p.once?y.once(g,f):y.on(g,f);else{if("function"!==typeof y.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y);y.addEventListener(g,(function S(k){p.once&&y.removeEventListener(g,S),f(k)}))}}Object.defineProperty(k,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(y){if("number"!==typeof y||y<0||S(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");i=y}}),k.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},k.prototype.setMaxListeners=function(y){if("number"!==typeof y||y<0||S(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},k.prototype.getMaxListeners=function(){return U(this)},k.prototype.emit=function(y){for(var g=[],f=1;f<arguments.length;f++)g.push(arguments[f]);var S="error"===y,k=this._events;if(void 0!==k)S=S&&void 0===k.error;else if(!S)return!1;if(S){var i;if(g.length>0&&(i=g[0]),i instanceof Error)throw i;var H=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw H.context=i,H}var U=k[y];if(void 0===U)return!1;if("function"===typeof U)p(U,this,g);else{var l=U.length,c=W(U,l);for(f=0;f<l;++f)p(c[f],this,g)}return!0},k.prototype.addListener=function(y,g){return l(this,y,g,!1)},k.prototype.on=k.prototype.addListener,k.prototype.prependListener=function(y,g){return l(this,y,g,!0)},k.prototype.once=function(y,g){return H(g),this.on(y,Z(this,y,g)),this},k.prototype.prependOnceListener=function(y,g){return H(g),this.prependListener(y,Z(this,y,g)),this},k.prototype.removeListener=function(y,g){var f,p,S,k,i;if(H(g),void 0===(p=this._events))return this;if(void 0===(f=p[y]))return this;if(f===g||f.listener===g)0===--this._eventsCount?this._events=Object.create(null):(delete p[y],p.removeListener&&this.emit("removeListener",y,f.listener||g));else if("function"!==typeof f){for(S=-1,k=f.length-1;k>=0;k--)if(f[k]===g||f[k].listener===g){i=f[k].listener,S=k;break}if(S<0)return this;0===S?f.shift():function(y,g){for(;g+1<y.length;g++)y[g]=y[g+1];y.pop()}(f,S),1===f.length&&(p[y]=f[0]),void 0!==p.removeListener&&this.emit("removeListener",y,i||g)}return this},k.prototype.off=k.prototype.removeListener,k.prototype.removeAllListeners=function(y){var g,f,p;if(void 0===(f=this._events))return this;if(void 0===f.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==f[y]&&(0===--this._eventsCount?this._events=Object.create(null):delete f[y]),this;if(0===arguments.length){var S,k=Object.keys(f);for(p=0;p<k.length;++p)"removeListener"!==(S=k[p])&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(g=f[y]))this.removeListener(y,g);else if(void 0!==g)for(p=g.length-1;p>=0;p--)this.removeListener(y,g[p]);return this},k.prototype.listeners=function(y){return C(this,y,!0)},k.prototype.rawListeners=function(y){return C(this,y,!1)},k.listenerCount=function(y,g){return"function"===typeof y.listenerCount?y.listenerCount(g):q.call(y,g)},k.prototype.listenerCount=q,k.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]}},12796:y=>{"use strict";y.exports=function(y,g,f,p,S,k){var i=+g[0],H=+g[1],U=+g[2],l=+f[0],c=+f[1],Z=+f[2],C=Math.sqrt(l*l+c*c+Z*Z);if(0===C)throw new Error("Can't raycast along a zero vector");return function(y,g,f,p,S,k,i,H,U,l){for(var c=0,Z=Math.floor,C=0|Z(g),q=0|Z(f),W=0|Z(p),j=S>0?1:-1,P=k>0?1:-1,B=i>0?1:-1,R=Math.abs(1/S),G=Math.abs(1/k),z=Math.abs(1/i),T=R<1/0?R*(j>0?C+1-g:g-C):1/0,Q=G<1/0?G*(P>0?q+1-f:f-q):1/0,m=z<1/0?z*(B>0?W+1-p:p-W):1/0,a=-1;c<=H;){var w=y(C,q,W);if(w)return U&&(U[0]=g+c*S,U[1]=f+c*k,U[2]=p+c*i),l&&(l[0]=l[1]=l[2]=0,0===a&&(l[0]=-j),1===a&&(l[1]=-P),2===a&&(l[2]=-B)),w;T<Q?T<m?(C+=j,c=T,T+=R,a=0):(W+=B,c=m,m+=z,a=2):Q<m?(q+=P,c=Q,Q+=G,a=1):(W+=B,c=m,m+=z,a=2)}return U&&(U[0]=g+c*S,U[1]=f+c*k,U[2]=p+c*i),l&&(l[0]=l[1]=l[2]=0),0}(y,i,H,U,l/=C,c/=C,Z/=C,p="undefined"===typeof p?64:+p,S,k)}},12822:(y,g,f)=>{"use strict";f.d(g,{c:()=>k});var p=f(12452);function S(){this.zj=!1,this.stopPropagation=!1,this.Aj=!1,this.disabled=!1}class k{constructor(y,g){this.version="0.7.0";var f=Object.assign({},new S,g||{});this.element=y||document,this.zj=!!f.zj,this.stopPropagation=!!f.stopPropagation,this.Aj=!!f.Aj,this.disabled=!!f.disabled,this.filterEvents=(y,g)=>!0,this.down=new p.EventEmitter,this.up=new p.EventEmitter,this.state={},this.Eg={dx:0,dy:0,sk:0,Cg:0,tk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?H(this):document.addEventListener("DOMContentLoaded",(y=>{H(this)}),{once:!0})}bind(y){for(var g=arguments.length,f=new Array(g>1?g-1:0),p=1;p<g;p++)f[p-1]=arguments[p];f.forEach((g=>{var f=this._keyBindmap[g]||[];f.includes(y)||(f.push(y),this._keyBindmap[g]=f)})),this.state[y]=!!this.state[y],this.pressCount[y]=this.pressCount[y]||0,this.releaseCount[y]=this.releaseCount[y]||0}unbind(y){for(var g in this._keyBindmap){var f=this._keyBindmap[g],p=f.indexOf(y);p>-1&&f.splice(p,1)}}getBindings(){var y={};for(var g in this._keyBindmap){this._keyBindmap[g].forEach((f=>{y[f]=y[f]||[],y[f].push(g)}))}return y}Td(){i(this.Eg),i(this.pressCount),i(this.releaseCount)}}function i(y){for(var g in y)y[g]=0}function H(y){window.addEventListener("keydown",W.bind(null,y,!0),!1),window.addEventListener("keyup",W.bind(null,y,!1),!1);var g={passive:!0};y.element.addEventListener("touchstart",Z.bind(void 0,y),{passive:!1}),y.element.addEventListener("touchend",q.bind(void 0,y),g),y.element.addEventListener("mousedown",j.bind(null,y,!0),g),window.document.addEventListener("mouseup",j.bind(null,y,!1),g),y.element.addEventListener("touchmove",P.bind(null,y),g),y.element.addEventListener("mousemove",P.bind(null,y),g),window.PointerEvent,y.element.addEventListener("wheel",B.bind(null,y),g),y.element.addEventListener("contextmenu",R.bind(null,y),!1),window.addEventListener("blur",G.bind(null,y),!1)}var U=0,l=0,c=null;function Z(y,g){g.preventDefault(),C(g)}function C(y){let g=!1;for(let f=0;f<y.touches.length;++f)if(y.touches[f].identifier===c){g=!0;break}if(!g){const g=y.changedTouches[0];U=g.clientX,l=g.clientY,c=g.identifier}}function q(y,g){for(var f=g.changedTouches,p=0;p<f.length;++p)f[p].identifier===c&&(c=null)}function W(y,g,f){z(f.code,g,y,f)}function j(y,g,f){if("pointerId"in f)if(g){if(null!==y._touches.currID)return;y._touches.currID=f.pointerId}else{if(y._touches.currID!==f.pointerId)return;y._touches.currID=null}return z("Mouse"+("button"in f?f.button+1:1),g,y,f),!1}function P(y,g){var f=g.movementX||g.mozMovementX||0,p=g.movementY||g.mozMovementY||0;if(g.touches&&0===(f|p)){var S=function(y){C(y);for(let g=0;g<y.changedTouches.length;++g)if(y.changedTouches[g].identifier==c){const f=y.changedTouches[g],p=[f.clientX-U,f.clientY-l];return U=f.clientX,l=f.clientY,p}return console.error(`Did not find touch id ${c}`),[0,0]}(g);f=S[0],p=S[1]}y.Eg.dx+=f,y.Eg.dy+=p}function B(y,g){var f=1;switch(g.deltaMode){case 0:f=1;break;case 1:f=12;break;case 2:f=y.element.clientHeight||window.innerHeight}y.Eg.sk+=(g.deltaX||0)*f,y.Eg.Cg+=(g.deltaY||0)*f,y.Eg.tk+=(g.deltaZ||0)*f}function R(y,g){if(!y.Aj)return g.preventDefault(),!1}function G(y){for(var g in y._keyStates)y._keyStates[g]&&(/^Mouse\d/.test(g)||z(g,!1,y,{code:g,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function z(y,g,f,p){var S=f._keyBindmap[y];S&&(T(f._keyStates[y],g)&&(f._keyStates[y]=g,S.forEach((y=>{(!f.filterEvents||f.filterEvents(p,y))&&function(y,g,f,p){var S=g?f.pressCount:f.releaseCount;S[y]=(S[y]||0)+1;var k=f._bindPressCount[y]||0;(k+=g?1:-1)<0&&(k=0);f._bindPressCount[y]=k;var i=f.state[y];if(T(i,k)){f.state[y]=k>0;var H=g?f.down:f.up;f.disabled||H.emit(y,p)}}(y,g,f,p)}))),"button"in p||(f.zj&&!p.defaultPrevented&&p.preventDefault(),f.stopPropagation&&p.stopPropagation()))}function T(y,g){return y?!g:g}},12045:y=>{y.exports=function(y,g,f){return y[0]=g[0]+f[0],y[1]=g[1]+f[1],y[2]=g[2]+f[2],y}},12002:(y,g,f)=>{y.exports=function(y,g){var f=p(y[0],y[1],y[2]),i=p(g[0],g[1],g[2]);S(f,f),S(i,i);var H=k(f,i);return H>1?0:Math.acos(H)};var p=f(12010),S=f(12016),k=f(12018)},12090:y=>{y.exports=function(y,g){return y[0]=Math.ceil(g[0]),y[1]=Math.ceil(g[1]),y[2]=Math.ceil(g[2]),y}},12e3:y=>{y.exports=function(y){var g=new Float32Array(3);return g[0]=y[0],g[1]=y[1],g[2]=y[2],g}},12023:y=>{y.exports=function(y,g){return y[0]=g[0],y[1]=g[1],y[2]=g[2],y}},11995:y=>{y.exports=function(){var y=new Float32Array(3);return y[0]=0,y[1]=0,y[2]=0,y}},12155:y=>{y.exports=function(y,g,f){var p=g[0],S=g[1],k=g[2],i=f[0],H=f[1],U=f[2];return y[0]=S*U-k*H,y[1]=k*i-p*U,y[2]=p*H-S*i,y}},12116:(y,g,f)=>{y.exports=f(12112)},12112:y=>{y.exports=function(y,g){var f=g[0]-y[0],p=g[1]-y[1],S=g[2]-y[2];return Math.sqrt(f*f+p*p+S*S)}},12072:(y,g,f)=>{y.exports=f(12067)},12067:y=>{y.exports=function(y,g,f){return y[0]=g[0]/f[0],y[1]=g[1]/f[1],y[2]=g[2]/f[2],y}},12018:y=>{y.exports=function(y,g){return y[0]*g[0]+y[1]*g[1]+y[2]*g[2]}},11986:y=>{y.exports=1e-6},12034:(y,g,f)=>{y.exports=function(y,g){var f=y[0],S=y[1],k=y[2],i=g[0],H=g[1],U=g[2];return Math.abs(f-i)<=p*Math.max(1,Math.abs(f),Math.abs(i))&&Math.abs(S-H)<=p*Math.max(1,Math.abs(S),Math.abs(H))&&Math.abs(k-U)<=p*Math.max(1,Math.abs(k),Math.abs(U))};var p=f(11986)},12042:y=>{y.exports=function(y,g){return y[0]===g[0]&&y[1]===g[1]&&y[2]===g[2]}},12088:y=>{y.exports=function(y,g){return y[0]=Math.floor(g[0]),y[1]=Math.floor(g[1]),y[2]=Math.floor(g[2]),y}},12206:(y,g,f)=>{y.exports=function(y,g,f,S,k,i){var H,U;g||(g=3);f||(f=0);U=S?Math.min(S*g+f,y.length):y.length;for(H=f;H<U;H+=g)p[0]=y[H],p[1]=y[H+1],p[2]=y[H+2],k(p,p,i),y[H]=p[0],y[H+1]=p[1],y[H+2]=p[2];return y};var p=f(11995)()},12010:y=>{y.exports=function(y,g,f){var p=new Float32Array(3);return p[0]=y,p[1]=g,p[2]=f,p}},11978:(y,g,f)=>{y.exports={EPSILON:f(11986),create:f(11995),clone:f(12e3),angle:f(12002),Gd:f(12010),i:f(12023),set:f(12030),equals:f(12034),exactEquals:f(12042),add:f(12045),ed:f(12047),sub:f(12051),multiply:f(12057),mul:f(12065),divide:f(12067),div:f(12072),min:f(12075),max:f(12081),floor:f(12088),ceil:f(12090),round:f(12093),scale:f(12096),Hd:f(12105),distance:f(12112),dist:f(12116),squaredDistance:f(12120),sqrDist:f(12128),length:f(12131),len:f(12134),squaredLength:f(12142),Jd:f(12145),negate:f(12151),inverse:f(12153),normalize:f(12016),dot:f(12018),cross:f(12155),Ad:f(12158),random:f(12165),transformMat4:f(12174),transformMat3:f(12182),transformQuat:f(12188),Kd:f(12190),Ld:f(12198),Od:f(12204),forEach:f(12206)}},12153:y=>{y.exports=function(y,g){return y[0]=1/g[0],y[1]=1/g[1],y[2]=1/g[2],y}},12134:(y,g,f)=>{y.exports=f(12131)},12131:y=>{y.exports=function(y){var g=y[0],f=y[1],p=y[2];return Math.sqrt(g*g+f*f+p*p)}},12158:y=>{y.exports=function(y,g,f,p){var S=g[0],k=g[1],i=g[2];return y[0]=S+p*(f[0]-S),y[1]=k+p*(f[1]-k),y[2]=i+p*(f[2]-i),y}},12081:y=>{y.exports=function(y,g,f){return y[0]=Math.max(g[0],f[0]),y[1]=Math.max(g[1],f[1]),y[2]=Math.max(g[2],f[2]),y}},12075:y=>{y.exports=function(y,g,f){return y[0]=Math.min(g[0],f[0]),y[1]=Math.min(g[1],f[1]),y[2]=Math.min(g[2],f[2]),y}},12065:(y,g,f)=>{y.exports=f(12057)},12057:y=>{y.exports=function(y,g,f){return y[0]=g[0]*f[0],y[1]=g[1]*f[1],y[2]=g[2]*f[2],y}},12151:y=>{y.exports=function(y,g){return y[0]=-g[0],y[1]=-g[1],y[2]=-g[2],y}},12016:y=>{y.exports=function(y,g){var f=g[0],p=g[1],S=g[2],k=f*f+p*p+S*S;k>0&&(k=1/Math.sqrt(k),y[0]=g[0]*k,y[1]=g[1]*k,y[2]=g[2]*k);return y}},12165:y=>{y.exports=function(y,g){g=g||1;var f=2*Math.random()*Math.PI,p=2*Math.random()-1,S=Math.sqrt(1-p*p)*g;return y[0]=Math.cos(f)*S,y[1]=Math.sin(f)*S,y[2]=p*g,y}},12190:y=>{y.exports=function(y,g,f,p){var S=f[1],k=f[2],i=g[1]-S,H=g[2]-k,U=Math.sin(p),l=Math.cos(p);return y[0]=g[0],y[1]=S+i*l-H*U,y[2]=k+i*U+H*l,y}},12198:y=>{y.exports=function(y,g,f,p){var S=f[0],k=f[2],i=g[0]-S,H=g[2]-k,U=Math.sin(p),l=Math.cos(p);return y[0]=S+H*U+i*l,y[1]=g[1],y[2]=k+H*l-i*U,y}},12204:y=>{y.exports=function(y,g,f,p){var S=f[0],k=f[1],i=g[0]-S,H=g[1]-k,U=Math.sin(p),l=Math.cos(p);return y[0]=S+i*l-H*U,y[1]=k+i*U+H*l,y[2]=g[2],y}},12093:y=>{y.exports=function(y,g){return y[0]=Math.round(g[0]),y[1]=Math.round(g[1]),y[2]=Math.round(g[2]),y}},12096:y=>{y.exports=function(y,g,f){return y[0]=g[0]*f,y[1]=g[1]*f,y[2]=g[2]*f,y}},12105:y=>{y.exports=function(y,g,f,p){return y[0]=g[0]+f[0]*p,y[1]=g[1]+f[1]*p,y[2]=g[2]+f[2]*p,y}},12030:y=>{y.exports=function(y,g,f,p){return y[0]=g,y[1]=f,y[2]=p,y}},12128:(y,g,f)=>{y.exports=f(12120)},12145:(y,g,f)=>{y.exports=f(12142)},12120:y=>{y.exports=function(y,g){var f=g[0]-y[0],p=g[1]-y[1],S=g[2]-y[2];return f*f+p*p+S*S}},12142:y=>{y.exports=function(y){var g=y[0],f=y[1],p=y[2];return g*g+f*f+p*p}},12051:(y,g,f)=>{y.exports=f(12047)},12047:y=>{y.exports=function(y,g,f){return y[0]=g[0]-f[0],y[1]=g[1]-f[1],y[2]=g[2]-f[2],y}},12182:y=>{y.exports=function(y,g,f){var p=g[0],S=g[1],k=g[2];return y[0]=p*f[0]+S*f[3]+k*f[6],y[1]=p*f[1]+S*f[4]+k*f[7],y[2]=p*f[2]+S*f[5]+k*f[8],y}},12174:y=>{y.exports=function(y,g,f){var p=g[0],S=g[1],k=g[2],i=f[3]*p+f[7]*S+f[11]*k+f[15];return i=i||1,y[0]=(f[0]*p+f[4]*S+f[8]*k+f[12])/i,y[1]=(f[1]*p+f[5]*S+f[9]*k+f[13])/i,y[2]=(f[2]*p+f[6]*S+f[10]*k+f[14])/i,y}},12188:y=>{y.exports=function(y,g,f){var p=g[0],S=g[1],k=g[2],i=f[0],H=f[1],U=f[2],l=f[3],c=l*p+H*k-U*S,Z=l*S+U*p-i*k,C=l*k+i*S-H*p,q=-i*p-H*S-U*k;return y[0]=c*l+q*-i+Z*-U-C*-H,y[1]=Z*l+q*-H+C*-i-c*-U,y[2]=C*l+q*-U+c*-H-Z*-i,y}},12480:y=>{"use strict";y.exports=function(y){for(var g=new Array(y),f=0;f<y;++f)g[f]=f;return g}},12554:y=>{y.exports=function(y){return null!=y&&null!=y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}},12799:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.di=!1,this.ei=!1,this.bi=30,this.ci=0,this.mi=!1,this.fullscreen=!1,this.gi=function(y){},this.hi=function(){},this.ki=function(){},this.cb=function(){},this.ii=function(y){},this.onFullscreenChanged=function(y){},l((()=>{!function(y,g){y._nowObject=performance||Date,y._lastTick=0,y._renderAccum=0,y._rt=0,y._frameCB=H.bind(null,y),requestAnimationFrame(y._frameCB),g>0&&(y._intervalCB=i.bind(null,y),y._interval=setInterval(y._intervalCB,Math.max(g,1e3/y.bi/2)))}(this,g),function(y,g){if(!g)return;var f=!1,p=!1;document.addEventListener("pointerlockchange",(p=>{f=document.pointerLockElement===g,y.ii(f)})),document.addEventListener("fullscreenchange",(f=>{p=document.fullscreenElement===g,y.onFullscreenChanged(p)})),Object.defineProperty(y,"mi",{get:()=>f,set:y=>{y&&!f?U(g):f&&!y&&function(y){y.exitPointerLock&&y.exitPointerLock()}(document)}}),Object.defineProperty(y,"fullscreen",{get:()=>p,set:y=>{y&&!p?g.requestFullscreen():p&&!y&&document.exitFullscreen()}}),g.addEventListener("click",(S=>{y.di&&!f&&U(g),y.ei&&!p&&g.requestFullscreen()}));var S=()=>y.cb();if(window.ResizeObserver){new ResizeObserver(S).observe(g)}else window.addEventListener("resize",S)}(this,y),this.ki()}))}}var S=3,k=20;function i(y){for(var g=1e3/y.bi,f=y._nowObject.now()+k,p=0;y._nowObject.now()>=y._lastTick+g&&y._nowObject.now()<f&&++p<=S;)y.gi(g),y._lastTick+=g;var i=5*(g+5),H=y._nowObject.now();if(H-y._lastTick>i)for(;H>=y._lastTick+g;)y._lastTick+=g}function H(y){requestAnimationFrame(y._frameCB),i(y);var g=y._nowObject.now(),f=g-y._rt;if(y._rt=g,y.ci>0){y._renderAccum+=f;var p=1e3/y.ci;if(y._renderAccum<p)return;y._renderAccum=Math.min(y._renderAccum-p,p)}var S=1e3/y.bi,k=(g-y._lastTick)/S;y.hi(f,k,S)}function U(y){y.requestPointerLock&&y.requestPointerLock()}var l=y=>{if("loading"===document.readyState){var g=()=>{document.removeEventListener("readystatechange",g),y()};document.addEventListener("readystatechange",g)}else setTimeout(y,1)}},12472:(y,g,f)=>{var p=f(12480),S=f(12484),k="undefined"!==typeof Float64Array;function i(y,g){return y[0]-g[0]}function H(){var y,g=this.stride,f=new Array(g.length);for(y=0;y<f.length;++y)f[y]=[Math.abs(g[y]),y];f.sort(i);var p=new Array(f.length);for(y=0;y<p.length;++y)p[y]=f[y][1];return p}function U(y,g){var f=["View",g,"d",y].join("");g<0&&(f="View_Nil"+y);var S="generic"===y;if(-1===g){var k="function "+f+"(a){this.data=a;};var proto="+f+".prototype;proto.dtype='"+y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+f+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+f+"(a){return new "+f+"(a);}";return new Function(k)()}if(0===g){k="function "+f+"(a,d) {this.data = a;this.offset = d};var proto="+f+".prototype;proto.dtype='"+y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+f+"_copy() {return new "+f+"(this.data,this.offset)};proto.pick=function "+f+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+f+"_get(){return "+(S?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+f+"_set(v){return "+(S?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+f+"(a,b,c,d){return new "+f+"(a,d)}";return new Function("TrivialArray",k)(l[y][0])}k=["'use strict'"];var i=p(g),U=i.map((function(y){return"i"+y})),c="this.offset+"+i.map((function(y){return"this.stride["+y+"]*i"+y})).join("+"),Z=i.map((function(y){return"b"+y})).join(","),C=i.map((function(y){return"c"+y})).join(",");k.push("function "+f+"(a,"+Z+","+C+",d){this.data=a","this.shape=["+Z+"]","this.stride=["+C+"]","this.offset=d|0}","var proto="+f+".prototype","proto.dtype='"+y+"'","proto.dimension="+g),k.push("Object.defineProperty(proto,'size',{get:function "+f+"_size(){return "+i.map((function(y){return"this.shape["+y+"]"})).join("*"),"}})"),1===g?k.push("proto.order=[0]"):(k.push("Object.defineProperty(proto,'order',{get:"),g<4?(k.push("function "+f+"_order(){"),2===g?k.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===g&&k.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):k.push("ORDER})")),k.push("proto.set=function "+f+"_set("+U.join(",")+",v){"),S?k.push("return this.data.set("+c+",v)}"):k.push("return this.data["+c+"]=v}"),k.push("proto.get=function "+f+"_get("+U.join(",")+"){"),S?k.push("return this.data.get("+c+")}"):k.push("return this.data["+c+"]}"),k.push("proto.index=function "+f+"_index(",U.join(),"){return "+c+"}"),k.push("proto.hi=function "+f+"_hi("+U.join(",")+"){return new "+f+"(this.data,"+i.map((function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")})).join(",")+","+i.map((function(y){return"this.stride["+y+"]"})).join(",")+",this.offset)}");var q=i.map((function(y){return"a"+y+"=this.shape["+y+"]"})),W=i.map((function(y){return"c"+y+"=this.stride["+y+"]"}));k.push("proto.lo=function "+f+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+q.join(",")+","+W.join(","));for(var j=0;j<g;++j)k.push("if(typeof i"+j+"==='number'&&i"+j+">=0){d=i"+j+"|0;b+=c"+j+"*d;a"+j+"-=d}");k.push("return new "+f+"(this.data,"+i.map((function(y){return"a"+y})).join(",")+","+i.map((function(y){return"c"+y})).join(",")+",b)}"),k.push("proto.step=function "+f+"_step("+U.join(",")+"){var "+i.map((function(y){return"a"+y+"=this.shape["+y+"]"})).join(",")+","+i.map((function(y){return"b"+y+"=this.stride["+y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(j=0;j<g;++j)k.push("if(typeof i"+j+"==='number'){d=i"+j+"|0;if(d<0){c+=b"+j+"*(a"+j+"-1);a"+j+"=ceil(-a"+j+"/d)}else{a"+j+"=ceil(a"+j+"/d)}b"+j+"*=d}");k.push("return new "+f+"(this.data,"+i.map((function(y){return"a"+y})).join(",")+","+i.map((function(y){return"b"+y})).join(",")+",c)}");var P=new Array(g),B=new Array(g);for(j=0;j<g;++j)P[j]="a[i"+j+"]",B[j]="b[i"+j+"]";k.push("proto.transpose=function "+f+"_transpose("+U+"){"+U.map((function(y,g){return y+"=("+y+"===undefined?"+g+":"+y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+f+"(this.data,"+P.join(",")+","+B.join(",")+",this.offset)}"),k.push("proto.pick=function "+f+"_pick("+U+"){var a=[],b=[],c=this.offset");for(j=0;j<g;++j)k.push("if(typeof i"+j+"==='number'&&i"+j+">=0){c=(c+this.stride["+j+"]*i"+j+")|0}else{a.push(this.shape["+j+"]);b.push(this.stride["+j+"])}");return k.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),k.push("return function construct_"+f+"(data,shape,stride,offset){return new "+f+"(data,"+i.map((function(y){return"shape["+y+"]"})).join(",")+","+i.map((function(y){return"stride["+y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",k.join("\n"))(l[y],H)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};y.exports=function(y,g,f,p){if(void 0===y)return(0,l.array[0])([]);"number"===typeof y&&(y=[y]),void 0===g&&(g=[y.length]);var i=g.length;if(void 0===f){f=new Array(i);for(var H=i-1,c=1;H>=0;--H)f[H]=c,c*=g[H]}if(void 0===p){p=0;for(H=0;H<i;++H)f[H]<0&&(p-=(g[H]-1)*f[H])}for(var Z=function(y){if(S(y))return"buffer";if(k)switch(Object.prototype.toString.call(y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(y)?"array":"generic"}(y),C=l[Z];C.length<=i+1;)C.push(U(Z,C.length-1));return(0,C[i+1])(y,g,f,p)}},12484:y=>{function g(y){return!!y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}y.exports=function(y){return null!=y&&(g(y)||function(y){return"function"===typeof y.readFloatLE&&"function"===typeof y.slice&&g(y.slice(0,0))}(y)||!!y._isBuffer)}},12645:y=>{"use strict";var g=[],f=[],p=[],S=[],k=[],i=[],H=[],U=[],l=[],c=[],Z=[],C=[];y.exports=function(y,q,W,j,P,B){for(var R=H,G=l,z=c,T=C,Q=0;Q<3;Q++)R[Q]=+W[Q],z[Q]=+q.max[Q],G[Q]=+q.base[Q];B||(B=1e-10);var m=function(y,H,l,c,C,q){var W=g,j=f,P=p,B=S,R=k,G=i,z=U,T=Math.floor,Q=0,m=0,a=0,w=0,o=0;if(I(),0===a)return 0;for(w=M();m<=a;){if(Y(w)&&n())return Q;w=M()}for(Q+=a,o=0;o<3;o++)c[o]+=l[o],C[o]+=l[o];return Q;function I(){if(m=0,0!==(a=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])))for(var y=0;y<3;y++){var g=l[y]>=0;B[y]=g?1:-1;var f=g?C[y]:c[y];W[y]=g?c[y]:C[y],j[y]=r(f,B[y]),P[y]=N(W[y],B[y]),z[y]=l[y]/a,R[y]=Math.abs(1/z[y]);var p=g?j[y]+1-f:f-j[y];G[y]=R[y]<1/0?R[y]*p:1/0}}function Y(g){for(var f=B[0],p=0===g?j[0]:P[0],S=j[0]+f,k=B[1],i=1===g?j[1]:P[1],H=j[1]+k,U=B[2],l=2===g?j[2]:P[2],c=j[2]+U,Z=p;Z!=S;Z+=f)for(var C=i;C!=H;C+=k)for(var q=l;q!=c;q+=U)if(y(Z,C,q))return!0;return!1}function n(){Q+=m;var y=B[w],g=m/a,f=Z;for(o=0;o<3;o++){var p=l[o]*g;c[o]+=p,C[o]+=p,f[o]=l[o]-p}if(y>0?C[w]=Math.round(C[w]):c[w]=Math.round(c[w]),H(Q,w,y,f))return!0;for(o=0;o<3;o++)l[o]=f[o];return I(),0===a}function M(){var y=G[0]<G[1]?G[0]<G[2]?0:2:G[1]<G[2]?1:2,g=G[y]-m;for(m=G[y],j[y]+=B[y],G[y]+=R[y],o=0;o<3;o++)W[o]+=g*z[o],P[o]=N(W[o],B[o]);return y}function r(y,g){return T(y-g*q)}function N(y,g){return T(y+g*q)}}(y,j,R,G,z,B);if(!P){for(Q=0;Q<3;Q++)T[Q]=W[Q]>0?z[Q]-q.max[Q]:G[Q]-q.base[Q];q.translate(T)}return m}},12824:(y,g,f)=>{"use strict";f.d(g,{c:()=>Z});var p=f(12641),S=f(11978);class k{constructor(y,g,f,k,i,H,U){this.Kg=new p(y.base,y.hh),this.mass=g,this.friction=f,this.restitution=k,this.ld=i,this.Mk=H,this.md=!!U,this.fh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.yl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.ag=S.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=S.create(),this._impulses=S.create(),this._sleepFrameCount=10}loadFromCopy(y){S.i(this.Kg.base,y.Kg.base),S.i(this.Kg.hh,y.Kg.hh),S.i(this.Kg.max,y.Kg.max),this.Kg.mag=y.Kg.mag,this.mass=y.mass,this.friction=y.friction,this.restitution=y.restitution,this.ld=y.ld,this.Mk=y.Mk,this.md=y.md,this.fh=y.fh,this.fluidDrag=y.fluidDrag,this.yl=y.yl,this.preventFallOffEdge=y.preventFallOffEdge,this.rolledBackLastTick=y.rolledBackLastTick,S.i(this.ag,y.ag),S.i(this.resting,y.resting),this.inFluid=y.inFluid,this._ratioInFluid=y._ratioInFluid,S.i(this._forces,y._forces),S.i(this._impulses,y._impulses),this._sleepFrameCount=y._sleepFrameCount}setPosition(y){i(y),S.ed(y,y,this.Kg.base),this.Kg.translate(y),this.eg()}eb(){return S.clone(this.Kg.base)}applyForce(y){i(y),S.add(this._forces,this._forces,y),this.eg()}applyImpulse(y){i(y),S.add(this._impulses,this._impulses,y),this.eg()}eg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var i=y=>{};var H=f(12641),U=f(11978),l=f(12645);function c(){this.fh=.1,this.fluidDrag=.4,this.yd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Z(y,g,f){y=Object.assign(new c,y),this.gravity=y.gravity||[0,-10,0],this.fh=y.fh||.1,this.yd=y.yd||2,this.fluidDrag=y.fluidDrag||.4,this.minBounceImpulse=y.minBounceImpulse,this.bodies=[],this.hk=y.hk,this.testSolid=g,this.testFluid=f}Z.prototype.Tk=function(y,g,f,p,S,i){y=y||new H([0,0,0],[1,1,1]),"undefined"==typeof g&&(g=1),"undefined"==typeof f&&(f=1),"undefined"==typeof p&&(p=0),"undefined"==typeof S&&(S=1);var U=new k(y,g,f,p,S,i);return this.bodies.push(U),U},Z.prototype.Uk=function(y){var g=this.bodies.indexOf(y);g<0||(this.bodies.splice(g,1),y.Kg=y.Mk=null)};var C=U.create(),q=U.create(),W=U.create(),j=U.create(),P=U.create(),B=U.create(),R=U.create(),G=new H([0,0,0],[1,1,1]),z=new k(G,1,1,0,1,(()=>{}),!1);function T(y,g,f){return g=f,g*=1-(1-y.ratioInFluid)**2}Z.prototype.Td=function(y){y/=1e3;var g=A(0,U.squaredLength(this.gravity));this.bodies.forEach((f=>function(y,g,f,p){U.i(P,g.resting),y.hk&&z.loadFromCopy(g);if(g.mass<=0)return U.set(g.ag,0,0,0),U.set(g._forces,0,0,0),void U.set(g._impulses,0,0,0);var S=p||0===g.ld;if(function(y,g,f,p){if(g._sleepFrameCount>0)return!1;if(p)return!0;var S=!1,k=.5*f*f*g.ld;return U.scale(F,y.gravity,k),l(y.testSolid,g.Kg,F,(function(){return S=!0,!0}),!0),S}(y,g,f,S))return;g._sleepFrameCount--,function(y,g){var f=g.Kg,p=Math.floor(f.base[0]),S=Math.floor(f.base[2]),k=Math.floor(f.base[1]),i=Math.floor(f.max[1]);if(!y.testFluid(p,k,S))return g.inFluid=!1,void(g.ratioInFluid=0);var H=1,l=k+1;for(;l<=i&&y.testFluid(p,l,S);)H++,l++;var c=(k+H-f.base[1])/f.hh[1];c>1&&(c=1);var Z=f.hh[0]*f.hh[1]*f.hh[2]*c,C=m;U.scale(C,y.gravity,-y.yd*Z*g.ld),g.applyForce(C),g.inFluid=!0,g.ratioInFluid=c}(y,g),V(g._forces),V(g._impulses),V(g.ag),V(g.resting),U.scale(C,g._forces,1/g.mass),U.Hd(C,C,y.gravity,g.ld),U.scale(q,g._impulses,1/g.mass),U.Hd(q,q,C,f),U.add(g.ag,g.ag,q),g.friction&&(a(y,0,g,q,f),a(y,1,g,q,f),a(y,2,g,q,f));var k=g.fluidDrag>=0?g.fluidDrag:y.fluidDrag,i=g.fh>=0?g.fh:y.fh,H=i,c=i;g.inFluid&&(H=T(g,H,g.fluidDragHoriz>=0?g.fluidDragHoriz:k),c=T(g,c,g.fluidDragVert>=0?g.fluidDragVert:k));H=Math.max(1-H*f/g.mass,0),c=Math.max(1-c*f/g.mass,0),U.set(Q,H,c,H),U.multiply(g.ag,g.ag,Q),U.scale(W,g.ag,f),U.set(g._forces,0,0,0),U.set(g._impulses,0,0,0),g.md&&J(I,g.Kg);U.i(B,W),U.set(R,0,0,0),g.preventFallOffEdge&&function(y,g,f,p){if(!g.resting[1]||f[1]>0)return;var S=b;J(S,g.Kg);for(var k=0;k<3;k+=2){U.set(N,0,0,0),N[k]=f[k];var i=!0;(i=(i=(i=(i=i&&!u(y,S.base[0]+N[0]+1e-5,S.base[1],S.base[2]+N[2]+1e-5))&&!u(y,S.max[0]+N[0]-1e-5,S.base[1],S.base[2]+N[2]+1e-5))&&!u(y,S.base[0]+N[0]+1e-5,S.base[1],S.max[2]+N[2]-1e-5))&&!u(y,S.max[0]+N[0]-1e-5,S.base[1],S.max[2]+N[2]-1e-5))?(p[k]=f[k]>0?1:-1,f[k]=0):0===k&&(U.set(s,f[0],0,0),o(y,S,s,p,g.slideOnCollision))}}(y,g,W,R);o(y,g.Kg,W,g.resting,g.slideOnCollision),g.md&&function(y,g,f,p){if(g.resting[1]>=0&&!g.inFluid)return;var S=0!==g.resting[0],k=0!==g.resting[2];if(!S&&!k)return;var i=Math.abs(p[0]/p[2]),H=4;if(!S&&i>H)return;if(!k&&i<1/H)return;U.add(n,f.base,p);var c=y.testSolid;l(c,f,p,(function(y,g,f,p){if(1!==g)return!0;p[g]=0}));var Z=f.base[1],C=g.inFluid?1.951:1.001,q=Math.floor(Z+C)-Z;U.set(M,0,q,0);var W=!1;if(l(c,f,M,(function(y,g,f,p){return W=!0,!0})),W)return;U.ed(r,n,f.base),r[1]=0,o(y,f,r,Y,!0);var j=A(f.base[0],n[0]),P=A(f.base[2],n[2]);if(S&&!j&&(!P||!k))return;if(k&&(!j||!S)&&!P)return;var B=!0;if(B=B&&!u(y,f.base[0]+1e-5,f.base[1],f.base[2]+1e-5),B=B&&!u(y,f.max[0]-1e-5,f.base[1],f.base[2]+1e-5),B=B&&!u(y,f.base[0]+1e-5,f.base[1],f.max[2]-1e-5),B=B&&!u(y,f.max[0]-1e-5,f.base[1],f.max[2]-1e-5),B)return;J(g.Kg,f),g.resting[0]=Y[0],g.resting[2]=Y[2],g.yl&&g.yl()}(y,g,I,B);for(var Z=0;Z<3;++Z)g.resting[Z]=g.resting[Z]||R[Z],j[Z]=0,g.resting[Z]&&(P[Z]||(j[Z]=-g.ag[Z]),g.ag[Z]=0);var G=U.length(j);G>.001&&(U.scale(j,j,g.mass),g.Mk&&g.Mk(j),g.restitution>0&&G>y.minBounceImpulse&&(U.scale(j,j,g.restitution),g.applyImpulse(j)));var w=U.squaredLength(g.ag);w>1e-5&&g.eg();y.hk&&y.hk(g)?(g.loadFromCopy(z),g.rolledBackLastTick=!0):g.rolledBackLastTick=!1}(this,f,y,g)))};var Q=U.create([0,0,0]);var m=U.create();function a(y,g,f,p,S){var k=f.resting[g],i=p[g];if(!f.alwaysApplyHorizFriction||1!==g){if(0===k)return;if(k*i<=0)return}U.i(w,f.ag),w[g]=0;var H=U.length(w);if(!A(H,0)){var l=Math.abs(f.friction*y.gravity[g]*S),c=H>l?(H-l)/H:0;f.ag[(g+1)%3]*=c,f.ag[(g+2)%3]*=c}}var w=U.create();function o(y,g,f,p,S){return U.set(p,0,0,0),l(y.testSolid,g,f,(function(y,g,f,k){p[g]=f,k[g]=0,S||(k[0]=0,k[1]=0,k[2]=0)}))}var I=new H([],[]),Y=U.create(),n=U.create(),M=U.create(),r=U.create();var N=U.create(),b=new H([],[]),s=U.create();function u(y,g,f,p){return y.testSolid(Math.floor(g),Math.floor(f-1),Math.floor(p))}var F=U.create();function A(y,g){return Math.abs(y-g)<1e-5}function J(y,g){for(var f=0;f<3;f++)y.base[f]=g.base[f],y.max[f]=g.max[f],y.hh[f]=g.hh[f]}var V=function(y){}},10639:function(y,g){!function(y){"use strict";var g=function(y,f){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,g){y.__proto__=g}||function(y,g){for(var f in g)Object.prototype.hasOwnProperty.call(g,f)&&(y[f]=g[f])},g(y,f)};function f(y,f){if("function"!==typeof f&&null!==f)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function p(){this.constructor=y}g(y,f),y.prototype=null===f?Object.create(f):(p.prototype=f.prototype,new p)}function p(y,g,f,p){var S,k=arguments.length,i=k<3?g:null===p?p=Object.getOwnPropertyDescriptor(g,f):p;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(y,g,f,p);else for(var H=y.length-1;H>=0;H--)(S=y[H])&&(i=(k<3?S(i):k>3?S(g,f,i):S(g,f))||i);return k>3&&i&&Object.defineProperty(g,f,i),i}function S(y,g,f){if(f||2===arguments.length)for(var p,S=0,k=g.length;S<k;S++)!p&&S in g||(p||(p=Array.prototype.slice.call(g,0,S)),p[S]=g[S]);return y.concat(p||Array.prototype.slice.call(g))}var k,i=255,H=213;y.OPERATION=void 0,(k=y.OPERATION||(y.OPERATION={}))[k.ADD=128]="ADD",k[k.REPLACE=0]="REPLACE",k[k.DELETE=64]="DELETE",k[k.DELETE_AND_ADD=192]="DELETE_AND_ADD",k[k.TOUCH=1]="TOUCH",k[k.CLEAR=10]="CLEAR";var U=function(){function g(y,g,f){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=y,this.setParent(g,f)}return g.prototype.setParent=function(y,g,f){var p=this;if(this.indexes||(this.indexes=this.ref instanceof ry?this.ref._definition.indexes:{}),this.parent=y,this.parentIndex=f,g)if(this.root=g,this.ref instanceof ry){var S=this.ref._definition;for(var k in S.schema){var i=this.ref[k];if(i&&i.$changes){var H=S.indexes[k];i.$changes.setParent(this.ref,g,H)}}}else"object"===typeof this.ref&&this.ref.forEach((function(y,g){if(y instanceof ry){var f=y.$changes,S=p.ref.$changes.indexes[g];f.setParent(p.ref,p.root,S)}}))},g.prototype.operation=function(y){this.changes.set(--this.currentCustomOperation,y)},g.prototype.change=function(g,f){void 0===f&&(f=y.OPERATION.ADD);var p="number"===typeof g?g:this.indexes[g];this.assertValidIndex(p,g);var S=this.changes.get(p);S&&S.op!==y.OPERATION.DELETE&&S.op!==y.OPERATION.TOUCH||this.changes.set(p,{op:S&&S.op===y.OPERATION.DELETE?y.OPERATION.DELETE_AND_ADD:f,index:p}),this.allChanges.add(p),this.changed=!0,this.touchParents()},g.prototype.touch=function(g){var f="number"===typeof g?g:this.indexes[g];this.assertValidIndex(f,g),this.changes.has(f)||this.changes.set(f,{op:y.OPERATION.TOUCH,index:f}),this.allChanges.add(f),this.touchParents()},g.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},g.prototype.getType=function(y){if(this.ref._definition)return(g=this.ref._definition).schema[g.fieldsByIndex[y]];var g,f=(g=this.parent._definition).schema[g.fieldsByIndex[this.parentIndex]];return Object.values(f)[0]},g.prototype.getChildrenFilter=function(){var y=this.parent._definition.childFilters;return y&&y[this.parentIndex]},g.prototype.getValue=function(y){return this.ref.getByIndex(y)},g.prototype.delete=function(g){var f="number"===typeof g?g:this.indexes[g];if(void 0!==f){var p=this.getValue(f);this.changes.set(f,{op:y.OPERATION.DELETE,index:f}),this.allChanges.delete(f),delete this.caches[f],p&&p.$changes&&(p.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(g," (").concat(f,")"))},g.prototype.discard=function(g,f){var p=this;void 0===g&&(g=!1),void 0===f&&(f=!1),this.ref instanceof ry||this.changes.forEach((function(g){if(g.op===y.OPERATION.DELETE){var f=p.ref.getIndex(g.index);delete p.indexes[f]}})),this.changes.clear(),this.changed=g,f&&this.allChanges.clear(),this.currentCustomOperation=0},g.prototype.discardAll=function(){var y=this;this.changes.forEach((function(g){var f=y.getValue(g.index);f&&f.$changes&&f.$changes.discardAll()})),this.discard()},g.prototype.cache=function(y,g){this.caches[y]=g},g.prototype.clone=function(){return new g(this.ref,this.parent,this.root)},g.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},g.prototype.assertValidIndex=function(y,g){if(void 0===y)throw new Error('ChangeTree: missing index for field "'.concat(g,'"'))},g}();function l(y,g,f,p){return y[g]||(y[g]=[]),y[g].push(f),null===p||void 0===p||p.forEach((function(y,g){return f(y,g)})),function(){return Z(y[g],y[g].indexOf(f))}}function c(g){var f=this,p="string"!==typeof this.$changes.getType();this.$items.forEach((function(S,k){g.push({refId:f.$changes.refId,op:y.OPERATION.DELETE,field:k,value:void 0,previousValue:S}),p&&f.$changes.root.removeRef(S.$changes.refId)}))}function Z(y,g){if(-1===g||g>=y.length)return!1;for(var f=y.length-1,p=g;p<f;p++)y[p]=y[p+1];return y.length=f,!0}var C=function(y,g){var f=y.toString(),p=g.toString();return f<p?-1:f>p?1:0};function q(y){return y.$proxy=!0,y=new Proxy(y,{get:function(y,g){return"symbol"===typeof g||isNaN(g)?y[g]:y.at(g)},set:function(y,g,f){if("symbol"===typeof g||isNaN(g))y[g]=f;else{var p=Array.from(y.$items.keys()),S=parseInt(p[g]||g);void 0===f||null===f?y.deleteAt(S):y.setAt(S,f)}return!0},deleteProperty:function(y,g){return"number"===typeof g?y.deleteAt(g):delete y[g],!0}})}var W=function(){function g(){for(var y=[],g=0;g<arguments.length;g++)y[g]=arguments[g];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,y)}return g.prototype.sd=function(g,f){return void 0===f&&(f=!0),l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,g,f?this.$items:void 0)},g.prototype.bb=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,g)},g.is=function(y){return Array.isArray(y)||void 0!==y.array},Object.defineProperty(g.prototype,"length",{get:function(){return this.$items.size},set:function(y){0===y?this.clear():this.splice(y,this.length-y)},enumerable:!1,configurable:!0}),g.prototype.push=function(){for(var y,g=this,f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];return f.forEach((function(f){y=g.$refId++,g.setAt(y,f)})),y},g.prototype.pop=function(){var y=Array.from(this.$indexes.values()).pop();if(void 0!==y){this.$changes.delete(y),this.$indexes.delete(y);var g=this.$items.get(y);return this.$items.delete(y),g}},g.prototype.at=function(y){var g=Array.from(this.$items.keys())[y];return this.$items.get(g)},g.prototype.setAt=function(g,f){var p,S;if(void 0!==f&&null!==f){if(this.$items.get(g)!==f){void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,g);var k=null!==(S=null===(p=this.$changes.indexes[g])||void 0===p?void 0:p.op)&&void 0!==S?S:y.OPERATION.ADD;this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,f),this.$changes.change(g,k)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},g.prototype.deleteAt=function(y){var g=Array.from(this.$items.keys())[y];return void 0!==g&&this.$deleteAt(g)},g.prototype.$deleteAt=function(y){return this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y)},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&c.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.concat=function(){for(var y,f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];return new(g.bind.apply(g,S([void 0],(y=Array.from(this.$items.values())).concat.apply(y,f),!1)))},g.prototype.join=function(y){return Array.from(this.$items.values()).join(y)},g.prototype.reverse=function(){var y=this,g=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(f,p){y.setAt(g[p],f)})),this},g.prototype.shift=function(){var y=Array.from(this.$items.keys()).shift();if(void 0!==y){var g=this.$items.get(y);return this.$deleteAt(y),g}},g.prototype.slice=function(y,f){var p=new g;return p.push.apply(p,Array.from(this.$items.values()).slice(y,f)),p},g.prototype.sort=function(y){var g=this;void 0===y&&(y=C);var f=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(y).forEach((function(y,p){g.setAt(f[p],y)})),this},g.prototype.splice=function(y,g){void 0===g&&(g=this.length-y);for(var f=Array.from(this.$items.keys()),p=[],S=y;S<y+g;S++)p.push(this.$items.get(f[S])),this.$deleteAt(f[S]);return p},g.prototype.unshift=function(){for(var y=this,g=[],f=0;f<arguments.length;f++)g[f]=arguments[f];var p=this.length,S=g.length,k=Array.from(this.$items.values());return g.forEach((function(g,f){y.setAt(f,g)})),k.forEach((function(g,f){y.setAt(S+f,g)})),p+S},g.prototype.indexOf=function(y,g){return Array.from(this.$items.values()).indexOf(y,g)},g.prototype.lastIndexOf=function(y,g){return void 0===g&&(g=this.length-1),Array.from(this.$items.values()).lastIndexOf(y,g)},g.prototype.every=function(y,g){return Array.from(this.$items.values()).every(y,g)},g.prototype.some=function(y,g){return Array.from(this.$items.values()).some(y,g)},g.prototype.forEach=function(y,g){Array.from(this.$items.values()).forEach(y,g)},g.prototype.map=function(y,g){return Array.from(this.$items.values()).map(y,g)},g.prototype.filter=function(y,g){return Array.from(this.$items.values()).filter(y,g)},g.prototype.reduce=function(y,g){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},g.prototype.reduceRight=function(y,g){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},g.prototype.find=function(y,g){return Array.from(this.$items.values()).find(y,g)},g.prototype.findIndex=function(y,g){return Array.from(this.$items.values()).findIndex(y,g)},g.prototype.fill=function(y,g,f){throw new Error("ArraySchema#fill() not implemented")},g.prototype.copyWithin=function(y,g,f){throw new Error("ArraySchema#copyWithin() not implemented")},g.prototype.toString=function(){return this.$items.toString()},g.prototype.toLocaleString=function(){return this.$items.toLocaleString()},g.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(g,Symbol.species,{get:function(){return g},enumerable:!1,configurable:!0}),g.prototype.entries=function(){return this.$items.entries()},g.prototype.keys=function(){return this.$items.keys()},g.prototype.values=function(){return this.$items.values()},g.prototype.includes=function(y,g){return Array.from(this.$items.values()).includes(y,g)},g.prototype.flatMap=function(y,g){throw new Error("ArraySchema#flatMap() is not supported.")},g.prototype.flat=function(y){throw new Error("ArraySchema#flat() is not supported.")},g.prototype.findLast=function(){var y=Array.from(this.$items.values());return y.findLast.apply(y,arguments)},g.prototype.findLastIndex=function(){var y=Array.from(this.$items.values());return y.findLastIndex.apply(y,arguments)},g.prototype.setIndex=function(y,g){this.$indexes.set(y,g)},g.prototype.getIndex=function(y){return this.$indexes.get(y)},g.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},g.prototype.deleteByIndex=function(y){var g=this.$indexes.get(y);this.$items.delete(g),this.$indexes.delete(y)},g.prototype.toArray=function(){return Array.from(this.$items.values())},g.prototype.toJSON=function(){return this.toArray().map((function(y){return"function"===typeof y.toJSON?y.toJSON():y}))},g.prototype.clone=function(y){return y?new(g.bind.apply(g,S([void 0],Array.from(this.$items.values()),!1))):new(g.bind.apply(g,S([void 0],this.map((function(y){return y.$changes?y.clone():y})),!1)))},g}();function j(y){return y.$proxy=!0,y=new Proxy(y,{get:function(y,g){return"symbol"!==typeof g&&"undefined"===typeof y[g]?y.get(g):y[g]},set:function(y,g,f){return"symbol"!==typeof g&&-1===g.indexOf("$")&&"sd"!==g&&"bb"!==g&&"onChange"!==g?y.set(g,f):y[g]=f,!0},deleteProperty:function(y,g){return y.delete(g),!0}})}var P=function(){function g(y){var f=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y)if(y instanceof Map||y instanceof g)y.forEach((function(y,g){return f.set(g,y)}));else for(var p in y)this.set(p,y[p])}return g.prototype.sd=function(g,f){return void 0===f&&(f=!0),l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,g,f?this.$items:void 0)},g.prototype.bb=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,g)},g.is=function(y){return void 0!==y.map},g.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(g.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(g,Symbol.species,{get:function(){return g},enumerable:!1,configurable:!0}),g.prototype.set=function(g,f){if(void 0===f||null===f)throw new Error("MapSchema#set('".concat(g,"', ").concat(f,"): trying to set ").concat(f," value on '").concat(g,"'."));g=g.toString();var p="undefined"!==typeof this.$changes.indexes[g],S=p?this.$changes.indexes[g]:this.$refId++,k=p?y.OPERATION.REPLACE:y.OPERATION.ADD,i=void 0!==f.$changes;if(i&&f.$changes.setParent(this,this.$changes.root,S),p){if(!i&&this.$items.get(g)===f)return;i&&this.$items.get(g)!==f&&(k=y.OPERATION.ADD)}else this.$changes.indexes[g]=S,this.$indexes.set(S,g);return this.$items.set(g,f),this.$changes.change(g,k),this},g.prototype.get=function(y){return this.$items.get(y)},g.prototype.delete=function(y){return this.$changes.delete(y),this.$items.delete(y)},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&c.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.has=function(y){return this.$items.has(y)},g.prototype.forEach=function(y){this.$items.forEach(y)},g.prototype.entries=function(){return this.$items.entries()},g.prototype.keys=function(){return this.$items.keys()},g.prototype.values=function(){return this.$items.values()},Object.defineProperty(g.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),g.prototype.setIndex=function(y,g){this.$indexes.set(y,g)},g.prototype.getIndex=function(y){return this.$indexes.get(y)},g.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},g.prototype.deleteByIndex=function(y){var g=this.$indexes.get(y);this.$items.delete(g),this.$indexes.delete(y)},g.prototype.toJSON=function(){var y={};return this.forEach((function(g,f){y[f]="function"===typeof g.toJSON?g.toJSON():g})),y},g.prototype.clone=function(y){var f;return y?f=Object.assign(new g,this):(f=new g,this.forEach((function(y,g){y.$changes?f.set(g,y.clone()):f.set(g,y)}))),f},g}(),B={};function R(y,g){B[y]=g}function G(y){return B[y]}var z=function(){function y(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return y.create=function(g){var f=new y;return f.schema=Object.assign({},g&&g.schema||{}),f.indexes=Object.assign({},g&&g.indexes||{}),f.fieldsByIndex=Object.assign({},g&&g.fieldsByIndex||{}),f.descriptors=Object.assign({},g&&g.descriptors||{}),f.deprecated=Object.assign({},g&&g.deprecated||{}),f},y.prototype.addField=function(y,g){var f=this.getNextFieldIndex();this.fieldsByIndex[f]=y,this.indexes[y]=f,this.schema[y]=Array.isArray(g)?{array:g[0]}:g},y.prototype.hasField=function(y){return void 0!==this.indexes[y]},y.prototype.addFilter=function(y,g){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[y]]=g,this.indexesWithFilters.push(this.indexes[y]),!0},y.prototype.addChildrenFilter=function(y,g){var f=this.indexes[y],p=this.schema[y];if(G(Object.keys(p)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[f]=g,!0;console.warn("@filterChildren: field '".concat(y,"' can't have children. Ignoring filter."))},y.prototype.getChildrenFilter=function(y){return this.childFilters&&this.childFilters[this.indexes[y]]},y.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},y}();function T(y){return y._context&&y._context.useFilters}var Q=function(){function y(){this.types={},this.schemas=new Map,this.useFilters=!1}return y.prototype.has=function(y){return this.schemas.has(y)},y.prototype.get=function(y){return this.types[y]},y.prototype.add=function(y,g){void 0===g&&(g=this.schemas.size),y._definition=z.create(y._definition),y._typeid=g,this.types[g]=y,this.schemas.set(y,g)},y.create=function(g){return void 0===g&&(g={}),function(f){return g.context||(g.context=new y),a(f,g)}},y}(),m=new Q;function a(y,g){return void 0===g&&(g={}),function(f,p){var k=g.context||m,i=f.constructor;if(i._context=k,!y)throw new Error("".concat(i.name,': @type() reference provided for "').concat(p,"\" is undefined. Make sure you don't have any circular dependencies."));k.has(i)||k.add(i);var H=i._definition;if(H.addField(p,y),H.descriptors[p]){if(H.deprecated[p])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(p,"' definition on '").concat(i.name,"'.\nCheck @type() annotation"))}catch(B){var U=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(U))}}var l=W.is(y),c=!l&&P.is(y);if("string"!==typeof y&&!ry.is(y)){var Z=Object.values(y)[0];"string"===typeof Z||k.has(Z)||k.add(Z)}if(g.manual)H.descriptors[p]={enumerable:!0,configurable:!0,writable:!0};else{var C="_".concat(p);H.descriptors[C]={enumerable:!1,configurable:!1,writable:!0},H.descriptors[p]={get:function(){return this[C]},set:function(y){y!==this[C]&&(void 0!==y&&null!==y?(!l||y instanceof W||(y=new(W.bind.apply(W,S([void 0],y,!1)))),!c||y instanceof P||(y=new P(y)),void 0===y.$proxy&&(c?y=j(y):l&&(y=q(y))),this.$changes.change(p),y.$changes&&y.$changes.setParent(this,this.$changes.root,this._definition.indexes[p])):this[C]&&this.$changes.delete(p),this[C]=y)},enumerable:!0,configurable:!0}}}}function w(y){return function(g,f){var p=g.constructor;p._definition.addFilter(f,y)&&(p._context.useFilters=!0)}}function o(y){return function(g,f){var p=g.constructor;p._definition.addChildrenFilter(f,y)&&(p._context.useFilters=!0)}}function I(y){return void 0===y&&(y=!0),function(g,f){var p=g.constructor._definition;p.deprecated[f]=!0,y&&(p.descriptors[f]={get:function(){throw new Error("".concat(f," is deprecated."))},set:function(y){},enumerable:!1,configurable:!0})}}function Y(y,g,f){for(var p in void 0===f&&(f={}),f.context||(f.context=y._context||f.context||m),g)a(g[p],f)(y.prototype,p);return y}function n(y){for(var g=0,f=0,p=0,S=y.length;p<S;p++)(g=y.charCodeAt(p))<128?f+=1:g<2048?f+=2:g<55296||g>=57344?f+=3:(p++,f+=4);return f}function M(y,g,f){for(var p=0,S=0,k=f.length;S<k;S++)(p=f.charCodeAt(S))<128?y[g++]=p:p<2048?(y[g++]=192|p>>6,y[g++]=128|63&p):p<55296||p>=57344?(y[g++]=224|p>>12,y[g++]=128|p>>6&63,y[g++]=128|63&p):(S++,p=65536+((1023&p)<<10|1023&f.charCodeAt(S)),y[g++]=240|p>>18,y[g++]=128|p>>12&63,y[g++]=128|p>>6&63,y[g++]=128|63&p)}function r(y,g){y.push(255&g)}function N(y,g){y.push(255&g)}function b(y,g){y.push(255&g),y.push(g>>8&255)}function s(y,g){y.push(255&g),y.push(g>>8&255)}function u(y,g){y.push(255&g),y.push(g>>8&255),y.push(g>>16&255),y.push(g>>24&255)}function F(y,g){var f=g>>24,p=g>>16,S=g>>8,k=g;y.push(255&k),y.push(255&S),y.push(255&p),y.push(255&f)}function A(y,g){var f=Math.floor(g/Math.pow(2,32));F(y,g>>>0),F(y,f)}function J(y,g){var f=g/Math.pow(2,32)|0;F(y,g>>>0),F(y,f)}function V(y,g){X(y,g)}function e(y,g){E(y,g)}var h=new Int32Array(2),D=new Float32Array(h.buffer),K=new Float64Array(h.buffer);function X(y,g){D[0]=g,u(y,h[0])}function E(y,g){K[0]=g,u(y,h[0]),u(y,h[1])}function O(y,g){return N(y,g?1:0)}function L(y,g){g||(g="");var f=n(g),p=0;if(f<32)y.push(160|f),p=1;else if(f<256)y.push(217),N(y,f),p=2;else if(f<65536)y.push(218),s(y,f),p=3;else{if(!(f<4294967296))throw new Error("String too long");y.push(219),F(y,f),p=5}return M(y,y.length,g),p+f}function x(y,g){return isNaN(g)?x(y,0):isFinite(g)?g!==(0|g)?(y.push(203),E(y,g),9):g>=0?g<128?(N(y,g),1):g<256?(y.push(204),N(y,g),2):g<65536?(y.push(205),s(y,g),3):g<4294967296?(y.push(206),F(y,g),5):(y.push(207),J(y,g),9):g>=-32?(y.push(224|g+32),1):g>=-128?(y.push(208),r(y,g),2):g>=-32768?(y.push(209),b(y,g),3):g>=-2147483648?(y.push(210),u(y,g),5):(y.push(211),A(y,g),9):x(y,g>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var d=Object.freeze({__proto__:null,utf8Write:M,int8:r,uint8:N,int16:b,uint16:s,int32:u,uint32:F,int64:A,uint64:J,float32:V,float64:e,writeFloat32:X,writeFloat64:E,boolean:O,string:L,number:x});function t(y,g,f){for(var p="",S=0,k=g,i=g+f;k<i;k++){var H=y[k];0!==(128&H)?192!==(224&H)?224!==(240&H)?240!==(248&H)?console.error("Invalid byte "+H.toString(16)):(S=(7&H)<<18|(63&y[++k])<<12|(63&y[++k])<<6|63&y[++k])>=65536?(S-=65536,p+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):p+=String.fromCharCode(S):p+=String.fromCharCode((15&H)<<12|(63&y[++k])<<6|63&y[++k]):p+=String.fromCharCode((31&H)<<6|63&y[++k]):p+=String.fromCharCode(H)}return p}function v(y,g){return yy(y,g)<<24>>24}function yy(y,g){return y[g.offset++]}function gy(y,g){return fy(y,g)<<16>>16}function fy(y,g){return y[g.offset++]|y[g.offset++]<<8}function py(y,g){return y[g.offset++]|y[g.offset++]<<8|y[g.offset++]<<16|y[g.offset++]<<24}function Sy(y,g){return py(y,g)>>>0}function ky(y,g){return Cy(y,g)}function iy(y,g){return qy(y,g)}function Hy(y,g){var f=Sy(y,g);return py(y,g)*Math.pow(2,32)+f}function Uy(y,g){var f=Sy(y,g);return Sy(y,g)*Math.pow(2,32)+f}var ly=new Int32Array(2),cy=new Float32Array(ly.buffer),Zy=new Float64Array(ly.buffer);function Cy(y,g){return ly[0]=py(y,g),cy[0]}function qy(y,g){return ly[0]=py(y,g),ly[1]=py(y,g),Zy[0]}function Wy(y,g){return yy(y,g)>0}function jy(y,g){var f,p=y[g.offset++];p<192?f=31&p:217===p?f=yy(y,g):218===p?f=fy(y,g):219===p&&(f=Sy(y,g));var S=t(y,g.offset,f);return g.offset+=f,S}function Py(y,g){var f=y[g.offset];return f<192&&f>160||217===f||218===f||219===f}function By(y,g){var f=y[g.offset++];return f<128?f:202===f?Cy(y,g):203===f?qy(y,g):204===f?yy(y,g):205===f?fy(y,g):206===f?Sy(y,g):207===f?Uy(y,g):208===f?v(y,g):209===f?gy(y,g):210===f?py(y,g):211===f?Hy(y,g):f>223?-1*(255-f+1):void 0}function Ry(y,g){var f=y[g.offset];return f<128||f>=202&&f<=211}function Gy(y,g){return y[g.offset]<160}function zy(y,g){return y[g.offset-1]===i&&(y[g.offset]<128||y[g.offset]>=202&&y[g.offset]<=211)}var Ty=Object.freeze({__proto__:null,int8:v,uint8:yy,int16:gy,uint16:fy,int32:py,uint32:Sy,float32:ky,float64:iy,int64:Hy,uint64:Uy,readFloat32:Cy,readFloat64:qy,boolean:Wy,string:jy,stringCheck:Py,number:By,numberCheck:Ry,arrayCheck:Gy,switchStructureCheck:zy}),Qy=function(){function g(y){var g=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y&&y.forEach((function(y){return g.add(y)}))}return g.prototype.sd=function(g,f){return void 0===f&&(f=!0),l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,g,f?this.$items:void 0)},g.prototype.bb=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,g)},g.is=function(y){return void 0!==y.collection},g.prototype.add=function(y){var g=this.$refId++;return void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,g),this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,y),this.$changes.change(g),g},g.prototype.at=function(y){var g=Array.from(this.$items.keys())[y];return this.$items.get(g)},g.prototype.entries=function(){return this.$items.entries()},g.prototype.delete=function(y){for(var g,f,p=this.$items.entries();(f=p.next())&&!f.done;)if(y===f.value[1]){g=f.value[0];break}return void 0!==g&&(this.$changes.delete(g),this.$indexes.delete(g),this.$items.delete(g))},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&c.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.has=function(y){return Array.from(this.$items.values()).some((function(g){return g===y}))},g.prototype.forEach=function(y){var g=this;this.$items.forEach((function(f,p,S){return y(f,p,g)}))},g.prototype.values=function(){return this.$items.values()},Object.defineProperty(g.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),g.prototype.setIndex=function(y,g){this.$indexes.set(y,g)},g.prototype.getIndex=function(y){return this.$indexes.get(y)},g.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},g.prototype.deleteByIndex=function(y){var g=this.$indexes.get(y);this.$items.delete(g),this.$indexes.delete(y)},g.prototype.toArray=function(){return Array.from(this.$items.values())},g.prototype.toJSON=function(){var y=[];return this.forEach((function(g,f){y.push("function"===typeof g.toJSON?g.toJSON():g)})),y},g.prototype.clone=function(y){var f;return y?f=Object.assign(new g,this):(f=new g,this.forEach((function(y){y.$changes?f.add(y.clone()):f.add(y)}))),f},g}(),my=function(){function g(y){var g=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y&&y.forEach((function(y){return g.add(y)}))}return g.prototype.sd=function(g,f){return void 0===f&&(f=!0),l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,g,f?this.$items:void 0)},g.prototype.bb=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,g)},g.is=function(y){return void 0!==y.set},g.prototype.add=function(g){var f,p;if(this.has(g))return!1;var S=this.$refId++;void 0!==g.$changes&&g.$changes.setParent(this,this.$changes.root,S);var k=null!==(p=null===(f=this.$changes.indexes[S])||void 0===f?void 0:f.op)&&void 0!==p?p:y.OPERATION.ADD;return this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,g),this.$changes.change(S,k),S},g.prototype.entries=function(){return this.$items.entries()},g.prototype.delete=function(y){for(var g,f,p=this.$items.entries();(f=p.next())&&!f.done;)if(y===f.value[1]){g=f.value[0];break}return void 0!==g&&(this.$changes.delete(g),this.$indexes.delete(g),this.$items.delete(g))},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&c.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.has=function(y){for(var g,f=this.$items.values(),p=!1;(g=f.next())&&!g.done;)if(y===g.value){p=!0;break}return p},g.prototype.forEach=function(y){var g=this;this.$items.forEach((function(f,p,S){return y(f,p,g)}))},g.prototype.values=function(){return this.$items.values()},Object.defineProperty(g.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),g.prototype.setIndex=function(y,g){this.$indexes.set(y,g)},g.prototype.getIndex=function(y){return this.$indexes.get(y)},g.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},g.prototype.deleteByIndex=function(y){var g=this.$indexes.get(y);this.$items.delete(g),this.$indexes.delete(y)},g.prototype.toArray=function(){return Array.from(this.$items.values())},g.prototype.toJSON=function(){var y=[];return this.forEach((function(g,f){y.push("function"===typeof g.toJSON?g.toJSON():g)})),y},g.prototype.clone=function(y){var f;return y?f=Object.assign(new g,this):(f=new g,this.forEach((function(y){y.$changes?f.add(y.clone()):f.add(y)}))),f},g}(),ay=function(){function y(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return y.prototype.addRefId=function(y){this.refIds.has(y)||(this.refIds.add(y),this.containerIndexes.set(y,new Set))},y.get=function(g){return void 0===g.$filterState&&(g.$filterState=new y),g.$filterState},y}(),wy=function(){function y(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return y.prototype.getNextUniqueId=function(){return this.nextUniqueId++},y.prototype.addRef=function(y,g,f){void 0===f&&(f=!0),this.refs.set(y,g),f&&(this.refCounts[y]=(this.refCounts[y]||0)+1)},y.prototype.removeRef=function(y){this.refCounts[y]=this.refCounts[y]-1,this.deletedRefs.add(y)},y.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},y.prototype.garbageCollectDeletedRefs=function(){var y=this;this.deletedRefs.forEach((function(g){if(!(y.refCounts[g]>0)){var f=y.refs.get(g);if(f instanceof ry)for(var p in f._definition.schema)"string"!==typeof f._definition.schema[p]&&f[p]&&f[p].$changes&&y.removeRef(f[p].$changes.refId);else{var S=f.$changes.parent._definition,k=S.schema[S.fieldsByIndex[f.$changes.parentIndex]];"function"===typeof Object.values(k)[0]&&Array.from(f.values()).forEach((function(g){return y.removeRef(g.$changes.refId)}))}y.refs.delete(g),delete y.refCounts[g]}})),this.deletedRefs.clear()},y}(),oy=function(y){function g(){return null!==y&&y.apply(this,arguments)||this}return f(g,y),g}(Error);function Iy(y,g,f,p){var S,k=!1;switch(g){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":S="number",isNaN(y)&&console.log('trying to encode "NaN" in '.concat(f.constructor.name,"#").concat(p));break;case"string":S="string",k=!0;break;case"boolean":return}if(typeof y!==S&&(!k||k&&null!==y)){var i="'".concat(JSON.stringify(y),"'").concat(y&&y.constructor&&" (".concat(y.constructor.name,")")||"");throw new oy("a '".concat(S,"' was expected, but ").concat(i," was provided in ").concat(f.constructor.name,"#").concat(p))}}function Yy(y,g,f,p){if(!(y instanceof g))throw new oy("a '".concat(g.name,"' was expected, but '").concat(y.constructor.name,"' was provided in ").concat(f.constructor.name,"#").concat(p))}function ny(y,g,f,p,S){Iy(f,y,p,S);var k=d[y];if(!k)throw new oy("a '".concat(y,"' was expected, but ").concat(f," was provided in ").concat(p.constructor.name,"#").concat(S));k(g,f)}function My(y,g,f){return Ty[y](g,f)}var ry=function(){function g(){for(var y=[],g=0;g<arguments.length;g++)y[g]=arguments[g];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new wy),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var f=this._definition.descriptors;f&&Object.defineProperties(this,f),y[0]&&this.assign(y[0])}return g.onError=function(y){console.error(y)},g.is=function(y){return y._definition&&void 0!==y._definition.schema},g.prototype.onChange=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,g)},g.prototype.bb=function(g){return l(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,g)},g.prototype.assign=function(y){return Object.assign(this,y),this},Object.defineProperty(g.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),g.prototype.setDirty=function(y,g){this.$changes.change(y,g)},g.prototype.listen=function(y,g,f){var p=this;return void 0===f&&(f=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[y]||(this.$callbacks[y]=[]),this.$callbacks[y].push(g),f&&void 0!==this[y]&&g(this[y],void 0),function(){return Z(p.$callbacks[y],p.$callbacks[y].indexOf(g))}},g.prototype.decode=function(f,p,S){var k;void 0===p&&(p={offset:0}),void 0===S&&(S=this);var H=[],U=this.$changes.root,l=f.length,c=0;for(U.refs.set(c,this);p.offset<l;){var Z=f[p.offset++];if(Z!=i){var C=S.$changes,q=void 0!==S._definition,j=q?Z>>6<<6:Z;if(j!==y.OPERATION.CLEAR){var B=q?Z%(j||255):By(f,p),R=q?S._definition.fieldsByIndex[B]:"",z=C.getType(B),T=void 0,Q=void 0,m=void 0;if(q?Q=S["_".concat(R)]:(Q=S.getByIndex(B),(j&y.OPERATION.ADD)===y.OPERATION.ADD?(m=S instanceof P?jy(f,p):B,S.setIndex(B,m)):m=S.getIndex(B)),(j&y.OPERATION.DELETE)===y.OPERATION.DELETE&&(j!==y.OPERATION.DELETE_AND_ADD&&S.deleteByIndex(B),Q&&Q.$changes&&U.removeRef(Q.$changes.refId),T=null),void 0!==R){if(j===y.OPERATION.DELETE);else if(g.is(z)){var a=By(f,p);if(T=U.refs.get(a),j!==y.OPERATION.REPLACE){var w=this.getSchemaType(f,p,z);T||((T=this.createTypeInstance(w)).$changes.refId=a,Q&&(T.$callbacks=Q.$callbacks,Q.$changes.refId&&a!==Q.$changes.refId&&U.removeRef(Q.$changes.refId))),U.addRef(a,T,T!==Q)}}else if("string"===typeof z)T=My(z,f,p);else{var o=G(Object.keys(z)[0]),I=By(f,p),Y=U.refs.has(I)?Q||U.refs.get(I):new o.constructor;if((T=Y.clone(!0)).$changes.refId=I,Q&&(T.$callbacks=Q.$callbacks,Q.$changes.refId&&I!==Q.$changes.refId)){U.removeRef(Q.$changes.refId);for(var n=Q.entries(),M=void 0;(M=n.next())&&!M.done;){var r=(k=M.value)[0],N=k[1];H.push({refId:I,op:y.OPERATION.DELETE,field:r,value:void 0,previousValue:N})}}U.addRef(I,T,Y!==Q)}if(null!==T&&void 0!==T)if(T.$changes&&T.$changes.setParent(C.ref,C.root,B),S instanceof g)S[R]=T;else if(S instanceof P)r=m,S.$items.set(r,T),S.$changes.allChanges.add(B);else if(S instanceof W)S.setAt(B,T);else if(S instanceof Qy){var b=S.add(T);S.setIndex(B,b)}else S instanceof my&&!1!==(b=S.add(T))&&S.setIndex(B,b);Q!==T&&H.push({refId:c,op:j,field:R,dynamicIndex:m,value:T,previousValue:Q})}else{console.warn("@colyseus/schema: definition mismatch");for(var s={offset:p.offset};p.offset<l&&(!zy(f,p)||(s.offset=p.offset+1,!U.refs.has(By(f,s))));)p.offset++}}else S.clear(H)}else{c=By(f,p);var u=U.refs.get(c);if(!u)throw new Error('"refId" not found: '.concat(c));S=u}}return this._triggerChanges(H),U.garbageCollectDeletedRefs(),H},g.prototype.encode=function(f,p,S){void 0===f&&(f=!1),void 0===p&&(p=[]),void 0===S&&(S=!1);for(var k=this.$changes,H=new WeakSet,U=[k],l=1,c=0;c<l;c++){var Z=U[c],C=Z.ref,q=C instanceof g;Z.ensureRefId(),H.add(Z),Z!==k&&(Z.changed||f)&&(N(p,i),x(p,Z.refId));for(var W=f?Array.from(Z.allChanges):Array.from(Z.changes.values()),j=0,B=W.length;j<B;j++){var R=f?{op:y.OPERATION.ADD,index:W[j]}:W[j],z=R.index,T=q?C._definition.fieldsByIndex&&C._definition.fieldsByIndex[z]:z,Q=p.length;if(R.op!==y.OPERATION.TOUCH)if(q)N(p,z|R.op);else{if(N(p,R.op),R.op===y.OPERATION.CLEAR)continue;x(p,z)}if(q||(R.op&y.OPERATION.ADD)!=y.OPERATION.ADD||C instanceof P&&L(p,Z.ref.$indexes.get(z)),R.op!==y.OPERATION.DELETE){var m=Z.getType(z),a=Z.getValue(z);if(a&&a.$changes&&!H.has(a.$changes)&&(U.push(a.$changes),a.$changes.ensureRefId(),l++),R.op!==y.OPERATION.TOUCH){if(g.is(m))Yy(a,m,C,T),x(p,a.$changes.refId),(R.op&y.OPERATION.ADD)===y.OPERATION.ADD&&this.tryEncodeTypeId(p,m,a.constructor);else if("string"===typeof m)ny(m,p,a,C,T);else{var w=G(Object.keys(m)[0]);Yy(C["_".concat(T)],w.constructor,C,T),x(p,a.$changes.refId)}S&&Z.cache(z,p.slice(Q))}}}f||S||Z.discard()}return p},g.prototype.encodeAll=function(y){return this.encode(!0,[],y)},g.prototype.applyFilters=function(f,p){var S,k;void 0===p&&(p=!1);for(var H=this,U=new Set,l=ay.get(f),c=[this.$changes],Z=1,C=[],q=function(q){var W=c[q];if(U.has(W.refId))return"continue";var j=W.ref,B=j instanceof g;N(C,i),x(C,W.refId);var R=l.refIds.has(W),G=p||!R;l.addRefId(W);var z=l.containerIndexes.get(W),T=G?Array.from(W.allChanges):Array.from(W.changes.values());!p&&B&&j._definition.indexesWithFilters&&j._definition.indexesWithFilters.forEach((function(g){!z.has(g)&&W.allChanges.has(g)&&(G?T.push(g):T.push({op:y.OPERATION.ADD,index:g}))}));for(var Q=0,m=T.length;Q<m;Q++){var a=G?{op:y.OPERATION.ADD,index:T[Q]}:T[Q];if(a.op!==y.OPERATION.CLEAR){var w=a.index;if(a.op!==y.OPERATION.DELETE){var o=W.getValue(w),I=W.getType(w);if(B){if((Y=j._definition.filters&&j._definition.filters[w])&&!Y.call(j,f,o,H)){o&&o.$changes&&U.add(o.$changes.refId);continue}}else{var Y,n=W.parent;if((Y=W.getChildrenFilter())&&!Y.call(n,f,j.$indexes.get(w),o,H)){o&&o.$changes&&U.add(o.$changes.refId);continue}}if(o.$changes&&(c.push(o.$changes),Z++),a.op!==y.OPERATION.TOUCH)if(a.op===y.OPERATION.ADD||B)C.push.apply(C,null!==(S=W.caches[w])&&void 0!==S?S:[]),z.add(w);else if(z.has(w))C.push.apply(C,null!==(k=W.caches[w])&&void 0!==k?k:[]);else{if(z.add(w),N(C,y.OPERATION.ADD),x(C,w),j instanceof P){var M=W.ref.$indexes.get(w);L(C,M)}o.$changes?x(C,o.$changes.refId):d[I](C,o)}else o.$changes&&!B&&(N(C,y.OPERATION.ADD),x(C,w),j instanceof P&&(M=W.ref.$indexes.get(w),L(C,M)),x(C,o.$changes.refId))}else B?N(C,a.op|w):(N(C,a.op),x(C,w))}else N(C,a.op)}},W=0;W<Z;W++)q(W);return C},g.prototype.clone=function(){var y,g=new this.constructor,f=this._definition.schema;for(var p in f)"object"===typeof this[p]&&"function"===typeof(null===(y=this[p])||void 0===y?void 0:y.clone)?g[p]=this[p].clone():g[p]=this[p];return g},g.prototype.toJSON=function(){var y=this._definition.schema,g=this._definition.deprecated,f={};for(var p in y)g[p]||null===this[p]||"undefined"===typeof this[p]||(f[p]="function"===typeof this[p].toJSON?this[p].toJSON():this["_".concat(p)]);return f},g.prototype.discardAllChanges=function(){this.$changes.discardAll()},g.prototype.getByIndex=function(y){return this[this._definition.fieldsByIndex[y]]},g.prototype.deleteByIndex=function(y){this[this._definition.fieldsByIndex[y]]=void 0},g.prototype.tryEncodeTypeId=function(y,g,f){g._typeid!==f._typeid&&(N(y,H),x(y,f._typeid))},g.prototype.getSchemaType=function(y,g,f){var p;return y[g.offset]===H&&(g.offset++,p=this.constructor._context.get(By(y,g))),p||f},g.prototype.createTypeInstance=function(y){var g=new y;return g.$changes.root=this.$changes.root,g},g.prototype._triggerChanges=function(f){for(var p,S,k,i,H,U,l,c,Z,C=new Set,q=this.$changes.root.refs,W=function(W){var j=f[W],P=j.refId,B=q.get(P),R=B.$callbacks;if((j.op&y.OPERATION.DELETE)===y.OPERATION.DELETE&&j.previousValue instanceof g&&(null===(S=null===(p=j.previousValue.$callbacks)||void 0===p?void 0:p[y.OPERATION.DELETE])||void 0===S||S.forEach((function(y){return y()}))),!R)return"continue";if(B instanceof g){if(!C.has(P))try{null===(k=null===R||void 0===R?void 0:R[y.OPERATION.REPLACE])||void 0===k||k.forEach((function(y){return y()}))}catch(G){g.onError(G)}try{R.hasOwnProperty(j.field)&&(null===(i=R[j.field])||void 0===i||i.forEach((function(y){return y(j.value,j.previousValue)})))}catch(G){g.onError(G)}}else j.op===y.OPERATION.ADD&&void 0===j.previousValue?null===(H=R[y.OPERATION.ADD])||void 0===H||H.forEach((function(y){var g;return y(j.value,null!==(g=j.dynamicIndex)&&void 0!==g?g:j.field)})):j.op===y.OPERATION.DELETE?void 0!==j.previousValue&&(null===(U=R[y.OPERATION.DELETE])||void 0===U||U.forEach((function(y){var g;return y(j.previousValue,null!==(g=j.dynamicIndex)&&void 0!==g?g:j.field)}))):j.op===y.OPERATION.DELETE_AND_ADD&&(void 0!==j.previousValue&&(null===(l=R[y.OPERATION.DELETE])||void 0===l||l.forEach((function(y){var g;return y(j.previousValue,null!==(g=j.dynamicIndex)&&void 0!==g?g:j.field)}))),null===(c=R[y.OPERATION.ADD])||void 0===c||c.forEach((function(y){var g;return y(j.value,null!==(g=j.dynamicIndex)&&void 0!==g?g:j.field)}))),j.value!==j.previousValue&&(null===(Z=R[y.OPERATION.REPLACE])||void 0===Z||Z.forEach((function(y){var g;return y(j.value,null!==(g=j.dynamicIndex)&&void 0!==g?g:j.field)})));C.add(P)},j=0;j<f.length;j++)W(j)},g._definition=z.create(),g}();function Ny(y){for(var g=[y.$changes],f=1,p={},S=p,k=function(y){var f=g[y];f.changes.forEach((function(y){var g=f.ref,p=y.index,k=g._definition?g._definition.fieldsByIndex[p]:g.$indexes.get(p);S[k]=f.getValue(p)}))},i=0;i<f;i++)k(i);return p}var by={context:new Q},sy=function(y){function g(){return null!==y&&y.apply(this,arguments)||this}return f(g,y),p([a("string",by)],g.prototype,"name",void 0),p([a("string",by)],g.prototype,"type",void 0),p([a("number",by)],g.prototype,"referencedType",void 0),g}(ry),uy=function(y){function g(){var g=null!==y&&y.apply(this,arguments)||this;return g.fields=new W,g}return f(g,y),p([a("number",by)],g.prototype,"id",void 0),p([a([sy],by)],g.prototype,"fields",void 0),g}(ry),Fy=function(y){function g(){var g=null!==y&&y.apply(this,arguments)||this;return g.types=new W,g}return f(g,y),g.encode=function(y){var f=y.constructor,p=new g;p.rootType=f._typeid;var S=function(y,g){for(var f in g){var S=new sy;S.name=f;var k=void 0;if("string"===typeof g[f])k=g[f];else{var i=g[f],H=void 0;ry.is(i)?(k="ref",H=g[f]):"string"===typeof i[k=Object.keys(i)[0]]?k+=":"+i[k]:H=i[k],S.referencedType=H?H._typeid:-1}S.type=k,y.fields.push(S)}p.types.push(y)},k=f._context.types;for(var i in k){var H=new uy;H.id=Number(i),S(H,k[i]._definition.schema)}return p.encodeAll()},g.decode=function(y,p){var S=new Q,k=new g;k.decode(y,p);var i=k.types.reduce((function(y,g){var p=function(y){function g(){return null!==y&&y.apply(this,arguments)||this}return f(g,y),g}(ry),k=g.id;return y[k]=p,S.add(p,k),y}),{});k.types.forEach((function(y){var g=i[y.id];y.fields.forEach((function(y){var f;if(void 0!==y.referencedType){var p=y.type,k=i[y.referencedType];if(!k){var H=y.type.split(":");p=H[0],k=H[1]}"ref"===p?a(k,{context:S})(g.prototype,y.name):a(((f={})[p]=k,f),{context:S})(g.prototype,y.name)}else a(y.type,{context:S})(g.prototype,y.name)}))}));var H=i[k.rootType],U=new H;for(var l in H._definition.schema){var c=H._definition.schema[l];"string"!==typeof c&&(U[l]="function"===typeof c?new c:new(G(Object.keys(c)[0]).constructor))}return U},p([a([uy],by)],g.prototype,"types",void 0),p([a("number",by)],g.prototype,"rootType",void 0),g}(ry);R("map",{constructor:P}),R("array",{constructor:W}),R("set",{constructor:my}),R("collection",{constructor:Qy}),y.ArraySchema=W,y.CollectionSchema=Qy,y.Context=Q,y.MapSchema=P,y.Reflection=Fy,y.ReflectionField=sy,y.ReflectionType=uy,y.Schema=ry,y.SchemaDefinition=z,y.SetSchema=my,y.decode=Ty,y.defineTypes=Y,y.deprecated=I,y.dumpChanges=Ny,y.encode=d,y.filter=w,y.filterChildren=o,y.hasFilter=T,y.registerType=R,y.type=a,Object.defineProperty(y,"__esModule",{value:!0})}(g)},12701:y=>{"use strict";y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12698:(y,g,f)=>{var p=f(12701),S=f(12710),k=Object.hasOwnProperty,i=Object.create(null);for(var H in p)k.call(p,H)&&(i[p[H]]=H);var U=y.exports={to:{},get:{}};function l(y,g,f){return Math.min(Math.max(g,y),f)}function c(y){var g=Math.round(y).toString(16).toUpperCase();return g.length<2?"0"+g:g}U.get=function(y){var g,f;switch(y.substring(0,3).toLowerCase()){case"hsl":g=U.get.hsl(y),f="hsl";break;case"hwb":g=U.get.hwb(y),f="hwb";break;default:g=U.get.rgb(y),f="rgb"}return g?{model:f,value:g}:null},U.get.rgb=function(y){if(!y)return null;var g,f,S,i=[0,0,0,1];if(g=y.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(S=g[2],g=g[1],f=0;f<3;f++){var H=2*f;i[f]=parseInt(g.slice(H,H+2),16)}S&&(i[3]=parseInt(S,16)/255)}else if(g=y.match(/^#([a-f0-9]{3,4})$/i)){for(S=(g=g[1])[3],f=0;f<3;f++)i[f]=parseInt(g[f]+g[f],16);S&&(i[3]=parseInt(S+S,16)/255)}else if(g=y.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(f=0;f<3;f++)i[f]=parseInt(g[f+1],0);g[4]&&(g[5]?i[3]=.01*parseFloat(g[4]):i[3]=parseFloat(g[4]))}else{if(!(g=y.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(g=y.match(/^(\w+)$/))?"transparent"===g[1]?[0,0,0,0]:k.call(p,g[1])?((i=p[g[1]])[3]=1,i):null:null;for(f=0;f<3;f++)i[f]=Math.round(2.55*parseFloat(g[f+1]));g[4]&&(g[5]?i[3]=.01*parseFloat(g[4]):i[3]=parseFloat(g[4]))}for(f=0;f<3;f++)i[f]=l(i[f],0,255);return i[3]=l(i[3],0,1),i},U.get.hsl=function(y){if(!y)return null;var g=y.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(g){var f=parseFloat(g[4]);return[(parseFloat(g[1])%360+360)%360,l(parseFloat(g[2]),0,100),l(parseFloat(g[3]),0,100),l(isNaN(f)?1:f,0,1)]}return null},U.get.hwb=function(y){if(!y)return null;var g=y.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(g){var f=parseFloat(g[4]);return[(parseFloat(g[1])%360+360)%360,l(parseFloat(g[2]),0,100),l(parseFloat(g[3]),0,100),l(isNaN(f)?1:f,0,1)]}return null},U.to.hex=function(){var y=S(arguments);return"#"+c(y[0])+c(y[1])+c(y[2])+(y[3]<1?c(Math.round(255*y[3])):"")},U.to.rgb=function(){var y=S(arguments);return y.length<4||1===y[3]?"rgb("+Math.round(y[0])+", "+Math.round(y[1])+", "+Math.round(y[2])+")":"rgba("+Math.round(y[0])+", "+Math.round(y[1])+", "+Math.round(y[2])+", "+y[3]+")"},U.to.rgb.percent=function(){var y=S(arguments),g=Math.round(y[0]/255*100),f=Math.round(y[1]/255*100),p=Math.round(y[2]/255*100);return y.length<4||1===y[3]?"rgb("+g+"%, "+f+"%, "+p+"%)":"rgba("+g+"%, "+f+"%, "+p+"%, "+y[3]+")"},U.to.hsl=function(){var y=S(arguments);return y.length<4||1===y[3]?"hsl("+y[0]+", "+y[1]+"%, "+y[2]+"%)":"hsla("+y[0]+", "+y[1]+"%, "+y[2]+"%, "+y[3]+")"},U.to.hwb=function(){var y=S(arguments),g="";return y.length>=4&&1!==y[3]&&(g=", "+y[3]),"hwb("+y[0]+", "+y[1]+"%, "+y[2]+"%"+g+")"},U.to.keyword=function(y){return i[y.slice(0,3)]}},12690:(y,g,f)=>{const p=f(12698),S=f(12719),k=["keyword","gray","hex"],i={};for(const q of Object.keys(S))i[[...S[q].labels].sort().join("")]=q;const H={};function U(y,g){if(!(this instanceof U))return new U(y,g);if(g&&g in k&&(g=null),g&&!(g in S))throw new Error("Unknown model: "+g);let f,l;if(null==y)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(y instanceof U)this.model=y.model,this.color=[...y.color],this.valpha=y.valpha;else if("string"===typeof y){const g=p.get(y);if(null===g)throw new Error("Unable to parse color from string: "+y);this.model=g.model,l=S[this.model].channels,this.color=g.value.slice(0,l),this.valpha="number"===typeof g.value[l]?g.value[l]:1}else if(y.length>0){this.model=g||"rgb",l=S[this.model].channels;const f=Array.prototype.slice.call(y,0,l);this.color=C(f,l),this.valpha="number"===typeof y[l]?y[l]:1}else if("number"===typeof y)this.model="rgb",this.color=[y>>16&255,y>>8&255,255&y],this.valpha=1;else{this.valpha=1;const g=Object.keys(y);"alpha"in y&&(g.splice(g.indexOf("alpha"),1),this.valpha="number"===typeof y.alpha?y.alpha:0);const p=g.sort().join("");if(!(p in i))throw new Error("Unable to parse color from object: "+JSON.stringify(y));this.model=i[p];const{labels:k}=S[this.model],H=[];for(f=0;f<k.length;f++)H.push(y[k[f]]);this.color=C(H)}if(H[this.model])for(l=S[this.model].channels,f=0;f<l;f++){const y=H[this.model][f];y&&(this.color[f]=y(this.color[f]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}U.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(y){let g=this.model in p.to?this:this.rgb();g=g.round("number"===typeof y?y:1);const f=1===g.valpha?g.color:[...g.color,this.valpha];return p.to[g.model](f)},percentString(y){const g=this.rgb().round("number"===typeof y?y:1),f=1===g.valpha?g.color:[...g.color,this.valpha];return p.to.rgb.percent(f)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const y={},{channels:g}=S[this.model],{labels:f}=S[this.model];for(let p=0;p<g;p++)y[f[p]]=this.color[p];return 1!==this.valpha&&(y.alpha=this.valpha),y},unitArray(){const y=this.rgb().color;return y[0]/=255,y[1]/=255,y[2]/=255,1!==this.valpha&&y.push(this.valpha),y},unitObject(){const y=this.rgb().object();return y.r/=255,y.g/=255,y.b/=255,1!==this.valpha&&(y.alpha=this.valpha),y},round(y){return y=Math.max(y||0,0),new U([...this.color.map(l(y)),this.valpha],this.model)},alpha(y){return void 0!==y?new U([...this.color,Math.max(0,Math.min(1,y))],this.model):this.valpha},red:c("rgb",0,Z(255)),green:c("rgb",1,Z(255)),blue:c("rgb",2,Z(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,(y=>(y%360+360)%360)),saturationl:c("hsl",1,Z(100)),lightness:c("hsl",2,Z(100)),saturationv:c("hsv",1,Z(100)),value:c("hsv",2,Z(100)),chroma:c("hcg",1,Z(100)),gray:c("hcg",2,Z(100)),white:c("hwb",1,Z(100)),wblack:c("hwb",2,Z(100)),cyan:c("cmyk",0,Z(100)),magenta:c("cmyk",1,Z(100)),yellow:c("cmyk",2,Z(100)),black:c("cmyk",3,Z(100)),x:c("xyz",0,Z(95.047)),y:c("xyz",1,Z(100)),z:c("xyz",2,Z(108.833)),l:c("lab",0,Z(100)),a:c("lab",1),b:c("lab",2),keyword(y){return void 0!==y?new U(y):S[this.model].keyword(this.color)},hex(y){return void 0!==y?new U(y):p.to.hex(this.rgb().round().color)},hexa(y){if(void 0!==y)return new U(y);const g=this.rgb().round().color;let f=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===f.length&&(f="0"+f),p.to.hex(g)+f},rgbNumber(){const y=this.rgb().color;return(255&y[0])<<16|(255&y[1])<<8|255&y[2]},luminosity(){const y=this.rgb().color,g=[];for(const[f,p]of y.entries()){const y=p/255;g[f]=y<=.04045?y/12.92:((y+.055)/1.055)**2.4}return.2126*g[0]+.7152*g[1]+.0722*g[2]},contrast(y){const g=this.luminosity(),f=y.luminosity();return g>f?(g+.05)/(f+.05):(f+.05)/(g+.05)},level(y){const g=this.contrast(y);return g>=7?"AAA":g>=4.5?"AA":""},isDark(){const y=this.rgb().color;return(2126*y[0]+7152*y[1]+722*y[2])/1e4<128},isLight(){return!this.isDark()},negate(){const y=this.rgb();for(let g=0;g<3;g++)y.color[g]=255-y.color[g];return y},lighten(y){const g=this.hsl();return g.color[2]+=g.color[2]*y,g},darken(y){const g=this.hsl();return g.color[2]-=g.color[2]*y,g},saturate(y){const g=this.hsl();return g.color[1]+=g.color[1]*y,g},desaturate(y){const g=this.hsl();return g.color[1]-=g.color[1]*y,g},whiten(y){const g=this.hwb();return g.color[1]+=g.color[1]*y,g},blacken(y){const g=this.hwb();return g.color[2]+=g.color[2]*y,g},grayscale(){const y=this.rgb().color,g=.3*y[0]+.59*y[1]+.11*y[2];return U.rgb(g,g,g)},fade(y){return this.alpha(this.valpha-this.valpha*y)},opaquer(y){return this.alpha(this.valpha+this.valpha*y)},rotate(y){const g=this.hsl();let f=g.color[0];return f=(f+y)%360,f=f<0?360+f:f,g.color[0]=f,g},mix(y,g){if(!y||!y.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof y);const f=y.rgb(),p=this.rgb(),S=void 0===g?.5:g,k=2*S-1,i=f.alpha()-p.alpha(),H=((k*i===-1?k:(k+i)/(1+k*i))+1)/2,l=1-H;return U.rgb(H*f.red()+l*p.red(),H*f.green()+l*p.green(),H*f.blue()+l*p.blue(),f.alpha()*S+p.alpha()*(1-S))}};for(const q of Object.keys(S)){if(k.includes(q))continue;const{channels:y}=S[q];U.prototype[q]=function(){if(this.model===q)return new U(this);for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];return g.length>0?new U(g,q):new U([...(p=S[this.model][q].raw(this.color),Array.isArray(p)?p:[p]),this.valpha],q);var p},U[q]=function(){for(var g=arguments.length,f=new Array(g),p=0;p<g;p++)f[p]=arguments[p];let S=f[0];return"number"===typeof S&&(S=C(f,y)),new U(S,q)}}function l(y){return function(g){return function(y,g){return Number(y.toFixed(g))}(g,y)}}function c(y,g,f){y=Array.isArray(y)?y:[y];for(const p of y)(H[p]||(H[p]=[]))[g]=f;return y=y[0],function(p){let S;return void 0!==p?(f&&(p=f(p)),S=this[y](),S.color[g]=p,S):(S=this[y]().color[g],f&&(S=f(S)),S)}}function Z(y){return function(g){return Math.max(0,Math.min(y,g))}}function C(y,g){for(let f=0;f<g;f++)"number"!==typeof y[f]&&(y[f]=0);return y}y.exports=U},12725:(y,g,f)=>{const p=f(12729),S={};for(const i of Object.keys(p))S[p[i]]=i;const k={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};y.exports=k;for(const i of Object.keys(k)){if(!("channels"in k[i]))throw new Error("missing channels property: "+i);if(!("labels"in k[i]))throw new Error("missing channel labels property: "+i);if(k[i].labels.length!==k[i].channels)throw new Error("channel and label counts mismatch: "+i);const{channels:y,labels:g}=k[i];delete k[i].channels,delete k[i].labels,Object.defineProperty(k[i],"channels",{value:y}),Object.defineProperty(k[i],"labels",{value:g})}k.rgb.hsl=function(y){const g=y[0]/255,f=y[1]/255,p=y[2]/255,S=Math.min(g,f,p),k=Math.max(g,f,p),i=k-S;let H,U;k===S?H=0:g===k?H=(f-p)/i:f===k?H=2+(p-g)/i:p===k&&(H=4+(g-f)/i),H=Math.min(60*H,360),H<0&&(H+=360);const l=(S+k)/2;return U=k===S?0:l<=.5?i/(k+S):i/(2-k-S),[H,100*U,100*l]},k.rgb.hsv=function(y){let g,f,p,S,k;const i=y[0]/255,H=y[1]/255,U=y[2]/255,l=Math.max(i,H,U),c=l-Math.min(i,H,U),Z=function(y){return(l-y)/6/c+.5};return 0===c?(S=0,k=0):(k=c/l,g=Z(i),f=Z(H),p=Z(U),i===l?S=p-f:H===l?S=1/3+g-p:U===l&&(S=2/3+f-g),S<0?S+=1:S>1&&(S-=1)),[360*S,100*k,100*l]},k.rgb.hwb=function(y){const g=y[0],f=y[1];let p=y[2];const S=k.rgb.hsl(y)[0],i=1/255*Math.min(g,Math.min(f,p));return p=1-1/255*Math.max(g,Math.max(f,p)),[S,100*i,100*p]},k.rgb.cmyk=function(y){const g=y[0]/255,f=y[1]/255,p=y[2]/255,S=Math.min(1-g,1-f,1-p);return[100*((1-g-S)/(1-S)||0),100*((1-f-S)/(1-S)||0),100*((1-p-S)/(1-S)||0),100*S]},k.rgb.keyword=function(y){const g=S[y];if(g)return g;let f,k=1/0;for(const S of Object.keys(p)){const g=p[S],U=(H=g,((i=y)[0]-H[0])**2+(i[1]-H[1])**2+(i[2]-H[2])**2);U<k&&(k=U,f=S)}var i,H;return f},k.keyword.rgb=function(y){return p[y]},k.rgb.xyz=function(y){let g=y[0]/255,f=y[1]/255,p=y[2]/255;g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,p=p>.04045?((p+.055)/1.055)**2.4:p/12.92;return[100*(.4124*g+.3576*f+.1805*p),100*(.2126*g+.7152*f+.0722*p),100*(.0193*g+.1192*f+.9505*p)]},k.rgb.lab=function(y){const g=k.rgb.xyz(y);let f=g[0],p=g[1],S=g[2];f/=95.047,p/=100,S/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,p=p>.008856?p**(1/3):7.787*p+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*p-16,500*(f-p),200*(p-S)]},k.hsl.rgb=function(y){const g=y[0]/360,f=y[1]/100,p=y[2]/100;let S,k,i;if(0===f)return i=255*p,[i,i,i];S=p<.5?p*(1+f):p+f-p*f;const H=2*p-S,U=[0,0,0];for(let l=0;l<3;l++)k=g+1/3*-(l-1),k<0&&k++,k>1&&k--,i=6*k<1?H+6*(S-H)*k:2*k<1?S:3*k<2?H+(S-H)*(2/3-k)*6:H,U[l]=255*i;return U},k.hsl.hsv=function(y){const g=y[0];let f=y[1]/100,p=y[2]/100,S=f;const k=Math.max(p,.01);p*=2,f*=p<=1?p:2-p,S*=k<=1?k:2-k;return[g,100*(0===p?2*S/(k+S):2*f/(p+f)),100*((p+f)/2)]},k.hsv.rgb=function(y){const g=y[0]/60,f=y[1]/100;let p=y[2]/100;const S=Math.floor(g)%6,k=g-Math.floor(g),i=255*p*(1-f),H=255*p*(1-f*k),U=255*p*(1-f*(1-k));switch(p*=255,S){case 0:return[p,U,i];case 1:return[H,p,i];case 2:return[i,p,U];case 3:return[i,H,p];case 4:return[U,i,p];case 5:return[p,i,H]}},k.hsv.hsl=function(y){const g=y[0],f=y[1]/100,p=y[2]/100,S=Math.max(p,.01);let k,i;i=(2-f)*p;const H=(2-f)*S;return k=f*S,k/=H<=1?H:2-H,k=k||0,i/=2,[g,100*k,100*i]},k.hwb.rgb=function(y){const g=y[0]/360;let f=y[1]/100,p=y[2]/100;const S=f+p;let k;S>1&&(f/=S,p/=S);const i=Math.floor(6*g),H=1-p;k=6*g-i,0!==(1&i)&&(k=1-k);const U=f+k*(H-f);let l,c,Z;switch(i){default:case 6:case 0:l=H,c=U,Z=f;break;case 1:l=U,c=H,Z=f;break;case 2:l=f,c=H,Z=U;break;case 3:l=f,c=U,Z=H;break;case 4:l=U,c=f,Z=H;break;case 5:l=H,c=f,Z=U}return[255*l,255*c,255*Z]},k.cmyk.rgb=function(y){const g=y[0]/100,f=y[1]/100,p=y[2]/100,S=y[3]/100;return[255*(1-Math.min(1,g*(1-S)+S)),255*(1-Math.min(1,f*(1-S)+S)),255*(1-Math.min(1,p*(1-S)+S))]},k.xyz.rgb=function(y){const g=y[0]/100,f=y[1]/100,p=y[2]/100;let S,k,i;return S=3.2406*g+-1.5372*f+-.4986*p,k=-.9689*g+1.8758*f+.0415*p,i=.0557*g+-.204*f+1.057*p,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,S=Math.min(Math.max(0,S),1),k=Math.min(Math.max(0,k),1),i=Math.min(Math.max(0,i),1),[255*S,255*k,255*i]},k.xyz.lab=function(y){let g=y[0],f=y[1],p=y[2];g/=95.047,f/=100,p/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,p=p>.008856?p**(1/3):7.787*p+16/116;return[116*f-16,500*(g-f),200*(f-p)]},k.lab.xyz=function(y){let g,f,p;f=(y[0]+16)/116,g=y[1]/500+f,p=f-y[2]/200;const S=f**3,k=g**3,i=p**3;return f=S>.008856?S:(f-16/116)/7.787,g=k>.008856?k:(g-16/116)/7.787,p=i>.008856?i:(p-16/116)/7.787,g*=95.047,f*=100,p*=108.883,[g,f,p]},k.lab.lch=function(y){const g=y[0],f=y[1],p=y[2];let S;S=360*Math.atan2(p,f)/2/Math.PI,S<0&&(S+=360);return[g,Math.sqrt(f*f+p*p),S]},k.lch.lab=function(y){const g=y[0],f=y[1],p=y[2]/360*2*Math.PI;return[g,f*Math.cos(p),f*Math.sin(p)]},k.rgb.ansi16=function(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[f,p,S]=y;let i=null===g?k.rgb.hsv(y)[2]:g;if(i=Math.round(i/50),0===i)return 30;let H=30+(Math.round(S/255)<<2|Math.round(p/255)<<1|Math.round(f/255));return 2===i&&(H+=60),H},k.hsv.ansi16=function(y){return k.rgb.ansi16(k.hsv.rgb(y),y[2])},k.rgb.ansi256=function(y){const g=y[0],f=y[1],p=y[2];if(g===f&&f===p)return g<8?16:g>248?231:Math.round((g-8)/247*24)+232;return 16+36*Math.round(g/255*5)+6*Math.round(f/255*5)+Math.round(p/255*5)},k.ansi16.rgb=function(y){let g=y%10;if(0===g||7===g)return y>50&&(g+=3.5),g=g/10.5*255,[g,g,g];const f=.5*(1+~~(y>50));return[(1&g)*f*255,(g>>1&1)*f*255,(g>>2&1)*f*255]},k.ansi256.rgb=function(y){if(y>=232){const g=10*(y-232)+8;return[g,g,g]}let g;y-=16;return[Math.floor(y/36)/5*255,Math.floor((g=y%36)/6)/5*255,g%6/5*255]},k.rgb.hex=function(y){const g=(((255&Math.round(y[0]))<<16)+((255&Math.round(y[1]))<<8)+(255&Math.round(y[2]))).toString(16).toUpperCase();return"000000".substring(g.length)+g},k.hex.rgb=function(y){const g=y.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!g)return[0,0,0];let f=g[0];3===g[0].length&&(f=f.split("").map((y=>y+y)).join(""));const p=parseInt(f,16);return[p>>16&255,p>>8&255,255&p]},k.rgb.hcg=function(y){const g=y[0]/255,f=y[1]/255,p=y[2]/255,S=Math.max(Math.max(g,f),p),k=Math.min(Math.min(g,f),p),i=S-k;let H,U;return H=i<1?k/(1-i):0,U=i<=0?0:S===g?(f-p)/i%6:S===f?2+(p-g)/i:4+(g-f)/i,U/=6,U%=1,[360*U,100*i,100*H]},k.hsl.hcg=function(y){const g=y[1]/100,f=y[2]/100,p=f<.5?2*g*f:2*g*(1-f);let S=0;return p<1&&(S=(f-.5*p)/(1-p)),[y[0],100*p,100*S]},k.hsv.hcg=function(y){const g=y[1]/100,f=y[2]/100,p=g*f;let S=0;return p<1&&(S=(f-p)/(1-p)),[y[0],100*p,100*S]},k.hcg.rgb=function(y){const g=y[0]/360,f=y[1]/100,p=y[2]/100;if(0===f)return[255*p,255*p,255*p];const S=[0,0,0],k=g%1*6,i=k%1,H=1-i;let U=0;switch(Math.floor(k)){case 0:S[0]=1,S[1]=i,S[2]=0;break;case 1:S[0]=H,S[1]=1,S[2]=0;break;case 2:S[0]=0,S[1]=1,S[2]=i;break;case 3:S[0]=0,S[1]=H,S[2]=1;break;case 4:S[0]=i,S[1]=0,S[2]=1;break;default:S[0]=1,S[1]=0,S[2]=H}return U=(1-f)*p,[255*(f*S[0]+U),255*(f*S[1]+U),255*(f*S[2]+U)]},k.hcg.hsv=function(y){const g=y[1]/100,f=g+y[2]/100*(1-g);let p=0;return f>0&&(p=g/f),[y[0],100*p,100*f]},k.hcg.hsl=function(y){const g=y[1]/100,f=y[2]/100*(1-g)+.5*g;let p=0;return f>0&&f<.5?p=g/(2*f):f>=.5&&f<1&&(p=g/(2*(1-f))),[y[0],100*p,100*f]},k.hcg.hwb=function(y){const g=y[1]/100,f=g+y[2]/100*(1-g);return[y[0],100*(f-g),100*(1-f)]},k.hwb.hcg=function(y){const g=y[1]/100,f=1-y[2]/100,p=f-g;let S=0;return p<1&&(S=(f-p)/(1-p)),[y[0],100*p,100*S]},k.apple.rgb=function(y){return[y[0]/65535*255,y[1]/65535*255,y[2]/65535*255]},k.rgb.apple=function(y){return[y[0]/255*65535,y[1]/255*65535,y[2]/255*65535]},k.gray.rgb=function(y){return[y[0]/100*255,y[0]/100*255,y[0]/100*255]},k.gray.hsl=function(y){return[0,0,y[0]]},k.gray.hsv=k.gray.hsl,k.gray.hwb=function(y){return[0,100,y[0]]},k.gray.cmyk=function(y){return[0,0,0,y[0]]},k.gray.lab=function(y){return[y[0],0,0]},k.gray.hex=function(y){const g=255&Math.round(y[0]/100*255),f=((g<<16)+(g<<8)+g).toString(16).toUpperCase();return"000000".substring(f.length)+f},k.rgb.gray=function(y){return[(y[0]+y[1]+y[2])/3/255*100]}},12719:(y,g,f)=>{const p=f(12725),S=f(12737),k={};Object.keys(p).forEach((y=>{k[y]={},Object.defineProperty(k[y],"channels",{value:p[y].channels}),Object.defineProperty(k[y],"labels",{value:p[y].labels});const g=S(y);Object.keys(g).forEach((f=>{const p=g[f];k[y][f]=function(y){const g=function(){for(var g=arguments.length,f=new Array(g),p=0;p<g;p++)f[p]=arguments[p];const S=f[0];if(void 0===S||null===S)return S;S.length>1&&(f=S);const k=y(f);if("object"===typeof k)for(let y=k.length,i=0;i<y;i++)k[i]=Math.round(k[i]);return k};return"conversion"in y&&(g.conversion=y.conversion),g}(p),k[y][f].raw=function(y){const g=function(){for(var g=arguments.length,f=new Array(g),p=0;p<g;p++)f[p]=arguments[p];const S=f[0];return void 0===S||null===S?S:(S.length>1&&(f=S),y(f))};return"conversion"in y&&(g.conversion=y.conversion),g}(p)}))})),y.exports=k},12737:(y,g,f)=>{const p=f(12725);function S(y){const g=function(){const y={},g=Object.keys(p);for(let f=g.length,p=0;p<f;p++)y[g[p]]={distance:-1,parent:null};return y}(),f=[y];for(g[y].distance=0;f.length;){const y=f.pop(),S=Object.keys(p[y]);for(let p=S.length,k=0;k<p;k++){const p=S[k],i=g[p];-1===i.distance&&(i.distance=g[y].distance+1,i.parent=y,f.unshift(p))}}return g}function k(y,g){return function(f){return g(y(f))}}function i(y,g){const f=[g[y].parent,y];let S=p[g[y].parent][y],i=g[y].parent;for(;g[i].parent;)f.unshift(g[i].parent),S=k(p[g[i].parent][i],S),i=g[i].parent;return S.conversion=f,S}y.exports=function(y){const g=S(y),f={},p=Object.keys(g);for(let S=p.length,k=0;k<S;k++){const y=p[k];null!==g[y].parent&&(f[y]=i(y,g))}return f}},12729:y=>{"use strict";y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10642:function(y,g,f){"use strict";var p=this&&this.__createBinding||(Object.create?function(y,g,f,p){void 0===p&&(p=f);var S=Object.getOwnPropertyDescriptor(g,f);S&&!("get"in S?!g.__esModule:S.writable||S.configurable)||(S={enumerable:!0,get:function(){return g[f]}}),Object.defineProperty(y,p,S)}:function(y,g,f,p){void 0===p&&(p=f),y[p]=g[f]}),S=this&&this.__setModuleDefault||(Object.create?function(y,g){Object.defineProperty(y,"default",{enumerable:!0,value:g})}:function(y,g){y.default=g}),k=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var g={};if(null!=y)for(var f in y)"default"!==f&&Object.prototype.hasOwnProperty.call(y,f)&&p(g,y,f);return S(g,y),g},i=this&&this.__awaiter||function(y,g,f,p){return new(f||(f=Promise))((function(S,k){function i(y){try{U(p.next(y))}catch(g){k(g)}}function H(y){try{U(p.throw(y))}catch(g){k(g)}}function U(y){var g;y.done?S(y.value):(g=y.value,g instanceof f?g:new f((function(y){y(g)}))).then(i,H)}U((p=p.apply(y,g||[])).next())}))};Object.defineProperty(g,"__esModule",{value:!0}),g.Auth=g.Platform=void 0;const H=k(f(10590)),U=f(10649),l="colyseus-auth-token";!function(y){y.ios="ios",y.android="android"}(g.Platform||(g.Platform={}));g.Auth=class{constructor(y){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=y.replace("ws","http"),(0,U.getItem)(l,(y=>this.token=y))}get hasToken(){return!!this.token}login(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,void 0,void 0,(function*(){const g=Object.assign({},y);this.hasToken&&(g.token=this.token);const f=yield this.request("post","/auth",g);this.token=f.token,(0,U.setItem)(l,this.token);for(let y in f)this.hasOwnProperty(y)&&(this[y]=f[y]);return this.registerPingService(),this}))}save(){return i(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return i(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return i(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return i(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(y){return i(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:y})}))}acceptFriendRequest(y){return i(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:y})}))}declineFriendRequest(y){return i(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:y})}))}blockUser(y){return i(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:y})}))}unblockUser(y){return i(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:y})}))}request(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return i(this,void 0,void 0,(function*(){S.Accept="application/json",this.hasToken&&(S.Authorization="Bearer "+this.token);const k=[];for(const y in f)k.push(`${y}=${f[y]}`);const i=k.length>0?`?${k.join("&")}`:"",U={headers:S};return p&&(U.body=p),(yield H[y](`${this.endpoint}${g}${i}`,U)).data}))}logout(){this.token=void 0,(0,U.removeItem)(l),this.unregisterPingService()}registerPingService(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),y)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10585:function(y,g,f){"use strict";var p,S=this&&this.__awaiter||function(y,g,f,p){return new(f||(f=Promise))((function(S,k){function i(y){try{U(p.next(y))}catch(g){k(g)}}function H(y){try{U(p.throw(y))}catch(g){k(g)}}function U(y){var g;y.done?S(y.value):(g=y.value,g instanceof f?g:new f((function(y){y(g)}))).then(i,H)}U((p=p.apply(y,g||[])).next())}))};Object.defineProperty(g,"__esModule",{value:!0}),g.Client=g.MatchMakeError=void 0;const k=f(10590),i=f(10593),H=f(10602);class U extends Error{constructor(y,g){super(y),this.code=g,Object.setPrototypeOf(this,U.prototype)}}g.MatchMakeError=U;const l="undefined"!==typeof window&&"undefined"!==typeof(null===(p=null===window||void 0===window?void 0:window.location)||void 0===p?void 0:p.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";g.Client=class{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;if("string"===typeof y){const g=new URL(y),f="https:"===g.protocol||"wss:"===g.protocol,p=Number(g.port||(f?443:80));this.settings={hostname:g.hostname,pathname:"/"!==g.pathname?g.pathname:"",port:p,secure:f}}else void 0===y.port&&(y.port=y.secure?443:80),void 0===y.pathname&&(y.pathname=""),this.settings=y}joinOrCreate(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",y,g,f)}))}create(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",y,g,f)}))}join(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",y,g,f)}))}joinById(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",y,g,f)}))}reconnect(y,g){return S(this,void 0,void 0,(function*(){if("string"===typeof y&&"string"===typeof g)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[f,p]=y.split(":");return yield this.createMatchMakeRequest("reconnect",f,{reconnectionToken:p},g)}))}getAvailableRooms(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return S(this,void 0,void 0,(function*(){return(yield(0,k.get)(this.getHttpEndpoint(`${y}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(y,g,f){return S(this,void 0,void 0,(function*(){const p=this.createRoom(y.room.name,g);p.roomId=y.room.roomId,p.sessionId=y.sessionId;const k={sessionId:p.sessionId};y.reconnectionToken&&(k.reconnectionToken=y.reconnectionToken);const H=f||p;return p.connect(this.buildEndpoint(y.room,k),y.devMode&&(()=>S(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${p.roomId}'...`);let f=0;const k=()=>S(this,void 0,void 0,(function*(){f++;try{yield this.consumeSeatReservation(y,g,H),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${p.roomId}'`)}catch(S){f<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${f} out of 8)`),setTimeout(k,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(k,2e3)}))),H),new Promise(((y,g)=>{const f=(y,f)=>g(new i.ServerError(y,f));H.onError.once(f),H.onJoin.once((()=>{H.onError.remove(f),y(H)}))}))}))}createMatchMakeRequest(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},p=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return S(this,void 0,void 0,(function*(){const S=(yield(0,k.post)(this.getHttpEndpoint(`${y}/${g}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(f)})).data;if(S.error)throw new U(S.error,S.code);return"reconnect"===y&&(S.reconnectionToken=f.reconnectionToken),yield this.consumeSeatReservation(S,p,i)}))}createRoom(y,g){return new H.Room(y,g)}buildEndpoint(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const f=[];for(const S in g)g.hasOwnProperty(S)&&f.push(`${S}=${g[S]}`);let p=this.settings.secure?"wss://":"ws://";return y.publicAddress?p+=`${y.publicAddress}`:p+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${p}/${y.processId}/${y.roomId}?${f.join("&")}`}getHttpEndpoint(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${y}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10613:(y,g,f)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.Connection=void 0;const p=f(10616);g.Connection=class{constructor(){this.events={},this.transport=new p.WebSocketTransport(this.events)}send(y){this.transport.send(y)}connect(y){this.transport.connect(y)}close(y,g){this.transport.close(y,g)}get isOpen(){return this.transport.isOpen}}},10626:(y,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.utf8Length=g.utf8Read=g.ErrorCode=g.Protocol=void 0,function(y){y[y.HANDSHAKE=9]="HANDSHAKE",y[y.JOIN_ROOM=10]="JOIN_ROOM",y[y.ERROR=11]="ERROR",y[y.LEAVE_ROOM=12]="LEAVE_ROOM",y[y.ROOM_DATA=13]="ROOM_DATA",y[y.ROOM_STATE=14]="ROOM_STATE",y[y.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",y[y.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",y[y.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(g.Protocol||(g.Protocol={})),function(y){y[y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",y[y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",y[y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",y[y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",y[y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",y[y.AUTH_FAILED=4215]="AUTH_FAILED",y[y.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(g.ErrorCode||(g.ErrorCode={})),g.utf8Read=function(y,g){const f=y[g++];for(var p="",S=0,k=g,i=g+f;k<i;k++){var H=y[k];if(0!==(128&H))if(192!==(224&H))if(224!==(240&H)){if(240!==(248&H))throw new Error("Invalid byte "+H.toString(16));(S=(7&H)<<18|(63&y[++k])<<12|(63&y[++k])<<6|63&y[++k])>=65536?(S-=65536,p+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):p+=String.fromCharCode(S)}else p+=String.fromCharCode((15&H)<<12|(63&y[++k])<<6|63&y[++k]);else p+=String.fromCharCode((31&H)<<6|63&y[++k]);else p+=String.fromCharCode(H)}return p},g.utf8Length=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",g=0,f=0;for(let p=0,S=y.length;p<S;p++)g=y.charCodeAt(p),g<128?f+=1:g<2048?f+=2:g<55296||g>=57344?f+=3:(p++,f+=4);return f+1}},10602:function(y,g,f){"use strict";var p=this&&this.__createBinding||(Object.create?function(y,g,f,p){void 0===p&&(p=f);var S=Object.getOwnPropertyDescriptor(g,f);S&&!("get"in S?!g.__esModule:S.writable||S.configurable)||(S={enumerable:!0,get:function(){return g[f]}}),Object.defineProperty(y,p,S)}:function(y,g,f,p){void 0===p&&(p=f),y[p]=g[f]}),S=this&&this.__setModuleDefault||(Object.create?function(y,g){Object.defineProperty(y,"default",{enumerable:!0,value:g})}:function(y,g){y.default=g}),k=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var g={};if(null!=y)for(var f in y)"default"!==f&&Object.prototype.hasOwnProperty.call(y,f)&&p(g,y,f);return S(g,y),g};Object.defineProperty(g,"__esModule",{value:!0}),g.Room=void 0;const i=k(f(10607)),H=f(10613),U=f(10626),l=f(10628),c=f(10632),Z=f(10637),C=f(10639),q=f(10593);class W{constructor(y,g){this.onStateChange=(0,Z.createSignal)(),this.onError=(0,Z.createSignal)(),this.onLeave=(0,Z.createSignal)(),this.onJoin=(0,Z.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,c.createNanoEvents)(),this.roomId=null,this.name=y,g&&(this.serializer=new((0,l.getSerializer)("schema")),this.rootSchema=g,this.serializer.state=new g),this.onError(((y,g)=>{var f;return null===(f=console.warn)||void 0===f?void 0:f.call(console,`colyseus.js - onError => (${y}) ${g}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const p=new H.Connection;f.connection=p,p.events.onmessage=W.prototype.onMessageCallback.bind(f),p.events.onclose=function(y){var p;if(!f.hasJoined)return null===(p=console.warn)||void 0===p||p.call(console,`Room connection was closed unexpectedly (${y.code}): ${y.reason}`),void f.onError.invoke(y.code,y.reason);y.code===q.CloseCode.DEVMODE_RESTART&&g?g():(f.onLeave.invoke(y.code),f.destroy())},p.events.onerror=function(y){var g;null===(g=console.warn)||void 0===g||g.call(console,`Room, onError (${y.code}): ${y.reason}`),f.onError.invoke(y.code,y.reason)},p.connect(y)}leave(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((g=>{this.onLeave((y=>g(y))),this.connection?y?this.connection.send([U.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(q.CloseCode.CONSENTED)}))}onMessage(y,g){return this.onMessageHandlers.on(this.getMessageHandlerKey(y),g)}send(y,g){const f=[U.Protocol.ROOM_DATA];let p;if("string"===typeof y?C.encode.string(f,y):C.encode.number(f,y),void 0!==g){const y=i.encode(g);p=new Uint8Array(f.length+y.byteLength),p.set(new Uint8Array(f),0),p.set(new Uint8Array(y),f.length)}else p=new Uint8Array(f);this.connection.send(p.buffer)}sendBytes(y,g){const f=[U.Protocol.ROOM_DATA_BYTES];let p;"string"===typeof y?C.encode.string(f,y):C.encode.number(f,y),p=new Uint8Array(f.length+(g.byteLength||g.length)),p.set(new Uint8Array(f),0),p.set(new Uint8Array(g),f.length),this.connection.send(p.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(y){const g=Array.from(new Uint8Array(y.data)),f=g[0];if(f===U.Protocol.JOIN_ROOM){let y=1;const f=(0,U.utf8Read)(g,y);if(y+=(0,U.utf8Length)(f),this.serializerId=(0,U.utf8Read)(g,y),y+=(0,U.utf8Length)(this.serializerId),!this.serializer){const y=(0,l.getSerializer)(this.serializerId);this.serializer=new y}g.length>y&&this.serializer.handshake&&this.serializer.handshake(g,{offset:y}),this.reconnectionToken=`${this.roomId}:${f}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([U.Protocol.JOIN_ROOM])}else if(f===U.Protocol.ERROR){const y={offset:1},f=C.decode.number(g,y),p=C.decode.string(g,y);this.onError.invoke(f,p)}else if(f===U.Protocol.LEAVE_ROOM)this.leave();else if(f===U.Protocol.ROOM_DATA_SCHEMA){const y={offset:1},f=this.serializer.getState().constructor._context.get(C.decode.number(g,y)),p=new f;p.decode(g,y),this.dispatchMessage(f,p)}else if(f===U.Protocol.ROOM_STATE)g.shift(),this.setState(g);else if(f===U.Protocol.ROOM_STATE_PATCH)g.shift(),this.patch(g);else if(f===U.Protocol.ROOM_DATA){const f={offset:1},p=C.decode.stringCheck(g,f)?C.decode.string(g,f):C.decode.number(g,f),S=g.length>f.offset?i.decode(y.data,f.offset):void 0;this.dispatchMessage(p,S)}else if(f===U.Protocol.ROOM_DATA_BYTES){const y={offset:1},f=C.decode.stringCheck(g,y)?C.decode.string(g,y):C.decode.number(g,y);this.dispatchMessage(f,new Uint8Array(g.slice(y.offset)))}}setState(y){this.serializer.setState(y),this.onStateChange.invoke(this.serializer.getState())}patch(y){this.serializer.patch(y),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(y,g){var f;const p=this.getMessageHandlerKey(y);this.onMessageHandlers.events[p]?this.onMessageHandlers.emit(p,g):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",y,g):null===(f=console.warn)||void 0===f||f.call(console,`colyseus.js: onMessage() not registered for type '${y}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(y){switch(typeof y){case"function":return`$${y._typeid}`;case"string":return y;case"number":return`i${y}`;default:throw new Error("invalid message type.")}}}g.Room=W},10649:(y,g)=>{"use strict";let f;function p(){return f||(f="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(y,g){this.cache[y]=g},getItem:function(y){this.cache[y]},removeItem:function(y){delete this.cache[y]}}),f}Object.defineProperty(g,"__esModule",{value:!0}),g.getItem=g.removeItem=g.setItem=void 0,g.setItem=function(y,g){p().setItem(y,g)},g.removeItem=function(y){p().removeItem(y)},g.getItem=function(y,g){const f=p().getItem(y);"undefined"!==typeof Promise&&f instanceof Promise?f.then((y=>g(y))):g(f)}},10632:(y,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.createNanoEvents=void 0;g.createNanoEvents=()=>({emit(y){let g=this.events[y]||[];for(var f=arguments.length,p=new Array(f>1?f-1:0),S=1;S<f;S++)p[S-1]=arguments[S];for(let k=0,i=g.length;k<i;k++)g[k](...p)},events:{},on(y,g){var f;return(null===(f=this.events[y])||void 0===f?void 0:f.push(g))||(this.events[y]=[g]),()=>{var f;this.events[y]=null===(f=this.events[y])||void 0===f?void 0:f.filter((y=>g!==y))}}})},10637:(y,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.createSignal=g.EventEmitter=void 0;class f{constructor(){this.handlers=[]}register(y){return this.handlers.push(y),this}invoke(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];this.handlers.forEach((y=>y.apply(this,g)))}invokeAsync(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];return Promise.all(this.handlers.map((y=>y.apply(this,g))))}remove(y){const g=this.handlers.indexOf(y);this.handlers[g]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}g.EventEmitter=f,g.createSignal=function(){const y=new f;function g(g){return y.register(g,null===this)}return g.once=g=>{const f=function(){for(var p=arguments.length,S=new Array(p),k=0;k<p;k++)S[k]=arguments[k];g.apply(this,S),y.remove(f)};y.register(f)},g.remove=g=>y.remove(g),g.invoke=function(){return y.invoke(...arguments)},g.invokeAsync=function(){return y.invokeAsync(...arguments)},g.clear=()=>y.clear(),g}},10593:(y,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.ServerError=g.CloseCode=void 0,function(y){y[y.CONSENTED=4e3]="CONSENTED",y[y.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(g.CloseCode||(g.CloseCode={}));class f extends Error{constructor(y,g){super(g),this.name="ServerError",this.code=y}}g.ServerError=f},10573:(y,g,f)=>{"use strict";g.b=void 0,f(10580);var p=f(10585);Object.defineProperty(g,"b",{enumerable:!0,get:function(){return p.Client}});var S=f(10626);var k=f(10602);var i=f(10642);const H=f(10654);const U=f(10656),l=f(10628);(0,l.registerSerializer)("schema",H.SchemaSerializer),(0,l.registerSerializer)("none",U.NoneSerializer)},10580:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=y=>null!==y&&"object"===typeof y&&y.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10607:(y,g)=>{"use strict";function f(y,g){if(this._offset=g,y instanceof ArrayBuffer)this._buffer=y,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(y))throw new Error("Invalid argument");this._buffer=y.buffer,this._view=new DataView(this._buffer,y.byteOffset,y.byteLength)}}Object.defineProperty(g,"__esModule",{value:!0}),g.decode=g.encode=void 0,f.prototype._array=function(y){for(var g=new Array(y),f=0;f<y;f++)g[f]=this._parse();return g},f.prototype._map=function(y){for(var g={},f=0;f<y;f++)g[this._parse()]=this._parse();return g},f.prototype._str=function(y){var g=function(y,g,f){for(var p="",S=0,k=g,i=g+f;k<i;k++){var H=y.getUint8(k);if(0!==(128&H))if(192!==(224&H))if(224!==(240&H)){if(240!==(248&H))throw new Error("Invalid byte "+H.toString(16));(S=(7&H)<<18|(63&y.getUint8(++k))<<12|(63&y.getUint8(++k))<<6|63&y.getUint8(++k))>=65536?(S-=65536,p+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):p+=String.fromCharCode(S)}else p+=String.fromCharCode((15&H)<<12|(63&y.getUint8(++k))<<6|63&y.getUint8(++k));else p+=String.fromCharCode((31&H)<<6|63&y.getUint8(++k));else p+=String.fromCharCode(H)}return p}(this._view,this._offset,y);return this._offset+=y,g},f.prototype._bin=function(y){var g=this._buffer.slice(this._offset,this._offset+y);return this._offset+=y,g},f.prototype._parse=function(){var y,g=this._view.getUint8(this._offset++),f=0,p=0,S=0,k=0;if(g<192)return g<128?g:g<144?this._map(15&g):g<160?this._array(15&g):this._str(31&g);if(g>223)return-1*(255-g+1);switch(g){case 192:return null;case 194:return!1;case 195:return!0;case 196:return f=this._view.getUint8(this._offset),this._offset+=1,this._bin(f);case 197:return f=this._view.getUint16(this._offset),this._offset+=2,this._bin(f);case 198:return f=this._view.getUint32(this._offset),this._offset+=4,this._bin(f);case 199:if(f=this._view.getUint8(this._offset),p=this._view.getInt8(this._offset+1),this._offset+=2,-1===p){var i=this._view.getUint32(this._offset);return S=this._view.getInt32(this._offset+4),k=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*S+k)+i/1e6)}return[p,this._bin(f)];case 200:return f=this._view.getUint16(this._offset),p=this._view.getInt8(this._offset+2),this._offset+=3,[p,this._bin(f)];case 201:return f=this._view.getUint32(this._offset),p=this._view.getInt8(this._offset+4),this._offset+=5,[p,this._bin(f)];case 202:return y=this._view.getFloat32(this._offset),this._offset+=4,y;case 203:return y=this._view.getFloat64(this._offset),this._offset+=8,y;case 204:return y=this._view.getUint8(this._offset),this._offset+=1,y;case 205:return y=this._view.getUint16(this._offset),this._offset+=2,y;case 206:return y=this._view.getUint32(this._offset),this._offset+=4,y;case 207:return S=this._view.getUint32(this._offset)*Math.pow(2,32),k=this._view.getUint32(this._offset+4),this._offset+=8,S+k;case 208:return y=this._view.getInt8(this._offset),this._offset+=1,y;case 209:return y=this._view.getInt16(this._offset),this._offset+=2,y;case 210:return y=this._view.getInt32(this._offset),this._offset+=4,y;case 211:return S=this._view.getInt32(this._offset)*Math.pow(2,32),k=this._view.getUint32(this._offset+4),this._offset+=8,S+k;case 212:return p=this._view.getInt8(this._offset),this._offset+=1,0===p?void(this._offset+=1):[p,this._bin(1)];case 213:return p=this._view.getInt8(this._offset),this._offset+=1,[p,this._bin(2)];case 214:return p=this._view.getInt8(this._offset),this._offset+=1,-1===p?(y=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*y)):[p,this._bin(4)];case 215:return p=this._view.getInt8(this._offset),this._offset+=1,0===p?(S=this._view.getInt32(this._offset)*Math.pow(2,32),k=this._view.getUint32(this._offset+4),this._offset+=8,new Date(S+k)):-1===p?(S=this._view.getUint32(this._offset),k=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&S)+k)+(S>>>2)/1e6)):[p,this._bin(8)];case 216:return p=this._view.getInt8(this._offset),this._offset+=1,[p,this._bin(16)];case 217:return f=this._view.getUint8(this._offset),this._offset+=1,this._str(f);case 218:return f=this._view.getUint16(this._offset),this._offset+=2,this._str(f);case 219:return f=this._view.getUint32(this._offset),this._offset+=4,this._str(f);case 220:return f=this._view.getUint16(this._offset),this._offset+=2,this._array(f);case 221:return f=this._view.getUint32(this._offset),this._offset+=4,this._array(f);case 222:return f=this._view.getUint16(this._offset),this._offset+=2,this._map(f);case 223:return f=this._view.getUint32(this._offset),this._offset+=4,this._map(f)}throw new Error("Could not parse")},g.decode=function(y){var g=new f(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),p=g._parse();if(g._offset!==y.byteLength)throw new Error(y.byteLength-g._offset+" trailing bytes");return p};function p(y,g,f){for(var p=0,S=0,k=f.length;S<k;S++)(p=f.charCodeAt(S))<128?y.setUint8(g++,p):p<2048?(y.setUint8(g++,192|p>>6),y.setUint8(g++,128|63&p)):p<55296||p>=57344?(y.setUint8(g++,224|p>>12),y.setUint8(g++,128|p>>6&63),y.setUint8(g++,128|63&p)):(S++,p=65536+((1023&p)<<10|1023&f.charCodeAt(S)),y.setUint8(g++,240|p>>18),y.setUint8(g++,128|p>>12&63),y.setUint8(g++,128|p>>6&63),y.setUint8(g++,128|63&p))}function S(y,g,f){var p=typeof f,k=0,i=0,H=0,U=0,l=0,c=0;if("string"===p){if(l=function(y){for(var g=0,f=0,p=0,S=y.length;p<S;p++)(g=y.charCodeAt(p))<128?f+=1:g<2048?f+=2:g<55296||g>=57344?f+=3:(p++,f+=4);return f}(f),l<32)y.push(160|l),c=1;else if(l<256)y.push(217,l),c=2;else if(l<65536)y.push(218,l>>8,l),c=3;else{if(!(l<4294967296))throw new Error("String too long");y.push(219,l>>24,l>>16,l>>8,l),c=5}return g.push({_str:f,_length:l,_offset:y.length}),c+l}if("number"===p)return Math.floor(f)===f&&isFinite(f)?f>=0?f<128?(y.push(f),1):f<256?(y.push(204,f),2):f<65536?(y.push(205,f>>8,f),3):f<4294967296?(y.push(206,f>>24,f>>16,f>>8,f),5):(H=f/Math.pow(2,32)|0,U=f>>>0,y.push(207,H>>24,H>>16,H>>8,H,U>>24,U>>16,U>>8,U),9):f>=-32?(y.push(f),1):f>=-128?(y.push(208,f),2):f>=-32768?(y.push(209,f>>8,f),3):f>=-2147483648?(y.push(210,f>>24,f>>16,f>>8,f),5):(H=Math.floor(f/Math.pow(2,32)),U=f>>>0,y.push(211,H>>24,H>>16,H>>8,H,U>>24,U>>16,U>>8,U),9):(y.push(203),g.push({_float:f,_length:8,_offset:y.length}),9);if("object"===p){if(null===f)return y.push(192),1;if(Array.isArray(f)){if((l=f.length)<16)y.push(144|l),c=1;else if(l<65536)y.push(220,l>>8,l),c=3;else{if(!(l<4294967296))throw new Error("Array too large");y.push(221,l>>24,l>>16,l>>8,l),c=5}for(k=0;k<l;k++)c+=S(y,g,f[k]);return c}if(f instanceof Date){var Z=f.getTime(),C=Math.floor(Z/1e3),q=1e6*(Z-1e3*C);return C>=0&&q>=0&&C<=17179869183?0===q&&C<=4294967295?(y.push(214,255,C>>24,C>>16,C>>8,C),6):(H=C/4294967296,U=4294967295&C,y.push(215,255,q>>22,q>>14,q>>6,H,U>>24,U>>16,U>>8,U),10):(H=Math.floor(C/4294967296),U=C>>>0,y.push(199,12,255,q>>24,q>>16,q>>8,q,H>>24,H>>16,H>>8,H,U>>24,U>>16,U>>8,U),15)}if(f instanceof ArrayBuffer){if((l=f.byteLength)<256)y.push(196,l),c=2;else if(l<65536)y.push(197,l>>8,l),c=3;else{if(!(l<4294967296))throw new Error("Buffer too large");y.push(198,l>>24,l>>16,l>>8,l),c=5}return g.push({_bin:f,_length:l,_offset:y.length}),c+l}if("function"===typeof f.toJSON)return S(y,g,f.toJSON());var W=[],j="",P=Object.keys(f);for(k=0,i=P.length;k<i;k++)void 0!==f[j=P[k]]&&"function"!==typeof f[j]&&W.push(j);if((l=W.length)<16)y.push(128|l),c=1;else if(l<65536)y.push(222,l>>8,l),c=3;else{if(!(l<4294967296))throw new Error("Object too large");y.push(223,l>>24,l>>16,l>>8,l),c=5}for(k=0;k<l;k++)c+=S(y,g,j=W[k]),c+=S(y,g,f[j]);return c}if("boolean"===p)return y.push(f?195:194),1;if("undefined"===p)return y.push(192),1;if("function"===typeof f.toJSON)return S(y,g,f.toJSON());throw new Error("Could not encode")}g.encode=function(y){var g=[],f=[],k=S(g,f,y),i=new ArrayBuffer(k),H=new DataView(i),U=0,l=0,c=-1;f.length>0&&(c=f[0]._offset);for(var Z,C=0,q=0,W=0,j=g.length;W<j;W++)if(H.setUint8(l+W,g[W]),W+1===c){if(C=(Z=f[U])._length,q=l+c,Z._bin)for(var P=new Uint8Array(Z._bin),B=0;B<C;B++)H.setUint8(q+B,P[B]);else Z._str?p(H,q,Z._str):void 0!==Z._float&&H.setFloat64(q,Z._float);l+=C,f[++U]&&(c=f[U]._offset)}return i}},10656:(y,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.NoneSerializer=void 0;g.NoneSerializer=class{setState(y){}getState(){return null}patch(y){}teardown(){}handshake(y){}}},10654:(y,g,f)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.SchemaSerializer=void 0;const p=f(10639);g.SchemaSerializer=class{setState(y){return this.state.decode(y)}getState(){return this.state}patch(y){return this.state.decode(y)}teardown(){var y,g;null===(g=null===(y=this.state)||void 0===y?void 0:y.$changes)||void 0===g||g.root.clearRefs()}handshake(y,g){if(this.state){(new p.Reflection).decode(y,g)}else this.state=p.Reflection.decode(y,g)}}},10628:(y,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.getSerializer=g.registerSerializer=void 0;const f={};g.registerSerializer=function(y,g){f[y]=g},g.getSerializer=function(y){const g=f[y];if(!g)throw new Error("missing serializer: "+y);return g}},10616:function(y,g,f){"use strict";var p=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(g,"__esModule",{value:!0}),g.WebSocketTransport=void 0;const S=p(f(10620)),k=globalThis.WebSocket||S.default;g.WebSocketTransport=class{constructor(y){this.events=y}send(y){y instanceof ArrayBuffer?this.ws.send(y):Array.isArray(y)&&this.ws.send(new Uint8Array(y).buffer)}connect(y){this.ws=new k(y,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(y,g){this.ws.close(y,g)}get isOpen(){return this.ws.readyState===k.OPEN}}},10620:y=>{"use strict";y.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},10697:y=>{"use strict";y.exports=function(y){for(var g=new Array(y),f=0;f<y;++f)g[f]=f;return g}},10703:y=>{function g(y){return!!y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}y.exports=function(y){return null!=y&&(g(y)||function(y){return"function"===typeof y.readFloatLE&&"function"===typeof y.slice&&g(y.slice(0,0))}(y)||!!y._isBuffer)}},10695:(y,g,f)=>{var p=f(10697),S=f(10703),k="undefined"!==typeof Float64Array;function i(y,g){return y[0]-g[0]}function H(){var y,g=this.stride,f=new Array(g.length);for(y=0;y<f.length;++y)f[y]=[Math.abs(g[y]),y];f.sort(i);var p=new Array(f.length);for(y=0;y<p.length;++y)p[y]=f[y][1];return p}function U(y,g){var f=["View",g,"d",y].join("");g<0&&(f="View_Nil"+y);var S="generic"===y;if(-1===g){var k="function "+f+"(a){this.data=a;};var proto="+f+".prototype;proto.dtype='"+y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+f+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+f+"(a){return new "+f+"(a);}";return new Function(k)()}if(0===g){k="function "+f+"(a,d) {this.data = a;this.offset = d};var proto="+f+".prototype;proto.dtype='"+y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+f+"_copy() {return new "+f+"(this.data,this.offset)};proto.pick=function "+f+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+f+"_get(){return "+(S?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+f+"_set(v){return "+(S?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+f+"(a,b,c,d){return new "+f+"(a,d)}";return new Function("TrivialArray",k)(l[y][0])}k=["'use strict'"];var i=p(g),U=i.map((function(y){return"i"+y})),c="this.offset+"+i.map((function(y){return"this.stride["+y+"]*i"+y})).join("+"),Z=i.map((function(y){return"b"+y})).join(","),C=i.map((function(y){return"c"+y})).join(",");k.push("function "+f+"(a,"+Z+","+C+",d){this.data=a","this.shape=["+Z+"]","this.stride=["+C+"]","this.offset=d|0}","var proto="+f+".prototype","proto.dtype='"+y+"'","proto.dimension="+g),k.push("Object.defineProperty(proto,'size',{get:function "+f+"_size(){return "+i.map((function(y){return"this.shape["+y+"]"})).join("*"),"}})"),1===g?k.push("proto.order=[0]"):(k.push("Object.defineProperty(proto,'order',{get:"),g<4?(k.push("function "+f+"_order(){"),2===g?k.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===g&&k.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):k.push("ORDER})")),k.push("proto.set=function "+f+"_set("+U.join(",")+",v){"),S?k.push("return this.data.set("+c+",v)}"):k.push("return this.data["+c+"]=v}"),k.push("proto.get=function "+f+"_get("+U.join(",")+"){"),S?k.push("return this.data.get("+c+")}"):k.push("return this.data["+c+"]}"),k.push("proto.index=function "+f+"_index(",U.join(),"){return "+c+"}"),k.push("proto.hi=function "+f+"_hi("+U.join(",")+"){return new "+f+"(this.data,"+i.map((function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")})).join(",")+","+i.map((function(y){return"this.stride["+y+"]"})).join(",")+",this.offset)}");var q=i.map((function(y){return"a"+y+"=this.shape["+y+"]"})),W=i.map((function(y){return"c"+y+"=this.stride["+y+"]"}));k.push("proto.lo=function "+f+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+q.join(",")+","+W.join(","));for(var j=0;j<g;++j)k.push("if(typeof i"+j+"==='number'&&i"+j+">=0){d=i"+j+"|0;b+=c"+j+"*d;a"+j+"-=d}");k.push("return new "+f+"(this.data,"+i.map((function(y){return"a"+y})).join(",")+","+i.map((function(y){return"c"+y})).join(",")+",b)}"),k.push("proto.step=function "+f+"_step("+U.join(",")+"){var "+i.map((function(y){return"a"+y+"=this.shape["+y+"]"})).join(",")+","+i.map((function(y){return"b"+y+"=this.stride["+y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(j=0;j<g;++j)k.push("if(typeof i"+j+"==='number'){d=i"+j+"|0;if(d<0){c+=b"+j+"*(a"+j+"-1);a"+j+"=ceil(-a"+j+"/d)}else{a"+j+"=ceil(a"+j+"/d)}b"+j+"*=d}");k.push("return new "+f+"(this.data,"+i.map((function(y){return"a"+y})).join(",")+","+i.map((function(y){return"b"+y})).join(",")+",c)}");var P=new Array(g),B=new Array(g);for(j=0;j<g;++j)P[j]="a[i"+j+"]",B[j]="b[i"+j+"]";k.push("proto.transpose=function "+f+"_transpose("+U+"){"+U.map((function(y,g){return y+"=("+y+"===undefined?"+g+":"+y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+f+"(this.data,"+P.join(",")+","+B.join(",")+",this.offset)}"),k.push("proto.pick=function "+f+"_pick("+U+"){var a=[],b=[],c=this.offset");for(j=0;j<g;++j)k.push("if(typeof i"+j+"==='number'&&i"+j+">=0){c=(c+this.stride["+j+"]*i"+j+")|0}else{a.push(this.shape["+j+"]);b.push(this.stride["+j+"])}");return k.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),k.push("return function construct_"+f+"(data,shape,stride,offset){return new "+f+"(data,"+i.map((function(y){return"shape["+y+"]"})).join(",")+","+i.map((function(y){return"stride["+y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",k.join("\n"))(l[y],H)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};y.exports=function(y,g,f,p){if(void 0===y)return(0,l.array[0])([]);"number"===typeof y&&(y=[y]),void 0===g&&(g=[y.length]);var i=g.length;if(void 0===f){f=new Array(i);for(var H=i-1,c=1;H>=0;--H)f[H]=c,c*=g[H]}if(void 0===p){p=0;for(H=0;H<i;++H)f[H]<0&&(p-=(g[H]-1)*f[H])}for(var Z=function(y){if(S(y))return"buffer";if(k)switch(Object.prototype.toString.call(y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(y)?"array":"generic"}(y),C=l[Z];C.length<=i+1;)C.push(U(Z,C.length-1));return(0,C[i+1])(y,g,f,p)}},10665:y=>{var g;self,g=()=>(()=>{"use strict";var y={d:(g,f)=>{for(var p in f)y.o(f,p)&&!y.o(g,p)&&Object.defineProperty(g,p,{enumerable:!0,get:f[p]})},o:(y,g)=>Object.prototype.hasOwnProperty.call(y,g)},g={};y.d(g,{default:()=>N});var f,p=function(y,g){var f=g.x-y.x,p=g.y-y.y;return Math.sqrt(f*f+p*p)},S=function(y){return y*(Math.PI/180)},k=new Map,i=function(y){k.has(y)&&clearTimeout(k.get(y)),k.set(y,setTimeout(y,100))},H=function(y,g,f){for(var p,S=g.split(/[ ,]+/g),k=0;k<S.length;k+=1)p=S[k],y.addEventListener?y.addEventListener(p,f,!1):y.attachEvent&&y.attachEvent(p,f)},U=function(y,g,f){for(var p,S=g.split(/[ ,]+/g),k=0;k<S.length;k+=1)p=S[k],y.removeEventListener?y.removeEventListener(p,f):y.detachEvent&&y.detachEvent(p,f)},l=function(y){return y.preventDefault(),y.type.match(/^touch/)?y.changedTouches:y},c=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Z=function(y,g){g.top||g.right||g.bottom||g.left?(y.style.top=g.top,y.style.right=g.right,y.style.bottom=g.bottom,y.style.left=g.left):(y.style.left=g.x+"px",y.style.top=g.y+"px")},C=function(y,g,f){var p=q(y);for(var S in p)if(p.hasOwnProperty(S))if("string"==typeof g)p[S]=g+" "+f;else{for(var k="",i=0,H=g.length;i<H;i+=1)k+=g[i]+" "+f+", ";p[S]=k.slice(0,-2)}return p},q=function(y){var g={};return g[y]="",["webkit","Moz","o"].forEach((function(f){g[f+y.charAt(0).toUpperCase()+y.slice(1)]=""})),g},W=function(y,g){for(var f in g)g.hasOwnProperty(f)&&(y[f]=g[f]);return y},j=function(y,g){if(y.length)for(var f=0,p=y.length;f<p;f+=1)g(y[f]);else g(y)},P="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,R=!!("ontouchstart"in window),G=!!window.PointerEvent,z=!!window.MSPointerEvent,T={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},Q={start:"mousedown",move:"mousemove",end:"mouseup"},m={};function a(){}P&&!B?f=T:G?f={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:z?f={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:R?(f=T,m=Q):f=Q,a.prototype.on=function(y,g){var f,p=this,S=y.split(/[ ,]+/g);p._handlers_=p._handlers_||{};for(var k=0;k<S.length;k+=1)f=S[k],p._handlers_[f]=p._handlers_[f]||[],p._handlers_[f].push(g);return p},a.prototype.off=function(y,g){var f=this;return f._handlers_=f._handlers_||{},void 0===y?f._handlers_={}:void 0===g?f._handlers_[y]=null:f._handlers_[y]&&f._handlers_[y].indexOf(g)>=0&&f._handlers_[y].splice(f._handlers_[y].indexOf(g),1),f},a.prototype.trigger=function(y,g){var f,p=this,S=y.split(/[ ,]+/g);p._handlers_=p._handlers_||{};for(var k=0;k<S.length;k+=1)f=S[k],p._handlers_[f]&&p._handlers_[f].length&&p._handlers_[f].forEach((function(y){y.call(p,{type:f,target:p},g)}))},a.prototype.config=function(y){var g=this;g.options=g.defaults||{},y&&(g.options=function(y,g){var f={};for(var p in y)y.hasOwnProperty(p)&&g.hasOwnProperty(p)?f[p]=g[p]:y.hasOwnProperty(p)&&(f[p]=y[p]);return f}(g.options,y))},a.prototype.bindEvt=function(y,g){var p=this;return p._domHandlers_=p._domHandlers_||{},p._domHandlers_[g]=function(){"function"==typeof p["on"+g]?p["on"+g].apply(p,arguments):console.warn('[WARNING] : Missing "on'+g+'" handler.')},H(y,f[g],p._domHandlers_[g]),m[g]&&H(y,m[g],p._domHandlers_[g]),p},a.prototype.unbindEvt=function(y,g){var p=this;return p._domHandlers_=p._domHandlers_||{},U(y,f[g],p._domHandlers_[g]),m[g]&&U(y,m[g],p._domHandlers_[g]),delete p._domHandlers_[g],this};const w=a;function o(y,g){return this.identifier=g.identifier,this.position=g.position,this.frontPosition=g.frontPosition,this.collection=y,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(g),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=o.id,o.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}o.prototype=new w,o.constructor=o,o.id=0,o.prototype.buildEl=function(y){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},o.prototype.stylize=function(){if(this.options.dataOnly)return this;var y=this.options.fadeTime+"ms",g=function(){var y=q("borderRadius");for(var g in y)y.hasOwnProperty(g)&&(y[g]="50%");return y}(),f=C("transition","opacity",y),p={};return p.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},p.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},p.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},W(p.el,f),"circle"===this.options.shape&&W(p.back,g),W(p.front,g),this.applyStyles(p),this},o.prototype.applyStyles=function(y){for(var g in this.ui)if(this.ui.hasOwnProperty(g))for(var f in y[g])this.ui[g].style[f]=y[g][f];return this},o.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},o.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},o.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},o.prototype.show=function(y){var g=this;return g.options.dataOnly||(clearTimeout(g.removeTimeout),clearTimeout(g.showTimeout),clearTimeout(g.restTimeout),g.addToDom(),g.restCallback(),setTimeout((function(){g.ui.el.style.opacity=1}),0),g.showTimeout=setTimeout((function(){g.trigger("shown",g.instance),"function"==typeof y&&y.call(this)}),g.options.fadeTime)),g},o.prototype.hide=function(y){var g=this;if(g.options.dataOnly)return g;if(g.ui.el.style.opacity=g.options.restOpacity,clearTimeout(g.removeTimeout),clearTimeout(g.showTimeout),clearTimeout(g.restTimeout),g.removeTimeout=setTimeout((function(){var f="dynamic"===g.options.mode?"none":"block";g.ui.el.style.display=f,"function"==typeof y&&y.call(g),g.trigger("hidden",g.instance)}),g.options.fadeTime),g.options.restJoystick){var f=g.options.restJoystick,p={};p.x=!0===f||!1!==f.x?0:g.instance.frontPosition.x,p.y=!0===f||!1!==f.y?0:g.instance.frontPosition.y,g.setPosition(y,p)}return g},o.prototype.setPosition=function(y,g){var f=this;f.frontPosition={x:g.x,y:g.y};var p=f.options.fadeTime+"ms",S={};S.front=C("transition",["transform"],p);var k={front:{}};k.front={transform:"translate("+f.frontPosition.x+"px,"+f.frontPosition.y+"px)"},f.applyStyles(S),f.applyStyles(k),f.restTimeout=setTimeout((function(){"function"==typeof y&&y.call(f),f.restCallback()}),f.options.fadeTime)},o.prototype.restCallback=function(){var y=this,g={};g.front=C("transition","none",""),y.applyStyles(g),y.trigger("rested",y.instance)},o.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},o.prototype.computeDirection=function(y){var g,f,p,S=y.angle.radian,k=Math.PI/4,i=Math.PI/2;if(S>k&&S<3*k&&!y.lockX?g="up":S>-k&&S<=k&&!y.lockY?g="left":S>3*-k&&S<=-k&&!y.lockX?g="down":y.lockY||(g="right"),y.lockY||(f=S>-i&&S<i?"left":"right"),y.lockX||(p=S>0?"up":"down"),y.force>this.options.threshold){var H,U={};for(H in this.direction)this.direction.hasOwnProperty(H)&&(U[H]=this.direction[H]);var l={};for(H in this.direction={x:f,y:p,angle:g},y.direction=this.direction,U)U[H]===this.direction[H]&&(l[H]=!0);if(l.x&&l.y&&l.angle)return y;l.x&&l.y||this.trigger("plain",y),l.x||this.trigger("plain:"+f,y),l.y||this.trigger("plain:"+p,y),l.angle||this.trigger("dir dir:"+g,y)}else this.resetDirection();return y};const I=o;function Y(y,g){var f=this;f.nipples=[],f.idles=[],f.actives=[],f.ids=[],f.pressureIntervals={},f.manager=y,f.id=Y.id,Y.id+=1,f.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},f.config(g),"static"!==f.options.mode&&"semi"!==f.options.mode||(f.options.multitouch=!1),f.options.multitouch||(f.options.maxNumberOfNipples=1);var p=getComputedStyle(f.options.zone.parentElement);return p&&"flex"===p.display&&(f.parentIsFlex=!0),f.updateBox(),f.prepareNipples(),f.Bj(),f.begin(),f.nipples}Y.prototype=new w,Y.constructor=Y,Y.id=0,Y.prototype.prepareNipples=function(){var y=this,g=y.nipples;g.on=y.on.bind(y),g.off=y.off.bind(y),g.options=y.options,g.destroy=y.destroy.bind(y),g.ids=y.ids,g.id=y.id,g.processOnMove=y.processOnMove.bind(y),g.processOnEnd=y.processOnEnd.bind(y),g.get=function(y){if(void 0===y)return g[0];for(var f=0,p=g.length;f<p;f+=1)if(g[f].identifier===y)return g[f];return!1}},Y.prototype.Bj=function(){var y=this;y.bindEvt(y.options.zone,"start"),y.options.zone.style.touchAction="none",y.options.zone.style.msTouchAction="none"},Y.prototype.begin=function(){var y=this,g=y.options;if("static"===g.mode){var f=y.createNipple(g.position,y.manager.getIdentifier());f.add(),y.idles.push(f)}},Y.prototype.createNipple=function(y,g){var f=this,p=f.manager.scroll,S={},k=f.options,i=f.parentIsFlex?p.x:p.x+f.box.left,H=f.parentIsFlex?p.y:p.y+f.box.top;if(y.x&&y.y)S={x:y.x-i,y:y.y-H};else if(y.top||y.right||y.bottom||y.left){var U=document.createElement("DIV");U.style.display="hidden",U.style.top=y.top,U.style.right=y.right,U.style.bottom=y.bottom,U.style.left=y.left,U.style.position="absolute",k.zone.appendChild(U);var l=U.getBoundingClientRect();k.zone.removeChild(U),S=y,y={x:l.left+p.x,y:l.top+p.y}}var c=new I(f,{color:k.color,size:k.size,threshold:k.threshold,fadeTime:k.fadeTime,dataOnly:k.dataOnly,restJoystick:k.restJoystick,restOpacity:k.restOpacity,mode:k.mode,identifier:g,position:y,zone:k.zone,frontPosition:{x:0,y:0},shape:k.shape});return k.dataOnly||(Z(c.ui.el,S),Z(c.ui.front,c.frontPosition)),f.nipples.push(c),f.trigger("added "+c.identifier+":added",c),f.manager.trigger("added "+c.identifier+":added",c),f.bindNipple(c),c},Y.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Y.prototype.bindNipple=function(y){var g,f=this,p=function(y,p){g=y.type+" "+p.id+":"+y.type,f.trigger(g,p)};y.on("destroyed",f.onDestroyed.bind(f)),y.on("shown hidden rested dir plain",p),y.on("dir:up dir:right dir:down dir:left",p),y.on("plain:up plain:right plain:down plain:left",p)},Y.prototype.pressureFn=function(y,g,f){var p=this,S=0;clearInterval(p.pressureIntervals[f]),p.pressureIntervals[f]=setInterval(function(){var f=y.force||y.pressure||y.webkitForce||0;f!==S&&(g.trigger("pressure",f),p.trigger("pressure "+g.identifier+":pressure",f),S=f)}.bind(p),100)},Y.prototype.onstart=function(y){var g=this,f=g.options,p=y;return y=l(y),g.updateBox(),j(y,(function(S){g.actives.length<f.maxNumberOfNipples?g.processOnStart(S):p.type.match(/^touch/)&&(Object.keys(g.manager.ids).forEach((function(f){if(Object.values(p.touches).findIndex((function(y){return y.identifier===f}))<0){var S=[y[0]];S.identifier=f,g.processOnEnd(S)}})),g.actives.length<f.maxNumberOfNipples&&g.processOnStart(S))})),g.manager.bindDocument(),!1},Y.prototype.processOnStart=function(y){var g,f=this,S=f.options,k=f.manager.getIdentifier(y),i=y.force||y.pressure||y.webkitForce||0,H={x:y.pageX,y:y.pageY},U=f.getOrCreate(k,H);U.identifier!==k&&f.manager.removeIdentifier(U.identifier),U.identifier=k;var l=function(g){g.trigger("start",g),f.trigger("start "+g.id+":start",g),g.show(),i>0&&f.pressureFn(y,g,g.identifier),f.processOnMove(y)};if((g=f.idles.indexOf(U))>=0&&f.idles.splice(g,1),f.actives.push(U),f.ids.push(U.identifier),"semi"!==S.mode)l(U);else{if(!(p(H,U.position)<=S.catchDistance))return U.destroy(),void f.processOnStart(y);l(U)}return U},Y.prototype.getOrCreate=function(y,g){var f,p=this,S=p.options;return/(semi|static)/.test(S.mode)?(f=p.idles[0])?(p.idles.splice(0,1),f):"semi"===S.mode?p.createNipple(g,y):(console.warn("Coudln't find the needed nipple."),!1):f=p.createNipple(g,y)},Y.prototype.processOnMove=function(y){var g=this,f=g.options,k=g.manager.getIdentifier(y),i=g.nipples.get(k),H=g.manager.scroll;if(function(y){return isNaN(y.buttons)?0!==y.pressure:0!==y.buttons}(y)){if(!i)return console.error("Found zombie joystick with ID "+k),void g.manager.removeIdentifier(k);if(f.dynamicPage){var U=i.el.getBoundingClientRect();i.position={x:H.x+U.left,y:H.y+U.top}}i.identifier=k;var l=i.options.size/2,c={x:y.pageX,y:y.pageY};f.lockX&&(c.y=i.position.y),f.lockY&&(c.x=i.position.x);var Z,C,q,W,j,P,B,R,G,z,T=p(c,i.position),Q=(Z=c,q=(C=i.position).x-Z.x,W=C.y-Z.y,function(y){return y*(180/Math.PI)}(Math.atan2(W,q))),m=S(Q),a=T/l,w={distance:T,position:c};if("circle"===i.options.shape?(j=Math.min(T,l),B=i.position,R=j,z={x:0,y:0},G=S(G=Q),z.x=B.x-R*Math.cos(G),z.y=B.y-R*Math.sin(G),P=z):(P=function(y,g,f){return{x:Math.min(Math.max(y.x,g.x-f),g.x+f),y:Math.min(Math.max(y.y,g.y-f),g.y+f)}}(c,i.position,l),j=p(P,i.position)),f.follow){if(T>l){var o=c.x-P.x,I=c.y-P.y;i.position.x+=o,i.position.y+=I,i.el.style.top=i.position.y-(g.box.top+H.y)+"px",i.el.style.left=i.position.x-(g.box.left+H.x)+"px",T=p(c,i.position)}}else c=P,T=j;var Y=c.x-i.position.x,n=c.y-i.position.y;i.frontPosition={x:Y,y:n},f.dataOnly||(i.ui.front.style.transform="translate("+Y+"px,"+n+"px)");var M={identifier:i.identifier,position:c,force:a,pressure:y.force||y.pressure||y.webkitForce||0,distance:T,angle:{radian:m,degree:Q},vector:{x:Y/l,y:-n/l},raw:w,instance:i,lockX:f.lockX,lockY:f.lockY};(M=i.computeDirection(M)).angle={radian:S(180-Q),degree:180-Q},i.trigger("move",M),g.trigger("move "+i.id+":move",M)}else this.processOnEnd(y)},Y.prototype.processOnEnd=function(y){var g=this,f=g.options,p=g.manager.getIdentifier(y),S=g.nipples.get(p),k=g.manager.removeIdentifier(S.identifier);S&&(f.dataOnly||S.hide((function(){"dynamic"===f.mode&&(S.trigger("removed",S),g.trigger("removed "+S.id+":removed",S),g.manager.trigger("removed "+S.id+":removed",S),S.destroy())})),clearInterval(g.pressureIntervals[S.identifier]),S.resetDirection(),S.trigger("end",S),g.trigger("end "+S.id+":end",S),g.ids.indexOf(S.identifier)>=0&&g.ids.splice(g.ids.indexOf(S.identifier),1),g.actives.indexOf(S)>=0&&g.actives.splice(g.actives.indexOf(S),1),/(semi|static)/.test(f.mode)?g.idles.push(S):g.nipples.indexOf(S)>=0&&g.nipples.splice(g.nipples.indexOf(S),1),g.manager.unbindDocument(),/(semi|static)/.test(f.mode)&&(g.manager.ids[k.id]=k.identifier))},Y.prototype.onDestroyed=function(y,g){var f=this;f.nipples.indexOf(g)>=0&&f.nipples.splice(f.nipples.indexOf(g),1),f.actives.indexOf(g)>=0&&f.actives.splice(f.actives.indexOf(g),1),f.idles.indexOf(g)>=0&&f.idles.splice(f.idles.indexOf(g),1),f.ids.indexOf(g.identifier)>=0&&f.ids.splice(f.ids.indexOf(g.identifier),1),f.manager.removeIdentifier(g.identifier),f.manager.unbindDocument()},Y.prototype.destroy=function(){var y=this;for(var g in y.unbindEvt(y.options.zone,"start"),y.nipples.forEach((function(y){y.destroy()})),y.pressureIntervals)y.pressureIntervals.hasOwnProperty(g)&&clearInterval(y.pressureIntervals[g]);y.trigger("destroyed",y.nipples),y.manager.unbindDocument(),y.off()};const n=Y;function M(y){var g=this;g.ids={},g.index=0,g.collections=[],g.scroll=c(),g.config(y),g.prepareCollections();var f=function(){var y;g.collections.forEach((function(f){f.forEach((function(f){y=f.el.getBoundingClientRect(),f.position={x:g.scroll.x+y.left,y:g.scroll.y+y.top}}))}))};H(window,"resize",(function(){i(f)}));var p=function(){g.scroll=c()};return H(window,"scroll",(function(){i(p)})),g.collections}M.prototype=new w,M.constructor=M,M.prototype.prepareCollections=function(){var y=this;y.collections.create=y.create.bind(y),y.collections.on=y.on.bind(y),y.collections.off=y.off.bind(y),y.collections.destroy=y.destroy.bind(y),y.collections.get=function(g){var f;return y.collections.every((function(y){return!(f=y.get(g))})),f}},M.prototype.create=function(y){return this.createCollection(y)},M.prototype.createCollection=function(y){var g=this,f=new n(g,y);return g.bindCollection(f),g.collections.push(f),f},M.prototype.bindCollection=function(y){var g,f=this,p=function(y,p){g=y.type+" "+p.id+":"+y.type,f.trigger(g,p)};y.on("destroyed",f.onDestroyed.bind(f)),y.on("shown hidden rested dir plain",p),y.on("dir:up dir:right dir:down dir:left",p),y.on("plain:up plain:right plain:down plain:left",p)},M.prototype.bindDocument=function(){var y=this;y.binded||(y.bindEvt(document,"move").bindEvt(document,"end"),y.binded=!0)},M.prototype.unbindDocument=function(y){var g=this;Object.keys(g.ids).length&&!0!==y||(g.unbindEvt(document,"move").unbindEvt(document,"end"),g.binded=!1)},M.prototype.getIdentifier=function(y){var g;return y?void 0===(g=void 0===y.identifier?y.pointerId:y.identifier)&&(g=this.latest||0):g=this.index,void 0===this.ids[g]&&(this.ids[g]=this.index,this.index+=1),this.latest=g,this.ids[g]},M.prototype.removeIdentifier=function(y){var g={};for(var f in this.ids)if(this.ids[f]===y){g.id=f,g.identifier=this.ids[f],delete this.ids[f];break}return g},M.prototype.onmove=function(y){return this.onAny("move",y),!1},M.prototype.onend=function(y){return this.onAny("end",y),!1},M.prototype.oncancel=function(y){return this.onAny("end",y),!1},M.prototype.onAny=function(y,g){var f,p=this,S="processOn"+y.charAt(0).toUpperCase()+y.slice(1);g=l(g);var k=function(y,g,f){f.ids.indexOf(g)>=0&&(f[S](y),y._found_=!0)};return j(g,(function(y){f=p.getIdentifier(y),j(p.collections,k.bind(null,y,f)),y._found_||p.removeIdentifier(f)})),!1},M.prototype.destroy=function(){var y=this;y.unbindDocument(!0),y.ids={},y.index=0,y.collections.forEach((function(y){y.destroy()})),y.off()},M.prototype.onDestroyed=function(y,g){var f=this;if(f.collections.indexOf(g)<0)return!1;f.collections.splice(f.collections.indexOf(g),1)};var r=new M;const N={create:function(y){return r.create(y)},factory:r};return g.default})(),y.exports=g()},10896:(y,g,f)=>{"use strict";const{Deflate:p,deflate:S,deflateRaw:k,gzip:i}=f(10902),{Inflate:H,inflate:U,inflateRaw:l,ungzip:c}=f(10958),Z=f(10934);y.exports.Deflate=p,y.exports.deflate=S,y.exports.deflateRaw=k,y.exports.gzip=i,y.exports.Inflate=H,y.exports.inflate=U,y.exports.inflateRaw=l,y.exports.ungzip=c,y.exports.constants=Z},10902:(y,g,f)=>{"use strict";const p=f(10907),S=f(10940),k=f(10949),i=f(10929),H=f(10952),U=Object.prototype.toString,{Z_NO_FLUSH:l,Z_SYNC_FLUSH:c,Z_FULL_FLUSH:Z,Z_FINISH:C,Z_OK:q,Z_STREAM_END:W,Z_DEFAULT_COMPRESSION:j,Z_DEFAULT_STRATEGY:P,Z_DEFLATED:B}=f(10934);function R(y){this.options=S.assign({level:j,method:B,Ja:16384,windowBits:15,memLevel:8,strategy:P},y||{});let g=this.options;g.raw&&g.windowBits>0?g.windowBits=-g.windowBits:g.gzip&&g.windowBits>0&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;let f=p.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(f!==q)throw new Error(i[f]);if(g.header&&p.deflateSetHeader(this.strm,g.header),g.dictionary){let y;if(y="string"===typeof g.dictionary?k.string2buf(g.dictionary):"[object ArrayBuffer]"===U.call(g.dictionary)?new Uint8Array(g.dictionary):g.dictionary,f=p.deflateSetDictionary(this.strm,y),f!==q)throw new Error(i[f]);this._dict_set=!0}}function G(y,g){const f=new R(g);if(f.push(y,!0),f.err)throw f.msg||i[f.err];return f.result}R.prototype.push=function(y,g){const f=this.strm,S=this.options.Ja;let i,H;if(this.ended)return!1;for(H=g===~~g?g:!0===g?C:l,"string"===typeof y?f.input=k.string2buf(y):"[object ArrayBuffer]"===U.call(y)?f.input=new Uint8Array(y):f.input=y,f.next_in=0,f.avail_in=f.input.length;;)if(0===f.avail_out&&(f.output=new Uint8Array(S),f.next_out=0,f.avail_out=S),(H===c||H===Z)&&f.avail_out<=6)this.onData(f.output.subarray(0,f.next_out)),f.avail_out=0;else{if(i=p.deflate(f,H),i===W)return f.next_out>0&&this.onData(f.output.subarray(0,f.next_out)),i=p.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===q;if(0!==f.avail_out){if(H>0&&f.next_out>0)this.onData(f.output.subarray(0,f.next_out)),f.avail_out=0;else if(0===f.avail_in)break}else this.onData(f.output)}return!0},R.prototype.onData=function(y){this.chunks.push(y)},R.prototype.onEnd=function(y){y===q&&(this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},y.exports.Deflate=R,y.exports.deflate=G,y.exports.deflateRaw=function(y,g){return(g=g||{}).raw=!0,G(y,g)},y.exports.gzip=function(y,g){return(g=g||{}).gzip=!0,G(y,g)},y.exports.constants=f(10934)},10958:(y,g,f)=>{"use strict";const p=f(10960),S=f(10940),k=f(10949),i=f(10929),H=f(10952),U=f(10973),l=Object.prototype.toString,{Z_NO_FLUSH:c,Z_FINISH:Z,Z_OK:C,Z_STREAM_END:q,Z_NEED_DICT:W,Z_STREAM_ERROR:j,Z_DATA_ERROR:P,Z_MEM_ERROR:B}=f(10934);function R(y){this.options=S.assign({Ja:65536,windowBits:15,to:""},y||{});const g=this.options;g.raw&&g.windowBits>=0&&g.windowBits<16&&(g.windowBits=-g.windowBits,0===g.windowBits&&(g.windowBits=-15)),!(g.windowBits>=0&&g.windowBits<16)||y&&y.windowBits||(g.windowBits+=32),g.windowBits>15&&g.windowBits<48&&0===(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;let f=p.inflateInit2(this.strm,g.windowBits);if(f!==C)throw new Error(i[f]);if(this.header=new U,p.inflateGetHeader(this.strm,this.header),g.dictionary&&("string"===typeof g.dictionary?g.dictionary=k.string2buf(g.dictionary):"[object ArrayBuffer]"===l.call(g.dictionary)&&(g.dictionary=new Uint8Array(g.dictionary)),g.raw&&(f=p.inflateSetDictionary(this.strm,g.dictionary),f!==C)))throw new Error(i[f])}function G(y,g){const f=new R(g);if(f.push(y),f.err)throw f.msg||i[f.err];return f.result}R.prototype.push=function(y,g){const f=this.strm,S=this.options.Ja,i=this.options.dictionary;let H,U,R;if(this.ended)return!1;for(U=g===~~g?g:!0===g?Z:c,"[object ArrayBuffer]"===l.call(y)?f.input=new Uint8Array(y):f.input=y,f.next_in=0,f.avail_in=f.input.length;;){for(0===f.avail_out&&(f.output=new Uint8Array(S),f.next_out=0,f.avail_out=S),H=p.inflate(f,U),H===W&&i&&(H=p.inflateSetDictionary(f,i),H===C?H=p.inflate(f,U):H===P&&(H=W));f.avail_in>0&&H===q&&f.state.wrap>0&&0!==y[f.next_in];)p.inflateReset(f),H=p.inflate(f,U);switch(H){case j:case P:case W:case B:return this.onEnd(H),this.ended=!0,!1}if(R=f.avail_out,f.next_out&&(0===f.avail_out||H===q))if("string"===this.options.to){let y=k.utf8border(f.output,f.next_out),g=f.next_out-y,p=k.buf2string(f.output,y);f.next_out=g,f.avail_out=S-g,g&&f.output.set(f.output.subarray(y,y+g),0),this.onData(p)}else this.onData(f.output.length===f.next_out?f.output:f.output.subarray(0,f.next_out));if(H!==C||0!==R){if(H===q)return H=p.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,!0;if(0===f.avail_in)break}}return!0},R.prototype.onData=function(y){this.chunks.push(y)},R.prototype.onEnd=function(y){y===C&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},y.exports.Inflate=R,y.exports.inflate=G,y.exports.inflateRaw=function(y,g){return(g=g||{}).raw=!0,G(y,g)},y.exports.ungzip=G,y.exports.constants=f(10934)},10940:y=>{"use strict";const g=(y,g)=>Object.prototype.hasOwnProperty.call(y,g);y.exports.assign=function(y){const f=Array.prototype.slice.call(arguments,1);for(;f.length;){const p=f.shift();if(p){if("object"!==typeof p)throw new TypeError(p+"must be non-object");for(const f in p)g(p,f)&&(y[f]=p[f])}}return y},y.exports.flattenChunks=y=>{let g=0;for(let p=0,S=y.length;p<S;p++)g+=y[p].length;const f=new Uint8Array(g);for(let p=0,S=0,k=y.length;p<k;p++){let g=y[p];f.set(g,S),S+=g.length}return f}},10949:y=>{"use strict";let g=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(p){g=!1}const f=new Uint8Array(256);for(let S=0;S<256;S++)f[S]=S>=252?6:S>=248?5:S>=240?4:S>=224?3:S>=192?2:1;f[254]=f[254]=1,y.exports.string2buf=y=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(y);let g,f,p,S,k,i=y.length,H=0;for(S=0;S<i;S++)f=y.charCodeAt(S),55296===(64512&f)&&S+1<i&&(p=y.charCodeAt(S+1),56320===(64512&p)&&(f=65536+(f-55296<<10)+(p-56320),S++)),H+=f<128?1:f<2048?2:f<65536?3:4;for(g=new Uint8Array(H),k=0,S=0;k<H;S++)f=y.charCodeAt(S),55296===(64512&f)&&S+1<i&&(p=y.charCodeAt(S+1),56320===(64512&p)&&(f=65536+(f-55296<<10)+(p-56320),S++)),f<128?g[k++]=f:f<2048?(g[k++]=192|f>>>6,g[k++]=128|63&f):f<65536?(g[k++]=224|f>>>12,g[k++]=128|f>>>6&63,g[k++]=128|63&f):(g[k++]=240|f>>>18,g[k++]=128|f>>>12&63,g[k++]=128|f>>>6&63,g[k++]=128|63&f);return g};y.exports.buf2string=(y,p)=>{const S=p||y.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(y.subarray(0,p));let k,i;const H=new Array(2*S);for(i=0,k=0;k<S;){let g=y[k++];if(g<128){H[i++]=g;continue}let p=f[g];if(p>4)H[i++]=65533,k+=p-1;else{for(g&=2===p?31:3===p?15:7;p>1&&k<S;)g=g<<6|63&y[k++],p--;p>1?H[i++]=65533:g<65536?H[i++]=g:(g-=65536,H[i++]=55296|g>>10&1023,H[i++]=56320|1023&g)}}return((y,f)=>{if(f<65534&&y.subarray&&g)return String.fromCharCode.apply(null,y.length===f?y:y.subarray(0,f));let p="";for(let g=0;g<f;g++)p+=String.fromCharCode(y[g]);return p})(H,i)},y.exports.utf8border=(y,g)=>{(g=g||y.length)>y.length&&(g=y.length);let p=g-1;for(;p>=0&&128===(192&y[p]);)p--;return p<0||0===p?g:p+f[y[p]]>g?p:g}},10921:y=>{"use strict";y.exports=(y,g,f,p)=>{let S=65535&y,k=y>>>16&65535,i=0;for(;0!==f;){i=f>2e3?2e3:f,f-=i;do{S=S+g[p++]|0,k=k+S|0}while(--i);S%=65521,k%=65521}return S|k<<16}},10934:y=>{"use strict";y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10924:y=>{"use strict";const g=new Uint32Array((()=>{let y,g=[];for(var f=0;f<256;f++){y=f;for(var p=0;p<8;p++)y=1&y?3988292384^y>>>1:y>>>1;g[f]=y}return g})());y.exports=(y,f,p,S)=>{const k=g,i=S+p;y^=-1;for(let g=S;g<i;g++)y=y>>>8^k[255&(y^f[g])];return~y}},10907:(y,g,f)=>{"use strict";const{_tr_init:p,_tr_stored_block:S,_tr_flush_block:k,_tr_tally:i,_tr_align:H}=f(10913),U=f(10921),l=f(10924),c=f(10929),{Z_NO_FLUSH:Z,Z_PARTIAL_FLUSH:C,Z_FULL_FLUSH:q,Z_FINISH:W,Z_BLOCK:j,Z_OK:P,Z_STREAM_END:B,Z_STREAM_ERROR:R,Z_DATA_ERROR:G,Z_BUF_ERROR:z,Z_DEFAULT_COMPRESSION:T,Z_FILTERED:Q,Z_HUFFMAN_ONLY:m,Z_RLE:a,Z_FIXED:w,Z_DEFAULT_STRATEGY:o,Z_UNKNOWN:I,Z_DEFLATED:Y}=f(10934),n=258,M=262,r=103,N=113,b=666,s=(y,g)=>(y.msg=c[g],g),u=y=>(y<<1)-(y>4?9:0),F=y=>{let g=y.length;for(;--g>=0;)y[g]=0};let A=(y,g,f)=>(g<<y.hash_shift^f)&y.hash_mask;const J=y=>{const g=y.state;let f=g.pending;f>y.avail_out&&(f=y.avail_out),0!==f&&(y.output.set(g.pending_buf.subarray(g.pending_out,g.pending_out+f),y.next_out),y.next_out+=f,g.pending_out+=f,y.total_out+=f,y.avail_out-=f,g.pending-=f,0===g.pending&&(g.pending_out=0))},V=(y,g)=>{k(y,y.block_start>=0?y.block_start:-1,y.strstart-y.block_start,g),y.block_start=y.strstart,J(y.strm)},e=(y,g)=>{y.pending_buf[y.pending++]=g},h=(y,g)=>{y.pending_buf[y.pending++]=g>>>8&255,y.pending_buf[y.pending++]=255&g},D=(y,g,f,p)=>{let S=y.avail_in;return S>p&&(S=p),0===S?0:(y.avail_in-=S,g.set(y.input.subarray(y.next_in,y.next_in+S),f),1===y.state.wrap?y.adler=U(y.adler,g,S,f):2===y.state.wrap&&(y.adler=l(y.adler,g,S,f)),y.next_in+=S,y.total_in+=S,S)},K=(y,g)=>{let f,p,S=y.max_chain_length,k=y.strstart,i=y.prev_length,H=y.nice_match;const U=y.strstart>y.w_size-M?y.strstart-(y.w_size-M):0,l=y.window,c=y.w_mask,Z=y.prev,C=y.strstart+n;let q=l[k+i-1],W=l[k+i];y.prev_length>=y.good_match&&(S>>=2),H>y.lookahead&&(H=y.lookahead);do{if(f=g,l[f+i]===W&&l[f+i-1]===q&&l[f]===l[k]&&l[++f]===l[k+1]){k+=2,f++;do{}while(l[++k]===l[++f]&&l[++k]===l[++f]&&l[++k]===l[++f]&&l[++k]===l[++f]&&l[++k]===l[++f]&&l[++k]===l[++f]&&l[++k]===l[++f]&&l[++k]===l[++f]&&k<C);if(p=n-(C-k),k=C-n,p>i){if(y.match_start=g,i=p,p>=H)break;q=l[k+i-1],W=l[k+i]}}}while((g=Z[g&c])>U&&0!==--S);return i<=y.lookahead?i:y.lookahead},X=y=>{const g=y.w_size;let f,p,S,k,i;do{if(k=y.window_size-y.lookahead-y.strstart,y.strstart>=g+(g-M)){y.window.set(y.window.subarray(g,g+g),0),y.match_start-=g,y.strstart-=g,y.block_start-=g,p=y.hash_size,f=p;do{S=y.head[--f],y.head[f]=S>=g?S-g:0}while(--p);p=g,f=p;do{S=y.prev[--f],y.prev[f]=S>=g?S-g:0}while(--p);k+=g}if(0===y.strm.avail_in)break;if(p=D(y.strm,y.window,y.strstart+y.lookahead,k),y.lookahead+=p,y.lookahead+y.insert>=3)for(i=y.strstart-y.insert,y.ins_h=y.window[i],y.ins_h=A(y,y.ins_h,y.window[i+1]);y.insert&&(y.ins_h=A(y,y.ins_h,y.window[i+3-1]),y.prev[i&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=i,i++,y.insert--,!(y.lookahead+y.insert<3)););}while(y.lookahead<M&&0!==y.strm.avail_in)},E=(y,g)=>{let f,p;for(;;){if(y.lookahead<M){if(X(y),y.lookahead<M&&g===Z)return 1;if(0===y.lookahead)break}if(f=0,y.lookahead>=3&&(y.ins_h=A(y,y.ins_h,y.window[y.strstart+3-1]),f=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),0!==f&&y.strstart-f<=y.w_size-M&&(y.match_length=K(y,f)),y.match_length>=3)if(p=i(y,y.strstart-y.match_start,y.match_length-3),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=3){y.match_length--;do{y.strstart++,y.ins_h=A(y,y.ins_h,y.window[y.strstart+3-1]),f=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart}while(0!==--y.match_length);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=A(y,y.ins_h,y.window[y.strstart+1]);else p=i(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(p&&(V(y,!1),0===y.strm.avail_out))return 1}return y.insert=y.strstart<2?y.strstart:2,g===W?(V(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(V(y,!1),0===y.strm.avail_out)?1:2},O=(y,g)=>{let f,p,S;for(;;){if(y.lookahead<M){if(X(y),y.lookahead<M&&g===Z)return 1;if(0===y.lookahead)break}if(f=0,y.lookahead>=3&&(y.ins_h=A(y,y.ins_h,y.window[y.strstart+3-1]),f=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=2,0!==f&&y.prev_length<y.max_lazy_match&&y.strstart-f<=y.w_size-M&&(y.match_length=K(y,f),y.match_length<=5&&(y.strategy===Q||3===y.match_length&&y.strstart-y.match_start>4096)&&(y.match_length=2)),y.prev_length>=3&&y.match_length<=y.prev_length){S=y.strstart+y.lookahead-3,p=i(y,y.strstart-1-y.prev_match,y.prev_length-3),y.lookahead-=y.prev_length-1,y.prev_length-=2;do{++y.strstart<=S&&(y.ins_h=A(y,y.ins_h,y.window[y.strstart+3-1]),f=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart)}while(0!==--y.prev_length);if(y.match_available=0,y.match_length=2,y.strstart++,p&&(V(y,!1),0===y.strm.avail_out))return 1}else if(y.match_available){if(p=i(y,0,y.window[y.strstart-1]),p&&V(y,!1),y.strstart++,y.lookahead--,0===y.strm.avail_out)return 1}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(p=i(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<2?y.strstart:2,g===W?(V(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(V(y,!1),0===y.strm.avail_out)?1:2};function L(y,g,f,p,S){this.good_length=y,this.max_lazy=g,this.nice_length=f,this.max_chain=p,this.func=S}const x=[new L(0,0,0,0,((y,g)=>{let f=65535;for(f>y.pending_buf_size-5&&(f=y.pending_buf_size-5);;){if(y.lookahead<=1){if(X(y),0===y.lookahead&&g===Z)return 1;if(0===y.lookahead)break}y.strstart+=y.lookahead,y.lookahead=0;const p=y.block_start+f;if((0===y.strstart||y.strstart>=p)&&(y.lookahead=y.strstart-p,y.strstart=p,V(y,!1),0===y.strm.avail_out))return 1;if(y.strstart-y.block_start>=y.w_size-M&&(V(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,g===W?(V(y,!0),0===y.strm.avail_out?3:4):(y.strstart>y.block_start&&(V(y,!1),y.strm.avail_out),1)})),new L(4,4,8,4,E),new L(4,5,16,8,E),new L(4,6,32,32,E),new L(4,4,16,16,O),new L(8,16,32,32,O),new L(8,16,128,128,O),new L(8,32,128,256,O),new L(32,128,258,1024,O),new L(32,258,258,4096,O)];function d(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),F(this.dyn_ltree),F(this.dyn_dtree),F(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),F(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),F(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const t=y=>{if(!y||!y.state)return s(y,R);y.total_in=y.total_out=0,y.data_type=I;const g=y.state;return g.pending=0,g.pending_out=0,g.wrap<0&&(g.wrap=-g.wrap),g.status=g.wrap?42:N,y.adler=2===g.wrap?0:1,g.last_flush=Z,p(g),P},v=y=>{const g=t(y);var f;return g===P&&((f=y.state).window_size=2*f.w_size,F(f.head),f.max_lazy_match=x[f.level].max_lazy,f.good_match=x[f.level].good_length,f.nice_match=x[f.level].nice_length,f.max_chain_length=x[f.level].max_chain,f.strstart=0,f.block_start=0,f.lookahead=0,f.insert=0,f.match_length=f.prev_length=2,f.match_available=0,f.ins_h=0),g},yy=(y,g,f,p,S,k)=>{if(!y)return R;let i=1;if(g===T&&(g=6),p<0?(i=0,p=-p):p>15&&(i=2,p-=16),S<1||S>9||f!==Y||p<8||p>15||g<0||g>9||k<0||k>w)return s(y,R);8===p&&(p=9);const H=new d;return y.state=H,H.strm=y,H.wrap=i,H.gzhead=null,H.w_bits=p,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=S+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+3-1)/3),H.window=new Uint8Array(2*H.w_size),H.head=new Uint16Array(H.hash_size),H.prev=new Uint16Array(H.w_size),H.lit_bufsize=1<<S+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new Uint8Array(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=g,H.strategy=k,H.method=f,v(y)};y.exports.deflateInit=(y,g)=>yy(y,g,Y,15,8,o),y.exports.deflateInit2=yy,y.exports.deflateReset=v,y.exports.deflateResetKeep=t,y.exports.deflateSetHeader=(y,g)=>y&&y.state?2!==y.state.wrap?R:(y.state.gzhead=g,P):R,y.exports.deflate=(y,g)=>{let f,p;if(!y||!y.state||g>j||g<0)return y?s(y,R):R;const k=y.state;if(!y.output||!y.input&&0!==y.avail_in||k.status===b&&g!==W)return s(y,0===y.avail_out?z:R);k.strm=y;const U=k.last_flush;if(k.last_flush=g,42===k.status)if(2===k.wrap)y.adler=0,e(k,31),e(k,139),e(k,8),k.gzhead?(e(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),e(k,255&k.gzhead.time),e(k,k.gzhead.time>>8&255),e(k,k.gzhead.time>>16&255),e(k,k.gzhead.time>>24&255),e(k,9===k.level?2:k.strategy>=m||k.level<2?4:0),e(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(e(k,255&k.gzhead.extra.length),e(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(y.adler=l(y.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(e(k,0),e(k,0),e(k,0),e(k,0),e(k,0),e(k,9===k.level?2:k.strategy>=m||k.level<2?4:0),e(k,3),k.status=N);else{let g=Y+(k.w_bits-8<<4)<<8,f=-1;f=k.strategy>=m||k.level<2?0:k.level<6?1:6===k.level?2:3,g|=f<<6,0!==k.strstart&&(g|=32),g+=31-g%31,k.status=N,h(k,g),0!==k.strstart&&(h(k,y.adler>>>16),h(k,65535&y.adler)),y.adler=1}if(69===k.status)if(k.gzhead.extra){for(f=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>f&&(y.adler=l(y.adler,k.pending_buf,k.pending-f,f)),J(y),f=k.pending,k.pending!==k.pending_buf_size));)e(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>f&&(y.adler=l(y.adler,k.pending_buf,k.pending-f,f)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(73===k.status)if(k.gzhead.name){f=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>f&&(y.adler=l(y.adler,k.pending_buf,k.pending-f,f)),J(y),f=k.pending,k.pending===k.pending_buf_size)){p=1;break}p=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,e(k,p)}while(0!==p);k.gzhead.hcrc&&k.pending>f&&(y.adler=l(y.adler,k.pending_buf,k.pending-f,f)),0===p&&(k.gzindex=0,k.status=91)}else k.status=91;if(91===k.status)if(k.gzhead.comment){f=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>f&&(y.adler=l(y.adler,k.pending_buf,k.pending-f,f)),J(y),f=k.pending,k.pending===k.pending_buf_size)){p=1;break}p=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,e(k,p)}while(0!==p);k.gzhead.hcrc&&k.pending>f&&(y.adler=l(y.adler,k.pending_buf,k.pending-f,f)),0===p&&(k.status=r)}else k.status=r;if(k.status===r&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&J(y),k.pending+2<=k.pending_buf_size&&(e(k,255&y.adler),e(k,y.adler>>8&255),y.adler=0,k.status=N)):k.status=N),0!==k.pending){if(J(y),0===y.avail_out)return k.last_flush=-1,P}else if(0===y.avail_in&&u(g)<=u(U)&&g!==W)return s(y,z);if(k.status===b&&0!==y.avail_in)return s(y,z);if(0!==y.avail_in||0!==k.lookahead||g!==Z&&k.status!==b){let f=k.strategy===m?((y,g)=>{let f;for(;;){if(0===y.lookahead&&(X(y),0===y.lookahead)){if(g===Z)return 1;break}if(y.match_length=0,f=i(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++,f&&(V(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,g===W?(V(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(V(y,!1),0===y.strm.avail_out)?1:2})(k,g):k.strategy===a?((y,g)=>{let f,p,S,k;const H=y.window;for(;;){if(y.lookahead<=n){if(X(y),y.lookahead<=n&&g===Z)return 1;if(0===y.lookahead)break}if(y.match_length=0,y.lookahead>=3&&y.strstart>0&&(S=y.strstart-1,p=H[S],p===H[++S]&&p===H[++S]&&p===H[++S])){k=y.strstart+n;do{}while(p===H[++S]&&p===H[++S]&&p===H[++S]&&p===H[++S]&&p===H[++S]&&p===H[++S]&&p===H[++S]&&p===H[++S]&&S<k);y.match_length=n-(k-S),y.match_length>y.lookahead&&(y.match_length=y.lookahead)}if(y.match_length>=3?(f=i(y,1,y.match_length-3),y.lookahead-=y.match_length,y.strstart+=y.match_length,y.match_length=0):(f=i(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++),f&&(V(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,g===W?(V(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(V(y,!1),0===y.strm.avail_out)?1:2})(k,g):x[k.level].func(k,g);if(3!==f&&4!==f||(k.status=b),1===f||3===f)return 0===y.avail_out&&(k.last_flush=-1),P;if(2===f&&(g===C?H(k):g!==j&&(S(k,0,0,!1),g===q&&(F(k.head),0===k.lookahead&&(k.strstart=0,k.block_start=0,k.insert=0))),J(y),0===y.avail_out))return k.last_flush=-1,P}return g!==W?P:k.wrap<=0?B:(2===k.wrap?(e(k,255&y.adler),e(k,y.adler>>8&255),e(k,y.adler>>16&255),e(k,y.adler>>24&255),e(k,255&y.total_in),e(k,y.total_in>>8&255),e(k,y.total_in>>16&255),e(k,y.total_in>>24&255)):(h(k,y.adler>>>16),h(k,65535&y.adler)),J(y),k.wrap>0&&(k.wrap=-k.wrap),0!==k.pending?P:B)},y.exports.deflateEnd=y=>{if(!y||!y.state)return R;const g=y.state.status;return 42!==g&&69!==g&&73!==g&&91!==g&&g!==r&&g!==N&&g!==b?s(y,R):(y.state=null,g===N?s(y,G):P)},y.exports.deflateSetDictionary=(y,g)=>{let f=g.length;if(!y||!y.state)return R;const p=y.state,S=p.wrap;if(2===S||1===S&&42!==p.status||p.lookahead)return R;if(1===S&&(y.adler=U(y.adler,g,f,0)),p.wrap=0,f>=p.w_size){0===S&&(F(p.head),p.strstart=0,p.block_start=0,p.insert=0);let y=new Uint8Array(p.w_size);y.set(g.subarray(f-p.w_size,f),0),g=y,f=p.w_size}const k=y.avail_in,i=y.next_in,H=y.input;for(y.avail_in=f,y.next_in=0,y.input=g,X(p);p.lookahead>=3;){let y=p.strstart,g=p.lookahead-2;do{p.ins_h=A(p,p.ins_h,p.window[y+3-1]),p.prev[y&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=y,y++}while(--g);p.strstart=y,p.lookahead=2,X(p)}return p.strstart+=p.lookahead,p.block_start=p.strstart,p.insert=p.lookahead,p.lookahead=0,p.match_length=p.prev_length=2,p.match_available=0,y.next_in=i,y.input=H,y.avail_in=k,p.wrap=S,P},y.exports.deflateInfo="pako deflate (from Nodeca project)"},10973:y=>{"use strict";y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},10969:y=>{"use strict";y.exports=function(y,g){let f,p,S,k,i,H,U,l,c,Z,C,q,W,j,P,B,R,G,z,T,Q,m,a,w;const o=y.state;f=y.next_in,a=y.input,p=f+(y.avail_in-5),S=y.next_out,w=y.output,k=S-(g-y.avail_out),i=S+(y.avail_out-257),H=o.dmax,U=o.wsize,l=o.whave,c=o.wnext,Z=o.window,C=o.hold,q=o.bits,W=o.lencode,j=o.distcode,P=(1<<o.lenbits)-1,B=(1<<o.distbits)-1;y:do{q<15&&(C+=a[f++]<<q,q+=8,C+=a[f++]<<q,q+=8),R=W[C&P];g:for(;;){if(G=R>>>24,C>>>=G,q-=G,G=R>>>16&255,0===G)w[S++]=65535&R;else{if(!(16&G)){if(0===(64&G)){R=W[(65535&R)+(C&(1<<G)-1)];continue g}if(32&G){o.mode=12;break y}y.msg="invalid literal/length code",o.mode=30;break y}z=65535&R,G&=15,G&&(q<G&&(C+=a[f++]<<q,q+=8),z+=C&(1<<G)-1,C>>>=G,q-=G),q<15&&(C+=a[f++]<<q,q+=8,C+=a[f++]<<q,q+=8),R=j[C&B];f:for(;;){if(G=R>>>24,C>>>=G,q-=G,G=R>>>16&255,!(16&G)){if(0===(64&G)){R=j[(65535&R)+(C&(1<<G)-1)];continue f}y.msg="invalid distance code",o.mode=30;break y}if(T=65535&R,G&=15,q<G&&(C+=a[f++]<<q,q+=8,q<G&&(C+=a[f++]<<q,q+=8)),T+=C&(1<<G)-1,T>H){y.msg="invalid distance too far back",o.mode=30;break y}if(C>>>=G,q-=G,G=S-k,T>G){if(G=T-G,G>l&&o.sane){y.msg="invalid distance too far back",o.mode=30;break y}if(Q=0,m=Z,0===c){if(Q+=U-G,G<z){z-=G;do{w[S++]=Z[Q++]}while(--G);Q=S-T,m=w}}else if(c<G){if(Q+=U+c-G,G-=c,G<z){z-=G;do{w[S++]=Z[Q++]}while(--G);if(Q=0,c<z){G=c,z-=G;do{w[S++]=Z[Q++]}while(--G);Q=S-T,m=w}}}else if(Q+=c-G,G<z){z-=G;do{w[S++]=Z[Q++]}while(--G);Q=S-T,m=w}for(;z>2;)w[S++]=m[Q++],w[S++]=m[Q++],w[S++]=m[Q++],z-=3;z&&(w[S++]=m[Q++],z>1&&(w[S++]=m[Q++]))}else{Q=S-T;do{w[S++]=w[Q++],w[S++]=w[Q++],w[S++]=w[Q++],z-=3}while(z>2);z&&(w[S++]=w[Q++],z>1&&(w[S++]=w[Q++]))}break}}break}}while(f<p&&S<i);z=q>>3,f-=z,q-=z<<3,C&=(1<<q)-1,y.next_in=f,y.next_out=S,y.avail_in=f<p?p-f+5:5-(f-p),y.avail_out=S<i?i-S+257:257-(S-i),o.hold=C,o.bits=q}},10960:(y,g,f)=>{"use strict";const p=f(10921),S=f(10924),k=f(10969),i=f(10971),{Z_FINISH:H,Z_BLOCK:U,Z_TREES:l,Z_OK:c,Z_STREAM_END:Z,Z_NEED_DICT:C,Z_STREAM_ERROR:q,Z_DATA_ERROR:W,Z_MEM_ERROR:j,Z_BUF_ERROR:P,Z_DEFLATED:B}=f(10934),R=12,G=30,z=y=>(y>>>24&255)+(y>>>8&65280)+((65280&y)<<8)+((255&y)<<24);function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Q=y=>{if(!y||!y.state)return q;const g=y.state;return y.total_in=y.total_out=g.total=0,y.msg="",g.wrap&&(y.adler=1&g.wrap),g.mode=1,g.last=0,g.havedict=0,g.dmax=32768,g.head=null,g.hold=0,g.bits=0,g.lencode=g.lendyn=new Int32Array(852),g.distcode=g.distdyn=new Int32Array(592),g.sane=1,g.back=-1,c},m=y=>{if(!y||!y.state)return q;const g=y.state;return g.wsize=0,g.whave=0,g.wnext=0,Q(y)},a=(y,g)=>{let f;if(!y||!y.state)return q;const p=y.state;return g<0?(f=0,g=-g):(f=1+(g>>4),g<48&&(g&=15)),g&&(g<8||g>15)?q:(null!==p.window&&p.wbits!==g&&(p.window=null),p.wrap=f,p.wbits=g,m(y))},w=(y,g)=>{if(!y)return q;const f=new T;y.state=f,f.window=null;const p=a(y,g);return p!==c&&(y.state=null),p};let o,I,Y=!0;const n=y=>{if(Y){o=new Int32Array(512),I=new Int32Array(32);let g=0;for(;g<144;)y.lens[g++]=8;for(;g<256;)y.lens[g++]=9;for(;g<280;)y.lens[g++]=7;for(;g<288;)y.lens[g++]=8;for(i(1,y.lens,0,288,o,0,y.work,{bits:9}),g=0;g<32;)y.lens[g++]=5;i(2,y.lens,0,32,I,0,y.work,{bits:5}),Y=!1}y.lencode=o,y.lenbits=9,y.distcode=I,y.distbits=5},M=(y,g,f,p)=>{let S;const k=y.state;return null===k.window&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new Uint8Array(k.wsize)),p>=k.wsize?(k.window.set(g.subarray(f-k.wsize,f),0),k.wnext=0,k.whave=k.wsize):(S=k.wsize-k.wnext,S>p&&(S=p),k.window.set(g.subarray(f-p,f-p+S),k.wnext),(p-=S)?(k.window.set(g.subarray(f-p,f),0),k.wnext=p,k.whave=k.wsize):(k.wnext+=S,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=S))),0};y.exports.inflateReset=m,y.exports.inflateReset2=a,y.exports.inflateResetKeep=Q,y.exports.inflateInit=y=>w(y,15),y.exports.inflateInit2=w,y.exports.inflate=(y,g)=>{let f,T,Q,m,a,w,o,I,Y,r,N,b,s,u,F,A,J,V,e,h,D,K,X=0;const E=new Uint8Array(4);let O,L;const x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!y||!y.state||!y.output||!y.input&&0!==y.avail_in)return q;f=y.state,f.mode===R&&(f.mode=13),a=y.next_out,Q=y.output,o=y.avail_out,m=y.next_in,T=y.input,w=y.avail_in,I=f.hold,Y=f.bits,r=w,N=o,K=c;y:for(;;)switch(f.mode){case 1:if(0===f.wrap){f.mode=13;break}for(;Y<16;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(2&f.wrap&&35615===I){f.check=0,E[0]=255&I,E[1]=I>>>8&255,f.check=S(f.check,E,2,0),I=0,Y=0,f.mode=2;break}if(f.flags=0,f.head&&(f.head.done=!1),!(1&f.wrap)||(((255&I)<<8)+(I>>8))%31){y.msg="incorrect header check",f.mode=G;break}if((15&I)!==B){y.msg="unknown compression method",f.mode=G;break}if(I>>>=4,Y-=4,D=8+(15&I),0===f.wbits)f.wbits=D;else if(D>f.wbits){y.msg="invalid window size",f.mode=G;break}f.dmax=1<<f.wbits,y.adler=f.check=1,f.mode=512&I?10:R,I=0,Y=0;break;case 2:for(;Y<16;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(f.flags=I,(255&f.flags)!==B){y.msg="unknown compression method",f.mode=G;break}if(57344&f.flags){y.msg="unknown header flags set",f.mode=G;break}f.head&&(f.head.text=I>>8&1),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,f.check=S(f.check,E,2,0)),I=0,Y=0,f.mode=3;case 3:for(;Y<32;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}f.head&&(f.head.time=I),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,E[2]=I>>>16&255,E[3]=I>>>24&255,f.check=S(f.check,E,4,0)),I=0,Y=0,f.mode=4;case 4:for(;Y<16;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}f.head&&(f.head.xflags=255&I,f.head.os=I>>8),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,f.check=S(f.check,E,2,0)),I=0,Y=0,f.mode=5;case 5:if(1024&f.flags){for(;Y<16;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}f.length=I,f.head&&(f.head.extra_len=I),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,f.check=S(f.check,E,2,0)),I=0,Y=0}else f.head&&(f.head.extra=null);f.mode=6;case 6:if(1024&f.flags&&(b=f.length,b>w&&(b=w),b&&(f.head&&(D=f.head.extra_len-f.length,f.head.extra||(f.head.extra=new Uint8Array(f.head.extra_len)),f.head.extra.set(T.subarray(m,m+b),D)),512&f.flags&&(f.check=S(f.check,T,b,m)),w-=b,m+=b,f.length-=b),f.length))break y;f.length=0,f.mode=7;case 7:if(2048&f.flags){if(0===w)break y;b=0;do{D=T[m+b++],f.head&&D&&f.length<65536&&(f.head.name+=String.fromCharCode(D))}while(D&&b<w);if(512&f.flags&&(f.check=S(f.check,T,b,m)),w-=b,m+=b,D)break y}else f.head&&(f.head.name=null);f.length=0,f.mode=8;case 8:if(4096&f.flags){if(0===w)break y;b=0;do{D=T[m+b++],f.head&&D&&f.length<65536&&(f.head.comment+=String.fromCharCode(D))}while(D&&b<w);if(512&f.flags&&(f.check=S(f.check,T,b,m)),w-=b,m+=b,D)break y}else f.head&&(f.head.comment=null);f.mode=9;case 9:if(512&f.flags){for(;Y<16;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(I!==(65535&f.check)){y.msg="header crc mismatch",f.mode=G;break}I=0,Y=0}f.head&&(f.head.hcrc=f.flags>>9&1,f.head.done=!0),y.adler=f.check=0,f.mode=R;break;case 10:for(;Y<32;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}y.adler=f.check=z(I),I=0,Y=0,f.mode=11;case 11:if(0===f.havedict)return y.next_out=a,y.avail_out=o,y.next_in=m,y.avail_in=w,f.hold=I,f.bits=Y,C;y.adler=f.check=1,f.mode=R;case R:if(g===U||g===l)break y;case 13:if(f.last){I>>>=7&Y,Y-=7&Y,f.mode=27;break}for(;Y<3;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}switch(f.last=1&I,I>>>=1,Y-=1,3&I){case 0:f.mode=14;break;case 1:if(n(f),f.mode=20,g===l){I>>>=2,Y-=2;break y}break;case 2:f.mode=17;break;case 3:y.msg="invalid block type",f.mode=G}I>>>=2,Y-=2;break;case 14:for(I>>>=7&Y,Y-=7&Y;Y<32;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if((65535&I)!==(I>>>16^65535)){y.msg="invalid stored block lengths",f.mode=G;break}if(f.length=65535&I,I=0,Y=0,f.mode=15,g===l)break y;case 15:f.mode=16;case 16:if(b=f.length,b){if(b>w&&(b=w),b>o&&(b=o),0===b)break y;Q.set(T.subarray(m,m+b),a),w-=b,m+=b,o-=b,a+=b,f.length-=b;break}f.mode=R;break;case 17:for(;Y<14;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(f.nlen=257+(31&I),I>>>=5,Y-=5,f.ndist=1+(31&I),I>>>=5,Y-=5,f.ncode=4+(15&I),I>>>=4,Y-=4,f.nlen>286||f.ndist>30){y.msg="too many length or distance symbols",f.mode=G;break}f.have=0,f.mode=18;case 18:for(;f.have<f.ncode;){for(;Y<3;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}f.lens[x[f.have++]]=7&I,I>>>=3,Y-=3}for(;f.have<19;)f.lens[x[f.have++]]=0;if(f.lencode=f.lendyn,f.lenbits=7,O={bits:f.lenbits},K=i(0,f.lens,0,19,f.lencode,0,f.work,O),f.lenbits=O.bits,K){y.msg="invalid code lengths set",f.mode=G;break}f.have=0,f.mode=19;case 19:for(;f.have<f.nlen+f.ndist;){for(;X=f.lencode[I&(1<<f.lenbits)-1],F=X>>>24,A=X>>>16&255,J=65535&X,!(F<=Y);){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(J<16)I>>>=F,Y-=F,f.lens[f.have++]=J;else{if(16===J){for(L=F+2;Y<L;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(I>>>=F,Y-=F,0===f.have){y.msg="invalid bit length repeat",f.mode=G;break}D=f.lens[f.have-1],b=3+(3&I),I>>>=2,Y-=2}else if(17===J){for(L=F+3;Y<L;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}I>>>=F,Y-=F,D=0,b=3+(7&I),I>>>=3,Y-=3}else{for(L=F+7;Y<L;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}I>>>=F,Y-=F,D=0,b=11+(127&I),I>>>=7,Y-=7}if(f.have+b>f.nlen+f.ndist){y.msg="invalid bit length repeat",f.mode=G;break}for(;b--;)f.lens[f.have++]=D}}if(f.mode===G)break;if(0===f.lens[256]){y.msg="invalid code -- missing end-of-block",f.mode=G;break}if(f.lenbits=9,O={bits:f.lenbits},K=i(1,f.lens,0,f.nlen,f.lencode,0,f.work,O),f.lenbits=O.bits,K){y.msg="invalid literal/lengths set",f.mode=G;break}if(f.distbits=6,f.distcode=f.distdyn,O={bits:f.distbits},K=i(2,f.lens,f.nlen,f.ndist,f.distcode,0,f.work,O),f.distbits=O.bits,K){y.msg="invalid distances set",f.mode=G;break}if(f.mode=20,g===l)break y;case 20:f.mode=21;case 21:if(w>=6&&o>=258){y.next_out=a,y.avail_out=o,y.next_in=m,y.avail_in=w,f.hold=I,f.bits=Y,k(y,N),a=y.next_out,Q=y.output,o=y.avail_out,m=y.next_in,T=y.input,w=y.avail_in,I=f.hold,Y=f.bits,f.mode===R&&(f.back=-1);break}for(f.back=0;X=f.lencode[I&(1<<f.lenbits)-1],F=X>>>24,A=X>>>16&255,J=65535&X,!(F<=Y);){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(A&&0===(240&A)){for(V=F,e=A,h=J;X=f.lencode[h+((I&(1<<V+e)-1)>>V)],F=X>>>24,A=X>>>16&255,J=65535&X,!(V+F<=Y);){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}I>>>=V,Y-=V,f.back+=V}if(I>>>=F,Y-=F,f.back+=F,f.length=J,0===A){f.mode=26;break}if(32&A){f.back=-1,f.mode=R;break}if(64&A){y.msg="invalid literal/length code",f.mode=G;break}f.extra=15&A,f.mode=22;case 22:if(f.extra){for(L=f.extra;Y<L;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}f.length+=I&(1<<f.extra)-1,I>>>=f.extra,Y-=f.extra,f.back+=f.extra}f.was=f.length,f.mode=23;case 23:for(;X=f.distcode[I&(1<<f.distbits)-1],F=X>>>24,A=X>>>16&255,J=65535&X,!(F<=Y);){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(0===(240&A)){for(V=F,e=A,h=J;X=f.distcode[h+((I&(1<<V+e)-1)>>V)],F=X>>>24,A=X>>>16&255,J=65535&X,!(V+F<=Y);){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}I>>>=V,Y-=V,f.back+=V}if(I>>>=F,Y-=F,f.back+=F,64&A){y.msg="invalid distance code",f.mode=G;break}f.offset=J,f.extra=15&A,f.mode=24;case 24:if(f.extra){for(L=f.extra;Y<L;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}f.offset+=I&(1<<f.extra)-1,I>>>=f.extra,Y-=f.extra,f.back+=f.extra}if(f.offset>f.dmax){y.msg="invalid distance too far back",f.mode=G;break}f.mode=25;case 25:if(0===o)break y;if(b=N-o,f.offset>b){if(b=f.offset-b,b>f.whave&&f.sane){y.msg="invalid distance too far back",f.mode=G;break}b>f.wnext?(b-=f.wnext,s=f.wsize-b):s=f.wnext-b,b>f.length&&(b=f.length),u=f.window}else u=Q,s=a-f.offset,b=f.length;b>o&&(b=o),o-=b,f.length-=b;do{Q[a++]=u[s++]}while(--b);0===f.length&&(f.mode=21);break;case 26:if(0===o)break y;Q[a++]=f.length,o--,f.mode=21;break;case 27:if(f.wrap){for(;Y<32;){if(0===w)break y;w--,I|=T[m++]<<Y,Y+=8}if(N-=o,y.total_out+=N,f.total+=N,N&&(y.adler=f.check=f.flags?S(f.check,Q,N,a-N):p(f.check,Q,N,a-N)),N=o,(f.flags?I:z(I))!==f.check){y.msg="incorrect data check",f.mode=G;break}I=0,Y=0}f.mode=28;case 28:if(f.wrap&&f.flags){for(;Y<32;){if(0===w)break y;w--,I+=T[m++]<<Y,Y+=8}if(I!==(4294967295&f.total)){y.msg="incorrect length check",f.mode=G;break}I=0,Y=0}f.mode=29;case 29:K=Z;break y;case G:K=W;break y;case 31:return j;default:return q}return y.next_out=a,y.avail_out=o,y.next_in=m,y.avail_in=w,f.hold=I,f.bits=Y,(f.wsize||N!==y.avail_out&&f.mode<G&&(f.mode<27||g!==H))&&M(y,y.output,y.next_out,N-y.avail_out)?(f.mode=31,j):(r-=y.avail_in,N-=y.avail_out,y.total_in+=r,y.total_out+=N,f.total+=N,f.wrap&&N&&(y.adler=f.check=f.flags?S(f.check,Q,N,y.next_out-N):p(f.check,Q,N,y.next_out-N)),y.data_type=f.bits+(f.last?64:0)+(f.mode===R?128:0)+(20===f.mode||15===f.mode?256:0),(0===r&&0===N||g===H)&&K===c&&(K=P),K)},y.exports.inflateEnd=y=>{if(!y||!y.state)return q;let g=y.state;return g.window&&(g.window=null),y.state=null,c},y.exports.inflateGetHeader=(y,g)=>{if(!y||!y.state)return q;const f=y.state;return 0===(2&f.wrap)?q:(f.head=g,g.done=!1,c)},y.exports.inflateSetDictionary=(y,g)=>{const f=g.length;let S,k,i;return y&&y.state?(S=y.state,0!==S.wrap&&11!==S.mode?q:11===S.mode&&(k=1,k=p(k,g,f,0),k!==S.check)?W:(i=M(y,g,f,f),i?(S.mode=31,j):(S.havedict=1,c))):q},y.exports.inflateInfo="pako inflate (from Nodeca project)"},10971:y=>{"use strict";const g=15,f=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),p=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),S=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),k=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);y.exports=(y,i,H,U,l,c,Z,C)=>{const q=C.bits;let W,j,P,B,R,G,z=0,T=0,Q=0,m=0,a=0,w=0,o=0,I=0,Y=0,n=0,M=null,r=0;const N=new Uint16Array(16),b=new Uint16Array(16);let s,u,F,A=null,J=0;for(z=0;z<=g;z++)N[z]=0;for(T=0;T<U;T++)N[i[H+T]]++;for(a=q,m=g;m>=1&&0===N[m];m--);if(a>m&&(a=m),0===m)return l[c++]=20971520,l[c++]=20971520,C.bits=1,0;for(Q=1;Q<m&&0===N[Q];Q++);for(a<Q&&(a=Q),I=1,z=1;z<=g;z++)if(I<<=1,I-=N[z],I<0)return-1;if(I>0&&(0===y||1!==m))return-1;for(b[1]=0,z=1;z<g;z++)b[z+1]=b[z]+N[z];for(T=0;T<U;T++)0!==i[H+T]&&(Z[b[i[H+T]]++]=T);if(0===y?(M=A=Z,G=19):1===y?(M=f,r-=257,A=p,J-=257,G=256):(M=S,A=k,G=-1),n=0,T=0,z=Q,R=c,w=a,o=0,P=-1,Y=1<<a,B=Y-1,1===y&&Y>852||2===y&&Y>592)return 1;for(;;){s=z-o,Z[T]<G?(u=0,F=Z[T]):Z[T]>G?(u=A[J+Z[T]],F=M[r+Z[T]]):(u=96,F=0),W=1<<z-o,j=1<<w,Q=j;do{j-=W,l[R+(n>>o)+j]=s<<24|u<<16|F}while(0!==j);for(W=1<<z-1;n&W;)W>>=1;if(0!==W?(n&=W-1,n+=W):n=0,T++,0===--N[z]){if(z===m)break;z=i[H+Z[T]]}if(z>a&&(n&B)!==P){for(0===o&&(o=a),R+=Q,w=z-o,I=1<<w;w+o<m&&(I-=N[w+o],!(I<=0));)w++,I<<=1;if(Y+=1<<w,1===y&&Y>852||2===y&&Y>592)return 1;P=n&B,l[P]=a<<24|w<<16|R-c}}return 0!==n&&(l[R+n]=z-o<<24|64<<16),C.bits=a,0}},10929:y=>{"use strict";y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10913:y=>{"use strict";function g(y){let g=y.length;for(;--g>=0;)y[g]=0}const f=256,p=286,S=30,k=15,i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),H=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=new Array(576);g(c);const Z=new Array(60);g(Z);const C=new Array(512);g(C);const q=new Array(256);g(q);const W=new Array(29);g(W);const j=new Array(S);function P(y,g,f,p,S){this.static_tree=y,this.extra_bits=g,this.extra_base=f,this.elems=p,this.max_length=S,this.has_stree=y&&y.length}let B,R,G;function z(y,g){this.dyn_tree=y,this.max_code=0,this.stat_desc=g}g(j);const T=y=>y<256?C[y]:C[256+(y>>>7)],Q=(y,g)=>{y.pending_buf[y.pending++]=255&g,y.pending_buf[y.pending++]=g>>>8&255},m=(y,g,f)=>{y.bi_valid>16-f?(y.bi_buf|=g<<y.bi_valid&65535,Q(y,y.bi_buf),y.bi_buf=g>>16-y.bi_valid,y.bi_valid+=f-16):(y.bi_buf|=g<<y.bi_valid&65535,y.bi_valid+=f)},a=(y,g,f)=>{m(y,f[2*g],f[2*g+1])},w=(y,g)=>{let f=0;do{f|=1&y,y>>>=1,f<<=1}while(--g>0);return f>>>1},o=(y,g,f)=>{const p=new Array(16);let S,i,H=0;for(S=1;S<=k;S++)p[S]=H=H+f[S-1]<<1;for(i=0;i<=g;i++){let g=y[2*i+1];0!==g&&(y[2*i]=w(p[g]++,g))}},I=y=>{let g;for(g=0;g<p;g++)y.dyn_ltree[2*g]=0;for(g=0;g<S;g++)y.dyn_dtree[2*g]=0;for(g=0;g<19;g++)y.bl_tree[2*g]=0;y.dyn_ltree[512]=1,y.opt_len=y.static_len=0,y.last_lit=y.matches=0},Y=y=>{y.bi_valid>8?Q(y,y.bi_buf):y.bi_valid>0&&(y.pending_buf[y.pending++]=y.bi_buf),y.bi_buf=0,y.bi_valid=0},n=(y,g,f,p)=>{const S=2*g,k=2*f;return y[S]<y[k]||y[S]===y[k]&&p[g]<=p[f]},M=(y,g,f)=>{const p=y.heap[f];let S=f<<1;for(;S<=y.heap_len&&(S<y.heap_len&&n(g,y.heap[S+1],y.heap[S],y.depth)&&S++,!n(g,p,y.heap[S],y.depth));)y.heap[f]=y.heap[S],f=S,S<<=1;y.heap[f]=p},r=(y,g,p)=>{let S,k,U,l,c=0;if(0!==y.last_lit)do{S=y.pending_buf[y.d_buf+2*c]<<8|y.pending_buf[y.d_buf+2*c+1],k=y.pending_buf[y.l_buf+c],c++,0===S?a(y,k,g):(U=q[k],a(y,U+f+1,g),l=i[U],0!==l&&(k-=W[U],m(y,k,l)),S--,U=T(S),a(y,U,p),l=H[U],0!==l&&(S-=j[U],m(y,S,l)))}while(c<y.last_lit);a(y,256,g)},N=(y,g)=>{const f=g.dyn_tree,p=g.stat_desc.static_tree,S=g.stat_desc.has_stree,i=g.stat_desc.elems;let H,U,l,c=-1;for(y.heap_len=0,y.heap_max=573,H=0;H<i;H++)0!==f[2*H]?(y.heap[++y.heap_len]=c=H,y.depth[H]=0):f[2*H+1]=0;for(;y.heap_len<2;)l=y.heap[++y.heap_len]=c<2?++c:0,f[2*l]=1,y.depth[l]=0,y.opt_len--,S&&(y.static_len-=p[2*l+1]);for(g.max_code=c,H=y.heap_len>>1;H>=1;H--)M(y,f,H);l=i;do{H=y.heap[1],y.heap[1]=y.heap[y.heap_len--],M(y,f,1),U=y.heap[1],y.heap[--y.heap_max]=H,y.heap[--y.heap_max]=U,f[2*l]=f[2*H]+f[2*U],y.depth[l]=(y.depth[H]>=y.depth[U]?y.depth[H]:y.depth[U])+1,f[2*H+1]=f[2*U+1]=l,y.heap[1]=l++,M(y,f,1)}while(y.heap_len>=2);y.heap[--y.heap_max]=y.heap[1],((y,g)=>{const f=g.dyn_tree,p=g.max_code,S=g.stat_desc.static_tree,i=g.stat_desc.has_stree,H=g.stat_desc.extra_bits,U=g.stat_desc.extra_base,l=g.stat_desc.max_length;let c,Z,C,q,W,j,P=0;for(q=0;q<=k;q++)y.bl_count[q]=0;for(f[2*y.heap[y.heap_max]+1]=0,c=y.heap_max+1;c<573;c++)Z=y.heap[c],q=f[2*f[2*Z+1]+1]+1,q>l&&(q=l,P++),f[2*Z+1]=q,Z>p||(y.bl_count[q]++,W=0,Z>=U&&(W=H[Z-U]),j=f[2*Z],y.opt_len+=j*(q+W),i&&(y.static_len+=j*(S[2*Z+1]+W)));if(0!==P){do{for(q=l-1;0===y.bl_count[q];)q--;y.bl_count[q]--,y.bl_count[q+1]+=2,y.bl_count[l]--,P-=2}while(P>0);for(q=l;0!==q;q--)for(Z=y.bl_count[q];0!==Z;)C=y.heap[--c],C>p||(f[2*C+1]!==q&&(y.opt_len+=(q-f[2*C+1])*f[2*C],f[2*C+1]=q),Z--)}})(y,g),o(f,c,y.bl_count)},b=(y,g,f)=>{let p,S,k=-1,i=g[1],H=0,U=7,l=4;for(0===i&&(U=138,l=3),g[2*(f+1)+1]=65535,p=0;p<=f;p++)S=i,i=g[2*(p+1)+1],++H<U&&S===i||(H<l?y.bl_tree[2*S]+=H:0!==S?(S!==k&&y.bl_tree[2*S]++,y.bl_tree[32]++):H<=10?y.bl_tree[34]++:y.bl_tree[36]++,H=0,k=S,0===i?(U=138,l=3):S===i?(U=6,l=3):(U=7,l=4))},s=(y,g,f)=>{let p,S,k=-1,i=g[1],H=0,U=7,l=4;for(0===i&&(U=138,l=3),p=0;p<=f;p++)if(S=i,i=g[2*(p+1)+1],!(++H<U&&S===i)){if(H<l)do{a(y,S,y.bl_tree)}while(0!==--H);else 0!==S?(S!==k&&(a(y,S,y.bl_tree),H--),a(y,16,y.bl_tree),m(y,H-3,2)):H<=10?(a(y,17,y.bl_tree),m(y,H-3,3)):(a(y,18,y.bl_tree),m(y,H-11,7));H=0,k=S,0===i?(U=138,l=3):S===i?(U=6,l=3):(U=7,l=4)}};let u=!1;const F=(y,g,f,p)=>{m(y,0+(p?1:0),3),((y,g,f,p)=>{Y(y),p&&(Q(y,f),Q(y,~f)),y.pending_buf.set(y.window.subarray(g,g+f),y.pending),y.pending+=f})(y,g,f,!0)};y.exports._tr_init=y=>{u||((()=>{let y,g,f,l,z;const T=new Array(16);for(f=0,l=0;l<28;l++)for(W[l]=f,y=0;y<1<<i[l];y++)q[f++]=l;for(q[f-1]=l,z=0,l=0;l<16;l++)for(j[l]=z,y=0;y<1<<H[l];y++)C[z++]=l;for(z>>=7;l<S;l++)for(j[l]=z<<7,y=0;y<1<<H[l]-7;y++)C[256+z++]=l;for(g=0;g<=k;g++)T[g]=0;for(y=0;y<=143;)c[2*y+1]=8,y++,T[8]++;for(;y<=255;)c[2*y+1]=9,y++,T[9]++;for(;y<=279;)c[2*y+1]=7,y++,T[7]++;for(;y<=287;)c[2*y+1]=8,y++,T[8]++;for(o(c,287,T),y=0;y<S;y++)Z[2*y+1]=5,Z[2*y]=w(y,5);B=new P(c,i,257,p,k),R=new P(Z,H,0,S,k),G=new P(new Array(0),U,0,19,7)})(),u=!0),y.l_desc=new z(y.dyn_ltree,B),y.d_desc=new z(y.dyn_dtree,R),y.bl_desc=new z(y.bl_tree,G),y.bi_buf=0,y.bi_valid=0,I(y)},y.exports._tr_stored_block=F,y.exports._tr_flush_block=(y,g,p,S)=>{let k,i,H=0;y.level>0?(2===y.strm.data_type&&(y.strm.data_type=(y=>{let g,p=4093624447;for(g=0;g<=31;g++,p>>>=1)if(1&p&&0!==y.dyn_ltree[2*g])return 0;if(0!==y.dyn_ltree[18]||0!==y.dyn_ltree[20]||0!==y.dyn_ltree[26])return 1;for(g=32;g<f;g++)if(0!==y.dyn_ltree[2*g])return 1;return 0})(y)),N(y,y.l_desc),N(y,y.d_desc),H=(y=>{let g;for(b(y,y.dyn_ltree,y.l_desc.max_code),b(y,y.dyn_dtree,y.d_desc.max_code),N(y,y.bl_desc),g=18;g>=3&&0===y.bl_tree[2*l[g]+1];g--);return y.opt_len+=3*(g+1)+5+5+4,g})(y),k=y.opt_len+3+7>>>3,i=y.static_len+3+7>>>3,i<=k&&(k=i)):k=i=p+5,p+4<=k&&-1!==g?F(y,g,p,S):4===y.strategy||i===k?(m(y,2+(S?1:0),3),r(y,c,Z)):(m(y,4+(S?1:0),3),((y,g,f,p)=>{let S;for(m(y,g-257,5),m(y,f-1,5),m(y,p-4,4),S=0;S<p;S++)m(y,y.bl_tree[2*l[S]+1],3);s(y,y.dyn_ltree,g-1),s(y,y.dyn_dtree,f-1)})(y,y.l_desc.max_code+1,y.d_desc.max_code+1,H+1),r(y,y.dyn_ltree,y.dyn_dtree)),I(y),S&&Y(y)},y.exports._tr_tally=(y,g,p)=>(y.pending_buf[y.d_buf+2*y.last_lit]=g>>>8&255,y.pending_buf[y.d_buf+2*y.last_lit+1]=255&g,y.pending_buf[y.l_buf+y.last_lit]=255&p,y.last_lit++,0===g?y.dyn_ltree[2*p]++:(y.matches++,g--,y.dyn_ltree[2*(q[p]+f+1)]++,y.dyn_dtree[2*T(g)]++),y.last_lit===y.lit_bufsize-1),y.exports._tr_align=y=>{m(y,2,3),a(y,256,c),(y=>{16===y.bi_valid?(Q(y,y.bi_buf),y.bi_buf=0,y.bi_valid=0):y.bi_valid>=8&&(y.pending_buf[y.pending++]=255&y.bi_buf,y.bi_buf>>=8,y.bi_valid-=8)})(y)}},10952:y=>{"use strict";y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11967:y=>{function g(y,g,f){for(var p=y.length,S=-1/0,k=1/0,i=0;i<p;i++){var H=(f[0][i]-y[i])/g[i],U=(f[1][i]-y[i])/g[i];if(H>U){var l=H;H=U,U=l}if(U<S||H>k)return 1/0;H>S&&(S=H),U<k&&(k=U)}return S>k?1/0:S}y.exports=function(y,f,p,S){var k=g(f,p,S);if(k===1/0)y=null;else{y=y||[];for(var i=0;i<f.length;i++)y[i]=f[i]+p[i]*k}return y},y.exports.distance=g},12760:(y,g,f)=>{"use strict";f.d(g,{c:()=>i});var p=f(19);const S=p.useLayoutEffect;const k=function(y){var g=(0,p.useRef)(y);return S((function(){g.current=y})),g};var i=function(y){var g=k(y);(0,p.ab)((function(){var y=function(y){var f;if(null!=g.current&&(f=g.current(y)),y.defaultPrevented&&(y.returnValue=""),"string"===typeof f)return y.returnValue=f,f};return window.addEventListener("beforeunload",y),function(){window.removeEventListener("beforeunload",y)}}),[])}},12710:(y,g,f)=>{"use strict";var p=f(12713),S=Array.prototype.concat,k=Array.prototype.slice,i=y.exports=function(y){for(var g=[],f=0,i=y.length;f<i;f++){var H=y[f];p(H)?g=S.call(g,k.call(H)):g.push(H)}return g};i.wrap=function(y){return function(){return y(i(arguments))}}},12713:y=>{y.exports=function(y){return!(!y||"string"===typeof y)&&(y instanceof Array||Array.isArray(y)||y.length>=0&&(y.splice instanceof Function||Object.getOwnPropertyDescriptor(y,y.length-1)&&"String"!==y.constructor.name))}},10684:(y,g,f)=>{var p=f(10693);function S(y){for(var g,f,S=0,k=y.length,i=0;i<y.length;){for(g=y[i],f=0;i<k&&y[i]===g;)++i,++f;S+=p.log2(f)/7|0,S+=p.log2(g>>>0)/7|0,S+=2}return S}g.size=S,g.encode=function(y,g){g||(g=new Uint8Array(S(y)));for(var f,p,k=0,i=g.length,H=0;H<y.length;){for(f=y[H],p=0;H<y.length&&y[H]===f;)++H,++p;for(;k<i&&p>=128;)g[k++]=128+(127&p),p>>>=7;if(k>=i)throw new Error("RLE buffer overflow");for(g[k++]=p,f>>>=0;k<i&&f>=128;)g[k++]=128+(127&f),f>>>=7;if(k>=i)throw new Error("RLE buffer overflow");g[k++]=f}return g},g.decode=function(y,g){for(var f,p,S,k,i=g.length,H=y.length,U=0,l=0;l<H;){for(f=0,p=0;l<H&&y[l]>=128;)f+=(127&y[l++])<<p,p+=7;if(f+=y[l++]<<p,l>=H)throw new Error("RLE buffer underrun");if(U+f>i)throw new Error("Chunk buffer overflow");for(S=0,p=0;l<H&&y[l]>=128;)S+=(127&y[l++])<<p,p+=7;if(l>=H)throw new Error("RLE buffer underrun");for(S+=y[l++]<<p,k=0;k<f;++k)g[U++]=S}return g}},10693:(y,g)=>{"use strict";function f(y){var g=32;return(y&=-y)&&g--,65535&y&&(g-=16),16711935&y&&(g-=8),252645135&y&&(g-=4),858993459&y&&(g-=2),1431655765&y&&(g-=1),g}g.INT_BITS=32,g.INT_MAX=2147483647,g.INT_MIN=-1<<31,g.sign=function(y){return(y>0)-(y<0)},g.abs=function(y){var g=y>>31;return(y^g)-g},g.min=function(y,g){return g^(y^g)&-(y<g)},g.max=function(y,g){return y^(y^g)&-(y<g)},g.isPow2=function(y){return!(y&y-1)&&!!y},g.log2=function(y){var g,f;return g=(y>65535)<<4,g|=f=((y>>>=g)>255)<<3,g|=f=((y>>>=f)>15)<<2,(g|=f=((y>>>=f)>3)<<1)|(y>>>=f)>>1},g.log10=function(y){return y>=1e9?9:y>=1e8?8:y>=1e7?7:y>=1e6?6:y>=1e5?5:y>=1e4?4:y>=1e3?3:y>=100?2:y>=10?1:0},g.popCount=function(y){return 16843009*((y=(858993459&(y-=y>>>1&1431655765))+(y>>>2&858993459))+(y>>>4)&252645135)>>>24},g.countTrailingZeros=f,g.nextPow2=function(y){return y+=0===y,--y,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)+1},g.prevPow2=function(y){return y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)-(y>>>1)},g.parity=function(y){return y^=y>>>16,y^=y>>>8,y^=y>>>4,27030>>>(y&=15)&1};var p=new Array(256);!function(y){for(var g=0;g<256;++g){var f=g,p=g,S=7;for(f>>>=1;f;f>>>=1)p<<=1,p|=1&f,--S;y[g]=p<<S&255}}(p),g.reverse=function(y){return p[255&y]<<24|p[y>>>8&255]<<16|p[y>>>16&255]<<8|p[y>>>24&255]},g.interleave2=function(y,g){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))|(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))<<1},g.deinterleave2=function(y,g){return(y=65535&((y=16711935&((y=252645135&((y=858993459&((y=y>>>g&1431655765)|y>>>1))|y>>>2))|y>>>4))|y>>>16))<<16>>16},g.interleave3=function(y,g,f){return y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2),(y|=(g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2))<<1)|(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<2},g.deinterleave3=function(y,g){return(y=1023&((y=4278190335&((y=251719695&((y=3272356035&((y=y>>>g&1227133513)|y>>>2))|y>>>4))|y>>>8))|y>>>16))<<22>>22},g.nextCombination=function(y){var g=y|y-1;return g+1|(~g&-~g)-1>>>f(y)+1}},10892:y=>{"use strict";y.exports=function(y,g,f,p){var S=self||window;try{try{var k;try{k=new S.Blob([y])}catch(l){(k=new(S.BlobBuilder||S.WebKitBlobBuilder||S.MozBlobBuilder||S.MSBlobBuilder)).append(y),k=k.getBlob()}var i=S.URL||S.webkitURL,H=i.createObjectURL(k),U=new S[g](H,f);return i.revokeObjectURL(H),U}catch(l){return new S[g]("data:application/javascript,".concat(encodeURIComponent(y)),f)}}catch(l){if(!p)throw Error("Inline worker is not supported");return new S[g](p,f)}}},11949:(y,g,f)=>{"use strict";function p(y,g,f,p,S){var k={};return Object.keys(p).forEach((function(y){k[y]=p[y]})),k.enumerable=!!k.enumerable,k.configurable=!!k.configurable,("value"in k||k.initializer)&&(k.writable=!0),k=f.slice().reverse().reduce((function(f,p){return p(y,g,f)||f}),k),S&&void 0!==k.initializer&&(k.value=k.initializer?k.initializer.call(S):void 0,k.initializer=void 0),void 0===k.initializer&&(Object.defineProperty(y,g,k),k=null),k}f.d(g,{b:()=>p})},11940:(y,g,f)=>{"use strict";function p(y,g,f,p){f&&Object.defineProperty(y,g,{enumerable:f.enumerable,configurable:f.configurable,writable:f.writable,value:f.initializer?f.initializer.call(p):void 0})}f.d(g,{b:()=>p})},12241:(y,g,f)=>{"use strict";f.d(g,{c:()=>G,d:()=>P,e:()=>B,g:()=>C,k:()=>j,l:()=>W,p:()=>q});var p=f(11054),S=f(11090),k=f(11079),i=f(10871),H=f(12245),U=f(11336),l=f(11274),c=f(10757),Z=f(11099);const C=Object.freeze(new p.g(0,0,0,0)),q=Object.freeze(p.m.Zero()),W=Object.freeze(p.l.Zero()),j=Object.freeze(l.e.Zero()),P=Object.freeze(S.c.Black()),B=Object.freeze(new S.f(0,0,0,0)),R={key:0,repeatCount:0,loopMode:2};class G{static _PrepareAnimation(y,g,f,k,i,H,U,c){let Z;if(!isNaN(parseFloat(i))&&isFinite(i)?Z=G.ANIMATIONTYPE_FLOAT:i instanceof p.g?Z=G.ANIMATIONTYPE_QUATERNION:i instanceof p.m?Z=G.ANIMATIONTYPE_VECTOR3:i instanceof p.l?Z=G.ANIMATIONTYPE_VECTOR2:i instanceof S.c?Z=G.ANIMATIONTYPE_COLOR3:i instanceof S.f?Z=G.ANIMATIONTYPE_COLOR4:i instanceof l.e&&(Z=G.ANIMATIONTYPE_SIZE),void 0==Z)return null;const C=new G(y,g,f,Z,U),q=[{frame:0,value:i},{frame:k,value:H}];return C.setKeys(q),void 0!==c&&C.setEasingFunction(c),C}static CreateAnimation(y,g,f,p){const S=new G(y+"Animation",y,f,g,G.ANIMATIONLOOPMODE_CONSTANT);return S.setEasingFunction(p),S}static CreateAndStartAnimation(y,g,f,p,S,k,i,H,U,l,c){const Z=G._PrepareAnimation(y,f,p,S,k,i,H,U);return Z?(g.va&&(c=g.va()),c?c.beginDirectAnimation(g,[Z],0,S,1===Z.loopMode,1,l):null):null}static CreateAndStartHierarchyAnimation(y,g,f,p,S,k,i,H,U,l,c){const Z=G._PrepareAnimation(y,p,S,k,i,H,U,l);if(!Z)return null;return g.va().beginDirectHierarchyAnimation(g,f,[Z],0,k,1===Z.loopMode,1,c)}static CreateMergeAndStartAnimation(y,g,f,p,S,k,i,H,U,l){const c=G._PrepareAnimation(y,f,p,S,k,i,H,U);return c?(g.animations.push(c),g.va().beginAnimation(g,0,S,1===c.loopMode,1,l)):null}static MakeAnimationAdditive(y,g,f){let S;S="object"===typeof g?g:{referenceFrame:g??0,range:f,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let k=y;if(S.cloneOriginalAnimation&&(k=y.clone(),k.name=S.clonedAnimationName||k.name),!k._keys.length)return k;const i=S.referenceFrame&&S.referenceFrame>=0?S.referenceFrame:0;let H=0;const U=k._keys[0];let l=k._keys.length-1;const c=k._keys[l],Z={referenceValue:U.value,referencePosition:p.j.o[0],referenceQuaternion:p.j.Quaternion[0],referenceScaling:p.j.o[1],keyPosition:p.j.o[2],keyQuaternion:p.j.Quaternion[1],keyScaling:p.j.o[3]};let C=U.frame,q=c.frame;if(S.range){const y=k.getRange(S.range);y&&(C=y.from,q=y.to)}else C=S.fromFrame??C,q=S.toFrame??q;if(C!==U.frame&&(H=k.createKeyForFrame(C)),q!==c.frame&&(l=k.createKeyForFrame(q)),1===k._keys.length){const y=k._getKeyValue(k._keys[0]);Z.referenceValue=y.clone?y.clone():y}else if(i<=U.frame){const y=k._getKeyValue(U.value);Z.referenceValue=y.clone?y.clone():y}else if(i>=c.frame){const y=k._getKeyValue(c.value);Z.referenceValue=y.clone?y.clone():y}else{R.key=0;const y=k._interpolate(i,R);Z.referenceValue=y.clone?y.clone():y}k.dataType===G.ANIMATIONTYPE_QUATERNION?Z.referenceValue.normalize().conjugateInPlace():k.dataType===G.ANIMATIONTYPE_MATRIX&&(Z.referenceValue.decompose(Z.referenceScaling,Z.referenceQuaternion,Z.referencePosition),Z.referenceQuaternion.normalize().conjugateInPlace());let W=Number.MAX_VALUE;const j=S.clipKeys?[]:null;for(let P=H;P<=l;P++){let y=k._keys[P];if((j||S.cloneOriginalAnimation)&&(y={frame:y.frame,value:y.value.clone?y.value.clone():y.value,inTangent:y.inTangent,outTangent:y.outTangent,interpolation:y.interpolation,lockedTangent:y.lockedTangent},j&&(W===Number.MAX_VALUE&&(W=y.frame),y.frame-=W,j.push(y))),!P||k.dataType===G.ANIMATIONTYPE_FLOAT||y.value!==U.value)switch(k.dataType){case G.ANIMATIONTYPE_MATRIX:y.value.decompose(Z.keyScaling,Z.keyQuaternion,Z.keyPosition),Z.keyPosition.ti(Z.referencePosition),Z.keyScaling.divideInPlace(Z.referenceScaling),Z.referenceQuaternion.multiplyToRef(Z.keyQuaternion,Z.keyQuaternion),p.c.ComposeToRef(Z.keyScaling,Z.keyQuaternion,Z.keyPosition,y.value);break;case G.ANIMATIONTYPE_QUATERNION:Z.referenceValue.multiplyToRef(y.value,y.value);break;case G.ANIMATIONTYPE_VECTOR2:case G.ANIMATIONTYPE_VECTOR3:case G.ANIMATIONTYPE_COLOR3:case G.ANIMATIONTYPE_COLOR4:y.value.subtractToRef(Z.referenceValue,y.value);break;case G.ANIMATIONTYPE_SIZE:y.value.width-=Z.referenceValue.width,y.value.height-=Z.referenceValue.height;break;default:y.value-=Z.referenceValue}}return j&&k.setKeys(j,!0),k}static TransitionTo(y,g,f,p,S,k,i){let H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(i<=0)return f[y]=g,H&&H(),null;const U=S*(i/1e3);k.setKeys([{frame:0,value:f[y].clone?f[y].clone():f[y]},{frame:U,value:g}]),f.animations||(f.animations=[]),f.animations.push(k);const l=p.beginAnimation(f,0,U,!1);return l.onAnimationEnd=H,l}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const y of this._runtimeAnimations)if(!y.isStopped())return!0;return!1}constructor(y,g,f,p,S,k){this.name=y,this.targetProperty=g,this.framePerSecond=f,this.dataType=p,this.loopMode=S,this.enableBlending=k,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=g.split("."),this.dataType=p,this.loopMode=void 0===S?G.ANIMATIONLOOPMODE_CYCLE:S,this.uniqueId=G._UniqueIdGenerator++}toString(y){let g="Name: "+this.name+", property: "+this.targetProperty;if(g+=", datatype: "+["Float","o","Quaternion","Matrix","hb","Vector2"][this.dataType],g+=", nKeys: "+(this._keys?this._keys.length:"none"),g+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),y){g+=", Ranges: {";let y=!0;for(const f in this._ranges)y&&(g+=", ",y=!1),g+=f;g+="}"}return g}addEvent(y){this._events.push(y),this._events.sort(((y,g)=>y.frame-g.frame))}removeEvents(y){for(let g=0;g<this._events.length;g++)this._events[g].frame===y&&(this._events.splice(g,1),g--)}getEvents(){return this._events}createRange(y,g,f){this._ranges[y]||(this._ranges[y]=new H.e(y,g,f))}deleteRange(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=this._ranges[y];if(f){if(g){const y=f.from,g=f.to;for(let f=this._keys.length-1;f>=0;f--)this._keys[f].frame>=y&&this._keys[f].frame<=g&&this._keys.splice(f,1)}this._ranges[y]=null}}getRange(y){return this._ranges[y]}getKeys(){return this._keys}getHighestFrame(){let y=0;for(let g=0,f=this._keys.length;g<f;g++)y<this._keys[g].frame&&(y=this._keys[g].frame);return y}getEasingFunction(){return this._easingFunction}setEasingFunction(y){this._easingFunction=y}floatInterpolateFunction(y,g,f){return(0,k.n)(y,g,f)}floatInterpolateFunctionWithTangents(y,g,f,p,S){return(0,k.g)(y,g,f,p,S)}quaternionInterpolateFunction(y,g,f){return p.g.Slerp(y,g,f)}quaternionInterpolateFunctionWithTangents(y,g,f,S,k){return p.g.Hermite(y,g,f,S,k).normalize()}vector3InterpolateFunction(y,g,f){return p.m.Lerp(y,g,f)}vector3InterpolateFunctionWithTangents(y,g,f,S,k){return p.m.Hermite(y,g,f,S,k)}vector2InterpolateFunction(y,g,f){return p.l.Lerp(y,g,f)}vector2InterpolateFunctionWithTangents(y,g,f,S,k){return p.l.Hermite(y,g,f,S,k)}sizeInterpolateFunction(y,g,f){return l.e.Lerp(y,g,f)}color3InterpolateFunction(y,g,f){return S.c.Lerp(y,g,f)}color3InterpolateFunctionWithTangents(y,g,f,p,k){return S.c.Hermite(y,g,f,p,k)}color4InterpolateFunction(y,g,f){return S.f.Lerp(y,g,f)}color4InterpolateFunctionWithTangents(y,g,f,p,k){return S.f.Hermite(y,g,f,p,k)}_getKeyValue(y){return"function"===typeof y?y():y}evaluate(y){return R.key=0,this._interpolate(y,R)}_interpolate(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(g.loopMode===G.ANIMATIONLOOPMODE_CONSTANT&&g.repeatCount>0)return g.highLimitValue.clone?g.highLimitValue.clone():g.highLimitValue;const p=this._keys,S=p.length;let k=g.key;for(;k>=0&&y<p[k].frame;)--k;for(;k+1<=S-1&&y>=p[k+1].frame;)++k;if(g.key=k,k<0)return f?void 0:this._getKeyValue(p[0].value);if(k+1>S-1)return f?void 0:this._getKeyValue(p[S-1].value);const i=p[k],H=p[k+1];if(f&&(y===i.frame||y===H.frame))return;const U=this._getKeyValue(i.value),l=this._getKeyValue(H.value);if(1===i.interpolation)return H.frame>y?U:l;const c=void 0!==i.outTangent&&void 0!==H.inTangent,Z=H.frame-i.frame;let R=(y-i.frame)/Z;const z=i.easingFunction||this.getEasingFunction();switch(null!==z&&(R=z.ease(R)),this.dataType){case G.ANIMATIONTYPE_FLOAT:{const y=c?this.floatInterpolateFunctionWithTangents(U,i.outTangent*Z,l,H.inTangent*Z,R):this.floatInterpolateFunction(U,l,R);switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return y;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(g.offsetValue??0)*g.repeatCount+y}break}case G.ANIMATIONTYPE_QUATERNION:{const y=c?this.quaternionInterpolateFunctionWithTangents(U,i.outTangent.scale(Z),l,H.inTangent.scale(Z),R):this.quaternionInterpolateFunction(U,l,R);switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return y;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.addInPlace((g.offsetValue||C).scale(g.repeatCount))}return y}case G.ANIMATIONTYPE_VECTOR3:{const y=c?this.vector3InterpolateFunctionWithTangents(U,i.outTangent.scale(Z),l,H.inTangent.scale(Z),R):this.vector3InterpolateFunction(U,l,R);switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return y;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((g.offsetValue||q).scale(g.repeatCount))}break}case G.ANIMATIONTYPE_VECTOR2:{const y=c?this.vector2InterpolateFunctionWithTangents(U,i.outTangent.scale(Z),l,H.inTangent.scale(Z),R):this.vector2InterpolateFunction(U,l,R);switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return y;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((g.offsetValue||W).scale(g.repeatCount))}break}case G.ANIMATIONTYPE_SIZE:switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(U,l,R);case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(U,l,R).add((g.offsetValue||j).scale(g.repeatCount))}break;case G.ANIMATIONTYPE_COLOR3:{const y=c?this.color3InterpolateFunctionWithTangents(U,i.outTangent.scale(Z),l,H.inTangent.scale(Z),R):this.color3InterpolateFunction(U,l,R);switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return y;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((g.offsetValue||P).scale(g.repeatCount))}break}case G.ANIMATIONTYPE_COLOR4:{const y=c?this.color4InterpolateFunctionWithTangents(U,i.outTangent.scale(Z),l,H.inTangent.scale(Z),R):this.color4InterpolateFunction(U,l,R);switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return y;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((g.offsetValue||B).scale(g.repeatCount))}break}case G.ANIMATIONTYPE_MATRIX:switch(g.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return G.AllowMatricesInterpolation?this.matrixInterpolateFunction(U,l,R,g.workValue):U;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U}}return 0}matrixInterpolateFunction(y,g,f,S){return G.AllowMatrixDecomposeForInterpolation?S?(p.c.DecomposeLerpToRef(y,g,f,S),S):p.c.DecomposeLerp(y,g,f):S?(p.c.LerpToRef(y,g,f,S),S):p.c.Lerp(y,g,f)}clone(){const y=new G(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(y.enableBlending=this.enableBlending,y.blendingSpeed=this.blendingSpeed,this._keys&&y.setKeys(this._keys),this._ranges){y._ranges={};for(const g in this._ranges){const f=this._ranges[g];f&&(y._ranges[g]=f.clone())}}return y}setKeys(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=g?y:y.slice(0)}createKeyForFrame(y){R.key=0;const g=this._interpolate(y,R,!0);if(!g)return this._keys[R.key].frame===y?R.key:R.key+1;const f={frame:y,value:g.clone?g.clone():g};return this._keys.splice(R.key+1,0,f),R.key+1}serialize(){const y={};y.name=this.name,y.property=this.targetProperty,y.framePerSecond=this.framePerSecond,y.dataType=this.dataType,y.loopBehavior=this.loopMode,y.enableBlending=this.enableBlending,y.blendingSpeed=this.blendingSpeed;const g=this.dataType;y.keys=[];const f=this.getKeys();for(let p=0;p<f.length;p++){const S=f[p],k={};switch(k.frame=S.frame,g){case G.ANIMATIONTYPE_FLOAT:k.values=[S.value],void 0!==S.inTangent&&k.values.push(S.inTangent),void 0!==S.outTangent&&(void 0===S.inTangent&&k.values.push(void 0),k.values.push(S.outTangent)),void 0!==S.interpolation&&(void 0===S.inTangent&&k.values.push(void 0),void 0===S.outTangent&&k.values.push(void 0),k.values.push(S.interpolation));break;case G.ANIMATIONTYPE_QUATERNION:case G.ANIMATIONTYPE_MATRIX:case G.ANIMATIONTYPE_VECTOR3:case G.ANIMATIONTYPE_COLOR3:case G.ANIMATIONTYPE_COLOR4:k.values=S.value.mj(),void 0!=S.inTangent&&k.values.push(S.inTangent.mj()),void 0!=S.outTangent&&(void 0===S.inTangent&&k.values.push(void 0),k.values.push(S.outTangent.mj())),void 0!==S.interpolation&&(void 0===S.inTangent&&k.values.push(void 0),void 0===S.outTangent&&k.values.push(void 0),k.values.push(S.interpolation))}y.keys.push(k)}y.ranges=[];for(const p in this._ranges){const g=this._ranges[p];if(!g)continue;const f={};f.name=p,f.from=g.from,f.to=g.to,y.ranges.push(f)}return y}static _UniversalLerp(y,g,f){const p=y.constructor;return p.Lerp?p.Lerp(y,g,f):p.Slerp?p.Slerp(y,g,f):y.toFixed?y*(1-f)+f*g:g}static Parse(y){const g=new G(y.name,y.property,y.framePerSecond,y.dataType,y.loopBehavior),f=y.dataType,k=[];let i,H;for(y.enableBlending&&(g.enableBlending=y.enableBlending),y.blendingSpeed&&(g.blendingSpeed=y.blendingSpeed),H=0;H<y.keys.length;H++){const g=y.keys[H];let U,l,c;switch(f){case G.ANIMATIONTYPE_FLOAT:i=g.values[0],g.values.length>=2&&(U=g.values[1]),g.values.length>=3&&(l=g.values[2]),g.values.length>=4&&(c=g.values[3]);break;case G.ANIMATIONTYPE_QUATERNION:if(i=p.g.eh(g.values),g.values.length>=8){const y=p.g.eh(g.values.slice(4,8));y.equals(p.g.Zero())||(U=y)}if(g.values.length>=12){const y=p.g.eh(g.values.slice(8,12));y.equals(p.g.Zero())||(l=y)}g.values.length>=13&&(c=g.values[12]);break;case G.ANIMATIONTYPE_MATRIX:i=p.c.eh(g.values),g.values.length>=17&&(c=g.values[16]);break;case G.ANIMATIONTYPE_COLOR3:i=S.c.eh(g.values),g.values[3]&&(U=S.c.eh(g.values[3])),g.values[4]&&(l=S.c.eh(g.values[4])),g.values[5]&&(c=g.values[5]);break;case G.ANIMATIONTYPE_COLOR4:i=S.f.eh(g.values),g.values[4]&&(U=S.f.eh(g.values[4])),g.values[5]&&(l=S.f.eh(g.values[5])),g.values[6]&&(c=S.f.eh(g.values[6]));break;case G.ANIMATIONTYPE_VECTOR3:default:i=p.m.eh(g.values),g.values[3]&&(U=p.m.eh(g.values[3])),g.values[4]&&(l=p.m.eh(g.values[4])),g.values[5]&&(c=g.values[5])}const Z={};Z.frame=g.frame,Z.value=i,void 0!=U&&(Z.inTangent=U),void 0!=l&&(Z.outTangent=l),void 0!=c&&(Z.interpolation=c),k.push(Z)}if(g.setKeys(k),y.ranges)for(H=0;H<y.ranges.length;H++)i=y.ranges[H],g.createRange(i.name,i.from,i.to);return g}static AppendSerializedAnimations(y,g){Z.c.AppendSerializedAnimations(y,g)}static ParseFromFileAsync(y,g){return new Promise(((f,p)=>{const S=new c.d;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){let g=JSON.parse(S.responseText);if(g.animations&&(g=g.animations),g.length){const y=[];for(const f of g)y.push(this.Parse(f));f(y)}else{const p=this.Parse(g);y&&(p.name=y),f(p)}}else p("Unable to load the animation")})),S.open("GET",g),S.send()}))}static ParseFromSnippetAsync(y){return new Promise(((g,f)=>{const p=new c.d;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const f=JSON.parse(JSON.parse(p.responseText).jsonPayload);if(f.animations){const p=JSON.parse(f.animations),S=[];for(const g of p.animations){const f=this.Parse(g);f.snippetId=y,S.push(f)}g(S)}else{const p=JSON.parse(f.animation),S=this.Parse(p);S.snippetId=y,g(S)}}else f("Unable to load the snippet "+y)})),p.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),p.send()}))}}G._UniqueIdGenerator=0,G.AllowMatricesInterpolation=!1,G.AllowMatrixDecomposeForInterpolation=!0,G.SnippetUrl="https://snippet.babylonjs.com",G.ANIMATIONTYPE_FLOAT=0,G.ANIMATIONTYPE_VECTOR3=1,G.ANIMATIONTYPE_QUATERNION=2,G.ANIMATIONTYPE_MATRIX=3,G.ANIMATIONTYPE_COLOR3=4,G.ANIMATIONTYPE_COLOR4=7,G.ANIMATIONTYPE_VECTOR2=5,G.ANIMATIONTYPE_SIZE=6,G.ANIMATIONLOOPMODE_RELATIVE=0,G.ANIMATIONLOOPMODE_CYCLE=1,G.ANIMATIONLOOPMODE_CONSTANT=2,G.ANIMATIONLOOPMODE_YOYO=4,G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,G.CreateFromSnippetAsync=G.ParseFromSnippetAsync,(0,i.c)("BABYLON.Animation",G),U.d._AnimationRangeFactory=(y,g,f)=>new H.e(y,g,f)},12245:(y,g,f)=>{"use strict";f.d(g,{e:()=>p});class p{constructor(y,g,f){this.name=y,this.from=g,this.to=f}clone(){return new p(this.name,this.from,this.to)}}},11612:(y,g,f)=>{"use strict";var p=f(10723),S=f(10736),k=f(10797),i=f(10730);k.b.AudioEngineFactory=(y,g,f)=>new H(y,g,f);class H{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new p.d,this.onAudioLockedObservable=new p.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,i.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const S=document.createElement("audio");this._hostElement=y,this._audioContext=g,this._audioDestination=f;try{S&&S.canPlayType&&(S.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||S.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(k){}try{S&&S.canPlayType&&S.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(k){}}lock(){this._triggerSuspendedState()}unlock(){var y,g;if("running"===(null===(y=this._audioContext)||void 0===y?void 0:y.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(g=this._audioContext)||void 0===g||g.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var y;null===(y=this._audioContext)||void 0===y||y.addEventListener("statechange",(()=>{var y;this.unlocked&&"running"!==(null===(y=this._audioContext)||void 0===y?void 0:y.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var y;return null!==(y=this._audioContext)&&void 0!==y&&y.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(y){this.canUseWebAudio=!1,S.d.Error("Web Audio: "+y.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const y=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",g=document.createElement("style");g.appendChild(document.createTextNode(y)),document.getElementsByTagName("head")[0].appendChild(g),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(y){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=y)}connectToAnalyser(y){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=y,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12235:(y,g,f)=>{"use strict";f.d(g,{d:()=>i});var p=f(11054),S=f(11071),k=f(11336);class i extends k.d{get _matrix(){return this._compose(),this.Uj}set _matrix(y){(y.updateFlag!==this.Uj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Uj.p(y),this._markAsDirtyAndDecompose())}constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(y,g.va(),!1),this.name=y,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=g,this.Uj=(null===S||void 0===S?void 0:S.clone())??p.c.Identity(),this._restMatrix=k??this.Uj.clone(),this._bindMatrix=i??this.Uj.clone(),this._index=H,this._absoluteMatrix=new p.c,this._absoluteBindMatrix=new p.c,this._absoluteInverseBindMatrix=new p.c,this._finalMatrix=new p.c,g.bones.push(this),this.setParent(f,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(y){this.setParent(y)}setParent(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==y){if(this.parent){const y=this.parent.children.indexOf(this);-1!==y&&this.parent.children.splice(y,1)}this._parentNode=y,this.parent&&this.parent.children.push(this),g&&this._updateAbsoluteBindMatrices(),this.Vg()}}getLocalMatrix(){return this._compose(),this.Uj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(y){this._restMatrix.p(y)}setRestPose(y){this.setRestMatrix(y)}getBindPose(){return this.getBindMatrix()}setBindMatrix(y){this.Lj(y)}setBindPose(y){this.setBindMatrix(y)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const y=p.j.o[0],g=p.j.Quaternion[0],f=p.j.o[1];this.getRestMatrix().decompose(y,g,f),this._linkedTransformNode.position.p(f),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??p.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(g),this._linkedTransformNode.pe.p(y)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(y){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=y,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.le}set position(y){this._decompose(),this.le.p(y),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(y){this.setRotation(y)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(y){this.setRotationQuaternion(y)}get pe(){return this.getScale()}set pe(y){this.setScale(y)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=p.m.Zero(),this._localRotation=p.g.Zero(),this.le=p.m.Zero()),this.Uj.decompose(this._localScaling,this._localRotation,this.le))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,p.c.ComposeToRef(this._localScaling,this._localRotation,this.le,this.Uj)):this._needToCompose=!1)}Lj(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(y),g&&this._updateAbsoluteBindMatrices(),f?this._matrix=y:this.Vg()}_updateAbsoluteBindMatrices(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(y||(y=this._bindMatrix),this.parent?y.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(y),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),g)for(let f=0;f<this.children.length;f++)this.children[f]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Vg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Vg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Vg(),this._needToDecompose=!0}_updatePosition(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=this.getLocalMatrix();if(0==g)S?(k.addAtIndex(12,y.x),k.addAtIndex(13,y.y),k.addAtIndex(14,y.z)):k.setTranslationFromFloats(y.x,y.y,y.z);else{let g=null;f&&(g=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=i._TmpMats[0],U=i._TmpVecs[0];this.parent?f&&g?(H.p(this.parent.getAbsoluteMatrix()),H.multiplyToRef(g,H)):H.p(this.parent.getAbsoluteMatrix()):p.c.IdentityToRef(H),S&&H.setTranslationFromFloats(0,0,0),H.invert(),p.m.TransformCoordinatesToRef(y,H,U),S?(k.addAtIndex(12,U.x),k.addAtIndex(13,U.y),k.addAtIndex(14,U.z)):k.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()}translate(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;this._updatePosition(y,g,f,!0)}setPosition(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;this._updatePosition(y,g,f,!1)}setAbsolutePosition(y,g){this.setPosition(y,1,g)}scale(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.getLocalMatrix(),H=i._TmpMats[0];p.c.ScalingToRef(y,g,f,H),H.multiplyToRef(k,k),H.invert();for(const p of this.children){const S=p.getLocalMatrix();S.multiplyToRef(H,S),S.multiplyAtIndex(12,y),S.multiplyAtIndex(13,g),S.multiplyAtIndex(14,f),p._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),S)for(const p of this.children)p.scale(y,g,f,S)}setScale(y){this._decompose(),this._localScaling.p(y),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(y){this._decompose(),y.p(this._localScaling)}setYawPitchRoll(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4?arguments[4]:void 0;if(0===S){const H=i._TmpQuat;return p.g.RotationYawPitchRollToRef(y,g,f,H),void this.setRotationQuaternion(H,S,k)}const H=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(H,k))return;const U=i._TmpMats[1];p.c.RotationYawPitchRollToRef(y,g,f,U),H.multiplyToRef(U,U),this._rotateWithMatrix(U,S,k)}rotate(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3?arguments[3]:void 0;const k=i._TmpMats[0];k.setTranslationFromFloats(0,0,0),p.c.RotationAxisToRef(y,g,k),this._rotateWithMatrix(k,f,S)}setAxisAngle(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3?arguments[3]:void 0;if(0===f){const k=i._TmpQuat;return p.g.RotationAxisToRef(y,g,k),void this.setRotationQuaternion(k,f,S)}const k=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,S))return;const H=i._TmpMats[1];p.c.RotationAxisToRef(y,g,H),k.multiplyToRef(H,H),this._rotateWithMatrix(H,f,S)}setRotation(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(y.y,y.x,y.z,g,f)}setRotationQuaternion(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;if(0===g)return this._decompose(),this._localRotation.p(y),void this._markAsDirtyAndCompose();const S=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,f))return;const k=i._TmpMats[1];p.c.FromQuaternionToRef(y,k),S.multiplyToRef(k,k),this._rotateWithMatrix(k,g,f)}setRotationMatrix(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;if(0===g){const S=i._TmpQuat;return p.g.FromRotationMatrixToRef(y,S),void this.setRotationQuaternion(S,g,f)}const S=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,f))return;const k=i._TmpMats[1];k.p(y),S.multiplyToRef(y,k),this._rotateWithMatrix(k,g,f)}_rotateWithMatrix(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;const p=this.getLocalMatrix(),S=p.m[12],k=p.m[13],H=p.m[14],U=this.getParent(),l=i._TmpMats[3],c=i._TmpMats[4];U&&1==g?(f?(l.p(f.getWorldMatrix()),U.getAbsoluteMatrix().multiplyToRef(l,l)):l.p(U.getAbsoluteMatrix()),c.p(l),c.invert(),p.multiplyToRef(l,p),p.multiplyToRef(y,p),p.multiplyToRef(c,p)):1==g&&f?(l.p(f.getWorldMatrix()),c.p(l),c.invert(),p.multiplyToRef(l,p),p.multiplyToRef(y,p),p.multiplyToRef(c,p)):p.multiplyToRef(y,p),p.setTranslationFromFloats(S,k,H),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(y,g){const f=i._TmpMats[2];return y.p(this.getAbsoluteMatrix()),g?(y.multiplyToRef(g.getWorldMatrix(),y),p.c.ScalingToRef(g.pe.x,g.pe.y,g.pe.z,f)):p.c.IdentityToRef(f),y.invert(),!isNaN(y.m[0])&&(f.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyToRef(f,y),!0)}eb(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=p.m.Zero();return this.getPositionToRef(y,g,f),f}getPositionToRef(){let y=arguments.length>1?arguments[1]:void 0,g=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const y=this.getLocalMatrix();g.x=y.m[12],g.y=y.m[13],g.z=y.m[14]}else{let f=null;y&&(f=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let p=i._TmpMats[0];y&&f?(p.p(this.getAbsoluteMatrix()),p.multiplyToRef(f,p)):p=this.getAbsoluteMatrix(),g.x=p.m[12],g.y=p.m[13],g.z=p.m[14]}}getAbsolutePosition(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const g=p.m.Zero();return this.getPositionToRef(1,y,g),g}getAbsolutePositionToRef(y,g){this.getPositionToRef(1,y,g)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Uj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Uj);const y=this._skeleton.getPoseMatrix();y&&this._absoluteMatrix.multiplyToRef(y,this._absoluteMatrix)}const y=this.children,g=y.length;for(let f=0;f<g;f++)y[f].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}_e(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=p.m.Zero();return this.getDirectionToRef(y,g,f),f}getDirectionToRef(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,S=null;g&&(S=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=i._TmpMats[0];k.p(this.getAbsoluteMatrix()),g&&S&&k.multiplyToRef(S,k),p.m.TransformNormalToRef(y,k,f),f.normalize()}getRotation(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=p.m.Zero();return this.getRotationToRef(y,g,f),f}getRotationToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;const p=i._TmpQuat;this.getRotationQuaternionToRef(y,g,p),p.toEulerAnglesToRef(f)}getRotationQuaternion(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=p.g.Identity();return this.getRotationQuaternionToRef(y,g,f),f}getRotationQuaternionToRef(){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),g.p(this._localRotation);else{const f=i._TmpMats[0],p=this.getAbsoluteMatrix();y?p.multiplyToRef(y.getWorldMatrix(),f):f.p(p),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.decompose(void 0,g,void 0)}}getRotationMatrix(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1?arguments[1]:void 0;const f=p.c.Identity();return this.getRotationMatrixToRef(y,g,f),f}getRotationMatrixToRef(){let y=arguments.length>1?arguments[1]:void 0,g=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(g);else{const f=i._TmpMats[0],p=this.getAbsoluteMatrix();y?p.multiplyToRef(y.getWorldMatrix(),f):f.p(p),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.getRotationMatrixToRef(g)}}getAbsolutePositionFromLocal(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=p.m.Zero();return this.getAbsolutePositionFromLocalToRef(y,g,f),f}getAbsolutePositionFromLocalToRef(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,S=null;g&&(S=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=i._TmpMats[0];k.p(this.getAbsoluteMatrix()),g&&S&&k.multiplyToRef(S,k),p.m.TransformCoordinatesToRef(y,k,f)}getLocalPositionFromAbsolute(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=p.m.Zero();return this.getLocalPositionFromAbsoluteToRef(y,g,f),f}getLocalPositionFromAbsoluteToRef(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,S=null;g&&(S=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=i._TmpMats[0];k.p(this.getAbsoluteMatrix()),g&&S&&k.multiplyToRef(S,k),k.invert(),p.m.TransformCoordinatesToRef(y,k,f)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}i._TmpVecs=(0,S.d)(2,p.m.Zero),i._TmpQuat=p.g.Identity(),i._TmpMats=(0,S.d)(5,p.c.Identity)},11131:(y,g,f)=>{"use strict";f.d(g,{b:()=>k,c:()=>i});var p=f(11133),S=f(10736);class k{get u(){return this._isDisposed}constructor(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,y&&y.va?this._engine=y.va().getEngine():this._engine=y,this._updatable=f,this._instanced=i,this._divisor=U||1,this._label=l,g instanceof p.b?(this._data=null,this._buffer=g):(this._data=g,this._buffer=null),this.byteStride=H?S:S*Float32Array.BYTES_PER_ELEMENT,k||this.create()}createVertexBuffer(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6?arguments[6]:void 0;const U=k?g:g*Float32Array.BYTES_PER_ELEMENT,l=p?k?p:p*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new i(this._engine,this,y,this._updatable,!0,l,void 0===S?this._instanced:S,U,f,void 0,void 0,!0,this._divisor||H)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!y&&this._buffer||(y=y||this._data,y&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,y),this._data=y):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(y,this._label),this._data=y):this._buffer=this._engine.createVertexBuffer(y,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.sb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.sb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.sb,void 0,this._label));S.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(y){this.create(y)}updateDirectly(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,y,p?g:g*Float32Array.BYTES_PER_ELEMENT,f?f*this.byteStride:void 0),this._data=0===g&&void 0===f?y:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class i{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(y){const g=0!=y;this._instanceDivisor=y,g!==this._instanced&&(this._instanced=g,this._computeHashCode())}get _maxVerticesCount(){const y=this.getData();return y?Array.isArray(y)?y.length/(this.byteStride/4)-this.byteOffset/4:(y.byteLength-this.byteOffset)/this.byteStride:0}constructor(y,g,f,p,S,H,U,l,c,Z){let C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]&&arguments[11],W=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,j=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let P=!1;if(this.Ed=y,"object"===typeof p&&null!==p?(P=p.updatable??!1,S=p.postponeInternalCreation,H=p.stride,U=p.instanced,l=p.offset,c=p.size,Z=p.type,C=p.normalized??!1,q=p.useBytes??!1,W=p.divisor??1,j=p.takeBufferOwnership??!1,this._label=p.label):P=!!p,g instanceof k?(this._buffer=g,this._ownsBuffer=j):(this._buffer=new k(y,g,P,H,S,U,q,W,this._label),this._ownsBuffer=!0),this.uniqueId=i._Counter++,this._kind=f,void 0===Z){const y=this.getData();this.type=y?i.GetDataType(y):i.FLOAT}else this.type=Z;const B=i.GetTypeByteLength(this.type);q?(this._size=c||(H?H/B:i.DeduceStride(f)),this.byteStride=H||this._buffer.byteStride||this._size*B,this.byteOffset=l||0):(this._size=c||H||i.DeduceStride(f),this.byteStride=H?H*B:this._buffer.byteStride||this._size*B,this.byteOffset=(l||0)*B),this.normalized=C,this._instanced=void 0!==U&&U,this._instanceDivisor=U?W:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var y;null===(y=this._buffer)||void 0===y||y._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(y,g){const f=this.getData();return f?i.GetFloatData(f,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,y,g):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/i.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/i.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*i.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(y){this._buffer.create(y),this._alignBuffer()}update(y){this._buffer.update(y),this._alignBuffer()}updateDirectly(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(y,g,void 0,f),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(y,g){i.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,y,this.normalized,g)}_alignBuffer(){}static DeduceStride(y){switch(y){case i.UVKind:case i.UV2Kind:case i.UV3Kind:case i.UV4Kind:case i.UV5Kind:case i.UV6Kind:return 2;case i.NormalKind:case i.PositionKind:return 3;case i.ColorKind:case i.ColorInstanceKind:case i.MatricesIndicesKind:case i.MatricesIndicesExtraKind:case i.MatricesWeightsKind:case i.MatricesWeightsExtraKind:case i.TangentKind:return 4;default:throw new Error("Invalid kind '"+y+"'")}}static GetDataType(y){return y instanceof Int8Array?i.BYTE:y instanceof Uint8Array?i.UNSIGNED_BYTE:y instanceof Int16Array?i.SHORT:y instanceof Uint16Array?i.UNSIGNED_SHORT:y instanceof Int32Array?i.INT:y instanceof Uint32Array?i.UNSIGNED_INT:i.FLOAT}static GetTypeByteLength(y){switch(y){case i.BYTE:case i.UNSIGNED_BYTE:return 1;case i.SHORT:case i.UNSIGNED_SHORT:return 2;case i.INT:case i.UNSIGNED_INT:case i.FLOAT:return 4;default:throw new Error(`Invalid type '${y}'`)}}static ForEach(y,g,f,p,S,k,H,U){if(y instanceof Array){let S=g/4;const i=f/4;for(let g=0;g<k;g+=p){for(let f=0;f<p;f++)U(y[S+f],g+f);S+=i}}else{const l=y instanceof ArrayBuffer?new DataView(y):new DataView(y.buffer,y.byteOffset,y.byteLength),c=i.GetTypeByteLength(S);for(let y=0;y<k;y+=p){let k=g;for(let g=0;g<p;g++){U(i._GetFloatValue(l,S,k,H),y+g),k+=c}g+=f}}}static _GetFloatValue(y,g,f,p){switch(g){case i.BYTE:{let g=y.getInt8(f);return p&&(g=Math.max(g/127,-1)),g}case i.UNSIGNED_BYTE:{let g=y.getUint8(f);return p&&(g/=255),g}case i.SHORT:{let g=y.getInt16(f,!0);return p&&(g=Math.max(g/32767,-1)),g}case i.UNSIGNED_SHORT:{let g=y.getUint16(f,!0);return p&&(g/=65535),g}case i.INT:return y.getInt32(f,!0);case i.UNSIGNED_INT:return y.getUint32(f,!0);case i.FLOAT:return y.getFloat32(f,!0);default:throw new Error(`Invalid component type ${g}`)}}static GetFloatData(y,g,f,p,k,H,U,l){const c=g*i.GetTypeByteLength(f),Z=U*g;if(f!==i.FLOAT||k!==c){const S=new Float32Array(Z);return i.ForEach(y,p,k,g,f,Z,H,((y,g)=>S[g]=y)),S}if(!(y instanceof Array||y instanceof Float32Array)||0!==p||y.length!==Z){if(y instanceof Array){const g=p/4;return y.slice(g,g+Z)}if(y instanceof ArrayBuffer)return new Float32Array(y,p,Z);{const g=y.byteOffset+p;if(0!==(3&g)&&(S.d.Warn("Float array must be aligned to 4-bytes border"),l=!0),l){const f=new Uint8Array(Z*Float32Array.BYTES_PER_ELEMENT),p=new Uint8Array(y.buffer,g,f.length);return f.set(p),new Float32Array(f.buffer)}return new Float32Array(y.buffer,g,Z)}}return l?y.slice():y}}i._Counter=0,i.BYTE=5120,i.UNSIGNED_BYTE=5121,i.SHORT=5122,i.UNSIGNED_SHORT=5123,i.INT=5124,i.UNSIGNED_INT=5125,i.FLOAT=5126,i.PositionKind="position",i.NormalKind="normal",i.TangentKind="tangent",i.UVKind="uv",i.UV2Kind="uv2",i.UV3Kind="uv3",i.UV4Kind="uv4",i.UV5Kind="uv5",i.UV6Kind="uv6",i.ColorKind="color",i.ColorInstanceKind="instanceColor",i.MatricesIndicesKind="matricesIndices",i.MatricesWeightsKind="matricesWeights",i.MatricesIndicesExtraKind="matricesIndicesExtra",i.MatricesWeightsExtraKind="matricesWeightsExtra"},11133:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{get underlyingResource(){return null}constructor(){this.references=0,this.sb=0,this.is32Bits=!1,this.uniqueId=p._Counter++}}p._Counter=0},12744:(y,g,f)=>{"use strict";f.d(g,{b:()=>r});var p=f(11021),S=f(11026),k=f(10723),i=f(11054),H=f(11336),U=f(11321),l=f(11156),c=f(10747),Z=f(11062);class C{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(y){this._zoomStopsAnimation=y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(y){this._idleRotationSpeed=y}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(y){this._idleRotationWaitTime=y}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(y){this._idleRotationSpinupTime=y}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(y){this._attachedCamera=y;const g=this._attachedCamera.va();this._onPrePointerObservableObserver=g.onPrePointerObservable.add((y=>{y.type!==l.d.POINTERDOWN?y.type===l.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const y=c.c.Now;let g=0;null!=this._lastFrameTime&&(g=y-this._lastFrameTime),this._lastFrameTime=y,this._applyUserInteraction();const f=y-this._lastInteractionTime-this._idleRotationWaitTime,p=Math.max(Math.min(f/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*p,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(g/1e3))}))}detach(){if(!this._attachedCamera)return;const y=this._attachedCamera.va();this._onPrePointerObservableObserver&&y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(y){this._lastInteractionTime=y??c.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let y=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(y=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?y:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=c.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}f(11565);class q{constructor(){this._easingMode=q.EASINGMODE_EASEIN}setEasingMode(y){const g=Math.min(Math.max(y,0),2);this._easingMode=g}getEasingMode(){return this._easingMode}easeInCore(y){throw new Error("You must implement this method")}ease(y){switch(this._easingMode){case q.EASINGMODE_EASEIN:return this.easeInCore(y);case q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-y)}return y>=.5?.5*(1-this.easeInCore(2*(1-y)))+.5:.5*this.easeInCore(2*y)}}q.EASINGMODE_EASEIN=0,q.EASINGMODE_EASEOUT=1,q.EASINGMODE_EASEINOUT=2;var W=f(12241);class j{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(y){if(this._autoTransitionRange===y)return;this._autoTransitionRange=y;const g=this._attachedCamera;g&&(y?this._onMeshTargetChangedObserver=g.onMeshTargetChangedObservable.add((y=>{if(y&&(y.Sj(!0),y.getBoundingInfo)){const g=y.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*g,this.upperRadiusTransitionRange=.05*g}})):this._onMeshTargetChangedObserver&&g.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(y){this._attachedCamera=y,this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(y){return!!this._attachedCamera&&(this._attachedCamera.radius===y&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(y){if(!this._attachedCamera)return;this._radiusBounceTransition||(j.EasingFunction.setEasingMode(j.EasingMode),this._radiusBounceTransition=W.c.CreateAnimation("radius",W.c.ANIMATIONTYPE_FLOAT,60,j.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const g=W.c.TransitionTo("radius",this._attachedCamera.radius+y,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));g&&this._animatables.push(g)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}j.EasingFunction=new class extends q{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=y}easeInCore(y){const g=Math.max(0,this.amplitude);return Math.pow(y,3)-y*g*Math.sin(3.141592653589793*y)}}(.3),j.EasingMode=q.EASINGMODE_EASEOUT;class P{constructor(){this.onTargetFramingAnimationEndObservable=new k.d,this._mode=P.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(y){this._mode=y}get mode(){return this._mode}set radiusScale(y){this._radiusScale=y}get radiusScale(){return this._radiusScale}set positionScale(y){this._positionScale=y}get positionScale(){return this._positionScale}set defaultElevation(y){this._defaultElevation=y}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(y){this._elevationReturnTime=y}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(y){this._elevationReturnWaitTime=y}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(y){this._zoomStopsAnimation=y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(y){this._framingTime=y}get framingTime(){return this._framingTime}init(){}attach(y){this._attachedCamera=y;const g=this._attachedCamera.va();P.EasingFunction.setEasingMode(P.EasingMode),this._onPrePointerObservableObserver=g.onPrePointerObservable.add((y=>{y.type!==l.d.POINTERDOWN?y.type===l.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=y.onMeshTargetChangedObservable.add((y=>{y&&y.getBoundingInfo&&this.zoomOnMesh(y,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const y=this._attachedCamera.va();this._onPrePointerObservableObserver&&y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.Sj(!0);const p=y.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(p.minimumWorld,p.maximumWorld,g,f)}zoomOnMeshHierarchy(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.Sj(!0);const p=y.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(p.min,p.max,g,f)}zoomOnMeshesHierarchy(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new i.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=new i.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let k=0;k<y.length;k++){const g=y[k].getHierarchyBoundingVectors(!0);i.m.CheckExtends(g.min,p,S),i.m.CheckExtends(g.max,p,S)}this.zoomOnBoundingInfo(p,S,g,f)}zoomOnBoundingInfo(y,g){let f,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const k=y.y,H=k+(g.y-k)*this._positionScale,U=g.ed(y).scale(.5);if(p)f=new i.m(0,H,0);else{const g=y.add(U);f=new i.m(g.x,H,g.z)}this._vectorTransition||(this._vectorTransition=W.c.CreateAnimation("target",W.c.ANIMATIONTYPE_VECTOR3,60,P.EasingFunction)),this._betaIsAnimating=!0;let l=W.c.TransitionTo("target",f,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);let c=0;if(this._mode===P.FitFrustumSidesMode){const f=this._calculateLowerRadiusFromModelBoundingSphere(y,g);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=U.length()+this._attachedCamera.$i),c=f}else this._mode===P.IgnoreBoundsSizeMode&&(c=this._calculateLowerRadiusFromModelBoundingSphere(y,g),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.$i));if(this.autoCorrectCameraLimitsAndSensibility){const f=g.ed(y).length();this._attachedCamera.panningSensibility=5e3/f,this._attachedCamera.wheelPrecision=100/c}return this._radiusTransition||(this._radiusTransition=W.c.CreateAnimation("radius",W.c.ANIMATIONTYPE_FLOAT,60,P.EasingFunction)),l=W.c.TransitionTo("radius",c,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),S&&S(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),l&&this._animatables.push(l),!0}_calculateLowerRadiusFromModelBoundingSphere(y,g){const f=this._attachedCamera;if(!f)return 0;let p=f._calculateLowerRadiusFromModelBoundingSphere(y,g,this._radiusScale);return f.lowerRadiusLimit&&this._mode===P.IgnoreBoundsSizeMode&&(p=p<f.lowerRadiusLimit?f.lowerRadiusLimit:p),f.upperRadiusLimit&&(p=p>f.upperRadiusLimit?f.upperRadiusLimit:p),p}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const y=c.c.Now-this._lastInteractionTime,g=.5*Math.PI-this._defaultElevation,f=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>f&&y>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=W.c.CreateAnimation("beta",W.c.ANIMATIONTYPE_FLOAT,60,P.EasingFunction));const y=W.c.TransitionTo("beta",g,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));y&&this._animatables.push(y)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=c.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}P.EasingFunction=new class extends q{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=y}easeInCore(y){return this.exponent<=0?y:(Math.exp(this.exponent*y)-1)/(Math.exp(this.exponent)-1)}},P.EasingMode=q.EASINGMODE_EASEINOUT,P.IgnoreBoundsSizeMode=0,P.FitFrustumSidesMode=1;var B=f(11334),R=f(12226),G=f(12231),z=f(10714);class T{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(y){y=z.e.BackCompatCameraNoPreventDefault(arguments);const g=this.camera.getEngine(),f=g.getInputElement();let p=0,S=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=k=>{var i,H;const U=k.event,c="touch"===U.pointerType;if(k.type!==l.d.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const Z=U.target;if(this._altKey=U.altKey,this._ctrlKey=U.ctrlKey,this._metaKey=U.metaKey,this._shiftKey=U.shiftKey,this._buttonsPressed=U.buttons,g.isPointerLock){const y=U.movementX,g=U.movementY;this.onTouch(null,y,g),this._pointA=null,this._pointB=null}else{if(k.type!==l.d.POINTERDOWN&&k.type!==l.d.POINTERDOUBLETAP&&c&&(null===(i=this._pointA)||void 0===i?void 0:i.pointerId)!==U.pointerId&&(null===(H=this._pointB)||void 0===H?void 0:H.pointerId)!==U.pointerId)return;if(k.type!==l.d.POINTERDOWN||-1!==this._currentActiveButton&&!c)if(k.type===l.d.POINTERDOUBLETAP)this.onDoubleTap(U.pointerType);else if(k.type!==l.d.POINTERUP||this._currentActiveButton!==U.button&&!c){if(k.type===l.d.POINTERMOVE)if(y||U.preventDefault(),this._pointA&&null===this._pointB){const y=U.clientX-this._pointA.x,g=U.clientY-this._pointA.y;this._pointA.x=U.clientX,this._pointA.y=U.clientY,this.onTouch(this._pointA,y,g)}else if(this._pointA&&this._pointB){const y=this._pointA.pointerId===U.pointerId?this._pointA:this._pointB;y.x=U.clientX,y.y=U.clientY;const g=this._pointA.x-this._pointB.x,f=this._pointA.y-this._pointB.y,i=g*g+f*f,H={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:U.pointerId,type:k.type};this.onMultiTouch(this._pointA,this._pointB,p,i,S,H),S=H,p=i}}else{try{null===Z||void 0===Z||Z.releasePointerCapture(U.pointerId)}catch(C){}c||(this._pointB=null),g._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==U.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==U.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==p||S)&&(this.onMultiTouch(this._pointA,this._pointB,p,0,S,null),p=0,S=null),this._currentActiveButton=-1,this.onButtonUp(U),y||U.preventDefault()}else{try{null===Z||void 0===Z||Z.setPointerCapture(U.pointerId)}catch(C){}if(null===this._pointA)this._pointA={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType};else{if(null!==this._pointB)return;this._pointB={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType}}-1!==this._currentActiveButton||c||(this._currentActiveButton=U.button),this.onButtonDown(U),y||(U.preventDefault(),f&&f.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,l.d.POINTERDOWN|l.d.POINTERUP|l.d.POINTERMOVE|l.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,p=0,S=null,this.onLostFocus()},this._contextMenuBind=y=>this.onContextMenu(y),f&&f.addEventListener("contextmenu",this._contextMenuBind,!1);const k=this.camera.va().getEngine().getHostWindow();k&&z.e.RegisterTopRootEvents(k,[{name:"blur",handler:this._onLostFocus}])}Wi(){if(this._onLostFocus){const y=this.camera.va().getEngine().getHostWindow();y&&z.e.UnregisterTopRootEvents(y,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const y=this.camera.va().getEngine().getInputElement();y&&y.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(y){}onTouch(y,g,f){}onMultiTouch(y,g,f,p,S,k){}onContextMenu(y){y.preventDefault()}onButtonDown(y){}onButtonUp(y){}onLostFocus(){}}(0,p.c)([(0,S.I)()],T.prototype,"buttons",void 0);class Q extends T{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(y,g){if(0!==this.panningSensibility&&y&&g){const f=g.x-y.x,p=g.y-y.y;this.camera.inertialPanningX+=-f/this.panningSensibility,this.camera.inertialPanningY+=p/this.panningSensibility}}_computePinchZoom(y,g){const f=this.camera.radius||Q.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=f*Math.sqrt(y)/Math.sqrt(g):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(g-y)*f*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(g-y)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(y,g,f){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-g/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility):(this.camera.inertialAlphaOffset-=g/this.angularSensibilityX,this.camera.inertialBetaOffset-=f/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(y,g,f,p,S,k){0===f&&null===S||0===p&&null===k||(this.multiTouchPanAndZoom?(this._computePinchZoom(f,p),this._computeMultiTouchPanning(S,k)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(p)-Math.sqrt(f))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(f,p),this._isPinching=!0):this._computeMultiTouchPanning(S,k)):this.multiTouchPanning?this._computeMultiTouchPanning(S,k):this.pinchZoom&&this._computePinchZoom(f,p))}onButtonDown(y){this._isPanClick=y.button===this.camera._panningMouseButton}onButtonUp(y){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Q.MinimumRadiusForPinch=.001,(0,p.c)([(0,S.I)()],Q.prototype,"buttons",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"angularSensibilityX",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"angularSensibilityY",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"pinchPrecision",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"pinchDeltaPercentage",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"useNaturalPinchZoom",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"pinchZoom",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"panningSensibility",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"multiTouchPanning",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"multiTouchPanAndZoom",void 0),G.c.ArcRotateCameraPointersInput=Q;var m=f(11161);class a{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(y){y=z.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((g=>{const f=g.event;if(!f.metaKey)if(g.type===m.d.KEYDOWN){if(this._ctrlPressed=f.ctrlKey,this._altPressed=f.altKey,-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysReset.indexOf(f.keyCode)){-1===this._keys.indexOf(f.keyCode)&&this._keys.push(f.keyCode),f.preventDefault&&(y||f.preventDefault())}}else if(-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysReset.indexOf(f.keyCode)){const g=this._keys.indexOf(f.keyCode);g>=0&&this._keys.splice(g,1),f.preventDefault&&(y||f.preventDefault())}})))}Wi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const y=this.camera;for(let g=0;g<this._keys.length;g++){const f=this._keys[g];-1!==this.keysLeft.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningX-=1/this.panningSensibility:y.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?y.inertialRadiusOffset+=1/this.zoomingSensibility:y.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningX+=1/this.panningSensibility:y.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?y.inertialRadiusOffset-=1/this.zoomingSensibility:y.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(f)&&y.useInputToRestoreState&&y.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,p.c)([(0,S.I)()],a.prototype,"keysUp",void 0),(0,p.c)([(0,S.I)()],a.prototype,"keysDown",void 0),(0,p.c)([(0,S.I)()],a.prototype,"keysLeft",void 0),(0,p.c)([(0,S.I)()],a.prototype,"keysRight",void 0),(0,p.c)([(0,S.I)()],a.prototype,"keysReset",void 0),(0,p.c)([(0,S.I)()],a.prototype,"panningSensibility",void 0),(0,p.c)([(0,S.I)()],a.prototype,"zoomingSensibility",void 0),(0,p.c)([(0,S.I)()],a.prototype,"useAltToZoom",void 0),(0,p.c)([(0,S.I)()],a.prototype,"angularSpeed",void 0),G.c.ArcRotateCameraKeyboardMoveInput=a;var w=f(11181),o=f(11165),I=f(11079);class Y{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new i.m(0,0,0),this._globalOffset=new i.m(0,0,0),this._inertialPanning=i.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(y,g){let f=0;const p=.01*y*this.wheelDeltaPercentage*g;return f=y>0?p/(1+this.wheelDeltaPercentage):p*(1+this.wheelDeltaPercentage),f}attachControl(y){y=z.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=g=>{if(g.type!==l.d.POINTERWHEEL)return;const f=g.event;let p=0;const S=f.deltaMode===o.e.DOM_DELTA_LINE?40:1,k=-f.deltaY*S;if(this.customComputeDeltaFromMouseWheel)p=this.customComputeDeltaFromMouseWheel(k,this,f);else if(this.wheelDeltaPercentage){if(p=this._computeDeltaFromMouseWheelLegacyEvent(k,this.camera.radius),p>0){let y=this.camera.radius,g=this.camera.inertialRadiusOffset+p;for(let f=0;f<20&&Math.abs(g)>.001;f++)y-=g,g*=this.camera.inertia;y=(0,I.d)(y,0,Number.MAX_VALUE),p=this._computeDeltaFromMouseWheelLegacyEvent(k,y)}}else p=k/(40*this.wheelPrecision);p&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(p)):this.camera.inertialRadiusOffset+=p),f.preventDefault&&(y||f.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,l.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.me(0)}Wi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const y=this.camera;0+y.inertialAlphaOffset+y.inertialBetaOffset+y.inertialRadiusOffset&&(this._updateHitPlane(),y.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(y.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const y=this.camera,g=y.target.ed(y.position);this._hitPlane=w.b.FromPositionAndNormal(y.target,g)}_getPosition(){const y=this.camera,g=y.va(),f=g.createPickingRay(g.pointerX,g.pointerY,i.c.Identity(),y,!1);0===y.targetScreenOffset.x&&0===y.targetScreenOffset.y||(this._viewOffset.set(y.targetScreenOffset.x,y.targetScreenOffset.y,0),y.getViewMatrix().invertToRef(y._cameraTransformMatrix),this._globalOffset=i.m.TransformNormal(this._viewOffset,y._cameraTransformMatrix),f.origin.addInPlace(this._globalOffset));let p=0;return this._hitPlane&&(p=f.intersectsPlane(this._hitPlane)??0),f.origin.addInPlace(f.direction.scaleInPlace(p))}_zoomToMouse(y){const g=this.camera,f=1-g.inertia;if(g.lowerRadiusLimit){const p=g.lowerRadiusLimit??0;g.radius-(g.inertialRadiusOffset+y)/f<p&&(y=(g.radius-p)*f-g.inertialRadiusOffset)}if(g.upperRadiusLimit){const p=g.upperRadiusLimit??0;g.radius-(g.inertialRadiusOffset+y)/f>p&&(y=(g.radius-p)*f-g.inertialRadiusOffset)}const p=y/f/g.radius,S=this._getPosition(),k=i.j.o[6];S.subtractToRef(g.target,k),k.scaleInPlace(p),k.scaleInPlace(f),this._inertialPanning.addInPlace(k),g.inertialRadiusOffset+=y}_zeroIfClose(y){Math.abs(y.x)<Z.e&&(y.x=0),Math.abs(y.y)<Z.e&&(y.y=0),Math.abs(y.z)<Z.e&&(y.z=0)}}(0,p.c)([(0,S.I)()],Y.prototype,"wheelPrecision",void 0),(0,p.c)([(0,S.I)()],Y.prototype,"zoomToMouseLocation",void 0),(0,p.c)([(0,S.I)()],Y.prototype,"wheelDeltaPercentage",void 0),G.c.ArcRotateCameraMouseWheelInput=Y;class n extends G.e{constructor(y){super(y)}addMouseWheel(){return this.add(new Y),this}addPointers(){return this.add(new Q),this}addKeyboard(){return this.add(new a),this}}var M=f(10871);H.d.AddNodeConstructor("ArcRotateCamera",((y,g)=>()=>new r(y,0,0,1,i.m.Zero(),g)));class r extends R.e{get target(){return this._target}set target(y){this.setTarget(y)}get targetHost(){return this._targetHost}set targetHost(y){y&&this.setTarget(y)}getTarget(){return this.target}get position(){return this._position}set position(y){this.setPosition(y)}set upVector(y){this._upToYMatrix||(this._yToUpMatrix=new i.c,this._upToYMatrix=new i.c,this._upVector=i.m.Zero()),y.normalize(),this._upVector.p(y),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){i.c.RotationAlignToRef(i.m.UpReadOnly,this._upVector,this._yToUpMatrix),i.c.RotationAlignToRef(this._upVector,i.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const y=this.inputs.attached.pointers;return y?y.angularSensibilityX:0}set angularSensibilityX(y){const g=this.inputs.attached.pointers;g&&(g.angularSensibilityX=y)}get angularSensibilityY(){const y=this.inputs.attached.pointers;return y?y.angularSensibilityY:0}set angularSensibilityY(y){const g=this.inputs.attached.pointers;g&&(g.angularSensibilityY=y)}get pinchPrecision(){const y=this.inputs.attached.pointers;return y?y.pinchPrecision:0}set pinchPrecision(y){const g=this.inputs.attached.pointers;g&&(g.pinchPrecision=y)}get pinchDeltaPercentage(){const y=this.inputs.attached.pointers;return y?y.pinchDeltaPercentage:0}set pinchDeltaPercentage(y){const g=this.inputs.attached.pointers;g&&(g.pinchDeltaPercentage=y)}get useNaturalPinchZoom(){const y=this.inputs.attached.pointers;return!!y&&y.useNaturalPinchZoom}set useNaturalPinchZoom(y){const g=this.inputs.attached.pointers;g&&(g.useNaturalPinchZoom=y)}get panningSensibility(){const y=this.inputs.attached.pointers;return y?y.panningSensibility:0}set panningSensibility(y){const g=this.inputs.attached.pointers;g&&(g.panningSensibility=y)}get keysUp(){const y=this.inputs.attached.keyboard;return y?y.keysUp:[]}set keysUp(y){const g=this.inputs.attached.keyboard;g&&(g.keysUp=y)}get keysDown(){const y=this.inputs.attached.keyboard;return y?y.keysDown:[]}set keysDown(y){const g=this.inputs.attached.keyboard;g&&(g.keysDown=y)}get keysLeft(){const y=this.inputs.attached.keyboard;return y?y.keysLeft:[]}set keysLeft(y){const g=this.inputs.attached.keyboard;g&&(g.keysLeft=y)}get keysRight(){const y=this.inputs.attached.keyboard;return y?y.keysRight:[]}set keysRight(y){const g=this.inputs.attached.keyboard;g&&(g.keysRight=y)}get wheelPrecision(){const y=this.inputs.attached.mousewheel;return y?y.wheelPrecision:0}set wheelPrecision(y){const g=this.inputs.attached.mousewheel;g&&(g.wheelPrecision=y)}get zoomToMouseLocation(){const y=this.inputs.attached.mousewheel;return!!y&&y.zoomToMouseLocation}set zoomToMouseLocation(y){const g=this.inputs.attached.mousewheel;g&&(g.zoomToMouseLocation=y)}get wheelDeltaPercentage(){const y=this.inputs.attached.mousewheel;return y?y.wheelDeltaPercentage:0}set wheelDeltaPercentage(y){const g=this.inputs.attached.mousewheel;g&&(g.wheelDeltaPercentage=y)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(y){y!==this.useBouncingBehavior&&(y?(this._bouncingBehavior=new j,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(y){y!==this.useFramingBehavior&&(y?(this._framingBehavior=new P,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(y){y!==this.useAutoRotationBehavior&&(y?(this._autoRotationBehavior=new C,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(y,g,f,p,S,H){var U;let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(y,i.m.Zero(),H,l),U=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=i.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=i.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new i.c,this.panningAxis=new i.m(1,1,0),this._transformedDirection=new i.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new k.d,this.checkCollisions=!1,this.collisionRadius=new i.m(.5,.5,.5),this._previousPosition=i.m.Zero(),this._collisionVelocity=i.m.Zero(),this._newPosition=i.m.Zero(),this._computationVector=i.m.Zero(),this._onCollisionPositionChange=function(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f?(U.setPosition(g),U.Mk&&U.Mk(f)):U._previousPosition.p(U._position);const p=Math.cos(U.alpha),S=Math.sin(U.alpha),k=Math.cos(U.beta);let i=Math.sin(U.beta);0===i&&(i=1e-4);const H=U._getTargetPosition();U._computationVector.ne(U.radius*p*i,U.radius*k,U.radius*S*i),H.addToRef(U._computationVector,U._newPosition),U._position.p(U._newPosition);let l=U.upVector;U.allowUpsideDown&&U.beta<0&&(l=l.clone(),l=l.negate()),U._computeViewMatrix(U._position,H,l),U._viewMatrix.addAtIndex(12,U.targetScreenOffset.x),U._viewMatrix.addAtIndex(13,U.targetScreenOffset.y),U._collisionTriggered=!1},this._target=i.m.Zero(),S&&this.setTarget(S),this.alpha=g,this.beta=f,this.radius=p,this.getViewMatrix(),this.inputs=new n(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new i.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=i.l.Zero()}_updateCache(y){y||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const y=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?y.addToRef(this._targetBoundingCenter,this._target):this._target.p(y)}const y=this._getLockedTargetPosition();return y||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const S=arguments;g=z.e.BackCompatCameraNoPreventDefault(S),this._useCtrlForPanning=f,this._panningMouseButton=p,"boolean"===typeof S[0]&&(S.length>1&&(this._useCtrlForPanning=S[1]),S.length>2&&(this._panningMouseButton=S[2])),this.inputs.attachElement(g),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Wi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const y=this._scene.getEngine().getDeltaTime()/1e3,g=1-Math.pow(2,-y/this.restoreStateInterpolationFactor);this.setTarget(i.m.Lerp(this.getTarget(),this._storedTarget,g)),i.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,i.j.Quaternion[0]),i.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,i.j.Quaternion[1]),i.g.SlerpToRef(i.j.Quaternion[1],i.j.Quaternion[0],g,i.j.Quaternion[2]),i.j.Quaternion[2].normalize(),i.j.Quaternion[2].toAlphaBetaGammaToRef(i.j.o[0]),this.alpha=i.j.o[0].x,this.beta=i.j.o[0].y,this.radius+=(this._storedRadius-this.radius)*g,i.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,g,this.targetScreenOffset),(i.m.DistanceSquared(this.getTarget(),this._storedTarget)<Z.e&&i.j.Quaternion[2].equalsWithEpsilon(i.j.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<Z.e&&i.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<Z.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const y=this.invertRotation?-1:1,g=this._calculateHandednessMultiplier();let f=this.inertialAlphaOffset*g;this.beta<0&&(f*=-1),this.alpha+=f*y,this.beta+=this.inertialBetaOffset*y,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const y=new i.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),y.multiplyInPlace(this.panningAxis),i.m.TransformNormalToRef(y,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const y=this.upVector,g=i.m.CrossToRef(this._transformedDirection,y,this._transformedDirection);i.m.CrossToRef(y,g,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);i.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const y=i.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(y),y.transposeToRef(y),i.m.TransformCoordinatesToRef(this._transformedDirection,y,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const y=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const g=Math.round((y-this.alpha)/(2*Math.PI));this.alpha+=2*g*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(y){this._position.equals(y)||(this._position.p(y),this.rebuildAnglesAndRadius())}setTarget(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(p=this.overrideCloneAlphaBetaRadius??p,y.Sj)g&&y.getBoundingInfo?this._targetBoundingCenter=y.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,y.Sj(),this._targetHost=y,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const g=y,p=this._getTargetPosition();if(p&&!f&&p.equals(g))return;this._targetHost=null,this._target=g,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}p||this.rebuildAnglesAndRadius()}_getViewMatrix(){const y=Math.cos(this.alpha),g=Math.sin(this.alpha),f=Math.cos(this.beta);let p=Math.sin(this.beta);0===p&&(p=1e-4),0===this.radius&&(this.radius=1e-4);const S=this._getTargetPosition();if(this._computationVector.ne(this.radius*y*p,this.radius*f,this.radius*g*p),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),S.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const y=this.va().collisionCoordinator;this._collider||(this._collider=y.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,y.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let y=this.upVector;this.allowUpsideDown&&p<0&&(y=y.negate()),this._computeViewMatrix(this._position,S,y),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=S,this._viewMatrix}zoomOn(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y=y||this.va().meshes;const f=U.e.MinMax(y);let p=this._calculateLowerRadiusFromModelBoundingSphere(f.min,f.max);p=Math.max(Math.min(p,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=p*this.zoomOnFactor,this.focusOn({min:f.min,max:f.max,distance:p},g)}focusOn(y){let g,f,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===y.min){const p=y||this.va().meshes;g=U.e.MinMax(p),f=i.m.Distance(g.min,g.max)}else{g=y,f=y.distance}this._target=U.e.Center(g),p||(this.maxZ=2*f)}createRigCamera(y,g){let f=0;switch(this.cameraRigMode){case B.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.d.RIG_MODE_VR:f=this._cameraRigParams.stereoHalfAngle*(0===g?1:-1);break;case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:f=this._cameraRigParams.stereoHalfAngle*(0===g?-1:1)}const p=new r(y,this.alpha+f,this.beta,this.radius,this._target,this.va());return p._cameraRigParams={},p.isRigCamera=!0,p.rigParent=this,p.upVector=this.upVector,p.mode=this.mode,p.orthoLeft=this.orthoLeft,p.orthoRight=this.orthoRight,p.orthoBottom=this.orthoBottom,p.orthoTop=this.orthoTop,p}_updateRigCameras(){const y=this._rigCameras[0],g=this._rigCameras[1];switch(y.beta=g.beta=this.beta,this.cameraRigMode){case B.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.d.RIG_MODE_VR:y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,g.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,g.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const p=i.m.Distance(y,g),S=this.va().getEngine().getAspectRatio(this),k=Math.tan(this.fov/2),H=k*S,U=.5*p*f,l=U*Math.sqrt(1+1/(H*H)),c=U*Math.sqrt(1+1/(k*k));return Math.max(l,c)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,p.c)([(0,S.I)()],r.prototype,"alpha",void 0),(0,p.c)([(0,S.I)()],r.prototype,"beta",void 0),(0,p.c)([(0,S.I)()],r.prototype,"radius",void 0),(0,p.c)([(0,S.I)()],r.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,p.c)([(0,S.H)("target")],r.prototype,"_target",void 0),(0,p.c)([(0,S.y)("targetHost")],r.prototype,"_targetHost",void 0),(0,p.c)([(0,S.I)()],r.prototype,"inertialAlphaOffset",void 0),(0,p.c)([(0,S.I)()],r.prototype,"inertialBetaOffset",void 0),(0,p.c)([(0,S.I)()],r.prototype,"inertialRadiusOffset",void 0),(0,p.c)([(0,S.I)()],r.prototype,"lowerAlphaLimit",void 0),(0,p.c)([(0,S.I)()],r.prototype,"upperAlphaLimit",void 0),(0,p.c)([(0,S.I)()],r.prototype,"lowerBetaLimit",void 0),(0,p.c)([(0,S.I)()],r.prototype,"upperBetaLimit",void 0),(0,p.c)([(0,S.I)()],r.prototype,"lowerRadiusLimit",void 0),(0,p.c)([(0,S.I)()],r.prototype,"upperRadiusLimit",void 0),(0,p.c)([(0,S.I)()],r.prototype,"inertialPanningX",void 0),(0,p.c)([(0,S.I)()],r.prototype,"inertialPanningY",void 0),(0,p.c)([(0,S.I)()],r.prototype,"pinchToPanMaxDistance",void 0),(0,p.c)([(0,S.I)()],r.prototype,"panningDistanceLimit",void 0),(0,p.c)([(0,S.H)()],r.prototype,"panningOriginTarget",void 0),(0,p.c)([(0,S.I)()],r.prototype,"panningInertia",void 0),(0,p.c)([(0,S.I)()],r.prototype,"zoomToMouseLocation",null),(0,p.c)([(0,S.I)()],r.prototype,"zoomOnFactor",void 0),(0,p.c)([(0,S.F)()],r.prototype,"targetScreenOffset",void 0),(0,p.c)([(0,S.I)()],r.prototype,"allowUpsideDown",void 0),(0,p.c)([(0,S.I)()],r.prototype,"useInputToRestoreState",void 0),(0,p.c)([(0,S.I)()],r.prototype,"restoreStateInterpolationFactor",void 0),(0,M.c)("BABYLON.ArcRotateCamera",r)},11334:(y,g,f)=>{"use strict";f.d(g,{d:()=>P});var p=f(11021),S=f(11026),k=f(11036),i=f(10714),H=f(10723),U=f(11054),l=f(11336),c=f(10736),Z=f(10871),C=f(10755),q=f(11342),W=f(11177),j=f(11099);class P extends l.d{get position(){return this._position}set position(y){this._position=y}set upVector(y){this._upVector=y}get upVector(){return this._upVector}get screenArea(){let y=0,g=0;if(this.mode===P.PERSPECTIVE_CAMERA)this.fovMode===P.FOVMODE_VERTICAL_FIXED?(g=2*this.$i*Math.tan(this.fov/2),y=this.getEngine().getAspectRatio(this)*g):(y=2*this.$i*Math.tan(this.fov/2),g=y/this.getEngine().getAspectRatio(this));else{const f=this.getEngine().getRenderWidth()/2,p=this.getEngine().getRenderHeight()/2;y=(this.orthoRight??f)-(this.orthoLeft??-f),g=(this.orthoTop??p)-(this.orthoBottom??-p)}return y*g}set orthoLeft(y){this._orthoLeft=y;for(const g of this._rigCameras)g.orthoLeft=y}get orthoLeft(){return this._orthoLeft}set orthoRight(y){this._orthoRight=y;for(const g of this._rigCameras)g.orthoRight=y}get orthoRight(){return this._orthoRight}set orthoBottom(y){this._orthoBottom=y;for(const g of this._rigCameras)g.orthoBottom=y}get orthoBottom(){return this._orthoBottom}set orthoTop(y){this._orthoTop=y;for(const g of this._rigCameras)g.orthoTop=y}get orthoTop(){return this._orthoTop}set mode(y){this._mode=y;for(const g of this._rigCameras)g.mode=y}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(y,g,f){let p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(y,f,!1),this._position=U.m.Zero(),this._upVector=U.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.$i=1,this.maxZ=1e4,this.inertia=.9,this._mode=P.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new q.b(0,0,1,1),this.layerMask=268435455,this.fovMode=P.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=P.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new H.d,this.onProjectionMatrixChangedObservable=new H.d,this.onAfterCheckInputsObservable=new H.d,this.onRestoreStateObservable=new H.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new U.c,this._postProcesses=new Array,this._activeMeshes=new k.i(256),this._globalPosition=U.m.Zero(),this._computedViewMatrix=U.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=U.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=U.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),p&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=g,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${y}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Fh"}toString(y){let g="Name: "+this.name;if(g+=", type: "+this.getClassName(),this.animations)for(let f=0;f<this.animations.length;f++)g+=", animation[0]: "+this.animations[f].toString(y);return g}applyVerticalCorrection(){const y=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-y.x:y.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(y){return-1!==this._activeMeshes.indexOf(y)}isReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(y)for(const g of this._postProcesses)if(g&&!g.isReady())return!1;return super.isReady(y)}_initCache(){super._initCache(),this._cache.position=new U.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new U.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.$i=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(y){y||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let y=this._cache.mode===this.mode&&this._cache.$i===this.$i&&this._cache.maxZ===this.maxZ;if(!y)return!1;const g=this.getEngine();return this.mode===P.PERSPECTIVE_CAMERA?y=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===g.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(y=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===g.getRenderWidth()&&this._cache.renderHeight===g.getRenderHeight(),this.oblique&&(y=y&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),y}attachControl(y,g){}Wi(y){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==P.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let y=0;y<this._postProcesses.length;y++)if(null!==this._postProcesses[y])return this._postProcesses[y];return null}_cascadePostProcessesToRigCams(){const y=this._getFirstPostProcess();y&&y.markTextureDirty();for(let g=0,f=this._rigCameras.length;g<f;g++){const y=this._rigCameras[g],f=y._rigPostProcess;if(f){"pass"===f.getEffectName()&&(y.isIntermediate=0===this._postProcesses.length),y._postProcesses=this._postProcesses.slice(0).concat(f),f.markTextureDirty()}else y._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!y.isReusable()&&this._postProcesses.indexOf(y)>-1?(c.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==g||g<0?this._postProcesses.push(y):null===this._postProcesses[g]?this._postProcesses[g]=y:this._postProcesses.splice(g,0,y),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Vg(),this._postProcesses.indexOf(y))}detachPostProcess(y){const g=this._postProcesses.indexOf(y);-1!==g&&(this._postProcesses[g]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Vg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return U.c.Identity()}getViewMatrix(y){return!y&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(y){this._doNotComputeProjectionMatrix=!0,void 0!==y&&(this._projectionMatrix=y)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(y){if(this._doNotComputeProjectionMatrix||!y&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.$i=this.$i,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const g=this.getEngine(),f=this.va(),p=g.useReverseDepthBuffer;if(this.mode===P.PERSPECTIVE_CAMERA){let y;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=g.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.$i<=0&&(this.$i=.1),y=f.useRightHandedSystem?U.c.PerspectiveFovRHToRef:U.c.PerspectiveFovLHToRef,y(this.fov,g.getAspectRatio(this),p?this.maxZ:this.$i,p?this.$i:this.maxZ,this._projectionMatrix,this.fovMode===P.FOVMODE_VERTICAL_FIXED,g.isNDCHalfZRange,this.projectionPlaneTilt,p)}else{var S,k,i;const y=g.getRenderWidth()/2,H=g.getRenderHeight()/2;f.useRightHandedSystem?this.oblique?U.c.ObliqueOffCenterRHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-H,this.orthoTop??H,p?this.maxZ:this.$i,p?this.$i:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,g.isNDCHalfZRange):U.c.OrthoOffCenterRHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-H,this.orthoTop??H,p?this.maxZ:this.$i,p?this.$i:this.maxZ,this._projectionMatrix,g.isNDCHalfZRange):this.oblique?U.c.ObliqueOffCenterLHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-H,this.orthoTop??H,p?this.maxZ:this.$i,p?this.$i:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,g.isNDCHalfZRange):U.c.OrthoOffCenterLHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-H,this.orthoTop??H,p?this.maxZ:this.$i,p?this.$i:this.maxZ,this._projectionMatrix,g.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(S=this.oblique)||void 0===S?void 0:S.angle,this._cache.obliqueLength=null===(k=this.oblique)||void 0===k?void 0:k.length,this._cache.obliqueOffset=null===(i=this.oblique)||void 0===i?void 0:i.offset,this._cache.renderWidth=g.getRenderWidth(),this._cache.renderHeight=g.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(y){return(this.radius||(this.target?U.m.Distance(this.position,this.target):this.position.length()))+y}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?W.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=W.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),g&&this.rigCameras.length>0){let g=!1;return this.rigCameras.forEach((f=>{f._updateFrustumPlanes(),g=g||y.isInFrustum(f._frustumPlanes)})),g}return y.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(y){return this._updateFrustumPlanes(),y.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,C.b)("Ray")}getForwardRayToRef(y){throw(0,C.b)("Ray")}dispose(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const y=this._rigCameras.pop();y&&y.dispose()}if(this._parentContainer){const y=this._parentContainer.cameras.indexOf(this);y>-1&&this._parentContainer.cameras.splice(y,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==P.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let y=this._postProcesses.length;for(;--y>=0;){const g=this._postProcesses[y];g&&g.dispose(this)}}let f=this.customRenderTargets.length;for(;--f>=0;)this.customRenderTargets[f].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(y,g)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(y,g){if(this.cameraRigMode!==y){for(;this._rigCameras.length>0;){const y=this._rigCameras.pop();y&&y.dispose()}if(this.cameraRigMode=y,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=g.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=i.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==P.RIG_MODE_NONE){const y=this.createRigCamera(this.name+"_L",0);y&&(y._isLeftCamera=!0);const g=this.createRigCamera(this.name+"_R",1);g&&(g._isRightCamera=!0),y&&g&&(this._rigCameras.push(y),this._rigCameras.push(g))}this._setRigMode(g),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(y){}_getVRProjectionMatrix(){return U.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.$i,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(y,g){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[y]=g,"interaxialDistance"===y&&(this._cameraRigParams.stereoHalfAngle=i.e.ToRadians(g/.0637))}createRigCamera(y,g){return null}_updateRigCameras(){for(let y=0;y<this._rigCameras.length;y++)this._rigCameras[y].$i=this.$i,this._rigCameras[y].maxZ=this.maxZ,this._rigCameras[y].fov=this.fov,this._rigCameras[y].upVector.p(this.upVector);this.cameraRigMode===P.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const y=j.c.Serialize(this);return y.uniqueId=this.uniqueId,y.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(y),this.inputs&&this.inputs.serialize(y),j.c.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y.isEnabled=this.isEnabled(),y}clone(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=j.c.Clone(P.GetConstructorFromName(this.getClassName(),y,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return f.name=y,f.parent=g,this.onClonedObservable.notifyObservers(f),f}_e(y){const g=U.m.Zero();return this.getDirectionToRef(y,g),g}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(y,g){U.m.TransformNormalToRef(y,this.getWorldMatrix(),g)}static GetConstructorFromName(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const k=l.d.Construct(y,g,f,{interaxial_distance:p,isStereoscopicSideBySide:S});return k||(()=>P._CreateDefaultParsedCamera(g,f))}Sj(){return this.getWorldMatrix()}static Parse(y,g){const f=y.type,p=P.GetConstructorFromName(f,y.name,g,y.interaxial_distance,y.isStereoscopicSideBySide),S=j.c.Parse(p,y,g);if(void 0!==y.parentId&&(S._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(S._waitingParentInstanceIndex=y.parentInstanceIndex),S.inputs&&(S.inputs.parse(y),S._setupInputs()),y.upVector&&(S.upVector=U.m.eh(y.upVector)),S.setPosition&&(S.position.ne(0,0,0),S.setPosition(U.m.eh(y.position))),y.target&&S.setTarget&&S.setTarget(U.m.eh(y.target)),y.cameraRigMode){const g=y.interaxial_distance?{interaxialDistance:y.interaxial_distance}:{};S.setCameraRigMode(y.cameraRigMode,g)}if(y.animations){for(let g=0;g<y.animations.length;g++){const f=y.animations[g],p=(0,Z.b)("BABYLON.Animation");p&&S.animations.push(p.Parse(f))}l.d.ParseAnimationRanges(S,y,g)}return y.autoAnimate&&g.beginAnimation(S,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),void 0!==y.isEnabled&&S.Mb(y.isEnabled),S}_calculateHandednessMultiplier(){let y=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(y*=-1),y}}P._CreateDefaultParsedCamera=(y,g)=>{throw(0,C.b)("UniversalCamera")},P.PERSPECTIVE_CAMERA=0,P.ORTHOGRAPHIC_CAMERA=1,P.FOVMODE_VERTICAL_FIXED=0,P.FOVMODE_HORIZONTAL_FIXED=1,P.RIG_MODE_NONE=0,P.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,P.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,P.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,P.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,P.RIG_MODE_STEREOSCOPIC_INTERLACED=14,P.RIG_MODE_VR=20,P.RIG_MODE_CUSTOM=22,P.ForceAttachControlToAlwaysPreventDefault=!1,(0,p.c)([(0,S.H)("position")],P.prototype,"_position",void 0),(0,p.c)([(0,S.H)("upVector")],P.prototype,"_upVector",void 0),(0,p.c)([(0,S.I)()],P.prototype,"orthoLeft",null),(0,p.c)([(0,S.I)()],P.prototype,"orthoRight",null),(0,p.c)([(0,S.I)()],P.prototype,"orthoBottom",null),(0,p.c)([(0,S.I)()],P.prototype,"orthoTop",null),(0,p.c)([(0,S.I)()],P.prototype,"fov",void 0),(0,p.c)([(0,S.I)()],P.prototype,"projectionPlaneTilt",void 0),(0,p.c)([(0,S.I)()],P.prototype,"$i",void 0),(0,p.c)([(0,S.I)()],P.prototype,"maxZ",void 0),(0,p.c)([(0,S.I)()],P.prototype,"inertia",void 0),(0,p.c)([(0,S.I)()],P.prototype,"mode",null),(0,p.c)([(0,S.I)()],P.prototype,"layerMask",void 0),(0,p.c)([(0,S.I)()],P.prototype,"fovMode",void 0),(0,p.c)([(0,S.I)()],P.prototype,"cameraRigMode",void 0),(0,p.c)([(0,S.I)()],P.prototype,"interaxialDistance",void 0),(0,p.c)([(0,S.I)()],P.prototype,"isStereoscopicSideBySide",void 0)},12231:(y,g,f)=>{"use strict";f.d(g,{c:()=>i,e:()=>H});var p=f(10736),S=f(11099),k=f(11334),i={};class H{constructor(y){this.attachedToElement=!1,this.attached={},this.camera=y,this.checkInputs=()=>{}}add(y){const g=y.getSimpleName();this.attached[g]?p.d.Warn("camera input of type "+g+" already exists on camera"):(this.attached[g]=y,y.camera=this.camera,y.checkInputs&&(this.checkInputs=this._addCheckInputs(y.checkInputs.bind(y))),this.attachedToElement&&y.attachControl(this.noPreventDefault))}remove(y){for(const g in this.attached){const f=this.attached[g];if(f===y)return f.Wi(),f.camera=null,delete this.attached[g],void this.rebuildInputCheck()}}removeByType(y){for(const g in this.attached){const f=this.attached[g];f.getClassName()===y&&(f.Wi(),f.camera=null,delete this.attached[g],this.rebuildInputCheck())}}_addCheckInputs(y){const g=this.checkInputs;return()=>{g(),y()}}attachInput(y){this.attachedToElement&&y.attachControl(this.noPreventDefault)}attachElement(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){y=!k.d.ForceAttachControlToAlwaysPreventDefault&&y,this.attachedToElement=!0,this.noPreventDefault=y;for(const g in this.attached)this.attached[g].attachControl(y)}}detachElement(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const g in this.attached)this.attached[g].Wi(),y&&(this.attached[g].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const y in this.attached){const g=this.attached[y];g.checkInputs&&(this.checkInputs=this._addCheckInputs(g.checkInputs.bind(g)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(y){const g={};for(const f in this.attached){const y=this.attached[f],p=S.c.Serialize(y);g[y.getClassName()]=p}y.inputsmgr=g}parse(y){const g=y.inputsmgr;if(g){this.clear();for(const y in g){const f=i[y];if(f){const p=g[y],k=S.c.Parse((()=>new f),p,null);this.add(k)}}}else for(const f in this.attached){const g=i[this.attached[f].getClassName()];if(g){const p=S.c.Parse((()=>new g),y,null);this.remove(this.attached[f]),this.add(p)}}}}},12224:(y,g,f)=>{"use strict";f.d(g,{c:()=>Q});var p=f(11021),S=f(11026),k=f(11054),i=f(12226),H=f(12231),U=f(11161),l=f(10714);class c{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(y){y=l.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((g=>{const f=g.event;if(!f.metaKey)if(g.type===U.d.KEYDOWN){if(-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysUpward.indexOf(f.keyCode)||-1!==this.keysDownward.indexOf(f.keyCode)||-1!==this.keysRotateLeft.indexOf(f.keyCode)||-1!==this.keysRotateRight.indexOf(f.keyCode)||-1!==this.keysRotateUp.indexOf(f.keyCode)||-1!==this.keysRotateDown.indexOf(f.keyCode)){-1===this._keys.indexOf(f.keyCode)&&this._keys.push(f.keyCode),y||f.preventDefault()}}else if(-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysUpward.indexOf(f.keyCode)||-1!==this.keysDownward.indexOf(f.keyCode)||-1!==this.keysRotateLeft.indexOf(f.keyCode)||-1!==this.keysRotateRight.indexOf(f.keyCode)||-1!==this.keysRotateUp.indexOf(f.keyCode)||-1!==this.keysRotateDown.indexOf(f.keyCode)){const g=this._keys.indexOf(f.keyCode);g>=0&&this._keys.splice(g,1),y||f.preventDefault()}})))}Wi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const y=this.camera;for(let g=0;g<this._keys.length;g++){const f=this._keys[g],p=y._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(f)?y._localDirection.ne(-p,0,0):-1!==this.keysUp.indexOf(f)?y._localDirection.ne(0,0,p):-1!==this.keysRight.indexOf(f)?y._localDirection.ne(p,0,0):-1!==this.keysDown.indexOf(f)?y._localDirection.ne(0,0,-p):-1!==this.keysUpward.indexOf(f)?y._localDirection.ne(0,p,0):-1!==this.keysDownward.indexOf(f)?y._localDirection.ne(0,-p,0):-1!==this.keysRotateLeft.indexOf(f)?(y._localDirection.ne(0,0,0),y.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(f)?(y._localDirection.ne(0,0,0),y.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(f)?(y._localDirection.ne(0,0,0),y.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(f)&&(y._localDirection.ne(0,0,0),y.cameraRotation.x+=this._getLocalRotation()),y.va().useRightHandedSystem&&(y._localDirection.z*=-1),y.getViewMatrix().invertToRef(y._cameraTransformMatrix),k.m.TransformNormalToRef(y._localDirection,y._cameraTransformMatrix,y._transformedDirection),y.cameraDirection.addInPlace(y._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const y=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*y}}(0,p.c)([(0,S.I)()],c.prototype,"keysUp",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysUpward",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysDown",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysDownward",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysLeft",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysRight",void 0),(0,p.c)([(0,S.I)()],c.prototype,"rotationSpeed",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysRotateLeft",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysRotateRight",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysRotateUp",void 0),(0,p.c)([(0,S.I)()],c.prototype,"keysRotateDown",void 0),H.c.FreeCameraKeyboardMoveInput=c;var Z=f(10723),C=f(11156);class q{constructor(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=y,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Z.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(y){y=l.e.BackCompatCameraNoPreventDefault(arguments);const g=this.camera.getEngine(),f=g.getInputElement();this._pointerInput||(this._pointerInput=p=>{const S=p.event,k="touch"===S.pointerType;if(!this.touchEnabled&&k)return;if(p.type!==C.d.POINTERMOVE&&-1===this.buttons.indexOf(S.button))return;const i=S.target;if(p.type===C.d.POINTERDOWN){if(k&&-1!==this._activePointerId||!k&&-1!==this._currentActiveButton)return;this._activePointerId=S.pointerId;try{null===i||void 0===i||i.setPointerCapture(S.pointerId)}catch(H){}-1===this._currentActiveButton&&(this._currentActiveButton=S.button),this._previousPosition={x:S.clientX,y:S.clientY},y||(S.preventDefault(),f&&f.focus()),g.isPointerLock&&this._onMouseMove&&this._onMouseMove(p.event)}else if(p.type===C.d.POINTERUP){if(k&&this._activePointerId!==S.pointerId||!k&&this._currentActiveButton!==S.button)return;try{null===i||void 0===i||i.releasePointerCapture(S.pointerId)}catch(H){}this._currentActiveButton=-1,this._previousPosition=null,y||S.preventDefault(),this._activePointerId=-1}else if(p.type===C.d.POINTERMOVE&&(this._activePointerId===S.pointerId||!k))if(g.isPointerLock&&this._onMouseMove)this._onMouseMove(p.event);else if(this._previousPosition){const g=this.camera._calculateHandednessMultiplier(),f=(S.clientX-this._previousPosition.x)*g,p=S.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=f/this.angularSensibility,this.camera.cameraRotation.x+=p/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:f,offsetY:p}),this._previousPosition={x:S.clientX,y:S.clientY},y||S.preventDefault()}}),this._onMouseMove=f=>{if(!g.isPointerLock)return;const p=this.camera._calculateHandednessMultiplier(),S=f.movementX*p;this.camera.cameraRotation.y+=S/this.angularSensibility;const k=f.movementY;this.camera.cameraRotation.x+=k/this.angularSensibility,this._previousPosition=null,y||f.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,C.d.POINTERDOWN|C.d.POINTERUP|C.d.POINTERMOVE),f&&(this._contextMenuBind=y=>this.onContextMenu(y),f.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(y){y.preventDefault()}Wi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const y=this.camera.getEngine().getInputElement();y&&y.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,p.c)([(0,S.I)()],q.prototype,"buttons",void 0),(0,p.c)([(0,S.I)()],q.prototype,"angularSensibility",void 0),H.c.FreeCameraMouseInput=q;var W,j=f(11165);class P{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Z.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(y){y=l.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=g=>{if(g.type!==C.d.POINTERWHEEL)return;const f=g.event,p=f.deltaMode===j.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*p*f.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*p*f.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*p*f.deltaZ/this._normalize,f.preventDefault&&(y||f.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,C.d.POINTERWHEEL)}Wi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,p.c)([(0,S.I)()],P.prototype,"wheelPrecisionX",void 0),(0,p.c)([(0,S.I)()],P.prototype,"wheelPrecisionY",void 0),(0,p.c)([(0,S.I)()],P.prototype,"wheelPrecisionZ",void 0),function(y){y[y.MoveRelative=0]="MoveRelative",y[y.RotateRelative=1]="RotateRelative",y[y.MoveScene=2]="MoveScene"}(W||(W={}));class B extends P{constructor(){super(...arguments),this._moveRelative=k.m.Zero(),this._rotateRelative=k.m.Zero(),this._moveScene=k.m.Zero(),this._wheelXAction=W.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=W.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(y){null===y&&this._wheelXAction!==W.MoveRelative||(this._wheelXAction=W.MoveRelative,this._wheelXActionCoordinate=y)}get wheelXMoveRelative(){return this._wheelXAction!==W.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(y){null===y&&this._wheelYAction!==W.MoveRelative||(this._wheelYAction=W.MoveRelative,this._wheelYActionCoordinate=y)}get wheelYMoveRelative(){return this._wheelYAction!==W.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(y){null===y&&this._wheelZAction!==W.MoveRelative||(this._wheelZAction=W.MoveRelative,this._wheelZActionCoordinate=y)}get wheelZMoveRelative(){return this._wheelZAction!==W.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(y){null===y&&this._wheelXAction!==W.RotateRelative||(this._wheelXAction=W.RotateRelative,this._wheelXActionCoordinate=y)}get wheelXRotateRelative(){return this._wheelXAction!==W.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(y){null===y&&this._wheelYAction!==W.RotateRelative||(this._wheelYAction=W.RotateRelative,this._wheelYActionCoordinate=y)}get wheelYRotateRelative(){return this._wheelYAction!==W.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(y){null===y&&this._wheelZAction!==W.RotateRelative||(this._wheelZAction=W.RotateRelative,this._wheelZActionCoordinate=y)}get wheelZRotateRelative(){return this._wheelZAction!==W.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(y){null===y&&this._wheelXAction!==W.MoveScene||(this._wheelXAction=W.MoveScene,this._wheelXActionCoordinate=y)}get wheelXMoveScene(){return this._wheelXAction!==W.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(y){null===y&&this._wheelYAction!==W.MoveScene||(this._wheelYAction=W.MoveScene,this._wheelYActionCoordinate=y)}get wheelYMoveScene(){return this._wheelYAction!==W.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(y){null===y&&this._wheelZAction!==W.MoveScene||(this._wheelZAction=W.MoveScene,this._wheelZActionCoordinate=y)}get wheelZMoveScene(){return this._wheelZAction!==W.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.me(0),this._rotateRelative.me(0),this._moveScene.me(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const y=k.c.Zero();this.camera.getViewMatrix().invertToRef(y);const g=k.m.Zero();k.m.TransformNormalToRef(this._moveRelative,y,g),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(g),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(y,g,f){if(0===y)return;if(null===g||null===f)return;let p=null;switch(g){case W.MoveRelative:p=this._moveRelative;break;case W.RotateRelative:p=this._rotateRelative;break;case W.MoveScene:p=this._moveScene}switch(f){case 0:p.set(y,0,0);break;case 1:p.set(0,y,0);break;case 2:p.set(0,0,y)}}}(0,p.c)([(0,S.I)()],B.prototype,"wheelXMoveRelative",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelYMoveRelative",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelZMoveRelative",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelXRotateRelative",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelYRotateRelative",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelZRotateRelative",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelXMoveScene",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelYMoveScene",null),(0,p.c)([(0,S.I)()],B.prototype,"wheelZMoveScene",null),H.c.FreeCameraMouseWheelInput=B;class R{constructor(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=y,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=l.e.IsSafari()}attachControl(y){y=l.e.BackCompatCameraNoPreventDefault(arguments);let g=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=f=>{const p=f.event,S="mouse"===p.pointerType||this._isSafari&&"undefined"===typeof p.pointerType;if(this.allowMouse||!S)if(f.type===C.d.POINTERDOWN){if(y||p.preventDefault(),this._pointerPressed.push(p.pointerId),1!==this._pointerPressed.length)return;g={x:p.clientX,y:p.clientY}}else if(f.type===C.d.POINTERUP){y||p.preventDefault();const f=this._pointerPressed.indexOf(p.pointerId);if(-1===f)return;if(this._pointerPressed.splice(f,1),0!=f)return;g=null,this._offsetX=null,this._offsetY=null}else if(f.type===C.d.POINTERMOVE){if(y||p.preventDefault(),!g)return;if(0!=this._pointerPressed.indexOf(p.pointerId))return;this._offsetX=p.clientX-g.x,this._offsetY=-(p.clientY-g.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,C.d.POINTERDOWN|C.d.POINTERUP|C.d.POINTERMOVE),this._onLostFocus){const y=this.camera.getEngine().getInputElement();y&&y.addEventListener("blur",this._onLostFocus)}}Wi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const y=this.camera.getEngine().getInputElement();y&&y.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const y=this.camera,g=y._calculateHandednessMultiplier();y.cameraRotation.y=g*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)y.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const g=y._computeLocalCameraSpeed(),f=new k.m(0,0,0!==this.touchMoveSensibility?g*this._offsetY/this.touchMoveSensibility:0);k.c.RotationYawPitchRollToRef(y.rotation.y,y.rotation.x,0,y._cameraRotationMatrix),y.cameraDirection.addInPlace(k.m.TransformCoordinates(f,y._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,p.c)([(0,S.I)()],R.prototype,"touchAngularSensibility",void 0),(0,p.c)([(0,S.I)()],R.prototype,"touchMoveSensibility",void 0),H.c.FreeCameraTouchInput=R;class G extends H.e{constructor(y){super(y),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new c),this}addMouse(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new q(y),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new R),this}clear(){super.clear(),this._mouseInput=null}}var z=f(10871),T=f(10797);class Q extends i.e{get angularSensibility(){const y=this.inputs.attached.mouse;return y?y.angularSensibility:0}set angularSensibility(y){const g=this.inputs.attached.mouse;g&&(g.angularSensibility=y)}get keysUp(){const y=this.inputs.attached.keyboard;return y?y.keysUp:[]}set keysUp(y){const g=this.inputs.attached.keyboard;g&&(g.keysUp=y)}get keysUpward(){const y=this.inputs.attached.keyboard;return y?y.keysUpward:[]}set keysUpward(y){const g=this.inputs.attached.keyboard;g&&(g.keysUpward=y)}get keysDown(){const y=this.inputs.attached.keyboard;return y?y.keysDown:[]}set keysDown(y){const g=this.inputs.attached.keyboard;g&&(g.keysDown=y)}get keysDownward(){const y=this.inputs.attached.keyboard;return y?y.keysDownward:[]}set keysDownward(y){const g=this.inputs.attached.keyboard;g&&(g.keysDownward=y)}get keysLeft(){const y=this.inputs.attached.keyboard;return y?y.keysLeft:[]}set keysLeft(y){const g=this.inputs.attached.keyboard;g&&(g.keysLeft=y)}get keysRight(){const y=this.inputs.attached.keyboard;return y?y.keysRight:[]}set keysRight(y){const g=this.inputs.attached.keyboard;g&&(g.keysRight=y)}get keysRotateLeft(){const y=this.inputs.attached.keyboard;return y?y.keysRotateLeft:[]}set keysRotateLeft(y){const g=this.inputs.attached.keyboard;g&&(g.keysRotateLeft=y)}get keysRotateRight(){const y=this.inputs.attached.keyboard;return y?y.keysRotateRight:[]}set keysRotateRight(y){const g=this.inputs.attached.keyboard;g&&(g.keysRotateRight=y)}get keysRotateUp(){const y=this.inputs.attached.keyboard;return y?y.keysRotateUp:[]}set keysRotateUp(y){const g=this.inputs.attached.keyboard;g&&(g.keysRotateUp=y)}get keysRotateDown(){const y=this.inputs.attached.keyboard;return y?y.keysRotateDown:[]}set keysRotateDown(y){const g=this.inputs.attached.keyboard;g&&(g.keysRotateDown=y)}constructor(y,g,f){var p;super(y,g,f,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),p=this,this.ellipsoid=new k.m(.5,1,.5),this.ellipsoidOffset=new k.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=k.m.Zero(),this._diffPosition=k.m.Zero(),this._newPosition=k.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;p._newPosition.p(g),p._newPosition.subtractToRef(p._oldPosition,p._diffPosition),p._diffPosition.length()>T.b.CollisionsEpsilon&&(p.position.addToRef(p._diffPosition,p._deferredPositionUpdate),p._deferOnly?p._deferredUpdated=!0:p.position.p(p._deferredPositionUpdate),p.Mk&&f&&p.Mk(f))},this.inputs=new G(this),this.inputs.addKeyboard().addMouse()}attachControl(y,g){g=l.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(g)}Wi(){this.inputs.detachElement(),this.cameraDirection=new k.m(0,0,0),this.cameraRotation=new k.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(y){this._collisionMask=isNaN(y)?-1:y}_collideWithWorld(y){let g;g=this.parent?k.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,g.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const f=this.va().collisionCoordinator;this._collider||(this._collider=f.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let p=y;this.applyGravity&&(p=y.add(this.va().gravity)),f.getNewPosition(this._oldPosition,p,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=k.m.Zero(),this._transformedDirection=k.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(y){this._needMoveForGravity=y}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,p.c)([(0,S.H)()],Q.prototype,"ellipsoid",void 0),(0,p.c)([(0,S.H)()],Q.prototype,"ellipsoidOffset",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"checkCollisions",void 0),(0,p.c)([(0,S.I)()],Q.prototype,"applyGravity",void 0),(0,z.c)("BABYLON.FreeCamera",Q)},12226:(y,g,f)=>{"use strict";f.d(g,{e:()=>l});var p=f(11021),S=f(11026),k=f(11334),i=f(11054),H=f(11062),U=f(11378);f(11336).d.AddNodeConstructor("TargetCamera",((y,g)=>()=>new l(y,i.m.Zero(),g)));class l extends k.d{constructor(y,g,f){super(y,g,f,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=i.m.Zero(),this._tmpTargetVector=i.m.Zero(),this.cameraDirection=new i.m(0,0,0),this.cameraRotation=new i.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new i.g,this.rotation=new i.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=i.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=i.c.Zero(),this._camMatrix=i.c.Zero(),this._cameraTransformMatrix=i.c.Zero(),this._cameraRotationMatrix=i.c.Zero(),this._referencePoint=new i.m(0,0,1),this._transformedReferencePoint=i.m.Zero(),this._deferredPositionUpdate=new i.m,this._deferredRotationQuaternionUpdate=new i.g,this._deferredRotationUpdate=new i.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=i.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(y){this.getWorldMatrix();const g=this.getTarget().ed(this.position);return g.normalize(),g.scaleInPlace(y),this.globalPosition.add(g)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const y=this.lockedTarget;y.Sj().getTranslationToRef(y.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.ne(0,0,0),this.cameraRotation.ne(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new i.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new i.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new i.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(y){y||super._updateCache();const g=this._getLockedTargetPosition();g?this._cache.lockedTarget?this._cache.lockedTarget.p(g):this._cache.lockedTarget=g.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const y=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(y):!y)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const y=this.getEngine();return this.speed*Math.sqrt(y.getDeltaTime()/(100*y.getFps()))}setTarget(y){this.upVector.normalize(),this._initialFocalDistance=y.ed(this.position).length(),this.position.z===y.z&&(this.position.z+=H.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),i.c.LookAtLHToRef(this.position,y,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const g=y.ed(this.position);g.x>=0?this.rotation.y=-Math.atan(g.z/g.x)+Math.PI/2:this.rotation.y=-Math.atan(g.z/g.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&i.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(y){this.setTarget(y)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(i.j.Matrix[0]),i.m.TransformNormalToRef(this.cameraDirection,i.j.Matrix[0],i.j.o[0]),this._deferredPositionUpdate.addInPlace(i.j.o[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const y=this.invertRotation?-this.inverseRotationSpeed:1,g=this._decideIfNeedsToMove(),f=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),g&&this._updatePosition(),f){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*y,this._deferredRotationUpdate.y+=this.cameraRotation.y*y,!this.noRotationConstraint){const y=1.570796;this._deferredRotationUpdate.x>y&&(this._deferredRotationUpdate.x=y),this._deferredRotationUpdate.x<-y&&(this._deferredRotationUpdate.x=-y)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(i.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}g&&(Math.abs(this.cameraDirection.x)<this.speed*H.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*H.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*H.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),f&&(Math.abs(this.cameraRotation.x)<this.speed*H.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*H.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):i.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return i.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),i.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?U.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(i.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),U.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(y,g,f){if(this.ignoreParentScaling){if(this.parent){const p=this.parent.getWorldMatrix();i.m.TransformCoordinatesToRef(y,p,this._globalPosition),i.m.TransformCoordinatesToRef(g,p,this._tmpTargetVector),i.m.TransformNormalToRef(f,p,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(y),this._tmpTargetVector.p(g),this._tmpUpVector.p(f);this.va().useRightHandedSystem?i.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):i.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?i.c.LookAtRHToRef(y,g,f,this._viewMatrix):i.c.LookAtLHToRef(y,g,f,this._viewMatrix),this.parent){const y=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(y,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(y)}createRigCamera(y,g){if(this.cameraRigMode!==k.d.RIG_MODE_NONE){const g=new l(y,this.position.clone(),this.va());return g.isRigCamera=!0,g.rigParent=this,this.cameraRigMode===k.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new i.g),g._cameraRigParams={},g.rotationQuaternion=new i.g),g.mode=this.mode,g.orthoLeft=this.orthoLeft,g.orthoRight=this.orthoRight,g.orthoTop=this.orthoTop,g.orthoBottom=this.orthoBottom,g}return null}_updateRigCameras(){const y=this._rigCameras[0],g=this._rigCameras[1];switch(this.Sj(),this.cameraRigMode){case k.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case k.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const f=this.cameraRigMode===k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,p=this.cameraRigMode===k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*f,y),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*p,g);break}case k.d.RIG_MODE_VR:y.rotationQuaternion?(y.rotationQuaternion.p(this.rotationQuaternion),g.rotationQuaternion.p(this.rotationQuaternion)):(y.rotation.p(this.rotation),g.rotation.p(this.rotation)),y.position.p(this.position),g.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(y,g){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const f=l._TargetFocalPoint.addInPlace(this.position);i.c.TranslationToRef(-f.x,-f.y,-f.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(i.c.RotationAxis(g.upVector,y),l._RigCamTransformMatrix),i.c.TranslationToRef(f.x,f.y,f.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),i.m.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,g.position),g.setTarget(f)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new i.c,l._TargetTransformMatrix=new i.c,l._TargetFocalPoint=new i.m,(0,p.c)([(0,S.H)()],l.prototype,"rotation",void 0),(0,p.c)([(0,S.I)()],l.prototype,"speed",void 0),(0,p.c)([(0,S.y)("lockedTargetId")],l.prototype,"lockedTarget",void 0)},11216:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{constructor(y,g,f){this.bu=y,this.bv=g,this.distance=f,this.faceId=0,this.subMeshId=0}}},11122:(y,g,f)=>{"use strict";f.d(g,{c:()=>k});var p=f(11054),S=f(11131);class k{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var y;let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||f&&!this.pickedMesh.isVerticesDataPresent(S.c.NormalKind))return null;let k,i=this.pickedMesh.hg();0===(null===(y=i)||void 0===y?void 0:y.length)&&(i=null);const H=p.j.o[0],U=p.j.o[1],l=p.j.o[2];if(f){const y=this.pickedMesh.getVerticesData(S.c.NormalKind);let g=i?p.m.FromArrayToRef(y,3*i[3*this.faceId],H):H.ne(y[3*this.faceId*3],y[3*this.faceId*3+1],y[3*this.faceId*3+2]),f=i?p.m.FromArrayToRef(y,3*i[3*this.faceId+1],U):U.ne(y[3*(3*this.faceId+1)],y[3*(3*this.faceId+1)+1],y[3*(3*this.faceId+1)+2]),c=i?p.m.FromArrayToRef(y,3*i[3*this.faceId+2],l):l.ne(y[3*(3*this.faceId+2)],y[3*(3*this.faceId+2)+1],y[3*(3*this.faceId+2)+2]);g=g.scale(this.bu),f=f.scale(this.bv),c=c.scale(1-this.bu-this.bv),k=new p.m(g.x+f.x+c.x,g.y+f.y+c.y,g.z+f.z+c.z)}else{const y=this.pickedMesh.getVerticesData(S.c.PositionKind),g=i?p.m.FromArrayToRef(y,3*i[3*this.faceId],H):H.ne(y[3*this.faceId*3],y[3*this.faceId*3+1],y[3*this.faceId*3+2]),f=i?p.m.FromArrayToRef(y,3*i[3*this.faceId+1],U):U.ne(y[3*(3*this.faceId+1)],y[3*(3*this.faceId+1)+1],y[3*(3*this.faceId+1)+2]),c=i?p.m.FromArrayToRef(y,3*i[3*this.faceId+2],l):l.ne(y[3*(3*this.faceId+2)],y[3*(3*this.faceId+2)+1],y[3*(3*this.faceId+2)+2]),Z=g.ed(f),C=c.ed(f);k=p.m.Cross(Z,C)}const c=(y,g)=>{let f=y.getWorldMatrix();y.nonUniformScaling&&(p.j.Matrix[0].p(f),f=p.j.Matrix[0],f.setTranslationFromFloats(0,0,0),f.invert(),f.transposeToRef(p.j.Matrix[1]),f=p.j.Matrix[1]),p.m.TransformNormalToRef(g,f,g)};if(g&&c(this.pickedMesh,k),this.ray){const y=p.j.o[0].p(k);g||c(this.pickedMesh,y),p.m.Dot(y,this.ray.direction)>0&&k.negateInPlace()}return k.normalize(),k}getTextureCoordinates(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.c.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(y))return null;const g=this.pickedMesh.hg();if(!g)return null;const f=this.pickedMesh.getVerticesData(y);if(!f)return null;let k=p.l.eh(f,2*g[3*this.faceId]),i=p.l.eh(f,2*g[3*this.faceId+1]),H=p.l.eh(f,2*g[3*this.faceId+2]);return k=k.scale(this.bu),i=i.scale(this.bv),H=H.scale(1-this.bu-this.bv),new p.l(k.x+i.x+H.x,k.y+i.y+H.y)}}},11283:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});let p=!1},12804:(y,g,f)=>{"use strict";f.d(g,{b:()=>k});var p=f(11036),S=f(12807);class k{constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=f,this.qi=[],this._maxBlockCapacity=g||64,this._selectionContent=new p.e(1024),this._creationFunc=y}update(y,g,f){S.b._CreateBlocks(y,g,f,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}pi(y){for(let g=0;g<this.Kh.length;g++){this.Kh[g].addEntry(y)}}Lc(y){for(let g=0;g<this.Kh.length;g++){this.Kh[g].removeEntry(y)}}select(y,g){this._selectionContent.reset();for(let f=0;f<this.Kh.length;f++){this.Kh[f].select(y,this._selectionContent,g)}return g?this._selectionContent.concat(this.qi):this._selectionContent.concatWithNoDuplicate(this.qi),this._selectionContent}intersects(y,g,f){this._selectionContent.reset();for(let p=0;p<this.Kh.length;p++){this.Kh[p].intersects(y,g,this._selectionContent,f)}return f?this._selectionContent.concat(this.qi):this._selectionContent.concatWithNoDuplicate(this.qi),this._selectionContent}intersectsRay(y){this._selectionContent.reset();for(let g=0;g<this.Kh.length;g++){this.Kh[g].intersectsRay(y,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.qi),this._selectionContent}}k.CreationFuncForMeshes=(y,g)=>{const f=y.getBoundingInfo();!y.isBlocked&&f.boundingBox.intersectsMinMax(g.ui,g.wi)&&g.entries.push(y)},k.CreationFuncForSubMeshes=(y,g)=>{y.getBoundingInfo().boundingBox.intersectsMinMax(g.ui,g.wi)&&g.entries.push(y)}},12807:(y,g,f)=>{"use strict";f.d(g,{b:()=>k});var p=f(11054),S=f(11223);class k{constructor(y,g,f,p,S,k){this.entries=[],this.xi=new Array,this._capacity=f,this._depth=p,this._maxDepth=S,this._creationFunc=k,this._minPoint=y,this._maxPoint=g,this.xi.push(y.clone()),this.xi.push(g.clone()),this.xi.push(y.clone()),this.xi[2].x=g.x,this.xi.push(y.clone()),this.xi[3].y=g.y,this.xi.push(y.clone()),this.xi[4].z=g.z,this.xi.push(g.clone()),this.xi[5].z=y.z,this.xi.push(g.clone()),this.xi[6].x=y.x,this.xi.push(g.clone()),this.xi[7].y=y.y}get sb(){return this._capacity}get ui(){return this._minPoint}get wi(){return this._maxPoint}addEntry(y){if(this.Kh)for(let g=0;g<this.Kh.length;g++){this.Kh[g].addEntry(y)}else this._creationFunc(y,this),this.entries.length>this.sb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(y){if(this.Kh){for(let g=0;g<this.Kh.length;g++){this.Kh[g].removeEntry(y)}return}const g=this.entries.indexOf(y);g>-1&&this.entries.splice(g,1)}addEntries(y){for(let g=0;g<y.length;g++){const f=y[g];this.addEntry(f)}}select(y,g,f){if(S.d.IsInFrustum(this.xi,y)){if(this.Kh){for(let p=0;p<this.Kh.length;p++){this.Kh[p].select(y,g,f)}return}f?g.concat(this.entries):g.concatWithNoDuplicate(this.entries)}}intersects(y,g,f,p){if(S.d.IntersectsSphere(this._minPoint,this._maxPoint,y,g)){if(this.Kh){for(let S=0;S<this.Kh.length;S++){this.Kh[S].intersects(y,g,f,p)}return}p?f.concat(this.entries):f.concatWithNoDuplicate(this.entries)}}intersectsRay(y,g){if(y.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Kh){for(let f=0;f<this.Kh.length;f++){this.Kh[f].intersectsRay(y,g)}return}g.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){k._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(y,g,f,S,i,H,U,l){U.Kh=new Array;const c=new p.m((g.x-y.x)/2,(g.y-y.y)/2,(g.z-y.z)/2);for(let p=0;p<2;p++)for(let g=0;g<2;g++)for(let Z=0;Z<2;Z++){const C=y.add(c.multiplyByFloats(p,g,Z)),q=y.add(c.multiplyByFloats(p+1,g+1,Z+1)),W=new k(C,q,S,i+1,H,l);W.addEntries(f),U.Kh.push(W)}}}},12811:(y,g,f)=>{"use strict";f.d(g,{d:()=>c});var p=f(11038),S=f(11054),k=f(11368),i=f(11716),H=f(11149),U=f(12804),l=f(10761);p.e.prototype.createOrUpdateSelectionOctree=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,f=this._getComponent(H.e.NAME_OCTREE);f||(f=new c(this),this.gb(f)),this.ni||(this.ni=new U.b(U.b.CreationFuncForMeshes,y,g));const p=this.getWorldExtends();return this.ni.update(p.min,p.max,this.meshes),this.ni},Object.defineProperty(p.e.prototype,"selectionOctree",{get:function(){return this.ni},enumerable:!0,configurable:!0}),k.c.prototype.createOrUpdateSubmeshesOctree=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const f=this.va();let p=f._getComponent(H.e.NAME_OCTREE);p||(p=new c(f),f.gb(p)),this._submeshesOctree||(this._submeshesOctree=new U.b(U.b.CreationFuncForSubMeshes,y,g)),this.Sj(!0);const S=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(S.minimumWorld,S.maximumWorld,this.og),this._submeshesOctree};class c{constructor(y){this.name=H.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new i.d(S.m.Zero(),new S.m(1,1,1)),(y=y||l.d.LastCreatedScene)&&(this.Oc=y,this.Oc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Oc.getActiveSubMeshCandidates=y=>this.getActiveSubMeshCandidates(y),this.Oc.getCollidingSubMeshCandidates=(y,g)=>this.getCollidingSubMeshCandidates(y,g),this.Oc.getIntersectingSubMeshCandidates=(y,g)=>this.getIntersectingSubMeshCandidates(y,g))}register(){this.Oc.onMeshRemovedObservable.add((y=>{const g=this.Oc.selectionOctree;if(void 0!==g&&null!==g){const f=g.qi.indexOf(y);-1!==f&&g.qi.splice(f,1)}})),this.Oc.onMeshImportedObservable.add((y=>{const g=this.Oc.selectionOctree;void 0!==g&&null!==g&&g.pi(y)}))}getActiveMeshCandidates(){var y;return(null===(y=this.Oc.ni)||void 0===y?void 0:y.select(this.Oc.frustumPlanes))||this.Oc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(y){if(y._submeshesOctree&&y.useOctreeForRenderingSelection){return y._submeshesOctree.select(this.Oc.frustumPlanes)}return this.Oc._getDefaultSubMeshCandidates(y)}getIntersectingSubMeshCandidates(y,g){if(y._submeshesOctree&&y.useOctreeForPicking){i.d.TransformToRef(g,y.getWorldMatrix(),this._tempRay);return y._submeshesOctree.intersectsRay(this._tempRay)}return this.Oc._getDefaultSubMeshCandidates(y)}getCollidingSubMeshCandidates(y,g){if(y._submeshesOctree&&y.useOctreeForCollisions){const f=g._velocityWorldLength+Math.max(g._radius.x,g._radius.y,g._radius.z);return y._submeshesOctree.intersects(g._basePointWorld,f)}return this.Oc._getDefaultSubMeshCandidates(y)}rebuild(){}dispose(){}}},11223:(y,g,f)=>{"use strict";f.d(g,{d:()=>i});var p=f(11071),S=f(11054),k=f(11062);class i{constructor(y,g,f){this.vectors=(0,p.d)(8,S.m.Zero),this.center=S.m.Zero(),this.centerWorld=S.m.Zero(),this.extendSize=S.m.Zero(),this.extendSizeWorld=S.m.Zero(),this.directions=(0,p.d)(3,S.m.Zero),this.vectorsWorld=(0,p.d)(8,S.m.Zero),this.minimumWorld=S.m.Zero(),this.maximumWorld=S.m.Zero(),this.minimum=S.m.Zero(),this.maximum=S.m.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(y,g,f)}reConstruct(y,g,f){const p=y.x,k=y.y,i=y.z,H=g.x,U=g.y,l=g.z,c=this.vectors;this.minimum.ne(p,k,i),this.maximum.ne(H,U,l),c[0].ne(p,k,i),c[1].ne(H,U,l),c[2].ne(H,k,i),c[3].ne(p,U,i),c[4].ne(p,k,l),c[5].ne(H,U,i),c[6].ne(p,U,l),c[7].ne(H,k,l),g.addToRef(y,this.center).scaleInPlace(.5),g.subtractToRef(y,this.extendSize).scaleInPlace(.5),this._worldMatrix=f||S.c.IdentityReadOnly,this._update(this._worldMatrix)}scale(y){const g=i._TmpVector3,f=this.maximum.subtractToRef(this.minimum,g[0]),p=f.length();f.normalizeFromLength(p);const S=p*y,k=f.scaleInPlace(.5*S),H=this.center.subtractToRef(k,g[1]),U=this.center.addToRef(k,g[2]);return this.reConstruct(H,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(y){const g=this.minimumWorld,f=this.maximumWorld,p=this.directions,k=this.vectorsWorld,i=this.vectors;if(y.isIdentity()){g.p(this.minimum),f.p(this.maximum);for(let y=0;y<8;++y)k[y].p(i[y]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{g.me(Number.MAX_VALUE),f.me(-Number.MAX_VALUE);for(let p=0;p<8;++p){const H=k[p];S.m.TransformCoordinatesToRef(i[p],y,H),g.minimizeInPlace(H),f.maximizeInPlace(H)}f.subtractToRef(g,this.extendSizeWorld).scaleInPlace(.5),f.addToRef(g,this.centerWorld).scaleInPlace(.5)}S.m.FromArrayToRef(y.m,0,p[0]),S.m.FromArrayToRef(y.m,4,p[1]),S.m.FromArrayToRef(y.m,8,p[2]),this._worldMatrix=y}isInFrustum(y){return i.IsInFrustum(this.vectorsWorld,y)}isCompletelyInFrustum(y){return i.IsCompletelyInFrustum(this.vectorsWorld,y)}intersectsPoint(y){const g=this.minimumWorld,f=this.maximumWorld,p=g.x,S=g.y,i=g.z,H=f.x,U=f.y,l=f.z,c=y.x,Z=y.y,C=y.z,q=-k.e;return!(H-c<q||q>c-p)&&(!(U-Z<q||q>Z-S)&&!(l-C<q||q>C-i))}intersectsSphere(y){return i.IntersectsSphere(this.minimumWorld,this.maximumWorld,y.centerWorld,y.radiusWorld)}intersectsMinMax(y,g){const f=this.minimumWorld,p=this.maximumWorld,S=f.x,k=f.y,i=f.z,H=p.x,U=p.y,l=p.z,c=y.x,Z=y.y,C=y.z,q=g.x,W=g.y,j=g.z;return!(H<c||S>q)&&(!(U<Z||k>W)&&!(l<C||i>j))}dispose(){var y,g;null===(y=this._drawWrapperFront)||void 0===y||y.dispose(),null===(g=this._drawWrapperBack)||void 0===g||g.dispose()}static Intersects(y,g){return y.intersectsMinMax(g.minimumWorld,g.maximumWorld)}static IntersectsSphere(y,g,f,p){const k=i._TmpVector3[0];S.m.ClampToRef(f,y,g,k);return S.m.DistanceSquared(f,k)<=p*p}static IsCompletelyInFrustum(y,g){for(let f=0;f<6;++f){const p=g[f];for(let g=0;g<8;++g)if(p.dotCoordinate(y[g])<0)return!1}return!0}static IsInFrustum(y,g){for(let f=0;f<6;++f){let p=!0;const S=g[f];for(let g=0;g<8;++g)if(S.dotCoordinate(y[g])>=0){p=!1;break}if(p)return!1}return!0}}i._TmpVector3=(0,p.d)(3,S.m.Zero)},11221:(y,g,f)=>{"use strict";f.d(g,{b:()=>Z});var p=f(11071),S=f(11054),k=f(11223),i=f(11228);const H={min:0,max:0},U={min:0,max:0},l=(y,g,f)=>{const p=S.m.Dot(g.centerWorld,y),k=Math.abs(S.m.Dot(g.directions[0],y))*g.extendSize.x+Math.abs(S.m.Dot(g.directions[1],y))*g.extendSize.y+Math.abs(S.m.Dot(g.directions[2],y))*g.extendSize.z;f.min=p-k,f.max=p+k},c=(y,g,f)=>(l(y,g,H),l(y,f,U),!(H.min>U.max||U.min>H.max));class Z{constructor(y,g,f){this._isLocked=!1,this.boundingBox=new k.d(y,g,f),this.boundingSphere=new i.d(y,g,f)}reConstruct(y,g,f){this.boundingBox.reConstruct(y,g,f),this.boundingSphere.reConstruct(y,g,f)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(y){this._isLocked=y}update(y){this._isLocked||(this.boundingBox._update(y),this.boundingSphere._update(y))}centerOn(y,g){const f=Z._TmpVector3[0].p(y).ti(g),p=Z._TmpVector3[1].p(y).addInPlace(g);return this.boundingBox.reConstruct(f,p,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(f,p,this.boundingBox.getWorldMatrix()),this}encapsulate(y){const g=S.m.Minimize(this.minimum,y),f=S.m.Maximize(this.maximum,y);return this.reConstruct(g,f,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(y){const g=S.j.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(g);const f=S.j.o[0];return S.m.TransformCoordinatesToRef(y.boundingBox.minimumWorld,g,f),this.encapsulate(f),S.m.TransformCoordinatesToRef(y.boundingBox.maximumWorld,g,f),this.encapsulate(f),this}scale(y){return this.boundingBox.scale(y),this.boundingSphere.scale(y),this}isInFrustum(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===g||3===g)&&this.boundingSphere.isCenterInFrustum(y))return!0;if(!this.boundingSphere.isInFrustum(y))return!1;return!(1!==g&&3!==g)||this.boundingBox.isInFrustum(y)}get diagonalLength(){const y=this.boundingBox;return y.maximumWorld.subtractToRef(y.minimumWorld,Z._TmpVector3[0]).length()}isCompletelyInFrustum(y){return this.boundingBox.isCompletelyInFrustum(y)}_checkCollision(y){return y._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(y){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(y)&&!!this.boundingBox.intersectsPoint(y))}intersects(y,g){if(!i.d.Intersects(this.boundingSphere,y.boundingSphere))return!1;if(!k.d.Intersects(this.boundingBox,y.boundingBox))return!1;if(!g)return!0;const f=this.boundingBox,p=y.boundingBox;return!!c(f.directions[0],f,p)&&(!!c(f.directions[1],f,p)&&(!!c(f.directions[2],f,p)&&(!!c(p.directions[0],f,p)&&(!!c(p.directions[1],f,p)&&(!!c(p.directions[2],f,p)&&(!!c(S.m.Cross(f.directions[0],p.directions[0]),f,p)&&(!!c(S.m.Cross(f.directions[0],p.directions[1]),f,p)&&(!!c(S.m.Cross(f.directions[0],p.directions[2]),f,p)&&(!!c(S.m.Cross(f.directions[1],p.directions[0]),f,p)&&(!!c(S.m.Cross(f.directions[1],p.directions[1]),f,p)&&(!!c(S.m.Cross(f.directions[1],p.directions[2]),f,p)&&(!!c(S.m.Cross(f.directions[2],p.directions[0]),f,p)&&(!!c(S.m.Cross(f.directions[2],p.directions[1]),f,p)&&!!c(S.m.Cross(f.directions[2],p.directions[2]),f,p))))))))))))))}}Z._TmpVector3=(0,p.d)(2,S.m.Zero)},11228:(y,g,f)=>{"use strict";f.d(g,{d:()=>k});var p=f(11071),S=f(11054);class k{constructor(y,g,f){this.center=S.m.Zero(),this.centerWorld=S.m.Zero(),this.minimum=S.m.Zero(),this.maximum=S.m.Zero(),this.reConstruct(y,g,f)}reConstruct(y,g,f){this.minimum.p(y),this.maximum.p(g);const p=S.m.Distance(y,g);g.addToRef(y,this.center).scaleInPlace(.5),this.radius=.5*p,this._update(f||S.c.IdentityReadOnly)}scale(y){const g=this.radius*y,f=k._TmpVector3,p=f[0].me(g),S=this.center.subtractToRef(p,f[1]),i=this.center.addToRef(p,f[2]);return this.reConstruct(S,i,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(y){if(y.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{S.m.TransformCoordinatesToRef(this.center,y,this.centerWorld);const g=k._TmpVector3[0];S.m.TransformNormalFromFloatsToRef(1,1,1,y,g),this.radiusWorld=Math.max(Math.abs(g.x),Math.abs(g.y),Math.abs(g.z))*this.radius}}isInFrustum(y){const g=this.centerWorld,f=this.radiusWorld;for(let p=0;p<6;p++)if(y[p].dotCoordinate(g)<=-f)return!1;return!0}isCenterInFrustum(y){const g=this.centerWorld;for(let f=0;f<6;f++)if(y[f].dotCoordinate(g)<0)return!1;return!0}intersectsPoint(y){const g=S.m.DistanceSquared(this.centerWorld,y);return!(this.radiusWorld*this.radiusWorld<g)}static Intersects(y,g){const f=S.m.DistanceSquared(y.centerWorld,g.centerWorld),p=y.radiusWorld+g.radiusWorld;return!(p*p<f)}static CreateFromCenterAndRadius(y,g,f){this._TmpVector3[0].p(y),this._TmpVector3[1].ne(0,0,g),this._TmpVector3[2].p(y),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ti(this._TmpVector3[1]);const p=new k(this._TmpVector3[0],this._TmpVector3[2]);return p._worldMatrix=f||S.c.Identity(),p}}k._TmpVector3=(0,p.d)(3,S.m.Zero)},11716:(y,g,f)=>{"use strict";f.d(g,{d:()=>q});var p=f(11038),S=f(11334),k=f(11062),i=f(11054),H=f(11071),U=f(11216),l=f(11122),c=f(10761),Z=f(11174);const C={internalPickerForMesh:void 0};class q{constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.e;this.origin=y,this.direction=g,this.length=f,this.epsilon=p}clone(){return new q(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const p=q._TmpVector3[0].ne(y.x-f,y.y-f,y.z-f),S=q._TmpVector3[1].ne(g.x+f,g.y+f,g.z+f);let k,i,H,U,l=0,c=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<p.x||this.origin.x>S.x)return!1}else if(k=1/this.direction.x,i=(p.x-this.origin.x)*k,H=(S.x-this.origin.x)*k,H===-1/0&&(H=1/0),i>H&&(U=i,i=H,H=U),l=Math.max(i,l),c=Math.min(H,c),l>c)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<p.y||this.origin.y>S.y)return!1}else if(k=1/this.direction.y,i=(p.y-this.origin.y)*k,H=(S.y-this.origin.y)*k,H===-1/0&&(H=1/0),i>H&&(U=i,i=H,H=U),l=Math.max(i,l),c=Math.min(H,c),l>c)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<p.z||this.origin.z>S.z)return!1}else if(k=1/this.direction.z,i=(p.z-this.origin.z)*k,H=(S.z-this.origin.z)*k,H===-1/0&&(H=1/0),i>H&&(U=i,i=H,H=U),l=Math.max(i,l),c=Math.min(H,c),l>c)return!1;return!0}intersectsBox(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(y.minimum,y.maximum,g)}intersectsSphere(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=y.center.x-this.origin.x,p=y.center.y-this.origin.y,S=y.center.z-this.origin.z,k=f*f+p*p+S*S,i=y.radius+g,H=i*i;if(k<=H)return!0;const U=f*this.direction.x+p*this.direction.y+S*this.direction.z;if(U<0)return!1;return k-U*U<=H}intersectsTriangle(y,g,f){const p=q._TmpVector3[0],S=q._TmpVector3[1],k=q._TmpVector3[2],H=q._TmpVector3[3],l=q._TmpVector3[4];g.subtractToRef(y,p),f.subtractToRef(y,S),i.m.CrossToRef(this.direction,S,k);const c=i.m.Dot(p,k);if(0===c)return null;const Z=1/c;this.origin.subtractToRef(y,H);const C=i.m.Dot(H,k)*Z;if(C<-this.epsilon||C>1+this.epsilon)return null;i.m.CrossToRef(H,p,l);const W=i.m.Dot(this.direction,l)*Z;if(W<-this.epsilon||C+W>1+this.epsilon)return null;const j=i.m.Dot(S,l)*Z;return j>this.length?null:new U.b(1-C-W,C,j)}intersectsPlane(y){let g;const f=i.m.Dot(y.k,this.direction);if(Math.abs(f)<9.99999997475243e-7)return null;{const p=i.m.Dot(y.k,this.origin);return g=(-y.d-p)/f,g<0?g<-9.99999997475243e-7?null:0:g}}intersectsAxis(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(y){case"y":{const y=(this.origin.y-g)/this.direction.y;return y>0?null:new i.m(this.origin.x+this.direction.x*-y,g,this.origin.z+this.direction.z*-y)}case"x":{const y=(this.origin.x-g)/this.direction.x;return y>0?null:new i.m(g,this.origin.y+this.direction.y*-y,this.origin.z+this.direction.z*-y)}case"z":{const y=(this.origin.z-g)/this.direction.z;return y>0?null:new i.m(this.origin.x+this.direction.x*-y,this.origin.y+this.direction.y*-y,g)}default:return null}}intersectsMesh(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const H=i.j.Matrix[0];return y.getWorldMatrix().invertToRef(H),this._tmpRay?q.TransformToRef(this,H,this._tmpRay):this._tmpRay=q.Transform(this,H),y.intersects(this._tmpRay,g,f,p,S,k)}intersectsMeshes(y,g,f){f?f.length=0:f=[];for(let p=0;p<y.length;p++){const S=this.intersectsMesh(y[p],g);S.hit&&f.push(S)}return f.sort(this._comparePickingInfo),f}_comparePickingInfo(y,g){return y.distance<g.distance?-1:y.distance>g.distance?1:0}intersectionSegment(y,g,f){const p=this.origin,S=i.j.o[0],k=i.j.o[1],H=i.j.o[2],U=i.j.o[3];g.subtractToRef(y,S),this.direction.scaleToRef(q._Rayl,H),p.addToRef(H,k),y.subtractToRef(p,U);const l=i.m.Dot(S,S),c=i.m.Dot(S,H),Z=i.m.Dot(H,H),C=i.m.Dot(S,U),W=i.m.Dot(H,U),j=l*Z-c*c;let P,B,R=j,G=j;j<q._Smallnum?(P=0,R=1,B=W,G=Z):(P=c*W-Z*C,B=l*W-c*C,P<0?(P=0,B=W,G=Z):P>R&&(P=R,B=W+c,G=Z)),B<0?(B=0,-C<0?P=0:-C>l?P=R:(P=-C,R=l)):B>G&&(B=G,-C+c<0?P=0:-C+c>l?P=R:(P=-C+c,R=l));const z=Math.abs(P)<q._Smallnum?0:P/R,T=Math.abs(B)<q._Smallnum?0:B/G,Q=i.j.o[4];H.scaleToRef(T,Q);const m=i.j.o[5];S.scaleToRef(z,m),m.addInPlace(U);const a=i.j.o[6];m.subtractToRef(Q,a);return T>0&&T<=this.length&&a.lengthSquared()<f*f?m.length():-1}update(y,g,f,p,S,k,H){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){q._RayDistant||(q._RayDistant=q.Zero()),q._RayDistant.unprojectRayToRef(y,g,f,p,i.c.IdentityReadOnly,k,H);const U=i.j.Matrix[0];S.invertToRef(U),q.TransformToRef(q._RayDistant,U,this)}else this.unprojectRayToRef(y,g,f,p,S,k,H);return this}static Zero(){return new q(i.m.Zero(),i.m.Zero())}static CreateNew(y,g,f,p,S,k,i){return q.Zero().update(y,g,f,p,S,k,i)}static CreateNewFromTo(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.IdentityReadOnly;const p=new q(new i.m(0,0,0),new i.m(0,0,0));return q.CreateFromToToRef(y,g,p,f)}static CreateFromToToRef(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.c.IdentityReadOnly;f.origin.p(y);const S=g.subtractToRef(y,f.direction),k=Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z);return f.length=k,f.direction.normalize(),q.TransformToRef(f,p,f)}static Transform(y,g){const f=new q(new i.m(0,0,0),new i.m(0,0,0));return q.TransformToRef(y,g,f),f}static TransformToRef(y,g,f){i.m.TransformCoordinatesToRef(y.origin,g,f.origin),i.m.TransformNormalToRef(y.direction,g,f.direction),f.length=y.length,f.epsilon=y.epsilon;const p=f.direction,S=p.length();if(0!==S&&1!==S){const y=1/S;p.x*=y,p.y*=y,p.z*=y,f.length*=S}return f}unprojectRayToRef(y,g,f,p,S,k,H){const U=i.j.Matrix[0];S.multiplyToRef(k,U),U.multiplyToRef(H,U),U.invert();const l=c.d.LastCreatedEngine,Z=i.j.o[0];Z.x=y/f*2-1,Z.y=-(g/p*2-1),Z.z=null!==l&&void 0!==l&&l.useReverseDepthBuffer?1:null!==l&&void 0!==l&&l.isNDCHalfZRange?0:-1;const C=i.j.o[1].ne(Z.x,Z.y,1-1e-8),q=i.j.o[2],W=i.j.o[3];i.m._UnprojectFromInvertedMatrixToRef(Z,U,q),i.m._UnprojectFromInvertedMatrixToRef(C,U,W),this.origin.p(q),W.subtractToRef(q,this.direction),this.direction.normalize()}}function W(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=q.Zero();return j(y,g,f,p,i,S,k),i}function j(y,g,f,p,S,k){let H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=y.getEngine();if(!k&&!(k=y.activeCamera))return y;const c=k.viewport,Z=l.getRenderHeight(),{x:C,y:q,width:W,height:j}=c.toGlobal(l.getRenderWidth(),Z),P=1/l.getHardwareScalingLevel();return g=g*P-C,f=f*P-(Z-q-j),S.update(g,f,W,j,p||i.c.IdentityReadOnly,H?i.c.IdentityReadOnly:k.getViewMatrix(),k.getProjectionMatrix(),U),y}function P(y,g,f,p,S){if(!l.c)return y;const k=y.getEngine();if(!S&&!(S=y.activeCamera))throw new Error("Active camera not set");const H=S.viewport,U=k.getRenderHeight(),{x:c,y:Z,width:C,height:q}=H.toGlobal(k.getRenderWidth(),U),W=i.c.Identity(),j=1/k.getHardwareScalingLevel();return g=g*j-c,f=f*j-(U-Z-q),p.update(g,f,C,q,W,W,S.getProjectionMatrix()),y}function B(y,g,f,p,S,k,i,H){const U=g(p,f.enableDistantPicking),l=f.intersects(U,S,i,k,p,H);return l&&l.hit?!S&&null!=y&&l.distance>=y.distance?null:l:null}function R(y,g,f,p,S,k){let H=null;const U=!!(y.activeCameras&&y.activeCameras.length>1&&y.cameraToUseForPointers!==y.activeCamera),c=y.cameraToUseForPointers||y.activeCamera,Z=C.internalPickerForMesh||B;for(let l=0;l<y.meshes.length;l++){const C=y.meshes[l];if(f){if(!f(C,-1))continue}else if(!C.isEnabled()||!C.isVisible||!C.Lb)continue;const q=U&&C.isWorldMatrixCameraDependent(),W=C.Sj(q,c);if(C.hasThinInstances&&C.thinInstanceEnablePicking){const y=Z(H,g,C,W,!0,!0,k);if(y){if(S)return y;const U=i.j.Matrix[1],l=C.thinInstanceGetWorldMatrices();for(let y=0;y<l.length;y++){if(f&&!f(C,y))continue;l[y].multiplyToRef(W,U);const i=Z(H,g,C,U,p,S,k,!0);if(i&&(H=i,H.thinInstanceIndex=y,p))return H}}}else{const y=Z(H,g,C,W,p,S,k);if(y&&(H=y,p))return H}}return H||new l.c}function G(y,g,f,p){if(!l.c)return null;const S=[],k=!!(y.activeCameras&&y.activeCameras.length>1&&y.cameraToUseForPointers!==y.activeCamera),H=y.cameraToUseForPointers||y.activeCamera,U=C.internalPickerForMesh||B;for(let l=0;l<y.meshes.length;l++){const c=y.meshes[l];if(f){if(!f(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.Lb)continue;const Z=k&&c.isWorldMatrixCameraDependent(),C=c.Sj(Z,H);if(c.hasThinInstances&&c.thinInstanceEnablePicking){if(U(null,g,c,C,!0,!0,p)){const y=i.j.Matrix[1],k=c.thinInstanceGetWorldMatrices();for(let i=0;i<k.length;i++){if(f&&!f(c,i))continue;k[i].multiplyToRef(C,y);const H=U(null,g,c,y,!1,!1,p,!0);H&&(H.thinInstanceIndex=i,S.push(H))}}}else{const y=U(null,g,c,C,!1,!1,p);y&&S.push(y)}}return S}function z(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;p||(p=y.getWorldMatrix()),g.length=f,S?g.origin.p(S):g.origin.p(y.position);const k=i.j.o[2];k.set(0,0,y._scene.useRightHandedSystem?-1:1);const H=i.j.o[3];return i.m.TransformNormalToRef(k,p,H),i.m.NormalizeToRef(H,g.direction),g}var T,Q;q._TmpVector3=(0,H.d)(6,i.m.Zero),q._RayDistant=q.Zero(),q._Smallnum=1e-8,q._Rayl=1e9,T=p.e,(Q=S.d)&&(Q.prototype.getForwardRay=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;return z(this,new q(i.m.Zero(),i.m.Zero(),y),y,g,f)},Q.prototype.getForwardRayToRef=function(y){return z(this,y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),T&&(Z.b._IsPickingAvailable=!0,T.prototype.createPickingRay=function(y,g,f,p){return W(this,y,g,f,p,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),p.e.prototype.createPickingRayToRef=function(y,g,f,p,S){return j(this,y,g,f,p,S,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},p.e.prototype.createPickingRayInCameraSpace=function(y,g,f){return function(y,g,f,p){const S=q.Zero();return P(y,g,f,S,p),S}(this,y,g,f)},p.e.prototype.createPickingRayInCameraSpaceToRef=function(y,g,f,p){return P(this,y,g,f,p)},p.e.prototype.pickWithBoundingInfo=function(y,g,f,p,S){return function(y,g,f,p,S,k){if(!l.c)return null;const H=R(y,(p=>(y._tempPickingRay||(y._tempPickingRay=q.Zero()),j(y,g,f,p,y._tempPickingRay,k||null),y._tempPickingRay)),p,S,!0);return H&&(H.ray=W(y,g,f,i.c.Identity(),k||null)),H}(this,y,g,f,p,S)},p.e.prototype.bd=function(y,g,f,p,S,k){return function(y,g,f,p,S,k,H){const U=R(y,((p,S)=>(y._tempPickingRay||(y._tempPickingRay=q.Zero()),j(y,g,f,p,y._tempPickingRay,k||null,!1,S),y._tempPickingRay)),p,S,!1,H);return U&&(U.ray=W(y,g,f,i.c.Identity(),k||null)),U}(this,y,g,f,p,S,k)},p.e.prototype.pickWithRay=function(y,g,f,p){return function(y,g,f,p,S){const k=R(y,(f=>(y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=i.c.Identity()),f.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=q.Zero()),q.TransformToRef(g,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform)),f,p,!1,S);return k&&(k.ray=g),k}(this,y,g,f,p)},p.e.prototype.multiPick=function(y,g,f,p,S){return function(y,g,f,p,S,k){return G(y,(p=>W(y,g,f,p,S||null)),p,k)}(this,y,g,f,p,S)},p.e.prototype.multiPickWithRay=function(y,g,f){return function(y,g,f,p){return G(y,(f=>(y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=i.c.Identity()),f.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=q.Zero()),q.TransformToRef(g,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform)),f,p)}(this,y,g,f)}},11607:(y,g,f)=>{"use strict";var p=f(10845),S=f(10736),k=f(10766),i=f(10878),H=f(10797),U=f(10860);H.b.prototype._partialLoadFile=function(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(y,(y=>{f[g]=y,f._internalCount++,6===f._internalCount&&p(f)}),void 0,void 0,!0,((y,g)=>{S&&y&&S(y.status+" "+y.statusText,g)}))},H.b.prototype._cascadeLoadFiles=function(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=[];S._internalCount=0;for(let k=0;k<6;k++)this._partialLoadFile(f[k],k,S,g,p)},H.b.prototype._cascadeLoadImgs=function(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5?arguments[5]:void 0;const i=[];i._internalCount=0;for(let H=0;H<6;H++)this._partialLoadImg(p[H],H,i,y,g,f,S,k)},H.b.prototype._partialLoadImg=function(y,g,f,p,S,H){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0;const c=(0,i.e)();(0,k.s)(y,(y=>{f[g]=y,f._internalCount++,p&&p.removePendingData(c),6===f._internalCount&&H&&H(S,f)}),((y,g)=>{p&&p.removePendingData(c),U&&U(y,g)}),p?p.offlineProvider:null,l),p&&p.addPendingData(c)},H.b.prototype.createCubeTextureBase=function(y,g,f,k){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,j=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,P=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],R=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const G=W||new p.d(this,7);G.isCube=!0,G.url=y,G.generateMipMaps=!k,G._lodGenerationScale=C,G._lodGenerationOffset=q,G._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!k),G!==W&&(G.label=y.substring(0,60)),this._doNotHandleContextLost||(G._extension=c,G._files=f,G._buffer=R);const z=y;this._transformTextureUrl&&!W&&(y=this._transformTextureUrl(y));const T=y.split("?")[0],Q=T.lastIndexOf("."),m=c||(Q>-1?T.substring(Q).toLowerCase():""),a=(0,U.e)(m),w=(p,U)=>{y===z?H&&p&&H(p.status+" "+p.statusText,U):(S.d.Warn(`Failed to load ${y}, falling back to the ${z}`),this.createCubeTextureBase(z,g,f,!!k,i,H,l,c,Z,C,q,G,j,P,B,R))};if(a)a.then((p=>{const k=y=>{j&&j(G,y),p.loadCubeData(y,G,Z,i,H)};R?k(R):f&&6===f.length?p.supportCascades?this._cascadeLoadFiles(g,(y=>k(y.map((y=>new Uint8Array(y))))),f,H):H?H("Textures type does not support cascades."):S.d.Warn("Texture loader does not support cascades."):this._loadFile(y,(y=>k(new Uint8Array(y))),void 0,void 0,!0,w)}));else{if(!f||0===f.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(g,G,((y,g)=>{P&&P(y,g)}),f,H)}return this._internalTexturesCache.push(G),G}},11551:(y,g,f)=>{"use strict";f(10797).b.prototype.createDepthStencilTexture=function(y,g,f){if(g.isCube){const f=y.width||y;return this._createDepthStencilCubeTexture(f,g)}return this._createDepthStencilTexture(y,g,f)}},11530:(y,g,f)=>{"use strict";f(11502).ThinEngine.prototype.setAlphaMode=function(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==y){switch(y){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}g||(this.depthCullingState.depthMask=0===y),this._alphaMode=y}else if(!g){const g=0===y;this.depthCullingState.depthMask!==g&&(this.depthCullingState.depthMask=g)}}},11500:(y,g,f)=>{"use strict";var p=f(11502);p.ThinEngine.prototype.updateDynamicIndexBuffer=function(y,g){let f;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(y),f=y.is32Bits?g instanceof Uint32Array?g:new Uint32Array(g):g instanceof Uint16Array?g:new Uint16Array(g),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,f,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},p.ThinEngine.prototype.updateDynamicVertexBuffer=function(y,g,f,p){this.bindArrayBuffer(y),void 0===f&&(f=0);const S=g.byteLength||g.length;void 0===p||p>=S&&0===f?g instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,f,new Float32Array(g)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,f,g):g instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(g).subarray(f,f+p)):(g=g instanceof ArrayBuffer?new Uint8Array(g,f,p):new Uint8Array(g.buffer,g.byteOffset+f,p),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,g)),this._resetVertexBufferBinding()}},11539:(y,g,f)=>{"use strict";var p=f(10845),S=f(10736),k=f(11502),i=f(11545);class H extends i.e{constructor(y,g,f,p,S){super(y,g,f,p),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=S}_cloneRenderTargetWrapper(){let y=null;return this._colorTextureArray&&this._depthStencilTextureArray?(y=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),y.texture.isReady=!0):y=super._cloneRenderTargetWrapper(),y}_swapRenderTargetWrapper(y){super._swapRenderTargetWrapper(y),y._framebuffer=this._framebuffer,y._depthStencilBuffer=this._depthStencilBuffer,y._MSAAFramebuffer=this._MSAAFramebuffer,y._colorTextureArray=this._colorTextureArray,y._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,k=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const y=this._engine,g=y._currentFramebuffer,f=this._context;y._bindUnboundFramebuffer(this._framebuffer),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,null),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,null),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.STENCIL_ATTACHMENT,f.RENDERBUFFER,null),y._bindUnboundFramebuffer(g),f.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(y,g,f,p,S,k)}shareDepth(y){super.shareDepth(y);const g=this._context,f=this._depthStencilBuffer,p=y._MSAAFramebuffer||y._framebuffer,S=this._engine;y._depthStencilBuffer&&y._depthStencilBuffer!==f&&g.deleteRenderbuffer(y._depthStencilBuffer),y._depthStencilBuffer=f;const k=y._generateStencilBuffer?g.DEPTH_STENCIL_ATTACHMENT:g.DEPTH_ATTACHMENT;S._bindUnboundFramebuffer(p),g.framebufferRenderbuffer(g.FRAMEBUFFER,k,g.RENDERBUFFER,f),S._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!y._hardwareTexture)return;const S=this._framebuffer,k=this._engine,i=k._currentFramebuffer;if(k._bindUnboundFramebuffer(S),k.webGLVersion>1){const S=this._context,k=S["COLOR_ATTACHMENT"+g];var H;if(y.is2DArray||y.is3D)f=f??(null===(H=this.layerIndices)||void 0===H?void 0:H[g])??0,S.framebufferTextureLayer(S.FRAMEBUFFER,k,y._hardwareTexture.underlyingResource,p,f);else if(y.isCube){var U;f=f??(null===(U=this.faceIndices)||void 0===U?void 0:U[g])??0,S.framebufferTexture2D(S.FRAMEBUFFER,k,S.TEXTURE_CUBE_MAP_POSITIVE_X+f,y._hardwareTexture.underlyingResource,p)}else S.framebufferTexture2D(S.FRAMEBUFFER,k,S.TEXTURE_2D,y._hardwareTexture.underlyingResource,p)}else{const S=this._context,k=S["COLOR_ATTACHMENT"+g+"_WEBGL"],i=void 0!==f?S.TEXTURE_CUBE_MAP_POSITIVE_X+f:S.TEXTURE_2D;S.framebufferTexture2D(S.FRAMEBUFFER,k,i,y._hardwareTexture.underlyingResource,p)}k._bindUnboundFramebuffer(i)}setTexture(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(y,g,f),this._bindTextureRenderTarget(y,g)}setLayerAndFaceIndices(y,g){var f;if(super.setLayerAndFaceIndices(y,g),!this.textures||!this.layerIndices||!this.faceIndices)return;const p=(null===(f=this._attachments)||void 0===f?void 0:f.length)??this.textures.length;for(let S=0;S<p;S++){const y=this.textures[S];y&&(y.is2DArray||y.is3D?this._bindTextureRenderTarget(y,S,this.layerIndices[S]):y.isCube?this._bindTextureRenderTarget(y,S,this.faceIndices[S]):this._bindTextureRenderTarget(y,S))}}setLayerAndFaceIndex(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(y,g,f),!this.textures||!this.layerIndices||!this.faceIndices)return;const p=this.textures[y];p.is2DArray||p.is3D?this._bindTextureRenderTarget(this.textures[y],y,this.layerIndices[y]):p.isCube&&this._bindTextureRenderTarget(this.textures[y],y,this.faceIndices[y])}dispose(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const g=this._context;y||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(g.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(g.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(g.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(y)}}f(11551);k.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(y,g,f){const p=new H(y,g,f,this,this._gl);return this._renderTargetWrapperCache.push(p),p},k.ThinEngine.prototype.createRenderTargetTexture=function(y,g){const f=this._createHardwareRenderTargetWrapper(!1,!1,y);let p,S,k=!0,i=!1,H=!1,U=1;void 0!==g&&"object"===typeof g&&(k=g.generateDepthBuffer??!0,i=!!g.generateStencilBuffer,H=!!g.noColorAttachment,p=g.colorAttachment,U=g.samples??1,S=g.label);const l=p||(H?null:this._createInternalTexture(y,g,!0,5)),c=y.width||y,Z=y.height||y,C=this._currentFramebuffer,q=this._gl,W=q.createFramebuffer();if(this._bindUnboundFramebuffer(W),f._depthStencilBuffer=this._setupFramebufferDepthAttachments(i,k,c,Z),!l||l.is2DArray||l.is3D||q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,l._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(C),f.label=S??"RenderTargetWrapper",f._framebuffer=W,f._generateDepthBuffer=k,f._generateStencilBuffer=i,f.setTextures(l),p){if(f._samples=p.samples,p.samples>1){const y=p._hardwareTexture.getMSAARenderBuffer(0);f._MSAAFramebuffer=q.createFramebuffer(),this._bindUnboundFramebuffer(f._MSAAFramebuffer),q.framebufferRenderbuffer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.RENDERBUFFER,y),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(f,U);return f},k.ThinEngine.prototype._createDepthStencilTexture=function(y,g,f){const k=this._gl,i=y.layers||0,H=y.depth||0;let U=k.TEXTURE_2D;0!==i?U=k.TEXTURE_2D_ARRAY:0!==H&&(U=k.TEXTURE_3D);const l=new p.d(this,12);if(l.label=g.label,!this._caps.depthTextureExtension)return S.d.Error("Depth texture is not supported by your browser or hardware."),l;const c={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...g};if(this._bindTextureDirectly(U,l,!0),this._setupDepthStencilTexture(l,y,0!==c.comparisonFunction&&c.bilinearFiltering,c.comparisonFunction,c.samples),void 0!==c.depthTextureFormat){if(15!==c.depthTextureFormat&&16!==c.depthTextureFormat&&17!==c.depthTextureFormat&&13!==c.depthTextureFormat&&14!==c.depthTextureFormat&&18!==c.depthTextureFormat)return S.d.Error(`Depth texture ${c.depthTextureFormat} format is not supported.`),l;l.format=c.depthTextureFormat}else l.format=c.generateStencil?13:16;const Z=17===l.format||13===l.format||18===l.format;let C=k.UNSIGNED_INT;15===l.format?C=k.UNSIGNED_SHORT:17===l.format||13===l.format?C=k.UNSIGNED_INT_24_8:14===l.format?C=k.FLOAT:18===l.format&&(C=k.FLOAT_32_UNSIGNED_INT_24_8_REV);const q=Z?k.DEPTH_STENCIL:k.DEPTH_COMPONENT,W=this._getInternalFormatFromDepthTextureFormat(l.format,!0,Z);return l.is2DArray?k.texImage3D(U,0,W,l.width,l.height,i,0,q,C,null):l.is3D?k.texImage3D(U,0,W,l.width,l.height,H,0,q,C,null):k.texImage2D(U,0,W,l.width,l.height,0,q,C,null),this._bindTextureDirectly(U,null),this._internalTexturesCache.push(l),f._depthStencilBuffer&&(k.deleteRenderbuffer(f._depthStencilBuffer),f._depthStencilBuffer=null),this._bindUnboundFramebuffer(f._MSAAFramebuffer??f._framebuffer),f._generateStencilBuffer=Z,f._depthStencilTextureWithStencil=Z,f._depthStencilBuffer=this._setupFramebufferDepthAttachments(f._generateStencilBuffer,f._generateDepthBuffer,f.width,f.height,f.samples,l.format),this._bindUnboundFramebuffer(null),l},k.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(y,g){var f;if(this.webGLVersion<2||!y)return 1;if(y.samples===g)return g;const p=this._gl;g=Math.min(g,this.getCaps().maxMSAASamples),y._depthStencilBuffer&&(p.deleteRenderbuffer(y._depthStencilBuffer),y._depthStencilBuffer=null),y._MSAAFramebuffer&&(p.deleteFramebuffer(y._MSAAFramebuffer),y._MSAAFramebuffer=null);const S=null===(f=y.texture)||void 0===f?void 0:f._hardwareTexture;if(null===S||void 0===S||S.releaseMSAARenderBuffers(),y.texture&&g>1&&"function"===typeof p.renderbufferStorageMultisample){const f=p.createFramebuffer();if(!f)throw new Error("Unable to create multi sampled framebuffer");y._MSAAFramebuffer=f,this._bindUnboundFramebuffer(y._MSAAFramebuffer);const k=this._createRenderBuffer(y.texture.width,y.texture.height,g,-1,this._getRGBABufferInternalSizedFormat(y.texture.type,y.texture.format,y.texture._useSRGBBuffer),p.COLOR_ATTACHMENT0,!1);if(!k)throw new Error("Unable to create multi sampled framebuffer");null===S||void 0===S||S.addMSAARenderBuffer(k)}this._bindUnboundFramebuffer(y._MSAAFramebuffer??y._framebuffer),y.texture&&(y.texture.samples=g),y._samples=g;const k=y._depthStencilTexture?y._depthStencilTexture.format:void 0;return y._depthStencilBuffer=this._setupFramebufferDepthAttachments(y._generateStencilBuffer,y._generateDepthBuffer,y.width,y.height,g,k),this._bindUnboundFramebuffer(null),g},k.ThinEngine.prototype._setupDepthStencilTexture=function(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const k=g.width??g,i=g.height??g,H=g.layers||0,U=g.depth||0;y.baseWidth=k,y.baseHeight=i,y.width=k,y.height=i,y.is2DArray=H>0,y.depth=H||U,y.isReady=!0,y.samples=S,y.generateMipMaps=!1,y.samplingMode=f?2:1,y.type=0,y._comparisonFunction=p;const l=this._gl,c=this._getTextureTarget(y),Z=this._getSamplingParameters(y.samplingMode,!1);l.texParameteri(c,l.TEXTURE_MAG_FILTER,Z.mag),l.texParameteri(c,l.TEXTURE_MIN_FILTER,Z.min),l.texParameteri(c,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(c,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===p?(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,p),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE)))}},10789:(y,g,f)=>{"use strict";f.d(g,{d:()=>a,f:()=>Q,g:()=>m,j:()=>r,n:()=>N});class p{constructor(){this.children=[]}isValid(y){return!0}process(y,g){let f="";if(this.line){let l=this.line;const c=g.processor;if(c){var p,S,k,i,H,U;c.lineProcessor&&(l=c.lineProcessor(l,g.isFragment,g.processingContext));const f=(null===(p=g.processor)||void 0===p?void 0:p.attributeKeywordName)??"attribute",Z=g.isFragment&&null!==(S=g.processor)&&void 0!==S&&S.varyingFragmentKeywordName?null===(k=g.processor)||void 0===k?void 0:k.varyingFragmentKeywordName:!g.isFragment&&null!==(i=g.processor)&&void 0!==i&&i.varyingVertexKeywordName?null===(H=g.processor)||void 0===H?void 0:H.varyingVertexKeywordName:"varying";if(!g.isFragment&&c.attributeProcessor&&this.line.startsWith(f))l=c.attributeProcessor(this.line,y,g.processingContext);else if(c.varyingProcessor&&(null!==(U=c.varyingCheck)&&void 0!==U&&U.call(c,this.line,g.isFragment)||!c.varyingCheck&&this.line.startsWith(Z)))l=c.varyingProcessor(this.line,g.isFragment,y,g.processingContext);else if(c.uniformProcessor&&c.uniformRegexp&&c.uniformRegexp.test(this.line))g.lookForClosingBracketForUniformBuffer||(l=c.uniformProcessor(this.line,g.isFragment,y,g.processingContext));else if(c.uniformBufferProcessor&&c.uniformBufferRegexp&&c.uniformBufferRegexp.test(this.line))g.lookForClosingBracketForUniformBuffer||(l=c.uniformBufferProcessor(this.line,g.isFragment,g.processingContext),g.lookForClosingBracketForUniformBuffer=!0);else if(c.textureProcessor&&c.textureRegexp&&c.textureRegexp.test(this.line))l=c.textureProcessor(this.line,g.isFragment,y,g.processingContext);else if((c.uniformProcessor||c.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!g.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?c.uniformProcessor&&(l=c.uniformProcessor(this.line,g.isFragment,y,g.processingContext)):c.uniformBufferProcessor&&(l=c.uniformBufferProcessor(this.line,g.isFragment,g.processingContext),g.lookForClosingBracketForUniformBuffer=!0)}g.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(g.lookForClosingBracketForUniformBuffer=!1,c.endOfUniformBufferProcessor&&(l=c.endOfUniformBufferProcessor(this.line,g.isFragment,g.processingContext)))}f+=l+"\n"}return this.children.forEach((p=>{f+=p.process(y,g)})),this.additionalDefineKey&&(y[this.additionalDefineKey]=this.additionalDefineValue||"true"),f}}class S{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(y){this._lines.length=0;for(const g of y){if(!g||"\r"===g)continue;if("#"===g[0]){this._lines.push(g);continue}const y=g.trim();if(!y)continue;if(y.startsWith("//")){this._lines.push(g);continue}const f=y.indexOf(";");if(-1===f)this._lines.push(y);else if(f===y.length-1)y.length>1&&this._lines.push(y);else{const y=g.split(";");for(let g=0;g<y.length;g++){let f=y[g];f&&(f=f.trim(),f&&this._lines.push(f+(g!==y.length-1?";":"")))}}}}}class k extends p{process(y,g){for(let f=0;f<this.children.length;f++){const p=this.children[f];if(p.isValid(y))return p.process(y,g)}return""}}class i extends p{isValid(y){return this.testExpression.isTrue(y)}}class H{isTrue(y){return!0}static postfixToInfix(y){const g=[];for(const f of y)if(void 0===H._OperatorPriority[f])g.push(f);else{const y=g[g.length-1],p=g[g.length-2];g.length-=2,g.push(`(${p}${f}${y})`)}return g[g.length-1]}static infixToPostfix(y){const g=H._InfixToPostfixCache.get(y);if(g)return g.accessTime=Date.now(),g.result;if(!y.includes("&&")&&!y.includes("||")&&!y.includes(")")&&!y.includes("("))return[y];const f=[];let p=-1;const S=()=>{c=c.trim(),""!==c&&(f.push(c),c="")},k=y=>{p<H._Stack.length-1&&(H._Stack[++p]=y)},i=()=>H._Stack[p],U=()=>-1===p?"!!INVALID EXPRESSION!!":H._Stack[p--];let l=0,c="";for(;l<y.length;){const g=y.charAt(l),Z=l<y.length-1?y.substring(l,2+l):"";if("("===g)c="",k(g);else if(")"===g){for(S();-1!==p&&"("!==i();)f.push(U());U()}else if(H._OperatorPriority[Z]>1){for(S();-1!==p&&H._OperatorPriority[i()]>=H._OperatorPriority[Z];)f.push(U());k(Z),l++}else c+=g;l++}for(S();-1!==p;)"("===i()?U():f.push(U());return H._InfixToPostfixCache.size>=H.InfixToPostfixCacheLimitSize&&H.ClearCache(),H._InfixToPostfixCache.set(y,{result:f,accessTime:Date.now()}),f}static ClearCache(){const y=Array.from(H._InfixToPostfixCache.entries()).sort(((y,g)=>y[1].accessTime-g[1].accessTime));for(let g=0;g<H.InfixToPostfixCacheCleanupSize;g++)H._InfixToPostfixCache.delete(y[g][0])}}H.InfixToPostfixCacheLimitSize=5e4,H.InfixToPostfixCacheCleanupSize=25e3,H._InfixToPostfixCache=new Map,H._OperatorPriority={")":0,"(":1,"||":2,"&&":3},H._Stack=["","","","","","","","","","","","","","","","","","","",""];class U extends H{constructor(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=y,this.not=g}isTrue(y){let g=void 0!==y[this.define];return this.not&&(g=!g),g}}class l extends H{isTrue(y){return this.leftOperand.isTrue(y)||this.rightOperand.isTrue(y)}}class c extends H{isTrue(y){return this.leftOperand.isTrue(y)&&this.rightOperand.isTrue(y)}}class Z extends H{constructor(y,g,f){super(),this.define=y,this.operand=g,this.testValue=f}isTrue(y){let g=y[this.define];void 0===g&&(g=this.define);let f=!1;const p=parseInt(g),S=parseInt(this.testValue);switch(this.operand){case">":f=p>S;break;case"<":f=p<S;break;case"<=":f=p<=S;break;case">=":f=p>=S;break;case"==":f=p===S;break;case"!=":f=p!==S}return f}}var C=f(10755),q=f(10791);const W=/defined\s*?\((.+?)\)/g,j=/defined\s*?\[(.+?)\]/g,P=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,B=/__decl__/,R=/light\{X\}.(\w*)/g,G=/\{X\}/g,z=[],T=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function Q(y){y.processor&&y.processor.initializeShaders&&y.processor.initializeShaders(y.processingContext)}function m(y,g,f,p){var S;null!==(S=g.processor)&&void 0!==S&&S.preProcessShaderCode&&(y=g.processor.preProcessShaderCode(y,g.isFragment)),r(y,g,(y=>{g.processCodeAfterIncludes&&(y=g.processCodeAfterIncludes(g.isFragment?"fragment":"vertex",y,g.defines));const S=function(y,g,f){let p=function(y,g){var f;if(null!==(f=g.processor)&&void 0!==f&&f.noPrecision)return y;const p=g.shouldUseHighPrecisionShader;-1===y.indexOf("precision highp float")?y=p?"precision highp float;\n"+y:"precision mediump float;\n"+y:p||(y=y.replace("precision highp float","precision mediump float"));return y}(y,g);if(!g.processor)return p;if(0===g.processor.shaderLanguage&&-1!==p.indexOf("#version 3")&&(p=p.replace("#version 300 es",""),!g.processor.parseGLES3))return p;const S=g.defines,k=M(g,f);g.processor.preProcessor&&(p=g.processor.preProcessor(p,S,k,g.isFragment,g.processingContext));p=n(p,k,g),g.processor.postProcessor&&(p=g.processor.postProcessor(p,S,g.isFragment,g.processingContext,f?{drawBuffersExtensionDisabled:!f.getCaps().drawBuffersExtension}:{}));null!==f&&void 0!==f&&f._features.needShaderCodeInlining&&(p=f.inlineShaderCode(p));return p}(y,g,p);f(S,y)}))}function a(y,g,f){return f.processor&&f.processor.finalizeShaders?f.processor.finalizeShaders(y,g,f.processingContext):{vertexCode:y,fragmentCode:g}}function w(y){const g=/defined\((.+)\)/.exec(y);if(g&&g.length)return new U(g[1].trim(),"!"===y[0]);const f=["==","!=",">=","<=","<",">"];let p="",S=0;for(p of f)if(S=y.indexOf(p),S>-1)break;if(-1===S)return new U(y);const k=y.substring(0,S).trim(),i=y.substring(S+p.length).trim();return new Z(k,p,i)}function o(y,g){const f=new i,p=y.substring(0,g);let S=y.substring(g);return S=S.substring(0,(S.indexOf("//")+1||S.length+1)-1).trim(),f.testExpression="#ifdef"===p?new U(S):"#ifndef"===p?new U(S,!0):function(y){y=y.replace(W,"defined[$1]");const g=H.infixToPostfix(y),f=[];for(const S of g)if("||"!==S&&"&&"!==S)f.push(S);else if(f.length>=2){let y=f[f.length-1],g=f[f.length-2];f.length-=2;const p="&&"==S?new c:new l;"string"===typeof y&&(y=y.replace(j,"defined($1)")),"string"===typeof g&&(g=g.replace(j,"defined($1)")),p.leftOperand="string"===typeof g?w(g):g,p.rightOperand="string"===typeof y?w(y):y,f.push(p)}let p=f[f.length-1];return"string"===typeof p&&(p=p.replace(j,"defined($1)")),"string"===typeof p?w(p):p}(S),f}function I(y,g,f){let S=y.currentLine;for(;Y(y,f);){S=y.currentLine;const k=S.substring(0,5).toLowerCase();if("#else"===k){const f=new p;return g.children.push(f),void Y(y,f)}if("#elif"===k){const y=o(S,5);g.children.push(y),f=y}}}function Y(y,g){for(;y.canRead;){y.lineIndex++;const f=y.currentLine;if(f.indexOf("#")>=0){const p=T.exec(f);if(p&&p.length){switch(p[0]){case"#ifdef":{const p=new k;g.children.push(p);const S=o(f,6);p.children.push(S),I(y,p,S);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const p=new k;g.children.push(p);const S=o(f,7);p.children.push(S),I(y,p,S);break}case"#if":{const p=new k,S=o(f,3);g.children.push(p),p.children.push(S),I(y,p,S);break}}continue}}const S=new p;if(S.line=f,g.children.push(S),"#"===f[0]&&"d"===f[1]){const y=f.replace(";","").split(" ");S.additionalDefineKey=y[1],3===y.length&&(S.additionalDefineValue=y[2])}}return!1}function n(y,g,f){const k=new p,i=new S;return i.lineIndex=-1,i.lines=y.split("\n"),Y(i,k),k.process(g,f)}function M(y,g){var f;const p=y.defines,S={};for(const k of p){const y=k.replace("#define","").replace(";","").trim().split(" ");S[y[0]]=y.length>1?y[1]:""}return 0===(null===(f=y.processor)||void 0===f?void 0:f.shaderLanguage)&&(S.GL_ES="true"),S.__VERSION__=y.version,S[y.platformName]="true",(0,q.i)(S,null===g||void 0===g?void 0:g.isNDCHalfZRange,null===g||void 0===g?void 0:g.useReverseDepthBuffer,null===g||void 0===g?void 0:g.useExactSrgbConversions),S}function r(y,g,f){let p;for(z.length=0;null!==(p=P.exec(y));)z.push(p);let S=String(y),k=[y],i=!1;for(const H of z){let y=H[1];if(-1!==y.indexOf("__decl__")&&(y=y.replace(B,""),g.supportsUniformBuffers&&(y=y.replace("Vertex","Ubo").replace("Fragment","Ubo")),y+="Declaration"),!g.includesShadersStore[y]){const p=g.shadersRepository+"ShadersInclude/"+y+".fx";return void N.loadFile(p,(p=>{g.includesShadersStore[y]=p,r(k.join(""),g,f)}))}{let f=g.includesShadersStore[y];if(H[2]){const y=H[3].split(",");for(let g=0;g<y.length;g+=2){const p=new RegExp(y[g],"g"),S=y[g+1];f=f.replace(p,S)}}if(H[4]){const y=H[5];if(-1!==y.indexOf("..")){const p=y.split(".."),S=parseInt(p[0]);let k=parseInt(p[1]),i=f.slice(0);f="",isNaN(k)&&(k=g.indexParameters[p[1]]);for(let y=S;y<k;y++)g.supportsUniformBuffers||(i=i.replace(R,((y,g)=>g+"{X}"))),f+=i.replace(G,y.toString())+"\n"}else g.supportsUniformBuffers||(f=f.replace(R,((y,g)=>g+"{X}"))),f=f.replace(G,y)}const p=[];for(const y of k){const g=y.split(H[0]);for(let y=0;y<g.length-1;y++)p.push(g[y]),p.push(f);p.push(g[g.length-1])}k=p,i=i||f.indexOf("#include<")>=0||f.indexOf("#include <")>=0}}z.length=0,S=k.join(""),i?r(S.toString(),g,f):f(S)}const N={loadFile:(y,g,f,p,S,k)=>{throw(0,C.b)("FileTools")}}},11518:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{get underlyingResource(){return this._webGLTexture}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=g,!y&&(y=g.createTexture(),!y))throw new Error("Unable to create webGL texture");this.set(y)}setUsage(){}set(y){this._webGLTexture=y}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(y){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(y)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const y of this._MSAARenderBuffers)this._context.deleteRenderbuffer(y);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var y;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._MSAARenderBuffers)||void 0===y?void 0:y[g])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10791:(y,g,f)=>{"use strict";f.d(g,{c:()=>S,g:()=>k,i:()=>H,j:()=>i,m:()=>U});var p=f(10755);f(10730);const S={};function k(y,g){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(g?g+"\n":"")+y}function i(y,g,f,k,i,H,U){const l=U||S.loadFile;if(l){return l(y,g,f,k,i,H)}throw(0,p.b)("FileTools")}function H(y,g,f,p){if(y)return g?y.IS_NDC_HALF_ZRANGE="":delete y.IS_NDC_HALF_ZRANGE,f?y.USE_REVERSE_DEPTHBUFFER="":delete y.USE_REVERSE_DEPTHBUFFER,void(p?y.USE_EXACT_SRGB_CONVERSIONS="":delete y.USE_EXACT_SRGB_CONVERSIONS);{let y="";return g&&(y+="#define IS_NDC_HALF_ZRANGE"),f&&(y&&(y+="\n"),y+="#define USE_REVERSE_DEPTHBUFFER"),p&&(y&&(y+="\n"),y+="#define USE_EXACT_SRGB_CONVERSIONS"),y}}function U(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0;switch(y){case 3:{const y=(ArrayBuffer,new Int8Array(g));return p&&y.set(new Int8Array(p)),y}case 0:{const y=(ArrayBuffer,new Uint8Array(g));return p&&y.set(new Uint8Array(p)),y}case 4:{const y=g instanceof ArrayBuffer?new Int16Array(g):new Int16Array(f?g/2:g);return p&&y.set(new Int16Array(p)),y}case 5:case 8:case 9:case 10:case 2:{const y=g instanceof ArrayBuffer?new Uint16Array(g):new Uint16Array(f?g/2:g);return p&&y.set(new Uint16Array(p)),y}case 6:{const y=g instanceof ArrayBuffer?new Int32Array(g):new Int32Array(f?g/4:g);return p&&y.set(new Int32Array(p)),y}case 7:case 11:case 12:case 13:case 14:case 15:{const y=g instanceof ArrayBuffer?new Uint32Array(g):new Uint32Array(f?g/4:g);return p&&y.set(new Uint32Array(p)),y}case 1:{const y=g instanceof ArrayBuffer?new Float32Array(g):new Float32Array(f?g/4:g);return p&&y.set(new Float32Array(p)),y}}const S=(ArrayBuffer,new Uint8Array(g));return p&&S.set(new Uint8Array(p)),S}},10797:(y,g,f)=>{"use strict";f.d(g,{b:()=>G});var p=f(10761),S=f(10736),k=f(10803),i=f(10837),H=f(10747);class U{constructor(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,y&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(y){this._zOffset!==y&&(this._zOffset=y,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(y){this._zOffsetUnits!==y&&(this._zOffsetUnits=y,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(y){this._cullFace!==y&&(this._cullFace=y,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(y){this._cull!==y&&(this._cull=y,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(y){this._depthFunc!==y&&(this._depthFunc=y,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(y){this._depthMask!==y&&(this._depthMask=y,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(y){this._depthTest!==y&&(this._depthTest=y,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(y){this._frontFace!==y&&(this._frontFace=y,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(y){this.isDirty&&(this._isCullDirty&&(this.cull?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(y.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(y.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(y.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(y.enable(y.POLYGON_OFFSET_FILL),y.polygonOffset(this.zOffset,this.zOffsetUnits)):y.disable(y.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(y.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class l{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(y){this._func!==y&&(this._func=y,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(y){this._funcRef!==y&&(this._funcRef=y,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(y){this._funcMask!==y&&(this._funcMask=y,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(y){this._opStencilFail!==y&&(this._opStencilFail=y,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(y){this._opDepthFail!==y&&(this._opDepthFail=y,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(y){this._opStencilDepthPass!==y&&(this._opStencilDepthPass=y,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(y){this._mask!==y&&(this._mask=y,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(y){this._enabled!==y&&(this._enabled=y,this._isStencilTestDirty=!0)}constructor(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,y&&this.reset()}reset(){var y;this.stencilMaterial=void 0,null===(y=this.stencilGlobal)||void 0===y||y.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(y){var g;if(!y)return;const f=!this.useStencilGlobalOnly&&!(null===(g=this.stencilMaterial)||void 0===g||!g.enabled);this.enabled=f?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=f?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=f?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=f?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=f?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=f?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=f?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=f?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(y.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(y.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(y.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class c{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=c.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=c.KEEP,this.opDepthFail=c.KEEP,this.opStencilDepthPass=c.REPLACE}get stencilFunc(){return this.func}set stencilFunc(y){this.func=y}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(y){this.funcRef=y}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(y){this.funcMask=y}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(y){this.opStencilFail=y}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(y){this.opDepthFail=y}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(y){this.opStencilDepthPass=y}get stencilMask(){return this.mask}set stencilMask(y){this.mask=y}get stencilTest(){return this.enabled}set stencilTest(y){this.enabled=y}}c.ALWAYS=519,c.KEEP=7680,c.REPLACE=7681;class Z{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(y){this._alphaBlend!==y&&(this._alphaBlend=y,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(y,g,f,p){this._blendConstants[0]===y&&this._blendConstants[1]===g&&this._blendConstants[2]===f&&this._blendConstants[3]===p||(this._blendConstants[0]=y,this._blendConstants[1]=g,this._blendConstants[2]=f,this._blendConstants[3]=p,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(y,g,f,p){this._blendFunctionParameters[0]===y&&this._blendFunctionParameters[1]===g&&this._blendFunctionParameters[2]===f&&this._blendFunctionParameters[3]===p||(this._blendFunctionParameters[0]=y,this._blendFunctionParameters[1]=g,this._blendFunctionParameters[2]=f,this._blendFunctionParameters[3]=p,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(y,g){this._blendEquationParameters[0]===y&&this._blendEquationParameters[1]===g||(this._blendEquationParameters[0]=y,this._blendEquationParameters[1]=g,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(y){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?y.enable(y.BLEND):y.disable(y.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(y.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(y.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(y.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var C=f(10755),q=f(10845),W=f(10730),j=f(10723),P=f(10791),B=f(10860);function R(y,g){if((0,W.i)()){const{requestAnimationFrame:f}=g||window;if("function"===typeof f)return f(y)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(y);return setTimeout(y,16)}class G{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(y){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(y){y!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=y,this._depthCullingState.depthFunc=y?518:515)}setColorWrite(y){y!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=y)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(y){if(y)return this.isNDCHalfZRange?y.IS_NDC_HALF_ZRANGE="":delete y.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?y.USE_REVERSE_DEPTHBUFFER="":delete y.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?y.USE_EXACT_SRGB_CONVERSIONS="":delete y.USE_EXACT_SRGB_CONVERSIONS);{let y="";return this.isNDCHalfZRange&&(y+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(y&&(y+="\n"),y+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(y&&(y+="\n"),y+="#define USE_EXACT_SRGB_CONVERSIONS"),y}}_rebuildInternalTextures(){const y=this._internalTexturesCache.slice();for(const g of y)g._rebuild()}_rebuildRenderTargetWrappers(){const y=this._renderTargetWrapperCache.slice();for(const g of y)g._rebuild()}_rebuildEffects(){for(const y in this._compiledEffects){const g=this._compiledEffects[y];g._pipelineContext=null,g._prepareEffect()}k.e.ResetCache()}_rebuildGraphicsResources(){var y;this.wipeCaches(!0),this._rebuildEffects(),null===(y=this._rebuildComputeEffects)||void 0===y||y.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){S.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(y){setTimeout((async()=>{this._clearEmptyResources();const g=this._depthCullingState.depthTest,f=this._depthCullingState.depthFunc,p=this._depthCullingState.depthMask,S=this._stencilState.stencilTest;await y(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=g,this._depthCullingState.depthFunc=f,this._depthCullingState.depthMask=p,this._stencilState.stencilTest=S,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(y){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(y){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const y=new Uint8Array(4),g=[y,y,y,y,y,y];this._emptyCubeTexture=this.createRawCubeTexture(g,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(y){if(!y)return this._activeRenderLoops.length=0,void this._cancelFrame();const g=this._activeRenderLoops.indexOf(y);g>=0&&(this._activeRenderLoops.splice(g,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const y=this._frameHandler;if(this._frameHandler=0,(0,W.i)()){const{cancelAnimationFrame:g}=this.getHostWindow()||window;if("function"===typeof g)return g(y)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(y);return clearTimeout(y)}}ij(){this.onBeginFrameObservable.notifyObservers(this)}jj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let y=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(y=!1),y&&(this.ij(),this._renderViews()||this._renderFrame(),this.jj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let y=0;y<this._activeRenderLoops.length;y++){(0,this._activeRenderLoops[y])()}}_renderViews(){return!1}_queueNewFrame(y,g){return R(y,g)}runRenderLoop(y){-1===this._activeRenderLoops.indexOf(y)&&(this._activeRenderLoops.push(y),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(y){this._depthCullingState.depthTest=y}setZOffset(y){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-y:y}getZOffset(){const y=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-y:y}setZOffsetUnits(y){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-y:y}getZOffsetUnits(){const y=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-y:y}getHostWindow(){return(0,W.i)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(y){this._compatibilityMode=!0}_rebuildTextures(){for(const y of this.scenes)y._rebuildTextures();for(const y of this._virtualScenes)y._rebuildTextures()}_releaseRenderTargetWrapper(y){const g=this._renderTargetWrapperCache.indexOf(y);-1!==g&&this._renderTargetWrapperCache.splice(g,1)}get currentViewport(){return this._cachedViewport}setViewport(y,g,f){const p=g||this.getRenderWidth(),S=f||this.getRenderHeight(),k=y.x||0,i=y.y||0;this._cachedViewport=y,this._viewport(k*p,i*S,p*y.width,S*y.height)}createCanvasImage(){return document.createElement("img")}get description(){let y=this.name+this.version;return this._caps.parallelShaderCompile&&(y+=" - Parallel shader compilation"),y}_createTextureBase(y,g,f,k){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,j=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,P=arguments.length>13?arguments[13]:void 0,R=arguments.length>14?arguments[14]:void 0,z=arguments.length>15?arguments[15]:void 0;const T="data:"===(y=y||"").substr(0,5),Q="blob:"===y.substr(0,5),m=T&&-1!==y.indexOf(";base64,"),a=C||new q.d(this,1);a!==C&&(a.label=y.substring(0,60));const w=y;!this._transformTextureUrl||m||C||Z||(y=this._transformTextureUrl(y)),w!==y&&(a._originalUrl=w);const o=y.lastIndexOf(".");let I=j||(o>-1?y.substring(o).toLowerCase():"");I.indexOf("?")>-1&&(I=I.split("?")[0]);const Y=(0,B.e)(I,P);k&&k.addPendingData(a),a.url=y,a.generateMipMaps=!g,a.samplingMode=i,a.invertY=f,a._useSRGBBuffer=this._getUseSRGBBuffer(!!z,g),this._doNotHandleContextLost||(a._buffer=Z);let n=null;H&&!C&&(n=a.onLoadedObservable.add(H)),C||this._internalTexturesCache.push(a);const M=(f,C)=>{k&&k.removePendingData(a),y===w?(n&&a.onLoadedObservable.remove(n),p.d.UseFallbackTexture&&y!==p.d.FallbackTexture&&this._createTextureBase(p.d.FallbackTexture,g,a.invertY,k,i,null,U,l,c,Z,a),f=(f||"Unknown error")+(p.d.UseFallbackTexture?" - Fallback texture was used":""),a.onErrorObservable.notifyObservers({message:f,exception:C}),U&&U(f,C)):(S.d.Warn(`Failed to load ${y}, falling back to ${w}`),this._createTextureBase(w,g,a.invertY,k,i,H,U,l,c,Z,a,W,j,P,R,z))};if(Y){const g=async y=>{(await Y).loadData(y,a,((y,g,f,p,S,H)=>{H?M("TextureLoader failed to load data"):l(a,I,k,{width:y,height:g},a.invertY,!f,p,(()=>(S(),!1)),i)}),R)};Z?Z instanceof ArrayBuffer?g(new Uint8Array(Z)):ArrayBuffer.isView(Z)?g(Z):U&&U("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(y,(y=>g(new Uint8Array(y))),void 0,k?k.offlineProvider:void 0,!0,((y,g)=>{M("Unable to load "+(y&&y.responseURL,g))}))}else{const f=y=>{Q&&!this._doNotHandleContextLost&&(a._buffer=y),l(a,I,k,y,a.invertY,g,!1,c,i)};!T||m?Z&&("string"===typeof Z.decoding||Z.close)?f(Z):G._FileToolsLoadImage(y||"",f,M,k?k.offlineProvider:null,P,a.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof Z||Z instanceof ArrayBuffer||ArrayBuffer.isView(Z)||Z instanceof Blob?G._FileToolsLoadImage(Z,f,M,k?k.offlineProvider:null,P,a.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):Z&&f(Z)}return a}_rebuildBuffers(){for(const y of this._uniformBuffers)y._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,W.d)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const y in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,y)&&(this._boundTexturesCache[y]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(y){this._name=y}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(y){this._hardwareScalingLevel=y,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(y){this._doNotHandleContextLost=y}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(y,g,f){var S,k;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new U,this._stencilStateComposer=new l,this._stencilState=new c,this._alphaState=new Z,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new j.d,this.onCanvasFocusObservable=new j.d,this.onNewSceneAddedObservable=new j.d,this.onResizeObservable=new j.d,this.onCanvasPointerOutObservable=new j.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new j.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new j.d,this.onAfterShaderCompilationObservable=new j.d,this.onBeginFrameObservable=new j.d,this.onEndFrameObservable=new j.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new j.d,this.onContextRestoredObservable=new j.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.nj=new j.d,p.d.Instances.push(this),this.startTime=H.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,i.e.SetMatrixPrecision(!!g.useHighPrecisionMatrix),(0,W.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=f??!1,g.antialias=y??g.antialias,g.deterministicLockstep=g.deterministicLockstep??!1,g.lockstepMaxSteps=g.lockstepMaxSteps??4,g.timeStep=g.timeStep??1/60,g.audioEngine=g.audioEngine??!0,g.stencil=g.stencil??!0,this._audioContext=(null===(S=g.audioEngineOptions)||void 0===S?void 0:S.audioContext)??null,this._audioDestination=(null===(k=g.audioEngineOptions)||void 0===k?void 0:k.audioDestination)??null,this.premultipliedAlpha=g.premultipliedAlpha??!0,this._doNotHandleContextLost=!!g.doNotHandleContextLost,this._isStencilEnable=!!g.stencil,this.useExactSrgbConversions=g.useExactSrgbConversions??!1;const C=(0,W.i)()&&window.devicePixelRatio||1,q=g.limitDeviceRatio||C;f=f||g.adaptToDeviceRatio||!1,this._hardwareScalingLevel=f?1/Math.min(q,C):1,this._lastDevicePixelRatio=C,this._creationOptions=g}resize(){let y,g,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const y=(0,W.i)()&&window.devicePixelRatio||1,g=this._lastDevicePixelRatio/y;this._lastDevicePixelRatio=y,this._hardwareScalingLevel*=g}if((0,W.i)()&&(0,W.d)())if(this._renderingCanvas){const f=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};y=this._renderingCanvas.clientWidth||f.width||this._renderingCanvas.width||100,g=this._renderingCanvas.clientHeight||f.height||this._renderingCanvas.height||100}else y=window.innerWidth,g=window.innerHeight;else y=this._renderingCanvas?this._renderingCanvas.width:100,g=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(y/this._hardwareScalingLevel,g/this._hardwareScalingLevel,f)}setSize(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(y|=0,g|=0,!f&&this._renderingCanvas.width===y&&this._renderingCanvas.height===g)return!1;if(this._renderingCanvas.width=y,this._renderingCanvas.height=g,this.scenes){for(let y=0;y<this.scenes.length;y++){const g=this.scenes[y];for(let y=0;y<g.cameras.length;y++){g.cameras[y]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(y,g,f,p,S,k,i,H,U,l,c){throw(0,C.b)("engine.rawTexture")}createRawCubeTexture(y,g,f,p,S,k,i,H){throw(0,C.b)("engine.rawTexture")}createRawTexture3D(y,g,f,p,S,k,i,H,U,l,c){throw(0,C.b)("engine.rawTexture")}createRawTexture2DArray(y,g,f,p,S,k,i,H,U,l,c){throw(0,C.b)("engine.rawTexture")}_sharedInit(y){this._renderingCanvas=y}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const y=navigator.userAgent;this.hostInformation.isMobile=-1!==y.indexOf("Mobile")||-1!==y.indexOf("Mac")&&(0,W.d)()&&"ontouchend"in document},this._checkForMobile(),(0,W.i)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(y){return document.createElement("video")}_reportDrawCall(){var y;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(y=this._drawCalls)||void 0===y||y.addCount(g,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(y,g){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(y,g){return createImageBitmap(y,g)}resizeImageBitmap(y,g,f){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(y){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(y,g){if("undefined"===typeof document)return new OffscreenCanvas(y,g);const f=document.createElement("canvas");return f.width=y,f.height=g,f}createCanvas(y,g){return G._CreateCanvas(y,g)}static _FileToolsLoadImage(y,g,f,p,S,k){throw(0,C.b)("FileTools")}_loadFile(y,g,f,p,S,k){const i=(0,P.j)(y,g,f,p,S,k);return this._activeRequests.push(i),i.onCompleteObservable.add((()=>{const y=this._activeRequests.indexOf(i);-1!==y&&this._activeRequests.splice(y,1)})),i}static _FileToolsLoadFile(y,g,f,p,S,k){if(P.c.loadFile)return P.c.loadFile(y,g,f,p,S,k);throw(0,C.b)("FileTools")}dispose(){var y;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(y=this.releaseComputeEffects)||void 0===y||y.call(this),k.e.ResetCache();for(const f of this._activeRequests)f.abort();this._boundRenderFunction=null,this.nj.notifyObservers(this),this.nj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,W.i)()&&window.removeEventListener("resize",this._checkForMobile);const g=p.d.Instances.indexOf(this);g>=0&&p.d.Instances.splice(g,1),p.d.Instances.length||(p.d.OnEnginesDisposedObservable.notifyObservers(this),p.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(y){throw(0,C.b)("LoadingScreen")}static MarkAllMaterialsAsDirty(y,g){for(let f=0;f<p.d.Instances.length;f++){const S=p.d.Instances[f];for(let f=0;f<S.scenes.length;f++)S.scenes[f].markAllMaterialsAsDirty(y,g)}}}G._RenderPassIdCounter=0,G._RescalePostProcessFactory=null,G.CollisionsEpsilon=.001,G.QueueNewFrame=R},11534:(y,g,f)=>{"use strict";f.d(g,{d:()=>a});var p=f(10845),S=f(10761),k=f(11502),i=f(10747);class H{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new U(y)}sampleFrame(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const g=y-this._lastFrameTimeMs;this._rollingFrameTime.add(g)}this._lastFrameTimeMs=y}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const y=this._rollingFrameTime.history(0);return 0===y?0:1e3/y}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class U{constructor(y){this._samples=new Array(y),this.reset()}add(y){let g;if(this.isSaturated()){const y=this._samples[this._pos];g=y-this.average,this.average-=g/(this._sampleCount-1),this._m2-=g*(y-this.average)}else this._sampleCount++;g=y-this.average,this.average+=g/this._sampleCount,this._m2+=g*(y-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=y,this._pos++,this._pos%=this._samples.length}history(y){if(y>=this._sampleCount||y>=this._samples.length)return 0;const g=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(g-y)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(y){const g=this._samples.length;return(y%g+g)%g}}var l=f(11514),c=f(10736),Z=f(11518),C=(f(11530),f(10882));function q(y,g,f,p){let S,k=1;1===p?S=new Float32Array(g*f*4):2===p?(S=new Uint16Array(g*f*4),k=15360):S=7===p?new Uint32Array(g*f*4):new Uint8Array(g*f*4);for(let i=0;i<g;i++)for(let p=0;p<f;p++){const f=3*(p*g+i),H=4*(p*g+i);S[H+0]=y[f+0],S[H+1]=y[f+1],S[H+2]=y[f+2],S[H+3]=k}return S}function W(y){return function(g,f,S,k,i,H,U,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const C=y?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,q=y?10:11,W=new p.d(this,q);W.baseWidth=f,W.baseHeight=S,W.baseDepth=k,W.width=f,W.height=S,W.depth=k,W.format=i,W.type=Z,W.generateMipMaps=H,W.samplingMode=l,y?W.is3D=!0:W.is2DArray=!0,this._doNotHandleContextLost||(W._bufferView=g),y?this.updateRawTexture3D(W,g,i,U,c,Z):this.updateRawTexture2DArray(W,g,i,U,c,Z),this._bindTextureDirectly(C,W,!0);const j=this._getSamplingParameters(l,H);return this._gl.texParameteri(C,this._gl.TEXTURE_MAG_FILTER,j.mag),this._gl.texParameteri(C,this._gl.TEXTURE_MIN_FILTER,j.min),H&&this._gl.generateMipmap(C),this._bindTextureDirectly(C,null),this._internalTexturesCache.push(W),W}}function j(y){return function(g,f,p,S){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const H=y?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,U=this._getWebGLTextureType(i),l=this._getInternalFormat(p),c=this._getRGBABufferInternalSizedFormat(i,p);this._bindTextureDirectly(H,g,!0),this._unpackFlipY(void 0===S||!!S),this._doNotHandleContextLost||(g._bufferView=f,g.format=p,g.invertY=S,g._compression=k),g.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),k&&f?this._gl.compressedTexImage3D(H,0,this.getCaps().s3tc[k],g.width,g.height,g.depth,0,f):this._gl.texImage3D(H,0,c,g.width,g.height,g.depth,0,l,U,f),g.generateMipMaps&&this._gl.generateMipmap(H),this._bindTextureDirectly(H,null),g.isReady=!0}}k.ThinEngine.prototype.updateRawTexture=function(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!y)return;const H=this._getRGBABufferInternalSizedFormat(k,f,i),U=this._getInternalFormat(f),l=this._getWebGLTextureType(k);this._bindTextureDirectly(this._gl.TEXTURE_2D,y,!0),this._unpackFlipY(void 0===p||!!p),this._doNotHandleContextLost||(y._bufferView=g,y.format=f,y.type=k,y.invertY=p,y._compression=S),y.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),S&&g?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[S],y.width,y.height,0,g):this._gl.texImage2D(this._gl.TEXTURE_2D,0,H,y.width,y.height,0,U,l,g),y.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),y.isReady=!0},k.ThinEngine.prototype.createRawTexture=function(y,g,f,S,k,i,H){let U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const Z=new p.d(this,3);Z.baseWidth=g,Z.baseHeight=f,Z.width=g,Z.height=f,Z.format=S,Z.generateMipMaps=k,Z.samplingMode=H,Z.invertY=i,Z._compression=U,Z.type=l,Z._useSRGBBuffer=this._getUseSRGBBuffer(c,!k),this._doNotHandleContextLost||(Z._bufferView=y),this.updateRawTexture(Z,y,S,i,U,l,Z._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0);const C=this._getSamplingParameters(H,k);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,C.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,C.min),k&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(Z),Z},k.ThinEngine.prototype.createRawCubeTexture=function(y,g,f,S,k,i,H){let U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const l=this._gl,Z=new p.d(this,8);Z.isCube=!0,Z.format=f,Z.type=S,this._doNotHandleContextLost||(Z._bufferViewArray=y);const q=this._getWebGLTextureType(S);let W=this._getInternalFormat(f);W===l.RGB&&(W=l.RGBA),q!==l.FLOAT||this._caps.textureFloatLinearFiltering?q!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?q!==l.FLOAT||this._caps.textureFloatRender?q!==l.HALF_FLOAT||this._caps.colorBufferFloat||(k=!1,c.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(k=!1,c.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(k=!1,H=1,c.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(k=!1,H=1,c.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const j=g,P=j;Z.width=j,Z.height=P,Z.invertY=i,Z._compression=U;if(!this.needPOTTextures||(0,C.k)(Z.width)&&(0,C.k)(Z.height)||(k=!1),y)this.updateRawCubeTexture(Z,y,f,S,i,U);else{const y=this._getRGBABufferInternalSizedFormat(S),g=0;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,Z,!0);for(let f=0;f<6;f++)U?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+f,g,this.getCaps().s3tc[U],Z.width,Z.height,0,void 0):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+f,g,y,Z.width,Z.height,0,W,q,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,Z,!0),y&&k&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const B=this._getSamplingParameters(H,k);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,B.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,B.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),Z.generateMipMaps=k,Z.samplingMode=H,Z.isReady=!0,Z},k.ThinEngine.prototype.updateRawCubeTexture=function(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;y._bufferViewArray=g,y.format=f,y.type=p,y.invertY=S,y._compression=k;const H=this._gl,U=this._getWebGLTextureType(p);let l=this._getInternalFormat(f);const c=this._getRGBABufferInternalSizedFormat(p);let Z=!1;l===H.RGB&&(l=H.RGBA,Z=!0),this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,y,!0),this._unpackFlipY(void 0===S||!!S),y.width%4!==0&&H.pixelStorei(H.UNPACK_ALIGNMENT,1);for(let C=0;C<6;C++){let f=g[C];k?H.compressedTexImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+C,i,this.getCaps().s3tc[k],y.width,y.height,0,f):(Z&&(f=q(f,y.width,y.height,p)),H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+C,i,c,y.width,y.height,0,l,U,f))}(!this.needPOTTextures||(0,C.k)(y.width)&&(0,C.k)(y.height))&&y.generateMipMaps&&0===i&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),y.isReady=!0},k.ThinEngine.prototype.createRawCubeTextureFromUrl=function(y,g,f,p,S,k,i,H){let U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,Z=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const C=this._gl,W=this.createRawCubeTexture(null,f,p,S,!k,Z,c,null);null===g||void 0===g||g.addPendingData(W),W.url=y,W.isReady=!1,this._internalTexturesCache.push(W);const j=y=>{const f=W.width,k=i(y);if(k){if(H){const y=this._getWebGLTextureType(S);let g=this._getInternalFormat(p);const i=this._getRGBABufferInternalSizedFormat(S);let U=!1;g===C.RGB&&(g=C.RGBA,U=!0),this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,W,!0),this._unpackFlipY(!1);const l=H(k);for(let p=0;p<l.length;p++){const k=f>>p;for(let f=0;f<6;f++){let H=l[p][f];U&&(H=q(H,k,k,S)),C.texImage2D(f,p,i,k,k,0,g,y,H)}}this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(W,k,p,S,Z);W.isReady=!0,null===g||void 0===g||g.removePendingData(W),W.onLoadedObservable.notifyObservers(W),W.onLoadedObservable.clear(),U&&U()}};return this._loadFile(y,(y=>{j(y)}),void 0,null===g||void 0===g?void 0:g.offlineProvider,!0,((y,f)=>{null===g||void 0===g||g.removePendingData(W),l&&y&&l(y.status+" "+y.statusText,f)})),W},k.ThinEngine.prototype.createRawTexture2DArray=W(!1),k.ThinEngine.prototype.createRawTexture3D=W(!0),k.ThinEngine.prototype.updateRawTexture2DArray=j(!1),k.ThinEngine.prototype.updateRawTexture3D=j(!0);var P=f(10791);k.ThinEngine.prototype._readTexturePixelsSync=function(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const c=this._gl;if(!c)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const y=c.createFramebuffer();if(!y)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=y}var Z,C;(c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),p>-1)?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+p,null===(Z=y._hardwareTexture)||void 0===Z?void 0:Z.underlyingResource,S):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null===(C=y._hardwareTexture)||void 0===C?void 0:C.underlyingResource,S);let q=void 0!==y.type?this._getWebGLTextureType(y.type):c.UNSIGNED_BYTE;if(H)k||(k=(0,P.m)(y.type,4*g*f));else if(q===c.UNSIGNED_BYTE)k||(k=new Uint8Array(4*g*f)),q=c.UNSIGNED_BYTE;else k||(k=new Float32Array(4*g*f)),q=c.FLOAT;return i&&this.flushFramebuffer(),c.readPixels(U,l,g,f,c.RGBA,q,k),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),k},k.ThinEngine.prototype._readTexturePixels=function(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(y,g,f,p,S,k,i,H,U,l))};f(11500);k.ThinEngine.prototype._createDepthStencilCubeTexture=function(y,g){const f=new p.d(this,12);if(f.isCube=!0,1===this.webGLVersion)return c.d.Error("Depth cube texture is not supported by WebGL 1."),f;const S={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...g},k=this._gl;this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,f,!0),this._setupDepthStencilTexture(f,y,S.bilinearFiltering,S.comparisonFunction);for(let p=0;p<6;p++)S.generateStencil?k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,k.DEPTH24_STENCIL8,y,y,0,k.DEPTH_STENCIL,k.UNSIGNED_INT_24_8,null):k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,k.DEPTH_COMPONENT24,y,y,0,k.DEPTH_COMPONENT,k.UNSIGNED_INT,null);return this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(f),f},k.ThinEngine.prototype._setCubeMapTextureParams=function(y,g,f){const p=this._gl;p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MIN_FILTER,g?p.LINEAR_MIPMAP_LINEAR:p.LINEAR),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),y.samplingMode=g?3:2,g&&this.getCaps().textureMaxLevel&&void 0!==f&&f>0&&(p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MAX_LEVEL,f),y._maxLodLevel=f),this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null)},k.ThinEngine.prototype.createCubeTexture=function(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,W=arguments.length>13&&void 0!==arguments[13]&&arguments[13],j=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const P=this._gl;return this.createCubeTextureBase(y,g,f,!!p,S,k,i,H,U,l,Z,q,(y=>this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,y,!0)),((y,g)=>{const f=this.needPOTTextures?(0,C.i)(g[0].width,this._caps.maxCubemapTextureSize):g[0].width,k=f,H=[P.TEXTURE_CUBE_MAP_POSITIVE_X,P.TEXTURE_CUBE_MAP_POSITIVE_Y,P.TEXTURE_CUBE_MAP_POSITIVE_Z,P.TEXTURE_CUBE_MAP_NEGATIVE_X,P.TEXTURE_CUBE_MAP_NEGATIVE_Y,P.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,y,!0),this._unpackFlipY(!1);const U=i?this._getInternalFormat(i,y._useSRGBBuffer):y._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:P.RGBA;let l=i?this._getInternalFormat(i):P.RGBA;y._useSRGBBuffer&&1===this.webGLVersion&&(l=U);for(let p=0;p<H.length;p++)if(g[p].width!==f||g[p].height!==k){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void c.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=f,this._workingCanvas.height=k,this._workingContext.drawImage(g[p],0,0,g[p].width,g[p].height,0,0,f,k),P.texImage2D(H[p],0,U,l,P.UNSIGNED_BYTE,this._workingCanvas)}else P.texImage2D(H[p],0,U,l,P.UNSIGNED_BYTE,g[p]);p||P.generateMipmap(P.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(y,!p),y.width=f,y.height=k,y.isReady=!0,i&&(y.format=i),y.onLoadedObservable.notifyObservers(y),y.onLoadedObservable.clear(),S&&S()}),!!W,j)},k.ThinEngine.prototype.generateMipMapsForCubemap=function(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(y.generateMipMaps){const f=this._gl;this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,y,!0),f.generateMipmap(f.TEXTURE_CUBE_MAP),g&&this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null)}};f(11539);k.ThinEngine.prototype.setDepthStencilTexture=function(y,g,f,p){void 0!==y&&(g&&(this._boundUniforms[y]=g),f&&f.depthStencilTexture?this._setTexture(y,f,!1,!0,p):this._setTexture(y,null,void 0,void 0,p))},k.ThinEngine.prototype.createRenderTargetCubeTexture=function(y,g){const f=this._createHardwareRenderTargetWrapper(!1,!0,y),S={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...g};S.generateStencilBuffer=S.generateDepthBuffer&&S.generateStencilBuffer,(1!==S.type||this._caps.textureFloatLinearFiltering)&&(2!==S.type||this._caps.textureHalfFloatLinearFiltering)||(S.samplingMode=1);const k=this._gl,i=new p.d(this,5);this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,i,!0);const H=this._getSamplingParameters(S.samplingMode,S.generateMipMaps);1!==S.type||this._caps.textureFloat||(S.type=0,c.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAG_FILTER,H.mag),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MIN_FILTER,H.min),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);for(let p=0;p<6;p++)k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,this._getRGBABufferInternalSizedFormat(S.type,S.format),y,y,0,this._getInternalFormat(S.format),this._getWebGLTextureType(S.type),null);const U=k.createFramebuffer();return this._bindUnboundFramebuffer(U),f._depthStencilBuffer=this._setupFramebufferDepthAttachments(S.generateStencilBuffer,S.generateDepthBuffer,y,y),S.generateMipMaps&&k.generateMipmap(k.TEXTURE_CUBE_MAP),this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),f._framebuffer=U,f._generateDepthBuffer=S.generateDepthBuffer,f._generateStencilBuffer=S.generateStencilBuffer,i.width=y,i.height=y,i.isReady=!0,i.isCube=!0,i.samples=1,i.generateMipMaps=S.generateMipMaps,i.samplingMode=S.samplingMode,i.type=S.type,i.format=S.format,this._internalTexturesCache.push(i),f.setTextures(i),f};var B=f(11555),R=f(11271),G=f(11568);k.ThinEngine.prototype.createPrefilteredCubeTexture=function(y,g,f,S){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6?arguments[6]:void 0,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(y,g,null,!1,(y=>{if(!y)return void(k&&k(null));const i=y.texture;if(l?y.info.sphericalPolynomial&&(i._sphericalPolynomial=y.info.sphericalPolynomial):i._sphericalPolynomial=new B.f,i._source=9,this.getCaps().textureLOD)return void(k&&k(i));const H=this._gl,U=y.width;if(!U)return;const Z=[];for(let k=0;k<3;k++){const l=1-k/2,C=S,q=Math.log2(U)*f+S,W=C+(q-C)*l,j=Math.round(Math.min(Math.max(W,0),q)),P=new p.d(this,2);if(P.type=i.type,P.format=i.format,P.width=Math.pow(2,Math.max(Math.log2(U)-j,0)),P.height=P.width,P.isCube=!0,P._cachedWrapU=0,P._cachedWrapV=0,this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,P,!0),P.samplingMode=2,H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),y.isDDS){const g=y.info,f=y.data;this._unpackFlipY(g.isCompressed),G.d.UploadDDSLevels(this,P,f,g,!0,6,j)}else c.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,null);const B=new R.c(g);B._isCube=!0,B._texture=P,P.isReady=!0,Z.push(B)}i._lodTextureHigh=Z[2],i._lodTextureMid=Z[1],i._lodTextureLow=Z[0],k&&k(i)}),i,H,U,l,f,S)},k.ThinEngine.prototype.createUniformBuffer=function(y,g){const f=this._gl.createBuffer();if(!f)throw new Error("Unable to create uniform buffer");const p=new l.c(f);return this.bindUniformBuffer(p),y instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,y,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(y),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),p.references=1,p},k.ThinEngine.prototype.createDynamicUniformBuffer=function(y,g){const f=this._gl.createBuffer();if(!f)throw new Error("Unable to create dynamic uniform buffer");const p=new l.c(f);return this.bindUniformBuffer(p),y instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,y,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(y),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),p.references=1,p},k.ThinEngine.prototype.updateUniformBuffer=function(y,g,f,p){this.bindUniformBuffer(y),void 0===f&&(f=0),void 0===p?g instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,f,g):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,f,new Float32Array(g)):g instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,g.subarray(f,f+p)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(g).subarray(f,f+p)),this.bindUniformBuffer(null)},k.ThinEngine.prototype.bindUniformBuffer=function(y){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,y?y.underlyingResource:null)},k.ThinEngine.prototype.bindUniformBufferBase=function(y,g,f){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,g,y?y.underlyingResource:null)},k.ThinEngine.prototype.bindUniformBlock=function(y,g,f){const p=y.program,S=this._gl.getUniformBlockIndex(p,g);4294967295!==S&&this._gl.uniformBlockBinding(p,S,f)};var z=f(10730),T=f(10797);T.b.prototype.displayLoadingUI=function(){if(!(0,z.i)())return;const y=this.loadingScreen;y&&y.displayLoadingUI()},T.b.prototype.hideLoadingUI=function(){if(!(0,z.i)())return;const y=this._loadingScreen;y&&y.hideLoadingUI()},Object.defineProperty(T.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=T.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(y){this._loadingScreen=y},enumerable:!0,configurable:!0}),Object.defineProperty(T.b.prototype,"loadingUIText",{set:function(y){this.loadingScreen.loadingUIText=y},enumerable:!0,configurable:!0}),Object.defineProperty(T.b.prototype,"loadingUIBackgroundColor",{set:function(y){this.loadingScreen.loadingUIBackgroundColor=y},enumerable:!0,configurable:!0}),T.b.prototype.getInputElement=function(){return this._renderingCanvas},T.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},T.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},T.b.prototype.getAspectRatio=function(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const f=y.viewport;return this.getRenderWidth(g)*f.width/(this.getRenderHeight(g)*f.height)},T.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},T.b.prototype._verifyPointerLock=function(){var y;null===(y=this._onPointerLockChange)||void 0===y||y.call(this)},T.b.prototype.setAlphaEquation=function(y){if(this._alphaEquation!==y){switch(y){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=y}},T.b.prototype.getInputElement=function(){return this._renderingCanvas},T.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},T.b.prototype.setDepthFunction=function(y){this._depthCullingState.depthFunc=y},T.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},T.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},T.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},T.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},T.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},T.b.prototype.setDepthWrite=function(y){this._depthCullingState.depthMask=y},T.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},T.b.prototype.setStencilBuffer=function(y){this._stencilState.stencilTest=y},T.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},T.b.prototype.setStencilMask=function(y){this._stencilState.stencilMask=y},T.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},T.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},T.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},T.b.prototype.setStencilFunction=function(y){this._stencilState.stencilFunc=y},T.b.prototype.setStencilFunctionReference=function(y){this._stencilState.stencilFuncRef=y},T.b.prototype.setStencilFunctionMask=function(y){this._stencilState.stencilFuncMask=y},T.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},T.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},T.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},T.b.prototype.setStencilOperationFail=function(y){this._stencilState.stencilOpStencilFail=y},T.b.prototype.setStencilOperationDepthFail=function(y){this._stencilState.stencilOpDepthFail=y},T.b.prototype.setStencilOperationPass=function(y){this._stencilState.stencilOpStencilDepthPass=y},T.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},T.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},T.b.prototype.setAlphaConstants=function(y,g,f,p){this._alphaState.setAlphaBlendConstants(y,g,f,p)},T.b.prototype.getAlphaMode=function(){return this._alphaMode},T.b.prototype.getAlphaEquation=function(){return this._alphaEquation},T.b.prototype.getRenderPassNames=function(){return this._renderPassNames},T.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},T.b.prototype.createRenderPassId=function(y){const g=++T.b._RenderPassIdCounter;return this._renderPassNames[g]=y??"NONAME",g},T.b.prototype.releaseRenderPassId=function(y){this._renderPassNames[y]=void 0;for(let g=0;g<this.scenes.length;++g){const f=this.scenes[g];for(let g=0;g<f.meshes.length;++g){const p=f.meshes[g];if(p.og)for(let g=0;g<p.og.length;++g){p.og[g]._removeDrawWrapper(y)}}}};f(11551);function Q(y){if(y.requestPointerLock){const g=y.requestPointerLock();g instanceof Promise?g.then((()=>{y.focus()})).catch((()=>{})):y.focus()}}var m=f(10886);f(11612);class a extends k.ThinEngine{static get NpmPackage(){return T.b.NpmPackage}static get Version(){return T.b.Version}static get Instances(){return S.d.Instances}static get LastCreatedEngine(){return S.d.LastCreatedEngine}static get LastCreatedScene(){return S.d.LastCreatedScene}static DefaultLoadingScreenFactory(y){return T.b.DefaultLoadingScreenFactory(y)}get _supportsHardwareTextureRescaling(){return!!a._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(y,g,f){if(super(y,g,f,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new H,this._drawCalls=new m.d,y&&(this._features.supportRenderPasses=!0,f=this._creationOptions,y.getContext)){const g=y;this._sharedInit(g)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(y){super._sharedInit(y),function(y,g,f){y._onCanvasFocus=()=>{y.onCanvasFocusObservable.notifyObservers(y)},y._onCanvasBlur=()=>{y.onCanvasBlurObservable.notifyObservers(y)},y._onCanvasContextMenu=g=>{y.disableContextMenu&&g.preventDefault()},g.addEventListener("focus",y._onCanvasFocus),g.addEventListener("blur",y._onCanvasBlur),g.addEventListener("contextmenu",y._onCanvasContextMenu),y._onBlur=()=>{y.disablePerformanceMonitorInBackground&&y.performanceMonitor.disable(),y._windowIsBackground=!0},y._onFocus=()=>{y.disablePerformanceMonitorInBackground&&y.performanceMonitor.enable(),y._windowIsBackground=!1},y._onCanvasPointerOut=f=>{document.elementFromPoint(f.clientX,f.clientY)!==g&&y.onCanvasPointerOutObservable.notifyObservers(f)};const p=y.getHostWindow();p&&"function"===typeof p.addEventListener&&(p.addEventListener("blur",y._onBlur),p.addEventListener("focus",y._onFocus)),g.addEventListener("pointerout",y._onCanvasPointerOut),f.doNotHandleTouchAction||function(y){y&&y.setAttribute&&(y.setAttribute("touch-action","none"),y.style.touchAction="none",y.style.webkitTapHighlightColor="transparent")}(g),!T.b.audioEngine&&f.audioEngine&&T.b.AudioEngineFactory&&(T.b.audioEngine=T.b.AudioEngineFactory(y.getRenderingCanvas(),y.getAudioContext(),y.getAudioDestination())),(0,z.d)()&&(y._onFullscreenChange=()=>{y.isFullscreen=!!document.fullscreenElement,y.isFullscreen&&y._pointerLockRequested&&g&&Q(g)},document.addEventListener("fullscreenchange",y._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",y._onFullscreenChange,!1),y._onPointerLockChange=()=>{y.isPointerLock=document.pointerLockElement===g},document.addEventListener("pointerlockchange",y._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",y._onPointerLockChange,!1)),y.enableOfflineSupport=void 0!==T.b.OfflineProviderFactory,y._deterministicLockstep=!!f.deterministicLockstep,y._lockstepMaxSteps=f.lockstepMaxSteps||0,y._timeStep=f.timeStep||1/60}(this,y,this._creationOptions)}resizeImageBitmap(y,g,f){return function(y,g,f,p){const S=y.createCanvas(f,p).getContext("2d");if(!S)throw new Error("Unable to get 2d context for resizeImageBitmap");return S.drawImage(g,0,0),S.getImageData(0,0,f,p).data}(this,y,g,f)}_createImageBitmapFromSource(y,g){return function(y,g,f){return new Promise(((p,S)=>{const k=new Image;k.onload=()=>{k.decode().then((()=>{y.createImageBitmap(k,f).then((y=>{p(y)}))}))},k.onerror=()=>{S(`Error loading image ${k.src}`)},k.src=g}))}(this,y,g)}switchFullscreen(y){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(y)}enterFullscreen(y){this.isFullscreen||(this._pointerLockRequested=y,this._renderingCanvas&&function(y){const g=y.requestFullscreen||y.webkitRequestFullscreen;g&&g.call(y)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const y=document;document.exitFullscreen?document.exitFullscreen():y.webkitCancelFullScreen&&y.webkitCancelFullScreen()}()}setDitheringState(y){y?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(y){y?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(y,g,f,p){const S=this._cachedViewport;return this._cachedViewport=null,this._viewport(y,g,f,p),S}scissorClear(y,g,f,p,S){this.enableScissor(y,g,f,p),this.clear(S,!0,!0,!0),this.disableScissor()}enableScissor(y,g,f,p){const S=this._gl;S.enable(S.SCISSOR_TEST),S.scissor(y,g,f,p)}disableScissor(){const y=this._gl;y.disable(y.SCISSOR_TEST)}_loadFileAsync(y,g,f){return new Promise(((p,S)=>{this._loadFile(y,(y=>{p(y)}),void 0,g,f,((y,g)=>{S(g)}))}))}getVertexShaderSource(y){const g=this._gl.getAttachedShaders(y);return g?this._gl.getShaderSource(g[0]):null}getFragmentShaderSource(y){const g=this._gl.getAttachedShaders(y);return g?this._gl.getShaderSource(g[1]):null}set framebufferDimensionsObject(y){this._framebufferDimensionsObject=y,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const y of this.scenes)y.resetCachedMaterial(),y._rebuildGeometries();for(const y of this._virtualScenes)y.resetCachedMaterial(),y._rebuildGeometries();super._rebuildBuffers()}getFontOffset(y){return function(y){const g=document.createElement("span");g.textContent="Hg",g.style.font=y;const f=document.createElement("div");f.style.display="inline-block",f.style.width="1px",f.style.height="0px",f.style.verticalAlign="bottom";const p=document.createElement("div");p.style.whiteSpace="nowrap",p.appendChild(g),p.appendChild(f),document.body.appendChild(p);let S=0,k=0;try{k=f.getBoundingClientRect().top-g.getBoundingClientRect().top,f.style.verticalAlign="baseline",S=f.getBoundingClientRect().top-g.getBoundingClientRect().top}finally{document.body.removeChild(p)}return{ascent:S,height:k,descent:k-S}}(y)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:y}=this.customAnimationFrameRequester;y&&y(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let y=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(y=!1),y&&(this.ij(),this._renderViews()||this._renderFrame(),this.jj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&Q(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}ij(){this._measureFps(),super.ij()}_deletePipelineContext(y){const g=y;g&&g.program&&g.transformFeedback&&(this.deleteTransformFeedback(g.transformFeedback),g.transformFeedback=null),super._deletePipelineContext(y)}createShaderProgram(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;S=S||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const i=super.createShaderProgram(y,g,f,p,S,k);return this.onAfterShaderCompilationObservable.notifyObservers(this),i}_createShaderProgram(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const k=p.createProgram();if(y.program=k,!k)throw new Error("Unable to create program");if(p.attachShader(k,g),p.attachShader(k,f),this.webGLVersion>1&&S){const g=this.createTransformFeedback();this.bindTransformFeedback(g),this.setTranformFeedbackVaryings(k,S),y.transformFeedback=g}return p.linkProgram(k),this.webGLVersion>1&&S&&this.bindTransformFeedback(null),y.context=p,y.vertexShader=g,y.fragmentShader=f,y.isParallelCompiled||this._finalizePipelineContext(y),k}_releaseTexture(y){super._releaseTexture(y)}_releaseRenderTargetWrapper(y){super._releaseRenderTargetWrapper(y),this.scenes.forEach((g=>{g.postProcesses.forEach((g=>{g._outputTexture===y&&(g._outputTexture=null)})),g.cameras.forEach((g=>{g._postProcesses.forEach((g=>{g&&g._outputTexture===y&&(g._outputTexture=null)}))}))}))}_rescaleTexture(y,g,f,p,S){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const k=this.createRenderTargetTexture({width:g.width,height:g.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&a._RescalePostProcessFactory&&(this._rescalePostProcess=a._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const i=()=>{this._rescalePostProcess.onApply=function(g){g._bindTexture("textureSampler",y)};let i=f;i||(i=this.scenes[this.scenes.length-1]),i.postProcessManager.directRender([this._rescalePostProcess],k,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,g,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,p,0,0,g.width,g.height,0),this.unBindFramebuffer(k),k.dispose(),S&&S()},H=this._rescalePostProcess.getEffect();H?H.executeWhenCompiled(i):this._rescalePostProcess.onEffectCreatedObservable.addOnce((y=>{y.executeWhenCompiled(i)}))}}wrapWebGLTexture(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const i=new Z.d(y,this._gl),H=new p.d(this,0,!0);return H._hardwareTexture=i,H.baseWidth=S,H.baseHeight=k,H.width=S,H.height=k,H.isReady=!0,H.useMipMaps=g,this.updateTextureSamplingMode(f,H),H}_uploadImageToTexture(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const S=this._gl,k=this._getWebGLTextureType(y.type),i=this._getInternalFormat(y.format),H=this._getRGBABufferInternalSizedFormat(y.type,i),U=y.isCube?S.TEXTURE_CUBE_MAP:S.TEXTURE_2D;this._bindTextureDirectly(U,y,!0),this._unpackFlipY(y.invertY);let l=S.TEXTURE_2D;y.isCube&&(l=S.TEXTURE_CUBE_MAP_POSITIVE_X+f),S.texImage2D(l,p,H,i,k,g),this._bindTextureDirectly(U,null,!0)}updateTextureComparisonFunction(y,g){if(1===this.webGLVersion)return void c.d.Error("WebGL 1 does not support texture comparison.");const f=this._gl;y.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,y,!0),0===g?(f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_COMPARE_FUNC,515),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_COMPARE_MODE,f.NONE)):(f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_COMPARE_FUNC,g),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_COMPARE_MODE,f.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,y,!0),0===g?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_FUNC,515),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_MODE,f.NONE)):(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_FUNC,g),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_MODE,f.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),y._comparisonFunction=g}createInstancesBuffer(y){const g=this._gl.createBuffer();if(!g)throw new Error("Unable to create instance buffer");const f=new l.c(g);return f.sb=y,this.bindArrayBuffer(f),this._gl.bufferData(this._gl.ARRAY_BUFFER,y,this._gl.DYNAMIC_DRAW),f.references=1,f}deleteInstancesBuffer(y){this._gl.deleteBuffer(y)}_clientWaitAsync(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const p=this._gl;return new Promise(((S,k)=>{const i=()=>{const H=p.clientWaitSync(y,g,0);H!=p.WAIT_FAILED?H!=p.TIMEOUT_EXPIRED?S():setTimeout(i,f):k()};i()}))}_readPixelsAsync(y,g,f,p,S,k,i){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const H=this._gl,U=H.createBuffer();H.bindBuffer(H.PIXEL_PACK_BUFFER,U),H.bufferData(H.PIXEL_PACK_BUFFER,i.byteLength,H.STREAM_READ),H.readPixels(y,g,f,p,S,k,0),H.bindBuffer(H.PIXEL_PACK_BUFFER,null);const l=H.fenceSync(H.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(H.flush(),this._clientWaitAsync(l,0,10).then((()=>(H.deleteSync(l),H.bindBuffer(H.PIXEL_PACK_BUFFER,U),H.getBufferSubData(H.PIXEL_PACK_BUFFER,0,i),H.bindBuffer(H.PIXEL_PACK_BUFFER,null),H.deleteBuffer(U),i)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(y,g){1===S.d.Instances.length&&T.b.audioEngine&&(T.b.audioEngine.dispose(),T.b.audioEngine=null);const f=y.getHostWindow();f&&"function"===typeof f.removeEventListener&&(f.removeEventListener("blur",y._onBlur),f.removeEventListener("focus",y._onFocus)),g&&(g.removeEventListener("focus",y._onCanvasFocus),g.removeEventListener("blur",y._onCanvasBlur),g.removeEventListener("pointerout",y._onCanvasPointerOut),g.removeEventListener("contextmenu",y._onCanvasContextMenu)),(0,z.d)()&&(document.removeEventListener("fullscreenchange",y._onFullscreenChange),document.removeEventListener("mozfullscreenchange",y._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",y._onFullscreenChange),document.removeEventListener("msfullscreenchange",y._onFullscreenChange),document.removeEventListener("pointerlockchange",y._onPointerLockChange),document.removeEventListener("mspointerlockchange",y._onPointerLockChange),document.removeEventListener("mozpointerlockchange",y._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",y._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}a.ALPHA_DISABLE=0,a.ALPHA_ADD=1,a.ALPHA_COMBINE=2,a.ALPHA_SUBTRACT=3,a.ALPHA_MULTIPLY=4,a.ALPHA_MAXIMIZED=5,a.ALPHA_ONEONE=6,a.ALPHA_PREMULTIPLIED=7,a.ALPHA_PREMULTIPLIED_PORTERDUFF=8,a.ALPHA_INTERPOLATE=9,a.ALPHA_SCREENMODE=10,a.DELAYLOADSTATE_NONE=0,a.DELAYLOADSTATE_LOADED=1,a.DELAYLOADSTATE_LOADING=2,a.DELAYLOADSTATE_NOTLOADED=4,a.NEVER=512,a.ALWAYS=519,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.GEQUAL=518,a.NOTEQUAL=517,a.KEEP=7680,a.REPLACE=7681,a.INCR=7682,a.DECR=7683,a.INVERT=5386,a.INCR_WRAP=34055,a.DECR_WRAP=34056,a.TEXTURE_CLAMP_ADDRESSMODE=0,a.TEXTURE_WRAP_ADDRESSMODE=1,a.TEXTURE_MIRROR_ADDRESSMODE=2,a.TEXTUREFORMAT_ALPHA=0,a.TEXTUREFORMAT_LUMINANCE=1,a.TEXTUREFORMAT_LUMINANCE_ALPHA=2,a.TEXTUREFORMAT_RGB=4,a.TEXTUREFORMAT_RGBA=5,a.TEXTUREFORMAT_RED=6,a.TEXTUREFORMAT_R=6,a.TEXTUREFORMAT_RG=7,a.TEXTUREFORMAT_RED_INTEGER=8,a.TEXTUREFORMAT_R_INTEGER=8,a.TEXTUREFORMAT_RG_INTEGER=9,a.TEXTUREFORMAT_RGB_INTEGER=10,a.TEXTUREFORMAT_RGBA_INTEGER=11,a.TEXTURETYPE_UNSIGNED_BYTE=0,a.TEXTURETYPE_UNSIGNED_INT=0,a.TEXTURETYPE_FLOAT=1,a.TEXTURETYPE_HALF_FLOAT=2,a.TEXTURETYPE_BYTE=3,a.TEXTURETYPE_SHORT=4,a.TEXTURETYPE_UNSIGNED_SHORT=5,a.TEXTURETYPE_INT=6,a.TEXTURETYPE_UNSIGNED_INTEGER=7,a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,a.TEXTURETYPE_UNSIGNED_INT_24_8=12,a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,a.TEXTURE_NEAREST_SAMPLINGMODE=1,a.TEXTURE_BILINEAR_SAMPLINGMODE=2,a.TEXTURE_TRILINEAR_SAMPLINGMODE=3,a.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,a.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,a.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,a.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,a.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,a.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,a.TEXTURE_NEAREST_LINEAR=7,a.TEXTURE_NEAREST_NEAREST=1,a.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,a.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,a.TEXTURE_LINEAR_LINEAR=2,a.TEXTURE_LINEAR_NEAREST=12,a.TEXTURE_EXPLICIT_MODE=0,a.TEXTURE_SPHERICAL_MODE=1,a.TEXTURE_PLANAR_MODE=2,a.TEXTURE_CUBIC_MODE=3,a.TEXTURE_PROJECTION_MODE=4,a.TEXTURE_SKYBOX_MODE=5,a.TEXTURE_INVCUBIC_MODE=6,a.TEXTURE_EQUIRECTANGULAR_MODE=7,a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,a.SCALEMODE_FLOOR=1,a.SCALEMODE_NEAREST=2,a.SCALEMODE_CEILING=3},10761:(y,g,f)=>{"use strict";f.d(g,{d:()=>S});var p=f(10723);class S{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}S.Instances=[],S.OnEnginesDisposedObservable=new p.d,S._LastCreatedScene=null,S.UseFallbackTexture=!0,S.FallbackTexture=""},12819:(y,g,f)=>{"use strict";f(10736);var p=f(11534);f(10845),f(11133),f(10837),f(11545),f(11511);p.d},10837:(y,g,f)=>{"use strict";f.d(g,{e:()=>p});class p{static SetMatrixPrecision(y){if(p.MatrixTrackPrecisionChange=!1,y&&!p.MatrixUse64Bits&&p.MatrixTrackedMatrices)for(let g=0;g<p.MatrixTrackedMatrices.length;++g){const y=p.MatrixTrackedMatrices[g],f=y.Tj;y.Tj=new Array(16);for(let g=0;g<16;++g)y.Tj[g]=f[g]}p.MatrixUse64Bits=y,p.MatrixCurrentType=p.MatrixUse64Bits?Array:Float32Array,p.MatrixTrackedMatrices=null}}p.MatrixUse64Bits=!1,p.MatrixTrackPrecisionChange=!0,p.MatrixCurrentType=Float32Array,p.MatrixTrackedMatrices=[]},11545:(y,g,f)=>{"use strict";f.d(g,{e:()=>p});class p{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var y;return(null===(y=this._textures)||void 0===y?void 0:y[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(y){var g,f;if(!this._textures)return-1;const p=this._textures[y],S=(null===(g=this._layerIndices)||void 0===g?void 0:g[y])??0,k=(null===(f=this._faceIndices)||void 0===f?void 0:f[y])??0;return p.isCube?6*S+k:p.is3D?0:S}get samples(){return this._samples}setSamples(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===y&&!f)return y;const p=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,y,g):this._engine.updateRenderTargetTextureSampleCount(this,y);return this._samples=y,p}constructor(y,g,f,p,S){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=y,this._isCube=g,this._size=f,this._engine=p,this._depthStencilTexture=null,this.label=S}setTextures(y){Array.isArray(y)?this._textures=y:this._textures=y?[y]:null}setTexture(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[g]!==y&&(this._textures[g]&&f&&this._textures[g].dispose(),this._textures[g]=y)}setLayerAndFaceIndices(y,g){this._layerIndices=y,this._faceIndices=g}setLayerAndFaceIndex(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==g&&g>=0&&(this._layerIndices[y]=g),void 0!==f&&f>=0&&(this._faceIndices[y]=f)}createDepthStencilTexture(){var y;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,i=arguments.length>5?arguments[5]:void 0;return null===(y=this._depthStencilTexture)||void 0===y||y.dispose(),this._depthStencilTextureWithStencil=p,this._depthStencilTextureLabel=i,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:f,comparisonFunction:g,generateStencil:p,isCube:this._isCube,samples:S,depthTextureFormat:k,label:i},this),this._depthStencilTexture}_shareDepth(y){this.shareDepth(y)}shareDepth(y){this._depthStencilTexture&&(y._depthStencilTexture&&y._depthStencilTexture.dispose(),y._depthStencilTexture=this._depthStencilTexture,y._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(y){this.texture&&this.texture._swapAndDie(y),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let y=null;if(this._isMulti){const g=this.textures;if(g&&g.length>0){let f=!1,p=g.length,S=-1;const k=g[g.length-1]._source;14!==k&&12!==k||(f=!0,S=g[g.length-1].format,p--);const i=[],H=[],U=[],l=[],c=[],Z=[],C=[],q={};for(let y=0;y<p;++y){const f=g[y];i.push(f.samplingMode),H.push(f.type),U.push(f.format);void 0!==q[f.uniqueId]?(l.push(-1),C.push(0)):(q[f.uniqueId]=y,f.is2DArray?(l.push(35866),C.push(f.depth)):f.isCube?(l.push(34067),C.push(0)):f.is3D?(l.push(32879),C.push(f.depth)):(l.push(3553),C.push(0))),this._faceIndices&&c.push(this._faceIndices[y]??0),this._layerIndices&&Z.push(this._layerIndices[y]??0)}const W={samplingModes:i,generateMipMaps:g[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:f,depthTextureFormat:S,types:H,formats:U,textureCount:p,targetTypes:l,faceIndex:c,layerIndex:Z,layerCounts:C,label:this.label},j={width:this.width,height:this.height,depth:this.depth};y=this._engine.createMultipleRenderTarget(j,W);for(let P=0;P<p;++P){if(-1!==l[P])continue;const f=q[g[P].uniqueId];y.setTexture(y.textures[f],P)}}}else{var g,f,p,S;const i={};if(i.generateDepthBuffer=this._generateDepthBuffer,i.generateMipMaps=(null===(g=this.texture)||void 0===g?void 0:g.generateMipMaps)??!1,i.generateStencilBuffer=this._generateStencilBuffer,i.samplingMode=null===(f=this.texture)||void 0===f?void 0:f.samplingMode,i.type=null===(p=this.texture)||void 0===p?void 0:p.type,i.format=null===(S=this.texture)||void 0===S?void 0:S.format,i.noColorAttachment=!this._textures,i.label=this.label,this.isCube)y=this._engine.createRenderTargetCubeTexture(this.width,i);else{var k;const g={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(k=this.texture)||void 0===k?void 0:k.depth:void 0};y=this._engine.createRenderTargetTexture(g,i)}y.texture&&(y.texture.isReady=!0)}return y}_swapRenderTargetWrapper(y){if(this._textures&&y._textures)for(let g=0;g<this._textures.length;++g)this._textures[g]._swapAndDie(y._textures[g],!1),y._textures[g].isReady=!0;this._depthStencilTexture&&y._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(y._depthStencilTexture),y._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const y=this._cloneRenderTargetWrapper();if(y){if(this._depthStencilTexture){const g=this._depthStencilTexture.samplingMode,f=this._depthStencilTexture.format,p=2===g||3===g||11===g;y.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,p,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,f,this._depthStencilTextureLabel)}this.samples>1&&y.setSamples(this.samples),y._swapRenderTargetWrapper(this),y.dispose()}}releaseTextures(){if(this._textures)for(let g=0;g<(null===(y=this._textures)||void 0===y?void 0:y.length);++g){var y;this._textures[g].dispose()}this._textures=null}dispose(){var y;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(y=this._depthStencilTexture)||void 0===y||y.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10812:(y,g,f)=>{"use strict";f.d(g,{e:()=>p});class p{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?p.ShadersRepository:p.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?p.ShadersStore:p.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?p.IncludesShadersStore:p.IncludesShadersStoreWGSL}}p.ShadersRepository="src/Shaders/",p.ShadersStore={},p.IncludesShadersStore={},p.ShadersRepositoryWGSL="src/ShadersWGSL/",p.ShadersStoreWGSL={},p.IncludesShadersStoreWGSL={}},10828:(y,g,f)=>{"use strict";f.d(g,{d:()=>C,e:()=>R,f:()=>q,j:()=>W,n:()=>B,o:()=>Z,q:()=>l,s:()=>c,v:()=>U,w:()=>H});class p{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Ed._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(y){y&&this.program&&y(this.program)}setEngine(y){this.Ed=y}_fillEffectInformation(y,g,f,p,S,k,i,H){const U=this.Ed;if(U.supportsUniformBuffers)for(const c in g)y.bindUniformBlock(c,g[c]);let l;for(this.Ed.getUniforms(this,f).forEach(((y,g)=>{p[f[g]]=y})),this._uniforms=p,l=0;l<S.length;l++){null==y.getUniform(S[l])&&(S.splice(l,1),l--)}S.forEach(((y,g)=>{k[y]=g}));for(const c of U.getAttributes(this,i))H.push(c)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(y,g){const f=this._valueCache[y],p=g.updateFlag;return(void 0===f||f!==p)&&(this._valueCache[y]=p,!0)}_cacheFloat2(y,g,f){let p=this._valueCache[y];if(!p||2!==p.length)return p=[g,f],this._valueCache[y]=p,!0;let S=!1;return p[0]!==g&&(p[0]=g,S=!0),p[1]!==f&&(p[1]=f,S=!0),S}_cacheFloat3(y,g,f,p){let S=this._valueCache[y];if(!S||3!==S.length)return S=[g,f,p],this._valueCache[y]=S,!0;let k=!1;return S[0]!==g&&(S[0]=g,k=!0),S[1]!==f&&(S[1]=f,k=!0),S[2]!==p&&(S[2]=p,k=!0),k}_cacheFloat4(y,g,f,p,S){let k=this._valueCache[y];if(!k||4!==k.length)return k=[g,f,p,S],this._valueCache[y]=k,!0;let i=!1;return k[0]!==g&&(k[0]=g,i=!0),k[1]!==f&&(k[1]=f,i=!0),k[2]!==p&&(k[2]=p,i=!0),k[3]!==S&&(k[3]=S,i=!0),i}setInt(y,g){const f=this._valueCache[y];void 0!==f&&f===g||this.Ed.setInt(this._uniforms[y],g)&&(this._valueCache[y]=g)}setInt2(y,g,f){this._cacheFloat2(y,g,f)&&(this.Ed.setInt2(this._uniforms[y],g,f)||(this._valueCache[y]=null))}setInt3(y,g,f,p){this._cacheFloat3(y,g,f,p)&&(this.Ed.setInt3(this._uniforms[y],g,f,p)||(this._valueCache[y]=null))}setInt4(y,g,f,p,S){this._cacheFloat4(y,g,f,p,S)&&(this.Ed.setInt4(this._uniforms[y],g,f,p,S)||(this._valueCache[y]=null))}setIntArray(y,g){this._valueCache[y]=null,this.Ed.setIntArray(this._uniforms[y],g)}setIntArray2(y,g){this._valueCache[y]=null,this.Ed.setIntArray2(this._uniforms[y],g)}setIntArray3(y,g){this._valueCache[y]=null,this.Ed.setIntArray3(this._uniforms[y],g)}setIntArray4(y,g){this._valueCache[y]=null,this.Ed.setIntArray4(this._uniforms[y],g)}setUInt(y,g){const f=this._valueCache[y];void 0!==f&&f===g||this.Ed.setUInt(this._uniforms[y],g)&&(this._valueCache[y]=g)}setUInt2(y,g,f){this._cacheFloat2(y,g,f)&&(this.Ed.setUInt2(this._uniforms[y],g,f)||(this._valueCache[y]=null))}setUInt3(y,g,f,p){this._cacheFloat3(y,g,f,p)&&(this.Ed.setUInt3(this._uniforms[y],g,f,p)||(this._valueCache[y]=null))}setUInt4(y,g,f,p,S){this._cacheFloat4(y,g,f,p,S)&&(this.Ed.setUInt4(this._uniforms[y],g,f,p,S)||(this._valueCache[y]=null))}setUIntArray(y,g){this._valueCache[y]=null,this.Ed.setUIntArray(this._uniforms[y],g)}setUIntArray2(y,g){this._valueCache[y]=null,this.Ed.setUIntArray2(this._uniforms[y],g)}setUIntArray3(y,g){this._valueCache[y]=null,this.Ed.setUIntArray3(this._uniforms[y],g)}setUIntArray4(y,g){this._valueCache[y]=null,this.Ed.setUIntArray4(this._uniforms[y],g)}setArray(y,g){this._valueCache[y]=null,this.Ed.setArray(this._uniforms[y],g)}setArray2(y,g){this._valueCache[y]=null,this.Ed.setArray2(this._uniforms[y],g)}setArray3(y,g){this._valueCache[y]=null,this.Ed.setArray3(this._uniforms[y],g)}setArray4(y,g){this._valueCache[y]=null,this.Ed.setArray4(this._uniforms[y],g)}setMatrices(y,g){g&&(this._valueCache[y]=null,this.Ed.setMatrices(this._uniforms[y],g))}setMatrix(y,g){this._cacheMatrix(y,g)&&(this.Ed.setMatrices(this._uniforms[y],g.mj())||(this._valueCache[y]=null))}setMatrix3x3(y,g){this._valueCache[y]=null,this.Ed.setMatrix3x3(this._uniforms[y],g)}setMatrix2x2(y,g){this._valueCache[y]=null,this.Ed.setMatrix2x2(this._uniforms[y],g)}setFloat(y,g){const f=this._valueCache[y];void 0!==f&&f===g||this.Ed.setFloat(this._uniforms[y],g)&&(this._valueCache[y]=g)}setVector2(y,g){this._cacheFloat2(y,g.x,g.y)&&(this.Ed.setFloat2(this._uniforms[y],g.x,g.y)||(this._valueCache[y]=null))}setFloat2(y,g,f){this._cacheFloat2(y,g,f)&&(this.Ed.setFloat2(this._uniforms[y],g,f)||(this._valueCache[y]=null))}setVector3(y,g){this._cacheFloat3(y,g.x,g.y,g.z)&&(this.Ed.setFloat3(this._uniforms[y],g.x,g.y,g.z)||(this._valueCache[y]=null))}setFloat3(y,g,f,p){this._cacheFloat3(y,g,f,p)&&(this.Ed.setFloat3(this._uniforms[y],g,f,p)||(this._valueCache[y]=null))}setVector4(y,g){this._cacheFloat4(y,g.x,g.y,g.z,g.w)&&(this.Ed.setFloat4(this._uniforms[y],g.x,g.y,g.z,g.w)||(this._valueCache[y]=null))}setQuaternion(y,g){this._cacheFloat4(y,g.x,g.y,g.z,g.w)&&(this.Ed.setFloat4(this._uniforms[y],g.x,g.y,g.z,g.w)||(this._valueCache[y]=null))}setFloat4(y,g,f,p,S){this._cacheFloat4(y,g,f,p,S)&&(this.Ed.setFloat4(this._uniforms[y],g,f,p,S)||(this._valueCache[y]=null))}setColor3(y,g){this._cacheFloat3(y,g.r,g.g,g.b)&&(this.Ed.setFloat3(this._uniforms[y],g.r,g.g,g.b)||(this._valueCache[y]=null))}setColor4(y,g,f){this._cacheFloat4(y,g.r,g.g,g.b,f)&&(this.Ed.setFloat4(this._uniforms[y],g.r,g.g,g.b,f)||(this._valueCache[y]=null))}setDirectColor4(y,g){this._cacheFloat4(y,g.r,g.g,g.b,g.a)&&(this.Ed.setFloat4(this._uniforms[y],g.r,g.g,g.b,g.a)||(this._valueCache[y]=null))}_getVertexShaderCode(){return this.vertexShader?this.Ed._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Ed._getShaderSource(this.fragmentShader):null}}var S=f(10791);const k=new WeakMap,i={_webGLVersion:2,cachedPipelines:{}};function H(y){let g=k.get(y);if(!g){if(!y)return i;g={_webGLVersion:y.TEXTURE_BINDING_3D?2:1,_context:y,cachedPipelines:{}},k.set(y,g)}return g}function U(y){k.delete(y)}function l(y,g,f,p,S,k){const i=H(p);k||(k=i._createShaderProgramInjection??C);return k(y,P(g,"vertex",p,i._contextWasLost),P(f,"fragment",p,i._contextWasLost),p,S,i.validateShaderPrograms)}function c(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6?arguments[6]:void 0;const U=H(S);i||(i=U._createShaderProgramInjection??C);const l=U._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return i(y,j(g,"vertex",p,l,S,U._contextWasLost),j(f,"fragment",p,l,S,U._contextWasLost),S,k,U.validateShaderPrograms)}function Z(y,g){const f=new p,S=H(y);return S.parallelShaderCompile&&(f.isParallelCompiled=!0),f.context=S._context,f}function C(y,g,f,p){let S=arguments.length>5?arguments[5]:void 0;const k=p.createProgram();if(y.program=k,!k)throw new Error("Unable to create program");return p.attachShader(k,g),p.attachShader(k,f),p.linkProgram(k),y.context=p,y.vertexShader=g,y.fragmentShader=f,y.isParallelCompiled||q(y,p,S),k}function q(y,g,f){const p=y.context,S=y.vertexShader,k=y.fragmentShader,i=y.program;if(!p.getProgramParameter(i,p.LINK_STATUS)){if(!g.getShaderParameter(S,g.COMPILE_STATUS)){const f=g.getShaderInfoLog(S);if(f)throw y.vertexCompilationError=f,new Error("VERTEX SHADER "+f)}if(!g.getShaderParameter(k,g.COMPILE_STATUS)){const f=g.getShaderInfoLog(k);if(f)throw y.fragmentCompilationError=f,new Error("FRAGMENT SHADER "+f)}const f=p.getProgramInfoLog(i);if(f)throw y.programLinkError=f,new Error(f)}if(f){p.validateProgram(i);if(!p.getProgramParameter(i,p.VALIDATE_STATUS)){const g=p.getProgramInfoLog(i);if(g)throw y.programValidationError=g,new Error(g)}}p.deleteShader(S),p.deleteShader(k),y.vertexShader=void 0,y.fragmentShader=void 0,y.onCompiled&&(y.onCompiled(),y.onCompiled=void 0)}function W(y,g,f,p,S,k,i,U,Z){let C=arguments.length>10?arguments[10]:void 0,q=arguments.length>11?arguments[11]:void 0,W=arguments.length>12?arguments[12]:void 0;const j=H(y.context);q||(q=j.createRawShaderProgramInjection??l),W||(W=j.createShaderProgramInjection??c);const P=y;P.program=p?q(P,g,f,P.context,Z):W(P,g,f,U,P.context,Z),P.program.__SPECTOR_rebuildProgram=i,C()}function j(y,g,f,p,k,i){return P((0,S.g)(y,f,p),g,k,i)}function P(y,g,f,p){const S=f.createShader("vertex"===g?f.VERTEX_SHADER:f.FRAGMENT_SHADER);if(!S){let y=f.NO_ERROR,S=f.NO_ERROR;for(;(S=f.getError())!==f.NO_ERROR;)y=S;throw new Error(`Something went wrong while creating a gl ${g} shader object. gl error=${y}, gl isContextLost=${f.isContextLost()}, _contextWasLost=${p}`)}return f.shaderSource(S,y),f.compileShader(S),S}function B(y,g){g.useProgram(y)}function R(y,g){const f=y;if(!f.isParallelCompiled)return void g(y);const p=f.onCompiled;f.onCompiled=()=>{null===p||void 0===p||p(),g(y)}}},11502:(y,g,f)=>{"use strict";f.r(g),f.d(g,{ThinEngine:()=>G});var p=f(10828),S=f(11511),k=f(10736),i=f(10730);class H{constructor(){this.shaderLanguage=0}postProcessor(y,g,f,p,S){if(S.drawBuffersExtensionDisabled){const g=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;y=y.replace(g,"")}return y}}const U=/(flat\s)?\s*varying\s*.*/;class l{constructor(){this.shaderLanguage=0}attributeProcessor(y){return y.replace("attribute","in")}varyingCheck(y,g){return U.test(y)}varyingProcessor(y,g){return y.replace("varying",g?"in":"out")}postProcessor(y,g,f){const p=-1!==y.search(/#extension.+GL_EXT_draw_buffers.+require/);if(y=(y=y.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),f){const g=-1!==y.search(/layout *\(location *= *0\) *out/g);y=(y=(y=(y=(y=(y=(y=y.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(p||g?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==g.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+y}return y}}var c=f(11514),Z=f(10882),C=f(10797),q=f(11518),W=f(10845),j=f(10803),P=f(10791),B=f(10819);class R{}class G extends C.b{get name(){return this._name}set name(y){this._name=y}get version(){return this._webGLVersion}static get ShadersRepository(){return j.e.ShadersRepository}static set ShadersRepository(y){j.e.ShadersRepository=y}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(y){this._framebufferDimensionsObject=y}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(y,g,f,S){if(f=f||{},super(g??f.antialias,f,S),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!y)return;let i=null;if(y.getContext){if(i=y,this._renderingCanvas=i,void 0===f.Eh&&(f.Eh=!1),void 0===f.xrCompatible&&(f.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const y=navigator.userAgent;for(const g of G.ExceptionList){const p=g.key,S=g.targets;if(new RegExp(p).test(y)){if(g.capture&&g.captureConstraint){const f=g.capture,p=g.captureConstraint,S=new RegExp(f).exec(y);if(S&&S.length>0){if(parseInt(S[S.length-1])>=p)continue}}for(const y of S)switch(y){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":f.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=y=>{y.preventDefault(),this._contextWasLost=!0,k.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},i.addEventListener("webglcontextlost",this._onContextLost,!1),i.addEventListener("webglcontextrestored",this._onContextRestored,!1),f.powerPreference=f.powerPreference||"high-performance"),this._badDesktopOS&&(f.xrCompatible=!1),!f.disableWebGL2Support)try{this._gl=i.getContext("webgl2",f)||i.getContext("experimental-webgl2",f),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(Z){}if(!this._gl){if(!i)throw new Error("The provided canvas is null or undefined.");try{this._gl=i.getContext("webgl",f)||i.getContext("experimental-webgl",f)}catch(Z){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=y,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const g=this._gl.getContextAttributes();g&&(f.stencil=g.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==f.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=f.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let p=0;p<this._caps.maxVertexAttribs;p++)this._currentBufferPointers[p]=new R;this._shaderProcessor=this.webGLVersion>1?new l:new H;const U=`Babylon.js v${G.Version}`;k.d.Log(U+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",U);const c=(0,p.w)(this._gl);c.validateShaderPrograms=this.validateShaderPrograms,c.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(y){return null}areAllEffectsReady(){for(const y in this._compiledEffects){if(!this._compiledEffects[y].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const y=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=y&&(this._glRenderer=this._gl.getParameter(y.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(y.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const y=this._gl.getExtension("WEBGL_draw_buffers");if(null!==y){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=y.drawBuffersWEBGL.bind(y),this._caps.maxDrawBuffers=this._gl.getParameter(y.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let g=0;g<16;g++)this._gl["COLOR_ATTACHMENT"+g+"_WEBGL"]=y["COLOR_ATTACHMENT"+g+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const y=this._gl.getExtension("WEBGL_depth_texture");null!=y&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=y.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const y=this._gl.getExtension("OES_vertex_array_object");null!=y&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=y.createVertexArrayOES.bind(y),this._gl.bindVertexArray=y.bindVertexArrayOES.bind(y),this._gl.deleteVertexArray=y.deleteVertexArrayOES.bind(y))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const y=this._gl.getExtension("ANGLE_instanced_arrays");null!=y?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=y.drawArraysInstancedANGLE.bind(y),this._gl.drawElementsInstanced=y.drawElementsInstancedANGLE.bind(y),this._gl.vertexAttribDivisor=y.vertexAttribDivisorANGLE.bind(y)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const y=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),g=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);y&&g&&(this._caps.highPrecisionShaderSupported=0!==y.precision&&0!==g.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const y=this._gl.getExtension("EXT_blend_minmax");null!=y&&(this._caps.blendMinMax=!0,this._gl.MAX=y.MAX_EXT,this._gl.MIN=y.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const y=this._gl.getExtension("EXT_sRGB");null!=y&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:y.SRGB_EXT,SRGB8:y.SRGB_ALPHA_EXT,SRGB8_ALPHA8:y.SRGB_ALPHA_EXT})}if(this._creationOptions){const y=this._creationOptions.forceSRGBBufferSupportState;void 0!==y&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&y)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let g=0;g<this._maxSimultaneousTextures;g++)this._nextFreeTextureSlots.push(g);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const y=this._workingCanvas.getContext("2d");y&&(this._workingContext=y)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const y=this.getGlInfo();return y&&y.renderer?y.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=S;let k=0;if(g&&y){let g=!0;if(this._currentRenderTarget){var i;const f=null===(i=this._currentRenderTarget.texture)||void 0===i?void 0:i.format;if(8===f||9===f||10===f||11===f){var H;const f=null===(H=this._currentRenderTarget.texture)||void 0===H?void 0:H.type;7===f||5===f?(G._TempClearColorUint32[0]=255*y.r,G._TempClearColorUint32[1]=255*y.g,G._TempClearColorUint32[2]=255*y.b,G._TempClearColorUint32[3]=255*y.a,this._gl.clearBufferuiv(this._gl.COLOR,0,G._TempClearColorUint32),g=!1):(G._TempClearColorInt32[0]=255*y.r,G._TempClearColorInt32[1]=255*y.g,G._TempClearColorInt32[2]=255*y.b,G._TempClearColorInt32[3]=255*y.a,this._gl.clearBufferiv(this._gl.COLOR,0,G._TempClearColorInt32),g=!1)}}g&&(this._gl.clearColor(y.r,y.g,y.b,void 0!==y.a?y.a:1),k|=this._gl.COLOR_BUFFER_BIT)}f&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),k|=this._gl.DEPTH_BUFFER_BIT),p&&(this._gl.clearStencil(0),k|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(k)}_viewport(y,g,f,p){y===this._viewportCached.x&&g===this._viewportCached.y&&f===this._viewportCached.z&&p===this._viewportCached.w||(this._viewportCached.x=y,this._viewportCached.y=g,this._viewportCached.z=f,this._viewportCached.w=p,this._gl.viewport(y,g,f,p))}jj(){super.jj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const U=y;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=y,this._bindUnboundFramebuffer(U._framebuffer);const l=this._gl;var c;if(!y.isMulti)if(y.is2DArray||y.is3D)l.framebufferTextureLayer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,null===(c=y.texture._hardwareTexture)||void 0===c?void 0:c.underlyingResource,i,H),U._currentLOD=i;else if(y.isCube){var Z;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+g,null===(Z=y.texture._hardwareTexture)||void 0===Z?void 0:Z.underlyingResource,i)}else if(U._currentLOD!==i){var C;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,null===(C=y.texture._hardwareTexture)||void 0===C?void 0:C.underlyingResource,i),U._currentLOD=i}const q=y._depthStencilTexture;if(q){y.is3D&&(y.texture.width===q.width&&y.texture.height===q.height&&y.texture.depth===q.depth||k.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const f=y._depthStencilTextureWithStencil?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT;var W;if(y.is2DArray||y.is3D)l.framebufferTextureLayer(l.FRAMEBUFFER,f,null===(W=q._hardwareTexture)||void 0===W?void 0:W.underlyingResource,i,H);else if(y.isCube){var j;l.framebufferTexture2D(l.FRAMEBUFFER,f,l.TEXTURE_CUBE_MAP_POSITIVE_X+g,null===(j=q._hardwareTexture)||void 0===j?void 0:j.underlyingResource,i)}else{var P;l.framebufferTexture2D(l.FRAMEBUFFER,f,l.TEXTURE_2D,null===(P=q._hardwareTexture)||void 0===P?void 0:P.underlyingResource,i)}}U._MSAAFramebuffer&&this._bindUnboundFramebuffer(U._MSAAFramebuffer),this._cachedViewport&&!S?this.setViewport(this._cachedViewport,f,p):(f||(f=y.width,i&&(f/=Math.pow(2,i))),p||(p=y.height,i&&(p/=Math.pow(2,i))),this._viewport(0,0,f,p)),this.wipeCaches()}setState(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==y||f)&&(this._depthCullingState.cull=y);const H=this.cullBackFaces??S??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==H||f)&&(this._depthCullingState.cullFace=H),this.setZOffset(g),this.setZOffsetUnits(i);const U=p?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==U||f)&&(this._depthCullingState.frontFace=U),this._stencilStateComposer.stencilMaterial=k}_bindUnboundFramebuffer(y){this._currentFramebuffer!==y&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,y),this._currentFramebuffer=y)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(y){const g=this._getTextureTarget(y);this._bindTextureDirectly(g,y,!0),this._gl.generateMipmap(g),this._bindTextureDirectly(g,null)}unBindFramebuffer(y){var g;let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;const S=y;this._currentRenderTarget=null;const k=this._gl;if(S._MSAAFramebuffer){if(y.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(y,f,p);k.bindFramebuffer(k.READ_FRAMEBUFFER,S._MSAAFramebuffer),k.bindFramebuffer(k.DRAW_FRAMEBUFFER,S._framebuffer),k.blitFramebuffer(0,0,y.width,y.height,0,0,y.width,y.height,k.COLOR_BUFFER_BIT,k.NEAREST)}null===(g=y.texture)||void 0===g||!g.generateMipMaps||f||y.isCube||this.generateMipmaps(y.texture),p&&(S._MSAAFramebuffer&&this._bindUnboundFramebuffer(S._framebuffer),p()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(y,g,f){return this._createVertexBuffer(y,this._gl.STATIC_DRAW)}_createVertexBuffer(y,g){const f=this._gl.createBuffer();if(!f)throw new Error("Unable to create vertex buffer");const p=new c.c(f);return this.bindArrayBuffer(p),"number"!==typeof y?y instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(y),g),p.sb=4*y.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,y,g),p.sb=y.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(y),g),p.sb=y),this._resetVertexBufferBinding(),p.references=1,p}createDynamicVertexBuffer(y,g){return this._createVertexBuffer(y,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(y,g,f){const p=this._gl.createBuffer(),S=new c.c(p);if(!p)throw new Error("Unable to create index buffer");this.bindIndexBuffer(S);const k=this._normalizeIndexData(y);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,k,g?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),S.references=1,S.is32Bits=4===k.BYTES_PER_ELEMENT,S}_normalizeIndexData(y){if(2===y.BYTES_PER_ELEMENT)return y;if(this._caps.uintIndices){if(y instanceof Uint32Array)return y;for(let g=0;g<y.length;g++)if(y[g]>=65535)return new Uint32Array(y);return new Uint16Array(y)}return new Uint16Array(y)}bindArrayBuffer(y){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(y,this._gl.ARRAY_BUFFER)}bindUniformBlock(y,g,f){const p=y.program,S=this._gl.getUniformBlockIndex(p,g);this._gl.uniformBlockBinding(p,S,f)}bindIndexBuffer(y){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(y,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(y,g){(this._vaoRecordInProgress||this._currentBoundBuffer[g]!==y)&&(this._gl.bindBuffer(g,y?y.underlyingResource:null),this._currentBoundBuffer[g]=y)}updateArrayBuffer(y){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,y)}_vertexAttribPointer(y,g,f,p,S,k,i){const H=this._currentBufferPointers[g];if(!H)return;let U=!1;H.active?(H.buffer!==y&&(H.buffer=y,U=!0),H.size!==f&&(H.size=f,U=!0),H.type!==p&&(H.type=p,U=!0),H.normalized!==S&&(H.normalized=S,U=!0),H.stride!==k&&(H.stride=k,U=!0),H.offset!==i&&(H.offset=i,U=!0)):(U=!0,H.active=!0,H.index=g,H.size=f,H.type=p,H.normalized=S,H.stride=k,H.offset=i,H.buffer=y),(U||this._vaoRecordInProgress)&&(this.bindArrayBuffer(y),p===this._gl.UNSIGNED_INT||p===this._gl.INT?this._gl.vertexAttribIPointer(g,f,p,k,i):this._gl.vertexAttribPointer(g,f,p,S,k,i))}_bindIndexBufferWithCache(y){null!=y&&this._cachedIndexBuffer!==y&&(this._cachedIndexBuffer=y,this.bindIndexBuffer(y),this._uintIndicesCurrentlySet=y.is32Bits)}_bindVertexBuffersAttributes(y,g,f){const p=g.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let S=0;S<p.length;S++){const k=g.getAttributeLocation(S);if(k>=0){const g=p[S];let i=null;if(f&&(i=f[g]),i||(i=y[g]),!i)continue;this._gl.enableVertexAttribArray(k),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[k]=!0);const H=i.getBuffer();H&&(this._vertexAttribPointer(H,k,i.getSize(),i.type,i.normalized,i.byteStride,i.byteOffset),i.getIsInstanced()&&(this._gl.vertexAttribDivisor(k,i.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(k),this._currentInstanceBuffers.push(H))))}}}recordVertexArrayObject(y,g,f,p){const S=this._gl.createVertexArray();if(!S)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(S),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(y,f,p),this.bindIndexBuffer(g),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),S}bindVertexArrayObject(y,g){this._cachedVertexArrayObject!==y&&(this._cachedVertexArrayObject=y,this._gl.bindVertexArray(y),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=g&&g.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(y,g,f,p,S){if(this._cachedVertexBuffers!==y||this._cachedEffectForVertexBuffers!==S){this._cachedVertexBuffers=y,this._cachedEffectForVertexBuffers=S;const g=S.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let k=0;for(let i=0;i<g;i++)if(i<f.length){const g=S.getAttributeLocation(i);g>=0&&(this._gl.enableVertexAttribArray(g),this._vertexAttribArraysEnabled[g]=!0,this._vertexAttribPointer(y,g,f[i],this._gl.FLOAT,!1,p,k)),k+=4*f[i]}}this._bindIndexBufferWithCache(g)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(y,g,f,p){this._cachedVertexBuffers===y&&this._cachedEffectForVertexBuffers===f||(this._cachedVertexBuffers=y,this._cachedEffectForVertexBuffers=f,this._bindVertexBuffersAttributes(y,f,p)),this._bindIndexBufferWithCache(g)}unbindInstanceAttributes(){let y;for(let g=0,f=this._currentInstanceLocations.length;g<f;g++){const f=this._currentInstanceBuffers[g];y!=f&&f.references&&(y=f,this.bindArrayBuffer(f));const p=this._currentInstanceLocations[g];this._gl.vertexAttribDivisor(p,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(y){this._gl.deleteVertexArray(y)}_releaseBuffer(y){return y.references--,0===y.references&&(this._deleteBuffer(y),!0)}_deleteBuffer(y){this._gl.deleteBuffer(y.underlyingResource)}updateAndBindInstancesBuffer(y,g,f){if(this.bindArrayBuffer(y),g&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,g),void 0!==f[0].index)this.bindInstancesBuffer(y,f,!0);else for(let p=0;p<4;p++){const g=f[p];this._vertexAttribArraysEnabled[g]||(this._gl.enableVertexAttribArray(g),this._vertexAttribArraysEnabled[g]=!0),this._vertexAttribPointer(y,g,4,this._gl.FLOAT,!1,64,16*p),this._gl.vertexAttribDivisor(g,1),this._currentInstanceLocations.push(g),this._currentInstanceBuffers.push(y)}}bindInstancesBuffer(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(y);let p=0;if(f)for(let S=0;S<g.length;S++){p+=4*g[S].attributeSize}for(let S=0;S<g.length;S++){const f=g[S];void 0===f.index&&(f.index=this._currentEffect.getAttributeLocationByName(f.attributeName)),f.index<0||(this._vertexAttribArraysEnabled[f.index]||(this._gl.enableVertexAttribArray(f.index),this._vertexAttribArraysEnabled[f.index]=!0),this._vertexAttribPointer(y,f.index,f.attributeSize,f.attributeType||this._gl.FLOAT,f.normalized||!1,p,f.offset),this._gl.vertexAttribDivisor(f.index,void 0===f.divisor?1:f.divisor),this._currentInstanceLocations.push(f.index),this._currentInstanceBuffers.push(y))}}disableInstanceAttributeByName(y){if(!this._currentEffect)return;const g=this._currentEffect.getAttributeLocationByName(y);this.disableInstanceAttribute(g)}disableInstanceAttribute(y){let g,f=!1;for(;-1!==(g=this._currentInstanceLocations.indexOf(y));)this._currentInstanceLocations.splice(g,1),this._currentInstanceBuffers.splice(g,1),f=!0,g=this._currentInstanceLocations.indexOf(y);f&&(this._gl.vertexAttribDivisor(y,0),this.disableAttributeByIndex(y))}disableAttributeByIndex(y){this._gl.disableVertexAttribArray(y),this._vertexAttribArraysEnabled[y]=!1,this._currentBufferPointers[y].active=!1}draw(y,g,f,p){this.drawElementsType(y?0:1,g,f,p)}drawPointClouds(y,g,f){this.drawArraysType(2,y,g,f)}drawUnIndexed(y,g,f,p){this.drawArraysType(y?0:1,g,f,p)}drawElementsType(y,g,f,p){this.applyStates(),this._reportDrawCall();const S=this._drawMode(y),k=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,i=this._uintIndicesCurrentlySet?4:2;p?this._gl.drawElementsInstanced(S,f,k,g*i,p):this._gl.drawElements(S,f,k,g*i)}drawArraysType(y,g,f,p){this.applyStates(),this._reportDrawCall();const S=this._drawMode(y);p?this._gl.drawArraysInstanced(S,g,f,p):this._gl.drawArrays(S,g,f)}_drawMode(y){switch(y){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(y){this._compiledEffects[y._key]&&delete this._compiledEffects[y._key];const g=y.getPipelineContext();g&&this._deletePipelineContext(g)}_deletePipelineContext(y){const g=y;g&&g.program&&(g.program.__SPECTOR_rebuildProgram=null,(0,B.j)(g),this._gl.deleteProgram(g.program))}_getGlobalDefines(y){return(0,P.i)(y,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(y,g,f,S,k,i,H,U,l){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10?arguments[10]:void 0;const C="string"===typeof y?y:y.vertexToken||y.vertexSource||y.vertexElement||y.vertex,q="string"===typeof y?y:y.fragmentToken||y.fragmentSource||y.fragmentElement||y.fragment,W=this._getGlobalDefines();let P=k??g.defines??"";W&&(P+=W);const B=C+"+"+q+"@"+P;if(this._compiledEffects[B]){const y=this._compiledEffects[B];return H&&y.isReady()&&H(y),y._refCount++,y}this._gl&&(0,p.w)(this._gl);const R=new j.e(y,g,f,S,this,k,i,H,U,l,B,g.shaderLanguage??c,g.extraInitializationsAsync??Z);return this._compiledEffects[B]=R,R}_getShaderSource(y){return this._gl.getShaderSource(y)}createRawShaderProgram(y,g,f,S){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const i=(0,p.w)(this._gl);return i._contextWasLost=this._contextWasLost,i.validateShaderPrograms=this.validateShaderPrograms,(0,p.q)(y,g,f,S||this._gl,k)}createShaderProgram(y,g,f,S,k){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const H=(0,p.w)(this._gl);return H._contextWasLost=this._contextWasLost,H.validateShaderPrograms=this.validateShaderPrograms,(0,p.s)(y,g,f,S,k||this._gl,i)}inlineShaderCode(y){return y}createPipelineContext(y){if(this._gl){(0,p.w)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const g=(0,p.o)(this._gl,y);return g.Ed=this,g}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(y){return(0,p.f)(y,this._gl,this.validateShaderPrograms)}_preparePipelineContext(y,g,f,S,k,i,H,U,l,c,Z){const C=(0,p.w)(this._gl);return C._contextWasLost=this._contextWasLost,C.validateShaderPrograms=this.validateShaderPrograms,C._createShaderProgramInjection=this._createShaderProgram.bind(this),C.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),C.createShaderProgramInjection=this.createShaderProgram.bind(this),C.loadFileInjection=this._loadFile.bind(this),(0,p.j)(y,g,f,S,k,i,H,U,l,c,Z)}_createShaderProgram(y,g,f,S){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,p.d)(y,g,f,S,k)}_isRenderingStateCompiled(y){const g=y;return!this._isDisposed&&!g._isDisposed&&(!!this._gl.getProgramParameter(g.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(g),!0))}_executeWhenRenderingStateIsCompiled(y,g){(0,p.e)(y,g)}getUniforms(y,g){const f=new Array,p=y;for(let S=0;S<g.length;S++)f.push(this._gl.getUniformLocation(p.program,g[S]));return f}getAttributes(y,g){const f=[],p=y;for(let k=0;k<g.length;k++)try{f.push(this._gl.getAttribLocation(p.program,g[k]))}catch(S){f.push(-1)}return f}enableEffect(y){(y=null!==y&&(0,S.e)(y)?y.effect:y)&&y!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(y),this._currentEffect=y,y.onBind&&y.onBind(y),y._onBindObservable&&y._onBindObservable.notifyObservers(y))}setInt(y,g){return!!y&&(this._gl.uniform1i(y,g),!0)}setInt2(y,g,f){return!!y&&(this._gl.uniform2i(y,g,f),!0)}setInt3(y,g,f,p){return!!y&&(this._gl.uniform3i(y,g,f,p),!0)}setInt4(y,g,f,p,S){return!!y&&(this._gl.uniform4i(y,g,f,p,S),!0)}setIntArray(y,g){return!!y&&(this._gl.uniform1iv(y,g),!0)}setIntArray2(y,g){return!(!y||g.length%2!==0)&&(this._gl.uniform2iv(y,g),!0)}setIntArray3(y,g){return!(!y||g.length%3!==0)&&(this._gl.uniform3iv(y,g),!0)}setIntArray4(y,g){return!(!y||g.length%4!==0)&&(this._gl.uniform4iv(y,g),!0)}setUInt(y,g){return!!y&&(this._gl.uniform1ui(y,g),!0)}setUInt2(y,g,f){return!!y&&(this._gl.uniform2ui(y,g,f),!0)}setUInt3(y,g,f,p){return!!y&&(this._gl.uniform3ui(y,g,f,p),!0)}setUInt4(y,g,f,p,S){return!!y&&(this._gl.uniform4ui(y,g,f,p,S),!0)}setUIntArray(y,g){return!!y&&(this._gl.uniform1uiv(y,g),!0)}setUIntArray2(y,g){return!(!y||g.length%2!==0)&&(this._gl.uniform2uiv(y,g),!0)}setUIntArray3(y,g){return!(!y||g.length%3!==0)&&(this._gl.uniform3uiv(y,g),!0)}setUIntArray4(y,g){return!(!y||g.length%4!==0)&&(this._gl.uniform4uiv(y,g),!0)}setArray(y,g){return!!y&&(!(g.length<1)&&(this._gl.uniform1fv(y,g),!0))}setArray2(y,g){return!(!y||g.length%2!==0)&&(this._gl.uniform2fv(y,g),!0)}setArray3(y,g){return!(!y||g.length%3!==0)&&(this._gl.uniform3fv(y,g),!0)}setArray4(y,g){return!(!y||g.length%4!==0)&&(this._gl.uniform4fv(y,g),!0)}setMatrices(y,g){return!!y&&(this._gl.uniformMatrix4fv(y,!1,g),!0)}setMatrix3x3(y,g){return!!y&&(this._gl.uniformMatrix3fv(y,!1,g),!0)}setMatrix2x2(y,g){return!!y&&(this._gl.uniformMatrix2fv(y,!1,g),!0)}setFloat(y,g){return!!y&&(this._gl.uniform1f(y,g),!0)}setFloat2(y,g,f){return!!y&&(this._gl.uniform2f(y,g,f),!0)}setFloat3(y,g,f,p){return!!y&&(this._gl.uniform3f(y,g,f,p),!0)}setFloat4(y,g,f,p,S){return!!y&&(this._gl.uniform4f(y,g,f,p,S),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const y=this._colorWrite;this._gl.colorMask(y,y,y,y)}}wipeCaches(y){this.preventCacheWipeBetweenFrames&&!y||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),y&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(y,g){const f=this._gl;let p=f.NEAREST,S=f.NEAREST;switch(y){case 11:p=f.LINEAR,S=g?f.LINEAR_MIPMAP_NEAREST:f.LINEAR;break;case 3:p=f.LINEAR,S=g?f.LINEAR_MIPMAP_LINEAR:f.LINEAR;break;case 8:p=f.NEAREST,S=g?f.NEAREST_MIPMAP_LINEAR:f.NEAREST;break;case 4:p=f.NEAREST,S=g?f.NEAREST_MIPMAP_NEAREST:f.NEAREST;break;case 5:p=f.NEAREST,S=g?f.LINEAR_MIPMAP_NEAREST:f.LINEAR;break;case 6:p=f.NEAREST,S=g?f.LINEAR_MIPMAP_LINEAR:f.LINEAR;break;case 7:p=f.NEAREST,S=f.LINEAR;break;case 1:p=f.NEAREST,S=f.NEAREST;break;case 9:p=f.LINEAR,S=g?f.NEAREST_MIPMAP_NEAREST:f.NEAREST;break;case 10:p=f.LINEAR,S=g?f.NEAREST_MIPMAP_LINEAR:f.NEAREST;break;case 2:p=f.LINEAR,S=f.LINEAR;break;case 12:p=f.LINEAR,S=f.NEAREST}return{min:S,mag:p}}_createTexture(){const y=this._gl.createTexture();if(!y)throw new Error("Unable to create texture");return y}_createHardwareTexture(){return new q.d(this._createTexture(),this._gl)}_createInternalTexture(y,g){let f,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=!1,i=0,H=3,U=5,l=!1,c=1;void 0!==g&&"object"===typeof g?(S=!!g.generateMipMaps,i=void 0===g.type?0:g.type,H=void 0===g.samplingMode?3:g.samplingMode,U=void 0===g.format?5:g.format,l=void 0!==g.useSRGBBuffer&&g.useSRGBBuffer,c=g.samples??1,f=g.label):S=!!g,l&&(l=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==i||this._caps.textureFloatLinearFiltering)&&(2!==i||this._caps.textureHalfFloatLinearFiltering)||(H=1),1!==i||this._caps.textureFloat||(i=0,k.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const Z=this._gl,C=new W.d(this,p),q=y.width||y,j=y.height||y,P=y.depth||0,B=y.layers||0,R=this._getSamplingParameters(H,S),G=0!==B?Z.TEXTURE_2D_ARRAY:0!==P?Z.TEXTURE_3D:Z.TEXTURE_2D,z=this._getRGBABufferInternalSizedFormat(i,U,l),T=this._getInternalFormat(U),Q=this._getWebGLTextureType(i);return this._bindTextureDirectly(G,C),0!==B?(C.is2DArray=!0,Z.texImage3D(G,0,z,q,j,B,0,T,Q,null)):0!==P?(C.is3D=!0,Z.texImage3D(G,0,z,q,j,P,0,T,Q,null)):Z.texImage2D(G,0,z,q,j,0,T,Q,null),Z.texParameteri(G,Z.TEXTURE_MAG_FILTER,R.mag),Z.texParameteri(G,Z.TEXTURE_MIN_FILTER,R.min),Z.texParameteri(G,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(G,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),S&&this._gl.generateMipmap(G),this._bindTextureDirectly(G,null),C._useSRGBBuffer=l,C.baseWidth=q,C.baseHeight=j,C.width=q,C.height=j,C.depth=B,C.isReady=!0,C.samples=c,C.generateMipMaps=S,C.samplingMode=H,C.type=i,C.format=U,C.label=f,this._internalTexturesCache.push(C),C}_getUseSRGBBuffer(y,g){return y&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||g)}createTexture(y,g,f,p){var S=this;let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,C=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0,j=arguments.length>13?arguments[13]:void 0,P=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(y,g,f,p,k,i,H,(function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];return S._prepareWebGLTexture(...g,c)}),((y,g,f,S,k,i)=>{const H=this._gl,U=f.width===y&&f.height===g;k._creationFlags=j??0;const l=this._getTexImageParametersForCreateTexture(k.format,k._useSRGBBuffer);if(U)return H.texImage2D(H.TEXTURE_2D,0,l.internalFormat,l.format,l.type,f),!1;const c=this._caps.maxTextureSize;if(f.width>c||f.height>c||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=y,this._workingCanvas.height=g,this._workingContext.drawImage(f,0,0,f.width,f.height,0,0,y,g),H.texImage2D(H.TEXTURE_2D,0,l.internalFormat,l.format,l.type,this._workingCanvas),k.width=y,k.height=g,!1);{const y=new W.d(this,2);this._bindTextureDirectly(H.TEXTURE_2D,y,!0),H.texImage2D(H.TEXTURE_2D,0,l.internalFormat,l.format,l.type,f),this._rescaleTexture(y,k,p,l.format,(()=>{this._releaseTexture(y),this._bindTextureDirectly(H.TEXTURE_2D,k,!0),i()}))}return!0}),U,l,c,Z,C,q,P)}_getTexImageParametersForCreateTexture(y,g){let f,p;return 1===this.webGLVersion?(f=this._getInternalFormat(y,g),p=f):(f=this._getInternalFormat(y,!1),p=this._getRGBABufferInternalSizedFormat(0,y,g)),{internalFormat:p,format:f,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(y,g,f,p,S){}_unpackFlipY(y){this._unpackFlipYCached!==y&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,y?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=y))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(y){return y.isCube?this._gl.TEXTURE_CUBE_MAP:y.is3D?this._gl.TEXTURE_3D:y.is2DArray||y.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=this._getTextureTarget(g),S=this._getSamplingParameters(y,g.useMipMaps||f);this._setTextureParameterInteger(p,this._gl.TEXTURE_MAG_FILTER,S.mag,g),this._setTextureParameterInteger(p,this._gl.TEXTURE_MIN_FILTER,S.min),f&&(g.generateMipMaps=!0,this._gl.generateMipmap(p)),this._bindTextureDirectly(p,null),g.samplingMode=y}updateTextureDimensions(y,g,f){}updateTextureWrappingMode(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=this._getTextureTarget(y);null!==g&&(this._setTextureParameterInteger(S,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(g),y),y._cachedWrapU=g),null!==f&&(this._setTextureParameterInteger(S,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(f),y),y._cachedWrapV=f),(y.is2DArray||y.is3D)&&null!==p&&(this._setTextureParameterInteger(S,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(p),y),y._cachedWrapR=p),this._bindTextureDirectly(S,null)}_uploadCompressedDataToTextureDirectly(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const H=this._gl;let U=H.TEXTURE_2D;if(y.isCube&&(U=H.TEXTURE_CUBE_MAP_POSITIVE_X+k),y._useSRGBBuffer)switch(g){case 37492:case 36196:this._caps.etc2?g=H.COMPRESSED_SRGB8_ETC2:y._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?g=H.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:y._useSRGBBuffer=!1;break;case 36492:g=H.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:g=H.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?g=H.COMPRESSED_SRGB_S3TC_DXT1_EXT:y._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?g=H.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:y._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?g=H.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:y._useSRGBBuffer=!1;break;default:y._useSRGBBuffer=!1}this._gl.compressedTexImage2D(U,i,g,f,p,0,S)}_uploadDataToTextureDirectly(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=this._gl,H=this._getWebGLTextureType(y.type),U=this._getInternalFormat(y.format),l=void 0===S?this._getRGBABufferInternalSizedFormat(y.type,y.format,y._useSRGBBuffer):this._getInternalFormat(S,y._useSRGBBuffer);this._unpackFlipY(y.invertY);let c=i.TEXTURE_2D;y.isCube&&(c=i.TEXTURE_CUBE_MAP_POSITIVE_X+f);const Z=Math.round(Math.log(y.width)*Math.LOG2E),C=Math.round(Math.log(y.height)*Math.LOG2E),q=k?y.width:Math.pow(2,Math.max(Z-p,0)),W=k?y.height:Math.pow(2,Math.max(C-p,0));i.texImage2D(c,p,l,q,W,0,U,H,g)}updateTextureData(y,g,f,p,S,k){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const l=this._gl,c=this._getWebGLTextureType(y.type),Z=this._getInternalFormat(y.format);this._unpackFlipY(y.invertY);let C=l.TEXTURE_2D,q=l.TEXTURE_2D;y.isCube&&(q=l.TEXTURE_CUBE_MAP_POSITIVE_X+i,C=l.TEXTURE_CUBE_MAP),this._bindTextureDirectly(C,y,!0),l.texSubImage2D(q,H,f,p,S,k,Z,c,g),U&&this._gl.generateMipmap(q),this._bindTextureDirectly(C,null)}_uploadArrayBufferViewToTexture(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const S=this._gl,k=y.isCube?S.TEXTURE_CUBE_MAP:S.TEXTURE_2D;this._bindTextureDirectly(k,y,!0),this._uploadDataToTextureDirectly(y,g,f,p),this._bindTextureDirectly(k,null,!0)}_prepareWebGLTextureContinuation(y,g,f,p,S){const k=this._gl;if(!k)return;const i=this._getSamplingParameters(S,!f);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,i.mag),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,i.min),f||p||k.generateMipmap(k.TEXTURE_2D),this._bindTextureDirectly(k.TEXTURE_2D,null),g&&g.removePendingData(y),y.onLoadedObservable.notifyObservers(y),y.onLoadedObservable.clear()}_prepareWebGLTexture(y,g,f,p,S,k,i,H,U,l){const c=this.getCaps().maxTextureSize,C=Math.min(c,this.needPOTTextures?(0,Z.i)(p.width,c):p.width),q=Math.min(c,this.needPOTTextures?(0,Z.i)(p.height,c):p.height),W=this._gl;W&&(y._hardwareTexture?(this._bindTextureDirectly(W.TEXTURE_2D,y,!0),this._unpackFlipY(void 0===S||!!S),y.baseWidth=p.width,y.baseHeight=p.height,y.width=C,y.height=q,y.isReady=!0,y.type=-1!==y.type?y.type:0,y.format=-1!==y.format?y.format:l??(".jpg"!==g||y._useSRGBBuffer?5:4),H(C,q,p,g,y,(()=>{this._prepareWebGLTextureContinuation(y,f,k,i,U)}))||this._prepareWebGLTextureContinuation(y,f,k,i,U)):f&&f.removePendingData(y))}_getInternalFormatFromDepthTextureFormat(y,g,f){const p=this._gl;if(!g)return p.STENCIL_INDEX8;let S=f?p.DEPTH_STENCIL:p.DEPTH_COMPONENT;return this.webGLVersion>1?15===y?S=p.DEPTH_COMPONENT16:16===y?S=p.DEPTH_COMPONENT24:17===y||13===y?S=f?p.DEPTH24_STENCIL8:p.DEPTH_COMPONENT24:14===y?S=p.DEPTH_COMPONENT32F:18===y&&(S=f?p.DEPTH32F_STENCIL8:p.DEPTH_COMPONENT32F):S=p.DEPTH_COMPONENT16,S}_setupFramebufferDepthAttachments(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,k=arguments.length>5?arguments[5]:void 0;const i=this._gl;k=k??(y?13:14);const H=this._getInternalFormatFromDepthTextureFormat(k,g,y);return y&&g?this._createRenderBuffer(f,p,S,i.DEPTH_STENCIL,H,i.DEPTH_STENCIL_ATTACHMENT):g?this._createRenderBuffer(f,p,S,H,H,i.DEPTH_ATTACHMENT):y?this._createRenderBuffer(f,p,S,H,H,i.STENCIL_ATTACHMENT):null}_createRenderBuffer(y,g,f,p,S,k){let i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const H=this._gl.createRenderbuffer();return this._updateRenderBuffer(H,y,g,f,p,S,k,i)}_updateRenderBuffer(y,g,f,p,S,k,i){let H=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this._gl;return U.bindRenderbuffer(U.RENDERBUFFER,y),p>1&&U.renderbufferStorageMultisample?U.renderbufferStorageMultisample(U.RENDERBUFFER,p,k,g,f):U.renderbufferStorage(U.RENDERBUFFER,S,g,f),U.framebufferRenderbuffer(U.FRAMEBUFFER,i,U.RENDERBUFFER,y),H&&U.bindRenderbuffer(U.RENDERBUFFER,null),y}_releaseTexture(y){this._deleteTexture(y._hardwareTexture),this.unbindAllTextures();const g=this._internalTexturesCache.indexOf(y);-1!==g&&this._internalTexturesCache.splice(g,1),y._lodTextureHigh&&y._lodTextureHigh.dispose(),y._lodTextureMid&&y._lodTextureMid.dispose(),y._lodTextureLow&&y._lodTextureLow.dispose(),y._irradianceTexture&&y._irradianceTexture.dispose()}_deleteTexture(y){null===y||void 0===y||y.release()}_setProgram(y){this._currentProgram!==y&&((0,p.n)(y,this._gl),this._currentProgram=y)}bindSamplers(y){const g=y.getPipelineContext();this._setProgram(g.program);const f=y.getSamplers();for(let p=0;p<f.length;p++){const g=y.getUniform(f[p]);g&&(this._boundUniforms[p]=g)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=!1;const i=g&&g._associatedChannel>-1;f&&i&&(this._activeChannel=g._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==g||p){if(this._activateCurrentTexture(),g&&g.isMultiview)throw k.d.Error(["_bindTextureDirectly called with a multiview texture!",y,g]),"_bindTextureDirectly called with a multiview texture!";var H;this._gl.bindTexture(y,(null===g||void 0===g||null===(H=g._hardwareTexture)||void 0===H?void 0:H.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=g,g&&(g._associatedChannel=this._activeChannel)}else f&&(S=!0,this._activateCurrentTexture());return i&&!f&&this._bindSamplerUniformToChannel(g._associatedChannel,this._activeChannel),S}_bindTexture(y,g,f){if(void 0===y)return;g&&(g._associatedChannel=y),this._activeChannel=y;const p=g?this._getTextureTarget(g):this._gl.TEXTURE_2D;this._bindTextureDirectly(p,g)}unbindAllTextures(){for(let y=0;y<this._maxSimultaneousTextures;y++)this._activeChannel=y,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(y,g,f,p){void 0!==y&&(g&&(this._boundUniforms[y]=g),this._setTexture(y,f))}_bindSamplerUniformToChannel(y,g){const f=this._boundUniforms[y];f&&f._currentState!==g&&(this._gl.uniform1i(f,g),f._currentState=g)}_getTextureWrapMode(y){switch(y){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(y,g){let f,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!g)return null!=this._boundTexturesCache[y]&&(this._activeChannel=y,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(g.video){this._activeChannel=y;const f=g.getInternalTexture();f&&(f._associatedChannel=y),g.update()}else if(4===g.delayLoadState)return g.delayLoad(),!1;f=S?g.depthStencilTexture:g.isReady()?g.getInternalTexture():g.isCube?this.emptyCubeTexture:g.is3D?this.emptyTexture3D:g.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!p&&f&&(f._associatedChannel=y);let k=!0;this._boundTexturesCache[y]===f&&(p||this._bindSamplerUniformToChannel(f._associatedChannel,y),k=!1),this._activeChannel=y;const i=this._getTextureTarget(f);if(k&&this._bindTextureDirectly(i,f,p),f&&!f.isMultiview){if(f.isCube&&f._cachedCoordinatesMode!==g.coordinatesMode){f._cachedCoordinatesMode=g.coordinatesMode;const y=3!==g.coordinatesMode&&5!==g.coordinatesMode?1:0;g.wrapU=y,g.wrapV=y}f._cachedWrapU!==g.wrapU&&(f._cachedWrapU=g.wrapU,this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(g.wrapU),f)),f._cachedWrapV!==g.wrapV&&(f._cachedWrapV=g.wrapV,this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(g.wrapV),f)),f.is3D&&f._cachedWrapR!==g.wrapR&&(f._cachedWrapR=g.wrapR,this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(g.wrapR),f)),this._setAnisotropicLevel(i,f,g.anisotropicFilteringLevel)}return!0}setTextureArray(y,g,f,p){if(void 0!==y&&g){this._textureUnits&&this._textureUnits.length===f.length||(this._textureUnits=new Int32Array(f.length));for(let g=0;g<f.length;g++){const p=f[g].getInternalTexture();p?(this._textureUnits[g]=y+g,p._associatedChannel=y+g):this._textureUnits[g]=-1}this._gl.uniform1iv(g,this._textureUnits);for(let y=0;y<f.length;y++)this._setTexture(this._textureUnits[y],f[y],!0)}}_setAnisotropicLevel(y,g,f){const p=this._caps.textureAnisotropicFilterExtension;11!==g.samplingMode&&3!==g.samplingMode&&2!==g.samplingMode&&(f=1),p&&g._cachedAnisotropicFilteringLevel!==f&&(this._setTextureParameterFloat(y,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(f,this._caps.maxAnisotropy),g),g._cachedAnisotropicFilteringLevel=f)}_setTextureParameterFloat(y,g,f,p){this._bindTextureDirectly(y,p,!0,!0),this._gl.texParameterf(y,g,f)}_setTextureParameterInteger(y,g,f,p){p&&this._bindTextureDirectly(y,p,!0,!0),this._gl.texParameteri(y,g,f)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let y=0;y<this._caps.maxVertexAttribs;y++)this.disableAttributeByIndex(y)}else for(let y=0,g=this._vertexAttribArraysEnabled.length;y<g;y++)y>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[y]||this.disableAttributeByIndex(y)}releaseEffects(){const y=Object.keys(this._compiledEffects);for(const g of y){this._compiledEffects[g].dispose()}this._compiledEffects={}}dispose(){var y;((0,i.i)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(y=this._gl.getExtension("WEBGL_lose_context"))||void 0===y||y.loseContext());(0,p.v)(this._gl)}attachContextLostEvent(y){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",y,!1)}attachContextRestoredEvent(y){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",y,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(y){const g=this._gl;for(;g.getError()!==g.NO_ERROR;);let f=!0;const p=g.createTexture();g.bindTexture(g.TEXTURE_2D,p),g.texImage2D(g.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(y),1,1,0,g.RGBA,this._getWebGLTextureType(y),null),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);const S=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,S),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0);const k=g.checkFramebufferStatus(g.FRAMEBUFFER);if(f=f&&k===g.FRAMEBUFFER_COMPLETE,f=f&&g.getError()===g.NO_ERROR,f&&(g.clear(g.COLOR_BUFFER_BIT),f=f&&g.getError()===g.NO_ERROR),f){g.bindFramebuffer(g.FRAMEBUFFER,null);const y=g.RGBA,p=g.UNSIGNED_BYTE,S=new Uint8Array(4);g.readPixels(0,0,1,1,y,p,S),f=f&&g.getError()===g.NO_ERROR}for(g.deleteTexture(p),g.deleteFramebuffer(S),g.bindFramebuffer(g.FRAMEBUFFER,null);!f&&g.getError()!==g.NO_ERROR;);return f}_getWebGLTextureType(y){if(1===this._webGLVersion){switch(y){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(y){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=g?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(y){case 0:f=this._gl.ALPHA;break;case 1:f=this._gl.LUMINANCE;break;case 2:f=this._gl.LUMINANCE_ALPHA;break;case 6:f=this._gl.RED;break;case 7:f=this._gl.RG;break;case 4:f=g?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:f=g?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(y){case 8:f=this._gl.RED_INTEGER;break;case 9:f=this._gl.RG_INTEGER;break;case 10:f=this._gl.RGB_INTEGER;break;case 11:f=this._gl.RGBA_INTEGER}return f}_getRGBABufferInternalSizedFormat(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==g)switch(g){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return f?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(y){case 3:switch(g){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(g){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return f?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return f?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(g){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(g){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(g){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(g){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(g){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(g){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(g){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return f?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(y,g,f,p){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const i=S?4:3,H=S?this._gl.RGBA:this._gl.RGB,U=new Uint8Array(p*f*i);return k&&this.flushFramebuffer(),this._gl.readPixels(y,g,f,p,H,this._gl.UNSIGNED_BYTE,U),Promise.resolve(U)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const y=C.b._CreateCanvas(1,1),g=y.getContext("webgl")||y.getContext("experimental-webgl");this._IsSupported=null!=g&&!!window.WebGLRenderingContext}catch(y){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const y=C.b._CreateCanvas(1,1),g=y.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||y.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!g}catch(y){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}G._TempClearColorUint32=new Uint32Array(4),G._TempClearColorInt32=new Int32Array(4),G.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],G._ConcatenateShader=P.g,G._IsSupported=null,G._HasMajorPerformanceCaveat=null},11165:(y,g,f)=>{"use strict";var p;f.d(g,{e:()=>S}),function(y){y[y.PointerMove=0]="PointerMove",y[y.PointerDown=1]="PointerDown",y[y.PointerUp=2]="PointerUp"}(p||(p={}));class S{}S.DOM_DELTA_PIXEL=0,S.DOM_DELTA_LINE=1,S.DOM_DELTA_PAGE=2},11161:(y,g,f)=>{"use strict";f.d(g,{d:()=>p,f:()=>k,i:()=>S});class p{}p.KEYDOWN=1,p.KEYUP=2;class S{constructor(y,g){this.type=y,this.event=g}}class k extends S{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(y){this.skipOnKeyboardObservable=y}constructor(y,g){super(y,g),this.type=y,this.event=g,this.skipOnKeyboardObservable=!1}}},11156:(y,g,f)=>{"use strict";f.d(g,{d:()=>S,e:()=>i,i:()=>H});var p=f(11054);class S{}S.POINTERDOWN=1,S.POINTERUP=2,S.POINTERMOVE=4,S.POINTERWHEEL=8,S.POINTERPICK=16,S.POINTERTAP=32,S.POINTERDOUBLETAP=64;class k{constructor(y,g){this.type=y,this.event=g}}class i extends k{constructor(y,g,f,S){super(y,g),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new p.l(f,S)}}class H extends k{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(y,g),this._pickInfo=f,this._inputManager=p}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10711:(y,g,f)=>{"use strict";f.r(g),f.d(g,{SceneInstrumentation:()=>k});var p=f(10714),S=f(10886);class k{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(y){y!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=y,y?(this._onBeforeActiveMeshesEvaluationObserver=this.Oc.onBeforeActiveMeshesEvaluationObservable.add((()=>{p.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Oc.onAfterActiveMeshesEvaluationObservable.add((()=>{p.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Oc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Oc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(y){y!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=y,y?(this._onBeforeRenderTargetsRenderObserver=this.Oc.onBeforeRenderTargetsRenderObservable.add((()=>{p.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Oc.onAfterRenderTargetsRenderObservable.add((()=>{p.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Oc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Oc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(y){y!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=y,y?(this._onBeforeParticlesRenderingObserver=this.Oc.onBeforeParticlesRenderingObservable.add((()=>{p.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Oc.onAfterParticlesRenderingObservable.add((()=>{p.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Oc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Oc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(y){y!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=y,this.Oc.spriteManagers&&(y?(this._onBeforeSpritesRenderingObserver=this.Oc.onBeforeSpritesRenderingObservable.add((()=>{p.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Oc.onAfterSpritesRenderingObservable.add((()=>{p.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Oc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Oc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(y){y!==this._capturePhysicsTime&&this.Oc.onBeforePhysicsObservable&&(this._capturePhysicsTime=y,y?(this._onBeforePhysicsObserver=this.Oc.onBeforePhysicsObservable.add((()=>{p.e.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Oc.onAfterPhysicsObservable.add((()=>{p.e.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.Oc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Oc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(y){y!==this._captureAnimationsTime&&(this._captureAnimationsTime=y,y?this._onAfterAnimationsObserver=this.Oc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Oc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(y){this._captureFrameTime=y}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(y){this._captureInterFrameTime=y}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(y){y!==this._captureRenderTime&&(this._captureRenderTime=y,y?(this._onBeforeDrawPhaseObserver=this.Oc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),p.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Oc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),p.e.EndPerformanceCounter("Main render")}))):(this.Oc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Oc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(y){y!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=y,y?(this._onBeforeCameraRenderObserver=this.Oc.onBeforeCameraRenderObservable.add((y=>{this._cameraRenderTime.beginMonitoring(),p.e.StartPerformanceCounter(`Rendering camera ${y.name}`)})),this._onAfterCameraRenderObserver=this.Oc.onAfterCameraRenderObservable.add((y=>{this._cameraRenderTime.endMonitoring(!1),p.e.EndPerformanceCounter(`Rendering camera ${y.name}`)}))):(this.Oc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Oc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Oc.getEngine()._drawCalls}constructor(y){this.Oc=y,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new S.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new S.d,this._captureFrameTime=!1,this._frameTime=new S.d,this._captureRenderTime=!1,this._renderTime=new S.d,this._captureInterFrameTime=!1,this._interFrameTime=new S.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new S.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new S.d,this._capturePhysicsTime=!1,this._physicsTime=new S.d,this._captureAnimationsTime=!1,this._animationsTime=new S.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new S.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=y.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(p.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Oc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=y.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(p.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.jj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.jj(),this._captureParticlesRenderTime&&this._particlesRenderTime.jj(),this._captureSpritesRenderTime&&this._spritesRenderTime.jj(),this._captureRenderTime&&this._renderTime.jj(),this._captureCameraRenderTime&&this._cameraRenderTime.jj()}))}dispose(){this.Oc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Oc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Oc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Oc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Oc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Oc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Oc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Oc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Oc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Oc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Oc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Oc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Oc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Oc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Oc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Oc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Oc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Oc=null}}},12333:(y,g,f)=>{"use strict";f.d(g,{b:()=>c});var p=f(11021),S=f(11026),k=f(11054),i=f(11336),H=f(12285),U=f(12341),l=f(10871);i.d.AddNodeConstructor("Light_Type_1",((y,g)=>()=>new c(y,k.m.Zero(),g)));class c extends U.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(y){this._shadowFrustumSize=y,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(y){this._shadowOrthoScale=y,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(y){this._orthoLeft=y}get orthoRight(){return this._orthoRight}set orthoRight(y){this._orthoRight=y}get orthoTop(){return this._orthoTop}set orthoTop(y){this._orthoTop=y}get orthoBottom(){return this._orthoBottom}set orthoBottom(y){this._orthoBottom=y}constructor(y,g,f){super(y,f),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=g.scale(-1),this.direction=g}getClassName(){return"kb"}getTypeID(){return H.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(y,g,f){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(y):this._setDefaultAutoExtendShadowProjectionMatrix(y,g,f)}_setDefaultFixedFrustumShadowProjectionMatrix(y){const g=this.va().activeCamera;g&&k.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:g.$i,void 0!==this.shadowMaxZ?this.shadowMaxZ:g.maxZ,y,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(y,g,f){const p=this.va().activeCamera;if(!p)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const y=k.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let p=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let i=0;i<f.length;i++){const H=f[i];if(!H)continue;const U=H.getBoundingInfo().boundingBox;for(let f=0;f<U.vectorsWorld.length;f++)k.m.TransformCoordinatesToRef(U.vectorsWorld[f],g,y),y.x<this._orthoLeft&&(this._orthoLeft=y.x),y.y<this._orthoBottom&&(this._orthoBottom=y.y),y.x>this._orthoRight&&(this._orthoRight=y.x),y.y>this._orthoTop&&(this._orthoTop=y.y),this.autoCalcShadowZBounds&&(y.z<p&&(p=y.z),y.z>S&&(S=y.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=p,this._shadowMaxZ=S)}const S=this._orthoRight-this._orthoLeft,i=this._orthoTop-this._orthoBottom,H=void 0!==this.shadowMinZ?this.shadowMinZ:p.$i,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,l=this.va().getEngine().useReverseDepthBuffer;k.c.OrthoOffCenterLHToRef(this._orthoLeft-S*this.shadowOrthoScale,this._orthoRight+S*this.shadowOrthoScale,this._orthoBottom-i*this.shadowOrthoScale,this._orthoTop+i*this.shadowOrthoScale,l?U:H,l?H:U,y,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(y,g){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,g),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,g),this)}transferToNodeMaterialEffect(y,g){return this.computeTransformedInformation()?(y.setFloat3(g,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(y.setFloat3(g,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(y){const g=this._scene.getEngine();return!g.useReverseDepthBuffer&&g.isNDCHalfZRange?0:1}getDepthMaxZ(y){const g=this._scene.getEngine();return g.useReverseDepthBuffer&&g.isNDCHalfZRange?0:1}prepareLightSpecificDefines(y,g){y["DIRLIGHT"+g]=!0}}(0,p.c)([(0,S.I)()],c.prototype,"shadowFrustumSize",null),(0,p.c)([(0,S.I)()],c.prototype,"shadowOrthoScale",null),(0,p.c)([(0,S.I)()],c.prototype,"autoUpdateExtends",void 0),(0,p.c)([(0,S.I)()],c.prototype,"autoCalcShadowZBounds",void 0),(0,p.c)([(0,S.I)("orthoLeft")],c.prototype,"_orthoLeft",void 0),(0,p.c)([(0,S.I)("orthoRight")],c.prototype,"_orthoRight",void 0),(0,p.c)([(0,S.I)("orthoTop")],c.prototype,"_orthoTop",void 0),(0,p.c)([(0,S.I)("orthoBottom")],c.prototype,"_orthoBottom",void 0),(0,l.c)("BABYLON.DirectionalLight",c)},12751:(y,g,f)=>{"use strict";f.d(g,{b:()=>c});var p=f(11021),S=f(11026),k=f(11054),i=f(11090),H=f(11336),U=f(12285),l=f(10871);H.d.AddNodeConstructor("Light_Type_3",((y,g)=>()=>new c(y,k.m.Zero(),g)));class c extends U.d{constructor(y,g,f){super(y,f),this.groundColor=new i.c(0,0,0),this.direction=g||k.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(y){return this.direction=k.m.Normalize(y.ed(k.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(y,g){const f=k.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",f.x,f.y,f.z,0,g),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.cj),g),this}transferToNodeMaterialEffect(y,g){const f=k.m.Normalize(this.direction);return y.setFloat3(g,f.x,f.y,f.z),this}Sj(){return this._worldMatrix||(this._worldMatrix=k.c.Identity()),this._worldMatrix}getTypeID(){return U.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(y,g){y["HEMILIGHT"+g]=!0}}(0,p.c)([(0,S.l)()],c.prototype,"groundColor",void 0),(0,p.c)([(0,S.H)()],c.prototype,"direction",void 0),(0,l.c)("BABYLON.HemisphericLight",c)},12285:(y,g,f)=>{"use strict";f.d(g,{d:()=>C});var p=f(11021),S=f(11026),k=f(11054),i=f(11090),H=f(11336),U=f(11117),l=f(10871),c=f(11194),Z=f(11099);class C extends H.d{get range(){return this._range}set range(y){this._range=y,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(y){this._intensityMode=y,this._computePhotometricScale()}get radius(){return this._radius}set radius(y){this._radius=y,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(y){this._shadowEnabled!==y&&(this._shadowEnabled=y,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(y){this._includedOnlyMeshes=y,this._hookArrayForIncludedOnly(y)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(y){this._excludedMeshes=y,this._hookArrayForExcluded(y)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(y){this._excludeWithLayerMask=y,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(y){this._includeOnlyWithLayerMask=y,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(y){this._lightmapMode!==y&&(this._lightmapMode=y,this._markMeshesAsLightDirty())}getViewMatrix(y){return null}getProjectionMatrix(y,g){return null}constructor(y,g){super(y,g,!1),this.Gh=new i.c(1,1,1),this.Hh=new i.c(1,1,1),this.falloffType=C.FALLOFF_DEFAULT,this.cj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=C.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new U.c(this.va().getEngine(),void 0,void 0,y),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(y,g){return this}_bindLight(y,g,f,p){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const k=y.toString();let H=!1;if(this._uniformBuffer.bindToEffect(f,"Light"+k),this._renderId!==g.getRenderId()||this._lastUseSpecular!==p||!this._uniformBuffer.useUbo){this._renderId=g.getRenderId(),this._lastUseSpecular=p;const y=this.getScaledIntensity();this.transferToEffect(f,k),this.Gh.scaleToRef(y,i.j.hb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",i.j.hb[0],this.range,k),p&&(this.Hh.scaleToRef(y,i.j.hb[1]),this._uniformBuffer.updateColor4("vLightSpecular",i.j.hb[1],this.radius,k)),H=!0}if(this.transferTexturesToEffect(f,k),g.shadowsEnabled&&this.shadowEnabled&&S){const y=this.getShadowGenerator(g.activeCamera)??this.getShadowGenerator();y&&(y.bindShadowLight(k,f),H=!0)}H?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(y){let g="Name: "+this.name;if(g+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let f=0;f<this.animations.length;f++)g+=", animation[0]: "+this.animations[f].toString(y);return g}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Mb(y){super.Mb(y),this._resyncMeshes()}getShadowGenerator(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(y)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return k.m.Zero()}canAffectMesh(y){return!y||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(y))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(y))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&y.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&y.layerMask)))}dispose(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const y=this._shadowGenerators.values();for(let g=y.next();!0!==g.done;g=y.next()){g.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const y=this._parentContainer.lights.indexOf(this);y>-1&&this._parentContainer.lights.splice(y,1),this._parentContainer=null}for(const f of this.va().meshes)f._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(y,g)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.cj}clone(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=C.GetConstructorFromName(this.getTypeID(),y,this.va());if(!f)return null;const p=Z.c.Clone(f,this);return y&&(p.name=y),g&&(p.parent=g),p.Mb(this.isEnabled()),this.onClonedObservable.notifyObservers(p),p}serialize(){const y=Z.c.Serialize(this);return y.uniqueId=this.uniqueId,y.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(y),this.excludedMeshes.length>0&&(y.excludedMeshesIds=[],this.excludedMeshes.forEach((g=>{y.excludedMeshesIds.push(g.id)}))),this.includedOnlyMeshes.length>0&&(y.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((g=>{y.includedOnlyMeshesIds.push(g.id)}))),Z.c.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y.isEnabled=this.isEnabled(),y}static GetConstructorFromName(y,g,f){const p=H.d.Construct("Light_Type_"+y,g,f);return p||null}static Parse(y,g){const f=C.GetConstructorFromName(y.type,y.name,g);if(!f)return null;const p=Z.c.Parse(f,y,g);if(y.excludedMeshesIds&&(p._excludedMeshesIds=y.excludedMeshesIds),y.includedOnlyMeshesIds&&(p._includedOnlyMeshesIds=y.includedOnlyMeshesIds),void 0!==y.parentId&&(p._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(p._waitingParentInstanceIndex=y.parentInstanceIndex),void 0!==y.falloffType&&(p.falloffType=y.falloffType),void 0!==y.lightmapMode&&(p.lightmapMode=y.lightmapMode),y.animations){for(let g=0;g<y.animations.length;g++){const f=y.animations[g],S=(0,l.b)("BABYLON.Animation");S&&p.animations.push(S.Parse(f))}H.d.ParseAnimationRanges(p,y,g)}return y.autoAnimate&&g.beginAnimation(p,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),void 0!==y.isEnabled&&p.Mb(y.isEnabled),p}_hookArrayForExcluded(y){var g=this;const f=y.push;y.push=function(){for(var p=arguments.length,S=new Array(p),k=0;k<p;k++)S[k]=arguments[k];const i=f.apply(y,S);for(const y of S)y._resyncLightSource(g);return i};const p=y.splice;y.splice=(g,f)=>{const S=p.apply(y,[g,f]);for(const y of S)y._resyncLightSource(this);return S};for(const S of y)S._resyncLightSource(this)}_hookArrayForIncludedOnly(y){var g=this;const f=y.push;y.push=function(){for(var p=arguments.length,S=new Array(p),k=0;k<p;k++)S[k]=arguments[k];const i=f.apply(y,S);return g._resyncMeshes(),i};const p=y.splice;y.splice=(g,f)=>{const S=p.apply(y,[g,f]);return this._resyncMeshes(),S},this._resyncMeshes()}_resyncMeshes(){for(const y of this.va().meshes)y._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const y of this.va().meshes)-1!==y.lightSources.indexOf(this)&&y._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let y=0;const g=this.getTypeID();let f=this.intensityMode;switch(f===C.INTENSITYMODE_AUTOMATIC&&(f=g===C.LIGHTTYPEID_DIRECTIONALLIGHT?C.INTENSITYMODE_ILLUMINANCE:C.INTENSITYMODE_LUMINOUSINTENSITY),g){case C.LIGHTTYPEID_POINTLIGHT:case C.LIGHTTYPEID_SPOTLIGHT:switch(f){case C.INTENSITYMODE_LUMINOUSPOWER:y=1/(4*Math.PI);break;case C.INTENSITYMODE_LUMINOUSINTENSITY:y=1;break;case C.INTENSITYMODE_LUMINANCE:y=this.radius*this.radius}break;case C.LIGHTTYPEID_DIRECTIONALLIGHT:switch(f){case C.INTENSITYMODE_ILLUMINANCE:y=1;break;case C.INTENSITYMODE_LUMINANCE:{let g=this.radius;g=Math.max(g,.001);y=2*Math.PI*(1-Math.cos(g));break}}break;case C.LIGHTTYPEID_HEMISPHERICLIGHT:y=1}return y}_reorderLightsInScene(){const y=this.va();0!=this._renderPriority&&(y.requireLightSorting=!0),this.va().sortLightsByPriority()}}C.FALLOFF_DEFAULT=c.b.FALLOFF_DEFAULT,C.FALLOFF_PHYSICAL=c.b.FALLOFF_PHYSICAL,C.FALLOFF_GLTF=c.b.FALLOFF_GLTF,C.FALLOFF_STANDARD=c.b.FALLOFF_STANDARD,C.LIGHTMAP_DEFAULT=c.b.LIGHTMAP_DEFAULT,C.LIGHTMAP_SPECULAR=c.b.LIGHTMAP_SPECULAR,C.LIGHTMAP_SHADOWSONLY=c.b.LIGHTMAP_SHADOWSONLY,C.INTENSITYMODE_AUTOMATIC=c.b.INTENSITYMODE_AUTOMATIC,C.INTENSITYMODE_LUMINOUSPOWER=c.b.INTENSITYMODE_LUMINOUSPOWER,C.INTENSITYMODE_LUMINOUSINTENSITY=c.b.INTENSITYMODE_LUMINOUSINTENSITY,C.INTENSITYMODE_ILLUMINANCE=c.b.INTENSITYMODE_ILLUMINANCE,C.INTENSITYMODE_LUMINANCE=c.b.INTENSITYMODE_LUMINANCE,C.LIGHTTYPEID_POINTLIGHT=c.b.LIGHTTYPEID_POINTLIGHT,C.LIGHTTYPEID_DIRECTIONALLIGHT=c.b.LIGHTTYPEID_DIRECTIONALLIGHT,C.LIGHTTYPEID_SPOTLIGHT=c.b.LIGHTTYPEID_SPOTLIGHT,C.LIGHTTYPEID_HEMISPHERICLIGHT=c.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,p.c)([(0,S.l)()],C.prototype,"diffuse",void 0),(0,p.c)([(0,S.l)()],C.prototype,"specular",void 0),(0,p.c)([(0,S.I)()],C.prototype,"falloffType",void 0),(0,p.c)([(0,S.I)()],C.prototype,"intensity",void 0),(0,p.c)([(0,S.I)()],C.prototype,"range",null),(0,p.c)([(0,S.I)()],C.prototype,"intensityMode",null),(0,p.c)([(0,S.I)()],C.prototype,"radius",null),(0,p.c)([(0,S.I)()],C.prototype,"_renderPriority",void 0),(0,p.c)([(0,S.d)("_reorderLightsInScene")],C.prototype,"renderPriority",void 0),(0,p.c)([(0,S.I)("shadowEnabled")],C.prototype,"_shadowEnabled",void 0),(0,p.c)([(0,S.I)("excludeWithLayerMask")],C.prototype,"_excludeWithLayerMask",void 0),(0,p.c)([(0,S.I)("includeOnlyWithLayerMask")],C.prototype,"_includeOnlyWithLayerMask",void 0),(0,p.c)([(0,S.I)("lightmapMode")],C.prototype,"_lightmapMode",void 0)},11194:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{static CompareLightsPriority(y,g){return y.shadowEnabled!==g.shadowEnabled?(g.shadowEnabled?1:0)-(y.shadowEnabled?1:0):g.renderPriority-y.renderPriority}}p.FALLOFF_DEFAULT=0,p.FALLOFF_PHYSICAL=1,p.FALLOFF_GLTF=2,p.FALLOFF_STANDARD=3,p.LIGHTMAP_DEFAULT=0,p.LIGHTMAP_SPECULAR=1,p.LIGHTMAP_SHADOWSONLY=2,p.INTENSITYMODE_AUTOMATIC=0,p.INTENSITYMODE_LUMINOUSPOWER=1,p.INTENSITYMODE_LUMINOUSINTENSITY=2,p.INTENSITYMODE_ILLUMINANCE=3,p.INTENSITYMODE_LUMINANCE=4,p.LIGHTTYPEID_POINTLIGHT=0,p.LIGHTTYPEID_DIRECTIONALLIGHT=1,p.LIGHTTYPEID_SPOTLIGHT=2,p.LIGHTTYPEID_HEMISPHERICLIGHT=3},12341:(y,g,f)=>{"use strict";f.d(g,{e:()=>U});var p=f(11021),S=f(11026),k=f(11054),i=f(12285),H=f(11378);class U extends i.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=k.c.Identity(),this._projectionMatrix=k.c.Identity()}_setPosition(y){this._position=y}get position(){return this._position}set position(y){this._setPosition(y)}_setDirection(y){this._direction=y}get direction(){return this._direction}set direction(y){this._setDirection(y)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(y){this._shadowMinZ=y,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(y){this._shadowMaxZ=y,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=k.m.Zero()),k.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=k.m.Zero()),k.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(y){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(y){return this.direction=k.m.Normalize(y.ed(this.position)),this.direction}getRotation(){this.direction.normalize();const y=k.m.Cross(this.direction,H.b.Y),g=k.m.Cross(y,this.direction);return k.m.RotationFromAxis(y,g,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=k.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Sj(y){return!y&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=k.c.Identity()),k.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(y){return void 0!==this.shadowMinZ?this.shadowMinZ:y.$i}getDepthMaxZ(y){return void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ}setShadowProjectionMatrix(y,g,f){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(g,f,y):this._setDefaultShadowProjectionMatrix(y,g,f),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(y){const g=k.j.o[0];let f=this.position;this.computeTransformedInformation()&&(f=this.transformedPosition),k.m.NormalizeToRef(this.getShadowDirection(y),g),1===Math.abs(k.m.Dot(g,k.m.Up()))&&(g.z=1e-13);const p=k.j.o[1];return f.addToRef(g,p),k.c.LookAtLHToRef(f,p,k.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(y,g){return this.setShadowProjectionMatrix(this._projectionMatrix,y??this._viewMatrix,g??[]),this._projectionMatrix}}(0,p.c)([(0,S.H)()],U.prototype,"position",null),(0,p.c)([(0,S.H)()],U.prototype,"direction",null),(0,p.c)([(0,S.I)()],U.prototype,"shadowMinZ",null),(0,p.c)([(0,S.I)()],U.prototype,"shadowMaxZ",null)},11700:(y,g,f)=>{"use strict";f.d(g,{b:()=>i,f:()=>k,j:()=>H});const p={},S={};function k(y,g){p[y]=g}function i(y,g){S[y]=g}function H(y){return S[y]?S[y]:null}},11445:(y,g,f)=>{"use strict";f.d(g,{e:()=>N,g:()=>Q});var p,S=f(10714),k=f(10723),i=f(11038),H=f(10761),U=f(10736),l=f(11361),c=f(10766),Z=f(10775),C=f(10878),q=f(10797);!function(y){y[y.Clean=0]="Clean",y[y.Stop=1]="Stop",y[y.Sync=2]="Sync",y[y.NoSync=3]="NoSync"}(p||(p={}));const W=new k.d,j={};let P=!1;function B(){return j[".babylon"]}function R(y){const g=j[y];return g||(U.d.Warn("Unable to find a plugin to load "+y+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),B())}function G(y,g,f){let p="Unable to load from "+(y.rawData?"binary data":y.url);return g?p+=`: ${g}`:f&&(p+=`: ${f}`),p}function z(y,g,f,p,S,k,i,H,U){var l;const Z="data:"===(C=y.url).substring(0,5)?C.substring(5):null;var C;if(y.rawData&&!i)throw"When using ArrayBufferView to load data the file extension must be provided.";const P=i?R(i):Z?function(y){for(const g in j){const f=j[g].plugin;if(f.canDirectLoad&&f.canDirectLoad(y))return j[g]}return B()}(y.url):function(y){const g=y.indexOf("?");-1!==g&&(y=y.substring(0,g));const f=y.lastIndexOf(".");return R(y.substring(f,y.length).toLowerCase())}(y.url);if(!P)throw new Error(`No plugin or fallback for ${i??y.url}`);if(!1===(null===U||void 0===U||null===(l=U[P.plugin.name])||void 0===l?void 0:l.enabled))throw new Error(`The '${P.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(y.rawData&&!P.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(y=>{if(P.plugin.createPlugin){const g=P.plugin.createPlugin(U??{});return g instanceof Promise?(g.then(y).catch((y=>{S("Error instantiating plugin.",y)})),null):(y(g),g)}return y(P.plugin),P.plugin})((U=>{var l;if(!U)throw`The loader plugin corresponding to the '${i}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(W.notifyObservers(U),Z&&(U.canDirectLoad&&U.canDirectLoad(y.url)||!(0,c.j)(y.url))){if(U.directLoad){const y=U.directLoad(g,Z);y instanceof Promise?y.then((y=>{f(U,y)})).catch((y=>{S("Error in directLoad of _loadData: "+y,y)})):f(U,y)}else f(U,Z);return}const C=P.isBinary,j=(y,p)=>{g.u?S("Scene has been disposed"):f(U,y,p)};let B=null,R=!1;null===(l=U.nj)||void 0===l||l.add((()=>{R=!0,B&&(B.abort(),B=null),k()}));const G=()=>{if(R)return;const f=(y,g)=>{S(null===y||void 0===y?void 0:y.statusText,g)};if(!U.loadFile&&y.rawData)throw"Plugin does not support loading ArrayBufferView.";B=U.loadFile?U.loadFile(g,y.rawData||y.file||y.url,y.rootUrl,j,p,C,f,H):g._loadFile(y.file||y.url,j,p,!0,C,f)},z=g.getEngine();let T=z.enableOfflineSupport;if(T){let f=!1;for(const p of g.disableOfflineSupportExceptionRules)if(p.test(y.url)){f=!0;break}T=!f}T&&q.b.OfflineProviderFactory?g.offlineProvider=q.b.OfflineProviderFactory(y.url,G,z.disableManifestCheck):G()}))}function T(y,g){let f,p,k=null,i=null;if(g)if(g.name)f=`file:${g.name}`,p=g.name,k=g;else if(ArrayBuffer.isView(g))f="",p=(0,C.e)(),i=g;else if(g.startsWith("data:"))f=g,p="";else if(y){const k=g;if("/"===k.substring(0,1))return S.e.Error("Wrong sceneFilename parameter"),null;f=y+k,p=k}else f=g,p=S.e.GetFilename(g),y=S.e.GetFolderPath(g);else f=y,p=S.e.GetFilename(y),y=S.e.GetFolderPath(y);return{url:f,rootUrl:y,name:p,file:k,rawData:i}}function Q(y){if("string"===typeof y.extensions){const g=y.extensions;j[g.toLowerCase()]={plugin:y,isBinary:!1}}else{const g=y.extensions;Object.keys(g).forEach((f=>{j[f.toLowerCase()]={plugin:y,isBinary:g[f].isBinary}}))}}function m(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.d.LastCreatedScene,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!p)return U.d.Error("No scene available to import mesh to"),null;const q=T(g,f);if(!q)return null;const W={};p.addPendingData(W);const j=()=>{p.removePendingData(W)},P=(y,g)=>{const f=G(q,y,g);i?i(p,f,new Z.j(f,Z.f.SceneLoaderError,g)):U.d.Error(f),j()},B=k?y=>{try{k(y)}catch(g){P("Error in onProgress callback: "+g,g)}}:void 0,R=(y,g,f,k,i,H,U,l)=>{if(p.importedMeshesFiles.push(q.url),S)try{S(y,g,f,k,i,H,U,l)}catch(c){P("Error in onSuccess callback: "+c,c)}p.removePendingData(W)};return z(q,p,((g,f,S)=>{if(g.rewriteRootURL&&(q.rootUrl=g.rewriteRootURL(q.rootUrl,S)),g.importMesh){const S=[],k=[],i=[];if(!g.importMesh(y,p,f,q.rootUrl,S,k,i,P))return;p.loadingPluginName=g.name,R(S,k,i,[],[],[],[],[])}else{g.importMeshAsync(y,p,f,q.rootUrl,B,q.name).then((y=>{p.loadingPluginName=g.name,R(y.meshes,y.uj,y.skeletons,y.animationGroups,y.transformNodes,y.geometries,y.lights,y.spriteManagers)})).catch((y=>{P(y.message,y)}))}}),B,P,j,l,c,C)}function a(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.d.LastCreatedEngine,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return f?o(y,g,new i.e(f),p,k,U,l,c,Z):(S.e.Error("No engine available"),null)}function w(y,g,f,p,S,k,i){return new Promise(((H,U)=>{a(y,g,f,(y=>{H(y)}),p,((y,g,f)=>{U(f||new Error(g))}),S,k,i)}))}function o(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.d.LastCreatedScene,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!f)return U.d.Error("No scene available to append to"),null;const q=T(y,g);if(!q)return null;const W={};f.addPendingData(W);const j=()=>{f.removePendingData(W)};l.b.ShowLoadingScreen&&!P&&(P=!0,f.getEngine().displayLoadingUI(),f.executeWhenReady((()=>{f.getEngine().hideLoadingUI(),P=!1})));const B=(y,g)=>{const p=G(q,y,g);k?k(f,p,new Z.j(p,Z.f.SceneLoaderError,g)):U.d.Error(p),j()},R=S?y=>{try{S(y)}catch(g){B("Error in onProgress callback",g)}}:void 0,Q=()=>{if(p)try{p(f)}catch(y){B("Error in onSuccess callback",y)}f.removePendingData(W)};return z(q,f,((y,g)=>{if(y.load){if(!y.load(f,g,q.rootUrl,B))return;f.loadingPluginName=y.name,Q()}else{y.loadAsync(f,g,q.rootUrl,R,q.name).then((()=>{f.loadingPluginName=y.name,Q()})).catch((y=>{B(y.message,y)}))}}),R,B,j,i,c,C)}function I(y,g,f,p,S,k,i){return new Promise(((H,U)=>{o(y,g,f,(y=>{H(y)}),p,((y,g,f)=>{U(f||new Error(g))}),S,k,i)}))}function Y(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.d.LastCreatedScene,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!f)return U.d.Error("No scene available to load asset container to"),null;const C=T(y,g);if(!C)return null;const q={};f.addPendingData(q);const W=()=>{f.removePendingData(q)},j=(y,g)=>{const p=G(C,y,g);k?k(f,p,new Z.j(p,Z.f.SceneLoaderError,g)):U.d.Error(p),W()},P=S?y=>{try{S(y)}catch(g){j("Error in onProgress callback",g)}}:void 0,B=y=>{if(p)try{p(y)}catch(g){j("Error in onSuccess callback",g)}f.removePendingData(q)};return z(C,f,((y,g)=>{if(y.loadAssetContainer){const p=y.loadAssetContainer(f,g,C.rootUrl,j);if(!p)return;p.populateRootNodes(),f.loadingPluginName=y.name,B(p)}else if(y.loadAssetContainerAsync){y.loadAssetContainerAsync(f,g,C.rootUrl,P,C.name).then((g=>{g.populateRootNodes(),f.loadingPluginName=y.name,B(g)})).catch((y=>{j(y.message,y)}))}else j("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),P,j,W,i,l,c)}function n(y,g,f,p,S,k,i){return new Promise(((H,U)=>{Y(y,g,f,(y=>{H(y)}),p,((y,g,f)=>{U(f||new Error(g))}),S,k,i)}))}function M(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.d.LastCreatedScene,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!f)return void U.d.Error("No scene available to load animations to");if(p){for(const y of f.animatables)y.reset();f.stopAllAnimations(),f.animationGroups.slice().forEach((y=>{y.dispose()}));f.getNodes().forEach((y=>{y.animations&&(y.animations=[])}))}else switch(S){case 0:f.animationGroups.slice().forEach((y=>{y.dispose()}));break;case 1:f.animationGroups.forEach((y=>{y.stop()}));break;case 2:f.animationGroups.forEach((y=>{y.reset(),y.restart()}));break;case 3:break;default:return void U.d.Error("Unknown animation group loading mode value '"+S+"'")}const W=f.animatables.length;Y(y,g,f,(y=>{y.mergeAnimationsTo(f,f.animatables.slice(W),k),y.dispose(),f.onAnimationFileImportedObservable.notifyObservers(f),i&&i(f)}),l,c,Z,C,q)}function r(y,g,f,p,S,k,i,H,U,l){return new Promise(((c,Z)=>{M(y,g,f,p,S,k,(y=>{c(y)}),i,((y,g,f)=>{Z(f||new Error(g))}),H,U,l)}))}class N{static get ForceFullSceneLoadingForIncremental(){return l.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(y){l.b.ForceFullSceneLoadingForIncremental=y}static get ShowLoadingScreen(){return l.b.ShowLoadingScreen}static set ShowLoadingScreen(y){l.b.ShowLoadingScreen=y}static get loggingLevel(){return l.b.loggingLevel}static set loggingLevel(y){l.b.loggingLevel=y}static get CleanBoneMatrixWeights(){return l.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(y){l.b.CleanBoneMatrixWeights=y}static GetDefaultPlugin(){return B()}static GetPluginForExtension(y){var g;return null===(g=R(y))||void 0===g?void 0:g.plugin}static IsPluginForExtensionAvailable(y){return function(y){return!!j[y]}(y)}static RegisterPlugin(y){Q(y)}static ImportMesh(y,g,f,p,S,k,i,H,U){return m(y,g,f,p,S,k,i,H,U)}static ImportMeshAsync(y,g,f,p,S,k,i){return function(y,g,f,p,S,k,i,H){return new Promise(((U,l)=>{m(y,g,f,p,((y,g,f,p,S,k,i,H)=>{U({meshes:y,uj:g,skeletons:f,animationGroups:p,transformNodes:S,geometries:k,lights:i,spriteManagers:H})}),S,((y,g,f)=>{l(f||new Error(g))}),k,i,H)}))}(y,g,f,p,S,k,i)}static Load(y,g,f,p,S,k,i,H){return a(y,g,f,p,S,k,i,H)}static LoadAsync(y,g,f,p,S,k){return w(y,g,f,p,S,k)}static Append(y,g,f,p,S,k,i,H){return o(y,g,f,p,S,k,i,H)}static AppendAsync(y,g,f,p,S,k){return I(y,g,f,p,S,k)}static LoadAssetContainer(y,g,f,p,S,k,i,H){return Y(y,g,f,p,S,k,i,H)}static LoadAssetContainerAsync(y,g,f,p,S,k){return n(y,g,f,p,S,k)}static ImportAnimations(y,g,f,p,S,k,i,H,U,l,c){M(y,g,f,p,S,k,i,H,U,l,c)}static ImportAnimationsAsync(y,g,f,p,S,k,i,H,U,l,c){return r(y,g,f,p,S,k,H,l,c)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=W},11361:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{static get ForceFullSceneLoadingForIncremental(){return p._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(y){p._ForceFullSceneLoadingForIncremental=y}static get ShowLoadingScreen(){return p._ShowLoadingScreen}static set ShowLoadingScreen(y){p._ShowLoadingScreen=y}static get loggingLevel(){return p._LoggingLevel}static set loggingLevel(y){p._LoggingLevel=y}static get CleanBoneMatrixWeights(){return p._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(y){p._CleanBoneMatrixWeights=y}}p._ForceFullSceneLoadingForIncremental=!1,p._ShowLoadingScreen=!0,p._CleanBoneMatrixWeights=!1,p._LoggingLevel=0},12268:(y,g,f)=>{"use strict";f.d(g,{b:()=>V});var p=f(11021),S=f(11026),k=f(10736),i=f(11036),H=f(12253),U=f(11038),l=f(11054),c=f(11131),Z=f(11253),C=f(11311);class q extends Z.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class W extends C.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRBRDF",90,new q,g),this._useEnergyConservation=W.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=W.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=W.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=W.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=W.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=W.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=W.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=W.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=y._dirtyCallbacks[16],this._enable(!0)}prepareDefines(y){y.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,y.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,y.SPHERICAL_HARMONICS=this._useSphericalHarmonics,y.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}W.DEFAULT_USE_ENERGY_CONSERVATION=!0,W.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,W.DEFAULT_USE_SPHERICAL_HARMONICS=!0,W.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useEnergyConservation",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useSphericalHarmonics",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var j=f(11197),P=f(11090),B=f(11087),R=f(11206),G=f(11262),z=f(11267),T=f(11285),Q=(f(12270),f(11294)),m=f(11242);class a extends Z.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class w extends C.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRClearCoat",100,new a,g),this._isEnabled=!1,this.isEnabled=!1,this.cj=1,this.roughness=0,this._indexOfRefraction=w._DefaultIndexOfRefraction,this.indexOfRefraction=w._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=P.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,g,f){if(!this._isEnabled)return!0;const p=this._material._disableBumpMap;if(y._areTexturesDirty&&g.texturesEnabled){if(this._texture&&T.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(f.getCaps().standardDerivatives&&this._bumpTexture&&T.b.ClearCoatBumpTextureEnabled&&!p&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&T.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,g){this._isEnabled?(y.CLEARCOAT=!0,y.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,y.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,y._areTexturesDirty&&g.texturesEnabled&&(this._texture&&T.b.ClearCoatTextureEnabled?(0,m.R)(this._texture,y,"CLEARCOAT_TEXTURE"):y.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&T.b.ClearCoatTextureEnabled?(0,m.R)(this._textureRoughness,y,"CLEARCOAT_TEXTURE_ROUGHNESS"):y.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&T.b.ClearCoatBumpTextureEnabled?(0,m.R)(this._bumpTexture,y,"CLEARCOAT_BUMP"):y.CLEARCOAT_BUMP=!1,y.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===w._DefaultIndexOfRefraction,this._isTintEnabled?(y.CLEARCOAT_TINT=!0,this._tintTexture&&T.b.ClearCoatTintTextureEnabled?((0,m.R)(this._tintTexture,y,"CLEARCOAT_TINT_TEXTURE"),y.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):y.CLEARCOAT_TINT_TEXTURE=!1):(y.CLEARCOAT_TINT=!1,y.CLEARCOAT_TINT_TEXTURE=!1))):(y.CLEARCOAT=!1,y.CLEARCOAT_TEXTURE=!1,y.CLEARCOAT_TEXTURE_ROUGHNESS=!1,y.CLEARCOAT_BUMP=!1,y.CLEARCOAT_TINT=!1,y.CLEARCOAT_TINT_TEXTURE=!1,y.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,y.CLEARCOAT_DEFAULTIOR=!1,y.CLEARCOAT_TEXTUREDIRECTUV=0,y.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,y.CLEARCOAT_BUMPDIRECTUV=0,y.CLEARCOAT_REMAP_F0=!1,y.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,y.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(y,g,f,p){if(!this._isEnabled)return;const S=p.materialDefines,k=this._material.isFrozen,i=this._material._disableBumpMap,H=this._material._invertNormalMapX,U=this._material._invertNormalMapY;if(!y.useUbo||!k||!y.isSync){var l,c,Z,C;if((this._texture||this._textureRoughness)&&T.b.ClearCoatTextureEnabled)y.updateFloat4("vClearCoatInfos",(null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(c=this._texture)||void 0===c?void 0:c.level)??0,(null===(Z=this._textureRoughness)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(C=this._textureRoughness)||void 0===C?void 0:C.level)??0),this._texture&&(0,m.u)(this._texture,y,"clearCoat"),this._textureRoughness&&!S.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,m.u)(this._textureRoughness,y,"clearCoatRoughness");this._bumpTexture&&f.getCaps().standardDerivatives&&T.b.ClearCoatTextureEnabled&&!i&&(y.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,m.u)(this._bumpTexture,y,"clearCoatBump"),g._mirroredCameraPosition?y.updateFloat2("vClearCoatTangentSpaceParams",H?1:-1,U?1:-1):y.updateFloat2("vClearCoatTangentSpaceParams",H?-1:1,U?-1:1)),this._tintTexture&&T.b.ClearCoatTintTextureEnabled&&(y.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,m.u)(this._tintTexture,y,"clearCoatTint")),y.updateFloat2("vClearCoatParams",this.cj,this.roughness);const p=1-this._indexOfRefraction,k=1+this._indexOfRefraction,q=Math.pow(-p/k,2),W=1/this._indexOfRefraction;y.updateFloat4("vClearCoatRefractionParams",q,W,p,k),this._isTintEnabled&&(y.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),y.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}g.texturesEnabled&&(this._texture&&T.b.ClearCoatTextureEnabled&&y.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!S.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.b.ClearCoatTextureEnabled&&y.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&f.getCaps().standardDerivatives&&T.b.ClearCoatBumpTextureEnabled&&!i&&y.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&T.b.ClearCoatTintTextureEnabled&&y.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(y){return this._texture===y||(this._textureRoughness===y||(this._bumpTexture===y||this._tintTexture===y))}getActiveTextures(y){this._texture&&y.push(this._texture),this._textureRoughness&&y.push(this._textureRoughness),this._bumpTexture&&y.push(this._bumpTexture),this._tintTexture&&y.push(this._tintTexture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&y.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&y.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&y.push(this._tintTexture)}dispose(y){var g,f,p,S;y&&(null===(g=this._texture)||void 0===g||g.dispose(),null===(f=this._textureRoughness)||void 0===f||f.dispose(),null===(p=this._bumpTexture)||void 0===p||p.dispose(),null===(S=this._tintTexture)||void 0===S||S.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(y,g,f){return y.CLEARCOAT_BUMP&&g.addFallback(f++,"CLEARCOAT_BUMP"),y.CLEARCOAT_TINT&&g.addFallback(f++,"CLEARCOAT_TINT"),y.CLEARCOAT&&g.addFallback(f++,"CLEARCOAT"),f}getSamplers(y){y.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}w._DefaultIndexOfRefraction=1.5,(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isEnabled",void 0),(0,p.c)([(0,S.I)()],w.prototype,"intensity",void 0),(0,p.c)([(0,S.I)()],w.prototype,"roughness",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"indexOfRefraction",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"texture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useRoughnessFromMainTexture",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"textureRoughness",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"remapF0OnInterfaceChange",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"bumpTexture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isTintEnabled",void 0),(0,p.c)([(0,S.l)()],w.prototype,"tintColor",void 0),(0,p.c)([(0,S.I)()],w.prototype,"tintColorAtDistance",void 0),(0,p.c)([(0,S.I)()],w.prototype,"tintThickness",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"tintTexture",void 0);class o extends Z.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class I extends C.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRIridescence",110,new o,g),this._isEnabled=!1,this.isEnabled=!1,this.cj=1,this.minimumThickness=I._DefaultMinimumThickness,this.maximumThickness=I._DefaultMaximumThickness,this.indexOfRefraction=I._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,g){if(!this._isEnabled)return!0;if(y._areTexturesDirty&&g.texturesEnabled){if(this._texture&&T.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&T.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,g){this._isEnabled?(y.IRIDESCENCE=!0,y._areTexturesDirty&&g.texturesEnabled&&(this._texture&&T.b.IridescenceTextureEnabled?(0,m.R)(this._texture,y,"IRIDESCENCE_TEXTURE"):y.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&T.b.IridescenceTextureEnabled?(0,m.R)(this._thicknessTexture,y,"IRIDESCENCE_THICKNESS_TEXTURE"):y.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(y.IRIDESCENCE=!1,y.IRIDESCENCE_TEXTURE=!1,y.IRIDESCENCE_THICKNESS_TEXTURE=!1,y.IRIDESCENCE_TEXTUREDIRECTUV=0,y.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(y,g){if(!this._isEnabled)return;const f=this._material.isFrozen;if(!y.useUbo||!f||!y.isSync){var p,S,k,i;if((this._texture||this._thicknessTexture)&&T.b.IridescenceTextureEnabled)y.updateFloat4("vIridescenceInfos",(null===(p=this._texture)||void 0===p?void 0:p.coordinatesIndex)??0,(null===(S=this._texture)||void 0===S?void 0:S.level)??0,(null===(k=this._thicknessTexture)||void 0===k?void 0:k.coordinatesIndex)??0,(null===(i=this._thicknessTexture)||void 0===i?void 0:i.level)??0),this._texture&&(0,m.u)(this._texture,y,"iridescence"),this._thicknessTexture&&(0,m.u)(this._thicknessTexture,y,"iridescenceThickness");y.updateFloat4("vIridescenceParams",this.cj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}g.texturesEnabled&&(this._texture&&T.b.IridescenceTextureEnabled&&y.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&T.b.IridescenceTextureEnabled&&y.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(y){return this._texture===y||this._thicknessTexture===y}getActiveTextures(y){this._texture&&y.push(this._texture),this._thicknessTexture&&y.push(this._thicknessTexture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&y.push(this._thicknessTexture)}dispose(y){var g,f;y&&(null===(g=this._texture)||void 0===g||g.dispose(),null===(f=this._thicknessTexture)||void 0===f||f.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(y,g,f){return y.IRIDESCENCE&&g.addFallback(f++,"IRIDESCENCE"),f}getSamplers(y){y.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}I._DefaultMinimumThickness=100,I._DefaultMaximumThickness=400,I._DefaultIndexOfRefraction=1.3,(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),(0,p.c)([(0,S.I)()],I.prototype,"intensity",void 0),(0,p.c)([(0,S.I)()],I.prototype,"minimumThickness",void 0),(0,p.c)([(0,S.I)()],I.prototype,"maximumThickness",void 0),(0,p.c)([(0,S.I)()],I.prototype,"indexOfRefraction",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"thicknessTexture",void 0);class Y extends Z.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class n extends C.b{set angle(y){this.direction.x=Math.cos(y),this.direction.y=Math.sin(y)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRAnisotropic",110,new Y,g),this._isEnabled=!1,this.isEnabled=!1,this.cj=1,this.direction=new l.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=y._dirtyCallbacks[16]}isReadyForSubMesh(y,g){return!this._isEnabled||!(y._areTexturesDirty&&g.texturesEnabled&&this._texture&&T.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(y,g,f){this._isEnabled?(y.ANISOTROPIC=this._isEnabled,this._isEnabled&&!f.isVerticesDataPresent(c.c.TangentKind)&&(y._needUVs=!0,y.MAINUV1=!0),y._areTexturesDirty&&g.texturesEnabled&&(this._texture&&T.b.AnisotropicTextureEnabled?(0,m.R)(this._texture,y,"ANISOTROPIC_TEXTURE"):y.ANISOTROPIC_TEXTURE=!1),y._areMiscDirty&&(y.ANISOTROPIC_LEGACY=this._legacy)):(y.ANISOTROPIC=!1,y.ANISOTROPIC_TEXTURE=!1,y.ANISOTROPIC_TEXTUREDIRECTUV=0,y.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(y,g){if(!this._isEnabled)return;const f=this._material.isFrozen;y.useUbo&&f&&y.isSync||(this._texture&&T.b.AnisotropicTextureEnabled&&(y.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,m.u)(this._texture,y,"anisotropy")),y.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.cj)),g.texturesEnabled&&this._texture&&T.b.AnisotropicTextureEnabled&&y.setTexture("anisotropySampler",this._texture)}hasTexture(y){return this._texture===y}getActiveTextures(y){this._texture&&y.push(this._texture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture)}dispose(y){y&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(y,g,f){return y.ANISOTROPIC&&g.addFallback(f++,"ANISOTROPIC"),f}getSamplers(y){y.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(y,g,f){super.parse(y,g,f),void 0===y.legacy&&(this.legacy=!0)}}(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,p.c)([(0,S.I)()],n.prototype,"intensity",void 0),(0,p.c)([(0,S.F)()],n.prototype,"direction",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"legacy",void 0);class M extends Z.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class r extends C.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"Sheen",120,new M,g),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.cj=1,this.color=P.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,g){if(!this._isEnabled)return!0;if(y._areTexturesDirty&&g.texturesEnabled){if(this._texture&&T.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,g){this._isEnabled?(y.SHEEN=!0,y.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,y.SHEEN_ROUGHNESS=null!==this._roughness,y.SHEEN_ALBEDOSCALING=this._albedoScaling,y.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,y._areTexturesDirty&&g.texturesEnabled&&(this._texture&&T.b.SheenTextureEnabled?((0,m.R)(this._texture,y,"SHEEN_TEXTURE"),y.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):y.SHEEN_TEXTURE=!1,this._textureRoughness&&T.b.SheenTextureEnabled?(0,m.R)(this._textureRoughness,y,"SHEEN_TEXTURE_ROUGHNESS"):y.SHEEN_TEXTURE_ROUGHNESS=!1)):(y.SHEEN=!1,y.SHEEN_TEXTURE=!1,y.SHEEN_TEXTURE_ROUGHNESS=!1,y.SHEEN_LINKWITHALBEDO=!1,y.SHEEN_ROUGHNESS=!1,y.SHEEN_ALBEDOSCALING=!1,y.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,y.SHEEN_GAMMATEXTURE=!1,y.SHEEN_TEXTUREDIRECTUV=0,y.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(y,g,f,p){if(!this._isEnabled)return;const S=p.materialDefines,k=this._material.isFrozen;if(!y.useUbo||!k||!y.isSync){var i,H,U,l;if((this._texture||this._textureRoughness)&&T.b.SheenTextureEnabled)y.updateFloat4("vSheenInfos",(null===(i=this._texture)||void 0===i?void 0:i.coordinatesIndex)??0,(null===(H=this._texture)||void 0===H?void 0:H.level)??0,(null===(U=this._textureRoughness)||void 0===U?void 0:U.coordinatesIndex)??0,(null===(l=this._textureRoughness)||void 0===l?void 0:l.level)??0),this._texture&&(0,m.u)(this._texture,y,"sheen"),this._textureRoughness&&!S.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,m.u)(this._textureRoughness,y,"sheenRoughness");y.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.cj),null!==this._roughness&&y.updateFloat("vSheenRoughness",this._roughness)}g.texturesEnabled&&(this._texture&&T.b.SheenTextureEnabled&&y.setTexture("sheenSampler",this._texture),this._textureRoughness&&!S.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.b.SheenTextureEnabled&&y.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(y){return this._texture===y||this._textureRoughness===y}getActiveTextures(y){this._texture&&y.push(this._texture),this._textureRoughness&&y.push(this._textureRoughness)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&y.push(this._textureRoughness)}dispose(y){var g,f;y&&(null===(g=this._texture)||void 0===g||g.dispose(),null===(f=this._textureRoughness)||void 0===f||f.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(y,g,f){return y.SHEEN&&g.addFallback(f++,"SHEEN"),f}getSamplers(y){y.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isEnabled",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"linkSheenWithAlbedo",void 0),(0,p.c)([(0,S.I)()],r.prototype,"intensity",void 0),(0,p.c)([(0,S.l)()],r.prototype,"color",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"texture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMainTexture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"textureRoughness",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoScaling",void 0);class N extends Z.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class b extends C.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(y){this._scene.enableSubSurfaceForPrePass()&&y&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(y))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(y){this._volumeIndexOfRefraction=y>=1?y:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRSubSurface",130,new N,g),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=P.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=P.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=y.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=y._dirtyCallbacks[32]}isReadyForSubMesh(y,g){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(y._areTexturesDirty&&g.texturesEnabled){if(this._thicknessTexture&&T.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&T.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&T.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const y=this._getRefractionTexture(g);if(y&&T.b.RefractionTextureEnabled&&!y.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,g){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return y.SUBSURFACE=!1,y.SS_DISPERSION=!1,y.SS_TRANSLUCENCY=!1,y.SS_SCATTERING=!1,y.SS_REFRACTION=!1,y.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_THICKNESSANDMASK_TEXTURE=!1,y.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,y.SS_HAS_THICKNESS=!1,y.SS_REFRACTIONINTENSITY_TEXTURE=!1,y.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,y.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,y.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,y.SS_REFRACTIONMAP_3D=!1,y.SS_REFRACTIONMAP_OPPOSITEZ=!1,y.SS_LODINREFRACTIONALPHA=!1,y.SS_GAMMAREFRACTION=!1,y.SS_RGBDREFRACTION=!1,y.SS_LINEARSPECULARREFRACTION=!1,y.SS_LINKREFRACTIONTOTRANSPARENCY=!1,y.SS_ALBEDOFORREFRACTIONTINT=!1,y.SS_ALBEDOFORTRANSLUCENCYTINT=!1,y.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,y.SS_USE_THICKNESS_AS_DEPTH=!1,y.SS_USE_GLTF_TEXTURES=!1,y.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(y.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(y._areTexturesDirty){if(y.SUBSURFACE=!0,y.SS_DISPERSION=this._isDispersionEnabled,y.SS_TRANSLUCENCY=this._isTranslucencyEnabled,y.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_SCATTERING=this._isScatteringEnabled,y.SS_THICKNESSANDMASK_TEXTURE=!1,y.SS_REFRACTIONINTENSITY_TEXTURE=!1,y.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,y.SS_HAS_THICKNESS=!1,y.SS_USE_GLTF_TEXTURES=!1,y.SS_REFRACTION=!1,y.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_REFRACTIONMAP_3D=!1,y.SS_GAMMAREFRACTION=!1,y.SS_RGBDREFRACTION=!1,y.SS_LINEARSPECULARREFRACTION=!1,y.SS_REFRACTIONMAP_OPPOSITEZ=!1,y.SS_LODINREFRACTIONALPHA=!1,y.SS_LINKREFRACTIONTOTRANSPARENCY=!1,y.SS_ALBEDOFORREFRACTIONTINT=!1,y.SS_ALBEDOFORTRANSLUCENCYTINT=!1,y.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,y.SS_USE_THICKNESS_AS_DEPTH=!1,y.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,y._areTexturesDirty&&g.texturesEnabled&&(this._thicknessTexture&&T.b.ThicknessTextureEnabled&&(0,m.R)(this._thicknessTexture,y,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&T.b.RefractionIntensityTextureEnabled&&(0,m.R)(this._refractionIntensityTexture,y,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&T.b.TranslucencyIntensityTextureEnabled&&(0,m.R)(this._translucencyIntensityTexture,y,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&T.b.TranslucencyColorTextureEnabled&&(0,m.R)(this._translucencyColorTexture,y,"SS_TRANSLUCENCYCOLOR_TEXTURE")),y.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,y.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,y.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,y.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&g.texturesEnabled){const f=this._getRefractionTexture(g);f&&T.b.RefractionTextureEnabled&&(y.SS_REFRACTION=!0,y.SS_REFRACTIONMAP_3D=f.isCube,y.SS_GAMMAREFRACTION=f.gammaSpace,y.SS_RGBDREFRACTION=f.isRGBD,y.SS_LINEARSPECULARREFRACTION=f.linearSpecularLOD,y.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&f.isCube?!f.invertZ:f.invertZ,y.SS_LODINREFRACTIONALPHA=f.lodLevelInAlpha,y.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,y.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,y.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=f.isCube&&f.boundingBoxSize,y.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(y.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(y,g,f,p){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)y.updateFloat2("vThicknessParam",0,0);else{p.getRenderingMesh().getWorldMatrix().decompose(l.j.o[0]);const g=Math.max(Math.abs(l.j.o[0].x),Math.abs(l.j.o[0].y),Math.abs(l.j.o[0].z));y.updateFloat2("vThicknessParam",this.minimumThickness*g,(this.maximumThickness-this.minimumThickness)*g)}}bindForSubMesh(y,g,f,p){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const S=p.materialDefines,k=this._material.isFrozen,i=this._material.realTimeFiltering,H=S.LODBASEDMICROSFURACE,U=this._getRefractionTexture(g);if(!y.useUbo||!k||!y.isSync){if(this._thicknessTexture&&T.b.ThicknessTextureEnabled&&(y.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,m.u)(this._thicknessTexture,y,"thickness")),this._refractionIntensityTexture&&T.b.RefractionIntensityTextureEnabled&&S.SS_REFRACTIONINTENSITY_TEXTURE&&(y.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,m.u)(this._refractionIntensityTexture,y,"refractionIntensity")),this._translucencyColorTexture&&T.b.TranslucencyColorTextureEnabled&&S.SS_TRANSLUCENCYCOLOR_TEXTURE&&(y.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,m.u)(this._translucencyColorTexture,y,"translucencyColor")),this._translucencyIntensityTexture&&T.b.TranslucencyIntensityTextureEnabled&&S.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(y.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,m.u)(this._translucencyIntensityTexture,y,"translucencyIntensity")),U&&T.b.RefractionTextureEnabled){y.Lj("refractionMatrix",U.getRefractionTextureMatrix());let g=1;U.isCube||U.depth&&(g=U.depth);const f=U.getSize().width,p=this.volumeIndexOfRefraction;if(y.updateFloat4("vRefractionInfos",U.level,1/p,g,this._invertRefractionY?-1:1),y.updateFloat4("vRefractionMicrosurfaceInfos",f,U.lodGenerationScale,U.lodGenerationOffset,1/this.indexOfRefraction),i&&y.updateFloat2("vRefractionFilteringInfo",f,Math.log2(f)),U.boundingBoxSize){const g=U;y.updateVector3("vRefractionPosition",g.boundingBoxPosition),y.updateVector3("vRefractionSize",g.boundingBoxSize)}}this._isScatteringEnabled&&y.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),y.updateColor3("vDiffusionDistance",this.diffusionDistance),y.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),y.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),y.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),y.updateFloat("dispersion",this.dispersion)}g.texturesEnabled&&(this._thicknessTexture&&T.b.ThicknessTextureEnabled&&y.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&T.b.RefractionIntensityTextureEnabled&&S.SS_REFRACTIONINTENSITY_TEXTURE&&y.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&T.b.TranslucencyIntensityTextureEnabled&&S.SS_TRANSLUCENCYINTENSITY_TEXTURE&&y.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&T.b.TranslucencyColorTextureEnabled&&S.SS_TRANSLUCENCYCOLOR_TEXTURE&&y.setTexture("translucencyColorSampler",this._translucencyColorTexture),U&&T.b.RefractionTextureEnabled&&(H?y.setTexture("refractionSampler",U):(y.setTexture("refractionSampler",U._lodTextureMid||U),y.setTexture("refractionSamplerLow",U._lodTextureLow||U),y.setTexture("refractionSamplerHigh",U._lodTextureHigh||U))))}_getRefractionTexture(y){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?y.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(y){T.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&y.push(this._refractionTexture)}hasTexture(y){return this._thicknessTexture===y||(this._refractionTexture===y||(this._refractionIntensityTexture===y||(this._translucencyIntensityTexture===y||this._translucencyColorTexture===y)))}hasRenderTargetTextures(){return!!(T.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(y){this._thicknessTexture&&y.push(this._thicknessTexture),this._refractionTexture&&y.push(this._refractionTexture),this._translucencyColorTexture&&y.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&y.push(this._translucencyIntensityTexture)}getAnimatables(y){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&y.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&y.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&y.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&y.push(this._translucencyIntensityTexture)}dispose(y){y&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(y,g,f){return y.SS_SCATTERING&&g.addFallback(f++,"SS_SCATTERING"),y.SS_TRANSLUCENCY&&g.addFallback(f++,"SS_TRANSLUCENCY"),f}getSamplers(y){y.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isRefractionEnabled",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isTranslucencyEnabled",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isDispersionEnabled",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markScenePrePassDirty")],b.prototype,"isScatteringEnabled",void 0),(0,p.c)([(0,S.I)()],b.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,p.c)([(0,S.I)()],b.prototype,"refractionIntensity",void 0),(0,p.c)([(0,S.I)()],b.prototype,"translucencyIntensity",void 0),(0,p.c)([(0,S.I)()],b.prototype,"useAlbedoToTintRefraction",void 0),(0,p.c)([(0,S.I)()],b.prototype,"useAlbedoToTintTranslucency",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"thicknessTexture",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"refractionTexture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"indexOfRefraction",void 0),(0,p.c)([(0,S.I)()],b.prototype,"_volumeIndexOfRefraction",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"volumeIndexOfRefraction",null),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertRefractionY",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"linkRefractionWithTransparency",void 0),(0,p.c)([(0,S.I)()],b.prototype,"minimumThickness",void 0),(0,p.c)([(0,S.I)()],b.prototype,"maximumThickness",void 0),(0,p.c)([(0,S.I)()],b.prototype,"useThicknessAsDepth",void 0),(0,p.c)([(0,S.l)()],b.prototype,"tintColor",void 0),(0,p.c)([(0,S.I)()],b.prototype,"tintColorAtDistance",void 0),(0,p.c)([(0,S.I)()],b.prototype,"dispersion",void 0),(0,p.c)([(0,S.l)()],b.prototype,"diffusionDistance",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useMaskFromThicknessTexture",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"refractionIntensityTexture",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"translucencyIntensityTexture",void 0),(0,p.c)([(0,S.l)()],b.prototype,"translucencyColor",void 0),(0,p.c)([(0,S.E)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"translucencyColorTexture",void 0),(0,p.c)([(0,S.I)(),(0,S.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useGltfStyleTextures",void 0);var s=f(11302),u=f(11249),F=f(11318);const A={effect:null,subMesh:null};class J extends Z.d{constructor(y){super(y),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class V extends G.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(y){this._realTimeFiltering=y,this.Vg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(y){this._realTimeFilteringQuality=y,this.Vg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(y){y!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=y||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(y,g){super(y,g,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||V.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new l.o(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=P.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new P.c(0,0,0),this._albedoColor=new P.c(1,1,1),this._reflectivityColor=new P.c(1,1,1),this._reflectionColor=new P.c(1,1,1),this._emissiveColor=new P.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=V.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new i.i(16),this._globalAmbientColor=new P.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new W(this),this.clearCoat=new w(this),this.iridescence=new I(this),this.anisotropy=new n(this),this.sheen=new r(this),this.subSurface=new b(this),this.detailMap=new s.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),T.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,H.c)(this.va()),this.prePassConfiguration=new j.d}get hasRenderTargetTextures(){return!!(T.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var y;return this._transparencyMode===V.PBRMATERIAL_OPAQUE||this._transparencyMode===V.PBRMATERIAL_ALPHATEST||(null===(y=this.subSurface)||void 0===y?void 0:y.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var y;return!!this._forceAlphaTest||(null===(y=this.subSurface)||void 0===y||!y.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===V.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Be&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==V.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Be||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(y,g,f){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const p=g._drawWrapper;if(p.effect&&this.isFrozen&&p._wasPreviouslyReady&&p._wasPreviouslyUsingInstances===f)return!0;g.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),g.materialDefines=new J(this._eventInfo.defineNames));const S=g.materialDefines;if(this._isReadyForSubMesh(g))return!0;const i=this.va(),H=i.getEngine();if(S._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,i.texturesEnabled)){if(this._albedoTexture&&T.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&T.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&T.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const y=this._getReflectionTexture();if(y&&T.b.ReflectionTextureEnabled){if(!y.isReadyOrNotBlocking())return!1;var U;if(y.irradianceTexture){if(!y.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!y.sphericalPolynomial&&null!==(U=y.getInternalTexture())&&void 0!==U&&U._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&T.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&T.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(T.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(H.getCaps().standardDerivatives&&this._bumpTexture&&T.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&T.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._eventInfo.subMesh=g,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(S._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;H.getCaps().standardDerivatives||y.isVerticesDataPresent(c.c.NormalKind)||(y.createNormals(!0),k.d.Warn("PBRMaterial: Normals have been created for the mesh: "+y.name));const l=g.effect,Z=S._areLightsDisposed;let C=this._prepareEffect(y,S,this.onCompiled,this.onError,f,null,g.getRenderingMesh().hasThinInstances),q=!1;if(C)if(this._onEffectCreatedObservable&&(A.effect=C,A.subMesh=g,this._onEffectCreatedObservable.notifyObservers(A)),this.allowShaderHotSwapping&&l&&!C.isReady()){if(C=l,S.markAsUnprocessed(),q=this.isFrozen,Z)return S._areLightsDisposed=!0,!1}else i.resetCachedMaterial(),g.setEffect(C,S,this._materialContext);return!(!g.effect||!g.effect.isReady())&&(S._renderId=i.getRenderId(),p._wasPreviouslyReady=!q,p._wasPreviouslyUsingInstances=!!f,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(y,g){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(y,g,k,i,H),!g.isDirty)return null;g.markAsProcessed();const U=this.va().getEngine(),l=new Q.d;let Z=0;g.USESPHERICALINVERTEX&&l.addFallback(Z++,"USESPHERICALINVERTEX"),g.FOG&&l.addFallback(Z,"FOG"),g.SPECULARAA&&l.addFallback(Z,"SPECULARAA"),g.POINTSIZE&&l.addFallback(Z,"POINTSIZE"),g.LOGARITHMICDEPTH&&l.addFallback(Z,"LOGARITHMICDEPTH"),g.PARALLAX&&l.addFallback(Z,"PARALLAX"),g.PARALLAX_RHS&&l.addFallback(Z,"PARALLAX_RHS"),g.PARALLAXOCCLUSION&&l.addFallback(Z++,"PARALLAXOCCLUSION"),g.ENVIRONMENTBRDF&&l.addFallback(Z++,"ENVIRONMENTBRDF"),g.TANGENT&&l.addFallback(Z++,"TANGENT"),g.BUMP&&l.addFallback(Z++,"BUMP"),Z=(0,m.x)(g,l,this._maxSimultaneousLights,Z++),g.SPECULARTERM&&l.addFallback(Z++,"SPECULARTERM"),g.USESPHERICALFROMREFLECTIONMAP&&l.addFallback(Z++,"USESPHERICALFROMREFLECTIONMAP"),g.USEIRRADIANCEMAP&&l.addFallback(Z++,"USEIRRADIANCEMAP"),g.LIGHTMAP&&l.addFallback(Z++,"LIGHTMAP"),g.NORMAL&&l.addFallback(Z++,"NORMAL"),g.AMBIENT&&l.addFallback(Z++,"AMBIENT"),g.EMISSIVE&&l.addFallback(Z++,"EMISSIVE"),g.VERTEXCOLOR&&l.addFallback(Z++,"VERTEXCOLOR"),g.MORPHTARGETS&&l.addFallback(Z++,"MORPHTARGETS"),g.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");const C=[c.c.PositionKind];g.NORMAL&&C.push(c.c.NormalKind),g.TANGENT&&C.push(c.c.TangentKind);for(let f=1;f<=6;++f)g["UV"+f]&&C.push(`uv${1===f?"":f}`);g.VERTEXCOLOR&&C.push(c.c.ColorKind),(0,m.C)(C,y,g,l),(0,m.F)(C,g),(0,m.H)(C,y,g),(0,m.z)(C,y,g);let q="pbr";const W=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],P=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],R=["Material","Scene","Mesh"],G={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:g.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=l,this._eventInfo.fallbackRank=Z,this._eventInfo.defines=g,this._eventInfo.uniforms=W,this._eventInfo.attributes=C,this._eventInfo.samplers=P,this._eventInfo.uniformBuffersNames=R,this._eventInfo.customCode=void 0,this._eventInfo.mesh=y,this._eventInfo.indexParameters=G,this._callbackPluginEventGeneric(128,this._eventInfo),F.d.AddUniformsAndSamplers(W,P),j.d.AddUniforms(W),j.d.AddSamplers(P),(0,u.c)(W),B.b&&(B.b.PrepareUniforms(W,g),B.b.PrepareSamplers(P,g)),(0,m.ab)({uniformsNames:W,uniformBuffersNames:R,samplers:P,defines:g,maxSimultaneousLights:this._maxSimultaneousLights});const z={};this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,W,R,P,g,C,z));const T=g.toString(),a=U.createEffect(q,{attributes:C,uniformsNames:W,uniformBuffersNames:R,samplers:P,defines:T,fallbacks:l,onCompiled:p,onError:S,indexParameters:G,processFinalCode:z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:g.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([f.e(21),f.e(43)]).then(f.bind(f,13587)),Promise.all([f.e(22),f.e(44)]).then(f.bind(f,13610))]):await Promise.all([Promise.all([f.e(25),f.e(45)]).then(f.bind(f,13618)),Promise.all([f.e(27),f.e(46)]).then(f.bind(f,13632))]),this._shadersLoaded=!0}},U);return this._eventInfo.customCode=void 0,a}_prepareDefines(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const k=this.va(),i=k.getEngine();(0,m.P)(k,y,g,!0,this._maxSimultaneousLights,this._disableLighting),g._needNormals=!0,(0,m.W)(k,g);const H=this.needAlphaBlendingForMesh(y)&&this.va().useOrderIndependentTransparency;if((0,m._)(k,g,this.canRenderToMRT&&!H),(0,m.X)(k,g,H),F.d.PrepareDefines(i.currentRenderPassId,y,g),g.METALLICWORKFLOW=this.isMetallicWorkflow(),g._areTexturesDirty){g._needUVs=!1;for(let y=1;y<=6;++y)g["MAINUV"+y]=!1;if(k.texturesEnabled){g.ALBEDODIRECTUV=0,g.AMBIENTDIRECTUV=0,g.OPACITYDIRECTUV=0,g.EMISSIVEDIRECTUV=0,g.REFLECTIVITYDIRECTUV=0,g.MICROSURFACEMAPDIRECTUV=0,g.METALLIC_REFLECTANCEDIRECTUV=0,g.REFLECTANCEDIRECTUV=0,g.BUMPDIRECTUV=0,g.LIGHTMAPDIRECTUV=0,i.getCaps().textureLOD&&(g.LODBASEDMICROSFURACE=!0),this._albedoTexture&&T.b.DiffuseTextureEnabled?((0,m.R)(this._albedoTexture,g,"ALBEDO"),g.GAMMAALBEDO=this._albedoTexture.gammaSpace):g.ALBEDO=!1,this._ambientTexture&&T.b.AmbientTextureEnabled?((0,m.R)(this._ambientTexture,g,"AMBIENT"),g.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):g.AMBIENT=!1,this._opacityTexture&&T.b.OpacityTextureEnabled?((0,m.R)(this._opacityTexture,g,"OPACITY"),g.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):g.OPACITY=!1;const y=this._getReflectionTexture();if(y&&T.b.ReflectionTextureEnabled){switch(g.REFLECTION=!0,g.GAMMAREFLECTION=y.gammaSpace,g.RGBDREFLECTION=y.isRGBD,g.LODINREFLECTIONALPHA=y.lodLevelInAlpha,g.LINEARSPECULARREFLECTION=y.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(g.NUM_SAMPLES=""+this.realTimeFilteringQuality,i._features.needTypeSuffixInShaderConstants&&(g.NUM_SAMPLES=g.NUM_SAMPLES+"u"),g.REALTIME_FILTERING=!0):g.REALTIME_FILTERING=!1,g.INVERTCUBICMAP=y.coordinatesMode===z.c.INVCUBIC_MODE,g.REFLECTIONMAP_3D=y.isCube,g.REFLECTIONMAP_OPPOSITEZ=g.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!y.invertZ:y.invertZ,g.REFLECTIONMAP_CUBIC=!1,g.REFLECTIONMAP_EXPLICIT=!1,g.REFLECTIONMAP_PLANAR=!1,g.REFLECTIONMAP_PROJECTION=!1,g.REFLECTIONMAP_SKYBOX=!1,g.REFLECTIONMAP_SPHERICAL=!1,g.REFLECTIONMAP_EQUIRECTANGULAR=!1,g.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,g.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,y.coordinatesMode){case z.c.EXPLICIT_MODE:g.REFLECTIONMAP_EXPLICIT=!0;break;case z.c.PLANAR_MODE:g.REFLECTIONMAP_PLANAR=!0;break;case z.c.PROJECTION_MODE:g.REFLECTIONMAP_PROJECTION=!0;break;case z.c.SKYBOX_MODE:g.REFLECTIONMAP_SKYBOX=!0;break;case z.c.SPHERICAL_MODE:g.REFLECTIONMAP_SPHERICAL=!0;break;case z.c.EQUIRECTANGULAR_MODE:g.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case z.c.FIXED_EQUIRECTANGULAR_MODE:g.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case z.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:g.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case z.c.CUBIC_MODE:case z.c.INVCUBIC_MODE:default:g.REFLECTIONMAP_CUBIC=!0,g.USE_LOCAL_REFLECTIONMAP_CUBIC=!!y.boundingBoxSize}y.coordinatesMode!==z.c.SKYBOX_MODE&&(y.irradianceTexture?(g.USEIRRADIANCEMAP=!0,g.USESPHERICALFROMREFLECTIONMAP=!1):y.isCube&&(g.USESPHERICALFROMREFLECTIONMAP=!0,g.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||i.getCaps().maxVaryingVectors<=8?g.USESPHERICALINVERTEX=!1:g.USESPHERICALINVERTEX=!0))}else g.REFLECTION=!1,g.REFLECTIONMAP_3D=!1,g.REFLECTIONMAP_SPHERICAL=!1,g.REFLECTIONMAP_PLANAR=!1,g.REFLECTIONMAP_CUBIC=!1,g.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,g.REFLECTIONMAP_PROJECTION=!1,g.REFLECTIONMAP_SKYBOX=!1,g.REFLECTIONMAP_EXPLICIT=!1,g.REFLECTIONMAP_EQUIRECTANGULAR=!1,g.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,g.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,g.INVERTCUBICMAP=!1,g.USESPHERICALFROMREFLECTIONMAP=!1,g.USEIRRADIANCEMAP=!1,g.USESPHERICALINVERTEX=!1,g.REFLECTIONMAP_OPPOSITEZ=!1,g.LODINREFLECTIONALPHA=!1,g.GAMMAREFLECTION=!1,g.RGBDREFLECTION=!1,g.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&T.b.LightmapTextureEnabled?((0,m.R)(this._lightmapTexture,g,"LIGHTMAP"),g.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,g.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,g.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):g.LIGHTMAP=!1,this._emissiveTexture&&T.b.EmissiveTextureEnabled?((0,m.R)(this._emissiveTexture,g,"EMISSIVE"),g.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):g.EMISSIVE=!1,T.b.SpecularTextureEnabled?(this._metallicTexture?((0,m.R)(this._metallicTexture,g,"REFLECTIVITY"),g.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,g.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,g.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,g.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,g.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,m.R)(this._reflectivityTexture,g,"REFLECTIVITY"),g.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,g.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,g.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):g.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(g.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,m.R)(this._metallicReflectanceTexture,g,"METALLIC_REFLECTANCE"),g.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):g.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,m.R)(this._reflectanceTexture,g,"REFLECTANCE"),g.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):g.REFLECTANCE=!1):(g.METALLIC_REFLECTANCE=!1,g.REFLECTANCE=!1),this._microSurfaceTexture?(0,m.R)(this._microSurfaceTexture,g,"MICROSURFACEMAP"):g.MICROSURFACEMAP=!1):(g.REFLECTIVITY=!1,g.MICROSURFACEMAP=!1),i.getCaps().standardDerivatives&&this._bumpTexture&&T.b.BumpTextureEnabled&&!this._disableBumpMap?((0,m.R)(this._bumpTexture,g,"BUMP"),this._useParallax&&this._albedoTexture&&T.b.DiffuseTextureEnabled?(g.PARALLAX=!0,g.PARALLAX_RHS=k.useRightHandedSystem,g.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):g.PARALLAX=!1,g.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(g.BUMP=!1,g.PARALLAX=!1,g.PARALLAX_RHS=!1,g.PARALLAXOCCLUSION=!1,g.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&T.b.ReflectionTextureEnabled?(g.ENVIRONMENTBRDF=!0,g.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(g.ENVIRONMENTBRDF=!1,g.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?g.ALPHAFROMALBEDO=!0:g.ALPHAFROMALBEDO=!1}g.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===V.LIGHTFALLOFF_STANDARD?(g.USEPHYSICALLIGHTFALLOFF=!1,g.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===V.LIGHTFALLOFF_GLTF?(g.USEPHYSICALLIGHTFALLOFF=!1,g.USEGLTFLIGHTFALLOFF=!0):(g.USEPHYSICALLIGHTFALLOFF=!0,g.USEGLTFLIGHTFALLOFF=!1),g.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.oh&&this._twoSidedLighting?g.TWOSIDEDLIGHTING=!0:g.TWOSIDEDLIGHTING=!1,g.SPECULARAA=i.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(g._areTexturesDirty||g._areMiscDirty)&&(g.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,g.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,g.ALPHABLEND=this.needAlphaBlendingForMesh(y),g.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,g.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),g._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(g),g.FORCENORMALFORWARD=this._forceNormalForward,g.RADIANCEOCCLUSION=this._useRadianceOcclusion,g.HORIZONOCCLUSION=this._useHorizonOcclusion,g._areMiscDirty&&((0,m.S)(y,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(y)||this._forceAlphaTest,g,this._applyDecalMapAfterDetailMap),g.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!y.isVerticesDataPresent(c.c.NormalKind),g.DEBUGMODE=this._debugMode),(0,m.L)(k,i,this,g,!!f,p,S),this._eventInfo.defines=g,this._eventInfo.mesh=y,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,m.K)(y,g,!0,!0,!0,this._transparencyMode!==V.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(y,g,f){const p={clipPlane:!1,useInstances:!1,...f};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const f=new J(this._eventInfo.defineNames),S=this._prepareEffect(y,f,void 0,void 0,p.useInstances,p.clipPlane,y.hasThinInstances);this._onEffectCreatedObservable&&(A.effect=S,A.subMesh=null,this._onEffectCreatedObservable.notifyObservers(A)),S.isReady()?g&&g(this):S.onCompileObservable.add((()=>{g&&g(this)}))})()}buildUniformLayout(){const y=this._uniformBuffer;y.addUniform("vAlbedoInfos",2),y.addUniform("vAmbientInfos",4),y.addUniform("vOpacityInfos",2),y.addUniform("vEmissiveInfos",2),y.addUniform("vLightmapInfos",2),y.addUniform("vReflectivityInfos",3),y.addUniform("vMicroSurfaceSamplerInfos",2),y.addUniform("vReflectionInfos",2),y.addUniform("vReflectionFilteringInfo",2),y.addUniform("vReflectionPosition",3),y.addUniform("vReflectionSize",3),y.addUniform("vBumpInfos",3),y.addUniform("albedoMatrix",16),y.addUniform("ambientMatrix",16),y.addUniform("opacityMatrix",16),y.addUniform("emissiveMatrix",16),y.addUniform("lightmapMatrix",16),y.addUniform("reflectivityMatrix",16),y.addUniform("microSurfaceSamplerMatrix",16),y.addUniform("bumpMatrix",16),y.addUniform("vTangentSpaceParams",2),y.addUniform("reflectionMatrix",16),y.addUniform("vReflectionColor",3),y.addUniform("vAlbedoColor",4),y.addUniform("vLightingIntensity",4),y.addUniform("vReflectionMicrosurfaceInfos",3),y.addUniform("pointSize",1),y.addUniform("vReflectivityColor",4),y.addUniform("vEmissiveColor",3),y.addUniform("vAmbientColor",3),y.addUniform("vDebugMode",2),y.addUniform("vMetallicReflectanceFactors",4),y.addUniform("vMetallicReflectanceInfos",2),y.addUniform("metallicReflectanceMatrix",16),y.addUniform("vReflectanceInfos",2),y.addUniform("reflectanceMatrix",16),y.addUniform("vSphericalL00",3),y.addUniform("vSphericalL1_1",3),y.addUniform("vSphericalL10",3),y.addUniform("vSphericalL11",3),y.addUniform("vSphericalL2_2",3),y.addUniform("vSphericalL2_1",3),y.addUniform("vSphericalL20",3),y.addUniform("vSphericalL21",3),y.addUniform("vSphericalL22",3),y.addUniform("vSphericalX",3),y.addUniform("vSphericalY",3),y.addUniform("vSphericalZ",3),y.addUniform("vSphericalXX_ZZ",3),y.addUniform("vSphericalYY_ZZ",3),y.addUniform("vSphericalZZ",3),y.addUniform("vSphericalXY",3),y.addUniform("vSphericalYZ",3),y.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(y,g,f){const p=this.va(),S=f.materialDefines;if(!S)return;const k=f.effect;if(!k)return;this._activeEffect=k,g.getMeshUniformBuffer().bindToEffect(k,"Mesh"),g.transferToEffect(y);const i=p.getEngine();this._uniformBuffer.bindToEffect(k,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,p,g,y,this.isFrozen),F.d.Bind(i.currentRenderPassId,this._activeEffect,g,y),this._eventInfo.subMesh=f,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),S.OBJECTSPACE_NORMALMAP&&(y.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const H=this._mustRebind(p,k,f,g.visibility);(0,m.e)(g,this._activeEffect,this.prePassConfiguration);let l=null;const c=this._uniformBuffer;if(H){if(this.bindViewProjection(k),l=this._getReflectionTexture(),!c.useUbo||!this.isFrozen||!c.isSync||f._drawWrapper._forceRebindOnNextCall){var Z;if(p.texturesEnabled){if(this._albedoTexture&&T.b.DiffuseTextureEnabled&&(c.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,m.u)(this._albedoTexture,c,"albedo")),this._ambientTexture&&T.b.AmbientTextureEnabled&&(c.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,m.u)(this._ambientTexture,c,"ambient")),this._opacityTexture&&T.b.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,m.u)(this._opacityTexture,c,"opacity")),l&&T.b.ReflectionTextureEnabled){if(c.Lj("reflectionMatrix",l.getReflectionTextureMatrix()),c.updateFloat2("vReflectionInfos",l.level,0),l.boundingBoxSize){const y=l;c.updateVector3("vReflectionPosition",y.boundingBoxPosition),c.updateVector3("vReflectionSize",y.boundingBoxSize)}if(this.realTimeFiltering){const y=l.getSize().width;c.updateFloat2("vReflectionFilteringInfo",y,Math.log2(y))}if(!S.USEIRRADIANCEMAP){const y=l.sphericalPolynomial;if(S.USESPHERICALFROMREFLECTIONMAP&&y)if(S.SPHERICAL_HARMONICS){const g=y.preScaledHarmonics;c.updateVector3("vSphericalL00",g.l00),c.updateVector3("vSphericalL1_1",g.l1_1),c.updateVector3("vSphericalL10",g.l10),c.updateVector3("vSphericalL11",g.l11),c.updateVector3("vSphericalL2_2",g.l2_2),c.updateVector3("vSphericalL2_1",g.l2_1),c.updateVector3("vSphericalL20",g.l20),c.updateVector3("vSphericalL21",g.l21),c.updateVector3("vSphericalL22",g.l22)}else c.updateFloat3("vSphericalX",y.x.x,y.x.y,y.x.z),c.updateFloat3("vSphericalY",y.y.x,y.y.y,y.y.z),c.updateFloat3("vSphericalZ",y.z.x,y.z.y,y.z.z),c.updateFloat3("vSphericalXX_ZZ",y.xx.x-y.zz.x,y.xx.y-y.zz.y,y.xx.z-y.zz.z),c.updateFloat3("vSphericalYY_ZZ",y.yy.x-y.zz.x,y.yy.y-y.zz.y,y.yy.z-y.zz.z),c.updateFloat3("vSphericalZZ",y.zz.x,y.zz.y,y.zz.z),c.updateFloat3("vSphericalXY",y.xy.x,y.xy.y,y.xy.z),c.updateFloat3("vSphericalYZ",y.yz.x,y.yz.y,y.yz.z),c.updateFloat3("vSphericalZX",y.zx.x,y.zx.y,y.zx.z)}c.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset)}this._emissiveTexture&&T.b.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,m.u)(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&T.b.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,m.u)(this._lightmapTexture,c,"lightmap")),T.b.SpecularTextureEnabled&&(this._metallicTexture?(c.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,m.u)(this._metallicTexture,c,"reflectivity")):this._reflectivityTexture&&(c.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,m.u)(this._reflectivityTexture,c,"reflectivity")),this._metallicReflectanceTexture&&(c.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,m.u)(this._metallicReflectanceTexture,c,"metallicReflectance")),this._reflectanceTexture&&S.REFLECTANCE&&(c.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,m.u)(this._reflectanceTexture,c,"reflectance")),this._microSurfaceTexture&&(c.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,m.u)(this._microSurfaceTexture,c,"microSurfaceSampler"))),this._bumpTexture&&i.getCaps().standardDerivatives&&T.b.BumpTextureEnabled&&!this._disableBumpMap&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,m.u)(this._bumpTexture,c,"bump"),p._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),S.METALLICWORKFLOW){var C;P.j.hb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,P.j.hb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,c.updateColor4("vReflectivityColor",P.j.hb[0],1);const y=(null===(C=this.subSurface)||void 0===C?void 0:C._indexOfRefraction)??1.5,g=1,f=Math.pow((y-g)/(y+g),2);this._metallicReflectanceColor.scaleToRef(f*this._metallicF0Factor,P.j.hb[0]);const p=this._metallicF0Factor;c.updateColor4("vMetallicReflectanceFactors",P.j.hb[0],p)}else c.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);c.updateColor3("vEmissiveColor",T.b.EmissiveTextureEnabled?this._emissiveColor:P.c.BlackReadOnly),c.updateColor3("vReflectionColor",this._reflectionColor),!S.SS_REFRACTION&&null!==(Z=this.subSurface)&&void 0!==Z&&Z._linkRefractionWithTransparency?c.updateColor4("vAlbedoColor",this._albedoColor,1):c.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*p.environmentIntensity,this._lightingInfos.w=this._specularIntensity,c.updateVector4("vLightingIntensity",this._lightingInfos),p.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),c.updateColor3("vAmbientColor",this._globalAmbientColor),c.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}p.texturesEnabled&&(this._albedoTexture&&T.b.DiffuseTextureEnabled&&c.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&T.b.AmbientTextureEnabled&&c.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&T.b.OpacityTextureEnabled&&c.setTexture("opacitySampler",this._opacityTexture),l&&T.b.ReflectionTextureEnabled&&(S.LODBASEDMICROSFURACE?c.setTexture("reflectionSampler",l):(c.setTexture("reflectionSampler",l._lodTextureMid||l),c.setTexture("reflectionSamplerLow",l._lodTextureLow||l),c.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l)),S.USEIRRADIANCEMAP&&c.setTexture("irradianceSampler",l.irradianceTexture)),S.ENVIRONMENTBRDF&&c.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&T.b.EmissiveTextureEnabled&&c.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&T.b.LightmapTextureEnabled&&c.setTexture("lightmapSampler",this._lightmapTexture),T.b.SpecularTextureEnabled&&(this._metallicTexture?c.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&c.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&c.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&S.REFLECTANCE&&c.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&c.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&i.getCaps().standardDerivatives&&T.b.BumpTextureEnabled&&!this._disableBumpMap&&c.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(g)&&this.va().depthPeelingRenderer.bind(k),this._eventInfo.subMesh=f,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,u.g)(this._activeEffect,this,p),this.bindEyePosition(k)}else p.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(H||!this.isFrozen){var q;if(p.lightsEnabled&&!this._disableLighting&&(0,m.m)(p,g,this._activeEffect,S,this._maxSimultaneousLights),(p.fogEnabled&&g.applyFog&&p.fogMode!==U.e.FOGMODE_NONE||l||this.subSurface.refractionTexture||g.receiveShadows||S.PREPASS)&&this.bindView(k),(0,m.i)(p,g,this._activeEffect,!0),S.NUM_MORPH_INFLUENCERS&&(0,m.s)(g,this._activeEffect),S.BAKED_VERTEX_ANIMATION_TEXTURE)null===(q=g.bakedVertexAnimationManager)||void 0===q||q.bind(k,S.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,m.q)(S,this._activeEffect,p)}this._afterBind(g,this._activeEffect,f),c.update()}getAnimatables(){const y=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&y.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&y.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&y.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&y.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&y.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?y.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&y.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&y.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&y.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&y.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&y.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&y.push(this._microSurfaceTexture),y}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const y=super.getActiveTextures();return this._albedoTexture&&y.push(this._albedoTexture),this._ambientTexture&&y.push(this._ambientTexture),this._opacityTexture&&y.push(this._opacityTexture),this._reflectionTexture&&y.push(this._reflectionTexture),this._emissiveTexture&&y.push(this._emissiveTexture),this._reflectivityTexture&&y.push(this._reflectivityTexture),this._metallicTexture&&y.push(this._metallicTexture),this._metallicReflectanceTexture&&y.push(this._metallicReflectanceTexture),this._reflectanceTexture&&y.push(this._reflectanceTexture),this._microSurfaceTexture&&y.push(this._microSurfaceTexture),this._bumpTexture&&y.push(this._bumpTexture),this._lightmapTexture&&y.push(this._lightmapTexture),y}hasTexture(y){return!!super.hasTexture(y)||(this._albedoTexture===y||(this._ambientTexture===y||(this._opacityTexture===y||(this._reflectionTexture===y||(this._emissiveTexture===y||(this._reflectivityTexture===y||(this._metallicTexture===y||(this._metallicReflectanceTexture===y||(this._reflectanceTexture===y||(this._microSurfaceTexture===y||(this._bumpTexture===y||this._lightmapTexture===y)))))))))))}setPrePassRenderer(){var y;if(null===(y=this.subSurface)||void 0===y||!y.isScatteringEnabled)return!1;const g=this.va().enableSubSurfaceForPrePass();return g&&(g.enabled=!0),!0}dispose(y,g){var f,p,S,k,i,H,U,l,c,Z,C,q;(this._breakShaderLoadedCheck=!0,g)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(f=this._albedoTexture)||void 0===f||f.dispose(),null===(p=this._ambientTexture)||void 0===p||p.dispose(),null===(S=this._opacityTexture)||void 0===S||S.dispose(),null===(k=this._reflectionTexture)||void 0===k||k.dispose(),null===(i=this._emissiveTexture)||void 0===i||i.dispose(),null===(H=this._metallicTexture)||void 0===H||H.dispose(),null===(U=this._reflectivityTexture)||void 0===U||U.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(c=this._lightmapTexture)||void 0===c||c.dispose(),null===(Z=this._metallicReflectanceTexture)||void 0===Z||Z.dispose(),null===(C=this._reflectanceTexture)||void 0===C||C.dispose(),null===(q=this._microSurfaceTexture)||void 0===q||q.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(y,g)}}V.PBRMATERIAL_OPAQUE=R.c.MATERIAL_OPAQUE,V.PBRMATERIAL_ALPHATEST=R.c.MATERIAL_ALPHATEST,V.PBRMATERIAL_ALPHABLEND=R.c.MATERIAL_ALPHABLEND,V.PBRMATERIAL_ALPHATESTANDBLEND=R.c.MATERIAL_ALPHATESTANDBLEND,V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,V.LIGHTFALLOFF_PHYSICAL=0,V.LIGHTFALLOFF_GLTF=1,V.LIGHTFALLOFF_STANDARD=2,V.ForceGLSL=!1,(0,p.c)([(0,S.t)()],V.prototype,"_imageProcessingConfiguration",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsMiscDirty")],V.prototype,"debugMode",void 0)},10860:(y,g,f)=>{"use strict";f.d(g,{e:()=>i});var p=f(10736);const S=new Map;function k(y,g){(function(y){return S.delete(y)})(y)&&p.d.Warn(`Extension with the name '${name}' already exists`),S.set(y,g)}function i(y,g){"image/ktx"!==g&&"image/ktx2"!==g||(y=".ktx"),S.has(y)||(y.endsWith(".dds")&&k(".dds",(()=>f.e(12).then(f.bind(f,13017)).then((y=>new y._DDSTextureLoader)))),y.endsWith(".basis")&&k(".basis",(()=>f.e(13).then(f.bind(f,13020)).then((y=>new y._BasisTextureLoader)))),y.endsWith(".env")&&k(".env",(()=>f.e(14).then(f.bind(f,13027)).then((y=>new y._ENVTextureLoader)))),y.endsWith(".hdr")&&k(".hdr",(()=>f.e(15).then(f.bind(f,13036)).then((y=>new y._HDRTextureLoader)))),(y.endsWith(".ktx")||y.endsWith(".ktx2"))&&(k(".ktx",(()=>f.e(16).then(f.bind(f,13040)).then((y=>new y._KTXTextureLoader)))),k(".ktx2",(()=>f.e(16).then(f.bind(f,13040)).then((y=>new y._KTXTextureLoader))))),y.endsWith(".tga")&&k(".tga",(()=>f.e(17).then(f.bind(f,13042)).then((y=>new y._TGATextureLoader)))),y.endsWith(".exr")&&k(".exr",(()=>f.e(18).then(f.bind(f,13046)).then((y=>new y._ExrTextureLoader)))));const p=S.get(y);return p?Promise.resolve(p(g)):null}},11271:(y,g,f)=>{"use strict";f.d(g,{c:()=>C});var p=f(11021),S=f(11026),k=f(10723),i=f(11054),H=f(10761),U=f(10878),l=(f(10766),f(11274));class c{get wrapU(){return this._wrapU}set wrapU(y){this._wrapU=y}get wrapV(){return this._wrapV}set wrapV(y){this._wrapV=y}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(y){this._texture&&(this._texture.isCube=y)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(y){this._texture&&(this._texture.is3D=y)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(y){this._texture&&(this._texture.is2DArray=y)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(y){return void 0!==(null===y||void 0===y?void 0:y.shareDepth)}constructor(y){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=l.e.Zero(),this._cachedBaseSize=l.e.Zero(),this._initialSamplingMode=2,this._texture=c._IsRenderTargetWrapper(y)?y.texture:y,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(y){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(y,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var Z=f(11099);class C extends c{set Be(y){this._hasAlpha!==y&&(this._hasAlpha=y,this._scene&&this._scene.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))))}get Be(){return this._hasAlpha}set getAlphaFromRGB(y){this._getAlphaFromRGB!==y&&(this._getAlphaFromRGB=y,this._scene&&this._scene.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(y){this._coordinatesIndex!==y&&(this._coordinatesIndex=y,this._scene&&this._scene.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(y){this._coordinatesMode!==y&&(this._coordinatesMode=y,this._scene&&this._scene.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(y){this._wrapU=y}get wrapV(){return this._wrapV}set wrapV(y){this._wrapV=y}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(y){this._texture?this._texture.isCube=y:this._isCube=y}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(y){this._texture&&(this._texture.is3D=y)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(y){this._texture&&(this._texture.is2DArray=y)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(y){var g;if(this._texture){if(this._texture._gammaSpace===y)return;this._texture._gammaSpace=y}else{if(this._gammaSpace===y)return;this._gammaSpace=y}null===(g=this.va())||void 0===g||g.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(y){var g;y!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=y),null===(g=this.va())||void 0===g||g.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(y){this._texture&&(this._texture._lodGenerationOffset=y)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(y){this._texture&&(this._texture._lodGenerationScale=y)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(y){this._texture&&(this._texture._linearSpecularLOD=y)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(y){this._texture&&(this._texture._irradianceTexture=y)}get uid(){return this._uid||(this._uid=(0,U.e)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(y){this._onDisposeObserver&&this.nj.remove(this._onDisposeObserver),this._onDisposeObserver=this.nj.add(y)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=C.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.nj=new k.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,y?C._IsScene(y)?this._scene=y:this._engine=y:this._scene=H.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=g,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return i.c.IdentityReadOnly}getReflectionTextureMatrix(){return i.c.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(y){}get canRescale(){return!1}_getFromCache(y,g,f,p,S,k){const i=this._getEngine();if(!i)return null;const H=i._getUseSRGBBuffer(!!S,g),U=i.getLoadedTexturesCache();for(let l=0;l<U.length;l++){const i=U[l];if((void 0===S||H===i._useSRGBBuffer)&&(void 0===p||p===i.invertY)&&i.url===y&&i.generateMipMaps===!g&&(!f||f===i.samplingMode)&&(void 0===k||k===i.isCube))return i.incrementReferences(),i}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const y=this.va();y&&y.markAllMaterialsAsDirty(1)}readPixels(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const l=this._getEngine();if(!l)return null;const c=this.getSize();let Z=c.width,C=c.height;0!==g&&(Z/=Math.pow(2,g),C/=Math.pow(2,g),Z=Math.round(Z),C=Math.round(C)),H=Math.min(Z,H),U=Math.min(C,U);try{return this._texture.isCube?l._readTexturePixels(this._texture,H,U,y,g,f,p,S,k,i):l._readTexturePixels(this._texture,H,U,-1,g,f,p,S,k,i)}catch(q){return null}}_readPixelsSync(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const k=this.getSize();let i=k.width,H=k.height;const U=this._getEngine();if(!U)return null;0!=g&&(i/=Math.pow(2,g),H/=Math.pow(2,g),i=Math.round(i),H=Math.round(H));try{return this._texture.isCube?U._readTexturePixelsSync(this._texture,i,H,y,g,f,p,S):U._readTexturePixelsSync(this._texture,i,H,-1,g,f,p,S)}catch(l){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const y=this._scene.textures.indexOf(this);if(y>=0&&this._scene.textures.splice(y,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const y=this._parentContainer.textures.indexOf(this);y>-1&&this._parentContainer.textures.splice(y,1),this._parentContainer=null}}this.nj.notifyObservers(this),this.nj.clear(),this.metadata=null,super.dispose()}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!y)return null;const g=Z.c.Serialize(this);return Z.c.AppendSerializedAnimations(this,g),g}static WhenAllReady(y,g){let f=y.length;if(0!==f)for(let p=0;p<y.length;p++){const S=y[p];if(S.isReady())0===--f&&g();else{const y=S.onLoadObservable;y?y.addOnce((()=>{0===--f&&g()})):0===--f&&g()}}else g()}static _IsScene(y){return"Scene"===y.getClassName()}}C.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,p.c)([(0,S.I)()],C.prototype,"uniqueId",void 0),(0,p.c)([(0,S.I)()],C.prototype,"name",void 0),(0,p.c)([(0,S.I)()],C.prototype,"metadata",void 0),(0,p.c)([(0,S.I)("Be")],C.prototype,"_hasAlpha",void 0),(0,p.c)([(0,S.I)("getAlphaFromRGB")],C.prototype,"_getAlphaFromRGB",void 0),(0,p.c)([(0,S.I)()],C.prototype,"level",void 0),(0,p.c)([(0,S.I)("coordinatesIndex")],C.prototype,"_coordinatesIndex",void 0),(0,p.c)([(0,S.I)()],C.prototype,"optimizeUVAllocation",void 0),(0,p.c)([(0,S.I)("coordinatesMode")],C.prototype,"_coordinatesMode",void 0),(0,p.c)([(0,S.I)()],C.prototype,"wrapU",null),(0,p.c)([(0,S.I)()],C.prototype,"wrapV",null),(0,p.c)([(0,S.I)()],C.prototype,"wrapR",void 0),(0,p.c)([(0,S.I)()],C.prototype,"anisotropicFilteringLevel",void 0),(0,p.c)([(0,S.I)()],C.prototype,"isCube",null),(0,p.c)([(0,S.I)()],C.prototype,"is3D",null),(0,p.c)([(0,S.I)()],C.prototype,"is2DArray",null),(0,p.c)([(0,S.I)()],C.prototype,"gammaSpace",null),(0,p.c)([(0,S.I)()],C.prototype,"invertZ",void 0),(0,p.c)([(0,S.I)()],C.prototype,"lodLevelInAlpha",void 0),(0,p.c)([(0,S.I)()],C.prototype,"lodGenerationOffset",null),(0,p.c)([(0,S.I)()],C.prototype,"lodGenerationScale",null),(0,p.c)([(0,S.I)()],C.prototype,"linearSpecularLOD",null),(0,p.c)([(0,S.E)()],C.prototype,"irradianceTexture",null),(0,p.c)([(0,S.I)()],C.prototype,"isRenderTarget",void 0)},12270:(y,g,f)=>{"use strict";var p=f(11572),S=f(11271);S.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(S.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=p.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((y=>{this._texture._sphericalPolynomial=y,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(y){this._texture&&(this._texture._sphericalPolynomial=y)},enumerable:!0,configurable:!0})},12306:(y,g,f)=>{"use strict";f.d(g,{b:()=>C});var p=f(11021),S=f(11026),k=f(10714),i=f(11054),H=f(11271),U=f(11267),l=f(10871),c=f(10723),Z=f(11099);f(11607);class C extends H.c{set boundingBoxSize(y){if(this._boundingBoxSize&&this._boundingBoxSize.equals(y))return;this._boundingBoxSize=y;const g=this.va();g&&g.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(y){this._rotationY=y,this.setReflectionTextureMatrix(i.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(y,g,f){let p="";return y.forEach((y=>p+=y)),new C(p,g,null,f,y)}static CreateFromPrefilteredData(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=g.useDelayedTextureLoading;g.useDelayedTextureLoading=!1;const k=new C(y,g,null,!1,null,null,null,void 0,!0,f,p);return g.useDelayedTextureLoading=S,k}constructor(y,g){var f;let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,W=arguments.length>10&&void 0!==arguments[10]&&arguments[10],j=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,R=arguments.length>14?arguments[14]:void 0;super(g),this.onLoadObservable=new c.d,this.boundingBoxPosition=i.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new i.c,this._buffer=null,this.name=y,this.url=y,this._noMipmap=S,this.Be=!1,this.isCube=!0,this._textureMatrix=i.c.Identity(),this.coordinatesMode=U.c.CUBIC_MODE;let G=null,z=null;null===p||Array.isArray(p)?(this._noMipmap=S,this._format=Z,this._createPolynomials=W,G=p,this._loaderOptions=B,this._useSRGBBuffer=R,this._lodScale=j,this._lodOffset=P):(G=p.extensions??null,this._noMipmap=p.noMipmap??!1,k=p.files??null,z=p.buffer??null,this._format=p.format??5,C=p.prefiltered??!1,q=p.forcedExtension??null,this._createPolynomials=p.createPolynomials??!1,this._lodScale=p.lodScale??.8,this._lodOffset=p.lodOffset??0,this._loaderOptions=p.loaderOptions,this._useSRGBBuffer=p.useSRGBBuffer,H=p.X??null,l=p.onError??null),(y||k)&&this.updateURL(y,q,H,C,l,G,null===(f=this.va())||void 0===f?void 0:f.useDelayedTextureLoading,k,z)}getClassName(){return"CubeTexture"}updateURL(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=y),this.url=y,g&&(this._forcedExtension=g);const l=y.lastIndexOf("."),c=g||(l>-1?y.substring(l).toLowerCase():""),Z=0===c.indexOf(".dds"),C=0===c.indexOf(".env"),q=0===c.indexOf(".basis");if(C?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=p,p&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),H)this._files=H;else if(q||C||Z||k||(k=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,k){for(let g=0;g<k.length;g++)this._files.push(y+k[g]);this._extensions=k}this._buffer=U,i?(this.delayLoadState=4,this._delayedOnLoad=f,this._delayedOnError=S):this._loadTexture(f,S)}delayLoad(y){4===this.delayLoadState&&(y&&(this._forcedExtension=y),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(y){var g,f;if(y.updateFlag===this._textureMatrix.updateFlag)return;y.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(f=this.va())||void 0===f||f.markAllMaterialsAsDirty(1,(y=>-1!==y.getActiveTextures().indexOf(this))));if(this._textureMatrix=y,null===(g=this.va())||void 0===g||!g.useRightHandedSystem)return;const p=i.j.o[0],S=i.j.Quaternion[0],k=i.j.o[1];this._textureMatrix.decompose(p,S,k),S.z*=-1,S.w*=-1,i.c.ComposeToRef(p,S,k,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var y;return null!==(y=this.va())&&void 0!==y&&y.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=this.va(),p=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const S=()=>{var g;(this.onLoadObservable.notifyObservers(this),p)&&(p.dispose(),null===(g=this.va())||void 0===g||g.markAllMaterialsAsDirty(1));y&&y()},i=(y,f)=>{this._loadingError=!0,this._errorObject={message:y,exception:f},g&&g(y,f),U.c.OnTextureLoadErrorObservable.notifyObservers(this)};var H;this._texture?this._texture.isReady?k.e.SetImmediate((()=>S())):this._texture.onLoadedObservable.add((()=>S())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,f,this._lodScale,this._lodOffset,y,i,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,f,this._files,this._noMipmap,y,i,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(H=this._texture)||void 0===H||H.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(y,g,f){const p=Z.c.Parse((()=>{let p=!1;return y.prefiltered&&(p=y.prefiltered),new C(f+(y.url??y.name),g,y.extensions,!1,y.files||null,null,null,void 0,p,y.forcedExtension)}),y,g);if(y.boundingBoxPosition&&(p.boundingBoxPosition=i.m.eh(y.boundingBoxPosition)),y.boundingBoxSize&&(p.boundingBoxSize=i.m.eh(y.boundingBoxSize)),y.animations)for(let S=0;S<y.animations.length;S++){const g=y.animations[S],f=(0,l.b)("BABYLON.Animation");f&&p.animations.push(f.Parse(g))}return p}clone(){let y=0;const g=Z.c.Clone((()=>{const g=new C(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return y=g.uniqueId,g}),this);return g.uniqueId=y,g}}(0,p.c)([(0,S.I)()],C.prototype,"url",void 0),(0,p.c)([(0,S.H)()],C.prototype,"boundingBoxPosition",void 0),(0,p.c)([(0,S.H)()],C.prototype,"boundingBoxSize",null),(0,p.c)([(0,S.I)("rotationY")],C.prototype,"rotationY",null),(0,p.c)([(0,S.I)("files")],C.prototype,"_files",void 0),(0,p.c)([(0,S.I)("forcedExtension")],C.prototype,"_forcedExtension",void 0),(0,p.c)([(0,S.I)("extensions")],C.prototype,"_extensions",void 0),(0,p.c)([(0,S.v)("textureMatrix")],C.prototype,"_textureMatrix",void 0),(0,p.c)([(0,S.v)("textureMatrixRefraction")],C.prototype,"_textureMatrixRefraction",void 0),U.c._CubeTextureParser=C.Parse,(0,l.c)("BABYLON.CubeTexture",C)},12774:(y,g,f)=>{"use strict";f.d(g,{e:()=>U});var p=f(10736),S=f(11267),k=f(10882),i=f(11502),H=f(10845);i.ThinEngine.prototype.createDynamicTexture=function(y,g,f,p){const S=new H.d(this,4);return S.baseWidth=y,S.baseHeight=g,f&&(y=this.needPOTTextures?(0,k.i)(y,this._caps.maxTextureSize):y,g=this.needPOTTextures?(0,k.i)(g,this._caps.maxTextureSize):g),S.width=y,S.height=g,S.isReady=!1,S.generateMipMaps=f,S.samplingMode=p,this.updateTextureSamplingMode(p,S),this._internalTexturesCache.push(S),S},i.ThinEngine.prototype.updateDynamicTexture=function(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!y)return;const i=this._gl,H=i.TEXTURE_2D,U=this._bindTextureDirectly(H,y,!0,k);this._unpackFlipY(void 0===f?y.invertY:f),p&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const l=this._getWebGLTextureType(y.type),c=this._getInternalFormat(S||y.format),Z=this._getRGBABufferInternalSizedFormat(y.type,c);i.texImage2D(H,0,Z,c,l,g),y.generateMipMaps&&i.generateMipmap(H),U||this._bindTextureDirectly(H,null),p&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),S&&(y.format=S),y._dynamicTextureSource=g,y._premulAlpha=p,y.invertY=f||!1,y.isReady=!0};class U extends S.c{constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,H=arguments.length>6?arguments[6]:void 0;const U=!f||f._isScene;super(null,U?f:null===f||void 0===f?void 0:f.Oc,U?!p:f,H,k,void 0,void 0,void 0,void 0,i),this.name=y,this.wrapU=S.c.CLAMP_ADDRESSMODE,this.wrapV=S.c.CLAMP_ADDRESSMODE,this._generateMipMaps=p;const l=this._getEngine();if(!l)return;if(g.getContext)this._canvas=g,this._ownCanvas=!1,this._texture=l.createDynamicTexture(this._canvas.width,this._canvas.height,p,k);else{this._canvas=l.createCanvas(1,1),this._ownCanvas=!0;const y=g;y.width||0===y.width?this._texture=l.createDynamicTexture(y.width,y.height,p,k):this._texture=l.createDynamicTexture(g,g,p,k)}const c=this.getSize();this._canvas.width!==c.width&&(this._canvas.width=c.width),this._canvas.height!==c.height&&(this._canvas.height=c.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(y){this._canvas.width=y.width,this._canvas.height=y.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(y.width,y.height,this._generateMipMaps,this.samplingMode)}scale(y){const g=this.getSize();g.width*=y,g.height*=y,this._recreate(g)}scaleTo(y,g){const f=this.getSize();f.width=y,f.height=g,this._recreate(f)}getContext(){return this._context}clear(y){const g=this.getSize();y&&(this._context.fillStyle=y),this._context.clearRect(0,0,g.width,g.height)}update(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===y||y,g,this._format||void 0,void 0,f)}drawText(y,g,f,p,S,k,i){let H=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this.getSize();if(k&&(this._context.fillStyle=k,this._context.fillRect(0,0,U.width,U.height)),this._context.font=p,null===g||void 0===g){const f=this._context.measureText(y);g=(U.width-f.width)/2}if(null===f||void 0===f){const y=parseInt(p.replace(/\D/g,""));f=U.height/2+y/3.65}this._context.fillStyle=S||"",this._context.fillText(y,g,f),H&&this.update(i)}dispose(){var y,g;(super.dispose(),this._ownCanvas)&&(null===(y=this._canvas)||void 0===y||null===(g=y.remove)||void 0===g||g.call(y));this._canvas=null,this._context=null}clone(){const y=this.va();if(!y)return this;const g=this.getSize(),f=new U(this.name,g,y,this._generateMipMaps);return f.Be=this.Be,f.level=this.level,f.wrapU=this.wrapU,f.wrapV=this.wrapV,f}serialize(){const y=this.va();y&&!y.isReady()&&p.d.Warn("The scene must be ready before serializing the dynamic texture");const g=super.serialize();return U._IsCanvasElement(this._canvas)&&(g.base64String=this._canvas.toDataURL()),g.invertY=this._invertY,g.samplingMode=this.samplingMode,g}static _IsCanvasElement(y){return void 0!==y.toDataURL}_rebuild(){this.update()}}},10845:(y,g,f)=>{"use strict";f.d(g,{d:()=>i});var p,S=f(10723),k=f(10851);!function(y){y[y.Unknown=0]="Unknown",y[y.Url=1]="Url",y[y.Temp=2]="Temp",y[y.Raw=3]="Raw",y[y.Dynamic=4]="Dynamic",y[y.RenderTarget=5]="RenderTarget",y[y.MultiRenderTarget=6]="MultiRenderTarget",y[y.Cube=7]="Cube",y[y.CubeRaw=8]="CubeRaw",y[y.CubePrefiltered=9]="CubePrefiltered",y[y.Raw3D=10]="Raw3D",y[y.Raw2DArray=11]="Raw2DArray",y[y.DepthStencil=12]="DepthStencil",y[y.CubeRawRGBD=13]="CubeRawRGBD",y[y.Depth=14]="Depth"}(p||(p={}));class i extends k.b{get useMipMaps(){return this.generateMipMaps}set useMipMaps(y){this.generateMipMaps=y}get uniqueId(){return this._uniqueId}_setUniqueId(y){this._uniqueId=y}getEngine(){return this._engine}get source(){return this._source}constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new S.d,this.onErrorObservable=new S.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=y,this._source=g,this._uniqueId=i._Counter++,f||(this._hardwareTexture=y._createHardwareTexture())}incrementReferences(){this._references++}updateSize(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,y,g,f),this.width=y,this.height=g,this.depth=f,this.baseWidth=y,this.baseHeight=g,this.baseDepth=f,this._size=y*g*f}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const y=this.onRebuildCallback(this),g=g=>{g._swapAndDie(this,!1),this.isReady=y.isReady};return void(y.isAsync?y.proxy.then(g):g(y.proxy))}let y;switch(this.source){case 2:case 12:case 14:break;case 1:return void(y=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(y=>{y._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:y=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),y._swapAndDie(this,!1),this.isReady=!0;break;case 10:y=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),y._swapAndDie(this,!1),this.isReady=!0;break;case 11:y=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),y._swapAndDie(this,!1),this.isReady=!0;break;case 4:y=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),y._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(y=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{y._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:y=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),y._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return y=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(y=>{y&&y._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(y._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(y){var g;let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(g=this._hardwareTexture)||void 0===g||g.setUsage(y._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),y._hardwareTexture=this._hardwareTexture,f&&(y._isRGBD=this._isRGBD),this._lodTextureHigh&&(y._lodTextureHigh&&y._lodTextureHigh.dispose(),y._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(y._lodTextureMid&&y._lodTextureMid.dispose(),y._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(y._lodTextureLow&&y._lodTextureLow.dispose(),y._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(y._irradianceTexture&&y._irradianceTexture.dispose(),y._irradianceTexture=this._irradianceTexture);const p=this._engine.getLoadedTexturesCache();let S=p.indexOf(this);-1!==S&&p.splice(S,1),S=p.indexOf(y),-1===S&&p.push(y)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}i._Counter=0},11521:(y,g,f)=>{"use strict";f.d(g,{d:()=>S});var p=f(11267);class S extends p.c{constructor(y,g,f,S,k){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=arguments.length>9?arguments[9]:void 0,Z=arguments.length>10?arguments[10]:void 0;super(null,k,!i,H,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c),this.format=S,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==l||(U=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==l||(U=1),this._texture=this._engine.createRawTexture(y,g,f,S,i,H,U,null,l,c??0,Z??!1),this.wrapU=p.c.CLAMP_ADDRESSMODE,this.wrapV=p.c.CLAMP_ADDRESSMODE)}update(y){this._getEngine().updateRawTexture(this._texture,y,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const y=new S(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return y._texture=this._texture,this._texture.incrementReferences(),y}static CreateLuminanceTexture(y,g,f,p){return new S(y,g,f,1,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(y,g,f,p){return new S(y,g,f,2,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(y,g,f,p){return new S(y,g,f,0,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(y,g,f,p){return new S(y,g,f,4,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(y,g,f,p){return new S(y,g,f,5,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(y,g,f,p){return new S(y,g,f,5,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(y,g,f,k){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:p.c.TRILINEAR_SAMPLINGMODE;return new S(y,g,f,6,k,i,H,U,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(y,g,f,k){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:p.c.TRILINEAR_SAMPLINGMODE;return new S(y,g,f,6,k,i,H,U,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11896:(y,g,f)=>{"use strict";f.d(g,{e:()=>S});var p=f(11267);class S extends p.c{get depth(){return this._depth}constructor(y,g,f,S,k,i){let H=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:p.c.TRILINEAR_SAMPLINGMODE,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10?arguments[10]:void 0;super(null,i,!H,U),this.format=k,this._texture=i.getEngine().createRawTexture2DArray(y,g,f,S,k,H,U,l,null,c,Z),this._depth=S,this.is2DArray=!0}update(y){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,y,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(y,g,f,p,k){return new S(y,g,f,p,5,k,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11585:(y,g,f)=>{"use strict";f.d(g,{e:()=>C});var p=f(10723),S=f(11054),k=f(11267),i=f(11138),H=f(11145),U=f(11071),l=f(10882),c=f(10803),Z=f(10736);c.e.prototype.setDepthStencilTexture=function(y,g){this._engine.setDepthStencilTexture(this._samplers[y],this._uniforms[y],g,y)};class C extends k.c{get renderList(){return this._renderList}set renderList(y){this._renderList!==y&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),y&&(this._unObserveRenderList=(0,U.j)(y,this._renderListHasChanged)),this._renderList=y)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(y){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(y)}set onBeforeRender(y){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(y)}set onAfterRender(y){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(y)}set onClear(y){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(y)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(y,g){let f;f=Array.isArray(y)?y:[y];for(let p=0;p<f.length;++p)for(let y=0;y<this._renderPassIds.length;++y)f[p].setMaterialForRenderPass(this._renderPassIds[y],void 0!==g?Array.isArray(g)?g[y]:g:void 0)}get isMulti(){var y;return(null===(y=this._renderTarget)||void 0===y?void 0:y.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(y){if(this._boundingBoxSize&&this._boundingBoxSize.equals(y))return;this._boundingBoxSize=y;const g=this.va();g&&g.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var y;return(null===(y=this._renderTarget)||void 0===y?void 0:y._depthStencilTexture)??null}constructor(y,g,f){let i,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:k.c.TRILINEAR_SAMPLINGMODE,q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],W=arguments.length>9&&void 0!==arguments[9]&&arguments[9],j=arguments.length>10&&void 0!==arguments[10]&&arguments[10],P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,B=arguments.length>12&&void 0!==arguments[12]&&arguments[12],R=arguments.length>13?arguments[13]:void 0,G=arguments.length>14?arguments[14]:void 0,z=arguments.length>15&&void 0!==arguments[15]&&arguments[15],T=arguments.length>16&&void 0!==arguments[16]&&arguments[16],Q=!0;if("object"===typeof U){const y=U;U=!!y.generateMipMaps,l=y.doNotChangeAspectRatio??!0,c=y.type??0,Z=!!y.isCube,C=y.samplingMode??k.c.TRILINEAR_SAMPLINGMODE,q=y.generateDepthBuffer??!0,W=!!y.generateStencilBuffer,j=!!y.isMulti,P=y.format??5,B=!!y.delayAllocation,R=y.samples,G=y.creationFlags,z=!!y.noColorAttachment,T=!!y.useSRGBBuffer,i=y.colorAttachment,Q=y.gammaSpace??Q}if(super(null,f,!U,void 0,C,void 0,void 0,void 0,void 0,P),this._unObserveRenderList=null,this._renderListHasChanged=(y,g)=>{const f=this._renderList?this._renderList.length:0;var p;(0===g&&f>0||0===f)&&(null===(p=this.va())||void 0===p||p.meshes.forEach((y=>{y._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new p.d,this.onAfterUnbindObservable=new p.d,this.onBeforeRenderObservable=new p.d,this.onAfterRenderObservable=new p.d,this.onClearObservable=new p.d,this.onResizeObservable=new p.d,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=S.m.Zero(),this._dumpToolsLoading=!1,!(f=this.va()))return;const m=this.va().getEngine();this._gammaSpace=Q,this._coordinatesMode=k.c.PROJECTION_MODE,this.renderList=[],this.name=y,this.isRenderTarget=!0,this._initialSizeParameter=g,this._renderPassIds=[],this._isCubeData=Z,this._processSizeParameter(g),this.renderPassId=this._renderPassIds[0],this._resizeObserver=m.onResizeObservable.add((()=>{})),this._generateMipMaps=!!U,this._doNotChangeAspectRatio=l,this._renderingManager=new H.d(f),this._renderingManager._useSceneAutoClearSetup=!0,j||(this._renderTargetOptions={generateMipMaps:U,type:c,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:q,generateStencilBuffer:W,samples:R,creationFlags:G,noColorAttachment:z,useSRGBBuffer:T,colorAttachment:i,label:this.name},this.samplingMode===k.c.NEAREST_SAMPLINGMODE&&(this.wrapU=k.c.CLAMP_ADDRESSMODE,this.wrapV=k.c.CLAMP_ADDRESSMODE),B||(Z?(this._renderTarget=f.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=k.c.INVCUBIC_MODE,this._textureMatrix=S.c.Identity()):this._renderTarget=f.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==R&&(this.samples=R)))}createDepthStencilTexture(){var y;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,i=arguments.length>5?arguments[5]:void 0;null===(y=this._renderTarget)||void 0===y||y.createDepthStencilTexture(g,f,p,S,k,i)}_releaseRenderPassId(){if(this._scene){const y=this._scene.getEngine();for(let g=0;g<this._renderPassIds.length;++g)y.releaseRenderPassId(this._renderPassIds[g])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const y=this._scene.getEngine(),g=this._isCubeData?6:this.getRenderLayers()||1;for(let f=0;f<g;++f)this._renderPassIds[f]=y.createRenderPassId(`RenderTargetTexture - ${this.name}#${f}`)}_processSizeParameter(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(y.ratio){this._sizeRatio=y.ratio;const g=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(g.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(g.getRenderHeight(),this._sizeRatio)}}else this._size=y;g&&this._createRenderPassId()}get samples(){var y;return(null===(y=this._renderTarget)||void 0===y?void 0:y.samples)??this._samples}set samples(y){this._renderTarget&&(this._samples=this._renderTarget.setSamples(y))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(y){this._refreshRate=y,this.resetRefreshCounter()}addPostProcess(y){if(!this._postProcessManager){const y=this.va();if(!y)return;this._postProcessManager=new i.c(y),this._postProcesses=new Array}this._postProcesses.push(y),this._postProcesses[0].Xi=!1}clearPostProcesses(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(y)for(const y of this._postProcesses)y.dispose();this._postProcesses=[]}}removePostProcess(y){if(!this._postProcesses)return;const g=this._postProcesses.indexOf(y);-1!==g&&(this._postProcesses.splice(g,1),this._postProcesses.length>0&&(this._postProcesses[0].Xi=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const y=this._size.layers;if(y)return y;const g=this._size.depth;return g||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(y){const g=Math.max(1,this.getRenderSize()*y);this.resize(g)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(y){var g;const f=this.isCube;null===(g=this._renderTarget)||void 0===g||g.dispose(),this._renderTarget=null;const p=this.va();p&&(this._processSizeParameter(y,!1),this._renderTarget=f?p.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):p.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(y,g)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(f.bind(f,12300)).then((y=>this._dumpTools=y))),this._render(!1,!1,!0)}_render(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=this.va();if(!p)return f;const S=p.getEngine();if(void 0!==this.useCameraPostProcesses&&(y=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let y=0;y<this._waitingRenderList.length;y++){const g=this._waitingRenderList[y],f=p.getMeshById(g);f&&this.renderList.push(f)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const y=this.va();if(!y)return f;const g=y.meshes;for(let f=0;f<g.length;f++){const y=g[f];this.renderListPredicate(y)&&this.renderList.push(y)}}const k=S.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const i=this.activeCamera??p.activeCamera,H=p.activeCamera;i&&(i!==p.activeCamera&&(p.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(!0)),p.activeCamera=i),S.setViewport(i.rigParent?i.rigParent.viewport:i.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let U=f;if(f){p.getViewMatrix()||p.updateTransformMatrix();const y=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let k=0;k<y&&U;k++){let y=null;const g=this.renderList?this.renderList:p.getActiveMeshes().data,i=this.renderList?this.renderList.length:p.getActiveMeshes().length;S.currentRenderPassId=this._renderPassIds[k],this.onBeforeRenderObservable.notifyObservers(k),this.getCustomRenderList&&(y=this.getCustomRenderList(k,g,i)),y||(y=g),this._doNotChangeAspectRatio||p.updateTransformMatrix(!0);for(let p=0;p<y.length&&U;++p){const g=y[p];if(g.isEnabled()&&!g.isBlocked&&g.isVisible&&g.og)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(g,this.refreshRate,f)){U=!1;continue}}else if(!g.isReady(!0)){U=!1;continue}}this.onAfterRenderObservable.notifyObservers(k),(this.is2DArray||this.is3D||this.isCube)&&(p.incrementRenderId(),p.resetCachedMaterial())}const g=this.particleSystemList||p.uj;for(const f of g)f.isReady()||(U=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let l=0;l<6;l++)this._renderToTarget(l,y,g,void 0,i),p.incrementRenderId(),p.resetCachedMaterial();else this._renderToTarget(0,y,g,void 0,i);else for(let l=0;l<this.getRenderLayers();l++)this._renderToTarget(0,y,g,l,i),p.incrementRenderId(),p.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),S.currentRenderPassId=k,p.activeCamera=H,H&&(this.activeCamera&&this.activeCamera!==p.activeCamera&&p.setTransformMatrix(H.getViewMatrix(),H.getProjectionMatrix(!0)),S.setViewport(H.viewport)),p.resetCachedMaterial(),U}_bestReflectionRenderTargetDimension(y,g){const f=y*g,p=(0,l.r)(f+16384/(128+f));return Math.min((0,l.e)(y),p)}_prepareRenderingManager(y,g,f,p){const S=this.va();if(!S)return;this._renderingManager.reset();const k=S.getRenderId();for(let H=0;H<g;H++){const g=y[H];if(g&&!g.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(g,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!g.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!g._internalAbstractMeshDataInfo._currentLODIsUpToDate&&f&&(g._internalAbstractMeshDataInfo._currentLOD=S.customLODSelector?S.customLODSelector(g,f):g.getLOD(f),g._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!g._internalAbstractMeshDataInfo._currentLOD)continue;let y,i=g._internalAbstractMeshDataInfo._currentLOD;if(i!==g&&0!==i.billboardMode&&i.Sj(),i._preActivateForIntermediateRendering(k),y=!(!p||!f)&&0===(g.layerMask&f.layerMask),g.isEnabled()&&g.isVisible&&g.og&&!y){if(i!==g&&i._activate(k,!0),g._activate(k,!0)&&g.og.length){g.isAnInstance?g._internalAbstractMeshDataInfo._actAsRegularMesh&&(i=g):i._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,i._internalAbstractMeshDataInfo._isActiveIntermediate=!0,S._prepareSkeleton(i);for(let y=0;y<i.og.length;y++){const g=i.og[y];this._renderingManager.dispatch(g,i)}}g._postActivate()}}}const i=this.particleSystemList||S.uj;for(let H=0;H<i.length;H++){const y=i[H],g=y.j;y.isStarted()&&g&&(!g.position||g.isEnabled())&&this._renderingManager.dispatchParticles(y)}}_bindFrameBuffer(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=this.va();if(!f)return;const p=f.getEngine();this._renderTarget&&p.bindFramebuffer(this._renderTarget,this.isCube?y:void 0,void 0,void 0,this.ignoreCameraViewport,0,g)}_unbindFrameBuffer(y,g){this._renderTarget&&y.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(g)}))}_prepareFrame(y,g,f,p){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):p&&y.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(g,f)}_renderToTarget(y,g,f){var p,S;let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const H=this.va();if(!H)return;const U=H.getEngine();this._prepareFrame(H,y,k,g),null===(p=U._debugPushGroup)||void 0===p||p.call(U,`render to face #${y} layer #${k}`,2),this.is2DArray||this.is3D?(U.currentRenderPassId=this._renderPassIds[k],this.onBeforeRenderObservable.notifyObservers(k)):(U.currentRenderPassId=this._renderPassIds[y],this.onBeforeRenderObservable.notifyObservers(y));if(U.snapshotRendering&&1===U.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(U):this.skipInitialClear||U.clear(this.clearColor||H.clearColor,!0,!0,!0);else{var l;let p=null;const S=this.renderList?this.renderList:H.getActiveMeshes().data,c=this.renderList?this.renderList.length:H.getActiveMeshes().length;this.getCustomRenderList&&(p=this.getCustomRenderList(this.is2DArray||this.is3D?k:y,S,c)),p?this._prepareRenderingManager(p,p.length,i,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(S,c,i,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),p=S);for(const g of H._beforeRenderTargetClearStage)g.action(this,y,k);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(U):this.skipInitialClear||U.clear(this.clearColor||H.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||H.updateTransformMatrix(!0);for(const g of H._beforeRenderTargetDrawStage)g.action(this,y,k);this._renderingManager.render(this.customRenderFunction,p,this.renderParticles,this.renderSprites);for(const g of H._afterRenderTargetDrawStage)g.action(this,y,k);const C=(null===(l=this._texture)||void 0===l?void 0:l.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,y,this._postProcesses,this.ignoreCameraViewport):g&&H.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,y);for(const g of H._afterRenderTargetPostProcessStage)g.action(this,y,k);this._texture&&(this._texture.generateMipMaps=C),this._doNotChangeAspectRatio||H.updateTransformMatrix(!0),f&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),U):Z.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(S=U._debugPopGroup)||void 0===S||S.call(U,2),this._unbindFrameBuffer(U,y),this._texture&&this.isCube&&5===y&&U.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(y,g,f,p)}setRenderingAutoClearDepthStencil(y,g){this._renderingManager.setRenderingAutoClearDepthStencil(y,g),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const y=this.getSize(),g=new C(this.name,y,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return g.Be=this.Be,g.level=this.level,g.coordinatesMode=this.coordinatesMode,this.renderList&&(g.renderList=this.renderList.slice(0)),g}serialize(){if(!this.name)return null;const y=super.serialize();if(y.renderTargetSize=this.getRenderSize(),y.renderList=[],this.renderList)for(let g=0;g<this.renderList.length;g++)y.renderList.push(this.renderList[g].id);return y}disposeFramebufferObjects(){var y;null===(y=this._renderTarget)||void 0===y||y.dispose(!0)}releaseInternalTexture(){var y;null===(y=this._renderTarget)||void 0===y||y.releaseTextures(),this._texture=null}dispose(){var y;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const g=this.va();if(!g)return;let f=g.customRenderTargets.indexOf(this);f>=0&&g.customRenderTargets.splice(f,1);for(const p of g.cameras)f=p.customRenderTargets.indexOf(this),f>=0&&p.customRenderTargets.splice(f,1);null===(y=this._renderTarget)||void 0===y||y.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===C.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=C.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}C.REFRESHRATE_RENDER_ONCE=0,C.REFRESHRATE_RENDER_ONEVERYFRAME=1,C.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,k.c._CreateRenderTargetTexture=(y,g,f,p,S)=>new C(y,g,f,p)},11267:(y,g,f)=>{"use strict";f.d(g,{c:()=>G});var p=f(11021),S=f(11026),k=f(10723),i=f(11054),H=f(11271),U=f(10871),l=f(10755),c=f(10794),Z=f(10869),C=f(11181),q=f(10783);function W(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=g.width,S=g.height;if(y instanceof Float32Array){let g=y.byteLength/y.BYTES_PER_ELEMENT;const f=new Uint8Array(g);for(;--g>=0;){let p=y[g];p<0?p=0:p>1&&(p=1),f[g]=255*p}y=f}const k=document.createElement("canvas");k.width=p,k.height=S;const i=k.getContext("2d");if(!i)return null;const H=i.createImageData(p,S);if(H.data.set(y),i.putImageData(H,0,0),f){const y=document.createElement("canvas");y.width=p,y.height=S;const g=y.getContext("2d");return g?(g.translate(0,S),g.scale(1,-1),g.drawImage(k,0,0),y.toDataURL("image/png")):null}return k.toDataURL("image/png")}function j(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const p=y.getInternalTexture();if(!p)return null;const S=y._readPixelsSync(g,f);return S?W(S,y.getSize(),p.invertY):null}async function P(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const p=y.getInternalTexture();if(!p)return null;const S=await y.readPixels(g,f);return S?W(S,y.getSize(),p.invertY):null}var B=f(11283),R=f(11099);class G extends H.c{static _CreateVideoTexture(y,g,f){arguments.length>5&&void 0!==arguments[5]||G.TRILINEAR_SAMPLINGMODE;throw(0,l.b)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(y){this._isBlocking=y}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(y,g,f,p){let S,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:G.TRILINEAR_SAMPLINGMODE,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9?arguments[9]:void 0,q=arguments.length>10?arguments[10]:void 0,W=arguments.length>11?arguments[11]:void 0,j=arguments.length>12?arguments[12]:void 0,P=arguments.length>13?arguments[13]:void 0;super(g),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new k.d,this._isBlocking=!0,this.name=y||"",this.url=y;let R=!1,z=null,T=!0;"object"===typeof f&&null!==f?(S=f.noMipmap??!1,p=f.invertY??!B.d,i=f.samplingMode??G.TRILINEAR_SAMPLINGMODE,H=f.X??null,U=f.onError??null,l=f.buffer??null,Z=f.deleteBuffer??!1,C=f.format,q=f.mimeType,W=f.loaderOptions,j=f.creationFlags,R=f.useSRGBBuffer??!1,z=f.internalTexture??null,T=f.gammaSpace??T):S=!!f,this._gammaSpace=T,this._noMipmap=S,this._invertY=void 0===p?!B.d:p,this._initialSamplingMode=i,this._buffer=l,this._deleteBuffer=Z,this._mimeType=q,this._loaderOptions=W,this._creationFlags=j,this._useSRGBBuffer=R,this._forcedExtension=P,C&&(this._format=C);const Q=this.va(),m=this._getEngine();if(!m)return;m.onBeforeTextureInitObservable.notifyObservers(this);const a=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),H&&H(),!this.isBlocking&&Q&&Q.resetCachedMaterial()},w=(y,g)=>{this._loadingError=!0,this._errorObject={message:y,exception:g},U&&U(y,g),G.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!z)return this._delayedOnLoad=a,void(this._delayedOnError=w);if(this._texture=z??this._getFromCache(this.url,S,i,this._invertY,R,this.isCube),this._texture)if(this._texture.isReady)c.c.SetImmediate((()=>a()));else{const y=this._texture.onLoadedObservable.add(a);this._texture.onErrorObservable.add((g=>{var f;w(g.message,g.exception),null===(f=this._texture)||void 0===f||f.onLoadedObservable.remove(y)}))}else if(Q&&Q.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=a,this._delayedOnError=w;else{try{this._texture=m.createTexture(this.url,S,this._invertY,Q,i,a,w,this._buffer,void 0,this._format,this._forcedExtension,q,W,j,R)}catch(o){throw w("error loading",o),o}Z&&(this._buffer=null)}}updateURL(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(y=>y.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=y),this.url=y,this._buffer=g,this._forcedExtension=p,this.delayLoadState=4,f&&(this._delayedOnLoad=f),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const y=this.va();y&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?c.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=y.getEngine().createTexture(this.url,this._noMipmap,this._invertY,y,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(y,g,f,p){y*=this._cachedUScale,g*=this._cachedVScale,y-=this.uRotationCenter*this._cachedUScale,g-=this.vRotationCenter*this._cachedVScale,f-=this.wRotationCenter,i.m.TransformCoordinatesFromFloatsToRef(y,g,f,this._rowGenerationMatrix,p),p.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,p.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,p.z+=this.wRotationCenter}getTextureMatrix(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*y===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*y,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=i.c.Zero(),this._rowGenerationMatrix=new i.c,this._t0=i.m.Zero(),this._t1=i.m.Zero(),this._t2=i.m.Zero()),i.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(i.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,i.j.Matrix[0]),i.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,i.j.Matrix[1]),i.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,i.j.Matrix[2]),i.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,i.j.Matrix[3]),i.j.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(i.j.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(i.j.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(i.j.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.ti(this._t0),this._t2.ti(this._t0),i.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const g=this.va();if(!g)return this._cachedTextureMatrix;const f=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&f!==this._cachedIdentity3x2&&g.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const y=this.va();if(!y)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==G.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===y.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=i.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=i.c.Zero());const g=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case G.PLANAR_MODE:i.c.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case G.PROJECTION_MODE:{i.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const g=y.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=g.updateFlag,g.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:i.c.IdentityToRef(this._cachedReflectionTextureMatrix)}return g&&y.markAllMaterialsAsDirty(1,(y=>y.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const y={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return R.c.Clone((()=>new G(this._texture?this._texture.url:null,this.va(),y)),this)}serialize(){var y;const g=this.name;G.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const f=super.serialize(G._SerializeInternalTextureUniqueId);if(!f)return null;var p;((G.SerializeBuffers||G.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(f.base64String=this._buffer,f.name=f.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?f.base64String="data:image/png;base64,"+(0,q.k)(this._buffer):(G.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(f.base64String=!this._engine||this._engine._features.supportSyncTextureRead?j(this):P(this))),f.invertY=this._invertY,f.samplingMode=this.samplingMode,f._creationFlags=this._creationFlags,f._useSRGBBuffer=this._useSRGBBuffer,G._SerializeInternalTextureUniqueId)&&(f.internalTextureUniqueId=null===(p=this._texture)||void 0===p?void 0:p.uniqueId);return f.internalTextureLabel=null===(y=this._texture)||void 0===y?void 0:y.label,f.noMipmap=this._noMipmap,this.name=g,f}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(y,g,f){if(y.customType){const p=Z.e.Instantiate(y.customType).Parse(y,g,f);return y.samplingMode&&p.updateSamplingMode&&p._samplingMode&&p._samplingMode!==y.samplingMode&&p.updateSamplingMode(y.samplingMode),p}if(y.isCube&&!y.isRenderTarget)return G._CubeTextureParser(y,g,f);const p=void 0!==y.internalTextureUniqueId;if(!y.name&&!y.isRenderTarget&&!p)return null;let S;if(p){const f=g.getEngine().getLoadedTexturesCache();for(const g of f)if(g.uniqueId===y.internalTextureUniqueId){S=g;break}}const k=g=>{if(g&&g._texture&&(g._texture._cachedWrapU=null,g._texture._cachedWrapV=null,g._texture._cachedWrapR=null),y.samplingMode){const f=y.samplingMode;g&&g.samplingMode!==f&&g.updateSamplingMode(f)}if(g&&y.animations)for(let f=0;f<y.animations.length;f++){const p=y.animations[f],S=(0,U.b)("BABYLON.Animation");S&&g.animations.push(S.Parse(p))}g&&g._texture&&(p&&!S&&g._texture._setUniqueId(y.internalTextureUniqueId),g._texture.label=y.internalTextureLabel)};return R.c.Parse((()=>{let p=!0;if(y.noMipmap&&(p=!1),y.mirrorPlane){const f=G._CreateMirror(y.name,y.renderTargetSize,g,p);return f._waitingRenderList=y.renderList,f.mirrorPlane=C.b.eh(y.mirrorPlane),k(f),f}if(y.isRenderTarget){let f=null;if(y.isCube){if(g.reflectionProbes)for(let p=0;p<g.reflectionProbes.length;p++){const f=g.reflectionProbes[p];if(f.name===y.name)return f.cubeTexture}}else f=G._CreateRenderTargetTexture(y.name,y.renderTargetSize,g,p,y._creationFlags??0),f._waitingRenderList=y.renderList;return k(f),f}if(y.isVideo){const S=G._CreateVideoTexture(f+(y.url||y.name),f+(y.src||y.url),g,p,y.invertY,y.samplingMode,y.settings||{});return k(S),S}{let i;if(y.base64String&&!S)i=G.CreateFromBase64String(y.base64String,y.base64String,g,!p,y.invertY,y.samplingMode,(()=>{k(i)}),y._creationFlags??0,y._useSRGBBuffer??!1),i.name=y.name;else{let H;H=y.name&&(y.name.indexOf("://")>0||y.name.startsWith("data:"))?y.name:f+y.name,y.url&&(y.url.startsWith("data:")||G.UseSerializedUrlIfAny)&&(H=y.url);const U={noMipmap:!p,invertY:y.invertY,samplingMode:y.samplingMode,X:()=>{k(i)},internalTexture:S};i=new G(H,g,U)}return i}}),y,g)}static CreateFromBase64String(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:G.TRILINEAR_SAMPLINGMODE;return new G("data:"+g,f,p,S,k,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:G.TRILINEAR_SAMPLINGMODE,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,c=arguments.length>10?arguments[10]:void 0,Z=arguments.length>11?arguments[11]:void 0;return"data:"!==y.substring(0,5)&&(y="data:"+y),new G(y,f,S,k,i,H,U,g,p,l,void 0,void 0,c,Z)}}G.SerializeBuffers=!0,G.ForceSerializeBuffers=!1,G.OnTextureLoadErrorObservable=new k.d,G._SerializeInternalTextureUniqueId=!1,G._CubeTextureParser=(y,g,f)=>{throw(0,l.b)("CubeTexture")},G._CreateMirror=(y,g,f,p)=>{throw(0,l.b)("MirrorTexture")},G._CreateRenderTargetTexture=(y,g,f,p,S)=>{throw(0,l.b)("RenderTargetTexture")},G.NEAREST_SAMPLINGMODE=1,G.NEAREST_NEAREST_MIPLINEAR=8,G.BILINEAR_SAMPLINGMODE=2,G.LINEAR_LINEAR_MIPNEAREST=11,G.TRILINEAR_SAMPLINGMODE=3,G.LINEAR_LINEAR_MIPLINEAR=3,G.NEAREST_NEAREST_MIPNEAREST=4,G.NEAREST_LINEAR_MIPNEAREST=5,G.NEAREST_LINEAR_MIPLINEAR=6,G.NEAREST_LINEAR=7,G.NEAREST_NEAREST=1,G.LINEAR_NEAREST_MIPNEAREST=9,G.LINEAR_NEAREST_MIPLINEAR=10,G.LINEAR_LINEAR=2,G.LINEAR_NEAREST=12,G.EXPLICIT_MODE=0,G.SPHERICAL_MODE=1,G.PLANAR_MODE=2,G.CUBIC_MODE=3,G.PROJECTION_MODE=4,G.SKYBOX_MODE=5,G.INVCUBIC_MODE=6,G.EQUIRECTANGULAR_MODE=7,G.FIXED_EQUIRECTANGULAR_MODE=8,G.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,G.CLAMP_ADDRESSMODE=0,G.WRAP_ADDRESSMODE=1,G.MIRROR_ADDRESSMODE=2,G.UseSerializedUrlIfAny=!1,(0,p.c)([(0,S.I)()],G.prototype,"url",void 0),(0,p.c)([(0,S.I)()],G.prototype,"uOffset",void 0),(0,p.c)([(0,S.I)()],G.prototype,"vOffset",void 0),(0,p.c)([(0,S.I)()],G.prototype,"uScale",void 0),(0,p.c)([(0,S.I)()],G.prototype,"vScale",void 0),(0,p.c)([(0,S.I)()],G.prototype,"uAng",void 0),(0,p.c)([(0,S.I)()],G.prototype,"vAng",void 0),(0,p.c)([(0,S.I)()],G.prototype,"wAng",void 0),(0,p.c)([(0,S.I)()],G.prototype,"uRotationCenter",void 0),(0,p.c)([(0,S.I)()],G.prototype,"vRotationCenter",void 0),(0,p.c)([(0,S.I)()],G.prototype,"wRotationCenter",void 0),(0,p.c)([(0,S.I)()],G.prototype,"homogeneousRotationInUVTransform",void 0),(0,p.c)([(0,S.I)()],G.prototype,"isBlocking",null),(0,U.c)("BABYLON.Texture",G),R.c._TextureParser=G.Parse},10851:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{get wrapU(){return this._cachedWrapU}set wrapU(y){this._cachedWrapU=y}get wrapV(){return this._cachedWrapV}set wrapV(y){this._cachedWrapV=y}get wrapR(){return this._cachedWrapR}set wrapR(y){this._cachedWrapR=y}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(y){this._cachedAnisotropicFilteringLevel=y}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(y){this._comparisonFunction=y}get useMipMaps(){return this._useMipMaps}set useMipMaps(y){this._useMipMaps=y}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=y,this._cachedWrapV=g,this._cachedWrapR=f,this._cachedAnisotropicFilteringLevel=p,this.samplingMode=S,this._comparisonFunction=k,this}compareSampler(y){return this._cachedWrapU===y._cachedWrapU&&this._cachedWrapV===y._cachedWrapV&&this._cachedWrapR===y._cachedWrapR&&this._cachedAnisotropicFilteringLevel===y._cachedAnisotropicFilteringLevel&&this.samplingMode===y.samplingMode&&this._comparisonFunction===y._comparisonFunction&&this._useMipMaps===y._useMipMaps}}},11249:(y,g,f)=>{"use strict";function p(y){-1===y.indexOf("vClipPlane")&&y.push("vClipPlane"),-1===y.indexOf("vClipPlane2")&&y.push("vClipPlane2"),-1===y.indexOf("vClipPlane3")&&y.push("vClipPlane3"),-1===y.indexOf("vClipPlane4")&&y.push("vClipPlane4"),-1===y.indexOf("vClipPlane5")&&y.push("vClipPlane5"),-1===y.indexOf("vClipPlane6")&&y.push("vClipPlane6")}function S(y,g,f){const p=!!(y.clipPlane??g.clipPlane),S=!!(y.clipPlane2??g.clipPlane2),k=!!(y.clipPlane3??g.clipPlane3),i=!!(y.clipPlane4??g.clipPlane4),H=!!(y.clipPlane5??g.clipPlane5),U=!!(y.clipPlane6??g.clipPlane6);p&&f.push("#define CLIPPLANE"),S&&f.push("#define CLIPPLANE2"),k&&f.push("#define CLIPPLANE3"),i&&f.push("#define CLIPPLANE4"),H&&f.push("#define CLIPPLANE5"),U&&f.push("#define CLIPPLANE6")}function k(y,g,f){let p=!1;const S=!!(y.clipPlane??g.clipPlane),k=!!(y.clipPlane2??g.clipPlane2),i=!!(y.clipPlane3??g.clipPlane3),H=!!(y.clipPlane4??g.clipPlane4),U=!!(y.clipPlane5??g.clipPlane5),l=!!(y.clipPlane6??g.clipPlane6);return f.CLIPPLANE!==S&&(f.CLIPPLANE=S,p=!0),f.CLIPPLANE2!==k&&(f.CLIPPLANE2=k,p=!0),f.CLIPPLANE3!==i&&(f.CLIPPLANE3=i,p=!0),f.CLIPPLANE4!==H&&(f.CLIPPLANE4=H,p=!0),f.CLIPPLANE5!==U&&(f.CLIPPLANE5=U,p=!0),f.CLIPPLANE6!==l&&(f.CLIPPLANE6=l,p=!0),p}function i(y,g,f){let p=g.clipPlane??f.clipPlane;H(y,"vClipPlane",p),p=g.clipPlane2??f.clipPlane2,H(y,"vClipPlane2",p),p=g.clipPlane3??f.clipPlane3,H(y,"vClipPlane3",p),p=g.clipPlane4??f.clipPlane4,H(y,"vClipPlane4",p),p=g.clipPlane5??f.clipPlane5,H(y,"vClipPlane5",p),p=g.clipPlane6??f.clipPlane6,H(y,"vClipPlane6",p)}function H(y,g,f){f&&y.setFloat4(g,f.k.x,f.k.y,f.k.z,f.d)}f.d(g,{c:()=>p,g:()=>i,h:()=>k,j:()=>S})},11107:(y,g,f)=>{"use strict";function p(y){y.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}f.d(g,{b:()=>p})},11511:(y,g,f)=>{"use strict";function p(y){return void 0===y.getPipelineContext}f.d(g,{e:()=>p})},11240:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{static GetEffect(y){return void 0===y.getPipelineContext?y.effect:y}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=y.createDrawContext(),g&&(this.materialContext=y.createMaterialContext())}setEffect(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var p;(this.effect=y,void 0!==g&&(this.defines=g),f)&&(null===(p=this.drawContext)||void 0===p||p.reset())}dispose(){var y;null===(y=this.drawContext)||void 0===y||y.dispose()}}},10819:(y,g,f)=>{"use strict";f.d(g,{c:()=>Z,d:()=>q,h:()=>l,j:()=>c});var p=f(10730),S=f(10828),k=f(10812),i=f(10736),H=f(10789),U=f(10791);function l(y,g){return(0,S.w)(g).cachedPipelines[y]}function c(y){const g=y._name,f=y.context;if(g&&f){const y=(0,S.w)(f),p=y.cachedPipelines[g];null===p||void 0===p||p.dispose(),delete y.cachedPipelines[g]}}function Z(y,g,f,S,k,i,U){let l,c;const Z=(0,p.i)()?null===i||void 0===i?void 0:i.getHostDocument():null;l="string"===typeof g?g:g.vertexSource?"source:"+g.vertexSource:g.vertexElement?(null===Z||void 0===Z?void 0:Z.getElementById(g.vertexElement))||g.vertexElement:g.vertex||g,c="string"===typeof g?g:g.fragmentSource?"source:"+g.fragmentSource:g.fragmentElement?(null===Z||void 0===Z?void 0:Z.getElementById(g.fragmentElement))||g.fragmentElement:g.fragment||g;const q=[void 0,void 0],W=()=>{if(q[0]&&q[1]){y.isFragment=!0;const[p,l]=q;(0,H.g)(l,y,((i,l)=>{U&&(U._fragmentSourceCodeBeforeMigration=l),f&&(i=f("fragment",i));const c=(0,H.d)(p,i,y);y=null;const Z=function(y,g,f,p){if(f){return{vertexSourceCode:(1===p?"//":"")+"#define SHADER_NAME vertex:"+(f.vertexElement||f.vertex||f.spectorName||f)+"\n"+y,fragmentSourceCode:(1===p?"//":"")+"#define SHADER_NAME fragment:"+(f.fragmentElement||f.fragment||f.spectorName||f)+"\n"+g}}return{vertexSourceCode:y,fragmentSourceCode:g}}(c.vertexCode,c.fragmentCode,g,k);null===S||void 0===S||S(Z.vertexSourceCode,Z.fragmentSourceCode)}),i)}};C(l,"Vertex","",(g=>{(0,H.f)(y),(0,H.g)(g,y,((y,p)=>{U&&(U._rawVertexSourceCode=g,U._vertexSourceCodeBeforeMigration=p),f&&(y=f("vertex",y)),q[0]=y,W()}),i)}),k),C(c,"Fragment","Pixel",(y=>{U&&(U._rawFragmentSourceCode=y),q[1]=y,W()}),k)}function C(y,g,f,S,i,H){if("undefined"!==typeof HTMLElement&&y instanceof HTMLElement){return void S((0,p.c)(y))}if("source:"===y.substring(0,7))return void S(y.substring(7));if("base64:"===y.substring(0,7)){return void S(window.atob(y.substring(7)))}const l=k.e.GetShadersStore(i);if(l[y+g+"Shader"])return void S(l[y+g+"Shader"]);if(f&&l[y+f+"Shader"])return void S(l[y+f+"Shader"]);let c;if(c="."===y[0]||"/"===y[0]||y.indexOf("http")>-1?y:k.e.GetShadersRepository(i)+y,!(H=H||U.j))throw new Error("loadFileInjection is not defined");H(c+"."+g.toLowerCase()+".fx",S)}const q=(y,g,f,p)=>{try{const k=y.existingPipelineContext||g(y.shaderProcessingContext);if(k._name=y.name,y.name&&y.context){(0,S.w)(y.context).cachedPipelines[y.name]=k}return f(k,y.vertex,y.fragment,!!y.createAsRaw,"","",y.rebuildRebind,y.defines,y.transformFeedbackVaryings,"",(()=>{p(k,(()=>{var g;null===(g=y.onRenderingStateCompiled)||void 0===g||g.call(y,k)}))})),k}catch(k){throw i.d.Error("Error compiling effect"),k}}},10803:(y,g,f)=>{"use strict";f.d(g,{e:()=>H});var p=f(10723),S=f(10736),k=f(10812),i=f(10819);class H{static get ShadersRepository(){return k.e.ShadersRepository}static set ShadersRepository(y){k.e.ShadersRepository=y}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new p.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9?arguments[9]:void 0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,j=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new p.d,this.onErrorObservable=new p.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=y,this._key=q;const P=this._key.replace(/\r/g,"").replace(/\n/g,"|");let B;if(g.attributes){const y=g;if(this._engine=f,this._attributesNames=y.attributes,this._uniformsNames=y.uniformsNames.concat(y.samplers),this._samplerList=y.samplers.slice(),this.defines=y.defines,this.onError=y.onError,this.onCompiled=y.onCompiled,this._fallbacks=y.fallbacks,this._indexParameters=y.indexParameters,this._transformFeedbackVaryings=y.transformFeedbackVaryings||null,this._multiTarget=!!y.multiTarget,this._shaderLanguage=y.shaderLanguage??0,y.uniformBuffersNames){this._uniformBuffersNamesList=y.uniformBuffersNames.slice();for(let g=0;g<y.uniformBuffersNames.length;g++)this._uniformBuffersNames[y.uniformBuffersNames[g]]=g}this._processFinalCode=y.processFinalCode??null,this._processCodeAfterIncludes=y.processCodeAfterIncludes??void 0,B=y.existingPipelineContext}else this._engine=k,this.defines=null==U?"":U,this._uniformsNames=f.concat(S),this._samplerList=S?S.slice():[],this._attributesNames=g,this._uniformBuffersNamesList=[],this._shaderLanguage=W,this.onError=Z,this.onCompiled=c,this._indexParameters=C,this._fallbacks=l;"WEBGL2"===this._engine.shaderPlatformName&&(B=(0,i.h)(P,this._engine._gl)??B),this._attributeLocationByName={},this.uniqueId=H._UniqueIdSeed++,B?(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,j)}async _processShaderCodeAsync(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3?arguments[3]:void 0;p&&await p(),this._processingContext=f||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const S={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:y??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:k.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:k.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,i.c)(S,this.name,this._processFinalCode,((y,f)=>{this._vertexSourceCode=y,this._fragmentSourceCode=f,this._prepareEffect(g)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(y){return this._attributes[y]}getAttributeLocationByName(y){return this._attributeLocationByName[y]}getAttributesCount(){return this._attributes.length}getUniformIndex(y){return this._uniformsNames.indexOf(y)}getUniform(y){return this._uniforms[y]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(y){this.isReady()?y(this):(this.onCompileObservable.add((g=>{y(g)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(y){try{if(this._isReadyInternal())return}catch(g){return void this._processCompilationErrors(g,y)}this._isDisposed||setTimeout((()=>{this._checkIsReady(y)}),16)}get vertexSourceCode(){var y;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(y=this._pipelineContext)||void 0===y?void 0:y._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var y;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(y=this._pipelineContext)||void 0===y?void 0:y._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(y,g,f,p){this._isReady=!1,this._vertexSourceCodeOverride=y,this._fragmentSourceCodeOverride=g,this.onError=(y,g)=>{p&&p(g)},this.onCompiled=()=>{var y,g;const p=this.getEngine().scenes;if(p)for(let f=0;f<p.length;f++)p[f].markAllMaterialsAsDirty(63);null===(y=(g=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===y||y.call(g,f)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(y){if(this._pipelineContext=y,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let g=0;g<this._attributesNames.length;g++){const y=this._attributesNames[g];this._attributeLocationByName[y]=this._attributes[g]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),H.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=this._pipelineContext;this._isReady=!1;try{const f=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),p=f?null:this.defines,S=f?this._vertexSourceCodeOverride:this._vertexSourceCode,k=f?this._fragmentSourceCodeOverride:this._fragmentSourceCode,H=this._engine;this._pipelineContext=(0,i.d)({existingPipelineContext:y?g:null,vertex:S,fragment:k,context:"WEBGL2"===H.shaderPlatformName?H._gl:void 0,rebuildRebind:(y,g,f,p)=>this._rebuildProgram(y,g,f,p),defines:p,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:f,parallelShaderCompile:H._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:f=>{g&&!y&&this._engine._deletePipelineContext(g),f&&this._onRenderingStateCompiled(f)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(g)}catch(f){this._processCompilationErrors(f,g)}}_getShaderCodeAndErrorLine(y,g,f){const p=f?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let S=null;if(g&&y){const k=g.match(p);if(k&&2===k.length){const g=parseInt(k[1]),p=y.split("\n",-1);p.length>=g&&(S=`Offending line [${g}] in ${f?"fragment":"vertex"} code: ${p[g-1]}`)}}return[y,S]}_processCompilationErrors(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=y.message;const f=this._attributesNames,p=this._fallbacks;if(S.d.Error("Unable to compile effect:"),S.d.Error("Uniforms: "+this._uniformsNames.map((function(y){return" "+y}))),S.d.Error("Attributes: "+f.map((function(y){return" "+y}))),S.d.Error("Defines:\n"+this.defines),H.LogShaderCodeOnCompilationError){var k,i;let y=null,g=null,f=null;var U;if(null!==(k=this._pipelineContext)&&void 0!==k&&k._getVertexShaderCode()&&([f,y]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),f&&(S.d.Error("Vertex code:"),S.d.Error(f))),null!==(i=this._pipelineContext)&&void 0!==i&&i._getFragmentShaderCode())[f,g]=this._getShaderCodeAndErrorLine(null===(U=this._pipelineContext)||void 0===U?void 0:U._getFragmentShaderCode(),this._compilationError,!0),f&&(S.d.Error("Fragment code:"),S.d.Error(f));y&&S.d.Error(y),g&&S.d.Error(g)}S.d.Error("Error: "+this._compilationError);const l=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};g&&(this._pipelineContext=g,this._isReady=!0,l()),p?(this._pipelineContext=null,p.hasMoreFallbacks?(this._allFallbacksProcessed=!1,S.d.Error("Trying next fallback."),this.defines=p.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,l(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,g||l())}get isSupported(){return""===this._compilationError}_bindTexture(y,g){this._engine._bindTexture(this._samplers[y],g,y)}setTexture(y,g){this._engine.setTexture(this._samplers[y],this._uniforms[y],g,y)}setTextureArray(y,g){const f=y+"Ex";if(-1===this._samplerList.indexOf(f+"0")){const p=this._samplerList.indexOf(y);for(let y=1;y<g.length;y++){const g=f+(y-1).toString();this._samplerList.splice(p+y,0,g)}let S=0;for(const y of this._samplerList)this._samplers[y]=S,S+=1}this._engine.setTextureArray(this._samplers[y],this._uniforms[y],g,y)}bindUniformBuffer(y,g){const f=this._uniformBuffersNames[g];void 0===f||H._BaseCache[f]===y&&this._engine._features.useUBOBindingCache||(H._BaseCache[f]=y,this._engine.bindUniformBufferBase(y,f,g))}bindUniformBlock(y,g){this._engine.bindUniformBlock(this._pipelineContext,y,g)}setInt(y,g){return this._pipelineContext.setInt(y,g),this}setInt2(y,g,f){return this._pipelineContext.setInt2(y,g,f),this}setInt3(y,g,f,p){return this._pipelineContext.setInt3(y,g,f,p),this}setInt4(y,g,f,p,S){return this._pipelineContext.setInt4(y,g,f,p,S),this}setIntArray(y,g){return this._pipelineContext.setIntArray(y,g),this}setIntArray2(y,g){return this._pipelineContext.setIntArray2(y,g),this}setIntArray3(y,g){return this._pipelineContext.setIntArray3(y,g),this}setIntArray4(y,g){return this._pipelineContext.setIntArray4(y,g),this}setUInt(y,g){return this._pipelineContext.setUInt(y,g),this}setUInt2(y,g,f){return this._pipelineContext.setUInt2(y,g,f),this}setUInt3(y,g,f,p){return this._pipelineContext.setUInt3(y,g,f,p),this}setUInt4(y,g,f,p,S){return this._pipelineContext.setUInt4(y,g,f,p,S),this}setUIntArray(y,g){return this._pipelineContext.setUIntArray(y,g),this}setUIntArray2(y,g){return this._pipelineContext.setUIntArray2(y,g),this}setUIntArray3(y,g){return this._pipelineContext.setUIntArray3(y,g),this}setUIntArray4(y,g){return this._pipelineContext.setUIntArray4(y,g),this}setFloatArray(y,g){return this._pipelineContext.setArray(y,g),this}setFloatArray2(y,g){return this._pipelineContext.setArray2(y,g),this}setFloatArray3(y,g){return this._pipelineContext.setArray3(y,g),this}setFloatArray4(y,g){return this._pipelineContext.setArray4(y,g),this}setArray(y,g){return this._pipelineContext.setArray(y,g),this}setArray2(y,g){return this._pipelineContext.setArray2(y,g),this}setArray3(y,g){return this._pipelineContext.setArray3(y,g),this}setArray4(y,g){return this._pipelineContext.setArray4(y,g),this}setMatrices(y,g){return this._pipelineContext.setMatrices(y,g),this}setMatrix(y,g){return this._pipelineContext.setMatrix(y,g),this}setMatrix3x3(y,g){return this._pipelineContext.setMatrix3x3(y,g),this}setMatrix2x2(y,g){return this._pipelineContext.setMatrix2x2(y,g),this}setFloat(y,g){return this._pipelineContext.setFloat(y,g),this}setBool(y,g){return this._pipelineContext.setInt(y,g?1:0),this}setVector2(y,g){return this._pipelineContext.setVector2(y,g),this}setFloat2(y,g,f){return this._pipelineContext.setFloat2(y,g,f),this}setVector3(y,g){return this._pipelineContext.setVector3(y,g),this}setFloat3(y,g,f,p){return this._pipelineContext.setFloat3(y,g,f,p),this}setVector4(y,g){return this._pipelineContext.setVector4(y,g),this}setQuaternion(y,g){return this._pipelineContext.setQuaternion(y,g),this}setFloat4(y,g,f,p,S){return this._pipelineContext.setFloat4(y,g,f,p,S),this}setColor3(y,g){return this._pipelineContext.setColor3(y,g),this}setColor4(y,g,f){return this._pipelineContext.setColor4(y,g,f),this}setDirectColor4(y,g){return this._pipelineContext.setDirectColor4(y,g),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,i.j)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;g&&(k.e.GetShadersStore(p)[`${y}PixelShader`]=g),f&&(k.e.GetShadersStore(p)[`${y}VertexShader`]=f)}static ResetCache(){H._BaseCache={}}}H.LogShaderCodeOnCompilationError=!0,H.AutomaticallyClearCodeCache=!1,H._UniqueIdSeed=0,H._BaseCache={},H.ShadersStore=k.e.ShadersStore,H.IncludesShadersStore=k.e.IncludesShadersStore},11294:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(y,g){this._defines[y]||(y<this._currentRank&&(this._currentRank=y),y>this._maxRank&&(this._maxRank=y),this._defines[y]=new Array),this._defines[y].push(g)}addCPUSkinningFallback(y,g){this._mesh=g,y<this._currentRank&&(this._currentRank=y),y>this._maxRank&&(this._maxRank=y)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(y,g){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,y=y.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),g._bonesComputationForcedToCPU=!0;const f=this._mesh.va();for(let y=0;y<f.meshes.length;y++){const p=f.meshes[y];if(p.material){if(p.computeBonesUsingShaders&&0!==p.numBoneInfluencers)if(p.material.getEffect()===g)p.computeBonesUsingShaders=!1;else if(p.og)for(const y of p.og){if(y.effect===g){p.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&p.computeBonesUsingShaders&&p.numBoneInfluencers>0&&(p.computeBonesUsingShaders=!1)}}else{const g=this._defines[this._currentRank];if(g)for(let f=0;f<g.length;f++)y=y.replace("#define "+g[f],"");this._currentRank++}return y}}},11594:(y,g,f)=>{"use strict";f.d(g,{b:()=>l,c:()=>c});var p=f(11131),S=f(11342),k=f(10723),i=f(10803),H=f(11240);f(11601);const U={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class l{constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;this._fullscreenViewport=new S.b(0,0,1,1);const f=g.xa??U.xa,k=g.indices??U.indices;this.Ed=y,this._vertexBuffers={[p.c.PositionKind]:new p.c(y,f,p.c.PositionKind,!1,!1,2)},this._indexBuffer=y.createIndexBuffer(k),this._onContextRestoredObserver=y.onContextRestoredObservable.add((()=>{this._indexBuffer=y.createIndexBuffer(k);for(const y in this._vertexBuffers){this._vertexBuffers[y]._rebuild()}}))}setViewport(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Ed.setViewport(y)}bindBuffers(y){this.Ed.bindBuffers(this._vertexBuffers,this._indexBuffer,y)}applyEffectWrapper(y){this.Ed.setState(!0),this.Ed.depthCullingState.depthTest=!1,this.Ed.stencilState.stencilTest=!1,this.Ed.enableEffect(y.drawWrapper),this.bindBuffers(y.effect),y.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Ed.depthCullingState.depthTest,this._savedStateStencilTest=this.Ed.stencilState.stencilTest}restoreStates(){this.Ed.depthCullingState.depthTest=this._savedStateDepthTest,this.Ed.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Ed.drawElementsType(0,0,6)}_isRenderTargetTexture(y){return void 0!==y.renderTarget}render(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!y.effect.isReady())return;this.saveStates(),this.setViewport();const f=null===g?null:this._isRenderTargetTexture(g)?g.renderTarget:g;f&&this.Ed.bindFramebuffer(f),this.applyEffectWrapper(y),this.draw(),f&&this.Ed.unBindFramebuffer(f),this.restoreStates()}dispose(){const y=this._vertexBuffers[p.c.PositionKind];y&&(y.dispose(),delete this._vertexBuffers[p.c.PositionKind]),this._indexBuffer&&this.Ed._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Ed.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class c{static RegisterShaderCodeProcessing(y,g){g?c._CustomShaderCodeProcessing[y??""]=g:delete c._CustomShaderCodeProcessing[y??""]}static _GetShaderCodeProcessing(y){return c._CustomShaderCodeProcessing[y]??c._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(y){this.options.name=y}isReady(){var y;return(null===(y=this._drawWrapper.effect)||void 0===y?void 0:y.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(y){this._drawWrapper.effect=y}constructor(y){this.alphaMode=0,this.onEffectCreatedObservable=new k.d(void 0,!0),this.onApplyObservable=new k.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...y,name:y.name||"effectWrapper",Ed:y.Ed,uniforms:y.uniforms||y.uniformNames||[],uniformNames:void 0,samplers:y.samplers||y.samplerNames||[],samplerNames:void 0,attributeNames:y.attributeNames||["position"],uniformBuffers:y.uniformBuffers||[],defines:y.defines||"",useShaderStore:y.useShaderStore||!1,vertexUrl:y.vertexUrl||y.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:y.fragmentShader||"pass",indexParameters:y.indexParameters,blockCompilation:y.blockCompilation||!1,shaderLanguage:y.shaderLanguage||0,onCompiled:y.onCompiled||void 0,extraInitializations:y.extraInitializations||void 0,extraInitializationsAsync:y.extraInitializationsAsync||void 0,useAsPostProcess:y.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),y.vertexUrl||y.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Ed.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new H.b(this.options.Ed),this._webGPUReady=1===this.options.shaderLanguage;const g=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,g,this.options.extraInitializations)}_gatherImports(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(y&&this._webGPUReady?g.push(Promise.all([f.e(37).then(f.bind(f,13549))])):g.push(Promise.all([Promise.resolve().then(f.bind(f,11601))])))}_postConstructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,p&&this._importPromises.push(...p);const S=this.options.Ed.isWebGPU&&!c.ForceGLSL;this._gatherImports(S,this._importPromises),void 0!==f&&f(S,this._importPromises),S&&this._webGPUReady&&(this.options.shaderLanguage=1),y||this.updateEffect(g)}updateEffect(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0;const l=c._GetShaderCodeProcessing(this.name);if(null!==l&&void 0!==l&&l.defineCustomBindings){var Z,C;const p=(null===(Z=g)||void 0===Z?void 0:Z.slice())??[];p.push(...this.options.uniforms);const S=(null===(C=f)||void 0===C?void 0:C.slice())??[];S.push(...this.options.samplers),y=l.defineCustomBindings(this.name,y,p,S),g=p,f=S}this.options.defines=y||"";const q=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let W;W=this.options.extraInitializationsAsync?async()=>{null===q||void 0===q||q(),await this.options.extraInitializationsAsync}:q,this.options.useShaderStore?this._drawWrapper.effect=this.options.Ed.createEffect({vertex:H??this._shaderPath.vertex,fragment:U??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:g||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:f||this.options.samplers,defines:null!==y?y:"",fallbacks:null,onCompiled:S??this.options.onCompiled,onError:k??null,indexParameters:p||this.options.indexParameters,processCodeAfterIncludes:null!==l&&void 0!==l&&l.processCodeAfterIncludes?(y,g)=>l.processCodeAfterIncludes(this.name,y,g):null,processFinalCode:null!==l&&void 0!==l&&l.processFinalCode?(y,g)=>l.processFinalCode(this.name,y,g):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:W},this.options.Ed):this._drawWrapper.effect=new i.e(this._shaderPath,this.options.attributeNames,g||this.options.uniforms,f||this.options.samplerNames,this.options.Ed,y,void 0,S||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,W),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var y,g;this.options.useAsPostProcess&&(this.options.Ed.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(y=c._GetShaderCodeProcessing(this.name))||void 0===y||null===(g=y.bindCustomBindings)||void 0===g||g.call(y,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}c.ForceGLSL=!1,c._CustomShaderCodeProcessing={}},11113:(y,g,f)=>{"use strict";f.d(g,{e:()=>k,g:()=>S});var p=f(11107);function S(y,g){g.EXPOSURE&&y.push("exposureLinear"),g.CONTRAST&&y.push("contrast"),g.COLORGRADING&&y.push("colorTransformSettings"),(g.VIGNETTE||g.DITHER)&&y.push("vInverseScreenSize"),g.VIGNETTE&&(y.push("vignetteSettings1"),y.push("vignetteSettings2")),g.COLORCURVES&&(0,p.b)(y),g.DITHER&&y.push("ditherIntensity")}function k(y,g){g.COLORGRADING&&y.push("txColorTransform")}},11087:(y,g,f)=>{"use strict";f.d(g,{b:()=>q});var p=f(11021),S=f(11026),k=f(10723),i=f(11090),H=f(11099),U=f(11107);class l{constructor(){this._dirty=!0,this._tempColor=new i.f(0,0,0,0),this._globalCurve=new i.f(0,0,0,0),this._highlightsCurve=new i.f(0,0,0,0),this._midtonesCurve=new i.f(0,0,0,0),this._shadowsCurve=new i.f(0,0,0,0),this._positiveCurve=new i.f(0,0,0,0),this._negativeCurve=new i.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(y){this._globalHue=y,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(y){this._globalDensity=y,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(y){this._globalSaturation=y,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(y){this._globalExposure=y,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(y){this._highlightsHue=y,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(y){this._highlightsDensity=y,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(y){this._highlightsSaturation=y,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(y){this._highlightsExposure=y,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(y){this._midtonesHue=y,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(y){this._midtonesDensity=y,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(y){this._midtonesSaturation=y,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(y){this._midtonesExposure=y,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(y){this._shadowsHue=y,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(y){this._shadowsDensity=y,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(y){this._shadowsSaturation=y,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(y){this._shadowsExposure=y,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";y._dirty&&(y._dirty=!1,y._getColorGradingDataToRef(y._globalHue,y._globalDensity,y._globalSaturation,y._globalExposure,y._globalCurve),y._getColorGradingDataToRef(y._highlightsHue,y._highlightsDensity,y._highlightsSaturation,y._highlightsExposure,y._tempColor),y._tempColor.multiplyToRef(y._globalCurve,y._highlightsCurve),y._getColorGradingDataToRef(y._midtonesHue,y._midtonesDensity,y._midtonesSaturation,y._midtonesExposure,y._tempColor),y._tempColor.multiplyToRef(y._globalCurve,y._midtonesCurve),y._getColorGradingDataToRef(y._shadowsHue,y._shadowsDensity,y._shadowsSaturation,y._shadowsExposure,y._tempColor),y._tempColor.multiplyToRef(y._globalCurve,y._shadowsCurve),y._highlightsCurve.subtractToRef(y._midtonesCurve,y._positiveCurve),y._midtonesCurve.subtractToRef(y._shadowsCurve,y._negativeCurve)),g&&(g.setFloat4(f,y._positiveCurve.r,y._positiveCurve.g,y._positiveCurve.b,y._positiveCurve.a),g.setFloat4(p,y._midtonesCurve.r,y._midtonesCurve.g,y._midtonesCurve.b,y._midtonesCurve.a),g.setFloat4(S,y._negativeCurve.r,y._negativeCurve.g,y._negativeCurve.b,y._negativeCurve.a))}_getColorGradingDataToRef(y,g,f,p,S){null!=y&&(y=l._Clamp(y,0,360),g=l._Clamp(g,-100,100),f=l._Clamp(f,-100,100),p=l._Clamp(p,-100,100),g=l._ApplyColorGradingSliderNonlinear(g),g*=.5,p=l._ApplyColorGradingSliderNonlinear(p),g<0&&(g*=-1,y=(y+180)%360),l._FromHSBToRef(y,g,50+.25*p,S),S.scaleToRef(2,S),S.a=1+.01*f)}static _ApplyColorGradingSliderNonlinear(y){y/=100;let g=Math.abs(y);return g=Math.pow(g,2),y<0&&(g*=-1),g*=100,g}static _FromHSBToRef(y,g,f,p){let S=l._Clamp(y,0,360);const k=l._Clamp(g/100,0,1),i=l._Clamp(f/100,0,1);if(0===k)p.r=i,p.g=i,p.b=i;else{S/=60;const y=Math.floor(S),g=S-y,f=i*(1-k),H=i*(1-k*g),U=i*(1-k*(1-g));switch(y){case 0:p.r=i,p.g=U,p.b=f;break;case 1:p.r=H,p.g=i,p.b=f;break;case 2:p.r=f,p.g=i,p.b=U;break;case 3:p.r=f,p.g=H,p.b=i;break;case 4:p.r=U,p.g=f,p.b=i;break;default:p.r=i,p.g=f,p.b=H}}p.a=1}static _Clamp(y,g,f){return Math.min(Math.max(y,g),f)}clone(){return H.c.Clone((()=>new l),this)}serialize(){return H.c.Serialize(this)}static Parse(y){return H.c.Parse((()=>new l),y,null,null)}}l.PrepareUniforms=U.b,(0,p.c)([(0,S.I)()],l.prototype,"_globalHue",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_globalDensity",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_globalSaturation",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_globalExposure",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_highlightsHue",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_highlightsDensity",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_highlightsSaturation",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_highlightsExposure",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_midtonesHue",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_midtonesDensity",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_midtonesSaturation",void 0),(0,p.c)([(0,S.I)()],l.prototype,"_midtonesExposure",void 0),H.c._ColorCurvesParser=l.Parse;var c=f(10882),Z=f(11113),C=f(10871);class q{constructor(){this.colorCurves=new l,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=q.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new i.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=q.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new k.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(y){this._colorCurvesEnabled!==y&&(this._colorCurvesEnabled=y,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(y){this._colorGradingTexture!==y&&(this._colorGradingTexture=y,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(y){this._colorGradingEnabled!==y&&(this._colorGradingEnabled=y,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(y){this._colorGradingWithGreenDepth!==y&&(this._colorGradingWithGreenDepth=y,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(y){this._colorGradingBGR!==y&&(this._colorGradingBGR=y,this._updateParameters())}get exposure(){return this._exposure}set exposure(y){this._exposure!==y&&(this._exposure=y,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(y){this._toneMappingEnabled!==y&&(this._toneMappingEnabled=y,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(y){this._toneMappingType!==y&&(this._toneMappingType=y,this._updateParameters())}get contrast(){return this._contrast}set contrast(y){this._contrast!==y&&(this._contrast=y,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(y){this.vignetteCenterY=y}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(y){this.vignetteCenterX=y}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(y){this._vignetteBlendMode!==y&&(this._vignetteBlendMode=y,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(y){this._vignetteEnabled!==y&&(this._vignetteEnabled=y,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(y){this._ditheringEnabled!==y&&(this._ditheringEnabled=y,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(y){this._ditheringIntensity!==y&&(this._ditheringIntensity=y,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(y){this._skipFinalColorClamp!==y&&(this._skipFinalColorClamp=y,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(y){this._applyByPostProcess!==y&&(this._applyByPostProcess=y,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(y){this._isEnabled!==y&&(this._isEnabled=y,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(y){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return y.VIGNETTE=!1,y.TONEMAPPING=0,y.CONTRAST=!1,y.EXPOSURE=!1,y.COLORCURVES=!1,y.COLORGRADING=!1,y.COLORGRADING3D=!1,y.DITHER=!1,y.IMAGEPROCESSING=!1,y.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(y.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(y.VIGNETTE=this.vignetteEnabled,y.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===q._VIGNETTEMODE_MULTIPLY,y.VIGNETTEBLENDMODEOPAQUE=!y.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case q.TONEMAPPING_KHR_PBR_NEUTRAL:y.TONEMAPPING=3;break;case q.TONEMAPPING_ACES:y.TONEMAPPING=2;break;default:y.TONEMAPPING=1}else y.TONEMAPPING=0;y.CONTRAST=1!==this.contrast,y.EXPOSURE=1!==this.exposure,y.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,y.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,y.COLORGRADING?y.COLORGRADING3D=this.colorGradingTexture.is3D:y.COLORGRADING3D=!1,y.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,y.SAMPLER3DBGRMAP=this.colorGradingBGR,y.DITHER=this._ditheringEnabled,y.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,y.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,y.IMAGEPROCESSING=y.VIGNETTE||!!y.TONEMAPPING||y.CONTRAST||y.EXPOSURE||y.COLORCURVES||y.COLORGRADING||y.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(y,g){if(this._colorCurvesEnabled&&this.colorCurves&&l.Bind(this.colorCurves,y),this._vignetteEnabled||this._ditheringEnabled){const f=1/y.getEngine().getRenderWidth(),p=1/y.getEngine().getRenderHeight();if(y.setFloat2("vInverseScreenSize",f,p),this._ditheringEnabled&&y.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const S=null!=g?g:p/f;let k=Math.tan(.5*this.vignetteCameraFov),i=k*S;const H=Math.sqrt(i*k);i=(0,c.o)(i,H,this.vignetteStretch),k=(0,c.o)(k,H,this.vignetteStretch),y.setFloat4("vignetteSettings1",i,k,-i*this.vignetteCenterX,-k*this.vignetteCenterY);const U=-2*this.vignetteWeight;y.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,U)}}if(y.setFloat("exposureLinear",this.exposure),y.setFloat("contrast",this.contrast),this.colorGradingTexture){y.setTexture("txColorTransform",this.colorGradingTexture);const g=this.colorGradingTexture.getSize().height;y.setFloat4("colorTransformSettings",(g-1)/g,.5/g,g,this.colorGradingTexture.level)}}clone(){return H.c.Clone((()=>new q),this)}serialize(){return H.c.Serialize(this)}static Parse(y){const g=H.c.Parse((()=>new q),y,null,null);return void 0!==y.vignetteCentreX&&(g.vignetteCenterX=y.vignetteCentreX),void 0!==y.vignetteCentreY&&(g.vignetteCenterY=y.vignetteCentreY),g}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}q.TONEMAPPING_STANDARD=0,q.TONEMAPPING_ACES=1,q.TONEMAPPING_KHR_PBR_NEUTRAL=2,q.PrepareUniforms=Z.g,q.PrepareSamplers=Z.e,q._VIGNETTEMODE_MULTIPLY=0,q._VIGNETTEMODE_OPAQUE=1,(0,p.c)([(0,S.h)()],q.prototype,"colorCurves",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_colorCurvesEnabled",void 0),(0,p.c)([(0,S.E)("colorGradingTexture")],q.prototype,"_colorGradingTexture",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_colorGradingEnabled",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_colorGradingWithGreenDepth",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_colorGradingBGR",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_exposure",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_toneMappingEnabled",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_toneMappingType",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_contrast",void 0),(0,p.c)([(0,S.I)()],q.prototype,"vignetteStretch",void 0),(0,p.c)([(0,S.I)()],q.prototype,"vignetteCenterX",void 0),(0,p.c)([(0,S.I)()],q.prototype,"vignetteCenterY",void 0),(0,p.c)([(0,S.I)()],q.prototype,"vignetteWeight",void 0),(0,p.c)([(0,S.o)()],q.prototype,"vignetteColor",void 0),(0,p.c)([(0,S.I)()],q.prototype,"vignetteCameraFov",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_vignetteBlendMode",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_vignetteEnabled",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_ditheringEnabled",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_ditheringIntensity",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_skipFinalColorClamp",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_applyByPostProcess",void 0),(0,p.c)([(0,S.I)()],q.prototype,"_isEnabled",void 0),H.c._ImageProcessingConfigurationParser=q.Parse,(0,C.c)("BABYLON.ImageProcessingConfiguration",q)},11302:(y,g,f)=>{"use strict";f.d(g,{d:()=>Z});var p=f(11021),S=f(11206),k=f(11026),i=f(11285),H=f(11253),U=f(11311),l=f(11242);class c extends H.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class Z extends U.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"DetailMap",140,new c,g),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=S.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,g,f){return!this._isEnabled||!(y._areTexturesDirty&&g.texturesEnabled&&f.getCaps().standardDerivatives&&this._texture&&i.b.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(y,g){if(this._isEnabled){y.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const f=g.getEngine();y._areTexturesDirty&&(f.getCaps().standardDerivatives&&this._texture&&i.b.DetailTextureEnabled&&this._isEnabled?((0,l.R)(this._texture,y,"DETAIL"),y.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):y.DETAIL=!1)}else y.DETAIL=!1}bindForSubMesh(y,g){if(!this._isEnabled)return;const f=this._material.isFrozen;y.useUbo&&f&&y.isSync||this._texture&&i.b.DetailTextureEnabled&&(y.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,l.u)(this._texture,y,"detail")),g.texturesEnabled&&this._texture&&i.b.DetailTextureEnabled&&y.setTexture("detailSampler",this._texture)}hasTexture(y){return this._texture===y}getActiveTextures(y){this._texture&&y.push(this._texture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture)}dispose(y){var g;y&&(null===(g=this._texture)||void 0===g||g.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(y){y.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,p.c)([(0,k.E)("detailTexture"),(0,k.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"diffuseBlendLevel",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"roughnessBlendLevel",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"bumpLevel",void 0),(0,p.c)([(0,k.I)(),(0,k.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"normalBlendMethod",void 0),(0,p.c)([(0,k.I)(),(0,k.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0)},11206:(y,g,f)=>{"use strict";f.d(g,{c:()=>P});var p=f(11021),S=f(11026),k=f(10714),i=f(10723),H=f(10761),U=f(11209),l=f(11117),c=f(10736),Z=f(11181),C=f(11240),q=f(11099);class W{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(y){this._func=y}get funcRef(){return this._funcRef}set funcRef(y){this._funcRef=y}get funcMask(){return this._funcMask}set funcMask(y){this._funcMask=y}get opStencilFail(){return this._opStencilFail}set opStencilFail(y){this._opStencilFail=y}get opDepthFail(){return this._opDepthFail}set opDepthFail(y){this._opDepthFail=y}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(y){this._opStencilDepthPass=y}get mask(){return this._mask}set mask(y){this._mask=y}get enabled(){return this._enabled}set enabled(y){this._enabled=y}getClassName(){return"MaterialStencilState"}copyTo(y){q.c.Clone((()=>y),this)}serialize(){return q.c.Serialize(this)}parse(y,g,f){q.c.Parse((()=>this),y,g,f)}}(0,p.c)([(0,S.I)()],W.prototype,"func",null),(0,p.c)([(0,S.I)()],W.prototype,"funcRef",null),(0,p.c)([(0,S.I)()],W.prototype,"funcMask",null),(0,p.c)([(0,S.I)()],W.prototype,"opStencilFail",null),(0,p.c)([(0,S.I)()],W.prototype,"opDepthFail",null),(0,p.c)([(0,S.I)()],W.prototype,"opStencilDepthPass",null),(0,p.c)([(0,S.I)()],W.prototype,"mask",null),(0,p.c)([(0,S.I)()],W.prototype,"enabled",null);var j=f(11242);class P{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(y){if(this._alpha===y)return;const g=this._alpha;this._alpha=y,1!==g&&1!==y||this.Vg(P.MiscDirtyFlag+P.PrePassDirtyFlag)}get alpha(){return this._alpha}set oh(y){this._backFaceCulling!==y&&(this._backFaceCulling=y,this.Vg(P.TextureDirtyFlag))}get oh(){return this._backFaceCulling}set cullBackFaces(y){this._cullBackFaces!==y&&(this._cullBackFaces=y,this.Vg(P.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(y){this._blockDirtyMechanism!==y&&(this._blockDirtyMechanism=y,y||this.hj())}atomicMaterialsUpdate(y){this.blockDirtyMechanism=!0;try{y(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(y){this._onDisposeObserver&&this.nj.remove(this._onDisposeObserver),this._onDisposeObserver=this.nj.add(y)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new i.d),this._onBindObservable}set onBind(y){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(y)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new i.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new i.d),this._onEffectCreatedObservable}set alphaMode(y){this._alphaMode!==y&&(this._alphaMode=y,this.Vg(P.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(y){this._needDepthPrePass!==y&&(this._needDepthPrePass=y,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(y){this._fogEnabled!==y&&(this._fogEnabled=y,this.Vg(P.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case P.WireFrameFillMode:case P.LineListDrawMode:case P.LineLoopDrawMode:case P.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(y){this.fillMode=y?P.WireFrameFillMode:P.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case P.PointFillMode:case P.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(y){this.fillMode=y?P.PointFillMode:P.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(y){this._fillMode!==y&&(this._fillMode=y,this.Vg(P.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(y){const g=this.va().getEngine().getCaps().fragmentDepthSupported;y&&!g&&c.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=y&&g,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(y){this._drawWrapper=y}constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.nj=new i.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new W,this._useUBO=!1,this._fillMode=P.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=y;const S=g||H.d.LastCreatedScene;S&&(this._scene=S,this._dirtyCallbacks={},this._forceGLSL=p,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=y||k.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new C.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new l.c(this._scene.getEngine(),void 0,void 0,y),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),f||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),P.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var y;const g=this.va().getEngine();null===(y=this._uniformBuffer)||void 0===y||y.dispose(),g.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new l.c(g,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new l.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(y){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.hj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.hj(),this.checkReadyOnlyOnce=!1}isReady(y,g){return!0}isReadyForSubMesh(y,g,f){const p=g.materialDefines;return!!p&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=p,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(y){return null!==this.sideOrientation?this.sideOrientation:y.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(y){this._transparencyMode!==y&&(this._transparencyMode=y,this._forceAlphaTest=y===P.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===P.MATERIAL_OPAQUE||this._transparencyMode===P.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(y){return y.visibility<1||!this._disableAlphaBlending&&(y.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(y){return!this.needAlphaBlendingForMesh(y)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}hj(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=this.va().meshes;for(const f of g)if(f.og)for(const g of f.og)if(g.Ha()===this)for(const f of g._drawWrappers)f&&this._materialContext===f.materialContext&&(f._wasPreviouslyReady=!1,f._wasPreviouslyUsingInstances=null,f._forceRebindOnNextCall=y);y&&this.Vg(P.AllDirtyFlag)}_preBind(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=this._scene.getEngine(),p=(null==g?this.sideOrientation:g)===P.ClockWiseSideOrientation;return f.enableEffect(y||this._getDrawWrapper()),f.setState(this.oh,this.zOffset,!1,p,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),p}bind(y,g){}buildUniformLayout(){const y=this._uniformBuffer;this._eventInfo.ubo=y,this._callbackPluginEventGeneric(8,this._eventInfo),y.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(y,g,f){const p=f._drawWrapper;this._eventInfo.subMesh=f,this._callbackPluginEventBindForSubMesh(this._eventInfo),p._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(y){}bindView(y){this._useUBO?this._needToBindSceneUbo=!0:y.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(y){this._useUBO?this._needToBindSceneUbo=!0:(y.setMatrix("viewProjection",this.va().getTransformMatrix()),y.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(y,g){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(y,g)}_afterBind(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&g&&(this._needToBindSceneUbo=!1,(0,j.t)(g,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=y?y.visibility:1,this._onBindObservable&&y&&this._onBindObservable.notifyObservers(y),this.disableDepthWrite){const y=this._scene.getEngine();this._cachedDepthWriteState=y.getDepthWrite(),y.setDepthWrite(!1)}if(this.disableColorWrite){const y=this._scene.getEngine();this._cachedColorWriteState=y.getColorWrite(),y.setColorWrite(!1)}if(0!==this.depthFunction){const y=this._scene.getEngine();this._cachedDepthFunctionState=y.getDepthFunction()||0,y.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(y){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=y,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(y){return null}_clonePlugins(y,g){const f={};if(this._serializePlugins(f),P._ParsePlugins(f,y,this._scene,g),this.pluginManager)for(const p of this.pluginManager._plugins){const g=y.pluginManager.getPlugin(p.name);g&&p.copyTo(g)}}getBindedMeshes(){if(this.meshMap){const y=[];for(const g in this.meshMap){const f=this.meshMap[g];f&&y.push(f)}return y}return this._scene.meshes.filter((y=>y.material===this))}forceCompilation(y,g,f,p){const S={clipPlane:!1,useInstances:!1,...f},k=this.va(),i=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const H=()=>{if(!this._scene||!this._scene.getEngine())return;const f=k.clipPlane;if(S.clipPlane&&(k.clipPlane=new Z.b(0,0,0,1)),this._storeEffectOnSubMeshes){let f=!0,k=null;if(y.og){const g=new U.b(0,0,0,0,0,y,void 0,!1,!1);g.materialDefines&&(g.materialDefines._renderId=-1),this.isReadyForSubMesh(y,g,S.useInstances)||(g.effect&&g.effect.getCompilationError()&&g.effect.allFallbacksProcessed()?k=g.effect.getCompilationError():(f=!1,setTimeout(H,16)))}f&&(this.allowShaderHotSwapping=i,k&&p&&p(k),g&&g(this))}else this.isReady()?(this.allowShaderHotSwapping=i,g&&g(this)):setTimeout(H,16);S.clipPlane&&(k.clipPlane=f)};H()}forceCompilationAsync(y,g){return new Promise(((f,p)=>{this.forceCompilation(y,(()=>{f()}),g,(y=>{p(y)}))}))}Vg(y){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(P._DirtyCallbackArray.length=0,y&P.TextureDirtyFlag&&P._DirtyCallbackArray.push(P._TextureDirtyCallBack),y&P.LightDirtyFlag&&P._DirtyCallbackArray.push(P._LightsDirtyCallBack),y&P.FresnelDirtyFlag&&P._DirtyCallbackArray.push(P._FresnelDirtyCallBack),y&P.AttributesDirtyFlag&&P._DirtyCallbackArray.push(P._AttributeDirtyCallBack),y&P.MiscDirtyFlag&&P._DirtyCallbackArray.push(P._MiscDirtyCallBack),y&P.PrePassDirtyFlag&&P._DirtyCallbackArray.push(P._PrePassDirtyCallBack),P._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(P._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const y=this.va().meshes;for(const g of y)if(g.og)for(const y of g.og)y.Ha()===this&&y.resetDrawCache()}_markAllSubMeshesAsDirty(y){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const g=this.va().meshes;for(const f of g)if(f.og)for(const g of f.og)if(g.Ha(!1)===this)for(const f of g._drawWrappers)f&&f.defines&&f.defines.markAllAsDirty&&this._materialContext===f.materialContext&&y(f.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const y=this.va().enablePrePassRenderer();y&&y.Vg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(P._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(P._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(P._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(P._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(P._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(P._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(P._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(P._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(P._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(P._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const y=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.nj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(y)}))}}setPrePassRenderer(y){return!1}dispose(y,g,f){const p=this.va();if(p.stopAnimation(this),p.freeProcessedMaterials(),p.removeMaterial(this),this._eventInfo.forceDisposeTextures=g,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const y=this._parentContainer.materials.indexOf(this);y>-1&&this._parentContainer.materials.splice(y,1),this._parentContainer=null}if(!0!==f)if(this.meshMap)for(const S in this.meshMap){const g=this.meshMap[S];g&&(g.material=null,this.releaseVertexArrayObject(g,y))}else{const g=p.meshes;for(const f of g)f.material!==this||f.sourceMesh||(f.material=null,this.releaseVertexArrayObject(f,y))}this._uniformBuffer.dispose(),y&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.nj.notifyObservers(this),this.nj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(y,g){const f=y.Hj;if(f)if(this._storeEffectOnSubMeshes){if(y.og)for(const p of y.og)f._releaseVertexArrayObject(p.effect),g&&p.effect&&p.effect.dispose()}else f._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const y=q.c.Serialize(this);return y.stencil=this.stencil.serialize(),y.uniqueId=this.uniqueId,this._serializePlugins(y),y}_serializePlugins(y){if(y.plugins={},this.pluginManager)for(const g of this.pluginManager._plugins)y.plugins[g.getClassName()]=g.serialize()}static Parse(y,g,f){if(y.customType){if("BABYLON.PBRMaterial"===y.customType&&y.overloadedAlbedo&&(y.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return c.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else y.customType="BABYLON.StandardMaterial";const p=k.e.Instantiate(y.customType).Parse(y,g,f);return p._loadedUniqueId=y.uniqueId,p}static _ParsePlugins(y,g,f,p){if(y.plugins)for(const H in y.plugins){var S,i;const U=y.plugins[H];let l=null===(S=g.pluginManager)||void 0===S?void 0:S.getPlugin(U.name);if(!l){const y=k.e.Instantiate("BABYLON."+H);y&&(l=new y(g))}null===(i=l)||void 0===i||i.parse(U,f,p)}}}P.TriangleFillMode=0,P.WireFrameFillMode=1,P.PointFillMode=2,P.PointListDrawMode=3,P.LineListDrawMode=4,P.LineLoopDrawMode=5,P.LineStripDrawMode=6,P.TriangleStripDrawMode=7,P.TriangleFanDrawMode=8,P.ClockWiseSideOrientation=0,P.CounterClockWiseSideOrientation=1,P.TextureDirtyFlag=1,P.LightDirtyFlag=2,P.FresnelDirtyFlag=4,P.AttributesDirtyFlag=8,P.MiscDirtyFlag=16,P.PrePassDirtyFlag=32,P.AllDirtyFlag=63,P.MATERIAL_OPAQUE=0,P.MATERIAL_ALPHATEST=1,P.MATERIAL_ALPHABLEND=2,P.MATERIAL_ALPHATESTANDBLEND=3,P.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,P.MATERIAL_NORMALBLENDMETHOD_RNM=1,P.OnEventObservable=new i.d,P._AllDirtyCallBack=y=>y.markAllAsDirty(),P._ImageProcessingDirtyCallBack=y=>y.markAsImageProcessingDirty(),P._TextureDirtyCallBack=y=>y.markAsTexturesDirty(),P._FresnelDirtyCallBack=y=>y.markAsFresnelDirty(),P._MiscDirtyCallBack=y=>y.markAsMiscDirty(),P._PrePassDirtyCallBack=y=>y.markAsPrePassDirty(),P._LightsDirtyCallBack=y=>y.markAsLightDirty(),P._AttributeDirtyCallBack=y=>y.markAsAttributesDirty(),P._FresnelAndMiscDirtyCallBack=y=>{P._FresnelDirtyCallBack(y),P._MiscDirtyCallBack(y)},P._TextureAndMiscDirtyCallBack=y=>{P._TextureDirtyCallBack(y),P._MiscDirtyCallBack(y)},P._DirtyCallbackArray=[],P._RunDirtyCallBacks=y=>{for(const g of P._DirtyCallbackArray)g(y)},(0,p.c)([(0,S.I)()],P.prototype,"id",void 0),(0,p.c)([(0,S.I)()],P.prototype,"uniqueId",void 0),(0,p.c)([(0,S.I)()],P.prototype,"name",void 0),(0,p.c)([(0,S.I)()],P.prototype,"metadata",void 0),(0,p.c)([(0,S.I)()],P.prototype,"checkReadyOnEveryCall",void 0),(0,p.c)([(0,S.I)()],P.prototype,"checkReadyOnlyOnce",void 0),(0,p.c)([(0,S.I)()],P.prototype,"state",void 0),(0,p.c)([(0,S.I)("alpha")],P.prototype,"_alpha",void 0),(0,p.c)([(0,S.I)("oh")],P.prototype,"_backFaceCulling",void 0),(0,p.c)([(0,S.I)("cullBackFaces")],P.prototype,"_cullBackFaces",void 0),(0,p.c)([(0,S.I)()],P.prototype,"sideOrientation",void 0),(0,p.c)([(0,S.I)("alphaMode")],P.prototype,"_alphaMode",void 0),(0,p.c)([(0,S.I)()],P.prototype,"_needDepthPrePass",void 0),(0,p.c)([(0,S.I)()],P.prototype,"disableDepthWrite",void 0),(0,p.c)([(0,S.I)()],P.prototype,"disableColorWrite",void 0),(0,p.c)([(0,S.I)()],P.prototype,"forceDepthWrite",void 0),(0,p.c)([(0,S.I)()],P.prototype,"depthFunction",void 0),(0,p.c)([(0,S.I)()],P.prototype,"separateCullingPass",void 0),(0,p.c)([(0,S.I)("fogEnabled")],P.prototype,"_fogEnabled",void 0),(0,p.c)([(0,S.I)()],P.prototype,"pointSize",void 0),(0,p.c)([(0,S.I)()],P.prototype,"zOffset",void 0),(0,p.c)([(0,S.I)()],P.prototype,"zOffsetUnits",void 0),(0,p.c)([(0,S.I)()],P.prototype,"pointsCloud",null),(0,p.c)([(0,S.I)()],P.prototype,"fillMode",null),(0,p.c)([(0,S.I)()],P.prototype,"useLogarithmicDepth",null),(0,p.c)([(0,S.I)()],P.prototype,"transparencyMode",null)},11253:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{constructor(y){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=y,y)for(const g in y)Object.prototype.hasOwnProperty.call(y,g)&&this._setDefaultValue(g)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||y,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const y of Object.keys(this))"_"!==y[0]&&this._keys.push(y);if(this._externalProperties)for(const y in this._externalProperties)-1===this._keys.indexOf(y)&&this._keys.push(y)}isEqual(y){if(this._keys.length!==y._keys.length)return!1;for(let g=0;g<this._keys.length;g++){const f=this._keys[g];if(this[f]!==y[f])return!1}return!0}cloneTo(y){this._keys.length!==y._keys.length&&(y._keys=this._keys.slice(0));for(let g=0;g<this._keys.length;g++){const f=this._keys[g];y[f]=this[f]}}reset(){this._keys.forEach((y=>this._setDefaultValue(y)))}_setDefaultValue(y){var g,f,p,S;const k=(null===(g=this._externalProperties)||void 0===g||null===(f=g[y])||void 0===f?void 0:f.type)??typeof this[y],i=null===(p=this._externalProperties)||void 0===p||null===(S=p[y])||void 0===S?void 0:S.default;switch(k){case"number":this[y]=i??0;break;case"string":this[y]=i??"";break;default:this[y]=i??!1}}toString(){let y="";for(let g=0;g<this._keys.length;g++){const f=this._keys[g],p=this[f];switch(typeof p){case"number":case"string":y+="#define "+f+" "+p+"\n";break;default:p&&(y+="#define "+f+"\n")}}return y}}},11285:(y,g,f)=>{"use strict";f.d(g,{b:()=>S});var p=f(10797);class S{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(y){this._DiffuseTextureEnabled!==y&&(this._DiffuseTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(y){this._DetailTextureEnabled!==y&&(this._DetailTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(y){this._DecalMapEnabled!==y&&(this._DecalMapEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(y){this._AmbientTextureEnabled!==y&&(this._AmbientTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(y){this._OpacityTextureEnabled!==y&&(this._OpacityTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(y){this._ReflectionTextureEnabled!==y&&(this._ReflectionTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(y){this._EmissiveTextureEnabled!==y&&(this._EmissiveTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(y){this._SpecularTextureEnabled!==y&&(this._SpecularTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(y){this._BumpTextureEnabled!==y&&(this._BumpTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(y){this._LightmapTextureEnabled!==y&&(this._LightmapTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(y){this._RefractionTextureEnabled!==y&&(this._RefractionTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(y){this._ColorGradingTextureEnabled!==y&&(this._ColorGradingTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(y){this._FresnelEnabled!==y&&(this._FresnelEnabled=y,p.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(y){this._ClearCoatTextureEnabled!==y&&(this._ClearCoatTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(y){this._ClearCoatBumpTextureEnabled!==y&&(this._ClearCoatBumpTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(y){this._ClearCoatTintTextureEnabled!==y&&(this._ClearCoatTintTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(y){this._SheenTextureEnabled!==y&&(this._SheenTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(y){this._AnisotropicTextureEnabled!==y&&(this._AnisotropicTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(y){this._ThicknessTextureEnabled!==y&&(this._ThicknessTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(y){this._RefractionIntensityTextureEnabled!==y&&(this._RefractionIntensityTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(y){this._TranslucencyIntensityTextureEnabled!==y&&(this._TranslucencyIntensityTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(y){this._TranslucencyColorTextureEnabled!==y&&(this._TranslucencyColorTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(y){this._IridescenceTextureEnabled!==y&&(this._IridescenceTextureEnabled=y,p.b.MarkAllMaterialsAsDirty(1))}}S._DiffuseTextureEnabled=!0,S._DetailTextureEnabled=!0,S._DecalMapEnabled=!0,S._AmbientTextureEnabled=!0,S._OpacityTextureEnabled=!0,S._ReflectionTextureEnabled=!0,S._EmissiveTextureEnabled=!0,S._SpecularTextureEnabled=!0,S._BumpTextureEnabled=!0,S._LightmapTextureEnabled=!0,S._RefractionTextureEnabled=!0,S._ColorGradingTextureEnabled=!0,S._FresnelEnabled=!0,S._ClearCoatTextureEnabled=!0,S._ClearCoatBumpTextureEnabled=!0,S._ClearCoatTintTextureEnabled=!0,S._SheenTextureEnabled=!0,S._AnisotropicTextureEnabled=!0,S._ThicknessTextureEnabled=!0,S._RefractionIntensityTextureEnabled=!0,S._TranslucencyIntensityTextureEnabled=!0,S._TranslucencyColorTextureEnabled=!0,S._IridescenceTextureEnabled=!0},11242:(y,g,f)=>{"use strict";f.d(g,{C:()=>T,F:()=>Q,H:()=>Z,K:()=>Y,L:()=>I,P:()=>w,R:()=>j,S:()=>a,W:()=>n,X:()=>M,_:()=>r,ab:()=>b,db:()=>C,e:()=>R,i:()=>c,m:()=>z,q:()=>l,s:()=>q,t:()=>W,u:()=>P,x:()=>m,z:()=>B});var p=f(10736),S=f(11090),k=f(10761),i=f(11194),H=f(11249);const U=S.c.Black();function l(y,g,f){if(!y||y.LOGARITHMICDEPTH||y.indexOf&&y.indexOf("LOGARITHMICDEPTH")>=0){const y=f.activeCamera;1===y.mode&&p.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),g.setFloat("logarithmicDepthConstant",2/(Math.log(y.maxZ+1)/Math.LN2))}}function c(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];f&&y.fogEnabled&&(!g||g.applyFog)&&0!==y.fogMode&&(f.setFloat4("vFogInfos",y.fogMode,y.fogStart,y.fogEnd,y.fogDensity),p?(y.fogColor.toLinearSpaceToRef(U,y.getEngine().useExactSrgbConversions),f.setColor3("vFogColor",U)):f.setColor3("vFogColor",y.fogColor))}function Z(y,g,f){const S=f.NUM_MORPH_INFLUENCERS;if(S>0&&k.d.LastCreatedEngine){const i=k.d.LastCreatedEngine.getCaps().maxVertexAttribs,H=g.morphTargetManager;if(null!==H&&void 0!==H&&H.isUsingTextureForTargets)return;const U=H&&H.supportsNormals&&f.NORMAL,l=H&&H.supportsTangents&&f.TANGENT,c=H&&H.supportsUVs&&f.UV1;for(let f=0;f<S;f++)y.push("position"+f),U&&y.push("normal"+f),l&&y.push("tangent"+f),c&&y.push("uv_"+f),y.length>i&&p.d.Error("Cannot add more vertex attributes for mesh "+g.name)}}function C(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y.push("world0"),y.push("world1"),y.push("world2"),y.push("world3"),g&&(y.push("previousWorld0"),y.push("previousWorld1"),y.push("previousWorld2"),y.push("previousWorld3"))}function q(y,g){const f=y.morphTargetManager;y&&f&&g.setFloatArray("morphTargetInfluences",f.influences)}function W(y,g){g.bindToEffect(y,"Scene")}function j(y,g,f){g._needUVs=!0,g[f]=!0,y.optimizeUVAllocation&&y.getTextureMatrix().isIdentityAs3x2()?(g[f+"DIRECTUV"]=y.coordinatesIndex+1,g["MAINUV"+(y.coordinatesIndex+1)]=!0):g[f+"DIRECTUV"]=0}function P(y,g,f){const p=y.getTextureMatrix();g.Lj(f+"Matrix",p)}function B(y,g,f){f.BAKED_VERTEX_ANIMATION_TEXTURE&&f.INSTANCES&&y.push("bakedVertexAnimationSettingsInstanced")}function R(y,g,f){var p;if(g&&y&&(y.computeBonesUsingShaders&&g._bonesComputationForcedToCPU&&(y.computeBonesUsingShaders=!1),y.useBones&&y.computeBonesUsingShaders&&y.skeleton)){const S=y.skeleton;if(S.isUsingTextureForMatrices&&g.getUniformIndex("boneTextureWidth")>-1){const f=S.getTransformMatrixTexture(y);g.setTexture("boneSampler",f),g.setFloat("boneTextureWidth",4*(S.bones.length+1))}else{const k=S.getTransformMatrices(y);k&&(g.setMatrices("mBones",k),f&&y.va().prePassRenderer&&y.va().prePassRenderer.getIndex(2)&&(f.previousBones[y.uniqueId]||(f.previousBones[y.uniqueId]=k.slice()),g.setMatrices("mPreviousBones",f.previousBones[y.uniqueId]),p=k,f.previousBones[y.uniqueId].set(p)))}}}function G(y,g,f,p,S){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];y._bindLight(g,f,p,S,k)}function z(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const k=Math.min(g.lightSources.length,S);for(let i=0;i<k;i++){G(g.lightSources[i],i,y,f,"boolean"===typeof p?p:p.SPECULARTERM,g.receiveShadows)}}function T(y,g,f,p){f.NUM_BONE_INFLUENCERS>0&&(p.addCPUSkinningFallback(0,g),y.push("matricesIndices"),y.push("matricesWeights"),f.NUM_BONE_INFLUENCERS>4&&(y.push("matricesIndicesExtra"),y.push("matricesWeightsExtra")))}function Q(y,g){(g.INSTANCES||g.THIN_INSTANCES)&&C(y,!!g.PREPASS_VELOCITY),g.INSTANCESCOLOR&&y.push("instanceColor")}function m(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=0;for(let k=0;k<f&&y["LIGHT"+k];k++)k>0&&(S=p+k,g.addFallback(S,"LIGHT"+k)),y.SHADOWS||(y["SHADOW"+k]&&g.addFallback(p,"SHADOW"+k),y["SHADOWPCF"+k]&&g.addFallback(p,"SHADOWPCF"+k),y["SHADOWPCSS"+k]&&g.addFallback(p,"SHADOWPCSS"+k),y["SHADOWPOISSON"+k]&&g.addFallback(p,"SHADOWPOISSON"+k),y["SHADOWESM"+k]&&g.addFallback(p,"SHADOWESM"+k),y["SHADOWCLOSEESM"+k]&&g.addFallback(p,"SHADOWCLOSEESM"+k));return S++}function a(y,g,f,p,S,k,i){let H=arguments.length>7&&void 0!==arguments[7]&&arguments[7];i._areMiscDirty&&(i.LOGARITHMICDEPTH=f,i.POINTSIZE=p,i.FOG=S&&function(y,g){return g.fogEnabled&&y.applyFog&&0!==g.fogMode}(y,g),i.NONUNIFORMSCALING=y.nonUniformScaling,i.ALPHATEST=k,i.DECAL_AFTER_DETAIL=H)}function w(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!f._areLightsDirty)return f._needNormals;let i=0;const H={needNormals:f._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(y.lightsEnabled&&!k)for(const l of g.lightSources)if(o(y,g,l,i,f,p,H),i++,i===S)break;f.SPECULARTERM=H.specularEnabled,f.SHADOWS=H.shadowEnabled;for(let l=i;l<S;l++)void 0!==f["LIGHT"+l]&&(f["LIGHT"+l]=!1,f["HEMILIGHT"+l]=!1,f["POINTLIGHT"+l]=!1,f["DIRLIGHT"+l]=!1,f["SPOTLIGHT"+l]=!1,f["SHADOW"+l]=!1,f["SHADOWCSM"+l]=!1,f["SHADOWCSMDEBUG"+l]=!1,f["SHADOWCSMNUM_CASCADES"+l]=!1,f["SHADOWCSMUSESHADOWMAXZ"+l]=!1,f["SHADOWCSMNOBLEND"+l]=!1,f["SHADOWCSM_RIGHTHANDED"+l]=!1,f["SHADOWPCF"+l]=!1,f["SHADOWPCSS"+l]=!1,f["SHADOWPOISSON"+l]=!1,f["SHADOWESM"+l]=!1,f["SHADOWCLOSEESM"+l]=!1,f["SHADOWCUBE"+l]=!1,f["SHADOWLOWQUALITY"+l]=!1,f["SHADOWMEDIUMQUALITY"+l]=!1);const U=y.getEngine().getCaps();return void 0===f.SHADOWFLOAT&&(H.needRebuild=!0),f.SHADOWFLOAT=H.shadowEnabled&&(U.textureFloatRender&&U.textureFloatLinearFiltering||U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering),f.LIGHTMAPEXCLUDED=H.lightmapMode,H.needRebuild&&f.rebuild(),H.needNormals}function o(y,g,f,p,S,k,H){switch(H.needNormals=!0,void 0===S["LIGHT"+p]&&(H.needRebuild=!0),S["LIGHT"+p]=!0,S["SPOTLIGHT"+p]=!1,S["HEMILIGHT"+p]=!1,S["POINTLIGHT"+p]=!1,S["DIRLIGHT"+p]=!1,f.prepareLightSpecificDefines(S,p),S["LIGHT_FALLOFF_PHYSICAL"+p]=!1,S["LIGHT_FALLOFF_GLTF"+p]=!1,S["LIGHT_FALLOFF_STANDARD"+p]=!1,f.falloffType){case i.b.FALLOFF_GLTF:S["LIGHT_FALLOFF_GLTF"+p]=!0;break;case i.b.FALLOFF_PHYSICAL:S["LIGHT_FALLOFF_PHYSICAL"+p]=!0;break;case i.b.FALLOFF_STANDARD:S["LIGHT_FALLOFF_STANDARD"+p]=!0}if(k&&!f.Hh.equalsFloats(0,0,0)&&(H.specularEnabled=!0),S["SHADOW"+p]=!1,S["SHADOWCSM"+p]=!1,S["SHADOWCSMDEBUG"+p]=!1,S["SHADOWCSMNUM_CASCADES"+p]=!1,S["SHADOWCSMUSESHADOWMAXZ"+p]=!1,S["SHADOWCSMNOBLEND"+p]=!1,S["SHADOWCSM_RIGHTHANDED"+p]=!1,S["SHADOWPCF"+p]=!1,S["SHADOWPCSS"+p]=!1,S["SHADOWPOISSON"+p]=!1,S["SHADOWESM"+p]=!1,S["SHADOWCLOSEESM"+p]=!1,S["SHADOWCUBE"+p]=!1,S["SHADOWLOWQUALITY"+p]=!1,S["SHADOWMEDIUMQUALITY"+p]=!1,g&&g.receiveShadows&&y.shadowsEnabled&&f.shadowEnabled){const g=f.getShadowGenerator(y.activeCamera)??f.getShadowGenerator();if(g){const y=g.getShadowMap();y&&y.renderList&&y.renderList.length>0&&(H.shadowEnabled=!0,g.prepareDefines(S,p))}}f.lightmapMode!=i.b.LIGHTMAP_DEFAULT?(H.lightmapMode=!0,S["LIGHTMAPEXCLUDED"+p]=!0,S["LIGHTMAPNOSPECULAR"+p]=f.lightmapMode==i.b.LIGHTMAP_SHADOWSONLY):(S["LIGHTMAPEXCLUDED"+p]=!1,S["LIGHTMAPNOSPECULAR"+p]=!1)}function I(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=function(y,g){let f=!1;if(y.activeCamera){const p=g.CAMERA_ORTHOGRAPHIC?1:0,S=g.CAMERA_PERSPECTIVE?1:0,k=1===y.activeCamera.mode?1:0,i=0===y.activeCamera.mode?1:0;(p^k||S^i)&&(g.CAMERA_ORTHOGRAPHIC=1===k,g.CAMERA_PERSPECTIVE=1===i,f=!0)}return f}(y,p);!1!==k&&(U=(0,H.h)(f,y,p)),p.DEPTHPREPASS!==!g.getColorWrite()&&(p.DEPTHPREPASS=!p.DEPTHPREPASS,U=!0),p.INSTANCES!==S&&(p.INSTANCES=S,U=!0),p.THIN_INSTANCES!==i&&(p.THIN_INSTANCES=i,U=!0),U&&p.markAsUnprocessed()}function Y(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!g._areAttributesDirty&&g._needNormals===g._normals&&g._needUVs===g._uvs)return!1;g._normals=g._needNormals,g._uvs=g._needUVs,g.NORMAL=g._needNormals&&y.isVerticesDataPresent("normal"),g._needNormals&&y.isVerticesDataPresent("tangent")&&(g.TANGENT=!0);for(let H=1;H<=6;++H)g["UV"+H]=!!g._needUVs&&y.isVerticesDataPresent(`uv${1===H?"":H}`);if(f){const f=y.useVertexColors&&y.isVerticesDataPresent("color");g.VERTEXCOLOR=f,g.VERTEXALPHA=y.hasVertexAlpha&&f&&k}return y.isVerticesDataPresent("instanceColor")&&(y.hasInstances||y.hasThinInstances)&&(g.INSTANCESCOLOR=!0),p&&function(y,g){if(y.useBones&&y.computeBonesUsingShaders&&y.skeleton){g.NUM_BONE_INFLUENCERS=y.numBoneInfluencers;const f=void 0!==g.BONETEXTURE;if(y.skeleton.isUsingTextureForMatrices&&f)g.BONETEXTURE=!0;else{g.BonesPerMesh=y.skeleton.bones.length+1,g.BONETEXTURE=!f&&void 0;const p=y.va().prePassRenderer;if(p&&p.enabled){const f=-1===p.excludedSkinnedMesh.indexOf(y);g.BONES_VELOCITY_ENABLED=f}}}else g.NUM_BONE_INFLUENCERS=0,g.BonesPerMesh=0,void 0!==g.BONETEXTURE&&(g.BONETEXTURE=!1)}(y,g),S&&function(y,g){const f=y.morphTargetManager;f?(g.MORPHTARGETS_UV=f.supportsUVs&&g.UV1,g.MORPHTARGETS_TANGENT=f.supportsTangents&&g.TANGENT,g.MORPHTARGETS_NORMAL=f.supportsNormals&&g.NORMAL,g.NUM_MORPH_INFLUENCERS=f.numMaxInfluencers||f.numInfluencers,g.MORPHTARGETS=g.NUM_MORPH_INFLUENCERS>0,g.MORPHTARGETS_TEXTURE=f.isUsingTextureForTargets):(g.MORPHTARGETS_UV=!1,g.MORPHTARGETS_TANGENT=!1,g.MORPHTARGETS_NORMAL=!1,g.MORPHTARGETS=!1,g.NUM_MORPH_INFLUENCERS=0)}(y,g),i&&function(y,g){const f=y.bakedVertexAnimationManager;g.BAKED_VERTEX_ANIMATION_TEXTURE=!(!f||!f.isEnabled)}(y,g),!0}function n(y,g){if(y.activeCamera){const f=g.MULTIVIEW;g.MULTIVIEW=null!==y.activeCamera.outputRenderTarget&&y.activeCamera.outputRenderTarget.getViewCount()>1,g.MULTIVIEW!=f&&g.markAsUnprocessed()}}function M(y,g,f){const p=g.ORDER_INDEPENDENT_TRANSPARENCY,S=g.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;g.ORDER_INDEPENDENT_TRANSPARENCY=y.useOrderIndependentTransparency&&f,g.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!y.getEngine().getCaps().textureFloatLinearFiltering,p===g.ORDER_INDEPENDENT_TRANSPARENCY&&S===g.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||g.markAsUnprocessed()}function r(y,g,f){const p=g.PREPASS;if(!g._arePrePassDirty)return;const S=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(y.prePassRenderer&&y.prePassRenderer.enabled&&f){g.PREPASS=!0,g.SCENE_MRT_COUNT=y.prePassRenderer.mrtCount,g.PREPASS_NORMAL_WORLDSPACE=y.prePassRenderer.generateNormalsInWorldSpace,g.PREPASS_COLOR=!0,g.PREPASS_COLOR_INDEX=0;for(let f=0;f<S.length;f++){const p=y.prePassRenderer.getIndex(S[f].type);-1!==p?(g[S[f].define]=!0,g[S[f].index]=p):g[S[f].define]=!1}}else{g.PREPASS=!1;for(let y=0;y<S.length;y++)g[S[y].define]=!1}g.PREPASS!=p&&(g.markAsUnprocessed(),g.markAsImageProcessingDirty())}function N(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];S&&S.push("Light"+y),k||(g.push("vLightData"+y,"vLightDiffuse"+y,"vLightSpecular"+y,"vLightDirection"+y,"vLightFalloff"+y,"vLightGround"+y,"lightMatrix"+y,"shadowsInfo"+y,"depthValues"+y),f.push("shadowTexture"+y),f.push("depthTexture"+y),g.push("viewFrustumZ"+y,"cascadeBlendFactor"+y,"lightSizeUVCorrection"+y,"depthCorrection"+y,"penumbraDarkness"+y,"frustumLengths"+y),p&&(f.push("projectionLightTexture"+y),g.push("textureProjectionMatrix"+y)))}function b(y,g,f){let p,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,k=null;if(y.uniformsNames){const i=y;p=i.uniformsNames,k=i.uniformBuffersNames,g=i.samplers,f=i.defines,S=i.maxSimultaneousLights||0}else p=y,g||(g=[]);for(let i=0;i<S&&f["LIGHT"+i];i++)N(i,p,g,f["PROJECTEDLIGHTTEXTURE"+i],k);f.NUM_MORPH_INFLUENCERS&&(p.push("morphTargetInfluences"),p.push("morphTargetCount")),f.BAKED_VERTEX_ANIMATION_TEXTURE&&(p.push("bakedVertexAnimationSettings"),p.push("bakedVertexAnimationTextureSizeInverted"),p.push("bakedVertexAnimationTime"),g.push("bakedVertexAnimationTexture"))}},11318:(y,g,f)=>{"use strict";f.d(g,{d:()=>k});var p,S=f(11054);!function(y){y[y.Zero=0]="Zero",y[y.One=1]="One",y[y.MaxViewZ=2]="MaxViewZ"}(p||(p={}));class k{static CreateConfiguration(y){return k._Configurations[y]={defines:{},previousWorldMatrices:{},previousViewProjection:S.c.Zero(),currentViewProjection:S.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},k._Configurations[y]}static DeleteConfiguration(y){delete k._Configurations[y]}static GetConfiguration(y){return k._Configurations[y]}static AddUniformsAndSamplers(y,g){y.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(y,g){for(const f of g)if(f.og)for(const g of f.og)g._removeDrawWrapper(y)}static PrepareDefines(y,g,f){if(!f._arePrePassDirty)return;const p=k._Configurations[y];if(!p)return;f.PREPASS=!0,f.PREPASS_COLOR=!1,f.PREPASS_COLOR_INDEX=-1;let S=0;for(let i=0;i<k.GeometryTextureDescriptions.length;i++){const y=k.GeometryTextureDescriptions[i],g=y.define,H=y.defineIndex,U=p.defines[H];void 0!==U?(f[g]=!0,f[H]=U,S++):(f[g]=!1,delete f[H])}f.SCENE_MRT_COUNT=S,f.BONES_VELOCITY_ENABLED=g.useBones&&g.computeBonesUsingShaders&&g.skeleton&&!g.skeleton.isUsingTextureForMatrices&&-1===p.excludedSkinnedMesh.indexOf(g)}static Bind(y,g,f,p){const S=k._Configurations[y];if(S&&(void 0!==S.defines.PREPASS_VELOCITY_INDEX||void 0!==S.defines.PREPASS_VELOCITY_LINEAR_INDEX)){S.previousWorldMatrices[f.uniqueId]||(S.previousWorldMatrices[f.uniqueId]=p.clone());const y=f.va();S.previousViewProjection||(S.previousViewProjection=y.getTransformMatrix().clone(),S.currentViewProjection=y.getTransformMatrix().clone());const k=y.getEngine();if(S.currentViewProjection.updateFlag!==y.getTransformMatrix().updateFlag?(S.lastUpdateFrameId=k.frameId,S.previousViewProjection.p(S.currentViewProjection),S.currentViewProjection.p(y.getTransformMatrix())):S.lastUpdateFrameId!==k.frameId&&(S.lastUpdateFrameId=k.frameId,S.previousViewProjection.p(S.currentViewProjection)),g.setMatrix("previousWorld",S.previousWorldMatrices[f.uniqueId]),g.setMatrix("previousViewProjection",S.previousViewProjection),S.previousWorldMatrices[f.uniqueId]=p.clone(),f.useBones&&f.computeBonesUsingShaders&&f.skeleton){const y=f.skeleton;if(!y.isUsingTextureForMatrices||-1===g.getUniformIndex("boneTextureWidth")){const p=y.getTransformMatrices(f);p&&(S.previousBones[f.uniqueId]||(S.previousBones[f.uniqueId]=p.slice()),g.setMatrices("mPreviousBones",S.previousBones[f.uniqueId]),S.previousBones[f.uniqueId].set(p))}}}}}k.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],k._Configurations={}},11311:(y,g,f)=>{"use strict";f.d(g,{b:()=>B});var p=f(11021),S=f(11026),k=f(11206),i=f(10761),H=f(10789),U=f(10812);const l=new RegExp("^([gimus]+)!");class c{constructor(y){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=y,this._scene=y.va(),this._engine=this._scene.getEngine()}_addPlugin(y){for(let p=0;p<this._plugins.length;++p)if(this._plugins[p].name===y.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!y.isCompatible(this._material.shaderLanguage))throw`The plugin "${y.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const g=y.getClassName();c._MaterialPluginClassToMainDefine[g]||(c._MaterialPluginClassToMainDefine[g]="MATERIALPLUGIN_"+ ++c._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(y,g)=>this._handlePluginEvent(y,g),this._plugins.push(y),this._plugins.sort(((y,g)=>y.priority-g.priority)),this._codeInjectionPoints={};const f={};f[c._MaterialPluginClassToMainDefine[g]]={type:"boolean",default:!0};for(const p of this._plugins)p.collectDefines(f),this._collectPointNames("vertex",p.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",p.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=f,!0}_activatePlugin(y){-1===this._activePlugins.indexOf(y)&&(this._activePlugins.push(y),this._activePlugins.sort(((y,g)=>y.priority-g.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),y.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(y),this._activePluginsForExtraEvents.sort(((y,g)=>y.priority-g.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(y){for(let g=0;g<this._plugins.length;++g)if(this._plugins[g].name===y)return this._plugins[g];return null}_handlePluginEventIsReadyForSubMesh(y){let g=!0;for(const f of this._activePlugins)g=g&&f.isReadyForSubMesh(y.defines,this._scene,this._engine,y.subMesh);y.isReadyForSubMesh=g}_handlePluginEventPrepareDefinesBeforeAttributes(y){for(const g of this._activePlugins)g.prepareDefinesBeforeAttributes(y.defines,this._scene,y.mesh)}_handlePluginEventPrepareDefines(y){for(const g of this._activePlugins)g.prepareDefines(y.defines,this._scene,y.mesh)}_handlePluginEventHardBindForSubMesh(y){for(const g of this._activePluginsForExtraEvents)g.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,y.subMesh)}_handlePluginEventBindForSubMesh(y){for(const g of this._activePlugins)g.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,y.subMesh)}_handlePluginEventHasRenderTargetTextures(y){let g=!1;for(const f of this._activePluginsForExtraEvents)if(g=f.hasRenderTargetTextures(),g)break;y.hasRenderTargetTextures=g}_handlePluginEventFillRenderTargetTextures(y){for(const g of this._activePluginsForExtraEvents)g.fillRenderTargetTextures(y.renderTargets)}_handlePluginEvent(y,g){switch(y){case 512:{const y=g;for(const g of this._activePlugins)g.getActiveTextures(y.activeTextures);break}case 256:{const y=g;for(const g of this._activePlugins)g.getAnimatables(y.animatables);break}case 1024:{const y=g;let f=!1;for(const g of this._activePlugins)if(f=g.hasTexture(y.texture),f)break;y.hasTexture=f;break}case 2:{const y=g;for(const g of this._plugins)g.dispose(y.forceDisposeTextures);break}case 4:g.defineNames=this._defineNamesFromPlugins;break;case 128:{const y=g;for(const g of this._activePlugins)y.fallbackRank=g.addFallbacks(y.defines,y.fallbacks,y.fallbackRank),g.getAttributes(y.attributes,this._scene,y.mesh);this._uniformList.length>0&&y.uniforms.push(...this._uniformList),this._samplerList.length>0&&y.samplers.push(...this._samplerList),this._uboList.length>0&&y.uniformBuffersNames.push(...this._uboList),y.customCode=this._injectCustomCode(y,y.customCode);break}case 8:{const y=g;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const f=1===this._material.shaderLanguage;for(const g of this._plugins){const p=g.getUniforms(this._material.shaderLanguage);if(p){if(p.ubo)for(const g of p.ubo){if(g.size&&g.type){const p=g.arraySize??0;if(y.ubo.addUniform(g.name,g.size,p),f){let y;switch(g.type){case"mat4":y="mat4x4f";break;case"float":y="f32";break;default:y=`${g.type}f`}this._uboDeclaration+=`uniform ${g.name}: ${y}${p>0?`[${p}]`:""};\n`}else this._uboDeclaration+=`${g.type} ${g.name}${p>0?`[${p}]`:""};\n`}this._uniformList.push(g.name)}p.vertex&&(this._vertexDeclaration+=p.vertex+"\n"),p.fragment&&(this._fragmentDeclaration+=p.fragment+"\n")}g.getSamplers(this._samplerList),g.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(y,g){if(g)for(const f in g)this._codeInjectionPoints[y]||(this._codeInjectionPoints[y]={}),this._codeInjectionPoints[y][f]=!0}_injectCustomCode(y,g){return(f,p)=>{var S;g&&(p=g(f,p)),this._uboDeclaration&&(p=p.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(p=p.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(p=p.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const k=null===(S=this._codeInjectionPoints)||void 0===S?void 0:S[f];if(!k)return p;let i=null;for(let g in k){let S="";for(const p of this._activePlugins){var c;let k=null===(c=p.getCustomCode(f,this._material.shaderLanguage))||void 0===c?void 0:c[g];if(k){if(p.resolveIncludes){if(null===i){const g=0;i={defines:[],indexParameters:y.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:U.e.GetShadersRepository(g),includesShadersStore:U.e.GetIncludesShadersStore(g),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}i.isFragment="fragment"===f,(0,H.j)(k,i,(y=>k=y))}S+=k+"\n"}}if(S.length>0)if("!"===g.charAt(0)){g=g.substring(1);let y="g";if("!"===g.charAt(0))y="",g=g.substring(1);else{const f=l.exec(g);f&&f.length>=2&&(y=f[1],g=g.substring(y.length+1))}y.indexOf("g")<0&&(y+="g");const f=p,k=new RegExp(g,y);let i=k.exec(f);for(;null!==i;){let y=S;for(let g=0;g<i.length;++g)y=y.replace("$"+g,i[g]);p=p.replace(i[0],y),i=k.exec(f)}}else{const y="#define "+g;p=p.replace(y,"\n"+S+"\n"+y)}}return p}}}c._MaterialPluginClassToMainDefine={},c._MaterialPluginCounter=0,i.d.OnEnginesDisposedObservable.add((()=>{W()}));const Z=[];let C=!1,q=null;function W(){Z.length=0,C=!1,k.c.OnEventObservable.remove(q),q=null}var j=f(11099),P=f(10871);class B{isCompatible(y){return 0===y}_enable(y){y&&this._pluginManager._activatePlugin(this)}constructor(y,g,f,p){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=y,this.name=g,this.priority=f,this.resolveIncludes=i,y.pluginManager||(y.pluginManager=new c(y),y.nj.add((()=>{y.pluginManager=void 0}))),this._pluginDefineNames=p,this._pluginManager=y.pluginManager,S&&this._pluginManager._addPlugin(this),k&&this._enable(!0),this.markAllDefinesAsDirty=y._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(y,g,f,p){return!0}hardBindForSubMesh(y,g,f,p){}bindForSubMesh(y,g,f,p){}dispose(y){}getCustomCode(y){return null}collectDefines(y){if(this._pluginDefineNames)for(const g of Object.keys(this._pluginDefineNames)){if("_"===g[0])continue;const f=typeof this._pluginDefineNames[g];y[g]={type:"number"===f?"number":"string"===f?"string":"boolean"===f?"boolean":"object",default:this._pluginDefineNames[g]}}}prepareDefinesBeforeAttributes(y,g,f){}prepareDefines(y,g,f){}hasTexture(y){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(y){}getActiveTextures(y){}getAnimatables(y){}addFallbacks(y,g,f){return f}getSamplers(y){}getAttributes(y,g,f){}getUniformBuffersNames(y){}getUniforms(){return{}}copyTo(y){j.c.Clone((()=>y),this)}serialize(){return j.c.Serialize(this)}parse(y,g,f){j.c.Parse((()=>this),y,g,f)}}(0,p.c)([(0,S.I)()],B.prototype,"name",void 0),(0,p.c)([(0,S.I)()],B.prototype,"priority",void 0),(0,p.c)([(0,S.I)()],B.prototype,"resolveIncludes",void 0),(0,p.c)([(0,S.I)()],B.prototype,"registerForExtraEvents",void 0),(0,P.c)("BABYLON.MaterialPluginBase",B)},11385:(y,g,f)=>{"use strict";f.d(g,{b:()=>i});var p=f(11206),S=f(11046),k=f(10871);class i extends p.c{get qg(){return this._subMaterials}set qg(y){this._subMaterials=y,this._hookArray(y)}getChildren(){return this.qg}constructor(y,g){super(y,g,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.qg=[],this._storeEffectOnSubMeshes=!0}_hookArray(y){var g=this;const f=y.push;y.push=function(){for(var p=arguments.length,S=new Array(p),k=0;k<p;k++)S[k]=arguments[k];const i=f.apply(y,S);return g._markAllSubMeshesAsTexturesDirty(),i};const p=y.splice;y.splice=(g,f)=>{const S=p.apply(y,[g,f]);return this._markAllSubMeshesAsTexturesDirty(),S}}getSubMaterial(y){return y<0||y>=this.qg.length?this.va().defaultMaterial:this.qg[y]}getActiveTextures(){return super.getActiveTextures().concat(...this.qg.map((y=>y?y.getActiveTextures():[])))}hasTexture(y){if(super.hasTexture(y))return!0;for(let f=0;f<this.qg.length;f++){var g;if(null!==(g=this.qg[f])&&void 0!==g&&g.hasTexture(y))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(y,g,f){for(let p=0;p<this.qg.length;p++){const S=this.qg[p];if(S){if(S._storeEffectOnSubMeshes){if(!S.isReadyForSubMesh(y,g,f))return!1;continue}if(!S.isReady(y))return!1}}return!0}clone(y,g){const f=new i(y,this.va());for(let p=0;p<this.qg.length;p++){let S=null;const k=this.qg[p];S=g&&k?k.clone(y+"-"+k.name):this.qg[p],f.qg.push(S)}return f}serialize(){const y={};y.name=this.name,y.id=this.id,y.uniqueId=this.uniqueId,S.e&&(y.tags=S.e.GetTags(this)),y.materialsUniqueIds=[],y.materials=[];for(let g=0;g<this.qg.length;g++){const f=this.qg[g];f?(y.materialsUniqueIds.push(f.uniqueId),y.materials.push(f.id)):(y.materialsUniqueIds.push(null),y.materials.push(null))}return y}dispose(y,g,f){const p=this.va();if(!p)return;if(f)for(let k=0;k<this.qg.length;k++){const f=this.qg[k];f&&f.dispose(y,g)}const S=p.multiMaterials.indexOf(this);S>=0&&p.multiMaterials.splice(S,1),super.dispose(y,g)}static ParseMultiMaterial(y,g){const f=new i(y.name,g);return f.id=y.id,f._loadedUniqueId=y.uniqueId,S.e&&S.e.AddTagsTo(f,y.tags),y.materialsUniqueIds?f._waitingSubMaterialsUniqueIds=y.materialsUniqueIds:y.materials.forEach((y=>f.qg.push(g.getLastMaterialById(y)))),f}}(0,k.c)("BABYLON.MultiMaterial",i)},11197:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(y){y.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(y){}bindForSubMesh(y,g,f,p,S){if(g.prePassRenderer&&g.prePassRenderer.enabled&&g.prePassRenderer.currentRTisSceneRT&&(-1!==g.prePassRenderer.getIndex(2)||-1!==g.prePassRenderer.getIndex(11))){this.previousWorldMatrices[f.uniqueId]||(this.previousWorldMatrices[f.uniqueId]=p.clone()),this.previousViewProjection||(this.previousViewProjection=g.getTransformMatrix().clone(),this.currentViewProjection=g.getTransformMatrix().clone());const S=g.getEngine();this.currentViewProjection.updateFlag!==g.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=S.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(g.getTransformMatrix())):this._lastUpdateFrameId!==S.frameId&&(this._lastUpdateFrameId=S.frameId,this.previousViewProjection.p(this.currentViewProjection)),y.setMatrix("previousWorld",this.previousWorldMatrices[f.uniqueId]),y.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[f.uniqueId]=p.clone()}}}},11262:(y,g,f)=>{"use strict";f.d(g,{e:()=>k});var p=f(11054),S=f(11206);class k extends S.c{constructor(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(y,g,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new p.c,this._storeEffectOnSubMeshes=f}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(y,g){return!!y&&(!this._storeEffectOnSubMeshes||(!y.og||0===y.og.length||this.isReadyForSubMesh(y,y.og[0],g)))}_isReadyForSubMesh(y){const g=y.materialDefines;return!(this.checkReadyOnEveryCall||!y.effect||!g||g._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(y){this._activeEffect.setMatrix("world",y)}bindOnlyNormalMatrix(y){this._activeEffect.setMatrix("normalMatrix",y)}bind(y,g){g&&this.bindForSubMesh(y,g,g.og[0])}_afterBind(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;super._afterBind(y,g,f),this.va()._cachedEffect=g,f?f._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return f._drawWrapper._forceRebindOnNextCall||y.isCachedMaterialInvalid(this,g,p)}dispose(y,g,f){this._activeEffect=void 0,super.dispose(y,g,f)}}},11015:(y,g,f)=>{"use strict";f.d(g,{b:()=>o});var p=f(11021),S=f(11026),k=f(11036),i=f(11038),H=f(11054),U=f(11090),l=f(11131),c=f(11197),Z=f(11087),C=f(11206),q=f(11253),W=f(11262),j=f(11267),P=f(10871),B=f(11285),R=f(11294),G=f(11302),z=f(11249),T=f(11242),Q=f(11099),m=f(11318);const a={effect:null,subMesh:null};class w extends q.d{constructor(y){super(y),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(y){const g=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const f of g)this[f]=f===y}}class o extends W.e{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(y){this._attachImageProcessingConfiguration(y),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(y){y!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=y||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(y){this.imageProcessingConfiguration.colorCurvesEnabled=y}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(y){this.imageProcessingConfiguration.colorGradingEnabled=y}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(y){this._imageProcessingConfiguration.toneMappingEnabled=y}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(y){this._imageProcessingConfiguration.exposure=y}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(y){this._imageProcessingConfiguration.contrast=y}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(y){this._imageProcessingConfiguration.colorGradingTexture=y}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(y){this._imageProcessingConfiguration.colorCurves=y}get canRenderToMRT(){return!0}constructor(y,g){super(y,g,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||o.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new U.c(0,0,0),this.diffuseColor=new U.c(1,1,1),this.specularColor=new U.c(1,1,1),this.emissiveColor=new U.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new k.i(16),this._worldViewProjectionMatrix=H.c.Zero(),this._globalAmbientColor=new U.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new G.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new c.d,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),o.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),o.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(o.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(o.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"nb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===C.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Be&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==C.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Be||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(y,g){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const S=g._drawWrapper;if(S.effect&&this.isFrozen&&S._wasPreviouslyReady&&S._wasPreviouslyUsingInstances===p)return!0;g.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),g.materialDefines=new w(this._eventInfo.defineNames));const k=this.va(),i=g.materialDefines;if(this._isReadyForSubMesh(g))return!0;const H=k.getEngine();i._needNormals=(0,T.P)(k,y,i,!0,this._maxSimultaneousLights,this._disableLighting),(0,T.W)(k,i);const U=this.needAlphaBlendingForMesh(y)&&this.va().useOrderIndependentTransparency;if((0,T._)(k,i,this.canRenderToMRT&&!U),(0,T.X)(k,i,U),m.d.PrepareDefines(H.currentRenderPassId,y,i),i._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,i._needUVs=!1;for(let y=1;y<=6;++y)i["MAINUV"+y]=!1;if(k.texturesEnabled){if(i.DIFFUSEDIRECTUV=0,i.BUMPDIRECTUV=0,i.AMBIENTDIRECTUV=0,i.OPACITYDIRECTUV=0,i.EMISSIVEDIRECTUV=0,i.SPECULARDIRECTUV=0,i.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&o.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,T.R)(this._diffuseTexture,i,"DIFFUSE")}else i.DIFFUSE=!1;if(this._ambientTexture&&o.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,T.R)(this._ambientTexture,i,"AMBIENT")}else i.AMBIENT=!1;if(this._opacityTexture&&o.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,T.R)(this._opacityTexture,i,"OPACITY"),i.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else i.OPACITY=!1;if(this._reflectionTexture&&o.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(i._needNormals=!0,i.REFLECTION=!0,i.ROUGHNESS=this._roughness>0,i.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,i.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===j.c.INVCUBIC_MODE,i.REFLECTIONMAP_3D=this._reflectionTexture.isCube,i.REFLECTIONMAP_OPPOSITEZ=i.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,i.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case j.c.EXPLICIT_MODE:i.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case j.c.PLANAR_MODE:i.setReflectionMode("REFLECTIONMAP_PLANAR");break;case j.c.PROJECTION_MODE:i.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case j.c.SKYBOX_MODE:i.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case j.c.SPHERICAL_MODE:i.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case j.c.EQUIRECTANGULAR_MODE:i.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case j.c.FIXED_EQUIRECTANGULAR_MODE:i.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case j.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:i.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case j.c.CUBIC_MODE:case j.c.INVCUBIC_MODE:default:i.setReflectionMode("REFLECTIONMAP_CUBIC")}i.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else i.REFLECTION=!1,i.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&o.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,T.R)(this._emissiveTexture,i,"EMISSIVE")}else i.EMISSIVE=!1;if(this._lightmapTexture&&o.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,T.R)(this._lightmapTexture,i,"LIGHTMAP"),i.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,i.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else i.LIGHTMAP=!1;if(this._specularTexture&&o.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,T.R)(this._specularTexture,i,"SPECULAR"),i.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else i.SPECULAR=!1;if(k.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&o.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,T.R)(this._bumpTexture,i,"BUMP"),i.PARALLAX=this._useParallax,i.PARALLAX_RHS=k.useRightHandedSystem,i.PARALLAXOCCLUSION=this._useParallaxOcclusion,i.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else i.BUMP=!1,i.PARALLAX=!1,i.PARALLAX_RHS=!1,i.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&o.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;i._needUVs=!0,i.REFRACTION=!0,i.REFRACTIONMAP_3D=this._refractionTexture.isCube,i.RGBDREFRACTION=this._refractionTexture.isRGBD,i.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else i.REFRACTION=!1;i.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else i.DIFFUSE=!1,i.AMBIENT=!1,i.OPACITY=!1,i.REFLECTION=!1,i.EMISSIVE=!1,i.LIGHTMAP=!1,i.BUMP=!1,i.REFRACTION=!1;i.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),i.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,i.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,i.SPECULAROVERALPHA=this._useSpecularOverAlpha,i.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,i.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,i.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(y)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._eventInfo.subMesh=g,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(i._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(i),i.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,i.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}i._areFresnelDirty&&(o.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(i.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,i.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,i.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,i.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,i.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,i.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,i._needNormals=!0,i.FRESNEL=!0):i.FRESNEL=!1),(0,T.S)(y,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(y)||this._forceAlphaTest,i,this._applyDecalMapAfterDetailMap),(0,T.L)(k,H,this,i,p,null,g.getRenderingMesh().hasThinInstances),this._eventInfo.defines=i,this._eventInfo.mesh=y,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,T.K)(y,i,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let C=!1;if(i.isDirty){const p=i._areLightsDisposed;i.markAsProcessed();const S=new R.d;i.REFLECTION&&S.addFallback(0,"REFLECTION"),i.SPECULAR&&S.addFallback(0,"SPECULAR"),i.BUMP&&S.addFallback(0,"BUMP"),i.PARALLAX&&S.addFallback(1,"PARALLAX"),i.PARALLAX_RHS&&S.addFallback(1,"PARALLAX_RHS"),i.PARALLAXOCCLUSION&&S.addFallback(0,"PARALLAXOCCLUSION"),i.SPECULAROVERALPHA&&S.addFallback(0,"SPECULAROVERALPHA"),i.FOG&&S.addFallback(1,"FOG"),i.POINTSIZE&&S.addFallback(0,"POINTSIZE"),i.LOGARITHMICDEPTH&&S.addFallback(0,"LOGARITHMICDEPTH"),(0,T.x)(i,S,this._maxSimultaneousLights),i.SPECULARTERM&&S.addFallback(0,"SPECULARTERM"),i.DIFFUSEFRESNEL&&S.addFallback(1,"DIFFUSEFRESNEL"),i.OPACITYFRESNEL&&S.addFallback(2,"OPACITYFRESNEL"),i.REFLECTIONFRESNEL&&S.addFallback(3,"REFLECTIONFRESNEL"),i.EMISSIVEFRESNEL&&S.addFallback(4,"EMISSIVEFRESNEL"),i.FRESNEL&&S.addFallback(4,"FRESNEL"),i.MULTIVIEW&&S.addFallback(0,"MULTIVIEW");const U=[l.c.PositionKind];i.NORMAL&&U.push(l.c.NormalKind),i.TANGENT&&U.push(l.c.TangentKind);for(let y=1;y<=6;++y)i["UV"+y]&&U.push(`uv${1===y?"":y}`);i.VERTEXCOLOR&&U.push(l.c.ColorKind),(0,T.C)(U,y,i,S),(0,T.F)(U,i),(0,T.H)(U,y,i),(0,T.z)(U,y,i);let q="default";const W=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],j=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],P=["Material","Scene","Mesh"],B={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:i.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=S,this._eventInfo.fallbackRank=0,this._eventInfo.defines=i,this._eventInfo.uniforms=W,this._eventInfo.attributes=U,this._eventInfo.samplers=j,this._eventInfo.uniformBuffersNames=P,this._eventInfo.customCode=void 0,this._eventInfo.mesh=y,this._eventInfo.indexParameters=B,this._callbackPluginEventGeneric(128,this._eventInfo),m.d.AddUniformsAndSamplers(W,j),c.d.AddUniforms(W),c.d.AddSamplers(j),Z.b&&(Z.b.PrepareUniforms(W,i),Z.b.PrepareSamplers(j,i)),(0,T.ab)({uniformsNames:W,uniformBuffersNames:P,samplers:j,defines:i,maxSimultaneousLights:this._maxSimultaneousLights}),(0,z.c)(W);const G={};this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,W,P,j,i,U,G));const Q=i.toString(),w=g.effect;let o=k.getEngine().createEffect(q,{attributes:U,uniformsNames:W,uniformBuffersNames:P,samplers:j,defines:Q,fallbacks:S,onCompiled:this.onCompiled,onError:this.onError,indexParameters:B,processFinalCode:G.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:i.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([f.e(21),f.e(19)]).then(f.bind(f,13050)),Promise.all([f.e(22),f.e(20)]).then(f.bind(f,13201))]):await Promise.all([Promise.all([f.e(25),f.e(24)]).then(f.bind(f,13279)),Promise.all([f.e(27),f.e(26)]).then(f.bind(f,13426))]),this._shadersLoaded=!0}},H);if(this._eventInfo.customCode=void 0,o)if(this._onEffectCreatedObservable&&(a.effect=o,a.subMesh=g,this._onEffectCreatedObservable.notifyObservers(a)),this.allowShaderHotSwapping&&w&&!o.isReady()){if(o=w,i.markAsUnprocessed(),C=this.isFrozen,p)return i._areLightsDisposed=!0,!1}else k.resetCachedMaterial(),g.setEffect(o,i,this._materialContext)}return!(!g.effect||!g.effect.isReady())&&(i._renderId=k.getRenderId(),S._wasPreviouslyReady=!C,S._wasPreviouslyUsingInstances=p,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const y=this._uniformBuffer;y.addUniform("diffuseLeftColor",4),y.addUniform("diffuseRightColor",4),y.addUniform("opacityParts",4),y.addUniform("reflectionLeftColor",4),y.addUniform("reflectionRightColor",4),y.addUniform("refractionLeftColor",4),y.addUniform("refractionRightColor",4),y.addUniform("emissiveLeftColor",4),y.addUniform("emissiveRightColor",4),y.addUniform("vDiffuseInfos",2),y.addUniform("vAmbientInfos",2),y.addUniform("vOpacityInfos",2),y.addUniform("vReflectionInfos",2),y.addUniform("vReflectionPosition",3),y.addUniform("vReflectionSize",3),y.addUniform("vEmissiveInfos",2),y.addUniform("vLightmapInfos",2),y.addUniform("vSpecularInfos",2),y.addUniform("vBumpInfos",3),y.addUniform("diffuseMatrix",16),y.addUniform("ambientMatrix",16),y.addUniform("opacityMatrix",16),y.addUniform("reflectionMatrix",16),y.addUniform("emissiveMatrix",16),y.addUniform("lightmapMatrix",16),y.addUniform("specularMatrix",16),y.addUniform("bumpMatrix",16),y.addUniform("vTangentSpaceParams",2),y.addUniform("pointSize",1),y.addUniform("alphaCutOff",1),y.addUniform("refractionMatrix",16),y.addUniform("vRefractionInfos",4),y.addUniform("vRefractionPosition",3),y.addUniform("vRefractionSize",3),y.addUniform("vSpecularColor",4),y.addUniform("vEmissiveColor",3),y.addUniform("vDiffuseColor",4),y.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(y,g,f){const p=this.va(),S=f.materialDefines;if(!S)return;const k=f.effect;if(!k)return;this._activeEffect=k,g.getMeshUniformBuffer().bindToEffect(k,"Mesh"),g.transferToEffect(y),this._uniformBuffer.bindToEffect(k,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,p,g,y,this.isFrozen),m.d.Bind(p.getEngine().currentRenderPassId,this._activeEffect,g,y),this._eventInfo.subMesh=f,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),S.OBJECTSPACE_NORMALMAP&&(y.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const H=this._mustRebind(p,k,f,g.visibility);(0,T.e)(g,k);const l=this._uniformBuffer;if(H){if(this.bindViewProjection(k),!l.useUbo||!this.isFrozen||!l.isSync||f._drawWrapper._forceRebindOnNextCall){if(o.FresnelEnabled&&S.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new U.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),p.texturesEnabled){if(this._diffuseTexture&&o.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,T.u)(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&o.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,T.u)(this._ambientTexture,l,"ambient")),this._opacityTexture&&o.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,T.u)(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&o.ReflectionTextureEnabled&&(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.Lj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const y=this._reflectionTexture;l.updateVector3("vReflectionPosition",y.boundingBoxPosition),l.updateVector3("vReflectionSize",y.boundingBoxSize)}if(this._emissiveTexture&&o.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,T.u)(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&o.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,T.u)(this._lightmapTexture,l,"lightmap")),this._specularTexture&&o.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,T.u)(this._specularTexture,l,"specular")),this._bumpTexture&&p.getEngine().getCaps().standardDerivatives&&o.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,T.u)(this._bumpTexture,l,"bump"),p._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&o.RefractionTextureEnabled){let y=1;if(this._refractionTexture.isCube||(l.Lj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(y=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,y,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const y=this._refractionTexture;l.updateVector3("vRefractionPosition",y.boundingBoxPosition),l.updateVector3("vRefractionSize",y.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",o.EmissiveTextureEnabled?this.emissiveColor:U.c.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),p.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}p.texturesEnabled&&(this._diffuseTexture&&o.DiffuseTextureEnabled&&k.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&o.AmbientTextureEnabled&&k.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&o.OpacityTextureEnabled&&k.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&o.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?k.setTexture("reflectionCubeSampler",this._reflectionTexture):k.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&o.EmissiveTextureEnabled&&k.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&o.LightmapTextureEnabled&&k.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&o.SpecularTextureEnabled&&k.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&p.getEngine().getCaps().standardDerivatives&&o.BumpTextureEnabled&&k.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&o.RefractionTextureEnabled&&(this._refractionTexture.isCube?k.setTexture("refractionCubeSampler",this._refractionTexture):k.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(g)&&this.va().depthPeelingRenderer.bind(k),this._eventInfo.subMesh=f,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,z.g)(k,this,p),this.bindEyePosition(k)}else p.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(H||!this.isFrozen){var c;if(p.lightsEnabled&&!this._disableLighting&&(0,T.m)(p,g,k,S,this._maxSimultaneousLights),(p.fogEnabled&&g.applyFog&&p.fogMode!==i.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||g.receiveShadows||S.PREPASS)&&this.bindView(k),(0,T.i)(p,g,k),S.NUM_MORPH_INFLUENCERS&&(0,T.s)(g,k),S.BAKED_VERTEX_ANIMATION_TEXTURE)null===(c=g.bakedVertexAnimationManager)||void 0===c||c.bind(k,S.INSTANCES);this.useLogarithmicDepth&&(0,T.q)(S,k,p),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(g,this._activeEffect,f),l.update()}getAnimatables(){const y=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&y.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&y.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&y.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&y.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&y.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&y.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&y.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&y.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&y.push(this._refractionTexture),y}getActiveTextures(){const y=super.getActiveTextures();return this._diffuseTexture&&y.push(this._diffuseTexture),this._ambientTexture&&y.push(this._ambientTexture),this._opacityTexture&&y.push(this._opacityTexture),this._reflectionTexture&&y.push(this._reflectionTexture),this._emissiveTexture&&y.push(this._emissiveTexture),this._specularTexture&&y.push(this._specularTexture),this._bumpTexture&&y.push(this._bumpTexture),this._lightmapTexture&&y.push(this._lightmapTexture),this._refractionTexture&&y.push(this._refractionTexture),y}hasTexture(y){return!!super.hasTexture(y)||(this._diffuseTexture===y||(this._ambientTexture===y||(this._opacityTexture===y||(this._reflectionTexture===y||(this._emissiveTexture===y||(this._specularTexture===y||(this._bumpTexture===y||(this._lightmapTexture===y||this._refractionTexture===y))))))))}dispose(y,g){var f,p,S,k,i,H,U,l,c;g&&(null===(f=this._diffuseTexture)||void 0===f||f.dispose(),null===(p=this._ambientTexture)||void 0===p||p.dispose(),null===(S=this._opacityTexture)||void 0===S||S.dispose(),null===(k=this._reflectionTexture)||void 0===k||k.dispose(),null===(i=this._emissiveTexture)||void 0===i||i.dispose(),null===(H=this._specularTexture)||void 0===H||H.dispose(),null===(U=this._bumpTexture)||void 0===U||U.dispose(),null===(l=this._lightmapTexture)||void 0===l||l.dispose(),null===(c=this._refractionTexture)||void 0===c||c.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(y,g)}clone(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const p=Q.c.Clone((()=>new o(y,this.va())),this,{cloneTexturesOnlyOnce:g});return p.name=y,p.id=y,this.stencil.copyTo(p.stencil),this._clonePlugins(p,f),p}static Parse(y,g,f){const p=Q.c.Parse((()=>new o(y.name,g)),y,g,f);return y.stencil&&p.stencil.parse(y.stencil,g,f),C.c._ParsePlugins(y,p,g,f),p}static get DiffuseTextureEnabled(){return B.b.DiffuseTextureEnabled}static set DiffuseTextureEnabled(y){B.b.DiffuseTextureEnabled=y}static get DetailTextureEnabled(){return B.b.DetailTextureEnabled}static set DetailTextureEnabled(y){B.b.DetailTextureEnabled=y}static get AmbientTextureEnabled(){return B.b.AmbientTextureEnabled}static set AmbientTextureEnabled(y){B.b.AmbientTextureEnabled=y}static get OpacityTextureEnabled(){return B.b.OpacityTextureEnabled}static set OpacityTextureEnabled(y){B.b.OpacityTextureEnabled=y}static get ReflectionTextureEnabled(){return B.b.ReflectionTextureEnabled}static set ReflectionTextureEnabled(y){B.b.ReflectionTextureEnabled=y}static get EmissiveTextureEnabled(){return B.b.EmissiveTextureEnabled}static set EmissiveTextureEnabled(y){B.b.EmissiveTextureEnabled=y}static get SpecularTextureEnabled(){return B.b.SpecularTextureEnabled}static set SpecularTextureEnabled(y){B.b.SpecularTextureEnabled=y}static get BumpTextureEnabled(){return B.b.BumpTextureEnabled}static set BumpTextureEnabled(y){B.b.BumpTextureEnabled=y}static get LightmapTextureEnabled(){return B.b.LightmapTextureEnabled}static set LightmapTextureEnabled(y){B.b.LightmapTextureEnabled=y}static get RefractionTextureEnabled(){return B.b.RefractionTextureEnabled}static set RefractionTextureEnabled(y){B.b.RefractionTextureEnabled=y}static get ColorGradingTextureEnabled(){return B.b.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(y){B.b.ColorGradingTextureEnabled=y}static get FresnelEnabled(){return B.b.FresnelEnabled}static set FresnelEnabled(y){B.b.FresnelEnabled=y}}o.ForceGLSL=!1,(0,p.c)([(0,S.E)("diffuseTexture")],o.prototype,"_diffuseTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"diffuseTexture",void 0),(0,p.c)([(0,S.E)("ambientTexture")],o.prototype,"_ambientTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTexture",void 0),(0,p.c)([(0,S.E)("opacityTexture")],o.prototype,"_opacityTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"opacityTexture",void 0),(0,p.c)([(0,S.E)("reflectionTexture")],o.prototype,"_reflectionTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectionTexture",void 0),(0,p.c)([(0,S.E)("emissiveTexture")],o.prototype,"_emissiveTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveTexture",void 0),(0,p.c)([(0,S.E)("specularTexture")],o.prototype,"_specularTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"specularTexture",void 0),(0,p.c)([(0,S.E)("bumpTexture")],o.prototype,"_bumpTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"bumpTexture",void 0),(0,p.c)([(0,S.E)("lightmapTexture")],o.prototype,"_lightmapTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"lightmapTexture",void 0),(0,p.c)([(0,S.E)("refractionTexture")],o.prototype,"_refractionTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"refractionTexture",void 0),(0,p.c)([(0,S.l)("ambient")],o.prototype,"ambientColor",void 0),(0,p.c)([(0,S.l)("diffuse")],o.prototype,"diffuseColor",void 0),(0,p.c)([(0,S.l)("specular")],o.prototype,"specularColor",void 0),(0,p.c)([(0,S.l)("emissive")],o.prototype,"emissiveColor",void 0),(0,p.c)([(0,S.I)()],o.prototype,"specularPower",void 0),(0,p.c)([(0,S.I)("useAlphaFromDiffuseTexture")],o.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"useAlphaFromDiffuseTexture",void 0),(0,p.c)([(0,S.I)("useEmissiveAsIllumination")],o.prototype,"_useEmissiveAsIllumination",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useEmissiveAsIllumination",void 0),(0,p.c)([(0,S.I)("linkEmissiveWithDiffuse")],o.prototype,"_linkEmissiveWithDiffuse",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"linkEmissiveWithDiffuse",void 0),(0,p.c)([(0,S.I)("useSpecularOverAlpha")],o.prototype,"_useSpecularOverAlpha",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useSpecularOverAlpha",void 0),(0,p.c)([(0,S.I)("useReflectionOverAlpha")],o.prototype,"_useReflectionOverAlpha",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useReflectionOverAlpha",void 0),(0,p.c)([(0,S.I)("disableLighting")],o.prototype,"_disableLighting",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsLightsDirty")],o.prototype,"disableLighting",void 0),(0,p.c)([(0,S.I)("useObjectSpaceNormalMap")],o.prototype,"_useObjectSpaceNormalMap",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useObjectSpaceNormalMap",void 0),(0,p.c)([(0,S.I)("useParallax")],o.prototype,"_useParallax",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useParallax",void 0),(0,p.c)([(0,S.I)("useParallaxOcclusion")],o.prototype,"_useParallaxOcclusion",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useParallaxOcclusion",void 0),(0,p.c)([(0,S.I)()],o.prototype,"parallaxScaleBias",void 0),(0,p.c)([(0,S.I)("roughness")],o.prototype,"_roughness",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"roughness",void 0),(0,p.c)([(0,S.I)()],o.prototype,"indexOfRefraction",void 0),(0,p.c)([(0,S.I)()],o.prototype,"invertRefractionY",void 0),(0,p.c)([(0,S.I)()],o.prototype,"alphaCutOff",void 0),(0,p.c)([(0,S.I)("useLightmapAsShadowmap")],o.prototype,"_useLightmapAsShadowmap",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useLightmapAsShadowmap",void 0),(0,p.c)([(0,S.s)("diffuseFresnelParameters")],o.prototype,"_diffuseFresnelParameters",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsFresnelDirty")],o.prototype,"diffuseFresnelParameters",void 0),(0,p.c)([(0,S.s)("opacityFresnelParameters")],o.prototype,"_opacityFresnelParameters",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],o.prototype,"opacityFresnelParameters",void 0),(0,p.c)([(0,S.s)("reflectionFresnelParameters")],o.prototype,"_reflectionFresnelParameters",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsFresnelDirty")],o.prototype,"reflectionFresnelParameters",void 0),(0,p.c)([(0,S.s)("refractionFresnelParameters")],o.prototype,"_refractionFresnelParameters",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsFresnelDirty")],o.prototype,"refractionFresnelParameters",void 0),(0,p.c)([(0,S.s)("emissiveFresnelParameters")],o.prototype,"_emissiveFresnelParameters",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsFresnelDirty")],o.prototype,"emissiveFresnelParameters",void 0),(0,p.c)([(0,S.I)("useReflectionFresnelFromSpecular")],o.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsFresnelDirty")],o.prototype,"useReflectionFresnelFromSpecular",void 0),(0,p.c)([(0,S.I)("useGlossinessFromSpecularMapAlpha")],o.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,p.c)([(0,S.I)("maxSimultaneousLights")],o.prototype,"_maxSimultaneousLights",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsLightsDirty")],o.prototype,"maxSimultaneousLights",void 0),(0,p.c)([(0,S.I)("invertNormalMapX")],o.prototype,"_invertNormalMapX",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertNormalMapX",void 0),(0,p.c)([(0,S.I)("invertNormalMapY")],o.prototype,"_invertNormalMapY",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertNormalMapY",void 0),(0,p.c)([(0,S.I)("twoSidedLighting")],o.prototype,"_twoSidedLighting",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"twoSidedLighting",void 0),(0,p.c)([(0,S.I)("applyDecalMapAfterDetailMap")],o.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,p.c)([(0,S.d)("_markAllSubMeshesAsMiscDirty")],o.prototype,"applyDecalMapAfterDetailMap",void 0),(0,P.c)("BABYLON.StandardMaterial",o),i.e.DefaultMaterialFactory=y=>new o("default material",y)},11117:(y,g,f)=>{"use strict";f.d(g,{c:()=>k});var p=f(10736),S=f(10714);class k{constructor(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=y,this._noUBO=!y.supportsUniformBuffers||S,this._dynamic=f,this._name=p??"no-name",this._data=g||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Lj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Lj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(y){let g;if(g=y<=2?y:4,this._uniformLocationPointer%g!==0){const y=this._uniformLocationPointer;this._uniformLocationPointer+=g-this._uniformLocationPointer%g;const f=this._uniformLocationPointer-y;for(let g=0;g<f;g++)this._data.push(0)}}addUniform(y,g){let f,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[y]){if(p>0){if(g instanceof Array)throw"addUniform should not be use with Array in UBO: "+y;if(this._fillAlignment(4),this._uniformArraySizes[y]={strideSize:g,arraySize:p},16==g)g*=p;else{g=g*p+(4-g)*p}f=[];for(let y=0;y<g;y++)f.push(0)}else{if(g instanceof Array)f=g,g=f.length;else{f=[];for(let y=0;y<g;y++)f.push(0)}this._fillAlignment(g)}this._uniformSizes[y]=g,this._uniformLocations[y]=this._uniformLocationPointer,this._uniformLocationPointer+=g;for(let y=0;y<g;y++)this._data.push(f[y]);this._needSync=!0}}addMatrix(y,g){this.addUniform(y,Array.prototype.slice.call(g.mj()))}addFloat2(y,g,f){const p=[g,f];this.addUniform(y,p)}addFloat3(y,g,f,p){const S=[g,f,p];this.addUniform(y,S)}addColor3(y,g){const f=[g.r,g.g,g.b];this.addUniform(y,f)}addColor4(y,g,f){const p=[g.r,g.g,g.b,f];this.addUniform(y,p)}addVector3(y,g){const f=[g.x,g.y,g.z];this.addUniform(y,f)}addMatrix3x3(y){this.addUniform(y,12)}addMatrix2x2(y){this.addUniform(y,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const y=[];let g=0;for(const f in this._uniformLocations)if(y.push(f),10===++g)break;return y.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(y,g){for(let f=0;f<y.length;++f)if(y[f]!==g[f])return!1;return!0}_copyBuffer(y,g){for(let f=0;f<y.length;++f)g[f]=y[f]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(k._UpdatedUbosInFrame[this._name]||(k._UpdatedUbosInFrame[this._name]=0),k._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(y,g,f){this._checkNewFrame();let S=this._uniformLocations[y];if(void 0===S){if(this._buffer)return void p.d.Error("Cannot add an uniform after UBO has been created. uniformName="+y);this.addUniform(y,f),S=this._uniformLocations[y]}if(this._buffer||this.create(),this._dynamic)for(let p=0;p<f;p++)this._bufferData[S+p]=g[p];else{let y=!1;for(let p=0;p<f;p++)(16===f&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[S+p]!==Math.fround(g[p]))&&(y=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[S+p]=g[p]);this._needSync=this._needSync||y}}updateUniformArray(y,g,f){this._checkNewFrame();const k=this._uniformLocations[y];if(void 0===k)return void p.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const i=this._uniformArraySizes[y];if(this._dynamic)for(let p=0;p<f;p++)this._bufferData[k+p]=g[p];else{let y=!1,p=0,H=0;for(let U=0;U<f;U++)if(this._bufferData[k+4*H+p]!==S.e.FloatRound(g[U])&&(y=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[k+4*H+p]=g[U]),p++,p===i.strideSize){for(;p<4;p++)this._bufferData[k+4*H+p]=0;p=0,H++}this._needSync=this._needSync||y}}_cacheMatrix(y,g){this._checkNewFrame();const f=this._valueCache[y],p=g.updateFlag;return(void 0===f||f!==p)&&(this._valueCache[y]=p,!0)}_updateMatrix3x3ForUniform(y,g){for(let f=0;f<3;f++)k._TempBuffer[4*f]=g[3*f],k._TempBuffer[4*f+1]=g[3*f+1],k._TempBuffer[4*f+2]=g[3*f+2],k._TempBuffer[4*f+3]=0;this.updateUniform(y,k._TempBuffer,12)}_updateMatrix3x3ForEffect(y,g){this._currentEffect.setMatrix3x3(y,g)}_updateMatrix2x2ForEffect(y,g){this._currentEffect.setMatrix2x2(y,g)}_updateMatrix2x2ForUniform(y,g){for(let f=0;f<2;f++)k._TempBuffer[4*f]=g[2*f],k._TempBuffer[4*f+1]=g[2*f+1],k._TempBuffer[4*f+2]=0,k._TempBuffer[4*f+3]=0;this.updateUniform(y,k._TempBuffer,8)}_updateFloatForEffect(y,g){this._currentEffect.setFloat(y,g)}_updateFloatForUniform(y,g){k._TempBuffer[0]=g,this.updateUniform(y,k._TempBuffer,1)}_updateFloat2ForEffect(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(y+p,g,f)}_updateFloat2ForUniform(y,g,f){k._TempBuffer[0]=g,k._TempBuffer[1]=f,this.updateUniform(y,k._TempBuffer,2)}_updateFloat3ForEffect(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(y+S,g,f,p)}_updateFloat3ForUniform(y,g,f,p){k._TempBuffer[0]=g,k._TempBuffer[1]=f,k._TempBuffer[2]=p,this.updateUniform(y,k._TempBuffer,3)}_updateFloat4ForEffect(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(y+k,g,f,p,S)}_updateFloat4ForUniform(y,g,f,p,S){k._TempBuffer[0]=g,k._TempBuffer[1]=f,k._TempBuffer[2]=p,k._TempBuffer[3]=S,this.updateUniform(y,k._TempBuffer,4)}_updateFloatArrayForEffect(y,g){this._currentEffect.setFloatArray(y,g)}_updateFloatArrayForUniform(y,g){this.updateUniformArray(y,g,g.length)}_updateArrayForEffect(y,g){this._currentEffect.setArray(y,g)}_updateArrayForUniform(y,g){this.updateUniformArray(y,g,g.length)}_updateIntArrayForEffect(y,g){this._currentEffect.setIntArray(y,g)}_updateIntArrayForUniform(y,g){k._TempBufferInt32View.set(g),this.updateUniformArray(y,k._TempBuffer,g.length)}_updateUIntArrayForEffect(y,g){this._currentEffect.setUIntArray(y,g)}_updateUIntArrayForUniform(y,g){k._TempBufferUInt32View.set(g),this.updateUniformArray(y,k._TempBuffer,g.length)}_updateMatrixForEffect(y,g){this._currentEffect.setMatrix(y,g)}_updateMatrixForUniform(y,g){this._cacheMatrix(y,g)&&this.updateUniform(y,g.mj(),16)}_updateMatricesForEffect(y,g){this._currentEffect.setMatrices(y,g)}_updateMatricesForUniform(y,g){this.updateUniform(y,g,g.length)}_updateVector3ForEffect(y,g){this._currentEffect.setVector3(y,g)}_updateVector3ForUniform(y,g){k._TempBuffer[0]=g.x,k._TempBuffer[1]=g.y,k._TempBuffer[2]=g.z,this.updateUniform(y,k._TempBuffer,3)}_updateVector4ForEffect(y,g){this._currentEffect.setVector4(y,g)}_updateVector4ForUniform(y,g){k._TempBuffer[0]=g.x,k._TempBuffer[1]=g.y,k._TempBuffer[2]=g.z,k._TempBuffer[3]=g.w,this.updateUniform(y,k._TempBuffer,4)}_updateColor3ForEffect(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(y+f,g)}_updateColor3ForUniform(y,g){k._TempBuffer[0]=g.r,k._TempBuffer[1]=g.g,k._TempBuffer[2]=g.b,this.updateUniform(y,k._TempBuffer,3)}_updateColor4ForEffect(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(y+p,g,f)}_updateDirectColor4ForEffect(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(y+f,g)}_updateColor4ForUniform(y,g,f){k._TempBuffer[0]=g.r,k._TempBuffer[1]=g.g,k._TempBuffer[2]=g.b,k._TempBuffer[3]=f,this.updateUniform(y,k._TempBuffer,4)}_updateDirectColor4ForUniform(y,g){k._TempBuffer[0]=g.r,k._TempBuffer[1]=g.g,k._TempBuffer[2]=g.b,k._TempBuffer[3]=g.a,this.updateUniform(y,k._TempBuffer,4)}_updateIntForEffect(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(y+f,g)}_updateIntForUniform(y,g){k._TempBufferInt32View[0]=g,this.updateUniform(y,k._TempBuffer,1)}_updateInt2ForEffect(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(y+p,g,f)}_updateInt2ForUniform(y,g,f){k._TempBufferInt32View[0]=g,k._TempBufferInt32View[1]=f,this.updateUniform(y,k._TempBuffer,2)}_updateInt3ForEffect(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(y+S,g,f,p)}_updateInt3ForUniform(y,g,f,p){k._TempBufferInt32View[0]=g,k._TempBufferInt32View[1]=f,k._TempBufferInt32View[2]=p,this.updateUniform(y,k._TempBuffer,3)}_updateInt4ForEffect(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(y+k,g,f,p,S)}_updateInt4ForUniform(y,g,f,p,S){k._TempBufferInt32View[0]=g,k._TempBufferInt32View[1]=f,k._TempBufferInt32View[2]=p,k._TempBufferInt32View[3]=S,this.updateUniform(y,k._TempBuffer,4)}_updateUIntForEffect(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(y+f,g)}_updateUIntForUniform(y,g){k._TempBufferUInt32View[0]=g,this.updateUniform(y,k._TempBuffer,1)}_updateUInt2ForEffect(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(y+p,g,f)}_updateUInt2ForUniform(y,g,f){k._TempBufferUInt32View[0]=g,k._TempBufferUInt32View[1]=f,this.updateUniform(y,k._TempBuffer,2)}_updateUInt3ForEffect(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(y+S,g,f,p)}_updateUInt3ForUniform(y,g,f,p){k._TempBufferUInt32View[0]=g,k._TempBufferUInt32View[1]=f,k._TempBufferUInt32View[2]=p,this.updateUniform(y,k._TempBuffer,3)}_updateUInt4ForEffect(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(y+k,g,f,p,S)}_updateUInt4ForUniform(y,g,f,p,S){k._TempBufferUInt32View[0]=g,k._TempBufferUInt32View[1]=f,k._TempBufferUInt32View[2]=p,k._TempBufferUInt32View[3]=S,this.updateUniform(y,k._TempBuffer,4)}setTexture(y,g){this._currentEffect.setTexture(y,g)}setTextureArray(y,g){this._currentEffect.setTextureArray(y,g)}bindTexture(y,g){this._currentEffect._bindTexture(y,g)}updateUniformDirectly(y,g){this.updateUniform(y,g,g.length),this.update()}bindToEffect(y,g){this._currentEffect=y,this._currentEffectName=g}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(y){if(!this._buffers)return this._buffer===y;for(let g=0;g<this._buffers.length;++g){if(this._buffers[g][0]===y)return this._bufferIndex=g,this._buffer=y,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const y=this._engine._uniformBuffers,g=y.indexOf(this);if(-1!==g&&(y[g]=y[y.length-1],y.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let f=0;f<this._buffers.length;++f){const y=this._buffers[f][0];this._engine._releaseBuffer(y)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}k._UpdatedUbosInFrame={},k._MAX_UNIFORM_SIZE=256,k._TempBuffer=new Float32Array(k._MAX_UNIFORM_SIZE),k._TempBufferInt32View=new Int32Array(k._TempBuffer.buffer),k._TempBufferUInt32View=new Uint32Array(k._TempBuffer.buffer)},11378:(y,g,f)=>{"use strict";f.d(g,{b:()=>i,c:()=>p});var p,S,k=f(11054);!function(y){y[y.LOCAL=0]="LOCAL",y[y.WORLD=1]="WORLD",y[y.BONE=2]="BONE"}(p||(p={}));class i{}i.X=new k.m(1,0,0),i.Y=new k.m(0,1,0),i.Z=new k.m(0,0,1),function(y){y[y.X=0]="X",y[y.Y=1]="Y",y[y.Z=2]="Z"}(S||(S={}))},11090:(y,g,f)=>{"use strict";f.d(g,{c:()=>Z,f:()=>C,j:()=>q});var p=f(11071),S=f(10871),k=f(11062),i=f(11079);function H(y){return Math.pow(y,k.m)}function U(y){return y<=.04045?.0773993808*y:Math.pow(.947867299*(y+.055),2.4)}function l(y){return Math.pow(y,k.i)}function c(y){return y<=.0031308?12.92*y:1.055*Math.pow(y,.41666)-.055}class Z{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=y,this.g=g,this.b=f}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"hb"}getHashCode(){let y=255*this.r|0;return y=397*y^255*this.g,y=397*y^255*this.b,y}toArray(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y[g]=this.r,y[g+1]=this.g,y[g+2]=this.b,this}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z.FromArrayToRef(y,g,this),this}toColor4(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new C(this.r,this.g,this.b,y)}mj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(y){return new Z(this.r*y.r,this.g*y.g,this.b*y.b)}multiplyToRef(y,g){return g.r=this.r*y.r,g.g=this.g*y.g,g.b=this.b*y.b,g}multiplyInPlace(y){return this.r*=y.r,this.g*=y.g,this.b*=y.b,this}multiplyByFloats(y,g,f){return new Z(this.r*y,this.g*g,this.b*f)}divide(y){throw new ReferenceError("Can not divide a color")}divideToRef(y,g){throw new ReferenceError("Can not divide a color")}divideInPlace(y){throw new ReferenceError("Can not divide a color")}minimizeInPlace(y){return this.minimizeInPlaceFromFloats(y.r,y.g,y.b)}maximizeInPlace(y){return this.maximizeInPlaceFromFloats(y.r,y.g,y.b)}minimizeInPlaceFromFloats(y,g,f){return this.r=Math.min(y,this.r),this.g=Math.min(g,this.g),this.b=Math.min(f,this.b),this}maximizeInPlaceFromFloats(y,g,f){return this.r=Math.max(y,this.r),this.g=Math.max(g,this.g),this.b=Math.max(f,this.b),this}floorToRef(y){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(y){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(y){return y&&this.r===y.r&&this.g===y.g&&this.b===y.b}equalsFloats(y,g,f){return this.equalsToFloats(y,g,f)}equalsToFloats(y,g,f){return this.r===y&&this.g===g&&this.b===f}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return(0,i.u)(this.r,y.r,g)&&(0,i.u)(this.g,y.g,g)&&(0,i.u)(this.b,y.b,g)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(y){throw new ReferenceError("Can not negate a color")}scale(y){return new Z(this.r*y,this.g*y,this.b*y)}scaleInPlace(y){return this.r*=y,this.g*=y,this.b*=y,this}scaleToRef(y,g){return g.r=this.r*y,g.g=this.g*y,g.b=this.b*y,g}scaleAndAddToRef(y,g){return g.r+=this.r*y,g.g+=this.g*y,g.b+=this.b*y,g}clampToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2?arguments[2]:void 0;return f.r=(0,i.d)(this.r,y,g),f.g=(0,i.d)(this.g,y,g),f.b=(0,i.d)(this.b,y,g),f}add(y){return new Z(this.r+y.r,this.g+y.g,this.b+y.b)}addInPlace(y){return this.r+=y.r,this.g+=y.g,this.b+=y.b,this}addInPlaceFromFloats(y,g,f){return this.r+=y,this.g+=g,this.b+=f,this}addToRef(y,g){return g.r=this.r+y.r,g.g=this.g+y.g,g.b=this.b+y.b,g}ed(y){return new Z(this.r-y.r,this.g-y.g,this.b-y.b)}subtractToRef(y,g){return g.r=this.r-y.r,g.g=this.g-y.g,g.b=this.b-y.b,g}ti(y){return this.r-=y.r,this.g-=y.g,this.b-=y.b,this}subtractFromFloats(y,g,f){return new Z(this.r-y,this.g-g,this.b-f)}subtractFromFloatsToRef(y,g,f,p){return p.r=this.r-y,p.g=this.g-g,p.b=this.b-f,p}clone(){return new Z(this.r,this.g,this.b)}p(y){return this.r=y.r,this.g=y.g,this.b=y.b,this}ne(y,g,f){return this.r=y,this.g=g,this.b=f,this}set(y,g,f){return this.ne(y,g,f)}me(y){return this.r=this.g=this.b=y,this}toHexString(){const y=Math.round(255*this.r),g=Math.round(255*this.g),f=Math.round(255*this.b);return"#"+(0,i.s)(y)+(0,i.s)(g)+(0,i.s)(f)}fromHexString(y){return"#"!==y.substring(0,1)||7!==y.length||(this.r=parseInt(y.substring(1,3),16)/255,this.g=parseInt(y.substring(3,5),16)/255,this.b=parseInt(y.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new Z)}toHSVToRef(y){const g=this.r,f=this.g,p=this.b,S=Math.max(g,f,p),k=Math.min(g,f,p);let i=0,H=0;const U=S,l=S-k;return 0!==S&&(H=l/S),S!=k&&(S==g?(i=(f-p)/l,f<p&&(i+=6)):S==f?i=(p-g)/l+2:S==p&&(i=(g-f)/l+4),i*=60),y.r=i,y.g=H,y.b=U,y}toLinearSpace(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=new Z;return this.toLinearSpaceToRef(g,y),g}toLinearSpaceToRef(y){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(y.r=U(this.r),y.g=U(this.g),y.b=U(this.b)):(y.r=H(this.r),y.g=H(this.g),y.b=H(this.b)),this}toGammaSpace(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=new Z;return this.toGammaSpaceToRef(g,y),g}toGammaSpaceToRef(y){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(y.r=c(this.r),y.g=c(this.g),y.b=c(this.b)):(y.r=l(this.r),y.g=l(this.g),y.b=l(this.b)),this}static HSVtoRGBToRef(y,g,f,p){const S=f*g,k=y/60,i=S*(1-Math.abs(k%2-1));let H=0,U=0,l=0;k>=0&&k<=1?(H=S,U=i):k>=1&&k<=2?(H=i,U=S):k>=2&&k<=3?(U=S,l=i):k>=3&&k<=4?(U=i,l=S):k>=4&&k<=5?(H=i,l=S):k>=5&&k<=6&&(H=S,l=i);const c=f-S;return p.r=H+c,p.g=U+c,p.b=l+c,p}static FromHSV(y,g,f){const p=new Z(0,0,0);return Z.HSVtoRGBToRef(y,g,f,p),p}static FromHexString(y){return new Z(0,0,0).fromHexString(y)}static eh(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Z(y[g],y[g+1],y[g+2])}static FromArrayToRef(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;f.r=y[g],f.g=y[g+1],f.b=y[g+2]}static FromInts(y,g,f){return new Z(y/255,g/255,f/255)}static Lerp(y,g,f){const p=new Z(0,0,0);return Z.LerpToRef(y,g,f,p),p}static LerpToRef(y,g,f,p){p.r=y.r+(g.r-y.r)*f,p.g=y.g+(g.g-y.g)*f,p.b=y.b+(g.b-y.b)*f}static Hermite(y,g,f,p,S){const k=S*S,i=S*k,H=2*i-3*k+1,U=-2*i+3*k,l=i-2*k+S,c=i-k,C=y.r*H+f.r*U+g.r*l+p.r*c,q=y.g*H+f.g*U+g.g*l+p.g*c,W=y.b*H+f.b*U+g.b*l+p.b*c;return new Z(C,q,W)}static Hermite1stDerivative(y,g,f,p,S){const k=Z.Black();return this.Hermite1stDerivativeToRef(y,g,f,p,S,k),k}static Hermite1stDerivativeToRef(y,g,f,p,S,k){const i=S*S;k.r=6*(i-S)*y.r+(3*i-4*S+1)*g.r+6*(-i+S)*f.r+(3*i-2*S)*p.r,k.g=6*(i-S)*y.g+(3*i-4*S+1)*g.g+6*(-i+S)*f.g+(3*i-2*S)*p.g,k.b=6*(i-S)*y.b+(3*i-4*S+1)*g.b+6*(-i+S)*f.b+(3*i-2*S)*p.b}static Red(){return new Z(1,0,0)}static Green(){return new Z(0,1,0)}static Blue(){return new Z(0,0,1)}static Black(){return new Z(0,0,0)}static get BlackReadOnly(){return Z._BlackReadOnly}static White(){return new Z(1,1,1)}static Purple(){return new Z(.5,0,.5)}static Magenta(){return new Z(1,0,1)}static Yellow(){return new Z(1,1,0)}static Gray(){return new Z(.5,.5,.5)}static Teal(){return new Z(0,1,1)}static Random(){return new Z(Math.random(),Math.random(),Math.random())}}Z._BlackReadOnly=Z.Black(),Object.defineProperties(Z.prototype,{dimension:{value:[3]},rank:{value:1}});class C{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=y,this.g=g,this.b=f,this.a=p}mj(){return[this.r,this.g,this.b,this.a]}toArray(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y[g]=this.r,y[g+1]=this.g,y[g+2]=this.b,y[g+3]=this.a,this}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=y[g],this.g=y[g+1],this.b=y[g+2],this.a=y[g+3],this}equals(y){return y&&this.r===y.r&&this.g===y.g&&this.b===y.b&&this.a===y.a}add(y){return new C(this.r+y.r,this.g+y.g,this.b+y.b,this.a+y.a)}addToRef(y,g){return g.r=this.r+y.r,g.g=this.g+y.g,g.b=this.b+y.b,g.a=this.a+y.a,g}addInPlace(y){return this.r+=y.r,this.g+=y.g,this.b+=y.b,this.a+=y.a,this}addInPlaceFromFloats(y,g,f,p){return this.r+=y,this.g+=g,this.b+=f,this.a+=p,this}ed(y){return new C(this.r-y.r,this.g-y.g,this.b-y.b,this.a-y.a)}subtractToRef(y,g){return g.r=this.r-y.r,g.g=this.g-y.g,g.b=this.b-y.b,g.a=this.a-y.a,g}ti(y){return this.r-=y.r,this.g-=y.g,this.b-=y.b,this.a-=y.a,this}subtractFromFloats(y,g,f,p){return new C(this.r-y,this.g-g,this.b-f,this.a-p)}subtractFromFloatsToRef(y,g,f,p,S){return S.r=this.r-y,S.g=this.g-g,S.b=this.b-f,S.a=this.a-p,S}scale(y){return new C(this.r*y,this.g*y,this.b*y,this.a*y)}scaleInPlace(y){return this.r*=y,this.g*=y,this.b*=y,this.a*=y,this}scaleToRef(y,g){return g.r=this.r*y,g.g=this.g*y,g.b=this.b*y,g.a=this.a*y,g}scaleAndAddToRef(y,g){return g.r+=this.r*y,g.g+=this.g*y,g.b+=this.b*y,g.a+=this.a*y,g}clampToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2?arguments[2]:void 0;return f.r=(0,i.d)(this.r,y,g),f.g=(0,i.d)(this.g,y,g),f.b=(0,i.d)(this.b,y,g),f.a=(0,i.d)(this.a,y,g),f}multiply(y){return new C(this.r*y.r,this.g*y.g,this.b*y.b,this.a*y.a)}multiplyToRef(y,g){return g.r=this.r*y.r,g.g=this.g*y.g,g.b=this.b*y.b,g.a=this.a*y.a,g}multiplyInPlace(y){return this.r*=y.r,this.g*=y.g,this.b*=y.b,this.a*=y.a,this}multiplyByFloats(y,g,f,p){return new C(this.r*y,this.g*g,this.b*f,this.a*p)}divide(y){throw new ReferenceError("Can not divide a color")}divideToRef(y,g){throw new ReferenceError("Can not divide a color")}divideInPlace(y){throw new ReferenceError("Can not divide a color")}minimizeInPlace(y){return this.r=Math.min(this.r,y.r),this.g=Math.min(this.g,y.g),this.b=Math.min(this.b,y.b),this.a=Math.min(this.a,y.a),this}maximizeInPlace(y){return this.r=Math.max(this.r,y.r),this.g=Math.max(this.g,y.g),this.b=Math.max(this.b,y.b),this.a=Math.max(this.a,y.a),this}minimizeInPlaceFromFloats(y,g,f,p){return this.r=Math.min(y,this.r),this.g=Math.min(g,this.g),this.b=Math.min(f,this.b),this.a=Math.min(p,this.a),this}maximizeInPlaceFromFloats(y,g,f,p){return this.r=Math.max(y,this.r),this.g=Math.max(g,this.g),this.b=Math.max(f,this.b),this.a=Math.max(p,this.a),this}floorToRef(y){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(y){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(y){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return(0,i.u)(this.r,y.r,g)&&(0,i.u)(this.g,y.g,g)&&(0,i.u)(this.b,y.b,g)&&(0,i.u)(this.a,y.a,g)}equalsToFloats(y,g,f,p){return this.r===y&&this.g===g&&this.b===f&&this.a===p}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let y=255*this.r|0;return y=397*y^255*this.g,y=397*y^255*this.b,y=397*y^255*this.a,y}clone(){return(new C).p(this)}p(y){return this.r=y.r,this.g=y.g,this.b=y.b,this.a=y.a,this}ne(y,g,f,p){return this.r=y,this.g=g,this.b=f,this.a=p,this}set(y,g,f,p){return this.ne(y,g,f,p)}me(y){return this.r=this.g=this.b=this.a=y,this}toHexString(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=Math.round(255*this.r),f=Math.round(255*this.g),p=Math.round(255*this.b);if(y)return"#"+(0,i.s)(g)+(0,i.s)(f)+(0,i.s)(p);const S=Math.round(255*this.a);return"#"+(0,i.s)(g)+(0,i.s)(f)+(0,i.s)(p)+(0,i.s)(S)}fromHexString(y){return"#"!==y.substring(0,1)||9!==y.length&&7!==y.length||(this.r=parseInt(y.substring(1,3),16)/255,this.g=parseInt(y.substring(3,5),16)/255,this.b=parseInt(y.substring(5,7),16)/255,9===y.length&&(this.a=parseInt(y.substring(7,9),16)/255)),this}toLinearSpace(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=new C;return this.toLinearSpaceToRef(g,y),g}toLinearSpaceToRef(y){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(y.r=U(this.r),y.g=U(this.g),y.b=U(this.b)):(y.r=H(this.r),y.g=H(this.g),y.b=H(this.b)),y.a=this.a,this}toGammaSpace(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=new C;return this.toGammaSpaceToRef(g,y),g}toGammaSpaceToRef(y){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(y.r=c(this.r),y.g=c(this.g),y.b=c(this.b)):(y.r=l(this.r),y.g=l(this.g),y.b=l(this.b)),y.a=this.a,this}static FromHexString(y){return"#"!==y.substring(0,1)||9!==y.length&&7!==y.length?new C(0,0,0,0):new C(0,0,0,1).fromHexString(y)}static Lerp(y,g,f){return C.LerpToRef(y,g,f,new C)}static LerpToRef(y,g,f,p){return p.r=y.r+(g.r-y.r)*f,p.g=y.g+(g.g-y.g)*f,p.b=y.b+(g.b-y.b)*f,p.a=y.a+(g.a-y.a)*f,p}static Hermite(y,g,f,p,S){const k=S*S,i=S*k,H=2*i-3*k+1,U=-2*i+3*k,l=i-2*k+S,c=i-k,Z=y.r*H+f.r*U+g.r*l+p.r*c,q=y.g*H+f.g*U+g.g*l+p.g*c,W=y.b*H+f.b*U+g.b*l+p.b*c,j=y.a*H+f.a*U+g.a*l+p.a*c;return new C(Z,q,W,j)}static Hermite1stDerivative(y,g,f,p,S){const k=new C;return this.Hermite1stDerivativeToRef(y,g,f,p,S,k),k}static Hermite1stDerivativeToRef(y,g,f,p,S,k){const i=S*S;k.r=6*(i-S)*y.r+(3*i-4*S+1)*g.r+6*(-i+S)*f.r+(3*i-2*S)*p.r,k.g=6*(i-S)*y.g+(3*i-4*S+1)*g.g+6*(-i+S)*f.g+(3*i-2*S)*p.g,k.b=6*(i-S)*y.b+(3*i-4*S+1)*g.b+6*(-i+S)*f.b+(3*i-2*S)*p.b,k.a=6*(i-S)*y.a+(3*i-4*S+1)*g.a+6*(-i+S)*f.a+(3*i-2*S)*p.a}static FromColor3(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new C(y.r,y.g,y.b,g)}static eh(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new C(y[g],y[g+1],y[g+2],y[g+3])}static FromArrayToRef(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;f.r=y[g],f.g=y[g+1],f.b=y[g+2],f.a=y[g+3]}static FromInts(y,g,f,p){return new C(y/255,g/255,f/255,p/255)}static CheckColors4(y,g){if(y.length===3*g){const g=[];for(let f=0;f<y.length;f+=3){const p=f/3*4;g[p]=y[f],g[p+1]=y[f+1],g[p+2]=y[f+2],g[p+3]=1}return g}return y}}Object.defineProperties(C.prototype,{dimension:{value:[4]},rank:{value:1}});class q{}q.hb=(0,p.d)(3,Z.Black),q.ob=(0,p.d)(3,(()=>new C(0,0,0,0))),(0,S.c)("BABYLON.Color3",Z),(0,S.c)("BABYLON.Color4",C)},11062:(y,g,f)=>{"use strict";f.d(g,{e:()=>i,g:()=>k,i:()=>p,m:()=>S});const p=1/2.2,S=2.2,k=(1+Math.sqrt(5))/2,i=.001},11177:(y,g,f)=>{"use strict";f.d(g,{b:()=>S});var p=f(11181);class S{static GetPlanes(y){const g=[];for(let f=0;f<6;f++)g.push(new p.b(0,0,0,0));return S.GetPlanesToRef(y,g),g}static GetNearPlaneToRef(y,g){const f=y.m;g.k.x=f[3]+f[2],g.k.y=f[7]+f[6],g.k.z=f[11]+f[10],g.d=f[15]+f[14],g.normalize()}static GetFarPlaneToRef(y,g){const f=y.m;g.k.x=f[3]-f[2],g.k.y=f[7]-f[6],g.k.z=f[11]-f[10],g.d=f[15]-f[14],g.normalize()}static GetLeftPlaneToRef(y,g){const f=y.m;g.k.x=f[3]+f[0],g.k.y=f[7]+f[4],g.k.z=f[11]+f[8],g.d=f[15]+f[12],g.normalize()}static GetRightPlaneToRef(y,g){const f=y.m;g.k.x=f[3]-f[0],g.k.y=f[7]-f[4],g.k.z=f[11]-f[8],g.d=f[15]-f[12],g.normalize()}static GetTopPlaneToRef(y,g){const f=y.m;g.k.x=f[3]-f[1],g.k.y=f[7]-f[5],g.k.z=f[11]-f[9],g.d=f[15]-f[13],g.normalize()}static GetBottomPlaneToRef(y,g){const f=y.m;g.k.x=f[3]+f[1],g.k.y=f[7]+f[5],g.k.z=f[11]+f[9],g.d=f[15]+f[13],g.normalize()}static GetPlanesToRef(y,g){S.GetNearPlaneToRef(y,g[0]),S.GetFarPlaneToRef(y,g[1]),S.GetLeftPlaneToRef(y,g[2]),S.GetRightPlaneToRef(y,g[3]),S.GetTopPlaneToRef(y,g[4]),S.GetBottomPlaneToRef(y,g[5])}static IsPointInFrustum(y,g){for(let f=0;f<6;f++)if(g[f].dotCoordinate(y)<0)return!1;return!0}}},11237:(y,g,f)=>{"use strict";f.d(g,{d:()=>H,e:()=>U});var p=f(11021),S=f(11054),k=f(11026);class i{static extractMinAndMaxIndexed(y,g,f,p,S,k){for(let i=f;i<f+p;i++){const f=3*g[i],p=y[f],H=y[f+1],U=y[f+2];S.minimizeInPlaceFromFloats(p,H,U),k.maximizeInPlaceFromFloats(p,H,U)}}static extractMinAndMax(y,g,f,p,S,k){for(let i=g,H=g*p;i<g+f;i++,H+=p){const g=y[H],f=y[H+1],p=y[H+2];S.minimizeInPlaceFromFloats(g,f,p),k.maximizeInPlaceFromFloats(g,f,p)}}}function H(y,g,f,p){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const H=new S.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new S.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return i.extractMinAndMaxIndexed(y,g,f,p,H,U),k&&(H.x-=H.x*k.x+k.y,H.y-=H.y*k.x+k.y,H.z-=H.z*k.x+k.y,U.x+=U.x*k.x+k.y,U.y+=U.y*k.x+k.y,U.z+=U.z*k.x+k.y),{minimum:H,maximum:U}}function U(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0;const H=new S.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new S.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return k||(k=3),i.extractMinAndMax(y,g,f,k,H,U),p&&(H.x-=H.x*p.x+p.y,H.y-=H.y*p.x+p.y,H.z-=H.z*p.x+p.y,U.x+=U.x*p.x+p.y,U.y+=U.y*p.x+p.y,U.z+=U.z*p.x+p.y),{minimum:H,maximum:U}}(0,p.c)([k.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p,S]=g;return!Array.isArray(p)&&!Array.isArray(S)}))],i,"extractMinAndMaxIndexed",null),(0,p.c)([k.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p]=g;return!Array.isArray(p)}))],i,"extractMinAndMax",null)},11562:(y,g,f)=>{"use strict";f.d(g,{e:()=>p.j});f(11378),f(11090),f(11062),f(11177),f(11565),f(11181),f(11274);var p=f(11054);f(11342)},11565:(y,g,f)=>{"use strict";f.d(g,{b:()=>H,e:()=>c,f:()=>Z});var p,S=f(11079),k=f(11054),i=f(11062);!function(y){y[y.CW=0]="CW",y[y.CCW=1]="CCW"}(p||(p={}));class H{static Interpolate(y,g,f,p,S){const k=1-3*p+3*g,i=3*p-6*g,H=3*g;let U=y;for(let l=0;l<5;l++){const g=U*U;U-=(k*(g*U)+i*g+H*U-y)*(1/(3*k*g+2*i*U+H)),U=Math.min(1,Math.max(0,U))}return 3*Math.pow(1-U,2)*U*f+3*(1-U)*Math.pow(U,2)*S+Math.pow(U,3)}}class U{constructor(y){this._radians=y,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(y,g){const f=g.ed(y),p=Math.atan2(f.y,f.x);return new U(p)}static BetweenTwoVectors(y,g){let f=y.lengthSquared()*g.lengthSquared();if(0===f)return new U(Math.PI/2);f=Math.sqrt(f);let p=y.dot(g)/f;p=(0,S.d)(p,-1,1);const k=Math.acos(p);return new U(k)}static FromRadians(y){return new U(y)}static FromDegrees(y){return new U(y*Math.PI/180)}}class l{constructor(y,g,f){this.startPoint=y,this.midPoint=g,this.endPoint=f;const p=Math.pow(g.x,2)+Math.pow(g.y,2),S=(Math.pow(y.x,2)+Math.pow(y.y,2)-p)/2,i=(p-Math.pow(f.x,2)-Math.pow(f.y,2))/2,H=(y.x-g.x)*(g.y-f.y)-(g.x-f.x)*(y.y-g.y);this.centerPoint=new k.l((S*(g.y-f.y)-i*(y.y-g.y))/H,((y.x-g.x)*i-(g.x-f.x)*S)/H),this.radius=this.centerPoint.ed(this.startPoint).length(),this.startAngle=U.BetweenTwoPoints(this.centerPoint,this.startPoint);const l=this.startAngle.degrees();let c=U.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),Z=U.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-l>180&&(c-=360),c-l<-180&&(c+=360),Z-c>180&&(Z-=360),Z-c<-180&&(Z+=360),this.orientation=c-l<0?0:1,this.angle=U.FromDegrees(0===this.orientation?l-Z:Z-l)}}class c{constructor(y,g){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new k.l(y,g))}addLineTo(y,g){if(this.closed)return this;const f=new k.l(y,g),p=this._points[this._points.length-1];return this._points.push(f),this._length+=f.ed(p).length(),this}addArcTo(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const i=this._points[this._points.length-1],H=new k.l(y,g),U=new k.l(f,p),c=new l(i,H,U);let Z=c.angle.radians()/S;0===c.orientation&&(Z*=-1);let C=c.startAngle.radians()+Z;for(let k=0;k<S;k++){const y=Math.cos(C)*c.radius+c.centerPoint.x,g=Math.sin(C)*c.radius+c.centerPoint.y;this.addLineTo(y,g),C+=Z}return this}addQuadraticCurveTo(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const k=(y,g,f,p)=>(1-y)*(1-y)*g+2*y*(1-y)*f+y*y*p,i=this._points[this._points.length-1];for(let H=0;H<=S;H++){const U=H/S,l=k(U,i.x,y,f),c=k(U,i.y,g,p);this.addLineTo(l,c)}return this}addBezierCurveTo(y,g,f,p,S,k){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const H=(y,g,f,p,S)=>(1-y)*(1-y)*(1-y)*g+3*y*(1-y)*(1-y)*f+3*y*y*(1-y)*p+y*y*y*S,U=this._points[this._points.length-1];for(let l=0;l<=i;l++){const c=l/i,Z=H(c,U.x,y,f,S),C=H(c,U.y,g,p,k);this.addLineTo(Z,C)}return this}isPointInside(y){let g=!1;const f=this._points.length;for(let p=f-1,S=0;S<f;p=S++){let f=this._points[p],k=this._points[S],i=k.x-f.x,H=k.y-f.y;if(Math.abs(H)>Number.EPSILON){if(H<0&&(f=this._points[S],i=-i,k=this._points[p],H=-H),y.y<f.y||y.y>k.y)continue;if(y.y===f.y&&y.x===f.x)return!0;{const p=H*(y.x-f.x)-i*(y.y-f.y);if(0===p)return!0;if(p<0)continue;g=!g}}else{if(y.y!==f.y)continue;if(k.x<=y.x&&y.x<=f.x||f.x<=y.x&&y.x<=k.x)return!0}}return g}close(){return this.closed=!0,this}length(){let y=this._length;if(this.closed){const g=this._points[this._points.length-1];y+=this._points[0].ed(g).length()}return y}area(){const y=this._points.length;let g=0;for(let f=y-1,p=0;p<y;f=p++)g+=this._points[f].x*this._points[p].y-this._points[p].x*this._points[f].y;return.5*g}getPoints(){return this._points}getPointAtLengthPosition(y){if(y<0||y>1)return k.l.Zero();const g=y*this.length();let f=0;for(let p=0;p<this._points.length;p++){const y=(p+1)%this._points.length,S=this._points[p],i=this._points[y].ed(S),H=i.length()+f;if(g>=f&&g<=H){const y=i.normalize(),p=g-f;return new k.l(S.x+y.x*p,S.y+y.y*p)}f=H}return k.l.Zero()}static StartingAt(y,g){return new c(y,g)}}class Z{constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=y,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:k.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:k.c.Identity()};for(let S=0;S<y.length;S++)this._curve[S]=y[S].clone();this._raw=f||!1,this._alignTangentsWithPath=p,this._compute(g,p)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(y){return this._updatePointAtData(y).point}getTangentAt(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(y,g),g?k.m.TransformCoordinates(k.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(y,g),g?k.m.TransformCoordinates(k.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(y,g),g?k.m.TransformCoordinates(k.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(y){return this.length()*y}getPreviousPointIndexAt(y){return this._updatePointAtData(y),this._pointAtData.previousPointArrayIndex}getSubPositionAt(y){return this._updatePointAtData(y),this._pointAtData.subPosition}getClosestPositionTo(y){let g=Number.MAX_VALUE,f=0;for(let p=0;p<this._curve.length-1;p++){const S=this._curve[p+0],i=this._curve[p+1].ed(S).normalize(),H=this._distances[p+1]-this._distances[p+0],U=Math.min(Math.max(k.m.Dot(i,y.ed(S).normalize()),0)*k.m.Distance(S,y)/H,1),l=k.m.Distance(S.add(i.scale(U*H)),y);l<g&&(g=l,f=(this._distances[p+0]+H*U)/this.length())}return f}slice(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(y<0&&(y=1- -1*y%1),g<0&&(g=1- -1*g%1),y>g){const f=y;y=g,g=f}const f=this.getCurve(),p=this.getPointAt(y);let S=this.getPreviousPointIndexAt(y);const k=this.getPointAt(g),i=this.getPreviousPointIndexAt(g)+1,H=[];return 0!==y&&(S++,H.push(p)),H.push(...f.slice(S,i)),1===g&&1!==y||H.push(k),new Z(H,this.getNormalAt(y),this._raw,this._alignTangentsWithPath)}update(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let p=0;p<y.length;p++)this._curve[p].x=y[p].x,this._curve[p].y=y[p].y,this._curve[p].z=y[p].z;return this._compute(g,f),this}_compute(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const f=this._curve.length;if(f<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[f-1]=this._curve[f-1].ed(this._curve[f-2]),this._raw||this._tangents[f-1].normalize();const p=this._tangents[0],S=this._normalVector(p,y);let i,H,U,l,c;this._normals[0]=S,this._raw||this._normals[0].normalize(),this._binormals[0]=k.m.Cross(p,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let Z=1;Z<f;Z++)i=this._getLastNonNullVector(Z),Z<f-1&&(H=this._getFirstNonNullVector(Z),this._tangents[Z]=g?H:i.add(H),this._tangents[Z].normalize()),this._distances[Z]=this._distances[Z-1]+this._curve[Z].ed(this._curve[Z-1]).length(),U=this._tangents[Z],c=this._binormals[Z-1],this._normals[Z]=k.m.Cross(c,U),this._raw||(0===this._normals[Z].length()?(l=this._normals[Z-1],this._normals[Z]=l.clone()):this._normals[Z].normalize()),this._binormals[Z]=k.m.Cross(U,this._normals[Z]),this._raw||this._binormals[Z].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(y){let g=1,f=this._curve[y+g].ed(this._curve[y]);for(;0===f.length()&&y+g+1<this._curve.length;)g++,f=this._curve[y+g].ed(this._curve[y]);return f}_getLastNonNullVector(y){let g=1,f=this._curve[y].ed(this._curve[y-g]);for(;0===f.length()&&y>g+1;)g++,f=this._curve[y].ed(this._curve[y-g]);return f}_normalVector(y,g){let f,p=y.length();if(0===p&&(p=1),void 0===g||null===g){let g;g=(0,S.u)(Math.abs(y.y)/p,1,i.e)?(0,S.u)(Math.abs(y.x)/p,1,i.e)?(0,S.u)(Math.abs(y.z)/p,1,i.e)?k.m.Zero():new k.m(0,0,1):new k.m(1,0,0):new k.m(0,-1,0),f=k.m.Cross(y,g)}else f=k.m.Cross(y,g),k.m.CrossToRef(f,y,f);return f.normalize(),f}_updatePointAtData(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===y)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=y;const f=this.getPoints();if(y<=0)return this._setPointAtData(0,0,f[0],0,g);if(y>=1)return this._setPointAtData(1,1,f[f.length-1],f.length-1,g);let p,S=f[0],i=0;const H=y*this.length();for(let U=1;U<f.length;U++){p=f[U];const l=k.m.Distance(S,p);if(i+=l,i===H)return this._setPointAtData(y,1,p,U,g);if(i>H){const f=(i-H)/l,k=S.ed(p),c=p.add(k.scaleInPlace(f));return this._setPointAtData(y,1-f,c,U-1,g)}S=p}return this._pointAtData}_setPointAtData(y,g,f,p,S){return this._pointAtData.point=f,this._pointAtData.position=y,this._pointAtData.subPosition=g,this._pointAtData.previousPointArrayIndex=p,this._pointAtData.interpolateReady=S,S&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=k.c.Identity();const y=this._pointAtData.previousPointArrayIndex;if(y!==this._tangents.length-1){const g=y+1,f=this._tangents[y].clone(),p=this._normals[y].clone(),S=this._binormals[y].clone(),i=this._tangents[g].clone(),H=this._normals[g].clone(),U=this._binormals[g].clone(),l=k.g.RotationQuaternionFromAxis(p,S,f),c=k.g.RotationQuaternionFromAxis(H,U,i);k.g.Slerp(l,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11181:(y,g,f)=>{"use strict";f.d(g,{b:()=>S});var p=f(11054);class S{constructor(y,g,f,S){this.k=new p.m(y,g,f),this.d=S}mj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new S(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let y=this.k.getHashCode();return y=397*y^this.d,y}normalize(){const y=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let g=0;return 0!==y&&(g=1/y),this.k.x*=g,this.k.y*=g,this.k.z*=g,this.d*=g,this}transform(y){const g=S._TmpMatrix;y.invertToRef(g);const f=g.m,p=this.k.x,k=this.k.y,i=this.k.z,H=this.d,U=p*f[0]+k*f[1]+i*f[2]+H*f[3],l=p*f[4]+k*f[5]+i*f[6]+H*f[7],c=p*f[8]+k*f[9]+i*f[10]+H*f[11],Z=p*f[12]+k*f[13]+i*f[14]+H*f[15];return new S(U,l,c,Z)}dotCoordinate(y){return this.k.x*y.x+this.k.y*y.y+this.k.z*y.z+this.d}copyFromPoints(y,g,f){const p=g.x-y.x,S=g.y-y.y,k=g.z-y.z,i=f.x-y.x,H=f.y-y.y,U=f.z-y.z,l=S*U-k*H,c=k*i-p*U,Z=p*H-S*i,C=Math.sqrt(l*l+c*c+Z*Z);let q;return q=0!==C?1/C:0,this.k.x=l*q,this.k.y=c*q,this.k.z=Z*q,this.d=-(this.k.x*y.x+this.k.y*y.y+this.k.z*y.z),this}isFrontFacingTo(y,g){return p.m.Dot(this.k,y)<=g}signedDistanceTo(y){return p.m.Dot(y,this.k)+this.d}static eh(y){return new S(y[0],y[1],y[2],y[3])}static FromPoints(y,g,f){const p=new S(0,0,0,0);return p.copyFromPoints(y,g,f),p}static FromPositionAndNormal(y,g){const f=new S(0,0,0,0);return this.FromPositionAndNormalToRef(y,g,f)}static FromPositionAndNormalToRef(y,g,f){return f.k.p(g),f.k.normalize(),f.d=-y.dot(f.k),f}static SignedDistanceToPlaneFromPositionAndNormal(y,g,f){const S=-(g.x*y.x+g.y*y.y+g.z*y.z);return p.m.Dot(f,g)+S}}S._TmpMatrix=p.c.Identity()},11079:(y,g,f)=>{"use strict";function p(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(y-g)<=f}function S(y,g){return y===g?y:Math.random()*(g-y)+y}function k(y,g,f){return y+(g-y)*f}function i(y,g,f,p,S){const k=S*S,i=S*k;return y*(2*i-3*k+1)+f*(-2*i+3*k)+g*(i-2*k+S)+p*(i-k)}function H(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(f,Math.max(g,y))}function U(y){return y-=2*Math.PI*Math.floor((y+Math.PI)/(2*Math.PI))}function l(y){const g=y.toString(16);return y<=15?("0"+g).toUpperCase():g.toUpperCase()}function c(y){if(Math.log2)return Math.floor(Math.log2(y));if(y<0)return NaN;if(0===y)return-1/0;let g=0;if(y<1){for(;y<1;)g++,y*=2;g=-g}else if(y>1)for(;y>1;)g++,y=Math.floor(y/2);return g}function Z(y,g){const f=y%g;return 0===f?g:Z(g,f)}f.d(g,{d:()=>H,g:()=>i,j:()=>Z,k:()=>c,n:()=>k,o:()=>U,q:()=>S,s:()=>l,u:()=>p})},11274:(y,g,f)=>{"use strict";f.d(g,{e:()=>p});class p{constructor(y,g){this.width=y,this.height=g}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let y=0|this.width;return y=397*y^this.height,y}p(y){this.width=y.width,this.height=y.height}ne(y,g){return this.width=y,this.height=g,this}set(y,g){return this.ne(y,g)}multiplyByFloats(y,g){return new p(this.width*y,this.height*g)}clone(){return new p(this.width,this.height)}equals(y){return!!y&&(this.width===y.width&&this.height===y.height)}get surface(){return this.width*this.height}static Zero(){return new p(0,0)}add(y){return new p(this.width+y.width,this.height+y.height)}ed(y){return new p(this.width-y.width,this.height-y.height)}scale(y){return new p(this.width*y,this.height*y)}static Lerp(y,g,f){const S=y.width+(g.width-y.width)*f,k=y.height+(g.height-y.height)*f;return new p(S,k)}}},11054:(y,g,f)=>{"use strict";f.d(g,{c:()=>W,g:()=>q,j:()=>P,l:()=>c,m:()=>Z,o:()=>C});var p=f(11062),S=f(11071),k=f(10871),i=f(10837),H=f(10761),U=f(11079);const l=y=>parseInt(y.toString().replace(/\W/g,""));class c{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=y,this.y=g}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let y=l(this.x);return y=397*y^l(this.y),y}toArray(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y[g]=this.x,y[g+1]=this.y,this}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return c.FromArrayToRef(y,g,this),this}mj(){return[this.x,this.y]}p(y){return this.x=y.x,this.y=y.y,this}ne(y,g){return this.x=y,this.y=g,this}set(y,g){return this.ne(y,g)}me(y){return this.ne(y,y)}add(y){return new c(this.x+y.x,this.y+y.y)}addToRef(y,g){return g.x=this.x+y.x,g.y=this.y+y.y,g}addInPlace(y){return this.x+=y.x,this.y+=y.y,this}addInPlaceFromFloats(y,g){return this.x+=y,this.y+=g,this}addVector3(y){return new c(this.x+y.x,this.y+y.y)}ed(y){return new c(this.x-y.x,this.y-y.y)}subtractToRef(y,g){return g.x=this.x-y.x,g.y=this.y-y.y,g}ti(y){return this.x-=y.x,this.y-=y.y,this}multiplyInPlace(y){return this.x*=y.x,this.y*=y.y,this}multiply(y){return new c(this.x*y.x,this.y*y.y)}multiplyToRef(y,g){return g.x=this.x*y.x,g.y=this.y*y.y,g}multiplyByFloats(y,g){return new c(this.x*y,this.y*g)}divide(y){return new c(this.x/y.x,this.y/y.y)}divideToRef(y,g){return g.x=this.x/y.x,g.y=this.y/y.y,g}divideInPlace(y){return this.x=this.x/y.x,this.y=this.y/y.y,this}minimizeInPlace(y){return this.minimizeInPlaceFromFloats(y.x,y.y)}maximizeInPlace(y){return this.maximizeInPlaceFromFloats(y.x,y.y)}minimizeInPlaceFromFloats(y,g){return this.x=Math.min(y,this.x),this.y=Math.min(g,this.y),this}maximizeInPlaceFromFloats(y,g){return this.x=Math.max(y,this.x),this.y=Math.max(g,this.y),this}subtractFromFloats(y,g){return new c(this.x-y,this.y-g)}subtractFromFloatsToRef(y,g,f){return f.x=this.x-y,f.y=this.y-g,f}negate(){return new c(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(y){return y.x=-this.x,y.y=-this.y,y}scaleInPlace(y){return this.x*=y,this.y*=y,this}scale(y){return new c(this.x*y,this.y*y)}scaleToRef(y,g){return g.x=this.x*y,g.y=this.y*y,g}scaleAndAddToRef(y,g){return g.x+=this.x*y,g.y+=this.y*y,g}equals(y){return y&&this.x===y.x&&this.y===y.y}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.e;return y&&(0,U.u)(this.x,y.x,g)&&(0,U.u)(this.y,y.y,g)}equalsToFloats(y,g){return this.x===y&&this.y===g}floor(){return new c(Math.floor(this.x),Math.floor(this.y))}floorToRef(y){return y.x=Math.floor(this.x),y.y=Math.floor(this.y),y}fract(){return new c(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(y){return y.x=this.x-Math.floor(this.x),y.y=this.y-Math.floor(this.y),y}rotateToRef(y,g){const f=Math.cos(y),p=Math.sin(y),S=f*this.x-p*this.y,k=p*this.x+f*this.y;return g.x=S,g.y=k,g}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(y){return 0===y||1===y?this:this.scaleInPlace(1/y)}normalizeToNew(){const y=new c;return this.normalizeToRef(y),y}normalizeToRef(y){const g=this.length();return 0===g&&(y.x=this.x,y.y=this.y),this.scaleToRef(1/g,y)}clone(){return new c(this.x,this.y)}dot(y){return this.x*y.x+this.y*y.y}static Zero(){return new c(0,0)}static One(){return new c(1,1)}static Random(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c((0,U.q)(y,g),(0,U.q)(y,g))}static RandomToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ne((0,U.q)(y,g),(0,U.q)(y,g))}static get ZeroReadOnly(){return c._ZeroReadOnly}static eh(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(y[g],y[g+1])}static FromArrayToRef(y,g,f){return f.x=y[g],f.y=y[g+1],f}static FromFloatsToRef(y,g,f){return f.ne(y,g),f}static CatmullRom(y,g,f,p,S){const k=S*S,i=S*k,H=.5*(2*g.x+(-y.x+f.x)*S+(2*y.x-5*g.x+4*f.x-p.x)*k+(-y.x+3*g.x-3*f.x+p.x)*i),U=.5*(2*g.y+(-y.y+f.y)*S+(2*y.y-5*g.y+4*f.y-p.y)*k+(-y.y+3*g.y-3*f.y+p.y)*i);return new c(H,U)}static ClampToRef(y,g,f,p){return p.x=(0,U.d)(y.x,g.x,f.x),p.y=(0,U.d)(y.y,g.y,f.y),p}static Clamp(y,g,f){const p=(0,U.d)(y.x,g.x,f.x),S=(0,U.d)(y.y,g.y,f.y);return new c(p,S)}static Hermite(y,g,f,p,S){const k=S*S,i=S*k,H=2*i-3*k+1,U=-2*i+3*k,l=i-2*k+S,Z=i-k,C=y.x*H+f.x*U+g.x*l+p.x*Z,q=y.y*H+f.y*U+g.y*l+p.y*Z;return new c(C,q)}static Hermite1stDerivative(y,g,f,p,S){return this.Hermite1stDerivativeToRef(y,g,f,p,S,new c)}static Hermite1stDerivativeToRef(y,g,f,p,S,k){const i=S*S;return k.x=6*(i-S)*y.x+(3*i-4*S+1)*g.x+6*(-i+S)*f.x+(3*i-2*S)*p.x,k.y=6*(i-S)*y.y+(3*i-4*S+1)*g.y+6*(-i+S)*f.y+(3*i-2*S)*p.y,k}static Lerp(y,g,f){return c.LerpToRef(y,g,f,new c)}static LerpToRef(y,g,f,p){return p.x=y.x+(g.x-y.x)*f,p.y=y.y+(g.y-y.y)*f,p}static Dot(y,g){return y.x*g.x+y.y*g.y}static Normalize(y){return c.NormalizeToRef(y,new c)}static NormalizeToRef(y,g){return y.normalizeToRef(g),g}static Minimize(y,g){const f=y.x<g.x?y.x:g.x,p=y.y<g.y?y.y:g.y;return new c(f,p)}static Maximize(y,g){const f=y.x>g.x?y.x:g.x,p=y.y>g.y?y.y:g.y;return new c(f,p)}static Transform(y,g){return c.TransformToRef(y,g,new c)}static TransformToRef(y,g,f){const p=g.m,S=y.x*p[0]+y.y*p[4]+p[12],k=y.x*p[1]+y.y*p[5]+p[13];return f.x=S,f.y=k,f}static PointInTriangle(y,g,f,p){const S=.5*(-f.y*p.x+g.y*(-f.x+p.x)+g.x*(f.y-p.y)+f.x*p.y),k=S<0?-1:1,i=(g.y*p.x-g.x*p.y+(p.y-g.y)*y.x+(g.x-p.x)*y.y)*k,H=(g.x*f.y-g.y*f.x+(g.y-f.y)*y.x+(f.x-g.x)*y.y)*k;return i>0&&H>0&&i+H<2*S*k}static Distance(y,g){return Math.sqrt(c.DistanceSquared(y,g))}static DistanceSquared(y,g){const f=y.x-g.x,p=y.y-g.y;return f*f+p*p}static Center(y,g){return c.CenterToRef(y,g,new c)}static CenterToRef(y,g,f){return f.ne((y.x+g.x)/2,(y.y+g.y)/2)}static DistanceOfPointFromSegment(y,g,f){const p=c.DistanceSquared(g,f);if(0===p)return c.Distance(y,g);const S=f.ed(g),k=Math.max(0,Math.min(1,c.Dot(y.ed(g),S)/p)),i=g.add(S.multiplyByFloats(k,k));return c.Distance(y,i)}}c._ZeroReadOnly=c.Zero(),Object.defineProperties(c.prototype,{dimension:{value:[2]},rank:{value:1}});class Z{get x(){return this._x}set x(y){this._x=y,this._isDirty=!0}get y(){return this._y}set y(y){this._y=y,this._isDirty=!0}get z(){return this._z}set z(y){this._z=y,this._isDirty=!0}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=y,this._y=g,this._z=f}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"o"}getHashCode(){let y=l(this._x);return y=397*y^l(this._y),y=397*y^l(this._z),y}mj(){return[this._x,this._y,this._z]}toArray(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y[g]=this._x,y[g+1]=this._y,y[g+2]=this._z,this}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z.FromArrayToRef(y,g,this),this}toQuaternion(){return q.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(y){return this._x+=y._x,this._y+=y._y,this._z+=y._z,this._isDirty=!0,this}addInPlaceFromFloats(y,g,f){return this._x+=y,this._y+=g,this._z+=f,this._isDirty=!0,this}add(y){return new Z(this._x+y._x,this._y+y._y,this._z+y._z)}addToRef(y,g){return g._x=this._x+y._x,g._y=this._y+y._y,g._z=this._z+y._z,g._isDirty=!0,g}ti(y){return this._x-=y._x,this._y-=y._y,this._z-=y._z,this._isDirty=!0,this}ed(y){return new Z(this._x-y._x,this._y-y._y,this._z-y._z)}subtractToRef(y,g){return this.subtractFromFloatsToRef(y._x,y._y,y._z,g)}subtractFromFloats(y,g,f){return new Z(this._x-y,this._y-g,this._z-f)}subtractFromFloatsToRef(y,g,f,p){return p._x=this._x-y,p._y=this._y-g,p._z=this._z-f,p._isDirty=!0,p}negate(){return new Z(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(y){return y._x=-1*this._x,y._y=-1*this._y,y._z=-1*this._z,y._isDirty=!0,y}scaleInPlace(y){return this._x*=y,this._y*=y,this._z*=y,this._isDirty=!0,this}scale(y){return new Z(this._x*y,this._y*y,this._z*y)}scaleToRef(y,g){return g._x=this._x*y,g._y=this._y*y,g._z=this._z*y,g._isDirty=!0,g}getNormalToRef(y){const g=this.length();let f=Math.acos(this.y/g);const p=Math.atan2(this.z,this.x);f>Math.PI/2?f-=Math.PI/2:f+=Math.PI/2;const S=g*Math.sin(f)*Math.cos(p),k=g*Math.cos(f),i=g*Math.sin(f)*Math.sin(p);return y.set(S,k,i),y}applyRotationQuaternionToRef(y,g){const f=this._x,p=this._y,S=this._z,k=y._x,i=y._y,H=y._z,U=y._w,l=2*(i*S-H*p),c=2*(H*f-k*S),Z=2*(k*p-i*f);return g._x=f+U*l+i*Z-H*c,g._y=p+U*c+H*l-k*Z,g._z=S+U*Z+k*c-i*l,g._isDirty=!0,g}applyRotationQuaternionInPlace(y){return this.applyRotationQuaternionToRef(y,this)}applyRotationQuaternion(y){return this.applyRotationQuaternionToRef(y,new Z)}scaleAndAddToRef(y,g){return g._x+=this._x*y,g._y+=this._y*y,g._z+=this._z*y,g._isDirty=!0,g}projectOnPlane(y,g){return this.projectOnPlaneToRef(y,g,new Z)}projectOnPlaneToRef(y,g,f){const p=y.k,S=y.d,k=j.o[0];this.subtractToRef(g,k),k.normalize();const i=Z.Dot(k,p);if(Math.abs(i)<1e-10)f.me(1/0);else{const y=-(Z.Dot(g,p)+S)/i,H=k.scaleInPlace(y);g.addToRef(H,f)}return f}equals(y){return y&&this._x===y._x&&this._y===y._y&&this._z===y._z}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.e;return y&&(0,U.u)(this._x,y._x,g)&&(0,U.u)(this._y,y._y,g)&&(0,U.u)(this._z,y._z,g)}equalsToFloats(y,g,f){return this._x===y&&this._y===g&&this._z===f}multiplyInPlace(y){return this._x*=y._x,this._y*=y._y,this._z*=y._z,this._isDirty=!0,this}multiply(y){return this.multiplyByFloats(y._x,y._y,y._z)}multiplyToRef(y,g){return g._x=this._x*y._x,g._y=this._y*y._y,g._z=this._z*y._z,g._isDirty=!0,g}multiplyByFloats(y,g,f){return new Z(this._x*y,this._y*g,this._z*f)}divide(y){return new Z(this._x/y._x,this._y/y._y,this._z/y._z)}divideToRef(y,g){return g._x=this._x/y._x,g._y=this._y/y._y,g._z=this._z/y._z,g._isDirty=!0,g}divideInPlace(y){return this._x=this._x/y._x,this._y=this._y/y._y,this._z=this._z/y._z,this._isDirty=!0,this}minimizeInPlace(y){return this.minimizeInPlaceFromFloats(y._x,y._y,y._z)}maximizeInPlace(y){return this.maximizeInPlaceFromFloats(y._x,y._y,y._z)}minimizeInPlaceFromFloats(y,g,f){return y<this._x&&(this.x=y),g<this._y&&(this.y=g),f<this._z&&(this.z=f),this}maximizeInPlaceFromFloats(y,g,f){return y>this._x&&(this.x=y),g>this._y&&(this.y=g),f>this._z&&(this.z=f),this}isNonUniformWithinEpsilon(y){const g=Math.abs(this._x),f=Math.abs(this._y);if(!(0,U.u)(g,f,y))return!0;const p=Math.abs(this._z);return!(0,U.u)(g,p,y)||!(0,U.u)(f,p,y)}get isNonUniform(){const y=Math.abs(this._x);if(y!==Math.abs(this._y))return!0;return y!==Math.abs(this._z)}floorToRef(y){return y._x=Math.floor(this._x),y._y=Math.floor(this._y),y._z=Math.floor(this._z),y._isDirty=!0,y}floor(){return new Z(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(y){return y._x=this.x-Math.floor(this._x),y._y=this.y-Math.floor(this._y),y._z=this.z-Math.floor(this._z),y._isDirty=!0,y}fract(){return new Z(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(y){if("xyz"===(y=y.toLowerCase()))return this;const g=j.o[0].p(this);return this.x=g[y[0]],this.y=g[y[1]],this.z=g[y[2]],this}rotateByQuaternionToRef(y,g){return y.toRotationMatrix(j.Matrix[0]),Z.TransformCoordinatesToRef(this,j.Matrix[0],g),g}rotateByQuaternionAroundPointToRef(y,g,f){return this.subtractToRef(g,j.o[0]),j.o[0].rotateByQuaternionToRef(y,j.o[0]),g.addToRef(j.o[0],f),f}cross(y){return Z.CrossToRef(this,y,new Z)}normalizeFromLength(y){return 0===y||1===y?this:this.scaleInPlace(1/y)}normalizeToNew(){return this.normalizeToRef(new Z)}normalizeToRef(y){const g=this.length();return 0===g||1===g?(y._x=this._x,y._y=this._y,y._z=this._z,y._isDirty=!0,y):this.scaleToRef(1/g,y)}clone(){return new Z(this._x,this._y,this._z)}p(y){return this.ne(y._x,y._y,y._z)}ne(y,g,f){return this._x=y,this._y=g,this._z=f,this._isDirty=!0,this}set(y,g,f){return this.ne(y,g,f)}me(y){return this._x=this._y=this._z=y,this._isDirty=!0,this}static GetClipFactor(y,g,f,p){const S=Z.Dot(y,f);return(S-p)/(S-Z.Dot(g,f))}static GetAngleBetweenVectors(y,g,f){const p=y.normalizeToRef(j.o[1]),S=g.normalizeToRef(j.o[2]);let k=Z.Dot(p,S);k=(0,U.d)(k,-1,1);const i=Math.acos(k),H=j.o[3];return Z.CrossToRef(p,S,H),Z.Dot(H,f)>0?isNaN(i)?0:i:isNaN(i)?-Math.PI:-Math.acos(k)}static GetAngleBetweenVectorsOnPlane(y,g,f){j.o[0].p(y);const p=j.o[0];j.o[1].p(g);const S=j.o[1];j.o[2].p(f);const k=j.o[2],i=j.o[3],H=j.o[4];p.normalize(),S.normalize(),k.normalize(),Z.CrossToRef(k,p,i),Z.CrossToRef(i,k,H);const l=Math.atan2(Z.Dot(S,i),Z.Dot(S,H));return(0,U.o)(l)}static PitchYawRollToMoveBetweenPointsToRef(y,g,f){const p=P.o[0];return g.subtractToRef(y,p),f._y=Math.atan2(p.x,p.z)||0,f._x=Math.atan2(Math.sqrt(p.x**2+p.z**2),p.y)||0,f._z=0,f._isDirty=!0,f}static PitchYawRollToMoveBetweenPoints(y,g){const f=Z.Zero();return Z.PitchYawRollToMoveBetweenPointsToRef(y,g,f)}static SlerpToRef(y,g,f,S){f=(0,U.d)(f,0,1);const k=j.o[0],i=j.o[1];k.p(y);const H=k.length();k.normalizeFromLength(H),i.p(g);const l=i.length();i.normalizeFromLength(l);const c=Z.Dot(k,i);let C,q;if(c<1-p.e){const y=Math.acos(c),g=1/Math.sin(y);C=Math.sin((1-f)*y)*g,q=Math.sin(f*y)*g}else C=1-f,q=f;return k.scaleInPlace(C),i.scaleInPlace(q),S.p(k).addInPlace(i),S.scaleInPlace((0,U.n)(H,l,f)),S}static SmoothToRef(y,g,f,p,S){return Z.SlerpToRef(y,g,0===p?1:f/p,S),S}static eh(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Z(y[g],y[g+1],y[g+2])}static FromFloatArray(y,g){return Z.eh(y,g)}static FromArrayToRef(y,g,f){return f._x=y[g],f._y=y[g+1],f._z=y[g+2],f._isDirty=!0,f}static FromFloatArrayToRef(y,g,f){return Z.FromArrayToRef(y,g,f)}static FromFloatsToRef(y,g,f,p){return p.ne(y,g,f),p}static Zero(){return new Z(0,0,0)}static One(){return new Z(1,1,1)}static Up(){return new Z(0,1,0)}static get UpReadOnly(){return Z._UpReadOnly}static get DownReadOnly(){return Z._DownReadOnly}static get RightReadOnly(){return Z._RightReadOnly}static get LeftReadOnly(){return Z._LeftReadOnly}static get LeftHandedForwardReadOnly(){return Z._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return Z._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return Z._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return Z._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return Z._ZeroReadOnly}static get OneReadOnly(){return Z._OneReadOnly}static Down(){return new Z(0,-1,0)}static Forward(){return new Z(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new Z(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new Z(1,0,0)}static Left(){return new Z(-1,0,0)}static Random(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Z((0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g))}static RandomToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ne((0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g))}static TransformCoordinates(y,g){const f=Z.Zero();return Z.TransformCoordinatesToRef(y,g,f),f}static TransformCoordinatesToRef(y,g,f){return Z.TransformCoordinatesFromFloatsToRef(y._x,y._y,y._z,g,f),f}static TransformCoordinatesFromFloatsToRef(y,g,f,p,S){const k=p.m,i=y*k[0]+g*k[4]+f*k[8]+k[12],H=y*k[1]+g*k[5]+f*k[9]+k[13],U=y*k[2]+g*k[6]+f*k[10]+k[14],l=1/(y*k[3]+g*k[7]+f*k[11]+k[15]);return S._x=i*l,S._y=H*l,S._z=U*l,S._isDirty=!0,S}static TransformNormal(y,g){const f=Z.Zero();return Z.TransformNormalToRef(y,g,f),f}static TransformNormalToRef(y,g,f){return this.TransformNormalFromFloatsToRef(y._x,y._y,y._z,g,f),f}static TransformNormalFromFloatsToRef(y,g,f,p,S){const k=p.m;return S._x=y*k[0]+g*k[4]+f*k[8],S._y=y*k[1]+g*k[5]+f*k[9],S._z=y*k[2]+g*k[6]+f*k[10],S._isDirty=!0,S}static CatmullRom(y,g,f,p,S){const k=S*S,i=S*k,H=.5*(2*g._x+(-y._x+f._x)*S+(2*y._x-5*g._x+4*f._x-p._x)*k+(-y._x+3*g._x-3*f._x+p._x)*i),U=.5*(2*g._y+(-y._y+f._y)*S+(2*y._y-5*g._y+4*f._y-p._y)*k+(-y._y+3*g._y-3*f._y+p._y)*i),l=.5*(2*g._z+(-y._z+f._z)*S+(2*y._z-5*g._z+4*f._z-p._z)*k+(-y._z+3*g._z-3*f._z+p._z)*i);return new Z(H,U,l)}static Clamp(y,g,f){const p=new Z;return Z.ClampToRef(y,g,f,p),p}static ClampToRef(y,g,f,p){let S=y._x;S=S>f._x?f._x:S,S=S<g._x?g._x:S;let k=y._y;k=k>f._y?f._y:k,k=k<g._y?g._y:k;let i=y._z;return i=i>f._z?f._z:i,i=i<g._z?g._z:i,p.ne(S,k,i),p}static CheckExtends(y,g,f){g.minimizeInPlace(y),f.maximizeInPlace(y)}static Hermite(y,g,f,p,S){const k=S*S,i=S*k,H=2*i-3*k+1,U=-2*i+3*k,l=i-2*k+S,c=i-k,C=y._x*H+f._x*U+g._x*l+p._x*c,q=y._y*H+f._y*U+g._y*l+p._y*c,W=y._z*H+f._z*U+g._z*l+p._z*c;return new Z(C,q,W)}static Hermite1stDerivative(y,g,f,p,S){const k=new Z;return this.Hermite1stDerivativeToRef(y,g,f,p,S,k),k}static Hermite1stDerivativeToRef(y,g,f,p,S,k){const i=S*S;return k._x=6*(i-S)*y._x+(3*i-4*S+1)*g._x+6*(-i+S)*f._x+(3*i-2*S)*p._x,k._y=6*(i-S)*y._y+(3*i-4*S+1)*g._y+6*(-i+S)*f._y+(3*i-2*S)*p._y,k._z=6*(i-S)*y._z+(3*i-4*S+1)*g._z+6*(-i+S)*f._z+(3*i-2*S)*p._z,k._isDirty=!0,k}static Lerp(y,g,f){const p=new Z(0,0,0);return Z.LerpToRef(y,g,f,p),p}static LerpToRef(y,g,f,p){return p._x=y._x+(g._x-y._x)*f,p._y=y._y+(g._y-y._y)*f,p._z=y._z+(g._z-y._z)*f,p._isDirty=!0,p}static Dot(y,g){return y._x*g._x+y._y*g._y+y._z*g._z}dot(y){return this._x*y._x+this._y*y._y+this._z*y._z}static Cross(y,g){const f=new Z;return Z.CrossToRef(y,g,f),f}static CrossToRef(y,g,f){const p=y._y*g._z-y._z*g._y,S=y._z*g._x-y._x*g._z,k=y._x*g._y-y._y*g._x;return f.ne(p,S,k),f}static Normalize(y){const g=Z.Zero();return Z.NormalizeToRef(y,g),g}static NormalizeToRef(y,g){return y.normalizeToRef(g),g}static Project(y,g,f,p){const S=new Z;return Z.ProjectToRef(y,g,f,p,S),S}static ProjectToRef(y,g,f,p,S){var k;const i=p.width,U=p.height,l=p.x,c=p.y,C=j.Matrix[1],q=null===(k=H.d.LastCreatedEngine)||void 0===k?void 0:k.isNDCHalfZRange,P=q?1:.5,B=q?0:.5;W.FromValuesToRef(i/2,0,0,0,0,-U/2,0,0,0,0,P,0,l+i/2,U/2+c,B,1,C);const R=j.Matrix[0];return g.multiplyToRef(f,R),R.multiplyToRef(C,R),Z.TransformCoordinatesToRef(y,R,S),S}static Reflect(y,g){return this.ReflectToRef(y,g,new Z)}static ReflectToRef(y,g,f){const p=P.o[0];return p.p(g).scaleInPlace(2*Z.Dot(y,g)),f.p(y).ti(p)}static _UnprojectFromInvertedMatrixToRef(y,g,f){Z.TransformCoordinatesToRef(y,g,f);const p=g.m,S=y._x*p[3]+y._y*p[7]+y._z*p[11]+p[15];return(0,U.u)(S,1)&&f.scaleInPlace(1/S),f}static UnprojectFromTransform(y,g,f,p,S){return this.Unproject(y,g,f,p,S,W.IdentityReadOnly)}static Unproject(y,g,f,p,S,k){const i=new Z;return Z.UnprojectToRef(y,g,f,p,S,k,i),i}static UnprojectToRef(y,g,f,p,S,k,i){return Z.UnprojectFloatsToRef(y._x,y._y,y._z,g,f,p,S,k,i),i}static UnprojectFloatsToRef(y,g,f,p,S,k,i,U,l){var c;const C=j.Matrix[0];k.multiplyToRef(i,C),C.multiplyToRef(U,C),C.invert();const q=j.o[0];return q.x=y/p*2-1,q.y=-(g/S*2-1),null!==(c=H.d.LastCreatedEngine)&&void 0!==c&&c.isNDCHalfZRange?q.z=f:q.z=2*f-1,Z._UnprojectFromInvertedMatrixToRef(q,C,l),l}static Minimize(y,g){const f=new Z;return f.p(y),f.minimizeInPlace(g),f}static Maximize(y,g){const f=new Z;return f.p(y),f.maximizeInPlace(g),f}static Distance(y,g){return Math.sqrt(Z.DistanceSquared(y,g))}static DistanceSquared(y,g){const f=y._x-g._x,p=y._y-g._y,S=y._z-g._z;return f*f+p*p+S*S}static ProjectOnTriangleToRef(y,g,f,S,k){const i=j.o[0],H=j.o[1],l=j.o[2],c=j.o[3],C=j.o[4];f.subtractToRef(g,i),S.subtractToRef(g,H),S.subtractToRef(f,l);const q=i.length(),W=H.length(),P=l.length();if(q<p.e||W<p.e||P<p.e)return k.p(g),Z.Distance(y,g);y.subtractToRef(g,C),Z.CrossToRef(i,H,c);const B=c.length();if(B<p.e)return k.p(g),Z.Distance(y,g);c.normalizeFromLength(B);let R=C.length();if(R<p.e)return k.p(g),0;C.normalizeFromLength(R);const G=Z.Dot(c,C),z=j.o[5],T=j.o[6];z.p(c).scaleInPlace(-R*G),T.p(y).addInPlace(z);const Q=j.o[4],m=j.o[5],a=j.o[7],w=j.o[8];Q.p(i).scaleInPlace(1/q),w.p(H).scaleInPlace(1/W),Q.addInPlace(w).scaleInPlace(-1),m.p(i).scaleInPlace(-1/q),w.p(l).scaleInPlace(1/P),m.addInPlace(w).scaleInPlace(-1),a.p(l).scaleInPlace(-1/P),w.p(H).scaleInPlace(-1/W),a.addInPlace(w).scaleInPlace(-1);const o=j.o[9];let I;o.p(T).ti(g),Z.CrossToRef(Q,o,w),I=Z.Dot(w,c);const Y=I;o.p(T).ti(f),Z.CrossToRef(m,o,w),I=Z.Dot(w,c);const n=I;o.p(T).ti(S),Z.CrossToRef(a,o,w),I=Z.Dot(w,c);const M=I,r=j.o[10];let N,b;Y>0&&n<0?(r.p(i),N=g,b=f):n>0&&M<0?(r.p(l),N=f,b=S):(r.p(H).scaleInPlace(-1),N=S,b=g);const s=j.o[9],u=j.o[4];N.subtractToRef(T,w),b.subtractToRef(T,s),Z.CrossToRef(w,s,u);if(!(Z.Dot(u,c)<0))return k.p(T),Math.abs(R*G);const F=j.o[5];Z.CrossToRef(r,u,F),F.normalize();const A=j.o[9];A.p(N).ti(T);const J=A.length();if(J<p.e)return k.p(N),Z.Distance(y,N);A.normalizeFromLength(J);const V=Z.Dot(F,A),e=j.o[7];e.p(T).addInPlace(F.scaleInPlace(J*V)),w.p(e).ti(N),R=r.length(),r.normalizeFromLength(R);let h=Z.Dot(w,r)/Math.max(R,p.e);return h=(0,U.d)(h,0,1),e.p(N).addInPlace(r.scaleInPlace(h*R)),k.p(e),Z.Distance(y,e)}static Center(y,g){return Z.CenterToRef(y,g,Z.Zero())}static CenterToRef(y,g,f){return f.ne((y._x+g._x)/2,(y._y+g._y)/2,(y._z+g._z)/2)}static RotationFromAxis(y,g,f){const p=new Z;return Z.RotationFromAxisToRef(y,g,f,p),p}static RotationFromAxisToRef(y,g,f,p){const S=j.Quaternion[0];return q.RotationQuaternionFromAxisToRef(y,g,f,S),S.toEulerAnglesToRef(p),p}}Z._UpReadOnly=Z.Up(),Z._DownReadOnly=Z.Down(),Z._LeftHandedForwardReadOnly=Z.Forward(!1),Z._RightHandedForwardReadOnly=Z.Forward(!0),Z._LeftHandedBackwardReadOnly=Z.Backward(!1),Z._RightHandedBackwardReadOnly=Z.Backward(!0),Z._RightReadOnly=Z.Right(),Z._LeftReadOnly=Z.Left(),Z._ZeroReadOnly=Z.Zero(),Z._OneReadOnly=Z.One(),Object.defineProperties(Z.prototype,{dimension:{value:[3]},rank:{value:1}});class C{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=y,this.y=g,this.z=f,this.w=p}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let y=l(this.x);return y=397*y^l(this.y),y=397*y^l(this.z),y=397*y^l(this.w),y}mj(){return[this.x,this.y,this.z,this.w]}toArray(y,g){return void 0===g&&(g=0),y[g]=this.x,y[g+1]=this.y,y[g+2]=this.z,y[g+3]=this.w,this}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return C.FromArrayToRef(y,g,this),this}addInPlace(y){return this.x+=y.x,this.y+=y.y,this.z+=y.z,this.w+=y.w,this}addInPlaceFromFloats(y,g,f,p){return this.x+=y,this.y+=g,this.z+=f,this.w+=p,this}add(y){return new C(this.x+y.x,this.y+y.y,this.z+y.z,this.w+y.w)}addToRef(y,g){return g.x=this.x+y.x,g.y=this.y+y.y,g.z=this.z+y.z,g.w=this.w+y.w,g}ti(y){return this.x-=y.x,this.y-=y.y,this.z-=y.z,this.w-=y.w,this}ed(y){return new C(this.x-y.x,this.y-y.y,this.z-y.z,this.w-y.w)}subtractToRef(y,g){return g.x=this.x-y.x,g.y=this.y-y.y,g.z=this.z-y.z,g.w=this.w-y.w,g}subtractFromFloats(y,g,f,p){return new C(this.x-y,this.y-g,this.z-f,this.w-p)}subtractFromFloatsToRef(y,g,f,p,S){return S.x=this.x-y,S.y=this.y-g,S.z=this.z-f,S.w=this.w-p,S}negate(){return new C(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(y){return y.x=-this.x,y.y=-this.y,y.z=-this.z,y.w=-this.w,y}scaleInPlace(y){return this.x*=y,this.y*=y,this.z*=y,this.w*=y,this}scale(y){return new C(this.x*y,this.y*y,this.z*y,this.w*y)}scaleToRef(y,g){return g.x=this.x*y,g.y=this.y*y,g.z=this.z*y,g.w=this.w*y,g}scaleAndAddToRef(y,g){return g.x+=this.x*y,g.y+=this.y*y,g.z+=this.z*y,g.w+=this.w*y,g}equals(y){return y&&this.x===y.x&&this.y===y.y&&this.z===y.z&&this.w===y.w}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.e;return y&&(0,U.u)(this.x,y.x,g)&&(0,U.u)(this.y,y.y,g)&&(0,U.u)(this.z,y.z,g)&&(0,U.u)(this.w,y.w,g)}equalsToFloats(y,g,f,p){return this.x===y&&this.y===g&&this.z===f&&this.w===p}multiplyInPlace(y){return this.x*=y.x,this.y*=y.y,this.z*=y.z,this.w*=y.w,this}multiply(y){return new C(this.x*y.x,this.y*y.y,this.z*y.z,this.w*y.w)}multiplyToRef(y,g){return g.x=this.x*y.x,g.y=this.y*y.y,g.z=this.z*y.z,g.w=this.w*y.w,g}multiplyByFloats(y,g,f,p){return new C(this.x*y,this.y*g,this.z*f,this.w*p)}divide(y){return new C(this.x/y.x,this.y/y.y,this.z/y.z,this.w/y.w)}divideToRef(y,g){return g.x=this.x/y.x,g.y=this.y/y.y,g.z=this.z/y.z,g.w=this.w/y.w,g}divideInPlace(y){return this.divideToRef(y,this)}minimizeInPlace(y){return y.x<this.x&&(this.x=y.x),y.y<this.y&&(this.y=y.y),y.z<this.z&&(this.z=y.z),y.w<this.w&&(this.w=y.w),this}maximizeInPlace(y){return y.x>this.x&&(this.x=y.x),y.y>this.y&&(this.y=y.y),y.z>this.z&&(this.z=y.z),y.w>this.w&&(this.w=y.w),this}minimizeInPlaceFromFloats(y,g,f,p){return this.x=Math.min(y,this.x),this.y=Math.min(g,this.y),this.z=Math.min(f,this.z),this.w=Math.min(p,this.w),this}maximizeInPlaceFromFloats(y,g,f,p){return this.x=Math.max(y,this.x),this.y=Math.max(g,this.y),this.z=Math.max(f,this.z),this.w=Math.max(p,this.w),this}floorToRef(y){return y.x=Math.floor(this.x),y.y=Math.floor(this.y),y.z=Math.floor(this.z),y.w=Math.floor(this.w),y}floor(){return new C(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(y){return y.x=this.x-Math.floor(this.x),y.y=this.y-Math.floor(this.y),y.z=this.z-Math.floor(this.z),y.w=this.w-Math.floor(this.w),y}fract(){return new C(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(y){return 0===y||1===y?this:this.scaleInPlace(1/y)}normalizeToNew(){return this.normalizeToRef(new C)}normalizeToRef(y){const g=this.length();return 0===g||1===g?(y.x=this.x,y.y=this.y,y.z=this.z,y.w=this.w,y):this.scaleToRef(1/g,y)}toVector3(){return new Z(this.x,this.y,this.z)}clone(){return new C(this.x,this.y,this.z,this.w)}p(y){return this.x=y.x,this.y=y.y,this.z=y.z,this.w=y.w,this}ne(y,g,f,p){return this.x=y,this.y=g,this.z=f,this.w=p,this}set(y,g,f,p){return this.ne(y,g,f,p)}me(y){return this.x=this.y=this.z=this.w=y,this}dot(y){return this.x*y.x+this.y*y.y+this.z*y.z+this.w*y.w}static eh(y,g){return g||(g=0),new C(y[g],y[g+1],y[g+2],y[g+3])}static FromArrayToRef(y,g,f){return f.x=y[g],f.y=y[g+1],f.z=y[g+2],f.w=y[g+3],f}static FromFloatArrayToRef(y,g,f){return C.FromArrayToRef(y,g,f),f}static FromFloatsToRef(y,g,f,p,S){return S.x=y,S.y=g,S.z=f,S.w=p,S}static Zero(){return new C(0,0,0,0)}static One(){return new C(1,1,1,1)}static Random(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new C((0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g))}static RandomToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2?arguments[2]:void 0;return f.x=(0,U.q)(y,g),f.y=(0,U.q)(y,g),f.z=(0,U.q)(y,g),f.w=(0,U.q)(y,g),f}static Clamp(y,g,f){return C.ClampToRef(y,g,f,new C)}static ClampToRef(y,g,f,p){return p.x=(0,U.d)(y.x,g.x,f.x),p.y=(0,U.d)(y.y,g.y,f.y),p.z=(0,U.d)(y.z,g.z,f.z),p.w=(0,U.d)(y.w,g.w,f.w),p}static CheckExtends(y,g,f){g.minimizeInPlace(y),f.maximizeInPlace(y)}static get ZeroReadOnly(){return C._ZeroReadOnly}static Normalize(y){return C.NormalizeToRef(y,new C)}static NormalizeToRef(y,g){return y.normalizeToRef(g),g}static Minimize(y,g){const f=new C;return f.p(y),f.minimizeInPlace(g),f}static Maximize(y,g){const f=new C;return f.p(y),f.maximizeInPlace(g),f}static Distance(y,g){return Math.sqrt(C.DistanceSquared(y,g))}static DistanceSquared(y,g){const f=y.x-g.x,p=y.y-g.y,S=y.z-g.z,k=y.w-g.w;return f*f+p*p+S*S+k*k}static Center(y,g){return C.CenterToRef(y,g,new C)}static CenterToRef(y,g,f){return f.x=(y.x+g.x)/2,f.y=(y.y+g.y)/2,f.z=(y.z+g.z)/2,f.w=(y.w+g.w)/2,f}static TransformCoordinates(y,g){return C.TransformCoordinatesToRef(y,g,new C)}static TransformCoordinatesToRef(y,g,f){return C.TransformCoordinatesFromFloatsToRef(y._x,y._y,y._z,g,f),f}static TransformCoordinatesFromFloatsToRef(y,g,f,p,S){const k=p.m,i=y*k[0]+g*k[4]+f*k[8]+k[12],H=y*k[1]+g*k[5]+f*k[9]+k[13],U=y*k[2]+g*k[6]+f*k[10]+k[14],l=y*k[3]+g*k[7]+f*k[11]+k[15];return S.x=i,S.y=H,S.z=U,S.w=l,S}static TransformNormal(y,g){return C.TransformNormalToRef(y,g,new C)}static TransformNormalToRef(y,g,f){const p=g.m,S=y.x*p[0]+y.y*p[4]+y.z*p[8],k=y.x*p[1]+y.y*p[5]+y.z*p[9],i=y.x*p[2]+y.y*p[6]+y.z*p[10];return f.x=S,f.y=k,f.z=i,f.w=y.w,f}static TransformNormalFromFloatsToRef(y,g,f,p,S,k){const i=S.m;return k.x=y*i[0]+g*i[4]+f*i[8],k.y=y*i[1]+g*i[5]+f*i[9],k.z=y*i[2]+g*i[6]+f*i[10],k.w=p,k}static FromVector3(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new C(y._x,y._y,y._z,g)}static Dot(y,g){return y.x*g.x+y.y*g.y+y.z*g.z+y.w*g.w}}C._ZeroReadOnly=C.Zero(),Object.defineProperties(C.prototype,{dimension:{value:[4]},rank:{value:1}});class q{get x(){return this._x}set x(y){this._x=y,this._isDirty=!0}get y(){return this._y}set y(y){this._y=y,this._isDirty=!0}get z(){return this._z}set z(y){this._z=y,this._isDirty=!0}get w(){return this._w}set w(y){this._w=y,this._isDirty=!0}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=y,this._y=g,this._z=f,this._w=p}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let y=l(this._x);return y=397*y^l(this._y),y=397*y^l(this._z),y=397*y^l(this._w),y}mj(){return[this._x,this._y,this._z,this._w]}toArray(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y[g]=this._x,y[g+1]=this._y,y[g+2]=this._z,y[g+3]=this._w,this}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q.FromArrayToRef(y,g,this)}equals(y){return y&&this._x===y._x&&this._y===y._y&&this._z===y._z&&this._w===y._w}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.e;return y&&(0,U.u)(this._x,y._x,g)&&(0,U.u)(this._y,y._y,g)&&(0,U.u)(this._z,y._z,g)&&(0,U.u)(this._w,y._w,g)}clone(){return new q(this._x,this._y,this._z,this._w)}p(y){return this._x=y._x,this._y=y._y,this._z=y._z,this._w=y._w,this._isDirty=!0,this}ne(y,g,f,p){return this._x=y,this._y=g,this._z=f,this._w=p,this._isDirty=!0,this}set(y,g,f,p){return this.ne(y,g,f,p)}me(y){return this.ne(y,y,y,y)}add(y){return new q(this._x+y._x,this._y+y._y,this._z+y._z,this._w+y._w)}addInPlace(y){return this._x+=y._x,this._y+=y._y,this._z+=y._z,this._w+=y._w,this._isDirty=!0,this}addToRef(y,g){return g._x=this._x+y._x,g._y=this._y+y._y,g._z=this._z+y._z,g._w=this._w+y._w,g._isDirty=!0,g}addInPlaceFromFloats(y,g,f,p){return this._x+=y,this._y+=g,this._z+=f,this._w+=p,this._isDirty=!0,this}subtractToRef(y,g){return g._x=this._x-y._x,g._y=this._y-y._y,g._z=this._z-y._z,g._w=this._w-y._w,g._isDirty=!0,g}subtractFromFloats(y,g,f,p){return this.subtractFromFloatsToRef(y,g,f,p,new q)}subtractFromFloatsToRef(y,g,f,p,S){return S._x=this._x-y,S._y=this._y-g,S._z=this._z-f,S._w=this._w-p,S._isDirty=!0,S}ed(y){return new q(this._x-y._x,this._y-y._y,this._z-y._z,this._w-y._w)}ti(y){return this._x-=y._x,this._y-=y._y,this._z-=y._z,this._w-=y._w,this._isDirty=!0,this}scale(y){return new q(this._x*y,this._y*y,this._z*y,this._w*y)}scaleToRef(y,g){return g._x=this._x*y,g._y=this._y*y,g._z=this._z*y,g._w=this._w*y,g._isDirty=!0,g}scaleInPlace(y){return this._x*=y,this._y*=y,this._z*=y,this._w*=y,this._isDirty=!0,this}scaleAndAddToRef(y,g){return g._x+=this._x*y,g._y+=this._y*y,g._z+=this._z*y,g._w+=this._w*y,g._isDirty=!0,g}multiply(y){const g=new q(0,0,0,1);return this.multiplyToRef(y,g),g}multiplyToRef(y,g){const f=this._x*y._w+this._y*y._z-this._z*y._y+this._w*y._x,p=-this._x*y._z+this._y*y._w+this._z*y._x+this._w*y._y,S=this._x*y._y-this._y*y._x+this._z*y._w+this._w*y._z,k=-this._x*y._x-this._y*y._y-this._z*y._z+this._w*y._w;return g.ne(f,p,S,k),g}multiplyInPlace(y){return this.multiplyToRef(y,this)}multiplyByFloats(y,g,f,p){return this._x*=y,this._y*=g,this._z*=f,this._w*=p,this._isDirty=!0,this}divide(y){throw new ReferenceError("Can not divide a quaternion")}divideToRef(y,g){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(y){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new q)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(y){return y._x=-this._x,y._y=-this._y,y._z=-this._z,y._w=-this._w,y._isDirty=!0,y}equalsToFloats(y,g,f,p){return this._x===y&&this._y===g&&this._z===f&&this._w===p}floorToRef(y){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(y){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(y){return y.ne(-this._x,-this._y,-this._z,this._w),y}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new q(-this._x,-this._y,-this._z,this._w)}invert(){const y=this.conjugate(),g=this.lengthSquared();return 0==g||1==g||y.scaleInPlace(1/g),y}invertInPlace(){this.conjugateInPlace();const y=this.lengthSquared();return 0==y||1==y||this.scaleInPlace(1/y),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(y){return 0===y||1===y?this:this.scaleInPlace(1/y)}normalizeToNew(){const y=new q(0,0,0,1);return this.normalizeToRef(y),y}normalizeToRef(y){const g=this.length();return 0===g||1===g?y.ne(this._x,this._y,this._z,this._w):this.scaleToRef(1/g,y)}toEulerAngles(){const y=Z.Zero();return this.toEulerAnglesToRef(y),y}toEulerAnglesToRef(y){const g=this._z,f=this._x,p=this._y,S=this._w,k=p*g-f*S,i=.4999999;if(k<-i)y._y=2*Math.atan2(p,S),y._x=Math.PI/2,y._z=0,y._isDirty=!0;else if(k>i)y._y=2*Math.atan2(p,S),y._x=-Math.PI/2,y._z=0,y._isDirty=!0;else{const i=S*S,H=g*g,U=f*f,l=p*p;y._z=Math.atan2(2*(f*p+g*S),-H-U+l+i),y._x=Math.asin(-2*k),y._y=Math.atan2(2*(g*f+p*S),H-U-l+i),y._isDirty=!0}return y}toAlphaBetaGammaToRef(y){const g=this._z,f=this._x,p=this._y,S=this._w,k=Math.sqrt(f*f+p*p),i=Math.sqrt(g*g+S*S),H=2*Math.atan2(k,i),U=2*Math.atan2(g,S),l=2*Math.atan2(p,f),c=(U+l)/2,Z=(U-l)/2;return y.set(Z,H,c),y}toRotationMatrix(y){return W.FromQuaternionToRef(this,y),y}fromRotationMatrix(y){return q.FromRotationMatrixToRef(y,this),this}dot(y){return this._x*y._x+this._y*y._y+this._z*y._z+this._w*y._w}static FromRotationMatrix(y){const g=new q;return q.FromRotationMatrixToRef(y,g),g}static FromRotationMatrixToRef(y,g){const f=y.m,p=f[0],S=f[4],k=f[8],i=f[1],H=f[5],U=f[9],l=f[2],c=f[6],Z=f[10],C=p+H+Z;let q;return C>0?(q=.5/Math.sqrt(C+1),g._w=.25/q,g._x=(c-U)*q,g._y=(k-l)*q,g._z=(i-S)*q,g._isDirty=!0):p>H&&p>Z?(q=2*Math.sqrt(1+p-H-Z),g._w=(c-U)/q,g._x=.25*q,g._y=(S+i)/q,g._z=(k+l)/q,g._isDirty=!0):H>Z?(q=2*Math.sqrt(1+H-p-Z),g._w=(k-l)/q,g._x=(S+i)/q,g._y=.25*q,g._z=(U+c)/q,g._isDirty=!0):(q=2*Math.sqrt(1+Z-p-H),g._w=(i-S)/q,g._x=(k+l)/q,g._y=(U+c)/q,g._z=.25*q,g._isDirty=!0),g}static Dot(y,g){return y._x*g._x+y._y*g._y+y._z*g._z+y._w*g._w}static AreClose(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const p=q.Dot(y,g);return 1-p*p<=f}static SmoothToRef(y,g,f,p,S){let k=0===p?1:f/p;return k=(0,U.d)(k,0,1),q.SlerpToRef(y,g,k,S),S}static Zero(){return new q(0,0,0,0)}static Inverse(y){return new q(-y._x,-y._y,-y._z,y._w)}static InverseToRef(y,g){return g.set(-y._x,-y._y,-y._z,y._w),g}static Identity(){return new q(0,0,0,1)}static IsIdentity(y){return y&&0===y._x&&0===y._y&&0===y._z&&1===y._w}static RotationAxis(y,g){return q.RotationAxisToRef(y,g,new q)}static RotationAxisToRef(y,g,f){f._w=Math.cos(g/2);const p=Math.sin(g/2)/y.length();return f._x=y._x*p,f._y=y._y*p,f._z=y._z*p,f._isDirty=!0,f}static eh(y,g){return g||(g=0),new q(y[g],y[g+1],y[g+2],y[g+3])}static FromArrayToRef(y,g,f){return f._x=y[g],f._y=y[g+1],f._z=y[g+2],f._w=y[g+3],f._isDirty=!0,f}static FromFloatsToRef(y,g,f,p,S){return S.ne(y,g,f,p),S}static FromEulerAngles(y,g,f){const p=new q;return q.RotationYawPitchRollToRef(g,y,f,p),p}static FromEulerAnglesToRef(y,g,f,p){return q.RotationYawPitchRollToRef(g,y,f,p),p}static FromEulerVector(y){const g=new q;return q.RotationYawPitchRollToRef(y._y,y._x,y._z,g),g}static FromEulerVectorToRef(y,g){return q.RotationYawPitchRollToRef(y._y,y._x,y._z,g),g}static FromUnitVectorsToRef(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.e;const k=Z.Dot(y,g)+1;return k<S?Math.abs(y.x)>Math.abs(y.z)?f.set(-y.y,y.x,0,0):f.set(0,-y.z,y.y,0):(Z.CrossToRef(y,g,P.o[0]),f.set(P.o[0].x,P.o[0].y,P.o[0].z,k)),f.normalize()}static RotationYawPitchRoll(y,g,f){const p=new q;return q.RotationYawPitchRollToRef(y,g,f,p),p}static RotationYawPitchRollToRef(y,g,f,p){const S=.5*f,k=.5*g,i=.5*y,H=Math.sin(S),U=Math.cos(S),l=Math.sin(k),c=Math.cos(k),Z=Math.sin(i),C=Math.cos(i);return p._x=C*l*U+Z*c*H,p._y=Z*c*U-C*l*H,p._z=C*c*H-Z*l*U,p._w=C*c*U+Z*l*H,p._isDirty=!0,p}static RotationAlphaBetaGamma(y,g,f){const p=new q;return q.RotationAlphaBetaGammaToRef(y,g,f,p),p}static RotationAlphaBetaGammaToRef(y,g,f,p){const S=.5*(f+y),k=.5*(f-y),i=.5*g;return p._x=Math.cos(k)*Math.sin(i),p._y=Math.sin(k)*Math.sin(i),p._z=Math.sin(S)*Math.cos(i),p._w=Math.cos(S)*Math.cos(i),p._isDirty=!0,p}static RotationQuaternionFromAxis(y,g,f){const p=new q(0,0,0,0);return q.RotationQuaternionFromAxisToRef(y,g,f,p),p}static RotationQuaternionFromAxisToRef(y,g,f,p){const S=j.Matrix[0];return y=y.normalizeToRef(j.o[0]),g=g.normalizeToRef(j.o[1]),f=f.normalizeToRef(j.o[2]),W.FromXYZAxesToRef(y,g,f,S),q.FromRotationMatrixToRef(S,p),p}static FromLookDirectionLH(y,g){const f=new q;return q.FromLookDirectionLHToRef(y,g,f),f}static FromLookDirectionLHToRef(y,g,f){const p=j.Matrix[0];return W.LookDirectionLHToRef(y,g,p),q.FromRotationMatrixToRef(p,f),f}static FromLookDirectionRH(y,g){const f=new q;return q.FromLookDirectionRHToRef(y,g,f),f}static FromLookDirectionRHToRef(y,g,f){const p=j.Matrix[0];return W.LookDirectionRHToRef(y,g,p),q.FromRotationMatrixToRef(p,f)}static Slerp(y,g,f){const p=q.Identity();return q.SlerpToRef(y,g,f,p),p}static SlerpToRef(y,g,f,p){let S,k,i=y._x*g._x+y._y*g._y+y._z*g._z+y._w*g._w,H=!1;if(i<0&&(H=!0,i=-i),i>.999999)k=1-f,S=H?-f:f;else{const y=Math.acos(i),g=1/Math.sin(y);k=Math.sin((1-f)*y)*g,S=H?-Math.sin(f*y)*g:Math.sin(f*y)*g}return p._x=k*y._x+S*g._x,p._y=k*y._y+S*g._y,p._z=k*y._z+S*g._z,p._w=k*y._w+S*g._w,p._isDirty=!0,p}static Hermite(y,g,f,p,S){const k=S*S,i=S*k,H=2*i-3*k+1,U=-2*i+3*k,l=i-2*k+S,c=i-k,Z=y._x*H+f._x*U+g._x*l+p._x*c,C=y._y*H+f._y*U+g._y*l+p._y*c,W=y._z*H+f._z*U+g._z*l+p._z*c,j=y._w*H+f._w*U+g._w*l+p._w*c;return new q(Z,C,W,j)}static Hermite1stDerivative(y,g,f,p,S){const k=new q;return this.Hermite1stDerivativeToRef(y,g,f,p,S,k),k}static Hermite1stDerivativeToRef(y,g,f,p,S,k){const i=S*S;return k._x=6*(i-S)*y._x+(3*i-4*S+1)*g._x+6*(-i+S)*f._x+(3*i-2*S)*p._x,k._y=6*(i-S)*y._y+(3*i-4*S+1)*g._y+6*(-i+S)*f._y+(3*i-2*S)*p._y,k._z=6*(i-S)*y._z+(3*i-4*S+1)*g._z+6*(-i+S)*f._z+(3*i-2*S)*p._z,k._w=6*(i-S)*y._w+(3*i-4*S+1)*g._w+6*(-i+S)*f._w+(3*i-2*S)*p._w,k._isDirty=!0,k}static Normalize(y){const g=q.Zero();return q.NormalizeToRef(y,g),g}static NormalizeToRef(y,g){return y.normalizeToRef(g),g}static Clamp(y,g,f){const p=new q;return q.ClampToRef(y,g,f,p),p}static ClampToRef(y,g,f,p){return p.ne((0,U.d)(y.x,g.x,f.x),(0,U.d)(y.y,g.y,f.y),(0,U.d)(y.z,g.z,f.z),(0,U.d)(y.w,g.w,f.w))}static Random(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new q((0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g))}static RandomToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ne((0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g),(0,U.q)(y,g))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(y,g){return Math.sqrt(q.DistanceSquared(y,g))}static DistanceSquared(y,g){const f=y.x-g.x,p=y.y-g.y,S=y.z-g.z,k=y.w-g.w;return f*f+p*p+S*S+k*k}static Center(y,g){return q.CenterToRef(y,g,q.Zero())}static CenterToRef(y,g,f){return f.ne((y.x+g.x)/2,(y.y+g.y)/2,(y.z+g.z)/2,(y.w+g.w)/2)}}Object.defineProperties(q.prototype,{dimension:{value:[4]},rank:{value:1}});class W{static get Use64Bits(){return i.e.MatrixUse64Bits}get m(){return this.Tj}markAsUpdated(){this.updateFlag=W._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=y,this._isIdentity3x2=y||f,this._isIdentityDirty=!this._isIdentity&&g,this._isIdentity3x2Dirty=!this._isIdentity3x2&&p}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,i.e.MatrixTrackPrecisionChange&&i.e.MatrixTrackedMatrices.push(this),this.Tj=new i.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const y=this.Tj;this._isIdentity=1===y[0]&&0===y[1]&&0===y[2]&&0===y[3]&&0===y[4]&&1===y[5]&&0===y[6]&&0===y[7]&&0===y[8]&&0===y[9]&&1===y[10]&&0===y[11]&&0===y[12]&&0===y[13]&&0===y[14]&&1===y[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Tj[0]||1!==this.Tj[5]||1!==this.Tj[15]||0!==this.Tj[1]||0!==this.Tj[2]||0!==this.Tj[3]||0!==this.Tj[4]||0!==this.Tj[6]||0!==this.Tj[7]||0!==this.Tj[8]||0!==this.Tj[9]||0!==this.Tj[10]||0!==this.Tj[11]||0!==this.Tj[12]||0!==this.Tj[13]||0!==this.Tj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const y=this.Tj,g=y[0],f=y[1],p=y[2],S=y[3],k=y[4],i=y[5],H=y[6],U=y[7],l=y[8],c=y[9],Z=y[10],C=y[11],q=y[12],W=y[13],j=y[14],P=y[15],B=Z*P-j*C,R=c*P-W*C,G=c*j-W*Z,z=l*P-q*C,T=l*j-Z*q,Q=l*W-q*c;return g*+(i*B-H*R+U*G)+f*-(k*B-H*z+U*T)+p*+(k*R-i*z+U*Q)+S*-(k*G-i*T+H*Q)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!y)return this.Tj;const f=this.Tj;for(let p=0;p<16;p++)y[g+p]=f[p];return this}mj(){return this.Tj}hd(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return W.FromArrayToRef(y,g,this)}ne(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];return W.FromArrayToRef(g,0,this)}set(){const y=this.Tj;for(let g=0;g<16;g++)y[g]=g<0||arguments.length<=g?void 0:arguments[g];return this.markAsUpdated(),this}me(y){const g=this.Tj;for(let f=0;f<16;f++)g[f]=y;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return W.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(y){const g=new W;return this.addToRef(y,g),g}addToRef(y,g){const f=this.Tj,p=g.Tj,S=y.m;for(let k=0;k<16;k++)p[k]=f[k]+S[k];return g.markAsUpdated(),g}addToSelf(y){const g=this.Tj,f=y.m;return g[0]+=f[0],g[1]+=f[1],g[2]+=f[2],g[3]+=f[3],g[4]+=f[4],g[5]+=f[5],g[6]+=f[6],g[7]+=f[7],g[8]+=f[8],g[9]+=f[9],g[10]+=f[10],g[11]+=f[11],g[12]+=f[12],g[13]+=f[13],g[14]+=f[14],g[15]+=f[15],this.markAsUpdated(),this}addInPlace(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]+=f[p];return this.markAsUpdated(),this}addInPlaceFromFloats(){const y=this.Tj;for(let g=0;g<16;g++)y[g]+=g<0||arguments.length<=g?void 0:arguments[g];return this.markAsUpdated(),this}ed(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]-=f[p];return this.markAsUpdated(),this}subtractToRef(y,g){const f=this.Tj,p=y.m,S=g.Tj;for(let k=0;k<16;k++)S[k]=f[k]-p[k];return g.markAsUpdated(),g}ti(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]-=f[p];return this.markAsUpdated(),this}subtractFromFloats(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];return this.subtractFromFloatsToRef(...g,new W)}subtractFromFloatsToRef(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];const p=g.pop(),S=this.Tj,k=p.Tj,i=g;for(let H=0;H<16;H++)k[H]=S[H]-i[H];return p.markAsUpdated(),p}invertToRef(y){if(!0===this._isIdentity)return W.IdentityToRef(y),y;const g=this.Tj,f=g[0],p=g[1],S=g[2],k=g[3],i=g[4],H=g[5],U=g[6],l=g[7],c=g[8],Z=g[9],C=g[10],q=g[11],j=g[12],P=g[13],B=g[14],R=g[15],G=C*R-B*q,z=Z*R-P*q,T=Z*B-P*C,Q=c*R-j*q,m=c*B-C*j,a=c*P-j*Z,w=+(H*G-U*z+l*T),o=-(i*G-U*Q+l*m),I=+(i*z-H*Q+l*a),Y=-(i*T-H*m+U*a),n=f*w+p*o+S*I+k*Y;if(0===n)return y.p(this),y;const M=1/n,r=U*R-B*l,N=H*R-P*l,b=H*B-P*U,s=i*R-j*l,u=i*B-j*U,F=i*P-j*H,A=U*q-C*l,J=H*q-Z*l,V=H*C-Z*U,e=i*q-c*l,h=i*C-c*U,D=i*Z-c*H,K=-(p*G-S*z+k*T),X=+(f*G-S*Q+k*m),E=-(f*z-p*Q+k*a),O=+(f*T-p*m+S*a),L=+(p*r-S*N+k*b),x=-(f*r-S*s+k*u),d=+(f*N-p*s+k*F),t=-(f*b-p*u+S*F),v=-(p*A-S*J+k*V),yy=+(f*A-S*e+k*h),gy=-(f*J-p*e+k*D),fy=+(f*V-p*h+S*D);return W.FromValuesToRef(w*M,K*M,L*M,v*M,o*M,X*M,x*M,yy*M,I*M,E*M,d*M,gy*M,Y*M,O*M,t*M,fy*M,y),y}addAtIndex(y,g){return this.Tj[y]+=g,this.markAsUpdated(),this}multiplyAtIndex(y,g){return this.Tj[y]*=g,this.markAsUpdated(),this}setTranslationFromFloats(y,g,f){return this.Tj[12]=y,this.Tj[13]=g,this.Tj[14]=f,this.markAsUpdated(),this}addTranslationFromFloats(y,g,f){return this.Tj[12]+=y,this.Tj[13]+=g,this.Tj[14]+=f,this.markAsUpdated(),this}setTranslation(y){return this.setTranslationFromFloats(y._x,y._y,y._z)}getTranslation(){return new Z(this.Tj[12],this.Tj[13],this.Tj[14])}getTranslationToRef(y){return y.x=this.Tj[12],y.y=this.Tj[13],y.z=this.Tj[14],y}removeRotationAndScaling(){const y=this.m;return W.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,y[12],y[13],y[14],y[15],this),this._updateIdentityStatus(0===y[12]&&0===y[13]&&0===y[14]&&1===y[15]),this}p(y){y.copyToArray(this.Tj);const g=y;return this.updateFlag=g.updateFlag,this._updateIdentityStatus(g._isIdentity,g._isIdentityDirty,g._isIdentity3x2,g._isIdentity3x2Dirty),this}copyToArray(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=this.Tj;return y[g]=f[0],y[g+1]=f[1],y[g+2]=f[2],y[g+3]=f[3],y[g+4]=f[4],y[g+5]=f[5],y[g+6]=f[6],y[g+7]=f[7],y[g+8]=f[8],y[g+9]=f[9],y[g+10]=f[10],y[g+11]=f[11],y[g+12]=f[12],y[g+13]=f[13],y[g+14]=f[14],y[g+15]=f[15],this}multiply(y){const g=new W;return this.multiplyToRef(y,g),g}multiplyInPlace(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]*=f[p];return this.markAsUpdated(),this}multiplyByFloats(){const y=this.Tj;for(let g=0;g<16;g++)y[g]*=g<0||arguments.length<=g?void 0:arguments[g];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];const p=g.pop(),S=this.Tj,k=p.Tj,i=g;for(let H=0;H<16;H++)k[H]=S[H]*i[H];return p.markAsUpdated(),p}multiplyToRef(y,g){return this._isIdentity?(g.p(y),g):y._isIdentity?(g.p(this),g):(this.multiplyToArray(y,g.Tj,0),g.markAsUpdated(),g)}multiplyToArray(y,g,f){const p=this.Tj,S=y.m,k=p[0],i=p[1],H=p[2],U=p[3],l=p[4],c=p[5],Z=p[6],C=p[7],q=p[8],W=p[9],j=p[10],P=p[11],B=p[12],R=p[13],G=p[14],z=p[15],T=S[0],Q=S[1],m=S[2],a=S[3],w=S[4],o=S[5],I=S[6],Y=S[7],n=S[8],M=S[9],r=S[10],N=S[11],b=S[12],s=S[13],u=S[14],F=S[15];return g[f]=k*T+i*w+H*n+U*b,g[f+1]=k*Q+i*o+H*M+U*s,g[f+2]=k*m+i*I+H*r+U*u,g[f+3]=k*a+i*Y+H*N+U*F,g[f+4]=l*T+c*w+Z*n+C*b,g[f+5]=l*Q+c*o+Z*M+C*s,g[f+6]=l*m+c*I+Z*r+C*u,g[f+7]=l*a+c*Y+Z*N+C*F,g[f+8]=q*T+W*w+j*n+P*b,g[f+9]=q*Q+W*o+j*M+P*s,g[f+10]=q*m+W*I+j*r+P*u,g[f+11]=q*a+W*Y+j*N+P*F,g[f+12]=B*T+R*w+G*n+z*b,g[f+13]=B*Q+R*o+G*M+z*s,g[f+14]=B*m+R*I+G*r+z*u,g[f+15]=B*a+R*Y+G*N+z*F,this}divide(y){return this.divideToRef(y,new W)}divideToRef(y,g){const f=this.Tj,p=y.m,S=g.Tj;for(let k=0;k<16;k++)S[k]=f[k]/p[k];return g.markAsUpdated(),g}divideInPlace(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]/=f[p];return this.markAsUpdated(),this}minimizeInPlace(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]=Math.min(g[p],f[p]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const y=this.Tj;for(let g=0;g<16;g++)y[g]=Math.min(y[g],g<0||arguments.length<=g?void 0:arguments[g]);return this.markAsUpdated(),this}maximizeInPlace(y){const g=this.Tj,f=y.m;for(let p=0;p<16;p++)g[p]=Math.min(g[p],f[p]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const y=this.Tj;for(let g=0;g<16;g++)y[g]=Math.min(y[g],g<0||arguments.length<=g?void 0:arguments[g]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new W)}negateInPlace(){const y=this.Tj;for(let g=0;g<16;g++)y[g]=-y[g];return this.markAsUpdated(),this}negateToRef(y){const g=this.Tj,f=y.Tj;for(let p=0;p<16;p++)f[p]=-g[p];return y.markAsUpdated(),y}equals(y){const g=y;if(!g)return!1;if((this._isIdentity||g._isIdentity)&&!this._isIdentityDirty&&!g._isIdentityDirty)return this._isIdentity&&g._isIdentity;const f=this.m,p=g.m;return f[0]===p[0]&&f[1]===p[1]&&f[2]===p[2]&&f[3]===p[3]&&f[4]===p[4]&&f[5]===p[5]&&f[6]===p[6]&&f[7]===p[7]&&f[8]===p[8]&&f[9]===p[9]&&f[10]===p[10]&&f[11]===p[11]&&f[12]===p[12]&&f[13]===p[13]&&f[14]===p[14]&&f[15]===p[15]}equalsWithEpsilon(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=this.Tj,p=y.m;for(let S=0;S<16;S++)if(!(0,U.u)(f[S],p[S],g))return!1;return!0}equalsToFloats(){const y=this.Tj;for(let g=0;g<16;g++)if(y[g]!=(g<0||arguments.length<=g?void 0:arguments[g]))return!1;return!0}floor(){return this.floorToRef(new W)}floorToRef(y){const g=this.Tj,f=y.Tj;for(let p=0;p<16;p++)f[p]=Math.floor(g[p]);return y.markAsUpdated(),y}fract(){return this.fractToRef(new W)}fractToRef(y){const g=this.Tj,f=y.Tj;for(let p=0;p<16;p++)f[p]=g[p]-Math.floor(g[p]);return y.markAsUpdated(),y}clone(){const y=new W;return y.p(this),y}getClassName(){return"Matrix"}getHashCode(){let y=l(this.Tj[0]);for(let g=1;g<16;g++)y=397*y^l(this.Tj[g]);return y}decomposeToTransformNode(y){return y.rotationQuaternion=y.rotationQuaternion||new q,this.decompose(y.pe,y.rotationQuaternion,y.position)}decompose(y,g,f,p){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return f&&f.me(0),y&&y.me(1),g&&g.ne(0,0,0,1),!0;const k=this.Tj;if(f&&f.ne(k[12],k[13],k[14]),(y=y||j.o[0]).x=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]),y.y=Math.sqrt(k[4]*k[4]+k[5]*k[5]+k[6]*k[6]),y.z=Math.sqrt(k[8]*k[8]+k[9]*k[9]+k[10]*k[10]),p){const g=(S?p.absoluteScaling.x:p.pe.x)<0?-1:1,f=(S?p.absoluteScaling.y:p.pe.y)<0?-1:1,k=(S?p.absoluteScaling.z:p.pe.z)<0?-1:1;y.x*=g,y.y*=f,y.z*=k}else this.determinant()<=0&&(y.y*=-1);if(0===y._x||0===y._y||0===y._z)return g&&g.ne(0,0,0,1),!1;if(g){const f=1/y._x,p=1/y._y,S=1/y._z;W.FromValuesToRef(k[0]*f,k[1]*f,k[2]*f,0,k[4]*p,k[5]*p,k[6]*p,0,k[8]*S,k[9]*S,k[10]*S,0,0,0,0,1,j.Matrix[0]),q.FromRotationMatrixToRef(j.Matrix[0],g)}return!0}getRow(y){if(y<0||y>3)return null;const g=4*y;return new C(this.Tj[g+0],this.Tj[g+1],this.Tj[g+2],this.Tj[g+3])}getRowToRef(y,g){if(y>=0&&y<=3){const f=4*y;g.x=this.Tj[f+0],g.y=this.Tj[f+1],g.z=this.Tj[f+2],g.w=this.Tj[f+3]}return g}setRow(y,g){return this.setRowFromFloats(y,g.x,g.y,g.z,g.w)}transpose(){const y=new W;return W.TransposeToRef(this,y),y}transposeToRef(y){return W.TransposeToRef(this,y),y}setRowFromFloats(y,g,f,p,S){if(y<0||y>3)return this;const k=4*y;return this.Tj[k+0]=g,this.Tj[k+1]=f,this.Tj[k+2]=p,this.Tj[k+3]=S,this.markAsUpdated(),this}scale(y){const g=new W;return this.scaleToRef(y,g),g}scaleToRef(y,g){for(let f=0;f<16;f++)g.Tj[f]=this.Tj[f]*y;return g.markAsUpdated(),g}scaleAndAddToRef(y,g){for(let f=0;f<16;f++)g.Tj[f]+=this.Tj[f]*y;return g.markAsUpdated(),g}scaleInPlace(y){const g=this.Tj;for(let f=0;f<16;f++)g[f]*=y;return this.markAsUpdated(),this}toNormalMatrix(y){const g=j.Matrix[0];this.invertToRef(g),g.transposeToRef(y);const f=y.Tj;return W.FromValuesToRef(f[0],f[1],f[2],0,f[4],f[5],f[6],0,f[8],f[9],f[10],0,0,0,0,1,y),y}getRotationMatrix(){const y=new W;return this.getRotationMatrixToRef(y),y}getRotationMatrixToRef(y){const g=j.o[0];if(!this.decompose(g))return W.IdentityToRef(y),y;const f=this.Tj,p=1/g._x,S=1/g._y,k=1/g._z;return W.FromValuesToRef(f[0]*p,f[1]*p,f[2]*p,0,f[4]*S,f[5]*S,f[6]*S,0,f[8]*k,f[9]*k,f[10]*k,0,0,0,0,1,y),y}toggleModelMatrixHandInPlace(){const y=this.Tj;return y[2]*=-1,y[6]*=-1,y[8]*=-1,y[9]*=-1,y[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const y=this.Tj;return y[8]*=-1,y[9]*=-1,y[10]*=-1,y[11]*=-1,this.markAsUpdated(),this}static eh(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=new W;return W.FromArrayToRef(y,g,f),f}static FromArrayToRef(y,g,f){for(let p=0;p<16;p++)f.Tj[p]=y[p+g];return f.markAsUpdated(),f}static FromFloat32ArrayToRefScaled(y,g,f,p){return p.Tj[0]=y[0+g]*f,p.Tj[1]=y[1+g]*f,p.Tj[2]=y[2+g]*f,p.Tj[3]=y[3+g]*f,p.Tj[4]=y[4+g]*f,p.Tj[5]=y[5+g]*f,p.Tj[6]=y[6+g]*f,p.Tj[7]=y[7+g]*f,p.Tj[8]=y[8+g]*f,p.Tj[9]=y[9+g]*f,p.Tj[10]=y[10+g]*f,p.Tj[11]=y[11+g]*f,p.Tj[12]=y[12+g]*f,p.Tj[13]=y[13+g]*f,p.Tj[14]=y[14+g]*f,p.Tj[15]=y[15+g]*f,p.markAsUpdated(),p}static get IdentityReadOnly(){return W._IdentityReadOnly}static FromValuesToRef(y,g,f,p,S,k,i,H,U,l,c,Z,C,q,W,j,P){const B=P.Tj;B[0]=y,B[1]=g,B[2]=f,B[3]=p,B[4]=S,B[5]=k,B[6]=i,B[7]=H,B[8]=U,B[9]=l,B[10]=c,B[11]=Z,B[12]=C,B[13]=q,B[14]=W,B[15]=j,P.markAsUpdated()}static FromValues(y,g,f,p,S,k,i,H,U,l,c,Z,C,q,j,P){const B=new W,R=B.Tj;return R[0]=y,R[1]=g,R[2]=f,R[3]=p,R[4]=S,R[5]=k,R[6]=i,R[7]=H,R[8]=U,R[9]=l,R[10]=c,R[11]=Z,R[12]=C,R[13]=q,R[14]=j,R[15]=P,B.markAsUpdated(),B}static Compose(y,g,f){const p=new W;return W.ComposeToRef(y,g,f,p),p}static ComposeToRef(y,g,f,p){const S=p.Tj,k=g._x,i=g._y,H=g._z,U=g._w,l=k+k,c=i+i,Z=H+H,C=k*l,q=k*c,W=k*Z,j=i*c,P=i*Z,B=H*Z,R=U*l,G=U*c,z=U*Z,T=y._x,Q=y._y,m=y._z;return S[0]=(1-(j+B))*T,S[1]=(q+z)*T,S[2]=(W-G)*T,S[3]=0,S[4]=(q-z)*Q,S[5]=(1-(C+B))*Q,S[6]=(P+R)*Q,S[7]=0,S[8]=(W+G)*m,S[9]=(P-R)*m,S[10]=(1-(C+j))*m,S[11]=0,S[12]=f._x,S[13]=f._y,S[14]=f._z,S[15]=1,p.markAsUpdated(),p}static Identity(){const y=W.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return y._updateIdentityStatus(!0),y}static IdentityToRef(y){return W.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,y),y._updateIdentityStatus(!0),y}static Zero(){const y=W.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return y._updateIdentityStatus(!1),y}static RotationX(y){const g=new W;return W.RotationXToRef(y,g),g}static Invert(y){const g=new W;return y.invertToRef(g),g}static RotationXToRef(y,g){const f=Math.sin(y),p=Math.cos(y);return W.FromValuesToRef(1,0,0,0,0,p,f,0,0,-f,p,0,0,0,0,1,g),g._updateIdentityStatus(1===p&&0===f),g}static RotationY(y){const g=new W;return W.RotationYToRef(y,g),g}static RotationYToRef(y,g){const f=Math.sin(y),p=Math.cos(y);return W.FromValuesToRef(p,0,-f,0,0,1,0,0,f,0,p,0,0,0,0,1,g),g._updateIdentityStatus(1===p&&0===f),g}static RotationZ(y){const g=new W;return W.RotationZToRef(y,g),g}static RotationZToRef(y,g){const f=Math.sin(y),p=Math.cos(y);return W.FromValuesToRef(p,f,0,0,-f,p,0,0,0,0,1,0,0,0,0,1,g),g._updateIdentityStatus(1===p&&0===f),g}static RotationAxis(y,g){const f=new W;return W.RotationAxisToRef(y,g,f),f}static RotationAxisToRef(y,g,f){const p=Math.sin(-g),S=Math.cos(-g),k=1-S;y=y.normalizeToRef(j.o[0]);const i=f.Tj;return i[0]=y._x*y._x*k+S,i[1]=y._x*y._y*k-y._z*p,i[2]=y._x*y._z*k+y._y*p,i[3]=0,i[4]=y._y*y._x*k+y._z*p,i[5]=y._y*y._y*k+S,i[6]=y._y*y._z*k-y._x*p,i[7]=0,i[8]=y._z*y._x*k-y._y*p,i[9]=y._z*y._y*k+y._x*p,i[10]=y._z*y._z*k+S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,f.markAsUpdated(),f}static RotationAlignToRef(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=Z.Dot(g,y),i=f.Tj;if(k<-1+p.e)i[0]=-1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=S?1:-1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=S?-1:1,i[11]=0;else{const f=Z.Cross(g,y),p=1/(1+k);i[0]=f._x*f._x*p+k,i[1]=f._y*f._x*p-f._z,i[2]=f._z*f._x*p+f._y,i[3]=0,i[4]=f._x*f._y*p+f._z,i[5]=f._y*f._y*p+k,i[6]=f._z*f._y*p-f._x,i[7]=0,i[8]=f._x*f._z*p-f._y,i[9]=f._y*f._z*p+f._x,i[10]=f._z*f._z*p+k,i[11]=0}return i[12]=0,i[13]=0,i[14]=0,i[15]=1,f.markAsUpdated(),f}static RotationYawPitchRoll(y,g,f){const p=new W;return W.RotationYawPitchRollToRef(y,g,f,p),p}static RotationYawPitchRollToRef(y,g,f,p){return q.RotationYawPitchRollToRef(y,g,f,j.Quaternion[0]),j.Quaternion[0].toRotationMatrix(p),p}static Scaling(y,g,f){const p=new W;return W.ScalingToRef(y,g,f,p),p}static ScalingToRef(y,g,f,p){return W.FromValuesToRef(y,0,0,0,0,g,0,0,0,0,f,0,0,0,0,1,p),p._updateIdentityStatus(1===y&&1===g&&1===f),p}static Translation(y,g,f){const p=new W;return W.TranslationToRef(y,g,f,p),p}static TranslationToRef(y,g,f,p){return W.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,y,g,f,1,p),p._updateIdentityStatus(0===y&&0===g&&0===f),p}static Lerp(y,g,f){const p=new W;return W.LerpToRef(y,g,f,p),p}static LerpToRef(y,g,f,p){const S=p.Tj,k=y.m,i=g.m;for(let H=0;H<16;H++)S[H]=k[H]*(1-f)+i[H]*f;return p.markAsUpdated(),p}static DecomposeLerp(y,g,f){const p=new W;return W.DecomposeLerpToRef(y,g,f,p),p}static DecomposeLerpToRef(y,g,f,p){const S=j.o[0],k=j.Quaternion[0],i=j.o[1];y.decompose(S,k,i);const H=j.o[2],U=j.Quaternion[1],l=j.o[3];g.decompose(H,U,l);const c=j.o[4];Z.LerpToRef(S,H,f,c);const C=j.Quaternion[2];q.SlerpToRef(k,U,f,C);const P=j.o[5];return Z.LerpToRef(i,l,f,P),W.ComposeToRef(c,C,P,p),p}static LookAtLH(y,g,f){const p=new W;return W.LookAtLHToRef(y,g,f,p),p}static LookAtLHToRef(y,g,f,p){const S=j.o[0],k=j.o[1],i=j.o[2];g.subtractToRef(y,i),i.normalize(),Z.CrossToRef(f,i,S);const H=S.lengthSquared();0===H?S.x=1:S.normalizeFromLength(Math.sqrt(H)),Z.CrossToRef(i,S,k),k.normalize();const U=-Z.Dot(S,y),l=-Z.Dot(k,y),c=-Z.Dot(i,y);return W.FromValuesToRef(S._x,k._x,i._x,0,S._y,k._y,i._y,0,S._z,k._z,i._z,0,U,l,c,1,p),p}static LookAtRH(y,g,f){const p=new W;return W.LookAtRHToRef(y,g,f,p),p}static LookAtRHToRef(y,g,f,p){const S=j.o[0],k=j.o[1],i=j.o[2];y.subtractToRef(g,i),i.normalize(),Z.CrossToRef(f,i,S);const H=S.lengthSquared();0===H?S.x=1:S.normalizeFromLength(Math.sqrt(H)),Z.CrossToRef(i,S,k),k.normalize();const U=-Z.Dot(S,y),l=-Z.Dot(k,y),c=-Z.Dot(i,y);return W.FromValuesToRef(S._x,k._x,i._x,0,S._y,k._y,i._y,0,S._z,k._z,i._z,0,U,l,c,1,p),p}static LookDirectionLH(y,g){const f=new W;return W.LookDirectionLHToRef(y,g,f),f}static LookDirectionLHToRef(y,g,f){const p=j.o[0];p.p(y),p.scaleInPlace(-1);const S=j.o[1];return Z.CrossToRef(g,p,S),W.FromValuesToRef(S._x,S._y,S._z,0,g._x,g._y,g._z,0,p._x,p._y,p._z,0,0,0,0,1,f),f}static LookDirectionRH(y,g){const f=new W;return W.LookDirectionRHToRef(y,g,f),f}static LookDirectionRHToRef(y,g,f){const p=j.o[2];return Z.CrossToRef(g,y,p),W.FromValuesToRef(p._x,p._y,p._z,0,g._x,g._y,g._z,0,y._x,y._y,y._z,0,0,0,0,1,f),f}static OrthoLH(y,g,f,p,S){const k=new W;return W.OrthoLHToRef(y,g,f,p,k,S),k}static OrthoLHToRef(y,g,f,p,S,k){const i=2/y,H=2/g,U=2/(p-f),l=-(p+f)/(p-f);return W.FromValuesToRef(i,0,0,0,0,H,0,0,0,0,U,0,0,0,l,1,S),k&&S.multiplyToRef(B,S),S._updateIdentityStatus(1===i&&1===H&&1===U&&0===l),S}static OrthoOffCenterLH(y,g,f,p,S,k,i){const H=new W;return W.OrthoOffCenterLHToRef(y,g,f,p,S,k,H,i),H}static OrthoOffCenterLHToRef(y,g,f,p,S,k,i,H){const U=2/(g-y),l=2/(p-f),c=2/(k-S),Z=-(k+S)/(k-S),C=(y+g)/(y-g),q=(p+f)/(f-p);return W.FromValuesToRef(U,0,0,0,0,l,0,0,0,0,c,0,C,q,Z,1,i),H&&i.multiplyToRef(B,i),i.markAsUpdated(),i}static ObliqueOffCenterLHToRef(y,g,f,p,S,k,i,H,U,l,c){const Z=-i*Math.cos(H),C=-i*Math.sin(H);return W.TranslationToRef(0,0,-U,j.Matrix[1]),W.FromValuesToRef(1,0,0,0,0,1,0,0,Z,C,1,0,0,0,0,1,j.Matrix[0]),j.Matrix[1].multiplyToRef(j.Matrix[0],j.Matrix[0]),W.TranslationToRef(0,0,U,j.Matrix[1]),j.Matrix[0].multiplyToRef(j.Matrix[1],j.Matrix[0]),W.OrthoOffCenterLHToRef(y,g,f,p,S,k,l,c),j.Matrix[0].multiplyToRef(l,l),l}static OrthoOffCenterRH(y,g,f,p,S,k,i){const H=new W;return W.OrthoOffCenterRHToRef(y,g,f,p,S,k,H,i),H}static OrthoOffCenterRHToRef(y,g,f,p,S,k,i,H){return W.OrthoOffCenterLHToRef(y,g,f,p,S,k,i,H),i.Tj[10]*=-1,i}static ObliqueOffCenterRHToRef(y,g,f,p,S,k,i,H,U,l,c){const Z=i*Math.cos(H),C=i*Math.sin(H);return W.TranslationToRef(0,0,U,j.Matrix[1]),W.FromValuesToRef(1,0,0,0,0,1,0,0,Z,C,1,0,0,0,0,1,j.Matrix[0]),j.Matrix[1].multiplyToRef(j.Matrix[0],j.Matrix[0]),W.TranslationToRef(0,0,-U,j.Matrix[1]),j.Matrix[0].multiplyToRef(j.Matrix[1],j.Matrix[0]),W.OrthoOffCenterRHToRef(y,g,f,p,S,k,l,c),j.Matrix[0].multiplyToRef(l,l),l}static PerspectiveLH(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const i=new W,H=2*f/y,U=2*f/g,l=(p+f)/(p-f),c=-2*p*f/(p-f),Z=Math.tan(k);return W.FromValuesToRef(H,0,0,0,0,U,0,Z,0,0,l,1,0,0,c,0,i),S&&i.multiplyToRef(B,i),i._updateIdentityStatus(!1),i}static PerspectiveFovLH(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const H=new W;return W.PerspectiveFovLHToRef(y,g,f,p,H,!0,S,k,i),H}static PerspectiveFovLHToRef(y,g,f,p,S){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const l=f,c=p,Z=1/Math.tan(.5*y),C=k?Z/g:Z,q=k?Z:Z*g,j=U&&0===l?-1:0!==c?(c+l)/(c-l):1,P=U&&0===l?2*c:0!==c?-2*c*l/(c-l):-2*l,R=Math.tan(H);return W.FromValuesToRef(C,0,0,0,0,q,0,R,0,0,j,1,0,0,P,0,S),i&&S.multiplyToRef(B,S),S._updateIdentityStatus(!1),S}static PerspectiveFovReverseLHToRef(y,g,f,p,S){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const U=1/Math.tan(.5*y),l=k?U/g:U,c=k?U:U*g,Z=Math.tan(H);return W.FromValuesToRef(l,0,0,0,0,c,0,Z,0,0,-f,1,0,0,1,0,S),i&&S.multiplyToRef(B,S),S._updateIdentityStatus(!1),S}static PerspectiveFovRH(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const H=new W;return W.PerspectiveFovRHToRef(y,g,f,p,H,!0,S,k,i),H}static PerspectiveFovRHToRef(y,g,f,p,S){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const l=f,c=p,Z=1/Math.tan(.5*y),C=k?Z/g:Z,q=k?Z:Z*g,j=U&&0===l?1:0!==c?-(c+l)/(c-l):-1,P=U&&0===l?2*c:0!==c?-2*c*l/(c-l):-2*l,R=Math.tan(H);return W.FromValuesToRef(C,0,0,0,0,q,0,R,0,0,j,-1,0,0,P,0,S),i&&S.multiplyToRef(B,S),S._updateIdentityStatus(!1),S}static PerspectiveFovReverseRHToRef(y,g,f,p,S){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const U=1/Math.tan(.5*y),l=k?U/g:U,c=k?U:U*g,Z=Math.tan(H);return W.FromValuesToRef(l,0,0,0,0,c,0,Z,0,0,-f,-1,0,0,-1,0,S),i&&S.multiplyToRef(B,S),S._updateIdentityStatus(!1),S}static GetFinalMatrix(y,g,f,p,S,k){const i=y.width,H=y.height,U=y.x,l=y.y,c=W.FromValues(i/2,0,0,0,0,-H/2,0,0,0,0,k-S,0,U+i/2,H/2+l,S,1),Z=new W;return g.multiplyToRef(f,Z),Z.multiplyToRef(p,Z),Z.multiplyToRef(c,Z)}static GetAsMatrix2x2(y){const g=y.m,f=[g[0],g[1],g[4],g[5]];return i.e.MatrixUse64Bits?f:new Float32Array(f)}static GetAsMatrix3x3(y){const g=y.m,f=[g[0],g[1],g[2],g[4],g[5],g[6],g[8],g[9],g[10]];return i.e.MatrixUse64Bits?f:new Float32Array(f)}static Transpose(y){const g=new W;return W.TransposeToRef(y,g),g}static TransposeToRef(y,g){const f=y.m,p=f[0],S=f[4],k=f[8],i=f[12],H=f[1],U=f[5],l=f[9],c=f[13],Z=f[2],C=f[6],q=f[10],W=f[14],j=f[3],P=f[7],B=f[11],R=f[15],G=g.Tj;return G[0]=p,G[1]=S,G[2]=k,G[3]=i,G[4]=H,G[5]=U,G[6]=l,G[7]=c,G[8]=Z,G[9]=C,G[10]=q,G[11]=W,G[12]=j,G[13]=P,G[14]=B,G[15]=R,g.markAsUpdated(),g._updateIdentityStatus(y._isIdentity,y._isIdentityDirty),g}static Reflection(y){const g=new W;return W.ReflectionToRef(y,g),g}static ReflectionToRef(y,g){y.normalize();const f=y.k.x,p=y.k.y,S=y.k.z,k=-2*f,i=-2*p,H=-2*S;return W.FromValuesToRef(k*f+1,i*f,H*f,0,k*p,i*p+1,H*p,0,k*S,i*S,H*S+1,0,k*y.d,i*y.d,H*y.d,1,g),g}static FromXYZAxesToRef(y,g,f,p){return W.FromValuesToRef(y._x,y._y,y._z,0,g._x,g._y,g._z,0,f._x,f._y,f._z,0,0,0,0,1,p),p}static FromQuaternionToRef(y,g){const f=y._x*y._x,p=y._y*y._y,S=y._z*y._z,k=y._x*y._y,i=y._z*y._w,H=y._z*y._x,U=y._y*y._w,l=y._y*y._z,c=y._x*y._w;return g.Tj[0]=1-2*(p+S),g.Tj[1]=2*(k+i),g.Tj[2]=2*(H-U),g.Tj[3]=0,g.Tj[4]=2*(k-i),g.Tj[5]=1-2*(S+f),g.Tj[6]=2*(l+c),g.Tj[7]=0,g.Tj[8]=2*(H+U),g.Tj[9]=2*(l-c),g.Tj[10]=1-2*(p+f),g.Tj[11]=0,g.Tj[12]=0,g.Tj[13]=0,g.Tj[14]=0,g.Tj[15]=1,g.markAsUpdated(),g}}W._UpdateFlagSeed=0,W._IdentityReadOnly=W.Identity(),Object.defineProperties(W.prototype,{dimension:{value:[4,4]},rank:{value:2}});class j{}j.o=(0,S.f)(11,Z.Zero),j.Matrix=(0,S.f)(2,W.Identity),j.Quaternion=(0,S.f)(3,q.Zero);class P{}P.Vector2=(0,S.f)(3,c.Zero),P.o=(0,S.f)(13,Z.Zero),P.Vector4=(0,S.f)(3,C.Zero),P.Quaternion=(0,S.f)(3,q.Zero),P.Matrix=(0,S.f)(8,W.Identity),(0,k.c)("BABYLON.Vector2",c),(0,k.c)("BABYLON.Vector3",Z),(0,k.c)("BABYLON.Vector4",C),(0,k.c)("BABYLON.Matrix",W);const B=W.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11342:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{constructor(y,g,f,p){this.x=y,this.y=g,this.width=f,this.height=p}toGlobal(y,g){return new p(this.x*y,this.y*g,this.width*y,this.height*g)}toGlobalToRef(y,g,f){return f.x=this.x*y,f.y=this.y*g,f.width=this.width*y,f.height=this.height*g,this}clone(){return new p(this.x,this.y,this.width,this.height)}}},11555:(y,g,f)=>{"use strict";f.d(g,{e:()=>l,f:()=>c});var p=f(11054),S=f(11562);const k=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],i=[()=>1,y=>y.y,y=>y.z,y=>y.x,y=>y.x*y.y,y=>y.y*y.z,y=>3*y.z*y.z-1,y=>y.x*y.z,y=>y.x*y.x-y.y*y.y],H=(y,g)=>k[y]*i[y](g),U=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class l{constructor(){this.preScaled=!1,this.l00=p.m.Zero(),this.l1_1=p.m.Zero(),this.l10=p.m.Zero(),this.l11=p.m.Zero(),this.l2_2=p.m.Zero(),this.l2_1=p.m.Zero(),this.l20=p.m.Zero(),this.l21=p.m.Zero(),this.l22=p.m.Zero()}addLight(y,g,f){S.e.o[0].set(g.r,g.g,g.b);const p=S.e.o[0],k=S.e.o[1];p.scaleToRef(f,k),k.scaleToRef(H(0,y),S.e.o[2]),this.l00.addInPlace(S.e.o[2]),k.scaleToRef(H(1,y),S.e.o[2]),this.l1_1.addInPlace(S.e.o[2]),k.scaleToRef(H(2,y),S.e.o[2]),this.l10.addInPlace(S.e.o[2]),k.scaleToRef(H(3,y),S.e.o[2]),this.l11.addInPlace(S.e.o[2]),k.scaleToRef(H(4,y),S.e.o[2]),this.l2_2.addInPlace(S.e.o[2]),k.scaleToRef(H(5,y),S.e.o[2]),this.l2_1.addInPlace(S.e.o[2]),k.scaleToRef(H(6,y),S.e.o[2]),this.l20.addInPlace(S.e.o[2]),k.scaleToRef(H(7,y),S.e.o[2]),this.l21.addInPlace(S.e.o[2]),k.scaleToRef(H(8,y),S.e.o[2]),this.l22.addInPlace(S.e.o[2])}scaleInPlace(y){this.l00.scaleInPlace(y),this.l1_1.scaleInPlace(y),this.l10.scaleInPlace(y),this.l11.scaleInPlace(y),this.l2_2.scaleInPlace(y),this.l2_1.scaleInPlace(y),this.l20.scaleInPlace(y),this.l21.scaleInPlace(y),this.l22.scaleInPlace(y)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(U[0]),this.l1_1.scaleInPlace(U[1]),this.l10.scaleInPlace(U[2]),this.l11.scaleInPlace(U[3]),this.l2_2.scaleInPlace(U[4]),this.l2_1.scaleInPlace(U[5]),this.l20.scaleInPlace(U[6]),this.l21.scaleInPlace(U[7]),this.l22.scaleInPlace(U[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(k[0]),this.l1_1.scaleInPlace(k[1]),this.l10.scaleInPlace(k[2]),this.l11.scaleInPlace(k[3]),this.l2_2.scaleInPlace(k[4]),this.l2_1.scaleInPlace(k[5]),this.l20.scaleInPlace(k[6]),this.l21.scaleInPlace(k[7]),this.l22.scaleInPlace(k[8])}updateFromArray(y){return p.m.FromArrayToRef(y[0],0,this.l00),p.m.FromArrayToRef(y[1],0,this.l1_1),p.m.FromArrayToRef(y[2],0,this.l10),p.m.FromArrayToRef(y[3],0,this.l11),p.m.FromArrayToRef(y[4],0,this.l2_2),p.m.FromArrayToRef(y[5],0,this.l2_1),p.m.FromArrayToRef(y[6],0,this.l20),p.m.FromArrayToRef(y[7],0,this.l21),p.m.FromArrayToRef(y[8],0,this.l22),this}updateFromFloatsArray(y){return p.m.FromFloatsToRef(y[0],y[1],y[2],this.l00),p.m.FromFloatsToRef(y[3],y[4],y[5],this.l1_1),p.m.FromFloatsToRef(y[6],y[7],y[8],this.l10),p.m.FromFloatsToRef(y[9],y[10],y[11],this.l11),p.m.FromFloatsToRef(y[12],y[13],y[14],this.l2_2),p.m.FromFloatsToRef(y[15],y[16],y[17],this.l2_1),p.m.FromFloatsToRef(y[18],y[19],y[20],this.l20),p.m.FromFloatsToRef(y[21],y[22],y[23],this.l21),p.m.FromFloatsToRef(y[24],y[25],y[26],this.l22),this}static eh(y){return(new l).updateFromArray(y)}static FromPolynomial(y){const g=new l;return g.l00=y.xx.scale(.376127).add(y.yy.scale(.376127)).add(y.zz.scale(.376126)),g.l1_1=y.y.scale(.977204),g.l10=y.z.scale(.977204),g.l11=y.x.scale(.977204),g.l2_2=y.xy.scale(1.16538),g.l2_1=y.yz.scale(1.16538),g.l20=y.zz.scale(1.34567).ed(y.xx.scale(.672834)).ed(y.yy.scale(.672834)),g.l21=y.zx.scale(1.16538),g.l22=y.xx.scale(1.16538).ed(y.yy.scale(1.16538)),g.l1_1.scaleInPlace(-1),g.l11.scaleInPlace(-1),g.l2_1.scaleInPlace(-1),g.l21.scaleInPlace(-1),g.scaleInPlace(Math.PI),g}}class c{constructor(){this.x=p.m.Zero(),this.y=p.m.Zero(),this.z=p.m.Zero(),this.xx=p.m.Zero(),this.yy=p.m.Zero(),this.zz=p.m.Zero(),this.xy=p.m.Zero(),this.yz=p.m.Zero(),this.zx=p.m.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=l.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(y){S.e.o[0].ne(y.r,y.g,y.b);const g=S.e.o[0];this.xx.addInPlace(g),this.yy.addInPlace(g),this.zz.addInPlace(g)}scaleInPlace(y){this.x.scaleInPlace(y),this.y.scaleInPlace(y),this.z.scaleInPlace(y),this.xx.scaleInPlace(y),this.yy.scaleInPlace(y),this.zz.scaleInPlace(y),this.yz.scaleInPlace(y),this.zx.scaleInPlace(y),this.xy.scaleInPlace(y)}updateFromHarmonics(y){return this._harmonics=y,this.x.p(y.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(y.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(y.l10),this.z.scaleInPlace(1.02333),this.xx.p(y.l00),S.e.o[0].p(y.l20).scaleInPlace(.247708),S.e.o[1].p(y.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).ti(S.e.o[0]).addInPlace(S.e.o[1]),this.yy.p(y.l00),this.yy.scaleInPlace(.886277).ti(S.e.o[0]).ti(S.e.o[1]),this.zz.p(y.l00),S.e.o[0].p(y.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(S.e.o[0]),this.yz.p(y.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(y.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(y.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(y){return(new c).updateFromHarmonics(y)}static eh(y){const g=new c;return p.m.FromArrayToRef(y[0],0,g.x),p.m.FromArrayToRef(y[1],0,g.y),p.m.FromArrayToRef(y[2],0,g.z),p.m.FromArrayToRef(y[3],0,g.xx),p.m.FromArrayToRef(y[4],0,g.yy),p.m.FromArrayToRef(y[5],0,g.zz),p.m.FromArrayToRef(y[6],0,g.yz),p.m.FromArrayToRef(y[7],0,g.zx),p.m.FromArrayToRef(y[8],0,g.xy),g}}},11392:(y,g,f)=>{"use strict";f.d(g,{c:()=>l});var p=f(11054),S=f(11090),k=f(11321),i=f(11349),H=f(11283);f(11396);function U(y){let g=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const f=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],k=[];let U=[];const l=y.width||y.size||1,c=y.height||y.size||1,Z=y.depth||y.size||1,C=y.wrap||!1;let q=void 0===y.topBaseAt?1:y.topBaseAt,W=void 0===y.bottomBaseAt?0:y.bottomBaseAt;q=(q+4)%4,W=(W+4)%4;let j=[2,0,3,1][q],P=[2,0,1,3][W],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(C){g=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let y=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],f=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const p=[17,18,19,16],S=[22,23,20,21];for(;j>0;)y.unshift(y.pop()),p.unshift(p.pop()),j--;for(;P>0;)f.unshift(f.pop()),S.unshift(S.pop()),P--;y=y.flat(),f=f.flat(),B=B.concat(y).concat(f),g.push(p[0],p[2],p[3],p[0],p[1],p[2]),g.push(S[0],S[2],S[3],S[0],S[1],S[2])}const R=[l/2,c/2,Z/2];U=B.reduce(((y,g,f)=>y.concat(g*R[f%3])),[]);const G=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,z=y.faceUV||new Array(6),T=y.faceColors,Q=[];for(let i=0;i<6;i++)void 0===z[i]&&(z[i]=new p.o(0,0,1,1)),T&&void 0===T[i]&&(T[i]=new S.f(1,1,1,1));for(let p=0;p<6;p++)if(k.push(z[p].z,H.d?1-z[p].w:z[p].w),k.push(z[p].x,H.d?1-z[p].w:z[p].w),k.push(z[p].x,H.d?1-z[p].y:z[p].y),k.push(z[p].z,H.d?1-z[p].y:z[p].y),T)for(let y=0;y<4;y++)Q.push(T[p].r,T[p].g,T[p].b,T[p].a);i.e._ComputeSides(G,U,g,f,k,y.frontUVs,y.backUVs);const m=new i.e;if(m.indices=g,m.xa=U,m.ya=f,m.Aa=k,T){const y=G===i.e.DOUBLESIDE?Q.concat(Q):Q;m.za=y}return m}function l(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new k.e(y,f);g.sideOrientation=k.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return U(g).Ca(p,g.updatable),p}i.e.CreateBox=U,k.e.CreateBox=function(y,g){return l(y,{size:g,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11708:(y,g,f)=>{"use strict";f.d(g,{e:()=>H});var p=f(11321),S=f(11349),k=f(11283);function i(y){const g=[],f=[],p=[],i=[],H=y.radius||.5,U=y.tessellation||64,l=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,c=0===y.sideOrientation?0:y.sideOrientation||S.e.DEFAULTSIDE;g.push(0,0,0),i.push(.5,.5);const Z=2*Math.PI*l,C=1===l?Z/U:Z/(U-1);let q=0;for(let S=0;S<U;S++){const y=Math.cos(q),f=Math.sin(q),p=(y+1)/2,S=(1-f)/2;g.push(H*y,H*f,0),i.push(p,k.d?1-S:S),q+=C}1===l&&(g.push(g[3],g[4],g[5]),i.push(i[2],k.d?1-i[3]:i[3]));const W=g.length/3;for(let S=1;S<W-1;S++)f.push(S+1,0,S);S.e.ComputeNormals(g,f,p),S.e._ComputeSides(c,g,f,p,i,y.frontUVs,y.backUVs);const j=new S.e;return j.indices=f,j.xa=g,j.ya=p,j.Aa=i,j}function H(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new p.e(y,f);g.sideOrientation=p.e._GetDefaultSideOrientation(g.sideOrientation),S._originalBuilderSideOrientation=g.sideOrientation;return i(g).Ca(S,g.updatable),S}S.e.CreateDisc=i,p.e.CreateDisc=function(y,g,f){return H(y,{radius:g,tessellation:f,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11396:(y,g,f)=>{"use strict";f.d(g,{f:()=>P,e:()=>R,i:()=>B});var p=f(11054),S=f(11090),k=f(11321),i=f(11349),H=f(11131);k.e._GroundMeshParser=(y,g)=>U.Parse(y,g);class U extends k.e{constructor(y,g){super(y,g),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=y,this._subdivisionsY=y,this.subdivide(y);const f=this;f.createOrUpdateSubmeshesOctree&&f.createOrUpdateSubmeshesOctree(g)}getHeightAtCoordinates(y,g){const f=this.getWorldMatrix(),S=p.j.Matrix[5];f.invertToRef(S);const k=p.j.o[8];if(p.m.TransformCoordinatesFromFloatsToRef(y,0,g,S,k),y=k.x,g=k.z,y<this._minX||y>=this._maxX||g<=this._minZ||g>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const i=this._getFacetAt(y,g),H=-(i.x*y+i.z*g+i.w)/i.y;return p.m.TransformCoordinatesFromFloatsToRef(0,H,0,f,k),k.y}getNormalAtCoordinates(y,g){const f=new p.m(0,1,0);return this.getNormalAtCoordinatesToRef(y,g,f),f}getNormalAtCoordinatesToRef(y,g,f){const S=this.getWorldMatrix(),k=p.j.Matrix[5];S.invertToRef(k);const i=p.j.o[8];if(p.m.TransformCoordinatesFromFloatsToRef(y,0,g,k,i),y=i.x,g=i.z,y<this._minX||y>this._maxX||g<this._minZ||g>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const H=this._getFacetAt(y,g);return p.m.TransformNormalFromFloatsToRef(H.x,H.y,H.z,S,f),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(y,g){const f=Math.floor((y+this._maxX)*this._subdivisionsX/this._width),p=Math.floor(-(g+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),S=this._heightQuads[p*this._subdivisionsX+f];let k;return k=g<S.slope.x*y+S.slope.y?S.facet1:S.facet2,k}_initHeightQuads(){const y=this._subdivisionsX,g=this._subdivisionsY;this._heightQuads=new Array;for(let f=0;f<g;f++)for(let g=0;g<y;g++){const S={slope:p.l.Zero(),facet1:new p.o(0,0,0,0),facet2:new p.o(0,0,0,0)};this._heightQuads[f*y+g]=S}return this}_computeHeightQuads(){const y=this.getVerticesData(H.c.PositionKind);if(!y)return this;const g=p.j.o[3],f=p.j.o[2],S=p.j.o[1],k=p.j.o[0],i=p.j.o[4],U=p.j.o[5],l=p.j.o[6],c=p.j.o[7],Z=p.j.o[8];let C=0,q=0,W=0,j=0,P=0,B=0,R=0;const G=this._subdivisionsX,z=this._subdivisionsY;for(let H=0;H<z;H++)for(let z=0;z<G;z++){C=3*z,q=H*(G+1)*3,W=(H+1)*(G+1)*3,g.x=y[q+C],g.y=y[q+C+1],g.z=y[q+C+2],f.x=y[q+C+3],f.y=y[q+C+4],f.z=y[q+C+5],S.x=y[W+C],S.y=y[W+C+1],S.z=y[W+C+2],k.x=y[W+C+3],k.y=y[W+C+4],k.z=y[W+C+5],j=(k.z-g.z)/(k.x-g.x),P=g.z-j*g.x,f.subtractToRef(g,i),S.subtractToRef(g,U),k.subtractToRef(g,l),p.m.CrossToRef(l,U,c),p.m.CrossToRef(i,l,Z),c.normalize(),Z.normalize(),B=-(c.x*g.x+c.y*g.y+c.z*g.z),R=-(Z.x*f.x+Z.y*f.y+Z.z*f.z);const T=this._heightQuads[H*G+z];T.slope.ne(j,P),T.facet1.ne(c.x,c.y,c.z,B),T.facet2.ne(Z.x,Z.y,Z.z,R)}return this}serialize(y){super.serialize(y),y.subdivisionsX=this._subdivisionsX,y.subdivisionsY=this._subdivisionsY,y.minX=this._minX,y.maxX=this._maxX,y.$i=this._minZ,y.maxZ=this._maxZ,y.width=this._width,y.height=this._height}static Parse(y,g){const f=new U(y.name,g);return f._subdivisionsX=y.subdivisionsX||1,f._subdivisionsY=y.subdivisionsY||1,f._minX=y.minX,f._maxX=y.maxX,f._minZ=y.$i,f._maxZ=y.maxZ,f._width=y.width,f._height=y.height,f}}var l=f(10714),c=f(10761),Z=f(11062),C=f(11283);function q(y){const g=[],f=[],S=[],k=[];let H,U;const l=y.width||y.size||1,c=y.height||y.size||1,Z=0|(y.subdivisionsX||y.subdivisions||1),q=0|(y.subdivisionsY||y.subdivisions||1);for(H=0;H<=q;H++)for(U=0;U<=Z;U++){const y=new p.m(U*l/Z-l/2,0,(q-H)*c/q-c/2),g=new p.m(0,1,0);f.push(y.x,y.y,y.z),S.push(g.x,g.y,g.z),k.push(U/Z,C.d?H/q:1-H/q)}for(H=0;H<q;H++)for(U=0;U<Z;U++)g.push(U+1+(H+1)*(Z+1)),g.push(U+1+H*(Z+1)),g.push(U+H*(Z+1)),g.push(U+(H+1)*(Z+1)),g.push(U+1+(H+1)*(Z+1)),g.push(U+H*(Z+1));const W=new i.e;return W.indices=g,W.xa=f,W.ya=S,W.Aa=k,W}function W(y){const g=void 0!==y.xmin&&null!==y.xmin?y.xmin:-1,f=void 0!==y.zmin&&null!==y.zmin?y.zmin:-1,S=void 0!==y.xmax&&null!==y.xmax?y.xmax:1,k=void 0!==y.zmax&&null!==y.zmax?y.zmax:1,H=y.subdivisions||{w:1,h:1},U=y.precision||{w:1,h:1},l=[],c=[],Z=[],C=[];let q,W,j,P;H.h=H.h<1?1:H.h,H.w=H.w<1?1:H.w,U.w=U.w<1?1:U.w,U.h=U.h<1?1:U.h;const B=(S-g)/H.w,R=(k-f)/H.h;function G(y,g,f,S){const k=c.length/3,i=U.w+1;for(q=0;q<U.h;q++)for(W=0;W<U.w;W++){const y=[k+W+q*i,k+(W+1)+q*i,k+(W+1)+(q+1)*i,k+W+(q+1)*i];l.push(y[1]),l.push(y[2]),l.push(y[3]),l.push(y[0]),l.push(y[1]),l.push(y[3])}const H=p.m.Zero(),j=new p.m(0,1,0);for(q=0;q<=U.h;q++)for(H.z=q*(S-g)/U.h+g,W=0;W<=U.w;W++)H.x=W*(f-y)/U.w+y,H.y=0,c.push(H.x,H.y,H.z),Z.push(j.x,j.y,j.z),C.push(W/U.w,q/U.h)}for(j=0;j<H.h;j++)for(P=0;P<H.w;P++)G(g+P*B,f+j*R,g+(P+1)*B,f+(j+1)*R);const z=new i.e;return z.indices=l,z.xa=c,z.ya=Z,z.Aa=C,z}function j(y){const g=[],f=[],k=[],H=[];let U,l;const c=y.colorFilter||new S.c(.3,.59,.11),C=y.alphaFilter||0;let q=!1;if(y.minHeight>y.maxHeight){q=!0;const g=y.maxHeight;y.maxHeight=y.minHeight,y.minHeight=g}for(U=0;U<=y.subdivisions;U++)for(l=0;l<=y.subdivisions;l++){const g=new p.m(l*y.width/y.subdivisions-y.width/2,0,(y.subdivisions-U)*y.height/y.subdivisions-y.height/2),S=4*(((g.x+y.width/2)/y.width*(y.bufferWidth-1)|0)+((1-(g.z+y.height/2)/y.height)*(y.bufferHeight-1)|0)*y.bufferWidth);let i=y.buffer[S]/255,W=y.buffer[S+1]/255,j=y.buffer[S+2]/255;const P=y.buffer[S+3]/255;q&&(i=1-i,W=1-W,j=1-j);const B=i*c.r+W*c.g+j*c.b;g.y=P>=C?y.minHeight+(y.maxHeight-y.minHeight)*B:y.minHeight-Z.e,y.heightBuffer&&(y.heightBuffer[U*(y.subdivisions+1)+l]=g.y),f.push(g.x,g.y,g.z),k.push(0,0,0),H.push(l/y.subdivisions,1-U/y.subdivisions)}for(U=0;U<y.subdivisions;U++)for(l=0;l<y.subdivisions;l++){const p=l+1+(U+1)*(y.subdivisions+1),S=l+1+U*(y.subdivisions+1),k=l+U*(y.subdivisions+1),i=l+(U+1)*(y.subdivisions+1),H=f[3*p+1]>=y.minHeight,c=f[3*S+1]>=y.minHeight,Z=f[3*k+1]>=y.minHeight;H&&c&&Z&&(g.push(p),g.push(S),g.push(k));f[3*i+1]>=y.minHeight&&H&&Z&&(g.push(i),g.push(p),g.push(k))}i.e.ComputeNormals(f,g,k);const W=new i.e;return W.indices=g,W.xa=f,W.ya=k,W.Aa=H,W}function P(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const f=new U(y,arguments.length>2?arguments[2]:void 0);f._setReady(!1),f._subdivisionsX=g.subdivisionsX||g.subdivisions||1,f._subdivisionsY=g.subdivisionsY||g.subdivisions||1,f._width=g.width||1,f._height=g.height||1,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ;return q(g).Ca(f,g.updatable),f._setReady(!0),f}function B(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new k.e(y,f);return W(g).Ca(p,g.updatable),p}function R(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=f.width||10,i=f.height||10,H=f.subdivisions||1,Z=f.minHeight||0,C=f.maxHeight||1,q=f.colorFilter||new S.c(.3,.59,.11),W=f.alphaFilter||0,P=f.updatable,B=f.onReady;p=p||c.d.LastCreatedScene;const R=new U(y,p);let G;R._subdivisionsX=H,R._subdivisionsY=H,R._width=k,R._height=i,R._maxX=R._width/2,R._maxZ=R._height/2,R._minX=-R._maxX,R._minZ=-R._maxZ,R._setReady(!1),f.passHeightBufferInCallback&&(G=new Float32Array((H+1)*(H+1)));const z=(y,g,f)=>{j({width:k,height:i,subdivisions:H,minHeight:Z,maxHeight:C,colorFilter:q,buffer:y,bufferWidth:g,bufferHeight:f,alphaFilter:W,heightBuffer:G}).Ca(R,P),B&&B(R,G),R._setReady(!0)};if("string"===typeof g){const y=y=>{var g;const f=y.width,S=y.height;if(p.u)return;const k=null===(g=p)||void 0===g?void 0:g.getEngine().resizeImageBitmap(y,f,S);z(k,f,S)};l.e.LoadImage(g,y,f.onError?f.onError:()=>{},p.offlineProvider)}else z(g.data,g.width,g.height);return R}i.e.CreateGround=q,i.e.CreateTiledGround=W,i.e.CreateGroundFromHeightMap=j,k.e.CreateGround=(y,g,f,p,S,k)=>P(y,{width:g,height:f,subdivisions:p,updatable:k},S),k.e.CreateTiledGround=(y,g,f,p,S,k,i,H,U)=>B(y,{xmin:g,zmin:f,xmax:p,zmax:S,subdivisions:k,precision:i,updatable:U},H),k.e.CreateGroundFromHeightMap=(y,g,f,p,S,k,i,H,U,l,c)=>R(y,g,{width:f,height:p,subdivisions:S,minHeight:k,maxHeight:i,updatable:U,onReady:l,alphaFilter:c},H)},12770:(y,g,f)=>{"use strict";f.d(g,{c:()=>n,d:()=>I,g:()=>Y});var p=f(11054),S=f(11321),k=f(11349),i=f(11090),H=f(11131),U=f(12282),l=f(11206),c=f(11099),Z=f(11038),C=f(11267),q=f(10871),W=f(11294),j=f(10757),P=f(11262),B=f(10761),R=f(11249),G=f(11242);const z={effect:null,subMesh:null};class T extends P.e{constructor(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(y,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new p.c,this._cachedWorldViewProjectionMatrix=new p.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=f,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...S}}get shaderPath(){return this._shaderPath}set shaderPath(y){this._shaderPath=y}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(y){-1===this._options.uniforms.indexOf(y)&&this._options.uniforms.push(y)}setTexture(y,g){return-1===this._options.samplers.indexOf(y)&&this._options.samplers.push(y),this._textures[y]=g,this}removeTexture(y){delete this._textures[y]}setTextureArray(y,g){return-1===this._options.samplers.indexOf(y)&&this._options.samplers.push(y),this._checkUniform(y),this._textureArrays[y]=g,this}setExternalTexture(y,g){return-1===this._options.externalTextures.indexOf(y)&&this._options.externalTextures.push(y),this._externalTextures[y]=g,this}setFloat(y,g){return this._checkUniform(y),this._floats[y]=g,this}setInt(y,g){return this._checkUniform(y),this._ints[y]=g,this}setUInt(y,g){return this._checkUniform(y),this._uints[y]=g,this}setFloats(y,g){return this._checkUniform(y),this._floatsArrays[y]=g,this}setColor3(y,g){return this._checkUniform(y),this._colors3[y]=g,this}setColor3Array(y,g){return this._checkUniform(y),this._colors3Arrays[y]=g.reduce(((y,g)=>(g.toArray(y,y.length),y)),[]),this}setColor4(y,g){return this._checkUniform(y),this._colors4[y]=g,this}setColor4Array(y,g){return this._checkUniform(y),this._colors4Arrays[y]=g.reduce(((y,g)=>(g.toArray(y,y.length),y)),[]),this}setVector2(y,g){return this._checkUniform(y),this._vectors2[y]=g,this}setVector3(y,g){return this._checkUniform(y),this._vectors3[y]=g,this}setVector4(y,g){return this._checkUniform(y),this._vectors4[y]=g,this}setQuaternion(y,g){return this._checkUniform(y),this._quaternions[y]=g,this}setQuaternionArray(y,g){return this._checkUniform(y),this._quaternionsArrays[y]=g.reduce(((y,g)=>(g.toArray(y,y.length),y)),[]),this}setMatrix(y,g){return this._checkUniform(y),this._matrices[y]=g,this}setMatrices(y,g){this._checkUniform(y);const f=new Float32Array(16*g.length);for(let p=0;p<g.length;p++){g[p].copyToArray(f,16*p)}return this._matrixArrays[y]=f,this}setMatrix3x3(y,g){return this._checkUniform(y),this._matrices3x3[y]=g,this}setMatrix2x2(y,g){return this._checkUniform(y),this._matrices2x2[y]=g,this}setArray2(y,g){return this._checkUniform(y),this._vectors2Arrays[y]=g,this}setArray3(y,g){return this._checkUniform(y),this._vectors3Arrays[y]=g,this}setArray4(y,g){return this._checkUniform(y),this._vectors4Arrays[y]=g,this}setUniformBuffer(y,g){return-1===this._options.uniformBuffers.indexOf(y)&&this._options.uniformBuffers.push(y),this._uniformBuffers[y]=g,this}setTextureSampler(y,g){return-1===this._options.samplerObjects.indexOf(y)&&this._options.samplerObjects.push(y),this._textureSamplers[y]=g,this}setStorageBuffer(y,g){return-1===this._options.storageBuffers.indexOf(y)&&this._options.storageBuffers.push(y),this._storageBuffers[y]=g,this}setDefine(y,g){const f=y.trimEnd()+" ",p=this.options.defines.findIndex((g=>g===y||g.startsWith(f)));return p>=0&&this.options.defines.splice(p,1),("boolean"!==typeof g||g)&&this.options.defines.push(f+g),this}isReadyForSubMesh(y,g,f){return this.isReady(y,f,g)}isReady(y,g,f){var p;const S=f&&this._storeEffectOnSubMeshes;if(this.isFrozen){const y=S?f._drawWrapper:this._drawWrapper;if(y.effect&&y._wasPreviouslyReady&&y._wasPreviouslyUsingInstances===g)return!0}const k=this.va(),i=k.getEngine(),U=[],l=[],c=new W.d;let C=this._shaderPath,q=this._options.uniforms,j=this._options.uniformBuffers,P=this._options.samplers;i.getCaps().multiview&&k.activeCamera&&k.activeCamera.outputRenderTarget&&k.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,U.push("#define MULTIVIEW"),-1!==q.indexOf("viewProjection")&&-1===q.indexOf("viewProjectionR")&&q.push("viewProjectionR"));for(let H=0;H<this._options.defines.length;H++){const y=0===this._options.defines[H].indexOf("#define")?this._options.defines[H]:`#define ${this._options.defines[H]}`;U.push(y)}for(let H=0;H<this._options.attributes.length;H++)l.push(this._options.attributes[H]);if(y&&y.isVerticesDataPresent(H.c.ColorKind)&&(-1===l.indexOf(H.c.ColorKind)&&l.push(H.c.ColorKind),U.push("#define VERTEXCOLOR")),g&&(U.push("#define INSTANCES"),(0,G.db)(l,this._materialHelperNeedsPreviousMatrices),null!==y&&void 0!==y&&y.hasThinInstances&&(U.push("#define THIN_INSTANCES"),y&&y.isVerticesDataPresent(H.c.ColorInstanceKind)&&(l.push(H.c.ColorInstanceKind),U.push("#define INSTANCESCOLOR")))),y&&y.useBones&&y.computeBonesUsingShaders&&y.skeleton){l.push(H.c.MatricesIndicesKind),l.push(H.c.MatricesWeightsKind),y.numBoneInfluencers>4&&(l.push(H.c.MatricesIndicesExtraKind),l.push(H.c.MatricesWeightsExtraKind));const g=y.skeleton;U.push("#define NUM_BONE_INFLUENCERS "+y.numBoneInfluencers),c.addCPUSkinningFallback(0,y),g.isUsingTextureForMatrices?(U.push("#define BONETEXTURE"),-1===q.indexOf("boneTextureWidth")&&q.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(U.push("#define BonesPerMesh "+(g.bones.length+1)),-1===q.indexOf("mBones")&&q.push("mBones"))}else U.push("#define NUM_BONE_INFLUENCERS 0");let B=0;const T=y?y.morphTargetManager:null;if(T){const y=T.supportsUVs&&-1!==U.indexOf("#define UV1"),g=T.supportsTangents&&-1!==U.indexOf("#define TANGENT"),f=T.supportsNormals&&-1!==U.indexOf("#define NORMAL");B=T.numMaxInfluencers||T.numInfluencers,y&&U.push("#define MORPHTARGETS_UV"),g&&U.push("#define MORPHTARGETS_TANGENT"),f&&U.push("#define MORPHTARGETS_NORMAL"),B>0&&U.push("#define MORPHTARGETS"),T.isUsingTextureForTargets&&(U.push("#define MORPHTARGETS_TEXTURE"),-1===q.indexOf("morphTargetTextureIndices")&&q.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),U.push("#define NUM_MORPH_INFLUENCERS "+B);for(let p=0;p<B;p++)l.push(H.c.PositionKind+p),f&&l.push(H.c.NormalKind+p),g&&l.push(H.c.TangentKind+p),y&&l.push(H.c.UVKind+"_"+p);B>0&&(q=q.slice(),q.push("morphTargetInfluences"),q.push("morphTargetCount"),q.push("morphTargetTextureInfo"),q.push("morphTargetTextureIndices"))}else U.push("#define NUM_MORPH_INFLUENCERS 0");if(y){const g=y.bakedVertexAnimationManager;g&&g.isEnabled&&(U.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===q.indexOf("bakedVertexAnimationSettings")&&q.push("bakedVertexAnimationSettings"),-1===q.indexOf("bakedVertexAnimationTextureSizeInverted")&&q.push("bakedVertexAnimationTextureSizeInverted"),-1===q.indexOf("bakedVertexAnimationTime")&&q.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,G.z)(l,y,U)}for(const H in this._textures)if(!this._textures[H].isReady())return!1;y&&this._shouldTurnAlphaTestOn(y)&&U.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,R.c)(q),(0,R.j)(this,k,U)),k.fogEnabled&&null!==y&&void 0!==y&&y.applyFog&&k.fogMode!==Z.e.FOGMODE_NONE&&(U.push("#define FOG"),-1===q.indexOf("view")&&q.push("view"),-1===q.indexOf("vFogInfos")&&q.push("vFogInfos"),-1===q.indexOf("vFogColor")&&q.push("vFogColor")),this._useLogarithmicDepth&&(U.push("#define LOGARITHMICDEPTH"),-1===q.indexOf("logarithmicDepthConstant")&&q.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(q=q.slice(),j=j.slice(),P=P.slice(),C=this.customShaderNameResolve(this.name,q,j,P,U,l));const Q=S?f._getDrawWrapper(void 0,!0):this._drawWrapper,m=(null===Q||void 0===Q?void 0:Q.effect)??null,a=(null===Q||void 0===Q?void 0:Q.defines)??null,w=U.join("\n");let o=m;return a!==w&&(o=i.createEffect(C,{attributes:l,uniformsNames:q,uniformBuffersNames:j,samplers:P,defines:w,fallbacks:c,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:B},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},i),S?f.setEffect(o,w,this._materialContext):Q&&Q.setEffect(o,w),this._onEffectCreatedObservable&&(z.effect=o,z.subMesh=f??(null===y||void 0===y?void 0:y.og[0])??null,this._onEffectCreatedObservable.notifyObservers(z))),Q._wasPreviouslyUsingInstances=!!g,!((null===(p=o)||void 0===p||!p.isReady())??1)&&(m!==o&&k.resetCachedMaterial(),Q._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(y,g){const f=this.va(),p=g??this.getEffect();p&&(-1!==this._options.uniforms.indexOf("world")&&p.setMatrix("world",y),-1!==this._options.uniforms.indexOf("worldView")&&(y.multiplyToRef(f.getViewMatrix(),this._cachedWorldViewMatrix),p.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(y.multiplyToRef(f.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),p.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&p.setMatrix("view",f.getViewMatrix()))}bindForSubMesh(y,g,f){var p;this.bind(y,g,null===(p=f._drawWrapperOverride)||void 0===p?void 0:p.effect,f)}bind(y,g,f,p){const S=p&&this._storeEffectOnSubMeshes,k=f??(S?p.effect:this.getEffect());if(!k)return;const i=this.va();this._activeEffect=k,this.bindOnlyWorldMatrix(y,f);const H=this._options.uniformBuffers;let U=!1;if(k&&H&&H.length>0&&i.getEngine().supportsUniformBuffers)for(let Z=0;Z<H.length;++Z){switch(H[Z]){case"Mesh":g&&(g.getMeshUniformBuffer().bindToEffect(k,"Mesh"),g.transferToEffect(y));break;case"Scene":(0,G.t)(k,i.getSceneUniformBuffer()),i.finalizeSceneUbo(),U=!0}}const l=g&&S?this._mustRebind(i,k,p,g.visibility):i.getCachedMaterial()!==this;if(k&&l){let y;for(y in U||-1===this._options.uniforms.indexOf("view")||k.setMatrix("view",i.getViewMatrix()),U||-1===this._options.uniforms.indexOf("projection")||k.setMatrix("projection",i.getProjectionMatrix()),U||-1===this._options.uniforms.indexOf("viewProjection")||(k.setMatrix("viewProjection",i.getTransformMatrix()),this._multiview&&k.setMatrix("viewProjectionR",i._transformMatrixR)),i.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&k.setVector3("cameraPosition",i.activeCamera.globalPosition),(0,G.e)(g,k),(0,R.g)(k,this,i),this._useLogarithmicDepth&&(0,G.q)(S?p.materialDefines:k.defines,k,i),g&&(0,G.i)(i,g,k),this._textures)k.setTexture(y,this._textures[y]);for(y in this._textureArrays)k.setTextureArray(y,this._textureArrays[y]);for(y in this._ints)k.setInt(y,this._ints[y]);for(y in this._uints)k.setUInt(y,this._uints[y]);for(y in this._floats)k.setFloat(y,this._floats[y]);for(y in this._floatsArrays)k.setArray(y,this._floatsArrays[y]);for(y in this._colors3)k.setColor3(y,this._colors3[y]);for(y in this._colors3Arrays)k.setArray3(y,this._colors3Arrays[y]);for(y in this._colors4){const g=this._colors4[y];k.setFloat4(y,g.r,g.g,g.b,g.a)}for(y in this._colors4Arrays)k.setArray4(y,this._colors4Arrays[y]);for(y in this._vectors2)k.setVector2(y,this._vectors2[y]);for(y in this._vectors3)k.setVector3(y,this._vectors3[y]);for(y in this._vectors4)k.setVector4(y,this._vectors4[y]);for(y in this._quaternions)k.setQuaternion(y,this._quaternions[y]);for(y in this._matrices)k.setMatrix(y,this._matrices[y]);for(y in this._matrixArrays)k.setMatrices(y,this._matrixArrays[y]);for(y in this._matrices3x3)k.setMatrix3x3(y,this._matrices3x3[y]);for(y in this._matrices2x2)k.setMatrix2x2(y,this._matrices2x2[y]);for(y in this._vectors2Arrays)k.setArray2(y,this._vectors2Arrays[y]);for(y in this._vectors3Arrays)k.setArray3(y,this._vectors3Arrays[y]);for(y in this._vectors4Arrays)k.setArray4(y,this._vectors4Arrays[y]);for(y in this._quaternionsArrays)k.setArray4(y,this._quaternionsArrays[y]);for(y in this._uniformBuffers){const g=this._uniformBuffers[y].getBuffer();g&&k.bindUniformBuffer(g,y)}const f=i.getEngine(),H=f.setExternalTexture;if(H)for(y in this._externalTextures)H.call(f,y,this._externalTextures[y]);const l=f.setTextureSampler;if(l)for(y in this._textureSamplers)l.call(f,y,this._textureSamplers[y]);const c=f.setStorageBuffer;if(c)for(y in this._storageBuffers)c.call(f,y,this._storageBuffers[y])}if(k&&g&&(l||!this.isFrozen)){const y=g.morphTargetManager;y&&y.numInfluencers>0&&(0,G.s)(g,k);const f=g.bakedVertexAnimationManager;if(f&&f.isEnabled){var c;const y=S?p._drawWrapper:this._drawWrapper;null===(c=g.bakedVertexAnimationManager)||void 0===c||c.bind(k,!!y._wasPreviouslyUsingInstances)}}this._afterBind(g,k,p)}getActiveTextures(){const y=super.getActiveTextures();for(const g in this._textures)y.push(this._textures[g]);for(const g in this._textureArrays){const f=this._textureArrays[g];for(let g=0;g<f.length;g++)y.push(f[g])}return y}hasTexture(y){if(super.hasTexture(y))return!0;for(const g in this._textures)if(this._textures[g]===y)return!0;for(const g in this._textureArrays){const f=this._textureArrays[g];for(let g=0;g<f.length;g++)if(f[g]===y)return!0}return!1}clone(y){const g=c.c.Clone((()=>new T(y,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);g.name=y,g.id=y,"object"===typeof g._shaderPath&&(g._shaderPath={...g._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((y=>{const g=this._options[y];Array.isArray(g)&&(this._options[y]=g.slice(0))})),this.stencil.copyTo(g.stencil);for(const f in this._textures)g.setTexture(f,this._textures[f]);for(const f in this._textureArrays)g.setTextureArray(f,this._textureArrays[f]);for(const f in this._externalTextures)g.setExternalTexture(f,this._externalTextures[f]);for(const f in this._ints)g.setInt(f,this._ints[f]);for(const f in this._uints)g.setUInt(f,this._uints[f]);for(const f in this._floats)g.setFloat(f,this._floats[f]);for(const f in this._floatsArrays)g.setFloats(f,this._floatsArrays[f]);for(const f in this._colors3)g.setColor3(f,this._colors3[f]);for(const f in this._colors3Arrays)g._colors3Arrays[f]=this._colors3Arrays[f];for(const f in this._colors4)g.setColor4(f,this._colors4[f]);for(const f in this._colors4Arrays)g._colors4Arrays[f]=this._colors4Arrays[f];for(const f in this._vectors2)g.setVector2(f,this._vectors2[f]);for(const f in this._vectors3)g.setVector3(f,this._vectors3[f]);for(const f in this._vectors4)g.setVector4(f,this._vectors4[f]);for(const f in this._quaternions)g.setQuaternion(f,this._quaternions[f]);for(const f in this._quaternionsArrays)g._quaternionsArrays[f]=this._quaternionsArrays[f];for(const f in this._matrices)g.setMatrix(f,this._matrices[f]);for(const f in this._matrixArrays)g._matrixArrays[f]=this._matrixArrays[f].slice();for(const f in this._matrices3x3)g.setMatrix3x3(f,this._matrices3x3[f]);for(const f in this._matrices2x2)g.setMatrix2x2(f,this._matrices2x2[f]);for(const f in this._vectors2Arrays)g.setArray2(f,this._vectors2Arrays[f]);for(const f in this._vectors3Arrays)g.setArray3(f,this._vectors3Arrays[f]);for(const f in this._vectors4Arrays)g.setArray4(f,this._vectors4Arrays[f]);for(const f in this._uniformBuffers)g.setUniformBuffer(f,this._uniformBuffers[f]);for(const f in this._textureSamplers)g.setTextureSampler(f,this._textureSamplers[f]);for(const f in this._storageBuffers)g.setStorageBuffer(f,this._storageBuffers[f]);return g}dispose(y,g,f){if(g){let y;for(y in this._textures)this._textures[y].dispose();for(y in this._textureArrays){const g=this._textureArrays[y];for(let y=0;y<g.length;y++)g[y].dispose()}}this._textures={},super.dispose(y,g,f)}serialize(){const y=c.c.Serialize(this);let g;for(g in y.customType="BABYLON.ShaderMaterial",y.uniqueId=this.uniqueId,y.options=this._options,y.shaderPath=this._shaderPath,y.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,y.stencil=this.stencil.serialize(),y.textures={},this._textures)y.textures[g]=this._textures[g].serialize();for(g in y.textureArrays={},this._textureArrays){y.textureArrays[g]=[];const f=this._textureArrays[g];for(let p=0;p<f.length;p++)y.textureArrays[g].push(f[p].serialize())}for(g in y.ints={},this._ints)y.ints[g]=this._ints[g];for(g in y.uints={},this._uints)y.uints[g]=this._uints[g];for(g in y.floats={},this._floats)y.floats[g]=this._floats[g];for(g in y.floatsArrays={},this._floatsArrays)y.floatsArrays[g]=this._floatsArrays[g];for(g in y.colors3={},this._colors3)y.colors3[g]=this._colors3[g].mj();for(g in y.colors3Arrays={},this._colors3Arrays)y.colors3Arrays[g]=this._colors3Arrays[g];for(g in y.colors4={},this._colors4)y.colors4[g]=this._colors4[g].mj();for(g in y.colors4Arrays={},this._colors4Arrays)y.colors4Arrays[g]=this._colors4Arrays[g];for(g in y.vectors2={},this._vectors2)y.vectors2[g]=this._vectors2[g].mj();for(g in y.vectors3={},this._vectors3)y.vectors3[g]=this._vectors3[g].mj();for(g in y.vectors4={},this._vectors4)y.vectors4[g]=this._vectors4[g].mj();for(g in y.quaternions={},this._quaternions)y.quaternions[g]=this._quaternions[g].mj();for(g in y.matrices={},this._matrices)y.matrices[g]=this._matrices[g].mj();for(g in y.matrixArray={},this._matrixArrays)y.matrixArray[g]=this._matrixArrays[g];for(g in y.matrices3x3={},this._matrices3x3)y.matrices3x3[g]=this._matrices3x3[g];for(g in y.matrices2x2={},this._matrices2x2)y.matrices2x2[g]=this._matrices2x2[g];for(g in y.vectors2Arrays={},this._vectors2Arrays)y.vectors2Arrays[g]=this._vectors2Arrays[g];for(g in y.vectors3Arrays={},this._vectors3Arrays)y.vectors3Arrays[g]=this._vectors3Arrays[g];for(g in y.vectors4Arrays={},this._vectors4Arrays)y.vectors4Arrays[g]=this._vectors4Arrays[g];for(g in y.quaternionsArrays={},this._quaternionsArrays)y.quaternionsArrays[g]=this._quaternionsArrays[g];return y}static Parse(y,g,f){const S=c.c.Parse((()=>new T(y.name,g,y.shaderPath,y.options,y.storeEffectOnSubMeshes)),y,g,f);let k;for(k in y.stencil&&S.stencil.parse(y.stencil,g,f),y.textures)S.setTexture(k,C.c.Parse(y.textures[k],g,f));for(k in y.textureArrays){const p=y.textureArrays[k],i=[];for(let y=0;y<p.length;y++)i.push(C.c.Parse(p[y],g,f));S.setTextureArray(k,i)}for(k in y.ints)S.setInt(k,y.ints[k]);for(k in y.uints)S.setUInt(k,y.uints[k]);for(k in y.floats)S.setFloat(k,y.floats[k]);for(k in y.floatsArrays)S.setFloats(k,y.floatsArrays[k]);for(k in y.colors3)S.setColor3(k,i.c.eh(y.colors3[k]));for(k in y.colors3Arrays){const g=y.colors3Arrays[k].reduce(((y,g,f)=>(f%3===0?y.push([g]):y[y.length-1].push(g),y)),[]).map((y=>i.c.eh(y)));S.setColor3Array(k,g)}for(k in y.colors4)S.setColor4(k,i.f.eh(y.colors4[k]));for(k in y.colors4Arrays){const g=y.colors4Arrays[k].reduce(((y,g,f)=>(f%4===0?y.push([g]):y[y.length-1].push(g),y)),[]).map((y=>i.f.eh(y)));S.setColor4Array(k,g)}for(k in y.vectors2)S.setVector2(k,p.l.eh(y.vectors2[k]));for(k in y.vectors3)S.setVector3(k,p.m.eh(y.vectors3[k]));for(k in y.vectors4)S.setVector4(k,p.o.eh(y.vectors4[k]));for(k in y.quaternions)S.setQuaternion(k,p.g.eh(y.quaternions[k]));for(k in y.matrices)S.setMatrix(k,p.c.eh(y.matrices[k]));for(k in y.matrixArray)S._matrixArrays[k]=new Float32Array(y.matrixArray[k]);for(k in y.matrices3x3)S.setMatrix3x3(k,y.matrices3x3[k]);for(k in y.matrices2x2)S.setMatrix2x2(k,y.matrices2x2[k]);for(k in y.vectors2Arrays)S.setArray2(k,y.vectors2Arrays[k]);for(k in y.vectors3Arrays)S.setArray3(k,y.vectors3Arrays[k]);for(k in y.vectors4Arrays)S.setArray4(k,y.vectors4Arrays[k]);for(k in y.quaternionsArrays)S.setArray4(k,y.quaternionsArrays[k]);return S}static ParseFromFileAsync(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((S,k)=>{const i=new j.d;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const g=JSON.parse(i.responseText),k=this.Parse(g,f||B.d.LastCreatedScene,p);y&&(k.name=y),S(k)}else k("Unable to load the ShaderMaterial")})),i.open("GET",g),i.send()}))}static ParseFromSnippetAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((p,S)=>{const k=new j.d;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const S=JSON.parse(JSON.parse(k.responseText).jsonPayload),i=JSON.parse(S.shaderMaterial),H=this.Parse(i,g||B.d.LastCreatedScene,f);H.snippetId=y,p(H)}else S("Unable to load the snippet "+y)})),k.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),k.send()}))}}T.SnippetUrl="https://snippet.babylonjs.com",T.CreateFromSnippetAsync=T.ParseFromSnippetAsync,(0,q.c)("BABYLON.ShaderMaterial",T),S.e._LinesMeshParser=(y,g)=>Q.Parse(y,g);class Q extends S.e{_isShaderMaterial(y){return"ShaderMaterial"===y.getClassName()}constructor(y){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,k=arguments.length>7?arguments[7]:void 0;super(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g,arguments.length>4?arguments[4]:void 0),this.useVertexColor=p,this.useVertexAlpha=S,this.color=new i.c(1,1,1),this.alpha=1,this._shaderLanguage=0,g&&(this.color=g.color.clone(),this.alpha=g.alpha,this.useVertexColor=g.useVertexColor,this.useVertexAlpha=g.useVertexAlpha),this.intersectionThreshold=.1;const U={attributes:[H.c.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===S?U.needAlphaBlending=!1:U.defines.push("#define VERTEXALPHA"),p?(U.defines.push("#define VERTEXCOLOR"),U.attributes.push(H.c.ColorKind)):(U.uniforms.push("color"),this._color4=new i.f),k)this.material=k;else{this.va().getEngine().isWebGPU&&!Q.ForceGLSL&&(this._shaderLanguage=1),U.shaderLanguage=this._shaderLanguage,U.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([f.e(23).then(f.bind(f,13641)),f.e(47).then(f.bind(f,13650))]):await Promise.all([f.e(28).then(f.bind(f,13658)),f.e(48).then(f.bind(f,13660))])},this.material=new T("colorShader",this.va(),"color",U,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(y){this._lineMaterial=y,this._lineMaterial.fillMode=l.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(y){}_bind(y,g){if(!this._geometry)return this;const f=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(g,f):this._geometry._bind(g,f,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:y,g:g,b:f}=this.color;this._color4.set(y,g,f,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(y,g,f){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const p=this.va().getEngine();return this._unIndexed?p.drawArraysType(l.c.LineListDrawMode,y.verticesStart,y.verticesCount,f):p.drawElementsType(l.c.LineListDrawMode,y.indexStart,y.indexCount,f),this}dispose(y){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(y)}clone(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;return new Q(y,this.va(),g,this,f)}createInstance(y){const g=new m(y,this);if(this.instancedBuffers){g.instancedBuffers={};for(const y in this.instancedBuffers)g.instancedBuffers[y]=this.instancedBuffers[y]}return g}serialize(y){super.serialize(y),y.color=this.color.mj(),y.alpha=this.alpha}static Parse(y,g){const f=new Q(y.name,g);return f.color=i.c.eh(y.color),f.alpha=y.alpha,f}}Q.ForceGLSL=!1;class m extends U.c{constructor(y,g){super(y,g),this.intersectionThreshold=g.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var a=f(10736);function w(y){const g=[],f=[],p=y.lines,S=y.za,i=[];let H=0;for(let k=0;k<p.length;k++){const y=p[k];for(let p=0;p<y.length;p++){const{x:U,y:l,z:c}=y[p];if(f.push(U,l,c),S){const y=S[k],{r:g,g:f,b:H,a:U}=y[p];i.push(g,f,H,U)}p>0&&(g.push(H-1),g.push(H)),H++}}const U=new k.e;return U.indices=g,U.xa=f,S&&(U.za=i),U}function o(y){const g=y.dashSize||3,f=y.gapSize||1,S=y.dashNb||200,i=y.points,H=[],U=[],l=p.m.Zero();let c=0,Z=0,C=0,q=0,W=0,j=0,P=0;for(P=0;P<i.length-1;P++)i[P+1].subtractToRef(i[P],l),c+=l.length();for(C=c/S,q=g*C/(g+f),P=0;P<i.length-1;P++){i[P+1].subtractToRef(i[P],l),Z=Math.floor(l.length()/C),l.normalize();for(let y=0;y<Z;y++)W=C*y,H.push(i[P].x+W*l.x,i[P].y+W*l.y,i[P].z+W*l.z),H.push(i[P].x+(W+q)*l.x,i[P].y+(W+q)*l.y,i[P].z+(W+q)*l.z),U.push(j,j+1),j+=2}const B=new k.e;return B.xa=H,B.indices=U,B}function I(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=g.instance,S=g.lines,k=g.za;if(p){const y=p.getVerticesData(H.c.PositionKind);let g,f;k&&(g=p.getVerticesData(H.c.ColorKind));let i=0,U=0;for(let p=0;p<S.length;p++){const H=S[p];for(let S=0;S<H.length;S++)y[i]=H[S].x,y[i+1]=H[S].y,y[i+2]=H[S].z,k&&g&&(f=k[p],g[U]=f[S].r,g[U+1]=f[S].g,g[U+2]=f[S].b,g[U+3]=f[S].a,U+=4),i+=3}return p.updateVerticesData(H.c.PositionKind,y,!1,!1),k&&g&&p.updateVerticesData(H.c.ColorKind,g,!1,!1),p.refreshBoundingInfo(),p}const i=new Q(y,f,null,void 0,void 0,!!k,g.useVertexAlpha,g.material);return w(g).Ca(i,g.updatable),i}function Y(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=g.za?[g.za]:null;return I(y,{lines:[g.points],updatable:g.updatable,instance:g.instance,za:p,useVertexAlpha:g.useVertexAlpha,material:g.material},f)}function n(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=g.points,i=g.instance,H=g.gapSize||1,U=g.dashSize||3;if(i){const y=y=>{const g=p.m.Zero(),f=y.length/6;let S=0,H=0,U=0,l=0,c=0,Z=0,C=0,q=0;for(C=0;C<k.length-1;C++)k[C+1].subtractToRef(k[C],g),S+=g.length();U=S/f;const W=i._creationDataStorage.dashSize;for(l=W*U/(W+i._creationDataStorage.gapSize),C=0;C<k.length-1;C++)for(k[C+1].subtractToRef(k[C],g),H=Math.floor(g.length()/U),g.normalize(),q=0;q<H&&Z<y.length;)c=U*q,y[Z]=k[C].x+c*g.x,y[Z+1]=k[C].y+c*g.y,y[Z+2]=k[C].z+c*g.z,y[Z+3]=k[C].x+(c+l)*g.x,y[Z+4]=k[C].y+(c+l)*g.y,y[Z+5]=k[C].z+(c+l)*g.z,Z+=6,q++;for(;Z<y.length;)y[Z]=k[C].x,y[Z+1]=k[C].y,y[Z+2]=k[C].z,Z+=3};return(g.dashNb||g.dashSize||g.gapSize||g.useVertexAlpha||g.material)&&a.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),i.updateMeshPositions(y,!1),i}const l=new Q(y,f,null,void 0,void 0,void 0,g.useVertexAlpha,g.material);return o(g).Ca(l,g.updatable),l._creationDataStorage=new S.g,l._creationDataStorage.dashSize=U,l._creationDataStorage.gapSize=H,l}k.e.CreateLineSystem=w,k.e.CreateDashedLines=o,S.e.pb=function(y,g){return Y(y,{points:g,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},S.e.CreateDashedLines=function(y,g,f,p,S){return n(y,{points:g,dashSize:f,gapSize:p,dashNb:S,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11449:(y,g,f)=>{"use strict";f.d(g,{c:()=>H,d:()=>U});var p=f(11321),S=f(11349),k=f(11283);function i(y){const g=[],f=[],p=[],i=[],H=y.width||y.size||1,U=y.height||y.size||1,l=0===y.sideOrientation?0:y.sideOrientation||S.e.DEFAULTSIDE,c=H/2,Z=U/2;f.push(-c,-Z,0),p.push(0,0,-1),i.push(0,k.d?1:0),f.push(c,-Z,0),p.push(0,0,-1),i.push(1,k.d?1:0),f.push(c,Z,0),p.push(0,0,-1),i.push(1,k.d?0:1),f.push(-c,Z,0),p.push(0,0,-1),i.push(0,k.d?0:1),g.push(0),g.push(1),g.push(2),g.push(0),g.push(2),g.push(3),S.e._ComputeSides(l,f,g,p,i,y.frontUVs,y.backUVs);const C=new S.e;return C.indices=g,C.xa=f,C.ya=p,C.Aa=i,C}function H(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new p.e(y,f);g.sideOrientation=p.e._GetDefaultSideOrientation(g.sideOrientation),S._originalBuilderSideOrientation=g.sideOrientation;return i(g).Ca(S,g.updatable),g.sourcePlane&&(S.translate(g.sourcePlane.k,-g.sourcePlane.d),S.setDirection(g.sourcePlane.k.scale(-1))),S}const U={rg:H};S.e.rg=i,p.e.rg=(y,g,f,p,S)=>H(y,{size:g,width:g,height:g,sideOrientation:S,updatable:p},f)},11696:(y,g,f)=>{"use strict";f.d(g,{c:()=>U});var p=f(11054),S=f(11321),k=f(11349),i=f(11283);function H(y){const g=0|(y.segments||32),f=y.diameterX||y.diameter||1,S=y.diameterY||y.diameter||1,H=y.diameterZ||y.diameter||1,U=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,l=y.slice&&y.slice<=0?1:y.slice||1,c=0===y.sideOrientation?0:y.sideOrientation||k.e.DEFAULTSIDE,Z=!!y.dedupTopBottomIndices,C=new p.m(f/2,S/2,H/2),q=2+g,W=2*q,j=[],P=[],B=[],R=[];for(let k=0;k<=q;k++){const y=k/q,g=y*Math.PI*l;for(let f=0;f<=W;f++){const S=f/W,k=S*Math.PI*2*U,H=p.c.RotationZ(-g),l=p.c.RotationY(k),c=p.m.TransformCoordinates(p.m.Up(),H),Z=p.m.TransformCoordinates(c,l),q=Z.multiply(C),j=Z.divide(C).normalize();P.push(q.x,q.y,q.z),B.push(j.x,j.y,j.z),R.push(S,i.d?1-y:y)}if(k>0){const y=P.length/3;for(let g=y-2*(W+1);g+W+2<y;g++)Z?(k>1&&(j.push(g),j.push(g+1),j.push(g+W+1)),(k<q||l<1)&&(j.push(g+W+1),j.push(g+1),j.push(g+W+2))):(j.push(g),j.push(g+1),j.push(g+W+1),j.push(g+W+1),j.push(g+1),j.push(g+W+2))}}k.e._ComputeSides(c,P,j,B,R,y.frontUVs,y.backUVs);const G=new k.e;return G.indices=j,G.xa=P,G.ya=B,G.Aa=R,G}function U(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return H(g).Ca(p,g.updatable),p}k.e.CreateSphere=H,S.e.CreateSphere=(y,g,f,p,S,k)=>U(y,{segments:g,diameterX:f,diameterY:f,diameterZ:f,sideOrientation:k,updatable:S},p)},12317:(y,g,f)=>{"use strict";f.d(g,{d:()=>Z});var p=f(10714),S=f(12325),k=f(11356),i=f(11131),H=f(11349),U=f(10736);function l(y,g,f,p,S){let k=null,i=null,H=null;try{let U;k=new y.Decoder,i=new y.DecoderBuffer,i.Init(g,g.byteLength);const l=k.GetEncodedGeometryType(i);switch(l){case y.TRIANGULAR_MESH:{const g=new y.Mesh;if(U=k.DecodeBufferToMesh(i,g),!U.ok()||0===g.ptr)throw new Error(U.error_msg());const f=3*g.num_faces(),S=4*f,l=y._malloc(S);try{k.GetTrianglesUInt32Array(g,S,l);const i=new Uint32Array(f);i.set(new Uint32Array(y.HEAPF32.buffer,l,f)),p(i)}finally{y._free(l)}H=g;break}case y.POINT_CLOUD:{const g=new y.PointCloud;if(U=k.DecodeBufferToPointCloud(i,g),!U.ok()||!g.ptr)throw new Error(U.error_msg());H=g;break}default:throw new Error(`Invalid geometry type ${l}`)}const c=H.num_points(),Z=(g,f,p,k)=>{const i=k.data_type(),H=k.num_components(),U=k.normalized(),l=k.byte_stride(),Z=k.byte_offset(),C={[y.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:y.HEAPF32},[y.DT_INT8]:{typedArrayConstructor:Int8Array,heap:y.HEAP8},[y.DT_INT16]:{typedArrayConstructor:Int16Array,heap:y.HEAP16},[y.DT_INT32]:{typedArrayConstructor:Int32Array,heap:y.HEAP32},[y.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:y.HEAPU8},[y.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:y.HEAPU16},[y.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:y.HEAPU32}}[i];if(!C)throw new Error(`Invalid data type ${i}`);const q=c*H,W=q*C.typedArrayConstructor.BYTES_PER_ELEMENT,j=y._malloc(W);try{g.GetAttributeDataArrayForAllPoints(f,k,i,W,j);const y=new C.typedArrayConstructor(C.heap.buffer,j,q);S(p,y.slice(),H,Z,l,U)}finally{y._free(j)}};if(f)for(const y in f){const g=f[y],p=k.GetAttributeByUniqueId(H,g);Z(k,H,y,p)}else{const g={position:y.POSITION,k:y.NORMAL,color:y.COLOR,uv:y.TEX_COORD};for(const y in g){const f=k.GetAttributeId(H,g[y]);if(-1!==f){const g=k.GetAttribute(H,f);Z(k,H,y,g)}}}return c}finally{H&&y.destroy(H),i&&y.destroy(i),k&&y.destroy(k)}}function c(){let y;onmessage=g=>{const f=g.data;switch(f.id){case"init":{const g=f.decoder;g.url&&importScripts(g.url);const p=g.wasmBinary?{wasmBinary:g.wasmBinary}:{};y=DracoDecoderModule(p),postMessage({id:"initDone"});break}case"decodeMesh":if(!y)throw new Error("Draco decoder module is not available");y.then((y=>{const g=l(y,f.dataView,f.attributes,(y=>{postMessage({id:"indices",data:y},[y.buffer])}),((y,g,f,p,S,k)=>{postMessage({id:"attribute",kind:y,data:g,size:f,byteOffset:p,byteStride:S,normalized:k},[g.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:g})}))}}}class Z{static get DecoderAvailable(){const y=Z.Configuration.decoder;return!!(y.wasmUrl&&y.wasmBinaryUrl&&"object"===typeof WebAssembly||y.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return Z._Default||(Z._Default=new Z),Z._Default}static ResetDefault(y){Z._Default&&(y||Z._Default.dispose(),Z._Default=null)}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.DefaultNumWorkers;const g=Z.Configuration.decoder;if(g.workerPool||"object"===typeof y&&y.workerPool)this._workerPoolPromise=Promise.resolve(g.workerPool||y.workerPool);else{const f=g.wasmBinary||"object"===typeof y&&y.wasmBinary,k="number"===typeof y?y:y.numWorkers,i=k&&"function"===typeof Worker&&"function"===typeof URL,H=i||!i&&!g.jsModule,U=g.wasmUrl&&g.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:H?p.e.GetBabylonScriptURL(g.wasmUrl,!0):"",wasmBinaryPromise:f?Promise.resolve(f):p.e.LoadFileAsync(p.e.GetBabylonScriptURL(g.wasmBinaryUrl,!0))}:{url:H?p.e.GetBabylonScriptURL(g.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};i?this._workerPoolPromise=U.wasmBinaryPromise.then((y=>{const g=`${l}(${c})()`,f=URL.createObjectURL(new Blob([g],{type:"application/javascript"}));return new S.c(k,(()=>function(y,g,f){return new Promise(((p,S)=>{const k=g=>{y.removeEventListener("error",k),y.removeEventListener("message",i),S(g)},i=g=>{"initDone"===g.data.id&&(y.removeEventListener("error",k),y.removeEventListener("message",i),p(y))};if(y.addEventListener("error",k),y.addEventListener("message",i),g){const p=g.slice(0);y.postMessage({id:"init",decoder:{url:f,wasmBinary:p}},[p])}else y.postMessage({id:"init",decoder:{url:f}})}))}(new Worker(f),y,U.url)))})):this._decoderModulePromise=U.wasmBinaryPromise.then((async y=>{if("undefined"===typeof DracoDecoderModule&&!g.jsModule){if(!U.url)throw new Error("Draco decoder module is not available");await p.e.LoadBabylonScriptAsync(U.url)}return await(f=y,S=g.jsModule,new Promise((y=>{(S||DracoDecoderModule)({wasmBinary:f}).then((g=>{y({module:g})}))})));var f,S}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((y=>{y.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(y,g,f){const p=y instanceof ArrayBuffer?new Int8Array(y):new Int8Array(y.buffer,y.byteOffset,y.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((y=>new Promise(((S,k)=>{y.push(((y,i)=>{let H=null;const l=[],c=g=>{y.removeEventListener("error",c),y.removeEventListener("message",Z),k(g),i()},Z=g=>{const p=g.data;switch(p.id){case"decodeMeshDone":y.removeEventListener("error",c),y.removeEventListener("message",Z),S({indices:H,attributes:l,totalVertices:p.totalVertices}),i();break;case"indices":H=p.data;break;case"attribute":l.push({kind:p.kind,data:p.data,size:p.size,byteOffset:p.byteOffset,byteStride:p.byteStride,normalized:(k=p.kind,C=p.normalized,f&&void 0!==f[k]?(C!==f[k]&&U.d.Warn(`Normalized flag from Draco data (${C}) does not match normalized flag from glTF accessor (${f[k]}). Using flag from glTF accessor.`),f[k]):C)})}var k,C};y.addEventListener("error",c),y.addEventListener("message",Z);const C=p.slice();y.postMessage({id:"decodeMesh",dataView:C,attributes:g},[C.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((y=>{let f=null;const S=[],k=l(y.module,p,g,(y=>{f=y}),((y,g,f,p,k,i)=>{S.push({kind:y,data:g,size:f,byteOffset:p,byteStride:k,normalized:i})}));return{indices:f,attributes:S,totalVertices:k}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(y,g,f,p){const S=await this.decodeMeshToMeshDataAsync(f,p),H=new k.d(y,g);S.indices&&H.setIndices(S.indices);for(const k of S.attributes)H.setVerticesBuffer(new i.c(g.getEngine(),k.data,k.kind,!1,void 0,k.byteStride,void 0,k.byteOffset,k.size,void 0,k.normalized,!0),S.totalVertices);return H}async _decodeMeshToGeometryForGltfAsync(y,g,f,p,S){const H=await this.decodeMeshToMeshDataAsync(f,p,S),U=new k.d(y,g);H.indices&&U.setIndices(H.indices);for(const k of H.attributes)U.setVerticesBuffer(new i.c(g.getEngine(),k.data,k.kind,!1,void 0,k.byteStride,void 0,k.byteOffset,k.size,void 0,k.normalized,!0),H.totalVertices);return U}async decodeMeshAsync(y,g){const f=await this.decodeMeshToMeshDataAsync(y,g),p=new H.e;f.indices&&(p.indices=f.indices);for(const S of f.attributes){const y=i.c.GetFloatData(S.data,S.size,i.c.GetDataType(S.data),S.byteOffset,S.byteStride,S.normalized,f.totalVertices);p.set(y,S.kind)}return p}}Z.Configuration={decoder:{wasmUrl:`${p.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${p.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${p.e._DefaultCdnUrl}/draco_decoder_gltf.js`}},Z.DefaultNumWorkers=Z.GetDefaultNumWorkers(),Z._Default=null},11514:(y,g,f)=>{"use strict";f.d(g,{c:()=>S});var p=f(11133);class S extends p.b{constructor(y){super(),this._buffer=y}get underlyingResource(){return this._buffer}}},11368:(y,g,f)=>{"use strict";f.d(g,{c:()=>m});var p=f(11021),S=f(10723),k=f(11054),i=f(11131),H=f(11349),U=f(11376),l=f(11122),c=f(11221),Z=f(11117);class C{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new k.m(0,0,0),this._diffPositionForCollisions=new k.m(0,0,0),this._collisionResponse=!0}}var q=f(10755),W=f(11237),j=f(11090),P=f(11062),B=f(11378),R=f(10871),G=f(11026),z=f(10797);class T{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=k.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class Q{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new T,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new C,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class m extends U.d{static get BILLBOARDMODE_NONE(){return U.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return U.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return U.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return U.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return U.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return U.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(y){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=y}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(y){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=y}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(y){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=y}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(y){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=y}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(y){this._internalAbstractMeshDataInfo._collisionRetryCount=y}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(y){this._internalAbstractMeshDataInfo._morphTargetManager!==y&&(this._internalAbstractMeshDataInfo._morphTargetManager=y,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(y){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==y&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=y,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(y){return!!super._updateNonUniformScalingState(y)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(y){this._internalAbstractMeshDataInfo._rawBoundingInfo=y}set Mk(y){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(y)}set onCollisionPositionChange(y){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(y)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(y){if(this._internalAbstractMeshDataInfo._visibility===y)return;const g=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=y,(1===g&&1!==y||1!==g&&1===y)&&this._markSubMeshesAsDirty((y=>{y.markAsMiscDirty(),y.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(y){this._internalAbstractMeshDataInfo._inheritVisibility=y}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let y=this._parentNode;for(;y;){const g=y.isVisible;if("undefined"!==typeof g)return g;y=y.parent}}return this._isVisible}set isVisible(y){this._isVisible=y}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(y){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=y}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(y){this._internalAbstractMeshDataInfo._renderingGroupId=y}get material(){return this._internalAbstractMeshDataInfo._material}set material(y){this._setMaterial(y)}_setMaterial(y){this._internalAbstractMeshDataInfo._material!==y&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=y,y&&y.meshMap&&(y.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.og&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(y){var g;return null===(g=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===g?void 0:g[y]}setMaterialForRenderPass(y,g){this.resetDrawCache(y),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[y]=g}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(y){this._internalAbstractMeshDataInfo._receiveShadows!==y&&(this._internalAbstractMeshDataInfo._receiveShadows=y,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(y){this._internalAbstractMeshDataInfo._hasVertexAlpha!==y&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=y,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(y){this._internalAbstractMeshDataInfo._useVertexColors!==y&&(this._internalAbstractMeshDataInfo._useVertexColors=y,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(y){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==y&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=y,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(y){this._internalAbstractMeshDataInfo._numBoneInfluencers!==y&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=y,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(y){this._internalAbstractMeshDataInfo._applyFog!==y&&(this._internalAbstractMeshDataInfo._applyFog=y,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(y){this._internalAbstractMeshDataInfo._enableDistantPicking=y}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(y){y!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=y,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(y){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(y)?-1:y}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(y){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=y}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(y){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(y)?-1:y}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(y){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=y}get lightSources(){return this._lightSources}set skeleton(y){const g=this._internalAbstractMeshDataInfo._skeleton;g&&g.needInitialSkinMatrix&&g._unregisterMeshWithPoseMatrix(this),y&&y.needInitialSkinMatrix&&y._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=y,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(y){var g;let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(y,f,!1),g=this,this._internalAbstractMeshDataInfo=new Q,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Hi=m.Ii,this.onCollideObservable=new S.d,this.onCollisionPositionChangeObservable=new S.d,this.onMaterialChangedObservable=new S.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Lb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=j.c.Red(),this.outlineWidth=.02,this.overlayColor=j.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.wb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new k.m(.5,1,.5),this.ellipsoidOffset=new k.m(0,0,0),this.edgesWidth=1,this.edgesColor=new j.f(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,_b:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new S.d,this._onCollisionPositionChange=function(y,f){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.subtractToRef(g._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,g._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),g._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>z.b.CollisionsEpsilon&&g.position.addInPlace(g._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),p&&g.onCollideObservable.notifyObservers(p),g.onCollisionPositionChangeObservable.notifyObservers(g.position)},f=this.va(),f.pi(this),this._resyncLightSources(),this._uniformBuffer=new Z.c(this.va().getEngine(),void 0,void 0,y,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),f.performancePriority){case 2:this.Da=!0;case 1:this.wb=!0,this.Lb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(y){const g=this._uniformBuffer;g.Lj("world",y),g.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),g.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(y){let g="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");g+=", # of submeshes: "+(this.og?this.og.length:0);const f=this._internalAbstractMeshDataInfo._skeleton;return f&&(g+=", skeleton: "+f.name),y&&(g+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],g+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData._b?"YES":"NO")),g}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==U.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(g||this.actionManager.isRecursive)){if(!y)return this.actionManager;if(this.actionManager.hasSpecificTrigger(y))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(y,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.og){for(const y of this.og)y._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const y of this.va().lights)y.isEnabled()&&y.canAffectMesh(this)&&this._lightSources.push(y);this._markSubMeshesAsLightDirty()}_resyncLightSource(y){const g=y.isEnabled()&&y.canAffectMesh(this),f=this._lightSources.indexOf(y);let p=!1;if(-1===f){if(!g)return;this._lightSources.push(y)}else{if(g)return;p=!0,this._lightSources.splice(f,1)}this._markSubMeshesAsLightDirty(p)}_unBindEffect(){for(const y of this.og)y.setEffect(null)}_removeLightSource(y,g){const f=this._lightSources.indexOf(y);-1!==f&&(this._lightSources.splice(f,1),this._markSubMeshesAsLightDirty(g))}_markSubMeshesAsDirty(y){if(this.og)for(const g of this.og)for(let f=0;f<g._drawWrappers.length;++f){const p=g._drawWrappers[f];p&&p.defines&&p.defines.markAllAsDirty&&y(p.defines)}}_markSubMeshesAsLightDirty(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((g=>g.markAsLightDirty(y)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((y=>y.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((y=>y.markAsMiscDirty()))}Vg(y){return this._currentRenderId=Number.MAX_VALUE,super.Vg(y),this._isDirty=!0,this}resetDrawCache(y){if(this.og)for(const g of this.og)g.resetDrawCache(y)}get isBlocked(){return!1}getLOD(y){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}hg(){return null}getVerticesData(y){return null}Ga(y,g,f,p){return this}updateVerticesData(y,g,f,p){return this}setIndices(y,g){return this}isVerticesDataPresent(y){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(y){return this._boundingInfo=y,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(y,g,f){return this._boundingInfo=new c.b(y,g,f),this._boundingInfo}normalizeToUnitCube(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(y,g,f)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(i.c.MatricesIndicesKind)&&this.isVerticesDataPresent(i.c.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(y){}_activate(y,g){return this._renderId=y,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===U.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(y,g,f){return this.position.addInPlace(this.calcMovePOV(y,g,f)),this}calcMovePOV(y,g,f){const p=new k.c;(this.rotationQuaternion?this.rotationQuaternion:k.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(p);const S=k.m.Zero(),i=this.definedFacingForward?-1:1;return k.m.TransformCoordinatesFromFloatsToRef(y*i,g,f*i,p,S),S}rotatePOV(y,g,f){return this.rotation.addInPlace(this.calcRotatePOV(y,g,f)),this}calcRotatePOV(y,g,f){const p=this.definedFacingForward?1:-1;return new k.m(y*p,g,f*p)}Fa(y,g){if(y){const f=(0,W.e)(y,0,this.getTotalVertices(),g);this._boundingInfo?this._boundingInfo.reConstruct(f.minimum,f.maximum):this._boundingInfo=new c.b(f.minimum,f.maximum)}if(this.og)for(let f=0;f<this.og.length;f++)this.og[f].refreshBoundingInfo(y);this.Ea()}_refreshBoundingInfoDirect(y){if(this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new c.b(y.minimum,y.maximum),this.og)for(let g=0;g<this.og.length;g++)this.og[g].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(y,g,f,p,S,H,U){!function(y,g,f,p,S,H,U){const l=k.j.o[0],c=k.j.Matrix[0],Z=k.j.Matrix[1],C=g===i.c.NormalKind?k.m.TransformNormalFromFloatsToRef:k.m.TransformCoordinatesFromFloatsToRef;for(let i=0,q=0;i<y.length;i+=3,q+=4){let g,W;for(c.reset(),g=0;g<4;g++)W=S[q+g],W>0&&(k.c.FromFloat32ArrayToRefScaled(f,Math.floor(16*p[q+g]),W,Z),c.addToSelf(Z));if(H&&U)for(g=0;g<4;g++)W=U[q+g],W>0&&(k.c.FromFloat32ArrayToRefScaled(f,Math.floor(16*H[q+g]),W,Z),c.addToSelf(Z));C(y[i],y[i+1],y[i+2],c,l),l.toArray(y,i)}}(y,g,f,p,S,H,U)}_getData(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.PositionKind;const p=y.cache,S=y=>{if(p){const g=p._vertexData||(p._vertexData={});return g[y]||this.copyVerticesData(y,g),g[y]}return this.getVerticesData(y)};if(g||(g=S(f)),!g)return null;if(p?(p._outputData?p._outputData.set(g):p._outputData=new Float32Array(g),g=p._outputData):(y.applyMorph&&this.morphTargetManager||y.applySkeleton&&this.skeleton)&&(g=g.slice()),y.applyMorph&&this.morphTargetManager&&function(y,g,f){let p=null;switch(g){case i.c.PositionKind:p=y=>y.getPositions();break;case i.c.NormalKind:p=y=>y.getNormals();break;case i.c.TangentKind:p=y=>y.getTangents();break;case i.c.UVKind:p=y=>y.getUVs();break;default:return}for(let S=0;S<y.length;S++){let g=y[S];for(let k=0;k<f.numTargets;k++){const i=f.getTarget(k),H=i.influence;if(0!==H){const f=p(i);f&&(g+=(f[S]-y[S])*H)}}y[S]=g}}(g,f,this.morphTargetManager),y.applySkeleton&&this.skeleton){const y=S(i.c.MatricesIndicesKind),p=S(i.c.MatricesWeightsKind);if(p&&y){const k=this.numBoneInfluencers>4,H=k?S(i.c.MatricesIndicesExtraKind):null,U=k?S(i.c.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this);m._ApplySkeleton(g,f,l,y,p,H,U)}}if(!1!==y.updatePositionsArray&&f===i.c.PositionKind){const y=this._internalAbstractMeshDataInfo._positions||[],f=y.length;if(y.length=g.length/3,f<y.length)for(let g=f;g<y.length;g++)y[g]=new k.m;for(let p=0,S=0;p<y.length;p++,S+=3)y[p].ne(g[S],g[S+1],g[S+2]);this._internalAbstractMeshDataInfo._positions=y}return g}getNormalsData(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:y,applyMorph:g,updatePositionsArray:!1},null,i.c.NormalKind)}Zd(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:y,applyMorph:g,updatePositionsArray:!1},f,i.c.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new c.b(k.m.Zero(),k.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(y){if(!this.og)return this;const g=this.og.length;for(let f=0;f<g;f++){const p=this.og[f];(g>1||!p.IsGlobal)&&p.updateBoundingInfo(y)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(y){return this.getBoundingInfo().isInFrustum(y,this.Hi)}isCompletelyInFrustum(y){return this.getBoundingInfo().isCompletelyInFrustum(y)}intersectsMesh(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0;const p=this.getBoundingInfo(),S=y.getBoundingInfo();if(p.intersects(S,g))return!0;if(f)for(const k of this.getChildMeshes())if(k.intersectsMesh(y,g,!0))return!0;return!1}intersectsPoint(y){return this.getBoundingInfo().intersectsPoint(y)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(y){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=y}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(y){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const g=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=g.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,g.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,y,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(y,g,f){var p;if(this._generatePointsArray(),!this._positions)return this;if(!y._lastColliderWorldVertices||!y._lastColliderTransformMatrix.equals(g)){y._lastColliderTransformMatrix=g.clone(),y._lastColliderWorldVertices=[],y._trianglePlanes=[];const f=y.verticesStart,p=y.verticesStart+y.verticesCount;for(let S=f;S<p;S++)y._lastColliderWorldVertices.push(k.m.TransformCoordinates(this._positions[S],g))}return f._collide(y._trianglePlanes,y._lastColliderWorldVertices,this.hg(),y.indexStart,y.indexStart+y.indexCount,y.verticesStart,!!y.Ha(),this,this._shouldConvertRHS(),7===(null===(p=y.Ha())||void 0===p?void 0:p.fillMode)),this}_processCollisionsForSubMeshes(y,g){const f=this._scene.getCollidingSubMeshCandidates(this,y),p=f.length;for(let S=0;S<p;S++){const k=f.data[S];p>1&&!k._checkCollision(y)||this._collideForSubMesh(k,g,y)}return this}_shouldConvertRHS(){return!1}_checkCollision(y){if(!this.getBoundingInfo()._checkCollision(y))return this;const g=k.j.Matrix[0],f=k.j.Matrix[1];return k.c.ScalingToRef(1/y._radius.x,1/y._radius.y,1/y._radius.z,g),this.worldMatrixFromCache.multiplyToRef(g,f),this._processCollisionsForSubMeshes(y,f),this}_generatePointsArray(){return!1}intersects(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const H=new l.c,U=this.getClassName(),c="InstancedLinesMesh"===U||"LinesMesh"===U||"GreasedLineMesh"===U?this.intersectionThreshold:0,Z=this.getBoundingInfo();if(!this.og)return H;if(!i&&(!y.intersectsSphere(Z.boundingSphere,c)||!y.intersectsBox(Z.boundingBox,c)))return H;if(p)return H.hit=!i,H.pickedMesh=i?null:this,H.distance=i?0:k.m.Distance(y.origin,Z.boundingSphere.center),H.subMeshId=0,H;if(!this._generatePointsArray())return H;let C=null;const q=this._scene.getIntersectingSubMeshCandidates(this,y),W=q.length;let j=!1;for(let k=0;k<W;k++){const y=q.data[k].Ha();if(y&&(7==y.fillMode||0==y.fillMode||1==y.fillMode||2==y.fillMode||4==y.fillMode)){j=!0;break}}if(!j)return H.hit=!0,H.pickedMesh=this,H.distance=k.m.Distance(y.origin,Z.boundingSphere.center),H.subMeshId=-1,H;for(let k=0;k<W;k++){const p=q.data[k];if(W>1&&!i&&!p.canIntersects(y))continue;const S=p.intersects(y,this._positions,this.hg(),g,f);if(S&&(g||!C||S.distance<C.distance)&&(C=S,C.subMeshId=k,g))break}if(C){const g=S??this.getWorldMatrix(),f=k.j.o[0],p=k.j.o[1];k.m.TransformCoordinatesToRef(y.origin,g,f),y.direction.scaleToRef(C.distance,p);const i=k.m.TransformNormal(p,g).addInPlace(f);return H.hit=!0,H.distance=k.m.Distance(f,i),H.pickedPoint=i,H.pickedMesh=this,H.bu=C.bu||0,H.bv=C.bv||0,H.subMeshFaceId=C.faceId,H.faceId=C.faceId+q.data[C.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),H.subMeshId=C.subMeshId,H}return H}clone(y,g,f){return null}releaseSubMeshes(){if(this.og)for(;this.og.length;)this.og[0].dispose();else this.og=[];return this}dispose(y){let g,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const p=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),p.freeActiveMeshes(),p.freeRenderingGroups(),p.renderingManager.maintainStateBetweenFrames&&p.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((y=>y!==this&&y.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),g=0;g<this._intersectionsInProgress.length;g++){const y=this._intersectionsInProgress[g],f=y._intersectionsInProgress.indexOf(this);y._intersectionsInProgress.splice(f,1)}this._intersectionsInProgress.length=0;p.lights.forEach((y=>{let g=y.includedOnlyMeshes.indexOf(this);-1!==g&&y.includedOnlyMeshes.splice(g,1),g=y.excludedMeshes.indexOf(this),-1!==g&&y.excludedMeshes.splice(g,1);const f=y.getShadowGenerators();if(f){const y=f.values();for(let f=y.next();!0!==f.done;f=y.next()){const y=f.value.getShadowMap();y&&y.renderList&&(g=y.renderList.indexOf(this),-1!==g&&y.renderList.splice(g,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const S=p.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,S.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),S.wipeCaches(),p.Lc(this),this._parentContainer){const y=this._parentContainer.meshes.indexOf(this);y>-1&&this._parentContainer.meshes.splice(y,1),this._parentContainer=null}if(f&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!y)for(g=0;g<p.uj.length;g++)p.uj[g].j===this&&(p.uj[g].dispose(),g--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(y,f)}_initFacetData(){const y=this._internalAbstractMeshDataInfo._facetData;y.facetNormals||(y.facetNormals=[]),y.facetPositions||(y.facetPositions=[]),y.facetPartitioning||(y.facetPartitioning=new Array),y.facetNb=this.hg().length/3|0,y.partitioningSubdivisions=y.partitioningSubdivisions?y.partitioningSubdivisions:10,y.partitioningBBoxRatio=y.partitioningBBoxRatio?y.partitioningBBoxRatio:1.01;for(let g=0;g<y.facetNb;g++)y.facetNormals[g]=k.m.Zero(),y.facetPositions[g]=k.m.Zero();return y.facetDataEnabled=!0,this}updateFacetData(){const y=this._internalAbstractMeshDataInfo._facetData;y.facetDataEnabled||this._initFacetData();const g=this.getVerticesData(i.c.PositionKind),f=this.hg(),p=this.getVerticesData(i.c.NormalKind),S=this.getBoundingInfo();if(y.facetDepthSort&&!y.facetDepthSortEnabled){if(y.facetDepthSortEnabled=!0,f instanceof Uint16Array)y.depthSortedIndices=new Uint16Array(f);else if(f instanceof Uint32Array)y.depthSortedIndices=new Uint32Array(f);else{let g=!1;for(let y=0;y<f.length;y++)if(f[y]>65535){g=!0;break}y.depthSortedIndices=g?new Uint32Array(f):new Uint16Array(f)}if(y.facetDepthSortFunction=function(y,g){return g.sqDistance-y.sqDistance},!y.facetDepthSortFrom){const g=this.va().activeCamera;y.facetDepthSortFrom=g?g.position:k.m.Zero()}y.depthSortedFacets=[];for(let g=0;g<y.facetNb;g++){const f={ind:3*g,sqDistance:0};y.depthSortedFacets.push(f)}y.invertedMatrix=k.c.Identity(),y.facetDepthSortOrigin=k.m.Zero()}y.bbSize.x=S.maximum.x-S.minimum.x>P.e?S.maximum.x-S.minimum.x:P.e,y.bbSize.y=S.maximum.y-S.minimum.y>P.e?S.maximum.y-S.minimum.y:P.e,y.bbSize.z=S.maximum.z-S.minimum.z>P.e?S.maximum.z-S.minimum.z:P.e;let U=y.bbSize.x>y.bbSize.y?y.bbSize.x:y.bbSize.y;if(U=U>y.bbSize.z?U:y.bbSize.z,y.subDiv.max=y.partitioningSubdivisions,y.subDiv.X=Math.floor(y.subDiv.max*y.bbSize.x/U),y.subDiv.Y=Math.floor(y.subDiv.max*y.bbSize.y/U),y.subDiv.Z=Math.floor(y.subDiv.max*y.bbSize.z/U),y.subDiv.X=y.subDiv.X<1?1:y.subDiv.X,y.subDiv.Y=y.subDiv.Y<1?1:y.subDiv.Y,y.subDiv.Z=y.subDiv.Z<1?1:y.subDiv.Z,y.facetParameters.facetNormals=this.getFacetLocalNormals(),y.facetParameters.facetPositions=this.getFacetLocalPositions(),y.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),y.facetParameters.bInfo=S,y.facetParameters.bbSize=y.bbSize,y.facetParameters.subDiv=y.subDiv,y.facetParameters.ratio=this.partitioningBBoxRatio,y.facetParameters.depthSort=y.facetDepthSort,y.facetDepthSort&&y.facetDepthSortEnabled&&(this.Sj(!0),this._worldMatrix.invertToRef(y.invertedMatrix),k.m.TransformCoordinatesToRef(y.facetDepthSortFrom,y.invertedMatrix,y.facetDepthSortOrigin),y.facetParameters.distanceTo=y.facetDepthSortOrigin),y.facetParameters.depthSortedFacets=y.depthSortedFacets,p&&H.e.ComputeNormals(g,f,p,y.facetParameters),y.facetDepthSort&&y.facetDepthSortEnabled){y.depthSortedFacets.sort(y.facetDepthSortFunction);const g=y.depthSortedIndices.length/3|0;for(let p=0;p<g;p++){const g=y.depthSortedFacets[p].ind;y.depthSortedIndices[3*p]=f[g],y.depthSortedIndices[3*p+1]=f[g+1],y.depthSortedIndices[3*p+2]=f[g+2]}this.updateIndices(y.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetNormals||this.updateFacetData(),y.facetNormals}getFacetLocalPositions(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetPositions||this.updateFacetData(),y.facetPositions}getFacetLocalPartitioning(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetPartitioning||this.updateFacetData(),y.facetPartitioning}getFacetPosition(y){const g=k.m.Zero();return this.getFacetPositionToRef(y,g),g}getFacetPositionToRef(y,g){const f=this.getFacetLocalPositions()[y],p=this.getWorldMatrix();return k.m.TransformCoordinatesToRef(f,p,g),this}getFacetNormal(y){const g=k.m.Zero();return this.getFacetNormalToRef(y,g),g}getFacetNormalToRef(y,g){const f=this.getFacetLocalNormals()[y];return k.m.TransformNormalToRef(f,this.getWorldMatrix(),g),this}getFacetsAtLocalCoordinates(y,g,f){const p=this.getBoundingInfo(),S=this._internalAbstractMeshDataInfo._facetData,k=Math.floor((y-p.minimum.x*S.partitioningBBoxRatio)*S.subDiv.X*S.partitioningBBoxRatio/S.bbSize.x),i=Math.floor((g-p.minimum.y*S.partitioningBBoxRatio)*S.subDiv.Y*S.partitioningBBoxRatio/S.bbSize.y),H=Math.floor((f-p.minimum.z*S.partitioningBBoxRatio)*S.subDiv.Z*S.partitioningBBoxRatio/S.bbSize.z);return k<0||k>S.subDiv.max||i<0||i>S.subDiv.max||H<0||H>S.subDiv.max?null:S.facetPartitioning[k+S.subDiv.max*i+S.subDiv.max*S.subDiv.max*H]}getClosestFacetAtCoordinates(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const H=this.getWorldMatrix(),U=k.j.Matrix[5];H.invertToRef(U);const l=k.j.o[8];k.m.TransformCoordinatesFromFloatsToRef(y,g,f,U,l);const c=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,p,S,i);return p&&k.m.TransformCoordinatesFromFloatsToRef(p.x,p.y,p.z,H,p),c}getClosestFacetAtLocalCoordinates(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=null,H=0,U=0,l=0,c=0,Z=0,C=0,q=0,W=0;const j=this.getFacetLocalPositions(),P=this.getFacetLocalNormals(),B=this.getFacetsAtLocalCoordinates(y,g,f);if(!B)return null;let R,G,z,T=Number.MAX_VALUE,Q=T;for(let m=0;m<B.length;m++)R=B[m],G=P[R],z=j[R],c=(y-z.x)*G.x+(g-z.y)*G.y+(f-z.z)*G.z,(!S||S&&k&&c>=0||S&&!k&&c<=0)&&(c=G.x*z.x+G.y*z.y+G.z*z.z,Z=-(G.x*y+G.y*g+G.z*f-c)/(G.x*G.x+G.y*G.y+G.z*G.z),C=y+G.x*Z,q=g+G.y*Z,W=f+G.z*Z,H=C-y,U=q-g,l=W-f,Q=H*H+U*U+l*l,Q<T&&(T=Q,i=R,p&&(p.x=C,p.y=q,p.z=W)));return i}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetDataEnabled&&(y.facetDataEnabled=!1,y.facetPositions=[],y.facetNormals=[],y.facetPartitioning=new Array,y.facetParameters=null,y.depthSortedIndices=new Uint32Array(0)),this}updateIndices(y,g){return this}createNormals(y){const g=this.getVerticesData(i.c.PositionKind),f=this.hg();let p;return p=this.isVerticesDataPresent(i.c.NormalKind)?this.getVerticesData(i.c.NormalKind):[],H.e.ComputeNormals(g,f,p,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(i.c.NormalKind,p,y),this}alignWithNormal(y,g){g||(g=B.b.Y);const f=k.j.o[0],p=k.j.o[1];return k.m.CrossToRef(g,y,p),k.m.CrossToRef(y,p,f),this.rotationQuaternion?k.g.RotationQuaternionFromAxisToRef(f,y,p,this.rotationQuaternion):k.m.RotationFromAxisToRef(f,y,p,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,q.b)("EdgesRenderer")}enableEdgesRendering(y,g,f){throw(0,q.b)("EdgesRenderer")}vj(){return this._scene.uj.filter((y=>y.j===this))}}m.OCCLUSION_TYPE_NONE=0,m.OCCLUSION_TYPE_OPTIMISTIC=1,m.OCCLUSION_TYPE_STRICT=2,m.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,m.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,m.CULLINGSTRATEGY_STANDARD=0,m.Ii=1,m.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,m.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,p.c)([G.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p,S,k,i,H]=g;return!Array.isArray(p)&&!Array.isArray(S)&&!Array.isArray(k)&&!Array.isArray(i)&&!Array.isArray(H)}))],m,"_ApplySkeleton",null),(0,R.c)("BABYLON.AbstractMesh",m)},11356:(y,g,f)=>{"use strict";f.d(g,{d:()=>P});var p=f(11054),S=f(11090),k=f(11349),i=f(11131),H=f(11209),U=f(11361),l=f(11221),c=f(10714),Z=f(11046),C=f(11237),q=f(10761),W=f(11283),j=f(10736);class P{get boundingBias(){return this._boundingBias}set boundingBias(y){this._boundingBias?this._boundingBias.p(y):this._boundingBias=y.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(y){const g=new P(P.RandomId(),y.va());return g.Ca(y),g}get meshes(){return this._meshes}constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=g||q.d.LastCreatedScene,this._scene&&(this.id=y,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=p,f?this.setAllVerticesData(f,p):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),S&&(this.Ca(S),S.Sj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let y=0;y<this._meshes.length;y++)if(!this._meshes[y].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const y=new Set;for(const g in this._vertexBuffers)y.add(this._vertexBuffers[g].getWrapperBuffer());y.forEach((y=>{y._rebuild()}))}setAllVerticesData(y,g){y.applyToGeometry(this,g),this._notifyUpdate()}Ga(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0;f&&Array.isArray(g)&&(g=new Float32Array(g));const S=new i.c(this._engine,g,y,{updatable:f,postponeInternalCreation:0===this._meshes.length,stride:p,label:"Geometry_"+this.id+"_"+y});this.setVerticesBuffer(S)}removeVerticesData(y){this._vertexBuffers[y]&&(this._vertexBuffers[y].dispose(),delete this._vertexBuffers[y]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=y.getKind();this._vertexBuffers[S]&&f&&this._vertexBuffers[S].dispose(),y._buffer&&y._buffer._increaseReferences(),this._vertexBuffers[S]=y;const k=this._meshes,H=k.length;if(S===i.c.PositionKind){this._totalVertices=g??y._maxVerticesCount,this._updateExtend(y.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const f=this._extend&&this._extend.minimum||new p.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),S=this._extend&&this._extend.maximum||new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let y=0;y<H;y++){const g=k[y];g.buildBoundingInfo(f,S),g._createGlobalSubMesh(g.isUnIndexed),g.Sj(!0),g.synchronizeInstances()}}this._notifyUpdate(S)}updateVerticesDataDirectly(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=this.getVertexBuffer(y);S&&(S.updateDirectly(g,f,p),this._notifyUpdate(y))}updateVerticesData(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=this.getVertexBuffer(y);p&&(p.update(g),y===i.c.PositionKind&&this.Ea(f,g),this._notifyUpdate(y))}Ea(y,g){if(y&&this._updateExtend(g),this._resetPointsArrayCache(),y){const y=this._meshes;for(const g of y){g.hasBoundingInfo?g.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):g.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const y=g.og;for(const g of y)g.refreshBoundingInfo()}}}_bind(y,g,f,p){if(!y)return;void 0===g&&(g=this._indexBuffer);const S=this.getVertexBuffers();if(!S)return;if(g!=this._indexBuffer||!this._vertexArrayObjects&&!p)return void this._engine.bindBuffers(S,g,y,f);const k=p||this._vertexArrayObjects,i=this._engine;k[y.key]||(k[y.key]=i.recordVertexArrayObject(S,g,y,f)),i.bindVertexArrayObject(k[y.key],g)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(y,g,f){const p=this.getVertexBuffer(y);return p?p.getFloatData(this._totalVertices,f||g&&1!==this._meshes.length):null}copyVerticesData(y,g){const f=this.getVertexBuffer(y);if(!f)return;g[y]||(g[y]=new Float32Array(this._totalVertices*f.getSize()));const p=f.getData();p&&function(y,g,f,p,S,k,H,U){const l=g*i.c.GetTypeByteLength(f),c=H*g;if(U.length!==c)throw new Error("Output length is not valid");if(f===i.c.FLOAT&&S===l)if(y instanceof Array){const g=p/4;U.set(y,g)}else if(y instanceof ArrayBuffer){const g=new Float32Array(y,p,c);U.set(g)}else{const g=y.byteOffset+p;if(g%4)return j.d.Warn("CopyFloatData: copied misaligned data."),void U.set(new Float32Array(y.buffer.slice(g,g+4*c)));const f=new Float32Array(y.buffer,g,c);U.set(f)}else i.c.ForEach(y,p,S,g,f,c,k,((y,g)=>U[g]=y))}(p,f.getSize(),f.type,f.byteOffset,f.byteStride,f.normalized,this._totalVertices,g[y])}isVertexBufferUpdatable(y){const g=this._vertexBuffers[y];return!!g&&g.isUpdatable()}getVertexBuffer(y){return this.isReady()?this._vertexBuffers[y]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(y){return this._vertexBuffers?void 0!==this._vertexBuffers[y]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(y)}getVerticesDataKinds(){const y=[];let g;if(!this._vertexBuffers&&this._delayInfo)for(g in this._delayInfo)y.push(g);else for(g in this._vertexBuffers)y.push(g);return y}updateIndices(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const p=y.length!==this._indices.length;if(f||(this._indices=y.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,y,g),p)for(const y of this._meshes)y._createGlobalSubMesh(!0)}else this.setIndices(y,null,!0)}setIndexBuffer(y,g,f){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=y,this._totalVertices=g,this._totalIndices=f,y.is32Bits||(y.is32Bits=this._totalIndices>65535);for(const p of this._meshes)p._createGlobalSubMesh(!0),p.synchronizeInstances();this._notifyUpdate()}setIndices(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=y,this._indexBufferIsUpdatable=f,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,f,"Geometry_"+this.id+"_IndexBuffer")),void 0!=g&&(this._totalVertices=g);for(const S of this._meshes)S._createGlobalSubMesh(!p),S.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}hg(y,g){if(!this.isReady())return null;const f=this._indices;return g||y&&1!==this._meshes.length?f.slice():f}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y&&this._vertexArrayObjects&&this._vertexArrayObjects[y.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[y.key]),delete this._vertexArrayObjects[y.key])}releaseForMesh(y,g){const f=this._meshes,p=f.indexOf(y);-1!==p&&(f.splice(p,1),this._vertexArrayObjects&&y._invalidateInstanceVertexArrayObject(),y._geometry=null,0===f.length&&g&&this.dispose())}Ca(y){if(y._geometry===this)return;const g=y._geometry;g&&g.releaseForMesh(y),this._vertexArrayObjects&&y._invalidateInstanceVertexArrayObject();const f=this._meshes;y._geometry=this,y._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),f.push(y),this.isReady()?this._applyToMesh(y):this._boundingInfo&&y.setBoundingInfo(this._boundingInfo)}_updateExtend(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!y&&(y=this.getVerticesData(i.c.PositionKind),!y))return;this._extend=(0,C.e)(y,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(y){const g=this._meshes.length;for(const f in this._vertexBuffers)1===g&&this._vertexBuffers[f].create(),f===i.c.PositionKind&&(this._extend||this._updateExtend(),y.buildBoundingInfo(this._extend.minimum,this._extend.maximum),y._createGlobalSubMesh(y.isUnIndexed),y.Ea());1===g&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),y._syncGeometryWithMorphTargetManager(),y.synchronizeInstances()}_notifyUpdate(y){this.onGeometryUpdated&&this.onGeometryUpdated(this,y),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const g of this._meshes)g._markSubMeshesAsAttributesDirty()}load(y,g){2!==this.delayLoadState&&(this.isReady()?g&&g():(this.delayLoadState=2,this._queueLoad(y,g)))}_queueLoad(y,g){this.delayLoadingFile&&(y.addPendingData(this),y._loadFile(this.delayLoadingFile,(f=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(f),this),this.delayLoadState=1,this._delayInfo=[],y.removePendingData(this);const p=this._meshes,S=p.length;for(let y=0;y<S;y++)this._applyToMesh(p[y]);g&&g()}),void 0,!0))}toLeftHanded(){const y=this.hg(!1);if(null!=y&&y.length>0){for(let g=0;g<y.length;g+=3){const f=y[g+0];y[g+0]=y[g+2],y[g+2]=f}this.setIndices(y)}const g=this.getVerticesData(i.c.PositionKind,!1);if(null!=g&&g.length>0){for(let y=0;y<g.length;y+=3)g[y+2]=-g[y+2];this.Ga(i.c.PositionKind,g,!1)}const f=this.getVerticesData(i.c.NormalKind,!1);if(null!=f&&f.length>0){for(let y=0;y<f.length;y+=3)f[y+2]=-f[y+2];this.Ga(i.c.NormalKind,f,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const y=this.getVerticesData(i.c.PositionKind);if(!y||0===y.length)return!1;for(let g=3*this._positionsCache.length,f=this._positionsCache.length;g<y.length;g+=3,++f)this._positionsCache[f]=p.m.eh(y,g);for(let g=0,f=0;g<y.length;g+=3,++f)this._positionsCache[f].set(y[0+g],y[1+g],y[2+g]);return this._positionsCache.length=y.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const f in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[f]);this._vertexArrayObjects={};const y=this._meshes,g=y.length;for(let f=0;f<g;f++)y[f]._invalidateInstanceVertexArrayObject()}}dispose(){const y=this._meshes,g=y.length;let f;for(f=0;f<g;f++)this.releaseForMesh(y[f]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const p in this._vertexBuffers)this._vertexBuffers[p].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const y=this._parentContainer.geometries.indexOf(this);y>-1&&this._parentContainer.geometries.splice(y,1),this._parentContainer=null}this._isDisposed=!0}i(y){const g=new k.e;g.indices=[];const f=this.hg();if(f)for(let k=0;k<f.length;k++)g.indices.push(f[k]);let p,S=!1,i=!1;for(p in this._vertexBuffers){const y=this.getVerticesData(p);if(y&&(y instanceof Float32Array?g.set(new Float32Array(y),p):g.set(y.slice(0),p),!i)){const y=this.getVertexBuffer(p);y&&(S=y.isUpdatable(),i=!S)}}const H=new P(y,this._scene,g,S);for(p in H.delayLoadState=this.delayLoadState,H.delayLoadingFile=this.delayLoadingFile,H._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)H._delayInfo=H._delayInfo||[],H._delayInfo.push(p);return H._boundingInfo=new l.b(this._extend.minimum,this._extend.maximum),H}serialize(){const y={};return y.id=this.id,y.uniqueId=this.uniqueId,y.updatable=this._updatable,Z.e&&Z.e.HasTags(this)&&(y.tags=Z.e.GetTags(this)),y}_toNumberArray(y){return Array.isArray(y)?y:Array.prototype.slice.call(y)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const y in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,y)&&(this._vertexBuffers[y]._buffer._data=null)}serializeVerticeData(){const y=this.serialize();return this.isVerticesDataPresent(i.c.PositionKind)&&(y.xa=this._toNumberArray(this.getVerticesData(i.c.PositionKind)),this.isVertexBufferUpdatable(i.c.PositionKind)&&(y.xa._updatable=!0)),this.isVerticesDataPresent(i.c.NormalKind)&&(y.ya=this._toNumberArray(this.getVerticesData(i.c.NormalKind)),this.isVertexBufferUpdatable(i.c.NormalKind)&&(y.ya._updatable=!0)),this.isVerticesDataPresent(i.c.TangentKind)&&(y.tangents=this._toNumberArray(this.getVerticesData(i.c.TangentKind)),this.isVertexBufferUpdatable(i.c.TangentKind)&&(y.tangents._updatable=!0)),this.isVerticesDataPresent(i.c.UVKind)&&(y.Aa=this._toNumberArray(this.getVerticesData(i.c.UVKind)),this.isVertexBufferUpdatable(i.c.UVKind)&&(y.Aa._updatable=!0)),this.isVerticesDataPresent(i.c.UV2Kind)&&(y.uvs2=this._toNumberArray(this.getVerticesData(i.c.UV2Kind)),this.isVertexBufferUpdatable(i.c.UV2Kind)&&(y.uvs2._updatable=!0)),this.isVerticesDataPresent(i.c.UV3Kind)&&(y.uvs3=this._toNumberArray(this.getVerticesData(i.c.UV3Kind)),this.isVertexBufferUpdatable(i.c.UV3Kind)&&(y.uvs3._updatable=!0)),this.isVerticesDataPresent(i.c.UV4Kind)&&(y.uvs4=this._toNumberArray(this.getVerticesData(i.c.UV4Kind)),this.isVertexBufferUpdatable(i.c.UV4Kind)&&(y.uvs4._updatable=!0)),this.isVerticesDataPresent(i.c.UV5Kind)&&(y.uvs5=this._toNumberArray(this.getVerticesData(i.c.UV5Kind)),this.isVertexBufferUpdatable(i.c.UV5Kind)&&(y.uvs5._updatable=!0)),this.isVerticesDataPresent(i.c.UV6Kind)&&(y.uvs6=this._toNumberArray(this.getVerticesData(i.c.UV6Kind)),this.isVertexBufferUpdatable(i.c.UV6Kind)&&(y.uvs6._updatable=!0)),this.isVerticesDataPresent(i.c.ColorKind)&&(y.za=this._toNumberArray(this.getVerticesData(i.c.ColorKind)),this.isVertexBufferUpdatable(i.c.ColorKind)&&(y.za._updatable=!0)),this.isVerticesDataPresent(i.c.MatricesIndicesKind)&&(y.matricesIndices=this._toNumberArray(this.getVerticesData(i.c.MatricesIndicesKind)),y.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(i.c.MatricesIndicesKind)&&(y.matricesIndices._updatable=!0)),this.isVerticesDataPresent(i.c.MatricesWeightsKind)&&(y.matricesWeights=this._toNumberArray(this.getVerticesData(i.c.MatricesWeightsKind)),this.isVertexBufferUpdatable(i.c.MatricesWeightsKind)&&(y.matricesWeights._updatable=!0)),y.indices=this._toNumberArray(this.hg()),y}static ExtractFromMesh(y,g){const f=y._geometry;return f?f.i(g):null}static RandomId(){return c.e.RandomId()}static _GetGeometryByLoadedUniqueId(y,g){for(let f=0;f<g.geometries.length;f++)if(g.geometries[f]._loadedUniqueId===y)return g.geometries[f];return null}static _ImportGeometry(y,g){const f=g.va(),p=y.geometryUniqueId,k=y.geometryId;if(p||k){const y=p?this._GetGeometryByLoadedUniqueId(p,f):f.getGeometryById(k);y&&y.Ca(g)}else if(y instanceof ArrayBuffer){const f=g._binaryInfo;if(f.positionsAttrDesc&&f.positionsAttrDesc.count>0){const p=new Float32Array(y,f.positionsAttrDesc.offset,f.positionsAttrDesc.count);g.Ga(i.c.PositionKind,p,!1)}if(f.normalsAttrDesc&&f.normalsAttrDesc.count>0){const p=new Float32Array(y,f.normalsAttrDesc.offset,f.normalsAttrDesc.count);g.Ga(i.c.NormalKind,p,!1)}if(f.tangetsAttrDesc&&f.tangetsAttrDesc.count>0){const p=new Float32Array(y,f.tangetsAttrDesc.offset,f.tangetsAttrDesc.count);g.Ga(i.c.TangentKind,p,!1)}if(f.uvsAttrDesc&&f.uvsAttrDesc.count>0){const p=new Float32Array(y,f.uvsAttrDesc.offset,f.uvsAttrDesc.count);if(W.d)for(let y=1;y<p.length;y+=2)p[y]=1-p[y];g.Ga(i.c.UVKind,p,!1)}if(f.uvs2AttrDesc&&f.uvs2AttrDesc.count>0){const p=new Float32Array(y,f.uvs2AttrDesc.offset,f.uvs2AttrDesc.count);if(W.d)for(let y=1;y<p.length;y+=2)p[y]=1-p[y];g.Ga(i.c.UV2Kind,p,!1)}if(f.uvs3AttrDesc&&f.uvs3AttrDesc.count>0){const p=new Float32Array(y,f.uvs3AttrDesc.offset,f.uvs3AttrDesc.count);if(W.d)for(let y=1;y<p.length;y+=2)p[y]=1-p[y];g.Ga(i.c.UV3Kind,p,!1)}if(f.uvs4AttrDesc&&f.uvs4AttrDesc.count>0){const p=new Float32Array(y,f.uvs4AttrDesc.offset,f.uvs4AttrDesc.count);if(W.d)for(let y=1;y<p.length;y+=2)p[y]=1-p[y];g.Ga(i.c.UV4Kind,p,!1)}if(f.uvs5AttrDesc&&f.uvs5AttrDesc.count>0){const p=new Float32Array(y,f.uvs5AttrDesc.offset,f.uvs5AttrDesc.count);if(W.d)for(let y=1;y<p.length;y+=2)p[y]=1-p[y];g.Ga(i.c.UV5Kind,p,!1)}if(f.uvs6AttrDesc&&f.uvs6AttrDesc.count>0){const p=new Float32Array(y,f.uvs6AttrDesc.offset,f.uvs6AttrDesc.count);if(W.d)for(let y=1;y<p.length;y+=2)p[y]=1-p[y];g.Ga(i.c.UV6Kind,p,!1)}if(f.colorsAttrDesc&&f.colorsAttrDesc.count>0){const p=new Float32Array(y,f.colorsAttrDesc.offset,f.colorsAttrDesc.count);g.Ga(i.c.ColorKind,p,!1,f.colorsAttrDesc.stride)}if(f.matricesIndicesAttrDesc&&f.matricesIndicesAttrDesc.count>0){const p=new Int32Array(y,f.matricesIndicesAttrDesc.offset,f.matricesIndicesAttrDesc.count),S=[];for(let y=0;y<p.length;y++){const g=p[y];S.push(255&g),S.push((65280&g)>>8),S.push((16711680&g)>>16),S.push(g>>24&255)}g.Ga(i.c.MatricesIndicesKind,S,!1)}if(f.matricesIndicesExtraAttrDesc&&f.matricesIndicesExtraAttrDesc.count>0){const p=new Int32Array(y,f.matricesIndicesExtraAttrDesc.offset,f.matricesIndicesExtraAttrDesc.count),S=[];for(let y=0;y<p.length;y++){const g=p[y];S.push(255&g),S.push((65280&g)>>8),S.push((16711680&g)>>16),S.push(g>>24&255)}g.Ga(i.c.MatricesIndicesExtraKind,S,!1)}if(f.matricesWeightsAttrDesc&&f.matricesWeightsAttrDesc.count>0){const p=new Float32Array(y,f.matricesWeightsAttrDesc.offset,f.matricesWeightsAttrDesc.count);g.Ga(i.c.MatricesWeightsKind,p,!1)}if(f.indicesAttrDesc&&f.indicesAttrDesc.count>0){const p=new Int32Array(y,f.indicesAttrDesc.offset,f.indicesAttrDesc.count);g.setIndices(p,null)}if(f.subMeshesAttrDesc&&f.subMeshesAttrDesc.count>0){const p=new Int32Array(y,f.subMeshesAttrDesc.offset,5*f.subMeshesAttrDesc.count);g.og=[];for(let y=0;y<f.subMeshesAttrDesc.count;y++){const f=p[5*y+0],S=p[5*y+1],k=p[5*y+2],i=p[5*y+3],U=p[5*y+4];H.b.AddToMesh(f,S,k,i,U,g)}}}else if(y.xa&&y.ya&&y.indices){if(g.Ga(i.c.PositionKind,y.xa,y.xa._updatable),g.Ga(i.c.NormalKind,y.ya,y.ya._updatable),y.tangents&&g.Ga(i.c.TangentKind,y.tangents,y.tangents._updatable),y.Aa&&g.Ga(i.c.UVKind,y.Aa,y.Aa._updatable),y.uvs2&&g.Ga(i.c.UV2Kind,y.uvs2,y.uvs2._updatable),y.uvs3&&g.Ga(i.c.UV3Kind,y.uvs3,y.uvs3._updatable),y.uvs4&&g.Ga(i.c.UV4Kind,y.uvs4,y.uvs4._updatable),y.uvs5&&g.Ga(i.c.UV5Kind,y.uvs5,y.uvs5._updatable),y.uvs6&&g.Ga(i.c.UV6Kind,y.uvs6,y.uvs6._updatable),y.za&&g.Ga(i.c.ColorKind,S.f.CheckColors4(y.za,y.xa.length/3),y.za._updatable),y.matricesIndices)if(y.matricesIndices._isExpanded)delete y.matricesIndices._isExpanded,g.Ga(i.c.MatricesIndicesKind,y.matricesIndices,y.matricesIndices._updatable);else{const f=[];for(let g=0;g<y.matricesIndices.length;g++){const p=y.matricesIndices[g];f.push(255&p),f.push((65280&p)>>8),f.push((16711680&p)>>16),f.push(p>>24&255)}g.Ga(i.c.MatricesIndicesKind,f,y.matricesIndices._updatable)}if(y.matricesIndicesExtra)if(y.matricesIndicesExtra._isExpanded)delete y.matricesIndices._isExpanded,g.Ga(i.c.MatricesIndicesExtraKind,y.matricesIndicesExtra,y.matricesIndicesExtra._updatable);else{const f=[];for(let g=0;g<y.matricesIndicesExtra.length;g++){const p=y.matricesIndicesExtra[g];f.push(255&p),f.push((65280&p)>>8),f.push((16711680&p)>>16),f.push(p>>24&255)}g.Ga(i.c.MatricesIndicesExtraKind,f,y.matricesIndicesExtra._updatable)}y.matricesWeights&&(P._CleanMatricesWeights(y,g),g.Ga(i.c.MatricesWeightsKind,y.matricesWeights,y.matricesWeights._updatable)),y.matricesWeightsExtra&&g.Ga(i.c.MatricesWeightsExtraKind,y.matricesWeightsExtra,y.matricesWeights._updatable),g.setIndices(y.indices,null)}if(y.og){g.og=[];for(let f=0;f<y.og.length;f++){const p=y.og[f];H.b.AddToMesh(p.materialIndex,p.verticesStart,p.verticesCount,p.indexStart,p.indexCount,g)}}g._shouldGenerateFlatShading&&(g.convertToFlatShadedMesh(),g._shouldGenerateFlatShading=!1),g.Sj(!0),f.onMeshImportedObservable.notifyObservers(g)}static _CleanMatricesWeights(y,g){const f=.001;if(!U.b.CleanBoneMatrixWeights)return;let p=0;if(!(y.skeletonId>-1))return;{const f=g.va().getLastSkeletonById(y.skeletonId);if(!f)return;p=f.bones.length}const S=g.getVerticesData(i.c.MatricesIndicesKind),k=g.getVerticesData(i.c.MatricesIndicesExtraKind),H=y.matricesWeights,l=y.matricesWeightsExtra,c=y.numBoneInfluencer,Z=H.length;for(let i=0;i<Z;i+=4){let y=0,g=-1;for(let p=0;p<4;p++){const S=H[i+p];y+=S,S<f&&g<0&&(g=p)}if(l)for(let p=0;p<4;p++){const S=l[i+p];y+=S,S<f&&g<0&&(g=p+4)}if((g<0||g>c-1)&&(g=c-1),y>f){const g=1/y;for(let y=0;y<4;y++)H[i+y]*=g;if(l)for(let y=0;y<4;y++)l[i+y]*=g}else g>=4?(l[i+g-4]=1-y,k[i+g-4]=p):(H[i+g]=1-y,S[i+g]=p)}g.Ga(i.c.MatricesIndicesKind,S),y.matricesWeightsExtra&&g.Ga(i.c.MatricesIndicesExtraKind,k)}static Parse(y,g,f){const S=new P(y.id,g,void 0,y.updatable);return S._loadedUniqueId=y.uniqueId,Z.e&&Z.e.AddTagsTo(S,y.tags),y.delayLoadingFile?(S.delayLoadState=4,S.delayLoadingFile=f+y.delayLoadingFile,S._boundingInfo=new l.b(p.m.eh(y.boundingBoxMinimum),p.m.eh(y.boundingBoxMaximum)),S._delayInfo=[],y.hasUVs&&S._delayInfo.push(i.c.UVKind),y.hasUVs2&&S._delayInfo.push(i.c.UV2Kind),y.hasUVs3&&S._delayInfo.push(i.c.UV3Kind),y.hasUVs4&&S._delayInfo.push(i.c.UV4Kind),y.hasUVs5&&S._delayInfo.push(i.c.UV5Kind),y.hasUVs6&&S._delayInfo.push(i.c.UV6Kind),y.hasColors&&S._delayInfo.push(i.c.ColorKind),y.hasMatricesIndices&&S._delayInfo.push(i.c.MatricesIndicesKind),y.hasMatricesWeights&&S._delayInfo.push(i.c.MatricesWeightsKind),S._delayLoadingFunction=k.e.ImportVertexData):k.e.ImportVertexData(y,S),g.pushGeometry(S,!0),S}}},12282:(y,g,f)=>{"use strict";f.d(g,{c:()=>C});var p=f(11054),S=f(10736),k=f(11368),i=f(11321),H=f(10740),U=f(11376),l=f(11131),c=f(10714),Z=f(10871);i.e._instancedMeshFactory=(y,g)=>{const f=new C(y,g);if(g.instancedBuffers){f.instancedBuffers={};for(const y in g.instancedBuffers)f.instancedBuffers[y]=g.instancedBuffers[y]}return f};class C extends k.c{constructor(y,g){super(y,g.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,g.Kj(this),this._sourceMesh=g,this._unIndexed=g._unIndexed,this.position.p(g.position),this.rotation.p(g.rotation),this.pe.p(g.pe),g.rotationQuaternion&&(this.rotationQuaternion=g.rotationQuaternion.clone()),this.animations=g.animations.slice();for(const f of g.getAnimationRanges())null!=f&&this.createAnimationRange(f.name,f.from,f.to);this.infiniteDistance=g.infiniteDistance,this.setPivotMatrix(g.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(y){var g;(null===(g=this._sourceMesh)||void 0===g?void 0:g.receiveShadows)!==y&&c.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(y){var g;(null===(g=this._sourceMesh)||void 0===g?void 0:g.material)!==y&&c.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(y){var g;(null===(g=this._sourceMesh)||void 0===g?void 0:g.visibility)!==y&&c.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(y){var g;(null===(g=this._sourceMesh)||void 0===g?void 0:g.skeleton)!==y&&c.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(y){this._sourceMesh&&y!==this._sourceMesh.renderingGroupId&&S.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(y){return this._sourceMesh.createInstance(y)}isReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(y,!0)}getVerticesData(y,g,f){return this._sourceMesh.getVerticesData(y,g,f)}copyVerticesData(y,g){this._sourceMesh.copyVerticesData(y,g)}Ga(y,g,f,p){return this.sourceMesh&&this.sourceMesh.Ga(y,g,f,p),this.sourceMesh}updateVerticesData(y,g,f,p){return this.sourceMesh&&this.sourceMesh.updateVerticesData(y,g,f,p),this.sourceMesh}setIndices(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(y,g),this.sourceMesh}isVerticesDataPresent(y){return this._sourceMesh.isVerticesDataPresent(y)}hg(){return this._sourceMesh.hg()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let y,g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;y="object"===typeof g?g:{applySkeleton:g,applyMorph:f};const p=this._sourceMesh.Hj?this._sourceMesh.Hj.boundingBias:null;return this.Fa(this._sourceMesh._getData(y,null,l.c.PositionKind),p),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(y,g){if(super._activate(y,g),this._sourceMesh.og||S.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,y),g){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==U.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new p.c);const y=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,p.j.o[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Sj(!0)),this._currentLOD.position.p(p.j.o[7]),this._currentLOD._masterMesh=y,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(y){if(!y)return this;const g=this.sourceMesh.getLODLevels();if(g&&0!==g.length){const g=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(y,g.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(y){return this.sourceMesh._preActivateForIntermediateRendering(y)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.og)for(let y=0;y<this._sourceMesh.og.length;y++)this._sourceMesh.og[y].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;const p=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(y);if(H.b.DeepCopy(this,p,["name","og","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","tj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),g&&(p.parent=g),!f)for(let S=0;S<this.va().meshes.length;S++){const y=this.va().meshes[S];y.parent===this&&y.clone(y.name,p)}return p.Sj(!0),this.onClonedObservable.notifyObservers(p),p}dispose(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Jj(this),super.dispose(y,g)}_serializeAsParent(y){super._serializeAsParent(y),y.parentId=this._sourceMesh.uniqueId,y.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;const p=this.clone("Clone of "+(this.name||this.id),y||this.parent,!0,g&&g.newSourcedMesh);p&&f&&f(this,p);for(const S of this.getChildTransformNodes(!0))S.instantiateHierarchy(p,g,f);return p}}i.e.prototype.registerInstancedBuffer=function(y,g){var f,p;if(null===(f=this._userInstancedBuffersStorage)||void 0===f||null===(p=f.vertexBuffers[y])||void 0===p||p.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const y of this.instances)y.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[y]=null,this._userInstancedBuffersStorage.strides[y]=g,this._userInstancedBuffersStorage.sizes[y]=32*g,this._userInstancedBuffersStorage.data[y]=new Float32Array(this._userInstancedBuffersStorage.sizes[y]),this._userInstancedBuffersStorage.vertexBuffers[y]=new l.c(this.getEngine(),this._userInstancedBuffersStorage.data[y],y,!0,!1,g,!0);for(const S of this.instances)S.instancedBuffers[y]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},i.e.prototype._processInstancedBuffers=function(y,g){const f=y?y.length:0;for(const p in this.instancedBuffers){let S=this._userInstancedBuffersStorage.sizes[p];const k=this._userInstancedBuffersStorage.strides[p],i=(f+1)*k;for(;S<i;)S*=2;this._userInstancedBuffersStorage.data[p].length!=S&&(this._userInstancedBuffersStorage.data[p]=new Float32Array(S),this._userInstancedBuffersStorage.sizes[p]=S,this._userInstancedBuffersStorage.vertexBuffers[p]&&(this._userInstancedBuffersStorage.vertexBuffers[p].dispose(),this._userInstancedBuffersStorage.vertexBuffers[p]=null));const H=this._userInstancedBuffersStorage.data[p];let U=0;if(g){const y=this.instancedBuffers[p];y.toArray?y.toArray(H,U):y.copyToArray?y.copyToArray(H,U):H[U]=y,U+=k}for(let g=0;g<f;g++){const f=y[g].instancedBuffers[p];f.toArray?f.toArray(H,U):f.copyToArray?f.copyToArray(H,U):H[U]=f,U+=k}this._userInstancedBuffersStorage.vertexBuffers[p]?this._userInstancedBuffersStorage.vertexBuffers[p].updateDirectly(H,0):(this._userInstancedBuffersStorage.vertexBuffers[p]=new l.c(this.getEngine(),this._userInstancedBuffersStorage.data[p],p,!0,!1,k,!0),this._invalidateInstanceVertexArrayObject())}},i.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const y in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[y]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},i.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const y in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[y]&&this._userInstancedBuffersStorage.vertexBuffers[y].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,Z.c)("BABYLON.InstancedMesh",C)},11321:(y,g,f)=>{"use strict";f.d(g,{e:()=>r,g:()=>o});var p=f(10723),S=f(10714),k=f(10740),i=f(11046),H=f(11325),U=f(11334),l=f(11054),c=f(11090),Z=f(11336),C=f(11131),q=f(11349),W=f(11356),j=f(11368),P=f(11209),B=f(11206),R=f(11385),G=f(11361),z=f(11099),T=f(10736),Q=f(10871),m=f(10755),a=f(11149);class w{constructor(y,g){this.distanceOrScreenCoverage=y,this.mesh=g}}class o{}class I{constructor(){this.visibleInstances={},this.batchCache=new Y,this.batchCacheReplacementModeInFrozenMode=new Y,this.instancesBufferSize=2048}}class Y{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class n{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class M{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class r extends j.c{static _GetDefaultSideOrientation(y){return y||r.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(y){this._internalMeshDataInfo._useLODScreenCoverage=y,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(y){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==y&&(y&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(C.c.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(C.c.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=y,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new p.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new p.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new p.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new p.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new p.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(y){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(y)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(y){this._internalMeshDataInfo._forcedInstanceCount=y}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(y){this._internalMeshDataInfo._sideOrientation=y,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===y||!this._scene.useRightHandedSystem&&0===y}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(y){this.sideOrientation=y,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(y){this._internalMeshDataInfo._overrideRenderingFillMode=y}get material(){return this._internalAbstractMeshDataInfo._material}set material(y){y&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(y.sideOrientation=null),this._setMaterial(y)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(y){this._unIndexed!==y&&(this._unIndexed=y,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(y){this._instanceDataStorage.manualUpdate=y}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(y){this._instanceDataStorage.previousManualUpdate=y}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(y){this._instanceDataStorage.forceMatrixUpdates=y}_copySource(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const p=this.va();if(y._geometry&&y._geometry.Ca(this),k.b.DeepCopy(y,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Hj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","tj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=y,p.useClonedMeshMap&&(y._internalMeshDataInfo.meshMap||(y._internalMeshDataInfo.meshMap={}),y._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=y._originalBuilderSideOrientation,this._creationDataStorage=y._creationDataStorage,y._ranges){const g=y._ranges;for(const y in g)Object.prototype.hasOwnProperty.call(g,y)&&g[y]&&this.createAnimationRange(y,g[y].from,g[y].to)}if(y.metadata&&y.metadata.clone?this.metadata=y.metadata.clone():this.metadata=y.metadata,this._internalMetadata=y._internalMetadata,i.e&&i.e.HasTags(y)&&i.e.AddTagsTo(this,i.e.GetTags(y,!0)),this.Mb(y.isEnabled(!1)),this.parent=y.parent,this.setPivotMatrix(y.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+y.id,this.material=y.material,!g){const g=y.getDescendants(!0);for(let y=0;y<g.length;y++){const f=g[y];f.clone&&f.clone(this.name+"."+f.name,this)}}if(y.morphTargetManager&&(this.morphTargetManager=y.morphTargetManager),p.getPhysicsEngine){const g=p.getPhysicsEngine();if(f&&g)if(1===g.getPluginVersion()){const f=g.getImpostorForPhysicsObject(y);f&&(this.physicsImpostor=f.clone(this))}else 2===g.getPluginVersion()&&y.physicsBody&&y.physicsBody.clone(this)}for(let S=0;S<p.uj.length;S++){const g=p.uj[S];g.j===y&&g.clone(g.name,this)}this.skeleton=y.skeleton,this.refreshBoundingInfo(!0,!0),this.Sj(!0)}constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(y,g),this._internalMeshDataInfo=new M,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new I,this._thinInstanceDataStorage=new n,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=r.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,g=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(y,g,f)=>{y&&f&&(this._uniformBuffer?this.transferToEffect(g):f.bindOnlyWorldMatrix(g))},S&&this._copySource(S,k,i),null!==f&&(this.parent=f),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=y=>{y.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new p.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),S&&S.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;const p=0===this.getTotalVertices()||g&&g.doNotInstantiate&&(!0===g.doNotInstantiate||g.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),y||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));p.parent=y||this.parent,p.position=this.position.clone(),p.pe=this.pe.clone(),this.rotationQuaternion?p.rotationQuaternion=this.rotationQuaternion.clone():p.rotation=this.rotation.clone(),f&&f(this,p);for(const S of this.getChildTransformNodes(!0))"InstancedMesh"===S.getClassName()&&"Mesh"===p.getClassName()&&S.sourceMesh===this?S.instantiateHierarchy(p,{doNotInstantiate:g&&g.doNotInstantiate||!1,newSourcedMesh:p},f):S.instantiateHierarchy(p,g,f);return p}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(y){let g=super.toString(y);if(g+=", n vertices: "+this.getTotalVertices(),g+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let f=0;f<this.animations.length;f++)g+=", animation[0]: "+this.animations[f].toString(y);if(y)if(this._geometry){const y=this.hg(),f=this.getVerticesData(C.c.PositionKind);f&&y&&(g+=", flat shading: "+(f.length/3===y.length?"YES":"NO"))}else g+=", flat shading: UNKNOWN";return g}_unBindEffect(){super._unBindEffect();for(const y of this.instances)y._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const y=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((g,f)=>g.distanceOrScreenCoverage<f.distanceOrScreenCoverage?y:g.distanceOrScreenCoverage>f.distanceOrScreenCoverage?-y:0))}addLODLevel(y,g){if(g&&g._masterMesh)return T.d.Warn("You cannot use a mesh as LOD level twice"),this;const f=new w(y,g);return this._internalMeshDataInfo._LODLevels.push(f),g&&(g._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(y){const g=this._internalMeshDataInfo;for(let f=0;f<g._LODLevels.length;f++){const p=g._LODLevels[f];if(p.distanceOrScreenCoverage===y)return p.mesh}return null}removeLODLevel(y){const g=this._internalMeshDataInfo;for(let f=0;f<g._LODLevels.length;f++)g._LODLevels[f].mesh===y&&(g._LODLevels.splice(f,1),y&&(y._masterMesh=null));return this._sortLODLevels(),this}getLOD(y,g){const f=this._internalMeshDataInfo;if(!f._LODLevels||0===f._LODLevels.length)return this;const p=g||this.getBoundingInfo().boundingSphere,S=y.mode===U.d.ORTHOGRAPHIC_CAMERA?y.$i:p.centerWorld.ed(y.globalPosition).length();let k=S,i=1;if(f._useLODScreenCoverage){const g=y.screenArea;let f=p.radiusWorld*y.$i/S;f=f*f*Math.PI,k=f/g,i=-1}if(i*f._LODLevels[f._LODLevels.length-1].distanceOrScreenCoverage>i*k)return this.onLODLevelSelection&&this.onLODLevelSelection(k,this,this),this;for(let H=0;H<f._LODLevels.length;H++){const y=f._LODLevels[H];if(i*y.distanceOrScreenCoverage<i*k){if(y.mesh){if(4===y.mesh.delayLoadState)return y.mesh._checkDelayState(),this;if(2===y.mesh.delayLoadState)return this;y.mesh._preActivate(),y.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(k,this,y.mesh),y.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(k,this,this),this}get Hj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(y,g,f,p){var S,k;if(!this._geometry)return null;let i=p||null===(S=this._userInstancedBuffersStorage)||void 0===S||null===(k=S.vertexBuffers[y])||void 0===k?void 0:k.getFloatData(this.instances.length+1,f||g&&1!==this._geometry.meshes.length);return i||(i=this._geometry.getVerticesData(y,g,f)),i}copyVerticesData(y,g){this._geometry&&this._geometry.copyVerticesData(y,g)}getVertexBuffer(y,g){var f;return this._geometry?(g||null===(f=this._userInstancedBuffersStorage)||void 0===f?void 0:f.vertexBuffers[y])??this._geometry.getVertexBuffer(y):null}isVerticesDataPresent(y,g){var f;return this._geometry?!g&&void 0!==(null===(f=this._userInstancedBuffersStorage)||void 0===f?void 0:f.vertexBuffers[y])||this._geometry.isVerticesDataPresent(y):!!this._delayInfo&&-1!==this._delayInfo.indexOf(y)}isVertexBufferUpdatable(y,g){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(y);if(!g){var f;const g=null===(f=this._userInstancedBuffersStorage)||void 0===f?void 0:f.vertexBuffers[y];if(g)return g.isUpdatable()}return this._geometry.isVertexBufferUpdatable(y)}getVerticesDataKinds(y){if(!this._geometry){const y=[];return this._delayInfo&&this._delayInfo.forEach((function(g){y.push(g)})),y}const g=this._geometry.getVerticesDataKinds();if(!y&&this._userInstancedBuffersStorage)for(const f in this._userInstancedBuffersStorage.vertexBuffers)-1===g.indexOf(f)&&g.push(f);return g}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}hg(y,g){return this._geometry?this._geometry.hg(y,g):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(y))return!1;if(!this.og||0===this.og.length)return!0;if(!y)return!0;const f=this.getEngine(),p=this.va(),S=g||f.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Sj();const k=this.material||p.defaultMaterial;if(k)if(k._storeEffectOnSubMeshes)for(const C of this.og){const y=C.Ha();if(y)if(y._storeEffectOnSubMeshes){if(!y.isReadyForSubMesh(this,C,S))return!1}else if(!y.isReady(this,S))return!1}else if(!k.isReady(this,S))return!1;const i=f.currentRenderPassId;for(const C of this.lightSources){const y=C.getShadowGenerators();if(!y)continue;const g=y.values();for(let p=g.next();!0!==p.done;p=g.next()){var H,U,l,c;const y=p.value;if(y&&(null===(H=y.getShadowMap())||void 0===H||!H.renderList||null!==(U=y.getShadowMap())&&void 0!==U&&U.renderList&&-1!==(null===(l=y.getShadowMap())||void 0===l||null===(c=l.renderList)||void 0===c?void 0:c.indexOf(this)))){const g=y.getShadowMap().renderPassIds??[f.currentRenderPassId];for(let p=0;p<g.length;++p){f.currentRenderPassId=g[p];for(const g of this.og){var Z;if(!y.isReady(g,S,(null===(Z=g.Ha())||void 0===Z?void 0:Z.needAlphaBlendingForMesh(this))??!1))return f.currentRenderPassId=i,!1}}f.currentRenderPassId=i}}}for(const C of this._internalMeshDataInfo._LODLevels)if(C.mesh&&!C.mesh.isReady(S))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Sh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(y){this._instanceDataStorage.overridenInstanceCount=y}_preActivate(){const y=this._internalMeshDataInfo,g=this.va().getRenderId();return y._preActivateId===g||(y._preActivateId=g,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(y){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=y),this}_registerInstanceForRenderId(y,g){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:g,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[g]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=g,this._instanceDataStorage.visibleInstances[g]=new Array),this._instanceDataStorage.visibleInstances[g].push(y),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let y,g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;y="object"===typeof g?g:{applySkeleton:g,applyMorph:f};const p=this.Hj?this.Hj.boundingBias:null;return this.Fa(this._getData(y,null,C.c.PositionKind),p),this}_createGlobalSubMesh(y){const g=this.getTotalVertices();if(!g||!this.hg())return null;if(this.og&&this.og.length>0){const f=this.hg();if(!f)return null;const p=f.length;let S=!1;if(y)S=!0;else for(const y of this.og){if(y.indexStart+y.indexCount>p){S=!0;break}if(y.verticesStart+y.verticesCount>g){S=!0;break}}if(!S)return this.og[0]}return this.releaseSubMeshes(),new P.b(0,0,g,0,this.getTotalIndices(),this)}subdivide(y){if(y<1)return;const g=this.getTotalIndices();let f=g/y|0,p=0;for(;f%3!==0;)f++;this.releaseSubMeshes();for(let S=0;S<y&&!(p>=g);S++)P.b.CreateFromIndices(0,p,S===y-1?g-p:f,this,void 0,!1),p+=f;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(y,g,f,p);else{const p=new q.e;p.set(g,y);const S=this.va();new W.d(W.d.RandomId(),S,p,f,this)}return this}removeVerticesData(y){this._geometry&&this._geometry.removeVerticesData(y)}markVerticesDataAsUpdatable(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=this.getVertexBuffer(y);f&&f.isUpdatable()!==g&&this.Ga(y,this.getVerticesData(y),g)}setVerticesBuffer(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=W.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(y,null,g),this}updateVerticesData(y,g,f,p){return this._geometry?(p?(this.makeGeometryUnique(),this.updateVerticesData(y,g,f,!1)):this._geometry.updateVerticesData(y,g,f),this):this}updateMeshPositions(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=this.getVerticesData(C.c.PositionKind);if(!f)return this;if(y(f),this.updateVerticesData(C.c.PositionKind,f,!1,!1),g){const y=this.hg(),g=this.getVerticesData(C.c.NormalKind);if(!g)return this;q.e.ComputeNormals(f,y,g),this.updateVerticesData(C.c.NormalKind,g,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const y=this._geometry,g=this._geometry.i(W.d.RandomId());return y.releaseForMesh(this,!0),g.Ca(this),this}setIndexBuffer(y,g,f){let p=this._geometry;p||(p=new W.d(W.d.RandomId(),this.va(),void 0,void 0,this)),p.setIndexBuffer(y,g,f)}setIndices(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(y,g,f,p);else{const g=new q.e;g.indices=y;const p=this.va();new W.d(W.d.RandomId(),p,g,f,this)}return this}updateIndices(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(y,g,f),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(y,g,f){let p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const S=this.va().getEngine();let k;if(this._unIndexed)if(this._getRenderingFillMode(f)===B.c.WireFrameFillMode)k=y._getLinesIndexBuffer(this.hg(),S);else k=null;else switch(this._getRenderingFillMode(f)){case B.c.PointFillMode:k=null;break;case B.c.WireFrameFillMode:k=y._getLinesIndexBuffer(this.hg(),S);break;default:case B.c.TriangleFillMode:k=this._geometry.getIndexBuffer()}return this._bindDirect(g,k,p)}_bindDirect(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(y),f&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(y,g,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(y,g),this):this}_draw(y,g,f){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const p=this.va().getEngine();return this._unIndexed&&g!==B.c.WireFrameFillMode||g==B.c.PointFillMode?p.drawArraysType(g,y.verticesStart,y.verticesCount,this.forcedInstanceCount||f):g==B.c.WireFrameFillMode?p.drawElementsType(g,0,y._linesIndexCount,this.forcedInstanceCount||f):p.drawElementsType(g,y.indexStart,y.indexCount,this.forcedInstanceCount||f),this}registerBeforeRender(y){return this.onBeforeRenderObservable.add(y),this}unregisterBeforeRender(y){return this.onBeforeRenderObservable.removeCallback(y),this}registerAfterRender(y){return this.onAfterRenderObservable.add(y),this}unregisterAfterRender(y){return this.onAfterRenderObservable.removeCallback(y),this}_getInstancesRenderList(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(g)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[y]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[y]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const f=this.va(),p=f._isInIntermediateRendering(),S=p?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,k=this._instanceDataStorage.batchCache;if(k.mustReturn=!1,k.renderSelf[y]=g||!S&&this.isEnabled()&&this.isVisible,k.visibleInstances[y]=null,this._instanceDataStorage.visibleInstances&&!g){const g=this._instanceDataStorage.visibleInstances,S=f.getRenderId(),i=p?g.intermediateDefaultRenderId:g.defaultRenderId;k.visibleInstances[y]=g[S],!k.visibleInstances[y]&&i&&(k.visibleInstances[y]=g[i])}return k.hardwareInstancedRendering[y]=!g&&this._instanceDataStorage.hardwareInstancedRendering&&null!==k.visibleInstances[y]&&void 0!==k.visibleInstances[y],this._instanceDataStorage.previousBatch=k,k}_renderWithInstances(y,g,f,p,S){const k=f.visibleInstances[y._id],i=k?k.length:0,H=this._instanceDataStorage,U=H.instancesBufferSize;let c=H.instancesBuffer,Z=H.instancesPreviousBuffer;const q=16*(i+1)*4;for(;H.instancesBufferSize<q;)H.instancesBufferSize*=2;H.instancesData&&U==H.instancesBufferSize||(H.instancesData=new Float32Array(H.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!H.instancesPreviousData||U!=H.instancesBufferSize)&&(H.instancesPreviousData=new Float32Array(H.instancesBufferSize/4));let W=0,j=0;const P=f.renderSelf[y._id],B=!c||U!==H.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!H.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||H.isFrozen&&!B)j=(P?1:0)+i;else{const g=this.getWorldMatrix();if(P&&(this._scene.needsPreviousWorldMatrices&&(H.masterMeshPreviousWorldMatrix?(H.masterMeshPreviousWorldMatrix.copyToArray(H.instancesPreviousData,W),H.masterMeshPreviousWorldMatrix.p(g)):(H.masterMeshPreviousWorldMatrix=g.clone(),H.masterMeshPreviousWorldMatrix.copyToArray(H.instancesPreviousData,W))),g.copyToArray(H.instancesData,W),W+=16,j++),k){var R;if(r.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(R=y.Ha())&&void 0!==R&&R.needAlphaBlendingForMesh(y.getRenderingMesh())){const y=this._scene.activeCamera.globalPosition;for(let g=0;g<k.length;g++){const f=k[g];f._distanceToCamera=l.m.Distance(f.getBoundingInfo().boundingSphere.centerWorld,y)}k.sort(((y,g)=>y._distanceToCamera>g._distanceToCamera?-1:y._distanceToCamera<g._distanceToCamera?1:0))}for(let y=0;y<k.length;y++){const g=k[y],f=g.getWorldMatrix();f.copyToArray(H.instancesData,W),this._scene.needsPreviousWorldMatrices&&(g._previousWorldMatrix?(g._previousWorldMatrix.copyToArray(H.instancesPreviousData,W),g._previousWorldMatrix.p(f)):(g._previousWorldMatrix=f.clone(),g._previousWorldMatrix.copyToArray(H.instancesPreviousData,W))),W+=16,j++}}}return B?(c&&c.dispose(),Z&&Z.dispose(),c=new C.b(S,H.instancesData,!0,16,!1,!0),H.instancesBuffer=c,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=c.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=c.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=c.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=c.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(Z=new C.b(S,H.instancesPreviousData,!0,16,!1,!0),H.instancesPreviousBuffer=Z,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=Z.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=Z.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=Z.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=Z.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(c.updateDirectly(H.instancesData,0,j),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||Z.updateDirectly(H.instancesPreviousData,0,j)),this._processInstancedBuffers(k,P),this.va()._activeIndices.addCount(y.indexCount*j,!1),S._currentDrawContext&&(S._currentDrawContext.useInstancing=!0),this._bind(y,p,g),this._draw(y,g,j),!this._scene.needsPreviousWorldMatrices||B||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||Z.updateDirectly(H.instancesData,0,j),S.unbindInstanceAttributes(),this}_renderWithThinInstances(y,g,f,p){var S;const k=(null===(S=this._thinInstanceDataStorage)||void 0===S?void 0:S.instancesCount)??0;this.va()._activeIndices.addCount(y.indexCount*k,!1),p._currentDrawContext&&(p._currentDrawContext.useInstancing=!0),this._bind(y,f,g),this._draw(y,g,k),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,k):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),p.unbindInstanceAttributes()}_processInstancedBuffers(y,g){}_processRendering(y,g,f,p,S,k,i,H){const U=this.va(),l=U.getEngine();if(p=this._getRenderingFillMode(p),k&&g.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(g,p,f,l),this;if(k)this._renderWithInstances(g,p,S,f,l);else{l._currentDrawContext&&(l._currentDrawContext.useInstancing=!1);let f=0;S.renderSelf[g._id]&&(i&&i(!1,y.getWorldMatrix(),H),f++,this._draw(g,p,this._instanceDataStorage.overridenInstanceCount));const k=S.visibleInstances[g._id];if(k){const y=k.length;f+=y;for(let f=0;f<y;f++){const y=k[f].getWorldMatrix();i&&i(!0,y,H),this._draw(g,p)}}U._activeIndices.addCount(g.indexCount*f,!1)}return this}_rebuild(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(y&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const g in this._userInstancedBuffersStorage.vertexBuffers){const f=this._userInstancedBuffersStorage.vertexBuffers[g];f&&(y&&f.dispose(),this._userInstancedBuffersStorage.vertexBuffers[g]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(y)}_freeze(){if(this.og){for(let y=0;y<this.og.length;y++)this._getInstancesRenderList(y);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(y,g,f,p){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const k=this._scene.getEngine(),i=k.currentRenderPassId;if(void 0!==y&&(k.currentRenderPassId=y),p)(!S||S&&p.isInFrustum(this._scene._frustumPlanes))&&this.render(p,!!g,f);else for(let H=0;H<this.og.length;H++){const y=this.og[H];(!S||S&&y.isInFrustum(this._scene._frustumPlanes))&&this.render(y,!!g,f)}return void 0!==y&&(k.currentRenderPassId=i),this}directRender(){if(!this.og)return this;for(const y of this.og)this.render(y,!1);return this}render(y,g,f){var p,S,k;const i=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const H=(null===(p=i.activeCameras)||void 0===p?void 0:p.length)??0;if((H>1&&i.activeCamera===i.activeCameras[0]||H<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const U=this._getInstancesRenderList(y._id,!!f);if(U.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const l=i.getEngine();let c=0,Z=null;this.ignoreCameraMaxZ&&i.activeCamera&&!i._isInIntermediateRendering()&&(c=i.activeCamera.maxZ,Z=i.activeCamera,i.activeCamera.maxZ=0,i.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const C=y.getRenderingMesh(),q=U.hardwareInstancedRendering[y._id]||C.hasThinInstances||!!this._userInstancedBuffersStorage&&!y.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,W=this._instanceDataStorage,j=y.Ha();if(!j)return Z&&(Z.maxZ=c,i.updateTransformMatrix(!0)),this;if(W.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===j){if(j._storeEffectOnSubMeshes&&(null===(S=y._drawWrapper)||void 0===S||!S._wasPreviouslyReady)||!j._storeEffectOnSubMeshes&&!j._getDrawWrapper()._wasPreviouslyReady)return Z&&(Z.maxZ=c,i.updateTransformMatrix(!0)),this}else{if(j._storeEffectOnSubMeshes){if(!j.isReadyForSubMesh(this,y,q))return Z&&(Z.maxZ=c,i.updateTransformMatrix(!0)),this}else if(!j.isReady(this,q))return Z&&(Z.maxZ=c,i.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=j}let P;g&&l.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),P=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?y._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const R=(null===(k=P)||void 0===k?void 0:k.effect)??null;for(const B of i._beforeRenderingMeshStage)B.action(this,y,U,R);if(!P||!R)return Z&&(Z.maxZ=c,i.updateTransformMatrix(!0)),this;const G=f||this;let z;if(W.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.oh&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)z=W.sideOrientation;else{const y=G._getWorldMatrixDeterminant();z=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),y<0&&(z=z===B.c.ClockWiseSideOrientation?B.c.CounterClockWiseSideOrientation:B.c.ClockWiseSideOrientation),W.sideOrientation=z}const T=this._internalMeshDataInfo._effectiveMaterial._preBind(P,z);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&l.setDepthWrite(!0);const Q=this._internalMeshDataInfo._effectiveMaterial,m=Q.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),q||this._bind(y,R,m,!1);const a=G.getWorldMatrix();Q._storeEffectOnSubMeshes?Q.bindForSubMesh(a,this,y):Q.bind(a,this),!Q.oh&&Q.separateCullingPass&&(l.setState(!0,Q.zOffset,!1,!T,Q.cullBackFaces,Q.stencil,Q.zOffsetUnits),this._processRendering(this,y,R,m,U,q,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),l.setState(!0,Q.zOffset,!1,T,Q.cullBackFaces,Q.stencil,Q.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(y)),this._processRendering(this,y,R,m,U,q,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const B of i._afterRenderingMeshStage)B.action(this,y,U,R);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),Z&&(Z.maxZ=c,i.updateTransformMatrix(!0)),2!==i.performancePriority||W.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(C.c.MatricesWeightsKind)&&(this.isVerticesDataPresent(C.c.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const y=this.getVerticesData(C.c.MatricesWeightsKind),g=y.length;for(let f=0;f<g;f+=4){const g=y[f]+y[f+1]+y[f+2]+y[f+3];if(0===g)y[f]=1;else{const p=1/g;y[f]*=p,y[f+1]*=p,y[f+2]*=p,y[f+3]*=p}}this.Ga(C.c.MatricesWeightsKind,y)}_normalizeSkinWeightsAndExtra(){const y=this.getVerticesData(C.c.MatricesWeightsExtraKind),g=this.getVerticesData(C.c.MatricesWeightsKind),f=g.length;for(let p=0;p<f;p+=4){let f=g[p]+g[p+1]+g[p+2]+g[p+3];if(f+=y[p]+y[p+1]+y[p+2]+y[p+3],0===f)g[p]=1;else{const S=1/f;g[p]*=S,g[p+1]*=S,g[p+2]*=S,g[p+3]*=S,y[p]*=S,y[p+1]*=S,y[p+2]*=S,y[p+3]*=S}}this.Ga(C.c.MatricesWeightsKind,g),this.Ga(C.c.MatricesWeightsKind,y)}validateSkinning(){const y=this.getVerticesData(C.c.MatricesWeightsExtraKind),g=this.getVerticesData(C.c.MatricesWeightsKind);if(null===g||null==this.skeleton)return{skinned:!1,valid:!0,om:"not skinned"};const f=g.length;let p=0,S=0,k=0,i=0;const H=null===y?4:8,U=[];for(let C=0;C<=H;C++)U[C]=0;for(let C=0;C<f;C+=4){let f=g[C],l=f,c=0===l?0:1;for(let S=1;S<H;S++){const k=S<4?g[C+S]:y[C+S-4];k>f&&p++,0!==k&&c++,l+=k,f=k}if(U[c]++,c>k&&(k=c),0===l)S++;else{const f=1/l;let p=0;for(let S=0;S<H;S++)p+=S<4?Math.abs(g[C+S]-g[C+S]*f):Math.abs(y[C+S-4]-y[C+S-4]*f);p>.001&&i++}}const l=this.skeleton.bones.length,c=this.getVerticesData(C.c.MatricesIndicesKind),Z=this.getVerticesData(C.c.MatricesIndicesExtraKind);let q=0;for(let C=0;C<f;C+=4)for(let y=0;y<H;y++){const g=y<4?c[C+y]:Z[C+y-4];(g>=l||g<0)&&q++}return{skinned:!0,valid:0===S&&0===i&&0===q,om:"Number of Weights = "+f/4+"\nMaximum influences = "+k+"\nMissing Weights = "+S+"\nNot Sorted = "+p+"\nNot Normalized = "+i+"\nWeightCounts = ["+U+"]\nNumber of bones = "+l+"\nBad Bone Indices = "+q}}_checkDelayState(){const y=this.va();return this._geometry?this._geometry.load(y):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(y)),this}_queueLoad(y){y.addPendingData(this);const g=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return S.e.LoadFile(this.delayLoadingFile,(g=>{g instanceof ArrayBuffer?this._delayLoadingFunction(g,this):this._delayLoadingFunction(JSON.parse(g),this),this.instances.forEach((y=>{y.refreshBoundingInfo(),y._syncSubMeshes()})),this.delayLoadState=1,y.removePendingData(this)}),(()=>{}),y.offlineProvider,g),this}isInFrustum(y){return 2!==this.delayLoadState&&(!!super.isInFrustum(y)&&(this._checkDelayState(),!0))}setMaterialById(y){const g=this.va().materials;let f;for(f=g.length-1;f>-1;f--)if(g[f].id===y)return this.material=g[f],this;const p=this.va().multiMaterials;for(f=p.length-1;f>-1;f--)if(p[f].id===y)return this.material=p[f],this;return this}getAnimatables(){const y=[];return this.material&&y.push(this.material),this.skeleton&&y.push(this.skeleton),y}bakeTransformIntoVertices(y){if(!this.isVerticesDataPresent(C.c.PositionKind))return this;const g=this.og.splice(0);this._resetPointsArrayCache();let f=this.getVerticesData(C.c.PositionKind);const p=l.m.Zero();let S;for(S=0;S<f.length;S+=3)l.m.TransformCoordinatesFromFloatsToRef(f[S],f[S+1],f[S+2],y,p).toArray(f,S);if(this.Ga(C.c.PositionKind,f,this.getVertexBuffer(C.c.PositionKind).isUpdatable()),this.isVerticesDataPresent(C.c.NormalKind)){for(f=this.getVerticesData(C.c.NormalKind),S=0;S<f.length;S+=3)l.m.TransformNormalFromFloatsToRef(f[S],f[S+1],f[S+2],y,p).normalize().toArray(f,S);this.Ga(C.c.NormalKind,f,this.getVertexBuffer(C.c.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(C.c.TangentKind)){for(f=this.getVerticesData(C.c.TangentKind),S=0;S<f.length;S+=4)l.m.TransformNormalFromFloatsToRef(f[S],f[S+1],f[S+2],y,p).normalize().toArray(f,S);this.Ga(C.c.TangentKind,f,this.getVertexBuffer(C.c.TangentKind).isUpdatable())}return y.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.og=g,this}bakeCurrentTransformIntoVertices(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Sj(!0)),this.resetLocalMatrix(y),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),y,this,g,f)}dispose(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const f=this._internalMeshDataInfo;if(f._onBeforeDrawObservable&&f._onBeforeDrawObservable.clear(),f._onBeforeBindObservable&&f._onBeforeBindObservable.clear(),f._onBeforeRenderObservable&&f._onBeforeRenderObservable.clear(),f._onAfterRenderObservable&&f._onAfterRenderObservable.clear(),f._onBetweenPassObservable&&f._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(f.meshMap)for(const y in f.meshMap){const g=f.meshMap[y];g&&(g._internalMeshDataInfo._source=null,f.meshMap[y]=void 0)}f._source&&f._source._internalMeshDataInfo.meshMap&&(f._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const y=this.va().meshes;for(const g of y){const y=g;y._internalMeshDataInfo&&y._internalMeshDataInfo._source&&y._internalMeshDataInfo._source===this&&(y._internalMeshDataInfo._source=null)}}f._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(y,g)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(y,g,f,p,k,i){let H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0;const l=this.va();return S.e.LoadImage(y,(y=>{const S=y.width,U=y.height,l=this.getEngine().createCanvas(S,U).getContext("2d");l.drawImage(y,0,0);const c=l.getImageData(0,0,S,U).data;this.applyDisplacementMapFromBuffer(c,S,U,g,f,k,i,H),p&&p(this)}),U||(()=>{}),l.offlineProvider),this}applyDisplacementMapFromBuffer(y,g,f,p,S,k,i){let H=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(C.c.PositionKind)||!this.isVerticesDataPresent(C.c.NormalKind)||!this.isVerticesDataPresent(C.c.UVKind))return T.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const U=this.getVerticesData(C.c.PositionKind,!0,!0),c=this.getVerticesData(C.c.NormalKind),Z=this.getVerticesData(C.c.UVKind);let W=l.m.Zero();const j=l.m.Zero(),P=l.l.Zero();k=k||l.l.Zero(),i=i||new l.l(1,1);for(let C=0;C<U.length;C+=3){l.m.FromArrayToRef(U,C,W),l.m.FromArrayToRef(c,C,j),l.l.FromArrayToRef(Z,C/3*2,P);const H=4*((Math.abs(P.x*i.x+k.x%1)*(g-1)%g|0)+(Math.abs(P.y*i.y+k.y%1)*(f-1)%f|0)*g),q=.3*(y[H]/255)+.59*(y[H+1]/255)+.11*(y[H+2]/255);j.normalize(),j.scaleInPlace(p+(S-p)*q),W=W.add(j),W.toArray(U,C)}return q.e.ComputeNormals(U,this.hg(),c),H?(this.Ga(C.c.PositionKind,U),this.Ga(C.c.NormalKind,c),this.Ga(C.c.UVKind,Z)):(this.updateVerticesData(C.c.PositionKind,U),this.updateVerticesData(C.c.NormalKind,c)),this}_getFlattenedNormals(y,g){const f=new Float32Array(3*y.length);let p=0;const S=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let k=0;k<y.length;k+=3){const i=l.m.eh(g,3*y[k]),H=l.m.eh(g,3*y[k+1]),U=l.m.eh(g,3*y[k+2]),c=i.ed(H),Z=U.ed(H),C=l.m.Normalize(l.m.Cross(c,Z));S&&C.scaleInPlace(-1);for(let y=0;y<3;y++)f[p++]=C.x,f[p++]=C.y,f[p++]=C.z}return f}_convertToUnIndexedMesh(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=this.getVerticesDataKinds().filter((y=>{var g;return!(null!==(g=this.getVertexBuffer(y))&&void 0!==g&&g.getIsInstanced())})),f=this.hg(),p={},S=(y,g)=>{const p=new Float32Array(f.length*g);let S=0;for(let k=0;k<f.length;k++)for(let i=0;i<g;i++)p[S++]=y[f[k]*g+i];return p},k=this.getBoundingInfo(),i=this.Hj?this.og.slice(0):[];for(const H of g)p[H]=this.getVerticesData(H);for(const H of g){const g=this.getVertexBuffer(H),k=g.getSize();if(y&&H===C.c.NormalKind){const y=this._getFlattenedNormals(f,p[C.c.PositionKind]);this.Ga(C.c.NormalKind,y,g.isUpdatable(),k)}else this.Ga(H,S(p[H],k),g.isUpdatable(),k)}if(this.morphTargetManager){for(let g=0;g<this.morphTargetManager.numTargets;g++){const p=this.morphTargetManager.getTarget(g),k=p.getPositions();p.setPositions(S(k,3));const i=p.getNormals();i&&p.setNormals(y?this._getFlattenedNormals(f,k):S(i,3));const H=p.getTangents();H&&p.setTangents(S(H,3));const U=p.getUVs();U&&p.setUVs(S(U,2))}this.morphTargetManager.synchronize()}for(let H=0;H<f.length;H++)f[H]=H;this.setIndices(f),this._unIndexed=!0,this.releaseSubMeshes();for(const H of i){const y=H.getBoundingInfo();P.b.AddToMesh(H.materialIndex,H.indexStart,H.indexCount,H.indexStart,H.indexCount,this).setBoundingInfo(y)}return this.setBoundingInfo(k),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g=q.e.ExtractFromMesh(this);let f;if(y&&this.isVerticesDataPresent(C.c.NormalKind)&&g.ya){for(f=0;f<g.ya.length;f++)g.ya[f]*=-1;this.Ga(C.c.NormalKind,g.ya,this.isVertexBufferUpdatable(C.c.NormalKind))}if(g.indices){let y;for(f=0;f<g.indices.length;f+=3)y=g.indices[f+1],g.indices[f+1]=g.indices[f+2],g.indices[f+2]=y;this.setIndices(g.indices,null,this.isVertexBufferUpdatable(C.c.PositionKind),!0)}return this}increaseVertices(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const g=q.e.ExtractFromMesh(this),f=g.indices&&!Array.isArray(g.indices)&&Array.from?Array.from(g.indices):g.indices,p=g.xa&&!Array.isArray(g.xa)&&Array.from?Array.from(g.xa):g.xa,S=g.Aa&&!Array.isArray(g.Aa)&&Array.from?Array.from(g.Aa):g.Aa,k=g.ya&&!Array.isArray(g.ya)&&Array.from?Array.from(g.ya):g.ya;if(f&&p){g.indices=f,g.xa=p,S&&(g.Aa=S),k&&(g.ya=k);const i=y+1,H=new Array;for(let y=0;y<i+1;y++)H[y]=new Array;let U,c;const Z=new l.m(0,0,0),q=new l.m(0,0,0),W=new l.l(0,0),j=new Array,P=new Array,B=new Array;let R,G,z,T=p.length;S&&(G=S.length),k&&(z=k.length);for(let y=0;y<f.length;y+=3){P[0]=f[y],P[1]=f[y+1],P[2]=f[y+2];for(let y=0;y<3;y++)if(U=P[y],c=P[(y+1)%3],void 0===B[U]&&void 0===B[c]?(B[U]=new Array,B[c]=new Array):(void 0===B[U]&&(B[U]=new Array),void 0===B[c]&&(B[c]=new Array)),void 0===B[U][c]&&void 0===B[c][U]){B[U][c]=[],Z.x=(p[3*c]-p[3*U])/i,Z.y=(p[3*c+1]-p[3*U+1])/i,Z.z=(p[3*c+2]-p[3*U+2])/i,k&&(q.x=(k[3*c]-k[3*U])/i,q.y=(k[3*c+1]-k[3*U+1])/i,q.z=(k[3*c+2]-k[3*U+2])/i),S&&(W.x=(S[2*c]-S[2*U])/i,W.y=(S[2*c+1]-S[2*U+1])/i),B[U][c].push(U);for(let y=1;y<i;y++)B[U][c].push(p.length/3),p[T++]=p[3*U]+y*Z.x,p[T++]=p[3*U+1]+y*Z.y,p[T++]=p[3*U+2]+y*Z.z,k&&(k[z++]=k[3*U]+y*q.x,k[z++]=k[3*U+1]+y*q.y,k[z++]=k[3*U+2]+y*q.z),S&&(S[G++]=S[2*U]+y*W.x,S[G++]=S[2*U+1]+y*W.y);B[U][c].push(c),B[c][U]=new Array,R=B[U][c].length;for(let y=0;y<R;y++)B[c][U][y]=B[U][c][R-1-y]}H[0][0]=f[y],H[1][0]=B[f[y]][f[y+1]][1],H[1][1]=B[f[y]][f[y+2]][1];for(let g=2;g<i;g++){H[g][0]=B[f[y]][f[y+1]][g],H[g][g]=B[f[y]][f[y+2]][g],Z.x=(p[3*H[g][g]]-p[3*H[g][0]])/g,Z.y=(p[3*H[g][g]+1]-p[3*H[g][0]+1])/g,Z.z=(p[3*H[g][g]+2]-p[3*H[g][0]+2])/g,k&&(q.x=(k[3*H[g][g]]-k[3*H[g][0]])/g,q.y=(k[3*H[g][g]+1]-k[3*H[g][0]+1])/g,q.z=(k[3*H[g][g]+2]-k[3*H[g][0]+2])/g),S&&(W.x=(S[2*H[g][g]]-S[2*H[g][0]])/g,W.y=(S[2*H[g][g]+1]-S[2*H[g][0]+1])/g);for(let y=1;y<g;y++)H[g][y]=p.length/3,p[T++]=p[3*H[g][0]]+y*Z.x,p[T++]=p[3*H[g][0]+1]+y*Z.y,p[T++]=p[3*H[g][0]+2]+y*Z.z,k&&(k[z++]=k[3*H[g][0]]+y*q.x,k[z++]=k[3*H[g][0]+1]+y*q.y,k[z++]=k[3*H[g][0]+2]+y*q.z),S&&(S[G++]=S[2*H[g][0]]+y*W.x,S[G++]=S[2*H[g][0]+1]+y*W.y)}H[i]=B[f[y+1]][f[y+2]],j.push(H[0][0],H[1][0],H[1][1]);for(let y=1;y<i;y++){let g;for(g=0;g<y;g++)j.push(H[y][g],H[y+1][g],H[y+1][g+1]),j.push(H[y][g],H[y+1][g+1],H[y][g+1]);j.push(H[y][g],H[y+1][g],H[y+1][g+1])}}g.indices=j,g.Ca(this,this.isVertexBufferUpdatable(C.c.PositionKind))}else T.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const y=q.e.ExtractFromMesh(this),g=y.Aa,f=y.indices,p=y.xa,S=y.za,k=y.matricesIndices,i=y.matricesWeights,H=y.matricesIndicesExtra,U=y.matricesWeightsExtra;if(void 0===f||void 0===p||null===f||null===p)T.d.Warn("VertexData contains empty entries");else{const l=new Array,c=new Array,Z=new Array,W=new Array,j=new Array,P=new Array,B=new Array,R=new Array;let G=new Array,z=0;const T={};let Q,m;for(let y=0;y<f.length;y+=3){m=[f[y],f[y+1],f[y+2]],G=[];for(let y=0;y<3;y++){G[y]="";for(let g=0;g<3;g++)Math.abs(p[3*m[y]+g])<1e-8&&(p[3*m[y]+g]=0),G[y]+=p[3*m[y]+g]+"|"}if(G[0]!=G[1]&&G[0]!=G[2]&&G[1]!=G[2])for(let y=0;y<3;y++){if(Q=T[G[y]],void 0===Q){T[G[y]]=z,Q=z++;for(let g=0;g<3;g++)l.push(p[3*m[y]+g]);if(null!==S&&void 0!==S)for(let g=0;g<4;g++)W.push(S[4*m[y]+g]);if(null!==g&&void 0!==g)for(let f=0;f<2;f++)Z.push(g[2*m[y]+f]);if(null!==k&&void 0!==k)for(let g=0;g<4;g++)j.push(k[4*m[y]+g]);if(null!==i&&void 0!==i)for(let g=0;g<4;g++)P.push(i[4*m[y]+g]);if(null!==H&&void 0!==H)for(let g=0;g<4;g++)B.push(H[4*m[y]+g]);if(null!==U&&void 0!==U)for(let g=0;g<4;g++)R.push(U[4*m[y]+g])}c.push(Q)}}const a=new Array;q.e.ComputeNormals(l,c,a),y.xa=l,y.indices=c,y.ya=a,null!==g&&void 0!==g&&(y.Aa=Z),null!==S&&void 0!==S&&(y.za=W),null!==k&&void 0!==k&&(y.matricesIndices=j),null!==i&&void 0!==i&&(y.matricesWeights=P),null!==H&&void 0!==H&&(y.matricesIndicesExtra=B),null!==i&&void 0!==i&&(y.matricesWeightsExtra=R),y.Ca(this,this.isVertexBufferUpdatable(C.c.PositionKind))}}static _instancedMeshFactory(y,g){throw(0,m.b)("InstancedMesh")}static _PhysicsImpostorParser(y,g,f){throw(0,m.b)("PhysicsImpostor")}createInstance(y){const g=r._instancedMeshFactory(y,this);return g.parent=this.parent,g}synchronizeInstances(){for(let y=0;y<this.instances.length;y++){this.instances[y]._syncSubMeshes()}return this}optimizeIndices(y){const g=this.hg(),f=this.getVerticesData(C.c.PositionKind);if(!f||!g)return this;const p=[];for(let S=0;S<f.length;S+=3)p.push(l.m.eh(f,S));const k=[];return S.d.SyncAsyncForLoop(p.length,40,(y=>{const g=p.length-1-y,f=p[g];for(let S=0;S<g;++S){const y=p[S];if(f.equals(y)){k[g]=S;break}}}),(()=>{for(let y=0;y<g.length;++y)g[y]=k[g[y]]||g[y];const f=this.og.slice(0);this.setIndices(g),this.og=f,y&&y(this)})),this}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y.name=this.name,y.id=this.id,y.uniqueId=this.uniqueId,y.type=this.getClassName(),i.e&&i.e.HasTags(this)&&(y.tags=i.e.GetTags(this)),y.position=this.position.mj(),this.rotationQuaternion?y.rotationQuaternion=this.rotationQuaternion.mj():this.rotation&&(y.rotation=this.rotation.mj()),y.pe=this.pe.mj(),this._postMultiplyPivotMatrix?y.pivotMatrix=this.getPivotMatrix().mj():y.localMatrix=this.getPivotMatrix().mj(),y.isEnabled=this.isEnabled(!1),y.isVisible=this.isVisible,y.infiniteDistance=this.infiniteDistance,y.pickable=this.Lb,y.receiveShadows=this.receiveShadows,y.billboardMode=this.billboardMode,y.visibility=this.visibility,y.wb=this.wb,y.checkCollisions=this.checkCollisions,y.ellipsoid=this.ellipsoid.mj(),y.ellipsoidOffset=this.ellipsoidOffset.mj(),y.Da=this.Da,y.isBlocker=this.isBlocker,y.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(y),y.isUnIndexed=this.isUnIndexed;const g=this._geometry;if(g&&this.og){y.geometryUniqueId=g.uniqueId,y.geometryId=g.id,y.og=[];for(let g=0;g<this.og.length;g++){const f=this.og[g];y.og.push({materialIndex:f.materialIndex,verticesStart:f.verticesStart,verticesCount:f.verticesCount,indexStart:f.indexStart,indexCount:f.indexCount})}}if(this.material?this.material.doNotSerialize||(y.materialUniqueId=this.material.uniqueId,y.materialId=this.material.id):(this.material=null,y.materialUniqueId=this._scene.defaultMaterial.uniqueId,y.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(y.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(y.skeletonId=this.skeleton.id,y.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(a.e.NAME_PHYSICSENGINE)){const g=this.getPhysicsImpostor();g&&(y.physicsMass=g.getParam("mass"),y.physicsFriction=g.getParam("friction"),y.physicsRestitution=g.getParam("mass"),y.physicsImpostor=g.type)}this.metadata&&(y.metadata=this.metadata),y.instances=[];for(let f=0;f<this.instances.length;f++){const g=this.instances[f];if(g.doNotSerialize)continue;const p={name:g.name,id:g.id,isEnabled:g.isEnabled(!1),isVisible:g.isVisible,Lb:g.Lb,checkCollisions:g.checkCollisions,position:g.position.mj(),pe:g.pe.mj()};if(g.parent&&g.parent._serializeAsParent(p),g.rotationQuaternion?p.rotationQuaternion=g.rotationQuaternion.mj():g.rotation&&(p.rotation=g.rotation.mj()),this.va()._getComponent(a.e.NAME_PHYSICSENGINE)){const y=g.getPhysicsImpostor();y&&(p.physicsMass=y.getParam("mass"),p.physicsFriction=y.getParam("friction"),p.physicsRestitution=y.getParam("mass"),p.physicsImpostor=y.type)}g.metadata&&(p.metadata=g.metadata),g.actionManager&&(p.actions=g.actionManager.serialize(g.name)),y.instances.push(p),z.c.AppendSerializedAnimations(g,p),p.ranges=g.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(y.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const g={data:{},sizes:{},strides:{}};for(const y in this._userThinInstanceBuffersStorage.data)g.data[y]=Array.from(this._userThinInstanceBuffersStorage.data[y]),g.sizes[y]=this._userThinInstanceBuffersStorage.sizes[y],g.strides[y]=this._userThinInstanceBuffersStorage.strides[y];y.thinInstances.userThinInstance=g}return z.c.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y.layerMask=this.layerMask,y.alphaIndex=this.alphaIndex,y.hasVertexAlpha=this.hasVertexAlpha,y.overlayAlpha=this.overlayAlpha,y.overlayColor=this.overlayColor.mj(),y.renderOverlay=this.renderOverlay,y.applyFog=this.applyFog,this.actionManager&&(y.actions=this.actionManager.serialize(this.name)),y}_syncGeometryWithMorphTargetManager(){if(!this.Hj)return;this._markSubMeshesAsAttributesDirty();const y=this._internalAbstractMeshDataInfo._morphTargetManager;if(y&&y.vertexCount){if(y.vertexCount!==this.getTotalVertices())return T.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(y.isUsingTextureForTargets)return;for(let g=0;g<y.numInfluencers;g++){const f=y.getActiveTarget(g),p=f.getPositions();if(!p)return void T.d.Error("Invalid morph target. Target must have positions.");this.Hj.Ga(C.c.PositionKind+g,p,!1,3);const S=f.getNormals();S&&this.Hj.Ga(C.c.NormalKind+g,S,!1,3);const k=f.getTangents();k&&this.Hj.Ga(C.c.TangentKind+g,k,!1,3);const i=f.getUVs();i&&this.Hj.Ga(C.c.UVKind+"_"+g,i,!1,2)}}else{let y=0;for(;this.Hj.isVerticesDataPresent(C.c.PositionKind+y);)this.Hj.removeVerticesData(C.c.PositionKind+y),this.Hj.isVerticesDataPresent(C.c.NormalKind+y)&&this.Hj.removeVerticesData(C.c.NormalKind+y),this.Hj.isVerticesDataPresent(C.c.TangentKind+y)&&this.Hj.removeVerticesData(C.c.TangentKind+y),this.Hj.isVerticesDataPresent(C.c.UVKind+y)&&this.Hj.removeVerticesData(C.c.UVKind+"_"+y),y++}}static Parse(y,g,f){let p;if(p=y.type&&"LinesMesh"===y.type?r._LinesMeshParser(y,g):y.type&&"GroundMesh"===y.type?r._GroundMeshParser(y,g):y.type&&"GoldbergMesh"===y.type?r._GoldbergMeshParser(y,g):y.type&&"GreasedLineMesh"===y.type?r._GreasedLineMeshParser(y,g):y.type&&"TrailMesh"===y.type?r._TrailMeshParser(y,g):new r(y.name,g),p.id=y.id,p._waitingParsedUniqueId=y.uniqueId,i.e&&i.e.AddTagsTo(p,y.tags),p.position=l.m.eh(y.position),void 0!==y.metadata&&(p.metadata=y.metadata),y.rotationQuaternion?p.rotationQuaternion=l.g.eh(y.rotationQuaternion):y.rotation&&(p.rotation=l.m.eh(y.rotation)),p.pe=l.m.eh(y.pe),y.localMatrix?p.setPreTransformMatrix(l.c.eh(y.localMatrix)):y.pivotMatrix&&p.setPivotMatrix(l.c.eh(y.pivotMatrix)),p.Mb(y.isEnabled),p.isVisible=y.isVisible,p.infiniteDistance=y.infiniteDistance,p.wb=!!y.wb,p.showBoundingBox=y.showBoundingBox,p.showSubMeshesBoundingBox=y.showSubMeshesBoundingBox,void 0!==y.applyFog&&(p.applyFog=y.applyFog),void 0!==y.pickable&&(p.Lb=y.pickable),void 0!==y.alphaIndex&&(p.alphaIndex=y.alphaIndex),p.receiveShadows=y.receiveShadows,void 0!==y.billboardMode&&(p.billboardMode=y.billboardMode),void 0!==y.visibility&&(p.visibility=y.visibility),p.checkCollisions=y.checkCollisions,p.Da=!!y.Da,y.ellipsoid&&(p.ellipsoid=l.m.eh(y.ellipsoid)),y.ellipsoidOffset&&(p.ellipsoidOffset=l.m.eh(y.ellipsoidOffset)),null!=y.overrideMaterialSideOrientation&&(p.sideOrientation=y.overrideMaterialSideOrientation),void 0!==y.sideOrientation&&(p.sideOrientation=y.sideOrientation),void 0!==y.isBlocker&&(p.isBlocker=y.isBlocker),p._shouldGenerateFlatShading=y.useFlatShading,y._b&&(p._waitingData._b=y._b),void 0!==y.parentId&&(p._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(p._waitingParentInstanceIndex=y.parentInstanceIndex),void 0!==y.actions&&(p._waitingData.actions=y.actions),void 0!==y.overlayAlpha&&(p.overlayAlpha=y.overlayAlpha),void 0!==y.overlayColor&&(p.overlayColor=c.c.eh(y.overlayColor)),void 0!==y.renderOverlay&&(p.renderOverlay=y.renderOverlay),p.isUnIndexed=!!y.isUnIndexed,p.hasVertexAlpha=y.hasVertexAlpha,y.delayLoadingFile?(p.delayLoadState=4,p.delayLoadingFile=f+y.delayLoadingFile,p.buildBoundingInfo(l.m.eh(y.boundingBoxMinimum),l.m.eh(y.boundingBoxMaximum)),y._binaryInfo&&(p._binaryInfo=y._binaryInfo),p._delayInfo=[],y.hasUVs&&p._delayInfo.push(C.c.UVKind),y.hasUVs2&&p._delayInfo.push(C.c.UV2Kind),y.hasUVs3&&p._delayInfo.push(C.c.UV3Kind),y.hasUVs4&&p._delayInfo.push(C.c.UV4Kind),y.hasUVs5&&p._delayInfo.push(C.c.UV5Kind),y.hasUVs6&&p._delayInfo.push(C.c.UV6Kind),y.hasColors&&p._delayInfo.push(C.c.ColorKind),y.hasMatricesIndices&&p._delayInfo.push(C.c.MatricesIndicesKind),y.hasMatricesWeights&&p._delayInfo.push(C.c.MatricesWeightsKind),p._delayLoadingFunction=W.d._ImportGeometry,G.b.ForceFullSceneLoadingForIncremental&&p._checkDelayState()):W.d._ImportGeometry(y,p),y.materialUniqueId?p._waitingMaterialId=y.materialUniqueId:y.materialId&&(p._waitingMaterialId=y.materialId),y.morphTargetManagerId>-1&&(p._waitingMorphTargetManagerId=y.morphTargetManagerId),void 0!==y.skeletonId&&null!==y.skeletonId&&(p.skeleton=g.getLastSkeletonById(y.skeletonId),y.numBoneInfluencers&&(p.numBoneInfluencers=y.numBoneInfluencers)),y.animations){for(let g=0;g<y.animations.length;g++){const f=y.animations[g],S=(0,Q.b)("BABYLON.Animation");S&&p.animations.push(S.Parse(f))}Z.d.ParseAnimationRanges(p,y,g)}if(y.autoAnimate&&g.beginAnimation(p,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),y.layerMask&&!isNaN(y.layerMask)?p.layerMask=Math.abs(parseInt(y.layerMask)):p.layerMask=268435455,y.physicsImpostor&&(p.physicsImpostor=r._PhysicsImpostorParser(g,p,y)),y.lodMeshIds&&(p._waitingData.lods={ids:y.lodMeshIds,distances:y.lodDistances?y.lodDistances:null,coverages:y.lodCoverages?y.lodCoverages:null}),y.instances)for(let S=0;S<y.instances.length;S++){const f=y.instances[S],k=p.createInstance(f.name);if(f.id&&(k.id=f.id),i.e&&(f.tags?i.e.AddTagsTo(k,f.tags):i.e.AddTagsTo(k,y.tags)),k.position=l.m.eh(f.position),void 0!==f.metadata&&(k.metadata=f.metadata),void 0!==f.parentId&&(k._waitingParentId=f.parentId),void 0!==f.parentInstanceIndex&&(k._waitingParentInstanceIndex=f.parentInstanceIndex),void 0!==f.isEnabled&&null!==f.isEnabled&&k.Mb(f.isEnabled),void 0!==f.isVisible&&null!==f.isVisible&&(k.isVisible=f.isVisible),void 0!==f.Lb&&null!==f.Lb&&(k.Lb=f.Lb),f.rotationQuaternion?k.rotationQuaternion=l.g.eh(f.rotationQuaternion):f.rotation&&(k.rotation=l.m.eh(f.rotation)),k.pe=l.m.eh(f.pe),void 0!=f.checkCollisions&&null!=f.checkCollisions&&(k.checkCollisions=f.checkCollisions),void 0!=f.pickable&&null!=f.pickable&&(k.Lb=f.pickable),void 0!=f.showBoundingBox&&null!=f.showBoundingBox&&(k.showBoundingBox=f.showBoundingBox),void 0!=f.showSubMeshesBoundingBox&&null!=f.showSubMeshesBoundingBox&&(k.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),void 0!=f.alphaIndex&&null!=f.showSubMeshesBoundingBox&&(k.alphaIndex=f.alphaIndex),f.physicsImpostor&&(k.physicsImpostor=r._PhysicsImpostorParser(g,k,f)),void 0!==f.actions&&(k._waitingData.actions=f.actions),f.animations){for(let y=0;y<f.animations.length;y++){const g=f.animations[y],p=(0,Q.b)("BABYLON.Animation");p&&k.animations.push(p.Parse(g))}Z.d.ParseAnimationRanges(k,f,g),f.autoAnimate&&g.beginAnimation(k,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}if(y.thinInstances){const g=y.thinInstances;if(p.thinInstanceEnablePicking=!!g.enablePicking,g.matrixData?(p.Pb("matrix",new Float32Array(g.matrixData),16,!1),p._thinInstanceDataStorage.matrixBufferSize=g.matrixBufferSize,p._thinInstanceDataStorage.instancesCount=g.instancesCount):p._thinInstanceDataStorage.matrixBufferSize=g.matrixBufferSize,y.thinInstances.userThinInstance){const g=y.thinInstances.userThinInstance;for(const y in g.data)p.Pb(y,new Float32Array(g.data[y]),g.strides[y],!1),p._userThinInstanceBuffersStorage.sizes[y]=g.sizes[y]}}return p}setPositionsForCPUSkinning(){const y=this._internalMeshDataInfo;if(!y._sourcePositions){const g=this.getVerticesData(C.c.PositionKind);if(!g)return y._sourcePositions;y._sourcePositions=new Float32Array(g),this.isVertexBufferUpdatable(C.c.PositionKind)||this.Ga(C.c.PositionKind,g,!0)}return y._sourcePositions}setNormalsForCPUSkinning(){const y=this._internalMeshDataInfo;if(!y._sourceNormals){const g=this.getVerticesData(C.c.NormalKind);if(!g)return y._sourceNormals;y._sourceNormals=new Float32Array(g),this.isVertexBufferUpdatable(C.c.NormalKind)||this.Ga(C.c.NormalKind,g,!0)}return y._sourceNormals}applySkeleton(y){if(!this.Hj)return this;if(this.Hj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Hj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(C.c.PositionKind))return this;if(!this.isVerticesDataPresent(C.c.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(C.c.MatricesWeightsKind))return this;const g=this.isVerticesDataPresent(C.c.NormalKind),f=this._internalMeshDataInfo;if(!f._sourcePositions){const y=this.og.slice();this.setPositionsForCPUSkinning(),this.og=y}g&&!f._sourceNormals&&this.setNormalsForCPUSkinning();let p=this.getVerticesData(C.c.PositionKind);if(!p)return this;p instanceof Float32Array||(p=new Float32Array(p));let S=this.getVerticesData(C.c.NormalKind);if(g){if(!S)return this;S instanceof Float32Array||(S=new Float32Array(S))}const k=this.getVerticesData(C.c.MatricesIndicesKind),i=this.getVerticesData(C.c.MatricesWeightsKind);if(!i||!k)return this;const H=this.numBoneInfluencers>4,U=H?this.getVerticesData(C.c.MatricesIndicesExtraKind):null,c=H?this.getVerticesData(C.c.MatricesWeightsExtraKind):null,Z=y.getTransformMatrices(this),q=l.m.Zero(),W=new l.c,j=new l.c;let P,B=0;for(let C=0;C<p.length;C+=3,B+=4){let y;for(P=0;P<4;P++)y=i[B+P],y>0&&(l.c.FromFloat32ArrayToRefScaled(Z,Math.floor(16*k[B+P]),y,j),W.addToSelf(j));if(H)for(P=0;P<4;P++)y=c[B+P],y>0&&(l.c.FromFloat32ArrayToRefScaled(Z,Math.floor(16*U[B+P]),y,j),W.addToSelf(j));l.m.TransformCoordinatesFromFloatsToRef(f._sourcePositions[C],f._sourcePositions[C+1],f._sourcePositions[C+2],W,q),q.toArray(p,C),g&&(l.m.TransformNormalFromFloatsToRef(f._sourceNormals[C],f._sourceNormals[C+1],f._sourceNormals[C+2],W,q),q.toArray(S,C)),W.reset()}return this.updateVerticesData(C.c.PositionKind,p),g&&this.updateVerticesData(C.c.NormalKind,S),this}static MinMax(y){let g=null,f=null;return y.forEach((function(y){const p=y.getBoundingInfo().boundingBox;g&&f?(g.minimizeInPlace(p.minimumWorld),f.maximizeInPlace(p.maximumWorld)):(g=p.minimumWorld,f=p.maximumWorld)})),g&&f?{min:g,max:f}:{min:l.m.Zero(),max:l.m.Zero()}}static Center(y){const g=y instanceof Array?r.MinMax(y):y;return l.m.Center(g.min,g.max)}static MergeMeshes(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;return(0,H.m)(r._MergeMeshesCoroutine(y,g,f,p,S,k,!1))}static MergeMeshesAsync(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;return(0,H.i)(r._MergeMeshesCoroutine(y,g,f,p,S,k,!0),(0,H.d)())}static*_MergeMeshesCoroutine(y){let g,f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0;if(0===(y=y.filter(Boolean)).length)return null;if(!p){let f=0;for(g=0;g<y.length;g++)if(f+=y[g].getTotalVertices(),f>=65536)return T.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}i&&(k=!1);const U=new Array,l=new Array,c=new Array,Z=y[0].sideOrientation;for(g=0;g<y.length;g++){const f=y[g];if(f.isAnInstance)return T.d.Warn("Cannot merge instance meshes."),null;if(Z!==f.sideOrientation)return T.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(k&&c.push(f.getTotalIndices()),i)if(f.material){const y=f.material;if(y instanceof R.b){for(let g=0;g<y.qg.length;g++)U.indexOf(y.qg[g])<0&&U.push(y.qg[g]);for(let g=0;g<f.og.length;g++)l.push(U.indexOf(y.qg[f.og[g].materialIndex])),c.push(f.og[g].indexCount)}else{U.indexOf(y)<0&&U.push(y);for(let g=0;g<f.og.length;g++)l.push(U.indexOf(y)),c.push(f.og[g].indexCount)}}else for(let y=0;y<f.og.length;y++)l.push(0),c.push(f.og[y].indexCount)}const C=y[0],W=y=>{const g=y.Sj(!0);return{vertexData:q.e.ExtractFromMesh(y,!1,!1),transform:g}},{vertexData:j,transform:B}=W(C);H&&(yield);const G=new Array(y.length-1);for(let q=1;q<y.length;q++)G[q-1]=W(y[q]),H&&(yield);const z=j._mergeCoroutine(B,G,p,H,!f);let Q=z.next();for(;!Q.done;)H&&(yield),Q=z.next();const m=Q.value;S||(S=new r(C.name+"_merged",C.va()));const a=m._applyToCoroutine(S,void 0,H);let w=a.next();for(;!w.done;)H&&(yield),w=a.next();if(S.checkCollisions=C.checkCollisions,S.sideOrientation=C.sideOrientation,f)for(g=0;g<y.length;g++)y[g].dispose();if(k||i){S.releaseSubMeshes(),g=0;let y=0;for(;g<c.length;)P.b.CreateFromIndices(0,y,c[g],S,void 0,!1),y+=c[g],g++;for(const g of S.og)g.refreshBoundingInfo();S.Sj(!0)}if(i){const y=new R.b(C.name+"_merged",C.va());y.qg=U;for(let g=0;g<S.og.length;g++)S.og[g].materialIndex=l[g];S.material=y}else S.material=C.material;return S}Kj(y){y._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(y)}Jj(y){const g=y._indexInSourceMeshInstanceArray;if(-1!=g){if(g!==this.instances.length-1){const y=this.instances[this.instances.length-1];this.instances[g]=y,y._indexInSourceMeshInstanceArray=g}y._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===B.c.CounterClockWiseSideOrientation}_getRenderingFillMode(y){const g=this.va();return g.forcePointsCloud?B.c.PointFillMode:g.forceWireframe?B.c.WireFrameFillMode:this.overrideRenderingFillMode??y}setMaterialByID(y){return this.setMaterialById(y)}static CreateRibbon(y,g,f,p,S,k,i,H,U){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(y,g,f,p,S,k){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(y,g,f,p,S){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(y,g,f,p,S,k){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(y,g,f,p){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(y,g,f,p,S,k,i,H,U){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(y,g,f,p,S,k,i){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(y,g,f,p,S,k,i,H,U,l){throw new Error("Import MeshBuilder to populate this function")}static pb(y,g,f,p,S){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(y,g,f,p,S,k,i,H){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(y,g,f,p,S,k,i){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(y,g,f,p,S,k,i,H){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(y,g,f,p,S,k,i,H,U,l){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(y,g,f,p,S,k,i,H,U,l,c,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(y,g,f,p,S,k,i){throw new Error("Import MeshBuilder to populate this function")}static rg(y,g,f,p,S){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(y,g,f,p,S,k){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(y,g,f,p,S,k,i,H,U){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(y,g,f,p,S,k,i,H,U,l,c){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(y,g,f,p,S,k,i,H,U,l){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(y,g,f){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(y,g,f){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(y,g,f,p,S,k){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(y,g,f){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(y){throw new Error("Import MeshBuilder to populate this function")}}r.FRONTSIDE=q.e.FRONTSIDE,r.BACKSIDE=q.e.BACKSIDE,r.DOUBLESIDE=q.e.DOUBLESIDE,r.DEFAULTSIDE=q.e.DEFAULTSIDE,r.NO_CAP=0,r.CAP_START=1,r.CAP_END=2,r.CAP_ALL=3,r.NO_FLIP=0,r.FLIP_TILE=1,r.ROTATE_TILE=2,r.FLIP_ROW=3,r.ROTATE_ROW=4,r.FLIP_N_ROTATE_TILE=5,r.FLIP_N_ROTATE_ROW=6,r.CENTER=0,r.LEFT=1,r.RIGHT=2,r.TOP=3,r.BOTTOM=4,r.INSTANCEDMESH_SORT_TRANSPARENT=!1,r._GroundMeshParser=(y,g)=>{throw(0,m.b)("GroundMesh")},r._GoldbergMeshParser=(y,g)=>{throw(0,m.b)("GoldbergMesh")},r._LinesMeshParser=(y,g)=>{throw(0,m.b)("LinesMesh")},r._GreasedLineMeshParser=(y,g)=>{throw(0,m.b)("GreasedLineMesh")},r._GreasedLineRibbonMeshParser=(y,g)=>{throw(0,m.b)("GreasedLineRibbonMesh")},r._TrailMeshParser=(y,g)=>{throw(0,m.b)("TrailMesh")},(0,Q.c)("BABYLON.Mesh",r)},11349:(y,g,f)=>{"use strict";f.d(g,{e:()=>W});var p=f(11021),S=f(11054),k=f(11131),i=f(10755),H=f(11090),U=f(10736),l=f(11026),c=f(11325),Z=f(10775),C=f(11209);class q{}class W{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,c.e)(this._applyToCoroutine.bind(this)),this.uniqueId=W._UniqueIDGenerator,W._UniqueIDGenerator++}set(y,g){switch(y.length||U.d.Warn(`Setting vertex data kind '${g}' with an empty array`),g){case k.c.PositionKind:this.xa=y;break;case k.c.NormalKind:this.ya=y;break;case k.c.TangentKind:this.tangents=y;break;case k.c.UVKind:this.Aa=y;break;case k.c.UV2Kind:this.uvs2=y;break;case k.c.UV3Kind:this.uvs3=y;break;case k.c.UV4Kind:this.uvs4=y;break;case k.c.UV5Kind:this.uvs5=y;break;case k.c.UV6Kind:this.uvs6=y;break;case k.c.ColorKind:this.za=y;break;case k.c.MatricesIndicesKind:this.matricesIndices=y;break;case k.c.MatricesWeightsKind:this.matricesWeights=y;break;case k.c.MatricesIndicesExtraKind:this.matricesIndicesExtra=y;break;case k.c.MatricesWeightsExtraKind:this.matricesWeightsExtra=y}}Ca(y,g){return this._applyTo(y,g,!1),this}applyToGeometry(y,g){return this._applyTo(y,g,!1),this}updateMesh(y){return this._update(y),this}updateGeometry(y){return this._update(y),this}*_applyToCoroutine(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0;if(this.xa&&(y.Ga(k.c.PositionKind,this.xa,g),f&&(yield)),this.ya&&(y.Ga(k.c.NormalKind,this.ya,g),f&&(yield)),this.tangents&&(y.Ga(k.c.TangentKind,this.tangents,g),f&&(yield)),this.Aa&&(y.Ga(k.c.UVKind,this.Aa,g),f&&(yield)),this.uvs2&&(y.Ga(k.c.UV2Kind,this.uvs2,g),f&&(yield)),this.uvs3&&(y.Ga(k.c.UV3Kind,this.uvs3,g),f&&(yield)),this.uvs4&&(y.Ga(k.c.UV4Kind,this.uvs4,g),f&&(yield)),this.uvs5&&(y.Ga(k.c.UV5Kind,this.uvs5,g),f&&(yield)),this.uvs6&&(y.Ga(k.c.UV6Kind,this.uvs6,g),f&&(yield)),this.za&&(y.Ga(k.c.ColorKind,this.za,g),this.hasVertexAlpha&&void 0!==y.hasVertexAlpha&&(y.hasVertexAlpha=!0),f&&(yield)),this.matricesIndices&&(y.Ga(k.c.MatricesIndicesKind,this.matricesIndices,g),f&&(yield)),this.matricesWeights&&(y.Ga(k.c.MatricesWeightsKind,this.matricesWeights,g),f&&(yield)),this.matricesIndicesExtra&&(y.Ga(k.c.MatricesIndicesExtraKind,this.matricesIndicesExtra,g),f&&(yield)),this.matricesWeightsExtra&&(y.Ga(k.c.MatricesWeightsExtraKind,this.matricesWeightsExtra,g),f&&(yield)),this.indices?(y.setIndices(this.indices,null,g),f&&(yield)):y.setIndices([],null),y.og&&this.materialInfos&&this.materialInfos.length>1){const g=y;g.og=[];for(const y of this.materialInfos)new C.b(y.materialIndex,y.verticesStart,y.verticesCount,y.indexStart,y.indexCount,g)}return this}_update(y,g,f){return this.xa&&y.updateVerticesData(k.c.PositionKind,this.xa,g,f),this.ya&&y.updateVerticesData(k.c.NormalKind,this.ya,g,f),this.tangents&&y.updateVerticesData(k.c.TangentKind,this.tangents,g,f),this.Aa&&y.updateVerticesData(k.c.UVKind,this.Aa,g,f),this.uvs2&&y.updateVerticesData(k.c.UV2Kind,this.uvs2,g,f),this.uvs3&&y.updateVerticesData(k.c.UV3Kind,this.uvs3,g,f),this.uvs4&&y.updateVerticesData(k.c.UV4Kind,this.uvs4,g,f),this.uvs5&&y.updateVerticesData(k.c.UV5Kind,this.uvs5,g,f),this.uvs6&&y.updateVerticesData(k.c.UV6Kind,this.uvs6,g,f),this.za&&y.updateVerticesData(k.c.ColorKind,this.za,g,f),this.matricesIndices&&y.updateVerticesData(k.c.MatricesIndicesKind,this.matricesIndices,g,f),this.matricesWeights&&y.updateVerticesData(k.c.MatricesWeightsKind,this.matricesWeights,g,f),this.matricesIndicesExtra&&y.updateVerticesData(k.c.MatricesIndicesExtraKind,this.matricesIndicesExtra,g,f),this.matricesWeightsExtra&&y.updateVerticesData(k.c.MatricesWeightsExtraKind,this.matricesWeightsExtra,g,f),this.indices&&y.setIndices(this.indices,null),this}static _TransformVector3Coordinates(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.length;const k=S.j.o[0],i=S.j.o[1];for(let H=f;H<f+p;H+=3)S.m.FromArrayToRef(y,H,k),S.m.TransformCoordinatesToRef(k,g,i),y[H]=i.x,y[H+1]=i.y,y[H+2]=i.z}static _TransformVector3Normals(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.length;const k=S.j.o[0],i=S.j.o[1];for(let H=f;H<f+p;H+=3)S.m.FromArrayToRef(y,H,k),S.m.TransformNormalToRef(k,g,i),y[H]=i.x,y[H+1]=i.y,y[H+2]=i.z}static _TransformVector4Normals(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.length;const k=S.j.Vector4[0],i=S.j.Vector4[1];for(let H=f;H<f+p;H+=4)S.o.FromArrayToRef(y,H,k),S.o.TransformNormalToRef(k,g,i),y[H]=i.x,y[H+1]=i.y,y[H+2]=i.z,y[H+3]=i.w}static _FlipFaces(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.length;for(let p=g;p<g+f;p+=3){const g=y[p+1];y[p+1]=y[p+2],y[p+2]=g}}transform(y){const g=y.determinant()<0;return this.xa&&W._TransformVector3Coordinates(this.xa,y),this.ya&&W._TransformVector3Normals(this.ya,y),this.tangents&&W._TransformVector4Normals(this.tangents,y),g&&this.indices&&W._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const y=[];for(const g of this.materialInfos){const f=new W;if(this.xa&&(f.xa=this.xa.slice(3*g.verticesStart,3*(g.verticesCount+g.verticesStart))),this.ya&&(f.ya=this.ya.slice(3*g.verticesStart,3*(g.verticesCount+g.verticesStart))),this.tangents&&(f.tangents=this.tangents.slice(4*g.verticesStart,4*(g.verticesCount+g.verticesStart))),this.za&&(f.za=this.za.slice(4*g.verticesStart,4*(g.verticesCount+g.verticesStart))),this.Aa&&(f.Aa=this.Aa.slice(2*g.verticesStart,2*(g.verticesCount+g.verticesStart))),this.uvs2&&(f.uvs2=this.uvs2.slice(2*g.verticesStart,2*(g.verticesCount+g.verticesStart))),this.uvs3&&(f.uvs3=this.uvs3.slice(2*g.verticesStart,2*(g.verticesCount+g.verticesStart))),this.uvs4&&(f.uvs4=this.uvs4.slice(2*g.verticesStart,2*(g.verticesCount+g.verticesStart))),this.uvs5&&(f.uvs5=this.uvs5.slice(2*g.verticesStart,2*(g.verticesCount+g.verticesStart))),this.uvs6&&(f.uvs6=this.uvs6.slice(2*g.verticesStart,2*(g.verticesCount+g.verticesStart))),this.matricesIndices&&(f.matricesIndices=this.matricesIndices.slice(4*g.verticesStart,4*(g.verticesCount+g.verticesStart))),this.matricesIndicesExtra&&(f.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*g.verticesStart,4*(g.verticesCount+g.verticesStart))),this.matricesWeights&&(f.matricesWeights=this.matricesWeights.slice(4*g.verticesStart,4*(g.verticesCount+g.verticesStart))),this.matricesWeightsExtra&&(f.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*g.verticesStart,4*(g.verticesCount+g.verticesStart))),this.indices){f.indices=[];for(let y=g.indexStart;y<g.indexStart+g.indexCount;y++)f.indices.push(this.indices[y]-g.verticesStart)}const p=new q;p.indexStart=0,p.indexCount=f.indices?f.indices.length:0,p.materialIndex=g.materialIndex,p.verticesStart=0,p.verticesCount=(f.xa?f.xa.length:0)/3,f.materialInfos=[p],y.push(f)}return y}merge(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const k=Array.isArray(y)?y.map((y=>({vertexData:y}))):[{vertexData:y}];return(0,c.m)(this._mergeCoroutine(void 0,k,g,!1,f,p,S))}*_mergeCoroutine(y,g){var f,p;let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let c=g.map((y=>y.vertexData)),Z=this;if(l)for(const k of c)k&&(k._validate(),!this.ya&&k.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&k.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&k.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&k.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&k.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&k.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&k.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&k.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&k.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&k.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&k.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&k.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&k.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const k of c)if(k)if(l)this.ya&&!k.ya&&(k.ya=new Float32Array(k.xa.length)),this.tangents&&!k.tangents&&(k.tangents=new Float32Array(k.xa.length/3*4)),this.Aa&&!k.Aa&&(k.Aa=new Float32Array(k.xa.length/3*2)),this.uvs2&&!k.uvs2&&(k.uvs2=new Float32Array(k.xa.length/3*2)),this.uvs3&&!k.uvs3&&(k.uvs3=new Float32Array(k.xa.length/3*2)),this.uvs4&&!k.uvs4&&(k.uvs4=new Float32Array(k.xa.length/3*2)),this.uvs5&&!k.uvs5&&(k.uvs5=new Float32Array(k.xa.length/3*2)),this.uvs6&&!k.uvs6&&(k.uvs6=new Float32Array(k.xa.length/3*2)),this.za&&!k.za&&(k.za=new Float32Array(k.xa.length/3*4),k.za.fill(1)),this.matricesIndices&&!k.matricesIndices&&(k.matricesIndices=new Float32Array(k.xa.length/3*4)),this.matricesWeights&&!k.matricesWeights&&(k.matricesWeights=new Float32Array(k.xa.length/3*4)),this.matricesIndicesExtra&&!k.matricesIndicesExtra&&(k.matricesIndicesExtra=new Float32Array(k.xa.length/3*4)),this.matricesWeightsExtra&&!k.matricesWeightsExtra&&(k.matricesWeightsExtra=new Float32Array(k.xa.length/3*4));else if(k._validate(),!this.ya!==!k.ya||!this.tangents!==!k.tangents||!this.Aa!==!k.Aa||!this.uvs2!==!k.uvs2||!this.uvs3!==!k.uvs3||!this.uvs4!==!k.uvs4||!this.uvs5!==!k.uvs5||!this.uvs6!==!k.uvs6||!this.za!==!k.za||!this.matricesIndices!==!k.matricesIndices||!this.matricesWeights!==!k.matricesWeights||!this.matricesIndicesExtra!==!k.matricesIndicesExtra||!this.matricesWeightsExtra!==!k.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(U){let f=0,p=0,S=0;const k=[];let i=null;const H=[];for(const g of this.splitBasedOnMaterialID())H.push({vertexData:g,transform:y});for(const y of g)if(y.vertexData)for(const g of y.vertexData.splitBasedOnMaterialID())H.push({vertexData:g,transform:y.transform});H.sort(((y,g)=>{const f=y.vertexData.materialInfos?y.vertexData.materialInfos[0].materialIndex:0,p=g.vertexData.materialInfos?g.vertexData.materialInfos[0].materialIndex:0;return f>p?1:f===p?0:-1}));for(const y of H){const g=y.vertexData;if(f=g.materialInfos?g.materialInfos[0].materialIndex:0,i&&i.materialIndex===f)i.indexCount+=g.indices.length,i.verticesCount+=g.xa.length/3;else{const y=new q;y.materialIndex=f,y.indexStart=p,y.indexCount=g.indices.length,y.verticesStart=S,y.verticesCount=g.xa.length/3,k.push(y),i=y}p+=g.indices.length,S+=g.xa.length/3}const U=H.splice(0,1)[0];Z=U.vertexData,y=U.transform,c=H.map((y=>y.vertexData)),g=H,this.materialInfos=k}const C=c.reduce(((y,g)=>{var f;return y+((null===(f=g.indices)||void 0===f?void 0:f.length)??0)}),(null===(f=Z.indices)||void 0===f?void 0:f.length)??0);let j=H||c.some((y=>y.indices===Z.indices))?null===(p=Z.indices)||void 0===p?void 0:p.slice():Z.indices;if(C>0){var P;let f=(null===(P=j)||void 0===P?void 0:P.length)??0;if(j||(j=new Array(C)),j.length!==C){if(Array.isArray(j))j.length=C;else{const y=S||j instanceof Uint32Array?new Uint32Array(C):new Uint16Array(C);y.set(j),j=y}y&&y.determinant()<0&&W._FlipFaces(j,0,f)}let p=Z.xa?Z.xa.length/3:0;for(const{vertexData:y,transform:S}of g)if(y.indices){for(let g=0;g<y.indices.length;g++)j[f+g]=y.indices[g]+p;S&&S.determinant()<0&&W._FlipFaces(j,f,y.indices.length),p+=y.xa.length/3,f+=y.indices.length,i&&(yield)}}return this.indices=j,this.xa=W._MergeElement(k.c.PositionKind,Z.xa,y,g.map((y=>[y.vertexData.xa,y.transform]))),i&&(yield),Z.ya&&(this.ya=W._MergeElement(k.c.NormalKind,Z.ya,y,g.map((y=>[y.vertexData.ya,y.transform]))),i&&(yield)),Z.tangents&&(this.tangents=W._MergeElement(k.c.TangentKind,Z.tangents,y,g.map((y=>[y.vertexData.tangents,y.transform]))),i&&(yield)),Z.Aa&&(this.Aa=W._MergeElement(k.c.UVKind,Z.Aa,y,g.map((y=>[y.vertexData.Aa,y.transform]))),i&&(yield)),Z.uvs2&&(this.uvs2=W._MergeElement(k.c.UV2Kind,Z.uvs2,y,g.map((y=>[y.vertexData.uvs2,y.transform]))),i&&(yield)),Z.uvs3&&(this.uvs3=W._MergeElement(k.c.UV3Kind,Z.uvs3,y,g.map((y=>[y.vertexData.uvs3,y.transform]))),i&&(yield)),Z.uvs4&&(this.uvs4=W._MergeElement(k.c.UV4Kind,Z.uvs4,y,g.map((y=>[y.vertexData.uvs4,y.transform]))),i&&(yield)),Z.uvs5&&(this.uvs5=W._MergeElement(k.c.UV5Kind,Z.uvs5,y,g.map((y=>[y.vertexData.uvs5,y.transform]))),i&&(yield)),Z.uvs6&&(this.uvs6=W._MergeElement(k.c.UV6Kind,Z.uvs6,y,g.map((y=>[y.vertexData.uvs6,y.transform]))),i&&(yield)),Z.za&&(this.za=W._MergeElement(k.c.ColorKind,Z.za,y,g.map((y=>[y.vertexData.za,y.transform]))),(void 0!==Z.hasVertexAlpha||g.some((y=>void 0!==y.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=Z.hasVertexAlpha||g.some((y=>y.vertexData.hasVertexAlpha))),i&&(yield)),Z.matricesIndices&&(this.matricesIndices=W._MergeElement(k.c.MatricesIndicesKind,Z.matricesIndices,y,g.map((y=>[y.vertexData.matricesIndices,y.transform]))),i&&(yield)),Z.matricesWeights&&(this.matricesWeights=W._MergeElement(k.c.MatricesWeightsKind,Z.matricesWeights,y,g.map((y=>[y.vertexData.matricesWeights,y.transform]))),i&&(yield)),Z.matricesIndicesExtra&&(this.matricesIndicesExtra=W._MergeElement(k.c.MatricesIndicesExtraKind,Z.matricesIndicesExtra,y,g.map((y=>[y.vertexData.matricesIndicesExtra,y.transform]))),i&&(yield)),Z.matricesWeightsExtra&&(this.matricesWeightsExtra=W._MergeElement(k.c.MatricesWeightsExtraKind,Z.matricesWeightsExtra,y,g.map((y=>[y.vertexData.matricesWeightsExtra,y.transform])))),this}static _MergeElement(y,g,f,p){const S=p.filter((y=>null!==y[0]&&void 0!==y[0]));if(!g&&0==S.length)return g;if(!g)return this._MergeElement(y,S[0][0],S[0][1],S.slice(1));const i=S.reduce(((y,g)=>y+g[0].length),g.length),H=y===k.c.PositionKind?W._TransformVector3Coordinates:y===k.c.NormalKind?W._TransformVector3Normals:y===k.c.TangentKind?W._TransformVector4Normals:()=>{};if(g instanceof Float32Array){const y=new Float32Array(i);y.set(g),f&&H(y,f,0,g.length);let p=g.length;for(const[g,f]of S)y.set(g,p),f&&H(y,f,p,g.length),p+=g.length;return y}{const y=new Array(i);for(let f=0;f<g.length;f++)y[f]=g[f];f&&H(y,f,0,g.length);let p=g.length;for(const[g,f]of S){for(let f=0;f<g.length;f++)y[p+f]=g[f];f&&H(y,f,p,g.length),p+=g.length}return y}}_validate(){if(!this.xa)throw new Z.j("Positions are required",Z.f.MeshInvalidPositionsError);const y=(y,g)=>{const f=k.c.DeduceStride(y);if(g.length%f!==0)throw new Error("The "+y+"s array count must be a multiple of "+f);return g.length/f},g=y(k.c.PositionKind,this.xa),f=(f,p)=>{const S=y(f,p);if(S!==g)throw new Error("The "+f+"s element count ("+S+") does not match the positions count ("+g+")")};this.ya&&f(k.c.NormalKind,this.ya),this.tangents&&f(k.c.TangentKind,this.tangents),this.Aa&&f(k.c.UVKind,this.Aa),this.uvs2&&f(k.c.UV2Kind,this.uvs2),this.uvs3&&f(k.c.UV3Kind,this.uvs3),this.uvs4&&f(k.c.UV4Kind,this.uvs4),this.uvs5&&f(k.c.UV5Kind,this.uvs5),this.uvs6&&f(k.c.UV6Kind,this.uvs6),this.za&&f(k.c.ColorKind,this.za),this.matricesIndices&&f(k.c.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&f(k.c.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&f(k.c.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&f(k.c.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const y=this.serialize();return W.Parse(y)}serialize(){const y={};if(this.xa&&(y.xa=Array.from(this.xa)),this.ya&&(y.ya=Array.from(this.ya)),this.tangents&&(y.tangents=Array.from(this.tangents)),this.Aa&&(y.Aa=Array.from(this.Aa)),this.uvs2&&(y.uvs2=Array.from(this.uvs2)),this.uvs3&&(y.uvs3=Array.from(this.uvs3)),this.uvs4&&(y.uvs4=Array.from(this.uvs4)),this.uvs5&&(y.uvs5=Array.from(this.uvs5)),this.uvs6&&(y.uvs6=Array.from(this.uvs6)),this.za&&(y.za=Array.from(this.za),y.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(y.matricesIndices=Array.from(this.matricesIndices),y.matricesIndices._isExpanded=!0),this.matricesWeights&&(y.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(y.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),y.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(y.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),y.indices=Array.from(this.indices),this.materialInfos){y.materialInfos=[];for(const g of this.materialInfos){const f={indexStart:g.indexStart,indexCount:g.indexCount,materialIndex:g.materialIndex,verticesStart:g.verticesStart,verticesCount:g.verticesCount};y.materialInfos.push(f)}}return y}static ExtractFromMesh(y,g,f){return W._ExtractFrom(y,g,f)}static ExtractFromGeometry(y,g,f){return W._ExtractFrom(y,g,f)}static _ExtractFrom(y,g,f){const p=new W;if(y.isVerticesDataPresent(k.c.PositionKind)&&(p.xa=y.getVerticesData(k.c.PositionKind,g,f)),y.isVerticesDataPresent(k.c.NormalKind)&&(p.ya=y.getVerticesData(k.c.NormalKind,g,f)),y.isVerticesDataPresent(k.c.TangentKind)&&(p.tangents=y.getVerticesData(k.c.TangentKind,g,f)),y.isVerticesDataPresent(k.c.UVKind)&&(p.Aa=y.getVerticesData(k.c.UVKind,g,f)),y.isVerticesDataPresent(k.c.UV2Kind)&&(p.uvs2=y.getVerticesData(k.c.UV2Kind,g,f)),y.isVerticesDataPresent(k.c.UV3Kind)&&(p.uvs3=y.getVerticesData(k.c.UV3Kind,g,f)),y.isVerticesDataPresent(k.c.UV4Kind)&&(p.uvs4=y.getVerticesData(k.c.UV4Kind,g,f)),y.isVerticesDataPresent(k.c.UV5Kind)&&(p.uvs5=y.getVerticesData(k.c.UV5Kind,g,f)),y.isVerticesDataPresent(k.c.UV6Kind)&&(p.uvs6=y.getVerticesData(k.c.UV6Kind,g,f)),y.isVerticesDataPresent(k.c.ColorKind)){const S=y.Hj||y,i=S.getVertexBuffer(k.c.ColorKind),H=S.getVerticesData(k.c.ColorKind,g,f);if(3===i.getSize()){const y=new Float32Array(4*H.length/3);for(let g=0,f=0;g<H.length;g+=3,f+=4)y[f]=H[g],y[f+1]=H[g+1],y[f+2]=H[g+2],y[f+3]=1;p.za=y}else{if(4!==i.getSize())throw new Error(`Unexpected number of color components: ${i.getSize()}`);p.za=H}}return y.isVerticesDataPresent(k.c.MatricesIndicesKind)&&(p.matricesIndices=y.getVerticesData(k.c.MatricesIndicesKind,g,f)),y.isVerticesDataPresent(k.c.MatricesWeightsKind)&&(p.matricesWeights=y.getVerticesData(k.c.MatricesWeightsKind,g,f)),y.isVerticesDataPresent(k.c.MatricesIndicesExtraKind)&&(p.matricesIndicesExtra=y.getVerticesData(k.c.MatricesIndicesExtraKind,g,f)),y.isVerticesDataPresent(k.c.MatricesWeightsExtraKind)&&(p.matricesWeightsExtra=y.getVerticesData(k.c.MatricesWeightsExtraKind,g,f)),p.indices=y.hg(g,f),p}static CreateRibbon(y){throw(0,i.b)("ribbonBuilder")}static CreateBox(y){throw(0,i.b)("boxBuilder")}static CreateTiledBox(y){throw(0,i.b)("tiledBoxBuilder")}static CreateTiledPlane(y){throw(0,i.b)("tiledPlaneBuilder")}static CreateSphere(y){throw(0,i.b)("sphereBuilder")}static CreateCylinder(y){throw(0,i.b)("cylinderBuilder")}static CreateTorus(y){throw(0,i.b)("torusBuilder")}static CreateLineSystem(y){throw(0,i.b)("linesBuilder")}static CreateDashedLines(y){throw(0,i.b)("linesBuilder")}static CreateGround(y){throw(0,i.b)("groundBuilder")}static CreateTiledGround(y){throw(0,i.b)("groundBuilder")}static CreateGroundFromHeightMap(y){throw(0,i.b)("groundBuilder")}static rg(y){throw(0,i.b)("planeBuilder")}static CreateDisc(y){throw(0,i.b)("discBuilder")}static CreatePolygon(y,g,f,p,S,k,H){throw(0,i.b)("polygonBuilder")}static CreateIcoSphere(y){throw(0,i.b)("icoSphereBuilder")}static CreatePolyhedron(y){throw(0,i.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||S.m.Up();throw(0,i.b)("capsuleBuilder")}static CreateTorusKnot(y){throw(0,i.b)("torusKnotBuilder")}static ComputeNormals(y,g,f,p){let k=0,i=0,H=0,U=0,l=0,c=0,Z=0,C=0,q=0,W=0,j=0,P=0,B=0,R=0,G=0,z=0,T=0,Q=0,m=0,a=0,w=!1,o=!1,I=!1,Y=!1,n=1,M=0,r=null;p&&(w=!!p.facetNormals,o=!!p.facetPositions,I=!!p.facetPartitioning,n=!0===p.useRightHandedSystem?-1:1,M=p.ratio||0,Y=!!p.depthSort,r=p.distanceTo,Y&&void 0===r&&(r=S.m.Zero()));let N=0,b=0,s=0,u=0;for(I&&p&&p.bbSize&&(N=p.subDiv.X*M/p.bbSize.x,b=p.subDiv.Y*M/p.bbSize.y,s=p.subDiv.Z*M/p.bbSize.z,u=p.subDiv.max*p.subDiv.max,p.facetPartitioning.length=0),k=0;k<y.length;k++)f[k]=0;const F=g.length/3|0;for(k=0;k<F;k++){if(P=3*g[3*k],B=P+1,R=P+2,G=3*g[3*k+1],z=G+1,T=G+2,Q=3*g[3*k+2],m=Q+1,a=Q+2,i=y[P]-y[G],H=y[B]-y[z],U=y[R]-y[T],l=y[Q]-y[G],c=y[m]-y[z],Z=y[a]-y[T],C=n*(H*Z-U*c),q=n*(U*l-i*Z),W=n*(i*c-H*l),j=Math.sqrt(C*C+q*q+W*W),j=0===j?1:j,C/=j,q/=j,W/=j,w&&p&&(p.facetNormals[k].x=C,p.facetNormals[k].y=q,p.facetNormals[k].z=W),o&&p&&(p.facetPositions[k].x=(y[P]+y[G]+y[Q])/3,p.facetPositions[k].y=(y[B]+y[z]+y[m])/3,p.facetPositions[k].z=(y[R]+y[T]+y[a])/3),I&&p){const g=Math.floor((p.facetPositions[k].x-p.bInfo.minimum.x*M)*N),f=Math.floor((p.facetPositions[k].y-p.bInfo.minimum.y*M)*b),S=Math.floor((p.facetPositions[k].z-p.bInfo.minimum.z*M)*s),i=Math.floor((y[P]-p.bInfo.minimum.x*M)*N),H=Math.floor((y[B]-p.bInfo.minimum.y*M)*b),U=Math.floor((y[R]-p.bInfo.minimum.z*M)*s),l=Math.floor((y[G]-p.bInfo.minimum.x*M)*N),c=Math.floor((y[z]-p.bInfo.minimum.y*M)*b),Z=Math.floor((y[T]-p.bInfo.minimum.z*M)*s),C=Math.floor((y[Q]-p.bInfo.minimum.x*M)*N),q=Math.floor((y[m]-p.bInfo.minimum.y*M)*b),W=Math.floor((y[a]-p.bInfo.minimum.z*M)*s),j=i+p.subDiv.max*H+u*U,w=l+p.subDiv.max*c+u*Z,o=C+p.subDiv.max*q+u*W,I=g+p.subDiv.max*f+u*S;p.facetPartitioning[I]=p.facetPartitioning[I]?p.facetPartitioning[I]:new Array,p.facetPartitioning[j]=p.facetPartitioning[j]?p.facetPartitioning[j]:new Array,p.facetPartitioning[w]=p.facetPartitioning[w]?p.facetPartitioning[w]:new Array,p.facetPartitioning[o]=p.facetPartitioning[o]?p.facetPartitioning[o]:new Array,p.facetPartitioning[j].push(k),w!=j&&p.facetPartitioning[w].push(k),o!=w&&o!=j&&p.facetPartitioning[o].push(k),I!=j&&I!=w&&I!=o&&p.facetPartitioning[I].push(k)}if(Y&&p&&p.facetPositions){const y=p.depthSortedFacets[k];y.ind=3*k,y.sqDistance=S.m.DistanceSquared(p.facetPositions[k],r)}f[P]+=C,f[B]+=q,f[R]+=W,f[G]+=C,f[z]+=q,f[T]+=W,f[Q]+=C,f[m]+=q,f[a]+=W}for(k=0;k<f.length/3;k++)C=f[3*k],q=f[3*k+1],W=f[3*k+2],j=Math.sqrt(C*C+q*q+W*W),j=0===j?1:j,C/=j,q/=j,W/=j,f[3*k]=C,f[3*k+1]=q,f[3*k+2]=W}static _ComputeSides(y,g,f,p,k,i,H){const U=f.length,l=p.length;let c,Z;switch(y=y||W.DEFAULTSIDE){case W.FRONTSIDE:break;case W.BACKSIDE:for(c=0;c<U;c+=3){const y=f[c];f[c]=f[c+2],f[c+2]=y}for(Z=0;Z<l;Z++)p[Z]=-p[Z];break;case W.DOUBLESIDE:{const y=g.length,C=y/3;for(let f=0;f<y;f++)g[y+f]=g[f];for(c=0;c<U;c+=3)f[c+U]=f[c+2]+C,f[c+1+U]=f[c+1]+C,f[c+2+U]=f[c]+C;for(Z=0;Z<l;Z++)p[l+Z]=-p[Z];const q=k.length;let W=0;for(W=0;W<q;W++)k[W+q]=k[W];for(i=i||new S.o(0,0,1,1),H=H||new S.o(0,0,1,1),W=0,c=0;c<q/2;c++)k[W]=i.x+(i.z-i.x)*k[W],k[W+1]=i.y+(i.w-i.y)*k[W+1],k[W+q]=H.x+(H.z-H.x)*k[W+q],k[W+q+1]=H.y+(H.w-H.y)*k[W+q+1],W+=2;break}}}static Parse(y){const g=new W,f=y.xa;f&&g.set(f,k.c.PositionKind);const p=y.ya;p&&g.set(p,k.c.NormalKind);const S=y.tangents;S&&g.set(S,k.c.TangentKind);const i=y.Aa;i&&g.set(i,k.c.UVKind);const U=y.uvs2;U&&g.set(U,k.c.UV2Kind);const l=y.uvs3;l&&g.set(l,k.c.UV3Kind);const c=y.uvs4;c&&g.set(c,k.c.UV4Kind);const Z=y.uvs5;Z&&g.set(Z,k.c.UV5Kind);const C=y.uvs6;C&&g.set(C,k.c.UV6Kind);const j=y.za;j&&(g.set(H.f.CheckColors4(j,f.length/3),k.c.ColorKind),void 0!==y.hasVertexAlpha&&(g.hasVertexAlpha=y.hasVertexAlpha));const P=y.matricesIndices;P&&g.set(P,k.c.MatricesIndicesKind);const B=y.matricesWeights;B&&g.set(B,k.c.MatricesWeightsKind);const R=y.indices;R&&(g.indices=R);const G=y.materialInfos;if(G){g.materialInfos=[];for(const y of G){const f=new q;f.indexCount=y.indexCount,f.indexStart=y.indexStart,f.verticesCount=y.verticesCount,f.verticesStart=y.verticesStart,f.materialIndex=y.materialIndex,g.materialInfos.push(f)}}return g}static ImportVertexData(y,g){const f=W.Parse(y);g.setAllVerticesData(f,y.updatable)}}W.FRONTSIDE=0,W.BACKSIDE=1,W.DOUBLESIDE=2,W.DEFAULTSIDE=0,W._UniqueIDGenerator=0,(0,p.c)([l.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p]=g;return!Array.isArray(p)}))],W,"_TransformVector3Coordinates",null),(0,p.c)([l.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p]=g;return!Array.isArray(p)}))],W,"_TransformVector3Normals",null),(0,p.c)([l.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p]=g;return!Array.isArray(p)}))],W,"_TransformVector4Normals",null),(0,p.c)([l.e.filter((function(){for(var y=arguments.length,g=new Array(y),f=0;f<y;f++)g[f]=arguments[f];let[p]=g;return!Array.isArray(p)}))],W,"_FlipFaces",null)},12763:(y,g,f)=>{"use strict";f.d(g,{b:()=>jy});var p=f(11054),S=f(11321),k=f(11131),i=f(11349),H=f(11283);function U(y){let g=y.pathArray;const f=y.closeArray||!1,p=y.closePath||!1,S=y.invertUV||!1,U=Math.floor(g[0].length/2);let l=y.offset||U;l=l>U?U:Math.floor(l);const c=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,Z=y.Aa,C=y.za,q=[],W=[],j=[],P=[],B=[],R=[],G=[],z=[];let T;const Q=[],m=[];let a,w,o;if(g.length<2){const y=[],f=[];for(w=0;w<g[0].length-l;w++)y.push(g[0][w]),f.push(g[0][w+l]);g=[y,f]}let I=0;const Y=p?1:0,n=f?1:0;let M,r,N,b,s,u;for(T=g[0].length,a=0;a<g.length+n;a++){for(G[a]=0,B[a]=[0],M=a===g.length?g[0]:g[a],r=M.length,T=T<r?T:r,o=0;o<r;)q.push(M[o].x,M[o].y,M[o].z),o>0&&(N=M[o].ed(M[o-1]).length(),b=N+G[a],B[a].push(b),G[a]=b),o++;p&&(o--,q.push(M[0].x,M[0].y,M[0].z),N=M[o].ed(M[0]).length(),b=N+G[a],B[a].push(b),G[a]=b),Q[a]=r+Y,m[a]=I,I+=r+Y}let F,A,J=null,V=null;for(w=0;w<T+Y;w++)for(z[w]=0,R[w]=[0],a=0;a<g.length-1+n;a++)s=g[a],u=a===g.length-1?g[0]:g[a+1],w===T?(J=s[0],V=u[0]):(J=s[w],V=u[w]),N=V.ed(J).length(),b=N+z[w],R[w].push(b),z[w]=b;if(Z)for(a=0;a<Z.length;a++)P.push(Z[a].x,H.d?1-Z[a].y:Z[a].y);else for(a=0;a<g.length+n;a++)for(w=0;w<T+Y;w++)F=0!=G[a]?B[a][w]/G[a]:0,A=0!=z[w]?R[w][a]/z[w]:0,S?P.push(A,F):P.push(F,H.d?1-A:A);a=0;let e=0,h=Q[a]-1,D=Q[a+1]-1,K=h<D?h:D,X=m[1]-m[0];const E=Q.length-1;for(;e<=K&&a<E;)W.push(e,e+X,e+1),W.push(e+X+1,e+1,e+X),e+=1,e===K&&(a++,X=m[a+1]-m[a],h=Q[a]-1,D=Q[a+1]-1,e=m[a],K=h<D?h+e:D+e);if(i.e.ComputeNormals(q,W,j),p){let y=0,f=0;for(a=0;a<g.length;a++){y=3*m[a],f=a+1<g.length?3*(m[a+1]-1):j.length-3,j[y]=.5*(j[y]+j[f]),j[y+1]=.5*(j[y+1]+j[f+1]),j[y+2]=.5*(j[y+2]+j[f+2]);const p=Math.sqrt(j[y]*j[y]+j[y+1]*j[y+1]+j[y+2]*j[y+2]);j[y]/=p,j[y+1]/=p,j[y+2]/=p,j[f]=j[y],j[f+1]=j[y+1],j[f+2]=j[y+2]}}if(f){let y=3*m[0],f=3*m[g.length];for(w=0;w<T+Y;w++){j[y]=.5*(j[y]+j[f]),j[y+1]=.5*(j[y+1]+j[f+1]),j[y+2]=.5*(j[y+2]+j[f+2]);const g=Math.sqrt(j[y]*j[y]+j[y+1]*j[y+1]+j[y+2]*j[y+2]);j[y]/=g,j[y+1]/=g,j[y+2]/=g,j[f]=j[y],j[f+1]=j[y+1],j[f+2]=j[y+2],y+=3,f+=3}}i.e._ComputeSides(c,q,W,j,P,y.frontUVs,y.backUVs);let O=null;if(C){O=new Float32Array(4*C.length);for(let y=0;y<C.length;y++)O[4*y]=C[y].r,O[4*y+1]=C[y].g,O[4*y+2]=C[y].b,O[4*y+3]=C[y].a}const L=new i.e,x=new Float32Array(q),d=new Float32Array(j),t=new Float32Array(P);return L.indices=W,L.xa=x,L.ya=d,L.Aa=t,O&&L.set(O,k.c.ColorKind),p&&(L._idx=m),L}function l(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=g.pathArray,c=g.closeArray,Z=g.closePath,C=S.e._GetDefaultSideOrientation(g.sideOrientation),q=g.instance,W=g.updatable;if(q){const y=p.j.o[0].me(Number.MAX_VALUE),f=p.j.o[1].me(-Number.MAX_VALUE),U=g=>{let p=l[0].length;const k=q;let i=0;const H=k._originalBuilderSideOrientation===S.e.DOUBLESIDE?2:1;for(let S=1;S<=H;++S)for(let H=0;H<l.length;++H){const S=l[H],U=S.length;p=p<U?p:U;for(let k=0;k<p;++k){const p=S[k];g[i]=p.x,g[i+1]=p.y,g[i+2]=p.z,y.minimizeInPlaceFromFloats(p.x,p.y,p.z),f.maximizeInPlaceFromFloats(p.x,p.y,p.z),i+=3}if(k._creationDataStorage&&k._creationDataStorage.closePath){const y=S[0];g[i]=y.x,g[i+1]=y.y,g[i+2]=y.z,i+=3}}},c=q.getVerticesData(k.c.PositionKind);if(U(c),q.hasBoundingInfo?q.getBoundingInfo().reConstruct(y,f,q._worldMatrix):q.buildBoundingInfo(y,f,q._worldMatrix),q.updateVerticesData(k.c.PositionKind,c,!1,!1),g.za){const y=q.getVerticesData(k.c.ColorKind);for(let f=0,p=0;f<g.za.length;f++,p+=4){const S=g.za[f];y[p]=S.r,y[p+1]=S.g,y[p+2]=S.b,y[p+3]=S.a}q.updateVerticesData(k.c.ColorKind,y,!1,!1)}if(g.Aa){const y=q.getVerticesData(k.c.UVKind);for(let f=0;f<g.Aa.length;f++)y[2*f]=g.Aa[f].x,y[2*f+1]=H.d?1-g.Aa[f].y:g.Aa[f].y;q.updateVerticesData(k.c.UVKind,y,!1,!1)}if(!q.areNormalsFrozen||q.isFacetDataEnabled){const y=q.hg(),g=q.getVerticesData(k.c.NormalKind),f=q.isFacetDataEnabled?q.getFacetDataParameters():null;if(i.e.ComputeNormals(c,y,g,f),q._creationDataStorage&&q._creationDataStorage.closePath){let y=0,f=0;for(let p=0;p<l.length;p++)y=3*q._creationDataStorage.idx[p],f=p+1<l.length?3*(q._creationDataStorage.idx[p+1]-1):g.length-3,g[y]=.5*(g[y]+g[f]),g[y+1]=.5*(g[y+1]+g[f+1]),g[y+2]=.5*(g[y+2]+g[f+2]),g[f]=g[y],g[f+1]=g[y+1],g[f+2]=g[y+2]}q.areNormalsFrozen||q.updateVerticesData(k.c.NormalKind,g,!1,!1)}return q}{const p=new S.e(y,f);p._originalBuilderSideOrientation=C,p._creationDataStorage=new S.g;const k=U(g);return Z&&(p._creationDataStorage.idx=k._idx),p._creationDataStorage.closePath=Z,p._creationDataStorage.closeArray=c,k.Ca(p,W),p}}i.e.CreateRibbon=U,S.e.CreateRibbon=function(y,g){return l(y,{pathArray:g,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var c=f(11708),Z=f(11392),C=f(11090);function q(y){const g=y.pattern||S.e.NO_FLIP,f=y.tileWidth||y.tileSize||1,p=y.tileHeight||y.tileSize||1,k=y.alignHorizontal||0,H=y.alignVertical||0,U=y.width||y.size||1,l=Math.floor(U/f);let c=U-l*f;const Z=y.height||y.size||1,C=Math.floor(Z/p);let q=Z-C*p;const W=f*l/2,j=p*C/2;let P=0,B=0,R=0,G=0,z=0,T=0;if(c>0||q>0){switch(R=-W,G=-j,z=W,T=j,k){case S.e.CENTER:c/=2,R-=c,z+=c;break;case S.e.LEFT:z+=c,P=-c/2;break;case S.e.RIGHT:R-=c,P=c/2}switch(H){case S.e.CENTER:q/=2,G-=q,T+=q;break;case S.e.BOTTOM:T+=q,B=-q/2;break;case S.e.TOP:G-=q,B=q/2}}const Q=[],m=[],a=[];a[0]=[0,0,1,0,1,1,0,1],a[1]=[0,0,1,0,1,1,0,1],g!==S.e.ROTATE_TILE&&g!==S.e.ROTATE_ROW||(a[1]=[1,1,0,1,0,0,1,0]),g!==S.e.FLIP_TILE&&g!==S.e.FLIP_ROW||(a[1]=[1,0,0,0,0,1,1,1]),g!==S.e.FLIP_N_ROTATE_TILE&&g!==S.e.FLIP_N_ROTATE_ROW||(a[1]=[0,1,1,1,1,0,0,0]);let w=[];const o=[],I=[];let Y=0;for(let i=0;i<C;i++)for(let y=0;y<l;y++)Q.push(y*f-W+P,i*p-j+B,0),Q.push((y+1)*f-W+P,i*p-j+B,0),Q.push((y+1)*f-W+P,(i+1)*p-j+B,0),Q.push(y*f-W+P,(i+1)*p-j+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),w=g===S.e.FLIP_TILE||g===S.e.ROTATE_TILE||g===S.e.FLIP_N_ROTATE_TILE?w.concat(a[(y%2+i%2)%2]):g===S.e.FLIP_ROW||g===S.e.ROTATE_ROW||g===S.e.FLIP_N_ROTATE_ROW?w.concat(a[i%2]):w.concat(a[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Y+=4;if(c>0||q>0){const y=q>0&&(H===S.e.CENTER||H===S.e.TOP),i=q>0&&(H===S.e.CENTER||H===S.e.BOTTOM),U=c>0&&(k===S.e.CENTER||k===S.e.RIGHT),Z=c>0&&(k===S.e.CENTER||k===S.e.LEFT);let a,n,M,r,N=[];if(y&&U&&(Q.push(R+P,G+B,0),Q.push(-W+P,G+B,0),Q.push(-W+P,G+q+B,0),Q.push(R+P,G+q+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,a=1-c/f,n=1-q/p,M=1,r=1,N=[a,n,M,n,M,r,a,r],g===S.e.ROTATE_ROW&&(N=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),g===S.e.FLIP_ROW&&(N=[1-a,n,1-M,n,1-M,r,1-a,r]),g===S.e.FLIP_N_ROTATE_ROW&&(N=[a,1-n,M,1-n,M,1-r,a,1-r]),w=w.concat(N),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&Z&&(Q.push(W+P,G+B,0),Q.push(z+P,G+B,0),Q.push(z+P,G+q+B,0),Q.push(W+P,G+q+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,a=0,n=1-q/p,M=c/f,r=1,N=[a,n,M,n,M,r,a,r],(g===S.e.ROTATE_ROW||g===S.e.ROTATE_TILE&&l%2===0)&&(N=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),(g===S.e.FLIP_ROW||g===S.e.FLIP_TILE&&l%2===0)&&(N=[1-a,n,1-M,n,1-M,r,1-a,r]),(g===S.e.FLIP_N_ROTATE_ROW||g===S.e.FLIP_N_ROTATE_TILE&&l%2===0)&&(N=[a,1-n,M,1-n,M,1-r,a,1-r]),w=w.concat(N),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&U&&(Q.push(R+P,j+B,0),Q.push(-W+P,j+B,0),Q.push(-W+P,T+B,0),Q.push(R+P,T+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,a=1-c/f,n=0,M=1,r=q/p,N=[a,n,M,n,M,r,a,r],(g===S.e.ROTATE_ROW&&C%2===1||g===S.e.ROTATE_TILE&&C%1===0)&&(N=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),(g===S.e.FLIP_ROW&&C%2===1||g===S.e.FLIP_TILE&&C%2===0)&&(N=[1-a,n,1-M,n,1-M,r,1-a,r]),(g===S.e.FLIP_N_ROTATE_ROW&&C%2===1||g===S.e.FLIP_N_ROTATE_TILE&&C%2===0)&&(N=[a,1-n,M,1-n,M,1-r,a,1-r]),w=w.concat(N),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&Z&&(Q.push(W+P,j+B,0),Q.push(z+P,j+B,0),Q.push(z+P,T+B,0),Q.push(W+P,T+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,a=0,n=0,M=c/f,r=q/p,N=[a,n,M,n,M,r,a,r],(g===S.e.ROTATE_ROW&&C%2===1||g===S.e.ROTATE_TILE&&(C+l)%2===1)&&(N=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),(g===S.e.FLIP_ROW&&C%2===1||g===S.e.FLIP_TILE&&(C+l)%2===1)&&(N=[1-a,n,1-M,n,1-M,r,1-a,r]),(g===S.e.FLIP_N_ROTATE_ROW&&C%2===1||g===S.e.FLIP_N_ROTATE_TILE&&(C+l)%2===1)&&(N=[a,1-n,M,1-n,M,1-r,a,1-r]),w=w.concat(N),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y){const y=[];a=0,n=1-q/p,M=1,r=1,y[0]=[a,n,M,n,M,r,a,r],y[1]=[a,n,M,n,M,r,a,r],g!==S.e.ROTATE_TILE&&g!==S.e.ROTATE_ROW||(y[1]=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),g!==S.e.FLIP_TILE&&g!==S.e.FLIP_ROW||(y[1]=[1-a,n,1-M,n,1-M,r,1-a,r]),g!==S.e.FLIP_N_ROTATE_TILE&&g!==S.e.FLIP_N_ROTATE_ROW||(y[1]=[a,1-n,M,1-n,M,1-r,a,1-r]);for(let p=0;p<l;p++)Q.push(p*f-W+P,G+B,0),Q.push((p+1)*f-W+P,G+B,0),Q.push((p+1)*f-W+P,G+q+B,0),Q.push(p*f-W+P,G+q+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,w=g===S.e.FLIP_TILE||g===S.e.ROTATE_TILE||g===S.e.FLIP_N_ROTATE_TILE?w.concat(y[(p+1)%2]):g===S.e.FLIP_ROW||g===S.e.ROTATE_ROW||g===S.e.FLIP_N_ROTATE_ROW?w.concat(y[1]):w.concat(y[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(i){const y=[];a=0,n=0,M=1,r=q/p,y[0]=[a,n,M,n,M,r,a,r],y[1]=[a,n,M,n,M,r,a,r],g!==S.e.ROTATE_TILE&&g!==S.e.ROTATE_ROW||(y[1]=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),g!==S.e.FLIP_TILE&&g!==S.e.FLIP_ROW||(y[1]=[1-a,n,1-M,n,1-M,r,1-a,r]),g!==S.e.FLIP_N_ROTATE_TILE&&g!==S.e.FLIP_N_ROTATE_ROW||(y[1]=[a,1-n,M,1-n,M,1-r,a,1-r]);for(let p=0;p<l;p++)Q.push(p*f-W+P,T-q+B,0),Q.push((p+1)*f-W+P,T-q+B,0),Q.push((p+1)*f-W+P,T+B,0),Q.push(p*f-W+P,T+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,w=g===S.e.FLIP_TILE||g===S.e.ROTATE_TILE||g===S.e.FLIP_N_ROTATE_TILE?w.concat(y[(p+C)%2]):g===S.e.FLIP_ROW||g===S.e.ROTATE_ROW||g===S.e.FLIP_N_ROTATE_ROW?w.concat(y[C%2]):w.concat(y[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const y=[];a=1-c/f,n=0,M=1,r=1,y[0]=[a,n,M,n,M,r,a,r],y[1]=[a,n,M,n,M,r,a,r],g!==S.e.ROTATE_TILE&&g!==S.e.ROTATE_ROW||(y[1]=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),g!==S.e.FLIP_TILE&&g!==S.e.FLIP_ROW||(y[1]=[1-a,n,1-M,n,1-M,r,1-a,r]),g!==S.e.FLIP_N_ROTATE_TILE&&g!==S.e.FLIP_N_ROTATE_ROW||(y[1]=[a,1-n,M,1-n,M,1-r,a,1-r]);for(let f=0;f<C;f++)Q.push(R+P,f*p-j+B,0),Q.push(R+c+P,f*p-j+B,0),Q.push(R+c+P,(f+1)*p-j+B,0),Q.push(R+P,(f+1)*p-j+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,w=g===S.e.FLIP_TILE||g===S.e.ROTATE_TILE||g===S.e.FLIP_N_ROTATE_TILE?w.concat(y[(f+1)%2]):g===S.e.FLIP_ROW||g===S.e.ROTATE_ROW||g===S.e.FLIP_N_ROTATE_ROW?w.concat(y[f%2]):w.concat(y[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const y=[];a=0,n=0,M=c/p,r=1,y[0]=[a,n,M,n,M,r,a,r],y[1]=[a,n,M,n,M,r,a,r],g!==S.e.ROTATE_TILE&&g!==S.e.ROTATE_ROW||(y[1]=[1-a,1-n,1-M,1-n,1-M,1-r,1-a,1-r]),g!==S.e.FLIP_TILE&&g!==S.e.FLIP_ROW||(y[1]=[1-a,n,1-M,n,1-M,r,1-a,r]),g!==S.e.FLIP_N_ROTATE_TILE&&g!==S.e.FLIP_N_ROTATE_ROW||(y[1]=[a,1-n,M,1-n,M,1-r,a,1-r]);for(let f=0;f<C;f++)Q.push(z-c+P,f*p-j+B,0),Q.push(z+P,f*p-j+B,0),Q.push(z+P,(f+1)*p-j+B,0),Q.push(z-c+P,(f+1)*p-j+B,0),I.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,w=g===S.e.FLIP_TILE||g===S.e.ROTATE_TILE||g===S.e.FLIP_N_ROTATE_TILE?w.concat(y[(f+l)%2]):g===S.e.FLIP_ROW||g===S.e.ROTATE_ROW||g===S.e.FLIP_N_ROTATE_ROW?w.concat(y[f%2]):w.concat(y[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const n=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE;i.e._ComputeSides(n,Q,I,m,w,y.frontUVs,y.backUVs);const M=new i.e;M.indices=I,M.xa=Q,M.ya=m,M.Aa=w;const r=n===i.e.DOUBLESIDE?o.concat(o):o;return M.za=r,M}function W(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return q(g).Ca(p,g.updatable),p}function j(y){const g=y.faceUV||new Array(6),f=y.faceColors,k=y.pattern||S.e.NO_FLIP,U=y.width||y.size||1,l=y.height||y.size||1,c=y.depth||y.size||1,Z=y.tileWidth||y.tileSize||1,W=y.tileHeight||y.tileSize||1,j=y.alignHorizontal||0,P=y.alignVertical||0,B=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE;for(let S=0;S<6;S++)void 0===g[S]&&(g[S]=new p.o(0,0,1,1)),f&&void 0===f[S]&&(f[S]=new C.f(1,1,1,1));const R=U/2,G=l/2,z=c/2,T=[];for(let p=0;p<2;p++)T[p]=q({pattern:k,tileWidth:Z,tileHeight:W,width:U,height:l,alignVertical:P,alignHorizontal:j,sideOrientation:B});for(let p=2;p<4;p++)T[p]=q({pattern:k,tileWidth:Z,tileHeight:W,width:c,height:l,alignVertical:P,alignHorizontal:j,sideOrientation:B});let Q=P;P===S.e.BOTTOM?Q=S.e.TOP:P===S.e.TOP&&(Q=S.e.BOTTOM);for(let p=4;p<6;p++)T[p]=q({pattern:k,tileWidth:Z,tileHeight:W,width:U,height:c,alignVertical:Q,alignHorizontal:j,sideOrientation:B});let m=[],a=[],w=[],o=[];const I=[],Y=[],n=[],M=[];let r=0,N=0;for(let S=0;S<6;S++){const y=T[S].xa.length;Y[S]=[],n[S]=[];for(let g=0;g<y/3;g++)Y[S].push(new p.m(T[S].xa[3*g],T[S].xa[3*g+1],T[S].xa[3*g+2])),n[S].push(new p.m(T[S].ya[3*g],T[S].ya[3*g+1],T[S].ya[3*g+2]));r=T[S].Aa.length,M[S]=[];for(let f=0;f<r;f+=2)M[S][f]=g[S].x+(g[S].z-g[S].x)*T[S].Aa[f],M[S][f+1]=g[S].y+(g[S].w-g[S].y)*T[S].Aa[f+1],H.d&&(M[S][f+1]=1-M[S][f+1]);if(w=w.concat(M[S]),o=o.concat(T[S].indices.map((y=>y+N))),N+=Y[S].length,f)for(let g=0;g<4;g++)I.push(f[S].r,f[S].g,f[S].b,f[S].a)}const b=new p.m(0,0,z),s=p.c.RotationY(Math.PI);m=Y[0].map((y=>p.m.TransformNormal(y,s).add(b))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[]),a=n[0].map((y=>p.m.TransformNormal(y,s))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[]),m=m.concat(Y[1].map((y=>y.ed(b))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[])),a=a.concat(n[1].map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[]));const u=new p.m(R,0,0),F=p.c.RotationY(-Math.PI/2);m=m.concat(Y[2].map((y=>p.m.TransformNormal(y,F).add(u))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[])),a=a.concat(n[2].map((y=>p.m.TransformNormal(y,F))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[]));const A=p.c.RotationY(Math.PI/2);m=m.concat(Y[3].map((y=>p.m.TransformNormal(y,A).ed(u))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[])),a=a.concat(n[3].map((y=>p.m.TransformNormal(y,A))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[]));const J=new p.m(0,G,0),V=p.c.RotationX(Math.PI/2);m=m.concat(Y[4].map((y=>p.m.TransformNormal(y,V).add(J))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[])),a=a.concat(n[4].map((y=>p.m.TransformNormal(y,V))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[]));const e=p.c.RotationX(-Math.PI/2);m=m.concat(Y[5].map((y=>p.m.TransformNormal(y,e).ed(J))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[])),a=a.concat(n[5].map((y=>p.m.TransformNormal(y,e))).map((y=>[y.x,y.y,y.z])).reduce(((y,g)=>y.concat(g)),[])),i.e._ComputeSides(B,m,o,a,w);const h=new i.e;if(h.indices=o,h.xa=m,h.ya=a,h.Aa=w,f){const y=B===i.e.DOUBLESIDE?I.concat(I):I;h.za=y}return h}function P(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return j(g).Ca(p,g.updatable),p}i.e.CreateTiledPlane=q;i.e.CreateTiledBox=j;var B=f(11696),R=f(11038),G=f(11378);function z(y){const g=y.height||2;let f=0===y.diameterTop?0:y.diameterTop||y.diameter||1,k=0===y.diameterBottom?0:y.diameterBottom||y.diameter||1;f=f||1e-5,k=k||1e-5;const U=0|(y.tessellation||24),l=0|(y.subdivisions||1),c=!!y.hasRings,Z=!!y.enclose,q=0===y.cap?0:y.cap||S.e.CAP_ALL,W=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,j=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,P=y.faceUV||new Array(3),B=y.faceColors,R=2+(1+(1!==W&&Z?2:0))*(c?l:1);let z;for(z=0;z<R;z++)B&&void 0===B[z]&&(B[z]=new C.f(1,1,1,1));for(z=0;z<R;z++)P&&void 0===P[z]&&(P[z]=new p.o(0,0,1,1));const T=[],Q=[],m=[],a=[],w=[],o=2*Math.PI*W/U;let I,Y,n;const M=(k-f)/2/g,r=p.m.Zero(),N=p.m.Zero(),b=p.m.Zero(),s=p.m.Zero(),u=p.m.Zero(),F=G.b.Y;let A,J,V,e=1,h=1,D=0,K=0;for(A=0;A<=l;A++)for(Y=A/l,n=(Y*(f-k)+k)/2,e=c&&0!==A&&A!==l?2:1,V=0;V<e;V++){for(c&&(h+=V),Z&&(h+=2*V),J=0;J<=U;J++)I=J*o,r.x=Math.cos(-I)*n,r.y=-g/2+Y*g,r.z=Math.sin(-I)*n,0===f&&A===l?(N.x=m[m.length-3*(U+1)],N.y=m[m.length-3*(U+1)+1],N.z=m[m.length-3*(U+1)+2]):(N.x=r.x,N.z=r.z,N.y=Math.sqrt(N.x*N.x+N.z*N.z)*M,N.normalize()),0===J&&(b.p(r),s.p(N)),Q.push(r.x,r.y,r.z),m.push(N.x,N.y,N.z),K=c?D!==h?P[h].y:P[h].w:P[h].y+(P[h].w-P[h].y)*Y,a.push(P[h].x+(P[h].z-P[h].x)*J/U,H.d?1-K:K),B&&w.push(B[h].r,B[h].g,B[h].b,B[h].a);1!==W&&Z&&(Q.push(r.x,r.y,r.z),Q.push(0,r.y,0),Q.push(0,r.y,0),Q.push(b.x,b.y,b.z),p.m.CrossToRef(F,N,u),u.normalize(),m.push(u.x,u.y,u.z,u.x,u.y,u.z),p.m.CrossToRef(s,F,u),u.normalize(),m.push(u.x,u.y,u.z,u.x,u.y,u.z),K=c?D!==h?P[h+1].y:P[h+1].w:P[h+1].y+(P[h+1].w-P[h+1].y)*Y,a.push(P[h+1].x,H.d?1-K:K),a.push(P[h+1].z,H.d?1-K:K),K=c?D!==h?P[h+2].y:P[h+2].w:P[h+2].y+(P[h+2].w-P[h+2].y)*Y,a.push(P[h+2].x,H.d?1-K:K),a.push(P[h+2].z,H.d?1-K:K),B&&(w.push(B[h+1].r,B[h+1].g,B[h+1].b,B[h+1].a),w.push(B[h+1].r,B[h+1].g,B[h+1].b,B[h+1].a),w.push(B[h+2].r,B[h+2].g,B[h+2].b,B[h+2].a),w.push(B[h+2].r,B[h+2].g,B[h+2].b,B[h+2].a))),D!==h&&(D=h)}const X=1!==W&&Z?U+4:U;for(A=0,h=0;h<l;h++){let y=0,g=0,f=0,p=0;for(J=0;J<U;J++)y=A*(X+1)+J,g=(A+1)*(X+1)+J,f=A*(X+1)+(J+1),p=(A+1)*(X+1)+(J+1),T.push(y,g,f),T.push(p,f,g);1!==W&&Z&&(T.push(y+2,g+2,f+2),T.push(p+2,f+2,g+2),T.push(y+4,g+4,f+4),T.push(p+4,f+4,g+4)),A=c?A+2:A+1}const E=y=>{const S=y?f/2:k/2;if(0===S)return;let i,l,c;const Z=y?P[R-1]:P[0];let C=null;B&&(C=y?B[R-1]:B[0]);const q=Q.length/3,j=y?g/2:-g/2,G=new p.m(0,j,0);Q.push(G.x,G.y,G.z),m.push(0,y?1:-1,0);const z=Z.y+.5*(Z.w-Z.y);a.push(Z.x+.5*(Z.z-Z.x),H.d?1-z:z),C&&w.push(C.r,C.g,C.b,C.a);const o=new p.l(.5,.5);for(c=0;c<=U;c++){i=2*Math.PI*c*W/U;const g=Math.cos(-i),f=Math.sin(-i);l=new p.m(g*S,j,f*S);const k=new p.l(g*o.x+.5,f*o.y+.5);Q.push(l.x,l.y,l.z),m.push(0,y?1:-1,0);const q=Z.y+(Z.w-Z.y)*k.y;a.push(Z.x+(Z.z-Z.x)*k.x,H.d?1-q:q),C&&w.push(C.r,C.g,C.b,C.a)}for(c=0;c<U;c++)y?(T.push(q),T.push(q+(c+2)),T.push(q+(c+1))):(T.push(q),T.push(q+(c+1)),T.push(q+(c+2)))};q!==S.e.CAP_START&&q!==S.e.CAP_ALL||E(!1),q!==S.e.CAP_END&&q!==S.e.CAP_ALL||E(!0),i.e._ComputeSides(j,Q,T,m,a,y.frontUVs,y.backUVs);const O=new i.e;return O.indices=T,O.xa=Q,O.ya=m,O.Aa=a,B&&(O.za=w),O}function T(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return z(g).Ca(p,g.updatable),p}function Q(y){const g=[],f=[],S=[],k=[],U=y.diameter||1,l=y.thickness||.5,c=0|(y.tessellation||16),Z=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,C=c+1;for(let i=0;i<=c;i++){const y=i/c,Z=i*Math.PI*2/c-Math.PI/2,q=p.c.Translation(U/2,0,0).multiply(p.c.RotationY(Z));for(let U=0;U<=c;U++){const Z=1-U/c,W=U*Math.PI*2/c+Math.PI,j=Math.cos(W),P=Math.sin(W);let B=new p.m(j,P,0),R=B.scale(l/2);const G=new p.l(y,Z);R=p.m.TransformCoordinates(R,q),B=p.m.TransformNormal(B,q),f.push(R.x,R.y,R.z),S.push(B.x,B.y,B.z),k.push(G.x,H.d?1-G.y:G.y);const z=(i+1)%C,T=(U+1)%C;g.push(i*C+U),g.push(i*C+T),g.push(z*C+U),g.push(i*C+T),g.push(z*C+T),g.push(z*C+U)}}i.e._ComputeSides(Z,f,g,S,k,y.frontUVs,y.backUVs);const q=new i.e;return q.indices=g,q.xa=f,q.ya=S,q.Aa=k,q}function m(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return Q(g).Ca(p,g.updatable),p}i.e.CreateCylinder=z,S.e.CreateCylinder=(y,g,f,p,k,i,H,U,l)=>{void 0!==H&&H instanceof R.e||(void 0!==H&&(l=U||S.e.DEFAULTSIDE,U=H),H=i,i=1);return T(y,{height:g,diameterTop:f,diameterBottom:p,tessellation:k,subdivisions:i,sideOrientation:l,updatable:U},H)};function a(y){const g=[],f=[],S=[],k=[],U=y.radius||2,l=y.tube||.5,c=y.radialSegments||32,Z=y.tubularSegments||32,C=y.p||2,q=y.q||3,W=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,j=y=>{const g=Math.cos(y),f=Math.sin(y),S=q/C*y,k=Math.cos(S),i=U*(2+k)*.5*g,H=U*(2+k)*f*.5,l=U*Math.sin(S)*.5;return new p.m(i,H,l)};let P,B;for(P=0;P<=c;P++){const y=P%c/c*2*C*Math.PI,g=j(y),S=j(y+.01),i=S.ed(g);let U=S.add(g);const q=p.m.Cross(i,U);for(U=p.m.Cross(q,i),q.normalize(),U.normalize(),B=0;B<Z;B++){const y=B%Z/Z*2*Math.PI,p=-l*Math.cos(y),S=l*Math.sin(y);f.push(g.x+p*U.x+S*q.x),f.push(g.y+p*U.y+S*q.y),f.push(g.z+p*U.z+S*q.z),k.push(P/c),k.push(H.d?1-B/Z:B/Z)}}for(P=0;P<c;P++)for(B=0;B<Z;B++){const y=(B+1)%Z,f=P*Z+B,p=(P+1)*Z+B,S=(P+1)*Z+y,k=P*Z+y;g.push(k),g.push(p),g.push(f),g.push(k),g.push(S),g.push(p)}i.e.ComputeNormals(f,g,S),i.e._ComputeSides(W,f,g,S,k,y.frontUVs,y.backUVs);const R=new i.e;return R.indices=g,R.xa=f,R.ya=S,R.Aa=k,R}function w(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return a(g).Ca(p,g.updatable),p}i.e.CreateTorus=Q,S.e.CreateTorus=(y,g,f,p,S,k,i)=>m(y,{diameter:g,thickness:f,tessellation:p,sideOrientation:i,updatable:k},S);i.e.CreateTorusKnot=a,S.e.CreateTorusKnot=(y,g,f,p,S,k,i,H,U,l)=>w(y,{radius:g,tube:f,radialSegments:p,tubularSegments:S,p:k,q:i,sideOrientation:l,updatable:U},H);var o=f(12770),I=f(10736),Y=f(11565),n=f(11062),M=f(10761);class r extends p.l{constructor(y,g){super(y.x,y.y),this.index=g}}class N{constructor(){this.elements=[]}add(y){const g=[];return y.forEach((y=>{const f=new r(y,this.elements.length);g.push(f),this.elements.push(f)})),g}computeBounds(){const y=new p.l(this.elements[0].x,this.elements[0].y),g=new p.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((f=>{f.x<y.x?y.x=f.x:f.x>g.x&&(g.x=f.x),f.y<y.y?y.y=f.y:f.y>g.y&&(g.y=f.y)})),{min:y,max:g,width:g.x-y.x,height:g.y-y.y}}}class b{_addToepoint(y){for(const g of y)this._epoints.push(g.x,g.y)}constructor(y,g,f){let p,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new N,this._outlinepoints=new N,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=S,this._name=y,this._scene=f||M.d.LastCreatedScene,p=g instanceof Y.e?g.getPoints():g,this._addToepoint(p),this._points.add(p),this._outlinepoints.add(p),"undefined"===typeof this.bjsEarcut&&I.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(y){this._points.add(y);const g=new N;return g.add(y),this._holes.push(g),this._eholes.push(this._epoints.length/2),this._addToepoint(y),this}build(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const p=new S.e(this._name,this._scene),i=this.buildVertexData(g,f);return p.Ga(k.c.PositionKind,i.xa,y),p.Ga(k.c.NormalKind,i.ya,y),p.Ga(k.c.UVKind,i.Aa,y),p.setIndices(i.indices),p}buildVertexData(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const f=new i.e,p=[],S=[],k=[],H=this._points.computeBounds();this._points.elements.forEach((y=>{p.push(0,1,0),S.push(y.x,0,y.y),k.push((y.x-H.min.x)/H.width,(y.y-H.min.y)/H.height)}));const U=[],l=this.bjsEarcut(this._epoints,this._eholes,2);for(let i=0;i<l.length;i++)U.push(l[i]);if(y>0){const f=S.length/3;this._points.elements.forEach((g=>{p.push(0,-1,0),S.push(g.x,-y,g.y),k.push(1-(g.x-H.min.x)/H.width,1-(g.y-H.min.y)/H.height)}));const i=U.length;for(let y=0;y<i;y+=3){const g=U[y+0],p=U[y+1],S=U[y+2];U.push(S+f),U.push(p+f),U.push(g+f)}this._addSide(S,p,k,U,H,this._outlinepoints,y,!1,g),this._holes.forEach((f=>{this._addSide(S,p,k,U,H,f,y,!0,g)}))}return f.indices=U,f.xa=S,f.ya=p,f.Aa=k,f}_addSide(y,g,f,S,k,i,H,U,l){let c=y.length/3,Z=0;for(let C=0;C<i.elements.length;C++){const q=i.elements[C],W=i.elements[(C+1)%i.elements.length];y.push(q.x,0,q.y),y.push(q.x,-H,q.y),y.push(W.x,0,W.y),y.push(W.x,-H,W.y);const j=i.elements[(C+i.elements.length-1)%i.elements.length],P=i.elements[(C+2)%i.elements.length];let B=new p.m(-(W.y-q.y),0,W.x-q.x),R=new p.m(-(q.y-j.y),0,q.x-j.x),G=new p.m(-(P.y-W.y),0,P.x-W.x);U||(B=B.scale(-1),R=R.scale(-1),G=G.scale(-1));const z=B.normalizeToNew();let T=R.normalizeToNew(),Q=G.normalizeToNew();const m=p.m.Dot(T,z);T=m>l?m<n.e-1?new p.m(q.x,0,q.y).ed(new p.m(W.x,0,W.y)).normalize():R.add(B).normalize():z;const a=p.m.Dot(G,B);Q=a>l?a<n.e-1?new p.m(W.x,0,W.y).ed(new p.m(q.x,0,q.y)).normalize():G.add(B).normalize():z,f.push(Z/k.width,0),f.push(Z/k.width,1),Z+=B.length(),f.push(Z/k.width,0),f.push(Z/k.width,1),g.push(T.x,T.y,T.z),g.push(T.x,T.y,T.z),g.push(Q.x,Q.y,Q.z),g.push(Q.x,Q.y,Q.z),U?(S.push(c),S.push(c+2),S.push(c+1),S.push(c+1),S.push(c+2),S.push(c+3)):(S.push(c),S.push(c+1),S.push(c+2),S.push(c+1),S.push(c+3),S.push(c+2)),c+=4}}}function s(y,g,f,S,U,l,c){const Z=f||new Array(3),q=S,W=[],j=c||!1;for(let k=0;k<3;k++)void 0===Z[k]&&(Z[k]=new p.o(0,0,1,1)),q&&void 0===q[k]&&(q[k]=new C.f(1,1,1,1));const P=y.getVerticesData(k.c.PositionKind),B=y.getVerticesData(k.c.NormalKind),R=y.getVerticesData(k.c.UVKind),G=y.hg(),z=P.length/9;let T=0,Q=0,m=0,a=0,w=0;const o=[0];if(j)for(let p=z;p<P.length/3;p+=4)Q=P[3*(p+2)]-P[3*p],m=P[3*(p+2)+2]-P[3*p+2],a=Math.sqrt(Q*Q+m*m),w+=a,o.push(w);let I=0,Y=0;for(let p=0;p<B.length;p+=3)Math.abs(B[p+1])<.001&&(Y=1),Math.abs(B[p+1]-1)<.001&&(Y=0),Math.abs(B[p+1]+1)<.001&&(Y=2),I=p/3,1===Y?(T=I-z,R[2*I]=T%4<1.5?j?Z[Y].x+(Z[Y].z-Z[Y].x)*o[Math.floor(T/4)]/w:Z[Y].x:j?Z[Y].x+(Z[Y].z-Z[Y].x)*o[Math.floor(T/4)+1]/w:Z[Y].z,R[2*I+1]=T%2===0?H.d?1-Z[Y].w:Z[Y].w:H.d?1-Z[Y].y:Z[Y].y):(R[2*I]=(1-R[2*I])*Z[Y].x+R[2*I]*Z[Y].z,R[2*I+1]=(1-R[2*I+1])*Z[Y].y+R[2*I+1]*Z[Y].w,H.d&&(R[2*I+1]=1-R[2*I+1])),q&&W.push(q[Y].r,q[Y].g,q[Y].b,q[Y].a);i.e._ComputeSides(g,P,G,B,R,U,l);const n=new i.e;if(n.indices=G,n.xa=P,n.ya=B,n.Aa=R,q){const y=g===i.e.DOUBLESIDE?W.concat(W):W;n.za=y}return n}function u(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation);const i=g.shape,H=g.holes||[],U=g.depth||0,l=g.smoothingThreshold||2,c=[];let Z=[];for(let S=0;S<i.length;S++)c[S]=new p.l(i[S].x,i[S].z);c[0].equalsWithEpsilon(c[c.length-1],1e-8)&&c.pop();const C=new b(y,c,f||M.d.LastCreatedScene,k);for(let S=0;S<H.length;S++){Z=[];for(let y=0;y<H[S].length;y++)Z.push(new p.l(H[S][y].x,H[S][y].z));C.addHole(Z)}const q=C.build(!1,U,l);q._originalBuilderSideOrientation=g.sideOrientation;return s(q,g.sideOrientation,g.faceUV,g.faceColors,g.frontUVs,g.backUVs,g.wrap).Ca(q,g.updatable),q}function F(y,g){return u(y,g,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function A(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=g.path,k=g.shape,i=g.scale||1,H=g.rotation||0,U=0===g.cap?0:g.cap||S.e.NO_CAP,l=g.updatable,c=S.e._GetDefaultSideOrientation(g.sideOrientation),Z=g.instance||null,C=g.invertUV||!1,q=g.closeShape||!1;return V(y,k,p,i,H,null,null,g.closePath||!1,q,U,!1,f,!!l,c,Z,C,g.frontUVs||null,g.backUVs||null,g.firstNormal||null,!!g.adjustFrame)}function J(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=g.path,k=g.shape,i=g.scaleFunction||(()=>1),H=g.rotationFunction||(()=>0),U=g.closePath||g.ribbonCloseArray||!1,l=g.closeShape||g.ribbonClosePath||!1,c=0===g.cap?0:g.cap||S.e.NO_CAP,Z=g.updatable,C=g.firstNormal||null,q=g.adjustFrame||!1;return V(y,k,p,null,null,i,H,U,l,c,!0,f,!!Z,S.e._GetDefaultSideOrientation(g.sideOrientation),g.instance||null,g.invertUV||!1,g.frontUVs||null,g.backUVs||null,C,q)}function V(y,g,f,k,i,H,U,c,Z,C,q,W,j,P,B,R,G,z,T,Q){const m=(y,g,f,k,i,H,U,l,c,Z,C)=>{const q=f.getTangents(),W=f.getNormals(),j=f.getBinormals(),P=f.getDistances();if(C)for(let S=0;S<q.length;S++)if(0==q[S].x&&0==q[S].y&&0==q[S].z&&q[S].p(q[S-1]),0==W[S].x&&0==W[S].y&&0==W[S].z&&W[S].p(W[S-1]),0==j[S].x&&0==j[S].y&&0==j[S].z&&j[S].p(j[S-1]),S>0){let y=q[S-1];p.m.Dot(y,q[S])<0&&q[S].scaleInPlace(-1),y=W[S-1],p.m.Dot(y,W[S])<0&&W[S].scaleInPlace(-1),y=j[S-1],p.m.Dot(y,j[S])<0&&j[S].scaleInPlace(-1)}let B=0;const R=Z&&l?l:()=>null!==H?H:0,G=Z&&U?U:()=>null!==i?i:1;let z=c===S.e.NO_CAP||c===S.e.CAP_END?0:2;const T=p.j.Matrix[0];for(let S=0;S<g.length;S++){const f=[],i=R(S,P[S]),H=G(S,P[S]);p.c.RotationAxisToRef(q[S],B,T);for(let k=0;k<y.length;k++){const i=q[S].scale(y[k].z).add(W[S].scale(y[k].x)).add(j[S].scale(y[k].y)),U=p.m.Zero();p.m.TransformCoordinatesToRef(i,T,U),U.scaleInPlace(H).addInPlace(g[S]),f[k]=U}k[z]=f,B+=i,z++}const Q=y=>{const g=Array(),f=p.m.Zero();let S;for(S=0;S<y.length;S++)f.addInPlace(y[S]);for(f.scaleInPlace(1/y.length),S=0;S<y.length;S++)g.push(f);return g};switch(c){case S.e.NO_CAP:break;case S.e.CAP_START:k[0]=Q(k[2]),k[1]=k[2];break;case S.e.CAP_END:k[z]=k[z-1],k[z+1]=Q(k[z-1]);break;case S.e.CAP_ALL:k[0]=Q(k[2]),k[1]=k[2],k[z]=k[z-1],k[z+1]=Q(k[z-1])}return k};let a,w;if(B){const y=B._creationDataStorage;return a=T?y.path3D.update(f,T):y.path3D.update(f),w=m(g,f,y.path3D,y.pathArray,k,i,H,U,y.cap,q,Q),B=l("",{pathArray:w,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},W||void 0)}a=T?new Y.f(f,T):new Y.f(f);w=m(g,f,a,new Array,k,i,H,U,C=C<0||C>3?0:C,q,Q);const o=l(y,{pathArray:w,closeArray:c,closePath:Z,updatable:j,sideOrientation:P,invertUV:R,frontUVs:G||void 0,backUVs:z||void 0},W);return o._creationDataStorage.pathArray=w,o._creationDataStorage.path3D=a,o._creationDataStorage.cap=C,o}i.e.CreatePolygon=s,S.e.CreatePolygon=function(y,g,f,p,S,k){return u(y,{shape:g,holes:p,updatable:S,sideOrientation:k},f,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},S.e.ExtrudePolygon=function(y,g,f,p,S,k,i){return F(y,{shape:g,holes:S,depth:f,updatable:k,sideOrientation:i},p,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function e(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=g.arc?g.arc<=0||g.arc>1?1:g.arc:1,i=void 0===g.closed||g.closed,H=g.shape,U=g.radius||1,c=g.tessellation||64,Z=g.clip||0,C=g.updatable,q=S.e._GetDefaultSideOrientation(g.sideOrientation),W=g.cap||S.e.NO_CAP,j=2*Math.PI,P=[],B=g.invertUV||!1;let R=0,G=0;const z=j/c*k;let T,Q;for(R=0;R<=c-Z;R++){for(Q=[],W!=S.e.CAP_START&&W!=S.e.CAP_ALL||(Q.push(new p.m(0,H[0].y,0)),Q.push(new p.m(Math.cos(R*z)*H[0].x*U,H[0].y,Math.sin(R*z)*H[0].x*U))),G=0;G<H.length;G++)T=new p.m(Math.cos(R*z)*H[G].x*U,H[G].y,Math.sin(R*z)*H[G].x*U),Q.push(T);W!=S.e.CAP_END&&W!=S.e.CAP_ALL||(Q.push(new p.m(Math.cos(R*z)*H[H.length-1].x*U,H[H.length-1].y,Math.sin(R*z)*H[H.length-1].x*U)),Q.push(new p.m(0,H[H.length-1].y,0))),P.push(Q)}return l(y,{pathArray:P,closeArray:i,sideOrientation:q,updatable:C,invertUV:B,frontUVs:g.frontUVs,backUVs:g.backUVs},f)}S.e.ExtrudeShape=function(y,g,f,p,k,i){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0;return A(y,{shape:g,path:f,scale:p,rotation:k,cap:0===i?0:i||S.e.NO_CAP,sideOrientation:l,instance:c,updatable:U},H)},S.e.ExtrudeShapeCustom=(y,g,f,p,k,i,H,U,l,c,Z,C)=>J(y,{shape:g,path:f,scaleFunction:p,rotationFunction:k,ribbonCloseArray:i,ribbonClosePath:H,cap:0===U?0:U||S.e.NO_CAP,sideOrientation:Z,instance:C,updatable:c},l);S.e.CreateLathe=(y,g,f,p,S,k,i)=>e(y,{shape:g,radius:f,tessellation:p,sideOrientation:i,updatable:k},S);var h=f(11449),D=f(11396);function K(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=g.path;let i=g.instance,H=1;void 0!==g.radius?H=g.radius:i&&(H=i._creationDataStorage.radius);const U=g.tessellation||64,c=g.radiusFunction||null;let Z=g.cap||S.e.NO_CAP;const C=g.invertUV||!1,q=g.updatable,W=S.e._GetDefaultSideOrientation(g.sideOrientation);g.arc=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1;const j=(y,g,f,k,i,H,U,l)=>{const c=g.getTangents(),Z=g.getNormals(),C=g.getDistances(),q=2*Math.PI/i*l,W=H||(()=>k);let j,P,B,R;const G=p.j.Matrix[0];let z=U===S.e.NO_CAP||U===S.e.CAP_END?0:2;for(let S=0;S<y.length;S++){P=W(S,C[S]),j=Array(),B=Z[S];for(let g=0;g<i;g++)p.c.RotationAxisToRef(c[S],q*g,G),R=j[g]?j[g]:p.m.Zero(),p.m.TransformCoordinatesToRef(B,G,R),R.scaleInPlace(P).addInPlace(y[S]),j[g]=R;f[z]=j,z++}const T=(g,f)=>{const p=Array();for(let S=0;S<g;S++)p.push(y[f]);return p};switch(U){case S.e.NO_CAP:break;case S.e.CAP_START:f[0]=T(i,0),f[1]=f[2].slice(0);break;case S.e.CAP_END:f[z]=f[z-1].slice(0),f[z+1]=T(i,y.length-1);break;case S.e.CAP_ALL:f[0]=T(i,0),f[1]=f[2].slice(0),f[z]=f[z-1].slice(0),f[z+1]=T(i,y.length-1)}return f};let P,B;if(i){const y=i._creationDataStorage,f=g.arc||y.arc;return P=y.path3D.update(k),B=j(k,P,y.pathArray,H,y.tessellation,c,y.cap,f),i=l("",{pathArray:B,instance:i}),y.path3D=P,y.pathArray=B,y.arc=f,y.radius=H,i}P=new Y.f(k);Z=Z<0||Z>3?0:Z,B=j(k,P,new Array,H,U,c,Z,g.arc);const R=l(y,{pathArray:B,closePath:!0,closeArray:!1,updatable:q,sideOrientation:W,invertUV:C,frontUVs:g.frontUVs,backUVs:g.backUVs},f);return R._creationDataStorage.pathArray=B,R._creationDataStorage.path3D=P,R._creationDataStorage.tessellation=U,R._creationDataStorage.cap=Z,R._creationDataStorage.arc=g.arc,R._creationDataStorage.radius=H,R}function X(y){const g=[];g[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},g[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},g[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},g[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},g[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},g[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},g[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},g[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},g[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},g[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},g[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},g[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},g[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},g[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},g[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const f=y.type&&(y.type<0||y.type>=g.length)?0:y.type||0,S=y.size,k=y.sizeX||S||1,U=y.sizeY||S||1,l=y.sizeZ||S||1,c=y.custom||g[f],Z=c.face.length,q=y.faceUV||new Array(Z),W=y.faceColors,j=void 0===y.flat||y.flat,P=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,B=[],R=[],G=[],z=[],T=[];let Q=0,m=0;const a=[];let w,o,I,Y,n,M,r=0,N=0;if(j)for(N=0;N<Z;N++)W&&void 0===W[N]&&(W[N]=new C.f(1,1,1,1)),q&&void 0===q[N]&&(q[N]=new p.o(0,0,1,1));if(j)for(N=0;N<Z;N++){const y=c.face[N].length;for(I=2*Math.PI/y,Y=.5*Math.tan(I/2),n=.5,r=0;r<y;r++)B.push(c.vertex[c.face[N][r]][0]*k,c.vertex[c.face[N][r]][1]*U,c.vertex[c.face[N][r]][2]*l),a.push(Q),Q++,w=q[N].x+(q[N].z-q[N].x)*(.5+Y),o=q[N].y+(q[N].w-q[N].y)*(n-.5),z.push(w,H.d?1-o:o),M=Y*Math.cos(I)-n*Math.sin(I),n=Y*Math.sin(I)+n*Math.cos(I),Y=M,W&&T.push(W[N].r,W[N].g,W[N].b,W[N].a);for(r=0;r<y-2;r++)R.push(a[0+m],a[r+2+m],a[r+1+m]);m+=y}else{for(r=0;r<c.vertex.length;r++)B.push(c.vertex[r][0]*k,c.vertex[r][1]*U,c.vertex[r][2]*l),z.push(0,H.d?1:0);for(N=0;N<Z;N++)for(r=0;r<c.face[N].length-2;r++)R.push(c.face[N][0],c.face[N][r+2],c.face[N][r+1])}i.e.ComputeNormals(B,R,G),i.e._ComputeSides(P,B,R,G,z,y.frontUVs,y.backUVs);const b=new i.e;return b.xa=B,b.indices=R,b.ya=G,b.Aa=z,W&&j&&(b.za=T),b}function E(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return X(g).Ca(p,g.updatable),p}S.e.CreateTube=(y,g,f,p,S,k,i,H,U,l)=>K(y,{path:g,radius:f,tessellation:p,radiusFunction:S,arc:1,cap:k,updatable:H,sideOrientation:U,instance:l},i);function O(y){const g=y.sideOrientation||i.e.DEFAULTSIDE,f=y.radius||1,S=void 0===y.flat||y.flat,k=0|(y.subdivisions||4),U=y.radiusX||f,l=y.radiusY||f,c=y.radiusZ||f,Z=(1+Math.sqrt(5))/2,C=[-1,Z,-0,1,Z,0,-1,-Z,0,1,-Z,0,0,-1,-Z,0,1,-Z,0,-1,Z,0,1,Z,Z,0,1,Z,0,-1,-Z,0,1,-Z,0,-1],q=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],W=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],j=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],P=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],R=[],G=[],z=[];let T=0;const Q=new Array(3),m=new Array(3);let a;for(a=0;a<3;a++)Q[a]=p.m.Zero(),m[a]=p.l.Zero();for(let i=0;i<20;i++){for(a=0;a<3;a++){const y=q[3*i+a];Q[a].ne(C[3*W[y]],C[3*W[y]+1],C[3*W[y]+2]),Q[a].normalize(),m[a].ne(.134765625*j[2*y]+.05859375+-.0390625*P[i],.2333984375*j[2*y+1]+.025390625+.01953125*P[i])}const y=(y,g,f,i)=>{const Z=p.m.Lerp(Q[0],Q[2],g/k),C=p.m.Lerp(Q[1],Q[2],g/k),q=k===g?Q[2]:p.m.Lerp(Z,C,y/(k-g));let W;if(q.normalize(),S){const y=p.m.Lerp(Q[0],Q[2],i/k),g=p.m.Lerp(Q[1],Q[2],i/k);W=p.m.Lerp(y,g,f/(k-i))}else W=new p.m(q.x,q.y,q.z);W.x/=U,W.y/=l,W.z/=c,W.normalize();const j=p.l.Lerp(m[0],m[2],g/k),P=p.l.Lerp(m[1],m[2],g/k),a=k===g?m[2]:p.l.Lerp(j,P,y/(k-g));R.push(q.x*U,q.y*l,q.z*c),G.push(W.x,W.y,W.z),z.push(a.x,H.d?1-a.y:a.y),B.push(T),T++};for(let g=0;g<k;g++)for(let f=0;f+g<k;f++)y(f,g,f+1/3,g+1/3),y(f+1,g,f+1/3,g+1/3),y(f,g+1,f+1/3,g+1/3),f+g+1<k&&(y(f+1,g,f+2/3,g+2/3),y(f+1,g+1,f+2/3,g+2/3),y(f,g+1,f+2/3,g+2/3))}i.e._ComputeSides(g,R,B,G,z,y.frontUVs,y.backUVs);const w=new i.e;return w.indices=B,w.xa=R,w.ya=G,w.Aa=z,w}function L(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new S.e(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),p._originalBuilderSideOrientation=g.sideOrientation;return O(g).Ca(p,g.updatable),p}i.e.CreatePolyhedron=X,S.e.CreatePolyhedron=(y,g,f)=>E(y,g,f);i.e.CreateIcoSphere=O,S.e.CreateIcoSphere=(y,g,f)=>L(y,g,f);var x=f(11079);const d=new p.m(1,0,0),t=new p.m(-1,0,0),v=new p.m(0,1,0),yy=new p.m(0,-1,0),gy=new p.m(0,0,1),fy=new p.m(0,0,-1);class py{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.m.Zero(),g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.m.Up(),f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.l.Zero(),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=y,this.k=g,this.uv=f,this.vertexIdx=S,this.vertexIdxForBones=k,this.localPositionOverride=i,this.localNormalOverride=H,this.matrixIndicesOverride=U,this.matrixWeightsOverride=l}clone(){var y,g,f,p;return new py(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(y=this.localPositionOverride)||void 0===y?void 0:y.slice(),null===(g=this.localNormalOverride)||void 0===g?void 0:g.slice(),null===(f=this.matrixIndicesOverride)||void 0===f?void 0:f.slice(),null===(p=this.matrixWeightsOverride)||void 0===p?void 0:p.slice())}}function Sy(y,g,f){var U,l,c,Z;const C=!!g.skeleton,q=f.localMode||C,W=g.hg(),j=C?g.Zd(!0,!0):g.getVerticesData(k.c.PositionKind),P=C?g.getNormalsData(!0,!0):g.getVerticesData(k.c.NormalKind),B=q?C?g.getVerticesData(k.c.PositionKind):j:null,R=q?C?g.getVerticesData(k.c.NormalKind):P:null,G=g.getVerticesData(k.c.UVKind),z=C?g.getVerticesData(k.c.MatricesIndicesKind):null,T=C?g.getVerticesData(k.c.MatricesWeightsKind):null,Q=C?g.getVerticesData(k.c.MatricesIndicesExtraKind):null,m=C?g.getVerticesData(k.c.MatricesWeightsExtraKind):null,a=f.position||p.m.Zero();let w=f.k||p.m.Up();const o=f.size||p.m.One(),I=f.angle||0;if(!w){const y=new p.m(0,0,1),f=g.va().activeCamera,S=p.m.TransformCoordinates(y,f.getWorldMatrix());w=f.globalPosition.ed(S)}const Y=-Math.atan2(w.z,w.x)-Math.PI/2,n=Math.sqrt(w.x*w.x+w.z*w.z),M=Math.atan2(w.y,n),r=new i.e;r.indices=[],r.xa=[],r.ya=[],r.Aa=[],r.matricesIndices=C?[]:null,r.matricesWeights=C?[]:null,r.matricesIndicesExtra=Q?[]:null,r.matricesWeightsExtra=m?[]:null;let N=0;const b=(y,g)=>{const S=new py;if(!W||!j||!P)return S;const k=W[y];if(S.vertexIdx=3*k,S.vertexIdxForBones=4*k,S.position=new p.m(j[3*k],j[3*k+1],j[3*k+2]),p.m.TransformCoordinatesToRef(S.position,g,S.position),S.k=new p.m(P[3*k],P[3*k+1],P[3*k+2]),p.m.TransformNormalToRef(S.k,g,S.k),f.captureUVS&&G){const y=G[2*k+1];S.uv=new p.l(G[2*k],H.d?1-y:y)}return S},s=[0,0,0,0],u=(y,g)=>{if(0===y.length)return y;const f=.5*Math.abs(p.m.Dot(o,g)),S=(y,g,f,p)=>{for(let S=0;S<p;++S)if(y[f+S]===g)return f+S;return-1},k=(y,k)=>{const i=p.m.GetClipFactor(y.position,k.position,g,f);let H=s,U=s;if(z&&T){const g=y.matrixIndicesOverride?0:y.vertexIdxForBones,f=y.matrixIndicesOverride??z,p=y.matrixWeightsOverride??T,l=k.matrixIndicesOverride?0:k.vertexIdxForBones,c=k.matrixIndicesOverride??z,Z=k.matrixWeightsOverride??T;H=[0,0,0,0],U=[0,0,0,0];let C=0;for(let y=0;y<4;++y)if(p[g+y]>0){const k=S(c,f[g+y],l,4);H[C]=f[g+y],U[C]=(0,x.n)(p[g+y],k>=0?Z[k]:0,i),C++}for(let y=0;y<4&&C<4;++y){const p=c[l+y];-1===S(f,p,g,4)&&(H[C]=p,U[C]=(0,x.n)(0,Z[l+y],i),C++)}const q=U[0]+U[1]+U[2]+U[3];U[0]/=q,U[1]/=q,U[2]/=q,U[3]/=q}const l=y.localPositionOverride?y.localPositionOverride[0]:(null===B||void 0===B?void 0:B[y.vertexIdx])??0,c=y.localPositionOverride?y.localPositionOverride[1]:(null===B||void 0===B?void 0:B[y.vertexIdx+1])??0,Z=y.localPositionOverride?y.localPositionOverride[2]:(null===B||void 0===B?void 0:B[y.vertexIdx+2])??0,C=k.localPositionOverride?k.localPositionOverride[0]:(null===B||void 0===B?void 0:B[k.vertexIdx])??0,q=k.localPositionOverride?k.localPositionOverride[1]:(null===B||void 0===B?void 0:B[k.vertexIdx+1])??0,W=k.localPositionOverride?k.localPositionOverride[2]:(null===B||void 0===B?void 0:B[k.vertexIdx+2])??0,j=y.localNormalOverride?y.localNormalOverride[0]:(null===R||void 0===R?void 0:R[y.vertexIdx])??0,P=y.localNormalOverride?y.localNormalOverride[1]:(null===R||void 0===R?void 0:R[y.vertexIdx+1])??0,G=y.localNormalOverride?y.localNormalOverride[2]:(null===R||void 0===R?void 0:R[y.vertexIdx+2])??0,Q=j+((k.localNormalOverride?k.localNormalOverride[0]:(null===R||void 0===R?void 0:R[k.vertexIdx])??0)-j)*i,m=P+((k.localNormalOverride?k.localNormalOverride[1]:(null===R||void 0===R?void 0:R[k.vertexIdx+1])??0)-P)*i,a=G+((k.localNormalOverride?k.localNormalOverride[2]:(null===R||void 0===R?void 0:R[k.vertexIdx+2])??0)-G)*i,w=Math.sqrt(Q*Q+m*m+a*a);return new py(p.m.Lerp(y.position,k.position,i),p.m.Lerp(y.k,k.k,i).normalize(),p.l.Lerp(y.uv,k.uv,i),-1,-1,B?[l+(C-l)*i,c+(q-c)*i,Z+(W-Z)*i]:null,R?[Q/w,m/w,a/w]:null,H,U)};let i=null;y.length>3&&(i=[]);for(let H=0;H<y.length;H+=3){let S=0,U=null,l=null,c=null,Z=null;const C=p.m.Dot(y[H].position,g)-f>0,q=p.m.Dot(y[H+1].position,g)-f>0,W=p.m.Dot(y[H+2].position,g)-f>0;switch(S=(C?1:0)+(q?1:0)+(W?1:0),S){case 0:y.length>3?(i.push(y[H]),i.push(y[H+1]),i.push(y[H+2])):i=y;break;case 1:if(i=i??new Array,C&&(U=y[H+1],l=y[H+2],c=k(y[H],U),Z=k(y[H],l)),q){U=y[H],l=y[H+2],c=k(y[H+1],U),Z=k(y[H+1],l),i.push(c),i.push(l.clone()),i.push(U.clone()),i.push(l.clone()),i.push(c.clone()),i.push(Z);break}W&&(U=y[H],l=y[H+1],c=k(y[H+2],U),Z=k(y[H+2],l)),U&&l&&c&&Z&&(i.push(U.clone()),i.push(l.clone()),i.push(c),i.push(Z),i.push(c.clone()),i.push(l.clone()));break;case 2:i=i??new Array,C||(U=y[H].clone(),l=k(U,y[H+1]),c=k(U,y[H+2]),i.push(U),i.push(l),i.push(c)),q||(U=y[H+1].clone(),l=k(U,y[H+2]),c=k(U,y[H]),i.push(U),i.push(l),i.push(c)),W||(U=y[H+2].clone(),l=k(U,y[H]),c=k(U,y[H+1]),i.push(U),i.push(l),i.push(c))}}return i},F=g instanceof S.e?g:null,A=null===F||void 0===F?void 0:F._thinInstanceDataStorage.matrixData,J=(null===F||void 0===F?void 0:F.Rb)||1,V=p.j.Matrix[0];V.p(p.c.IdentityReadOnly);for(let S=0;S<J;++S){if(null!==F&&void 0!==F&&F.hasThinInstances&&A){const y=16*S;V.setRowFromFloats(0,A[y+0],A[y+1],A[y+2],A[y+3]),V.setRowFromFloats(1,A[y+4],A[y+5],A[y+6],A[y+7]),V.setRowFromFloats(2,A[y+8],A[y+9],A[y+10],A[y+11]),V.setRowFromFloats(3,A[y+12],A[y+13],A[y+14],A[y+15])}const y=p.c.RotationYawPitchRoll(Y,M,I).multiply(p.c.Translation(a.x,a.y,a.z)),k=p.c.Invert(y),i=g.getWorldMatrix(),U=V.multiply(i).multiply(k),l=new Array(3);for(let g=0;g<W.length;g+=3){let y=l;if(y[0]=b(g,U),y[1]=b(g+1,U),y[2]=b(g+2,U),!(f.cullBackFaces&&-y[0].k.z<=0&&-y[1].k.z<=0&&-y[2].k.z<=0)&&(y=u(y,d),y&&(y=u(y,t),y&&(y=u(y,v),y&&(y=u(y,yy),y&&(y=u(y,gy),y&&(y=u(y,fy),y)))))))for(let g=0;g<y.length;g++){const p=y[g];if(r.indices.push(N),q?(p.localPositionOverride?(r.xa[3*N]=p.localPositionOverride[0],r.xa[3*N+1]=p.localPositionOverride[1],r.xa[3*N+2]=p.localPositionOverride[2]):B&&(r.xa[3*N]=B[p.vertexIdx],r.xa[3*N+1]=B[p.vertexIdx+1],r.xa[3*N+2]=B[p.vertexIdx+2]),p.localNormalOverride?(r.ya[3*N]=p.localNormalOverride[0],r.ya[3*N+1]=p.localNormalOverride[1],r.ya[3*N+2]=p.localNormalOverride[2]):R&&(r.ya[3*N]=R[p.vertexIdx],r.ya[3*N+1]=R[p.vertexIdx+1],r.ya[3*N+2]=R[p.vertexIdx+2])):(p.position.toArray(r.xa,3*N),p.k.toArray(r.ya,3*N)),r.matricesIndices&&r.matricesWeights&&(p.matrixIndicesOverride?(r.matricesIndices[4*N]=p.matrixIndicesOverride[0],r.matricesIndices[4*N+1]=p.matrixIndicesOverride[1],r.matricesIndices[4*N+2]=p.matrixIndicesOverride[2],r.matricesIndices[4*N+3]=p.matrixIndicesOverride[3]):(z&&(r.matricesIndices[4*N]=z[p.vertexIdxForBones],r.matricesIndices[4*N+1]=z[p.vertexIdxForBones+1],r.matricesIndices[4*N+2]=z[p.vertexIdxForBones+2],r.matricesIndices[4*N+3]=z[p.vertexIdxForBones+3]),Q&&r.matricesIndicesExtra&&(r.matricesIndicesExtra[4*N]=Q[p.vertexIdxForBones],r.matricesIndicesExtra[4*N+1]=Q[p.vertexIdxForBones+1],r.matricesIndicesExtra[4*N+2]=Q[p.vertexIdxForBones+2],r.matricesIndicesExtra[4*N+3]=Q[p.vertexIdxForBones+3])),p.matrixWeightsOverride?(r.matricesWeights[4*N]=p.matrixWeightsOverride[0],r.matricesWeights[4*N+1]=p.matrixWeightsOverride[1],r.matricesWeights[4*N+2]=p.matrixWeightsOverride[2],r.matricesWeights[4*N+3]=p.matrixWeightsOverride[3]):(T&&(r.matricesWeights[4*N]=T[p.vertexIdxForBones],r.matricesWeights[4*N+1]=T[p.vertexIdxForBones+1],r.matricesWeights[4*N+2]=T[p.vertexIdxForBones+2],r.matricesWeights[4*N+3]=T[p.vertexIdxForBones+3]),m&&r.matricesWeightsExtra&&(r.matricesWeightsExtra[4*N]=m[p.vertexIdxForBones],r.matricesWeightsExtra[4*N+1]=m[p.vertexIdxForBones+1],r.matricesWeightsExtra[4*N+2]=m[p.vertexIdxForBones+2],r.matricesWeightsExtra[4*N+3]=m[p.vertexIdxForBones+3]))),f.captureUVS)p.uv.toArray(r.Aa,2*N);else{r.Aa.push(.5+p.position.x/o.x);const y=.5+p.position.y/o.y;r.Aa.push(H.d?1-y:y)}N++}}}0===r.indices.length&&(r.indices=null),0===r.xa.length&&(r.xa=null),0===r.ya.length&&(r.ya=null),0===r.Aa.length&&(r.Aa=null),0===(null===(U=r.matricesIndices)||void 0===U?void 0:U.length)&&(r.matricesIndices=null),0===(null===(l=r.matricesWeights)||void 0===l?void 0:l.length)&&(r.matricesWeights=null),0===(null===(c=r.matricesIndicesExtra)||void 0===c?void 0:c.length)&&(r.matricesIndicesExtra=null),0===(null===(Z=r.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(r.matricesWeightsExtra=null);const e=new S.e(y,g.va());return r.Ca(e),q?(e.skeleton=g.skeleton,e.parent=g):(e.position=a.clone(),e.rotation=new p.m(M,Y,I)),e.Sj(!0),e.refreshBoundingInfo(!0,!0),e}function ky(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const g=0|Math.max(y.subdivisions?y.subdivisions:2,1),f=0|Math.max(y.tessellation?y.tessellation:16,3),S=Math.max(y.height?y.height:1,0),k=Math.max(y.radius?y.radius:.25,0),U=0|Math.max(y.capSubdivisions?y.capSubdivisions:6,1),l=f,c=g,Z=Math.max(y.radiusTop?y.radiusTop:k,0),C=Math.max(y.radiusBottom?y.radiusBottom:k,0),q=S-(Z+C),W=2*Math.PI,j=Math.max(y.topCapSubdivisions?y.topCapSubdivisions:U,1),P=Math.max(y.bottomCapSubdivisions?y.bottomCapSubdivisions:U,1),B=Math.acos((C-Z)/S);let R=[];const G=[],z=[],T=[];let Q=0;const m=[],a=.5*q,w=.5*Math.PI;let o,I;const Y=p.m.Zero(),n=p.m.Zero(),M=Math.cos(B),r=Math.sin(B),N=new p.l(Z*r,a+Z*M).ed(new p.l(C*r,C*M-a)).length(),b=Z*B+N+C*(w-B);let s=0;for(I=0;I<=j;I++){const y=[],g=w-B*(I/j);s+=Z*B/j;const f=Math.cos(g),p=Math.sin(g),S=f*Z;for(o=0;o<=l;o++){const g=o/l,k=g*W+0,i=Math.sin(k),U=Math.cos(k);n.x=S*i,n.y=a+p*Z,n.z=S*U,G.push(n.x,n.y,n.z),Y.set(f*i,p,f*U),z.push(Y.x,Y.y,Y.z),T.push(g,H.d?s/b:1-s/b),y.push(Q),Q++}m.push(y)}const u=S-Z-C+M*Z-M*C,F=r*(C-Z)/u;for(I=1;I<=c;I++){const y=[];s+=N/c;const g=r*(I*(C-Z)/c+Z);for(o=0;o<=l;o++){const f=o/l,p=f*W+0,S=Math.sin(p),k=Math.cos(p);n.x=g*S,n.y=a+M*Z-I*u/c,n.z=g*k,G.push(n.x,n.y,n.z),Y.set(S,F,k).normalize(),z.push(Y.x,Y.y,Y.z),T.push(f,H.d?s/b:1-s/b),y.push(Q),Q++}m.push(y)}for(I=1;I<=P;I++){const y=[],g=w-B-(Math.PI-B)*(I/P);s+=C*B/P;const f=Math.cos(g),p=Math.sin(g),S=f*C;for(o=0;o<=l;o++){const g=o/l,k=g*W+0,i=Math.sin(k),U=Math.cos(k);n.x=S*i,n.y=p*C-a,n.z=S*U,G.push(n.x,n.y,n.z),Y.set(f*i,p,f*U),z.push(Y.x,Y.y,Y.z),T.push(g,H.d?s/b:1-s/b),y.push(Q),Q++}m.push(y)}for(o=0;o<l;o++)for(I=0;I<j+c+P;I++){const y=m[I][o],g=m[I+1][o],f=m[I+1][o+1],p=m[I][o+1];R.push(y),R.push(g),R.push(p),R.push(g),R.push(f),R.push(p)}if(R=R.reverse(),y.orientation&&!y.orientation.equals(p.m.Up())){const g=new p.c;y.orientation.clone().scale(.5*Math.PI).cross(p.m.Up()).toQuaternion().toRotationMatrix(g);const f=p.m.Zero();for(let y=0;y<G.length;y+=3)f.set(G[y],G[y+1],G[y+2]),p.m.TransformCoordinatesToRef(f.clone(),g,f),G[y]=f.x,G[y+1]=f.y,G[y+2]=f.z}const A=new i.e;return A.xa=G,A.ya=z,A.Aa=T,A.indices=R,A}function iy(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:p.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new S.e(y,f);return ky(g).Ca(k,g.updatable),k}S.e.CreateDecal=(y,g,f,p,S,k)=>Sy(y,g,{position:f,k:p,size:S,angle:k});S.e.CreateCapsule=(y,g,f)=>iy(y,g,f),i.e.CreateCapsule=ky;class Hy{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=y,this.y=g,y!==Math.floor(y)&&(y=Math.floor(y),I.d.Warn("x is not an integer, floor(x) used")),g!==Math.floor(g)&&(g=Math.floor(g),I.d.Warn("y is not an integer, floor(y) used"))}clone(){return new Hy(this.x,this.y)}rotate60About(y){const g=this.x;return this.x=y.x+y.y-this.y,this.y=g+this.y-y.x,this}rotateNeg60About(y){const g=this.x;return this.x=g+this.y-y.y,this.y=y.x+y.y-g,this}rotate120(y,g){y!==Math.floor(y)&&(y=Math.floor(y),I.d.Warn("m not an integer only floor(m) used")),g!==Math.floor(g)&&(g=Math.floor(g),I.d.Warn("n not an integer only floor(n) used"));const f=this.x;return this.x=y-f-this.y,this.y=g+f,this}rotateNeg120(y,g){y!==Math.floor(y)&&(y=Math.floor(y),I.d.Warn("m is not an integer, floor(m) used")),g!==Math.floor(g)&&(g=Math.floor(g),I.d.Warn("n is not an integer,   floor(n) used"));const f=this.x;return this.x=this.y-g,this.y=y+g-f-this.y,this}toCartesianOrigin(y,g){const f=p.m.Zero();return f.x=y.x+2*this.x*g+this.y*g,f.y=y.y+Math.sqrt(3)*this.y*g,f}static Zero(){return new Hy(0,0)}}class Uy{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ly("icosahedron","Regular",[[0,n.g,-1],[-n.g,1,0],[-1,0,-n.g],[1,0,-n.g],[n.g,1,0],[0,n.g,1],[-1,0,n.g],[-n.g,-1,0],[0,-n.g,-1],[n.g,-1,0],[1,0,n.g],[0,-n.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let y=12;const g={},f=this.m,p=this.n;let S,k,i,H,U,l=f,c=1,Z=0;0!==p&&(l=(0,x.j)(f,p)),c=f/l,Z=p/l;const C=Hy.Zero(),q=new Hy(f,p),W=new Hy(-p,f+p),j=Hy.Zero(),P=Hy.Zero(),B=Hy.Zero();let R,G,z,T,Q=[];const m=[],a=this.vertByDist,w=(f,p,S,k)=>{R=f+"|"+S,G=p+"|"+k,R in g||G in g?R in g&&!(G in g)?g[G]=g[R]:G in g&&!(R in g)&&(g[R]=g[G]):(g[R]=y,g[G]=y,y++),a[S][0]>2?m[g[R]]=[-a[S][0],a[S][1],g[R]]:m[g[R]]=[Q[a[S][0]],a[S][1],g[R]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let o=0;o<20;o++){if(Q=this.IDATA.face[o],i=Q[2],H=Q[1],U=Q[0],z=C.x+"|"+C.y,R=o+"|"+z,R in g||(g[R]=i,m[i]=[Q[a[z][0]],a[z][1]]),z=q.x+"|"+q.y,R=o+"|"+z,R in g||(g[R]=H,m[H]=[Q[a[z][0]],a[z][1]]),z=W.x+"|"+W.y,R=o+"|"+z,R in g||(g[R]=U,m[U]=[Q[a[z][0]],a[z][1]]),S=this.IDATA.edgematch[o][0],k=this.IDATA.edgematch[o][1],"B"===k)for(let y=1;y<l;y++)P.x=f-y*(c+Z),P.y=p+y*c,B.x=-y*Z,B.y=y*(c+Z),z=P.x+"|"+P.y,T=B.x+"|"+B.y,w(o,S,z,T);if("O"===k)for(let y=1;y<l;y++)B.x=-y*Z,B.y=y*(c+Z),j.x=y*c,j.y=y*Z,z=B.x+"|"+B.y,T=j.x+"|"+j.y,w(o,S,z,T);if(S=this.IDATA.edgematch[o][2],k=this.IDATA.edgematch[o][3],k&&"A"===k)for(let y=1;y<l;y++)j.x=y*c,j.y=y*Z,P.x=f-(l-y)*(c+Z),P.y=p+(l-y)*c,z=j.x+"|"+j.y,T=P.x+"|"+P.y,w(o,S,z,T);for(let f=0;f<this.vertices.length;f++)z=this.vertices[f].x+"|"+this.vertices[f].y,R=o+"|"+z,R in g||(g[R]=y++,a[z][0]>2?m[g[R]]=[-a[z][0],a[z][1],g[R]]:m[g[R]]=[Q[a[z][0]],a[z][1],g[R]])}this.closestTo=m,this.vecToidx=g}calcCoeffs(){const y=this.m,g=this.n,f=Math.sqrt(3)/3,p=y*y+g*g+y*g;this.coau=(y+g)/p,this.cobu=-g/p,this.coav=-f*(y-g)/p,this.cobv=f*(2*y+g)/p}createInnerFacets(){const y=this.m,g=this.n;for(let f=0;f<g+y+1;f++)for(let y=this.min[f];y<this.max[f]+1;y++)y<this.max[f]&&y<this.max[f+1]+1&&this.innerFacets.push(["|"+y+"|"+f,"|"+y+"|"+(f+1),"|"+(y+1)+"|"+f]),f>0&&y<this.max[f-1]&&y+1<this.max[f]+1&&this.innerFacets.push(["|"+y+"|"+f,"|"+(y+1)+"|"+f,"|"+(y+1)+"|"+(f-1)])}edgeVecsABOB(){const y=this.m,g=this.n,f=new Hy(-g,y+g);for(let p=1;p<y+g;p++){const y=new Hy(this.min[p],p),g=new Hy(this.min[p-1],p-1),S=new Hy(this.min[p+1],p+1),k=y.clone(),i=g.clone(),H=S.clone();k.rotate60About(f),i.rotate60About(f),H.rotate60About(f);const U=new Hy(this.max[k.y],k.y),l=new Hy(this.max[k.y-1],k.y-1),c=new Hy(this.max[k.y-1]-1,k.y-1);k.x===U.x&&k.y===U.y||(k.x!==l.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,l,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,c,U])):k.y===H.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([y,g,l]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([y,l,S])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([y,g,l]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,l,U])))}}mapABOBtoOBOA(){const y=new Hy(0,0);for(let g=0;g<this.isoVecsABOB.length;g++){const f=[];for(let p=0;p<3;p++)y.x=this.isoVecsABOB[g][p].x,y.y=this.isoVecsABOB[g][p].y,0===this.vertexTypes[g][p]&&y.rotateNeg120(this.m,this.n),f.push(y.clone());this.isoVecsOBOA.push(f)}}mapABOBtoBAOA(){const y=new Hy(0,0);for(let g=0;g<this.isoVecsABOB.length;g++){const f=[];for(let p=0;p<3;p++)y.x=this.isoVecsABOB[g][p].x,y.y=this.isoVecsABOB[g][p].y,1===this.vertexTypes[g][p]&&y.rotate120(this.m,this.n),f.push(y.clone());this.isoVecsBAOA.push(f)}}MapToFace(y,g){const f=this.IDATA.face[y],S=f[2],k=f[1],i=f[0],H=p.m.eh(this.IDATA.vertex[S]),U=p.m.eh(this.IDATA.vertex[k]),l=p.m.eh(this.IDATA.vertex[i]),c=U.ed(H),Z=l.ed(H),C=c.scale(this.coau).add(Z.scale(this.cobu)),q=c.scale(this.coav).add(Z.scale(this.cobv)),W=[];let j,P=p.j.o[0];for(let p=0;p<this.cartesian.length;p++)P=C.scale(this.cartesian[p].x).add(q.scale(this.cartesian[p].y)).add(H),W[p]=[P.x,P.y,P.z],j=y+"|"+this.vertices[p].x+"|"+this.vertices[p].y,g.vertex[this.vecToidx[j]]=[P.x,P.y,P.z]}build(y,g){const f=[],p=Hy.Zero(),S=new Hy(y,g),k=new Hy(-g,y+g);f.push(p,S,k);for(let z=g;z<y+1;z++)for(let g=0;g<y+1-z;g++)f.push(new Hy(g,z));if(g>0){const p=(0,x.j)(y,g),S=y/p,k=g/p;for(let H=1;H<p;H++)f.push(new Hy(H*S,H*k)),f.push(new Hy(-H*k,H*(S+k))),f.push(new Hy(y-H*(S+k),g+H*S));const i=y/g;for(let H=1;H<g;H++)for(let p=0;p<H*i;p++)f.push(new Hy(p,H)),f.push(new Hy(p,H).rotate120(y,g)),f.push(new Hy(p,H).rotateNeg120(y,g))}f.sort(((y,g)=>y.x-g.x)),f.sort(((y,g)=>y.y-g.y));const i=new Array(y+g+1),H=new Array(y+g+1);for(let z=0;z<i.length;z++)i[z]=1/0,H[z]=-1/0;let U=0,l=0;const c=f.length;for(let z=0;z<c;z++)l=f[z].x,U=f[z].y,i[U]=Math.min(l,i[U]),H[U]=Math.max(l,H[U]);const Z=(f,p)=>{const S=f.clone();return"A"===p&&S.rotateNeg120(y,g),"B"===p&&S.rotate120(y,g),S.x<0?S.y:S.x+S.y},C=[],q=[],W=[],j=[],P={},B=[];let R=-1,G=-1;for(let z=0;z<c;z++)C[z]=f[z].toCartesianOrigin(new Hy(0,0),.5),q[z]=Z(f[z],"O"),W[z]=Z(f[z],"A"),j[z]=Z(f[z],"B"),q[z]===W[z]&&W[z]===j[z]?(R=3,G=q[z]):q[z]===W[z]?(R=4,G=q[z]):W[z]===j[z]?(R=5,G=W[z]):j[z]===q[z]&&(R=6,G=q[z]),q[z]<W[z]&&q[z]<j[z]&&(R=2,G=q[z]),W[z]<q[z]&&W[z]<j[z]&&(R=1,G=W[z]),j[z]<W[z]&&j[z]<q[z]&&(R=0,G=j[z]),B.push([R,G,f[z].x,f[z].y]);B.sort(((y,g)=>y[2]-g[2])),B.sort(((y,g)=>y[3]-g[3])),B.sort(((y,g)=>y[1]-g[1])),B.sort(((y,g)=>y[0]-g[0]));for(let z=0;z<B.length;z++)P[B[z][2]+"|"+B[z][3]]=[B[z][0],B[z][1],z];return this.m=y,this.n=g,this.vertices=f,this.vertByDist=P,this.cartesian=C,this.min=i,this.max=H,this}}class ly{constructor(y,g,f,p){this.name=y,this.category=g,this.vertex=f,this.face=p}}class cy extends ly{innerToData(y,g){for(let f=0;f<g.innerFacets.length;f++)this.face.push(g.innerFacets[f].map((f=>g.vecToidx[y+f])))}mapABOBtoDATA(y,g){const f=g.IDATA.edgematch[y][0];for(let p=0;p<g.isoVecsABOB.length;p++){const S=[];for(let k=0;k<3;k++)0===g.vertexTypes[p][k]?S.push(y+"|"+g.isoVecsABOB[p][k].x+"|"+g.isoVecsABOB[p][k].y):S.push(f+"|"+g.isoVecsABOB[p][k].x+"|"+g.isoVecsABOB[p][k].y);this.face.push([g.vecToidx[S[0]],g.vecToidx[S[1]],g.vecToidx[S[2]]])}}mapOBOAtoDATA(y,g){const f=g.IDATA.edgematch[y][0];for(let p=0;p<g.isoVecsOBOA.length;p++){const S=[];for(let k=0;k<3;k++)1===g.vertexTypes[p][k]?S.push(y+"|"+g.isoVecsOBOA[p][k].x+"|"+g.isoVecsOBOA[p][k].y):S.push(f+"|"+g.isoVecsOBOA[p][k].x+"|"+g.isoVecsOBOA[p][k].y);this.face.push([g.vecToidx[S[0]],g.vecToidx[S[1]],g.vecToidx[S[2]]])}}mapBAOAtoDATA(y,g){const f=g.IDATA.edgematch[y][2];for(let p=0;p<g.isoVecsBAOA.length;p++){const S=[];for(let k=0;k<3;k++)1===g.vertexTypes[p][k]?S.push(y+"|"+g.isoVecsBAOA[p][k].x+"|"+g.isoVecsBAOA[p][k].y):S.push(f+"|"+g.isoVecsBAOA[p][k].x+"|"+g.isoVecsBAOA[p][k].y);this.face.push([g.vecToidx[S[0]],g.vecToidx[S[1]],g.vecToidx[S[2]]])}}orderData(y){const g=[];for(let k=0;k<13;k++)g[k]=[];const f=y.closestTo;for(let k=0;k<f.length;k++)f[k][0]>-1?f[k][1]>0&&g[f[k][0]].push([k,f[k][1]]):g[12].push([k,f[k][0]]);const p=[];for(let k=0;k<12;k++)p[k]=k;let S=12;for(let k=0;k<12;k++){g[k].sort(((y,g)=>y[1]-g[1]));for(let y=0;y<g[k].length;y++)p[g[k][y][0]]=S++}for(let k=0;k<g[12].length;k++)p[g[12][k][0]]=S++;for(let k=0;k<this.vertex.length;k++)this.vertex[k].push(p[k]);this.vertex.sort(((y,g)=>y[3]-g[3]));for(let k=0;k<this.vertex.length;k++)this.vertex[k].pop();for(let k=0;k<this.face.length;k++)for(let y=0;y<this.face[k].length;y++)this.face[k][y]=p[this.face[k][y]];this.sharedNodes=g[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(y,g){const f=[],p=[];let S=g.pop();p.push(S);let k=this.face[S].indexOf(y);k=(k+2)%3;let i=this.face[S][k];f.push(i);let H=0;for(;g.length>0;)S=g[H],this.face[S].indexOf(i)>-1?(k=(this.face[S].indexOf(i)+1)%3,i=this.face[S][k],f.push(i),p.push(S),g.splice(H,1),H=0):H++;return this.adjacentFaces.push(f),p}toGoldbergPolyhedronData(){const y=new ly("GeoDual","Goldberg",[],[]);y.name="GD dual";const g=this.vertex.length,f=new Array(g);for(let U=0;U<g;U++)f[U]=[];for(let U=0;U<this.face.length;U++)for(let y=0;y<3;y++)f[this.face[U][y]].push(U);let p=0,S=0,k=0,i=[],H=[];this.adjacentFaces=[];for(let U=0;U<f.length;U++)y.face[U]=this.setOrder(U,f[U].concat([])),f[U].forEach((g=>{p=0,S=0,k=0,i=this.face[g];for(let y=0;y<3;y++)H=this.vertex[i[y]],p+=H[0],S+=H[1],k+=H[2];y.vertex[g]=[p/3,S/3,k/3]}));return y}static BuildGeodesicData(y){const g=new cy("Geodesic-m-n","Geodesic",[[0,n.g,-1],[-n.g,1,0],[-1,0,-n.g],[1,0,-n.g],[n.g,1,0],[0,n.g,1],[-1,0,n.g],[-n.g,-1,0],[0,-n.g,-1],[n.g,-1,0],[1,0,n.g],[0,-n.g,1]],[]);y.setIndices(),y.calcCoeffs(),y.createInnerFacets(),y.edgeVecsABOB(),y.mapABOBtoOBOA(),y.mapABOBtoBAOA();for(let f=0;f<y.IDATA.face.length;f++)y.MapToFace(f,g),g.innerToData(f,y),"B"===y.IDATA.edgematch[f][1]&&g.mapABOBtoDATA(f,y),"O"===y.IDATA.edgematch[f][1]&&g.mapOBOAtoDATA(f,y),"A"===y.IDATA.edgematch[f][3]&&g.mapBAOAtoDATA(f,y);g.orderData(y);return g.vertex=g.vertex.map((function(y){const g=y[0],f=y[1],p=y[2],S=Math.sqrt(g*g+f*f+p*p);return y[0]*=1/S,y[1]*=1/S,y[2]*=1/S,y})),g}}S.e._GoldbergMeshParser=(y,g)=>Zy.Parse(y,g);class Zy extends S.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(y,g){return void 0===g?(y>this.goldbergData.nbUnsharedFaces-1&&(I.d.Warn("Maximum number of unshared faces used"),y=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+y):(y>11&&(I.d.Warn("Last pole used"),y=11),g>this.goldbergData.nbFacesAtPole-1&&(I.d.Warn("Maximum number of faces at a pole used"),g=this.goldbergData.nbFacesAtPole-1),12+y*this.goldbergData.nbFacesAtPole+g)}_changeGoldbergFaceColors(y){for(let f=0;f<y.length;f++){const g=y[f][0],p=y[f][1],S=y[f][2];for(let y=g;y<p+1;y++)this.goldbergData.faceColors[y]=S}const g=[];for(let f=0;f<12;f++)for(let y=0;y<5;y++)g.push(this.goldbergData.faceColors[f].r,this.goldbergData.faceColors[f].g,this.goldbergData.faceColors[f].b,this.goldbergData.faceColors[f].a);for(let f=12;f<this.goldbergData.faceColors.length;f++)for(let y=0;y<6;y++)g.push(this.goldbergData.faceColors[f].r,this.goldbergData.faceColors[f].g,this.goldbergData.faceColors[f].b,this.goldbergData.faceColors[f].a);return g}setGoldbergFaceColors(y){const g=this._changeGoldbergFaceColors(y);this.Ga(k.c.ColorKind,g)}updateGoldbergFaceColors(y){const g=this._changeGoldbergFaceColors(y);this.updateVerticesData(k.c.ColorKind,g)}_changeGoldbergFaceUVs(y){const g=this.getVerticesData(k.c.UVKind);for(let f=0;f<y.length;f++){const p=y[f][0],S=y[f][1],k=y[f][2],i=y[f][3],H=y[f][4],U=[],l=[];let c,Z;for(let y=0;y<5;y++)c=k.x+i*Math.cos(H+y*Math.PI/2.5),Z=k.y+i*Math.sin(H+y*Math.PI/2.5),c<0&&(c=0),c>1&&(c=1),U.push(c,Z);for(let y=0;y<6;y++)c=k.x+i*Math.cos(H+y*Math.PI/3),Z=k.y+i*Math.sin(H+y*Math.PI/3),c<0&&(c=0),c>1&&(c=1),l.push(c,Z);for(let y=p;y<Math.min(12,S+1);y++)for(let f=0;f<5;f++)g[10*y+2*f]=U[2*f],g[10*y+2*f+1]=U[2*f+1];for(let y=Math.max(12,p);y<S+1;y++)for(let f=0;f<6;f++)g[12*y-24+2*f]=l[2*f],g[12*y-23+2*f]=l[2*f+1]}return g}setGoldbergFaceUVs(y){const g=this._changeGoldbergFaceUVs(y);this.Ga(k.c.UVKind,g)}updateGoldbergFaceUVs(y){const g=this._changeGoldbergFaceUVs(y);this.updateVerticesData(k.c.UVKind,g)}placeOnGoldbergFaceAt(y,g,f){const S=p.m.RotationFromAxis(this.goldbergData.faceXaxis[g],this.goldbergData.faceYaxis[g],this.goldbergData.faceZaxis[g]);y.rotation=S,y.position=this.goldbergData.faceCenters[g].add(this.goldbergData.faceXaxis[g].scale(f.x)).add(this.goldbergData.faceYaxis[g].scale(f.y)).add(this.goldbergData.faceZaxis[g].scale(f.z))}serialize(y){super.serialize(y),y.type="GoldbergMesh";const g={};if(g.adjacentFaces=this.goldbergData.adjacentFaces,g.nbSharedFaces=this.goldbergData.nbSharedFaces,g.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,g.nbFaces=this.goldbergData.nbFaces,g.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){g.faceColors=[];for(const y of this.goldbergData.faceColors)g.faceColors.push(y.mj())}if(this.goldbergData.faceCenters){g.faceCenters=[];for(const y of this.goldbergData.faceCenters)g.faceCenters.push(y.mj())}if(this.goldbergData.faceZaxis){g.faceZaxis=[];for(const y of this.goldbergData.faceZaxis)g.faceZaxis.push(y.mj())}if(this.goldbergData.faceYaxis){g.faceYaxis=[];for(const y of this.goldbergData.faceYaxis)g.faceYaxis.push(y.mj())}if(this.goldbergData.faceXaxis){g.faceXaxis=[];for(const y of this.goldbergData.faceXaxis)g.faceXaxis.push(y.mj())}y.goldbergData=g}static Parse(y,g){const f=y.goldbergData;f.faceColors=f.faceColors.map((y=>C.f.eh(y))),f.faceCenters=f.faceCenters.map((y=>p.m.eh(y))),f.faceZaxis=f.faceZaxis.map((y=>p.m.eh(y))),f.faceXaxis=f.faceXaxis.map((y=>p.m.eh(y))),f.faceYaxis=f.faceYaxis.map((y=>p.m.eh(y)));const S=new Zy(y.name,g);return S.goldbergData=f,S}}var Cy=f(11376);class qy{constructor(y){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=y}moveTo(y,g){this._currentPath=new Y.e(y,g),this._tempPaths.push(this._currentPath)}lineTo(y,g){this._currentPath.addLineTo(y,g)}quadraticCurveTo(y,g,f,p){this._currentPath.addQuadraticCurveTo(y,g,f,p,this._resolution)}bezierCurveTo(y,g,f,p,S,k){this._currentPath.addBezierCurveTo(y,g,f,p,S,k,this._resolution)}extractHoles(){for(const y of this._tempPaths)y.area()>0?this._holes.push(y):this._paths.push(y);if(!this._paths.length&&this._holes.length){const y=this._holes;this._holes=this._paths,this._paths=y}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Wy(y,g,f,p,S,k){const i=k.glyphs[y]||k.glyphs["?"];if(!i)return null;const H=new qy(S);if(i.o){const y=i.o.split(" ");for(let S=0,k=y.length;S<k;){switch(y[S++]){case"m":{const k=parseInt(y[S++])*g+f,i=parseInt(y[S++])*g+p;H.moveTo(k,i);break}case"l":{const k=parseInt(y[S++])*g+f,i=parseInt(y[S++])*g+p;H.lineTo(k,i);break}case"q":{const k=parseInt(y[S++])*g+f,i=parseInt(y[S++])*g+p,U=parseInt(y[S++])*g+f,l=parseInt(y[S++])*g+p;H.quadraticCurveTo(U,l,k,i);break}case"b":{const k=parseInt(y[S++])*g+f,i=parseInt(y[S++])*g+p,U=parseInt(y[S++])*g+f,l=parseInt(y[S++])*g+p,c=parseInt(y[S++])*g+f,Z=parseInt(y[S++])*g+p;H.bezierCurveTo(U,l,c,Z,k,i);break}}}}return H.extractHoles(),{offsetX:i.ha*g,shapePath:H}}const jy={CreateBox:Z.c,CreateTiledBox:P,CreateSphere:B.c,CreateDisc:c.e,CreateIcoSphere:L,CreateRibbon:l,CreateCylinder:T,CreateTorus:m,CreateTorusKnot:w,CreateLineSystem:o.d,pb:o.g,CreateDashedLines:o.c,ExtrudeShape:A,ExtrudeShapeCustom:J,CreateLathe:e,CreateTiledPlane:W,rg:h.c,CreateGround:D.f,CreateTiledGround:D.i,CreateGroundFromHeightMap:D.e,CreatePolygon:u,ExtrudePolygon:F,CreateTube:K,CreatePolyhedron:E,CreateGeodesic:function(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=g.m||1;p!==Math.floor(p)&&(p=Math.floor(p),I.d.Warn("m not an integer only floor(m) used"));let S=g.n||0;if(S!==Math.floor(S)&&(S=Math.floor(S),I.d.Warn("n not an integer only floor(n) used")),S>p){const y=S;S=p,p=y,I.d.Warn("n > m therefore m and n swapped")}const k=new Uy;return k.build(p,S),E(y,{custom:cy.BuildGeodesicData(k),size:g.size,sizeX:g.sizeX,sizeY:g.sizeY,sizeZ:g.sizeZ,faceUV:g.faceUV,faceColors:g.faceColors,flat:g.flat,updatable:g.updatable,sideOrientation:g.sideOrientation,frontUVs:g.frontUVs,backUVs:g.backUVs},f)},CreateGoldberg:function(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=g.size,U=g.sizeX||k||1,l=g.sizeY||k||1,c=g.sizeZ||k||1;let Z=g.m||1;Z!==Math.floor(Z)&&(Z=Math.floor(Z),I.d.Warn("m not an integer only floor(m) used"));let q=g.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),I.d.Warn("n not an integer only floor(n) used")),q>Z){const y=q;q=Z,Z=y,I.d.Warn("n > m therefore m and n swapped")}const W=new Uy;W.build(Z,q);const j=cy.BuildGeodesicData(W),P=j.toGoldbergPolyhedronData(),B=new Zy(y,f);g.sideOrientation=S.e._GetDefaultSideOrientation(g.sideOrientation),B._originalBuilderSideOrientation=g.sideOrientation;(function(y,g){const f=y.size,S=y.sizeX||f||1,k=y.sizeY||f||1,U=y.sizeZ||f||1,l=0===y.sideOrientation?0:y.sideOrientation||i.e.DEFAULTSIDE,c=[],Z=[],C=[],q=[];let W=1/0,j=-1/0,P=1/0,B=-1/0;for(let p=0;p<g.vertex.length;p++)W=Math.min(W,g.vertex[p][0]*S),j=Math.max(j,g.vertex[p][0]*S),P=Math.min(P,g.vertex[p][1]*k),B=Math.max(B,g.vertex[p][1]*k);let R=0;for(let i=0;i<g.face.length;i++){const y=g.face[i],f=p.m.eh(g.vertex[y[0]]),l=p.m.eh(g.vertex[y[2]]),G=p.m.eh(g.vertex[y[1]]),z=l.ed(f),T=G.ed(f),Q=p.m.Cross(T,z).normalize();for(let p=0;p<y.length;p++){C.push(Q.x,Q.y,Q.z);const f=g.vertex[y[p]];c.push(f[0]*S,f[1]*k,f[2]*U);const i=(f[1]*k-P)/(B-P);q.push((f[0]*S-W)/(j-W),H.d?1-i:i)}for(let g=0;g<y.length-2;g++)Z.push(R,R+g+2,R+g+1);R+=y.length}i.e._ComputeSides(l,c,Z,C,q);const G=new i.e;return G.xa=c,G.indices=Z,G.ya=C,G.Aa=q,G})(g,P).Ca(B,g.updatable),B.goldbergData.nbSharedFaces=j.sharedNodes,B.goldbergData.nbUnsharedFaces=j.poleNodes,B.goldbergData.adjacentFaces=j.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let S=0;S<j.vertex.length;S++)B.goldbergData.faceCenters.push(p.m.eh(j.vertex[S])),B.goldbergData.faceCenters[S].x*=U,B.goldbergData.faceCenters[S].y*=l,B.goldbergData.faceCenters[S].z*=c,B.goldbergData.faceColors.push(new C.f(1,1,1,1));for(let S=0;S<P.face.length;S++){const y=P.face[S],g=p.m.eh(P.vertex[y[0]]),f=p.m.eh(P.vertex[y[2]]),k=p.m.eh(P.vertex[y[1]]),i=f.ed(g),H=k.ed(g),U=p.m.Cross(H,i).normalize(),l=p.m.Cross(H,U).normalize();B.goldbergData.faceXaxis.push(H.normalize()),B.goldbergData.faceYaxis.push(U),B.goldbergData.faceZaxis.push(l)}return B},CreateDecal:Sy,CreateCapsule:iy,CreateText:function(y,g,f){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const U=function(y,g,f,p){const S=Array.from(y),k=g/p.resolution,i=(p.boundingBox.yMax-p.boundingBox.yMin+p.underlineThickness)*k,H=[];let U=0,l=0;for(let c=0;c<S.length;c++){const y=S[c];if("\n"===y)U=0,l-=i;else{const g=Wy(y,k,U,l,f,p);g&&(U+=g.offsetX,H.push(g.shapePath))}}return H}(g,k.size||50,k.resolution||8,f),l=[];let c=0;for(const W of U){if(!W.paths.length)continue;const g=W.holes.slice();for(const f of W.paths){var Z,C;const U=[],q=[],W=f.getPoints();for(const y of W)q.push(new p.m(y.x,0,y.y));const j=g.slice();for(const y of j){const S=y.getPoints();let k=!1;for(const y of S)if(f.isPointInside(y)){k=!0;break}if(!k)continue;const i=[];for(const y of S)i.push(new p.m(y.x,0,y.y));U.push(i),g.splice(g.indexOf(y),1)}if(!U.length&&g.length)for(const y of g){const g=y.getPoints(),f=[];for(const y of g)f.push(new p.m(y.x,0,y.y));U.push(f)}const P=F(y,{shape:q,holes:U.length?U:void 0,depth:k.depth||1,faceUV:k.faceUV||(null===(Z=k.perLetterFaceUV)||void 0===Z?void 0:Z.call(k,c)),faceColors:k.faceColors||(null===(C=k.perLetterFaceColors)||void 0===C?void 0:C.call(k,c)),sideOrientation:S.e._GetDefaultSideOrientation(k.sideOrientation||S.e.DOUBLESIDE)},i,H);l.push(P),c++}}const q=S.e.MergeMeshes(l,!0,!0);if(q){const g=q.getBoundingInfo().boundingBox;q.position.x+=-(g.minimumWorld.x+g.maximumWorld.x)/2,q.position.y+=-(g.minimumWorld.y+g.maximumWorld.y)/2,q.position.z+=-(g.minimumWorld.z+g.maximumWorld.z)/2+g.extendSize.z,q.name=y;const f=new Cy.d("pivot",i);f.rotation.x=-Math.PI/2,q.parent=f,q.bakeCurrentTransformIntoVertices(),q.parent=null,f.dispose()}return q}}},11209:(y,g,f)=>{"use strict";f.d(g,{b:()=>U});var p=f(11131),S=f(11216),k=f(11221),i=f(11237),H=f(11240);class U{get materialDefines(){var y;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(y=this._getDrawWrapper())||void 0===y?void 0:y.defines}set materialDefines(y){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=y}_getDrawWrapper(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y=y??this._engine.currentRenderPassId;let f=this._drawWrappers[y];return!f&&g&&(this._drawWrappers[y]=f=new H.b(this._mesh.va().getEngine())),f}_removeDrawWrapper(y){var g;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(g=this._drawWrappers[y])||void 0===g||g.dispose());this._drawWrappers[y]=void 0}get effect(){var y;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(y=this._getDrawWrapper())||void 0===y?void 0:y.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(y){this._mainDrawWrapperOverride=y}setEffect(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=this._drawWrapper;S.setEffect(y,g,p),void 0!==f&&(S.materialContext=f),y||(S.defines=null,S.materialContext=void 0)}resetDrawCache(y){if(this._drawWrappers){if(void 0!==y)return void this._removeDrawWrapper(y);for(const y of this._drawWrappers)null===y||void 0===y||y.dispose()}this._drawWrappers=[]}static AddToMesh(y,g,f,p,S,k,i){return new U(y,g,f,p,S,k,i,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(y,g,f,p,S,k,i){let H=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=y,this.verticesStart=g,this.verticesCount=f,this.indexStart=p,this.indexCount=S,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=k,this._renderingMesh=i||k,U&&k.og.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=k.og.length-1,H&&(this.refreshBoundingInfo(),k.Sj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(y){return this._boundingInfo=y,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const y=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return y||this._renderingMesh}Ha(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const g=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!g)return y?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(g)){const y=g.getSubMaterial(this.materialIndex);return this._currentMaterial!==y&&(this._currentMaterial=y,this.resetDrawCache()),y}return g}_isMultiMaterial(y){return void 0!==y.getSubMaterial}refreshBoundingInfo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Hj)return this;if(y||(y=this._renderingMesh.getVerticesData(p.c.PositionKind)),!y)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const g=this._renderingMesh.hg();let f;if(0===this.indexStart&&this.indexCount===g.length){const y=this._renderingMesh.getBoundingInfo();f={minimum:y.minimum.clone(),maximum:y.maximum.clone()}}else f=(0,i.d)(y,g,this.indexStart,this.indexCount,this._renderingMesh.Hj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(f.minimum,f.maximum):this._boundingInfo=new k.b(f.minimum,f.maximum),this}_checkCollision(y){return this.getBoundingInfo()._checkCollision(y)}updateBoundingInfo(y){let g=this.getBoundingInfo();return g||(this.refreshBoundingInfo(),g=this.getBoundingInfo()),g&&g.update(y),this}isInFrustum(y){const g=this.getBoundingInfo();return!!g&&g.isInFrustum(y,this._mesh.Hi)}isCompletelyInFrustum(y){const g=this.getBoundingInfo();return!!g&&g.isCompletelyInFrustum(y)}render(y){return this._renderingMesh.render(this,y,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(y,g){if(!this._linesIndexBuffer){const f=[];for(let g=this.indexStart;g<this.indexStart+this.indexCount;g+=3)f.push(y[g],y[g+1],y[g+1],y[g+2],y[g+2],y[g]);this._linesIndexBuffer=g.createIndexBuffer(f),this._linesIndexCount=f.length}return this._linesIndexBuffer}canIntersects(y){const g=this.getBoundingInfo();return!!g&&y.intersectsBox(g.boundingBox)}intersects(y,g,f,p,S){const k=this.Ha();if(!k)return null;let i=3,H=!1;switch(k.fillMode){case 3:case 5:case 6:case 8:return null;case 7:i=1,H=!0}return 4===k.fillMode?f.length?this._intersectLines(y,g,f,this._mesh.intersectionThreshold,p):this._intersectUnIndexedLines(y,g,f,this._mesh.intersectionThreshold,p):!f.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(y,g,f,p,S):this._intersectTriangles(y,g,f,i,H,p,S)}_intersectLines(y,g,f,p,k){let i=null;for(let H=this.indexStart;H<this.indexStart+this.indexCount;H+=2){const U=g[f[H]],l=g[f[H+1]],c=y.intersectionSegment(U,l,p);if(!(c<0)&&((k||!i||c<i.distance)&&(i=new S.b(null,null,c),i.faceId=H/2,k)))break}return i}_intersectUnIndexedLines(y,g,f,p,k){let i=null;for(let H=this.verticesStart;H<this.verticesStart+this.verticesCount;H+=2){const f=g[H],U=g[H+1],l=y.intersectionSegment(f,U,p);if(!(l<0)&&((k||!i||l<i.distance)&&(i=new S.b(null,null,l),i.faceId=H/2,k)))break}return i}_intersectTriangles(y,g,f,p,S,k,i){let H=null,U=-1;for(let l=this.indexStart;l<this.indexStart+this.indexCount-(3-p);l+=p){U++;const p=f[l],c=f[l+1],Z=f[l+2];if(S&&4294967295===Z){l+=2;continue}const C=g[p],q=g[c],W=g[Z];if(!C||!q||!W)continue;if(i&&!i(C,q,W,y,p,c,Z))continue;const j=y.intersectsTriangle(C,q,W);if(j){if(j.distance<0)continue;if((k||!H||j.distance<H.distance)&&(H=j,H.faceId=U,k))break}}return H}_intersectUnIndexedTriangles(y,g,f,p,S){let k=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){const f=g[i],H=g[i+1],U=g[i+2];if(S&&!S(f,H,U,y,-1,-1,-1))continue;const l=y.intersectsTriangle(f,H,U);if(l){if(l.distance<0)continue;if((p||!k||l.distance<k.distance)&&(k=l,k.faceId=i/3,p))break}}return k}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(y,g){const f=new U(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,y,g,!1);if(!this.IsGlobal){const y=this.getBoundingInfo();if(!y)return f;f._boundingInfo=new k.b(y.minimum,y.maximum)}return f}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const y=this._mesh.og.indexOf(this);this._mesh.og.splice(y,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(y,g,f,p,S){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Number.MAX_VALUE,H=-Number.MAX_VALUE;const l=(S||p).hg();for(let U=g;U<g+f;U++){const y=l[U];y<i&&(i=y),y>H&&(H=y)}return new U(y,i,H-i+1,g,f,p,S,k)}}},12308:(y,g,f)=>{"use strict";var p=f(11321),S=f(11131),k=f(11054),i=f(10736),H=f(11221);p.e.prototype.thinInstanceAdd=function(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return i.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(y)?y.length:1);const f=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(y))for(let p=0;p<y.length;++p)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,y[p],p===y.length-1&&g);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,y,g);return f},p.e.prototype.thinInstanceAddSelf=function(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(k.c.IdentityReadOnly,y)},p.e.prototype.thinInstanceRegisterAttribute=function(y,g){y===S.c.ColorKind&&(y=S.c.ColorInstanceKind),this.removeVerticesData(y),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[y]=g,this._userThinInstanceBuffersStorage.sizes[y]=g*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[y]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[y]),this._userThinInstanceBuffersStorage.vertexBuffers[y]=new S.c(this.getEngine(),this._userThinInstanceBuffersStorage.data[y],y,!0,!1,g,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])},p.e.prototype.thinInstanceSetMatrixAt=function(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||y>=this._thinInstanceDataStorage.instancesCount)return!1;const p=this._thinInstanceDataStorage.matrixData;return g.copyToArray(p,16*y),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[y]=g),f&&(this.Ub("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},p.e.prototype.thinInstanceSetAttributeAt=function(y,g,f){let p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return y===S.c.ColorKind&&(y=S.c.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[y]||g>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(y,0),this._userThinInstanceBuffersStorage.data[y].set(f,g*this._userThinInstanceBuffersStorage.strides[y]),p&&this.Ub(y),!0)},Object.defineProperty(p.e.prototype,"Rb",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(y){var g;const f=this._thinInstanceDataStorage.matrixData??(null===(g=this.source)||void 0===g?void 0:g._thinInstanceDataStorage.matrixData);y<=(f?f.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=y)},enumerable:!0,configurable:!0}),p.e.prototype._thinInstanceCreateMatrixBuffer=function(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const p=new S.b(this.getEngine(),g,!f,16,!1,!0);for(let S=0;S<4;S++)this.setVerticesBuffer(p.createVertexBuffer(y+S,4*S,4));return p},p.e.prototype.Pb=function(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var k;if(f=f||16,"matrix"===y)null===(k=this._thinInstanceDataStorage.matrixBuffer)||void 0===k||k.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=g?g.length:32*f,this._thinInstanceDataStorage.matrixData=g,this._thinInstanceDataStorage.worldMatrices=null,null!==g?(this._thinInstanceDataStorage.instancesCount=g.length/f,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",g,p),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===y){var i;null===(i=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===i||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=g,null!==g&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",g,p))}else{var H;if(y===S.c.ColorKind&&(y=S.c.ColorInstanceKind),null===g)null!==(H=this._userThinInstanceBuffersStorage)&&void 0!==H&&H.data[y]&&(this.removeVerticesData(y),delete this._userThinInstanceBuffersStorage.data[y],delete this._userThinInstanceBuffersStorage.strides[y],delete this._userThinInstanceBuffersStorage.sizes[y],delete this._userThinInstanceBuffersStorage.vertexBuffers[y]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[y]=g,this._userThinInstanceBuffersStorage.strides[y]=f,this._userThinInstanceBuffersStorage.sizes[y]=g.length,this._userThinInstanceBuffersStorage.vertexBuffers[y]=new S.c(this.getEngine(),g,y,!p,!1,f,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])}},p.e.prototype.Ub=function(y){var g;if("matrix"===y)this.Qj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(y),null===(g=this._thinInstanceDataStorage.matrixBuffer)||void 0===g||g.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===y){var f;this.Qj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(y),null===(f=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===f||f.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var p;y===S.c.ColorKind&&(y=S.c.ColorInstanceKind),null!==(p=this._userThinInstanceBuffersStorage)&&void 0!==p&&p.vertexBuffers[y]&&(this.Qj&&!this._userThinInstanceBuffersStorage.vertexBuffers[y].isUpdatable()&&this._thinInstanceRecreateBuffer(y),this._userThinInstanceBuffersStorage.vertexBuffers[y].updateDirectly(this._userThinInstanceBuffersStorage.data[y],0))}},p.e.prototype.thinInstancePartialBufferUpdate=function(y,g,f){var p;"matrix"===y?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(g,f):(y===S.c.ColorKind&&(y=S.c.ColorInstanceKind),null!==(p=this._userThinInstanceBuffersStorage)&&void 0!==p&&p.vertexBuffers[y]&&this._userThinInstanceBuffersStorage.vertexBuffers[y].updateDirectly(g,f))},p.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const y=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let g=0;g<this._thinInstanceDataStorage.instancesCount;++g)this._thinInstanceDataStorage.worldMatrices[g]=k.c.eh(y,16*g)}return this._thinInstanceDataStorage.worldMatrices},p.e.prototype.thinInstanceRefreshBoundingInfo=function(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const p=this._thinInstanceDataStorage.boundingVectors;if(y||!this.rawBoundingInfo){p.length=0,this.refreshBoundingInfo(g,f);const y=this.getBoundingInfo();this.rawBoundingInfo=new H.b(y.minimum,y.maximum)}const S=this.getBoundingInfo(),i=this._thinInstanceDataStorage.matrixData;if(0===p.length)for(let k=0;k<S.boundingBox.vectors.length;++k)p.push(S.boundingBox.vectors[k].clone());k.j.o[0].me(Number.POSITIVE_INFINITY),k.j.o[1].me(Number.NEGATIVE_INFINITY);for(let H=0;H<this._thinInstanceDataStorage.instancesCount;++H){k.c.FromArrayToRef(i,16*H,k.j.Matrix[0]);for(let y=0;y<p.length;++y)k.m.TransformCoordinatesToRef(p[y],k.j.Matrix[0],k.j.o[2]),k.j.o[0].minimizeInPlace(k.j.o[2]),k.j.o[1].maximizeInPlace(k.j.o[2])}S.reConstruct(k.j.o[0],k.j.o[1]),this.Ea()},p.e.prototype._thinInstanceRecreateBuffer=function(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var f;if("matrix"===y)null===(f=this._thinInstanceDataStorage.matrixBuffer)||void 0===f||f.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,g);else if("previousMatrix"===y){var p;if(this._scene.needsPreviousWorldMatrices)null===(p=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,g)}else{var k;y===S.c.ColorKind&&(y=S.c.ColorInstanceKind),null===(k=this._userThinInstanceBuffersStorage.vertexBuffers[y])||void 0===k||k.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[y]=new S.c(this.getEngine(),this._userThinInstanceBuffersStorage.data[y],y,!g,!1,this._userThinInstanceBuffersStorage.strides[y],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])}},p.e.prototype._thinInstanceUpdateBufferSize=function(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;y===S.c.ColorKind&&(y=S.c.ColorInstanceKind);const f="matrix"===y;if(!f&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[y]))return;const p=f?16:this._userThinInstanceBuffersStorage.strides[y],k=f?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[y];let i=f?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[y];const H=(this._thinInstanceDataStorage.instancesCount+g)*p;let U=k;for(;U<H;)U*=2;if(!i||k!=U){if(i){const y=new Float32Array(U);y.set(i,0),i=y}else i=new Float32Array(U);var l,c,Z;if(f){if(null===(l=this._thinInstanceDataStorage.matrixBuffer)||void 0===l||l.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",i,!1),this._thinInstanceDataStorage.matrixData=i,this._thinInstanceDataStorage.matrixBufferSize=U,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(c=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===c||c.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",i,!1)}else null===(Z=this._userThinInstanceBuffersStorage.vertexBuffers[y])||void 0===Z||Z.dispose(),this._userThinInstanceBuffersStorage.data[y]=i,this._userThinInstanceBuffersStorage.sizes[y]=U,this._userThinInstanceBuffersStorage.vertexBuffers[y]=new S.c(this.getEngine(),i,y,!0,!1,p,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])}},p.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},p.e.prototype._disposeThinInstanceSpecificData=function(){var y;null!==(y=this._thinInstanceDataStorage)&&void 0!==y&&y.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11376:(y,g,f)=>{"use strict";f.d(g,{d:()=>Z});var p=f(11021),S=f(11026),k=f(11099),i=f(10723),H=f(11054),U=f(11336),l=f(10871);const c=H.c.Compose(H.m.One(),H.g.FromEulerAngles(0,Math.PI,0),H.m.Zero());class Z extends U.d{get billboardMode(){return this._billboardMode}set billboardMode(y){this._billboardMode!==y&&(this._billboardMode=y,this._cache.useBillboardPosition=0!==(this._billboardMode&Z.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(y){y!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=y,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==Z.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(y){this._infiniteDistance!==y&&(this._infiniteDistance=y)}constructor(y){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new H.m(0,0,1),this._up=new H.m(0,1,0),this._right=new H.m(1,0,0),this._position=H.m.Zero(),this._rotation=H.m.Zero(),this._rotationQuaternion=null,this._scaling=H.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=Z.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Uj=H.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=H.m.Zero(),this._absoluteScaling=H.m.Zero(),this._absoluteRotationQuaternion=H.g.Identity(),this._pivotMatrix=H.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new i.d,this._nonUniformScaling=!1,g&&this.va().addTransformNode(this)}getClassName(){return"qb"}get position(){return this._position}set position(y){this._position=y,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(y){this._rotation=y,this._rotationQuaternion=null,this._markAsDirtyInternal()}get pe(){return this._scaling}set pe(y){this._scaling=y,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(y){this._rotationQuaternion=y,y&&this._rotation.me(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return H.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return H.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return H.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(y){return this._poseMatrix?(this._poseMatrix.p(y),this):(this._poseMatrix=y.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=H.c.Identity()),this._poseMatrix}_isSynchronized(){const y=this._cache;return this._billboardMode===y.billboardMode&&this._billboardMode===Z.BILLBOARDMODE_NONE&&(!y.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const y=this._cache;y.localMatrixUpdated=!1,y.billboardMode=-1,y.infiniteDistance=!1,y.useBillboardPosition=!1,y.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(y){return this.setPivotMatrix(y,!1)}setPivotMatrix(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(y),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=g,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=H.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;const p=this.clone("Clone of "+(this.name||this.id),y||this.parent,!0);p&&f&&f(this,p);for(const S of this.getChildTransformNodes(!0))S.instantiateHierarchy(p,g,f);return p}_b(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.me(0),this._rotationQuaternion=this._rotationQuaternion||H.g.Identity(),y.decompose(this._scaling,this._rotationQuaternion,this._position),this.Sj(!0)):(this._worldMatrix=y,this._absolutePosition.ne(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Sj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Sj(!0),this}get tj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Sj(),this._absolutePosition}setAbsolutePosition(y){if(!y)return this;let g,f,p;if(void 0===y.x){if(arguments.length<3)return this;g=arguments[0],f=arguments[1],p=arguments[2]}else g=y.x,f=y.y,p=y.z;if(this.parent){const y=H.j.Matrix[0];this.parent.getWorldMatrix().invertToRef(y),H.m.TransformCoordinatesFromFloatsToRef(g,f,p,y,this.position)}else this.position.x=g,this.position.y=f,this.position.z=p;return this._absolutePosition.p(y),this}setPositionWithLocalVector(y){return this.Sj(),this.position=H.m.TransformNormal(y,this.Uj),this}getPositionExpressedInLocalSpace(){this.Sj();const y=H.j.Matrix[0];return this.Uj.invertToRef(y),H.m.TransformNormal(this.position,y)}locallyTranslate(y){return this.Sj(!0),this.position=H.m.TransformCoordinates(y,this.Uj),this}lookAt(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const k=Z._LookAtVectorCache,i=0===S?this.position:this.getAbsolutePosition();if(y.subtractToRef(i,k),this.setDirection(k,g,f,p),1===S&&this.parent)if(this.rotationQuaternion){const y=H.j.Matrix[0];this.rotationQuaternion.toRotationMatrix(y);const g=H.j.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(g),g.invert(),y.multiplyToRef(g,y),this.rotationQuaternion.fromRotationMatrix(y)}else{const y=H.j.Quaternion[0];H.g.FromEulerVectorToRef(this.rotation,y);const g=H.j.Matrix[0];y.toRotationMatrix(g);const f=H.j.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),g.multiplyToRef(f,g),y.fromRotationMatrix(g),y.toEulerAnglesToRef(this.rotation)}return this}_e(y){const g=H.m.Zero();return this.getDirectionToRef(y,g),g}getDirectionToRef(y,g){return H.m.TransformNormalToRef(y,this.getWorldMatrix(),g),this}setDirection(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const S=-Math.atan2(y.z,y.x)+Math.PI/2,k=Math.sqrt(y.x*y.x+y.z*y.z),i=-Math.atan2(y.y,k);return this.rotationQuaternion?H.g.RotationYawPitchRollToRef(S+g,i+f,p,this.rotationQuaternion):(this.rotation.x=i+f,this.rotation.y=S+g,this.rotation.z=p),this}setPivotPoint(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Sj(!0);const f=this.getWorldMatrix();if(1==g){const g=H.j.Matrix[0];f.invertToRef(g),y=H.m.TransformCoordinates(y,g)}return this.setPivotMatrix(H.c.Translation(-y.x,-y.y,-y.z),!0)}getPivotPoint(){const y=H.m.Zero();return this.getPivotPointToRef(y),y}getPivotPointToRef(y){return y.x=-this._pivotMatrix.m[12],y.y=-this._pivotMatrix.m[13],y.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const y=H.m.Zero();return this.getAbsolutePivotPointToRef(y),y}getAbsolutePivotPointToRef(y){return this.getPivotPointToRef(y),H.m.TransformCoordinatesToRef(y,this.getWorldMatrix(),y),this}Vg(y){if(this._isDirty)return this;if(this._children)for(const g of this._children)g.Vg(y);return super.Vg(y)}setParent(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!y&&!this.parent)return this;const p=H.j.Quaternion[0],S=H.j.o[0],k=H.j.o[1],i=H.j.Matrix[1];H.c.IdentityToRef(i);const U=H.j.Matrix[0];this.Sj(!0);let l=this.rotationQuaternion;return l||(l=Z._TmpRotation,H.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l)),H.c.ComposeToRef(this.pe,l,this.position,U),this.parent&&U.multiplyToRef(this.parent.Sj(!0),U),y&&(y.Sj(!0).invertToRef(i),U.multiplyToRef(i,U)),U.decompose(k,p,S,g?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(p):p.toEulerAnglesToRef(this.rotation),this.pe.p(k),this.position.p(S),this.parent=y,f&&this.setPivotMatrix(H.c.Identity()),this}addChild(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y.setParent(this,g),this}removeChild(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y.setParent(null,g),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(y){return this._nonUniformScaling!==y&&(this._nonUniformScaling=y,!0)}attachToBone(y,g){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=g,this.parent=y,y.getSkeleton().prepare(!0),y.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=y?this._currentParentWhenAttachingToBone:null,this):(y&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(y,g,f){let p;if(y.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.me(0)),f&&0!==f){if(this.parent){const f=this.parent.getWorldMatrix(),p=H.j.Matrix[0];f.invertToRef(p),y=H.m.TransformNormal(y,p),f.determinant()<0&&(g*=-1)}p=H.g.RotationAxisToRef(y,g,Z._RotationAxisCache),p.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else p=H.g.RotationAxisToRef(y,g,Z._RotationAxisCache),this.rotationQuaternion.multiplyToRef(p,this.rotationQuaternion);return this}rotateAround(y,g,f){g.normalize(),this.rotationQuaternion||(this.rotationQuaternion=H.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.me(0));const p=H.j.o[0],S=H.j.o[1],k=H.j.o[2],i=H.j.Quaternion[0],U=H.j.Matrix[0],l=H.j.Matrix[1],c=H.j.Matrix[2],Z=H.j.Matrix[3];return y.subtractToRef(this.position,p),H.c.TranslationToRef(p.x,p.y,p.z,U),H.c.TranslationToRef(-p.x,-p.y,-p.z,l),H.c.RotationAxisToRef(g,f,c),l.multiplyToRef(c,Z),Z.multiplyToRef(U,Z),Z.decompose(S,i,k),this.position.addInPlace(k),i.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(y,g,f){const p=y.scale(g);if(f&&0!==f)this.setAbsolutePosition(this.getAbsolutePosition().add(p));else{const y=this.getPositionExpressedInLocalSpace().add(p);this.setPositionWithLocalVector(y)}return this}addRotation(y,g,f){let p;this.rotationQuaternion?p=this.rotationQuaternion:(p=H.j.Quaternion[1],H.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,p));const S=H.j.Quaternion[0];return H.g.RotationYawPitchRollToRef(g,y,f,S),p.multiplyInPlace(S),this.rotationQuaternion||p.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==Z.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Sj(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const f=this.va().getRenderId();if(!this._isDirty&&!y&&(this._currentRenderId===f||this.isSynchronized()))return this._currentRenderId=f,this._worldMatrix;g=g||this.va().activeCamera,this._updateCache();const p=this._cache;p.pivotMatrixUpdated=!1,p.billboardMode=this.billboardMode,p.infiniteDistance=this.infiniteDistance,p.parent=this._parentNode,this._currentRenderId=f,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const S=this._getEffectiveParent(),k=Z._TmpScaling;let i,U=this._position;if(this._infiniteDistance&&!this.parent&&g){const y=g.getWorldMatrix(),f=new H.m(y.m[12],y.m[13],y.m[14]);U=Z._TmpTranslation,U.ne(this._position.x+f.x,this._position.y+f.y,this._position.z+f.z)}if(k.ne(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,i=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(H.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.ne(0,0,0))}}else i=Z._TmpRotation,H.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,i);if(this._usePivotMatrix){const y=H.j.Matrix[1];H.c.ScalingToRef(k.x,k.y,k.z,y);const g=H.j.Matrix[0];i.toRotationMatrix(g),this._pivotMatrix.multiplyToRef(y,H.j.Matrix[4]),H.j.Matrix[4].multiplyToRef(g,this.Uj),this._postMultiplyPivotMatrix&&this.Uj.multiplyToRef(this._pivotMatrixInverse,this.Uj),this.Uj.addTranslationFromFloats(U.x,U.y,U.z)}else H.c.ComposeToRef(k,i,U,this.Uj);if(S&&S.getWorldMatrix){if(y&&S.Sj(y),p.useBillboardPath){if(this._transformToBoneReferal){const y=this.parent;y.getSkeleton().prepare(),y.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),H.j.Matrix[7])}else H.j.Matrix[7].p(S.getWorldMatrix());const y=H.j.o[5],g=H.j.o[6],f=H.j.Quaternion[0];H.j.Matrix[7].decompose(g,f,y),H.c.ScalingToRef(g.x,g.y,g.z,H.j.Matrix[7]),H.j.Matrix[7].setTranslation(y),Z.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(f,y),this.Uj.setTranslation(y)),this.Uj.multiplyToRef(H.j.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const y=this.parent;y.getSkeleton().prepare(),this.Uj.multiplyToRef(y.getFinalMatrix(),H.j.Matrix[6]),H.j.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Uj.multiplyToRef(S.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Uj);if(p.useBillboardPath&&g&&this.billboardMode&&!p.useBillboardPosition){const y=H.j.o[0];if(this._worldMatrix.getTranslationToRef(y),H.j.Matrix[1].p(g.getViewMatrix()),this._scene.useRightHandedSystem&&H.j.Matrix[1].multiplyToRef(c,H.j.Matrix[1]),H.j.Matrix[1].setTranslationFromFloats(0,0,0),H.j.Matrix[1].invertToRef(H.j.Matrix[0]),(this.billboardMode&Z.BILLBOARDMODE_ALL)!==Z.BILLBOARDMODE_ALL){H.j.Matrix[0].decompose(void 0,H.j.Quaternion[0],void 0);const y=H.j.o[1];H.j.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&Z.BILLBOARDMODE_X)!==Z.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&Z.BILLBOARDMODE_Y)!==Z.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&Z.BILLBOARDMODE_Z)!==Z.BILLBOARDMODE_Z&&(y.z=0),H.c.RotationYawPitchRollToRef(y.y,y.x,y.z,H.j.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(H.j.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(H.j.o[0])}else if(p.useBillboardPath&&g&&p.useBillboardPosition){const y=H.j.o[0];this._worldMatrix.getTranslationToRef(y);const f=g.globalPosition;this._worldMatrix.invertToRef(H.j.Matrix[1]);const p=H.j.o[1];H.m.TransformCoordinatesToRef(f,H.j.Matrix[1],p),p.normalize();const S=-Math.atan2(p.z,p.x)+Math.PI/2,k=Math.sqrt(p.x*p.x+p.z*p.z),i=-Math.atan2(p.y,k);if(H.g.RotationYawPitchRollToRef(S,i,0,H.j.Quaternion[0]),(this.billboardMode&Z.BILLBOARDMODE_ALL)!==Z.BILLBOARDMODE_ALL){const y=H.j.o[1];H.j.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&Z.BILLBOARDMODE_X)!==Z.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&Z.BILLBOARDMODE_Y)!==Z.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&Z.BILLBOARDMODE_Z)!==Z.BILLBOARDMODE_Z&&(y.z=0),H.c.RotationYawPitchRollToRef(y.y,y.x,y.z,H.j.Matrix[0])}else H.c.FromQuaternionToRef(H.j.Quaternion[0],H.j.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(H.j.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(H.j.o[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):S&&S._nonUniformScaling?this._updateNonUniformScalingState(S._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.ne(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=H.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Sj(),y){const y=this.getChildren();for(let g=0;g<y.length;++g){const f=y[g];if(f){f.Sj();const y=H.j.Matrix[0];f.Uj.multiplyToRef(this.Uj,y);const g=H.j.Quaternion[0];y.decompose(f.pe,g,f.position),f.rotationQuaternion?f.rotationQuaternion.p(g):g.toEulerAnglesToRef(f.rotation)}}}this.pe.ne(1,1,1),this.position.ne(0,0,0),this.rotation.ne(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=H.g.Identity()),this._worldMatrix=H.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(y){return this.onAfterWorldMatrixUpdateObservable.add(y),this}unregisterAfterWorldMatrixUpdate(y){return this.onAfterWorldMatrixUpdateObservable.removeCallback(y),this}getPositionInCameraSpace(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y||(y=this.va().activeCamera),H.m.TransformCoordinates(this.getAbsolutePosition(),y.getViewMatrix())}getDistanceToCamera(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y||(y=this.va().activeCamera),this.getAbsolutePosition().ed(y.globalPosition).length()}clone(y,g,f){const p=k.c.Clone((()=>new Z(y,this.va())),this);if(p.name=y,p.id=y,g&&(p.parent=g),!f){const g=this.getDescendants(!0);for(let f=0;f<g.length;f++){const S=g[f];S.clone&&S.clone(y+"."+S.name,p)}}return p}serialize(y){const g=k.c.Serialize(this,y);return g.type=this.getClassName(),g.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(g),g.localMatrix=this.getPivotMatrix().mj(),g.isEnabled=this.isEnabled(),k.c.AppendSerializedAnimations(this,g),g.ranges=this.serializeAnimationRanges(),g}static Parse(y,g,f){const p=k.c.Parse((()=>new Z(y.name,g)),y,g,f);if(y.localMatrix?p.setPreTransformMatrix(H.c.eh(y.localMatrix)):y.pivotMatrix&&p.setPivotMatrix(H.c.eh(y.pivotMatrix)),p.Mb(y.isEnabled),p._waitingParsedUniqueId=y.uniqueId,void 0!==y.parentId&&(p._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(p._waitingParentInstanceIndex=y.parentInstanceIndex),y.animations){for(let g=0;g<y.animations.length;g++){const f=y.animations[g],S=(0,l.b)("BABYLON.Animation");S&&p.animations.push(S.Parse(f))}U.d.ParseAnimationRanges(p,y,g)}return y.autoAnimate&&g.beginAnimation(p,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),p}getChildTransformNodes(y,g){const f=[];return this._getDescendants(f,y,(y=>(!g||g(y))&&y instanceof Z)),f}dispose(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const y=this._parentContainer.transformNodes.indexOf(this);y>-1&&this._parentContainer.transformNodes.splice(y,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),y){const y=this.getChildTransformNodes(!0);for(const g of y)g.parent=null,g.Sj(!0)}super.dispose(y,g)}normalizeToUnitCube(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0,p=null,S=null;g&&(this.rotationQuaternion?(S=this.rotationQuaternion.clone(),this.rotationQuaternion.ne(0,0,0,1)):this.rotation&&(p=this.rotation.clone(),this.rotation.ne(0,0,0)));const k=this.getHierarchyBoundingVectors(y,f),i=k.max.ed(k.min),H=Math.max(i.x,i.y,i.z);if(0===H)return this;const U=1/H;return this.pe.scaleInPlace(U),g&&(this.rotationQuaternion&&S?this.rotationQuaternion.p(S):this.rotation&&p&&this.rotation.p(p)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}Z.BILLBOARDMODE_NONE=0,Z.BILLBOARDMODE_X=1,Z.BILLBOARDMODE_Y=2,Z.BILLBOARDMODE_Z=4,Z.BILLBOARDMODE_ALL=7,Z.BILLBOARDMODE_USE_POSITION=128,Z.BillboardUseParentOrientation=!1,Z._TmpRotation=H.g.Zero(),Z._TmpScaling=H.m.Zero(),Z._TmpTranslation=H.m.Zero(),Z._LookAtVectorCache=new H.m(0,0,0),Z._RotationAxisCache=new H.g,(0,p.c)([(0,S.H)("position")],Z.prototype,"_position",void 0),(0,p.c)([(0,S.H)("rotation")],Z.prototype,"_rotation",void 0),(0,p.c)([(0,S.A)("rotationQuaternion")],Z.prototype,"_rotationQuaternion",void 0),(0,p.c)([(0,S.H)("pe")],Z.prototype,"_scaling",void 0),(0,p.c)([(0,S.I)("billboardMode")],Z.prototype,"_billboardMode",void 0),(0,p.c)([(0,S.I)()],Z.prototype,"scalingDeterminant",void 0),(0,p.c)([(0,S.I)("infiniteDistance")],Z.prototype,"_infiniteDistance",void 0),(0,p.c)([(0,S.I)()],Z.prototype,"ignoreNonUniformScaling",void 0),(0,p.c)([(0,S.I)()],Z.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11572:(y,g,f)=>{"use strict";f.d(g,{c:()=>l});var p=f(11054),S=f(11079),k=f(11555),i=f(11062),H=f(11090);class U{constructor(y,g,f,p){this.name=y,this.worldAxisForNormal=g,this.worldAxisForFileX=f,this.worldAxisForFileY=p}}class l{static ConvertCubeMapTextureToSphericalPolynomial(y){var g;if(!y.isCube)return null;null===(g=y.va())||void 0===g||g.getEngine().flushFramebuffer();const f=y.getSize().width,p=y.readPixels(0,void 0,void 0,!1),S=y.readPixels(1,void 0,void 0,!1);let k,i;y.isRenderTarget?(k=y.readPixels(3,void 0,void 0,!1),i=y.readPixels(2,void 0,void 0,!1)):(k=y.readPixels(2,void 0,void 0,!1),i=y.readPixels(3,void 0,void 0,!1));const H=y.readPixels(4,void 0,void 0,!1),U=y.readPixels(5,void 0,void 0,!1),l=y.gammaSpace;let c=0;return 1!=y.textureType&&2!=y.textureType||(c=1),new Promise((y=>{Promise.all([S,p,k,i,H,U]).then((g=>{let[p,S,k,i,H,U]=g;const Z={size:f,right:S,left:p,up:k,down:i,front:H,back:U,format:5,type:c,gammaSpace:l};y(this.ConvertCubeMapToSphericalPolynomial(Z))}))}))}static _AreaElement(y,g){return Math.atan2(y*g,Math.sqrt(y*y+g*g+1))}static ConvertCubeMapToSphericalPolynomial(y){const g=new k.e;let f=0;const p=2/y.size,U=p,l=.5*p,c=l-1;for(let k=0;k<6;k++){const Z=this._FileFaces[k],C=y[Z.name];let q=c;const W=5===y.format?4:3;for(let k=0;k<y.size;k++){let j=c;for(let U=0;U<y.size;U++){const c=Z.worldAxisForFileX.scale(j).add(Z.worldAxisForFileY.scale(q)).add(Z.worldAxisForNormal);c.normalize();const P=this._AreaElement(j-l,q-l)-this._AreaElement(j-l,q+l)-this._AreaElement(j+l,q-l)+this._AreaElement(j+l,q+l);let B=C[k*y.size*W+U*W+0],R=C[k*y.size*W+U*W+1],G=C[k*y.size*W+U*W+2];isNaN(B)&&(B=0),isNaN(R)&&(R=0),isNaN(G)&&(G=0),0===y.type&&(B/=255,R/=255,G/=255),y.gammaSpace&&(B=Math.pow((0,S.d)(B),i.m),R=Math.pow((0,S.d)(R),i.m),G=Math.pow((0,S.d)(G),i.m));const z=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const y=Math.max(B,R,G);if(y>z){const g=z/y;B*=g,R*=g,G*=g}}else B=(0,S.d)(B,0,z),R=(0,S.d)(R,0,z),G=(0,S.d)(G,0,z);const T=new H.c(B,R,G);g.addLight(c,T,P),f+=P,j+=p}q+=U}}const Z=6*(4*Math.PI)/6/f;return g.scaleInPlace(Z),g.convertIncidentRadianceToIrradiance(),g.convertIrradianceToLambertianRadiance(),k.f.FromHarmonics(g)}}l._FileFaces=[new U("right",new p.m(1,0,0),new p.m(0,0,-1),new p.m(0,-1,0)),new U("left",new p.m(-1,0,0),new p.m(0,0,1),new p.m(0,-1,0)),new U("up",new p.m(0,1,0),new p.m(1,0,0),new p.m(0,0,1)),new U("down",new p.m(0,-1,0),new p.m(1,0,0),new p.m(0,0,-1)),new U("front",new p.m(0,0,1),new p.m(1,0,0),new p.m(0,-1,0)),new U("back",new p.m(0,0,-1),new p.m(-1,0,0),new p.m(0,-1,0))],l.MAX_HDRI_VALUE=4096,l.PRESERVE_CLAMPED_COLORS=!1},11071:(y,g,f)=>{"use strict";function p(y,g){const f=[];for(let p=0;p<y;++p)f.push(g());return f}function S(y,g){return p(y,g)}f.d(g,{d:()=>p,f:()=>S,j:()=>i});const k=["push","splice","pop","shift","unshift"];function i(y,g){const f=k.map((f=>function(y,g,f){const p=y[g];if("function"!==typeof p)return null;const S=function(){const p=y.length,k=S.previous.apply(y,arguments);return f(g,p),k};return p.next=S,S.previous=p,y[g]=S,()=>{const f=S.previous;if(!f)return;const p=S.next;p?(f.next=p,p.previous=f):(f.next=void 0,y[g]=f),S.next=void 0,S.previous=void 0}}(y,f,g)));return()=>{f.forEach((y=>{null===y||void 0===y||y()}))}}},12253:(y,g,f)=>{"use strict";f.d(g,{c:()=>i});var p=f(11267),S=f(12260);let k=0;const i=y=>{if(!y.environmentBRDFTexture){const g=y.useDelayedTextureLoading;y.useDelayedTextureLoading=!1;const f=y._blockEntityCollection;y._blockEntityCollection=!1;const i=p.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+k++,y,!0,!1,p.c.BILINEAR_SAMPLINGMODE);y._blockEntityCollection=f;const H=y.getEngine().getLoadedTexturesCache(),U=H.indexOf(i.getInternalTexture());-1!==U&&H.splice(U,1),i.isRGBD=!0,i.wrapU=p.c.CLAMP_ADDRESSMODE,i.wrapV=p.c.CLAMP_ADDRESSMODE,y.environmentBRDFTexture=i,y.useDelayedTextureLoading=g,S.c.ExpandRGBDTexture(i);const l=y.getEngine().onContextRestoredObservable.add((()=>{i.isRGBD=!0;const g=y.onBeforeRenderObservable.add((()=>{i.isReady()&&(y.onBeforeRenderObservable.remove(g),S.c.ExpandRGBDTexture(i))}))}));y.nj.add((()=>{y.getEngine().onContextRestoredObservable.remove(l)}))}return y.environmentBRDFTexture}},11325:(y,g,f)=>{"use strict";function p(y,g,f){try{const p=y.next();p.done?g(p):p.value?p.value.then((()=>{p.value=void 0,g(p)}),f):g(p)}catch(p){f(p)}}function S(){let y,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(f,S,k)=>{const i=performance.now();void 0===y||i-y>g?(y=i,setTimeout((()=>{p(f,S,k)}),0)):p(f,S,k)}}function k(y,g,f,p,S){const k=()=>{let i;const H=y=>{y.done?f(y.value):void 0===i?i=!0:k()};do{i=void 0,S&&S.aborted?p(new Error("Aborted")):g(y,H,p),void 0===i&&(i=!1)}while(i)};k()}function i(y,g){let f;return k(y,p,(y=>f=y),(y=>{throw y}),g),f}function H(y,g,f){return new Promise(((p,S)=>{k(y,g,p,S,f)}))}function U(y,g){return function(){return i(y(...arguments),g)}}f.d(g,{d:()=>S,e:()=>U,i:()=>H,m:()=>i})},11568:(y,g,f)=>{"use strict";f.d(g,{d:()=>W});var p=f(11079),S=f(10736),k=f(11572),i=f(11581);f(11607);const H=131072,U=131072;function l(y){return y.charCodeAt(0)+(y.charCodeAt(1)<<8)+(y.charCodeAt(2)<<16)+(y.charCodeAt(3)<<24)}const c=l("DXT1"),Z=l("DXT3"),C=l("DXT5"),q=l("DX10");class W{static GetDDSInfo(y){const g=new Int32Array(y.buffer,y.byteOffset,31),f=new Int32Array(y.buffer,y.byteOffset,35);let p=1;g[2]&H&&(p=Math.max(1,g[7]));const S=g[21],k=S===q?f[32]:0;let i=0;switch(S){case 113:i=2;break;case 116:i=1;break;case q:if(10===k){i=2;break}if(2===k){i=1;break}}return{width:g[4],height:g[3],mipmapCount:p,isFourCC:4===(4&g[20]),isRGB:64===(64&g[20]),isLuminance:(g[20]&U)===U,isCube:512===(512&g[28]),isCompressed:S===c||S===Z||S===C,dxgiFormat:k,textureType:i}}static _GetHalfFloatAsFloatRGBAArrayBuffer(y,g,f,p,S,k){const H=new Float32Array(p),U=new Uint16Array(S,f);let l=0;for(let c=0;c<g;c++)for(let g=0;g<y;g++){const f=4*(g+c*y);H[l]=(0,i.e)(U[f]),H[l+1]=(0,i.e)(U[f+1]),H[l+2]=(0,i.e)(U[f+2]),W.StoreLODInAlphaChannel?H[l+3]=k:H[l+3]=(0,i.e)(U[f+3]),l+=4}return H}static _GetHalfFloatRGBAArrayBuffer(y,g,f,p,S,k){if(W.StoreLODInAlphaChannel){const H=new Uint16Array(p),U=new Uint16Array(S,f);let l=0;for(let f=0;f<g;f++)for(let g=0;g<y;g++){const p=4*(g+f*y);H[l]=U[p],H[l+1]=U[p+1],H[l+2]=U[p+2],H[l+3]=(0,i.h)(k),l+=4}return H}return new Uint16Array(S,f,p)}static _GetFloatRGBAArrayBuffer(y,g,f,p,S,k){if(W.StoreLODInAlphaChannel){const i=new Float32Array(p),H=new Float32Array(S,f);let U=0;for(let f=0;f<g;f++)for(let g=0;g<y;g++){const p=4*(g+f*y);i[U]=H[p],i[U+1]=H[p+1],i[U+2]=H[p+2],i[U+3]=k,U+=4}return i}return new Float32Array(S,f,p)}static _GetFloatAsHalfFloatRGBAArrayBuffer(y,g,f,p,S,k){const H=new Uint16Array(p),U=new Float32Array(S,f);let l=0;for(let c=0;c<g;c++)for(let g=0;g<y;g++)H[l]=(0,i.h)(U[l]),H[l+1]=(0,i.h)(U[l+1]),H[l+2]=(0,i.h)(U[l+2]),W.StoreLODInAlphaChannel?H[l+3]=(0,i.h)(k):H[l+3]=(0,i.h)(U[l+3]),l+=4;return H}static _GetFloatAsUIntRGBAArrayBuffer(y,g,f,S,k,i){const H=new Uint8Array(S),U=new Float32Array(k,f);let l=0;for(let c=0;c<g;c++)for(let g=0;g<y;g++){const f=4*(g+c*y);H[l]=255*(0,p.d)(U[f]),H[l+1]=255*(0,p.d)(U[f+1]),H[l+2]=255*(0,p.d)(U[f+2]),W.StoreLODInAlphaChannel?H[l+3]=i:H[l+3]=255*(0,p.d)(U[f+3]),l+=4}return H}static _GetHalfFloatAsUIntRGBAArrayBuffer(y,g,f,S,k,H){const U=new Uint8Array(S),l=new Uint16Array(k,f);let c=0;for(let Z=0;Z<g;Z++)for(let g=0;g<y;g++){const f=4*(g+Z*y);U[c]=255*(0,p.d)((0,i.e)(l[f])),U[c+1]=255*(0,p.d)((0,i.e)(l[f+1])),U[c+2]=255*(0,p.d)((0,i.e)(l[f+2])),W.StoreLODInAlphaChannel?U[c+3]=H:U[c+3]=255*(0,p.d)((0,i.e)(l[f+3])),c+=4}return U}static _GetRGBAArrayBuffer(y,g,f,p,S,k,i,H,U){const l=new Uint8Array(p),c=new Uint8Array(S,f);let Z=0;for(let C=0;C<g;C++)for(let g=0;g<y;g++){const f=4*(g+C*y);l[Z]=c[f+k],l[Z+1]=c[f+i],l[Z+2]=c[f+H],l[Z+3]=c[f+U],Z+=4}return l}static _ExtractLongWordOrder(y){return 0===y||255===y||-16777216===y?0:1+W._ExtractLongWordOrder(y>>8)}static _GetRGBArrayBuffer(y,g,f,p,S,k,i,H){const U=new Uint8Array(p),l=new Uint8Array(S,f);let c=0;for(let Z=0;Z<g;Z++)for(let g=0;g<y;g++){const f=3*(g+Z*y);U[c]=l[f+k],U[c+1]=l[f+i],U[c+2]=l[f+H],c+=3}return U}static _GetLuminanceArrayBuffer(y,g,f,p,S){const k=new Uint8Array(p),i=new Uint8Array(S,f);let H=0;for(let U=0;U<g;U++)for(let g=0;g<y;g++){const f=g+U*y;k[H]=i[f],H++}return k}static UploadDDSLevels(y,g,f,p,i,U){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,j=arguments.length>7?arguments[7]:void 0,P=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],B=null;p.sphericalPolynomial&&(B=[]);const R=!!y.getCaps().s3tc;g.generateMipMaps=i;const G=new Int32Array(f.buffer,f.byteOffset,31);let z,T,Q,m,a,w,o,I=0,Y=0,n=1;if(542327876!==G[0])return void S.d.Error("Invalid magic number in DDS header");if(!p.isFourCC&&!p.isRGB&&!p.isLuminance)return void S.d.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(p.isCompressed&&!R)return void S.d.Error("Compressed textures are not supported on this platform.");let M=G[22];m=G[1]+4;let r=!1;if(p.isFourCC)switch(z=G[21],z){case c:n=8,Y=33777;break;case Z:n=16,Y=33778;break;case C:n=16,Y=33779;break;case 113:r=!0,M=64;break;case 116:r=!0,M=128;break;case q:{m+=20;let y=!1;switch(p.dxgiFormat){case 10:r=!0,M=64,y=!0;break;case 2:r=!0,M=128,y=!0;break;case 88:p.isRGB=!0,p.isFourCC=!1,M=32,y=!0}if(y)break}default:return void S.d.Error(["Unsupported FourCC code:",(N=z,String.fromCharCode(255&N,N>>8&255,N>>16&255,N>>24&255))])}var N;const b=W._ExtractLongWordOrder(G[23]),s=W._ExtractLongWordOrder(G[24]),u=W._ExtractLongWordOrder(G[25]),F=W._ExtractLongWordOrder(G[26]);r&&(Y=y._getRGBABufferInternalSizedFormat(p.textureType)),w=1,G[2]&H&&!1!==i&&(w=Math.max(1,G[7]));const A=j||0,J=y.getCaps();for(let S=A;S<U;S++){for(T=G[4],Q=G[3],o=0;o<w;++o){if(-1===l||l===o){const k=-1===l?o:0;if(!p.isCompressed&&p.isFourCC){g.format=5,I=T*Q*4;let p=null;if(y._badOS||y._badDesktopOS||!J.textureHalfFloat&&!J.textureFloat)128===M?(p=W._GetFloatAsUIntRGBAArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer,k),B&&0==k&&B.push(W._GetFloatRGBAArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer,k))):64===M&&(p=W._GetHalfFloatAsUIntRGBAArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer,k),B&&0==k&&B.push(W._GetHalfFloatAsFloatRGBAArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer,k))),g.type=0;else{const y=J.textureFloat&&(P&&J.textureFloatLinearFiltering||!P),S=J.textureHalfFloat&&(P&&J.textureHalfFloatLinearFiltering||!P),i=(128===M||64===M&&!S)&&y?1:(64===M||128===M&&!y)&&S?2:0;let H,U=null;if(128===M)switch(i){case 1:H=W._GetFloatRGBAArrayBuffer,U=null;break;case 2:H=W._GetFloatAsHalfFloatRGBAArrayBuffer,U=W._GetFloatRGBAArrayBuffer;break;case 0:H=W._GetFloatAsUIntRGBAArrayBuffer,U=W._GetFloatRGBAArrayBuffer}else switch(i){case 1:H=W._GetHalfFloatAsFloatRGBAArrayBuffer,U=null;break;case 2:H=W._GetHalfFloatRGBAArrayBuffer,U=W._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:H=W._GetHalfFloatAsUIntRGBAArrayBuffer,U=W._GetHalfFloatAsFloatRGBAArrayBuffer}g.type=i,p=H(T,Q,f.byteOffset+m,I,f.buffer,k),B&&0==k&&B.push(U?U(T,Q,f.byteOffset+m,I,f.buffer,k):p)}p&&y._uploadDataToTextureDirectly(g,p,S,k)}else if(p.isRGB)g.type=0,24===M?(g.format=4,I=T*Q*3,a=W._GetRGBArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer,b,s,u),y._uploadDataToTextureDirectly(g,a,S,k)):(g.format=5,I=T*Q*4,a=W._GetRGBAArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer,b,s,u,F),y._uploadDataToTextureDirectly(g,a,S,k));else if(p.isLuminance){const p=y._getUnpackAlignement(),i=T;I=Math.floor((T+p-1)/p)*p*(Q-1)+i,a=W._GetLuminanceArrayBuffer(T,Q,f.byteOffset+m,I,f.buffer),g.format=1,g.type=0,y._uploadDataToTextureDirectly(g,a,S,k)}else I=Math.max(4,T)/4*Math.max(4,Q)/4*n,a=new Uint8Array(f.buffer,f.byteOffset+m,I),g.type=0,y._uploadCompressedDataToTextureDirectly(g,Y,T,Q,a,S,k)}m+=M?T*Q*(M/8):I,T*=.5,Q*=.5,T=Math.max(1,T),Q=Math.max(1,Q)}if(void 0!==j)break}B&&B.length>0?p.sphericalPolynomial=k.c.ConvertCubeMapToSphericalPolynomial({size:G[4],right:B[0],left:B[1],up:B[2],down:B[3],front:B[4],back:B[5],format:5,type:1,gammaSpace:!1}):p.sphericalPolynomial=void 0}}W.StoreLODInAlphaChannel=!1},11033:(y,g,f)=>{"use strict";f.d(g,{e:()=>k,i:()=>i});const p={},S={};function k(y){const g=y.getClassName();return S[g]||(S[g]={}),S[g]}function i(y){const g=y.getClassName();if(p[g])return p[g];p[g]={};const f=p[g];let k=y,i=g;for(;i;){const y=S[i];for(const S in y)f[S]=y[S];let g,p=!1;do{if(g=Object.getPrototypeOf(k),!g.getClassName){p=!0;break}if(g.getClassName()!==i)break;k=g}while(g);if(p)break;i=g.getClassName(),k=g}return f}},11026:(y,g,f)=>{"use strict";f.d(g,{A:()=>P,E:()=>H,F:()=>c,H:()=>Z,I:()=>i,d:()=>k,e:()=>R,h:()=>q,l:()=>U,o:()=>W,s:()=>l,t:()=>j,v:()=>B,y:()=>C});var p=f(11033);function S(y,g){return(f,S)=>{const k=(0,p.e)(f);k[S]||(k[S]={type:y,sourceName:g})}}function k(y){return function(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(f,p)=>{const S=g||"_"+p;Object.defineProperty(f,p,{get:function(){return this[S]},set:function(g){"function"===typeof this.equals&&this.equals(g)||this[S]!==g&&(this[S]=g,f[y].apply(this))},enumerable:!0,configurable:!0})}}(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function i(y){return S(0,y)}function H(y){return S(1,y)}function U(y){return S(2,y)}function l(y){return S(3,y)}function c(y){return S(4,y)}function Z(y){return S(5,y)}function C(y){return S(6,y)}function q(y){return S(7,y)}function W(y){return S(8,y)}function j(y){return S(9,y)}function P(y){return S(10,y)}function B(y){return S(12,y)}function R(y,g,f,p){const S=f.value;f.value=function(){let f=S;if("undefined"!==typeof _native&&_native[g]){const y=_native[g];f=p?function(){return p(...arguments)?y(...arguments):S(...arguments)}:y}return y[g]=f,f(...arguments)}}R.filter=function(y){return(g,f,p)=>R(g,f,p,y)}},11099:(y,g,f)=>{"use strict";f.d(g,{c:()=>l});var p=f(10755),S=f(11046),k=f(11090),i=f(11054),H=f(11033);const U=function(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const k=y();S.e&&S.e.HasTags(g)&&S.e.AddTagsTo(k,S.e.GetTags(g,!0));const i=(0,H.i)(k),U={};for(const S in i){const y=i[S],H=g[S],c=y.type;if(void 0!==H&&null!==H&&("uniqueId"!==S||l.AllowLoadingUniqueId))switch(c){case 0:case 6:case 11:k[S]=H;break;case 1:p.cloneTexturesOnlyOnce&&U[H.uniqueId]?k[S]=U[H.uniqueId]:(k[S]=f||H.isRenderTarget?H:H.clone(),U[H.uniqueId]=k[S]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:k[S]=f?H:H.clone()}}return k};class l{static AppendSerializedAnimations(y,g){if(y.animations){g.animations=[];for(let f=0;f<y.animations.length;f++){const p=y.animations[f];g.animations.push(p.serialize())}}}static Serialize(y,g){g||(g={}),S.e&&(g.tags=S.e.GetTags(y));const f=(0,H.i)(y);for(const p in f){const S=f[p],k=S.sourceName||p,i=S.type,H=y[p];if(void 0!==H&&null!==H&&("uniqueId"!==p||l.AllowLoadingUniqueId))switch(i){case 0:g[k]=H;break;case 1:case 3:case 7:case 9:g[k]=H.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:g[k]=H.mj();break;case 6:case 11:g[k]=H.id}}return g}static ParseProperties(y,g,f,p){p||(p="");const S=(0,H.i)(g);for(const H in S){const U=S[H],c=y[U.sourceName||H],Z=U.type;if(void 0!==c&&null!==c&&("uniqueId"!==H||l.AllowLoadingUniqueId)){const y=g;switch(Z){case 0:y[H]=c;break;case 1:f&&(y[H]=l._TextureParser(c,f,p));break;case 2:y[H]=k.c.eh(c);break;case 3:y[H]=l._FresnelParametersParser(c);break;case 4:y[H]=i.l.eh(c);break;case 5:y[H]=i.m.eh(c);break;case 6:f&&(y[H]=f.getLastMeshById(c));break;case 7:y[H]=l._ColorCurvesParser(c);break;case 8:y[H]=k.f.eh(c);break;case 9:y[H]=l._ImageProcessingConfigurationParser(c);break;case 10:y[H]=i.g.eh(c);break;case 11:f&&(y[H]=f.getCameraById(c));break;case 12:y[H]=i.c.eh(c)}}}}static Parse(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=y();return S.e&&S.e.AddTagsTo(k,g.tags),l.ParseProperties(g,k,f,p),k}static Clone(y,g){return U(y,g,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(y,g){return U(y,g,!0)}}l.AllowLoadingUniqueId=!1,l._ImageProcessingConfigurationParser=y=>{throw(0,p.b)("ImageProcessingConfiguration")},l._FresnelParametersParser=y=>{throw(0,p.b)("FresnelParameters")},l._ColorCurvesParser=y=>{throw(0,p.b)("ColorCurves")},l._TextureParser=(y,g,f)=>{throw(0,p.b)("Texture")}},10740:(y,g,f)=>{"use strict";f.d(g,{b:()=>k});var p=f(10736);const S=(y,g,f)=>y?y.getClassName&&"Mesh"===y.getClassName()?null:!y.getClassName||"SubMesh"!==y.getClassName()&&"PhysicsBody"!==y.getClassName()?y.clone?y.clone():Array.isArray(y)?y.slice():f&&"object"===typeof y?{...y}:null:y.clone(g):null;class k{static DeepCopy(y,g,f,k){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const H=function(y){const g=[];do{Object.getOwnPropertyNames(y).forEach((function(y){-1===g.indexOf(y)&&g.push(y)}))}while(y=Object.getPrototypeOf(y));return g}(y);for(const l of H){if("_"===l[0]&&(!k||-1===k.indexOf(l)))continue;if(l.endsWith("Observable"))continue;if(f&&-1!==f.indexOf(l))continue;const H=y[l],c=typeof H;if("function"!==c)try{if("object"===c)if(H instanceof Uint8Array)g[l]=Uint8Array.from(H);else if(H instanceof Array){if(g[l]=[],H.length>0)if("object"==typeof H[0])for(let y=0;y<H.length;y++){const f=S(H[y],g,i);-1===g[l].indexOf(f)&&g[l].push(f)}else g[l]=H.slice(0)}else g[l]=S(H,g,i);else g[l]=H}catch(U){p.d.Warn(U.message)}}}}},10755:(y,g,f)=>{"use strict";f.d(g,{b:()=>S});const p={};function S(y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!p[y])return p[y]=!0,`${y} needs to be imported before as it contains a side-effect required by your code.`}},10730:(y,g,f)=>{"use strict";function p(){return"undefined"!==typeof window}function S(){return"undefined"!==typeof navigator}function k(){return"undefined"!==typeof document}function i(y){let g="",f=y.firstChild;for(;f;)3===f.nodeType&&(g+=f.textContent),f=f.nextSibling;return g}f.d(g,{c:()=>i,d:()=>k,g:()=>S,i:()=>p})},12300:(y,g,f)=>{"use strict";f.r(g),f.d(g,{Dispose:()=>C,DumpData:()=>Z,DumpDataAsync:()=>c,DumpFramebuffer:()=>l,DumpTools:()=>q});var p=f(11594),S=f(10714),k=f(11079),i=f(10761);let H,U=null;async function l(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",k=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const H=await f.readPixels(0,0,y,g);Z(y,g,new Uint8Array(H.buffer),p,S,k,!0,void 0,i)}function c(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0;return new Promise((U=>{Z(y,g,f,(y=>U(y)),p,S,k,i,H)}))}function Z(y,g,l,c){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((y,g)=>{let S,k=null;const U={Eh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(f.bind(f,11502)).then((l=>{let{ThinEngine:c}=l;try{S=new OffscreenCanvas(100,100),k=new c(S,!1,U)}catch(q){S=document.createElement("canvas"),k=new c(S,!1,U)}i.d.Instances.pop(),i.d.OnEnginesDisposedObservable.add((y=>{k&&y!==k&&!k.u&&0===i.d.Instances.length&&C()})),k.getCaps().parallelShaderCompile=void 0;const Z=new p.b(k);f.e(34).then(f.bind(f,13530)).then((f=>{let{passPixelShader:i}=f;if(!k)return void g("Engine is not defined");const U=new p.c({Ed:k,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});H={canvas:S,Ed:k,renderer:Z,wrapper:U},y(H)}))})).catch(g)}))),await U})().then((f=>{if(f.Ed.setSize(y,g,!0),l instanceof Float32Array){const y=new Uint8Array(l.length);let g=l.length;for(;g--;){const f=l[g];y[g]=Math.round(255*(0,k.d)(f))}l=y}const p=f.Ed.createRawTexture(l,y,g,5,!1,!W,1);f.renderer.setViewport(),f.renderer.applyEffectWrapper(f.wrapper),f.wrapper.effect._bindTexture("textureSampler",p),f.renderer.draw(),j?S.e.ToBlob(f.canvas,(y=>{const g=new FileReader;g.onload=y=>{const g=y.target.result;c&&c(g)},g.readAsArrayBuffer(y)}),Z,P):S.e.EncodeScreenshotCanvasData(f.canvas,c,Z,q,P),p.dispose()}))}function C(){var y;H?(H.wrapper.dispose(),H.renderer.dispose(),H.Ed.dispose()):null===(y=U)||void 0===y||y.then((y=>{y.wrapper.dispose(),y.renderer.dispose(),y.Ed.dispose()}));U=null,H=null}const q={DumpData:Z,DumpDataAsync:c,DumpFramebuffer:l,Dispose:C};S.e.DumpData=Z,S.e.DumpDataAsync=c,S.e.DumpFramebuffer=l},12295:(y,g,f)=>{"use strict";f.d(g,{d:()=>W,e:()=>B,i:()=>z,k:()=>T});var p=f(10714),S=f(11054),k=f(11079),i=f(11555),H=f(10845),U=f(11271),l=(f(11038),f(11590)),c=f(10736);f(12260),f(12270),f(12300);const Z="image/png",C=2,q=[134,22,135,150,246,214,150,54];function W(y){const g=new DataView(y.buffer,y.byteOffset,y.byteLength);let f=0;for(let i=0;i<q.length;i++)if(g.getUint8(f++)!==q[i])return c.d.Error("Not a babylon environment map"),null;let p="",S=0;for(;S=g.getUint8(f++);)p+=String.fromCharCode(S);let k=JSON.parse(p);return k=j(k),k.Hh&&(k.Hh.specularDataPosition=f,k.Hh.lodGenerationScale=k.Hh.lodGenerationScale||.8),k}function j(y){if(y.version>C)throw new Error(`Unsupported babylon environment map version "${y.version}". Latest supported version is "${C}".`);return 2===y.version?y:y={...y,version:2,imageType:Z}}function P(y,g){const f=(g=j(g)).Hh;let p=Math.log2(g.width);if(p=Math.round(p)+1,f.mipmaps.length!==6*p)throw new Error(`Unsupported specular mipmaps number "${f.mipmaps.length}"`);const S=new Array(p);for(let k=0;k<p;k++){S[k]=new Array(6);for(let g=0;g<6;g++){const p=f.mipmaps[6*k+g];S[k][g]=new Uint8Array(y.buffer,y.byteOffset+f.specularDataPosition+p.position,p.length)}}return S}function B(y,g,f){const p=(f=j(f)).Hh;if(!p)return Promise.resolve();y._lodGenerationScale=p.lodGenerationScale;return G(y,P(g,f),f.imageType)}function R(y,g,f,p,S,k,i,H,U,l,c){return new Promise(((Z,C)=>{if(f){const f=g.createTexture(null,!0,!0,null,1,null,(y=>{C(y)}),y);null===p||void 0===p||p.onEffectCreatedObservable.addOnce((H=>{H.executeWhenCompiled((()=>{p.externalTextureSamplerBinding=!0,p.onApply=p=>{p._bindTexture("textureSampler",f),p.setFloat2("scale",1,g._features.needsInvertingBitmap&&y instanceof ImageBitmap?-1:1)},g.scenes.length&&(g.scenes[0].postProcessManager.directRender([p],l,!0,k,i),g.restoreDefaultFramebuffer(),f.dispose(),URL.revokeObjectURL(S),Z())}))}))}else{if(g._uploadImageToTexture(c,y,k,i),H){const f=U[i];f&&g._uploadImageToTexture(f._texture,y,k,0)}Z()}}))}async function G(y,g){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z;if(!p.e.IsExponentOfTwo(y.width))throw new Error("Texture size must be a power of two");const i=(0,k.k)(y.width)+1,c=y.getEngine();let C=!1,q=!1,W=null,j=null,P=null;const B=c.getCaps();y.format=5,y.type=0,y.generateMipMaps=!0,y._cachedAnisotropicFilteringLevel=null,c.updateTextureSamplingMode(3,y),B.textureLOD?c._features.supportRenderAndCopyToLodForFloatTextures?B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(C=!0,y.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(C=!0,y.type=1):C=!1:(C=!1,q=!0,P={});let G=0;if(C)c.isWebGPU?(G=1,await f.e(39).then(f.bind(f,13564))):await f.e(41).then(f.bind(f,13575)),W=new l.c("rgbdDecode","rgbdDecode",null,null,1,null,3,c,!1,void 0,y.type,void 0,null,!1,void 0,G),y._isRGBD=!1,y.invertY=!1,j=c.createRenderTargetCubeTexture(y.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:y.type,format:5});else if(y._isRGBD=!0,y.invertY=!0,q){const g=3,f=y._lodGenerationScale,p=y._lodGenerationOffset;for(let S=0;S<g;S++){const k=(i-1)*f+p,l=p+(k-p)*(1-S/(g-1)),Z=Math.round(Math.min(Math.max(l,0),k)),C=new H.d(c,2);C.isCube=!0,C.invertY=!0,C.generateMipMaps=!1,c.updateTextureSamplingMode(2,C);const q=new U.c(null);switch(q._isCube=!0,q._texture=C,P[Z]=q,S){case 0:y._lodTextureLow=q;break;case 1:y._lodTextureMid=q;break;case 2:y._lodTextureHigh=q}}}const z=[];for(let f=0;f<g.length;f++)for(let p=0;p<6;p++){const k=g[f][p],i=new Blob([k],{type:S}),H=URL.createObjectURL(i);let U;if(c._features.forceBitmapOverHTMLImageElement)U=c.createImageBitmap(i,{premultiplyAlpha:"none"}).then((g=>R(g,c,C,W,H,p,f,q,P,j,y)));else{const g=new Image;g.src=H,U=new Promise(((S,k)=>{g.onload=()=>{R(g,c,C,W,H,p,f,q,P,j,y).then((()=>S())).catch((y=>{k(y)}))},g.onerror=y=>{k(y)}}))}z.push(U)}if(g.length<i){let f;const p=Math.pow(2,i-1-g.length),S=p*p*4;switch(y.type){case 0:f=new Uint8Array(S);break;case 2:f=new Uint16Array(S);break;case 1:f=new Float32Array(S)}for(let k=g.length;k<i;k++)for(let g=0;g<6;g++)c._uploadArrayBufferViewToTexture(y,f,g,k)}return Promise.all(z).then((()=>{j&&(c._releaseTexture(y),j._swapAndDie(y)),W&&W.dispose(),q&&(y._lodTextureHigh&&y._lodTextureHigh._texture&&(y._lodTextureHigh._texture.isReady=!0),y._lodTextureMid&&y._lodTextureMid._texture&&(y._lodTextureMid._texture.isReady=!0),y._lodTextureLow&&y._lodTextureLow._texture&&(y._lodTextureLow._texture.isReady=!0))}))}function z(y,g){const f=(g=j(g)).irradiance;if(!f)return;const p=new i.f;S.m.FromArrayToRef(f.x,0,p.x),S.m.FromArrayToRef(f.y,0,p.y),S.m.FromArrayToRef(f.z,0,p.z),S.m.FromArrayToRef(f.xx,0,p.xx),S.m.FromArrayToRef(f.yy,0,p.yy),S.m.FromArrayToRef(f.zz,0,p.zz),S.m.FromArrayToRef(f.yz,0,p.yz),S.m.FromArrayToRef(f.zx,0,p.zx),S.m.FromArrayToRef(f.xy,0,p.xy),y._sphericalPolynomial=p}function T(y,g,f,p,S){const k=G(y.getEngine().createRawCubeTexture(null,y.width,y.format,y.type,y.generateMipMaps,y.invertY,y.samplingMode,y._compression),g).then((()=>y));return y.onRebuildCallback=y=>({proxy:k,isReady:!0,isAsync:!0}),y._source=13,y._bufferViewArrayArray=g,y._lodGenerationScale=p,y._lodGenerationOffset=S,y._sphericalPolynomial=f,G(y,g).then((()=>(y.isReady=!0,y)))}},10775:(y,g,f)=>{"use strict";f.d(g,{d:()=>p,f:()=>S,j:()=>k});class p extends Error{}p._setPrototypeOf=Object.setPrototypeOf||((y,g)=>(y.__proto__=g,y));const S={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class k extends p{constructor(y,g,f){super(y),this.errorCode=g,this.innerError=f,this.name="RuntimeError",p._setPrototypeOf(this,k.prototype)}}},10766:(y,g,f)=>{"use strict";f.d(g,{e:()=>n,g:()=>G,j:()=>I,r:()=>a,n:()=>P,s:()=>Q,t:()=>m,v:()=>w,y:()=>z});var p=f(10757),S=f(10730),k=f(10723);class i{}i.FilesToLoad={};var H=f(10775),U=f(10783),l=f(10789),c=f(10761),Z=f(10736),C=f(10794),q=f(10791),W=f(10797);const j=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class P extends H.j{constructor(y,g){super(y,H.f.LoadFileError),this.name="LoadFileError",H.d._setPrototypeOf(this,P.prototype),g instanceof p.d?this.request=g:this.file=g}}class B extends H.j{constructor(y,g){super(y,H.f.RequestFileError),this.request=g,this.name="RequestFileError",H.d._setPrototypeOf(this,B.prototype)}}class R extends H.j{constructor(y,g){super(y,H.f.ReadFileError),this.file=g,this.name="ReadFileError",H.d._setPrototypeOf(this,R.prototype)}}const G={DefaultRetryStrategy:class{static ExponentialBackoff(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(f,p,S)=>0!==p.status||S>=y||-1!==f.indexOf("file:")?-1:Math.pow(2,S)*g}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:y=>y,ScriptBaseUrl:"",ScriptPreprocessUrl:y=>y,CleanUrl:y=>y=y.replace(/#/gm,"%23")},z=(y,g)=>{if((!y||0!==y.indexOf("data:"))&&G.CorsBehavior)if("string"===typeof G.CorsBehavior||G.CorsBehavior instanceof String)g.crossOrigin=G.CorsBehavior;else{const f=G.CorsBehavior(y);f&&(g.crossOrigin=f)}},T={getRequiredSize:null},Q=function(y,g,f,S){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",H=arguments.length>5?arguments[5]:void 0;const l=c.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===l||void 0===l||!l._features.forceBitmapOverHTMLImageElement))return f("LoadImage is only supported in web or BabylonNative environments."),null;let Z,C=!1;y instanceof ArrayBuffer||ArrayBuffer.isView(y)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(Z=URL.createObjectURL(new Blob([y],{type:k})),C=!0):Z=`data:${k};base64,`+(0,U.k)(y):y instanceof Blob?(Z=URL.createObjectURL(y),C=!0):(Z=G.CleanUrl(y),Z=G.PreprocessUrl(Z));const q=g=>{if(f){const p=Z||y.toString();f(`Error while trying to load image: ${0===p.indexOf("http")||p.length<=128?p:p.slice(0,128)+"..."}`,g)}};if(null!==l&&void 0!==l&&l._features.forceBitmapOverHTMLImageElement)return a(Z,(p=>{l.createImageBitmap(new Blob([p],{type:k}),{premultiplyAlpha:"none",...H}).then((y=>{g(y),C&&URL.revokeObjectURL(Z)})).catch((g=>{f&&f("Error while trying to load image: "+y,g)}))}),void 0,S||void 0,!0,((y,g)=>{q(g)})),null;const W=new Image;if(T.getRequiredSize){const g=T.getRequiredSize(y);g.width&&(W.width=g.width),g.height&&(W.height=g.height)}z(Z,W);const j=[],P=()=>{j.forEach((y=>{y.target.removeEventListener(y.name,y.handler)})),j.length=0};j.push({target:W,name:"load",handler:()=>{P(),g(W),C&&W.src&&URL.revokeObjectURL(W.src)}}),j.push({target:W,name:"error",handler:y=>{P(),q(y),C&&W.src&&URL.revokeObjectURL(W.src)}}),j.push({target:document,name:"securitypolicyviolation",handler:y=>{if(y.blockedURI!==W.src||"om"===y.disposition)return;P();const g=new Error(`CSP violation of policy ${y.effectiveDirective} ${y.blockedURI}. Current policy is ${y.originalPolicy}`);c.d.UseFallbackTexture=!1,q(g),C&&W.src&&URL.revokeObjectURL(W.src),W.src=""}}),j.forEach((y=>{y.target.addEventListener(y.name,y.handler)}));const B="blob:"===Z.substring(0,5),R="data:"===Z.substring(0,5),Q=()=>{B||R||!p.d.IsCustomRequestAvailable?W.src=Z:a(Z,((y,g,f)=>{const p=new Blob([y],{type:!k&&f?f:k}),S=URL.createObjectURL(p);C=!0,W.src=S}),void 0,S||void 0,!0,((y,g)=>{q(g)}))},m=()=>{S&&S.loadImage(Z,W)};if(!B&&!R&&S&&S.enableTexturesOffline)S.open(m,Q);else{if(-1!==Z.indexOf("file:")){const y=decodeURIComponent(Z.substring(5).toLowerCase());if(i.FilesToLoad[y]&&"undefined"!==typeof URL){try{let g;try{g=URL.createObjectURL(i.FilesToLoad[y])}catch(w){g=URL.createObjectURL(i.FilesToLoad[y])}W.src=g,C=!0}catch(o){W.src=""}return W}}Q()}return W},m=(y,g,f,p,S)=>{const i=new FileReader,H={onCompleteObservable:new k.d,abort:()=>i.abort()};return i.onloadend=()=>H.onCompleteObservable.notifyObservers(H),S&&(i.onerror=()=>{S(new R(`Unable to read ${y.name}`,y))}),i.onload=y=>{g(y.target.result)},f&&(i.onprogress=f),p?i.readAsArrayBuffer(y):i.readAsText(y),H},a=(y,g,f,p,S,U,l)=>{if(y.name)return m(y,g,f,S,U?y=>{U(void 0,y)}:void 0);const c=y;if(-1!==c.indexOf("file:")){let y=decodeURIComponent(c.substring(5).toLowerCase());0===y.indexOf("./")&&(y=y.substring(2));const p=i.FilesToLoad[y];if(p)return m(p,g,f,S,U?y=>U(void 0,new P(y.message,y.file)):void 0)}const{match:q,type:W}=Y(c);if(q){const y={onCompleteObservable:new k.d,abort:()=>()=>{}};try{const y=S?n(c):M(c);g(y,void 0,W)}catch(H){U?U(void 0,H):Z.d.Error(H.message||"Failed to parse the Data URL")}return C.c.SetImmediate((()=>{y.onCompleteObservable.notifyObservers(y)})),y}return w(c,((y,f)=>{g(y,null===f||void 0===f?void 0:f.responseURL,null===f||void 0===f?void 0:f.getResponseHeader("content-type"))}),f,p,S,U?y=>{U(y.request,new P(y.message,y.request))}:void 0,l)},w=(y,g,f,i,H,U,l)=>{y=G.CleanUrl(y),y=G.PreprocessUrl(y);const c=G.BaseUrl+y;let C=!1;const q={onCompleteObservable:new k.d,abort:()=>C=!0},W=()=>{let y,k=new p.d,i=null;const W=()=>{k&&(f&&k.removeEventListener("progress",f),y&&k.removeEventListener("readystatechange",y),k.removeEventListener("loadend",j))};let j=()=>{W(),q.onCompleteObservable.notifyObservers(q),q.onCompleteObservable.clear(),f=void 0,y=null,j=null,U=void 0,l=void 0,g=void 0};q.abort=()=>{C=!0,j&&j(),k&&k.readyState!==(XMLHttpRequest.DONE||4)&&k.abort(),null!==i&&(clearTimeout(i),i=null),k=null};const P=y=>{const g=y.message||"Unknown error";U&&k?U(new B(g,k)):Z.d.Error(g)},R=Z=>{if(k){if(k.open("GET",c),l)try{l(k)}catch(q){return void P(q)}H&&(k.responseType="arraybuffer"),f&&k.addEventListener("progress",f),j&&k.addEventListener("loadend",j),y=()=>{if(!C&&k&&k.readyState===(XMLHttpRequest.DONE||4)){if(y&&k.removeEventListener("readystatechange",y),k.status>=200&&k.status<300||0===k.status&&(!(0,S.i)()||o())){try{g&&g(H?k.response:k.responseText,k)}catch(q){P(q)}return}const f=G.DefaultRetryStrategy;if(f){const y=f(c,k,Z);if(-1!==y)return W(),k=new p.d,void(i=setTimeout((()=>R(Z+1)),y))}const l=new B("Error status: "+k.status+" "+k.statusText+" - Unable to load "+c,k);U&&U(l)}},k.addEventListener("readystatechange",y),k.send()}};R(0)};if(i&&i.enableSceneOffline){const p=y=>{y&&y.status>400?U&&U(y):W()},S=()=>{i&&i.loadFile(G.BaseUrl+y,(y=>{!C&&g&&g(y),q.onCompleteObservable.notifyObservers(q)}),f?y=>{!C&&f&&f(y)}:void 0,p,H)};i.open(S,p)}else W();return q},o=()=>"undefined"!==typeof location&&"file:"===location.protocol,I=y=>j.test(y),Y=y=>{const g=j.exec(y);if(null===g||0===g.length)return{match:!1,type:""};return{match:!0,type:g[0].replace("data:","").replace("base64,","")}};function n(y){return(0,U.c)(y.split(",")[1])}const M=y=>(0,U.g)(y.split(",")[1]);let r;W.b._FileToolsLoadImage=Q,q.c.loadFile=a,l.n.loadFile=a;((y,g,f,p,S,k,i,H,U,l)=>{r={DecodeBase64UrlToBinary:y,DecodeBase64UrlToString:g,DefaultRetryStrategy:f.DefaultRetryStrategy,BaseUrl:f.BaseUrl,CorsBehavior:f.CorsBehavior,PreprocessUrl:f.PreprocessUrl,IsBase64DataUrl:p,IsFileURL:S,LoadFile:k,LoadImage:i,ReadFile:H,RequestFile:U,SetCorsBehavior:l},Object.defineProperty(r,"DefaultRetryStrategy",{get:function(){return f.DefaultRetryStrategy},set:function(y){f.DefaultRetryStrategy=y}}),Object.defineProperty(r,"BaseUrl",{get:function(){return f.BaseUrl},set:function(y){f.BaseUrl=y}}),Object.defineProperty(r,"PreprocessUrl",{get:function(){return f.PreprocessUrl},set:function(y){f.PreprocessUrl=y}}),Object.defineProperty(r,"CorsBehavior",{get:function(){return f.CorsBehavior},set:function(y){f.CorsBehavior=y}})})(n,M,G,I,o,a,Q,m,w,z)},10878:(y,g,f)=>{"use strict";function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(y=>{const g=16*Math.random()|0;return("x"===y?g:3&g|8).toString(16)}))}f.d(g,{e:()=>p})},10869:(y,g,f)=>{"use strict";f.d(g,{e:()=>k});var p=f(10736),S=f(10871);class k{static Instantiate(y){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[y])return this.RegisteredExternalClasses[y];const g=(0,S.b)(y);if(g)return g;p.d.Warn(y+" not found, you may have missed an import.");const f=y.split(".");let k=window||this;for(let p=0,S=f.length;p<S;p++)k=k[f[p]];return"function"!==typeof k?null:k}}k.RegisteredExternalClasses={}},10736:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{static _CheckLimit(y,g){let f=p._LogLimitOutputs[y];return f?f.current++:(f={limit:g,current:1},p._LogLimitOutputs[y]=f),f.current<=f.limit}static _GenerateLimitMessage(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const f=p._LogLimitOutputs[y];if(!f||!p.MessageLimitReached)return;const S=this._Levels[g];f.current===f.limit&&p[S.name](p.MessageLimitReached.replace(/%LIMIT%/g,""+f.limit).replace(/%TYPE%/g,S.name??""))}static _AddLogEntry(y){p._LogCache=y+p._LogCache,p.OnNewCacheEntry&&p.OnNewCacheEntry(y)}static _FormatMessage(y){const g=y=>y<10?"0"+y:""+y,f=new Date;return"["+g(f.getHours())+":"+g(f.getMinutes())+":"+g(f.getSeconds())+"]: "+y}static _LogDisabled(y,g){}static _LogEnabled(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;const S=Array.isArray(g)?g[0]:g;if(void 0!==f&&!p._CheckLimit(S,f))return;const k=p._FormatMessage(S),i=this._Levels[y],H=Array.isArray(g)?g.slice(1):[];i.logFunc&&i.logFunc("BJS - "+k,...H);const U=`<div style='color:${i.color}'>${k}</div><br>`;p._AddLogEntry(U),p._GenerateLimitMessage(S,y)}static get LogCache(){return p._LogCache}static ClearLogCache(){p._LogCache="",p._LogLimitOutputs={},p.errorsCount=0}static set LogLevels(y){p.Log=p._LogDisabled,p.Warn=p._LogDisabled,p.Error=p._LogDisabled,[p.MessageLogLevel,p.WarningLogLevel,p.ErrorLogLevel].forEach((g=>{if((y&g)===g){const y=this._Levels[g];p[y.name]=p._LogEnabled.bind(p,g)}}))}}p.NoneLogLevel=0,p.MessageLogLevel=1,p.WarningLogLevel=2,p.ErrorLogLevel=4,p.AllLogLevel=7,p.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",p._LogCache="",p._LogLimitOutputs={},p._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],p.errorsCount=0,p.Log=p._LogEnabled.bind(p,p.MessageLogLevel),p.Warn=p._LogEnabled.bind(p,p.WarningLogLevel),p.Error=p._LogEnabled.bind(p,p.ErrorLogLevel)},10723:(y,g,f)=>{"use strict";f.d(g,{d:()=>k});class p{constructor(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0;this.initialize(y,g,f,p)}initialize(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0;return this.mask=y,this.skipNextObservers=g,this.target=f,this.currentTarget=p,this}}class S{constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=y,this.mask=g,this.scope=f,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class k{static FromPromise(y,g){const f=new k;return y.then((y=>{f.notifyObservers(y)})).catch((y=>{if(!g)throw y;g.notifyObservers(y)})),f}get observers(){return this._observers}constructor(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=g,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new p(0),y&&(this._onObserverAdded=y)}add(y){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!y)return null;const p=new S(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return p.unregisterOnNextCall=f,g?this._observers.unshift(p):this._observers.push(p),this._onObserverAdded&&this._onObserverAdded(p),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(p,this._lastNotifiedValue),p._remove=()=>{this.remove(p)},p}addOnce(y){return this.add(y,void 0,void 0,void 0,!0)}remove(y){if(!y)return!1;y._remove=null;return-1!==this._observers.indexOf(y)&&(this._deferUnregister(y),!0)}removeCallback(y,g){for(let f=0;f<this._observers.length;f++){const p=this._observers[f];if(!p._willBeUnregistered&&(p.callback===y&&(!g||g===p.scope)))return this._deferUnregister(p),!0}return!1}_deferUnregister(y){y._willBeUnregistered||(this._numObserversMarkedAsDeleted++,y.unregisterOnNextCall=!1,y._willBeUnregistered=!0,setTimeout((()=>{this._remove(y)}),0))}_remove(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!y)return!1;const f=this._observers.indexOf(y);return-1!==f&&(g&&this._numObserversMarkedAsDeleted--,this._observers.splice(f,1),!0)}makeObserverTopPriority(y){this._remove(y,!1),this._observers.unshift(y)}makeObserverBottomPriority(y){this._remove(y,!1),this._observers.push(y)}notifyObservers(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=y),!this._observers.length)return!0;const k=this._eventState;k.mask=g,k.target=f,k.currentTarget=p,k.skipNextObservers=!1,k.lastReturnValue=y,k.userInfo=S;for(const i of this._observers)if(!i._willBeUnregistered&&(i.mask&g&&(i.unregisterOnNextCall&&this._deferUnregister(i),i.scope?k.lastReturnValue=i.callback.apply(i.scope,[y,k]):k.lastReturnValue=i.callback(y,k)),k.skipNextObservers))return!1;return!0}notifyObserver(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=g),y._willBeUnregistered)return;const p=this._eventState;p.mask=f,p.skipNextObservers=!1,y.unregisterOnNextCall&&this._deferUnregister(y),y.callback(g,p)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const y=this._observers.pop();y&&(y._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const y=new k;return y._observers=this._observers.slice(0),y}hasSpecificMask(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const g of this._observers)if(g.mask&y||g.mask===y)return!0;return!1}}},10886:(y,g,f)=>{"use strict";f.d(g,{d:()=>S});var p=f(10747);class S{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(y,g){S.Enabled&&(this._current+=y,g&&this._fetchResult())}beginMonitoring(){S.Enabled&&(this._startMonitoringTime=p.c.Now)}endMonitoring(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!S.Enabled)return;y&&this.fetchNewFrame();const g=p.c.Now;this._current=g-this._startMonitoringTime,y&&this._fetchResult()}jj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const y=p.c.Now;y-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=y,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}S.Enabled=!0},10747:(y,g,f)=>{"use strict";f.d(g,{c:()=>S});var p=f(10730);class S{static get Now(){return(0,p.i)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12260:(y,g,f)=>{"use strict";f.d(g,{c:()=>k});var p=f(11590),S=f(11581);class k{static ExpandRGBDTexture(y){const g=y._texture;if(!g||!y.isRGBD)return;const S=g.getEngine(),k=S.getCaps(),i=g.isReady;let H=!1;k.textureHalfFloatRender&&k.textureHalfFloatLinearFiltering?(H=!0,g.type=2):k.textureFloatRender&&k.textureFloatLinearFiltering&&(H=!0,g.type=1),H&&(g.isReady=!1,g._isRGBD=!1,g.invertY=!1);const U=async()=>{const k=S.isWebGPU,i=k?1:0;g.isReady=!1,k?await Promise.all([f.e(39).then(f.bind(f,13564)),f.e(40).then(f.bind(f,13570))]):await Promise.all([f.e(41).then(f.bind(f,13575)),f.e(42).then(f.bind(f,13584))]);const H=new p.c("rgbdDecode","rgbdDecode",null,null,1,null,3,S,!1,void 0,g.type,void 0,null,!1,void 0,i);H.externalTextureSamplerBinding=!0;const U=S.createRenderTargetTexture(g.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:g.samplingMode,type:g.type,format:5});H.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{H.onApply=y=>{y._bindTexture("textureSampler",g),y.setFloat2("scale",1,1)},y.va().postProcessManager.directRender([H],U,!0),S.restoreDefaultFramebuffer(),S._releaseTexture(g),H&&H.dispose(),U._swapAndDie(g),g.isReady=!0}))}))};H&&(i?U():y.onLoadObservable.addOnce(U))}static EncodeTextureToRGBD(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,S.d)("rgbdEncode",y,g,f,1,5)}}},11036:(y,g,f)=>{"use strict";f.d(g,{e:()=>S,i:()=>p});class p{constructor(y){this.length=0,this.data=new Array(y),this._id=p._GlobalId++}push(y){this.data[this.length++]=y,this.length>this.data.length&&(this.data.length*=2)}forEach(y){for(let g=0;g<this.length;g++)y(this.data[g])}sort(y){this.data.sort(y)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(y){if(0!==y.length){this.length+y.length>this.data.length&&(this.data.length=2*(this.length+y.length));for(let g=0;g<y.length;g++)this.data[this.length++]=(y.data||y)[g]}}indexOf(y){const g=this.data.indexOf(y);return g>=this.length?-1:g}contains(y){return-1!==this.indexOf(y)}}p._GlobalId=0;class S extends p{constructor(){super(...arguments),this._duplicateId=0}push(y){super.push(y),y.__smartArrayFlags||(y.__smartArrayFlags={}),y.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(y){return(!y.__smartArrayFlags||y.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(y),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(y){if(0!==y.length){this.length+y.length>this.data.length&&(this.data.length=2*(this.length+y.length));for(let g=0;g<y.length;g++){const f=(y.data||y)[g];this.pushNoDuplicate(f)}}}}},10783:(y,g,f)=>{"use strict";f.d(g,{c:()=>i,g:()=>k,j:()=>p,k:()=>S});const p=y=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(y);let g="";for(let f=0;f<y.byteLength;f++)g+=String.fromCharCode(y[f]);return g},S=y=>{const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let f,p,S,k,i,H,U,l="",c=0;const Z=ArrayBuffer.isView(y)?new Uint8Array(y.buffer,y.byteOffset,y.byteLength):new Uint8Array(y);for(;c<Z.length;)f=Z[c++],p=c<Z.length?Z[c++]:Number.NaN,S=c<Z.length?Z[c++]:Number.NaN,k=f>>2,i=(3&f)<<4|p>>4,H=(15&p)<<2|S>>6,U=63&S,isNaN(p)?H=U=64:isNaN(S)&&(U=64),l+=g.charAt(k)+g.charAt(i)+g.charAt(H)+g.charAt(U);return l},k=y=>atob(y),i=y=>{const g=k(y),f=g.length,p=new Uint8Array(new ArrayBuffer(f));for(let S=0;S<f;S++)p[S]=g.charCodeAt(S);return p.buffer}},11046:(y,g,f)=>{"use strict";f.d(g,{e:()=>S});class p{static Eval(y,g){return"true"===(y=y.match(/\([^()]*\)/g)?y.replace(/\([^()]*\)/g,(y=>(y=y.slice(1,y.length-1),p._HandleParenthesisContent(y,g)))):p._HandleParenthesisContent(y,g))||"false"!==y&&p.Eval(y,g)}static _HandleParenthesisContent(y,g){let f;g=g||(y=>"true"===y);const S=y.split("||");for(const k in S)if(Object.prototype.hasOwnProperty.call(S,k)){let y=p._SimplifyNegation(S[k].trim());const i=y.split("&&");if(i.length>1)for(let S=0;S<i.length;++S){const k=p._SimplifyNegation(i[S].trim());if(f="true"!==k&&"false"!==k?"!"===k[0]?!g(k.substring(1)):g(k):"true"===k,!f){y="false";break}}if(f||"true"===y){f=!0;break}f="true"!==y&&"false"!==y?"!"===y[0]?!g(y.substring(1)):g(y):"true"===y}return f?"true":"false"}static _SimplifyNegation(y){return"!true"===(y=(y=y.replace(/^[\s!]+/,(y=>(y=y.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?y="false":"!false"===y&&(y="true"),y}}class S{static EnableFor(y){y._tags=y._tags||{},y.hasTags=()=>S.HasTags(y),y.addTags=g=>S.AddTagsTo(y,g),y.removeTags=g=>S.RemoveTagsFrom(y,g),y.matchesTagsQuery=g=>S.MatchesQuery(y,g)}static DisableFor(y){delete y._tags,delete y.hasTags,delete y.addTags,delete y.removeTags,delete y.matchesTagsQuery}static HasTags(y){if(!y._tags)return!1;const g=y._tags;for(const f in g)if(Object.prototype.hasOwnProperty.call(g,f))return!0;return!1}static GetTags(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!y._tags)return null;if(g){const g=[];for(const f in y._tags)Object.prototype.hasOwnProperty.call(y._tags,f)&&!0===y._tags[f]&&g.push(f);return g.join(" ")}return y._tags}static AddTagsTo(y,g){if(!g)return;if("string"!==typeof g)return;g.split(" ").forEach((function(g){S._AddTagTo(y,g)}))}static _AddTagTo(y,g){""!==(g=g.trim())&&"true"!==g&&"false"!==g&&(g.match(/[\s]/)||g.match(/^([!]|([|]|[&]){2})/)||(S.EnableFor(y),y._tags[g]=!0))}static RemoveTagsFrom(y,g){if(!S.HasTags(y))return;const f=g.split(" ");for(const p in f)S._RemoveTagFrom(y,f[p])}static _RemoveTagFrom(y,g){delete y._tags[g]}static MatchesQuery(y,g){return void 0===g||(""===g?S.HasTags(y):p.Eval(g,(g=>S.HasTags(y)&&y._tags[g])))}}},11581:(y,g,f)=>{"use strict";f.d(g,{d:()=>U,e:()=>C,h:()=>Z});f(11267),f(11585);var p=f(11590),S=f(10797),k=f(10871),i=f(11099);class H extends p.c{getClassName(){return"PassPostProcess"}constructor(y,g){super(y,"pass",null,null,g,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(y,g){y?(this._webGPUReady=!0,g.push(Promise.all([f.e(33).then(f.bind(f,13523))]))):g.push(Promise.all([f.e(34).then(f.bind(f,13530))])),super._gatherImports(y,g)}static _Parse(y,g,f,p){return i.c.Parse((()=>new H(y.name,y.options,g,y.renderTargetSamplingMode,y._engine,y.reusable)),y,f,p)}}(0,k.c)("BABYLON.PassPostProcess",H);p.c;function U(y,g,f,S,k,i,H,U){const l=g.getEngine();return g.isReady=!1,k=k??g.samplingMode,S=S??g.type,i=i??g.format,H=H??g.width,U=U??g.height,-1===S&&(S=0),new Promise((c=>{const Z=new p.c("postprocess",y,null,null,1,null,k,l,!1,void 0,S,void 0,null,!1,i);Z.externalTextureSamplerBinding=!0;const C=l.createRenderTargetTexture({width:H,height:U},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:k,type:S,format:i});Z.onEffectCreatedObservable.addOnce((y=>{y.executeWhenCompiled((()=>{Z.onApply=y=>{y._bindTexture("textureSampler",g),y.setFloat2("scale",1,1)},f.postProcessManager.directRender([Z],C,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(g),Z&&Z.dispose(),C._swapAndDie(g),g.type=S,g.format=5,g.isReady=!0,c(g)}))}))}))}let l,c;function Z(y){l||(l=new Float32Array(1),c=new Int32Array(l.buffer)),l[0]=y;const g=c[0];let f=g>>16&32768,p=g>>12&2047;const S=g>>23&255;return S<103?f:S>142?(f|=31744,f|=(255==S?0:1)&&8388607&g,f):S<113?(p|=2048,f|=(p>>114-S)+(p>>113-S&1),f):(f|=S-112<<10|p>>1,f+=1&p,f)}function C(y){const g=(32768&y)>>15,f=(31744&y)>>10,p=1023&y;return 0===f?(g?-1:1)*Math.pow(2,-14)*(p/Math.pow(2,10)):31==f?p?NaN:1/0*(g?-1:1):(g?-1:1)*Math.pow(2,f-15)*(1+p/Math.pow(2,10))}S.b._RescalePostProcessFactory=y=>new H("rescale",1,null,2,y,!1,0)},10794:(y,g,f)=>{"use strict";f.d(g,{c:()=>S});var p=f(10730);class S{static SetImmediate(y){(0,p.i)()&&window.setImmediate?window.setImmediate(y):setTimeout(y,1)}}},10882:(y,g,f)=>{"use strict";function p(y){let g=1;do{g*=2}while(g<y);return g===y}function S(y,g,f){return y*(1-f)+g*f}function k(y){const g=i(y),f=H(y);return g-y>y-f?f:g}function i(y){return y--,y|=y>>1,y|=y>>2,y|=y>>4,y|=y>>8,y|=y>>16,++y}function H(y){return y|=y>>1,y|=y>>2,y|=y>>4,y|=y>>8,(y|=y>>16)-(y>>1)}function U(y,g){let f;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:f=H(y);break;case 2:f=k(y);break;default:f=i(y)}return Math.min(f,g)}f.d(g,{e:()=>H,i:()=>U,k:()=>p,o:()=>S,r:()=>k})},10714:(y,g,f)=>{"use strict";f.d(g,{d:()=>B,e:()=>P});var p=f(10723),S=f(10730),k=f(10736),i=f(10740),H=f(10747),U=f(10755),l=f(10757),c=f(10761),Z=f(10766),C=f(10794),q=f(10869),W=f(10878),j=f(10882);class P{static get BaseUrl(){return Z.g.BaseUrl}static set BaseUrl(y){Z.g.BaseUrl=y}static get CleanUrl(){return Z.g.CleanUrl}static set CleanUrl(y){Z.g.CleanUrl=y}static IsAbsoluteUrl(y){return 0===y.indexOf("//")||-1!==y.indexOf("://")&&(-1!==y.indexOf(".")&&(-1!==y.indexOf("/")&&(!(y.indexOf(":")>y.indexOf("/"))&&(y.indexOf("://")<y.indexOf(".")||(0===y.indexOf("data:")||0===y.indexOf("blob:"))))))}static set ScriptBaseUrl(y){Z.g.ScriptBaseUrl=y}static get ScriptBaseUrl(){return Z.g.ScriptBaseUrl}static set ScriptPreprocessUrl(y){Z.g.ScriptPreprocessUrl=y}static get ScriptPreprocessUrl(){return Z.g.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return Z.g.DefaultRetryStrategy}static set DefaultRetryStrategy(y){Z.g.DefaultRetryStrategy=y}static get CorsBehavior(){return Z.g.CorsBehavior}static set CorsBehavior(y){Z.g.CorsBehavior=y}static get UseFallbackTexture(){return c.d.UseFallbackTexture}static set UseFallbackTexture(y){c.d.UseFallbackTexture=y}static get RegisteredExternalClasses(){return q.e.RegisteredExternalClasses}static set RegisteredExternalClasses(y){q.e.RegisteredExternalClasses=y}static get fallbackTexture(){return c.d.FallbackTexture}static set fallbackTexture(y){c.d.FallbackTexture=y}static FetchToRef(y,g,f,p,S,k){const i=4*((Math.abs(y)*f%f|0)+(Math.abs(g)*p%p|0)*f);k.r=S[i]/255,k.g=S[i+1]/255,k.b=S[i+2]/255,k.a=S[i+3]/255}static Mix(y,g,f){return 0}static Instantiate(y){return q.e.Instantiate(y)}static SetImmediate(y){C.c.SetImmediate(y)}static IsExponentOfTwo(y){return!0}static FloatRound(y){return Math.fround(y)}static GetFilename(y){const g=y.lastIndexOf("/");return g<0?y:y.substring(g+1)}static GetFolderPath(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const f=y.lastIndexOf("/");return f<0?g?y:"":y.substring(0,f+1)}static ToDegrees(y){return 180*y/Math.PI}static ToRadians(y){return y*Math.PI/180}static SmoothAngleChange(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const p=this.ToRadians(y),S=this.ToRadians(g);return this.ToDegrees(Math.atan2((1-f)*Math.sin(S)+f*Math.sin(p),(1-f)*Math.cos(S)+f*Math.cos(p)))}static MakeArray(y,g){return!0===g||void 0!==y&&null!=y?Array.isArray(y)?y:[y]:null}static GetPointerPrefix(y){return(0,S.i)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(y,g){(0,Z.y)(y,g)}static SetReferrerPolicyBehavior(y,g){g.referrerPolicy=y}static get PreprocessUrl(){return Z.g.PreprocessUrl}static set PreprocessUrl(y){Z.g.PreprocessUrl=y}static LoadImage(y,g,f,p,S,k){return(0,Z.s)(y,g,f,p,S,k)}static LoadFile(y,g,f,p,S,k){return(0,Z.r)(y,g,f,p,S,k)}static LoadFileAsync(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((f,p)=>{(0,Z.r)(y,(y=>{f(y)}),void 0,void 0,g,((y,g)=>{p(g)}))}))}static GetBabylonScriptURL(y,g){if(!y)return"";if(P.ScriptBaseUrl&&y.startsWith(P._DefaultCdnUrl)){const g="/"===P.ScriptBaseUrl[P.ScriptBaseUrl.length-1]?P.ScriptBaseUrl.substring(0,P.ScriptBaseUrl.length-1):P.ScriptBaseUrl;y=y.replace(P._DefaultCdnUrl,g)}return y=P.ScriptPreprocessUrl(y),g&&(y=P.GetAbsoluteUrl(y)),y}static LoadBabylonScript(y,g,f,p){y=P.GetBabylonScriptURL(y),P.LoadScript(y,g,f)}static LoadBabylonScriptAsync(y){return y=P.GetBabylonScriptURL(y),P.LoadScriptAsync(y)}static LoadScript(y,g,f,p){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(y),g&&g()}catch(U){null===f||void 0===f||f(`Unable to load script '${y}' in worker`,U)}return}if(!(0,S.i)())return void(null===f||void 0===f||f(`Cannot load script '${y}' outside of a window or a worker`));const i=document.getElementsByTagName("head")[0],H=document.createElement("script");k?(H.setAttribute("type","module"),H.innerText=y):(H.setAttribute("type","text/javascript"),H.setAttribute("src",y)),p&&(H.id=p),H.onload=()=>{g&&g()},H.onerror=g=>{f&&f(`Unable to load script '${y}'`,g)},i.appendChild(H)}static LoadScriptAsync(y,g){return new Promise(((f,p)=>{this.LoadScript(y,(()=>{f()}),((y,g)=>{p(g||new Error(y))}),g)}))}static ReadFileAsDataURL(y,g,f){const S=new FileReader,k={onCompleteObservable:new p.d,abort:()=>S.abort()};return S.onloadend=()=>{k.onCompleteObservable.notifyObservers(k)},S.onload=y=>{g(y.target.result)},S.onprogress=f,S.readAsDataURL(y),k}static ReadFile(y,g,f,p,S){return(0,Z.t)(y,g,f,p,S)}static FileAsURL(y){const g=new Blob([y]);return window.URL.createObjectURL(g)}static Format(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return y.toFixed(g)}static DeepCopy(y,g,f,p){i.b.DeepCopy(y,g,f,p)}static IsEmpty(y){for(const g in y)if(Object.prototype.hasOwnProperty.call(y,g))return!1;return!0}static RegisterTopRootEvents(y,g){for(let p=0;p<g.length;p++){const S=g[p];y.addEventListener(S.name,S.handler,!1);try{window.parent&&window.parent.addEventListener(S.name,S.handler,!1)}catch(f){}}}static UnregisterTopRootEvents(y,g){for(let p=0;p<g.length;p++){const S=g[p];y.removeEventListener(S.name,S.handler);try{y.parent&&y.parent.removeEventListener(S.name,S.handler)}catch(f){}}}static async DumpFramebuffer(y,g,f,p){throw(0,U.b)("DumpTools")}static DumpData(y,g,f,p){throw(0,U.b)("DumpTools")}static DumpDataAsync(y,g,f){throw(0,U.b)("DumpTools")}static _IsOffScreenCanvas(y){return void 0!==y.convertToBlob}static ToBlob(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",p=arguments.length>3?arguments[3]:void 0;P._IsOffScreenCanvas(y)||y.toBlob||(y.toBlob=function(y,g,f){setTimeout((()=>{const p=atob(this.toDataURL(g,f).split(",")[1]),S=p.length,k=new Uint8Array(S);for(let y=0;y<S;y++)k[y]=p.charCodeAt(y);y(new Blob([k]))}))}),P._IsOffScreenCanvas(y)?y.convertToBlob({type:f,quality:p}).then((y=>g(y))):y.toBlob((function(y){g(y)}),f,p)}static DownloadBlob(y,g){if("download"in document.createElement("a")){if(!g){const y=new Date;g="screenshot_"+((y.getFullYear()+"-"+(y.getMonth()+1)).slice(2)+"-"+y.getDate()+"_"+y.getHours()+"-"+("0"+y.getMinutes()).slice(-2))+".png"}P.Download(y,g)}else if(y&&"undefined"!==typeof URL){const g=URL.createObjectURL(y),f=window.open("");if(!f)return;const p=f.document.createElement("img");p.onload=function(){URL.revokeObjectURL(g)},p.src=g,f.document.body.appendChild(p)}}static EncodeScreenshotCanvasData(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;if("string"!==typeof p&&g){if(g){if(P._IsOffScreenCanvas(y))return void y.convertToBlob({type:f,quality:S}).then((y=>{const f=new FileReader;f.readAsDataURL(y),f.onloadend=()=>{const y=f.result;g(y)}}));const p=y.toDataURL(f,S);g(p)}}else this.ToBlob(y,(function(y){y&&P.DownloadBlob(y,p),g&&g("")}),f,S)}static Download(y,g){if("undefined"===typeof URL)return;const f=window.URL.createObjectURL(y),p=document.createElement("a");document.body.appendChild(p),p.style.display="none",p.href=f,p.download=g,p.addEventListener("click",(()=>{p.parentElement&&p.parentElement.removeChild(p)})),p.click(),window.URL.revokeObjectURL(f)}static BackCompatCameraNoPreventDefault(y){return"boolean"===typeof y[0]?y[0]:"boolean"===typeof y[1]&&y[1]}static CreateScreenshot(y,g,f,p){throw(0,U.b)("ScreenshotTools")}static CreateScreenshotAsync(y,g,f){throw(0,U.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(y,g,f,p){throw(0,U.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(y,g,f){throw(0,U.b)("ScreenshotTools")}static RandomId(){return(0,W.e)()}static IsBase64(y){return(0,Z.j)(y)}static DecodeBase64(y){return(0,Z.e)(y)}static get errorsCount(){return k.d.errorsCount}static Log(y){k.d.Log(y)}static Warn(y){k.d.Warn(y)}static Error(y){k.d.Error(y)}static get LogCache(){return k.d.LogCache}static ClearLogCache(){k.d.ClearLogCache()}static set LogLevels(y){k.d.LogLevels=y}static set PerformanceLogLevel(y){return(y&P.PerformanceUserMarkLogLevel)===P.PerformanceUserMarkLogLevel?(P.StartPerformanceCounter=P._StartUserMark,void(P.EndPerformanceCounter=P._EndUserMark)):(y&P.PerformanceConsoleLogLevel)===P.PerformanceConsoleLogLevel?(P.StartPerformanceCounter=P._StartPerformanceConsole,void(P.EndPerformanceCounter=P._EndPerformanceConsole)):(P.StartPerformanceCounter=P._StartPerformanceCounterDisabled,void(P.EndPerformanceCounter=P._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(y,g){}static _EndPerformanceCounterDisabled(y,g){}static _StartUserMark(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!P._Performance){if(!(0,S.i)())return;P._Performance=window.performance}g&&P._Performance.mark&&P._Performance.mark(y+"-Begin")}static _EndUserMark(y){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&P._Performance.mark&&(P._Performance.mark(y+"-End"),P._Performance.measure(y,y+"-Begin",y+"-End"))}static _StartPerformanceConsole(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];g&&(P._StartUserMark(y,g),console.time&&console.time(y))}static _EndPerformanceConsole(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];g&&(P._EndUserMark(y,g),console.timeEnd(y))}static get Now(){return H.c.Now}static GetClassName(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=null;if(!g&&y.getClassName)f=y.getClassName();else{if(y instanceof Object){f=(g?y:Object.getPrototypeOf(y)).constructor.__bjsclassName__}f||(f=typeof y)}return f}static First(y,g){for(const f of y)if(g(f))return f;return null}static getFullClassName(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=null,p=null;if(!g&&y.getClassName)f=y.getClassName();else{if(y instanceof Object){const S=g?y:Object.getPrototypeOf(y);f=S.constructor.__bjsclassName__,p=S.constructor.__bjsmoduleName__}f||(f=typeof y)}return f?(null!=p?p+".":"")+f:null}static DelayAsync(y){return new Promise((g=>{setTimeout((()=>{g()}),y)}))}static IsSafari(){return!!(0,S.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}P.UseCustomRequestHeaders=!1,P.CustomRequestHeaders=l.d.CustomRequestHeaders,P.GetDOMTextContent=S.c,P._DefaultCdnUrl="https://cdn.babylonjs.com",P.GetAbsoluteUrl="object"===typeof document?y=>{const g=document.createElement("a");return g.href=y,g.href}:"function"===typeof URL&&"object"===typeof location?y=>new URL(y,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},P.NoneLogLevel=k.d.NoneLogLevel,P.MessageLogLevel=k.d.MessageLogLevel,P.WarningLogLevel=k.d.WarningLogLevel,P.ErrorLogLevel=k.d.ErrorLogLevel,P.AllLogLevel=k.d.AllLogLevel,P.IsWindowObjectExist=S.i,P.PerformanceNoneLogLevel=0,P.PerformanceUserMarkLogLevel=1,P.PerformanceConsoleLogLevel=2,P.StartPerformanceCounter=P._StartPerformanceCounterDisabled,P.EndPerformanceCounter=P._EndPerformanceCounterDisabled;class B{constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=y,this.index=p-1,this._done=!1,this._fn=g,this._successCallback=f}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(y,g,f){const p=new B(y,g,f,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return p.executeNext(),p}static SyncAsyncForLoop(y,g,f,p,S){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return B.Run(Math.ceil(y/g),(p=>{S&&S()?p.breakLoop():setTimeout((()=>{for(let k=0;k<g;++k){const i=p.index*g+k;if(i>=y)break;if(f(i),S&&S()){p.breakLoop();break}}p.executeNext()}),k)}),p)}}P.Mix=j.o,P.IsExponentOfTwo=j.k,c.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10871:(y,g,f)=>{"use strict";f.d(g,{b:()=>k,c:()=>S});const p={};function S(y,g){p[y]=g}function k(y){return p[y]}},11189:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{static get UniqueId(){const y=this._UniqueIdCounter;return this._UniqueIdCounter++,y}}p._UniqueIdCounter=1},10757:(y,g,f)=>{"use strict";f.d(g,{d:()=>p});class p{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(p.CustomRequestHeaders).length>0||p.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const y in p.CustomRequestHeaders){const g=p.CustomRequestHeaders[y];g&&this._xhr.setRequestHeader(y,g)}}_shouldSkipRequestModifications(y){return p.SkipRequestModificationForBabylonCDN&&(y.includes("preview.babylonjs.com")||y.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(y){this._xhr.onprogress=y}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(y){this._xhr.responseType=y}get timeout(){return this._xhr.timeout}set timeout(y){this._xhr.timeout=y}addEventListener(y,g,f){this._xhr.addEventListener(y,g,f)}removeEventListener(y,g,f){this._xhr.removeEventListener(y,g,f)}abort(){this._xhr.abort()}send(y){p.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(y)}open(y,g){for(const f of p.CustomRequestModifiers){if(this._shouldSkipRequestModifications(g))return;f(this._xhr,g)}g=(g=g.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=g,this._xhr.open(y,g,!0)}setRequestHeader(y,g){this._xhr.setRequestHeader(y,g)}getResponseHeader(y){return this._xhr.getResponseHeader(y)}}p.CustomRequestHeaders={},p.CustomRequestModifiers=new Array,p.SkipRequestModificationForBabylonCDN=!0},12325:(y,g,f)=>{"use strict";f.d(g,{c:()=>S});class p{constructor(y){this._pendingActions=new Array,this._workerInfos=y.map((y=>({workerPromise:Promise.resolve(y),idle:!0})))}dispose(){for(const y of this._workerInfos)y.workerPromise.then((y=>{y.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(y){this._executeOnIdleWorker(y)||this._pendingActions.push(y)}_executeOnIdleWorker(y){for(const g of this._workerInfos)if(g.idle)return this._execute(g,y),!0;return!1}_execute(y,g){y.idle=!1,y.workerPromise.then((f=>{g(f,(()=>{const g=this._pendingActions.shift();g?this._execute(y,g):y.idle=!0}))}))}}class S extends p{constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.DefaultOptions;super([]),this._maxWorkers=y,this._createWorkerAsync=g,this._options=f}push(y){if(!this._executeOnIdleWorker(y))if(this._workerInfos.length<this._maxWorkers){const g={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(g),this._execute(g,y)}else this._pendingActions.push(y)}_execute(y,g){y.timeoutId&&(clearTimeout(y.timeoutId),delete y.timeoutId),super._execute(y,((f,p)=>{g(f,(()=>{p(),y.idle&&(y.timeoutId=setTimeout((()=>{y.workerPromise.then((y=>{y.terminate()}));const g=this._workerInfos.indexOf(y);-1!==g&&this._workerInfos.splice(g,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}S.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11496:(y,g,f)=>{"use strict";f.d(g,{b:()=>By});var p=f(11054),S=f(11253);class k extends S.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var i=f(11090),H=(f(11500),f(10871));class U{get noiseTexture(){return this._noiseTexture}set noiseTexture(y){this._noiseTexture!==y&&(this._noiseTexture=y,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(y){this._isAnimationSheetEnabled!=y&&(this._isAnimationSheetEnabled=y,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(y){this._useLogarithmicDepth=y&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:p.m.Zero()}set direction1(y){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=y)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:p.m.Zero()}set direction2(y){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=y)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:p.m.Zero()}set minEmitBox(y){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=y)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:p.m.Zero()}set maxEmitBox(y){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=y)}get billboardMode(){return this._billboardMode}set billboardMode(y){this._billboardMode!==y&&(this._billboardMode=y,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(y){this._isBillboardBased!==y&&(this._isBillboardBased=y,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(y){this._attachImageProcessingConfiguration(y)}_attachImageProcessingConfiguration(y){y!==this._imageProcessingConfiguration&&(!y&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=y)}_reset(){}_removeGradientAndTexture(y,g,f){if(!g)return this;let p=0;for(const S of g){if(S.gradient===y){g.splice(p,1);break}p++}return f&&f.dispose(),this}constructor(y){this.animations=[],this.renderingGroupId=0,this.j=p.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new p.m(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new p.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.fg=new p.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=p.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new i.f(1,1,1,1),this.color2=new i.f(1,1,1,1),this.colorDead=new i.f(0,0,0,1),this.textureMask=new i.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new k,this.id=y,this.name=y}createPointEmitter(y,g){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new p.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new p.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new p.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new p.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new p.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new p.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(y,g,f,p){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,(0,H.c)("BABYLON.BaseParticleSystem",U);var l=f(11079),c=f(10740);class Z{constructor(){this.direction1=new p.m(0,1,0),this.direction2=new p.m(0,1,0),this.minEmitBox=new p.m(-.5,-.5,-.5),this.maxEmitBox=new p.m(.5,.5,.5)}startDirectionFunction(y,g,f,S){const k=(0,l.q)(this.direction1.x,this.direction2.x),i=(0,l.q)(this.direction1.y,this.direction2.y),H=(0,l.q)(this.direction1.z,this.direction2.z);if(S)return g.x=k,g.y=i,void(g.z=H);p.m.TransformNormalFromFloatsToRef(k,i,H,y,g)}startPositionFunction(y,g,f,S){const k=(0,l.q)(this.minEmitBox.x,this.maxEmitBox.x),i=(0,l.q)(this.minEmitBox.y,this.maxEmitBox.y),H=(0,l.q)(this.minEmitBox.z,this.maxEmitBox.z);if(S)return g.x=k,g.y=i,void(g.z=H);p.m.TransformCoordinatesFromFloatsToRef(k,i,H,y,g)}clone(){const y=new Z;return c.b.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2),y.setVector3("minEmitBox",this.minEmitBox),y.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3),y.addUniform("minEmitBox",3),y.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.direction1=this.direction1.mj(),y.direction2=this.direction2.mj(),y.minEmitBox=this.minEmitBox.mj(),y.maxEmitBox=this.maxEmitBox.mj(),y}parse(y){p.m.FromArrayToRef(y.direction1,0,this.direction1),p.m.FromArrayToRef(y.direction2,0,this.direction2),p.m.FromArrayToRef(y.minEmitBox,0,this.minEmitBox),p.m.FromArrayToRef(y.maxEmitBox,0,this.maxEmitBox)}}class C{get radius(){return this._radius}set radius(y){this._radius=y,this._buildHeight()}get angle(){return this._angle}set angle(y){this._angle=y,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=f,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=g,this.radius=y}startDirectionFunction(y,g,f,S){S?p.j.o[0].p(f.le).normalize():f.position.subtractToRef(y.getTranslation(),p.j.o[0]).normalize();const k=(0,l.q)(0,this.directionRandomizer),i=(0,l.q)(0,this.directionRandomizer),H=(0,l.q)(0,this.directionRandomizer);g.x=p.j.o[0].x+k,g.y=p.j.o[0].y+i,g.z=p.j.o[0].z+H,g.normalize()}startPositionFunction(y,g,f,S){const k=(0,l.q)(0,2*Math.PI);let i;this.emitFromSpawnPointOnly?i=1e-4:(i=(0,l.q)(0,this.heightRange),i=1-i*i);let H=this._radius-(0,l.q)(0,this._radius*this.radiusRange);H*=i;const U=H*Math.sin(k),c=H*Math.cos(k),Z=i*this._height;if(S)return g.x=U,g.y=Z,void(g.z=c);p.m.TransformCoordinatesFromFloatsToRef(U,Z,c,y,g)}clone(){const y=new C(this._radius,this._angle,this.directionRandomizer);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat2("radius",this._radius,this.radiusRange),y.setFloat("coneAngle",this._angle),y.setFloat2("height",this._height,this.heightRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",2),y.addUniform("coneAngle",1),y.addUniform("height",2),y.addUniform("directionRandomizer",1)}getEffectDefines(){let y="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(y+="\n#define CONEEMITTERSPAWNPOINT"),y}getClassName(){return"ConeParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this._radius,y.angle=this._angle,y.directionRandomizer=this.directionRandomizer,y.radiusRange=this.radiusRange,y.heightRange=this.heightRange,y.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,y}parse(y){this.radius=y.radius,this.angle=y.angle,this.directionRandomizer=y.directionRandomizer,this.radiusRange=void 0!==y.radiusRange?y.radiusRange:1,this.heightRange=void 0!==y.radiusRange?y.heightRange:1,this.emitFromSpawnPointOnly=void 0!==y.emitFromSpawnPointOnly&&y.emitFromSpawnPointOnly}}class q extends C{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0);super(y,g),this.direction1=f,this.direction2=S}startDirectionFunction(y,g){const f=(0,l.q)(this.direction1.x,this.direction2.x),S=(0,l.q)(this.direction1.y,this.direction2.y),k=(0,l.q)(this.direction1.z,this.direction2.z);p.m.TransformNormalFromFloatsToRef(f,S,k,y,g)}clone(){const y=new q(this.radius,this.angle,this.direction1,this.direction2);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.mj(),y.direction2=this.direction2.mj(),y}parse(y){super.parse(y),this.direction1.p(y.direction1),this.direction2.p(y.direction2)}}class W{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=y,this.height=g,this.radiusRange=f,this.directionRandomizer=S,this._tempVector=p.m.Zero()}startDirectionFunction(y,g,f,S,k){f.position.subtractToRef(y.getTranslation(),this._tempVector),this._tempVector.normalize(),p.m.TransformNormalToRef(this._tempVector,k,this._tempVector);const i=(0,l.q)(-this.directionRandomizer/2,this.directionRandomizer/2);let H=Math.atan2(this._tempVector.x,this._tempVector.z);H+=(0,l.q)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=i,this._tempVector.x=Math.sin(H),this._tempVector.z=Math.cos(H),this._tempVector.normalize(),S?g.p(this._tempVector):p.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,y,g)}startPositionFunction(y,g,f,S){const k=(0,l.q)(-this.height/2,this.height/2),i=(0,l.q)(0,2*Math.PI),H=(0,l.q)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(H)*this.radius,c=U*Math.cos(i),Z=U*Math.sin(i);S?g.ne(c,k,Z):p.m.TransformCoordinatesFromFloatsToRef(c,k,Z,y,g)}clone(){const y=new W(this.radius,this.directionRandomizer);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("height",this.height),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("height",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.height=this.height,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.height=y.height,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class j extends W{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0),k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new p.m(0,1,0);super(y,g,f),this.direction1=S,this.direction2=k}startDirectionFunction(y,g,f,S){const k=(0,l.q)(this.direction1.x,this.direction2.x),i=(0,l.q)(this.direction1.y,this.direction2.y),H=(0,l.q)(this.direction1.z,this.direction2.z);S?g.ne(k,i,H):p.m.TransformNormalFromFloatsToRef(k,i,H,y,g)}clone(){const y=new j(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("height",this.height),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("height",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.mj(),y.direction2=this.direction2.mj(),y}parse(y){super.parse(y),p.m.FromArrayToRef(y.direction1,0,this.direction1),p.m.FromArrayToRef(y.direction2,0,this.direction2)}}class P{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=y,this.radiusRange=g,this.directionRandomizer=f}startDirectionFunction(y,g,f,S){const k=f.position.ed(y.getTranslation()).normalize(),i=(0,l.q)(0,this.directionRandomizer),H=(0,l.q)(0,this.directionRandomizer),U=(0,l.q)(0,this.directionRandomizer);k.x+=i,k.y+=H,k.z+=U,k.normalize(),S?g.p(k):p.m.TransformNormalFromFloatsToRef(k.x,k.y,k.z,y,g)}startPositionFunction(y,g,f,S){const k=this.radius-(0,l.q)(0,this.radius*this.radiusRange),i=(0,l.q)(0,1),H=(0,l.q)(0,2*Math.PI),U=Math.acos(2*i-1),c=k*Math.cos(H)*Math.sin(U),Z=k*Math.cos(U),C=k*Math.sin(H)*Math.sin(U);S?g.ne(c,Math.abs(Z),C):p.m.TransformCoordinatesFromFloatsToRef(c,Math.abs(Z),C,y,g)}clone(){const y=new P(this.radius,this.directionRandomizer);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class B{constructor(){this.direction1=new p.m(0,1,0),this.direction2=new p.m(0,1,0)}startDirectionFunction(y,g,f,S){const k=(0,l.q)(this.direction1.x,this.direction2.x),i=(0,l.q)(this.direction1.y,this.direction2.y),H=(0,l.q)(this.direction1.z,this.direction2.z);S?g.ne(k,i,H):p.m.TransformNormalFromFloatsToRef(k,i,H,y,g)}startPositionFunction(y,g,f,S){S?g.ne(0,0,0):p.m.TransformCoordinatesFromFloatsToRef(0,0,0,y,g)}clone(){const y=new B;return c.b.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.direction1=this.direction1.mj(),y.direction2=this.direction2.mj(),y}parse(y){p.m.FromArrayToRef(y.direction1,0,this.direction1),p.m.FromArrayToRef(y.direction2,0,this.direction2)}}class R{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=y,this.radiusRange=g,this.directionRandomizer=f}startDirectionFunction(y,g,f,S){const k=f.position.ed(y.getTranslation()).normalize(),i=(0,l.q)(0,this.directionRandomizer),H=(0,l.q)(0,this.directionRandomizer),U=(0,l.q)(0,this.directionRandomizer);k.x+=i,k.y+=H,k.z+=U,k.normalize(),S?g.p(k):p.m.TransformNormalFromFloatsToRef(k.x,k.y,k.z,y,g)}startPositionFunction(y,g,f,S){const k=this.radius-(0,l.q)(0,this.radius*this.radiusRange),i=(0,l.q)(0,1),H=(0,l.q)(0,2*Math.PI),U=Math.acos(2*i-1),c=k*Math.cos(H)*Math.sin(U),Z=k*Math.cos(U),C=k*Math.sin(H)*Math.sin(U);S?g.ne(c,Z,C):p.m.TransformCoordinatesFromFloatsToRef(c,Z,C,y,g)}clone(){const y=new R(this.radius,this.directionRandomizer);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class G extends R{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.m(0,1,0),f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0);super(y),this.direction1=g,this.direction2=f}startDirectionFunction(y,g){const f=(0,l.q)(this.direction1.x,this.direction2.x),S=(0,l.q)(this.direction1.y,this.direction2.y),k=(0,l.q)(this.direction1.z,this.direction2.z);p.m.TransformNormalFromFloatsToRef(f,S,k,y,g)}clone(){const y=new G(this.radius,this.direction1,this.direction2);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.mj(),y.direction2=this.direction2.mj(),y}parse(y){super.parse(y),this.direction1.p(y.direction1),this.direction2.p(y.direction2)}}class z{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(y,g,f,S){const k=p.j.o[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,f,k);const y=p.j.o[1];k.subtractToRef(f.position,y),y.scaleToRef(1/f.lifeTime,k)}else k.set(0,0,0);S?g.p(k):p.m.TransformNormalToRef(k,y,g)}startPositionFunction(y,g,f,S){const k=p.j.o[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,f,k):k.set(0,0,0),S?g.p(k):p.m.TransformCoordinatesToRef(k,y,g)}clone(){const y=new z;return c.b.DeepCopy(this,y),y}applyToShader(y){}buildUniformLayout(y){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.particlePositionGenerator=this.particlePositionGenerator,y.particleDestinationGenerator=this.particleDestinationGenerator,y}parse(y){y.particlePositionGenerator&&(this.particlePositionGenerator=y.particlePositionGenerator),y.particleDestinationGenerator&&(this.particleDestinationGenerator=y.particleDestinationGenerator)}}var T=f(11131);class Q{get mesh(){return this._mesh}set mesh(y){this._mesh!==y&&(this._mesh=y,y?(this._indices=y.hg(),this._positions=y.getVerticesData(T.c.PositionKind),this._normals=y.getVerticesData(T.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=p.m.Zero(),this._mesh=null,this.direction1=new p.m(0,1,0),this.direction2=new p.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=y}startDirectionFunction(y,g,f,S){if(this.useMeshNormalsForDirection&&this._normals)return void p.m.TransformNormalToRef(this._storedNormal,y,g);const k=(0,l.q)(this.direction1.x,this.direction2.x),i=(0,l.q)(this.direction1.y,this.direction2.y),H=(0,l.q)(this.direction1.z,this.direction2.z);S?g.ne(k,i,H):p.m.TransformNormalFromFloatsToRef(k,i,H,y,g)}startPositionFunction(y,g,f,S){if(!this._indices||!this._positions)return;const k=3*Math.random()*(this._indices.length/3)|0,i=Math.random(),H=Math.random()*(1-i),U=1-i-H,l=this._indices[k],c=this._indices[k+1],Z=this._indices[k+2],C=p.j.o[0],q=p.j.o[1],W=p.j.o[2],j=p.j.o[3];p.m.FromArrayToRef(this._positions,3*l,C),p.m.FromArrayToRef(this._positions,3*c,q),p.m.FromArrayToRef(this._positions,3*Z,W),j.x=i*C.x+H*q.x+U*W.x,j.y=i*C.y+H*q.y+U*W.y,j.z=i*C.z+H*q.z+U*W.z,S?g.ne(j.x,j.y,j.z):p.m.TransformCoordinatesFromFloatsToRef(j.x,j.y,j.z,y,g),this.useMeshNormalsForDirection&&this._normals&&(p.m.FromArrayToRef(this._normals,3*l,C),p.m.FromArrayToRef(this._normals,3*c,q),p.m.FromArrayToRef(this._normals,3*Z,W),this._storedNormal.x=i*C.x+H*q.x+U*W.x,this._storedNormal.y=i*C.y+H*q.y+U*W.y,this._storedNormal.z=i*C.z+H*q.z+U*W.z)}clone(){const y=new Q(this.mesh);return c.b.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var y;const g={};return g.type=this.getClassName(),g.direction1=this.direction1.mj(),g.direction2=this.direction2.mj(),g.meshId=null===(y=this.mesh)||void 0===y?void 0:y.id,g.useMeshNormalsForDirection=this.useMeshNormalsForDirection,g}parse(y,g){p.m.FromArrayToRef(y.direction1,0,this.direction1),p.m.FromArrayToRef(y.direction2,0,this.direction2),y.meshId&&g&&(this.mesh=g.getLastMeshById(y.meshId)),this.useMeshNormalsForDirection=y.useMeshNormalsForDirection}}var m=f(10803);class a{_isUbo(y){return void 0!==y.addUniform}constructor(y){this._isUbo(y)?(this.setMatrix3x3=y.updateMatrix3x3.bind(y),this.setMatrix2x2=y.updateMatrix2x2.bind(y),this.setFloat=y.updateFloat.bind(y),this.setFloat2=y.updateFloat2.bind(y),this.setFloat3=y.updateFloat3.bind(y),this.setFloat4=y.updateFloat4.bind(y),this.setFloatArray=y.updateFloatArray.bind(y),this.setArray=y.updateArray.bind(y),this.setIntArray=y.updateIntArray.bind(y),this.setMatrix=y.Lj.bind(y),this.setMatrices=y.updateMatrices.bind(y),this.setVector3=y.updateVector3.bind(y),this.setVector4=y.updateVector4.bind(y),this.setColor3=y.updateColor3.bind(y),this.setColor4=y.updateColor4.bind(y),this.setDirectColor4=y.updateDirectColor4.bind(y),this.setInt=y.updateInt.bind(y),this.setInt2=y.updateInt2.bind(y),this.setInt3=y.updateInt3.bind(y),this.setInt4=y.updateInt4.bind(y)):(this.setMatrix3x3=y.setMatrix3x3.bind(y),this.setMatrix2x2=y.setMatrix2x2.bind(y),this.setFloat=y.setFloat.bind(y),this.setFloat2=y.setFloat2.bind(y),this.setFloat3=y.setFloat3.bind(y),this.setFloat4=y.setFloat4.bind(y),this.setFloatArray=y.setFloatArray.bind(y),this.setArray=y.setArray.bind(y),this.setIntArray=y.setIntArray.bind(y),this.setMatrix=y.setMatrix.bind(y),this.setMatrices=y.setMatrices.bind(y),this.setVector3=y.setVector3.bind(y),this.setVector4=y.setVector4.bind(y),this.setColor3=y.setColor3.bind(y),this.setColor4=y.setColor4.bind(y),this.setDirectColor4=y.setDirectColor4.bind(y),this.setInt=y.setInt.bind(y),this.setInt2=y.setInt2.bind(y),this.setInt3=y.setInt3.bind(y),this.setInt4=y.setInt4.bind(y))}}var w=f(10812);const o="gpuUpdateParticlesPixelShader",I="#version 300 es\nvoid main() {discard;}\n";w.e.ShadersStore[o]=I;const Y="gpuUpdateParticlesVertexShader",n="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";w.e.ShadersStore[Y]=n;(0,H.c)("BABYLON.WebGL2ParticleSystem",class{constructor(y,g){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=y,this._engine=g,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var y;return(null===(y=this._updateEffect)||void 0===y?void 0:y.isReady())??!1}createUpdateBuffer(y){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof z&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=y,this._updateEffect=new m.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new a(this._updateEffect)}createVertexBuffers(y,g){this._updateVAO.push(this._createUpdateVAO(y)),this._renderVAO.push(this._engine.recordVertexArrayObject(g,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=g}createParticleBuffer(y){return y}bindDrawBuffers(y,g,f){f?this._engine.bindBuffers(this._renderVertexBuffers,f,g):this._engine.bindVertexArrayObject(this._renderVAO[y],null)}preUpdateParticleBuffer(){const y=this._engine;if(this._engine.enableEffect(this._updateEffect),!y.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(y,g,f){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[y],null);const p=this._engine;p.bindTransformFeedbackBuffer(g.getBuffer()),p.setRasterizerState(!1),p.beginTransformFeedback(!0),p.drawArraysType(3,0,f),p.endTransformFeedback(),p.setRasterizerState(!0),p.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let y=0;y<this._updateVAO.length;y++)this._engine.releaseVertexArrayObject(this._updateVAO[y]);this._updateVAO.length=0;for(let y=0;y<this._renderVAO.length;y++)this._engine.releaseVertexArrayObject(this._renderVAO[y]);this._renderVAO.length=0}_createUpdateVAO(y){const g={};g.position=y.createVertexBuffer("position",0,3);let f=3;g.age=y.createVertexBuffer("age",f,1),f+=1,g.size=y.createVertexBuffer("size",f,3),f+=3,g.life=y.createVertexBuffer("life",f,1),f+=1,g.seed=y.createVertexBuffer("seed",f,4),f+=4,g.direction=y.createVertexBuffer("direction",f,3),f+=3,this._parent.particleEmitterType instanceof z&&(g.initialPosition=y.createVertexBuffer("initialPosition",f,3),f+=3),this._parent._colorGradientsTexture||(g.color=y.createVertexBuffer("color",f,4),f+=4),this._parent._isBillboardBased||(g.initialDirection=y.createVertexBuffer("initialDirection",f,3),f+=3),this._parent.noiseTexture&&(g.noiseCoordinates1=y.createVertexBuffer("noiseCoordinates1",f,3),f+=3,g.noiseCoordinates2=y.createVertexBuffer("noiseCoordinates2",f,3),f+=3),this._parent._angularSpeedGradientsTexture?(g.angle=y.createVertexBuffer("angle",f,1),f+=1):(g.angle=y.createVertexBuffer("angle",f,2),f+=2),this._parent._isAnimationSheetEnabled&&(g.cellIndex=y.createVertexBuffer("cellIndex",f,1),f+=1,this._parent.spriteRandomStartCell&&(g.cellStartOffset=y.createVertexBuffer("cellStartOffset",f,1),f+=1));const p=this._engine.recordVertexArrayObject(g,null,this._updateEffect);return this._engine.bindArrayBuffer(null),p}});class M{constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,p=arguments.length>3?arguments[3]:void 0;this._engine=y,this._label=p,this._engine._storageBuffers.push(this),this._create(g,f)}_create(y,g){this._bufferSize=y,this._creationFlags=g,this._buffer=this._engine.createStorageBuffer(y,g,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(y,g,f){this._buffer&&this._engine.updateStorageBuffer(this._buffer,y,g,f)}read(y,g,f,p){return this._engine.readFromStorageBuffer(this._buffer,y,g,f,p)}dispose(){const y=this._engine._storageBuffers,g=y.indexOf(this);-1!==g&&(y[g]=y[y.length-1],y.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var r=f(11021),N=f(11026),b=f(11099),s=f(11267),u=f(11189),F=f(10736),A=f(10851),J=f(10886);class V{constructor(){this._gpuTimeInFrameId=-1,this.counter=new J.d}_addDuration(y,g){y<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==y?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(g,!1),this._gpuTimeInFrameId=y):this.counter.addCount(g,!1))}}class e{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=y,this._engine=g,this.uniqueId=u.d.UniqueId,g.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new V),this._engine.getCaps().supportComputeShaders?p.bindingsMapping?(this._context=g.createComputeContext(),this._shaderPath=f,this._options={bindingsMapping:{},defines:[],...p}):F.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):F.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const p=this._bindings[y];this._bindings[y]={type:f?0:4,object:g,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!p||p.object!==g||p.type!==this._bindings[y].type)}setStorageTexture(y,g){const f=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==g),this._bindings[y]={type:1,object:g,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setExternalTexture(y,g){const f=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==g),this._bindings[y]={type:6,object:g,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setVideoTexture(y,g){return!!g.externalTexture&&(this.setExternalTexture(y,g.externalTexture),!0)}setUniformBuffer(y,g){const f=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==g),this._bindings[y]={type:e._BufferIsDataBuffer(g)?7:2,object:g,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setStorageBuffer(y,g){const f=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==g),this._bindings[y]={type:e._BufferIsDataBuffer(g)?7:3,object:g,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setTextureSampler(y,g){const f=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!f||!g.compareSampler(f.object)),this._bindings[y]={type:5,object:g,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}isReady(){let y=this._effect;for(const S in this._bindings){const y=this._bindings[S],g=y.type,f=y.object;switch(g){case 0:case 4:case 1:if(!f.isReady())return!1;break;case 6:if(!f.isReady())return!1;break}}const g=[],f=this._shaderPath;if(this._options.defines)for(let S=0;S<this._options.defines.length;S++)g.push(this._options.defines[S]);const p=g.join("\n");return this._cachedDefines!==p&&(this._cachedDefines=p,y=this._engine.createComputeEffect(f,{defines:p,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=y),!!y.isReady()}dispatch(y,g,f){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,y,g,f,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const f=e._BufferIsDataBuffer(y)?y:y.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,f,g,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const g in this._bindings){const f=this._bindings[g];if(!this._options.bindingsMapping[g])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+g+"'");switch(f.type){case 0:{const p=this._samplers[g],S=f.object;var y;if(!p||!S._texture||!p.compareSampler(S._texture))this._samplers[g]=(new A.b).setParameters(S.wrapU,S.wrapV,S.wrapR,S.anisotropicFilteringLevel,S._texture.samplingMode,null===(y=S._texture)||void 0===y?void 0:y._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const y=f.object;y.getBuffer()!==f.buffer&&(f.buffer=y.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((S=>{const k=()=>{this.dispatch(y,g,f)?S():setTimeout(k,p)};k()}))}serialize(){const y=b.c.Serialize(this);y.options=this._options,y.shaderPath=this._shaderPath,y.Bj={},y.textures={};for(const g in this._bindings){const f=this._bindings[g],p=f.object;switch(f.type){case 0:case 4:case 1:{const S=p.serialize();S&&(y.textures[g]=S,y.Bj[g]={type:f.type});break}}}return y}static Parse(y,g,f){const p=b.c.Parse((()=>new e(y.name,g.getEngine(),y.shaderPath,y.options)),y,g,f);for(const S in y.textures){const k=y.Bj[S],i=s.c.Parse(y.textures[S],g,f);0===k.type?p.setTexture(S,i):4===k.type?p.setTexture(S,i,!1):p.setStorageTexture(S,i)}return p}static _BufferIsDataBuffer(y){return void 0!==y.underlyingResource}}(0,r.c)([(0,N.I)()],e.prototype,"name",void 0),(0,r.c)([(0,N.I)()],e.prototype,"fastMode",void 0),(0,H.c)("BABYLON.ComputeShader",e);var h=f(11117);const D="gpuUpdateParticlesComputeShader",K="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";w.e.ShadersStoreWGSL[D]=K;(0,H.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(y,g){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=y,this._engine=g}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var y;return(null===(y=this._updateComputeShader)||void 0===y?void 0:y.isReady())??!1}createUpdateBuffer(y){var g;const f={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(f.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(f.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(f.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(f.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(f.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(f.noiseTexture={group:1,binding:11}),this._updateComputeShader=new e("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:f,defines:y.split("\n")}),null===(g=this._simParamsComputeShader)||void 0===g||g.dispose(),this._simParamsComputeShader=new h.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new a(this._simParamsComputeShader)}createVertexBuffers(y,g){this._renderVertexBuffers.push(g)}createParticleBuffer(y){const g=new M(this._engine,4*y.length,11,"ComputeShaderParticleSystemBuffer");return g.update(y),this._bufferComputeShader.push(g),g.getBuffer()}bindDrawBuffers(y,g,f){this._engine.bindBuffers(this._renderVertexBuffers[y],f,g)}preUpdateParticleBuffer(){}updateParticleBuffer(y,g,f){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[y]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^y]),this._updateComputeShader.dispatch(Math.ceil(f/64))}releaseBuffers(){var y;for(let g=0;g<this._bufferComputeShader.length;++g)this._bufferComputeShader[g].dispose();this._bufferComputeShader.length=0,null===(y=this._simParamsComputeShader)||void 0===y||y.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class X{constructor(y,g,f){this.gradient=y,this.color1=g,this.color2=f}getColorToRef(y){this.color2?i.f.LerpToRef(this.color1,this.color2,Math.random(),y):y.p(this.color1)}}class E{constructor(y,g){this.gradient=y,this.color=g}}class O{constructor(y,g,f){this.gradient=y,this.factor1=g,this.factor2=f}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class L{static GetCurrentGradient(y,g,f){if(g[0].gradient>y)return void f(g[0],g[0],1);for(let S=0;S<g.length-1;S++){const p=g[S],k=g[S+1];if(y>=p.gradient&&y<=k.gradient){return void f(p,k,(y-p.gradient)/(k.gradient-p.gradient))}}const p=g.length-1;f(g[p],g[p],1)}}var x=f(10723),d=f(11521),t=f(10761);class v{constructor(y){this.particleSystem=y,this.position=p.m.Zero(),this.direction=p.m.Zero(),this.color=new i.f(0,0,0,0),this.colorStep=new i.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new p.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new i.f(0,0,0,0),this._currentColor2=new i.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=v._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let y=this.age,g=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===g?(g=1,y=this._randomCellOffset):y+=this._randomCellOffset);const f=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let p;p=this._initialSpriteCellLoop?(0,l.d)(y*g%this.lifeTime/this.lifeTime):(0,l.d)(y*g/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+p*f|0}_inheritParticleInfoToSubEmitter(y){if(y.particleSystem.j.position){const g=y.particleSystem.j;if(g.position.p(this.position),y.inheritDirection){const y=p.j.o[0];this.direction.normalizeToRef(y),g.setDirection(y,0,Math.PI/2)}}else{y.particleSystem.j.p(this.position)}this.direction.scaleToRef(y.inheritedVelocityAmount/2,p.j.o[0]),y.particleSystem._inheritedVelocityOffset.p(p.j.o[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((y=>{this._inheritParticleInfoToSubEmitter(y)}))}_reset(){this.age=0,this.id=v._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(y){y.position.p(this.position),this._initialDirection?y._initialDirection?y._initialDirection.p(this._initialDirection):y._initialDirection=this._initialDirection.clone():y._initialDirection=null,y.direction.p(this.direction),this.le&&(y.le?y.le.p(this.le):y.le=this.le.clone()),y.color.p(this.color),y.colorStep.p(this.colorStep),y.lifeTime=this.lifeTime,y.age=this.age,y._randomCellOffset=this._randomCellOffset,y.size=this.size,y.scale.p(this.scale),y.angle=this.angle,y.angularSpeed=this.angularSpeed,y.particleSystem=this.particleSystem,y.cellIndex=this.cellIndex,y.id=this.id,y._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(y._currentColorGradient=this._currentColorGradient,y._currentColor1.p(this._currentColor1),y._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(y._currentSizeGradient=this._currentSizeGradient,y._currentSize1=this._currentSize1,y._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(y._currentAngularSpeedGradient=this._currentAngularSpeedGradient,y._currentAngularSpeed1=this._currentAngularSpeed1,y._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(y._currentVelocityGradient=this._currentVelocityGradient,y._currentVelocity1=this._currentVelocity1,y._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(y._currentLimitVelocityGradient=this._currentLimitVelocityGradient,y._currentLimitVelocity1=this._currentLimitVelocity1,y._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(y._currentDragGradient=this._currentDragGradient,y._currentDrag1=this._currentDrag1,y._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(y._initialStartSpriteCellID=this._initialStartSpriteCellID,y._initialEndSpriteCellID=this._initialEndSpriteCellID,y._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(y.remapData&&this.remapData?y.remapData.p(this.remapData):y.remapData=new p.o(0,0,0,0)),this._randomNoiseCoordinates1&&(y._randomNoiseCoordinates1?(y._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),y._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(y._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),y._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}v._Count=0;var yy=f(11240),gy=(f(11530),f(11249)),fy=f(11242),py=f(11113);class Sy extends U{set onDispose(y){this._onDisposeObserver&&this.nj.remove(this._onDisposeObserver),this._onDisposeObserver=this.nj.add(y)}get useRampGradients(){return this._useRampGradients}set useRampGradients(y){this._useRampGradients!==y&&(this._useRampGradients=y,this._resetEffect())}get particles(){return this.wj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.wj.length}getClassName(){return"rb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var y;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._customWrappers[g])||void 0===y?void 0:y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[y]??this._customWrappers[0]}setCustomEffect(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[g]=new yy.b(this._engine),this._customWrappers[g].effect=y,this._customWrappers[g].drawContext&&(this._customWrappers[g].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new x.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(y),this._emitterInverseWorldMatrix=p.c.Identity(),this._inheritedVelocityOffset=new p.m,this.nj=new x.d,this.onStoppedObservable=new x.d,this.wj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new i.f(0,0,0,0),this._colorDiff=new i.f(0,0,0,0),this._scaledDirection=p.m.Zero(),this._scaledGravity=p.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=y=>{},this.recycleParticle=y=>{const g=this.wj.pop();g!==y&&g.copyTo(y),this._stockParticles.push(g)},this._createParticle=()=>{let y;return 0!==this._stockParticles.length?(y=this._stockParticles.pop(),y._reset()):y=new v(this),this._prepareParticle(y),y},this._shadersLoaded=!1,this._capacity=g,this._epsilon=H,this._isAnimationSheetEnabled=k,f&&"Scene"!==f.getClassName()?(this._engine=f,this.defaultProjectionMatrix=p.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=f||t.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.uj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new yy.b(this._engine)},this._customWrappers[0].effect=S,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Z;let U=null;this.updateFunction=y=>{let g=null;var f;this.noiseTexture&&(g=this.noiseTexture.getSize(),null===(f=this.noiseTexture.getContent())||void 0===f||f.then((y=>{U=y})));const S=y===this.wj;for(let k=0;k<y.length;k++){const f=y[k];let H=this._scaledUpdateSpeed;const c=f.age;if(f.age+=H,f.age>f.lifeTime){const y=f.age-c;H=(f.lifeTime-c)*H/y,f.age=f.lifeTime}const Z=f.age/f.lifeTime;this._colorGradients&&this._colorGradients.length>0?L.GetCurrentGradient(Z,this._colorGradients,((y,g,p)=>{y!==f._currentColorGradient&&(f._currentColor1.p(f._currentColor2),g.getColorToRef(f._currentColor2),f._currentColorGradient=y),i.f.LerpToRef(f._currentColor1,f._currentColor2,p,f.color)})):(f.colorStep.scaleToRef(H,this._scaledColorStep),f.color.addInPlace(this._scaledColorStep),f.color.a<0&&(f.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&L.GetCurrentGradient(Z,this._angularSpeedGradients,((y,g,p)=>{y!==f._currentAngularSpeedGradient&&(f._currentAngularSpeed1=f._currentAngularSpeed2,f._currentAngularSpeed2=g.getFactor(),f._currentAngularSpeedGradient=y),f.angularSpeed=(0,l.n)(f._currentAngularSpeed1,f._currentAngularSpeed2,p)})),f.angle+=f.angularSpeed*H;let C=H;if(this._velocityGradients&&this._velocityGradients.length>0&&L.GetCurrentGradient(Z,this._velocityGradients,((y,g,p)=>{y!==f._currentVelocityGradient&&(f._currentVelocity1=f._currentVelocity2,f._currentVelocity2=g.getFactor(),f._currentVelocityGradient=y),C*=(0,l.n)(f._currentVelocity1,f._currentVelocity2,p)})),f.direction.scaleToRef(C,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&L.GetCurrentGradient(Z,this._limitVelocityGradients,((y,g,p)=>{y!==f._currentLimitVelocityGradient&&(f._currentLimitVelocity1=f._currentLimitVelocity2,f._currentLimitVelocity2=g.getFactor(),f._currentLimitVelocityGradient=y);const S=(0,l.n)(f._currentLimitVelocity1,f._currentLimitVelocity2,p);f.direction.length()>S&&f.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&L.GetCurrentGradient(Z,this._dragGradients,((y,g,p)=>{y!==f._currentDragGradient&&(f._currentDrag1=f._currentDrag2,f._currentDrag2=g.getFactor(),f._currentDragGradient=y);const S=(0,l.n)(f._currentDrag1,f._currentDrag2,p);this._scaledDirection.scaleInPlace(1-S)})),this.isLocal&&f.le?(f.le.addInPlace(this._scaledDirection),p.m.TransformCoordinatesToRef(f.le,this._emitterWorldMatrix,f.position)):f.position.addInPlace(this._scaledDirection),U&&g&&f._randomNoiseCoordinates1){const y=this._fetchR(f._randomNoiseCoordinates1.x,f._randomNoiseCoordinates1.y,g.width,g.height,U),S=this._fetchR(f._randomNoiseCoordinates1.z,f._randomNoiseCoordinates2.x,g.width,g.height,U),k=this._fetchR(f._randomNoiseCoordinates2.y,f._randomNoiseCoordinates2.z,g.width,g.height,U),i=p.j.o[0],l=p.j.o[1];i.ne((2*y-1)*this.noiseStrength.x,(2*S-1)*this.noiseStrength.y,(2*k-1)*this.noiseStrength.z),i.scaleToRef(H,l),f.direction.addInPlace(l)}this.gravity.scaleToRef(H,this._scaledGravity),f.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&L.GetCurrentGradient(Z,this._sizeGradients,((y,g,p)=>{y!==f._currentSizeGradient&&(f._currentSize1=f._currentSize2,f._currentSize2=g.getFactor(),f._currentSizeGradient=y),f.size=(0,l.n)(f._currentSize1,f._currentSize2,p)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&L.GetCurrentGradient(Z,this._colorRemapGradients,((y,g,p)=>{const S=(0,l.n)(y.factor1,g.factor1,p),k=(0,l.n)(y.factor2,g.factor2,p);f.remapData.x=S,f.remapData.y=k-S})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&L.GetCurrentGradient(Z,this._alphaRemapGradients,((y,g,p)=>{const S=(0,l.n)(y.factor1,g.factor1,p),k=(0,l.n)(y.factor2,g.factor2,p);f.remapData.z=S,f.remapData.w=k-S}))),this._isAnimationSheetEnabled&&f.updateCellIndex(),f._inheritParticleInfoToSubEmitters(),f.age>=f.lifeTime&&(this._emitFromParticle(f),f._attachedSubEmitters&&(f._attachedSubEmitters.forEach((y=>{y.particleSystem.disposeOnStop=!0,y.particleSystem.stop()})),f._attachedSubEmitters=null),this.recycleParticle(f),S&&k--)}}}serialize(y){throw new Error("Method not implemented.")}clone(y,g){throw new Error("Method not implemented.")}_addFactorGradient(y,g,f,p){const S=new O(g,f,p);y.push(S),y.sort(((y,g)=>y.gradient<g.gradient?-1:y.gradient>g.gradient?1:0))}_removeFactorGradient(y,g){if(!y)return;let f=0;for(const p of y){if(p.gradient===g){y.splice(f,1);break}f++}}addLifeTimeGradient(y,g,f){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,y,g,f),this}removeLifeTimeGradient(y){return this._removeFactorGradient(this._lifeTimeGradients,y),this}addSizeGradient(y,g,f){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,y,g,f),this}removeSizeGradient(y){return this._removeFactorGradient(this._sizeGradients,y),this}addColorRemapGradient(y,g,f){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,y,g,f),this}removeColorRemapGradient(y){return this._removeFactorGradient(this._colorRemapGradients,y),this}addAlphaRemapGradient(y,g,f){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,y,g,f),this}removeAlphaRemapGradient(y){return this._removeFactorGradient(this._alphaRemapGradients,y),this}addAngularSpeedGradient(y,g,f){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,y,g,f),this}removeAngularSpeedGradient(y){return this._removeFactorGradient(this._angularSpeedGradients,y),this}addVelocityGradient(y,g,f){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,y,g,f),this}removeVelocityGradient(y){return this._removeFactorGradient(this._velocityGradients,y),this}addLimitVelocityGradient(y,g,f){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,y,g,f),this}removeLimitVelocityGradient(y){return this._removeFactorGradient(this._limitVelocityGradients,y),this}addDragGradient(y,g,f){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,y,g,f),this}removeDragGradient(y){return this._removeFactorGradient(this._dragGradients,y),this}addEmitRateGradient(y,g,f){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,y,g,f),this}removeEmitRateGradient(y){return this._removeFactorGradient(this._emitRateGradients,y),this}addStartSizeGradient(y,g,f){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,y,g,f),this}removeStartSizeGradient(y){return this._removeFactorGradient(this._startSizeGradients,y),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const y=new Uint8Array(4*this._rawTextureWidth),g=i.j.hb[0];for(let f=0;f<this._rawTextureWidth;f++){const p=f/this._rawTextureWidth;L.GetCurrentGradient(p,this._rampGradients,((p,S,k)=>{i.c.LerpToRef(p.color,S.color,k,g),y[4*f]=255*g.r,y[4*f+1]=255*g.g,y[4*f+2]=255*g.b,y[4*f+3]=255}))}this._rampGradientsTexture=d.d.CreateRGBATexture(y,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((y,g)=>y.gradient<g.gradient?-1:y.gradient>g.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(y,g){this._rampGradients||(this._rampGradients=[]);const f=new E(y,g);return this._rampGradients.push(f),this._syncRampGradientTexture(),this}removeRampGradient(y){return this._removeGradientAndTexture(y,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(y,g,f){this._colorGradients||(this._colorGradients=[]);const p=new X(y,g,f);return this._colorGradients.push(p),this._colorGradients.sort(((y,g)=>y.gradient<g.gradient?-1:y.gradient>g.gradient?1:0)),this}removeColorGradient(y){if(!this._colorGradients)return this;let g=0;for(const f of this._colorGradients){if(f.gradient===y){this._colorGradients.splice(g,1);break}g++}return this}resetDrawCache(){for(const y of this._drawWrappers)if(y)for(const g of y)null===g||void 0===g||g.dispose();this._drawWrappers=[]}_fetchR(y,g,f,p,S){return S[4*(((y=.5*Math.abs(y)+.5)*f%f|0)+((g=.5*Math.abs(g)+.5)*p%p|0)*f)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const y=this._engine,g=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*g),this._vertexBuffer=new T.b(y,this._vertexData,!0,g);let f=0;const p=this._vertexBuffer.createVertexBuffer(T.c.PositionKind,f,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.c.PositionKind]=p,f+=3;const S=this._vertexBuffer.createVertexBuffer(T.c.ColorKind,f,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.c.ColorKind]=S,f+=4;const k=this._vertexBuffer.createVertexBuffer("angle",f,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=k,f+=1;const i=this._vertexBuffer.createVertexBuffer("size",f,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=i,f+=2,this._isAnimationSheetEnabled){const y=this._vertexBuffer.createVertexBuffer("cellIndex",f,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=y,f+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const y=this._vertexBuffer.createVertexBuffer("direction",f,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=y,f+=3}if(this._useRampGradients){const y=this._vertexBuffer.createVertexBuffer("remapData",f,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=y,f+=4}let H;if(this._useInstancing){const g=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new T.b(y,g,!1,2),H=this._spriteBuffer.createVertexBuffer("offset",0,2)}else H=this._vertexBuffer.createVertexBuffer("offset",f,2,this._vertexBufferSize,this._useInstancing),f+=2;this._vertexBuffers.offset=H,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const y=[],g=[];let f=0;for(let p=0;p<this._capacity;p++)y.push(f),y.push(f+1),y.push(f+2),y.push(f),y.push(f+2),y.push(f+3),g.push(f,f+1,f+1,f+2,f+2,f+3,f+3,f,f,f+3),f+=4;this._indexBuffer=this._engine.createIndexBuffer(y),this._linesIndexBuffer=this._engine.createIndexBuffer(g)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(y)setTimeout((()=>{this.start(0)}),y);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var g;-1!==(null===(g=this.j)||void 0===g?void 0:g.getClassName().indexOf("Mesh"))&&this.j.Sj(!0);const y=this.noiseTexture;if(y&&y.onGeneratedObservable)y.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let g=0;g<this.preWarmCycles;g++)this.animate(!0),y.render()}))}));else for(let g=0;g<this.preWarmCycles;g++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(y))}_postStop(y){}reset(){this._stockParticles.length=0,this.wj.length=0}_appendParticleVertex(y,g,f,S){let k=y*this._vertexBufferSize;if(this._vertexData[k++]=g.position.x+this.fg.x,this._vertexData[k++]=g.position.y+this.fg.y,this._vertexData[k++]=g.position.z+this.fg.z,this._vertexData[k++]=g.color.r,this._vertexData[k++]=g.color.g,this._vertexData[k++]=g.color.b,this._vertexData[k++]=g.color.a,this._vertexData[k++]=g.angle,this._vertexData[k++]=g.scale.x*g.size,this._vertexData[k++]=g.scale.y*g.size,this._isAnimationSheetEnabled&&(this._vertexData[k++]=g.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[k++]=g.direction.x,this._vertexData[k++]=g.direction.y,this._vertexData[k++]=g.direction.z);else if(g._initialDirection){let y=g._initialDirection;this.isLocal&&(p.m.TransformNormalToRef(y,this._emitterWorldMatrix,p.j.o[0]),y=p.j.o[0]),0===y.x&&0===y.z&&(y.x=.001),this._vertexData[k++]=y.x,this._vertexData[k++]=y.y,this._vertexData[k++]=y.z}else{let y=g.direction;this.isLocal&&(p.m.TransformNormalToRef(y,this._emitterWorldMatrix,p.j.o[0]),y=p.j.o[0]),0===y.x&&0===y.z&&(y.x=.001),this._vertexData[k++]=y.x,this._vertexData[k++]=y.y,this._vertexData[k++]=y.z}this._useRampGradients&&g.remapData&&(this._vertexData[k++]=g.remapData.x,this._vertexData[k++]=g.remapData.y,this._vertexData[k++]=g.remapData.z,this._vertexData[k++]=g.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===f?f=this._epsilon:1===f&&(f=1-this._epsilon),0===S?S=this._epsilon:1===S&&(S=1-this._epsilon)),this._vertexData[k++]=f,this._vertexData[k++]=S)}_prepareParticle(y){}_update(y){if(this._alive=this.wj.length>0,this.j.position){const y=this.j;this._emitterWorldMatrix=y.getWorldMatrix()}else{const y=this.j;this._emitterWorldMatrix=p.c.Translation(y.x,y.y,y.z)}let g;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.wj);for(let f=0;f<y&&this.wj.length!==this._capacity;f++){if(g=this._createParticle(),this.wj.push(g),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const y=(0,l.d)(this._actualFrame/this.targetStopDuration);L.GetCurrentGradient(y,this._lifeTimeGradients,((f,p)=>{const S=f,k=p,i=S.getFactor(),H=k.getFactor(),U=(y-S.gradient)/(k.gradient-S.gradient);g.lifeTime=(0,l.n)(i,H,U)}))}else g.lifeTime=(0,l.q)(this.minLifeTime,this.maxLifeTime);const y=(0,l.q)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,g.position,g,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,g.position,g,this.isLocal),this.isLocal&&(g.le?g.le.p(g.position):g.le=g.position.clone(),p.m.TransformCoordinatesToRef(g.le,this._emitterWorldMatrix,g.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,g.direction,g,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,g.direction,g,this.isLocal,this._emitterInverseWorldMatrix),0===y?g._initialDirection?g._initialDirection.p(g.direction):g._initialDirection=g.direction.clone():g._initialDirection=null,g.direction.scaleInPlace(y),this._sizeGradients&&0!==this._sizeGradients.length?(g._currentSizeGradient=this._sizeGradients[0],g._currentSize1=g._currentSizeGradient.getFactor(),g.size=g._currentSize1,this._sizeGradients.length>1?g._currentSize2=this._sizeGradients[1].getFactor():g._currentSize2=g._currentSize1):g.size=(0,l.q)(this.minSize,this.maxSize),g.scale.ne((0,l.q)(this.minScaleX,this.maxScaleX),(0,l.q)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const y=this._actualFrame/this.targetStopDuration;L.GetCurrentGradient(y,this._startSizeGradients,((y,f,p)=>{y!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=f.getFactor(),this._currentStartSizeGradient=y);const S=(0,l.n)(this._currentStartSize1,this._currentStartSize2,p);g.scale.scaleInPlace(S)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(g._currentAngularSpeedGradient=this._angularSpeedGradients[0],g.angularSpeed=g._currentAngularSpeedGradient.getFactor(),g._currentAngularSpeed1=g.angularSpeed,this._angularSpeedGradients.length>1?g._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():g._currentAngularSpeed2=g._currentAngularSpeed1):g.angularSpeed=(0,l.q)(this.minAngularSpeed,this.maxAngularSpeed),g.angle=(0,l.q)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(g._currentVelocityGradient=this._velocityGradients[0],g._currentVelocity1=g._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?g._currentVelocity2=this._velocityGradients[1].getFactor():g._currentVelocity2=g._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(g._currentLimitVelocityGradient=this._limitVelocityGradients[0],g._currentLimitVelocity1=g._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?g._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():g._currentLimitVelocity2=g._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(g._currentDragGradient=this._dragGradients[0],g._currentDrag1=g._currentDragGradient.getFactor(),this._dragGradients.length>1?g._currentDrag2=this._dragGradients[1].getFactor():g._currentDrag2=g._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)g._currentColorGradient=this._colorGradients[0],g._currentColorGradient.getColorToRef(g.color),g._currentColor1.p(g.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(g._currentColor2):g._currentColor2.p(g.color);else{const y=(0,l.q)(0,1);i.f.LerpToRef(this.color1,this.color2,y,g.color),this.colorDead.subtractToRef(g.color,this._colorDiff),this._colorDiff.scaleToRef(1/g.lifeTime,g.colorStep)}this._isAnimationSheetEnabled&&(g._initialStartSpriteCellID=this.startSpriteCellID,g._initialEndSpriteCellID=this.endSpriteCellID,g._initialSpriteCellLoop=this.spriteCellLoop),g.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(g.remapData=new p.o(0,1,0,1)),this.noiseTexture&&(g._randomNoiseCoordinates1?(g._randomNoiseCoordinates1.ne(Math.random(),Math.random(),Math.random()),g._randomNoiseCoordinates2.ne(Math.random(),Math.random(),Math.random())):(g._randomNoiseCoordinates1=new p.m(Math.random(),Math.random(),Math.random()),g._randomNoiseCoordinates2=new p.m(Math.random(),Math.random(),Math.random()))),g._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=[T.c.PositionKind,T.c.ColorKind,"angle","offset","size"];return y&&p.push("cellIndex"),g||p.push("direction"),f&&p.push("remapData"),p}static _GetEffectCreationOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,gy.c)(p),y&&p.push("particlesInfos"),g&&p.push("logarithmicDepthConstant"),f&&(p.push("vFogInfos"),p.push("vFogColor")),p}fillDefines(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,gy.j)(this,this._scene,y),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&y.push("#define FOG")),this._isAnimationSheetEnabled&&y.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&y.push("#define LOGARITHMICDEPTH"),g===U.BLENDMODE_MULTIPLY&&y.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&y.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(y.push("#define BILLBOARD"),this.billboardMode){case 2:y.push("#define BILLBOARDY");break;case 8:case 9:y.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&y.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:y.push("#define BILLBOARDMODE_ALL")}f&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),y.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(y,g,f){g.push(...Sy._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),y.push(...Sy._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),f.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,py.g)(y,this._imageProcessingConfigurationDefines),(0,py.e)(f,this._imageProcessingConfigurationDefines))}_getWrapper(y){const g=this._getCustomDrawWrapper(y);if(null!==g&&void 0!==g&&g.effect)return g;const f=[];this.fillDefines(f,y);const p=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let S=this._drawWrappers[p];S||(S=this._drawWrappers[p]=[]);let k=S[y];k||(k=new yy.b(this._engine),k.drawContext&&(k.drawContext.useInstancing=this._useInstancing),S[y]=k);const i=f.join("\n");if(k.defines!==i){const y=[],g=[],f=[];this.fillUniformsAttributesAndSamplerNames(g,y,f),k.setEffect(this._engine.createEffect("particles",y,g,f,i,void 0,void 0,void 0,void 0,this._shaderLanguage),i)}return k}animate(){var y;let g,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!f&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(f?this.preWarmStepOffset:(null===(y=this._scene)||void 0===y?void 0:y.getAnimationRatio())||1),this.manualEmitCount>-1)g=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let y=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const g=this._actualFrame/this.targetStopDuration;L.GetCurrentGradient(g,this._emitRateGradients,((g,f,p)=>{g!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=f.getFactor(),this._currentEmitRateGradient=g),y=(0,l.n)(this._currentEmitRate1,this._currentEmitRate2,p)}))}g=y*this._scaledUpdateSpeed|0,this._newPartsExcess+=y*this._scaledUpdateSpeed-g}if(this._newPartsExcess>1&&(g+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?g=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(g),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!f){let y=0;for(let g=0;g<this.wj.length;g++){const f=this.wj[g];this._appendParticleVertices(y,f),y+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.wj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(y,g){this._appendParticleVertex(y++,g,0,0),this._useInstancing||(this._appendParticleVertex(y++,g,1,0),this._appendParticleVertex(y++,g,1,1),this._appendParticleVertex(y++,g,0,1))}rebuild(){var y;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(y=this._spriteBuffer)||void 0===y||y._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Sy.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(f.bind(f,11802)),Promise.resolve().then(f.bind(f,11744))])):await Promise.all([Promise.resolve().then(f.bind(f,11728)),Promise.resolve().then(f.bind(f,11718))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(y){const g=this._getWrapper(y),f=g.effect,S=this._engine;S.enableEffect(g);const k=this.defaultViewMatrix??this._scene.getViewMatrix();if(f.setTexture("diffuseSampler",this.particleTexture),f.setMatrix("view",k),f.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const y=this.particleTexture.getBaseSize();f.setFloat3("particlesInfos",this.spriteCellWidth/y.width,this.spriteCellHeight/y.height,this.spriteCellWidth/y.width)}if(f.setVector2("translationPivot",this.translationPivot),f.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const y=this._scene.activeCamera;f.setVector3("eyePosition",y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),f.setTexture("rampSampler",this._rampGradientsTexture));const i=f.defines;var H,l,c,Z,C,q;(this._scene&&((0,gy.g)(f,this,this._scene),this.applyFog&&(0,fy.i)(this._scene,void 0,f)),i.indexOf("#define BILLBOARDMODE_ALL")>=0&&(k.invertToRef(p.j.Matrix[0]),f.setMatrix("invView",p.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?S.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,f):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,f)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?S.bindBuffers(this._vertexBuffers,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBuffer:this._indexBuffer,f):S.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null,f);switch(this.useLogarithmicDepth&&this._scene&&(0,fy.q)(i,f,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(f),y){case U.BLENDMODE_ADD:S.setAlphaMode(1);break;case U.BLENDMODE_ONEONE:S.setAlphaMode(6);break;case U.BLENDMODE_STANDARD:S.setAlphaMode(2);break;case U.BLENDMODE_MULTIPLY:S.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(f),this._useInstancing)?null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?S.drawElementsType(6,0,10,this.wj.length):S.drawArraysType(7,0,4,this.wj.length):null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?S.drawElementsType(1,0,10*this.wj.length):S.drawElementsType(0,0,6*this.wj.length);return this.wj.length}render(){if(!this.isReady()||!this.wj.length)return 0;const y=this._engine;y.setState&&(y.setState(!1),this.forceDepthWrite&&y.setDepthWrite(!0));let g=0;return g=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),g}_onDispose(){}dispose(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(g,f),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const y=this._scene.uj.indexOf(this);y>-1&&this._scene.uj.splice(y,1),this._scene._activeParticleSystems.dispose()}this.nj.notifyObservers(this),this.nj.clear(),this.onStoppedObservable.clear(),this.reset()}}Sy.ForceGLSL=!1;var ky,iy=f(10755);!function(y){y[y.ATTACHED=0]="ATTACHED",y[y.END=1]="END"}(ky||(ky={}));class Hy{constructor(y){if(this.particleSystem=y,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!y.j||!y.j.dispose){const g=(0,H.b)("BABYLON.AbstractMesh");y.j=new g("SubemitterSystemEmitter",y.va()),y._disposeEmitterOnDispose=!0}}clone(){let y=this.particleSystem.j;if(y){if(y instanceof p.m)y=y.clone();else if(-1!==y.getClassName().indexOf("Mesh")){y=new((0,H.b)("BABYLON.Mesh"))("",y.va()),y.isVisible=!1}}else y=new p.m;const g=new Hy(this.particleSystem.clone(this.particleSystem.name,y));return g.particleSystem.name+="Clone",g.type=this.type,g.inheritDirection=this.inheritDirection,g.inheritedVelocityAmount=this.inheritedVelocityAmount,g.particleSystem._disposeEmitterOnDispose=!0,g.particleSystem.disposeOnStop=!0,g}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={};return g.type=this.type,g.inheritDirection=this.inheritDirection,g.inheritedVelocityAmount=this.inheritedVelocityAmount,g.particleSystem=this.particleSystem.serialize(y),g}static _ParseParticleSystem(y,g,f){throw(0,iy.b)("ParseParticle")}static Parse(y,g,f){const p=y.particleSystem,S=new Hy(Hy._ParseParticleSystem(p,g,f,!0));return S.type=y.type,S.inheritDirection=y.inheritDirection,S.inheritedVelocityAmount=y.inheritedVelocityAmount,S.particleSystem._isSubEmitter=!0,S}dispose(){this.particleSystem.dispose()}}var Uy=f(10797);function ly(y,g){const f=new B;return f.direction1=y,f.direction2=g,f}function cy(){return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Zy(){return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Cy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.m(0,1,0),f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0);return new G(y,g,f)}function qy(){return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Wy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0),k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new p.m(0,1,0);return new j(y,g,f,S,k)}function jy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new C(y,g)}function Py(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0);return new q(y,g,f,S)}class By extends Sy{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=y=>{if(!this._subEmitters||0===this._subEmitters.length)return;const g=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[g].forEach((g=>{if(1===g.type){const f=g.clone();y._inheritParticleInfoToSubEmitter(f),f.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(f.particleSystem),f.particleSystem.start()}}))}}createPointEmitter(y,g){const f=ly(y,g);return this.particleEmitterType=f,f}createHemisphericEmitter(){const y=cy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createSphereEmitter(){const y=Zy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createDirectedSphereEmitter(){const y=Cy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0));return this.particleEmitterType=y,y}createCylinderEmitter(){const y=qy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=y,y}createDirectedCylinderEmitter(){const y=Wy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new p.m(0,1,0));return this.particleEmitterType=y,y}createConeEmitter(){const y=jy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=y,y}createDirectedConeEmitter(){const y=Py(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0));return this.particleEmitterType=y,y}createBoxEmitter(y,g,f,p){const S=new Z;return this.particleEmitterType=S,this.direction1=y,this.direction2=g,this.minEmitBox=f,this.maxEmitBox=p,S}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((y=>{y instanceof By?this._subEmitters.push([new Hy(y)]):y instanceof Hy?this._subEmitters.push([y]):y instanceof Array&&this._subEmitters.push(y)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((y=>{y.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const y=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==y&&this._rootParticleSystem.activeSubSystems.splice(y,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(y){y&&this._stopSubEmitters()}_prepareParticle(y){if(this._subEmitters&&this._subEmitters.length>0){const g=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];y._attachedSubEmitters=[],g.forEach((g=>{if(0===g.type){const f=g.clone();y._attachedSubEmitters.push(f),f.particleSystem.start()}}))}}_onDispose(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var f;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),y)&&(null===(f=this.particles)||void 0===f||f.forEach((y=>{if(y._attachedSubEmitters)for(let g=y._attachedSubEmitters.length-1;g>=0;g-=1)y._attachedSubEmitters[g].dispose()})));if(g&&this.activeSubSystems)for(let p=this.activeSubSystems.length-1;p>=0;p-=1)this.activeSubSystems[p].dispose();if(this._subEmitters&&this._subEmitters.length){for(let y=0;y<this._subEmitters.length;y++)for(const g of this._subEmitters[y])g.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(y,g,f,S){let k;k=f instanceof Uy.b?null:f;const U=(0,H.b)("BABYLON.Texture");if(U&&k&&(y.texture?g.particleTexture=U.Parse(y.texture,k,S):y.textureName&&(g.particleTexture=new U(S+y.textureName,k,!1,void 0===y.invertY||y.invertY),g.particleTexture.name=y.textureName)),y.emitterId||0===y.emitterId||void 0!==y.j?y.emitterId&&k?g.j=k.getLastMeshById(y.emitterId):g.j=p.m.eh(y.j):g.j=p.m.Zero(),g.isLocal=!!y.isLocal,void 0!==y.renderingGroupId&&(g.renderingGroupId=y.renderingGroupId),void 0!==y.isBillboardBased&&(g.isBillboardBased=y.isBillboardBased),void 0!==y.billboardMode&&(g.billboardMode=y.billboardMode),void 0!==y.useLogarithmicDepth&&(g.useLogarithmicDepth=y.useLogarithmicDepth),y.animations){for(let f=0;f<y.animations.length;f++){const p=y.animations[f],S=(0,H.b)("BABYLON.Animation");S&&g.animations.push(S.Parse(p))}g.beginAnimationOnStart=y.beginAnimationOnStart,g.beginAnimationFrom=y.beginAnimationFrom,g.beginAnimationTo=y.beginAnimationTo,g.beginAnimationLoop=y.beginAnimationLoop}if(y.autoAnimate&&k&&k.beginAnimation(g,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),g.startDelay=0|y.startDelay,g.minAngularSpeed=y.minAngularSpeed,g.maxAngularSpeed=y.maxAngularSpeed,g.minSize=y.minSize,g.maxSize=y.maxSize,y.minScaleX&&(g.minScaleX=y.minScaleX,g.maxScaleX=y.maxScaleX,g.minScaleY=y.minScaleY,g.maxScaleY=y.maxScaleY),void 0!==y.preWarmCycles&&(g.preWarmCycles=y.preWarmCycles,g.preWarmStepOffset=y.preWarmStepOffset),void 0!==y.minInitialRotation&&(g.minInitialRotation=y.minInitialRotation,g.maxInitialRotation=y.maxInitialRotation),g.minLifeTime=y.minLifeTime,g.maxLifeTime=y.maxLifeTime,g.minEmitPower=y.minEmitPower,g.maxEmitPower=y.maxEmitPower,g.emitRate=y.emitRate,g.gravity=p.m.eh(y.gravity),y.noiseStrength&&(g.noiseStrength=p.m.eh(y.noiseStrength)),g.color1=i.f.eh(y.color1),g.color2=i.f.eh(y.color2),g.colorDead=i.f.eh(y.colorDead),g.updateSpeed=y.updateSpeed,g.targetStopDuration=y.targetStopDuration,g.blendMode=y.blendMode,y.colorGradients)for(const p of y.colorGradients)g.addColorGradient(p.gradient,i.f.eh(p.color1),p.color2?i.f.eh(p.color2):void 0);if(y.rampGradients){for(const f of y.rampGradients)g.addRampGradient(f.gradient,i.c.eh(f.color));g.useRampGradients=y.useRampGradients}if(y.colorRemapGradients)for(const p of y.colorRemapGradients)g.addColorRemapGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.alphaRemapGradients)for(const p of y.alphaRemapGradients)g.addAlphaRemapGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.sizeGradients)for(const p of y.sizeGradients)g.addSizeGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.angularSpeedGradients)for(const p of y.angularSpeedGradients)g.addAngularSpeedGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.velocityGradients)for(const p of y.velocityGradients)g.addVelocityGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.dragGradients)for(const p of y.dragGradients)g.addDragGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.emitRateGradients)for(const p of y.emitRateGradients)g.addEmitRateGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.startSizeGradients)for(const p of y.startSizeGradients)g.addStartSizeGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.lifeTimeGradients)for(const p of y.lifeTimeGradients)g.addLifeTimeGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);if(y.limitVelocityGradients){for(const f of y.limitVelocityGradients)g.addLimitVelocityGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);g.limitVelocityDamping=y.limitVelocityDamping}if(y.noiseTexture&&k){const f=(0,H.b)("BABYLON.ProceduralTexture");g.noiseTexture=f.Parse(y.noiseTexture,k,S)}let l;if(y.particleEmitterType){switch(y.particleEmitterType.type){case"SphereParticleEmitter":l=new R;break;case"SphereDirectedParticleEmitter":l=new G;break;case"ConeEmitter":case"ConeParticleEmitter":l=new C;break;case"ConeDirectedParticleEmitter":l=new q;break;case"CylinderParticleEmitter":l=new W;break;case"CylinderDirectedParticleEmitter":l=new j;break;case"HemisphericParticleEmitter":l=new P;break;case"PointParticleEmitter":l=new B;break;case"MeshParticleEmitter":l=new Q;break;case"CustomParticleEmitter":l=new z;break;default:l=new Z}l.parse(y.particleEmitterType,k)}else l=new Z,l.parse(y,k);g.particleEmitterType=l,g.startSpriteCellID=y.startSpriteCellID,g.endSpriteCellID=y.endSpriteCellID,g.spriteCellLoop=y.spriteCellLoop??!0,g.spriteCellWidth=y.spriteCellWidth,g.spriteCellHeight=y.spriteCellHeight,g.spriteCellChangeSpeed=y.spriteCellChangeSpeed,g.spriteRandomStartCell=y.spriteRandomStartCell,g.disposeOnStop=y.disposeOnStop??!1,g.manualEmitCount=y.manualEmitCount??-1}static Parse(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const H=y.name;let U,l,c=null,Z=null;if(g instanceof Uy.b?U=g:(l=g,U=l.getEngine()),y.customShader&&U.createEffectForParticles){Z=y.customShader;const g=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"";c=U.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,g)}const C=new By(H,k||y.sb,g,c,y.isAnimationSheetEnabled);if(C.customShader=Z,C._rootUrl=f,y.id&&(C.id=y.id),y.subEmitters){C.subEmitters=[];for(const p of y.subEmitters){const y=[];for(const S of p)y.push(Hy.Parse(S,g,f));C.subEmitters.push(y)}}return By._Parse(y,C,g,f),y.textureMask&&(C.textureMask=i.f.eh(y.textureMask)),y.fg&&(C.fg=p.m.eh(y.fg)),y.preventAutoStart&&(C.preventAutoStart=y.preventAutoStart),S||C.preventAutoStart||C.start(),C}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={};if(By._Serialize(g,this,y),g.textureMask=this.textureMask.mj(),g.customShader=this.customShader,g.preventAutoStart=this.preventAutoStart,g.fg=this.fg.mj(),this.subEmitters){g.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const f of this._subEmitters){const p=[];for(const g of f)p.push(g.serialize(y));g.subEmitters.push(p)}}return g}static _Serialize(y,g,f){if(y.name=g.name,y.id=g.id,y.sb=g.getCapacity(),y.disposeOnStop=g.disposeOnStop,y.manualEmitCount=g.manualEmitCount,g.j.position){const f=g.j;y.emitterId=f.id}else{const f=g.j;y.j=f.mj()}g.particleEmitterType&&(y.particleEmitterType=g.particleEmitterType.serialize()),g.particleTexture&&(f?y.texture=g.particleTexture.serialize():(y.textureName=g.particleTexture.name,y.invertY=!!g.particleTexture._invertY)),y.isLocal=g.isLocal,b.c.AppendSerializedAnimations(g,y),y.beginAnimationOnStart=g.beginAnimationOnStart,y.beginAnimationFrom=g.beginAnimationFrom,y.beginAnimationTo=g.beginAnimationTo,y.beginAnimationLoop=g.beginAnimationLoop,y.startDelay=g.startDelay,y.renderingGroupId=g.renderingGroupId,y.isBillboardBased=g.isBillboardBased,y.billboardMode=g.billboardMode,y.minAngularSpeed=g.minAngularSpeed,y.maxAngularSpeed=g.maxAngularSpeed,y.minSize=g.minSize,y.maxSize=g.maxSize,y.minScaleX=g.minScaleX,y.maxScaleX=g.maxScaleX,y.minScaleY=g.minScaleY,y.maxScaleY=g.maxScaleY,y.minEmitPower=g.minEmitPower,y.maxEmitPower=g.maxEmitPower,y.minLifeTime=g.minLifeTime,y.maxLifeTime=g.maxLifeTime,y.emitRate=g.emitRate,y.gravity=g.gravity.mj(),y.noiseStrength=g.noiseStrength.mj(),y.color1=g.color1.mj(),y.color2=g.color2.mj(),y.colorDead=g.colorDead.mj(),y.updateSpeed=g.updateSpeed,y.targetStopDuration=g.targetStopDuration,y.blendMode=g.blendMode,y.preWarmCycles=g.preWarmCycles,y.preWarmStepOffset=g.preWarmStepOffset,y.minInitialRotation=g.minInitialRotation,y.maxInitialRotation=g.maxInitialRotation,y.startSpriteCellID=g.startSpriteCellID,y.spriteCellLoop=g.spriteCellLoop,y.endSpriteCellID=g.endSpriteCellID,y.spriteCellChangeSpeed=g.spriteCellChangeSpeed,y.spriteCellWidth=g.spriteCellWidth,y.spriteCellHeight=g.spriteCellHeight,y.spriteRandomStartCell=g.spriteRandomStartCell,y.isAnimationSheetEnabled=g.isAnimationSheetEnabled,y.useLogarithmicDepth=g.useLogarithmicDepth;const p=g.getColorGradients();if(p){y.colorGradients=[];for(const g of p){const f={gradient:g.gradient,color1:g.color1.mj()};g.color2?f.color2=g.color2.mj():f.color2=g.color1.mj(),y.colorGradients.push(f)}}const S=g.getRampGradients();if(S){y.rampGradients=[];for(const g of S){const f={gradient:g.gradient,color:g.color.mj()};y.rampGradients.push(f)}y.useRampGradients=g.useRampGradients}const k=g.getColorRemapGradients();if(k){y.colorRemapGradients=[];for(const g of k){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.colorRemapGradients.push(f)}}const i=g.getAlphaRemapGradients();if(i){y.alphaRemapGradients=[];for(const g of i){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.alphaRemapGradients.push(f)}}const H=g.getSizeGradients();if(H){y.sizeGradients=[];for(const g of H){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.sizeGradients.push(f)}}const U=g.getAngularSpeedGradients();if(U){y.angularSpeedGradients=[];for(const g of U){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.angularSpeedGradients.push(f)}}const l=g.getVelocityGradients();if(l){y.velocityGradients=[];for(const g of l){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.velocityGradients.push(f)}}const c=g.getDragGradients();if(c){y.dragGradients=[];for(const g of c){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.dragGradients.push(f)}}const Z=g.getEmitRateGradients();if(Z){y.emitRateGradients=[];for(const g of Z){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.emitRateGradients.push(f)}}const C=g.getStartSizeGradients();if(C){y.startSizeGradients=[];for(const g of C){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.startSizeGradients.push(f)}}const q=g.getLifeTimeGradients();if(q){y.lifeTimeGradients=[];for(const g of q){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.lifeTimeGradients.push(f)}}const W=g.getLimitVelocityGradients();if(W){y.limitVelocityGradients=[];for(const g of W){const f={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?f.factor2=g.factor2:f.factor2=g.factor1,y.limitVelocityGradients.push(f)}y.limitVelocityDamping=g.limitVelocityDamping}g.noiseTexture&&(y.noiseTexture=g.noiseTexture.serialize())}clone(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p={...this._customWrappers};let S=null;const k=this._engine;if(k.createEffectForParticles&&null!=this.customShader){S=this.customShader;const y=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"",g=k.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,y);p[0]?p[0].effect=g:this.setCustomEffect(g,0)}const i=this.serialize(f),H=By.Parse(i,this._scene||this._engine,this._rootUrl);return H.name=y,H.customShader=S,H._customWrappers=p,void 0===g&&(g=this.j),this.noiseTexture&&(H.noiseTexture=this.noiseTexture.clone()),H.j=g,this.preventAutoStart||H.start(),H}}By.BILLBOARDMODE_Y=2,By.BILLBOARDMODE_ALL=7,By.BILLBOARDMODE_STRETCHED=8,By.BILLBOARDMODE_STRETCHED_LOCAL=9,Hy._ParseParticleSystem=By.Parse;var Ry=f(11087),Gy=f(11038),zy=f(11534);zy.d.prototype.createTransformFeedback=function(){const y=this._gl.createTransformFeedback();if(!y)throw new Error("Unable to create Transform Feedback");return y},zy.d.prototype.deleteTransformFeedback=function(y){this._gl.deleteTransformFeedback(y)},zy.d.prototype.bindTransformFeedback=function(y){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,y)},zy.d.prototype.beginTransformFeedback=function(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(y?this._gl.POINTS:this._gl.TRIANGLES)},zy.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},zy.d.prototype.setTranformFeedbackVaryings=function(y,g){this._gl.transformFeedbackVaryings(y,g,this._gl.INTERLEAVED_ATTRIBS)},zy.d.prototype.bindTransformFeedbackBuffer=function(y){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,y?y.underlyingResource:null)},zy.d.prototype.readTransformFeedbackBuffer=function(y){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,y)};const Ty="clipPlaneFragmentDeclaration2",Qy="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";w.e.IncludesShadersStore[Ty]=Qy;f(11621),f(11630),f(11639),f(11644),f(11653),f(11661),f(11668),f(11670);const my="gpuRenderParticlesPixelShader",ay="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";w.e.ShadersStore[my]=ay;const wy="clipPlaneVertexDeclaration2",oy="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";w.e.IncludesShadersStore[wy]=oy;f(11676),f(11678),f(11687),f(11689);const Iy="gpuRenderParticlesVertexShader",Yy="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";w.e.ShadersStore[Iy]=Yy;class ny extends U{static get IsSupported(){if(!t.d.LastCreatedEngine)return!1;const y=t.d.LastCreatedEngine.getCaps();return y.supportTransformFeedbacks||y.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(y){this._maxActiveParticleCount=Math.min(y,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(y){this.maxActiveParticleCount=y}createPointEmitter(y,g){const f=ly(y,g);return this.particleEmitterType=f,f}createHemisphericEmitter(){const y=cy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createSphereEmitter(){const y=Zy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createDirectedSphereEmitter(){const y=Cy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0));return this.particleEmitterType=y,y}createCylinderEmitter(){const y=qy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=y,y}createDirectedCylinderEmitter(){const y=Wy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new p.m(0,1,0));return this.particleEmitterType=y,y}createConeEmitter(){const y=jy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=y,y}createDirectedConeEmitter(){const y=Py(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p.m(0,1,0));return this.particleEmitterType=y,y}createBoxEmitter(y,g,f,p){const S=new Z;return this.particleEmitterType=S,this.direction1=y,this.direction2=g,this.minEmitBox=f,this.maxEmitBox=p,S}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==By.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(By.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(By.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";y?setTimeout((()=>{this.start(0)}),y):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var y;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._customWrappers[g])||void 0===y?void 0:y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[y]??this._customWrappers[0]}setCustomEffect(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[g]=new yy.b(this._engine),this._customWrappers[g].effect=y}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new x.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(y,g,f){return super._removeGradientAndTexture(y,g,f),this._releaseBuffers(),this}addColorGradient(y,g){this._colorGradients||(this._colorGradients=[]);const f=new X(y,g);return this._colorGradients.push(f),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(y&&this._colorGradients.sort(((y,g)=>y.gradient<g.gradient?-1:y.gradient>g.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(y){return this._removeGradientAndTexture(y,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const g in this._drawWrappers){var y;null===(y=this._drawWrappers[g].drawContext)||void 0===y||y.reset()}}_addFactorGradient(y,g,f){const p=new O(g,f);y.push(p),this._releaseBuffers()}addSizeGradient(y,g){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,y,g),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(y){return this._removeGradientAndTexture(y,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(y,g){if(!y)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&y.sort(((y,g)=>y.gradient<g.gradient?-1:y.gradient>g.gradient?1:0));const f=this;f[g]&&(f[g].dispose(),f[g]=null)}addAngularSpeedGradient(y,g){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,y,g),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(y){return this._removeGradientAndTexture(y,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(y,g){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,y,g),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(y){return this._removeGradientAndTexture(y,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(y,g){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,y,g),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(y){return this._removeGradientAndTexture(y,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(y,g){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,y,g),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(y){return this._removeGradientAndTexture(y,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(y){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(y),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.nj=new x.d,this.onStoppedObservable=new x.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,f&&"Scene"!==f.getClassName()?(this._engine=f,this.defaultProjectionMatrix=p.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=f||t.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.uj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,H.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,H.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,H.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,H.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new yy.b(this._engine)},this._customWrappers[0].effect=S,this._drawWrappers={0:new yy.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(g=g??{}).randomTextureSize||delete g.randomTextureSize;const i={sb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...g},U=g;isFinite(U)&&(i.sb=U),this._capacity=i.sb,this._maxActiveParticleCount=i.sb,this._currentActiveCount=0,this._isAnimationSheetEnabled=k,this.particleEmitterType=new Z;const l=Math.min(this._engine.getCaps().maxTextureSize,i.randomTextureSize);let c=[];for(let p=0;p<l;++p)c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),c.push(Math.random());this._randomTexture=new d.d(new Float32Array(c),l,1,5,f,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,c=[];for(let p=0;p<l;++p)c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),c.push(Math.random());this._randomTexture2=new d.d(new Float32Array(c),l,1,5,f,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=l}_reset(){this._releaseBuffers()}_createVertexBuffers(y,g,f){const p={};p.position=g.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let S=3;p.age=g.createVertexBuffer("age",S,1,this._attributesStrideSize,!0),S+=1,p.size=g.createVertexBuffer("size",S,3,this._attributesStrideSize,!0),S+=3,p.life=g.createVertexBuffer("life",S,1,this._attributesStrideSize,!0),S+=1,S+=4,this.billboardMode===By.BILLBOARDMODE_STRETCHED&&(p.direction=g.createVertexBuffer("direction",S,3,this._attributesStrideSize,!0)),S+=3,this._platform.alignDataInBuffer&&(S+=1),this.particleEmitterType instanceof z&&(S+=3,this._platform.alignDataInBuffer&&(S+=1)),this._colorGradientsTexture||(p.color=g.createVertexBuffer("color",S,4,this._attributesStrideSize,!0),S+=4),this._isBillboardBased||(p.initialDirection=g.createVertexBuffer("initialDirection",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1)),this.noiseTexture&&(p.noiseCoordinates1=g.createVertexBuffer("noiseCoordinates1",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1),p.noiseCoordinates2=g.createVertexBuffer("noiseCoordinates2",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1)),p.angle=g.createVertexBuffer("angle",S,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?S++:S+=2,this._isAnimationSheetEnabled&&(p.cellIndex=g.createVertexBuffer("cellIndex",S,1,this._attributesStrideSize,!0),S+=1,this.spriteRandomStartCell&&(p.cellStartOffset=g.createVertexBuffer("cellStartOffset",S,1,this._attributesStrideSize,!0),S+=1)),p.offset=f.createVertexBuffer("offset",0,2),p.uv=f.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(p),this._platform.createVertexBuffers(y,p),this.resetDrawCache()}_initialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!y)return;const g=this._engine,f=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof z&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const S=this.particleEmitterType instanceof z,k=p.j.o[0];let i=0;for(let p=0;p<this._capacity;p++)if(f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),S?(this.particleEmitterType.particleDestinationGenerator(p,null,k),f.push(k.x),f.push(k.y),f.push(k.z)):(f.push(0),f.push(0),f.push(0)),this._platform.alignDataInBuffer&&f.push(0),i+=16,S&&(this.particleEmitterType.particlePositionGenerator(p,null,k),f.push(k.x),f.push(k.y),f.push(k.z),this._platform.alignDataInBuffer&&f.push(0),i+=4),this._colorGradientsTexture||(f.push(0),f.push(0),f.push(0),f.push(0),i+=4),this.isBillboardBased||(f.push(0),f.push(0),f.push(0),this._platform.alignDataInBuffer&&f.push(0),i+=4),this.noiseTexture&&(f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),this._platform.alignDataInBuffer&&f.push(0),f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),this._platform.alignDataInBuffer&&f.push(0),i+=8),f.push(0),i+=1,this._angularSpeedGradientsTexture||(f.push(0),i+=1),this._isAnimationSheetEnabled&&(f.push(0),i+=1,this.spriteRandomStartCell&&(f.push(0),i+=1)),this._platform.alignDataInBuffer){let y=3-(i+3&3);for(i+=y;y-- >0;)f.push(0)}const H=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(f),l=this._platform.createParticleBuffer(f);this._buffer0=new T.b(g,U,!1,this._attributesStrideSize),this._buffer1=new T.b(g,l,!1,this._attributesStrideSize),this._spriteBuffer=new T.b(g,H,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let y=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(y+="\n#define BILLBOARD"),this._colorGradientsTexture&&(y+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(y+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(y+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(y+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(y+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(y+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(y+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(y+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(y+="\n#define NOISE"),this.isLocal&&(y+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===y||(this._cachedUpdateDefines=y,this._updateBuffer=this._platform.createUpdateBuffer(y)),this._platform.isUpdateBufferReady()}_getWrapper(y){const g=this._getCustomDrawWrapper(y);if(null!==g&&void 0!==g&&g.effect)return g;const f=[];this.fillDefines(f,y);let p=this._drawWrappers[y];p||(p=new yy.b(this._engine),p.drawContext&&(p.drawContext.useInstancing=!0),this._drawWrappers[y]=p);const S=f.join("\n");if(p.defines!==S){const y=[],g=[],f=[];this.fillUniformsAttributesAndSamplerNames(g,y,f),p.setEffect(this._engine.createEffect("gpuRenderParticles",y,g,f,S),S)}return p}static _GetAttributeNamesOrOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=[T.c.PositionKind,"age","life","size","angle"];return y||S.push(T.c.ColorKind),g&&S.push("cellIndex"),f||S.push("initialDirection"),p&&S.push("direction"),S.push("offset",T.c.UVKind),S}static _GetEffectCreationOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=["emitterWM","fg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,gy.c)(p),y&&p.push("sheetInfos"),g&&p.push("logarithmicDepthConstant"),f&&(p.push("vFogInfos"),p.push("vFogColor")),p}fillDefines(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,gy.j)(this,this._scene,y),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Gy.e.FOGMODE_NONE&&y.push("#define FOG")),g===By.BLENDMODE_MULTIPLY&&y.push("#define BLENDMULTIPLYMODE"),this.isLocal&&y.push("#define LOCAL"),this.useLogarithmicDepth&&y.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(y.push("#define BILLBOARD"),this.billboardMode){case By.BILLBOARDMODE_Y:y.push("#define BILLBOARDY");break;case By.BILLBOARDMODE_STRETCHED:y.push("#define BILLBOARDSTRETCHED");break;case By.BILLBOARDMODE_ALL:y.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&y.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&y.push("#define ANIMATESHEET"),f&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),y.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(y,g,f){g.push(...ny._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===By.BILLBOARDMODE_STRETCHED)),y.push(...ny._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),f.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ry.b.PrepareUniforms(y,this._imageProcessingConfigurationDefines),Ry.b.PrepareSamplers(f,this._imageProcessingConfigurationDefines))}animate(){var y;let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(g?this.preWarmStepOffset:(null===(y=this._scene)||void 0===y?void 0:y.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(y,g){const f=this[g];if(!y||!y.length||f)return;const p=new Float32Array(this._rawTextureWidth);for(let S=0;S<this._rawTextureWidth;S++){const g=S/this._rawTextureWidth;L.GetCurrentGradient(g,y,((y,g,f)=>{p[S]=(0,l.n)(y.factor1,g.factor1,f)}))}this[g]=d.d.CreateRTexture(p,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[g].name=g.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const y=new Uint8Array(4*this._rawTextureWidth),g=i.j.ob[0];for(let f=0;f<this._rawTextureWidth;f++){const p=f/this._rawTextureWidth;L.GetCurrentGradient(p,this._colorGradients,((p,S,k)=>{i.f.LerpToRef(p.color1,S.color1,k,g),y[4*f]=255*g.r,y[4*f+1]=255*g.g,y[4*f+2]=255*g.b,y[4*f+3]=255*g.a}))}this._colorGradientsTexture=d.d.CreateRGBATexture(y,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(y,g){var f,S,k,i;const H=this._getWrapper(y),U=H.effect;this._engine.enableEffect(H);const l=(null===(f=this._scene)||void 0===f?void 0:f.getViewMatrix())||p.c.IdentityReadOnly;if(U.setMatrix("view",l),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("fg",this.fg),this.isLocal&&U.setMatrix("emitterWM",g),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const y=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/y.width,this.spriteCellHeight/y.height,y.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const y=this._scene.activeCamera;U.setVector3("eyePosition",y.globalPosition)}const c=U.defines;if(this._scene&&((0,gy.g)(U,this,this._scene),this.applyFog&&(0,fy.i)(this._scene,void 0,U)),c.indexOf("#define BILLBOARDMODE_ALL")>=0){const y=l.clone();y.invert(),U.setMatrix("invView",y)}switch(this.useLogarithmicDepth&&this._scene&&(0,fy.q)(c,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),y){case By.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case By.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case By.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case By.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,U,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(i=this._scene)&&void 0!==i&&i.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(y){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!y)if(this.j.position){y=this.j.getWorldMatrix()}else{const g=this.j;y=p.j.Matrix[0],p.c.TranslationToRef(g.x,g.y,g.z,y)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",y),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const g=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=g}render(){let y,g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!g&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let y=0;y<this.preWarmCycles;y++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const y=0|this._accumulatedCount;this._accumulatedCount-=y,this._currentActiveCount+=y}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){y=this.j.getWorldMatrix()}else{const g=this.j;y=p.j.Matrix[0],p.c.TranslationToRef(g.x,g.y,g.z,y)}const S=this._engine;this.updateInAnimate||this._update(y);let k=0;return g||f||(S.setState(!1),this.forceDepthWrite&&S.setDepthWrite(!0),k=this.blendMode===By.BLENDMODE_MULTIPLYADD?this._render(By.BLENDMODE_MULTIPLY,y)+this._render(By.BLENDMODE_ADD,y):this._render(this.blendMode,y),this._engine.setAlphaMode(0)),k}rebuild(){const y=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(y,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,y()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const g in this._drawWrappers){this._drawWrappers[g].dispose()}if(this._drawWrappers={},this._scene){const y=this._scene.uj.indexOf(this);y>-1&&this._scene.uj.splice(y,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let g=0;g<this._renderVertexBuffers.length;++g){const y=this._renderVertexBuffers[g];for(const g in y)y[g].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.nj.notifyObservers(this),this.nj.clear()}clone(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p={...this._customWrappers};let S=null;const k=this._engine;if(k.createEffectForParticles&&null!=this.customShader){S=this.customShader;const y=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"";p[0]=k.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,y,void 0,void 0,void 0,this)}const i=this.serialize(f),H=ny.Parse(i,this._scene||this._engine,this._rootUrl);return H.name=y,H.customShader=S,H._customWrappers=p,void 0===g&&(g=this.j),this.noiseTexture&&(H.noiseTexture=this.noiseTexture.clone()),H.j=g,H}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={};return By._Serialize(g,this,y),g.activeParticleCount=this.activeParticleCount,g.randomTextureSize=this._randomTextureSize,g.customShader=this.customShader,g}static Parse(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0;const k=y.name;let i,H;g instanceof Uy.b?i=g:(H=g,i=H.getEngine());const U=new ny(k,{sb:S||y.sb,randomTextureSize:y.randomTextureSize},g,null,y.isAnimationSheetEnabled);if(U._rootUrl=f,y.customShader&&i.createEffectForParticles){const g=y.customShader,f=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"",p=i.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,f,void 0,void 0,void 0,U);U.setCustomEffect(p,0),U.customShader=g}return y.id&&(U.id=y.id),y.activeParticleCount&&(U.activeParticleCount=y.activeParticleCount),By._Parse(y,U,g,f),y.preventAutoStart&&(U.preventAutoStart=y.preventAutoStart),p||U.preventAutoStart||U.start(),U}}var My=f(10714),ry=f(11696),Ny=f(11015);class by{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(y){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const g of this.systems)g.j=y;this._emitterNode=y}setEmitterAsSphere(y,g,f){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:y,renderingGroupId:g};const p=(0,ry.c)("emitterSphere",{diameter:y.diameter,segments:y.segments},f);p.renderingGroupId=g;const S=new Ny.b("emitterSphereMaterial",f);S.emissiveColor=y.color,p.material=S;for(const k of this.systems)k.j=p;this._emitterNode=p}start(y){for(const g of this.systems)y&&(g.j=y),g.start()}dispose(){for(const y of this.systems)y.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={systems:[]};for(const f of this.systems)g.systems.push(f.serialize(y));return this._emitterNode&&(g.j=this._emitterCreationOptions),g}static Parse(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0;const S=new by,k=this.BaseAssetsUrl+"/textures/";g=g||t.d.LastCreatedScene;for(const i of y.systems)S.systems.push(f?ny.Parse(i,g,k,!0,p):By.Parse(i,g,k,!0,p));if(y.j){const f=y.j.options;if("Sphere"===y.j.kind)S.setEmitterAsSphere({diameter:f.diameter,segments:f.segments,color:i.c.eh(f.color)},y.j.renderingGroupId,g)}return S}}by.BaseAssetsUrl="https://assets.babylonjs.com/particles";var sy=f(10757);class uy{static CreateDefault(y){let g,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,p=arguments.length>2?arguments[2]:void 0;return g=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ny("default system",{sb:f},p):new By("default system",f,p),g.j=y,g.particleTexture=new s.c("https://assets.babylonjs.com/textures/flare.png",g.va()),g.createConeEmitter(.1,Math.PI/4),g.color1=new i.f(1,1,1,1),g.color2=new i.f(1,1,1,1),g.colorDead=new i.f(1,1,1,0),g.minSize=.1,g.maxSize=.1,g.minEmitPower=2,g.maxEmitPower=2,g.updateSpeed=1/60,g.emitRate=30,g}static CreateAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0;g||(g=t.d.LastCreatedScene);const S={};return g.addPendingData(S),new Promise(((k,i)=>{if(f&&!ny.IsSupported)return g.removePendingData(S),i("Particle system with GPU is not supported.");My.e.LoadFile(`${uy.BaseAssetsUrl}/systems/${y}.json`,(y=>{g.removePendingData(S);const i=JSON.parse(y.toString());return k(by.Parse(i,g,f,p))}),void 0,void 0,void 0,(()=>(g.removePendingData(S),i(`An error occurred with the creation of your particle system. Check if your type '${y}' exists.`))))}))}static ExportSet(y){const g=new by;for(const f of y)g.systems.push(f);return g}static ParseFromFileAsync(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",k=arguments.length>5?arguments[5]:void 0;return new Promise(((i,H)=>{const U=new sy.d;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const g=JSON.parse(U.responseText);let H;H=p?ny.Parse(g,f,S,!1,k):By.Parse(g,f,S,!1,k),y&&(H.name=y),i(H)}else H("Unable to load the particle system")})),U.open("GET",g),U.send()}))}static ParseFromSnippetAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",S=arguments.length>4?arguments[4]:void 0;if("_BLANK"===y){const y=this.CreateDefault(null);return y.start(),Promise.resolve(y)}return new Promise(((k,i)=>{const H=new sy.d;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const i=JSON.parse(JSON.parse(H.responseText).jsonPayload),U=JSON.parse(i.particleSystem);let l;l=f?ny.Parse(U,g,p,!1,S):By.Parse(U,g,p,!1,S),l.snippetId=y,k(l)}else i("Unable to load the snippet "+y)})),H.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),H.send()}))}}uy.BaseAssetsUrl=by.BaseAssetsUrl,uy.SnippetUrl="https://snippet.babylonjs.com",uy.CreateFromSnippetAsync=uy.ParseFromSnippetAsync;var Fy=f(11321),Ay=f(11149),Jy=f(11700);(0,Jy.f)(Ay.e.NAME_PARTICLESYSTEM,((y,g,f,p)=>{const S=(0,Jy.j)(Ay.e.NAME_PARTICLESYSTEM);if(S&&void 0!==y.uj&&null!==y.uj)for(let k=0,i=y.uj.length;k<i;k++){const i=y.uj[k];f.uj.push(S(i,g,p))}})),(0,Jy.b)(Ay.e.NAME_PARTICLESYSTEM,((y,g,f)=>{if(y.activeParticleCount){return ny.Parse(y,g,f)}return By.Parse(y,g,f)})),Uy.b.prototype.createEffectForParticles=function(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=[],Z=[];const C=[];return U?U.fillUniformsAttributesAndSamplerNames(Z,c,C):(c=By._GetAttributeNamesOrOptions(),Z=By._GetEffectCreationOptions()),-1===S.indexOf(" BILLBOARD")&&(S+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===S.indexOf(" ANIMATESHEET")&&(S+="\n#define ANIMATESHEET\n"),-1===p.indexOf("diffuseSampler")&&p.push("diffuseSampler"),this.createEffect({vertex:(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:y},c,Z.concat(g),C.concat(p),S,k,i,H,void 0,l,(async()=>{0===l?await Promise.resolve().then(f.bind(f,11728)):await Promise.resolve().then(f.bind(f,11802))}))},Fy.e.prototype.getEmittedParticleSystems=function(){const y=[];for(let g=0;g<this.va().uj.length;g++){const f=this.va().uj[g];f.j===this&&y.push(f)}return y},Fy.e.prototype.getHierarchyEmittedParticleSystems=function(){const y=[],g=this.getDescendants();g.push(this);for(let f=0;f<this.va().uj.length;f++){const p=this.va().uj[f],S=p.j;S.position&&-1!==g.indexOf(S)&&y.push(p)}return y};f(11221),f(11228),f(11368);f(11349),f(11708),f(11378),f(11209),f(11385);f(11562);var Vy;f(11716),f(11271);!function(y){y[y.Color=2]="Color",y[y.UV=1]="UV",y[y.Random=0]="Random",y[y.Stated=3]="Stated"}(Vy||(Vy={}));f(11718),f(11728),f(11744),f(11802)},11590:(y,g,f)=>{"use strict";f.d(g,{c:()=>W});var p=f(11021),S=f(11036),k=f(10723),i=f(11054),H=f(10803),U=f(11026),l=f(11099),c=f(10871),Z=f(10797),C=f(10882),q=f(11594);Z.b.prototype.setTextureFromPostProcess=function(y,g,f){var p;let S=null;g&&(g._forcedOutputTexture?S=g._forcedOutputTexture:g._textures.data[g._currentRenderTextureInd]&&(S=g._textures.data[g._currentRenderTextureInd])),this._bindTexture(y,(null===(p=S)||void 0===p?void 0:p.texture)??null,f)},Z.b.prototype.setTextureFromPostProcessOutput=function(y,g,f){var p;this._bindTexture(y,(null===g||void 0===g||null===(p=g._outputTexture)||void 0===p?void 0:p.texture)??null,f)},H.e.prototype.setTextureFromPostProcess=function(y,g){this._engine.setTextureFromPostProcess(this._samplers[y],g,y)},H.e.prototype.setTextureFromPostProcessOutput=function(y,g){this._engine.setTextureFromPostProcessOutput(this._samplers[y],g,y)};class W{static get ForceGLSL(){return q.c.ForceGLSL}static set ForceGLSL(y){q.c.ForceGLSL=y}static RegisterShaderCodeProcessing(y,g){q.c.RegisterShaderCodeProcessing(y,g)}get name(){return this._effectWrapper.name}set name(y){this._effectWrapper.name=y}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(y){this._effectWrapper.alphaMode=y}get samples(){return this._samples}set samples(y){this._samples=Math.min(y,this._engine.getCaps().maxMSAASamples),this._textures.forEach((y=>{y.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(y){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),y&&(this._onActivateObserver=this.onActivateObservable.add(y))}set onSizeChanged(y){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(y)}set onApply(y){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(y)}set onBeforeRender(y){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(y)}set onAfterRender(y){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(y)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(y){this._forcedOutputTexture=y}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.ne(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(y,g,f,p,H,U){var l;let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,Z=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,P=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",R=arguments.length>12?arguments[12]:void 0,G=arguments.length>13&&void 0!==arguments[13]&&arguments[13],z=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,T=arguments.length>15?arguments[15]:void 0,Q=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Xi=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new S.i(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new i.l(1,1),this._texelSize=i.l.Zero(),this.onActivateObservable=new k.d,this.onSizeChangedObservable=new k.d,this.onApplyObservable=new k.d,this.onBeforeRenderObservable=new k.d,this.onAfterRenderObservable=new k.d;let m,a=1,w=null;if(f&&!Array.isArray(f)){const y=f;f=y.uniforms??null,p=y.samplers??null,a=y.size??1,U=y.camera??null,c=y.samplingMode??1,Z=y.Ed,C=y.reusable,j=Array.isArray(y.defines)?y.defines.join("\n"):y.defines??null,P=y.textureType??0,B=y.vertexUrl??"postprocess",R=y.indexParameters,G=y.blockCompilation??!1,z=y.textureFormat??5,T=y.shaderLanguage??0,w=y.uniformBuffers??null,Q=y.extraInitializations,m=y.effectWrapper}else H&&(a="number"===typeof H?H:{width:H.width,height:H.height});const o=!!m;if(this._effectWrapper=m??new q.c({name:y,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:g,Ed:Z||(null===(l=U)||void 0===l?void 0:l.va().getEngine()),uniforms:f,samplers:p,uniformBuffers:w,defines:j,vertexUrl:B,indexParameters:R,blockCompilation:G,shaderLanguage:T,extraInitializations:Q}),this.name=y,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=U?(this._camera=U,this._scene=U.va(),U.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):Z&&(this._engine=Z,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=c||1,this._reusable=C||!1,this._textureType=P,this._textureFormat=z,this._shaderLanguage=T||0,this._samplers=p||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=g,this._vertexUrl=B,this._parameters=f||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=w||[],this._indexParameters=R,!o){this._webGPUReady=1===this._shaderLanguage;const y=[];this._gatherImports(this._engine.isWebGPU&&!W.ForceGLSL,y),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(G,j,Q,y)}}_gatherImports(){let y=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?y.push(Promise.all([f.e(37).then(f.bind(f,13549))])):y.push(Promise.all([Promise.resolve().then(f.bind(f,11601))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(y){return this._disposeTextures(),this._shareOutputWithPostProcess=y,this}useOwnOutput(){0==this._textures.length&&(this._textures=new S.i(2)),this._shareOutputWithPostProcess=null}updateEffect(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(y,g,f,p,S,k,i,H),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let S=0;S<this._textureCache.length;S++)if(this._textureCache[S].texture.width===y.width&&this._textureCache[S].texture.height===y.height&&this._textureCache[S].postProcessChannel===f&&this._textureCache[S].texture._generateDepthBuffer===g.generateDepthBuffer&&this._textureCache[S].texture.samples===g.samples)return this._textureCache[S].texture;const p=this._engine.createRenderTargetTexture(y,g);return this._textureCache.push({texture:p,postProcessChannel:f,lastUsedRenderId:-1}),p}_flushTextureCache(){const y=this._renderId;for(let g=this._textureCache.length-1;g>=0;g--)if(y-this._textureCache[g].lastUsedRenderId>100){let y=!1;for(let f=0;f<this._textures.length;f++)if(this._textures.data[f]===this._textureCache[g].texture){y=!0;break}y||(this._textureCache[g].texture.dispose(),this._textureCache.splice(g,1))}}resize(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=y,this.height=g;let k=null;if(f)for(let U=0;U<f._postProcesses.length;U++)if(null!==f._postProcesses[U]){k=f._postProcesses[U];break}const i={width:this.width,height:this.height},H={generateMipMaps:p,generateDepthBuffer:S||k===this,generateStencilBuffer:(S||k===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(i,H,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(i,H,1)),this._texelSize.ne(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let y;if(this._shareOutputWithPostProcess)y=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)y=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let g;y=this.inputTexture;for(let f=0;f<this._textureCache.length;f++)if(this._textureCache[f].texture===y){g=this._textureCache[f];break}g&&(g.lastUsedRenderId=this._renderId)}return y}activate(y){var g,f;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;const k=(y=y||this._camera).va(),i=k.getEngine(),H=i.getCaps().maxTextureSize,U=(p?p.width:this._engine.getRenderWidth(!0))*this._options|0,l=(p?p.height:this._engine.getRenderHeight(!0))*this._options|0;let c=this._options.width||U,Z=this._options.height||l;const q=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let W=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const y=i.currentViewport;y&&(c*=y.width,Z*=y.height)}(q||this.alwaysForcePOT)&&(this._options.width||(c=i.needPOTTextures?(0,C.i)(c,H,this.scaleMode):c),this._options.height||(Z=i.needPOTTextures?(0,C.i)(Z,H,this.scaleMode):Z)),this.width===c&&this.height===Z&&(W=this._getTarget())||this.resize(c,Z,y,q,S),this._textures.forEach((y=>{y.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(y,this.samples)})),this._flushTextureCache(),this._renderId++}return W||(W=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.ne(U/c,l/Z),this._engine.bindFramebuffer(W,0,U,l,this.forceFullscreenViewport)):(this._scaleRatio.ne(1,1),this._engine.bindFramebuffer(W,0,void 0,void 0,this.forceFullscreenViewport)),null===(g=(f=this._engine)._debugInsertMarker)||void 0===g||g.call(f,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(y),this.Xi&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:k.clearColor,k._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),W}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let y;var g;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),y=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(g=y)||void 0===g?void 0:g.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let y=this._textureCache.length-1;y>=0;y--)this._textureCache[y].texture.dispose();this._textureCache.length=0}setPrePassRenderer(y){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=y.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(y){let g;if(y=y||this._camera,this._disposeTextures(),this._scene&&(g=this._scene.postProcesses.indexOf(this),-1!==g&&this._scene.postProcesses.splice(g,1)),this._parentContainer){const y=this._parentContainer.postProcesses.indexOf(this);y>-1&&this._parentContainer.postProcesses.splice(y,1),this._parentContainer=null}if(g=this._engine.postProcesses.indexOf(this),-1!==g&&this._engine.postProcesses.splice(g,1),y){if(y.detachPostProcess(this),g=y._postProcesses.indexOf(this),0===g&&y._postProcesses.length>0){const y=this._camera._getFirstPostProcess();y&&y.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const y=l.c.Serialize(this),g=this.getCamera()||this._scene&&this._scene.activeCamera;return y.customType="BABYLON."+this.getClassName(),y.cameraId=g?g.id:null,y.reusable=this._reusable,y.textureType=this._textureType,y.fragmentUrl=this._fragmentUrl,y.parameters=this._parameters,y.samplers=this._samplers,y.uniformBuffers=this._uniformBuffers,y.options=this._options,y.defines=this._postProcessDefines,y.textureFormat=this._textureFormat,y.vertexUrl=this._vertexUrl,y.indexParameters=this._indexParameters,y}clone(){const y=this.serialize();y._engine=this._engine,y.cameraId=null;const g=W.Parse(y,this._scene,"");return g?(g.onActivateObservable=this.onActivateObservable.clone(),g.onSizeChangedObservable=this.onSizeChangedObservable.clone(),g.onApplyObservable=this.onApplyObservable.clone(),g.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),g.onAfterRenderObservable=this.onAfterRenderObservable.clone(),g._prePassEffectConfiguration=this._prePassEffectConfiguration,g):null}static Parse(y,g,f){const p=(0,c.b)(y.customType);if(!p||!p._Parse)return null;const S=g?g.getCameraById(y.cameraId):null;return p._Parse(y,S,g,f)}static _Parse(y,g,f,p){return l.c.Parse((()=>new W(y.name,y.fragmentUrl,y.parameters,y.samplers,y.options,g,y.renderTargetSamplingMode,y._engine,y.reusable,y.defines,y.textureType,y.vertexUrl,y.indexParameters,!1,y.textureFormat)),y,f,p)}}(0,p.c)([(0,U.I)()],W.prototype,"uniqueId",void 0),(0,p.c)([(0,U.I)()],W.prototype,"name",null),(0,p.c)([(0,U.I)()],W.prototype,"width",void 0),(0,p.c)([(0,U.I)()],W.prototype,"height",void 0),(0,p.c)([(0,U.I)()],W.prototype,"renderTargetSamplingMode",void 0),(0,p.c)([(0,U.o)()],W.prototype,"clearColor",void 0),(0,p.c)([(0,U.I)()],W.prototype,"Xi",void 0),(0,p.c)([(0,U.I)()],W.prototype,"forceAutoClearInAlphaMode",void 0),(0,p.c)([(0,U.I)()],W.prototype,"alphaMode",null),(0,p.c)([(0,U.I)()],W.prototype,"alphaConstants",void 0),(0,p.c)([(0,U.I)()],W.prototype,"enablePixelPerfectMode",void 0),(0,p.c)([(0,U.I)()],W.prototype,"forceFullscreenViewport",void 0),(0,p.c)([(0,U.I)()],W.prototype,"scaleMode",void 0),(0,p.c)([(0,U.I)()],W.prototype,"alwaysForcePOT",void 0),(0,p.c)([(0,U.I)("samples")],W.prototype,"_samples",void 0),(0,p.c)([(0,U.I)()],W.prototype,"adaptScaleToCurrentViewport",void 0),(0,c.c)("BABYLON.PostProcess",W)},11138:(y,g,f)=>{"use strict";f.d(g,{c:()=>k});var p=f(11131),S=f(10723);class k{constructor(y){this._vertexBuffers={},this.onBeforeRenderObservable=new S.d,this._scene=y}_prepareBuffers(){if(this._vertexBuffers[p.c.PositionKind])return;const y=[];y.push(1,1),y.push(-1,1),y.push(-1,-1),y.push(1,-1),this._vertexBuffers[p.c.PositionKind]=new p.c(this._scene.getEngine(),y,p.c.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const y=[];y.push(0),y.push(1),y.push(2),y.push(0),y.push(2),y.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(y)}_rebuild(){const y=this._vertexBuffers[p.c.PositionKind];y&&(y._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=this._scene.activeCamera;return!!f&&(g=g||f._postProcesses.filter((y=>null!=y)),!(!g||0===g.length||!this._scene.postProcessesEnabled)&&(g[0].activate(f,y,null!==g&&void 0!==g),!0))}directRender(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=this._scene.getEngine();for(let U=0;U<y.length;U++){var H;if(U<y.length-1)y[U+1].activate(this._scene.activeCamera,null===g||void 0===g?void 0:g.texture);else g?i.bindFramebuffer(g,p,void 0,void 0,f,S):k||i.restoreDefaultFramebuffer(),null===(H=i._debugInsertMarker)||void 0===H||H.call(i,`post process ${y[U].name} output`);const l=y[U],c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,c),i.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(c))}i.setDepthBuffer(!0),i.setDepthWrite(!0)}_finalizeFrame(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const k=this._scene.activeCamera;if(!k)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(p=p||k._postProcesses.filter((y=>null!=y))).length||!this._scene.postProcessesEnabled)return;const i=this._scene.getEngine();for(let U=0,l=p.length;U<l;U++){const c=p[U];var H;if(U<l-1)c._outputTexture=p[U+1].activate(k,null===g||void 0===g?void 0:g.texture);else g?(i.bindFramebuffer(g,f,void 0,void 0,S),c._outputTexture=g):(i.restoreDefaultFramebuffer(),c._outputTexture=null),null===(H=i._debugInsertMarker)||void 0===H||H.call(i,`post process ${p[U].name} output`);if(y)break;const Z=c.apply();Z&&(c.onBeforeRenderObservable.notifyObservers(Z),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,Z),i.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(Z))}i.setDepthBuffer(!0),i.setDepthWrite(!0),i.setAlphaMode(0)}dispose(){const y=this._vertexBuffers[p.c.PositionKind];y&&(y.dispose(),this._vertexBuffers[p.c.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11145:(y,g,f)=>{"use strict";f.d(g,{d:()=>H});var p=f(11036),S=f(11054);class k{set opaqueSortCompareFn(y){this._opaqueSortCompareFn=y||k.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(y){this._alphaTestSortCompareFn=y||k.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(y){this._transparentSortCompareFn=y||k.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=y,this._opaqueSubMeshes=new p.i(256),this._transparentSubMeshes=new p.i(256),this._alphaTestSubMeshes=new p.i(256),this._depthOnlySubMeshes=new p.i(256),this._particleSystems=new p.i(256),this._spriteManagers=new p.i(256),this._empty=!0,this._edgesRenderers=new p.e(16),this._scene=g,this.opaqueSortCompareFn=f,this.alphaTestSortCompareFn=S,this.transparentSortCompareFn=k}render(y,g,f,p){if(y)return void y(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const S=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(S.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),S.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const k=S.getStencilBuffer();if(S.setStencilBuffer(!1),g&&this._renderSprites(),f&&this._renderParticles(p),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(S.setStencilBuffer(k),this._scene.useOrderIndependentTransparency){const y=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);y.length&&this._renderTransparent(y)}else this._renderTransparent(this._transparentSubMeshes);S.setAlphaMode(0)}if(S.setStencilBuffer(!1),this._edgesRenderers.length){for(let y=0;y<this._edgesRenderers.length;y++)this._edgesRenderers.data[y].render();S.setAlphaMode(0)}S.setStencilBuffer(k)}_renderOpaqueSorted(y){k._RenderSorted(y,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(y){k._RenderSorted(y,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(y){k._RenderSorted(y,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(y,g,f,p){let i,H=0;const U=f?f.globalPosition:k._ZeroVector;if(p)for(;H<y.length;H++)i=y.data[H],i._alphaIndex=i.getMesh().alphaIndex,i._distanceToCamera=S.m.Distance(i.getBoundingInfo().boundingSphere.centerWorld,U);const l=y.length===y.data.length?y.data:y.data.slice(0,y.length);g&&l.sort(g);const c=l[0].getMesh().va();for(H=0;H<l.length;H++)if(i=l[H],!c._activeMeshesFrozenButKeepClipping||i.isInFrustum(c._frustumPlanes)){if(p){const y=i.Ha();if(y&&y.needDepthPrePass){const g=y.va().getEngine();g.setColorWrite(!1),g.setAlphaMode(0),i.render(!1),g.setColorWrite(!0)}}i.render(p)}}static defaultTransparentSortCompare(y,g){return y._alphaIndex>g._alphaIndex?1:y._alphaIndex<g._alphaIndex?-1:k.backToFrontSortCompare(y,g)}static backToFrontSortCompare(y,g){return y._distanceToCamera<g._distanceToCamera?1:y._distanceToCamera>g._distanceToCamera?-1:0}static frontToBackSortCompare(y,g){return y._distanceToCamera<g._distanceToCamera?-1:y._distanceToCamera>g._distanceToCamera?1:0}static PainterSortCompare(y,g){const f=y.getMesh(),p=g.getMesh();return f.material&&p.material?f.material.uniqueId-p.material.uniqueId:f.uniqueId-p.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(y,g,f){void 0===g&&(g=y.getMesh()),void 0===f&&(f=y.Ha()),null!==f&&void 0!==f&&(f.needAlphaBlendingForMesh(g)?this._transparentSubMeshes.push(y):f.needAlphaTesting()?(f.needDepthPrePass&&this._depthOnlySubMeshes.push(y),this._alphaTestSubMeshes.push(y)):(f.needDepthPrePass&&this._depthOnlySubMeshes.push(y),this._opaqueSubMeshes.push(y)),g._renderingGroup=this,g._edgesRenderer&&g.isEnabled()&&g.isVisible&&g._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(g._edgesRenderer),this._empty=!1)}dispatchSprites(y){this._spriteManagers.push(y),this._empty=!1}dispatchParticles(y){this._particleSystems.push(y),this._empty=!1}_renderParticles(y){if(0===this._particleSystems.length)return;const g=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let f=0;f<this._particleSystems.length;f++){const p=this._particleSystems.data[f];if(0===(g&&g.layerMask&p.layerMask))continue;const S=p.j;S.position&&y&&-1===y.indexOf(S)||this._scene._activeParticles.addCount(p.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const y=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let g=0;g<this._spriteManagers.length;g++){const f=this._spriteManagers.data[g];0!==(y&&y.layerMask&f.layerMask)&&f.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}k._ZeroVector=S.m.Zero();class i{}class H{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(y){y!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=y,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const y of this._scene.meshes)if(y.og)for(const g of y.og)g._wasDispatched=!1;if(this._scene.spriteManagers)for(const y of this._scene.spriteManagers)y._wasDispatched=!1;for(const y of this._scene.uj)y._wasDispatched=!1}constructor(y){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new i,this._maintainStateBetweenFrames=!1,this._scene=y;for(let g=H.MIN_RENDERINGGROUPS;g<H.MAX_RENDERINGGROUPS;g++)this._autoClearDepthStencil[g]={Xi:!0,depth:!0,stencil:!0}}getRenderingGroup(y){const g=y||0;return this._prepareRenderingGroup(g),this._renderingGroups[g]}_clearDepthStencilBuffer(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,y,g),this._depthStencilBufferAlreadyCleaned=!0)}render(y,g,f,p){const S=this._renderingGroupInfo;if(S.Oc=this._scene,S.camera=this._scene.activeCamera,this._scene.spriteManagers&&p)for(let k=0;k<this._scene.spriteManagers.length;k++){const y=this._scene.spriteManagers[k];this.dispatchSprites(y)}for(let k=H.MIN_RENDERINGGROUPS;k<H.MAX_RENDERINGGROUPS;k++){this._depthStencilBufferAlreadyCleaned=k===H.MIN_RENDERINGGROUPS;const i=this._renderingGroups[k];if(!i||i._empty)continue;const U=1<<k;if(S.renderingGroupId=k,this._scene.onBeforeRenderingGroupObservable.notifyObservers(S,U),H.AUTOCLEAR){const y=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(k):this._autoClearDepthStencil[k];y&&y.Xi&&this._clearDepthStencilBuffer(y.depth,y.stencil)}for(const y of this._scene._beforeRenderingGroupDrawStage)y.action(k);i.render(y,p,f,g);for(const y of this._scene._afterRenderingGroupDrawStage)y.action(k);this._scene.onAfterRenderingGroupObservable.notifyObservers(S,U)}}reset(){if(!this.maintainStateBetweenFrames)for(let y=H.MIN_RENDERINGGROUPS;y<H.MAX_RENDERINGGROUPS;y++){const g=this._renderingGroups[y];g&&g.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let y=H.MIN_RENDERINGGROUPS;y<H.MAX_RENDERINGGROUPS;y++){const g=this._renderingGroups[y];g&&g.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let y=H.MIN_RENDERINGGROUPS;y<H.MAX_RENDERINGGROUPS;y++){const g=this._renderingGroups[y];g&&g.dispose()}}_prepareRenderingGroup(y){void 0===this._renderingGroups[y]&&(this._renderingGroups[y]=new k(y,this._scene,this._customOpaqueSortCompareFn[y],this._customAlphaTestSortCompareFn[y],this._customTransparentSortCompareFn[y]))}dispatchSprites(y){this.maintainStateBetweenFrames&&y._wasDispatched||(y._wasDispatched=!0,this.getRenderingGroup(y.renderingGroupId).dispatchSprites(y))}dispatchParticles(y){this.maintainStateBetweenFrames&&y._wasDispatched||(y._wasDispatched=!0,this.getRenderingGroup(y.renderingGroupId).dispatchParticles(y))}dispatch(y,g,f){void 0===g&&(g=y.getMesh()),this.maintainStateBetweenFrames&&y._wasDispatched||(y._wasDispatched=!0,this.getRenderingGroup(g.renderingGroupId).dispatch(y,g,f))}setRenderingOrder(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[y]=g,this._customAlphaTestSortCompareFn[y]=f,this._customTransparentSortCompareFn[y]=p,this._renderingGroups[y]){const g=this._renderingGroups[y];g.opaqueSortCompareFn=this._customOpaqueSortCompareFn[y],g.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[y],g.transparentSortCompareFn=this._customTransparentSortCompareFn[y]}}setRenderingAutoClearDepthStencil(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[y]={Xi:g,depth:f,stencil:p}}getAutoClearDepthStencilSetup(y){return this._autoClearDepthStencil[y]}}H.MAX_RENDERINGGROUPS=4,H.MIN_RENDERINGGROUPS=0,H.AUTOCLEAR=!0},11788:(y,g,f)=>{"use strict";const p="clipPlaneFragment",S="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11751:(y,g,f)=>{"use strict";const p="clipPlaneFragmentDeclaration",S="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11828:(y,g,f)=>{"use strict";const p="clipPlaneVertex",S="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11811:(y,g,f)=>{"use strict";const p="clipPlaneVertexDeclaration",S="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11799:(y,g,f)=>{"use strict";const p="fogFragment",S="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11782:(y,g,f)=>{"use strict";const p="fogFragmentDeclaration",S="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11836:(y,g,f)=>{"use strict";const p="fogVertex",S="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11819:(y,g,f)=>{"use strict";const p="fogVertexDeclaration",S="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11768:(y,g,f)=>{"use strict";const p="helperFunctions",S="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11754:(y,g,f)=>{"use strict";const p="imageProcessingDeclaration",S="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11776:(y,g,f)=>{"use strict";const p="imageProcessingFunctions",S="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";f(10812).e.IncludesShadersStoreWGSL[p]=S},11759:(y,g,f)=>{"use strict";const p="logDepthDeclaration",S="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11794:(y,g,f)=>{"use strict";const p="logDepthFragment",S="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11838:(y,g,f)=>{"use strict";const p="logDepthVertex",S="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";f(10812).e.IncludesShadersStoreWGSL[p]=S},11744:(y,g,f)=>{"use strict";f.r(g),f.d(g,{particlesPixelShaderWGSL:()=>i});var p=f(10812);f(11751),f(11754),f(11759),f(11768),f(11776),f(11782),f(11788),f(11794),f(11799);const S="particlesPixelShader",k="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";p.e.ShadersStoreWGSL[S]=k;const i={name:S,shader:k}},11802:(y,g,f)=>{"use strict";f.r(g),f.d(g,{particlesVertexShaderWGSL:()=>i});var p=f(10812);f(11811),f(11819),f(11759),f(11828),f(11836),f(11838);const S="particlesVertexShader",k="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";p.e.ShadersStoreWGSL[S]=k;const i={name:S,shader:k}},11661:(y,g,f)=>{"use strict";const p="clipPlaneFragment",S="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11723:(y,g,f)=>{"use strict";const p="clipPlaneFragmentDeclaration",S="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11678:(y,g,f)=>{"use strict";const p="clipPlaneVertex",S="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11736:(y,g,f)=>{"use strict";const p="clipPlaneVertexDeclaration",S="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11670:(y,g,f)=>{"use strict";const p="fogFragment",S="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11653:(y,g,f)=>{"use strict";const p="fogFragmentDeclaration",S="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11687:(y,g,f)=>{"use strict";const p="fogVertex",S="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11676:(y,g,f)=>{"use strict";const p="fogVertexDeclaration",S="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11639:(y,g,f)=>{"use strict";const p="helperFunctions",S="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";f(10812).e.IncludesShadersStore[p]=S},11621:(y,g,f)=>{"use strict";const p="imageProcessingDeclaration",S="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11644:(y,g,f)=>{"use strict";const p="imageProcessingFunctions",S="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";f(10812).e.IncludesShadersStore[p]=S},11630:(y,g,f)=>{"use strict";const p="logDepthDeclaration",S="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11668:(y,g,f)=>{"use strict";const p="logDepthFragment",S="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11689:(y,g,f)=>{"use strict";const p="logDepthVertex",S="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";f(10812).e.IncludesShadersStore[p]=S},11718:(y,g,f)=>{"use strict";f.r(g),f.d(g,{particlesPixelShader:()=>i});var p=f(10812);f(11723),f(11621),f(11630),f(11639),f(11644),f(11653),f(11661),f(11668),f(11670);const S="particlesPixelShader",k="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";p.e.ShadersStore[S]=k;const i={name:S,shader:k}},11728:(y,g,f)=>{"use strict";f.r(g),f.d(g,{particlesVertexShader:()=>i});var p=f(10812);f(11736),f(11676),f(11630),f(11678),f(11687),f(11689);const S="particlesVertexShader",k="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";p.e.ShadersStore[S]=k;const i={name:S,shader:k}},11601:(y,g,f)=>{"use strict";f.r(g),f.d(g,{postprocessVertexShader:()=>k});const p="postprocessVertexShader",S="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";f(10812).e.ShadersStore[p]=S;const k={name:p,shader:S}},11174:(y,g,f)=>{"use strict";f.d(g,{b:()=>p});class p{}p._IsPickingAvailable=!1},11336:(y,g,f)=>{"use strict";f.d(g,{d:()=>Z});var p=f(11021),S=f(11054),k=f(11026),i=f(10723),H=f(10761),U=f(10755),l=f(11099);class c{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new i.d,this._onClonedObservable=new i.d}}class Z{static AddNodeConstructor(y,g){this._NodeConstructors[y]=g}static Construct(y,g,f,p){const S=this._NodeConstructors[y];return S?S(g,f,p):null}set accessibilityTag(y){this._accessibilityTag=y,this.onAccessibilityTagChangedObservable.notifyObservers(y)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(y){this._nodeDataStorage._doNotSerialize=y}u(){return this._nodeDataStorage._isDisposed}set parent(y){if(this._parentNode===y)return;const g=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const g=this._parentNode._children.indexOf(this);-1!==g&&this._parentNode._children.splice(g,1),y||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=y,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),g||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(y){y.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const y=this._scene.rootNodes,g=y.length-1;y[this._nodeDataStorage._sceneRootNodesIndex]=y[g],y[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}getClassName(){return"Node"}set onDispose(y){this._onDisposeObserver&&this.nj.remove(this._onDisposeObserver),this._onDisposeObserver=this.nj.add(y)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new c,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new i.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=S.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.nj=new i.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=y,this.id=y,this._scene=g||H.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),f&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(y)||(y.init(),this._scene.isLoading&&!g?this._scene.onDataLoadedObservable.addOnce((()=>{y.attach(this)})):y.attach(this),this._behaviors.push(y)),this}removeBehavior(y){const g=this._behaviors.indexOf(y);return-1===g||(this._behaviors[g].detach(),this._behaviors.splice(g,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(y){for(const g of this._behaviors)if(g.name===y)return g;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Sj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(y){!y&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(y){return this.parent?this.parent._getActionManagerForTrigger(y,!1):null}_updateCache(y){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Vg(y){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((y=>{y._syncParentEnabledState()}))}Mb(y){this._nodeDataStorage._isEnabled!==y&&(this._nodeDataStorage._isEnabled=y,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(y))}isDescendantOf(y){return!!this.parent&&(this.parent===y||this.parent.isDescendantOf(y))}_getDescendants(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0;if(this._children)for(let p=0;p<this._children.length;p++){const S=this._children[p];f&&!f(S)||y.push(S),g||S._getDescendants(y,!1,f)}}getDescendants(y,g){const f=[];return this._getDescendants(f,y,g),f}getChildMeshes(y,g){const f=[];return this._getDescendants(f,y,(y=>(!g||g(y))&&void 0!==y.Hi)),f}getChildren(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(g,y)}_setReady(y){y!==this._nodeDataStorage._isReady&&(y?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(y){for(let g=0;g<this.animations.length;g++){const f=this.animations[g];if(f.name===y)return f}return null}createAnimationRange(y,g,f){if(!this._ranges[y]){this._ranges[y]=Z._AnimationRangeFactory(y,g,f);for(let p=0,S=this.animations.length;p<S;p++)this.animations[p]&&this.animations[p].createRange(y,g,f)}}deleteAnimationRange(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let f=0,p=this.animations.length;f<p;f++)this.animations[f]&&this.animations[f].deleteRange(y,g);this._ranges[y]=null}getAnimationRange(y){return this._ranges[y]||null}clone(y,g,f){const p=l.c.Clone((()=>new Z(y,this.va())),this);if(g&&(p.parent=g),!f){const g=this.getDescendants(!0);for(let f=0;f<g.length;f++){const S=g[f];S.clone(y+"."+S.name,p)}}return p}getAnimationRanges(){const y=[];let g;for(g in this._ranges)y.push(this._ranges[g]);return y}beginAnimation(y,g,f,p){const S=this.getAnimationRange(y);return S?this._scene.beginAnimation(this,S.from,S.to,g,f,p):null}serializeAnimationRanges(){const y=[];for(const g in this._ranges){const f=this._ranges[g];if(!f)continue;const p={};p.name=g,p.from=f.from,p.to=f.to,y.push(p)}return y}Sj(y){return this._worldMatrix||(this._worldMatrix=S.c.Identity()),this._worldMatrix}dispose(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!y){const f=this.getDescendants(!0);for(const p of f)p.dispose(y,g)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.nj.notifyObservers(this),this.nj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const f of this._behaviors)f.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(y,g,f){if(g.ranges)for(let p=0;p<g.ranges.length;p++){const f=g.ranges[p];y.createAnimationRange(f.name,f.from,f.to)}}getHierarchyBoundingVectors(){let y,g,f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Sj(!0);const k=this;if(k.getBoundingInfo&&k.og){const f=k.getBoundingInfo();y=f.boundingBox.minimumWorld.clone(),g=f.boundingBox.maximumWorld.clone()}else y=new S.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),g=new S.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(f){const f=this.getDescendants(!1);for(const k of f){const f=k;if(f.Sj(!0),p&&!p(f))continue;if(!f.getBoundingInfo||0===f.getTotalVertices())continue;const i=f.getBoundingInfo().boundingBox,H=i.minimumWorld,U=i.maximumWorld;S.m.CheckExtends(H,y,g),S.m.CheckExtends(U,y,g)}}return{min:y,max:g}}}Z._AnimationRangeFactory=(y,g,f)=>{throw(0,U.b)("AnimationRange")},Z._NodeConstructors={},(0,p.c)([(0,k.I)()],Z.prototype,"name",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"id",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"uniqueId",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"state",void 0),(0,p.c)([(0,k.I)()],Z.prototype,"metadata",void 0)},11038:(y,g,f)=>{"use strict";f.d(g,{e:()=>yy});var p=f(10714),S=f(10747),k=f(10723),i=f(11036);class H{constructor(){this._count=0,this._data={}}p(y){this.clear(),y.forEach(((y,g)=>this.add(y,g)))}get(y){const g=this._data[y];if(void 0!==g)return g}getOrAddWithFactory(y,g){let f=this.get(y);return void 0!==f||(f=g(y),f&&this.add(y,f)),f}getOrAdd(y,g){const f=this.get(y);return void 0!==f?f:(this.add(y,g),g)}contains(y){return void 0!==this._data[y]}add(y,g){return void 0===this._data[y]&&(this._data[y]=g,++this._count,!0)}set(y,g){return void 0!==this._data[y]&&(this._data[y]=g,!0)}getAndRemove(y){const g=this.get(y);return void 0!==g?(delete this._data[y],--this._count,g):null}remove(y){return!!this.contains(y)&&(delete this._data[y],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(y){for(const g in this._data){y(g,this._data[g])}}first(y){for(const g in this._data){const f=y(g,this._data[g]);if(f)return f}return null}}var U=f(11046),l=f(11054),c=f(11087),Z=f(11117),C=f(11122);class q{constructor(y,g,f,p,S,k){this.source=y,this.pointerX=g,this.pointerY=f,this.meshUnderPointer=p,this.sourceEvent=S,this.additionalData=k}static CreateNew(y,g,f){const p=y.va();return new q(y,p.pointerX,p.pointerY,p.meshUnderPointer||y,g,f)}static CreateNewFromSprite(y,g,f,p){return new q(y,g.pointerX,g.pointerY,g.meshUnderPointer,f,p)}static CreateNewFromScene(y,g){return new q(null,y.pointerX,y.pointerY,y.meshUnderPointer,g)}static CreateNewFromPrimitive(y,g,f,p){return new q(y,g.x,g.y,null,f,p)}}var W=f(11138),j=f(11145),P=f(11149),B=f(10730),R=f(10761),G=f(10755),z=f(11156);class T{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const y in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,y))return!0;return!1}static get HasPickTriggers(){for(const y in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,y)){const g=parseInt(y);if(g>=1&&g<=7)return!0}return!1}static HasSpecificTrigger(y){for(const g in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,g)){if(parseInt(g)===y)return!0}return!1}}T.Triggers={};var Q,m,a,w,o,I,Y,n=f(11161);!function(y){y[y.Generic=0]="Generic",y[y.Keyboard=1]="Keyboard",y[y.Mouse=2]="Mouse",y[y.Touch=3]="Touch",y[y.DualShock=4]="DualShock",y[y.Xbox=5]="Xbox",y[y.Switch=6]="Switch",y[y.DualSense=7]="DualSense"}(Q||(Q={})),function(y){y[y.Horizontal=0]="Horizontal",y[y.Vertical=1]="Vertical",y[y.LeftClick=2]="LeftClick",y[y.MiddleClick=3]="MiddleClick",y[y.RightClick=4]="RightClick",y[y.BrowserBack=5]="BrowserBack",y[y.BrowserForward=6]="BrowserForward",y[y.MouseWheelX=7]="MouseWheelX",y[y.MouseWheelY=8]="MouseWheelY",y[y.MouseWheelZ=9]="MouseWheelZ",y[y.Move=12]="Move"}(m||(m={})),function(y){y[y.Horizontal=0]="Horizontal",y[y.Vertical=1]="Vertical",y[y.LeftClick=2]="LeftClick",y[y.MiddleClick=3]="MiddleClick",y[y.RightClick=4]="RightClick",y[y.BrowserBack=5]="BrowserBack",y[y.BrowserForward=6]="BrowserForward",y[y.MouseWheelX=7]="MouseWheelX",y[y.MouseWheelY=8]="MouseWheelY",y[y.MouseWheelZ=9]="MouseWheelZ",y[y.DeltaHorizontal=10]="DeltaHorizontal",y[y.DeltaVertical=11]="DeltaVertical"}(a||(a={})),function(y){y[y.Cross=0]="Cross",y[y.Circle=1]="Circle",y[y.Square=2]="Square",y[y.Triangle=3]="Triangle",y[y.L1=4]="L1",y[y.R1=5]="R1",y[y.L2=6]="L2",y[y.R2=7]="R2",y[y.Share=8]="Share",y[y.Options=9]="Options",y[y.L3=10]="L3",y[y.R3=11]="R3",y[y.DPadUp=12]="DPadUp",y[y.DPadDown=13]="DPadDown",y[y.DPadLeft=14]="DPadLeft",y[y.DPadRight=15]="DPadRight",y[y.Home=16]="Home",y[y.TouchPad=17]="TouchPad",y[y.LStickXAxis=18]="LStickXAxis",y[y.LStickYAxis=19]="LStickYAxis",y[y.RStickXAxis=20]="RStickXAxis",y[y.RStickYAxis=21]="RStickYAxis"}(w||(w={})),function(y){y[y.Cross=0]="Cross",y[y.Circle=1]="Circle",y[y.Square=2]="Square",y[y.Triangle=3]="Triangle",y[y.L1=4]="L1",y[y.R1=5]="R1",y[y.L2=6]="L2",y[y.R2=7]="R2",y[y.Create=8]="Create",y[y.Options=9]="Options",y[y.L3=10]="L3",y[y.R3=11]="R3",y[y.DPadUp=12]="DPadUp",y[y.DPadDown=13]="DPadDown",y[y.DPadLeft=14]="DPadLeft",y[y.DPadRight=15]="DPadRight",y[y.Home=16]="Home",y[y.TouchPad=17]="TouchPad",y[y.LStickXAxis=18]="LStickXAxis",y[y.LStickYAxis=19]="LStickYAxis",y[y.RStickXAxis=20]="RStickXAxis",y[y.RStickYAxis=21]="RStickYAxis"}(o||(o={})),function(y){y[y.A=0]="A",y[y.B=1]="B",y[y.X=2]="X",y[y.Y=3]="Y",y[y.LB=4]="LB",y[y.RB=5]="RB",y[y.LT=6]="LT",y[y.RT=7]="RT",y[y.Back=8]="Back",y[y.Start=9]="Start",y[y.LS=10]="LS",y[y.RS=11]="RS",y[y.DPadUp=12]="DPadUp",y[y.DPadDown=13]="DPadDown",y[y.DPadLeft=14]="DPadLeft",y[y.DPadRight=15]="DPadRight",y[y.Home=16]="Home",y[y.LStickXAxis=17]="LStickXAxis",y[y.LStickYAxis=18]="LStickYAxis",y[y.RStickXAxis=19]="RStickXAxis",y[y.RStickYAxis=20]="RStickYAxis"}(I||(I={})),function(y){y[y.B=0]="B",y[y.A=1]="A",y[y.Y=2]="Y",y[y.X=3]="X",y[y.L=4]="L",y[y.R=5]="R",y[y.ZL=6]="ZL",y[y.ZR=7]="ZR",y[y.Minus=8]="Minus",y[y.Plus=9]="Plus",y[y.LS=10]="LS",y[y.RS=11]="RS",y[y.DPadUp=12]="DPadUp",y[y.DPadDown=13]="DPadDown",y[y.DPadLeft=14]="DPadLeft",y[y.DPadRight=15]="DPadRight",y[y.Home=16]="Home",y[y.Capture=17]="Capture",y[y.LStickXAxis=18]="LStickXAxis",y[y.LStickYAxis=19]="LStickYAxis",y[y.RStickXAxis=20]="RStickXAxis",y[y.RStickYAxis=21]="RStickYAxis"}(Y||(Y={}));var M=f(11165);class r{static CreateDeviceEvent(y,g,f,p,S,k,i){switch(y){case Q.Keyboard:return this._CreateKeyboardEvent(f,p,S,k);case Q.Mouse:if(f===m.MouseWheelX||f===m.MouseWheelY||f===m.MouseWheelZ)return this._CreateWheelEvent(y,g,f,p,S,k);case Q.Touch:return this._CreatePointerEvent(y,g,f,p,S,k,i);default:throw`Unable to generate event for device ${Q[y]}`}}static _CreatePointerEvent(y,g,f,p,S,k,i){const H=this._CreateMouseEvent(y,g,f,p,S,k);y===Q.Mouse?(H.deviceType=Q.Mouse,H.pointerId=1,H.pointerType="mouse"):(H.deviceType=Q.Touch,H.pointerId=i??g,H.pointerType="touch");let U=0;return U+=S.pollInput(y,g,m.LeftClick),U+=2*S.pollInput(y,g,m.RightClick),U+=4*S.pollInput(y,g,m.MiddleClick),H.buttons=U,f===m.Move?H.type="pointermove":f>=m.LeftClick&&f<=m.RightClick&&(H.type=1===p?"pointerdown":"pointerup",H.button=f-2),H}static _CreateWheelEvent(y,g,f,p,S,k){const i=this._CreateMouseEvent(y,g,f,p,S,k);switch(i.pointerId=1,i.type="wheel",i.deltaMode=M.e.DOM_DELTA_PIXEL,i.deltaX=0,i.deltaY=0,i.deltaZ=0,f){case m.MouseWheelX:i.deltaX=p;break;case m.MouseWheelY:i.deltaY=p;break;case m.MouseWheelZ:i.deltaZ=p}return i}static _CreateMouseEvent(y,g,f,p,S,k){const i=this._CreateEvent(k),H=S.pollInput(y,g,m.Horizontal),U=S.pollInput(y,g,m.Vertical);return k?(i.movementX=0,i.movementY=0,i.offsetX=i.movementX-k.getBoundingClientRect().x,i.offsetY=i.movementY-k.getBoundingClientRect().y):(i.movementX=S.pollInput(y,g,10),i.movementY=S.pollInput(y,g,11),i.offsetX=0,i.offsetY=0),this._CheckNonCharacterKeys(i,S),i.clientX=H,i.clientY=U,i.x=H,i.y=U,i.deviceType=y,i.deviceSlot=g,i.inputIndex=f,i}static _CreateKeyboardEvent(y,g,f,p){const S=this._CreateEvent(p);return this._CheckNonCharacterKeys(S,f),S.deviceType=Q.Keyboard,S.deviceSlot=0,S.inputIndex=y,S.type=1===g?"keydown":"keyup",S.key=String.fromCharCode(y),S.keyCode=y,S}static _CheckNonCharacterKeys(y,g){const f=g.isDeviceAvailable(Q.Keyboard),p=f&&1===g.pollInput(Q.Keyboard,0,18),S=f&&1===g.pollInput(Q.Keyboard,0,17),k=f&&(1===g.pollInput(Q.Keyboard,0,91)||1===g.pollInput(Q.Keyboard,0,92)||1===g.pollInput(Q.Keyboard,0,93)),i=f&&1===g.pollInput(Q.Keyboard,0,16);y.altKey=p,y.ctrlKey=S,y.metaKey=k,y.shiftKey=i}static _CreateEvent(y){const g={preventDefault:()=>{}};return g.target=y,g}}class N{constructor(y,g,f){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(y,g,((y,g,p,S)=>{const k=r.CreateDeviceEvent(y,g,p,S,this);f(y,g,k)})):this._createDummyNativeInput()}pollInput(y,g,f){return this._nativeInput.pollInput(y,g,f)}isDeviceAvailable(y){return y===Q.Mouse||y===Q.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const b=Object.keys(m).length/2;class s{constructor(y,g,f,S){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=p.e.IsSafari(),this._usingMacOS=(0,B.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=y=>{},this._keyboardUpEvent=y=>{},this._keyboardBlurEvent=y=>{},this._pointerMoveEvent=y=>{},this._pointerDownEvent=y=>{},this._pointerUpEvent=y=>{},this._pointerCancelEvent=y=>{},this._pointerWheelEvent=y=>{},this._pointerBlurEvent=y=>{},this._pointerMacOSChromeOutEvent=y=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,B.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,B.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=y=>{},this._gamepadDisconnectedEvent=y=>{},this._eventPrefix=p.e.GetPointerPrefix(y),this._engine=y,this._onDeviceConnected=g,this._onDeviceDisconnected=f,this._onInputChanged=S,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(y,g,f){const S=this._inputs[y][g];if(!S)throw`Unable to find device ${Q[y]}`;y>=Q.DualShock&&y<=Q.DualSense&&this._updateDevice(y,g,f);const k=S[f];if(void 0===k)throw`Unable to find input ${f} for device ${Q[y]} in slot ${g}`;return f===m.Move&&p.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),k}isDeviceAvailable(y){return void 0!==this._inputs[y]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const y=null===this||void 0===this?void 0:this._engine.getInputElement();if(y&&(!this._eventsAttached||this._elementToAttachTo!==y)){if(this._disableEvents(),this._inputs)for(const y of this._inputs)if(y)for(const g in y){const f=y[+g];if(f)for(let y=0;y<f.length;y++)f[y]=0}this._elementToAttachTo=y,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const y=navigator.getGamepads();for(const g of y)g&&this._addGamePad(g)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(Q.Mouse,0,0,0)}_addGamePad(y){const g=this._getGamepadDeviceType(y.id),f=y.index;this._gamepads=this._gamepads||new Array(y.index+1),this._registerDevice(g,f,y.buttons.length+y.axes.length),this._gamepads[f]=g}_addPointerDevice(y,g,f,p){this._pointerActive||(this._pointerActive=!0),this._registerDevice(y,g,b);const S=this._inputs[y][g];S[0]=f,S[1]=p}_registerDevice(y,g,f){if(void 0===g)throw`Unable to register device ${Q[y]} to undefined slot.`;if(this._inputs[y]||(this._inputs[y]={}),!this._inputs[y][g]){const p=new Array(f);p.fill(0),this._inputs[y][g]=p,this._onDeviceConnected(y,g)}}_unregisterDevice(y,g){this._inputs[y][g]&&(delete this._inputs[y][g],this._onDeviceDisconnected(y,g))}_handleKeyActions(){this._keyboardDownEvent=y=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(Q.Keyboard,0,255));const g=this._inputs[Q.Keyboard][0];if(g){g[y.keyCode]=1;const f=y;f.inputIndex=y.keyCode,this._usingMacOS&&y.metaKey&&"Meta"!==y.key&&(this._metaKeys.includes(y.keyCode)||this._metaKeys.push(y.keyCode)),this._onInputChanged(Q.Keyboard,0,f)}},this._keyboardUpEvent=y=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(Q.Keyboard,0,255));const g=this._inputs[Q.Keyboard][0];if(g){g[y.keyCode]=0;const f=y;if(f.inputIndex=y.keyCode,this._usingMacOS&&"Meta"===y.key&&this._metaKeys.length>0){for(const y of this._metaKeys){const f=r.CreateDeviceEvent(Q.Keyboard,0,y,0,this,this._elementToAttachTo);g[y]=0,this._onInputChanged(Q.Keyboard,0,f)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(Q.Keyboard,0,f)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const y=this._inputs[Q.Keyboard][0];for(let g=0;g<y.length;g++)if(0!==y[g]){y[g]=0;const f=r.CreateDeviceEvent(Q.Keyboard,0,g,0,this,this._elementToAttachTo);this._onInputChanged(Q.Keyboard,0,f)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,B.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let p=0;p<this._maxTouchPoints;p++)this._activeTouchIds[p]=-1;this._pointerMoveEvent=y=>{const g=this._getPointerType(y);let f=g===Q.Mouse?0:this._activeTouchIds.indexOf(y.pointerId);if(g===Q.Touch&&-1===f){const S=this._activeTouchIds.indexOf(-1);if(!(S>=0))return void p.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);f=S,this._activeTouchIds[S]=y.pointerId,this._onDeviceConnected(g,f)}this._inputs[g]||(this._inputs[g]={}),this._inputs[g][f]||this._addPointerDevice(g,f,y.clientX,y.clientY);const S=this._inputs[g][f];if(S){const p=y;p.inputIndex=m.Move,S[m.Horizontal]=y.clientX,S[m.Vertical]=y.clientY,g===Q.Touch&&0===S[m.LeftClick]&&(S[m.LeftClick]=1),void 0===y.pointerId&&(y.pointerId=this._mouseId),this._onInputChanged(g,f,p),this._usingSafari||-1===y.button||(p.inputIndex=y.button+2,S[y.button+2]=S[y.button+2]?0:1,this._onInputChanged(g,f,p))}},this._pointerDownEvent=y=>{const g=this._getPointerType(y);let f=g===Q.Mouse?0:y.pointerId;if(g===Q.Touch){let g=this._activeTouchIds.indexOf(y.pointerId);if(-1===g&&(g=this._activeTouchIds.indexOf(-1)),!(g>=0))return void p.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);f=g,this._activeTouchIds[g]=y.pointerId}this._inputs[g]||(this._inputs[g]={}),this._inputs[g][f]?g===Q.Touch&&this._onDeviceConnected(g,f):this._addPointerDevice(g,f,y.clientX,y.clientY);const S=this._inputs[g][f];if(S){const p=S[m.Horizontal],i=S[m.Vertical];if(g===Q.Mouse){if(void 0===y.pointerId&&(y.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(k){}}else if(y.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(y.pointerId)}catch(k){}S[m.Horizontal]=y.clientX,S[m.Vertical]=y.clientY,S[y.button+2]=1;const H=y;H.inputIndex=y.button+2,this._onInputChanged(g,f,H),p===y.clientX&&i===y.clientY||(H.inputIndex=m.Move,this._onInputChanged(g,f,H))}},this._pointerUpEvent=y=>{var g;const f=this._getPointerType(y),p=f===Q.Mouse?0:this._activeTouchIds.indexOf(y.pointerId);if(f===Q.Touch){if(-1===p)return;this._activeTouchIds[p]=-1}const S=null===(g=this._inputs[f])||void 0===g?void 0:g[p];if(S&&0!==S[y.button+2]){var k,i,H,U;const g=S[m.Horizontal],l=S[m.Vertical];S[m.Horizontal]=y.clientX,S[m.Vertical]=y.clientY,S[y.button+2]=0;const c=y;void 0===y.pointerId&&(y.pointerId=this._mouseId),g===y.clientX&&l===y.clientY||(c.inputIndex=m.Move,this._onInputChanged(f,p,c)),c.inputIndex=y.button+2,f===Q.Mouse&&this._mouseId>=0&&null!==(k=(i=this._elementToAttachTo).hasPointerCapture)&&void 0!==k&&k.call(i,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):y.pointerId&&null!==(H=(U=this._elementToAttachTo).hasPointerCapture)&&void 0!==H&&H.call(U,y.pointerId)&&this._elementToAttachTo.releasePointerCapture(y.pointerId),this._onInputChanged(f,p,c),f===Q.Touch&&this._onDeviceDisconnected(f,p)}},this._pointerCancelEvent=y=>{if("mouse"===y.pointerType){var g,f;const y=this._inputs[Q.Mouse][0];this._mouseId>=0&&null!==(g=(f=this._elementToAttachTo).hasPointerCapture)&&void 0!==g&&g.call(f,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let g=m.LeftClick;g<=m.BrowserForward;g++)if(1===y[g]){y[g]=0;const f=r.CreateDeviceEvent(Q.Mouse,0,g,0,this,this._elementToAttachTo);this._onInputChanged(Q.Mouse,0,f)}}else{var p,S;const g=this._activeTouchIds.indexOf(y.pointerId);if(-1===g)return;null!==(p=(S=this._elementToAttachTo).hasPointerCapture)&&void 0!==p&&p.call(S,y.pointerId)&&this._elementToAttachTo.releasePointerCapture(y.pointerId),this._inputs[Q.Touch][g][m.LeftClick]=0;const f=r.CreateDeviceEvent(Q.Touch,g,m.LeftClick,0,this,this._elementToAttachTo,y.pointerId);this._onInputChanged(Q.Touch,g,f),this._activeTouchIds[g]=-1,this._onDeviceDisconnected(Q.Touch,g)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let y=!1;const g=function(){};try{const f=Object.defineProperty({},"passive",{get:function(){y=!0}});this._elementToAttachTo.addEventListener("test",g,f),this._elementToAttachTo.removeEventListener("test",g,f)}catch(f){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(Q.Mouse)){var y,g;const f=this._inputs[Q.Mouse][0];this._mouseId>=0&&null!==(y=(g=this._elementToAttachTo).hasPointerCapture)&&void 0!==y&&y.call(g,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let y=m.LeftClick;y<=m.BrowserForward;y++)if(1===f[y]){f[y]=0;const g=r.CreateDeviceEvent(Q.Mouse,0,y,0,this,this._elementToAttachTo);this._onInputChanged(Q.Mouse,0,g)}}if(this.isDeviceAvailable(Q.Touch)){const y=this._inputs[Q.Touch];for(let g=0;g<this._activeTouchIds.length;g++){var f,p,S;const k=this._activeTouchIds[g];if(null!==(f=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==f&&f.call(p,k)&&this._elementToAttachTo.releasePointerCapture(k),-1!==k&&1===(null===(S=y[g])||void 0===S?void 0:S[m.LeftClick])){y[g][m.LeftClick]=0;const f=r.CreateDeviceEvent(Q.Touch,g,m.LeftClick,0,this,this._elementToAttachTo,k);this._onInputChanged(Q.Touch,g,f),this._activeTouchIds[g]=-1,this._onDeviceDisconnected(Q.Touch,g)}}}},this._pointerWheelEvent=y=>{const g=Q.Mouse;this._inputs[g]||(this._inputs[g]=[]),this._inputs[g][0]||(this._pointerActive=!0,this._registerDevice(g,0,b));const f=this._inputs[g][0];if(f){f[m.MouseWheelX]=y.deltaX||0,f[m.MouseWheelY]=y.deltaY||y.wheelDelta||0,f[m.MouseWheelZ]=y.deltaZ||0;const p=y;void 0===y.pointerId&&(y.pointerId=this._mouseId),0!==f[m.MouseWheelX]&&(p.inputIndex=m.MouseWheelX,this._onInputChanged(g,0,p)),0!==f[m.MouseWheelY]&&(p.inputIndex=m.MouseWheelY,this._onInputChanged(g,0,p)),0!==f[m.MouseWheelZ]&&(p.inputIndex=m.MouseWheelZ,this._onInputChanged(g,0,p))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=y=>{y.buttons>1&&this._pointerCancelEvent(y)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!y&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(Q.Mouse)){const y=this._inputs[Q.Mouse][0];y[m.MouseWheelX]=0,y[m.MouseWheelY]=0,y[m.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=y=>{this._addGamePad(y.gamepad)},this._gamepadDisconnectedEvent=y=>{if(this._gamepads){const g=this._getGamepadDeviceType(y.gamepad.id),f=y.gamepad.index;this._unregisterDevice(g,f),delete this._gamepads[f]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(y,g,f){const p=navigator.getGamepads()[g];if(p&&y===this._gamepads[g]){const S=this._inputs[y][g];f>=p.buttons.length?S[f]=p.axes[f-p.buttons.length].valueOf():S[f]=p.buttons[f].value}}_getGamepadDeviceType(y){return-1!==y.indexOf("054c")?-1!==y.indexOf("0ce6")?Q.DualSense:Q.DualShock:-1!==y.indexOf("Xbox One")||-1!==y.search("Xbox 360")||-1!==y.search("xinput")?Q.Xbox:-1!==y.indexOf("057e")?Q.Switch:Q.Generic}_getPointerType(y){let g=Q.Mouse;return("touch"===y.pointerType||"pen"===y.pointerType||y.touches)&&(g=Q.Touch),g}}class u{constructor(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=g,this.deviceSlot=f,this.onInputChangedObservable=new k.d,this._deviceInputSystem=y}getInput(y){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,y)}}class F{constructor(y){this._registeredManagers=new Array,this._refCount=0,this.registerManager=y=>{for(let g=0;g<this._devices.length;g++){const f=this._devices[g];for(const p in f){const f=+p;y._addDevice(new u(this._deviceInputSystem,g,f))}}this._registeredManagers.push(y)},this.unregisterManager=y=>{const g=this._registeredManagers.indexOf(y);g>-1&&this._registeredManagers.splice(g,1)};const g=Object.keys(Q).length/2;this._devices=new Array(g);const f=(y,g)=>{this._devices[y]||(this._devices[y]=new Array),this._devices[y][g]||(this._devices[y][g]=g);for(const f of this._registeredManagers){const p=new u(this._deviceInputSystem,y,g);f._addDevice(p)}},p=(y,g)=>{var f;null!==(f=this._devices[y])&&void 0!==f&&f[g]&&delete this._devices[y][g];for(const p of this._registeredManagers)p._removeDevice(y,g)},S=(y,g,f)=>{if(f)for(const p of this._registeredManagers)p._onInputChanged(y,g,f)};"undefined"!==typeof _native?this._deviceInputSystem=new N(f,p,S):this._deviceInputSystem=new s(y,f,p,S)}dispose(){this._deviceInputSystem.dispose()}}class A{getDeviceSource(y,g){if(void 0===g){if(void 0===this._firstDevice[y])return null;g=this._firstDevice[y]}return this._devices[y]&&void 0!==this._devices[y][g]?this._devices[y][g]:null}getDeviceSources(y){return this._devices[y]?this._devices[y].filter((y=>!!y)):[]}constructor(y){const g=Object.keys(Q).length/2;this._devices=new Array(g),this._firstDevice=new Array(g),this._engine=y,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new F(y)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new k.d((y=>{for(const g of this._devices)if(g)for(const f of g)f&&this.onDeviceConnectedObservable.notifyObserver(y,f)})),this.onDeviceDisconnectedObservable=new k.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=y.nj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.nj.remove(this._onDisposeObserver)}_addDevice(y){this._devices[y.deviceType]||(this._devices[y.deviceType]=new Array),this._devices[y.deviceType][y.deviceSlot]||(this._devices[y.deviceType][y.deviceSlot]=y,this._updateFirstDevices(y.deviceType)),this.onDeviceConnectedObservable.notifyObservers(y)}_removeDevice(y,g){var f,p;const S=null===(f=this._devices[y])||void 0===f?void 0:f[g];this.onDeviceDisconnectedObservable.notifyObservers(S),null!==(p=this._devices[y])&&void 0!==p&&p[g]&&delete this._devices[y][g],this._updateFirstDevices(y)}_onInputChanged(y,g,f){var p,S;null===(p=this._devices[y])||void 0===p||null===(S=p[g])||void 0===S||S.onInputChangedObservable.notifyObservers(f)}_updateFirstDevices(y){switch(y){case Q.Keyboard:case Q.Mouse:this._firstDevice[y]=0;break;case Q.Touch:case Q.DualSense:case Q.DualShock:case Q.Xbox:case Q.Switch:case Q.Generic:{delete this._firstDevice[y];const g=this._devices[y];if(g)for(let f=0;f<g.length;f++)if(g[f]){this._firstDevice[y]=f;break}break}}}}var J=f(11174);class V{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(y){this._singleClick=y}set doubleClick(y){this._doubleClick=y}set hasSwiped(y){this._hasSwiped=y}set ignore(y){this._ignore=y}}class e{constructor(y){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new l.l(0,0),this._previousStartingPointerPosition=new l.l(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=y||R.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(y){return this._meshUnderPointerId[y]||null}get unTranslatedPointer(){return new l.l(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(y){this._pointerX=y}get pointerY(){return this._pointerY}set pointerY(y){this._pointerY=y}_updatePointerPosition(y){const g=this._scene.getEngine().getInputElementClientRect();g&&(this._pointerX=y.clientX-g.left,this._pointerY=y.clientY-g.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(y,g){const f=this._scene,p=f.getEngine(),S=p.getInputElement();S&&(S.tabIndex=p.canvasTabIndex,f.doNotHandleCursors||(S.style.cursor=f.defaultCursor)),this._setCursorAndPointerOverMesh(y,g,f);for(const U of f._pointerMoveStage){var k;const f=!(null===(k=y=y||this._pickMove(g))||void 0===k||!k.pickedMesh);y=U.action(this._unTranslatedPointerX,this._unTranslatedPointerY,y,f,S)}const i=g.inputIndex>=m.MouseWheelX&&g.inputIndex<=m.MouseWheelZ?z.d.POINTERWHEEL:z.d.POINTERMOVE;let H;f.onPointerMove&&(y=y||this._pickMove(g),f.onPointerMove(g,y,i)),y?(H=new z.i(i,g,y),this._setRayOnPointerInfo(y,g)):(H=new z.i(i,g,null,this),this._movePointerInfo=H),f.onPointerObservable.hasObservers()&&f.onPointerObservable.notifyObservers(H,i)}_setRayOnPointerInfo(y,g){const f=this._scene;y&&J.b._IsPickingAvailable&&(y.ray||(y.ray=f.createPickingRay(g.offsetX,g.offsetY,l.c.Identity(),f.activeCamera)))}_addCameraPointerObserver(y,g){return this._cameraObserverCount++,this._scene.onPointerObservable.add(y,g)}_removeCameraPointerObserver(y){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(y)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(y,g,f){const p=this._scene,S=new z.e(f,g,this._unTranslatedPointerX,this._unTranslatedPointerY);return y&&(S.originalPickingInfo=y,S.ray=y.ray,"xr-near"===g.pointerType&&y.originMesh&&(S.nearInteractionPickingInfo=y)),p.onPrePointerObservable.notifyObservers(S,f),!!S.skipOnPointerObservable}_pickMove(y){const g=this._scene,f=g.bd(this._unTranslatedPointerX,this._unTranslatedPointerY,g.pointerMovePredicate,g.pointerMoveFastCheck,g.cameraToUseForPointers,g.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(f,y,g),f}_setCursorAndPointerOverMesh(y,g,f){const p=f.getEngine().getInputElement();if(null!==y&&void 0!==y&&y.pickedMesh){if(this.setPointerOverMesh(y.pickedMesh,g.pointerId,y,g),!f.doNotHandleCursors&&p&&this._pointerOverMesh){const y=this._pointerOverMesh._getActionManagerForTrigger();y&&y.hasPointerTriggers&&(p.style.cursor=y.hoverCursor||f.hoverCursor)}}else this.setPointerOverMesh(null,g.pointerId,y,g)}simulatePointerMove(y,g){const f=new PointerEvent("pointermove",g);f.inputIndex=m.Move,this._checkPrePointerObservable(y,f,z.d.POINTERMOVE)||this._processPointerMove(y,f)}simulatePointerDown(y,g){const f=new PointerEvent("pointerdown",g);f.inputIndex=f.button+2,this._checkPrePointerObservable(y,f,z.d.POINTERDOWN)||this._processPointerDown(y,f)}_processPointerDown(y,g){var f;const p=this._scene;if(null!==(f=y)&&void 0!==f&&f.pickedMesh){this._pickedDownMesh=y.pickedMesh;const f=y.pickedMesh._getActionManagerForTrigger();if(f){if(f.hasPickTriggers)switch(f.processTrigger(5,q.CreateNew(y.pickedMesh,g,y)),g.button){case 0:f.processTrigger(2,q.CreateNew(y.pickedMesh,g,y));break;case 1:f.processTrigger(4,q.CreateNew(y.pickedMesh,g,y));break;case 2:f.processTrigger(3,q.CreateNew(y.pickedMesh,g,y))}f.hasSpecificTrigger(8)&&window.setTimeout((()=>{const y=p.bd(this._unTranslatedPointerX,this._unTranslatedPointerY,(y=>y.Lb&&y.isVisible&&y.isReady()&&y.actionManager&&y.actionManager.hasSpecificTrigger(8)&&y===this._pickedDownMesh),!1,p.cameraToUseForPointers);null!==y&&void 0!==y&&y.pickedMesh&&f&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>e.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,f.processTrigger(8,q.CreateNew(y.pickedMesh,g)))}),e.LongPressDelay)}}else for(const i of p._pointerDownStage)y=i.action(this._unTranslatedPointerX,this._unTranslatedPointerY,y,g,!1);let S;const k=z.d.POINTERDOWN;y?(p.onPointerDown&&p.onPointerDown(g,y,k),S=new z.i(k,g,y),this._setRayOnPointerInfo(y,g)):S=new z.i(k,g,null,this),p.onPointerObservable.hasObservers()&&p.onPointerObservable.notifyObservers(S,k)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(y,g,f){const p=new PointerEvent("pointerup",g);p.inputIndex=m.Move;const S=new V;f?S.doubleClick=!0:S.singleClick=!0,this._checkPrePointerObservable(y,p,z.d.POINTERUP)||this._processPointerUp(y,p,S)}_processPointerUp(y,g,f){var p;const S=this._scene;if(null!==(p=y)&&void 0!==p&&p.pickedMesh){if(this._pickedUpMesh=y.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(S.onPointerPick&&S.onPointerPick(g,y),f.singleClick&&!f.ignore&&S.onPointerObservable.observers.length>this._cameraObserverCount)){const f=z.d.POINTERPICK,p=new z.i(f,g,y);this._setRayOnPointerInfo(y,g),S.onPointerObservable.notifyObservers(p,f)}const p=y.pickedMesh._getActionManagerForTrigger();if(p&&!f.ignore){p.processTrigger(7,q.CreateNew(y.pickedMesh,g,y)),!f.hasSwiped&&f.singleClick&&p.processTrigger(1,q.CreateNew(y.pickedMesh,g,y));const S=y.pickedMesh._getActionManagerForTrigger(6);f.doubleClick&&S&&S.processTrigger(6,q.CreateNew(y.pickedMesh,g,y))}}else if(!f.ignore)for(const k of S._pointerUpStage)y=k.action(this._unTranslatedPointerX,this._unTranslatedPointerY,y,g,f.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const y=this._pickedDownMesh._getActionManagerForTrigger(16);y&&y.processTrigger(16,q.CreateNew(this._pickedDownMesh,g))}if(!f.ignore){const p=new z.i(z.d.POINTERUP,g,y);if(this._setRayOnPointerInfo(y,g),S.onPointerObservable.notifyObservers(p,z.d.POINTERUP),S.onPointerUp&&S.onPointerUp(g,y,z.d.POINTERUP),!f.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let p=0;if(f.singleClick?p=z.d.POINTERTAP:f.doubleClick&&(p=z.d.POINTERDOUBLETAP),p){const f=new z.i(p,g,y);S.onPointerObservable.hasObservers()&&S.onPointerObservable.hasSpecificMask(p)&&S.onPointerObservable.notifyObservers(f,p)}}}}isPointerCaptured(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[y]}attachControl(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=this._scene,k=S.getEngine();p||(p=k.getInputElement()),this._alreadyAttached&&this.Wi(),p&&(this._alreadyAttachedTo=p),this._deviceSourceManager=new A(k),this._initActionManager=y=>{if(!this._meshPickProceed){const g=S.skipPointerUpPicking||0===S._registeredActions&&!this._checkForPicking()&&!S.onPointerUp?null:S.bd(this._unTranslatedPointerX,this._unTranslatedPointerY,S.pointerUpPredicate,S.pointerUpFastCheck,S.cameraToUseForPointers,S.pointerUpTrianglePredicate);this._currentPickResult=g,g&&(y=g.hit&&g.pickedMesh?g.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return y},this._delayedSimpleClick=(y,g,f)=>{if((Date.now()-this._previousStartingPointerTime>e.DoubleClickDelay&&!this._doubleClickOccured||y!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,g.singleClick=!0,g.ignore=!1,this._delayedClicks[y])){const g=this._delayedClicks[y].evt,f=z.d.POINTERTAP,p=new z.i(f,g,this._currentPickResult);S.onPointerObservable.hasObservers()&&S.onPointerObservable.hasSpecificMask(f)&&S.onPointerObservable.notifyObservers(p,f),this._delayedClicks[y]=null}},this._initClickEvent=(y,g,f,p)=>{const S=new V;this._currentPickResult=null;let k=null,i=y.hasSpecificMask(z.d.POINTERPICK)||g.hasSpecificMask(z.d.POINTERPICK)||y.hasSpecificMask(z.d.POINTERTAP)||g.hasSpecificMask(z.d.POINTERTAP)||y.hasSpecificMask(z.d.POINTERDOUBLETAP)||g.hasSpecificMask(z.d.POINTERDOUBLETAP);!i&&T&&(k=this._initActionManager(k,S),k&&(i=k.hasPickTriggers));let H=!1;if(i){const i=f.button;if(S.hasSwiped=this._isPointerSwiping(),!S.hasSwiped){let c=!e.ExclusiveDoubleClickMode;if(c||(c=!y.hasSpecificMask(z.d.POINTERDOUBLETAP)&&!g.hasSpecificMask(z.d.POINTERDOUBLETAP),c&&!T.HasSpecificTrigger(6)&&(k=this._initActionManager(k,S),k&&(c=!k.hasSpecificTrigger(6)))),c)(Date.now()-this._previousStartingPointerTime>e.DoubleClickDelay||i!==this._previousButtonPressed)&&(S.singleClick=!0,p(S,this._currentPickResult),H=!0);else{const y={evt:f,clickInfo:S,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,i,S,p),e.DoubleClickDelay)};this._delayedClicks[i]=y}let Z=y.hasSpecificMask(z.d.POINTERDOUBLETAP)||g.hasSpecificMask(z.d.POINTERDOUBLETAP);if(!Z&&T.HasSpecificTrigger(6)&&(k=this._initActionManager(k,S),k&&(Z=k.hasSpecificTrigger(6))),Z)if(i===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<e.DoubleClickDelay&&!this._doubleClickOccured){if(S.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=i,e.ExclusiveDoubleClickMode){var U;if(this._delayedClicks[i])clearTimeout(null===(U=this._delayedClicks[i])||void 0===U?void 0:U.timeoutId),this._delayedClicks[i]=null;p(S,this._previousPickResult)}else p(S,this._currentPickResult);else{var l;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,S.doubleClick=!0,S.ignore=!1,e.ExclusiveDoubleClickMode&&this._delayedClicks[i])clearTimeout(null===(l=this._delayedClicks[i])||void 0===l?void 0:l.timeoutId),this._delayedClicks[i]=null;p(S,this._currentPickResult)}H=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=i}}H||p(S,this._currentPickResult)},this._onPointerMove=y=>{if(this._updatePointerPosition(y),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold),k.isPointerLock&&k._verifyPointerLock(),this._checkPrePointerObservable(null,y,y.inputIndex>=m.MouseWheelX&&y.inputIndex<=m.MouseWheelZ?z.d.POINTERWHEEL:z.d.POINTERMOVE))return;if(!S.cameraToUseForPointers&&!S.activeCamera)return;if(S.dj)return void this._processPointerMove(new C.c,y);S.pointerMovePredicate||(S.pointerMovePredicate=y=>y.Lb&&y.isVisible&&y.isReady()&&y.isEnabled()&&(y.enablePointerMoveEvents||S.constantlyUpdateMeshUnderPointer||null!==y._getActionManagerForTrigger())&&(!S.cameraToUseForPointers||0!==(S.cameraToUseForPointers.layerMask&y.layerMask)));const g=S._registeredActions>0||S.constantlyUpdateMeshUnderPointer?this._pickMove(y):null;this._processPointerMove(g,y)},this._onPointerDown=y=>{const g=this._activePointerIds.indexOf(-1);if(-1===g?this._activePointerIds.push(y.pointerId):this._activePointerIds[g]=y.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,e.ExclusiveDoubleClickMode)for(let p=0;p<this._delayedClicks.length;p++)if(this._delayedClicks[p])if(y.button===p){var f;clearTimeout(null===(f=this._delayedClicks[p])||void 0===f?void 0:f.timeoutId)}else{const y=this._delayedClicks[p].clickInfo;this._doubleClickOccured=!1,y.singleClick=!0,y.ignore=!1;const g=this._delayedClicks[p].evt,f=z.d.POINTERTAP,k=new z.i(f,g,this._currentPickResult);S.onPointerObservable.hasObservers()&&S.onPointerObservable.hasSpecificMask(f)&&S.onPointerObservable.notifyObservers(k,f),this._delayedClicks[p]=null}if(this._updatePointerPosition(y),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=y.button),S.preventDefaultOnPointerDown&&p&&(y.preventDefault(),p.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,y,z.d.POINTERDOWN))return;if(!S.cameraToUseForPointers&&!S.activeCamera)return;let k;this._pointerCaptures[y.pointerId]=!0,S.pointerDownPredicate||(S.pointerDownPredicate=y=>y.Lb&&y.isVisible&&y.isReady()&&y.isEnabled()&&(!S.cameraToUseForPointers||0!==(S.cameraToUseForPointers.layerMask&y.layerMask))),this._pickedDownMesh=null,k=S.skipPointerDownPicking||0===S._registeredActions&&!this._checkForPicking()&&!S.onPointerDown?new C.c:S.bd(this._unTranslatedPointerX,this._unTranslatedPointerY,S.pointerDownPredicate,S.pointerDownFastCheck,S.cameraToUseForPointers,S.pointerDownTrianglePredicate),this._processPointerDown(k,y)},this._onPointerUp=y=>{const g=this._activePointerIds.indexOf(y.pointerId);-1!==g&&(this._activePointerIds[g]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(y),S.preventDefaultOnPointerUp&&p&&(y.preventDefault(),p.focus()),this._initClickEvent(S.onPrePointerObservable,S.onPointerObservable,y,((g,f)=>{if(S.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!g.ignore)){if(this._checkPrePointerObservable(null,y,z.d.POINTERUP))return this._swipeButtonPressed===y.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===y.buttons&&(this._pointerCaptures[y.pointerId]=!1));g.hasSwiped||(g.singleClick&&S.onPrePointerObservable.hasSpecificMask(z.d.POINTERTAP)&&this._checkPrePointerObservable(null,y,z.d.POINTERTAP)&&(this._skipPointerTap=!0),g.doubleClick&&S.onPrePointerObservable.hasSpecificMask(z.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,y,z.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[y.pointerId]?(0===y.buttons&&(this._pointerCaptures[y.pointerId]=!1),(S.cameraToUseForPointers||S.activeCamera)&&(S.pointerUpPredicate||(S.pointerUpPredicate=y=>y.Lb&&y.isVisible&&y.isReady()&&y.isEnabled()&&(!S.cameraToUseForPointers||0!==(S.cameraToUseForPointers.layerMask&y.layerMask))),!this._meshPickProceed&&(T&&T.HasTriggers||this._checkForPicking()||S.onPointerUp)&&this._initActionManager(null,g),f||(f=this._currentPickResult),this._processPointerUp(f,y,g),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===y.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===y.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=y=>{const g=n.d.KEYDOWN;if(S.onPreKeyboardObservable.hasObservers()){const f=new n.f(g,y);if(S.onPreKeyboardObservable.notifyObservers(f,g),f.skipOnKeyboardObservable)return}if(S.onKeyboardObservable.hasObservers()){const f=new n.i(g,y);S.onKeyboardObservable.notifyObservers(f,g)}S.actionManager&&S.actionManager.processTrigger(14,q.CreateNewFromScene(S,y))},this._onKeyUp=y=>{const g=n.d.KEYUP;if(S.onPreKeyboardObservable.hasObservers()){const f=new n.f(g,y);if(S.onPreKeyboardObservable.notifyObservers(f,g),f.skipOnKeyboardObservable)return}if(S.onKeyboardObservable.hasObservers()){const f=new n.i(g,y);S.onKeyboardObservable.notifyObservers(f,g)}S.actionManager&&S.actionManager.processTrigger(15,q.CreateNewFromScene(S,y))},this._deviceSourceManager.onDeviceConnectedObservable.add((p=>{p.deviceType===Q.Mouse?p.onInputChangedObservable.add((S=>{this._originMouseEvent=S,S.inputIndex===m.LeftClick||S.inputIndex===m.MiddleClick||S.inputIndex===m.RightClick||S.inputIndex===m.BrowserBack||S.inputIndex===m.BrowserForward?g&&1===p.getInput(S.inputIndex)?this._onPointerDown(S):y&&0===p.getInput(S.inputIndex)&&this._onPointerUp(S):f&&(S.inputIndex===m.Move?this._onPointerMove(S):S.inputIndex!==m.MouseWheelX&&S.inputIndex!==m.MouseWheelY&&S.inputIndex!==m.MouseWheelZ||this._onPointerMove(S))})):p.deviceType===Q.Touch?p.onInputChangedObservable.add((S=>{S.inputIndex===m.LeftClick&&(g&&1===p.getInput(S.inputIndex)?(this._onPointerDown(S),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):y&&0===p.getInput(S.inputIndex)&&(this._onPointerUp(S),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),f&&S.inputIndex===m.Move&&this._onPointerMove(S)})):p.deviceType===Q.Keyboard&&p.onInputChangedObservable.add((y=>{"keydown"===y.type?this._onKeyDown(y):"keyup"===y.type&&this._onKeyUp(y)}))})),this._alreadyAttached=!0}Wi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[g]===y&&(!y||!y._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const S=this._meshUnderPointerId[g];let k;S&&(k=S._getActionManagerForTrigger(10),k&&k.processTrigger(10,q.CreateNew(S,p,{pointerId:g}))),y?(this._meshUnderPointerId[g]=y,this._pointerOverMesh=y,k=y._getActionManagerForTrigger(9),k&&k.processTrigger(9,q.CreateNew(y,p,{pointerId:g,pickResult:f}))):(delete this._meshUnderPointerId[g],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(y){this._pointerOverMesh===y&&(this._pointerOverMesh=null),this._pickedDownMesh===y&&(this._pickedDownMesh=null),this._pickedUpMesh===y&&(this._pickedUpMesh=null);for(const g in this._meshUnderPointerId)this._meshUnderPointerId[g]===y&&delete this._meshUnderPointerId[g]}}e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1;var h=f(10886),D=f(11090),K=f(11177),X=f(11189),E=f(10766),O=f(11194),L=f(11071);class x{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.dj=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var d,t=f(10736),v=f(10871);!function(y){y[y.BackwardCompatible=0]="BackwardCompatible",y[y.Intermediate=1]="Intermediate",y[y.Aggressive=2]="Aggressive"}(d||(d={}));class yy{static DefaultMaterialFactory(y){throw(0,G.b)("nb")}static CollisionCoordinatorFactory(){throw(0,G.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(y){y!==this._clearColor&&(this._clearColor=y,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(y){if(y!==this._performancePriority){switch(this._performancePriority=y,y){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.dj=!1,this.Xi=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.dj=!0,this.Xi=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.dj=!0,this.Xi=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(y)}}set forceWireframe(y){this._forceWireframe!==y&&(this._forceWireframe=y,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(y){this._skipFrustumClipping!==y&&(this._skipFrustumClipping=y)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(y){this._forcePointsCloud!==y&&(this._forcePointsCloud=y,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(y){this._environmentTexture!==y&&(this._environmentTexture=y,this.markAllMaterialsAsDirty(1))}getNodes(){let y=[];return y=y.concat(this.meshes),y=y.concat(this.lights),y=y.concat(this.cameras),y=y.concat(this.transformNodes),this.skeletons.forEach((g=>y=y.concat(g.bones))),y}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}set onDispose(y){this._onDisposeObserver&&this.nj.remove(this._onDisposeObserver),this._onDisposeObserver=this.nj.add(y)}set beforeRender(y){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),y&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(y))}set afterRender(y){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),y&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(y))}set beforeCameraRender(y){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(y)}set afterCameraRender(y){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(y)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(y){this._pointerPickingConfiguration.pointerDownPredicate=y}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(y){this._pointerPickingConfiguration.pointerUpPredicate=y}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(y){this._pointerPickingConfiguration.pointerMovePredicate=y}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(y){this._pointerPickingConfiguration.pointerDownFastCheck=y}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(y){this._pointerPickingConfiguration.pointerUpFastCheck=y}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(y){this._pointerPickingConfiguration.pointerMoveFastCheck=y}get dj(){return this._pointerPickingConfiguration.dj}set dj(y){this._pointerPickingConfiguration.dj=y}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(y){this._pointerPickingConfiguration.skipPointerDownPicking=y}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(y){this._pointerPickingConfiguration.skipPointerUpPicking=y}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return e.DragMovementThreshold}static set DragMovementThreshold(y){e.DragMovementThreshold=y}static get LongPressDelay(){return e.LongPressDelay}static set LongPressDelay(y){e.LongPressDelay=y}static get DoubleClickDelay(){return e.DoubleClickDelay}static set DoubleClickDelay(y){e.DoubleClickDelay=y}static get ExclusiveDoubleClickMode(){return e.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(y){e.ExclusiveDoubleClickMode=y}bindEyePosition(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const p=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,S=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return l.j.Vector4[0].set(p.x,p.y,p.z,S?-1:1),y&&(f?y.setFloat3(g,l.j.Vector4[0].x,l.j.Vector4[0].y,l.j.Vector4[0].z):y.setVector4(g,l.j.Vector4[0])),l.j.Vector4[0]}finalizeSceneUbo(){const y=this.getSceneUniformBuffer(),g=this.bindEyePosition(null);return y.updateFloat4("vEyePosition",g.x,g.y,g.z,g.w),y.update(),y}set useRightHandedSystem(y){this._useRightHandedSystem!==y&&(this._useRightHandedSystem=y,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(y){this._currentStepId=y}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(y){this._fogEnabled!==y&&(this._fogEnabled=y,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(y){this._fogMode!==y&&(this._fogMode=y,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(y){this._shadowsEnabled!==y&&(this._shadowsEnabled=y,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(y){this._lightsEnabled!==y&&(this._lightsEnabled=y,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(y){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),y&&(this._unObserveActiveCameras=(0,L.j)(y,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=y}get activeCamera(){return this._activeCamera}set activeCamera(y){y!==this._activeCamera&&(this._activeCamera=y,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.zi||(this.zi=yy.DefaultMaterialFactory(this)),this.zi}set defaultMaterial(y){this.zi=y}set texturesEnabled(y){this._texturesEnabled!==y&&(this._texturesEnabled=y,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(y){if(this._frameGraph)return this._frameGraph=y,void(y||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=y,y&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(y){this._skeletonsEnabled!==y&&(this._skeletonsEnabled=y,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=yy.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const y of this._transientComponents)y.register();this._transientComponents.length=0}}gb(y){this._components.push(y),this._transientComponents.push(y);const g=y;g.addFromContainer&&g.serialize&&this._serializableComponents.push(g)}_getComponent(y){for(const g of this._components)if(g.name===y)return g;return null}constructor(y,g){this._inputManager=new e(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Xi=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new D.f(.2,.2,.3,1),this.onClearColorChangedObservable=new k.d,this.ambientColor=new D.c(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new k.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.uj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.dk=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.nj=new k.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new k.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new k.d,this.onAfterRenderCameraObservable=new k.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new k.d,this.onAfterAnimationsObservable=new k.d,this.onBeforeDrawPhaseObservable=new k.d,this.onAfterDrawPhaseObservable=new k.d,this.onReadyObservable=new k.d,this.onBeforeCameraRenderObservable=new k.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new k.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new k.d,this.onAfterActiveMeshesEvaluationObservable=new k.d,this.onBeforeParticlesRenderingObservable=new k.d,this.onAfterParticlesRenderingObservable=new k.d,this.onDataLoadedObservable=new k.d,this.onNewCameraAddedObservable=new k.d,this.onCameraRemovedObservable=new k.d,this.onNewLightAddedObservable=new k.d,this.onLightRemovedObservable=new k.d,this.onNewGeometryAddedObservable=new k.d,this.onGeometryRemovedObservable=new k.d,this.onNewTransformNodeAddedObservable=new k.d,this.onTransformNodeRemovedObservable=new k.d,this.onNewMeshAddedObservable=new k.d,this.onMeshRemovedObservable=new k.d,this.onNewSkeletonAddedObservable=new k.d,this.onSkeletonRemovedObservable=new k.d,this.onNewMaterialAddedObservable=new k.d,this.onNewMultiMaterialAddedObservable=new k.d,this.onMaterialRemovedObservable=new k.d,this.onMultiMaterialRemovedObservable=new k.d,this.onNewTextureAddedObservable=new k.d,this.onTextureRemovedObservable=new k.d,this.onBeforeRenderTargetsRenderObservable=new k.d,this.onAfterRenderTargetsRenderObservable=new k.d,this.onBeforeStepObservable=new k.d,this.onAfterStepObservable=new k.d,this.onActiveCameraChanged=new k.d,this.onActiveCamerasChanged=new k.d,this.onBeforeRenderingGroupObservable=new k.d,this.onAfterRenderingGroupObservable=new k.d,this.onMeshImportedObservable=new k.d,this.onAnimationFileImportedObservable=new k.d,this._registeredForLateAnimationBindings=new i.e(256),this._pointerPickingConfiguration=new x,this.onPrePointerObservable=new k.d,this.onPointerObservable=new k.d,this.onPreKeyboardObservable=new k.d,this.onKeyboardObservable=new k.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=yy.FOGMODE_NONE,this.fogColor=new D.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new l.m(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new i.e(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new h.d,this._activeIndices=new h.d,this._activeParticles=new h.d,this._activeBones=new h.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new i.i(256),this._processedMaterials=new i.i(256),this._renderTargets=new i.e(256),this._materialsRenderTargets=new i.e(256),this._activeParticleSystems=new i.i(256),this._activeSkeletons=new i.e(32),this._softwareSkinnedMeshes=new i.e(32),this._activeAnimatables=new Array,this._transformMatrix=l.c.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=P.f.Create(),this._beforeClearStage=P.f.Create(),this._beforeRenderTargetClearStage=P.f.Create(),this._gatherRenderTargetsStage=P.f.Create(),this._gatherActiveCameraRenderTargetsStage=P.f.Create(),this._isReadyForMeshStage=P.f.Create(),this._beforeEvaluateActiveMeshStage=P.f.Create(),this._evaluateSubMeshStage=P.f.Create(),this._preActiveMeshStage=P.f.Create(),this._cameraDrawRenderTargetStage=P.f.Create(),this._beforeCameraDrawStage=P.f.Create(),this._beforeRenderTargetDrawStage=P.f.Create(),this._beforeRenderingGroupDrawStage=P.f.Create(),this._beforeRenderingMeshStage=P.f.Create(),this._afterRenderingMeshStage=P.f.Create(),this._afterRenderingGroupDrawStage=P.f.Create(),this._afterCameraDrawStage=P.f.Create(),this._afterCameraPostProcessStage=P.f.Create(),this._afterRenderTargetDrawStage=P.f.Create(),this._afterRenderTargetPostProcessStage=P.f.Create(),this._afterRenderStage=P.f.Create(),this._pointerMoveStage=P.f.Create(),this._pointerDownStage=P.f.Create(),this._pointerUpStage=P.f.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const f={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...g};y=this._engine=y||R.d.LastCreatedEngine,f.virtual?y._virtualScenes.push(this):(R.d._LastCreatedScene=this,y.scenes.push(this)),this._uid=null,this._renderingManager=new j.d(this),W.c&&(this.postProcessManager=new W.c(this)),(0,B.i)()&&this.attachControl(),this._createUbo(),c.b&&(this._imageProcessingConfiguration=new c.b),this.setDefaultCandidateProviders(),f.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=f.useMaterialMeshMap,this.useClonedMeshMap=f.useClonedMeshMap,g&&g.virtual||y.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(y){return this._defaultSubMeshCandidates.data=y.og,this._defaultSubMeshCandidates.length=y.og.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=y=>this._getDefaultSubMeshCandidates(y),this.getIntersectingSubMeshCandidates=(y,g)=>this._getDefaultSubMeshCandidates(y),this.getCollidingSubMeshCandidates=(y,g)=>this._getDefaultSubMeshCandidates(y)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(y){this._inputManager.pointerX=y}get pointerY(){return this._inputManager.pointerY}set pointerY(y){this._inputManager.pointerY=y}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==g||this._cachedMaterial!==y||this._cachedVisibility!==f}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(y,g){return this._inputManager.simulatePointerMove(y,g),this}simulatePointerDown(y,g){return this._inputManager.simulatePointerDown(y,g),this}simulatePointerUp(y,g,f){return this._inputManager.simulatePointerUp(y,g,f),this}isPointerCaptured(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(y)}attachControl(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(y,g,f)}Wi(){this._inputManager.Wi()}isReady(){var y,g;let f,p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const S=this.getEngine(),k=S.currentRenderPassId;S.currentRenderPassId=(null===(y=this.activeCamera)||void 0===y?void 0:y.renderPassId)??k;let i=!0;for(this._pendingData.length>0&&(i=!1),null===(g=this.prePassRenderer)||void 0===g||g.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&i&&(i=this.depthPeelingRenderer.isReady()),p&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),f=0;f<this.meshes.length;f++){const y=this.meshes[f];if(!y.og||0===y.og.length)continue;if(!y.isReady(!0)){i=!1;continue}const g=y.hasThinInstances||"InstancedMesh"===y.getClassName()||"InstancedLinesMesh"===y.getClassName()||S.getCaps().instancedArrays&&y.instances.length>0;for(const f of this._isReadyForMeshStage)f.action(y,g)||(i=!1);if(!p)continue;const k=y.material||this.defaultMaterial;if(k)if(k._storeEffectOnSubMeshes)for(const f of y.og){const y=f.Ha();y&&y.hasRenderTargetTextures&&null!=y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(y)&&(this._processedMaterials.push(y),this._materialsRenderTargets.concatWithNoDuplicate(y.getRenderTargetTextures()))}else k.hasRenderTargetTextures&&null!=k.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(k)&&(this._processedMaterials.push(k),this._materialsRenderTargets.concatWithNoDuplicate(k.getRenderTargetTextures()))}if(p)for(f=0;f<this._materialsRenderTargets.length;++f){this._materialsRenderTargets.data[f].isReadyForRendering()||(i=!1)}for(f=0;f<this.geometries.length;f++){2===this.geometries[f].delayLoadState&&(i=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const H of this.activeCameras)H.isReady(!0)||(i=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(i=!1));for(const H of this.uj)H.isReady()||(i=!1);if(this.layers)for(const H of this.layers)H.isReady()||(i=!1);return S.areAllEffectsReady()||(i=!1),S.currentRenderPassId=k,i}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(y){this.onBeforeRenderObservable.add(y)}unregisterBeforeRender(y){this.onBeforeRenderObservable.removeCallback(y)}registerAfterRender(y){this.onAfterRenderObservable.add(y)}unregisterAfterRender(y){this.onAfterRenderObservable.removeCallback(y)}_executeOnceBeforeRender(y){const g=()=>{y(),setTimeout((()=>{this.unregisterBeforeRender(g)}))};this.registerBeforeRender(g)}executeOnceBeforeRender(y,g){void 0!==g?setTimeout((()=>{this._executeOnceBeforeRender(y)}),g):this._executeOnceBeforeRender(y)}addPendingData(y){this._pendingData.push(y)}removePendingData(y){const g=this.isLoading,f=this._pendingData.indexOf(y);-1!==f&&this._pendingData.splice(f,1),g&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(y),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(g)}whenReadyAsync(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((g=>{this.executeWhenReady((()=>{g()}),y)}))}_checkIsReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(y)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(y)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=S.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(y,g,f,p){f||p||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===y.updateFlag&&this._projectionUpdateFlag===g.updateFlag||(this._viewUpdateFlag=y.updateFlag,this._projectionUpdateFlag=g.updateFlag,this._viewMatrix=y,this._projectionMatrix=g,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?K.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=K.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(f,p):this._sceneUbo.useUbo&&(this._sceneUbo.Lj("viewProjection",this._transformMatrix),this._sceneUbo.Lj("view",this._viewMatrix),this._sceneUbo.Lj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(y){const g=new Z.c(this._engine,void 0,!1,y??"Oc");return g.addUniform("viewProjection",16),g.addUniform("view",16),g.addUniform("projection",16),g.addUniform("vEyePosition",4),g}setSceneUniformBuffer(y){this._sceneUbo=y,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return X.d.UniqueId}pi(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(y),y._resyncLightSources(),y.parent||y._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(y),g&&y.getChildMeshes().forEach((y=>{this.pi(y)})))}Lc(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const f=this.meshes.indexOf(y);return-1!==f&&(this.meshes.splice(f,1),y.parent||y._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(y),this.onMeshRemovedObservable.notifyObservers(y),g&&y.getChildMeshes().forEach((y=>{this.Lc(y)})),f}addTransformNode(y){this._blockEntityCollection||y.va()===this&&-1!==y._indexInSceneTransformNodesArray||(y._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(y),y.parent||y._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(y))}removeTransformNode(y){const g=y._indexInSceneTransformNodesArray;if(-1!==g){if(g!==this.transformNodes.length-1){const y=this.transformNodes[this.transformNodes.length-1];this.transformNodes[g]=y,y._indexInSceneTransformNodesArray=g}y._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),y.parent||y._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(y),g}removeSkeleton(y){const g=this.skeletons.indexOf(y);return-1!==g&&(this.skeletons.splice(g,1),this.onSkeletonRemovedObservable.notifyObservers(y),this._executeActiveContainerCleanup(this._activeSkeletons)),g}removeMorphTargetManager(y){const g=this.morphTargetManagers.indexOf(y);return-1!==g&&this.morphTargetManagers.splice(g,1),g}removeLight(y){const g=this.lights.indexOf(y);if(-1!==g){for(const g of this.meshes)g._removeLightSource(y,!1);this.lights.splice(g,1),this.sortLightsByPriority(),y.parent||y._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(y),g}removeCamera(y){const g=this.cameras.indexOf(y);if(-1!==g&&(this.cameras.splice(g,1),y.parent||y._removeFromSceneRootNodes()),this.activeCameras){const g=this.activeCameras.indexOf(y);-1!==g&&this.activeCameras.splice(g,1)}return this.activeCamera===y&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(y),g}removeParticleSystem(y){const g=this.uj.indexOf(y);return-1!==g&&(this.uj.splice(g,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),g}removeAnimation(y){const g=this.animations.indexOf(y);return-1!==g&&this.animations.splice(g,1),g}stopAnimation(y,g,f){}removeAnimationGroup(y){const g=this.animationGroups.indexOf(y);return-1!==g&&this.animationGroups.splice(g,1),g}removeMultiMaterial(y){const g=this.multiMaterials.indexOf(y);return-1!==g&&this.multiMaterials.splice(g,1),this.onMultiMaterialRemovedObservable.notifyObservers(y),g}removeMaterial(y){const g=y._indexInSceneMaterialArray;if(-1!==g&&g<this.materials.length){if(g!==this.materials.length-1){const y=this.materials[this.materials.length-1];this.materials[g]=y,y._indexInSceneMaterialArray=g}y._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(y),g}removeActionManager(y){const g=this.actionManagers.indexOf(y);return-1!==g&&this.actionManagers.splice(g,1),g}removeTexture(y){const g=this.textures.indexOf(y);return-1!==g&&this.textures.splice(g,1),this.onTextureRemovedObservable.notifyObservers(y),g}addLight(y){if(!this._blockEntityCollection){this.lights.push(y),this.sortLightsByPriority(),y.parent||y._addToSceneRootNodes();for(const g of this.meshes)-1===g.lightSources.indexOf(y)&&(g.lightSources.push(y),g._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(y)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(O.b.CompareLightsPriority)}addCamera(y){this._blockEntityCollection||(this.cameras.push(y),this.onNewCameraAddedObservable.notifyObservers(y),y.parent||y._addToSceneRootNodes())}addSkeleton(y){this._blockEntityCollection||(this.skeletons.push(y),this.onNewSkeletonAddedObservable.notifyObservers(y))}addParticleSystem(y){this._blockEntityCollection||this.uj.push(y)}addAnimation(y){this._blockEntityCollection||this.animations.push(y)}addAnimationGroup(y){this._blockEntityCollection||this.animationGroups.push(y)}addMultiMaterial(y){this._blockEntityCollection||(this.multiMaterials.push(y),this.onNewMultiMaterialAddedObservable.notifyObservers(y))}addMaterial(y){this._blockEntityCollection||y.va()===this&&-1!==y._indexInSceneMaterialArray||(y._indexInSceneMaterialArray=this.materials.length,this.materials.push(y),this.onNewMaterialAddedObservable.notifyObservers(y))}addMorphTargetManager(y){this._blockEntityCollection||this.morphTargetManagers.push(y)}addGeometry(y){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[y.uniqueId]=this.geometries.length),this.geometries.push(y))}addActionManager(y){this.actionManagers.push(y)}addTexture(y){this._blockEntityCollection||(this.textures.push(y),this.onNewTextureAddedObservable.notifyObservers(y))}switchActiveCamera(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Wi(),this.activeCamera=y,g&&y.attachControl())}setActiveCameraById(y){const g=this.getCameraById(y);return g?(this.activeCamera=g,g):null}setActiveCameraByName(y){const g=this.getCameraByName(y);return g?(this.activeCamera=g,g):null}getAnimationGroupByName(y){for(let g=0;g<this.animationGroups.length;g++)if(this.animationGroups[g].name===y)return this.animationGroups[g];return null}_getMaterial(y,g){for(let f=0;f<this.materials.length;f++){const y=this.materials[f];if(g(y))return y}if(y)for(let f=0;f<this.multiMaterials.length;f++){const y=this.multiMaterials[f];if(g(y))return y}return null}getMaterialByUniqueID(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(g,(g=>g.uniqueId===y))}getMaterialById(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(g,(g=>g.id===y))}getMaterialByName(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(g,(g=>g.name===y))}getLastMaterialById(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let f=this.materials.length-1;f>=0;f--)if(this.materials[f].id===y)return this.materials[f];if(g)for(let f=this.multiMaterials.length-1;f>=0;f--)if(this.multiMaterials[f].id===y)return this.multiMaterials[f];return null}getTextureByUniqueId(y){for(let g=0;g<this.textures.length;g++)if(this.textures[g].uniqueId===y)return this.textures[g];return null}getTextureByName(y){for(let g=0;g<this.textures.length;g++)if(this.textures[g].name===y)return this.textures[g];return null}getCameraById(y){for(let g=0;g<this.cameras.length;g++)if(this.cameras[g].id===y)return this.cameras[g];return null}getCameraByUniqueId(y){for(let g=0;g<this.cameras.length;g++)if(this.cameras[g].uniqueId===y)return this.cameras[g];return null}getCameraByName(y){for(let g=0;g<this.cameras.length;g++)if(this.cameras[g].name===y)return this.cameras[g];return null}getBoneById(y){for(let g=0;g<this.skeletons.length;g++){const f=this.skeletons[g];for(let g=0;g<f.bones.length;g++)if(f.bones[g].id===y)return f.bones[g]}return null}getBoneByName(y){for(let g=0;g<this.skeletons.length;g++){const f=this.skeletons[g];for(let g=0;g<f.bones.length;g++)if(f.bones[g].name===y)return f.bones[g]}return null}getLightByName(y){for(let g=0;g<this.lights.length;g++)if(this.lights[g].name===y)return this.lights[g];return null}getLightById(y){for(let g=0;g<this.lights.length;g++)if(this.lights[g].id===y)return this.lights[g];return null}getLightByUniqueId(y){for(let g=0;g<this.lights.length;g++)if(this.lights[g].uniqueId===y)return this.lights[g];return null}getParticleSystemById(y){for(let g=0;g<this.uj.length;g++)if(this.uj[g].id===y)return this.uj[g];return null}getGeometryById(y){for(let g=0;g<this.geometries.length;g++)if(this.geometries[g].id===y)return this.geometries[g];return null}_getGeometryByUniqueId(y){if(this._geometriesByUniqueId){const g=this._geometriesByUniqueId[y];if(void 0!==g)return this.geometries[g]}else for(let g=0;g<this.geometries.length;g++)if(this.geometries[g].uniqueId===y)return this.geometries[g];return null}pushGeometry(y,g){return!(!g&&this._getGeometryByUniqueId(y.uniqueId))&&(this.addGeometry(y),this.onNewGeometryAddedObservable.notifyObservers(y),!0)}removeGeometry(y){let g;if(this._geometriesByUniqueId){if(g=this._geometriesByUniqueId[y.uniqueId],void 0===g)return!1}else if(g=this.geometries.indexOf(y),g<0)return!1;if(g!==this.geometries.length-1){const y=this.geometries[this.geometries.length-1];y&&(this.geometries[g]=y,this._geometriesByUniqueId&&(this._geometriesByUniqueId[y.uniqueId]=g))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[y.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(y),!0}getGeometries(){return this.geometries}getMeshById(y){for(let g=0;g<this.meshes.length;g++)if(this.meshes[g].id===y)return this.meshes[g];return null}getMeshesById(y){return this.meshes.filter((function(g){return g.id===y}))}getTransformNodeById(y){for(let g=0;g<this.transformNodes.length;g++)if(this.transformNodes[g].id===y)return this.transformNodes[g];return null}getTransformNodeByUniqueId(y){for(let g=0;g<this.transformNodes.length;g++)if(this.transformNodes[g].uniqueId===y)return this.transformNodes[g];return null}getTransformNodesById(y){return this.transformNodes.filter((function(g){return g.id===y}))}getMeshByUniqueId(y){for(let g=0;g<this.meshes.length;g++)if(this.meshes[g].uniqueId===y)return this.meshes[g];return null}getLastMeshById(y){for(let g=this.meshes.length-1;g>=0;g--)if(this.meshes[g].id===y)return this.meshes[g];return null}getLastTransformNodeById(y){for(let g=this.transformNodes.length-1;g>=0;g--)if(this.transformNodes[g].id===y)return this.transformNodes[g];return null}getLastEntryById(y){let g;for(g=this.meshes.length-1;g>=0;g--)if(this.meshes[g].id===y)return this.meshes[g];for(g=this.transformNodes.length-1;g>=0;g--)if(this.transformNodes[g].id===y)return this.transformNodes[g];for(g=this.cameras.length-1;g>=0;g--)if(this.cameras[g].id===y)return this.cameras[g];for(g=this.lights.length-1;g>=0;g--)if(this.lights[g].id===y)return this.lights[g];return null}getNodeById(y){const g=this.getMeshById(y);if(g)return g;const f=this.getTransformNodeById(y);if(f)return f;const p=this.getLightById(y);if(p)return p;const S=this.getCameraById(y);if(S)return S;const k=this.getBoneById(y);return k||null}getNodeByName(y){const g=this.getMeshByName(y);if(g)return g;const f=this.getTransformNodeByName(y);if(f)return f;const p=this.getLightByName(y);if(p)return p;const S=this.getCameraByName(y);if(S)return S;const k=this.getBoneByName(y);return k||null}getMeshByName(y){for(let g=0;g<this.meshes.length;g++)if(this.meshes[g].name===y)return this.meshes[g];return null}getTransformNodeByName(y){for(let g=0;g<this.transformNodes.length;g++)if(this.transformNodes[g].name===y)return this.transformNodes[g];return null}getLastSkeletonById(y){for(let g=this.skeletons.length-1;g>=0;g--)if(this.skeletons[g].id===y)return this.skeletons[g];return null}getSkeletonByUniqueId(y){for(let g=0;g<this.skeletons.length;g++)if(this.skeletons[g].uniqueId===y)return this.skeletons[g];return null}getSkeletonById(y){for(let g=0;g<this.skeletons.length;g++)if(this.skeletons[g].id===y)return this.skeletons[g];return null}getSkeletonByName(y){for(let g=0;g<this.skeletons.length;g++)if(this.skeletons[g].name===y)return this.skeletons[g];return null}getMorphTargetManagerById(y){for(let g=0;g<this.morphTargetManagers.length;g++)if(this.morphTargetManagers[g].uniqueId===y)return this.morphTargetManagers[g];return null}getMorphTargetById(y){for(let g=0;g<this.morphTargetManagers.length;++g){const f=this.morphTargetManagers[g];for(let g=0;g<f.numTargets;++g){const p=f.getTarget(g);if(p.id===y)return p}}return null}getMorphTargetByName(y){for(let g=0;g<this.morphTargetManagers.length;++g){const f=this.morphTargetManagers[g];for(let g=0;g<f.numTargets;++g){const p=f.getTarget(g);if(p.name===y)return p}}return null}getPostProcessByName(y){for(let g=0;g<this.postProcesses.length;++g){const f=this.postProcesses[g];if(f.name===y)return f}return null}isActiveMesh(y){return-1!==this._activeMeshes.indexOf(y)}get uid(){return this._uid||(this._uid=p.e.RandomId()),this._uid}addExternalData(y,g){return this._externalData||(this._externalData=new H),this._externalData.add(y,g)}getExternalData(y){return this._externalData?this._externalData.get(y):null}getOrAddExternalDataWithFactory(y,g){return this._externalData||(this._externalData=new H),this._externalData.getOrAddWithFactory(y,g)}removeExternalData(y){return this._externalData.remove(y)}_evaluateSubMesh(y,g,f,p){if(p||y.isInFrustum(this._frustumPlanes)){for(const p of this._evaluateSubMeshStage)p.action(g,y);const f=y.Ha();null!==f&&void 0!==f&&(f.hasRenderTargetTextures&&null!=f.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(f)&&(this._processedMaterials.push(f),this._materialsRenderTargets.concatWithNoDuplicate(f.getRenderTargetTextures())),this._renderingManager.dispatch(y,g,f))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(y){this._preventFreeActiveMeshesAndRenderingGroups!==y&&(y&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=y)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let y=0;y<this.activeCameras.length;y++){const g=this.activeCameras[y];g&&g._activeMeshes&&g._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let y=0;y<this.textures.length;y++){const g=this.textures[y];g&&g.renderList&&g.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=S,this._skipEvaluateActiveMeshesCompletely=y,p)for(let y=0;y<this._activeMeshes.length;y++)this._activeMeshes.data[y]._freeze();g&&g()}else f&&f("No active camera found")})),this}unfreezeActiveMeshes(){for(let y=0;y<this.meshes.length;y++){const g=this.meshes[y];g._internalAbstractMeshDataInfo&&(g._internalAbstractMeshDataInfo._isActive=!1)}for(let y=0;y<this._activeMeshes.length;y++)this._activeMeshes.data[y]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(y){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>y.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var y;if(this._activeMeshes.length>0)null===(y=this.activeCamera)||void 0===y||y._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const y=this._activeMeshes.length;for(let g=0;g<y;g++){this._activeMeshes.data[g].Sj()}}if(this._activeParticleSystems){const y=this._activeParticleSystems.length;for(let g=0;g<y;g++)this._activeParticleSystems.data[g].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const p of this._beforeEvaluateActiveMeshStage)p.action();const g=this.getActiveMeshCandidates(),f=g.length;for(let p=0;p<f;p++){const y=g.data[p];if(y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,y.isBlocked)continue;if(this._totalVertices.addCount(y.getTotalVertices(),!1),!y.isReady()||!y.isEnabled()||y.pe.hasAZeroComponent)continue;y.Sj(),y.actionManager&&y.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(y);let f=this.customLODSelector?this.customLODSelector(y,this.activeCamera):y.getLOD(this.activeCamera);if(y._internalAbstractMeshDataInfo._currentLOD=f,y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==f&&null!==f&&(f!==y&&0!==f.billboardMode&&f.Sj(),y._preActivate(),y.isVisible&&y.visibility>0&&0!==(y.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||y.wb||y.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(y),this.activeCamera._activeMeshes.push(y),f!==y&&f._activate(this._renderId,!1);for(const g of this._preActiveMeshStage)g.action(y);y._activate(this._renderId,!1)&&(y.isAnInstance?y._internalAbstractMeshDataInfo._actAsRegularMesh&&(f=y):f._internalAbstractMeshDataInfo._onlyForInstances=!1,f._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(y,f)),y._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let y=0;y<this.uj.length;y++){const g=this.uj[y];if(!g.isStarted()||!g.j)continue;const f=g.j;f.position&&!f.isEnabled()||(this._activeParticleSystems.push(g),g.animate(),this._renderingManager.dispatchParticles(g))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(y){this._skeletonsEnabled&&y.skeleton&&(this._activeSkeletons.pushNoDuplicate(y.skeleton)&&(y.skeleton.prepare(),this._activeBones.addCount(y.skeleton.bones.length,!1)),y.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(y)&&this.frameGraph&&y.applySkeleton(y.skeleton))}_activeMesh(y,g){this._prepareSkeleton(g);let f=y.hasInstances||y.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||g.wb;if(g&&g.og&&g.og.length>0){const p=this.getActiveSubMeshCandidates(g),S=p.length;f=f||1===S;for(let k=0;k<S;k++){const S=p.data[k];this._evaluateSubMesh(S,g,y,f)}}}updateTransformMatrix(y){const g=this.activeCamera;if(g)if(g._renderingMultiview){const f=g._rigCameras[0],p=g._rigCameras[1];this.setTransformMatrix(f.getViewMatrix(),f.getProjectionMatrix(y),p.getViewMatrix(),p.getProjectionMatrix(y))}else this.setTransformMatrix(g.getViewMatrix(),g.getProjectionMatrix(y))}_bindFrameBuffer(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];y&&y._multiviewTexture?y._multiviewTexture._bindFrameBuffer():y&&y.outputRenderTarget?y.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),g&&this._clearFrameBuffer(y)}_clearFrameBuffer(y){if(y&&y._multiviewTexture);else if(y&&y.outputRenderTarget&&!y._renderingMultiview){const g=y.outputRenderTarget;g.onClearObservable.hasObservers()?g.onClearObservable.notifyObservers(this._engine):g.skipInitialClear||y.isRightCamera||(this.Xi&&this._engine.clear(g.clearColor||this._clearColor,!g._cleared,!0,!0),g._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(y,g){var f;let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(y&&y._skipRendering)return;const k=this._engine;if(this._activeCamera=y,!this.activeCamera)throw new Error("Active camera not set");if(k.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&S){let g=!0;y._renderingMultiview&&y.outputRenderTarget&&(g=y.outputRenderTarget.skipInitialClear,this.Xi&&(this._defaultFrameBufferCleared=!1,y.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),y._renderingMultiview&&y.outputRenderTarget&&(y.outputRenderTarget.skipInitialClear=g)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let p=0;p<this._softwareSkinnedMeshes.length;p++){const y=this._softwareSkinnedMeshes.data[p];y.applySkeleton(y.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),y.customRenderTargets&&y.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(y.customRenderTargets),g&&g.customRenderTargets&&g.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(g.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const p of this._gatherActiveCameraRenderTargetsStage)p.action(this._renderTargets);let i=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){p.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let y=0;y<this._renderTargets.length;y++){const g=this._renderTargets.data[y];if(g._shouldRender()){this._renderId++;const y=g.activeCamera&&g.activeCamera!==this.activeCamera;g.render(y,this.dumpNextRenderTargets),i=!0}}p.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const y of this._cameraDrawRenderTargetStage)i=y.action(this.activeCamera)||i;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(f=y.outputRenderTarget)||void 0===f?void 0:f.renderPassId)??y.renderPassId??0,i&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||y._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const p of this._beforeCameraDrawStage)p.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),k.snapshotRendering&&1===k.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const p of this._afterCameraDrawStage)p.action(this.activeCamera);if(this.postProcessManager&&!y._multiviewTexture){const g=y.outputRenderTarget?y.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(y.isIntermediate,g)}for(const p of this._afterCameraPostProcessStage)p.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===y.cameraRigMode||y._renderingMultiview)return y._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(y,void 0,g),void this.onAfterRenderCameraObservable.notifyObservers(y);if(y._useMultiviewToSingleView)this._renderMultiviewToSingleView(y);else{this.onBeforeCameraRenderObservable.notifyObservers(y);for(let g=0;g<y._rigCameras.length;g++)this._renderForCamera(y._rigCameras[g],y)}this._activeCamera=y,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(y)}_checkIntersections(){for(let y=0;y<this._meshesForIntersections.length;y++){const g=this._meshesForIntersections.data[y];if(g.actionManager)for(let y=0;g.actionManager&&y<g.actionManager.actions.length;y++){const f=g.actionManager.actions[y];if(12===f.trigger||13===f.trigger){const y=f.getTriggerParameter(),p=y.mesh?y.mesh:y,S=p.intersectsMesh(g,y.usePreciseIntersection),k=g._intersectionsInProgress.indexOf(p);S&&-1===k?12===f.trigger?(f._executeCurrent(q.CreateNew(g,void 0,p)),g._intersectionsInProgress.push(p)):13===f.trigger&&g._intersectionsInProgress.push(p):!S&&k>-1&&(13===f.trigger&&f._executeCurrent(q.CreateNew(g,void 0,p)),g.actionManager.hasSpecificTrigger(13,(y=>{const g=y.mesh?y.mesh:y;return p===g}))&&13!==f.trigger||g._intersectionsInProgress.splice(k,1))}}}}_advancePhysicsEngineStep(y){}_animate(y){}animate(){if(this._engine.isDeterministicLockStep()){let y=Math.max(yy.MinDeltaTime,Math.min(this._engine.getDeltaTime(),yy.MaxDeltaTime))+this._timeAccumulator;const g=this._engine.getTimeStep(),f=1e3/g/1e3;let p=0;const S=this._engine.getLockstepMaxSteps();let k=Math.floor(y/g);for(k=Math.min(k,S);y>0&&p<k;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=g*f,this._animate(g),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(g),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,p++,y-=g;this._timeAccumulator=y<0?0:y}else{const y=this.useConstantAnimationDeltaTime?16:Math.max(yy.MinDeltaTime,Math.min(this._engine.getDeltaTime(),yy.MaxDeltaTime));this._animationRatio=.06*y,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(y)}}_clear(){(this.autoClearDepthAndStencil||this.Xi)&&this._engine.clear(this._clearColor,this.Xi||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(y){var g;if(null===y||void 0===y||!y.outputRenderTarget||null!==y&&void 0!==y&&y.isRigCamera||(y.outputRenderTarget._cleared=!1),null!==y&&void 0!==y&&null!==(g=y.rigCameras)&&void 0!==g&&g.length)for(let f=0;f<y.rigCameras.length;++f){const g=y.rigCameras[f].outputRenderTarget;g&&(g._cleared=!1)}}resetDrawCache(y){if(this.meshes)for(const g of this.meshes)g.resetDrawCache(y)}_renderWithFrameGraph(){var y;let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),g)for(const S of this.cameras)if(S.update(),0!==S.cameraRigMode)for(let y=0;y<S._rigCameras.length;y++)S._rigCameras[y].update();for(const S of this._beforeClearStage)S.action();const f=this.getActiveMeshCandidates(),p=f.length;for(let S=0;S<p;S++){const y=f.data[S];y.isBlocked||(this._totalVertices.addCount(y.getTotalVertices(),!1),y.isReady()&&y.isEnabled()&&!y.pe.hasAZeroComponent&&(y.Sj(),y.actionManager&&y.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(y)))}if(this.particlesEnabled)for(let S=0;S<this.uj.length;S++){const y=this.uj[S];if(!y.isStarted()||!y.j)continue;const g=y.j;g.position&&!g.isEnabled()||(this._activeParticleSystems.push(y),y.animate())}null===(y=this.frameGraph)||void 0===y||y.execute()}render(){var y;let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(y=this.activeCameras)&&void 0!==y&&y.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),f||this.animate();for(const y of this._beforeCameraUpdateStage)y.action();if(g)if(this.activeCameras&&this.activeCameras.length>0)for(let y=0;y<this.activeCameras.length;y++){const g=this.activeCameras[y];if(g.update(),0!==g.cameraRigMode)for(let y=0;y<g._rigCameras.length;y++)g._rigCameras[y].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let y=0;y<this.activeCamera._rigCameras.length;y++)this.activeCamera._rigCameras[y].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(g,f);else{var S;const y=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const g=null!==(S=this.activeCameras)&&void 0!==S&&S.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){p.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let f=0;f<this.customRenderTargets.length;f++){const p=this.customRenderTargets[f];if(p._shouldRender()){if(this._renderId++,this.activeCamera=p.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");y.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),p.render(g!==this.activeCamera,this.dumpNextRenderTargets)}}p.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===g||void 0===g?void 0:g.renderPassId)??0,this.activeCamera=g,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const f of this._beforeClearStage)f.action();this._clearFrameBuffer(this.activeCamera);for(const f of this._gatherRenderTargetsStage)f.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let f=0;f<this.activeCameras.length;f++)this._processSubCameras(this.activeCameras[f],f>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const y of this._afterRenderStage)y.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let y=0;y<this._toBeDisposed.length;y++){const g=this._toBeDisposed[y];g&&g.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let y=0;y<this.materials.length;y++)this.materials[y].freeze()}unfreezeMaterials(){for(let y=0;y<this.materials.length;y++)this.materials[y].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((y=>{y.onAnimationEndObservable.clear(),y.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const y=this._activeRequests.slice();for(const S of y)S.abort();this._activeRequests.length=0;try{this.nj.notifyObservers(this)}catch(p){t.d.Error("An error occurred while calling onDisposeObservable!",p)}this.Wi();if(this._engine.getInputElement())for(let S=0;S<this.cameras.length;S++)this.cameras[S].Wi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(y=>y.dispose(!0))),this._disposeList(this.transformNodes,(y=>y.dispose(!0)));const g=this.cameras;this._disposeList(g),this.zi&&this.zi.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.uj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let f=this._engine.scenes.indexOf(this);f>-1&&this._engine.scenes.splice(f,1),R.d._LastCreatedScene===this&&(this._engine.scenes.length>0?R.d._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:R.d._LastCreatedScene=null),f=this._engine._virtualScenes.indexOf(this),f>-1&&this._engine._virtualScenes.splice(f,1),this._engine.wipeCaches(!0),this.nj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(y,g){const f=y.slice(0);g=g??(y=>y.dispose());for(const p of f)g(p);y.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let y=0;y<this.meshes.length;y++){const g=this.meshes[y].Hj;g&&g.clearCachedData()}}cleanCachedTextureBuffer(){for(const y of this.textures){y._buffer&&(y._buffer=null)}}getWorldExtends(y){const g=new l.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new l.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return y=y||(()=>!0),this.meshes.filter(y).forEach((y=>{if(y.Sj(!0),!y.og||0===y.og.length||y.infiniteDistance)return;const p=y.getBoundingInfo(),S=p.boundingBox.minimumWorld,k=p.boundingBox.maximumWorld;l.m.CheckExtends(S,g,f),l.m.CheckExtends(k,g,f)})),{min:g,max:f}}createPickingRay(y,g,f,p){throw(0,G.b)("Ray")}createPickingRayToRef(y,g,f,p,S){throw(0,G.b)("Ray")}createPickingRayInCameraSpace(y,g,f){throw(0,G.b)("Ray")}createPickingRayInCameraSpaceToRef(y,g,f,p){throw(0,G.b)("Ray")}bd(y,g,f,p,S,k){const i=(0,G.b)("Ray",!0);return i&&t.d.Warn(i),new C.c}pickWithBoundingInfo(y,g,f,p,S){const k=(0,G.b)("Ray",!0);return k&&t.d.Warn(k),new C.c}pickWithRay(y,g,f,p){throw(0,G.b)("Ray")}multiPick(y,g,f,p,S){throw(0,G.b)("Ray")}multiPickWithRay(y,g,f){throw(0,G.b)("Ray")}setPointerOverMesh(y,g,f){this._inputManager.setPointerOverMesh(y,g,f)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const y of this.geometries)y._rebuild();for(const y of this.meshes)y._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const y of this._components)y.rebuild();for(const y of this.uj)y.rebuild();if(this.spriteManagers)for(const y of this.spriteManagers)y.rebuild()}_rebuildTextures(){for(const y of this.textures)y._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(y,g,f){if(void 0===g)return y;const p=[];for(const S in y){const k=y[S];U.e&&U.e.MatchesQuery(k,g)&&(!f||f(k))&&p.push(k)}return p}getMeshesByTags(y,g){return this._getByTags(this.meshes,y,g)}getCamerasByTags(y,g){return this._getByTags(this.cameras,y,g)}getLightsByTags(y,g){return this._getByTags(this.lights,y,g)}getMaterialByTags(y,g){return this._getByTags(this.materials,y,g).concat(this._getByTags(this.multiMaterials,y,g))}getTransformNodesByTags(y,g){return this._getByTags(this.transformNodes,y,g)}setRenderingOrder(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(y,g,f,p)}setRenderingAutoClearDepthStencil(y,g){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(y,g,f,p)}getAutoClearDepthStencilSetup(y){return this._renderingManager.getAutoClearDepthStencilSetup(y)}_forceBlockMaterialDirtyMechanism(y){this._blockMaterialDirtyMechanism=y}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(y){this._blockMaterialDirtyMechanism!==y&&(this._blockMaterialDirtyMechanism=y,y||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(y,g){if(!this._blockMaterialDirtyMechanism)for(const f of this.materials)g&&!g(f)||f.Vg(y)}_loadFile(y,g,f,p,S,k,i){const H=(0,E.r)(y,g,f,p?this.offlineProvider:void 0,S,k,i);return this._activeRequests.push(H),H.onCompleteObservable.add((y=>{this._activeRequests.splice(this._activeRequests.indexOf(y),1)})),H}_loadFileAsync(y,g,f,p,S){return new Promise(((k,i)=>{this._loadFile(y,(y=>{k(y)}),g,f,p,((y,g)=>{i(g)}),S)}))}_requestFile(y,g,f,p,S,k,i){const H=(0,E.v)(y,g,f,p?this.offlineProvider:void 0,S,k,i);return this._activeRequests.push(H),H.onCompleteObservable.add((y=>{this._activeRequests.splice(this._activeRequests.indexOf(y),1)})),H}_requestFileAsync(y,g,f,p,S){return new Promise(((k,i)=>{this._requestFile(y,(y=>{k(y)}),g,f,p,(y=>{i(y)}),S)}))}_readFile(y,g,f,p,S){const k=(0,E.t)(y,g,f,p,S);return this._activeRequests.push(k),k.onCompleteObservable.add((y=>{this._activeRequests.splice(this._activeRequests.indexOf(y),1)})),k}_readFileAsync(y,g,f){return new Promise(((p,S)=>{this._readFile(y,(y=>{p(y)}),g,f,(y=>{S(y)}))}))}getPerfCollector(){throw(0,G.b)("performanceViewerSceneExtension")}setActiveCameraByID(y){return this.setActiveCameraById(y)}getMaterialByID(y){return this.getMaterialById(y)}getLastMaterialByID(y){return this.getLastMaterialById(y)}getTextureByUniqueID(y){return this.getTextureByUniqueId(y)}getCameraByID(y){return this.getCameraById(y)}getCameraByUniqueID(y){return this.getCameraByUniqueId(y)}getBoneByID(y){return this.getBoneById(y)}getLightByID(y){return this.getLightById(y)}getLightByUniqueID(y){return this.getLightByUniqueId(y)}getParticleSystemByID(y){return this.getParticleSystemById(y)}getGeometryByID(y){return this.getGeometryById(y)}getMeshByID(y){return this.getMeshById(y)}getMeshByUniqueID(y){return this.getMeshByUniqueId(y)}getLastMeshByID(y){return this.getLastMeshById(y)}getMeshesByID(y){return this.getMeshesById(y)}getTransformNodeByID(y){return this.getTransformNodeById(y)}getTransformNodeByUniqueID(y){return this.getTransformNodeByUniqueId(y)}getTransformNodesByID(y){return this.getTransformNodesById(y)}getNodeByID(y){return this.getNodeById(y)}getLastEntryByID(y){return this.getLastEntryById(y)}getLastSkeletonByID(y){return this.getLastSkeletonById(y)}}yy.FOGMODE_NONE=0,yy.FOGMODE_EXP=1,yy.FOGMODE_EXP2=2,yy.FOGMODE_LINEAR=3,yy.MinDeltaTime=1,yy.MaxDeltaTime=1e3,(0,v.c)("BABYLON.Scene",yy)},11149:(y,g,f)=>{"use strict";f.d(g,{e:()=>p,f:()=>S});class p{}p.NAME_EFFECTLAYER="EffectLayer",p.NAME_LAYER="Layer",p.NAME_LENSFLARESYSTEM="LensFlareSystem",p.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",p.NAME_PARTICLESYSTEM="rb",p.NAME_GAMEPAD="Gamepad",p.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",p.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",p.NAME_PREPASSRENDERER="PrePassRenderer",p.NAME_DEPTHRENDERER="DepthRenderer",p.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",p.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",p.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",p.NAME_SPRITE="Sprite",p.NAME_SUBSURFACE="SubSurface",p.NAME_OUTLINERENDERER="Outline",p.NAME_PROCEDURALTEXTURE="ProceduralTexture",p.NAME_SHADOWGENERATOR="ShadowGenerator",p.NAME_OCTREE="tb",p.NAME_PHYSICSENGINE="PhysicsEngine",p.NAME_AUDIO="Audio",p.NAME_FLUIDRENDERER="FluidRenderer",p.STEP_ISREADYFORMESH_EFFECTLAYER=0,p.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,p.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,p.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,p.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,p.STEP_BEFORECAMERADRAW_PREPASS=0,p.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,p.STEP_BEFORECAMERADRAW_LAYER=2,p.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,p.STEP_BEFORERENDERTARGETDRAW_LAYER=1,p.STEP_BEFORERENDERINGMESH_PREPASS=0,p.STEP_BEFORERENDERINGMESH_OUTLINE=1,p.STEP_AFTERRENDERINGMESH_PREPASS=0,p.STEP_AFTERRENDERINGMESH_OUTLINE=1,p.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,p.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,p.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,p.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,p.STEP_BEFORECLEAR_PREPASS=1,p.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,p.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,p.STEP_AFTERRENDERTARGETDRAW_LAYER=1,p.STEP_AFTERCAMERADRAW_PREPASS=0,p.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,p.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,p.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,p.STEP_AFTERCAMERADRAW_LAYER=4,p.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,p.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,p.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,p.STEP_AFTERRENDER_AUDIO=0,p.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,p.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,p.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,p.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,p.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,p.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,p.STEP_POINTERMOVE_SPRITE=0,p.STEP_POINTERDOWN_SPRITE=0,p.STEP_POINTERUP_SPRITE=0;class S extends Array{constructor(y){super(...y)}static Create(){return Object.create(S.prototype)}registerStep(y,g,f){let p=0,S=Number.MAX_VALUE;for(;p<this.length;p++){if(S=this[p].index,y<S)break}this.splice(p,0,{index:y,component:g,action:f.bind(g)})}clear(){this.length=0}}},11021:(y,g,f)=>{"use strict";f.d(g,{c:()=>p});function p(y,g,f,p){var S,k=arguments.length,i=k<3?g:null===p?p=Object.getOwnPropertyDescriptor(g,f):p;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(y,g,f,p);else for(var H=y.length-1;H>=0;H--)(S=y[H])&&(i=(k<3?S(i):k>3?S(g,f,i):S(g,f))||i);return k>3&&i&&Object.defineProperty(g,f,i),i}Object.create;Object.create},12217:(y,g,f)=>{"use strict";class p{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((y,g)=>{this._resolve=y,this._reject=g}))}}var S=f(11054),k=f(11090),i=f(10714),H=f(11334),U=f(12224),l=f(12235),c=f(10723),Z=f(11521),C=f(12241),q=f(12245),W=f(10761),j=f(10736),P=f(10740);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(y){this._useTextureToStoreBoneMatrices=y,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(y,g,f){this.name=y,this.id=g,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=S.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new c.d,this.bones=[],this._scene=f||W.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const p=this._scene.getEngine().getCaps();this._canUseTextureForBones=p.textureFloat&&p.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((y=>!y.getParent()))}getTransformMatrices(y){if(this.needInitialSkinMatrix){if(!y)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return y._bonesTransformMatrices||this.prepare(!0),y._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(y){return this.needInitialSkinMatrix&&y._transformMatrixTexture?y._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(y){let g=`Name: ${this.name}, nBones: ${this.bones.length}`;if(g+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,y){g+=", Ranges: {";let y=!0;for(const f in this._ranges)y&&(g+=", ",y=!1),g+=f;g+="}"}return g}getBoneIndexByName(y){for(let g=0,f=this.bones.length;g<f;g++)if(this.bones[g].name===y)return g;return-1}createAnimationRange(y,g,f){if(!this._ranges[y]){this._ranges[y]=new q.e(y,g,f);for(let p=0,S=this.bones.length;p<S;p++)this.bones[p].animations[0]&&this.bones[p].animations[0].createRange(y,g,f)}}deleteAnimationRange(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let f=0,p=this.bones.length;f<p;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].deleteRange(y,g);this._ranges[y]=null}getAnimationRange(y){return this._ranges[y]||null}getAnimationRanges(){const y=[];let g;for(g in this._ranges)y.push(this._ranges[g]);return y}copyAnimationRange(y,g){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[g]||!y.getAnimationRange(g))return!1;let p=!0;const S=this._getHighestAnimationFrame()+1,k={},i=y.bones;let H,U;for(U=0,H=i.length;U<H;U++)k[i[U].name]=i[U];this.bones.length!==i.length&&(j.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${i.length}`),p=!1);const l=f&&this.dimensionsAtRest&&y.dimensionsAtRest?this.dimensionsAtRest.divide(y.dimensionsAtRest):null;for(U=0,H=this.bones.length;U<H;U++){const y=this.bones[U].name,i=k[y];i?p=p&&this.bones[U].copyAnimationRange(i,g,S,f,l):(j.d.Warn("copyAnimationRange: not same rig, missing source bone "+y),p=!1)}const c=y.getAnimationRange(g);return c&&(this._ranges[g]=new q.e(g,c.from+S,c.to+S)),p}returnToRest(){for(const y of this.bones)-1!==y._index&&y.returnToRest()}_getHighestAnimationFrame(){let y=0;for(let g=0,f=this.bones.length;g<f;g++)if(this.bones[g].animations[0]){const f=this.bones[g].animations[0].getHighestFrame();y<f&&(y=f)}return y}beginAnimation(y,g,f,p){const S=this.getAnimationRange(y);return S?this._scene.beginAnimation(this,S.from,S.to,g,f,p):null}static MakeAnimationAdditive(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;const p=y.getAnimationRange(f);if(!p)return null;const S=y._scene.getAllAnimatablesByTarget(y);let k=null;for(let H=0;H<S.length;H++){const y=S[H];if(y.fromFrame===(null===p||void 0===p?void 0:p.from)&&y.toFrame===(null===p||void 0===p?void 0:p.to)){k=y;break}}const i=y.getAnimatables();for(let H=0;H<i.length;H++){const y=i[H].animations;if(y)for(let p=0;p<y.length;p++)C.c.MakeAnimationAdditive(y[p],g,f)}return k&&(k.isAdditive=!0),y}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(y){this._meshesWithPoseMatrix.push(y)}_unregisterMeshWithPoseMatrix(y){const g=this._meshesWithPoseMatrix.indexOf(y);g>-1&&this._meshesWithPoseMatrix.splice(g,1)}_computeTransformMatrices(y,g){this.onBeforeComputeObservable.notifyObservers(this);for(let f=0;f<this.bones.length;f++){const p=this.bones[f];p._childUpdateId++;const S=p.getParent();if(S?p.getLocalMatrix().multiplyToRef(S.getFinalMatrix(),p.getFinalMatrix()):g?p.getLocalMatrix().multiplyToRef(g,p.getFinalMatrix()):p.getFinalMatrix().p(p.getLocalMatrix()),-1!==p._index){const g=null===p._index?f:p._index;p.getAbsoluteInverseBindMatrix().multiplyToArray(p.getFinalMatrix(),y,16*g)}}this._identity.copyToArray(y,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const y=this.va().getRenderId();if(this._currentRenderId===y)return;this._currentRenderId=y}if(this._numBonesWithLinkedTransformNode>0)for(const y of this.bones)if(y._linkedTransformNode){const g=y._linkedTransformNode;y.position=g.position,g.rotationQuaternion?y.rotationQuaternion=g.rotationQuaternion:y.rotation=g.rotation,y.pe=g.pe}if(this.needInitialSkinMatrix)for(const y of this._meshesWithPoseMatrix){const g=y.getPoseMatrix();let f=this._isDirty;if(y._bonesTransformMatrices&&y._bonesTransformMatrices.length===16*(this.bones.length+1)||(y._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),f=!0),f){if(this._synchronizedWithMesh!==y){this._synchronizedWithMesh=y;for(const y of this.bones)if(!y.getParent()){y.getBindMatrix().multiplyToRef(g,S.j.Matrix[1]),y._updateAbsoluteBindMatrices(S.j.Matrix[1])}if(this.isUsingTextureForMatrices){const g=4*(this.bones.length+1);y._transformMatrixTexture&&y._transformMatrixTexture.getSize().width===g||(y._transformMatrixTexture&&y._transformMatrixTexture.dispose(),y._transformMatrixTexture=Z.d.CreateRGBATexture(y._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(y._bonesTransformMatrices,g),this.isUsingTextureForMatrices&&y._transformMatrixTexture&&y._transformMatrixTexture.update(y._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Z.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let y=0;y<this.bones.length;y++)this._animatables.push(this.bones[y])}return this._animatables}clone(y,g){const f=new B(y,g||y,this._scene);f.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let p=0;p<this.bones.length;p++){const y=this.bones[p];let g=null;const S=y.getParent();if(S){const y=this.bones.indexOf(S);g=f.bones[y]}const k=new l.d(y.name,f,g,y.getBindMatrix().clone(),y.getRestMatrix().clone());k._index=y._index,y._linkedTransformNode&&k.linkTransformNode(y._linkedTransformNode),P.b.DeepCopy(y.animations,k.animations)}if(this._ranges){f._ranges={};for(const y in this._ranges){const g=this._ranges[y];g&&(f._ranges[y]=g.clone())}}return this._isDirty=!0,f.prepare(!0),f}enableBlending(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((g=>{g.animations.forEach((g=>{g.enableBlending=!0,g.blendingSpeed=y}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const y=this._parentContainer.skeletons.indexOf(this);y>-1&&this._parentContainer.skeletons.splice(y,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const y={};y.name=this.name,y.id=this.id,this.dimensionsAtRest&&(y.dimensionsAtRest=this.dimensionsAtRest.mj()),y.bones=[],y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let f=0;f<this.bones.length;f++){var g;const p=this.bones[f],S=p.getParent(),k={parentBoneIndex:S?this.bones.indexOf(S):-1,index:p.getIndex(),name:p.name,id:p.id,matrix:p.getBindMatrix().mj(),rest:p.getRestMatrix().mj(),linkedTransformNodeId:null===(g=p.getTransformNode())||void 0===g?void 0:g.id};y.bones.push(k),p.length&&(k.length=p.length),p.metadata&&(k.metadata=p.metadata),p.animations&&p.animations.length>0&&(k.animation=p.animations[0].serialize()),y.ranges=[];for(const g in this._ranges){const f=this._ranges[g];if(!f)continue;const p={};p.name=g,p.from=f.from,p.to=f.to,y.ranges.push(p)}}return y}static Parse(y,g){const f=new B(y.name,y.id,g);let p;for(y.dimensionsAtRest&&(f.dimensionsAtRest=S.m.eh(y.dimensionsAtRest)),f.needInitialSkinMatrix=y.needInitialSkinMatrix,p=0;p<y.bones.length;p++){const g=y.bones[p],k=y.bones[p].index;let i=null;g.parentBoneIndex>-1&&(i=f.bones[g.parentBoneIndex]);const H=g.rest?S.c.eh(g.rest):null,U=new l.d(g.name,f,i,S.c.eh(g.matrix),H,null,k);void 0!==g.id&&null!==g.id&&(U.id=g.id),g.length&&(U.length=g.length),g.metadata&&(U.metadata=g.metadata),g.animation&&U.animations.push(C.c.Parse(g.animation)),void 0!==g.linkedTransformNodeId&&null!==g.linkedTransformNodeId&&(f._hasWaitingData=!0,U._waitingTransformNodeId=g.linkedTransformNodeId)}if(y.ranges)for(p=0;p<y.ranges.length;p++){const g=y.ranges[p];f.createAnimationRange(g.name,g.from,g.to)}return f}computeAbsoluteMatrices(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||y)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(y)}getPoseMatrix(){let y=null;return this._meshesWithPoseMatrix.length>0&&(y=this._meshesWithPoseMatrix[0].getPoseMatrix()),y}sortBones(){const y=[],g=new Array(this.bones.length);for(let f=0;f<this.bones.length;f++)this._sortBones(f,y,g);this.bones=y}_sortBones(y,g,f){if(f[y])return;f[y]=!0;const p=this.bones[y];if(!p)return;void 0===p._index&&(p._index=y);const S=p.getParent();S&&this._sortBones(this.bones.indexOf(S),g,f),g.push(p)}setCurrentPoseAsRest(){this.bones.forEach((y=>{y.setCurrentPoseAsRest()}))}}var R=f(11206),G=f(11021),z=f(11026),T=f(12253),Q=f(12268),m=f(10871),a=f(11099);class w extends Q.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(y){this.subSurface.refractionTexture=y,y?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(y){this.subSurface.indexOfRefraction=y}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(y){this.subSurface.invertRefractionY=y}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(y){this.subSurface.linkRefractionWithTransparency=y,y&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===Q.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(y){y!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=y?Q.b.LIGHTFALLOFF_PHYSICAL:Q.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===Q.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(y){y!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=y?Q.b.LIGHTFALLOFF_GLTF:Q.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(y){this._attachImageProcessingConfiguration(y),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(y){this.imageProcessingConfiguration.colorCurvesEnabled=y}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(y){this.imageProcessingConfiguration.colorGradingEnabled=y}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(y){this._imageProcessingConfiguration.toneMappingEnabled=y}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(y){this._imageProcessingConfiguration.exposure=y}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(y){this._imageProcessingConfiguration.contrast=y}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(y){this._imageProcessingConfiguration.colorGradingTexture=y}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(y){this._imageProcessingConfiguration.colorCurves=y}constructor(y,g){super(y,g,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=w.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=k.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new k.c(0,0,0),this.albedoColor=new k.c(1,1,1),this.reflectivityColor=new k.c(1,1,1),this.reflectionColor=new k.c(1,1,1),this.emissiveColor=new k.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,T.c)(this.va())}getClassName(){return"PBRMaterial"}clone(y){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const p=a.c.Clone((()=>new w(y,this.va())),this,{cloneTexturesOnlyOnce:g});return p.id=y,p.name=y,this.stencil.copyTo(p.stencil),this._clonePlugins(p,f),p}serialize(){const y=super.serialize();return y.customType="BABYLON.PBRMaterial",y}static Parse(y,g,f){const p=a.c.Parse((()=>new w(y.name,g)),y,g,f);return y.stencil&&p.stencil.parse(y.stencil,g,f),R.c._ParsePlugins(y,p,g,f),y.clearCoat&&p.clearCoat.parse(y.clearCoat,g,f),y.anisotropy&&p.anisotropy.parse(y.anisotropy,g,f),y.brdf&&p.brdf.parse(y.brdf,g,f),y.sheen&&p.sheen.parse(y.sheen,g,f),y.subSurface&&p.subSurface.parse(y.subSurface,g,f),y.iridescence&&p.iridescence.parse(y.iridescence,g,f),p}}w.PBRMATERIAL_OPAQUE=Q.b.PBRMATERIAL_OPAQUE,w.PBRMATERIAL_ALPHATEST=Q.b.PBRMATERIAL_ALPHATEST,w.PBRMATERIAL_ALPHABLEND=Q.b.PBRMATERIAL_ALPHABLEND,w.PBRMATERIAL_ALPHATESTANDBLEND=Q.b.PBRMATERIAL_ALPHATESTANDBLEND,w.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=Q.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"directIntensity",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"emissiveIntensity",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"environmentIntensity",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"specularIntensity",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"disableBumpMap",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"albedoTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"ambientTexture",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"ambientTextureStrength",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"opacityTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"reflectionTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"emissiveTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"reflectivityTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"metallicTexture",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"metallic",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"roughness",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"metallicF0Factor",void 0),(0,G.c)([(0,z.l)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"metallicReflectanceColor",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"metallicReflectanceTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"reflectanceTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"microSurfaceTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"bumpTexture",void 0),(0,G.c)([(0,z.E)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty",null)],w.prototype,"lightmapTexture",void 0),(0,G.c)([(0,z.l)("ambient"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"ambientColor",void 0),(0,G.c)([(0,z.l)("albedo"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"albedoColor",void 0),(0,G.c)([(0,z.l)("reflectivity"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"reflectivityColor",void 0),(0,G.c)([(0,z.l)("reflection"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"reflectionColor",void 0),(0,G.c)([(0,z.l)("emissive"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"emissiveColor",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"microSurface",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useLightmapAsShadowmap",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"useAlphaFromAlbedoTexture",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"forceAlphaTest",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],w.prototype,"alphaCutOff",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useSpecularOverAlpha",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useAmbientInGrayScale",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,G.c)([(0,z.I)()],w.prototype,"usePhysicalLightFalloff",null),(0,G.c)([(0,z.I)()],w.prototype,"useGLTFLightFalloff",null),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useRadianceOverAlpha",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useObjectSpaceNormalMap",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useParallax",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useParallaxOcclusion",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"parallaxScaleBias",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsLightsDirty")],w.prototype,"disableLighting",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"forceIrradianceInFragment",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsLightsDirty")],w.prototype,"maxSimultaneousLights",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"invertNormalMapX",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"invertNormalMapY",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"twoSidedLighting",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useAlphaFresnel",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useLinearAlphaFresnel",void 0),(0,G.c)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"environmentBRDFTexture",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"forceNormalForward",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"enableSpecularAntiAliasing",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useHorizonOcclusion",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useRadianceOcclusion",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],w.prototype,"unlit",void 0),(0,G.c)([(0,z.I)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],w.prototype,"applyDecalMapAfterDetailMap",void 0),(0,m.c)("BABYLON.PBRMaterial",w);var o=f(11267),I=f(11376),Y=f(11131),n=f(11356),M=f(11368),r=f(11321);class N{get influence(){return this._influence}set influence(y){if(this._influence===y)return;const g=this._influence;this._influence=y,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===g||0===y)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=y,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new c.d,this._onDataLayoutChanged=new c.d,this._animationPropertiesOverride=null,this.id=y,this._scene=f||W.d.LastCreatedScene,this.influence=g,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(y){const g=this.hasPositions;this._positions=y,g!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(y){const g=this.hasNormals;this._normals=y,g!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(y){const g=this.hasTangents;this._tangents=y,g!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(y){const g=this.hasUVs;this._uvs=y,g!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const y=a.c.Clone((()=>new N(this.name,this.influence,this._scene)),this);return y._positions=this._positions,y._normals=this._normals,y._tangents=this._tangents,y._uvs=this._uvs,y}serialize(){const y={};return y.name=this.name,y.influence=this.influence,y.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(y.id=this.id),this.hasNormals&&(y.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(y.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(y.Aa=Array.prototype.slice.call(this.getUVs())),a.c.AppendSerializedAnimations(this,y),y}getClassName(){return"MorphTarget"}static Parse(y,g){const f=new N(y.name,y.influence);if(f.setPositions(y.xa),null!=y.id&&(f.id=y.id),y.ya&&f.setNormals(y.ya),y.tangents&&f.setTangents(y.tangents),y.Aa&&f.setUVs(y.Aa),y.animations){for(let g=0;g<y.animations.length;g++){const p=y.animations[g],S=(0,m.b)("BABYLON.Animation");S&&f.animations.push(S.Parse(p))}y.autoAnimate&&g&&g.beginAnimation(f,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1)}return f}static FromMesh(y,g,f){g||(g=y.name);const p=new N(g,f,y.va());return p.setPositions(y.getVerticesData(Y.c.PositionKind)),y.isVerticesDataPresent(Y.c.NormalKind)&&p.setNormals(y.getVerticesData(Y.c.NormalKind)),y.isVerticesDataPresent(Y.c.TangentKind)&&p.setTangents(y.getVerticesData(Y.c.TangentKind)),y.isVerticesDataPresent(Y.c.UVKind)&&p.setUVs(y.getVerticesData(Y.c.UVKind)),p}}(0,G.c)([(0,z.I)()],N.prototype,"id",void 0);var b=f(11036),s=f(11896);class u{set areUpdatesFrozen(y){y?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new b.i(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,y||(y=W.d.LastCreatedScene),this._scene=y,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const y=this._scene.getEngine().getCaps();this._canUseTextureForTargets=y.canUseGLVertexID&&y.textureFloat&&y.maxVertexTextureImageUnits>0&&y.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(y){this._numMaxInfluencers!==y&&(this._numMaxInfluencers=y,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(y){this._useTextureToStoreTargets=y}get isUsingTextureForTargets(){var y;return u.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(y=this._scene)&&void 0!==y&&y.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(y){return this._activeTargets.data[y]}getTarget(y){return this._targets[y]}getTargetByName(y){for(const g of this._targets)if(g.name===y)return g;return null}addTarget(y){this._targets.push(y),this._targetInfluenceChangedObservers.push(y.onInfluenceChanged.add((y=>{this._syncActiveTargets(y)}))),this._targetDataLayoutChangedObservers.push(y._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(y){const g=this._targets.indexOf(y);g>=0&&(this._targets.splice(g,1),y.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(g,1)[0]),y._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(g,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(y)}_bind(y){y.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),y.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),y.setTexture("morphTargets",this._targetStoreTexture),y.setInt("morphTargetCount",this.numInfluencers)}clone(){const y=new u(this._scene);for(const g of this._targets)y.addTarget(g.clone());return y.enableNormalMorphing=this.enableNormalMorphing,y.enableTangentMorphing=this.enableTangentMorphing,y.enableUVMorphing=this.enableUVMorphing,y}serialize(){const y={};y.id=this.uniqueId,y.targets=[];for(const g of this._targets)y.targets.push(g.serialize());return y}_syncActiveTargets(y){if(this.areUpdatesFrozen)return;let g=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let f=-1;for(const p of this._targets){if(f++,0===p.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=u.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(p),this._morphTargetTextureIndices[g]=f,this._tempInfluences[g++]=p.influence,this._supportsNormals=this._supportsNormals&&p.hasNormals,this._supportsTangents=this._supportsTangents&&p.hasTangents,this._supportsUVs=this._supportsUVs&&p.hasUVs;const y=p.getPositions();if(y){const g=y.length/3;if(0===this._vertexCount)this._vertexCount=g;else if(this._vertexCount!==g)return void j.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==g&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,g)),this._influences&&this._influences.length===g||(this._influences=new Float32Array(g));for(let p=0;p<g;p++)this._influences[p]=this._tempInfluences[p];y&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const y=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>y&&(this._textureHeight=Math.ceil(this._textureWidth/y),this._textureWidth=y);let g=!0;if(this._targetStoreTexture){const y=this._targetStoreTexture.getSize();y.width===this._textureWidth&&y.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(g=!1)}if(g){this._targetStoreTexture&&this._targetStoreTexture.dispose();const y=this._targets.length,g=new Float32Array(y*this._textureWidth*this._textureHeight*4);let f=0;for(let p=0;p<y;p++){const y=this._targets[p],S=y.getPositions(),k=y.getNormals(),i=y.getUVs(),H=y.getTangents();if(!S)return void(0===p&&j.d.Error("Invalid morph target. Target must have positions."));f=p*this._textureWidth*this._textureHeight*4;for(let p=0;p<this._vertexCount;p++)g[f]=S[3*p],g[f+1]=S[3*p+1],g[f+2]=S[3*p+2],f+=4,this._supportsNormals&&k&&(g[f]=k[3*p],g[f+1]=k[3*p+1],g[f+2]=k[3*p+2],f+=4),this._supportsUVs&&i&&(g[f]=i[2*p],g[f+1]=i[2*p+1],f+=4),this._supportsTangents&&H&&(g[f]=H[3*p],g[f+1]=H[3*p+1],g[f+2]=H[3*p+2],f+=4)}this._targetStoreTexture=s.e.CreateRGBATexture(g,this._textureWidth,this._textureHeight,y,this._scene,!1,!1,1,1)}}for(const y of this._scene.meshes)y.morphTargetManager===this&&y._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const y=this._parentContainer.morphTargetManagers.indexOf(this);y>-1&&this._parentContainer.morphTargetManagers.splice(y,1),this._parentContainer=null}for(const y of this._targets)this._scene.stopAnimation(y)}}static Parse(y,g){const f=new u(g);for(const p of y.targets)f.addTarget(N.Parse(p,g));return f}}u.EnableTextureStorage=!0,u.MaxActiveMorphTargetsInVertexAttributeMode=8;var F=f(12276),A=f(10766),J=f(11221);function V(y,g,f,p){return S.m.eh(g,f).scaleInPlace(p)}class e{constructor(y,g,f,p){this.type=y,this.name=g,this.getValue=f,this.getStride=p}_buildAnimation(y,g,f){const p=new C.c(y,this.name,g,this.type);return p.setKeys(f),p}}class h extends e{buildAnimations(y,g,f,p,S){S(y._babylonTransformNode,this._buildAnimation(g,f,p))}}const D={translation:[new h(C.c.ANIMATIONTYPE_VECTOR3,"position",V,(()=>3))],rotation:[new h(C.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(y,g,f,p){return S.g.eh(g,f).scaleInPlace(p)}),(()=>4))],scale:[new h(C.c.ANIMATIONTYPE_VECTOR3,"pe",V,(()=>3))],weights:[new class extends e{buildAnimations(y,g,f,p,S){if(y._numMorphTargets)for(let k=0;k<y._numMorphTargets;k++){const i=new C.c(`${g}_${k}`,this.name,f,this.type);if(i.setKeys(p.map((y=>({frame:y.frame,inTangent:y.inTangent?y.inTangent[k]:void 0,value:y.value[k],outTangent:y.outTangent?y.outTangent[k]:void 0,interpolation:y.interpolation})))),y._primitiveBabylonMeshes)for(const g of y._primitiveBabylonMeshes)if(g.morphTargetManager){const y=g.morphTargetManager.getTarget(k),f=i.clone();y.animations.push(f),S(y,f)}}}}(C.c.ANIMATIONTYPE_FLOAT,"influence",(function(y,g,f,p){const S=new Array(y._numMorphTargets);for(let k=0;k<S.length;k++)S[k]=g[f++]*p;return S}),(y=>y._numMorphTargets))]},K=new Map,X=K;function E(y,g,f){O(y)&&j.d.Warn(`Extension with the name '${y}' already exists`),K.set(y,{isGLTFExtension:g,factory:f})}function O(y){return K.delete(y)}function L(){const y=y=>y&&"object"===typeof y;for(var g=arguments.length,f=new Array(g),p=0;p<g;p++)f[p]=arguments[p];return f.reduce(((g,f)=>(Object.keys(f).forEach((p=>{const S=g[p],k=f[p];Array.isArray(S)&&Array.isArray(k)?g[p]=S.concat(...k):y(S)&&y(k)?g[p]=L(S,k):g[p]=k})),g)),{})}class x{static Get(y,g,f){if(!g||void 0==f||!g[f])throw new Error(`${y}: Failed to find index (${f})`);return g[f]}static TryGet(y,g){return y&&void 0!=g&&y[g]?y[g]:null}static Assign(y){if(y)for(let g=0;g<y.length;g++)y[g].index=g}}class d{static RegisterExtension(y,g){E(y,!1,g)}static UnregisterExtension(y){return O(y)}get Si(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(y){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=y}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((y=>y.dispose&&y.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(y,g,f,p,S,k){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=g,this._assetContainer=f,this._loadData(p);let k=null;if(y){const g={};if(this._gltf.nodes)for(const y of this._gltf.nodes)y.name&&(g[y.name]=y.index);k=(y instanceof Array?y:[y]).map((y=>{const f=g[y];if(void 0===f)throw new Error(`Failed to find node '${y}'`);return f}))}return this._loadAsync(S,i,k,(()=>({meshes:this._getMeshes(),uj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=y,this._loadData(g),this._loadAsync(f,S,null,(()=>{})))))}_loadAsync(y,g,f,p){return Promise.resolve().then((async()=>{this._rootUrl=y,this._uniqueRootUrl=!y.startsWith("file:")&&g?y:`${y}${Date.now()}/`,this._fileName=g,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const S=`${F.m[F.m.LOADING]} => ${F.m[F.m.READY]}`,k=`${F.m[F.m.LOADING]} => ${F.m[F.m.COMPLETE]}`;this._parent._startPerformanceCounter(S),this._parent._startPerformanceCounter(k),this._parent._setState(F.m.LOADING),this._extensionsOnLoading();const H=new Array;if(!this.parent.loadOnlyMaterials)if(f)H.push(this.loadSceneAsync("/nodes",{nodes:f,index:-1}));else if(void 0!=this._gltf.Oc||this._gltf.scenes&&this._gltf.scenes[0]){const y=x.Get("/scene",this._gltf.scenes,this._gltf.Oc||0);H.push(this.loadSceneAsync(`/scenes/${y.index}`,y))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let y=0;y<this._gltf.materials.length;++y){const g=this._gltf.materials[y],f="/materials/"+y,p=R.c.TriangleFillMode;H.push(this._loadMaterialAsync(f,g,null,p,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&H.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&H.push(this._compileShadowGeneratorsAsync());return Promise.all(H).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Mb(!0),this._extensionsOnReady(),this._parent._setState(F.m.READY),this._startAnimations(),p()))).then((y=>(this._parent._endPerformanceCounter(S),i.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(k),this._parent._setState(F.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(y=>{this._parent.onErrorObservable.notifyObservers(y),this._parent.onErrorObservable.clear(),this.dispose()}))})),y)))})).catch((y=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(y),this._parent.onErrorObservable.clear(),this.dispose()),y}))}_loadData(y){if(this._gltf=y.json,this._setupData(),y.bin){const g=this._gltf.buffers;if(g&&g[0]&&!g[0].uri){const f=g[0];(f.byteLength<y.bin.byteLength-3||f.byteLength>y.bin.byteLength)&&j.d.Warn(`Binary buffer length (${f.byteLength}) from JSON does not match chunk length (${y.bin.byteLength})`),this._bin=y.bin}else j.d.Warn("Unexpected BIN chunk")}}_setupData(){if(x.Assign(this._gltf.accessors),x.Assign(this._gltf.animations),x.Assign(this._gltf.buffers),x.Assign(this._gltf.bufferViews),x.Assign(this._gltf.cameras),x.Assign(this._gltf.images),x.Assign(this._gltf.materials),x.Assign(this._gltf.meshes),x.Assign(this._gltf.nodes),x.Assign(this._gltf.samplers),x.Assign(this._gltf.scenes),x.Assign(this._gltf.skins),x.Assign(this._gltf.textures),this._gltf.nodes){const y={};for(const f of this._gltf.nodes)if(f.children)for(const g of f.children)y[g]=f.index;const g=this._createRootNode();for(const f of this._gltf.nodes){const p=y[f.index];f.parent=void 0===p?g:this._gltf.nodes[p]}}}async _loadExtensionsAsync(){const y=[];if(X.forEach(((g,f)=>{var p;!1===(null===(p=this.parent.extensionOptions[f])||void 0===p?void 0:p.enabled)?g.isGLTFExtension&&this.isExtensionUsed(f)&&j.d.Warn(`Extension ${f} is used but has been explicitly disabled.`):g.isGLTFExtension&&!this.isExtensionUsed(f)||y.push((async()=>{const y=await g.factory(this);return y.name!==f&&j.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${y.name} !== ${f}`),this._parent.onExtensionLoadedObservable.notifyObservers(y),y})())})),this._extensions.push(...await Promise.all(y)),this._extensions.sort(((y,g)=>(y.order||Number.MAX_VALUE)-(g.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const f of this._gltf.extensionsRequired){if(!this._extensions.some((y=>y.name===f&&y.enabled))){var g;if(!1===(null===(g=this.parent.extensionOptions[f])||void 0===g?void 0:g.enabled))throw new Error(`Required extension ${f} is disabled`);throw new Error(`Required extension ${f} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new r.e("__root__",this._babylonScene);this._rootBabylonMesh=y,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Mb(!1);const g={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case F.j.AUTO:this._babylonScene.useRightHandedSystem||(g.rotation=[0,1,0,0],g.scale=[1,1,-1],d._LoadTransform(g,this._rootBabylonMesh));break;case F.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(y),g}loadSceneAsync(y,g){const f=this._extensionsLoadSceneAsync(y,g);if(f)return f;const p=new Array;if(this.logOpen(`${y} ${g.name||""}`),g.nodes)for(const S of g.nodes){const g=x.Get(`${y}/nodes/${S}`,this._gltf.nodes,S);p.push(this.loadNodeAsync(`/nodes/${g.index}`,g,(y=>{y.parent=this._rootBabylonMesh})))}for(const S of this._postSceneLoadActions)S();return p.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(p).then((()=>{}))}_forEachPrimitive(y,g){if(y._primitiveBabylonMeshes)for(const f of y._primitiveBabylonMeshes)g(f)}_getGeometries(){const y=[],g=this._gltf.nodes;if(g)for(const f of g)this._forEachPrimitive(f,(g=>{const f=g.Hj;f&&-1===y.indexOf(f)&&y.push(f)}));return y}_getMeshes(){const y=[];this._rootBabylonMesh instanceof M.c&&y.push(this._rootBabylonMesh);const g=this._gltf.nodes;if(g)for(const f of g)this._forEachPrimitive(f,(g=>{y.push(g)}));return y}_getTransformNodes(){const y=[],g=this._gltf.nodes;if(g)for(const f of g)f._babylonTransformNode&&"qb"===f._babylonTransformNode.getClassName()&&y.push(f._babylonTransformNode),f._babylonTransformNodeForSkin&&y.push(f._babylonTransformNodeForSkin);return y}_getSkeletons(){const y=[],g=this._gltf.skins;if(g)for(const f of g)f._data&&y.push(f._data.babylonSkeleton);return y}_getAnimationGroups(){const y=[],g=this._gltf.animations;if(g)for(const f of g)f._babylonAnimationGroup&&y.push(f._babylonAnimationGroup);return y}_startAnimations(){switch(this._parent.animationStartMode){case F.f.NONE:break;case F.f.FIRST:{const y=this._getAnimationGroups();0!==y.length&&y[0].start(!0);break}case F.f.ALL:{const y=this._getAnimationGroups();for(const g of y)g.start(!0);break}default:return void j.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const p=this._extensionsLoadNodeAsync(y,g,f);if(p)return p;if(g._babylonTransformNode)throw new Error(`${y}: Invalid recursive node hierarchy`);const S=new Array;this.logOpen(`${y} ${g.name||""}`);const k=p=>{if(d.AddPointerMetadata(p,y),d._LoadTransform(g,p),void 0!=g.camera){const f=x.Get(`${y}/camera`,this._gltf.cameras,g.camera);S.push(this.loadCameraAsync(`/cameras/${f.index}`,f,(y=>{y.parent=p})))}if(g.children)for(const f of g.children){const g=x.Get(`${y}/children/${f}`,this._gltf.nodes,f);S.push(this.loadNodeAsync(`/nodes/${g.index}`,g,(y=>{y.parent=p})))}f(p)},i=void 0!=g.mesh,H=this._parent.loadSkins&&void 0!=g.skin;if(!i||H){const y=g.name||`node${g.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new I.d(y,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==g.mesh?g._babylonTransformNode=f:g._babylonTransformNodeForSkin=f,k(f)}if(i)if(H){const f=x.Get(`${y}/mesh`,this._gltf.meshes,g.mesh);S.push(this._loadMeshAsync(`/meshes/${f.index}`,g,f,(f=>{const p=g._babylonTransformNodeForSkin;f.metadata=L(p.metadata,f.metadata||{});const k=x.Get(`${y}/skin`,this._gltf.skins,g.skin);S.push(this._loadSkinAsync(`/skins/${k.index}`,g,k,(y=>{this._forEachPrimitive(g,(g=>{g.skeleton=y})),this._postSceneLoadActions.push((()=>{if(void 0!=k.skeleton){const y=x.Get(`/skins/${k.index}/skeleton`,this._gltf.nodes,k.skeleton).parent;g.index===y.index?f.parent=p.parent:f.parent=y._babylonTransformNode}else f.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:p,skinnedNode:f})}))})))})))}else{const f=x.Get(`${y}/mesh`,this._gltf.meshes,g.mesh);S.push(this._loadMeshAsync(`/meshes/${f.index}`,g,f,k))}return this.logClose(),Promise.all(S).then((()=>(this._forEachPrimitive(g,(y=>{y.Hj&&y.Hj.useBoundingInfoFromGeometry?y.Ea():y.refreshBoundingInfo(!0,!0)})),g._babylonTransformNode)))}_loadMeshAsync(y,g,f,p){const S=f.primitives;if(!S||!S.length)throw new Error(`${y}: Primitives are missing`);void 0==S[0].index&&x.Assign(S);const k=new Array;this.logOpen(`${y} ${f.name||""}`);const i=g.name||`node${g.index}`;if(1===S.length){const p=f.primitives[0];k.push(this._loadMeshPrimitiveAsync(`${y}/primitives/${p.index}`,i,g,f,p,(y=>{g._babylonTransformNode=y,g._primitiveBabylonMeshes=[y]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,g._babylonTransformNode=new I.d(i,this._babylonScene),g._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g._primitiveBabylonMeshes=[];for(const p of S)k.push(this._loadMeshPrimitiveAsync(`${y}/primitives/${p.index}`,`${i}_primitive${p.index}`,g,f,p,(y=>{y.parent=g._babylonTransformNode,g._primitiveBabylonMeshes.push(y)})))}return p(g._babylonTransformNode),this.logClose(),Promise.all(k).then((()=>g._babylonTransformNode))}_loadMeshPrimitiveAsync(y,g,f,p,S,k){const i=this._extensionsLoadMeshPrimitiveAsync(y,g,f,p,S,k);if(i)return i;this.logOpen(`${y}`);const H=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==f.skin&&!p.primitives[0].targets;let U,l;if(H&&S._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,U=S._instanceData.babylonSourceMesh.createInstance(g),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l=S._instanceData.promise;else{const k=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new r.e(g,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.sideOrientation=this._babylonScene.useRightHandedSystem?R.c.CounterClockWiseSideOrientation:R.c.ClockWiseSideOrientation,this._createMorphTargets(y,f,p,S,i),k.push(this._loadVertexDataAsync(y,S,i).then((g=>this._loadMorphTargetsAsync(y,S,i,g).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,g.Ca(i),g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const c=d._GetDrawMode(y,S.mode);if(void 0==S.material){let y=this._defaultBabylonMaterialData[c];y||(y=this._createDefaultMaterial("__GLTFLoader._default",c),this._parent.onMaterialLoadedObservable.notifyObservers(y),this._defaultBabylonMaterialData[c]=y),i.material=y}else if(!this.parent.skipMaterials){const g=x.Get(`${y}/material`,this._gltf.materials,S.material);k.push(this._loadMaterialAsync(`/materials/${g.index}`,g,i,c,(y=>{i.material=y})))}l=Promise.all(k),H&&(S._instanceData={babylonSourceMesh:i,promise:l}),U=i}return d.AddPointerMetadata(U,y),this._parent.onMeshLoadedObservable.notifyObservers(U),k(U),this.logClose(),l.then((()=>U))}_loadVertexDataAsync(y,g,f){const p=this._extensionsLoadVertexDataAsync(y,g,f);if(p)return p;const k=g.attributes;if(!k)throw new Error(`${y}: Attributes are missing`);const i=new Array,H=new n.d(f.name,this._babylonScene);if(void 0==g.indices)f.isUnIndexed=!0;else{const f=x.Get(`${y}/indices`,this._gltf.accessors,g.indices);i.push(this._loadIndicesAccessorAsync(`/accessors/${f.index}`,f).then((y=>{H.setIndices(y)})))}const U=(g,p,U)=>{if(void 0==k[g])return;f._delayInfo=f._delayInfo||[],-1===f._delayInfo.indexOf(p)&&f._delayInfo.push(p);const l=x.Get(`${y}/attributes/${g}`,this._gltf.accessors,k[g]);i.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,p).then((y=>{if(y.getKind()===Y.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!f.skeleton&&l.min&&l.max){const y=S.j.o[0].ne(...l.min),g=S.j.o[1].ne(...l.max);if(l.normalized&&5126!==l.componentType){let f=1;switch(l.componentType){case 5120:f=127;break;case 5121:f=255;break;case 5122:f=32767;break;case 5123:f=65535}const p=1/f;y.scaleInPlace(p),g.scaleInPlace(p)}H._boundingInfo=new J.b(y,g),H.useBoundingInfoFromGeometry=!0}H.setVerticesBuffer(y,l.count)}))),p==Y.c.MatricesIndicesExtraKind&&(f.numBoneInfluencers=8),U&&U(l)};return U("POSITION",Y.c.PositionKind),U("NORMAL",Y.c.NormalKind),U("TANGENT",Y.c.TangentKind),U("TEXCOORD_0",Y.c.UVKind),U("TEXCOORD_1",Y.c.UV2Kind),U("TEXCOORD_2",Y.c.UV3Kind),U("TEXCOORD_3",Y.c.UV4Kind),U("TEXCOORD_4",Y.c.UV5Kind),U("TEXCOORD_5",Y.c.UV6Kind),U("JOINTS_0",Y.c.MatricesIndicesKind),U("WEIGHTS_0",Y.c.MatricesWeightsKind),U("JOINTS_1",Y.c.MatricesIndicesExtraKind),U("WEIGHTS_1",Y.c.MatricesWeightsExtraKind),U("COLOR_0",Y.c.ColorKind,(y=>{"VEC4"===y.type&&(f.hasVertexAlpha=!0)})),Promise.all(i).then((()=>H))}_createMorphTargets(y,g,f,p,S){if(!p.targets||!this._parent.loadMorphTargets)return;if(void 0==g._numMorphTargets)g._numMorphTargets=p.targets.length;else if(p.targets.length!==g._numMorphTargets)throw new Error(`${y}: Primitives do not have the same number of targets`);const k=f.extras?f.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,S.morphTargetManager=new u(this._babylonScene),S.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.morphTargetManager.areUpdatesFrozen=!0;for(let i=0;i<p.targets.length;i++){const y=g.weights?g.weights[i]:f.weights?f.weights[i]:0,p=k?k[i]:`morphTarget${i}`;S.morphTargetManager.addTarget(new N(p,y,S.va()))}}_loadMorphTargetsAsync(y,g,f,p){if(!g.targets||!this._parent.loadMorphTargets)return Promise.resolve();const S=new Array,k=f.morphTargetManager;for(let i=0;i<k.numTargets;i++){const f=k.getTarget(i);S.push(this._loadMorphTargetVertexDataAsync(`${y}/targets/${i}`,p,g.targets[i],f))}return Promise.all(S).then((()=>{k.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(y,g,f,p){const S=new Array,k=(p,k,i)=>{if(void 0==f[p])return;const H=g.getVertexBuffer(k);if(!H)return;const U=x.Get(`${y}/${p}`,this._gltf.accessors,f[p]);S.push(this._loadFloatAccessorAsync(`/accessors/${U.index}`,U).then((y=>{i(H,y)})))};return k("POSITION",Y.c.PositionKind,((y,g)=>{const f=new Float32Array(g.length);y.forEach(g.length,((y,p)=>{f[p]=g[p]+y})),p.setPositions(f)})),k("NORMAL",Y.c.NormalKind,((y,g)=>{const f=new Float32Array(g.length);y.forEach(f.length,((y,p)=>{f[p]=g[p]+y})),p.setNormals(f)})),k("TANGENT",Y.c.TangentKind,((y,g)=>{const f=new Float32Array(g.length/3*4);let S=0;y.forEach(g.length/3*4,((y,p)=>{(p+1)%4!==0&&(f[S]=g[S]+y,S++)})),p.setTangents(f)})),Promise.all(S).then((()=>{}))}static _LoadTransform(y,g){if(void 0!=y.skin)return;let f=S.m.Zero(),p=S.g.Identity(),k=S.m.One();if(y.matrix){S.c.eh(y.matrix).decompose(k,p,f)}else y.translation&&(f=S.m.eh(y.translation)),y.rotation&&(p=S.g.eh(y.rotation)),y.scale&&(k=S.m.eh(y.scale));g.position=f,g.rotationQuaternion=p,g.pe=k}_loadSkinAsync(y,g,f,p){if(!this._parent.loadSkins)return Promise.resolve();const S=this._extensionsLoadSkinAsync(y,g,f);if(S)return S;if(f._data)return p(f._data.babylonSkeleton),f._data.promise;const k=`skeleton${f.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new B(f.name||k,k,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(y,f,i);const H=this._loadSkinInverseBindMatricesDataAsync(y,f).then((y=>{this._updateBoneMatrices(i,y)}));return f._data={babylonSkeleton:i,promise:H},p(i),H}_loadBones(y,g,f){if(void 0==g.skeleton||this._parent.alwaysComputeSkeletonRootNode){const f=this._findSkeletonRootNode(`${y}/joints`,g.joints);if(f)if(void 0===g.skeleton)g.skeleton=f.index;else{const p=(y,g)=>{for(;g.parent;g=g.parent)if(g.parent===y)return!0;return!1},S=x.Get(`${y}/skeleton`,this._gltf.nodes,g.skeleton);S===f||p(S,f)||(j.d.Warn(`${y}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),g.skeleton=f.index)}else j.d.Warn(`${y}: Failed to find common root`)}const p={};for(const S of g.joints){const k=x.Get(`${y}/joints/${S}`,this._gltf.nodes,S);this._loadBone(k,g,f,p)}}_findSkeletonRootNode(y,g){if(0===g.length)return null;const f={};for(const S of g){const g=[];let p=x.Get(`${y}/${S}`,this._gltf.nodes,S);for(;-1!==p.index;)g.unshift(p),p=p.parent;f[S]=g}let p=null;for(let S=0;;++S){let y=f[g[0]];if(S>=y.length)return p;const k=y[S];for(let i=1;i<g.length;++i)if(y=f[g[i]],S>=y.length||k!==y[S])return p;p=k}}_loadBone(y,g,f,p){y._isJoint=!0;let S=p[y.index];if(S)return S;let k=null;y.index!==g.skeleton&&(y.parent&&-1!==y.parent.index?k=this._loadBone(y.parent,g,f,p):void 0!==g.skeleton&&j.d.Warn(`/skins/${g.index}/skeleton: Skeleton node is not a common root`));const i=g.joints.indexOf(y.index);return S=new l.d(y.name||`joint${y.index}`,f,k,this._getNodeMatrix(y),null,null,i),p[y.index]=S,this._postSceneLoadActions.push((()=>{S.linkTransformNode(y._babylonTransformNode)})),S}_loadSkinInverseBindMatricesDataAsync(y,g){if(void 0==g.inverseBindMatrices)return Promise.resolve(null);const f=x.Get(`${y}/inverseBindMatrices`,this._gltf.accessors,g.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${f.index}`,f)}_updateBoneMatrices(y,g){for(const f of y.bones){const y=S.c.Identity(),p=f._index;g&&-1!==p&&(S.c.FromArrayToRef(g,16*p,y),y.invertToRef(y));const k=f.getParent();k&&y.multiplyToRef(k.getAbsoluteInverseBindMatrix(),y),f.Lj(y,!1,!1),f._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(y){return y.matrix?S.c.eh(y.matrix):S.c.Compose(y.scale?S.m.eh(y.scale):S.m.One(),y.rotation?S.g.eh(y.rotation):S.g.Identity(),y.translation?S.m.eh(y.translation):S.m.Zero())}loadCameraAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const p=this._extensionsLoadCameraAsync(y,g,f);if(p)return p;const k=new Array;this.logOpen(`${y} ${g.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new U.c(g.name||`camera${g.index}`,S.m.Zero(),this._babylonScene,!1);switch(i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.ignoreParentScaling=!0,g._babylonCamera=i,i.rotation.set(0,Math.PI,0),g.type){case"perspective":{const f=g.perspective;if(!f)throw new Error(`${y}: Camera perspective properties are missing`);i.fov=f.yfov,i.$i=f.znear,i.maxZ=f.zfar||0;break}case"orthographic":if(!g.orthographic)throw new Error(`${y}: Camera orthographic properties are missing`);i.mode=H.d.ORTHOGRAPHIC_CAMERA,i.orthoLeft=-g.orthographic.xmag,i.orthoRight=g.orthographic.xmag,i.orthoBottom=-g.orthographic.ymag,i.orthoTop=g.orthographic.ymag,i.$i=g.orthographic.znear,i.maxZ=g.orthographic.zfar;break;default:throw new Error(`${y}: Invalid camera type (${g.type})`)}return d.AddPointerMetadata(i,y),this._parent.onCameraLoadedObservable.notifyObservers(i),f(i),this.logClose(),Promise.all(k).then((()=>i))}_loadAnimationsAsync(){const y=this._gltf.animations;if(!y)return Promise.resolve();const g=new Array;for(let f=0;f<y.length;f++){const p=y[f];g.push(this.loadAnimationAsync(`/animations/${p.index}`,p).then((y=>{0===y.targetedAnimations.length&&y.dispose()})))}return Promise.all(g).then((()=>{}))}loadAnimationAsync(y,g){const p=this._extensionsLoadAnimationAsync(y,g);return p||f.e(38).then(f.bind(f,13556)).then((f=>{let{AnimationGroup:p}=f;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new p(g.name||`animation${g.index}`,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g._babylonAnimationGroup=S;const k=new Array;x.Assign(g.channels),x.Assign(g.samplers);for(const i of g.channels)k.push(this._loadAnimationChannelAsync(`${y}/channels/${i.index}`,y,g,i,((y,g)=>{y.animations=y.animations||[],y.animations.push(g),S.addTargetedAnimation(g,y)})));return Promise.all(k).then((()=>(S.normalize(0),S)))}))}_loadAnimationChannelAsync(y,g,f,p,S){const k=this._extensionsLoadAnimationChannelAsync(y,g,f,p,S);if(k)return k;if(void 0==p.target.node)return Promise.resolve();const i=x.Get(`${y}/target/node`,this._gltf.nodes,p.target.node),H=p.target.path,U="weights"===H;if(U&&!i._numMorphTargets||!U&&!i._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!U&&!i._isJoint)return Promise.resolve();let l;switch(H){case"translation":l=D.translation;break;case"rotation":l=D.rotation;break;case"scale":l=D.scale;break;case"weights":l=D.weights;break;default:throw new Error(`${y}/target/path: Invalid value (${p.target.path})`)}const c={object:i,info:l};return this._loadAnimationChannelFromTargetInfoAsync(y,g,f,p,c,S)}_loadAnimationChannelFromTargetInfoAsync(y,g,f,p,S,k){const i=this.parent.targetFps,H=1/i,U=x.Get(`${y}/sampler`,f.samplers,p.sampler);return this._loadAnimationSamplerAsync(`${g}/samplers/${p.sampler}`,U).then((y=>{let g=0;const U=S.object,l=S.info;for(const S of l){const l=S.getStride(U),c=y.input,Z=y.output,C=new Array(c.length);let q=0;switch(y.interpolation){case"STEP":for(let y=0;y<c.length;y++){const g=S.getValue(U,Z,q,1);q+=l,C[y]={frame:c[y]*i,value:g,interpolation:1}}break;case"CUBICSPLINE":for(let y=0;y<c.length;y++){const g=S.getValue(U,Z,q,H);q+=l;const f=S.getValue(U,Z,q,1);q+=l;const p=S.getValue(U,Z,q,H);q+=l,C[y]={frame:c[y]*i,inTangent:g,value:f,outTangent:p}}break;case"LINEAR":for(let y=0;y<c.length;y++){const g=S.getValue(U,Z,q,1);q+=l,C[y]={frame:c[y]*i,value:g}}}if(q>0){const y=`${f.name||`animation${f.index}`}_channel${p.index}_${g}`;S.buildAnimations(U,y,i,C,((y,f)=>{++g,k(y,f)}))}}}))}_loadAnimationSamplerAsync(y,g){if(g._data)return g._data;const f=g.interpolation||"LINEAR";switch(f){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${y}/interpolation: Invalid value (${g.interpolation})`)}const p=x.Get(`${y}/input`,this._gltf.accessors,g.input),S=x.Get(`${y}/output`,this._gltf.accessors,g.output);return g._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${p.index}`,p),this._loadFloatAccessorAsync(`/accessors/${S.index}`,S)]).then((y=>{let[g,p]=y;return{input:g,interpolation:f,output:p}})),g._data}loadBufferAsync(y,g,f,p){const S=this._extensionsLoadBufferAsync(y,g,f,p);if(S)return S;if(!g._data)if(g.uri)g._data=this.loadUriAsync(`${y}/uri`,g,g.uri);else{if(!this._bin)throw new Error(`${y}: Uri is missing or the binary glTF is missing its binary chunk`);g._data=this._bin.readAsync(0,g.byteLength)}return g._data.then((g=>{try{return new Uint8Array(g.buffer,g.byteOffset+f,p)}catch(S){throw new Error(`${y}: ${S.message}`)}}))}loadBufferViewAsync(y,g){const f=this._extensionsLoadBufferViewAsync(y,g);if(f)return f;if(g._data)return g._data;const p=x.Get(`${y}/buffer`,this._gltf.buffers,g.buffer);return g._data=this.loadBufferAsync(`/buffers/${p.index}`,p,g.byteOffset||0,g.byteLength),g._data}_loadAccessorAsync(y,g,f){if(g._data)return g._data;const p=d._GetNumComponents(y,g.type),S=p*Y.c.GetTypeByteLength(g.componentType),k=p*g.count;if(void 0==g.bufferView)g._data=Promise.resolve(new f(k));else{const i=x.Get(`${y}/bufferView`,this._gltf.bufferViews,g.bufferView);g._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((H=>{if(5126!==g.componentType||g.normalized||i.byteStride&&i.byteStride!==S){const y=new f(k);return Y.c.ForEach(H,g.byteOffset||0,i.byteStride||S,p,g.componentType,y.length,g.normalized||!1,((g,f)=>{y[f]=g})),y}return d._GetTypedArray(y,g.componentType,H,g.byteOffset,k)}))}if(g.sparse){const k=g.sparse;g._data=g._data.then((i=>{const H=i,U=x.Get(`${y}/sparse/indices/bufferView`,this._gltf.bufferViews,k.indices.bufferView),l=x.Get(`${y}/sparse/values/bufferView`,this._gltf.bufferViews,k.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${U.index}`,U),this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)]).then((i=>{let[U,l]=i;const c=d._GetTypedArray(`${y}/sparse/indices`,k.indices.componentType,U,k.indices.byteOffset,k.count),Z=p*k.count;let C;if(5126!==g.componentType||g.normalized){const i=d._GetTypedArray(`${y}/sparse/values`,g.componentType,l,k.values.byteOffset,Z);C=new f(Z),Y.c.ForEach(i,0,S,p,g.componentType,C.length,g.normalized||!1,((y,g)=>{C[g]=y}))}else C=d._GetTypedArray(`${y}/sparse/values`,g.componentType,l,k.values.byteOffset,Z);let q=0;for(let y=0;y<c.length;y++){let g=c[y]*p;for(let y=0;y<p;y++)H[g++]=C[q++]}return H}))}))}return g._data}_loadFloatAccessorAsync(y,g){return this._loadAccessorAsync(y,g,Float32Array)}_loadIndicesAccessorAsync(y,g){if("SCALAR"!==g.type)throw new Error(`${y}/type: Invalid value ${g.type}`);if(5121!==g.componentType&&5123!==g.componentType&&5125!==g.componentType)throw new Error(`${y}/componentType: Invalid value ${g.componentType}`);if(g._data)return g._data;if(g.sparse){const f=d._GetTypedArrayConstructor(`${y}/componentType`,g.componentType);g._data=this._loadAccessorAsync(y,g,f)}else{const f=x.Get(`${y}/bufferView`,this._gltf.bufferViews,g.bufferView);g._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((f=>d._GetTypedArray(y,g.componentType,f,g.byteOffset,g.count)))}return g._data}_loadVertexBufferViewAsync(y){if(y._babylonBuffer)return y._babylonBuffer;const g=this._babylonScene.getEngine();return y._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((y=>new Y.b(g,y,!1))),y._babylonBuffer}_loadVertexAccessorAsync(y,g,f){var p;if(null!==(p=g._babylonVertexBuffer)&&void 0!==p&&p[f])return g._babylonVertexBuffer[f];g._babylonVertexBuffer||(g._babylonVertexBuffer={});const S=this._babylonScene.getEngine();if(g.sparse||void 0==g.bufferView)g._babylonVertexBuffer[f]=this._loadFloatAccessorAsync(y,g).then((y=>new Y.c(S,y,f,!1)));else{const p=x.Get(`${y}/bufferView`,this._gltf.bufferViews,g.bufferView);g._babylonVertexBuffer[f]=this._loadVertexBufferViewAsync(p).then((k=>{const i=d._GetNumComponents(y,g.type);return new Y.c(S,k,f,!1,void 0,p.byteStride,void 0,g.byteOffset,i,g.componentType,g.normalized,!0,void 0,!0)}))}return g._babylonVertexBuffer[f]}_loadMaterialMetallicRoughnessPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return g&&(g.baseColorFactor?(f.albedoColor=k.c.eh(g.baseColorFactor),f.alpha=g.baseColorFactor[3]):f.albedoColor=k.c.White(),f.metallic=void 0==g.metallicFactor?1:g.metallicFactor,f.roughness=void 0==g.roughnessFactor?1:g.roughnessFactor,g.baseColorTexture&&p.push(this.loadTextureInfoAsync(`${y}/baseColorTexture`,g.baseColorTexture,(y=>{y.name=`${f.name} (Base Color)`,f.albedoTexture=y}))),g.metallicRoughnessTexture&&(g.metallicRoughnessTexture.nonColorData=!0,p.push(this.loadTextureInfoAsync(`${y}/metallicRoughnessTexture`,g.metallicRoughnessTexture,(y=>{y.name=`${f.name} (Metallic Roughness)`,f.metallicTexture=y}))),f.useMetallnessFromMetallicTextureBlue=!0,f.useRoughnessFromMetallicTextureGreen=!0,f.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(p).then((()=>{}))}_loadMaterialAsync(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const k=this._extensionsLoadMaterialAsync(y,g,f,p,S);if(k)return k;g._data=g._data||{};let i=g._data[p];if(!i){this.logOpen(`${y} ${g.name||""}`);const f=this.createMaterial(y,g,p);i={babylonMaterial:f,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(y,g,f)},g._data[p]=i,d.AddPointerMetadata(f,y),this._parent.onMaterialLoadedObservable.notifyObservers(f),this.logClose()}return f&&(i.babylonMeshes.push(f),f.nj.addOnce((()=>{const y=i.babylonMeshes.indexOf(f);-1!==y&&i.babylonMeshes.splice(y,1)}))),S(i.babylonMaterial),i.promise.then((()=>i.babylonMaterial))}_createDefaultMaterial(y,g){this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new w(y,this._babylonScene);return f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.fillMode=g,f.enableSpecularAntiAliasing=!0,f.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,f.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,f.transparencyMode=w.PBRMATERIAL_OPAQUE,f.metallic=1,f.roughness=1,f}createMaterial(y,g,f){const p=this._extensionsCreateMaterial(y,g,f);if(p)return p;const S=g.name||`material${g.index}`;return this._createDefaultMaterial(S,f)}loadMaterialPropertiesAsync(y,g,f){const p=this._extensionsLoadMaterialPropertiesAsync(y,g,f);if(p)return p;const S=new Array;return S.push(this.loadMaterialBasePropertiesAsync(y,g,f)),g.pbrMetallicRoughness&&S.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${y}/pbrMetallicRoughness`,g.pbrMetallicRoughness,f)),this.loadMaterialAlphaProperties(y,g,f),Promise.all(S).then((()=>{}))}loadMaterialBasePropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return f.emissiveColor=g.emissiveFactor?k.c.eh(g.emissiveFactor):new k.c(0,0,0),g.doubleSided&&(f.oh=!1,f.twoSidedLighting=!0),g.normalTexture&&(g.normalTexture.nonColorData=!0,p.push(this.loadTextureInfoAsync(`${y}/normalTexture`,g.normalTexture,(y=>{y.name=`${f.name} (Normal)`,f.bumpTexture=y}))),f.invertNormalMapX=!this._babylonScene.useRightHandedSystem,f.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=g.normalTexture.scale&&f.bumpTexture&&(f.bumpTexture.level=g.normalTexture.scale),f.forceIrradianceInFragment=!0),g.occlusionTexture&&(g.occlusionTexture.nonColorData=!0,p.push(this.loadTextureInfoAsync(`${y}/occlusionTexture`,g.occlusionTexture,(y=>{y.name=`${f.name} (Occlusion)`,f.ambientTexture=y}))),f.useAmbientInGrayScale=!0,void 0!=g.occlusionTexture.strength&&(f.ambientTextureStrength=g.occlusionTexture.strength)),g.emissiveTexture&&p.push(this.loadTextureInfoAsync(`${y}/emissiveTexture`,g.emissiveTexture,(y=>{y.name=`${f.name} (Emissive)`,f.emissiveTexture=y}))),Promise.all(p).then((()=>{}))}loadMaterialAlphaProperties(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);switch(g.alphaMode||"OPAQUE"){case"OPAQUE":f.transparencyMode=w.PBRMATERIAL_OPAQUE,f.alpha=1;break;case"MASK":f.transparencyMode=w.PBRMATERIAL_ALPHATEST,f.alphaCutOff=void 0==g.alphaCutoff?.5:g.alphaCutoff,f.albedoTexture&&(f.albedoTexture.Be=!0);break;case"BLEND":f.transparencyMode=w.PBRMATERIAL_ALPHABLEND,f.albedoTexture&&(f.albedoTexture.Be=!0,f.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${y}/alphaMode: Invalid value (${g.alphaMode})`)}}loadTextureInfoAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const p=this._extensionsLoadTextureInfoAsync(y,g,f);if(p)return p;if(this.logOpen(`${y}`),g.texCoord>=6)throw new Error(`${y}/texCoord: Invalid value (${g.texCoord})`);const S=x.Get(`${y}/index`,this._gltf.textures,g.index);S._textureInfo=g;const k=this._loadTextureAsync(`/textures/${g.index}`,S,(p=>{p.coordinatesIndex=g.texCoord||0,d.AddPointerMetadata(p,y),this._parent.onTextureLoadedObservable.notifyObservers(p),f(p)}));return this.logClose(),k}_loadTextureAsync(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const p=this._extensionsLoadTextureAsync(y,g,f);if(p)return p;this.logOpen(`${y} ${g.name||""}`);const S=void 0==g.sampler?d.DefaultSampler:x.Get(`${y}/sampler`,this._gltf.samplers,g.sampler),k=x.Get(`${y}/source`,this._gltf.images,g.source),i=this._createTextureAsync(y,S,k,f,void 0,!g._textureInfo.nonColorData);return this.logClose(),i}_createTextureAsync(y,g,f){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},k=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;const H=this._loadSampler(`/samplers/${g.index}`,g),U=new Array,l=new p;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c={noMipmap:H.noMipMaps,invertY:!1,samplingMode:H.samplingMode,X:()=>{this._disposed||l.resolve()},onError:(g,f)=>{this._disposed||l.reject(new Error(`${y}: ${f&&f.message?f.message:g||"Failed to load texture"}`))},mimeType:f.mimeType,loaderOptions:k,useSRGBBuffer:!!i&&this._parent.useSRGBBuffers},Z=new o.c(null,this._babylonScene,c);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.push(l.promise),U.push(this.loadImageAsync(`/images/${f.index}`,f).then((y=>{const g=f.uri||`${this._fileName}#image${f.index}`,p=`data:${this._uniqueRootUrl}${g}`;Z.updateURL(p,y);const S=Z.getInternalTexture();S&&(S.label=f.name)}))),Z.wrapU=H.wrapU,Z.wrapV=H.wrapV,S(Z),this._parent.useGltfTextureNames&&(Z.name=f.name||f.uri||`image${f.index}`),Promise.all(U).then((()=>Z))}_loadSampler(y,g){return g._data||(g._data={noMipMaps:9728===g.minFilter||9729===g.minFilter,samplingMode:d._GetTextureSamplingMode(y,g),wrapU:d._GetTextureWrapMode(`${y}/wrapS`,g.wrapS),wrapV:d._GetTextureWrapMode(`${y}/wrapT`,g.wrapT)}),g._data}loadImageAsync(y,g){if(!g._data){if(this.logOpen(`${y} ${g.name||""}`),g.uri)g._data=this.loadUriAsync(`${y}/uri`,g,g.uri);else{const f=x.Get(`${y}/bufferView`,this._gltf.bufferViews,g.bufferView);g._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}this.logClose()}return g._data}loadUriAsync(y,g,f){const p=this._extensionsLoadUriAsync(y,g,f);if(p)return p;if(!d._ValidateUri(f))throw new Error(`${y}: '${f}' is invalid`);if((0,A.j)(f)){const g=new Uint8Array((0,A.e)(f));return this.log(`${y}: Decoded ${f.substring(0,64)}... (${g.length} bytes)`),Promise.resolve(g)}return this.log(`${y}: Loading ${f}`),this._parent.preprocessUrlAsync(this._rootUrl+f).then((g=>new Promise(((p,S)=>{this._parent._loadFile(this._babylonScene,g,(g=>{this._disposed||(this.log(`${y}: Loaded ${f} (${g.byteLength} bytes)`),p(new Uint8Array(g)))}),!0,(g=>{S(new A.n(`${y}: Failed to load '${f}'${g?": "+g.status+" "+g.statusText:""}`,g))}))}))))}static AddPointerMetadata(y,g){y.metadata=y.metadata||{};const f=y._internalMetadata=y._internalMetadata||{},p=f.Si=f.Si||{};(p.pointers=p.pointers||[]).push(g)}static _GetTextureWrapMode(y,g){switch(g=void 0==g?10497:g){case 33071:return o.c.CLAMP_ADDRESSMODE;case 33648:return o.c.MIRROR_ADDRESSMODE;case 10497:return o.c.WRAP_ADDRESSMODE;default:return j.d.Warn(`${y}: Invalid value (${g})`),o.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(y,g){const f=void 0==g.magFilter?9729:g.magFilter,p=void 0==g.minFilter?9987:g.minFilter;if(9729===f)switch(p){case 9728:return o.c.LINEAR_NEAREST;case 9729:return o.c.LINEAR_LINEAR;case 9984:return o.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return o.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return o.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return o.c.LINEAR_LINEAR_MIPLINEAR;default:return j.d.Warn(`${y}/minFilter: Invalid value (${p})`),o.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==f&&j.d.Warn(`${y}/magFilter: Invalid value (${f})`),p){case 9728:return o.c.NEAREST_NEAREST;case 9729:return o.c.NEAREST_LINEAR;case 9984:return o.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return o.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return o.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return o.c.NEAREST_LINEAR_MIPLINEAR;default:return j.d.Warn(`${y}/minFilter: Invalid value (${p})`),o.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(y,g){switch(g){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${y}: Invalid component type ${g}`)}}static _GetTypedArray(y,g,f,p,S){const k=f.buffer;p=f.byteOffset+(p||0);const i=d._GetTypedArrayConstructor(`${y}/componentType`,g),H=Y.c.GetTypeByteLength(g);return p%H!==0?(j.d.Warn(`${y}: Copying buffer as byte offset (${p}) is not a multiple of component type byte length (${H})`),new i(k.slice(p,p+S*H),0)):new i(k,p,S)}static _GetNumComponents(y,g){switch(g){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${y}: Invalid type (${g})`)}static _ValidateUri(y){return i.e.IsBase64(y)||-1===y.indexOf("..")}static _GetDrawMode(y,g){switch(void 0==g&&(g=4),g){case 0:return R.c.PointListDrawMode;case 1:return R.c.LineListDrawMode;case 2:return R.c.LineLoopDrawMode;case 3:return R.c.LineStripDrawMode;case 4:return R.c.TriangleFillMode;case 5:return R.c.TriangleStripDrawMode;case 6:return R.c.TriangleFanDrawMode}throw new Error(`${y}: Invalid mesh primitive mode (${g})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const y=new Array;if(this._gltf.materials)for(const g of this._gltf.materials)if(g._data)for(const f in g._data){const p=g._data[f];for(const g of p.babylonMeshes){g.Sj(!0);const f=p.babylonMaterial;y.push(f.forceCompilationAsync(g)),y.push(f.forceCompilationAsync(g,{useInstances:!0})),this._parent.useClipPlane&&(y.push(f.forceCompilationAsync(g,{clipPlane:!0})),y.push(f.forceCompilationAsync(g,{clipPlane:!0,useInstances:!0})))}}return Promise.all(y).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const y=new Array,g=this._babylonScene.lights;for(const f of g){const g=f.getShadowGenerator();g&&y.push(g.forceCompilationAsync())}return Promise.all(y).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(y){for(const g of this._extensions)g.enabled&&y(g)}_applyExtensions(y,g,f){for(const p of this._extensions)if(p.enabled){const S=`${p.name}.${g}`,k=y;k._activeLoaderExtensionFunctions=k._activeLoaderExtensionFunctions||{};const i=k._activeLoaderExtensionFunctions;if(!i[S]){i[S]=!0;try{const y=f(p);if(y)return y}finally{delete i[S]}}}return null}_extensionsOnLoading(){this._forEachExtensions((y=>y.onLoading&&y.onLoading()))}_extensionsOnReady(){this._forEachExtensions((y=>y.onReady&&y.onReady()))}_extensionsLoadSceneAsync(y,g){return this._applyExtensions(g,"loadScene",(f=>f.loadSceneAsync&&f.loadSceneAsync(y,g)))}_extensionsLoadNodeAsync(y,g,f){return this._applyExtensions(g,"loadNode",(p=>p.loadNodeAsync&&p.loadNodeAsync(y,g,f)))}_extensionsLoadCameraAsync(y,g,f){return this._applyExtensions(g,"loadCamera",(p=>p.loadCameraAsync&&p.loadCameraAsync(y,g,f)))}_extensionsLoadVertexDataAsync(y,g,f){return this._applyExtensions(g,"loadVertexData",(p=>p._loadVertexDataAsync&&p._loadVertexDataAsync(y,g,f)))}_extensionsLoadMeshPrimitiveAsync(y,g,f,p,S,k){return this._applyExtensions(S,"loadMeshPrimitive",(i=>i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(y,g,f,p,S,k)))}_extensionsLoadMaterialAsync(y,g,f,p,S){return this._applyExtensions(g,"loadMaterial",(k=>k._loadMaterialAsync&&k._loadMaterialAsync(y,g,f,p,S)))}_extensionsCreateMaterial(y,g,f){return this._applyExtensions(g,"createMaterial",(p=>p.createMaterial&&p.createMaterial(y,g,f)))}_extensionsLoadMaterialPropertiesAsync(y,g,f){return this._applyExtensions(g,"loadMaterialProperties",(p=>p.loadMaterialPropertiesAsync&&p.loadMaterialPropertiesAsync(y,g,f)))}_extensionsLoadTextureInfoAsync(y,g,f){return this._applyExtensions(g,"loadTextureInfo",(p=>p.loadTextureInfoAsync&&p.loadTextureInfoAsync(y,g,f)))}_extensionsLoadTextureAsync(y,g,f){return this._applyExtensions(g,"loadTexture",(p=>p._loadTextureAsync&&p._loadTextureAsync(y,g,f)))}_extensionsLoadAnimationAsync(y,g){return this._applyExtensions(g,"loadAnimation",(f=>f.loadAnimationAsync&&f.loadAnimationAsync(y,g)))}_extensionsLoadAnimationChannelAsync(y,g,f,p,S){return this._applyExtensions(f,"loadAnimationChannel",(k=>k._loadAnimationChannelAsync&&k._loadAnimationChannelAsync(y,g,f,p,S)))}_extensionsLoadSkinAsync(y,g,f){return this._applyExtensions(f,"loadSkin",(p=>p._loadSkinAsync&&p._loadSkinAsync(y,g,f)))}_extensionsLoadUriAsync(y,g,f){return this._applyExtensions(g,"loadUri",(p=>p._loadUriAsync&&p._loadUriAsync(y,g,f)))}_extensionsLoadBufferViewAsync(y,g){return this._applyExtensions(g,"loadBufferView",(f=>f.loadBufferViewAsync&&f.loadBufferViewAsync(y,g)))}_extensionsLoadBufferAsync(y,g,f,p){return this._applyExtensions(g,"loadBuffer",(S=>S.loadBufferAsync&&S.loadBufferAsync(y,g,f,p)))}static LoadExtensionAsync(y,g,f,p){if(!g.extensions)return null;const S=g.extensions[f];return S?p(`${y}/extensions/${f}`,S):null}static LoadExtraAsync(y,g,f,p){if(!g.extras)return null;const S=g.extras[f];return S?p(`${y}/extras/${f}`,S):null}isExtensionUsed(y){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(y)}logOpen(y){this._parent._logOpen(y)}logClose(){this._parent._logClose()}log(y){this._parent._log(y)}startPerformanceCounter(y){this._parent._startPerformanceCounter(y)}endPerformanceCounter(y){this._parent._endPerformanceCounter(y)}}d.DefaultSampler={index:-1},F.c._CreateGLTF2Loader=y=>new d(y);var t=f(11555),v=f(12295),yy=f(12306);class gy extends yy.b{constructor(y,g,f){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",y),this._texture=y.getEngine().createRawCubeTexture(g,f,p,S,k,i,H,U)}update(y,g,f,p){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,y,g,f,p,S)}updateRGBDAsync(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,v.k)(this._texture,y,g,f,p).then((()=>{}))}clone(){return a.c.Clone((()=>{const y=this.va(),g=this._texture,f=new gy(y,g._bufferViewArray,g.width,g.format,g.type,g.generateMipMaps,g.invertY,g.samplingMode,g._compression);return 13===g.source&&f.updateRGBDAsync(g._bufferViewArrayArray,g._sphericalPolynomial,g._lodGenerationScale,g._lodGenerationOffset),f}),this)}}const fy="EXT_lights_image_based";class py{constructor(y){this.name=fy,this._loader=y,this.enabled=this._loader.isExtensionUsed(fy)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.Si.extensions;if(y&&y[this.name]){const g=y[this.name];this._lights=g.lights}}loadSceneAsync(y,g){return d.LoadExtensionAsync(y,g,this.name,((f,p)=>{this._loader._allMaterialsDirtyRequired=!0;const S=new Array;S.push(this._loader.loadSceneAsync(y,g)),this._loader.logOpen(`${f}`);const k=x.Get(`${f}/light`,this._lights,p.fb);return S.push(this._loadLightAsync(`/extensions/${this.name}/lights/${p.fb}`,k).then((y=>{this._loader.babylonScene.environmentTexture=y}))),this._loader.logClose(),Promise.all(S).then((()=>{}))}))}_loadLightAsync(y,g){if(!g._loaded){const f=new Array;this._loader.logOpen(`${y}`);const p=new Array(g.specularImages.length);for(let S=0;S<g.specularImages.length;S++){const k=g.specularImages[S];p[S]=new Array(k.length);for(let g=0;g<k.length;g++){const i=`${y}/specularImages/${S}/${g}`;this._loader.logOpen(`${i}`);const H=k[g],U=x.Get(i,this._loader.Si.images,H);f.push(this._loader.loadImageAsync(`/images/${H}`,U).then((y=>{p[S][g]=y}))),this._loader.logClose()}}this._loader.logClose(),g._loaded=Promise.all(f).then((()=>{const f=new gy(this._loader.babylonScene,null,g.specularImageSize);if(f.name=g.name||"environment",g._babylonTexture=f,void 0!=g.cj&&(f.level=g.cj),g.rotation){let y=S.g.eh(g.rotation);this._loader.babylonScene.useRightHandedSystem||(y=S.g.Inverse(y)),S.c.FromQuaternionToRef(y,f.getReflectionTextureMatrix())}if(!g.irradianceCoefficients)throw new Error(`${y}: Irradiance coefficients are missing`);const k=t.e.eh(g.irradianceCoefficients);k.scaleInPlace(g.cj),k.convertIrradianceToLambertianRadiance();const i=t.f.FromHarmonics(k),H=(p.length-1)/Math.log2(g.specularImageSize);return f.updateRGBDAsync(p,i,H)}))}return g._loaded.then((()=>g._babylonTexture))}}O(fy),E(fy,!0,(y=>new py(y)));f(12308);const Sy="EXT_mesh_gpu_instancing";class ky{constructor(y){this.name=Sy,this._loader=y,this.enabled=this._loader.isExtensionUsed(Sy)}dispose(){this._loader=null}loadNodeAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((y,p)=>{this._loader._disableInstancedMesh++;const k=this._loader.loadNodeAsync(`/nodes/${g.index}`,g,f);if(this._loader._disableInstancedMesh--,!g._primitiveBabylonMeshes)return k;const i=new Array;let H=0;const U=g=>{if(void 0==p.attributes[g])return void i.push(Promise.resolve(null));const f=x.Get(`${y}/attributes/${g}`,this._loader.Si.accessors,p.attributes[g]);if(i.push(this._loader._loadFloatAccessorAsync(`/accessors/${f.bufferView}`,f)),0===H)H=f.count;else if(H!==f.count)throw new Error(`${y}/attributes: Instance buffer accessors do not have the same count.`)};return U("TRANSLATION"),U("ROTATION"),U("SCALE"),k.then((y=>Promise.all(i).then((f=>{let[p,k,i]=f;const U=new Float32Array(16*H);S.j.o[0].ne(0,0,0),S.j.Quaternion[0].ne(0,0,0,1),S.j.o[1].ne(1,1,1);for(let y=0;y<H;++y)p&&S.m.FromArrayToRef(p,3*y,S.j.o[0]),k&&S.g.FromArrayToRef(k,4*y,S.j.Quaternion[0]),i&&S.m.FromArrayToRef(i,3*y,S.j.o[1]),S.c.ComposeToRef(S.j.o[1],S.j.Quaternion[0],S.j.o[0],S.j.Matrix[0]),S.j.Matrix[0].copyToArray(U,16*y);for(const y of g._primitiveBabylonMeshes)y.Pb("matrix",U,16,!0);return y}))))}))}}O(Sy),E(Sy,!0,(y=>new ky(y)));class iy{static get Default(){return iy._Default||(iy._Default=new iy),iy._Default}constructor(){const y=iy.Configuration.decoder;this._decoderModulePromise=i.e.LoadBabylonScriptAsync(y.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(y,g,f,p,S){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const k=await MeshoptDecoder.decodeGltfBufferAsync(g,f,y,p,S);return MeshoptDecoder.useWorkers(0),k}))}}iy.Configuration={decoder:{url:`${i.e._DefaultCdnUrl}/meshopt_decoder.js`}},iy._Default=null;const Hy="EXT_meshopt_compression";class Uy{constructor(y){this.name=Hy,this.enabled=y.isExtensionUsed(Hy),this._loader=y}dispose(){this._loader=null}loadBufferViewAsync(y,g){return d.LoadExtensionAsync(y,g,this.name,((f,p)=>{const S=g;if(S._meshOptData)return S._meshOptData;const k=x.Get(`${y}/buffer`,this._loader.Si.buffers,p.buffer);return S._meshOptData=this._loader.loadBufferAsync(`/buffers/${k.index}`,k,p.byteOffset||0,p.byteLength).then((y=>iy.Default.decodeGltfBufferAsync(y,p.count,p.byteStride,p.mode,p.filter))),S._meshOptData}))}}O(Hy),E(Hy,!0,(y=>new Uy(y)));const ly="EXT_texture_webp";class cy{constructor(y){this.name=ly,this._loader=y,this.enabled=y.isExtensionUsed(ly)}dispose(){this._loader=null}_loadTextureAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=void 0==g.sampler?d.DefaultSampler:x.Get(`${y}/sampler`,this._loader.Si.samplers,g.sampler),i=x.Get(`${p}/source`,this._loader.Si.images,S.source);return this._loader._createTextureAsync(y,k,i,(y=>{f(y)}),void 0,!g._textureInfo.nonColorData)}))}}O(ly),E(ly,!0,(y=>new cy(y)));const Zy="EXT_texture_avif";class Cy{constructor(y){this.name=Zy,this._loader=y,this.enabled=y.isExtensionUsed(Zy)}dispose(){this._loader=null}_loadTextureAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=void 0==g.sampler?d.DefaultSampler:x.Get(`${y}/sampler`,this._loader.Si.samplers,g.sampler),i=x.Get(`${p}/source`,this._loader.Si.images,S.source);return this._loader._createTextureAsync(y,k,i,(y=>{f(y)}),void 0,!g._textureInfo.nonColorData)}))}}O(Zy),E(Zy,!0,(y=>new Cy(y)));var qy=f(12317);const Wy="KHR_draco_mesh_compression";class jy{constructor(y){this.name=Wy,this.useNormalizedFlagFromAccessor=!0,this._loader=y,this.enabled=qy.d.DecoderAvailable&&this._loader.isExtensionUsed(Wy)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{if(void 0!=g.mode&&4!==g.mode&&5!==g.mode)throw new Error(`${y}: Unsupported mode ${g.mode}`);const k={},i={},H=(y,p)=>{const H=S.attributes[y];if(void 0!=H&&(f._delayInfo=f._delayInfo||[],-1===f._delayInfo.indexOf(p)&&f._delayInfo.push(p),k[p]=H,this.useNormalizedFlagFromAccessor)){const f=x.TryGet(this._loader.Si.accessors,g.attributes[y]);f&&(i[p]=f.normalized||!1)}};H("POSITION",Y.c.PositionKind),H("NORMAL",Y.c.NormalKind),H("TANGENT",Y.c.TangentKind),H("TEXCOORD_0",Y.c.UVKind),H("TEXCOORD_1",Y.c.UV2Kind),H("TEXCOORD_2",Y.c.UV3Kind),H("TEXCOORD_3",Y.c.UV4Kind),H("TEXCOORD_4",Y.c.UV5Kind),H("TEXCOORD_5",Y.c.UV6Kind),H("JOINTS_0",Y.c.MatricesIndicesKind),H("WEIGHTS_0",Y.c.MatricesWeightsKind),H("COLOR_0",Y.c.ColorKind);const U=x.Get(p,this._loader.Si.bufferViews,S.bufferView);return U._dracoBabylonGeometry||(U._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((g=>(this.dracoCompression||qy.d.Default)._decodeMeshToGeometryForGltfAsync(f.name,this._loader.babylonScene,g,k,i).catch((g=>{throw new Error(`${y}: ${g.message}`)}))))),U._dracoBabylonGeometry}))}}O(Wy),E(Wy,!0,(y=>new jy(y)));var Py=f(12333),By=f(11336),Ry=f(12285),Gy=f(12341);By.d.AddNodeConstructor("Light_Type_0",((y,g)=>()=>new zy(y,S.m.Zero(),g)));class zy extends Gy.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(y){this._shadowAngle=y,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(y){const g=this.needCube();if(this._direction=y,this.needCube()!==g&&this._shadowGenerators){const y=this._shadowGenerators.values();for(let g=y.next();!0!==g.done;g=y.next()){g.value.recreateShadowMap()}}}constructor(y,g,f){super(y,f),this._shadowAngle=Math.PI/2,this.position=g}getClassName(){return"PointLight"}getTypeID(){return Ry.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(y){if(this.direction)return super.getShadowDirection(y);switch(y){case 0:return new S.m(1,0,0);case 1:return new S.m(-1,0,0);case 2:return new S.m(0,-1,0);case 3:return new S.m(0,1,0);case 4:return new S.m(0,0,1);case 5:return new S.m(0,0,-1)}return S.m.Zero()}_setDefaultShadowProjectionMatrix(y,g,f){const p=this.va().activeCamera;if(!p)return;const k=void 0!==this.shadowMinZ?this.shadowMinZ:p.$i,i=void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,H=this.va().getEngine().useReverseDepthBuffer;S.c.PerspectiveFovLHToRef(this.shadowAngle,1,H?i:k,H?k:i,y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,H)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(y,g){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,g):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,g),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,g),this}transferToNodeMaterialEffect(y,g){return this.computeTransformedInformation()?y.setFloat3(g,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):y.setFloat3(g,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(y,g){y["POINTLIGHT"+g]=!0}}(0,G.c)([(0,z.I)()],zy.prototype,"shadowAngle",null),(0,m.c)("BABYLON.PointLight",zy),By.d.AddNodeConstructor("Light_Type_2",((y,g)=>()=>new Ty(y,S.m.Zero(),S.m.Zero(),0,0,g)));class Ty extends Gy.e{get angle(){return this._angle}set angle(y){this._angle=y,this._cosHalfAngle=Math.cos(.5*y),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(y){this._innerAngle=y,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(y){this._shadowAngleScale=y,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(y){this._projectionTextureLightNear=y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(y){this._projectionTextureLightFar=y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(y){this._projectionTextureUpDirection=y,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(y){this._projectionTexture!==y&&(this._projectionTexture=y,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Ty._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Ty._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(y){return void 0!==y.onGeneratedObservable}static _IsTexture(y){return void 0!==y.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(y){this._projectionTextureProjectionLightMatrix=y,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(y,g,f,p,k,i){super(y,i),this._innerAngle=0,this._projectionTextureMatrix=S.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=S.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=S.m.Zero(),this._projectionTextureViewLightMatrix=S.c.Zero(),this._projectionTextureProjectionLightMatrix=S.c.Zero(),this._projectionTextureScalingMatrix=S.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=g,this.direction=f,this.angle=p,this.exponent=k}getClassName(){return"SpotLight"}getTypeID(){return Ry.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(y){super._setDirection(y),this._projectionTextureViewLightDirty=!0}_setPosition(y){super._setPosition(y),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(y,g,f){const p=this.va().activeCamera;if(!p)return;this._shadowAngleScale=this._shadowAngleScale||1;const k=this._shadowAngleScale*this._angle,i=void 0!==this.shadowMinZ?this.shadowMinZ:p.$i,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,U=this.va().getEngine().useReverseDepthBuffer;S.c.PerspectiveFovLHToRef(k,1,U?H:i,U?i:H,y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),S.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const y=this.projectionTextureLightFar,g=this.projectionTextureLightNear,f=y/(y-g),p=-f*g,k=1/Math.tan(this._angle/2);S.c.FromValuesToRef(k/1,0,0,0,0,k,0,0,0,0,f,1,0,0,p,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof o.c){const y=this._projectionTexture.uScale/2,g=this._projectionTexture.vScale/2;S.c.FromValuesToRef(y,0,0,0,0,g,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(y,g){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),y.setMatrix("textureProjectionMatrix"+g,this._projectionTextureMatrix),y.setTexture("projectionLightTexture"+g,this.projectionTexture)),this}transferToEffect(y,g){let f;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,g),f=S.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,g),f=S.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",f.x,f.y,f.z,this._cosHalfAngle,g),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,g),this}transferToNodeMaterialEffect(y,g){let f;return f=this.computeTransformedInformation()?S.m.Normalize(this.transformedDirection):S.m.Normalize(this.direction),this.va().useRightHandedSystem?y.setFloat3(g,-f.x,-f.y,-f.z):y.setFloat3(g,f.x,f.y,f.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(y){const g=this._scene.getEngine(),f=void 0!==this.shadowMinZ?this.shadowMinZ:y.$i;return g.useReverseDepthBuffer&&g.isNDCHalfZRange?f:this._scene.getEngine().isNDCHalfZRange?0:f}getDepthMaxZ(y){const g=this._scene.getEngine(),f=void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ;return g.useReverseDepthBuffer&&g.isNDCHalfZRange?0:f}prepareLightSpecificDefines(y,g){y["SPOTLIGHT"+g]=!0,y["PROJECTEDLIGHTTEXTURE"+g]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,G.c)([(0,z.I)()],Ty.prototype,"angle",null),(0,G.c)([(0,z.I)()],Ty.prototype,"innerAngle",null),(0,G.c)([(0,z.I)()],Ty.prototype,"shadowAngleScale",null),(0,G.c)([(0,z.I)()],Ty.prototype,"exponent",void 0),(0,G.c)([(0,z.I)()],Ty.prototype,"projectionTextureLightNear",null),(0,G.c)([(0,z.I)()],Ty.prototype,"projectionTextureLightFar",null),(0,G.c)([(0,z.I)()],Ty.prototype,"projectionTextureUpDirection",null),(0,G.c)([(0,z.E)("projectedLightTexture")],Ty.prototype,"_projectionTexture",void 0),(0,m.c)("BABYLON.SpotLight",Ty);const Qy="KHR_lights_punctual";class my{constructor(y){this.name=Qy,this._loader=y,this.enabled=this._loader.isExtensionUsed(Qy)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.Si.extensions;if(y&&y[this.name]){const g=y[this.name];this._lights=g.lights,x.Assign(this._lights)}}loadNodeAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,i)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(y,g,(y=>{let g;const H=x.Get(p,this._lights,i.fb),U=H.name||y.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,H.type){case"directional":{const y=new Py.b(U,S.m.Backward(),this._loader.babylonScene);y.position.me(0),g=y;break}case"point":g=new zy(U,S.m.Zero(),this._loader.babylonScene);break;case"spot":{const y=new Ty(U,S.m.Zero(),S.m.Backward(),0,1,this._loader.babylonScene);y.angle=2*(H.spot&&H.spot.outerConeAngle||Math.PI/4),y.innerAngle=2*(H.spot&&H.spot.innerConeAngle||0),g=y;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${p}: Invalid light type (${H.type})`)}g._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,H._babylonLight=g,g.falloffType=Ry.d.FALLOFF_GLTF,g.Gh=H.color?k.c.eh(H.color):k.c.White(),g.cj=void 0==H.cj?1:H.cj,g.range=void 0==H.range?Number.MAX_VALUE:H.range,g.parent=y,this._loader._babylonLights.push(g),d.AddPointerMetadata(g,p),f(y)})))))}}O(Qy),E(Qy,!0,(y=>new my(y)));const ay="KHR_materials_pbrSpecularGlossiness";class wy{constructor(y){this.name=ay,this.order=200,this._loader=y,this.enabled=this._loader.isExtensionUsed(ay)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialBasePropertiesAsync(y,g,f)),k.push(this._loadSpecularGlossinessPropertiesAsync(p,S,f)),this._loader.loadMaterialAlphaProperties(y,g,f),Promise.all(k).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return f.metallic=null,f.roughness=null,g.diffuseFactor?(f.albedoColor=k.c.eh(g.diffuseFactor),f.alpha=g.diffuseFactor[3]):f.albedoColor=k.c.White(),f.reflectivityColor=g.specularFactor?k.c.eh(g.specularFactor):k.c.White(),f.microSurface=void 0==g.glossinessFactor?1:g.glossinessFactor,g.diffuseTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTexture`,g.diffuseTexture,(y=>{y.name=`${f.name} (Diffuse)`,f.albedoTexture=y}))),g.specularGlossinessTexture&&(p.push(this._loader.loadTextureInfoAsync(`${y}/specularGlossinessTexture`,g.specularGlossinessTexture,(y=>{y.name=`${f.name} (Specular Glossiness)`,f.reflectivityTexture=y,f.reflectivityTexture.Be=!0}))),f.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(p).then((()=>{}))}}O(ay),E(ay,!0,(y=>new wy(y)));const oy="KHR_materials_unlit";class Iy{constructor(y){this.name=oy,this.order=210,this._loader=y,this.enabled=this._loader.isExtensionUsed(oy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,(()=>this._loadUnlitPropertiesAsync(y,g,f)))}_loadUnlitPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;f.unlit=!0;const S=g.pbrMetallicRoughness;return S&&(S.baseColorFactor?(f.albedoColor=k.c.eh(S.baseColorFactor),f.alpha=S.baseColorFactor[3]):f.albedoColor=k.c.White(),S.baseColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/baseColorTexture`,S.baseColorTexture,(y=>{y.name=`${f.name} (Base Color)`,f.albedoTexture=y})))),g.doubleSided&&(f.oh=!1,f.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(y,g,f),Promise.all(p).then((()=>{}))}}O(oy),E(oy,!0,(y=>new Iy(y)));const Yy="KHR_materials_clearcoat";class ny{constructor(y){this.name=Yy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(Yy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadClearCoatPropertiesAsync(p,S,f)),Promise.all(k).then((()=>{}))}))}_loadClearCoatPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return f.clearCoat.isEnabled=!0,f.clearCoat.useRoughnessFromMainTexture=!1,f.clearCoat.remapF0OnInterfaceChange=!1,void 0!=g.clearcoatFactor?f.clearCoat.cj=g.clearcoatFactor:f.clearCoat.cj=0,g.clearcoatTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatTexture`,g.clearcoatTexture,(y=>{y.name=`${f.name} (ClearCoat)`,f.clearCoat.texture=y}))),void 0!=g.clearcoatRoughnessFactor?f.clearCoat.roughness=g.clearcoatRoughnessFactor:f.clearCoat.roughness=0,g.clearcoatRoughnessTexture&&(g.clearcoatRoughnessTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatRoughnessTexture`,g.clearcoatRoughnessTexture,(y=>{y.name=`${f.name} (ClearCoat Roughness)`,f.clearCoat.textureRoughness=y})))),g.clearcoatNormalTexture&&(g.clearcoatNormalTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatNormalTexture`,g.clearcoatNormalTexture,(y=>{y.name=`${f.name} (ClearCoat Normal)`,f.clearCoat.bumpTexture=y}))),f.invertNormalMapX=!f.va().useRightHandedSystem,f.invertNormalMapY=f.va().useRightHandedSystem,void 0!=g.clearcoatNormalTexture.scale&&(f.clearCoat.bumpTexture.level=g.clearcoatNormalTexture.scale)),Promise.all(p).then((()=>{}))}}O(Yy),E(Yy,!0,(y=>new ny(y)));const My="KHR_materials_iridescence";class ry{constructor(y){this.name=My,this.order=195,this._loader=y,this.enabled=this._loader.isExtensionUsed(My)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadIridescencePropertiesAsync(p,S,f)),Promise.all(k).then((()=>{}))}))}_loadIridescencePropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return f.iridescence.isEnabled=!0,f.iridescence.cj=g.iridescenceFactor??0,f.iridescence.indexOfRefraction=g.iridescenceIor??g.iridescenceIOR??1.3,f.iridescence.minimumThickness=g.iridescenceThicknessMinimum??100,f.iridescence.maximumThickness=g.iridescenceThicknessMaximum??400,g.iridescenceTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/iridescenceTexture`,g.iridescenceTexture,(y=>{y.name=`${f.name} (Iridescence)`,f.iridescence.texture=y}))),g.iridescenceThicknessTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/iridescenceThicknessTexture`,g.iridescenceThicknessTexture,(y=>{y.name=`${f.name} (Iridescence Thickness)`,f.iridescence.thicknessTexture=y}))),Promise.all(p).then((()=>{}))}}O(My),E(My,!0,(y=>new ry(y)));const Ny="KHR_materials_anisotropy";class by{constructor(y){this.name=Ny,this.order=195,this._loader=y,this.enabled=this._loader.isExtensionUsed(Ny)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadIridescencePropertiesAsync(p,S,f)),Promise.all(k).then((()=>{}))}))}_loadIridescencePropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return f.anisotropy.isEnabled=!0,f.anisotropy.cj=g.anisotropyStrength??0,f.anisotropy.angle=g.anisotropyRotation??0,g.anisotropyTexture&&(g.anisotropyTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${y}/anisotropyTexture`,g.anisotropyTexture,(y=>{y.name=`${f.name} (Anisotropy Intensity)`,f.anisotropy.texture=y})))),Promise.all(p).then((()=>{}))}}O(Ny),E(Ny,!0,(y=>new by(y)));const sy="KHR_materials_emissive_strength";class uy{constructor(y){this.name=sy,this.order=170,this._loader=y,this.enabled=this._loader.isExtensionUsed(sy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>this._loader.loadMaterialPropertiesAsync(y,g,f).then((()=>{this._loadEmissiveProperties(p,S,f)}))))}_loadEmissiveProperties(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);void 0!==g.emissiveStrength&&(f.emissiveIntensity=g.emissiveStrength)}}O(sy),E(sy,!0,(y=>new uy(y)));const Fy="KHR_materials_sheen";class Ay{constructor(y){this.name=Fy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(Fy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadSheenPropertiesAsync(p,S,f)),Promise.all(k).then((()=>{}))}))}_loadSheenPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return f.sheen.isEnabled=!0,f.sheen.cj=1,void 0!=g.sheenColorFactor?f.sheen.color=k.c.eh(g.sheenColorFactor):f.sheen.color=k.c.Black(),g.sheenColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/sheenColorTexture`,g.sheenColorTexture,(y=>{y.name=`${f.name} (Sheen Color)`,f.sheen.texture=y}))),void 0!==g.sheenRoughnessFactor?f.sheen.roughness=g.sheenRoughnessFactor:f.sheen.roughness=0,g.sheenRoughnessTexture&&(g.sheenRoughnessTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${y}/sheenRoughnessTexture`,g.sheenRoughnessTexture,(y=>{y.name=`${f.name} (Sheen Roughness)`,f.sheen.textureRoughness=y})))),f.sheen.albedoScaling=!0,f.sheen.useRoughnessFromMainTexture=!1,Promise.all(p).then((()=>{}))}}O(Fy),E(Fy,!0,(y=>new Ay(y)));const Jy="KHR_materials_specular";class Vy{constructor(y){this.name=Jy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(Jy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadSpecularPropertiesAsync(p,S,f)),Promise.all(k).then((()=>{}))}))}_loadSpecularPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const p=new Array;return void 0!==g.specularFactor&&(f.metallicF0Factor=g.specularFactor),void 0!==g.specularColorFactor&&(f.metallicReflectanceColor=k.c.eh(g.specularColorFactor)),g.specularTexture&&(g.specularTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${y}/specularTexture`,g.specularTexture,(y=>{y.name=`${f.name} (Specular)`,f.metallicReflectanceTexture=y,f.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),g.specularColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/specularColorTexture`,g.specularColorTexture,(y=>{y.name=`${f.name} (Specular Color)`,f.reflectanceTexture=y}))),Promise.all(p).then((()=>{}))}}O(Jy),E(Jy,!0,(y=>new Vy(y)));const ey="KHR_materials_ior";class hy{constructor(y){this.name=ey,this.order=180,this._loader=y,this.enabled=this._loader.isExtensionUsed(ey)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadIorPropertiesAsync(p,S,f)),Promise.all(k).then((()=>{}))}))}_loadIorPropertiesAsync(y,g,f){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);return void 0!==g.ior?f.indexOfRefraction=g.ior:f.indexOfRefraction=hy._DEFAULT_IOR,Promise.resolve()}}hy._DEFAULT_IOR=1.5,O(ey),E(ey,!0,(y=>new hy(y)));const Dy="KHR_materials_variants";class Ky{constructor(y){this.name=Dy,this._loader=y,this.enabled=this._loader.isExtensionUsed(Dy)}dispose(){this._loader=null}static GetAvailableVariants(y){const g=this._GetExtensionMetadata(y);return g?Object.keys(g.variants):[]}getAvailableVariants(y){return Ky.GetAvailableVariants(y)}static SelectVariant(y,g){const f=this._GetExtensionMetadata(y);if(!f)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Dy} extension`);const p=y=>{const g=f.variants[y];if(g)for(const f of g)f.mesh.material=f.material};if(g instanceof Array)for(const S of g)p(S);else p(g);f.lastSelected=g}selectVariant(y,g){Ky.SelectVariant(y,g)}static Reset(y){const g=this._GetExtensionMetadata(y);if(!g)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Dy} extension`);for(const f of g.original)f.mesh.material=f.material;g.lastSelected=null}reset(y){Ky.Reset(y)}static GetLastSelectedVariant(y){const g=this._GetExtensionMetadata(y);if(!g)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Dy} extension`);return g.lastSelected}getLastSelectedVariant(y){return Ky.GetLastSelectedVariant(y)}static _GetExtensionMetadata(y){var g,f;return(null===y||void 0===y||null===(g=y._internalMetadata)||void 0===g||null===(f=g.Si)||void 0===f?void 0:f[Dy])||null}onLoading(){const y=this._loader.Si.extensions;if(y&&y[this.name]){const g=y[this.name];this._variants=g.variants}}_loadMeshPrimitiveAsync(y,g,f,p,S,k){return d.LoadExtensionAsync(y,S,this.name,((i,H)=>{const U=new Array;return U.push(this._loader._loadMeshPrimitiveAsync(y,g,f,p,S,(g=>{if(k(g),g instanceof r.e){const f=d._GetDrawMode(y,S.mode),p=this._loader.rootBabylonMesh,k=p?p._internalMetadata=p._internalMetadata||{}:{},l=k.Si=k.Si||{},c=l[Dy]=l[Dy]||{lastSelected:null,original:[],variants:{}};c.original.push({mesh:g,material:g.material});for(let y=0;y<H.mappings.length;++y){const S=H.mappings[y],k=x.Get(`${i}/mappings/${y}/material`,this._loader.Si.materials,S.material);U.push(this._loader._loadMaterialAsync(`#/materials/${S.material}`,k,g,f,(y=>{for(let f=0;f<S.variants.length;++f){const k=S.variants[f],i=x.Get(`/extensions/${Dy}/variants/${k}`,this._variants,k);c.variants[i.name]=c.variants[i.name]||[],c.variants[i.name].push({mesh:g,material:y}),g.onClonedObservable.add((y=>{const f=y;let S=null,k=f;do{if(k=k.parent,!k)return;S=Ky._GetExtensionMetadata(k)}while(null===S);if(p&&S===Ky._GetExtensionMetadata(p)){k._internalMetadata={};for(const y in p._internalMetadata)k._internalMetadata[y]=p._internalMetadata[y];k._internalMetadata.Si=[];for(const y in p._internalMetadata.Si)k._internalMetadata.Si[y]=p._internalMetadata.Si[y];k._internalMetadata.Si[Dy]={lastSelected:null,original:[],variants:{}};for(const y of S.original)k._internalMetadata.Si[Dy].original.push({mesh:y.mesh,material:y.material});for(const y in S.variants)if(Object.prototype.hasOwnProperty.call(S.variants,y)){k._internalMetadata.Si[Dy].variants[y]=[];for(const g of S.variants[y])k._internalMetadata.Si[Dy].variants[y].push({mesh:g.mesh,material:g.material})}S=k._internalMetadata.Si[Dy]}for(const p of S.original)p.mesh===g&&(p.mesh=f);for(const p of S.variants[i.name])p.mesh===g&&(p.mesh=f)}))}})))}}}))),Promise.all(U).then((y=>{let[g]=y;return g}))}))}}O(Dy),E(Dy,!0,(y=>new Ky(y)));var Xy=f(11585);class Ey{}Ey.AUTOSAMPLERSUFFIX="Sampler",Ey.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Ey.ALPHA_DISABLE=0,Ey.ALPHA_ADD=1,Ey.ALPHA_COMBINE=2,Ey.ALPHA_SUBTRACT=3,Ey.ALPHA_MULTIPLY=4,Ey.ALPHA_MAXIMIZED=5,Ey.ALPHA_ONEONE=6,Ey.ALPHA_PREMULTIPLIED=7,Ey.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Ey.ALPHA_INTERPOLATE=9,Ey.ALPHA_SCREENMODE=10,Ey.ALPHA_ONEONE_ONEONE=11,Ey.ALPHA_ALPHATOCOLOR=12,Ey.ALPHA_REVERSEONEMINUS=13,Ey.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Ey.ALPHA_ONEONE_ONEZERO=15,Ey.ALPHA_EXCLUSION=16,Ey.ALPHA_LAYER_ACCUMULATE=17,Ey.ALPHA_EQUATION_ADD=0,Ey.ALPHA_EQUATION_SUBSTRACT=1,Ey.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Ey.ALPHA_EQUATION_MAX=3,Ey.ALPHA_EQUATION_MIN=4,Ey.ALPHA_EQUATION_DARKEN=5,Ey.DELAYLOADSTATE_NONE=0,Ey.DELAYLOADSTATE_LOADED=1,Ey.DELAYLOADSTATE_LOADING=2,Ey.DELAYLOADSTATE_NOTLOADED=4,Ey.NEVER=512,Ey.ALWAYS=519,Ey.LESS=513,Ey.EQUAL=514,Ey.LEQUAL=515,Ey.GREATER=516,Ey.GEQUAL=518,Ey.NOTEQUAL=517,Ey.KEEP=7680,Ey.ZERO=0,Ey.REPLACE=7681,Ey.INCR=7682,Ey.DECR=7683,Ey.INVERT=5386,Ey.INCR_WRAP=34055,Ey.DECR_WRAP=34056,Ey.TEXTURE_CLAMP_ADDRESSMODE=0,Ey.TEXTURE_WRAP_ADDRESSMODE=1,Ey.TEXTURE_MIRROR_ADDRESSMODE=2,Ey.TEXTURE_CREATIONFLAG_STORAGE=1,Ey.TEXTUREFORMAT_ALPHA=0,Ey.TEXTUREFORMAT_LUMINANCE=1,Ey.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Ey.TEXTUREFORMAT_RGB=4,Ey.TEXTUREFORMAT_RGBA=5,Ey.TEXTUREFORMAT_RED=6,Ey.TEXTUREFORMAT_R=6,Ey.TEXTUREFORMAT_RG=7,Ey.TEXTUREFORMAT_RED_INTEGER=8,Ey.TEXTUREFORMAT_R_INTEGER=8,Ey.TEXTUREFORMAT_RG_INTEGER=9,Ey.TEXTUREFORMAT_RGB_INTEGER=10,Ey.TEXTUREFORMAT_RGBA_INTEGER=11,Ey.TEXTUREFORMAT_BGRA=12,Ey.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Ey.TEXTUREFORMAT_DEPTH32_FLOAT=14,Ey.TEXTUREFORMAT_DEPTH16=15,Ey.TEXTUREFORMAT_DEPTH24=16,Ey.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Ey.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Ey.TEXTUREFORMAT_STENCIL8=19,Ey.TEXTUREFORMAT_UNDEFINED=4294967295,Ey.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Ey.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Ey.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Ey.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Ey.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Ey.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Ey.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Ey.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Ey.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Ey.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Ey.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Ey.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Ey.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Ey.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Ey.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Ey.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Ey.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Ey.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Ey.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Ey.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Ey.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Ey.TEXTURETYPE_UNSIGNED_BYTE=0,Ey.TEXTURETYPE_UNSIGNED_INT=0,Ey.TEXTURETYPE_FLOAT=1,Ey.TEXTURETYPE_HALF_FLOAT=2,Ey.TEXTURETYPE_BYTE=3,Ey.TEXTURETYPE_SHORT=4,Ey.TEXTURETYPE_UNSIGNED_SHORT=5,Ey.TEXTURETYPE_INT=6,Ey.TEXTURETYPE_UNSIGNED_INTEGER=7,Ey.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Ey.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Ey.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Ey.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Ey.TEXTURETYPE_UNSIGNED_INT_24_8=12,Ey.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Ey.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Ey.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Ey.TEXTURETYPE_UNDEFINED=16,Ey.TEXTURE_2D=3553,Ey.TEXTURE_2D_ARRAY=35866,Ey.TEXTURE_CUBE_MAP=34067,Ey.TEXTURE_CUBE_MAP_ARRAY=3735928559,Ey.TEXTURE_3D=32879,Ey.TEXTURE_NEAREST_SAMPLINGMODE=1,Ey.TEXTURE_NEAREST_NEAREST=1,Ey.TEXTURE_BILINEAR_SAMPLINGMODE=2,Ey.TEXTURE_LINEAR_LINEAR=2,Ey.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Ey.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Ey.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Ey.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Ey.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Ey.TEXTURE_NEAREST_LINEAR=7,Ey.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Ey.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Ey.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Ey.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Ey.TEXTURE_LINEAR_NEAREST=12,Ey.TEXTURE_EXPLICIT_MODE=0,Ey.TEXTURE_SPHERICAL_MODE=1,Ey.TEXTURE_PLANAR_MODE=2,Ey.TEXTURE_CUBIC_MODE=3,Ey.TEXTURE_PROJECTION_MODE=4,Ey.TEXTURE_SKYBOX_MODE=5,Ey.TEXTURE_INVCUBIC_MODE=6,Ey.TEXTURE_EQUIRECTANGULAR_MODE=7,Ey.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Ey.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Ey.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Ey.TEXTURE_FILTERING_QUALITY_HIGH=64,Ey.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Ey.TEXTURE_FILTERING_QUALITY_LOW=8,Ey.SCALEMODE_FLOOR=1,Ey.SCALEMODE_NEAREST=2,Ey.SCALEMODE_CEILING=3,Ey.MATERIAL_TextureDirtyFlag=1,Ey.MATERIAL_LightDirtyFlag=2,Ey.MATERIAL_FresnelDirtyFlag=4,Ey.MATERIAL_AttributesDirtyFlag=8,Ey.MATERIAL_MiscDirtyFlag=16,Ey.MATERIAL_PrePassDirtyFlag=32,Ey.MATERIAL_AllDirtyFlag=63,Ey.MATERIAL_TriangleFillMode=0,Ey.MATERIAL_WireFrameFillMode=1,Ey.MATERIAL_PointFillMode=2,Ey.MATERIAL_PointListDrawMode=3,Ey.MATERIAL_LineListDrawMode=4,Ey.MATERIAL_LineLoopDrawMode=5,Ey.MATERIAL_LineStripDrawMode=6,Ey.MATERIAL_TriangleStripDrawMode=7,Ey.MATERIAL_TriangleFanDrawMode=8,Ey.MATERIAL_ClockWiseSideOrientation=0,Ey.MATERIAL_CounterClockWiseSideOrientation=1,Ey.ACTION_NothingTrigger=0,Ey.ACTION_OnPickTrigger=1,Ey.ACTION_OnLeftPickTrigger=2,Ey.ACTION_OnRightPickTrigger=3,Ey.ACTION_OnCenterPickTrigger=4,Ey.ACTION_OnPickDownTrigger=5,Ey.ACTION_OnDoublePickTrigger=6,Ey.ACTION_OnPickUpTrigger=7,Ey.ACTION_OnPickOutTrigger=16,Ey.ACTION_OnLongPressTrigger=8,Ey.ACTION_OnPointerOverTrigger=9,Ey.ACTION_OnPointerOutTrigger=10,Ey.ACTION_OnEveryFrameTrigger=11,Ey.ACTION_OnIntersectionEnterTrigger=12,Ey.ACTION_OnIntersectionExitTrigger=13,Ey.ACTION_OnKeyDownTrigger=14,Ey.ACTION_OnKeyUpTrigger=15,Ey.PARTICLES_BILLBOARDMODE_Y=2,Ey.PARTICLES_BILLBOARDMODE_ALL=7,Ey.PARTICLES_BILLBOARDMODE_STRETCHED=8,Ey.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Ey.MESHES_CULLINGSTRATEGY_STANDARD=0,Ey.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Ey.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Ey.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Ey.SCENELOADER_NO_LOGGING=0,Ey.SCENELOADER_MINIMAL_LOGGING=1,Ey.SCENELOADER_SUMMARY_LOGGING=2,Ey.SCENELOADER_DETAILED_LOGGING=3,Ey.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Ey.PREPASS_POSITION_TEXTURE_TYPE=1,Ey.PREPASS_VELOCITY_TEXTURE_TYPE=2,Ey.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Ey.PREPASS_COLOR_TEXTURE_TYPE=4,Ey.PREPASS_DEPTH_TEXTURE_TYPE=5,Ey.PREPASS_NORMAL_TEXTURE_TYPE=6,Ey.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Ey.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,Ey.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,Ey.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,Ey.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,Ey.PREPASS_ALBEDO_TEXTURE_TYPE=12,Ey.BUFFER_CREATIONFLAG_READ=1,Ey.BUFFER_CREATIONFLAG_WRITE=2,Ey.BUFFER_CREATIONFLAG_READWRITE=3,Ey.BUFFER_CREATIONFLAG_UNIFORM=4,Ey.BUFFER_CREATIONFLAG_VERTEX=8,Ey.BUFFER_CREATIONFLAG_INDEX=16,Ey.BUFFER_CREATIONFLAG_STORAGE=32,Ey.BUFFER_CREATIONFLAG_INDIRECT=64,Ey.RENDERPASS_MAIN=0,Ey.INPUT_ALT_KEY=18,Ey.INPUT_CTRL_KEY=17,Ey.INPUT_META_KEY1=91,Ey.INPUT_META_KEY2=92,Ey.INPUT_META_KEY3=93,Ey.INPUT_SHIFT_KEY=16,Ey.SNAPSHOTRENDERING_STANDARD=0,Ey.SNAPSHOTRENDERING_FAST=1,Ey.PERSPECTIVE_CAMERA=0,Ey.ORTHOGRAPHIC_CAMERA=1,Ey.FOVMODE_VERTICAL_FIXED=0,Ey.FOVMODE_HORIZONTAL_FIXED=1,Ey.RIG_MODE_NONE=0,Ey.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Ey.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Ey.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Ey.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Ey.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Ey.RIG_MODE_VR=20,Ey.RIG_MODE_CUSTOM=22,Ey.MAX_SUPPORTED_UV_SETS=6,Ey.GL_ALPHA_EQUATION_ADD=32774,Ey.GL_ALPHA_EQUATION_MIN=32775,Ey.GL_ALPHA_EQUATION_MAX=32776,Ey.GL_ALPHA_EQUATION_SUBTRACT=32778,Ey.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Ey.GL_ALPHA_FUNCTION_SRC=768,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Ey.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Ey.GL_ALPHA_FUNCTION_DST_ALPHA=772,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Ey.GL_ALPHA_FUNCTION_DST_COLOR=774,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Ey.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Ey.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Ey.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Ey.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,Ey.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,Ey.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,Ey.SnippetUrl="https://snippet.babylonjs.com",Ey.FOGMODE_NONE=0,Ey.FOGMODE_EXP=1,Ey.FOGMODE_EXP2=2,Ey.FOGMODE_LINEAR=3,Ey.BYTE=5120,Ey.UNSIGNED_BYTE=5121,Ey.SHORT=5122,Ey.UNSIGNED_SHORT=5123,Ey.INT=5124,Ey.UNSIGNED_INT=5125,Ey.FLOAT=5126,Ey.PositionKind="position",Ey.NormalKind="k",Ey.TangentKind="tangent",Ey.UVKind="uv",Ey.UV2Kind="uv2",Ey.UV3Kind="uv3",Ey.UV4Kind="uv4",Ey.UV5Kind="uv5",Ey.UV6Kind="uv6",Ey.ColorKind="color",Ey.ColorInstanceKind="instanceColor",Ey.MatricesIndicesKind="matricesIndices",Ey.MatricesWeightsKind="matricesWeights",Ey.MatricesIndicesExtraKind="matricesIndicesExtra",Ey.MatricesWeightsExtraKind="matricesWeightsExtra";class Oy{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Ey.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(y,g){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Oy._GetDefaultOptions(),...y},this._scene=g,this._scene._transmissionHelper=this,this.onErrorObservable=new c.d,this._scene.nj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(y){if(!Object.keys(y).filter((g=>this._options[g]!==y[g])).length)return;const g={...this._options,...y},f=this._options;this._options=g,g.renderSize===f.renderSize&&g.renderTargetTextureType===f.renderTargetTextureType&&g.generateMipmaps===f.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=g.samples,this._opaqueRenderTarget.lodGenerationScale=g.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=g.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(y){return!!y&&!!(y instanceof w&&y.subSurface.isRefractionEnabled)}_addMesh(y){this._materialObservers[y.uniqueId]=y.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),i.e.SetImmediate((()=>{this._shouldRenderAsTransmission(y.material)?(y.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(y)&&this._transparentMeshesCache.push(y)):-1===this._opaqueMeshesCache.indexOf(y)&&this._opaqueMeshesCache.push(y)}))}_removeMesh(y){y.onMaterialChangedObservable.remove(this._materialObservers[y.uniqueId]),delete this._materialObservers[y.uniqueId];let g=this._transparentMeshesCache.indexOf(y);-1!==g&&this._transparentMeshesCache.splice(g,1),g=this._opaqueMeshesCache.indexOf(y),-1!==g&&this._opaqueMeshesCache.splice(g,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(y){const g=this._transparentMeshesCache.indexOf(y),f=this._opaqueMeshesCache.indexOf(y);this._shouldRenderAsTransmission(y.material)?(y.material instanceof w&&(y.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==f?(this._opaqueMeshesCache.splice(f,1),this._transparentMeshesCache.push(y)):-1===g&&this._transparentMeshesCache.push(y)):-1!==g?(this._transparentMeshesCache.splice(g,1),this._opaqueMeshesCache.push(y)):-1===f&&this._opaqueMeshesCache.push(y)}_isRenderTargetValid(){var y;return null!==(null===(y=this._opaqueRenderTarget)||void 0===y?void 0:y.getInternalTexture())}_setupRenderTargets(){var y;let g,f;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Xy.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(y=this._options.clearColor)||void 0===y?void 0:y.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((y=>{f=this._scene.environmentIntensity,this._scene.environmentIntensity=1,g=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?y.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(y.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=f,this._scene.imageProcessingConfiguration._applyByPostProcess=g})),this._transparentMeshesCache.forEach((y=>{this._shouldRenderAsTransmission(y.material)&&(y.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Ly="KHR_materials_transmission";class xy{constructor(y){this.name=Ly,this.order=175,this._loader=y,this.enabled=this._loader.isExtensionUsed(Ly),this.enabled&&(y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadTransparentPropertiesAsync(p,g,f,S)),Promise.all(k).then((()=>{}))}))}_loadTransparentPropertiesAsync(y,g,f,p){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const S=f;if(S.subSurface.isRefractionEnabled=!0,S.subSurface.volumeIndexOfRefraction=1,S.subSurface.useAlbedoToTintRefraction=!0,void 0===p.transmissionFactor)return S.subSurface.refractionIntensity=0,S.subSurface.isRefractionEnabled=!1,Promise.resolve();{var k;S.subSurface.refractionIntensity=p.transmissionFactor;const y=S.va();if(S.subSurface.refractionIntensity&&!y._transmissionHelper)new Oy({},S.va());else if(S.subSurface.refractionIntensity&&(null===(k=y._transmissionHelper)||void 0===k||!k._isRenderTargetValid())){var i;null===(i=y._transmissionHelper)||void 0===i||i._setupRenderTargets()}}return S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=0,p.transmissionTexture?(p.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${y}/transmissionTexture`,p.transmissionTexture,void 0).then((y=>{y.name=`${f.name} (Transmission)`,S.subSurface.refractionIntensityTexture=y,S.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}O(Ly),E(Ly,!0,(y=>new xy(y)));const dy="KHR_materials_diffuse_transmission";class ty{constructor(y){this.name=dy,this.order=174,this._loader=y,this.enabled=this._loader.isExtensionUsed(dy),this.enabled&&(y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadTranslucentPropertiesAsync(p,g,f,S)),Promise.all(k).then((()=>{}))}))}_loadTranslucentPropertiesAsync(y,g,f,p){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);const S=f;if(S.subSurface.isTranslucencyEnabled=!0,S.subSurface.volumeIndexOfRefraction=1,S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=0,S.subSurface.useAlbedoToTintTranslucency=!1,void 0===p.diffuseTransmissionFactor)return S.subSurface.translucencyIntensity=0,S.subSurface.isTranslucencyEnabled=!1,Promise.resolve();S.subSurface.translucencyIntensity=p.diffuseTransmissionFactor;const i=new Array;return S.subSurface.useGltfStyleTextures=!0,p.diffuseTransmissionTexture&&(p.diffuseTransmissionTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTransmissionTexture`,p.diffuseTransmissionTexture).then((y=>{y.name=`${f.name} (Diffuse Transmission)`,S.subSurface.translucencyIntensityTexture=y})))),void 0!==p.diffuseTransmissionColorFactor?S.subSurface.translucencyColor=k.c.eh(p.diffuseTransmissionColorFactor):S.subSurface.translucencyColor=k.c.White(),p.diffuseTransmissionColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTransmissionColorTexture`,p.diffuseTransmissionColorTexture).then((y=>{y.name=`${f.name} (Diffuse Transmission Color)`,S.subSurface.translucencyColorTexture=y}))),Promise.all(i).then((()=>{}))}}O(dy),E(dy,!0,(y=>new ty(y)));const vy="KHR_materials_volume";class yg{constructor(y){this.name=vy,this.order=173,this._loader=y,this.enabled=this._loader.isExtensionUsed(vy),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadVolumePropertiesAsync(p,g,f,S)),Promise.all(k).then((()=>{}))}))}_loadVolumePropertiesAsync(y,g,f,p){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);if(!f.subSurface.isRefractionEnabled&&!f.subSurface.isTranslucencyEnabled||!p.thicknessFactor)return Promise.resolve();f.subSurface.volumeIndexOfRefraction=f.indexOfRefraction;const S=void 0!==p.attenuationDistance?p.attenuationDistance:Number.MAX_VALUE;return f.subSurface.tintColorAtDistance=S,void 0!==p.attenuationColor&&3==p.attenuationColor.length&&f.subSurface.tintColor.ne(p.attenuationColor[0],p.attenuationColor[1],p.attenuationColor[2]),f.subSurface.minimumThickness=0,f.subSurface.maximumThickness=p.thicknessFactor,f.subSurface.useThicknessAsDepth=!0,p.thicknessTexture?(p.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${y}/thicknessTexture`,p.thicknessTexture).then((y=>{y.name=`${f.name} (Thickness)`,f.subSurface.thicknessTexture=y,f.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}O(vy),E(vy,!0,(y=>new yg(y)));const gg="KHR_materials_dispersion";class fg{constructor(y){this.name=gg,this.order=174,this._loader=y,this.enabled=this._loader.isExtensionUsed(gg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(y,g,f)),k.push(this._loadDispersionPropertiesAsync(p,g,f,S)),Promise.all(k).then((()=>{}))}))}_loadDispersionPropertiesAsync(y,g,f,p){if(!(f instanceof w))throw new Error(`${y}: Material type not supported`);return f.subSurface.isRefractionEnabled&&p.dispersion?(f.subSurface.isDispersionEnabled=!0,f.subSurface.dispersion=p.dispersion,Promise.resolve()):Promise.resolve()}}O(gg),E(gg,!0,(y=>new fg(y)));const pg="KHR_mesh_quantization";class Sg{constructor(y){this.name=pg,this.enabled=y.isExtensionUsed(pg)}dispose(){}}O(pg),E(pg,!0,(y=>new Sg(y)));const kg="KHR_texture_basisu";class ig{constructor(y){this.name=kg,this._loader=y,this.enabled=y.isExtensionUsed(kg)}dispose(){this._loader=null}_loadTextureAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>{const k=void 0==g.sampler?d.DefaultSampler:x.Get(`${y}/sampler`,this._loader.Si.samplers,g.sampler),i=x.Get(`${p}/source`,this._loader.Si.images,S.source);return this._loader._createTextureAsync(y,k,i,(y=>{f(y)}),g._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!g._textureInfo.nonColorData)}))}}O(kg),E(kg,!0,(y=>new ig(y)));const Hg="KHR_texture_transform";class Ug{constructor(y){this.name=Hg,this._loader=y,this.enabled=this._loader.isExtensionUsed(Hg)}dispose(){this._loader=null}loadTextureInfoAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((p,S)=>this._loader.loadTextureInfoAsync(y,g,(y=>{if(!(y instanceof o.c))throw new Error(`${p}: Texture type not supported`);S.offset&&(y.uOffset=S.offset[0],y.vOffset=S.offset[1]),y.uRotationCenter=0,y.vRotationCenter=0,S.rotation&&(y.wAng=-S.rotation),S.scale&&(y.uScale=S.scale[0],y.vScale=S.scale[1]),void 0!=S.texCoord&&(y.coordinatesIndex=S.texCoord),f(y)}))))}}O(Hg),E(Hg,!0,(y=>new Ug(y)));const lg="KHR_xmp_json_ld";class cg{constructor(y){this.name=lg,this.order=100,this._loader=y,this.enabled=this._loader.isExtensionUsed(lg)}dispose(){this._loader=null}onLoading(){var y,g,f;if(null===this._loader.rootBabylonMesh)return;const p=null===(y=this._loader.Si.extensions)||void 0===y?void 0:y.KHR_xmp_json_ld,S=null===(g=this._loader.Si.asset)||void 0===g||null===(f=g.extensions)||void 0===f?void 0:f.KHR_xmp_json_ld;if(p&&S){const y=+S.packet;p.packets&&y<p.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=p.packets[y])}}}function Zg(y,g,f,p){return k.c.eh(g,f).scale(p)}function Cg(y,g,f,p){return g[f]*p}function qg(y,g,f,p){return-g[f]*p}function Wg(y,g,f,p){return g[f+1]*p}function jg(y,g,f,p){return g[f]*p*2}function Pg(y){return{scale:[new Rg(C.c.ANIMATIONTYPE_FLOAT,`${y}.uScale`,Cg,(()=>2)),new Rg(C.c.ANIMATIONTYPE_FLOAT,`${y}.vScale`,Wg,(()=>2))],offset:[new Rg(C.c.ANIMATIONTYPE_FLOAT,`${y}.uOffset`,Cg,(()=>2)),new Rg(C.c.ANIMATIONTYPE_FLOAT,`${y}.vOffset`,Wg,(()=>2))],rotation:[new Rg(C.c.ANIMATIONTYPE_FLOAT,`${y}.wAng`,qg,(()=>1))]}}O(lg),E(lg,!0,(y=>new cg(y)));class Bg extends e{buildAnimations(y,g,f,p,S){S(y._babylonCamera,this._buildAnimation(g,f,p))}}class Rg extends e{buildAnimations(y,g,f,p,S){for(const k in y._data)S(y._data[k].babylonMaterial,this._buildAnimation(g,f,p))}}class Gg extends e{buildAnimations(y,g,f,p,S){S(y._babylonLight,this._buildAnimation(g,f,p))}}const zg={__array__:{__target__:!0,...D}},Tg={__array__:{__target__:!0,orthographic:{xmag:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"orthoLeft",qg,(()=>1)),new Bg(C.c.ANIMATIONTYPE_FLOAT,"orthoRight",Wg,(()=>1))],ymag:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"orthoBottom",qg,(()=>1)),new Bg(C.c.ANIMATIONTYPE_FLOAT,"orthoTop",Wg,(()=>1))],zfar:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"maxZ",Cg,(()=>1))],znear:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"$i",Cg,(()=>1))]},perspective:{yfov:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"fov",Cg,(()=>1))],zfar:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"maxZ",Cg,(()=>1))],znear:[new Bg(C.c.ANIMATIONTYPE_FLOAT,"$i",Cg,(()=>1))]}}},Qg={nodes:zg,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Rg(C.c.ANIMATIONTYPE_COLOR3,"albedoColor",Zg,(()=>4)),new Rg(C.c.ANIMATIONTYPE_FLOAT,"alpha",(function(y,g,f,p){return g[f+3]*p}),(()=>4))],metallicFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"metallic",Cg,(()=>1))],roughnessFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"roughness",Cg,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Pg("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Pg("metallicTexture")}}},emissiveFactor:[new Rg(C.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Zg,(()=>3))],normalTexture:{scale:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Cg,(()=>1))],extensions:{KHR_texture_transform:Pg("bumpTexture")}},occlusionTexture:{strength:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Cg,(()=>1))],extensions:{KHR_texture_transform:Pg("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Pg("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Cg,(()=>1))],anisotropyRotation:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Cg,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Pg("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Cg,(()=>1))],clearcoatRoughnessFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Cg,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Pg("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Cg,(()=>1))],extensions:{KHR_texture_transform:Pg("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Pg("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Cg,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Cg,(()=>1))]},KHR_materials_ior:{ior:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Cg,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Cg,(()=>1))],iridescenceIor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Cg,(()=>1))],iridescenceThicknessMinimum:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Cg,(()=>1))],iridescenceThicknessMaximum:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Cg,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Pg("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Pg("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Rg(C.c.ANIMATIONTYPE_COLOR3,"sheen.color",Zg,(()=>3))],sheenRoughnessFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Cg,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Pg("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Pg("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Cg,(()=>1))],specularColorFactor:[new Rg(C.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Zg,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Pg("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Pg("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Cg,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Pg("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Rg(C.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Zg,(()=>3))],attenuationDistance:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Cg,(()=>1))],thicknessFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Cg,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Pg("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Rg(C.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Cg,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Pg("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Rg(C.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Zg,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Pg("subSurface.translucencyColorTexture")}}}}}},cameras:Tg,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Gg(C.c.ANIMATIONTYPE_COLOR3,"diffuse",Zg,(()=>3))],cj:[new Gg(C.c.ANIMATIONTYPE_FLOAT,"intensity",Cg,(()=>1))],range:[new Gg(C.c.ANIMATIONTYPE_FLOAT,"range",Cg,(()=>1))],spot:{innerConeAngle:[new Gg(C.c.ANIMATIONTYPE_FLOAT,"innerAngle",jg,(()=>1))],outerConeAngle:[new Gg(C.c.ANIMATIONTYPE_FLOAT,"angle",jg,(()=>1))]}}}}}};class mg{constructor(y,g){this._gltf=y,this._infoTree=g}convert(y){let g,f=this._gltf,p=this._infoTree;if(!y.startsWith("/"))throw new Error("Path must start with a /");const S=y.split("/");S.shift();for(const k of S){if(p.__array__)p=p.__array__;else if(p=p[k],!p)throw new Error(`Path ${y} is invalid`);if(void 0===f)throw new Error(`Path ${y} is invalid`);f=f[k],p.__target__&&(g=f)}return{object:g,info:p}}}const ag="KHR_animation_pointer";class wg extends mg{constructor(y){super(y,Qg)}}class og{constructor(y){this.name=ag,this._loader=y,this._pathToObjectConverter=new wg(this._loader.Si)}get enabled(){return this._loader.isExtensionUsed(ag)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(y,g,f,p,S){var k;const i=null===(k=p.target.extensions)||void 0===k?void 0:k.KHR_animation_pointer;if(!i||!this._pathToObjectConverter)return null;"pointer"!==p.target.path&&j.d.Warn(`${y}/target/path: Value (${p.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=p.target.node&&j.d.Warn(`${y}/target/node: Value (${p.target.node}) must not be present when using the ${this.name} extension`);const H=`${y}/extensions/${this.name}`,U=i.pointer;if(!U)throw new Error(`${H}: Pointer is missing`);try{const k=this._pathToObjectConverter.convert(U);return this._loader._loadAnimationChannelFromTargetInfoAsync(y,g,f,p,k,S)}catch(l){return j.d.Warn(`${H}/pointer: Invalid pointer (${U}) skipped`),null}}}O(ag),E(ag,!0,(y=>new og(y)));class Ig{constructor(y,g,f){this.frame=y,this.action=g,this.onlyOnce=f,this.isDone=!1}_clone(){return new Ig(this.frame,this.action,this.onlyOnce)}}var Yg=f(10755),ng=f(10797);class Mg{get loop(){return this._loop}set loop(y){y!==this._loop&&(this._loop=y,this.updateOptions({loop:y}))}get currentTime(){var y;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(y=ng.b.audioEngine)&&void 0!==y&&y.audioContext&&(this.isPlaying||this.isPaused)){const y=this.isPaused?0:ng.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+y}return 0}get spatialSound(){return this._spatialSound}set spatialSound(y){if(y==this._spatialSound)return;const g=this.isPlaying;this.pause(),y?(this._spatialSound=y,this._updateSpatialParameters()):this._disableSpatialSound(),g&&this.play()}constructor(y,g,f){var p;let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new c.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=S.m.Zero(),this._localDirection=new S.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=y,f=f||W.d.LastCreatedScene)if(this._scene=f,Mg._SceneComponentInitialization(f),this._readyToPlayCallback=k,this._customAttenuationFunction=(y,g,f,p,S)=>g<f?y*(1-g/f):0,H&&(this.autoplay=H.autoplay||!1,this._loop=H.loop||!1,void 0!==H.volume&&(this._volume=H.volume),this._spatialSound=H.spatialSound??!1,this.maxDistance=H.maxDistance??100,this.useCustomAttenuation=H.useCustomAttenuation??!1,this.rolloffFactor=H.rolloffFactor||1,this.refDistance=H.refDistance||1,this.distanceModel=H.distanceModel||"linear",this._playbackRate=H.playbackRate||1,this._streaming=H.streaming??!1,this._length=H.length,this._offset=H.offset),null!==(p=ng.b.audioEngine)&&void 0!==p&&p.canUseWebAudio&&ng.b.audioEngine.audioContext){this._soundGain=ng.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let y=!0;if(g)try{"string"===typeof g?(this._urlType="String",this._url=g):g instanceof ArrayBuffer?this._urlType="ArrayBuffer":g instanceof HTMLMediaElement?this._urlType="MediaElement":g instanceof MediaStream?this._urlType="MediaStream":g instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(g)&&(this._urlType="Array");let f=[],p=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ng.b.audioEngine.audioContext.createMediaElementSource(g),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ng.b.audioEngine.audioContext.createMediaStreamSource(g),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":g.byteLength>0&&(p=!0,this._soundLoaded(g));break;case"AudioBuffer":this._audioBufferLoaded(g);break;case"String":f.push(g);case"Array":0===f.length&&(f=g);for(let y=0;y<f.length;y++){const g=f[y];if(p=H&&H.skipCodecCheck||-1!==g.indexOf(".mp3",g.length-4)&&ng.b.audioEngine.isMP3supported||-1!==g.indexOf(".ogg",g.length-4)&&ng.b.audioEngine.isOGGsupported||-1!==g.indexOf(".wav",g.length-4)||-1!==g.indexOf(".m4a",g.length-4)||-1!==g.indexOf(".mp4",g.length-4)||-1!==g.indexOf("blob:"),p){this._streaming?(this._htmlAudioElement=new Audio(g),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,i.e.SetCorsBehavior(g,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(g,(y=>{this._soundLoaded(y)}),void 0,!0,!0,(y=>{y&&j.d.Error("XHR "+y.status+" error on: "+g+"."),j.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:y=!1}y?p||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):j.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(U){j.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),ng.b.audioEngine&&!ng.b.audioEngine.WarnedWebAudioUnsupported&&(j.d.Error("Web Audio is not supported by your browser."),ng.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var y;null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(y){var g;null!==(g=ng.b.audioEngine)&&void 0!==g&&g.audioContext&&(this._audioBuffer=y,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(y){var g;null!==(g=ng.b.audioEngine)&&void 0!==g&&g.audioContext&&ng.b.audioEngine.audioContext.decodeAudioData(y,(y=>{this._audioBufferLoaded(y)}),(y=>{j.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+y)}))}setAudioBuffer(y){var g;null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&(this._audioBuffer=y,this._isReadyToPlay=!0)}updateOptions(y){y&&(this.loop=y.loop??this.loop,this.maxDistance=y.maxDistance??this.maxDistance,this.useCustomAttenuation=y.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=y.rolloffFactor??this.rolloffFactor,this.refDistance=y.refDistance??this.refDistance,this.distanceModel=y.distanceModel??this.distanceModel,this._playbackRate=y.playbackRate??this._playbackRate,this._length=y.length??void 0,this.spatialSound=y.spatialSound??this._spatialSound,this._setOffset(y.offset??void 0),this.setVolume(y.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var y;null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&ng.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??ng.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var y;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(y=this._soundPanner)||void 0===y||y.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var y;null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(y){var g;null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(y),this._isOutputConnected=!0)}setDirectionalCone(y,g,f){g<y?j.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=y,this._coneOuterAngle=g,this._coneOuterGain=f,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(y){if(y!=this._coneInnerAngle){var g;if(this._coneOuterAngle<y)return void j.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=y,null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(y){if(y!=this._coneOuterAngle){var g;if(y<this._coneInnerAngle)return void j.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=y,null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(y){var g;y.equals(this._position)||(this._position.p(y),null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(y){var g;this._localDirection=y,null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const y=this._connectedTransformNode.getWorldMatrix(),g=S.m.TransformNormal(this._localDirection,y);g.normalize(),this._soundPanner.orientationX.value=g.x,this._soundPanner.orientationY.value=g.y,this._soundPanner.orientationZ.value=g.z}updateDistanceFromListener(){var y;if(null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const y=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ed(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,y,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(y){this._customAttenuationFunction=y}play(y,g,f){var p;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(p=ng.b.audioEngine)&&void 0!==p&&p.audioContext)try{var S,k;this._clearTimeoutsAndObservers();let p=y?(null===(S=ng.b.audioEngine)||void 0===S?void 0:S.audioContext.currentTime)+y:null===(k=ng.b.audioEngine)||void 0===k?void 0:k.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=ng.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const y=()=>{var f;if(null!==(f=ng.b.audioEngine)&&void 0!==f&&f.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=g??0;const f=this._htmlAudioElement.play();void 0!==f&&f.catch((()=>{var g,f;(null===(g=ng.b.audioEngine)||void 0===g||g.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(f=ng.b.audioEngine)||void 0===f?void 0:f.onAudioUnlockedObservable.addOnce((()=>{y()})))}))}else{var p;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(p=ng.b.audioEngine)||void 0===p?void 0:p.onAudioUnlockedObservable.addOnce((()=>{y()}))}};y()}}else{var i;const S=()=>{var S;if(null!==(S=ng.b.audioEngine)&&void 0!==S&&S.audioContext){var k;if(f=f||this._length,void 0!==g&&this._setOffset(g),this._soundSource){const y=this._soundSource;y.onended=()=>{y.disconnect()}}if(this._soundSource=null===(k=ng.b.audioEngine)||void 0===k?void 0:k.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var i;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==g&&(this._soundSource.loopStart=g),void 0!==f&&(this._soundSource.loopEnd=(0|g)+f),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},p=y?(null===(i=ng.b.audioEngine)||void 0===i?void 0:i.audioContext.currentTime)+y:ng.b.audioEngine.audioContext.currentTime;const S=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(p,S,this.loop?void 0:f)}}};"suspended"===(null===(i=ng.b.audioEngine)||void 0===i?void 0:i.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var y;"suspended"===(null===(y=ng.b.audioEngine)||void 0===y?void 0:y.audioContext.state)?(ng.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=ng.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{S()})))):S()}),500):S()}this._startTime=p,this.isPlaying=!0,this.isPaused=!1}catch(H){j.d.Error("Error while trying to play audio: "+this.name+", "+H.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(y){var g;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var f;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(f=this._streamingSource)||void 0===f||f.disconnect();this.isPlaying=!1}else if(null!==(g=ng.b.audioEngine)&&void 0!==g&&g.audioContext&&this._soundSource){const g=y?ng.b.audioEngine.audioContext.currentTime+y:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(g)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var g;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(g=this._streamingSource)||void 0===g||g.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(y=ng.b.audioEngine)&&void 0!==y&&y.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=ng.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(y,g){var f;null!==(f=ng.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._soundGain&&(g&&ng.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ng.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ng.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(y,ng.b.audioEngine.audioContext.currentTime+g)):this._soundGain.gain.value=y),this._volume=y}setPlaybackRate(y){this._playbackRate=y,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(y){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=y,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=y=>this._onRegisterAfterWorldMatrixUpdate(y),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(y){var g;if(y.getBoundingInfo){const g=y.getBoundingInfo();this.setPosition(g.boundingSphere.centerWorld)}else this.setPosition(y.absolutePosition);null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const y=()=>{this._isReadyToPlay?(f._audioBuffer=this.getAudioBuffer(),f._isReadyToPlay=!0,f.autoplay&&f.play(0,this._offset,this._length)):setTimeout(y,300)},g={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},f=new Mg(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,g);return this.useCustomAttenuation&&f.setAttenuationFunction(this._customAttenuationFunction),f.setPosition(this._position),f.setPlaybackRate(this._playbackRate),y(),f}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const y={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(y.connectedMeshId=this._connectedTransformNode.id),y.position=this._position.mj(),y.refDistance=this.refDistance,y.distanceModel=this.distanceModel,y.isDirectional=this._isDirectional,y.localDirectionToMesh=this._localDirection.mj(),y.coneInnerAngle=this._coneInnerAngle,y.coneOuterAngle=this._coneOuterAngle,y.coneOuterGain=this._coneOuterGain),y}static Parse(y,g,f,p){const k=y.name;let i;i=y.url?f+y.url:f+k;const H={autoplay:y.autoplay,loop:y.loop,volume:y.volume,spatialSound:y.spatialSound,maxDistance:y.maxDistance,rolloffFactor:y.rolloffFactor,refDistance:y.refDistance,distanceModel:y.distanceModel,playbackRate:y.playbackRate};let U;if(p){const y=()=>{p._isReadyToPlay?(U._audioBuffer=p.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)):setTimeout(y,300)};U=new Mg(k,new ArrayBuffer(0),g,null,H),y()}else U=new Mg(k,i,g,(()=>{g.removePendingData(U)}),H),g.addPendingData(U);if(y.position){const g=S.m.eh(y.position);U.setPosition(g)}if(y.isDirectional&&(U.setDirectionalCone(y.coneInnerAngle||360,y.coneOuterAngle||360,y.coneOuterGain||0),y.localDirectionToMesh)){const g=S.m.eh(y.localDirectionToMesh);U.setLocalDirectionToMesh(g)}if(y.connectedMeshId){const f=g.getMeshById(y.connectedMeshId);f&&U.attachToMesh(f)}return y.metadata&&(U.metadata=y.metadata),U}_setOffset(y){this._offset!==y&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=y)}_clearTimeoutsAndObservers(){var y;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(y=ng.b.audioEngine)||void 0===y||y.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Mg._SceneComponentInitialization=y=>{throw(0,Yg.b)("AudioSceneComponent")},(0,m.c)("BABYLON.Sound",Mg);class rg{constructor(y,g,f){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],g.length!==f.length)throw new Error("Sounds length does not equal weights length");this.loop=y,this._weights=f;let p=0;for(const k of f)p+=k;const S=p>0?1/p:0;for(let k=0;k<this._weights.length;k++)this._weights[k]*=S;this._sounds=g;for(const k of this._sounds)k.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(y){if(y!==this._coneInnerAngle){if(this._coneOuterAngle<y)return void j.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=y;for(const g of this._sounds)g.directionalConeInnerAngle=y}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(y){if(y!==this._coneOuterAngle){if(y<this._coneInnerAngle)return void j.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=y;for(const g of this._sounds)g.directionalConeOuterAngle=y}}get volume(){return this._volume}set volume(y){if(y!==this._volume)for(const g of this._sounds)g.setVolume(y)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(y){if(!this.isPaused){this.stop();const y=Math.random();let g=0;for(let f=0;f<this._weights.length;f++)if(g+=this._weights[f],y<=g){this._currentIndex=f;break}}const g=this._sounds[this._currentIndex??0];g.isReady()?g.play(0,this.isPaused?void 0:y):g.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Ng{constructor(y){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(y=y||W.d.LastCreatedScene)&&(this._scene=y,this.soundCollection=[],this._options=g,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var y;null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&ng.b.audioEngine.audioContext&&(this._outputAudioNode=ng.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ng.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(ng.b.audioEngine&&ng.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(y){var g;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&y.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==y.soundTrackId&&(-1===y.soundTrackId?this._scene.mainSoundTrack.removeSound(y):this._scene.soundTracks&&this._scene.soundTracks[y.soundTrackId].removeSound(y)),this.soundCollection.push(y),y.soundTrackId=this.id}removeSound(y){const g=this.soundCollection.indexOf(y);-1!==g&&this.soundCollection.splice(g,1)}setVolume(y){var g;null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=y)}switchPanningModelToHRTF(){var y;if(null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio)for(let g=0;g<this.soundCollection.length;g++)this.soundCollection[g].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var y;if(null!==(y=ng.b.audioEngine)&&void 0!==y&&y.canUseWebAudio)for(let g=0;g<this.soundCollection.length;g++)this.soundCollection[g].switchPanningModelToEqualPower()}connectToAnalyser(y){var g;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=y,null!==(g=ng.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ng.b.audioEngine.masterGain))}}var bg=f(11149),sg=f(11038),ug=(f(11612),f(10747));(0,f(11700).f)(bg.e.NAME_AUDIO,((y,g,f,p)=>{let S,k=[];if(f.dk=f.dk||[],void 0!==y.dk&&null!==y.dk)for(let H=0,U=y.dk.length;H<U;H++){var i;const U=y.dk[H];null!==(i=ng.b.audioEngine)&&void 0!==i&&i.canUseWebAudio?(U.url||(U.url=U.name),k[U.url]?f.dk.push(Mg.Parse(U,g,p,k[U.url])):(S=Mg.Parse(U,g,p),k[U.url]=S,f.dk.push(S))):f.dk.push(new Mg(U.name,null,g))}k=[]})),Object.defineProperty(sg.e.prototype,"mainSoundTrack",{get:function(){let y=this._getComponent(bg.e.NAME_AUDIO);return y||(y=new Fg(this),this.gb(y)),this._mainSoundTrack||(this._mainSoundTrack=new Ng(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),sg.e.prototype.getSoundByName=function(y){let g;for(g=0;g<this.mainSoundTrack.soundCollection.length;g++)if(this.mainSoundTrack.soundCollection[g].name===y)return this.mainSoundTrack.soundCollection[g];if(this.soundTracks)for(let f=0;f<this.soundTracks.length;f++)for(g=0;g<this.soundTracks[f].soundCollection.length;g++)if(this.soundTracks[f].soundCollection[g].name===y)return this.soundTracks[f].soundCollection[g];return null},Object.defineProperty(sg.e.prototype,"audioEnabled",{get:function(){let y=this._getComponent(bg.e.NAME_AUDIO);return y||(y=new Fg(this),this.gb(y)),y.audioEnabled},set:function(y){let g=this._getComponent(bg.e.NAME_AUDIO);g||(g=new Fg(this),this.gb(g)),y?g.enableAudio():g.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(sg.e.prototype,"headphone",{get:function(){let y=this._getComponent(bg.e.NAME_AUDIO);return y||(y=new Fg(this),this.gb(y)),y.headphone},set:function(y){let g=this._getComponent(bg.e.NAME_AUDIO);g||(g=new Fg(this),this.gb(g)),y?g.switchAudioModeForHeadphones():g.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(sg.e.prototype,"audioListenerPositionProvider",{get:function(){let y=this._getComponent(bg.e.NAME_AUDIO);return y||(y=new Fg(this),this.gb(y)),y.audioListenerPositionProvider},set:function(y){let g=this._getComponent(bg.e.NAME_AUDIO);if(g||(g=new Fg(this),this.gb(g)),y&&"function"!==typeof y)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");g.audioListenerPositionProvider=y},enumerable:!0,configurable:!0}),Object.defineProperty(sg.e.prototype,"audioListenerRotationProvider",{get:function(){let y=this._getComponent(bg.e.NAME_AUDIO);return y||(y=new Fg(this),this.gb(y)),y.audioListenerRotationProvider},set:function(y){let g=this._getComponent(bg.e.NAME_AUDIO);if(g||(g=new Fg(this),this.gb(g)),y&&"function"!==typeof y)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");g.audioListenerRotationProvider=y},enumerable:!0,configurable:!0}),Object.defineProperty(sg.e.prototype,"audioPositioningRefreshRate",{get:function(){let y=this._getComponent(bg.e.NAME_AUDIO);return y||(y=new Fg(this),this.gb(y)),y.audioPositioningRefreshRate},set:function(y){let g=this._getComponent(bg.e.NAME_AUDIO);g||(g=new Fg(this),this.gb(g)),g.audioPositioningRefreshRate=y},enumerable:!0,configurable:!0});class Fg{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(y){this.name=bg.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new S.m,this._cachedCameraPosition=new S.m,this._lastCheck=0,this._invertMatrixTemp=new S.c,this._cameraDirectionTemp=new S.m,(y=y||W.d.LastCreatedScene)&&(this.Oc=y,y.soundTracks=[],y.dk=[])}register(){this.Oc._afterRenderStage.registerStep(bg.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(y){if(y.dk=[],this.Oc.soundTracks)for(let g=0;g<this.Oc.soundTracks.length;g++){const f=this.Oc.soundTracks[g];for(let g=0;g<f.soundCollection.length;g++)y.dk.push(f.soundCollection[g].serialize())}}addFromContainer(y){y.dk&&y.dk.forEach((y=>{y.play(),y.autoplay=!0,this.Oc.mainSoundTrack.addSound(y)}))}removeFromContainer(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y.dk&&y.dk.forEach((y=>{y.stop(),y.autoplay=!1,this.Oc.mainSoundTrack.removeSound(y),g&&y.dispose()}))}dispose(){const y=this.Oc;if(y._mainSoundTrack&&y.mainSoundTrack.dispose(),y.soundTracks)for(let g=0;g<y.soundTracks.length;g++)y.soundTracks[g].dispose()}disableAudio(){const y=this.Oc;let g;for(this._audioEnabled=!1,ng.b.audioEngine&&ng.b.audioEngine.audioContext&&ng.b.audioEngine.audioContext.suspend(),g=0;g<y.mainSoundTrack.soundCollection.length;g++)y.mainSoundTrack.soundCollection[g].pause();if(y.soundTracks)for(g=0;g<y.soundTracks.length;g++)for(let f=0;f<y.soundTracks[g].soundCollection.length;f++)y.soundTracks[g].soundCollection[f].pause()}enableAudio(){const y=this.Oc;let g;for(this._audioEnabled=!0,ng.b.audioEngine&&ng.b.audioEngine.audioContext&&ng.b.audioEngine.audioContext.resume(),g=0;g<y.mainSoundTrack.soundCollection.length;g++)y.mainSoundTrack.soundCollection[g].isPaused&&y.mainSoundTrack.soundCollection[g].play();if(y.soundTracks)for(g=0;g<y.soundTracks.length;g++)for(let f=0;f<y.soundTracks[g].soundCollection.length;f++)y.soundTracks[g].soundCollection[f].isPaused&&y.soundTracks[g].soundCollection[f].play()}switchAudioModeForHeadphones(){const y=this.Oc;if(this._headphone=!0,y.mainSoundTrack.switchPanningModelToHRTF(),y.soundTracks)for(let g=0;g<y.soundTracks.length;g++)y.soundTracks[g].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const y=this.Oc;if(this._headphone=!1,y.mainSoundTrack.switchPanningModelToEqualPower(),y.soundTracks)for(let g=0;g<y.soundTracks.length;g++)y.soundTracks[g].switchPanningModelToEqualPower()}_afterRender(){const y=ug.c.Now;if(this._lastCheck&&y-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=y;const g=this.Oc;if(!this._audioEnabled||!g._mainSoundTrack||!g.soundTracks||0===g._mainSoundTrack.soundCollection.length&&1===g.soundTracks.length)return;const f=ng.b.audioEngine;if(f&&f.audioContext){let y,p=g.activeCamera;if(g.activeCameras&&g.activeCameras.length>0&&(p=g.activeCameras[0]),this.audioListenerPositionProvider){const y=this.audioListenerPositionProvider();f.audioContext.listener.setPosition(y.x||0,y.y||0,y.z||0)}else p?this._cachedCameraPosition.equals(p.globalPosition)||(this._cachedCameraPosition.p(p.globalPosition),f.audioContext.listener.setPosition(p.globalPosition.x,p.globalPosition.y,p.globalPosition.z)):f.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const y=this.audioListenerRotationProvider();f.audioContext.listener.setOrientation(y.x||0,y.y||0,y.z||0,0,1,0)}else p?(p.rigCameras&&p.rigCameras.length>0&&(p=p.rigCameras[0]),p.getViewMatrix().invertToRef(this._invertMatrixTemp),S.m.TransformNormalToRef(Fg._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),f.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):f.audioContext.listener.setOrientation(0,0,0,0,1,0);for(y=0;y<g.mainSoundTrack.soundCollection.length;y++){const f=g.mainSoundTrack.soundCollection[y];f.useCustomAttenuation&&f.updateDistanceFromListener()}if(g.soundTracks)for(y=0;y<g.soundTracks.length;y++)for(let f=0;f<g.soundTracks[y].soundCollection.length;f++){const p=g.soundTracks[y].soundCollection[f];p.useCustomAttenuation&&p.updateDistanceFromListener()}}}}Fg._CameraDirection=new S.m(0,0,-1),Mg._SceneComponentInitialization=y=>{let g=y._getComponent(bg.e.NAME_AUDIO);g||(g=new Fg(y),y.gb(g))};const Ag="MSFT_audio_emitter";class Jg{constructor(y){this.name=Ag,this._loader=y,this.enabled=this._loader.isExtensionUsed(Ag)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const y=this._loader.Si.extensions;if(y&&y[this.name]){const g=y[this.name];this._clips=g.clips,this._emitters=g.emitters,x.Assign(this._clips),x.Assign(this._emitters)}}loadSceneAsync(y,g){return d.LoadExtensionAsync(y,g,this.name,((f,p)=>{const S=new Array;S.push(this._loader.loadSceneAsync(y,g));for(const y of p.emitters){const g=x.Get(`${f}/emitters`,this._emitters,y);if(void 0!=g.refDistance||void 0!=g.maxDistance||void 0!=g.rolloffFactor||void 0!=g.distanceModel||void 0!=g.innerAngle||void 0!=g.outerAngle)throw new Error(`${f}: Direction or Distance properties are not allowed on emitters attached to a scene`);S.push(this._loadEmitterAsync(`${f}/emitters/${g.index}`,g))}return Promise.all(S).then((()=>{}))}))}loadNodeAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((y,p)=>{const k=new Array;return this._loader.loadNodeAsync(y,g,(g=>{for(const f of p.emitters){const p=x.Get(`${y}/emitters`,this._emitters,f);k.push(this._loadEmitterAsync(`${y}/emitters/${p.index}`,p).then((()=>{for(const y of p._babylonSounds)y.attachToMesh(g),void 0==p.innerAngle&&void 0==p.outerAngle||(y.setLocalDirectionToMesh(S.m.Forward()),y.setDirectionalCone(2*i.e.ToDegrees(void 0==p.innerAngle?Math.PI:p.innerAngle),2*i.e.ToDegrees(void 0==p.outerAngle?Math.PI:p.outerAngle),0))})))}f(g)})).then((y=>Promise.all(k).then((()=>y))))}))}loadAnimationAsync(y,g){return d.LoadExtensionAsync(y,g,this.name,((f,p)=>this._loader.loadAnimationAsync(y,g).then((S=>{const k=new Array;x.Assign(p.events);for(const i of p.events)k.push(this._loadAnimationEventAsync(`${f}/events/${i.index}`,y,g,i,S));return Promise.all(k).then((()=>S))}))))}_loadClipAsync(y,g){if(g._objectURL)return g._objectURL;let f;if(g.uri)f=this._loader.loadUriAsync(y,g,g.uri);else{const p=x.Get(`${y}/bufferView`,this._loader.Si.bufferViews,g.bufferView);f=this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p)}return g._objectURL=f.then((y=>URL.createObjectURL(new Blob([y],{type:g.mimeType})))),g._objectURL}_loadEmitterAsync(y,g){if(g._babylonSounds=g._babylonSounds||[],!g._babylonData){const y=new Array,f=g.name||`emitter${g.index}`,p={loop:!1,autoplay:!1,volume:void 0==g.volume?1:g.volume};for(let k=0;k<g.clips.length;k++){const S=`/extensions/${this.name}/clips`,i=x.Get(S,this._clips,g.clips[k].clip);y.push(this._loadClipAsync(`${S}/${g.clips[k].clip}`,i).then((y=>{const S=g._babylonSounds[k]=new Mg(f,y,this._loader.babylonScene,null,p);S.refDistance=g.refDistance||1,S.maxDistance=g.maxDistance||256,S.rolloffFactor=g.rolloffFactor||1,S.distanceModel=g.distanceModel||"exponential"})))}const S=Promise.all(y).then((()=>{const y=g.clips.map((y=>y.weight||1)),f=new rg(g.loop||!1,g._babylonSounds,y);g.innerAngle&&(f.directionalConeInnerAngle=2*i.e.ToDegrees(g.innerAngle)),g.outerAngle&&(f.directionalConeOuterAngle=2*i.e.ToDegrees(g.outerAngle)),g.volume&&(f.volume=g.volume),g._babylonData.sound=f}));g._babylonData={loaded:S}}return g._babylonData.loaded}_getEventAction(y,g,f,p,S){switch(f){case"play":return y=>{const f=(S||0)+(y-p);g.play(f)};case"stop":return()=>{g.stop()};case"pause":return()=>{g.pause()};default:throw new Error(`${y}: Unsupported action ${f}`)}}_loadAnimationEventAsync(y,g,f,p,S){if(0==S.targetedAnimations.length)return Promise.resolve();const k=S.targetedAnimations[0],i=p.j,H=x.Get(`/extensions/${this.name}/emitters`,this._emitters,i);return this._loadEmitterAsync(y,H).then((()=>{const g=H._babylonData.sound;if(g){const f=new Ig(p.time,this._getEventAction(y,g,p.action,p.time,p.startOffset));k.animation.addEvent(f),S.onAnimationGroupEndObservable.add((()=>{g.stop()})),S.onAnimationGroupPauseObservable.add((()=>{g.pause()}))}}))}}O(Ag),E(Ag,!0,(y=>new Jg(y)));const Vg="MSFT_lod";class eg{constructor(y){var g;this.name=Vg,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new c.d,this.onMaterialLODsLoadedObservable=new c.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=y,this.maxLODsToLoad=(null===(g=this._loader.parent.extensionOptions[Vg])||void 0===g?void 0:g.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Vg)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let y=0;y<this._nodePromiseLODs.length;y++){const g=Promise.all(this._nodePromiseLODs[y]).then((()=>{0!==y&&(this._loader.endPerformanceCounter(`Node LOD ${y}`),this._loader.log(`Loaded node LOD ${y}`)),this.onNodeLODsLoadedObservable.notifyObservers(y),y!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${y+1}`),this._loadBufferLOD(this._nodeBufferLODs,y+1),this._nodeSignalLODs[y]&&this._nodeSignalLODs[y].resolve())}));this._loader._completePromises.push(g)}for(let y=0;y<this._materialPromiseLODs.length;y++){const g=Promise.all(this._materialPromiseLODs[y]).then((()=>{0!==y&&(this._loader.endPerformanceCounter(`Material LOD ${y}`),this._loader.log(`Loaded material LOD ${y}`)),this.onMaterialLODsLoadedObservable.notifyObservers(y),y!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${y+1}`),this._loadBufferLOD(this._materialBufferLODs,y+1),this._materialSignalLODs[y]&&this._materialSignalLODs[y].resolve())}));this._loader._completePromises.push(g)}}loadSceneAsync(y,g){const f=this._loader.loadSceneAsync(y,g);return this._loadBufferLOD(this._bufferLODs,0),f}loadNodeAsync(y,g,f){return d.LoadExtensionAsync(y,g,this.name,((y,S)=>{let k;const i=this._getLODs(y,g,this._loader.Si.nodes,S.ids);this._loader.logOpen(`${y}`);for(let g=0;g<i.length;g++){const y=i[g];0!==g&&(this._nodeIndexLOD=g,this._nodeSignalLODs[g]=this._nodeSignalLODs[g]||new p);const S=y=>{f(y),y.Mb(!1)},H=this._loader.loadNodeAsync(`/nodes/${y.index}`,y,S).then((y=>{if(0!==g){const y=i[g-1];y._babylonTransformNode&&(this._disposeTransformNode(y._babylonTransformNode),delete y._babylonTransformNode)}return y.Mb(!0),y}));this._nodePromiseLODs[g]=this._nodePromiseLODs[g]||[],0===g?k=H:(this._nodeIndexLOD=null,this._nodePromiseLODs[g].push(H))}return this._loader.logClose(),k}))}_loadMaterialAsync(y,g,f,p,S){return this._nodeIndexLOD?null:d.LoadExtensionAsync(y,g,this.name,((y,k)=>{let i;const H=this._getLODs(y,g,this._loader.Si.materials,k.ids);this._loader.logOpen(`${y}`);for(let g=0;g<H.length;g++){const y=H[g];0!==g&&(this._materialIndexLOD=g);const k=this._loader._loadMaterialAsync(`/materials/${y.index}`,y,f,p,(y=>{0===g&&S(y)})).then((y=>{if(0!==g){S(y);const f=H[g-1]._data;f[p]&&(this._disposeMaterials([f[p].babylonMaterial]),delete f[p])}return y}));this._materialPromiseLODs[g]=this._materialPromiseLODs[g]||[],0===g?i=k:(this._materialIndexLOD=null,this._materialPromiseLODs[g].push(k))}return this._loader.logClose(),i}))}_loadUriAsync(y,g,f){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const S=this._nodeIndexLOD-1;return this._nodeSignalLODs[S]=this._nodeSignalLODs[S]||new p,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(y,g,f)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const S=this._materialIndexLOD-1;return this._materialSignalLODs[S]=this._materialSignalLODs[S]||new p,this._materialSignalLODs[S].promise.then((()=>this._loader.loadUriAsync(y,g,f)))}return null}loadBufferAsync(y,g,f,S){if(this._loader.parent.useRangeRequests&&!g.uri){if(!this._loader.bin)throw new Error(`${y}: Uri is missing or the binary glTF is missing its binary chunk`);const g=(y,g)=>{const k=f,i=k+S-1;let H=y[g];return H?(H.start=Math.min(H.start,k),H.end=Math.max(H.end,i)):(H={start:k,end:i,loaded:new p},y[g]=H),H.loaded.promise.then((y=>new Uint8Array(y.buffer,y.byteOffset+f-H.start,S)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?g(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?g(this._materialBufferLODs,this._materialIndexLOD):g(this._bufferLODs,0)}return null}_loadBufferLOD(y,g){const f=y[g];f&&(this._loader.log(`Loading buffer range [${f.start}-${f.end}]`),this._loader.bin.readAsync(f.start,f.end-f.start+1).then((y=>{f.loaded.resolve(y)}),(y=>{f.loaded.reject(y)})))}_getLODs(y,g,f,p){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const S=[];for(let k=p.length-1;k>=0;k--)if(S.push(x.Get(`${y}/ids/${p[k]}`,f,p[k])),S.length===this.maxLODsToLoad)return S;return S.push(g),S}_disposeTransformNode(y){const g=[],f=y.material;f&&g.push(f);for(const S of y.getChildMeshes())S.material&&g.push(S.material);y.dispose();const p=g.filter((y=>this._loader.babylonScene.meshes.every((g=>g.material!=y))));this._disposeMaterials(p)}_disposeMaterials(y){const g={};for(const f of y){for(const y of f.getActiveTextures())g[y.uniqueId]=y;f.dispose()}for(const f in g)for(const y of this._loader.babylonScene.materials)y.hasTexture(g[f])&&delete g[f];for(const f in g)g[f].dispose()}}O(Vg),E(Vg,!0,(y=>new eg(y)));const hg="MSFT_minecraftMesh";class Dg{constructor(y){this.name=hg,this._loader=y,this.enabled=this._loader.isExtensionUsed(hg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtraAsync(y,g,this.name,((p,S)=>{if(S){if(!(f instanceof w))throw new Error(`${p}: Material type not supported`);const S=this._loader.loadMaterialPropertiesAsync(y,g,f);return f.needAlphaBlending()&&(f.forceDepthWrite=!0,f.separateCullingPass=!0),f.oh=f.forceDepthWrite,f.twoSidedLighting=!0,S}return null}))}}O(hg),E(hg,!0,(y=>new Dg(y)));const Kg="MSFT_sRGBFactors";class Xg{constructor(y){this.name=Kg,this._loader=y,this.enabled=this._loader.isExtensionUsed(Kg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,g,f){return d.LoadExtraAsync(y,g,this.name,((p,S)=>{if(S){if(!(f instanceof w))throw new Error(`${p}: Material type not supported`);const S=this._loader.loadMaterialPropertiesAsync(y,g,f),k=f.va().getEngine().useExactSrgbConversions;return f.albedoTexture||f.albedoColor.toLinearSpaceToRef(f.albedoColor,k),f.reflectivityTexture||f.reflectivityColor.toLinearSpaceToRef(f.reflectivityColor,k),S}return null}))}}O(Kg),E(Kg,!0,(y=>new Xg(y)));var Eg,Og=f(10878);!function(y){y[y.Input=0]="Input",y[y.Output=1]="Output"}(Eg||(Eg={}));class Lg{constructor(y,g,f){this._ownerBlock=f,this._connectedPoint=[],this.uniqueId=(0,Og.e)(),this.connectedPointIds=[],this.name=y,this._connectionType=g}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(y){if(this._connectionType===y._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||y._isSingularConnection()&&y._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(y),y._connectedPoint.push(this)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y.uniqueId=this.uniqueId,y.name=this.name,y._connectionType=this._connectionType,y.connectedPointIds=[],y.className=this.getClassName();for(const g of this._connectedPoint)y.connectedPointIds.push(g.uniqueId)}getClassName(){return"FGConnection"}deserialize(y){this.uniqueId=y.uniqueId,this.name=y.name,this._connectionType=y._connectionType,this.connectedPointIds=y.connectedPointIds}static Parse(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1?arguments[1]:void 0;const f=new(i.e.Instantiate(y.className))(y.name,y._connectionType,g);return f.deserialize(y),f}}class xg{constructor(y){this.value=this._toInt(y)}_toInt(y){return 0|y}add(y){return new xg(this.value+y.value)}ed(y){return new xg(this.value-y.value)}multiply(y){return new xg(Math.imul(this.value,y.value))}divide(y){return new xg(this.value/y.value)}getClassName(){return xg.ClassName}equals(y){return this.value===y.value}static Parse(y){return new xg(y.value)}}xg.ClassName="FlowGraphInteger",(0,m.c)("FlowGraphInteger",xg);class dg{constructor(y,g){this.typeName=y,this.defaultValue=g}serialize(y){y.typeName=this.typeName,y.defaultValue=this.defaultValue}static Parse(y){return new dg(y.typeName,y.defaultValue)}}const tg=new dg("any",void 0),vg=(new dg("string",""),new dg("number",0)),yf=new dg("boolean",!1),gf=new dg("Vector2",S.l.Zero()),ff=new dg("o",S.m.Zero()),pf=(new dg("Vector4",S.o.Zero()),new dg("Matrix",S.c.Identity())),Sf=(new dg("hb",k.c.Black()),new dg("ob",new k.f(0,0,0,0)),new dg("Quaternion",S.g.Identity()),new dg("FlowGraphInteger",new xg(0)));class kf extends Lg{constructor(y,g,f,p){super(y,g,f),this.richType=p}_isSingularConnection(){return 0===this.connectionType}setValue(y,g){g._setConnectionValue(this,y)}connectTo(y){super.connectTo(y)}_getValueOrDefault(y){return y._hasConnectionValue(this)?y._getConnectionValue(this):this.richType.defaultValue}getValue(y){return 1===this.connectionType?(y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(y),this._getValueOrDefault(y)):this.isConnected()?this._connectedPoint[0].getValue(y):this._getValueOrDefault(y)}getClassName(){return"FGDataConnection"}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.richType={},this.richType.serialize(y.richType)}static Parse(y,g){const f=Lg.Parse(y,g);return f.richType=dg.Parse(y.richType),f}}function Hf(y){return"Mesh"===y||"AbstractMesh"===y||"GroundMesh"===y||"InstanceMesh"===y||"LinesMesh"===y||"GoldbergMesh"===y||"GreasedLineMesh"===y||"TrailMesh"===y}function Uf(y){return"Vector2"===y||"o"===y||"Vector4"===y||"Quaternion"===y||"hb"===y||"ob"===y}function lf(y,g,f){var p;const S=(null===g||void 0===g||null===(p=g.getClassName)||void 0===p?void 0:p.call(g))??"";Hf(S)?f[y]={name:g.name,className:S}:Uf(S)?f[y]={value:g.mj(),className:S}:f[y]=g}function cf(y,g,f){const p=g[y];let i;const H=null===p||void 0===p?void 0:p.className;return i=Hf(H)?f.getMeshByName(p.name):Uf(H)?function(y,g){if("Vector2"===y)return S.l.eh(g);if("o"===y)return S.m.eh(g);if("Vector4"===y)return S.o.eh(g);if("Quaternion"===y)return S.g.eh(g);if("hb"===y)return new k.c(g[0],g[1],g[2]);if("ob"===y)return new k.f(g[0],g[1],g[2],g[3]);throw new Error(`Unknown vector class name ${y}`)}(H,p.value):"Matrix"===H?S.c.eh(p.value):H===xg.ClassName?xg.Parse(p):p&&void 0!==p.value?p.value:p,i}(0,m.c)("FGDataConnection",kf);class Zf{constructor(y){var g;this.config=y,this.uniqueId=(0,Og.e)(),this.name=(null===(g=this.config)||void 0===g?void 0:g.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(y){}registerDataInput(y,g){const f=new kf(y,0,this,g);return this.dataInputs.push(f),f}registerDataOutput(y,g){const f=new kf(y,1,this,g);return this.dataOutputs.push(f),f}getDataInput(y){return this.dataInputs.find((g=>g.name===y))}getDataOutput(y){return this.dataOutputs.find((g=>g.name===y))}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y.uniqueId=this.uniqueId,y.config={},this.config&&(y.config.name=this.config.name),y.dataInputs=[],y.dataOutputs=[],y.className=this.getClassName();for(const g of this.dataInputs){const f={};g.serialize(f),y.dataInputs.push(f)}for(const g of this.dataOutputs){const f={};g.serialize(f),y.dataOutputs.push(f)}}getClassName(){return"FGBlock"}static Parse(y,g){const f=i.e.Instantiate(y.className),p={},S=g.valueParseFunction??cf;if(y.config)for(const i in y.config)p[i]=S(i,y.config,g.Oc);var k;("FGSetPropertyBlock"===(k=y.className)||"FGGetPropertyBlock"===k||"FGPlayAnimationBlock"===k||"FGMeshPickEventBlock"===k)&&(p.pathConverter=g.pathConverter);const H=new f(p);H.uniqueId=y.uniqueId;for(let i=0;i<y.dataInputs.length;i++){const g=H.getDataInput(y.dataInputs[i].name);if(!g)throw new Error("Could not find data input with name "+y.dataInputs[i].name+" in block "+y.className);g.deserialize(y.dataInputs[i])}for(let i=0;i<y.dataOutputs.length;i++){const g=H.getDataOutput(y.dataOutputs[i].name);if(!g)throw new Error("Could not find data output with name "+y.dataOutputs[i].name+" in block "+y.className);g.deserialize(y.dataOutputs[i])}return H.metadata=y.metadata,H.deserialize&&H.deserialize(y),H}}class Cf extends Lg{_isSingularConnection(){return 1===this.connectionType}_activateSignal(y){var g;0===this.connectionType?(y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(y,this),y._increaseExecutionId()):null===(g=this._connectedPoint[0])||void 0===g||g._activateSignal(y)}}(0,m.c)("FlowGraphSignalConnection",Cf);class qf extends Zf{constructor(y){super(y),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(y){const g=new Cf(y,0,this);return this.signalInputs.push(g),g}_registerSignalOutput(y){const g=new Cf(y,1,this);return this.signalOutputs.push(g),g}getSignalInput(y){return this.signalInputs.find((g=>g.name===y))}getSignalOutput(y){return this.signalOutputs.find((g=>g.name===y))}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.signalInputs=[],y.signalOutputs=[];for(const g of this.signalInputs){const f={};g.serialize(f),y.signalInputs.push(f)}for(const g of this.signalOutputs){const f={};g.serialize(f),y.signalOutputs.push(f)}}deserialize(y){for(let g=0;g<y.signalInputs.length;g++){const f=this.getSignalInput(y.signalInputs[g].name);if(!f)throw new Error("Could not find signal input with name "+y.signalInputs[g].name+" in block "+y.className);f.deserialize(y.signalInputs[g])}for(let g=0;g<y.signalOutputs.length;g++){const f=this.getSignalOutput(y.signalOutputs[g].name);if(!f)throw new Error("Could not find signal output with name "+y.signalOutputs[g].name+" in block "+y.className);f.deserialize(y.signalOutputs[g])}}getClassName(){return"FGExecutionBlock"}}class Wf extends qf{constructor(y){super(y),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(y){this._preparePendingTasks(y),y._addPendingBlock(this)}}class jf extends Wf{_execute(y){y._notifyExecuteNode(this),this.out._activateSignal(y)}}class Pf{constructor(y){this.uniqueId=(0,Og.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new c.d,this._configuration=y}hasVariable(y){return y in this._userVariables}setVariable(y,g){this._userVariables[y]=g}getVariable(y){return this._userVariables[y]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(y,g){return`${y.uniqueId}_${g}`}_setExecutionVariable(y,g,f){this._executionVariables[this._getUniqueIdPrefixedName(y,g)]=f}_getExecutionVariable(y,g,f){return this._hasExecutionVariable(y,g)?this._executionVariables[this._getUniqueIdPrefixedName(y,g)]:f}_deleteExecutionVariable(y,g){delete this._executionVariables[this._getUniqueIdPrefixedName(y,g)]}_hasExecutionVariable(y,g){return this._getUniqueIdPrefixedName(y,g)in this._executionVariables}_hasConnectionValue(y){return y.uniqueId in this._connectionValues}_setConnectionValue(y,g){this._connectionValues[y.uniqueId]=g}_getConnectionValue(y){return this._connectionValues[y.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(y){this._pendingBlocks.push(y)}_removePendingBlock(y){const g=this._pendingBlocks.indexOf(y);-1!==g&&this._pendingBlocks.splice(g,1)}_clearPendingBlocks(){for(const y of this._pendingBlocks)y._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(y){this.onNodeExecutedObservable.notifyObservers(y)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lf;y.uniqueId=this.uniqueId,y._userVariables={};for(const f in this._userVariables)g(f,this._userVariables[f],y._userVariables);y._connectionValues={};for(const f in this._connectionValues)g(f,this._connectionValues[f],y._connectionValues)}getClassName(){return"FGContext"}static Parse(y,g){const f=g.graph.createContext(),p=g.valueParseFunction??cf;f.uniqueId=y.uniqueId;for(const S in y._userVariables){const g=p(S,y._userVariables,f._configuration.Oc);f._userVariables[S]=g}for(const S in y._connectionValues){const g=p(S,y._connectionValues,f._configuration.Oc);f._connectionValues[S]=g}return f}}(0,G.c)([(0,z.I)()],Pf.prototype,"uniqueId",void 0);var Bf,Rf,Gf=f(11156);function zf(y,g){return!(!y.parent||y.parent!==g&&!zf(y.parent,g))}class Tf extends jf{constructor(y){super(y),this.config=y}_getReferencedMesh(){const y=this.config.pathConverter.convert(this.config.path),g=y.info.getObject(y.object);if(!g||!(g instanceof M.c))throw new Error("Mesh pick event block requires a valid mesh");return g}_preparePendingTasks(y){let g=y._getExecutionVariable(this,"meshPickObserver");if(!g){const f=this._getReferencedMesh();y._setExecutionVariable(this,"mesh",f),g=f.va().onPointerObservable.add((g=>{var p,S,k;g.type===Gf.d.POINTERPICK&&null!==(p=g.pickInfo)&&void 0!==p&&p.pickedMesh&&((null===(S=g.pickInfo)||void 0===S?void 0:S.pickedMesh)===f||zf(null===(k=g.pickInfo)||void 0===k?void 0:k.pickedMesh,f))&&this._execute(y)}));const p=f.nj.add((()=>this._onDispose));y._setExecutionVariable(this,"meshPickObserver",g),y._setExecutionVariable(this,"meshDisposeObserver",p)}}_onDispose(y){this._cancelPendingTasks(y),y._removePendingBlock(this)}_cancelPendingTasks(y){const g=y._getExecutionVariable(this,"mesh"),f=y._getExecutionVariable(this,"meshPickObserver"),p=y._getExecutionVariable(this,"meshDisposeObserver");g.va().onPointerObservable.remove(f),g.nj.remove(p),y._deleteExecutionVariable(this,"mesh"),y._deleteExecutionVariable(this,"meshPickObserver"),y._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Tf.ClassName}serialize(y){super.serialize(y),y.config.path=this.config.path}}Tf.ClassName="FGMeshPickEventBlock",(0,m.c)(Tf.ClassName,Tf),function(y){y[y.Stopped=0]="Stopped",y[y.Started=1]="Started"}(Bf||(Bf={}));class Qf{constructor(y){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=y.Oc,this._coordinator=y.coordinator,this._sceneDisposeObserver=this._scene.nj.add((()=>this.dispose()))}createContext(){const y=new Pf({Oc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(y),y}getContext(y){return this._executionContexts[y]}addEventBlock(y){this._eventBlocks.push(y)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const y of this._executionContexts){const g=this._getContextualOrder();for(const f of g)f._startPendingTasks(y)}}}_getContextualOrder(){const y=[];for(const g of this._eventBlocks)if(g.getClassName()===Tf.ClassName){const f=g._getReferencedMesh();let p=0;for(;p<y.length;p++){const g=y[p]._getReferencedMesh();if(f&&g&&zf(f,g))break}y.splice(p,0,g)}else y.push(g);return y}dispose(){if(0!==this.state){this.state=0;for(const y of this._executionContexts)y._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.nj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(y){const g=[],f=new Set;for(const p of this._eventBlocks)g.push(p),f.add(p.uniqueId);for(;g.length>0;){const p=g.pop();y(p);for(const y of p.dataInputs)for(const p of y._connectedPoint)f.has(p._ownerBlock.uniqueId)||(g.push(p._ownerBlock),f.add(p._ownerBlock.uniqueId));if(p instanceof qf)for(const y of p.signalOutputs)for(const p of y._connectedPoint)f.has(p._ownerBlock.uniqueId)||(g.push(p._ownerBlock),f.add(p._ownerBlock.uniqueId))}}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1?arguments[1]:void 0;y.allBlocks=[],this.visitAllBlocks((g=>{const f={};g.serialize(f),y.allBlocks.push(f)})),y.executionContexts=[];for(const f of this._executionContexts){const p={};f.serialize(p,g),y.executionContexts.push(p)}}static GetDataOutConnectionByUniqueId(y,g){for(const f of y)for(const y of f.dataOutputs)if(y.uniqueId===g)return y;throw new Error("Could not find data out connection with unique id "+g)}static GetSignalInConnectionByUniqueId(y,g){for(const f of y)if(f instanceof qf)for(const y of f.signalInputs)if(y.uniqueId===g)return y;throw new Error("Could not find signal in connection with unique id "+g)}static Parse(y,g){const f=g.coordinator.createGraph(),p=[],S=g.valueParseFunction??cf;for(const k of y.allBlocks){const y=Zf.Parse(k,{Oc:g.coordinator.config.Oc,pathConverter:g.pathConverter,valueParseFunction:S});p.push(y),y instanceof jf&&f.addEventBlock(y)}for(const k of p){for(const y of k.dataInputs)for(const g of y.connectedPointIds){const f=Qf.GetDataOutConnectionByUniqueId(p,g);y.connectTo(f)}if(k instanceof qf)for(const y of k.signalOutputs)for(const g of y.connectedPointIds){const f=Qf.GetSignalInConnectionByUniqueId(p,g);y.connectTo(f)}}for(const k of y.executionContexts)Pf.Parse(k,{graph:f,valueParseFunction:S});return f}}class mf{constructor(y){this.config=y,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Oc.nj.add((()=>{this.dispose()}));(mf.SceneCoordinators.get(this.config.Oc)??[]).push(this)}createGraph(){const y=new Qf({Oc:this.config.Oc,coordinator:this});return this._flowGraphs.push(y),y}removeGraph(y){const g=this._flowGraphs.indexOf(y);-1!==g&&(y.dispose(),this._flowGraphs.splice(g,1))}start(){this._flowGraphs.forEach((y=>y.start()))}dispose(){this._flowGraphs.forEach((y=>y.dispose())),this._flowGraphs.length=0;const y=mf.SceneCoordinators.get(this.config.Oc)??[],g=y.indexOf(this);-1!==g&&y.splice(g,1)}serialize(y,g){y._flowGraphs=[],this._flowGraphs.forEach((f=>{const p={};f.serialize(p,g),y._flowGraphs.push(p)}))}static Parse(y,g){var f;const p=g.valueParseFunction??cf,S=new mf({Oc:g.Oc});return null===(f=y._flowGraphs)||void 0===f||f.forEach((y=>{Qf.Parse(y,{coordinator:S,valueParseFunction:p,pathConverter:g.pathConverter})})),S}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(y){let g=this._customEventsMap.get(y);return g||(g=new c.d,this._customEventsMap.set(y,g)),g}notifyCustomEvent(y,g){const f=this._customEventsMap.get(y);f&&f.notifyObservers(g)}}mf.SceneCoordinators=new Map;class af extends jf{_preparePendingTasks(y){if(!y._getExecutionVariable(this,"sceneReadyObserver")){const g=y.configuration.Oc.onReadyObservable.add((()=>{this._execute(y)}));y._setExecutionVariable(this,"sceneReadyObserver",g)}}_cancelPendingTasks(y){const g=y._getExecutionVariable(this,"sceneReadyObserver");y.configuration.Oc.onReadyObservable.remove(g),y._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return af.ClassName}}af.ClassName="FGSceneReadyEventBlock",(0,m.c)("FGSceneReadyEventBlock",af);class wf extends jf{_preparePendingTasks(y){if(!y._getExecutionVariable(this,"sceneBeforeRender")){const g=y.configuration.Oc.onBeforeRenderObservable.add((()=>{this._execute(y)}));y._setExecutionVariable(this,"sceneBeforeRender",g)}}_cancelPendingTasks(y){const g=y._getExecutionVariable(this,"sceneBeforeRender");y.configuration.Oc.onBeforeRenderObservable.remove(g),y._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return wf.ClassName}}wf.ClassName="FGSceneTickEventBlock",(0,m.c)(wf.ClassName,wf);class of extends qf{constructor(y){super(y),this.out=this._registerSignalOutput("out")}}class If extends of{constructor(y){super(y),this.message=this.registerDataInput("message",tg)}_execute(y){const g=this.message.getValue(y);j.d.Log(g),this.out._activateSignal(y)}getClassName(){return If.ClassName}}If.ClassName="FGConsoleLogBlock",(0,m.c)(If.ClassName,If),function(y){y[y.INIT=0]="INIT",y[y.STARTED=1]="STARTED",y[y.ENDED=2]="ENDED"}(Rf||(Rf={}));class Yf{constructor(y){this.onEachCountObservable=new c.d,this.onTimerAbortedObservable=new c.d,this.onTimerEndedObservable=new c.d,this.onStateChangedObservable=new c.d,this._observer=null,this._breakOnNextTick=!1,this._tick=y=>{const g=Date.now();this._timer=g-this._startTime;const f={startTime:this._startTime,currentTime:g,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:y},p=this._breakOnNextTick||this._breakCondition(f);p||this._timer>=this._timeToEnd?this._stop(f,p):this.onEachCountObservable.notifyObservers(f)},this._setState(0),this._contextObservable=y.contextObservable,this._observableParameters=y.observableParameters??{},this._breakCondition=y.breakCondition??(()=>!1),this._timeToEnd=y.timeout,y.onEnded&&this.onTimerEndedObservable.add(y.onEnded),y.gi&&this.onEachCountObservable.add(y.gi),y.onAborted&&this.onTimerAbortedObservable.add(y.onAborted)}set breakCondition(y){this._breakCondition=y}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=y,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(y){this._state=y,this.onStateChangedObservable.notifyObservers(this._state)}_stop(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),g?this.onTimerAbortedObservable.notifyObservers(y):this.onTimerEndedObservable.notifyObservers(y)}}class nf extends Wf{constructor(y){super(y),this.timeout=this.registerDataInput("timeout",vg)}_preparePendingTasks(y){const g=this.timeout.getValue(y);if(void 0!==g&&g>=0){const f=y._getExecutionVariable(this,"runningTimers")||[],p=y.configuration.Oc,S=new Yf({timeout:g,contextObservable:p.onBeforeRenderObservable,onEnded:()=>this._onEnded(S,y)});S.start(),f.push(S),y._setExecutionVariable(this,"runningTimers",f)}}_execute(y){this._startPendingTasks(y),this.out._activateSignal(y)}_onEnded(y,g){const f=g._getExecutionVariable(this,"runningTimers")||[],p=f.indexOf(y);-1!==p?f.splice(p,1):i.e.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),g._removePendingBlock(this),this.done._activateSignal(g)}_cancelPendingTasks(y){const g=y._getExecutionVariable(this,"runningTimers")||[];for(const f of g)f.dispose();y._deleteExecutionVariable(this,"runningTimers")}getClassName(){return nf.ClassName}}nf.ClassName="FGTimerBlock",(0,m.c)("FGTimerBlock",nf);class Mf extends of{constructor(y){super(y),this.config=y;for(let g=0;g<this.config.eventData.length;g++){const y=this.config.eventData[g];this.registerDataInput(y,tg)}}_execute(y){const g=this.config.eventId,f=this.dataInputs.map((g=>g.getValue(y)));y.configuration.coordinator.notifyCustomEvent(g,f),this.out._activateSignal(y)}getClassName(){return Mf.ClassName}}Mf.ClassName="FGSendCustomEventBlock",(0,m.c)("FGSendCustomEventBlock",Mf);class rf extends jf{constructor(y){super(y),this.config=y;for(let g=0;g<this.config.eventData.length;g++){const y=this.config.eventData[g];this.registerDataOutput(y,tg)}}_preparePendingTasks(y){const g=y.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=g.add((g=>{for(let f=0;f<g.length;f++)this.dataOutputs[f].setValue(g[f],y);this._execute(y)}))}_cancelPendingTasks(y){const g=y.configuration.coordinator.getCustomEventObservable(this.config.eventId);g?g.remove(this._eventObserver):i.e.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return rf.ClassName}serialize(y){super.serialize(y),y.eventId=this.config.eventId,y.eventData=this.config.eventData}}rf.ClassName="FGReceiveCustomEventBlock",(0,m.c)(rf.ClassName,rf);class Nf extends qf{constructor(y){super(y),this.config=y,this.outFlows=[];for(let g=0;g<this.config.numberOutputFlows;g++)this.outFlows.push(this._registerSignalOutput(`${g}`))}_execute(y){for(let g=0;g<this.config.numberOutputFlows;g++)this.outFlows[g]._activateSignal(y)}getClassName(){return Nf.ClassName}}Nf.ClassName="FGSequenceBlock",(0,m.c)(Nf.ClassName,Nf);const bf=new RegExp(/\{(\w+)\}/g);class sf{constructor(y,g){this.path=y,this.ownerBlock=g,this.templatedInputs=[];let f=bf.exec(y);for(;f;){const[,p]=f;this.templatedInputs.push(g.registerDataInput(p,Sf)),f=bf.exec(y)}}getAccessor(y,g){let f=this.path;for(const p of this.templatedInputs){const y=p.getValue(g).value;f=f.replace(`{${p.name}}`,y.toString())}return y.convert(f)}}class uf extends Zf{constructor(y){super(y),this.config=y,this.value=this.registerDataOutput("value",tg),this.templateComponent=new sf(y.path,this)}_updateOutputs(y){const g=this.templateComponent.getAccessor(this.config.pathConverter,y),f=g.info.get(g.object);this.value.setValue(f,y)}getClassName(){return uf.ClassName}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.config.path=this.config.path}}uf.ClassName="FGGetPropertyBlock",(0,m.c)(uf.ClassName,uf);class Ff extends of{constructor(y){super(y),this.config=y,this.a=this.registerDataInput("a",tg),this.templateComponent=new sf(y.path,this)}_execute(y){const g=this.a.getValue(y),f=this.templateComponent.getAccessor(this.config.pathConverter,y);f.info.set(g,f.object),this.out._activateSignal(y)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.config.path=this.config.path}getClassName(){return Ff.ClassName}}Ff.ClassName="FGSetPropertyBlock",(0,m.c)("FGSetPropertyBlock",Ff);const Af="cachedOperationValue",Jf="cachedExecutionId";class Vf extends Zf{constructor(y,g){super(g),this.value=this.registerDataOutput("value",y)}_updateOutputs(y){const g=y._getExecutionVariable(this,Jf),f=y._getExecutionVariable(this,Af);if(void 0!==f&&g===y.executionId)this.value.setValue(f,y);else{const g=this._doOperation(y);y._setExecutionVariable(this,Af,g),y._setExecutionVariable(this,Jf,y.executionId),this.value.setValue(g,y)}}}class ef extends Vf{constructor(y,g,f,p,S,k){super(f,k),this._operation=p,this._className=S,this.a=this.registerDataInput("a",y),this.b=this.registerDataInput("b",g)}_doOperation(y){return this._operation(this.a.getValue(y),this.b.getValue(y))}getClassName(){return this._className}}class hf extends Vf{constructor(y,g,f,p){super(y,p),this._operation=g,this._className=f}_doOperation(y){return this._operation()}getClassName(){return this._className}}class Df extends Vf{constructor(y,g,f,p,S){super(g,S),this._operation=f,this._className=p,this.a=this.registerDataInput("a",y)}_doOperation(y){return this._operation(this.a.getValue(y))}getClassName(){return this._className}}class Kf extends Vf{constructor(y,g,f,p,S,k,i){super(p,i),this._operation=S,this._className=k,this.a=this.registerDataInput("a",y),this.b=this.registerDataInput("b",g),this.c=this.registerDataInput("c",f)}_doOperation(y){return this._operation(this.a.getValue(y),this.b.getValue(y),this.c.getValue(y))}getClassName(){return this._className}}function Xf(y){return y.getClassName?y.getClassName():""}function Ef(y,g){return"Vector2"===y&&"Vector2"===g||"o"===y&&"o"===g||"Vector4"===y&&"Vector4"===g}function Of(y,g){return"Matrix"===y&&"Matrix"===g}function Lf(y,g){return"FlowGraphInteger"===y&&"FlowGraphInteger"===g}class xf extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicAdd(y,g)),xf.ClassName,y)}_polymorphicAdd(y,g){const f=Xf(y),p=Xf(g);return Ef(f,p)||Of(f,p)||Lf(f,p)?y.add(g):y+g}}xf.ClassName="FGAddBlock",(0,m.c)(xf.ClassName,xf);class df extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicAdd(y,g)),df.ClassName,y)}_polymorphicAdd(y,g){const f=Xf(y),p=Xf(g);return Ef(f,p)||Lf(f,p)?y.ed(g):Of(f,p)?y.add(g.scale(-1)):y-g}}df.ClassName="FGSubBlock",(0,m.c)(df.ClassName,df);class tf extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicMultiply(y,g)),tf.ClassName,y)}_polymorphicMultiply(y,g){const f=Xf(y),p=Xf(g);return Ef(f,p)||Lf(f,p)?y.multiply(g):Of(f,p)?S.c.FromValues(y.m[0]*g.m[0],y.m[4]*g.m[4],y.m[8]*g.m[8],y.m[12]*g.m[12],y.m[1]*g.m[1],y.m[5]*g.m[5],y.m[9]*g.m[9],y.m[13]*g.m[13],y.m[2]*g.m[2],y.m[6]*g.m[6],y.m[10]*g.m[10],y.m[14]*g.m[14],y.m[3]*g.m[3],y.m[7]*g.m[7],y.m[11]*g.m[11],y.m[15]*g.m[15]):y*g}}tf.ClassName="FGMultiplyBlock",(0,m.c)(tf.ClassName,tf);class vf extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicDivide(y,g)),vf.ClassName,y)}_polymorphicDivide(y,g){const f=Xf(y),p=Xf(g);return Ef(f,p)||Lf(f,p)?y.divide(g):Of(f,p)?S.c.FromValues(y.m[0]/g.m[0],y.m[4]/g.m[4],y.m[8]/g.m[8],y.m[12]/g.m[12],y.m[1]/g.m[1],y.m[5]/g.m[5],y.m[9]/g.m[9],y.m[13]/g.m[13],y.m[2]/g.m[2],y.m[6]/g.m[6],y.m[10]/g.m[10],y.m[14]/g.m[14],y.m[3]/g.m[3],y.m[7]/g.m[7],y.m[11]/g.m[11],y.m[15]/g.m[15]):y/g}}vf.ClassName="FGDivideBlock",(0,m.c)(vf.ClassName,vf);class yp extends hf{constructor(y){super(vg,(()=>Math.random()),yp.ClassName,y)}}yp.ClassName="FGRandomBlock",(0,m.c)(yp.ClassName,yp);class gp extends ef{constructor(y){super(tg,tg,vg,((y,g)=>this._polymorphicDot(y,g)),gp.ClassName,y)}_polymorphicDot(y,g){switch(Xf(y)){case"Vector2":return S.l.Dot(y,g);case"o":return S.m.Dot(y,g);case"Vector4":return S.o.Dot(y,g);default:throw new Error(`Cannot get dot product of ${y} and ${g}`)}}}gp.ClassName="FGDotBlock",(0,m.c)(gp.ClassName,gp);class fp extends hf{constructor(y){super(vg,(()=>Math.E),fp.ClassName,y)}}fp.ClassName="FGEBlock",(0,m.c)(fp.ClassName,fp);class pp extends hf{constructor(y){super(vg,(()=>Math.PI),pp.ClassName,y)}}pp.ClassName="FGPIBlock",(0,m.c)(pp.ClassName,pp);class Sp extends hf{constructor(y){super(vg,(()=>Number.POSITIVE_INFINITY),Sp.ClassName,y)}}Sp.ClassName="FGInfBlock",(0,m.c)(Sp.ClassName,Sp);class kp extends hf{constructor(y){super(vg,(()=>Number.NaN),kp.ClassName,y)}}function ip(y,g){switch(Xf(y)){case"FlowGraphInteger":return new xg(g(y.value));case"Vector2":return new S.l(g(y.x),g(y.y));case"o":return new S.m(g(y.x),g(y.y),g(y.z));case"Vector4":return new S.o(g(y.x),g(y.y),g(y.z),g(y.w));case"Matrix":return S.c.FromValues(g(y.m[0]),g(y.m[4]),g(y.m[8]),g(y.m[12]),g(y.m[1]),g(y.m[5]),g(y.m[9]),g(y.m[13]),g(y.m[2]),g(y.m[6]),g(y.m[10]),g(y.m[14]),g(y.m[3]),g(y.m[7]),g(y.m[11]),g(y.m[15]));default:return g(y)}}kp.ClassName="FGNaNBlock",(0,m.c)(kp.ClassName,kp);class Hp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicAbs(y)),Hp.ClassName,y)}_polymorphicAbs(y){return ip(y,Math.abs)}}Hp.ClassName="FGAbsBlock",(0,m.c)(Hp.ClassName,Hp);class Up extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicSign(y)),Up.ClassName,y)}_polymorphicSign(y){return ip(y,Math.sign)}}Up.ClassName="FGSignBlock",(0,m.c)(Up.ClassName,Up);class lp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicTrunc(y)),lp.ClassName,y)}_polymorphicTrunc(y){return ip(y,Math.trunc)}}lp.ClassName="FGTruncBlock",(0,m.c)(lp.ClassName,lp);class cp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicFloor(y)),cp.ClassName,y)}_polymorphicFloor(y){return ip(y,Math.floor)}}cp.ClassName="FGFloorBlock",(0,m.c)(cp.ClassName,cp);class Zp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicCeiling(y)),Zp.ClassName,y)}_polymorphicCeiling(y){return ip(y,Math.ceil)}}Zp.ClassName="FGCeilBlock",(0,m.c)(Zp.ClassName,Zp);class Cp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicFract(y)),Cp.ClassName,y)}_polymorphicFract(y){return ip(y,(y=>y-Math.floor(y)))}}Cp.ClassName="FGFractBlock",(0,m.c)(Cp.ClassName,Cp);class qp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicNeg(y)),qp.ClassName,y)}_polymorphicNeg(y){return ip(y,(y=>-y))}}function Wp(y,g,f){switch(Xf(y)){case"FlowGraphInteger":return new xg(f(y.value,g.value));case"Vector2":return new S.l(f(y.x,g.x),f(y.y,g.y));case"o":return new S.m(f(y.x,g.x),f(y.y,g.y),f(y.z,g.z));case"Vector4":return new S.o(f(y.x,g.x),f(y.y,g.y),f(y.z,g.z),f(y.w,g.w));case"Matrix":return S.c.FromValues(f(y.m[0],g.m[0]),f(y.m[4],g.m[4]),f(y.m[8],g.m[8]),f(y.m[12],g.m[12]),f(y.m[1],g.m[1]),f(y.m[5],g.m[5]),f(y.m[9],g.m[9]),f(y.m[13],g.m[13]),f(y.m[2],g.m[2]),f(y.m[6],g.m[6]),f(y.m[10],g.m[10]),f(y.m[14],g.m[14]),f(y.m[3],g.m[3]),f(y.m[7],g.m[7]),f(y.m[11],g.m[11]),f(y.m[15],g.m[15]));default:return f(y,g)}}qp.ClassName="FGNegBlock",(0,m.c)(qp.ClassName,qp);class jp extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicRemainder(y,g)),jp.ClassName,y)}_polymorphicRemainder(y,g){return Wp(y,g,((y,g)=>y%g))}}jp.ClassName="FGRemainderBlock",(0,m.c)(jp.ClassName,jp);class Pp extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicMin(y,g)),Pp.ClassName,y)}_polymorphicMin(y,g){return Wp(y,g,Math.min)}}Pp.ClassName="FGMinBlock",(0,m.c)(Pp.ClassName,Pp);class Bp extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicMax(y,g)),Bp.ClassName,y)}_polymorphicMax(y,g){return Wp(y,g,Math.max)}}function Rp(y,g,f){return Math.min(Math.max(y,Math.min(g,f)),Math.max(g,f))}function Gp(y,g,f,p){switch(Xf(y)){case"FlowGraphInteger":return new xg(p(y.value,g.value,f.value));case"Vector2":return new S.l(p(y.x,g.x,f.x),p(y.y,g.y,f.y));case"o":return new S.m(p(y.x,g.x,f.x),p(y.y,g.y,f.y),p(y.z,g.z,f.z));case"Vector4":return new S.o(p(y.x,g.x,f.x),p(y.y,g.y,f.y),p(y.z,g.z,f.z),p(y.w,g.w,f.w));case"Matrix":return S.c.FromValues(p(y.m[0],g.m[0],f.m[0]),p(y.m[4],g.m[4],f.m[4]),p(y.m[8],g.m[8],f.m[8]),p(y.m[12],g.m[12],f.m[12]),p(y.m[1],g.m[1],f.m[1]),p(y.m[5],g.m[5],f.m[5]),p(y.m[9],g.m[9],f.m[9]),p(y.m[13],g.m[13],f.m[13]),p(y.m[2],g.m[2],f.m[2]),p(y.m[6],g.m[6],f.m[6]),p(y.m[10],g.m[10],f.m[10]),p(y.m[14],g.m[14],f.m[14]),p(y.m[3],g.m[3],f.m[3]),p(y.m[7],g.m[7],f.m[7]),p(y.m[11],g.m[11],f.m[11]),p(y.m[15],g.m[15],f.m[15]));default:return p(y,g,f)}}Bp.ClassName="FGMaxBlock",(0,m.c)(Bp.ClassName,Bp);class zp extends Kf{constructor(y){super(tg,tg,tg,tg,((y,g,f)=>this._polymorphicClamp(y,g,f)),zp.ClassName,y)}_polymorphicClamp(y,g,f){return Gp(y,g,f,Rp)}}function Tp(y){return Math.min(Math.max(y,0),1)}zp.ClassName="FGClampBlock",(0,m.c)(zp.ClassName,zp);class Qp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicSaturate(y)),Qp.ClassName,y)}_polymorphicSaturate(y){return ip(y,Tp)}}Qp.ClassName="FGSaturateBlock",(0,m.c)(Qp.ClassName,Qp);class mp extends Kf{constructor(y){super(tg,tg,tg,tg,((y,g,f)=>this._polymorphicInterpolate(y,g,f)),mp.ClassName,y)}_interpolate(y,g,f){return(1-f)*y+f*g}_polymorphicInterpolate(y,g,f){return Gp(y,g,f,this._interpolate)}}mp.ClassName="FGInterpolateBlock",(0,m.c)(mp.ClassName,mp);class ap extends ef{constructor(y){super(tg,tg,yf,((y,g)=>this._polymorphicEq(y,g)),ap.ClassName,y)}_polymorphicEq(y,g){const f=Xf(y),p=Xf(g);return Ef(f,p)||Of(f,p)||Lf(f,p)?y.equals(g):y===g}}function wp(y,g,f){const p=Xf(y);if(p===Xf(g)){if(""===p)return f(y,g);if("FlowGraphInteger"===p)return f(y.value,g.value);throw new Error(`Cannot compare ${y} and ${g}`)}throw new Error(`${y} and ${g} are of different types.`)}ap.ClassName="FGEqBlock",(0,m.c)(ap.ClassName,ap);class op extends ef{constructor(y){super(tg,tg,yf,((y,g)=>this._polymorphicLessThan(y,g)),op.ClassName,y)}_polymorphicLessThan(y,g){return wp(y,g,((y,g)=>y<g))}}op.ClassName="FGLessThanBlock",(0,m.c)(op.ClassName,op);class Ip extends ef{constructor(y){super(tg,tg,yf,((y,g)=>this._polymorphicLessThanOrEqual(y,g)),Ip.ClassName,y)}_polymorphicLessThanOrEqual(y,g){return wp(y,g,((y,g)=>y<=g))}}Ip.ClassName="FGLessThanOrEqualBlock";class Yp extends ef{constructor(y){super(tg,tg,yf,((y,g)=>this._polymorphicGreaterThan(y,g)),Yp.ClassName,y)}_polymorphicGreaterThan(y,g){return wp(y,g,((y,g)=>y>g))}}Yp.ClassName="FGGreaterThanBlock",(0,m.c)(Yp.ClassName,Yp);class np extends ef{constructor(y){super(tg,tg,yf,((y,g)=>this._polymorphicGreaterThanOrEqual(y,g)),np.ClassName,y)}_polymorphicGreaterThanOrEqual(y,g){return wp(y,g,((y,g)=>y>=g))}}np.ClassName="FGGreaterThanOrEqualBlock",(0,m.c)(np.ClassName,np);class Mp extends Df{constructor(y){super(tg,yf,(y=>this._polymorphicIsNan(y)),Mp.ClassName,y)}_polymorphicIsNan(y){const g=Xf(y);if(""===g)return isNaN(y);if("FlowGraphInteger"===g)return isNaN(y.value);throw new Error(`Cannot get NaN of ${y}`)}}Mp.ClassName="FGIsNanBlock",(0,m.c)(Mp.ClassName,Mp);class rp extends Df{constructor(y){super(tg,yf,(y=>this._polymorphicIsInf(y)),rp.ClassName,y)}_polymorphicIsInf(y){const g=Xf(y);if(""===g)return!isFinite(y);if("FlowGraphInteger"===g)return!isFinite(y.value);throw new Error(`Cannot get isInf of ${y}`)}}rp.ClassName="FGIsInfBlock";class Np extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicDegToRad(y)),Np.ClassName,y)}_degToRad(y){return y*Math.PI/180}_polymorphicDegToRad(y){return ip(y,this._degToRad)}}Np.ClassName="FGDegToRadBlock",(0,m.c)(Np.ClassName,Np);class bp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicRadToDeg(y)),bp.ClassName,y)}_radToDeg(y){return 180*y/Math.PI}_polymorphicRadToDeg(y){return ip(y,this._radToDeg)}}bp.ClassName="FGRadToDegBlock",(0,m.c)(bp.ClassName,bp);class sp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicSin(y)),sp.ClassName,y)}_polymorphicSin(y){return ip(y,Math.sin)}}sp.ClassName="FGSinBlock",(0,m.c)(sp.ClassName,sp);class up extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicCos(y)),up.ClassName,y)}_polymorphicCos(y){return ip(y,Math.cos)}}up.ClassName="FGCosBlock",(0,m.c)(up.ClassName,up);class Fp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicTan(y)),Fp.ClassName,y)}_polymorphicTan(y){return ip(y,Math.tan)}}Fp.ClassName="FGTanBlock",(0,m.c)(Fp.ClassName,Fp);class Ap extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicAsin(y)),Ap.ClassName,y)}_polymorphicAsin(y){return ip(y,Math.asin)}}Ap.ClassName="FGAsinBlock",(0,m.c)(Ap.ClassName,Ap);class Jp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicAcos(y)),Jp.ClassName,y)}_polymorphicAcos(y){return ip(y,Math.acos)}}Jp.ClassName="FGAcosBlock",(0,m.c)(Jp.ClassName,Jp);class Vp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicAtan(y)),Vp.ClassName,y)}_polymorphicAtan(y){return ip(y,Math.atan)}}Vp.ClassName="FGAtanBlock",(0,m.c)(Vp.ClassName,Vp);class ep extends ef{constructor(y){super(tg,tg,tg,((y,g)=>this._polymorphicAtan2(y,g)),ep.ClassName,y)}_polymorphicAtan2(y,g){return Wp(y,g,Math.atan2)}}ep.ClassName="FGAtan2Block",(0,m.c)(ep.ClassName,ep);class hp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicSinh(y)),hp.ClassName,y)}_polymorphicSinh(y){return ip(y,Math.sinh)}}hp.ClassName="FGSinhBlock",(0,m.c)(hp.ClassName,hp);class Dp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicCosh(y)),Dp.ClassName,y)}_polymorphicCosh(y){return ip(y,Math.cosh)}}Dp.ClassName="FGCoshBlock",(0,m.c)(Dp.ClassName,Dp);class Kp extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicTanh(y)),Kp.ClassName,y)}_polymorphicTanh(y){return ip(y,Math.tanh)}}Kp.ClassName="FGTanhBlock",(0,m.c)(Kp.ClassName,Kp);class Xp extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicAsinh(y)),Xp.ClassName,y)}_polymorphicAsinh(y){return ip(y,Math.asinh)}}Xp.ClassName="FGAsinhBlock",(0,m.c)(Xp.ClassName,Xp);class Ep extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicAcosh(y)),Ep.ClassName,y)}_polymorphicAcosh(y){return ip(y,Math.acosh)}}Ep.ClassName="FGAcoshBlock",(0,m.c)(Ep.ClassName,Ep);class Op extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicAtanh(y)),Op.ClassName,y)}_polymorphicAtanh(y){return ip(y,Math.atanh)}}Op.ClassName="FGAtanhBlock",(0,m.c)(Op.ClassName,Op);class Lp extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicExp(y)),Lp.ClassName,y)}_polymorphicExp(y){return ip(y,Math.exp)}}Lp.ClassName="FGExpBlock",(0,m.c)(Lp.ClassName,Lp);class xp extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicLog(y)),xp.ClassName,y)}_polymorphicLog(y){return ip(y,Math.log)}}xp.ClassName="FGLogBlock",(0,m.c)(xp.ClassName,xp);class dp extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicLog2(y)),dp.ClassName,y)}_polymorphicLog2(y){return ip(y,Math.log2)}}dp.ClassName="FGLog2Block",(0,m.c)(dp.ClassName,dp);class tp extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicLog10(y)),tp.ClassName,y)}_polymorphicLog10(y){return ip(y,Math.log10)}}tp.ClassName="FGLog10Block",(0,m.c)(tp.ClassName,tp);class vp extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicSqrt(y)),vp.ClassName,y)}_polymorphicSqrt(y){return ip(y,Math.sqrt)}}vp.ClassName="FGSqrtBlock",(0,m.c)(vp.ClassName,vp);class yS extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicCubeRoot(y)),yS.ClassName,y)}_polymorphicCubeRoot(y){return ip(y,Math.cbrt)}}yS.ClassName="FGCubeRootBlock",(0,m.c)(yS.ClassName,yS);class gS extends ef{constructor(y){super(tg,vg,vg,((y,g)=>this._polymorphicPow(y,g)),gS.ClassName,y)}_polymorphicPow(y,g){return Wp(y,g,Math.pow)}}gS.ClassName="FGPowBlock",(0,m.c)(gS.ClassName,gS);class fS extends Df{constructor(y){super(tg,vg,(y=>this._polymorphicLength(y)),fS.ClassName,y)}_polymorphicLength(y){switch(Xf(y)){case"Vector2":case"o":case"Vector4":return y.length();default:throw new Error(`Cannot compute length of value ${y}`)}}}fS.ClassName="FGLengthBlock",(0,m.c)(fS.ClassName,fS);class pS extends Df{constructor(y){super(tg,tg,(y=>this._polymorphicNormalize(y)),pS.ClassName,y)}_polymorphicNormalize(y){switch(Xf(y)){case"Vector2":case"o":case"Vector4":return y.normalize();default:throw new Error(`Cannot normalize value ${y}`)}}}pS.ClassName="FGNormalizeBlock",(0,m.c)(pS.ClassName,pS);class SS extends ef{constructor(y){super(ff,ff,ff,((y,g)=>S.m.Cross(y,g)),SS.ClassName,y)}}SS.ClassName="FGCrossBlock",(0,m.c)(SS.ClassName,SS);class kS extends ef{constructor(y){super(gf,vg,gf,((y,g)=>S.l.Transform(y,S.c.RotationZ(g))),kS.ClassName,y)}}kS.ClassName="FGRotate2DBlock",(0,m.c)(kS.ClassName,kS);class iS extends Kf{constructor(y){super(ff,ff,vg,ff,((y,g,f)=>S.m.TransformCoordinates(y,S.c.RotationAxis(g,f))),iS.ClassName,y)}}iS.ClassName="FGRotate3DBlock",(0,m.c)(iS.ClassName,iS);class HS extends Df{constructor(y){super(pf,pf,(y=>S.c.Transpose(y)),HS.ClassName,y)}}HS.ClassName="FGTransposeBlock",(0,m.c)(HS.ClassName,HS);class US extends Df{constructor(y){super(pf,vg,(y=>y.determinant()),US.ClassName,y)}}US.ClassName="FGDeterminantBlock",(0,m.c)(US.ClassName,US);class lS extends Df{constructor(y){super(pf,pf,(y=>S.c.Invert(y)),lS.ClassName,y)}}lS.ClassName="FGInvertMatrixBlock",(0,m.c)(lS.ClassName,lS);class cS extends ef{constructor(y){super(pf,pf,pf,((y,g)=>g.multiply(y)),cS.ClassName,y)}}cS.ClassName="FGMatMulBlock",(0,m.c)(cS.ClassName,cS);class ZS extends Df{constructor(y){super(Sf,Sf,(y=>new xg(~y.value)),ZS.ClassName,y)}}ZS.ClassName="FGBitwiseNotBlock",(0,m.c)(ZS.ClassName,ZS);class CS extends ef{constructor(y){super(Sf,Sf,Sf,((y,g)=>new xg(y.value&g.value)),CS.ClassName,y)}}CS.ClassName="FGBitwiseAndBlock",(0,m.c)(CS.ClassName,CS);class qS extends ef{constructor(y){super(Sf,Sf,Sf,((y,g)=>new xg(y.value|g.value)),qS.ClassName,y)}}qS.ClassName="FGBitwiseOrBlock",(0,m.c)(qS.ClassName,qS);class WS extends ef{constructor(y){super(Sf,Sf,Sf,((y,g)=>new xg(y.value^g.value)),WS.ClassName,y)}}WS.ClassName="FGBitwiseXorBlock",(0,m.c)(WS.ClassName,WS);class jS extends ef{constructor(y){super(Sf,Sf,Sf,((y,g)=>new xg(y.value<<g.value)),jS.ClassName,y)}}jS.ClassName="FGBitwiseLeftShiftBlock",(0,m.c)(jS.ClassName,jS);class PS extends ef{constructor(y){super(Sf,Sf,Sf,((y,g)=>new xg(y.value>>g.value)),PS.ClassName,y)}}PS.ClassName="FGBitwiseRightShiftBlock",(0,m.c)(PS.ClassName,PS);class BS extends Df{constructor(y){super(Sf,Sf,(y=>new xg(Math.clz32(y.value))),BS.ClassName,y)}}BS.ClassName="FGCountLeadingZerosBlock",(0,m.c)(BS.ClassName,BS);class RS extends Df{constructor(y){super(Sf,Sf,(y=>new xg(y.value?31-Math.clz32(y.value&-y.value):32)),RS.ClassName,y)}}RS.ClassName="FGCountTrailingZerosBlock",(0,m.c)(RS.ClassName,RS);class GS extends Df{constructor(y){super(Sf,Sf,(y=>new xg(function(y){let g=0;for(;y;)g+=1&y,y>>=1;return g}(y.value))),GS.ClassName,y)}}GS.ClassName="FGCountOneBitsBlock",(0,m.c)(GS.ClassName,GS);class zS extends of{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new xg(0)};super(y),this.config=y,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Sf),this.value=this.registerDataOutput("value",Sf)}_execute(y,g){if(g===this.reset)this.value.setValue(this.config.startIndex,y);else{const g=this.value.getValue(y);g.value<this.n.getValue(y).value&&(this.value.setValue(new xg(g.value+1),y),this.out._activateSignal(y))}}getClassName(){return zS.ClassName}}zS.ClassName="FGDoNBlock",(0,m.c)(zS.ClassName,zS);class TS extends Zf{constructor(y){super(y),this.config=y,this.output=this.registerDataOutput(y.variableName,tg)}_updateOutputs(y){const g=this.config.variableName;y.hasVariable(g)&&this.output.setValue(y.getVariable(g),y)}getClassName(){return TS.ClassName}serialize(y){super.serialize(y),y.config.variableName=this.config.variableName}}TS.ClassName="FGGetVariableBlock",(0,m.c)(TS.ClassName,TS);class QS extends of{constructor(y){super(y),this.config=y,this.input=this.registerDataInput(y.variableName,tg)}_execute(y){const g=this.config.variableName,f=this.input.getValue(y);y.setVariable(g,f),this.out._activateSignal(y)}getClassName(){return QS.ClassName}}QS.ClassName="FGSetVariableBlock",(0,m.c)(QS.ClassName,QS);class mS extends of{constructor(y){super(y),this.config=y,this.condition=this.registerDataInput("condition",yf),this.loopBody=this._registerSignalOutput("loopBody")}_execute(y,g){var f;let p=this.condition.getValue(y);for(null!==(f=this.config)&&void 0!==f&&f.isDo&&!p&&this.loopBody._activateSignal(y);p;)this.loopBody._activateSignal(y),p=this.condition.getValue(y);this.out._activateSignal(y)}getClassName(){return mS.ClassName}serialize(y){var g;super.serialize(y),y.isDo=null===(g=this.config)||void 0===g?void 0:g.isDo}}mS.ClassName="FGWhileLoopBlock",(0,m.c)(mS.ClassName,mS);const aS={"lifecycle/onStart":af.ClassName,"lifecycle/onTick":wf.ClassName,log:If.ClassName,"flow/delay":nf.ClassName,"customEvent/send":Mf.ClassName,"customEvent/receive":rf.ClassName,"flow/sequence":Nf.ClassName,"world/get":uf.ClassName,"world/set":Ff.ClassName,"flow/doN":zS.ClassName,"variable/get":TS.ClassName,"variable/set":QS.ClassName,"flow/whileLoop":mS.ClassName,"math/random":yp.ClassName,"math/e":fp.ClassName,"math/pi":pp.ClassName,"math/inf":Sp.ClassName,"math/nan":kp.ClassName,"math/abs":Hp.ClassName,"math/sign":Up.ClassName,"math/trunc":lp.ClassName,"math/floor":cp.ClassName,"math/ceil":Zp.ClassName,"math/fract":Cp.ClassName,"math/neg":qp.ClassName,"math/add":xf.ClassName,"math/sub":df.ClassName,"math/mul":tf.ClassName,"math/div":vf.ClassName,"math/rem":jp.ClassName,"math/min":Pp.ClassName,"math/max":Bp.ClassName,"math/clamp":zp.ClassName,"math/saturate":Qp.ClassName,"math/mix":mp.ClassName,"math/eq":ap.ClassName,"math/lt":op.ClassName,"math/le":Ip.ClassName,"math/gt":Yp.ClassName,"math/ge":np.ClassName,"math/isnan":Mp.ClassName,"math/isinf":rp.ClassName,"math/rad":Np.ClassName,"math/deg":bp.ClassName,"math/sin":sp.ClassName,"math/cos":up.ClassName,"math/tan":Fp.ClassName,"math/asin":Ap.ClassName,"math/acos":Jp.ClassName,"math/atan":Vp.ClassName,"math/atan2":ep.ClassName,"math/sinh":hp.ClassName,"math/cosh":Dp.ClassName,"math/tanh":Kp.ClassName,"math/asinh":Xp.ClassName,"math/acosh":Ep.ClassName,"math/atanh":Op.ClassName,"math/exp":Lp.ClassName,"math/log":xp.ClassName,"math/log2":dp.ClassName,"math/log10":tp.ClassName,"math/sqrt":vp.ClassName,"math/cbrt":yS.ClassName,"math/pow":gS.ClassName,"math/length":fS.ClassName,"math/normalize":pS.ClassName,"math/dot":gp.ClassName,"math/cross":SS.ClassName,"math/rotate2d":kS.ClassName,"math/rotate3d":iS.ClassName,"math/transpose":HS.ClassName,"math/determinant":US.ClassName,"math/inverse":lS.ClassName,"math/matmul":cS.ClassName,"math/not":ZS.ClassName,"math/and":CS.ClassName,"math/or":qS.ClassName,"math/xor":WS.ClassName,"math/asr":PS.ClassName,"math/lsl":jS.ClassName,"math/clz":BS.ClassName,"math/ctz":RS.ClassName,"math/popcnt":GS.ClassName},wS={float2:"Vector2",float3:"o",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function oS(y,g,f){if(void 0!==y.type){const p=g.types&&g.types[y.type];if(!p)throw new Error(`${f}: Unknown type: ${y.type}`);const S=p.signature;if(!S)throw new Error(`${f}: Type ${y.type} has no signature`);const k=wS[S];return{value:y.value,className:k}}return y.value}function IS(y,g,f){const p=aS[g.type];if(!p)throw new Error(`/extensions/KHR_interactivity/nodes/${y}: Unknown block type: ${g.type}`);const S=y.toString(),k=function(y,g,f){const p={},S=y.configuration??[];for(const k of S)if("customEvent"===k.id){const y=g.customEvents&&g.customEvents[k.value];if(!y)throw new Error(`/extensions/KHR_interactivity/nodes/${f}: Unknown custom event: ${k.value}`);p.eventId=y.id,p.eventData=y.values.map((y=>y.id))}else if("variable"===k.id){const y=g.variables&&g.variables[k.value];if(!y)throw new Error(`/extensions/KHR_interactivity/nodes/${f}: Unknown variable: ${k.value}`);p.variableName=y.id}else if("path"===k.id){const y=k.value;p.path=y}else p[k.id]=oS(k,g,`/extensions/KHR_interactivity/nodes/${f}`);return p}(g,f,S);return{className:p,config:k,uniqueId:S,metadata:g.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class YS extends mg{constructor(y){super(y,MS)}}const nS={__array__:{__target__:!0,translation:{type:"o",get:y=>y._babylonTransformNode.position,set:(y,g)=>{g._babylonTransformNode.position=y},getObject:y=>y._babylonTransformNode}}},MS={nodes:nS},rS="KHR_interactivity";class NS{constructor(y){this._loader=y,this.name=rS,this.enabled=this._loader.isExtensionUsed(rS),this._pathConverter=new YS(this._loader.Si)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var y;if(!this._loader.babylonScene||!this._pathConverter)return;const g=this._loader.babylonScene,f=function(y){const g={uniqueId:(0,Og.e)(),_userVariables:{},_connectionValues:{}},f=[g],p=[];for(let k=0;k<y.nodes.length;k++){const g=IS(k,y.nodes[k],y);p.push(g)}for(let k=0;k<y.nodes.length;k++){const f=y.nodes[k],S=p[k],i=f.flows??[];for(const y of i){const g=y.id,f={uniqueId:(0,Og.e)(),name:g,_connectionType:1,connectedPointIds:[]};S.signalOutputs.push(f);const i=y.node,H=y.socket,U=p[i];if(!U)throw new Error(`/extensions/KHR_interactivity/nodes/${k}: Could not find node with id ${i} that connects its input with with node ${k}'s output ${g}`);let l=U.signalInputs.find((y=>y.name===H));l||(l={uniqueId:(0,Og.e)(),name:H,_connectionType:0,connectedPointIds:[]},U.signalInputs.push(l)),l.connectedPointIds.push(f.uniqueId),f.connectedPointIds.push(l.uniqueId)}const H=f.values??[];for(const U of H){const f=U.id,i={uniqueId:(0,Og.e)(),name:f,_connectionType:0,connectedPointIds:[]};if(S.dataInputs.push(i),void 0!==U.value){const f=oS(U,y,`/extensions/KHR_interactivity/nodes/${k}`);g._connectionValues[i.uniqueId]=f}else{if(void 0===U.node||void 0===U.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${k}: Invalid socket ${f} in node ${k}`);{const y=U.node,g=U.socket,S=p[y];if(!S)throw new Error(`/extensions/KHR_interactivity/nodes/${k}: Could not find node with id ${y} that connects its output with node${k}'s input ${f}`);let H=S.dataOutputs.find((y=>y.name===g));H||(H={uniqueId:(0,Og.e)(),name:g,_connectionType:1,connectedPointIds:[]},S.dataOutputs.push(H)),i.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(i.uniqueId)}}}}const S=y.variables??[];for(let k=0;k<S.length;k++){const f=S[k],p=f.id;g._userVariables[p]=oS(f,y,`/extensions/KHR_interactivity/variables/${k}`)}return{allBlocks:p,executionContexts:f}}(null===(y=this._loader.Si.extensions)||void 0===y?void 0:y.KHR_interactivity),p=new mf({Oc:g});Qf.Parse(f,{coordinator:p,pathConverter:this._pathConverter}),p.start()}}O(rS),E(rS,!0,(y=>new NS(y)));const bS="KHR_node_visibility";class sS{constructor(y){this.name=bS,this._loader=y,this.enabled=y.isExtensionUsed(bS)}async onReady(){var y;null===(y=this._loader.Si.nodes)||void 0===y||y.forEach((y=>{var g,f,p,S;(null===(g=y._primitiveBabylonMeshes)||void 0===g||g.forEach((y=>{y.inheritVisibility=!0})),null!==(f=y.extensions)&&void 0!==f&&f.KHR_node_visibility)&&(!1===(null===(p=y.extensions)||void 0===p?void 0:p.KHR_node_visibility.visible)&&(y._babylonTransformNode&&(y._babylonTransformNode.isVisible=!1),null===(S=y._primitiveBabylonMeshes)||void 0===S||S.forEach((y=>{y.isVisible=!1}))))}))}dispose(){this._loader=null}}O(bS),E(bS,!0,(y=>new sS(y)));const uS="ExtrasAsMetadata";class FS{_assignExtras(y,g){if(g.extras&&Object.keys(g.extras).length>0){const f=y.metadata=y.metadata||{};(f.Si=f.Si||{}).extras=g.extras}}constructor(y){this.name=uS,this.enabled=!0,this._loader=y}dispose(){this._loader=null}loadNodeAsync(y,g,f){return this._loader.loadNodeAsync(y,g,(y=>{this._assignExtras(y,g),f(y)}))}loadCameraAsync(y,g,f){return this._loader.loadCameraAsync(y,g,(y=>{this._assignExtras(y,g),f(y)}))}createMaterial(y,g,f){const p=this._loader.createMaterial(y,g,f);return this._assignExtras(p,g),p}}O(uS),E(uS,!1,(y=>new FS(y)))},12276:(y,g,f)=>{"use strict";f.d(g,{c:()=>M,f:()=>a,j:()=>m,m:()=>w});var p=f(10723),S=f(10714),k=f(11445),i=f(11321),H=f(11376),U=f(11368),l=f(10736),c=f(10761),Z=f(12282),C=f(12285),q=f(11334);class W{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.uj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.dk=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(y){this._environmentTexture=y}getNodes(){let y=[];return y=y.concat(this.meshes),y=y.concat(this.lights),y=y.concat(this.cameras),y=y.concat(this.transformNodes),this.skeletons.forEach((g=>y=y.concat(g.bones))),y}}class j extends W{}class P{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((y=>{y.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((y=>{y.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((y=>{y.dispose()})),this.animationGroups.length=0}}class B extends W{constructor(y){super(),this._wasAddedToScene=!1,(y=y||c.d.LastCreatedScene)&&(this.Oc=y,this.proceduralTextures=[],y.nj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=y.getEngine().onContextRestoredObservable.add((()=>{for(const y of this.geometries)y._rebuild();for(const y of this.meshes)y._rebuild();for(const y of this.uj)y.rebuild();for(const y of this.textures)y._rebuild()})))}_topologicalSort(y){const g=new Map;for(const i of y)g.set(i.uniqueId,i);const f={dependsOn:new Map,dependedBy:new Map};for(const i of y){const y=i.uniqueId;f.dependsOn.set(y,new Set),f.dependedBy.set(y,new Set)}for(const i of y){const y=i.uniqueId,p=f.dependsOn.get(y);if(i instanceof Z.c){const S=i.sourceMesh;g.has(S.uniqueId)&&(p.add(S.uniqueId),f.dependedBy.get(S.uniqueId).add(y))}const S=f.dependedBy.get(y);for(const k of i.getDescendants()){const p=k.uniqueId;if(g.has(p)){S.add(p);f.dependsOn.get(p).add(y)}}}const p=[],S=[];for(const i of y){const y=i.uniqueId;0===f.dependsOn.get(y).size&&(S.push(i),g.delete(y))}const k=S;for(;k.length>0;){const y=k.shift();p.push(y);const S=f.dependedBy.get(y.uniqueId);for(const p of Array.from(S.values())){const S=f.dependsOn.get(p);S.delete(y.uniqueId),0===S.size&&g.get(p)&&(k.push(g.get(p)),g.delete(p))}}return g.size>0&&(l.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),g.forEach((y=>l.d.Error(y.name)))),p}_addNodeAndDescendantsToList(y,g,f,p){if(f&&(!p||p(f))&&!g.has(f.uniqueId)){y.push(f),g.add(f.uniqueId);for(const S of f.getDescendants(!0))this._addNodeAndDescendantsToList(y,g,S,p)}}_isNodeInContainer(y){return y instanceof U.c&&-1!==this.meshes.indexOf(y)||(y instanceof H.d&&-1!==this.transformNodes.indexOf(y)||(y instanceof C.d&&-1!==this.lights.indexOf(y)||y instanceof q.d&&-1!==this.cameras.indexOf(y)))}_isValidHierarchy(){for(const y of this.meshes)if(y.parent&&!this._isNodeInContainer(y.parent))return l.d.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.transformNodes)if(y.parent&&!this._isNodeInContainer(y.parent))return l.d.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.lights)if(y.parent&&!this._isNodeInContainer(y.parent))return l.d.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.cameras)if(y.parent&&!this._isNodeInContainer(y.parent))return l.d.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(y){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||S.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const p={},k={},H=new P,U=[],l=[],c={doNotInstantiate:!0,...f},Z=[],C=new Set;for(const S of this.transformNodes)null===S.parent&&this._addNodeAndDescendantsToList(Z,C,S,c.predicate);for(const S of this.meshes)null===S.parent&&this._addNodeAndDescendantsToList(Z,C,S,c.predicate);const q=this._topologicalSort(Z),W=(f,S)=>{if(((g,f)=>{if(p[g.uniqueId]=f.uniqueId,k[f.uniqueId]=f,y&&(f.name=y(g.name)),f instanceof i.e){const y=f;if(y.morphTargetManager){const f=g.morphTargetManager;y.morphTargetManager=f.clone();for(let g=0;g<f.numTargets;g++){const S=f.getTarget(g),i=y.morphTargetManager.getTarget(g);p[S.uniqueId]=i.uniqueId,k[i.uniqueId]=i}}}})(f,S),f.parent){const y=p[f.parent.uniqueId],g=k[y];S.parent=g||f.parent}if(S.position&&f.position&&S.position.p(f.position),S.rotationQuaternion&&f.rotationQuaternion&&S.rotationQuaternion.p(f.rotationQuaternion),S.rotation&&f.rotation&&S.rotation.p(f.rotation),S.pe&&f.pe&&S.pe.p(f.pe),S.material){const i=S;if(i.material)if(g){const g=f.material;if(-1===l.indexOf(g)){let f=g.clone(y?y(g.name):"Clone of "+g.name);if(l.push(g),p[g.uniqueId]=f.uniqueId,k[f.uniqueId]=f,"MultiMaterial"===g.getClassName()){const S=g;for(const g of S.qg)g&&(f=g.clone(y?y(g.name):"Clone of "+g.name),l.push(g),p[g.uniqueId]=f.uniqueId,k[f.uniqueId]=f);S.qg=S.qg.map((y=>y&&k[p[y.uniqueId]]))}}"InstancedMesh"!==i.getClassName()&&(i.material=k[p[g.uniqueId]])}else"MultiMaterial"===i.material.getClassName()?-1===this.Oc.multiMaterials.indexOf(i.material)&&this.Oc.addMultiMaterial(i.material):-1===this.Oc.materials.indexOf(i.material)&&this.Oc.addMaterial(i.material)}null===S.parent&&H.rootNodes.push(S)};return q.forEach((y=>{if("InstancedMesh"===y.getClassName()){const g=y,f=g.sourceMesh,S=p[f.uniqueId],i=("number"===typeof S?k[S]:f).createInstance(g.name);W(g,i)}else{let g=!0;"qb"===y.getClassName()||"Node"===y.getClassName()||y.skeleton||!y.getTotalVertices||0===y.getTotalVertices()?g=!1:c.doNotInstantiate&&(g="function"===typeof c.doNotInstantiate?!c.doNotInstantiate(y):!c.doNotInstantiate);const f=g?y.createInstance(`instance of ${y.name}`):y.clone(`Clone of ${y.name}`,null,!0);if(!f)throw new Error(`Could not clone or instantiate node on Asset Container ${y.name}`);W(y,f)}})),this.skeletons.forEach((g=>{if(c.predicate&&!c.predicate(g))return;const f=g.clone(y?y(g.name):"Clone of "+g.name);for(const y of this.meshes)if(y.skeleton===g&&!y.isAnInstance){const g=k[p[y.uniqueId]];if(!g||g.isAnInstance)continue;if(g.skeleton=f,-1!==U.indexOf(f))continue;U.push(f);for(const y of f.bones)y._linkedTransformNode&&(y._linkedTransformNode=k[p[y._linkedTransformNode.uniqueId]])}H.skeletons.push(f)})),this.animationGroups.forEach((g=>{if(c.predicate&&!c.predicate(g))return;const f=g.clone(y?y(g.name):"Clone of "+g.name,(y=>k[p[y.uniqueId]]||y));H.animationGroups.push(f)})),H}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||S.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Oc.environmentTexture=this.environmentTexture);for(const y of this.Oc._serializableComponents)y.addFromContainer(this);this.Oc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const g=[];this.cameras.forEach((f=>{y&&!y(f)||(this.Oc.addCamera(f),g.push(f))})),this.lights.forEach((f=>{y&&!y(f)||(this.Oc.addLight(f),g.push(f))})),this.meshes.forEach((f=>{y&&!y(f)||(this.Oc.pi(f),g.push(f))})),this.skeletons.forEach((g=>{y&&!y(g)||this.Oc.addSkeleton(g)})),this.animations.forEach((g=>{y&&!y(g)||this.Oc.addAnimation(g)})),this.animationGroups.forEach((g=>{y&&!y(g)||this.Oc.addAnimationGroup(g)})),this.multiMaterials.forEach((g=>{y&&!y(g)||this.Oc.addMultiMaterial(g)})),this.materials.forEach((g=>{y&&!y(g)||this.Oc.addMaterial(g)})),this.morphTargetManagers.forEach((g=>{y&&!y(g)||this.Oc.addMorphTargetManager(g)})),this.geometries.forEach((g=>{y&&!y(g)||this.Oc.addGeometry(g)})),this.transformNodes.forEach((f=>{y&&!y(f)||(this.Oc.addTransformNode(f),g.push(f))})),this.actionManagers.forEach((g=>{y&&!y(g)||this.Oc.addActionManager(g)})),this.textures.forEach((g=>{y&&!y(g)||this.Oc.addTexture(g)})),this.reflectionProbes.forEach((g=>{y&&!y(g)||this.Oc.addReflectionProbe(g)}));for(const f of g)f.parent&&-1===this.Oc.getNodes().indexOf(f.parent)&&(f.setParent?f.setParent(null):f.parent=null)}removeAllFromScene(){this._isValidHierarchy()||S.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Oc.environmentTexture&&(this.Oc.environmentTexture=null);for(const y of this.Oc._serializableComponents)y.removeFromContainer(this)}removeFromScene(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((g=>{y&&!y(g)||this.Oc.removeCamera(g)})),this.lights.forEach((g=>{y&&!y(g)||this.Oc.removeLight(g)})),this.meshes.forEach((g=>{y&&!y(g)||this.Oc.Lc(g,!0)})),this.skeletons.forEach((g=>{y&&!y(g)||this.Oc.removeSkeleton(g)})),this.animations.forEach((g=>{y&&!y(g)||this.Oc.removeAnimation(g)})),this.animationGroups.forEach((g=>{y&&!y(g)||this.Oc.removeAnimationGroup(g)})),this.multiMaterials.forEach((g=>{y&&!y(g)||this.Oc.removeMultiMaterial(g)})),this.materials.forEach((g=>{y&&!y(g)||this.Oc.removeMaterial(g)})),this.morphTargetManagers.forEach((g=>{y&&!y(g)||this.Oc.removeMorphTargetManager(g)})),this.geometries.forEach((g=>{y&&!y(g)||this.Oc.removeGeometry(g)})),this.transformNodes.forEach((g=>{y&&!y(g)||this.Oc.removeTransformNode(g)})),this.actionManagers.forEach((g=>{y&&!y(g)||this.Oc.removeActionManager(g)})),this.textures.forEach((g=>{y&&!y(g)||this.Oc.removeTexture(g)})),this.reflectionProbes.forEach((g=>{y&&!y(g)||this.Oc.removeReflectionProbe(g)}))}dispose(){this.cameras.slice(0).forEach((y=>{y.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((y=>{y.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((y=>{y.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((y=>{y.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((y=>{y.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((y=>{y.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((y=>{y.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((y=>{y.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((y=>{y.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((y=>{y.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((y=>{y.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((y=>{y.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((y=>{y.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const y of this.Oc._serializableComponents)y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Oc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(y,g,f){if(y&&g)for(const p of y){let y=!0;if(f)for(const g of f)if(p===g){y=!1;break}y&&(g.push(p),p._parentContainer=this)}}moveAllFromScene(y){this._wasAddedToScene=!1,void 0===y&&(y=new j);for(const g in this)Object.prototype.hasOwnProperty.call(this,g)&&(this[g]=this[g]||("_environmentTexture"===g?null:[]),this._moveAssets(this.Oc[g],this[g],y[g]));this.environmentTexture=this.Oc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const y=new i.e("assetContainerRootMesh",this.Oc);return this.meshes.forEach((g=>{g.parent||y.addChild(g)})),this.meshes.unshift(y),y}mergeAnimationsTo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.d.LastCreatedScene,g=arguments.length>1?arguments[1]:void 0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!y)return l.d.Error("No scene available to merge animations to"),[];const p=f||(g=>{let f=null;const p=g.animations.length?g.animations[0].targetProperty:"",S=g.name.split(".").join("").split("_primitive")[0];switch(p){case"position":case"rotationQuaternion":f=y.getTransformNodeByName(g.name)||y.getTransformNodeByName(S);break;case"influence":f=y.getMorphTargetByName(g.name)||y.getMorphTargetByName(S);break;default:f=y.getNodeByName(g.name)||y.getNodeByName(S)}return f});this.getNodes().forEach((y=>{const g=p(y);if(null!==g){for(const f of y.animations){const y=g.animations.filter((y=>y.targetProperty===f.targetProperty));for(const f of y){const y=g.animations.indexOf(f,0);y>-1&&g.animations.splice(y,1)}}g.animations=g.animations.concat(y.animations)}}));const S=[];return this.animationGroups.slice().forEach((y=>{S.push(y.clone(y.name,p)),y.animatables.forEach((y=>{y.stop()}))})),g.forEach((g=>{const f=p(g.target);f&&(y.beginAnimation(f,g.fromFrame,g.toFrame,g.loopAnimation,g.speedRatio,g.onAnimationEnd?g.onAnimationEnd:void 0,void 0,!0,void 0,g.onAnimationLoop?g.onAnimationLoop:void 0),y.stopAnimation(g.target))})),S}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((y=>{y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y)})),this.transformNodes.forEach((y=>{y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y)})),this.lights.forEach((y=>{y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y)})),this.cameras.forEach((y=>{y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y)}))}addAllAssetsToContainer(y){if(!y)return;const g=[],f=new Set;for(g.push(y);g.length>0;){const y=g.pop();if(y instanceof i.e?(y.Hj&&-1===this.geometries.indexOf(y.Hj)&&this.geometries.push(y.Hj),this.meshes.push(y)):y instanceof H.d?this.transformNodes.push(y):y instanceof C.d?this.lights.push(y):y instanceof q.d&&this.cameras.push(y),y instanceof U.c){if(y.material&&-1===this.materials.indexOf(y.material)){this.materials.push(y.material);for(const g of y.material.getActiveTextures())-1===this.textures.indexOf(g)&&this.textures.push(g)}y.skeleton&&-1===this.skeletons.indexOf(y.skeleton)&&this.skeletons.push(y.skeleton),y.morphTargetManager&&-1===this.morphTargetManagers.indexOf(y.morphTargetManager)&&this.morphTargetManagers.push(y.morphTargetManager)}for(const p of y.getChildren())f.has(p)||g.push(p);f.add(y)}this.populateRootNodes()}}var R=f(10783);class G{constructor(y){this.byteOffset=0,this.buffer=y}loadAsync(y){return this.buffer.readAsync(this.byteOffset,y).then((y=>{this._dataView=new DataView(y.buffer,y.byteOffset,y.byteLength),this._dataByteOffset=0}))}readUint32(){const y=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,y}readUint8Array(y){const g=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,y);return this._dataByteOffset+=y,this.byteOffset+=y,g}readString(y){return(0,R.j)(this.readUint8Array(y))}skipBytes(y){this._dataByteOffset+=y,this.byteOffset+=y}}var z=f(12287);const T="Z2xURg",Q={name:"Si",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:y=>-1!==y.indexOf("asset")&&-1!==y.indexOf("version")||y.startsWith("data:base64,"+T)||y.startsWith("data:;base64,"+T)||y.startsWith("data:application/octet-stream;base64,"+T)||y.startsWith("data:model/gltf-binary;base64,"+T)};var m,a,w,o=f(10766),I=f(10775);function Y(y,g,f){try{return Promise.resolve(new Uint8Array(y,g,f))}catch(p){return Promise.reject(p)}}!function(y){y[y.AUTO=0]="AUTO",y[y.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(m||(m={})),function(y){y[y.NONE=0]="NONE",y[y.FIRST=1]="FIRST",y[y.ALL=2]="ALL"}(a||(a={})),function(y){y[y.LOADING=0]="LOADING",y[y.READY=1]="READY",y[y.COMPLETE=2]="COMPLETE"}(w||(w={}));class n{constructor(){this.coordinateSystemMode=m.AUTO,this.animationStartMode=a.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=y=>Promise.resolve(y),this.extensionOptions={}}p(y){y&&(this.onParsed=y.onParsed,this.coordinateSystemMode=y.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=y.animationStartMode??this.animationStartMode,this.loadNodeAnimations=y.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=y.loadSkins??this.loadSkins,this.loadMorphTargets=y.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=y.compileMaterials??this.compileMaterials,this.useClipPlane=y.useClipPlane??this.useClipPlane,this.compileShadowGenerators=y.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=y.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=y.useRangeRequests??this.useRangeRequests,this.createInstances=y.createInstances??this.createInstances,this.alwaysComputeBoundingBox=y.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=y.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=y.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=y.skipMaterials??this.skipMaterials,this.useSRGBBuffers=y.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=y.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=y.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=y.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=y.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=y.customRootNode,this.onMeshLoaded=y.onMeshLoaded,this.onSkinLoaded=y.onSkinLoaded,this.onTextureLoaded=y.onTextureLoaded,this.onMaterialLoaded=y.onMaterialLoaded,this.onCameraLoaded=y.onCameraLoaded,this.extensionOptions=y.extensionOptions??this.extensionOptions)}}class M extends n{constructor(y){super(),this.onParsedObservable=new p.d,this.onMeshLoadedObservable=new p.d,this.onSkinLoadedObservable=new p.d,this.onTextureLoadedObservable=new p.d,this.onMaterialLoadedObservable=new p.d,this.onCameraLoadedObservable=new p.d,this.onCompleteObservable=new p.d,this.onErrorObservable=new p.d,this.nj=new p.d,this.onExtensionLoadedObservable=new p.d,this.validate=!1,this.onValidatedObservable=new p.d,this._loader=null,this._state=null,this._requests=new Array,this.name=Q.name,this.extensions=Q.extensions,this.onLoaderStateChangedObservable=new p.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(y)}set onParsed(y){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),y&&(this._onParsedObserver=this.onParsedObservable.add(y))}set onMeshLoaded(y){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),y&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(y))}set onSkinLoaded(y){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),y&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((g=>y(g.node,g.skinnedNode))))}set onTextureLoaded(y){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),y&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(y))}set onMaterialLoaded(y){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),y&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(y))}set onCameraLoaded(y){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),y&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(y))}set onComplete(y){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(y)}set onError(y){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(y)}set onDispose(y){this._onDisposeObserver&&this.nj.remove(this._onDisposeObserver),this._onDisposeObserver=this.nj.add(y)}set onExtensionLoaded(y){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(y)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(y){this._loggingEnabled!==y&&(this._loggingEnabled=y,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(y){this._capturePerformanceCounters!==y&&(this._capturePerformanceCounters=y,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(y){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(y)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const y of this._requests)y.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=y=>Promise.resolve(y),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.nj.notifyObservers(void 0),this.nj.clear()}loadFile(y,g,f,k,i,H,U,c){if(ArrayBuffer.isView(g))return this._loadBinary(y,g,f,k,U,c),null;this._progressCallback=i;const Z=g.name||S.e.GetFilename(g);if(H){if(this.useRangeRequests){this.validate&&l.d.Warn("glTF validation is not supported when range requests are enabled");const f={abort:()=>{},onCompleteObservable:new p.d},S={readAsync:(f,p)=>new Promise(((S,k)=>{this._loadFile(y,g,(y=>{S(new Uint8Array(y))}),!0,(y=>{k(y)}),(y=>{y.setRequestHeader("Range",`bytes=${f}-${f+p-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new G(S)).then((y=>{f.onCompleteObservable.notifyObservers(f),k(y)}),U?y=>U(void 0,y):void 0),f}return this._loadFile(y,g,(g=>{this._validate(y,new Uint8Array(g,0,g.byteLength),f,Z),this._unpackBinaryAsync(new G({readAsync:(y,f)=>Y(g,y,f),byteLength:g.byteLength})).then((y=>{k(y)}),U?y=>U(void 0,y):void 0)}),!0,U)}return this._loadFile(y,g,(g=>{try{this._validate(y,g,f,Z),k({json:this._parseJson(g)})}catch{U&&U()}}),!1,U)}_loadBinary(y,g,f,p,S,k){this._validate(y,new Uint8Array(g.buffer,g.byteOffset,g.byteLength),f,k),this._unpackBinaryAsync(new G({readAsync:(y,f)=>function(y,g,f){try{if(g<0||g>=y.byteLength)throw new RangeError("Offset is out of range.");if(g+f>y.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(y.buffer,y.byteOffset+g,f))}catch(p){return Promise.reject(p)}}(g,y,f),byteLength:g.byteLength})).then((y=>{p(y)}),S?y=>S(void 0,y):void 0)}importMeshAsync(y,g,f,p,S,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(f),this._loader.importMeshAsync(y,g,null,f,p,S,k))))}loadAsync(y,g,f,p,S){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(g),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(g),this._loader.loadAsync(y,g,f,p,S))))}loadAssetContainerAsync(y,g,f,p,S){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(g),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(g);const k=new B(y),i=[];this.onMaterialLoadedObservable.add((y=>{i.push(y)}));const H=[];this.onTextureLoadedObservable.add((y=>{H.push(y)}));const U=[];this.onCameraLoadedObservable.add((y=>{U.push(y)}));const l=[];return this.onMeshLoadedObservable.add((y=>{y.morphTargetManager&&l.push(y.morphTargetManager)})),this._loader.importMeshAsync(null,y,k,g,f,p,S).then((y=>(Array.prototype.push.apply(k.geometries,y.geometries),Array.prototype.push.apply(k.meshes,y.meshes),Array.prototype.push.apply(k.uj,y.uj),Array.prototype.push.apply(k.skeletons,y.skeletons),Array.prototype.push.apply(k.animationGroups,y.animationGroups),Array.prototype.push.apply(k.materials,i),Array.prototype.push.apply(k.textures,H),Array.prototype.push.apply(k.lights,y.lights),Array.prototype.push.apply(k.transformNodes,y.transformNodes),Array.prototype.push.apply(k.cameras,U),Array.prototype.push.apply(k.morphTargetManagers,l),k)))}))}canDirectLoad(y){return Q.canDirectLoad(y)}directLoad(y,g){if(g.startsWith("base64,"+T)||g.startsWith(";base64,"+T)||g.startsWith("application/octet-stream;base64,"+T)||g.startsWith("model/gltf-binary;base64,"+T)){const f=(0,o.e)(g);return this._validate(y,new Uint8Array(f,0,f.byteLength)),this._unpackBinaryAsync(new G({readAsync:(y,g)=>Y(f,y,g),byteLength:f.byteLength}))}return this._validate(y,g),Promise.resolve({json:this._parseJson(g)})}createPlugin(y){return new M(y[Q.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((y,g)=>{this.onCompleteObservable.addOnce((()=>{y()})),this.onErrorObservable.addOnce((y=>{g(y)}))}))}_setState(y){this._state!==y&&(this._state=y,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(w[this._state]))}_loadFile(y,g,f,p,S,k){const i=y._loadFile(g,f,(y=>{this._onProgress(y,i)}),!0,p,S,k);return i.onCompleteObservable.add((()=>{i._lengthComputable=!0,i._total=i._loaded})),this._requests.push(i),i}_onProgress(y,g){if(!this._progressCallback)return;g._lengthComputable=y.lengthComputable,g._loaded=y.loaded,g._total=y.total;let f=!0,p=0,S=0;for(const k of this._requests){if(void 0===k._lengthComputable||void 0===k._loaded||void 0===k._total)return;f=f&&k._lengthComputable,p+=k._loaded,S+=k._total}this._progressCallback({lengthComputable:f,loaded:p,total:f?S:0})}_validate(y,g){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),z.d.ValidateAsync(g,f,p,(g=>this.preprocessUrlAsync(f+g).then((g=>y._loadFileAsync(g,void 0,!0,!0).then((y=>new Uint8Array(y,0,y.byteLength))))))).then((y=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(y),this.onValidatedObservable.clear()}),(y=>{this._endPerformanceCounter("Validate JSON"),S.e.Warn(`Failed to validate: ${y.message}`),this.onValidatedObservable.clear()})))}_getLoader(y){const g=y.json.asset||{};this._log(`Asset version: ${g.version}`),g.minVersion&&this._log(`Asset minimum version: ${g.minVersion}`),g.generator&&this._log(`Asset generator: ${g.generator}`);const f=M._parseVersion(g.version);if(!f)throw new Error("Invalid version: "+g.version);if(void 0!==g.minVersion){const y=M._parseVersion(g.minVersion);if(!y)throw new Error("Invalid minimum version: "+g.minVersion);if(M._compareVersion(y,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+g.minVersion)}const p={1:M._CreateGLTF1Loader,2:M._CreateGLTF2Loader}[f.major];if(!p)throw new Error("Unsupported version: "+g.version);return p(this)}_parseJson(y){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${y.length}`);const g=JSON.parse(y);return this._endPerformanceCounter("Parse JSON"),g}_unpackBinaryAsync(y){return this._startPerformanceCounter("Unpack Binary"),y.loadAsync(20).then((()=>{const g=y.readUint32();if(1179937895!==g)throw new I.j("Unexpected magic: "+g,I.f.GLTFLoaderUnexpectedMagicError);const f=y.readUint32();this.loggingEnabled&&this._log(`Binary version: ${f}`);const p=y.readUint32();let S;switch(this.useRangeRequests||p===y.buffer.byteLength||l.d.Warn(`Length in header does not match actual data length: ${p} != ${y.buffer.byteLength}`),f){case 1:S=this._unpackBinaryV1Async(y,p);break;case 2:S=this._unpackBinaryV2Async(y,p);break;default:throw new Error("Unsupported version: "+f)}return this._endPerformanceCounter("Unpack Binary"),S}))}_unpackBinaryV1Async(y,g){const f=y.readUint32(),p=y.readUint32();if(0!==p)throw new Error(`Unexpected content format: ${p}`);const S=g-y.byteOffset,k={json:this._parseJson(y.readString(f)),bin:null};if(0!==S){const g=y.byteOffset;k.bin={readAsync:(f,p)=>y.buffer.readAsync(g+f,p),byteLength:S}}return Promise.resolve(k)}_unpackBinaryV2Async(y,g){const f=1313821514,p=5130562,S=y.readUint32();if(y.readUint32()!==f)throw new Error("First chunk format is not JSON");return y.byteOffset+S===g?y.loadAsync(S).then((()=>({json:this._parseJson(y.readString(S)),bin:null}))):y.loadAsync(S+8).then((()=>{const k={json:this._parseJson(y.readString(S)),bin:null},i=()=>{const S=y.readUint32();switch(y.readUint32()){case f:throw new Error("Unexpected JSON chunk");case p:{const g=y.byteOffset;k.bin={readAsync:(f,p)=>y.buffer.readAsync(g+f,p),byteLength:S},y.skipBytes(S);break}default:y.skipBytes(S)}return y.byteOffset!==g?y.loadAsync(8).then(i):Promise.resolve(k)};return i()}))}static _parseVersion(y){if("1.0"===y||"1.0.1"===y)return{major:1,minor:0};const g=(y+"").match(/^(\d+)\.(\d+)/);return g?{major:parseInt(g[1]),minor:parseInt(g[2])}:null}static _compareVersion(y,g){return y.major>g.major?1:y.major<g.major?-1:y.minor>g.minor?1:y.minor<g.minor?-1:0}_logOpen(y){this._log(y),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(y){const g=M._logSpaces.substring(0,2*this._logIndentLevel);l.d.Log(`${g}${y}`)}_logDisabled(y){}_startPerformanceCounterEnabled(y){S.e.StartPerformanceCounter(y)}_startPerformanceCounterDisabled(y){}_endPerformanceCounterEnabled(y){S.e.EndPerformanceCounter(y)}_endPerformanceCounterDisabled(y){}}M.IncrementalLoading=!0,M.HomogeneousCoordinates=!1,M._logSpaces="                                ",(0,k.g)(new M)},12287:(y,g,f)=>{"use strict";f.d(g,{d:()=>i});var p=f(10714);function S(y,g,f,p){const S={externalResourceFunction:p};return f&&(S.uri="file:"===g?f:g+f),ArrayBuffer.isView(y)?GLTFValidator.validateBytes(y,S):GLTFValidator.validateString(y,S)}function k(){const y=[];onmessage=g=>{const f=g.data;switch(f.id){case"init":importScripts(f.url);break;case"validate":S(f.data,f.rootUrl,f.fileName,(g=>new Promise(((f,p)=>{const S=y.length;y.push({resolve:f,reject:p}),postMessage({id:"getExternalResource",index:S,uri:g})})))).then((y=>{postMessage({id:"validate.resolve",value:y})}),(y=>{postMessage({id:"validate.reject",reason:y})}));break;case"getExternalResource.resolve":y[f.index].resolve(f.value);break;case"getExternalResource.reject":y[f.index].reject(f.reason)}}}class i{static ValidateAsync(y,g,f,i){return"function"===typeof Worker?new Promise(((H,U)=>{const l=`${S}(${k})()`,c=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),Z=new Worker(c),C=y=>{Z.removeEventListener("error",C),Z.removeEventListener("message",q),U(y)},q=y=>{const g=y.data;switch(g.id){case"getExternalResource":i(g.uri).then((y=>{Z.postMessage({id:"getExternalResource.resolve",index:g.index,value:y},[y.buffer])}),(y=>{Z.postMessage({id:"getExternalResource.reject",index:g.index,reason:y})}));break;case"validate.resolve":Z.removeEventListener("error",C),Z.removeEventListener("message",q),H(g.value),Z.terminate();break;case"validate.reject":Z.removeEventListener("error",C),Z.removeEventListener("message",q),U(g.reason),Z.terminate()}};if(Z.addEventListener("error",C),Z.addEventListener("message",q),Z.postMessage({id:"init",url:p.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(y)){const p=y.slice();Z.postMessage({id:"validate",data:p,rootUrl:g,fileName:f},[p.buffer])}else Z.postMessage({id:"validate",data:y,rootUrl:g,fileName:f})})):(this._LoadScriptPromise||(this._LoadScriptPromise=p.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>S(y,g,f,i))))}}i.Configuration={url:`${p.e._DefaultCdnUrl}/gltf_validator.js`}},12777:(y,g,f)=>{"use strict";f.d(g,{c:()=>m});var p=f(11021),S=f(11026),k=f(11099),i=f(11054),H=f(11253),U=f(11262),l=f(11131),c=f(11038),Z=f(10871),C=f(10812);f(11723),f(11630),f(11653),f(11639),f(11661),f(11668),f(11670);const q="imageProcessingCompatibility",W="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";C.e.IncludesShadersStore[q]=W;const j="skyPixelShader",P="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";C.e.ShadersStore[j]=P;f(11736),f(11676),f(11678),f(11689),f(11687);const B="skyVertexShader",R="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";C.e.ShadersStore[B]=R;var G=f(11294),z=f(11249),T=f(11242);class Q extends H.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class m extends U.e{constructor(y,g){super(y,g),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new i.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=i.m.Zero(),this.up=i.m.Up(),this.dithering=!1,this._cameraPosition=i.m.Zero(),this._skyOrientation=new i.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(y,g){const f=g._drawWrapper;if(this.isFrozen&&f.effect&&f._wasPreviouslyReady)return!0;g.materialDefines||(g.materialDefines=new Q);const p=g.materialDefines,S=this.va();if(this._isReadyForSubMesh(g))return!0;if((0,T.S)(y,S,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,p),(0,T.K)(y,p,!0,!1),p.IMAGEPROCESSINGPOSTPROCESS!==S.imageProcessingConfiguration.applyByPostProcess&&p.markAsMiscDirty(),p.DITHER!==this.dithering&&p.markAsMiscDirty(),p.isDirty){p.markAsProcessed(),S.resetCachedMaterial();const y=new G.d;p.FOG&&y.addFallback(1,"FOG"),p.IMAGEPROCESSINGPOSTPROCESS=S.imageProcessingConfiguration.applyByPostProcess,p.DITHER=this.dithering;const f=[l.c.PositionKind];p.VERTEXCOLOR&&f.push(l.c.ColorKind);const k="sky",i=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,z.c)(i);const H=p.toString();g.setEffect(S.getEngine().createEffect(k,f,i,[],H,y,this.onCompiled,this.onError),p,this._materialContext)}return!(!g.effect||!g.effect.isReady())&&(p._renderId=S.getRenderId(),f._wasPreviouslyReady=!0,!0)}bindForSubMesh(y,g,f){const p=this.va(),S=f.materialDefines;if(!S)return;const k=f.effect;if(!k)return;this._activeEffect=k,this.bindOnlyWorldMatrix(y),this._activeEffect.setMatrix("viewProjection",p.getTransformMatrix()),this._mustRebind(p,k,f)&&((0,z.g)(k,this,p),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,T.q)(S,k,p)),p.fogEnabled&&g.applyFog&&p.fogMode!==c.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",p.getViewMatrix()),(0,T.i)(p,g,this._activeEffect);const H=p.activeCamera;if(H){const y=H.getWorldMatrix();this._cameraPosition.x=y.m[12],this._cameraPosition.y=y.m[13],this._cameraPosition.z=y.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const y=Math.PI*(this.inclination-.5),g=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(g)*Math.cos(y),this.sunPosition.y=this.distance*Math.sin(-y),this.sunPosition.z=this.distance*Math.sin(g)*Math.cos(y),i.g.FromUnitVectorsToRef(i.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(g,this._activeEffect,f)}getAnimatables(){return[]}dispose(y){super.dispose(y)}clone(y){return k.c.Clone((()=>new m(y,this.va())),this)}serialize(){const y=super.serialize();return y.customType="BABYLON.SkyMaterial",y}getClassName(){return"SkyMaterial"}static Parse(y,g,f){return k.c.Parse((()=>new m(y.name,g)),y,g,f)}}(0,p.c)([(0,S.I)()],m.prototype,"luminance",void 0),(0,p.c)([(0,S.I)()],m.prototype,"turbidity",void 0),(0,p.c)([(0,S.I)()],m.prototype,"rayleigh",void 0),(0,p.c)([(0,S.I)()],m.prototype,"mieCoefficient",void 0),(0,p.c)([(0,S.I)()],m.prototype,"mieDirectionalG",void 0),(0,p.c)([(0,S.I)()],m.prototype,"distance",void 0),(0,p.c)([(0,S.I)()],m.prototype,"inclination",void 0),(0,p.c)([(0,S.I)()],m.prototype,"azimuth",void 0),(0,p.c)([(0,S.H)()],m.prototype,"sunPosition",void 0),(0,p.c)([(0,S.I)()],m.prototype,"useSunPosition",void 0),(0,p.c)([(0,S.H)()],m.prototype,"cameraOffset",void 0),(0,p.c)([(0,S.H)()],m.prototype,"up",void 0),(0,p.c)([(0,S.I)()],m.prototype,"dithering",void 0),(0,Z.c)("BABYLON.SkyMaterial",m)},10590:(y,g,f)=>{"use strict";function p(y,g){g.headers=y.headers||{},g.statusMessage=y.statusText,g.statusCode=y.status,g.data=y.response}function S(y,g,f){return new Promise((function(S,k){f=f||{};var i,H,U,l=new XMLHttpRequest,c=f.body,Z=f.headers||{};for(i in f.timeout&&(l.timeout=f.timeout),l.ontimeout=l.onerror=function(y){y.timeout="timeout"==y.type,k(y)},l.open(y,g.href||g),l.onload=function(){for(U=l.getAllResponseHeaders().trim().split(/[\r\n]+/),p(l,l);H=U.shift();)H=H.split(": "),l.headers[H.shift().toLowerCase()]=H.join(": ");if((H=l.headers["content-type"])&&~H.indexOf("application/json"))try{l.data=JSON.parse(l.data,f.reviver)}catch(y){return p(l,y),k(y)}(l.status>=400?k:S)(l)},typeof FormData<"u"&&c instanceof FormData||c&&"object"==typeof c&&(Z["content-type"]="application/json",c=JSON.stringify(c)),l.withCredentials=!!f.withCredentials,Z)l.setRequestHeader(i,Z[i]);l.send(c)}))}f.r(g),f.d(g,{del:()=>U,get:()=>k,patch:()=>H,post:()=>i,put:()=>l,send:()=>S});var k=S.bind(S,"GET"),i=S.bind(S,"POST"),H=S.bind(S,"PATCH"),U=S.bind(S,"DELETE"),l=S.bind(S,"PUT")},12873:(y,g,f)=>{"use strict";f.d(g,{c:()=>Z});const p=.5*(Math.sqrt(3)-1),S=(3-Math.sqrt(3))/6,k=1/3,i=1/6,H=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,l=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),c=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Z=class{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const g="function"==typeof y?y:function(y){let g=0,f=0,p=0,S=1;const k=function(){let y=4022871197;return function(g){g=g.toString();for(let f=0;f<g.length;f++){y+=g.charCodeAt(f);let p=.02519603282416938*y;y=p>>>0,p-=y,p*=y,y=p>>>0,p-=y,y+=4294967296*p}return 2.3283064365386963e-10*(y>>>0)}}();g=k(" "),f=k(" "),p=k(" "),g-=k(y),g<0&&(g+=1);f-=k(y),f<0&&(f+=1);p-=k(y),p<0&&(p+=1);return function(){const y=2091639*g+2.3283064365386963e-10*S;return g=f,f=p,p=y-(S=0|y)}}(y);this.p=function(y){const g=new Uint8Array(256);for(let f=0;f<256;f++)g[f]=f;for(let f=0;f<255;f++){const p=f+~~(y()*(256-f)),S=g[f];g[f]=g[p],g[p]=S}return g}(g),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let f=0;f<512;f++)this.perm[f]=this.p[255&f],this.permMod12[f]=this.perm[f]%12}noise2D(y,g){const f=this.permMod12,k=this.perm;let i=0,H=0,U=0;const c=(y+g)*p,Z=Math.floor(y+c),C=Math.floor(g+c),q=(Z+C)*S,W=y-(Z-q),j=g-(C-q);let P,B;W>j?(P=1,B=0):(P=0,B=1);const R=W-P+S,G=j-B+S,z=W-1+2*S,T=j-1+2*S,Q=255&Z,m=255&C;let a=.5-W*W-j*j;if(a>=0){const y=3*f[Q+k[m]];a*=a,i=a*a*(l[y]*W+l[y+1]*j)}let w=.5-R*R-G*G;if(w>=0){const y=3*f[Q+P+k[m+B]];w*=w,H=w*w*(l[y]*R+l[y+1]*G)}let o=.5-z*z-T*T;if(o>=0){const y=3*f[Q+1+k[m+1]];o*=o,U=o*o*(l[y]*z+l[y+1]*T)}return 70*(i+H+U)}noise3D(y,g,f){const p=this.permMod12,S=this.perm;let H,U,c,Z;const C=(y+g+f)*k,q=Math.floor(y+C),W=Math.floor(g+C),j=Math.floor(f+C),P=(q+W+j)*i,B=y-(q-P),R=g-(W-P),G=f-(j-P);let z,T,Q,m,a,w;B>=R?R>=G?(z=1,T=0,Q=0,m=1,a=1,w=0):B>=G?(z=1,T=0,Q=0,m=1,a=0,w=1):(z=0,T=0,Q=1,m=1,a=0,w=1):R<G?(z=0,T=0,Q=1,m=0,a=1,w=1):B<G?(z=0,T=1,Q=0,m=0,a=1,w=1):(z=0,T=1,Q=0,m=1,a=1,w=0);const o=B-z+i,I=R-T+i,Y=G-Q+i,n=B-m+2*i,M=R-a+2*i,r=G-w+2*i,N=B-1+.5,b=R-1+.5,s=G-1+.5,u=255&q,F=255&W,A=255&j;let J=.6-B*B-R*R-G*G;if(J<0)H=0;else{const y=3*p[u+S[F+S[A]]];J*=J,H=J*J*(l[y]*B+l[y+1]*R+l[y+2]*G)}let V=.6-o*o-I*I-Y*Y;if(V<0)U=0;else{const y=3*p[u+z+S[F+T+S[A+Q]]];V*=V,U=V*V*(l[y]*o+l[y+1]*I+l[y+2]*Y)}let e=.6-n*n-M*M-r*r;if(e<0)c=0;else{const y=3*p[u+m+S[F+a+S[A+w]]];e*=e,c=e*e*(l[y]*n+l[y+1]*M+l[y+2]*r)}let h=.6-N*N-b*b-s*s;if(h<0)Z=0;else{const y=3*p[u+1+S[F+1+S[A+1]]];h*=h,Z=h*h*(l[y]*N+l[y+1]*b+l[y+2]*s)}return 32*(H+U+c+Z)}noise4D(y,g,f,p){const S=this.perm;let k,i,l,Z,C;const q=(y+g+f+p)*H,W=Math.floor(y+q),j=Math.floor(g+q),P=Math.floor(f+q),B=Math.floor(p+q),R=(W+j+P+B)*U,G=y-(W-R),z=g-(j-R),T=f-(P-R),Q=p-(B-R);let m=0,a=0,w=0,o=0;G>z?m++:a++,G>T?m++:w++,G>Q?m++:o++,z>T?a++:w++,z>Q?a++:o++,T>Q?w++:o++;const I=m>=3?1:0,Y=a>=3?1:0,n=w>=3?1:0,M=o>=3?1:0,r=m>=2?1:0,N=a>=2?1:0,b=w>=2?1:0,s=o>=2?1:0,u=m>=1?1:0,F=a>=1?1:0,A=w>=1?1:0,J=o>=1?1:0,V=G-I+U,e=z-Y+U,h=T-n+U,D=Q-M+U,K=G-r+2*U,X=z-N+2*U,E=T-b+2*U,O=Q-s+2*U,L=G-u+3*U,x=z-F+3*U,d=T-A+3*U,t=Q-J+3*U,v=G-1+4*U,yy=z-1+4*U,gy=T-1+4*U,fy=Q-1+4*U,py=255&W,Sy=255&j,ky=255&P,iy=255&B;let Hy=.6-G*G-z*z-T*T-Q*Q;if(Hy<0)k=0;else{const y=S[py+S[Sy+S[ky+S[iy]]]]%32*4;Hy*=Hy,k=Hy*Hy*(c[y]*G+c[y+1]*z+c[y+2]*T+c[y+3]*Q)}let Uy=.6-V*V-e*e-h*h-D*D;if(Uy<0)i=0;else{const y=S[py+I+S[Sy+Y+S[ky+n+S[iy+M]]]]%32*4;Uy*=Uy,i=Uy*Uy*(c[y]*V+c[y+1]*e+c[y+2]*h+c[y+3]*D)}let ly=.6-K*K-X*X-E*E-O*O;if(ly<0)l=0;else{const y=S[py+r+S[Sy+N+S[ky+b+S[iy+s]]]]%32*4;ly*=ly,l=ly*ly*(c[y]*K+c[y+1]*X+c[y+2]*E+c[y+3]*O)}let cy=.6-L*L-x*x-d*d-t*t;if(cy<0)Z=0;else{const y=S[py+u+S[Sy+F+S[ky+A+S[iy+J]]]]%32*4;cy*=cy,Z=cy*cy*(c[y]*L+c[y+1]*x+c[y+2]*d+c[y+3]*t)}let Zy=.6-v*v-yy*yy-gy*gy-fy*fy;if(Zy<0)C=0;else{const y=S[py+1+S[Sy+1+S[ky+1+S[iy+1]]]]%32*4;Zy*=Zy,C=Zy*Zy*(c[y]*v+c[y+1]*yy+c[y+2]*gy+c[y+3]*fy)}return 27*(k+i+l+Z+C)}}}}]);