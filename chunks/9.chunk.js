"use strict";(self.ozi0exxand9=self.ozi0exxand9||[]).push([[9],{11306:(f,v,Z)=>{Z.d(v,{b:()=>y,f:()=>z,k:()=>Y,i:()=>g,m:()=>w});class V{constructor(){this.children=[]}isValid(f){return!0}process(f,v,Z){let V="";if(this.line){let Z=this.line;const O=v.processor;if(O){var h,J,l,e,C,H;O.lineProcessor&&(Z=O.lineProcessor(Z,v.isFragment,v.processingContext));const V=(null===(h=v.processor)||void 0===h?void 0:h.attributeKeywordName)??"attribute",u=v.isFragment&&null!==(J=v.processor)&&void 0!==J&&J.varyingFragmentKeywordName?null===(l=v.processor)||void 0===l?void 0:l.varyingFragmentKeywordName:!v.isFragment&&null!==(e=v.processor)&&void 0!==e&&e.varyingVertexKeywordName?null===(C=v.processor)||void 0===C?void 0:C.varyingVertexKeywordName:"varying";if(!v.isFragment&&O.attributeProcessor&&this.line.startsWith(V))Z=O.attributeProcessor(this.line,f,v.processingContext);else if(O.varyingProcessor&&(null!==(H=O.varyingCheck)&&void 0!==H&&H.call(O,this.line,v.isFragment)||!O.varyingCheck&&this.line.startsWith(u)))Z=O.varyingProcessor(this.line,v.isFragment,f,v.processingContext);else if(O.uniformProcessor&&O.uniformRegexp&&O.uniformRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(Z=O.uniformProcessor(this.line,v.isFragment,f,v.processingContext));else if(O.uniformBufferProcessor&&O.uniformBufferRegexp&&O.uniformBufferRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(Z=O.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0);else if(O.textureProcessor&&O.textureRegexp&&O.textureRegexp.test(this.line))Z=O.textureProcessor(this.line,v.isFragment,f,v.processingContext);else if((O.uniformProcessor||O.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!v.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?O.uniformProcessor&&(Z=O.uniformProcessor(this.line,v.isFragment,f,v.processingContext)):O.uniformBufferProcessor&&(Z=O.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0)}v.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(v.lookForClosingBracketForUniformBuffer=!1,O.endOfUniformBufferProcessor&&(Z=O.endOfUniformBufferProcessor(this.line,v.isFragment,v.processingContext)))}V+=Z+"\n"}for(const O of this.children)V+=O.process(f,v,Z);return this.additionalDefineKey&&(f[this.additionalDefineKey]=this.additionalDefineValue||"true",Z[this.additionalDefineKey]=f[this.additionalDefineKey]),V}}class h{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(f){this._lines.length=0;for(const v of f){if(!v||"\r"===v)continue;if("#"===v[0]){this._lines.push(v);continue}const f=v.trim();if(!f)continue;if(f.startsWith("//")){this._lines.push(v);continue}const Z=f.indexOf(";");if(-1===Z)this._lines.push(f);else if(Z===f.length-1)f.length>1&&this._lines.push(f);else{const f=v.split(";");for(let v=0;v<f.length;v++){let Z=f[v];Z&&(Z=Z.trim(),Z&&this._lines.push(Z+(v!==f.length-1?";":"")))}}}}}class J extends V{process(f,v,Z){for(let V=0;V<this.children.length;V++){const h=this.children[V];if(h.isValid(f))return h.process(f,v,Z)}return""}}class l extends V{isValid(f){return this.testExpression.isTrue(f)}}class e{isTrue(f){return!0}static postfixToInfix(f){const v=[];for(const Z of f)if(void 0===e._OperatorPriority[Z])v.push(Z);else{const f=v[v.length-1],V=v[v.length-2];v.length-=2,v.push(`(${V}${Z}${f})`)}return v[v.length-1]}static infixToPostfix(f){const v=e._InfixToPostfixCache.get(f);if(v)return v.accessTime=Date.now(),v.result;if(!f.includes("&&")&&!f.includes("||")&&!f.includes(")")&&!f.includes("("))return[f];const Z=[];let V=-1;const h=()=>{O=O.trim(),""!==O&&(Z.push(O),O="")},J=f=>{V<e._Stack.length-1&&(e._Stack[++V]=f)},l=()=>e._Stack[V],C=()=>-1===V?"!!INVALID EXPRESSION!!":e._Stack[V--];let H=0,O="";for(;H<f.length;){const v=f.charAt(H),u=H<f.length-1?f.substring(H,2+H):"";if("("===v)O="",J(v);else if(")"===v){for(h();-1!==V&&"("!==l();)Z.push(C());C()}else if(e._OperatorPriority[u]>1){for(h();-1!==V&&e._OperatorPriority[l()]>=e._OperatorPriority[u];)Z.push(C());J(u),H++}else O+=v;H++}for(h();-1!==V;)"("===l()?C():Z.push(C());return e._InfixToPostfixCache.size>=e.InfixToPostfixCacheLimitSize&&e.ClearCache(),e._InfixToPostfixCache.set(f,{result:Z,accessTime:Date.now()}),Z}static ClearCache(){const f=Array.from(e._InfixToPostfixCache.entries()).sort(((f,v)=>f[1].accessTime-v[1].accessTime));for(let v=0;v<e.InfixToPostfixCacheCleanupSize;v++)e._InfixToPostfixCache.delete(f[v][0])}}e.InfixToPostfixCacheLimitSize=5e4,e.InfixToPostfixCacheCleanupSize=25e3,e._InfixToPostfixCache=new Map,e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""];class C extends e{constructor(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=f,this.not=v}isTrue(f){let v=void 0!==f[this.define];return this.not&&(v=!v),v}}class H extends e{isTrue(f){return this.leftOperand.isTrue(f)||this.rightOperand.isTrue(f)}}class O extends e{isTrue(f){return this.leftOperand.isTrue(f)&&this.rightOperand.isTrue(f)}}class u extends e{constructor(f,v,Z){super(),this.define=f,this.operand=v,this.testValue=Z}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(f){let v=!1;const Z=parseInt(void 0!=f[this.define]?f[this.define]:this.define),V=parseInt(void 0!=f[this.testValue]?f[this.testValue]:this.testValue);if(isNaN(Z)||isNaN(V))return!1;switch(this.operand){case">":v=Z>V;break;case"<":v=Z<V;break;case"<=":v=Z<=V;break;case">=":v=Z>=V;break;case"==":v=Z===V;break;case"!=":v=Z!==V}return v}}var W=Z(11263),a=Z(11314);const b=/defined\s*?\((.+?)\)/g,X=/defined\s*?\[(.+?)\]/g,F=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,U=/__decl__/,K=/light\{X\}.(\w*)/g,M=/\{X\}/g,A=[],s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function z(f){f.processor&&f.processor.initializeShaders&&f.processor.initializeShaders(f.processingContext)}function Y(f,v,Z,V){var h;null!==(h=v.processor)&&void 0!==h&&h.preProcessShaderCode&&(f=v.processor.preProcessShaderCode(f,v.isFragment)),g(f,v,(f=>{v.processCodeAfterIncludes&&(f=v.processCodeAfterIncludes(v.isFragment?"fragment":"vertex",f,v.defines));const h=function(f,v,Z){let V=function(f,v){var Z;if(null!==(Z=v.processor)&&void 0!==Z&&Z.noPrecision)return f;const V=v.shouldUseHighPrecisionShader;-1===f.indexOf("precision highp float")?f=V?"precision highp float;\n"+f:"precision mediump float;\n"+f:V||(f=f.replace("precision highp float","precision mediump float"));return f}(f,v);if(!v.processor)return V;if(0===v.processor.shaderLanguage&&-1!==V.indexOf("#version 3")&&(V=V.replace("#version 300 es",""),!v.processor.parseGLES3))return V;const h=v.defines,J=P(v,Z);v.processor.preProcessor&&(V=v.processor.preProcessor(V,h,J,v.isFragment,v.processingContext));const l={};V=B(V,J,v,l),v.processor.postProcessor&&(V=v.processor.postProcessor(V,h,v.isFragment,v.processingContext,Z?{drawBuffersExtensionDisabled:!Z.getCaps().drawBuffersExtension}:{},J,l));null!==Z&&void 0!==Z&&Z._features.needShaderCodeInlining&&(V=Z.inlineShaderCode(V));return V}(f,v,V);Z(h,f)}))}function y(f,v,Z){return Z.processor&&Z.processor.finalizeShaders?Z.processor.finalizeShaders(f,v,Z.processingContext):{vertexCode:f,fragmentCode:v}}function N(f){const v=/defined\((.+)\)/.exec(f);if(v&&v.length)return new C(v[1].trim(),"!"===f[0]);const Z=["==","!=",">=","<=","<",">"];let V="",h=0;for(V of Z)if(h=f.indexOf(V),h>-1)break;if(-1===h)return new C(f);const J=f.substring(0,h).trim(),l=f.substring(h+V.length).trim();return new u(J,V,l)}function i(f,v){const Z=new l,V=f.substring(0,v);let h=f.substring(v);return h=h.substring(0,(h.indexOf("//")+1||h.length+1)-1).trim(),Z.testExpression="#ifdef"===V?new C(h):"#ifndef"===V?new C(h,!0):function(f){f=f.replace(b,"defined[$1]");const v=e.infixToPostfix(f),Z=[];for(const h of v)if("||"!==h&&"&&"!==h)Z.push(h);else if(Z.length>=2){let f=Z[Z.length-1],v=Z[Z.length-2];Z.length-=2;const V="&&"==h?new O:new H;"string"===typeof f&&(f=f.replace(X,"defined($1)")),"string"===typeof v&&(v=v.replace(X,"defined($1)")),V.leftOperand="string"===typeof v?N(v):v,V.rightOperand="string"===typeof f?N(f):f,Z.push(V)}let V=Z[Z.length-1];return"string"===typeof V&&(V=V.replace(X,"defined($1)")),"string"===typeof V?N(V):V}(h),Z}function I(f,v,Z,h){let J=f.currentLine;for(;T(f,Z,h);){J=f.currentLine;const l=J.substring(0,5).toLowerCase();if("#else"===l){const Z=new V;return v.children.push(Z),void T(f,Z,h)}if("#elif"===l){const f=i(J,5);v.children.push(f),Z=f}}}function T(f,v,Z){for(;f.canRead;){f.lineIndex++;const h=f.currentLine;if(h.indexOf("#")>=0){const V=s.exec(h);if(V&&V.length){switch(V[0]){case"#ifdef":{const V=new J;v.children.push(V);const l=i(h,6);V.children.push(l),I(f,V,l,Z);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const V=new J;v.children.push(V);const l=i(h,7);V.children.push(l),I(f,V,l,Z);break}case"#if":{const V=new J,l=i(h,3);v.children.push(V),V.children.push(l),I(f,V,l,Z);break}}continue}}const l=new V;if(l.line=h,v.children.push(l),"#"===h[0]&&"d"===h[1]){const f=h.replace(";","").split(" ");l.additionalDefineKey=f[1],3===f.length&&(l.additionalDefineValue=f[2])}}return!1}function B(f,v,Z,J){const l=new V,e=new h;return e.lineIndex=-1,e.lines=f.split("\n"),T(e,l,J),l.process(v,Z,J)}function P(f,v){var Z;const V=f.defines,h={};for(const J of V){const f=J.replace("#define","").replace(";","").trim().split(" ");h[f[0]]=f.length>1?f[1]:""}return 0===(null===(Z=f.processor)||void 0===Z?void 0:Z.shaderLanguage)&&(h.GL_ES="true"),h.__VERSION__=f.version,h[f.platformName]="true",(0,a.m)(h,null===v||void 0===v?void 0:v.isNDCHalfZRange,null===v||void 0===v?void 0:v.useReverseDepthBuffer,null===v||void 0===v?void 0:v.useExactSrgbConversions),h}function g(f,v,Z){let V;for(A.length=0;null!==(V=F.exec(f));)A.push(V);let h=String(f),J=[f],l=!1;for(const e of A){let f=e[1];if(-1!==f.indexOf("__decl__")&&(f=f.replace(U,""),v.supportsUniformBuffers&&(f=f.replace("Vertex","Ubo").replace("Fragment","Ubo")),f+="Declaration"),!v.includesShadersStore[f]){const V=v.shadersRepository+"ShadersInclude/"+f+".fx";return void w.loadFile(V,(V=>{v.includesShadersStore[f]=V,g(J.join(""),v,Z)}))}{let Z=v.includesShadersStore[f];if(e[2]){const f=e[3].split(",");for(let v=0;v<f.length;v+=2){const V=new RegExp(f[v],"g"),h=f[v+1];Z=Z.replace(V,h)}}if(e[4]){const f=e[5];if(-1!==f.indexOf("..")){const V=f.split(".."),h=parseInt(V[0]);let J=parseInt(V[1]),l=Z.slice(0);Z="",isNaN(J)&&(J=v.indexParameters[V[1]]);for(let f=h;f<J;f++)v.supportsUniformBuffers||(l=l.replace(K,((f,v)=>v+"{X}"))),Z+=l.replace(M,f.toString())+"\n"}else v.supportsUniformBuffers||(Z=Z.replace(K,((f,v)=>v+"{X}"))),Z=Z.replace(M,f)}const V=[];for(const f of J){const v=f.split(e[0]);for(let f=0;f<v.length-1;f++)V.push(v[f]),V.push(Z);V.push(v[v.length-1])}J=V,l=l||Z.indexOf("#include<")>=0||Z.indexOf("#include <")>=0}}A.length=0,h=J.join(""),l?g(h.toString(),v,Z):Z(h)}const w={loadFile:(f,v,Z,V,h,J)=>{throw(0,W.e)("FileTools")}}},11314:(f,v,Z)=>{Z.d(v,{e:()=>h,i:()=>J,m:()=>e,o:()=>l,r:()=>C});var V=Z(11263);Z(11239);const h={};function J(f,v){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(v?v+"\n":"")+f}function l(f,v,Z,J,l,e,C){const H=C||h.loadFile;if(H){return H(f,v,Z,J,l,e)}throw(0,V.e)("FileTools")}function e(f,v,Z,V){if(f)return v?f.IS_NDC_HALF_ZRANGE="":delete f.IS_NDC_HALF_ZRANGE,Z?f.USE_REVERSE_DEPTHBUFFER="":delete f.USE_REVERSE_DEPTHBUFFER,void(V?f.USE_EXACT_SRGB_CONVERSIONS="":delete f.USE_EXACT_SRGB_CONVERSIONS);{let f="";return v&&(f+="#define IS_NDC_HALF_ZRANGE"),Z&&(f&&(f+="\n"),f+="#define USE_REVERSE_DEPTHBUFFER"),V&&(f&&(f+="\n"),f+="#define USE_EXACT_SRGB_CONVERSIONS"),f}}function C(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;switch(f){case 3:{const f=(ArrayBuffer,new Int8Array(v));return V&&f.set(new Int8Array(V)),f}case 0:{const f=(ArrayBuffer,new Uint8Array(v));return V&&f.set(new Uint8Array(V)),f}case 4:{const f=v instanceof ArrayBuffer?new Int16Array(v):new Int16Array(Z?v/2:v);return V&&f.set(new Int16Array(V)),f}case 5:case 8:case 9:case 10:case 2:{const f=v instanceof ArrayBuffer?new Uint16Array(v):new Uint16Array(Z?v/2:v);return V&&f.set(new Uint16Array(V)),f}case 6:{const f=v instanceof ArrayBuffer?new Int32Array(v):new Int32Array(Z?v/4:v);return V&&f.set(new Int32Array(V)),f}case 7:case 11:case 12:case 13:case 14:case 15:{const f=v instanceof ArrayBuffer?new Uint32Array(v):new Uint32Array(Z?v/4:v);return V&&f.set(new Uint32Array(V)),f}case 1:{const f=v instanceof ArrayBuffer?new Float32Array(v):new Float32Array(Z?v/4:v);return V&&f.set(new Float32Array(V)),f}}const h=(ArrayBuffer,new Uint8Array(v));return V&&h.set(new Uint8Array(V)),h}},11333:(f,v,Z)=>{Z.d(v,{c:()=>V});class V{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?V.ShadersRepository:V.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?V.ShadersStore:V.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?V.IncludesShadersStore:V.IncludesShadersStoreWGSL}}V.ShadersRepository="src/Shaders/",V.ShadersStore={},V.IncludesShadersStore={},V.ShadersRepositoryWGSL="src/ShadersWGSL/",V.ShadersStoreWGSL={},V.IncludesShadersStoreWGSL={}},11346:(f,v,Z)=>{Z.d(v,{d:()=>W,g:()=>M,k:()=>b,l:()=>a,o:()=>X,q:()=>K,t:()=>u,u:()=>H,x:()=>O,y:()=>C,z:()=>e});class V{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.bv._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(f){f&&this.program&&f(this.program)}setEngine(f){this.bv=f}_fillEffectInformation(f,v,Z,V,h,J,l,e){const C=this.bv;if(C.supportsUniformBuffers)for(const O in v)f.bindUniformBlock(O,v[O]);let H;for(this.bv.getUniforms(this,Z).forEach(((f,v)=>{V[Z[v]]=f})),this._uniforms=V,H=0;H<h.length;H++){null==f.getUniform(h[H])&&(h.splice(H,1),H--)}h.forEach(((f,v)=>{J[f]=v}));for(const O of C.getAttributes(this,l))e.push(O)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(f,v){const Z=this._valueCache[f],V=v.updateFlag;return(void 0===Z||Z!==V)&&(this._valueCache[f]=V,!0)}_cacheFloat2(f,v,Z){let V=this._valueCache[f];if(!V||2!==V.length)return V=[v,Z],this._valueCache[f]=V,!0;let h=!1;return V[0]!==v&&(V[0]=v,h=!0),V[1]!==Z&&(V[1]=Z,h=!0),h}_cacheFloat3(f,v,Z,V){let h=this._valueCache[f];if(!h||3!==h.length)return h=[v,Z,V],this._valueCache[f]=h,!0;let J=!1;return h[0]!==v&&(h[0]=v,J=!0),h[1]!==Z&&(h[1]=Z,J=!0),h[2]!==V&&(h[2]=V,J=!0),J}_cacheFloat4(f,v,Z,V,h){let J=this._valueCache[f];if(!J||4!==J.length)return J=[v,Z,V,h],this._valueCache[f]=J,!0;let l=!1;return J[0]!==v&&(J[0]=v,l=!0),J[1]!==Z&&(J[1]=Z,l=!0),J[2]!==V&&(J[2]=V,l=!0),J[3]!==h&&(J[3]=h,l=!0),l}setInt(f,v){const Z=this._valueCache[f];void 0!==Z&&Z===v||this.bv.setInt(this._uniforms[f],v)&&(this._valueCache[f]=v)}setInt2(f,v,Z){this._cacheFloat2(f,v,Z)&&(this.bv.setInt2(this._uniforms[f],v,Z)||(this._valueCache[f]=null))}setInt3(f,v,Z,V){this._cacheFloat3(f,v,Z,V)&&(this.bv.setInt3(this._uniforms[f],v,Z,V)||(this._valueCache[f]=null))}setInt4(f,v,Z,V,h){this._cacheFloat4(f,v,Z,V,h)&&(this.bv.setInt4(this._uniforms[f],v,Z,V,h)||(this._valueCache[f]=null))}setIntArray(f,v){this._valueCache[f]=null,this.bv.setIntArray(this._uniforms[f],v)}setIntArray2(f,v){this._valueCache[f]=null,this.bv.setIntArray2(this._uniforms[f],v)}setIntArray3(f,v){this._valueCache[f]=null,this.bv.setIntArray3(this._uniforms[f],v)}setIntArray4(f,v){this._valueCache[f]=null,this.bv.setIntArray4(this._uniforms[f],v)}setUInt(f,v){const Z=this._valueCache[f];void 0!==Z&&Z===v||this.bv.setUInt(this._uniforms[f],v)&&(this._valueCache[f]=v)}setUInt2(f,v,Z){this._cacheFloat2(f,v,Z)&&(this.bv.setUInt2(this._uniforms[f],v,Z)||(this._valueCache[f]=null))}setUInt3(f,v,Z,V){this._cacheFloat3(f,v,Z,V)&&(this.bv.setUInt3(this._uniforms[f],v,Z,V)||(this._valueCache[f]=null))}setUInt4(f,v,Z,V,h){this._cacheFloat4(f,v,Z,V,h)&&(this.bv.setUInt4(this._uniforms[f],v,Z,V,h)||(this._valueCache[f]=null))}setUIntArray(f,v){this._valueCache[f]=null,this.bv.setUIntArray(this._uniforms[f],v)}setUIntArray2(f,v){this._valueCache[f]=null,this.bv.setUIntArray2(this._uniforms[f],v)}setUIntArray3(f,v){this._valueCache[f]=null,this.bv.setUIntArray3(this._uniforms[f],v)}setUIntArray4(f,v){this._valueCache[f]=null,this.bv.setUIntArray4(this._uniforms[f],v)}setArray(f,v){this._valueCache[f]=null,this.bv.setArray(this._uniforms[f],v)}setArray2(f,v){this._valueCache[f]=null,this.bv.setArray2(this._uniforms[f],v)}setArray3(f,v){this._valueCache[f]=null,this.bv.setArray3(this._uniforms[f],v)}setArray4(f,v){this._valueCache[f]=null,this.bv.setArray4(this._uniforms[f],v)}setMatrices(f,v){v&&(this._valueCache[f]=null,this.bv.setMatrices(this._uniforms[f],v))}setMatrix(f,v){this._cacheMatrix(f,v)&&(this.bv.setMatrices(this._uniforms[f],v.Ph())||(this._valueCache[f]=null))}setMatrix3x3(f,v){this._valueCache[f]=null,this.bv.setMatrix3x3(this._uniforms[f],v)}setMatrix2x2(f,v){this._valueCache[f]=null,this.bv.setMatrix2x2(this._uniforms[f],v)}setFloat(f,v){const Z=this._valueCache[f];void 0!==Z&&Z===v||this.bv.setFloat(this._uniforms[f],v)&&(this._valueCache[f]=v)}setVector2(f,v){this._cacheFloat2(f,v.x,v.y)&&(this.bv.setFloat2(this._uniforms[f],v.x,v.y)||(this._valueCache[f]=null))}setFloat2(f,v,Z){this._cacheFloat2(f,v,Z)&&(this.bv.setFloat2(this._uniforms[f],v,Z)||(this._valueCache[f]=null))}setVector3(f,v){this._cacheFloat3(f,v.x,v.y,v.z)&&(this.bv.setFloat3(this._uniforms[f],v.x,v.y,v.z)||(this._valueCache[f]=null))}setFloat3(f,v,Z,V){this._cacheFloat3(f,v,Z,V)&&(this.bv.setFloat3(this._uniforms[f],v,Z,V)||(this._valueCache[f]=null))}setVector4(f,v){this._cacheFloat4(f,v.x,v.y,v.z,v.w)&&(this.bv.setFloat4(this._uniforms[f],v.x,v.y,v.z,v.w)||(this._valueCache[f]=null))}setQuaternion(f,v){this._cacheFloat4(f,v.x,v.y,v.z,v.w)&&(this.bv.setFloat4(this._uniforms[f],v.x,v.y,v.z,v.w)||(this._valueCache[f]=null))}setFloat4(f,v,Z,V,h){this._cacheFloat4(f,v,Z,V,h)&&(this.bv.setFloat4(this._uniforms[f],v,Z,V,h)||(this._valueCache[f]=null))}setColor3(f,v){this._cacheFloat3(f,v.r,v.g,v.b)&&(this.bv.setFloat3(this._uniforms[f],v.r,v.g,v.b)||(this._valueCache[f]=null))}setColor4(f,v,Z){this._cacheFloat4(f,v.r,v.g,v.b,Z)&&(this.bv.setFloat4(this._uniforms[f],v.r,v.g,v.b,Z)||(this._valueCache[f]=null))}setDirectColor4(f,v){this._cacheFloat4(f,v.r,v.g,v.b,v.a)&&(this.bv.setFloat4(this._uniforms[f],v.r,v.g,v.b,v.a)||(this._valueCache[f]=null))}_getVertexShaderCode(){return this.vertexShader?this.bv._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.bv._getShaderSource(this.fragmentShader):null}}var h=Z(11314);const J=new WeakMap,l={_webGLVersion:2,cachedPipelines:{}};function e(f){let v=J.get(f);if(!v){if(!f)return l;v={_webGLVersion:f.TEXTURE_BINDING_3D?2:1,_context:f,parallelShaderCompile:f.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},J.set(f,v)}return v}function C(f){J.delete(f)}function H(f,v,Z,V,h,J){const l=e(V);J||(J=l._createShaderProgramInjection??W);return J(f,U(v,"vertex",V,l._contextWasLost),U(Z,"fragment",V,l._contextWasLost),V,h,l.validateShaderPrograms)}function O(f,v,Z,V,h){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0;const C=e(h);l||(l=C._createShaderProgramInjection??W);const H=C._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return l(f,F(v,"vertex",V,H,h,C._contextWasLost),F(Z,"fragment",V,H,h,C._contextWasLost),h,J,C.validateShaderPrograms)}function u(f,v){const Z=new V,h=e(f);return h.parallelShaderCompile&&!h.disableParallelShaderCompile&&(Z.isParallelCompiled=!0),Z.context=h._context,Z}function W(f,v,Z,V){let h=arguments.length>5?arguments[5]:void 0;const J=V.createProgram();if(f.program=J,!J)throw new Error("Unable to create program");return V.attachShader(J,v),V.attachShader(J,Z),V.linkProgram(J),f.context=V,f.vertexShader=v,f.fragmentShader=Z,f.isParallelCompiled||b(f,V,h),J}function a(f,v,Z){const V=f;if(V._isDisposed)return!1;const h=e(v);return!!(h&&h.parallelShaderCompile&&h.parallelShaderCompile.COMPLETION_STATUS_KHR&&V.program&&v.getProgramParameter(V.program,h.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(b(V,v,Z),!0)}function b(f,v,Z){const V=f.context,h=f.vertexShader,J=f.fragmentShader,l=f.program;if(!V.getProgramParameter(l,V.LINK_STATUS)){if(!v.getShaderParameter(h,v.COMPILE_STATUS)){const Z=v.getShaderInfoLog(h);if(Z)throw f.vertexCompilationError=Z,new Error("VERTEX SHADER "+Z)}if(!v.getShaderParameter(J,v.COMPILE_STATUS)){const Z=v.getShaderInfoLog(J);if(Z)throw f.fragmentCompilationError=Z,new Error("FRAGMENT SHADER "+Z)}const Z=V.getProgramInfoLog(l);if(Z)throw f.programLinkError=Z,new Error(Z)}if(Z){V.validateProgram(l);if(!V.getProgramParameter(l,V.VALIDATE_STATUS)){const v=V.getProgramInfoLog(l);if(v)throw f.programValidationError=v,new Error(v)}}V.deleteShader(h),V.deleteShader(J),f.vertexShader=void 0,f.fragmentShader=void 0,f.onCompiled&&(f.onCompiled(),f.onCompiled=void 0)}function X(f,v,Z,V,h,J,l,C,u){let W=arguments.length>10?arguments[10]:void 0,a=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0;const X=e(f.context);a||(a=X.createRawShaderProgramInjection??H),b||(b=X.createShaderProgramInjection??O);const F=f;F.program=V?a(F,v,Z,F.context,u):b(F,v,Z,C,F.context,u),F.program.__SPECTOR_rebuildProgram=l,W()}function F(f,v,Z,V,J,l){return U((0,h.i)(f,Z,V),v,J,l)}function U(f,v,Z,V){const h=Z.createShader("vertex"===v?Z.VERTEX_SHADER:Z.FRAGMENT_SHADER);if(!h){let f=Z.NO_ERROR,h=Z.NO_ERROR;for(;(h=Z.getError())!==Z.NO_ERROR;)f=h;throw new Error(`Something went wrong while creating a gl ${v} shader object. gl error=${f}, gl isContextLost=${Z.isContextLost()}, _contextWasLost=${V}`)}return Z.shaderSource(h,f),Z.compileShader(h),h}function K(f,v){v.useProgram(f)}function M(f,v){const Z=f;if(!Z.isParallelCompiled)return void v(f);const V=Z.onCompiled;Z.onCompiled=()=>{null===V||void 0===V||V(),v(f)}}},11337:(f,v,Z)=>{Z.d(v,{c:()=>u,f:()=>a,h:()=>H,l:()=>O});var V=Z(11239),h=Z(11346),J=Z(11333),l=Z(11247),e=Z(11306),C=Z(11314);function H(f,v){return(0,h.z)(v).cachedPipelines[f]}function O(f){const v=f._name,Z=f.context;if(v&&Z){const f=(0,h.z)(Z),V=f.cachedPipelines[v];null===V||void 0===V||V.dispose(),delete f.cachedPipelines[v]}}function u(f,v,Z,h,J,l,C){let H,O;const u=(0,V.m)()?null===l||void 0===l?void 0:l.getHostDocument():null;H="string"===typeof v?v:v.vertexSource?"source:"+v.vertexSource:v.vertexElement?(null===u||void 0===u?void 0:u.getElementById(v.vertexElement))||v.vertexElement:v.vertex||v,O="string"===typeof v?v:v.fragmentSource?"source:"+v.fragmentSource:v.fragmentElement?(null===u||void 0===u?void 0:u.getElementById(v.fragmentElement))||v.fragmentElement:v.fragment||v;const a=[void 0,void 0],b=()=>{if(a[0]&&a[1]){f.isFragment=!0;const[V,H]=a;(0,e.k)(H,f,((l,H)=>{C&&(C._fragmentSourceCodeBeforeMigration=H),Z&&(l=Z("fragment",l));const O=(0,e.b)(V,l,f);f=null;const u=function(f,v,Z,V){if(Z){return{vertexSourceCode:(1===V?"//":"")+"#define SHADER_NAME vertex:"+(Z.vertexElement||Z.vertex||Z.spectorName||Z)+"\n"+f,fragmentSourceCode:(1===V?"//":"")+"#define SHADER_NAME fragment:"+(Z.fragmentElement||Z.fragment||Z.spectorName||Z)+"\n"+v}}return{vertexSourceCode:f,fragmentSourceCode:v}}(O.vertexCode,O.fragmentCode,v,J);null===h||void 0===h||h(u.vertexSourceCode,u.fragmentSourceCode)}),l)}};W(H,"Vertex","",(v=>{(0,e.f)(f),(0,e.k)(v,f,((f,V)=>{C&&(C._rawVertexSourceCode=v,C._vertexSourceCodeBeforeMigration=V),Z&&(f=Z("vertex",f)),a[0]=f,b()}),l)}),J),W(O,"Fragment","Pixel",(f=>{C&&(C._rawFragmentSourceCode=f),a[1]=f,b()}),J)}function W(f,v,Z,h,l,e){if("undefined"!==typeof HTMLElement&&f instanceof HTMLElement){return void h((0,V.d)(f))}if("source:"===f.substring(0,7))return void h(f.substring(7));if("base64:"===f.substring(0,7)){return void h(window.atob(f.substring(7)))}const H=J.c.GetShadersStore(l);if(H[f+v+"Shader"])return void h(H[f+v+"Shader"]);if(Z&&H[f+Z+"Shader"])return void h(H[f+Z+"Shader"]);let O;if(O="."===f[0]||"/"===f[0]||f.indexOf("http")>-1?f:J.c.GetShadersRepository(l)+f,!(e=e||C.o))throw new Error("loadFileInjection is not defined");e(O+"."+v.toLowerCase()+".fx",h)}const a=(f,v,Z,V)=>{try{const J=f.context?(0,h.z)(f.context):null;J&&(J.disableParallelShaderCompile=f.disableParallelCompilation);const l=f.existingPipelineContext||v(f.shaderProcessingContext);return l._name=f.name,f.name&&J&&(J.cachedPipelines[f.name]=l),Z(l,f.vertex,f.fragment,!!f.createAsRaw,"","",f.rebuildRebind,f.defines,f.transformFeedbackVaryings,"",(()=>{V(l,(()=>{var v;null===(v=f.onRenderingStateCompiled)||void 0===v||v.call(f,l)}))})),l}catch(J){throw l.e.Error("Error compiling effect"),J}}},11325:(f,v,Z)=>{Z.r(v),Z.d(v,{Effect:()=>C});var V=Z(11235),h=Z(11247),J=Z(11333),l=Z(11337),e=Z(11316);class C{static get ShadersRepository(){return J.c.ShadersRepository}static set ShadersRepository(f){J.c.ShadersRepository=f}get C(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new V.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,W=arguments.length>9?arguments[9]:void 0,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,X=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new V.c,this.onErrorObservable=new V.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=f,this._key=a;const F=this._key.replace(/\r/g,"").replace(/\n/g,"|");let U;if(v.attributes){const f=v;if(this._engine=Z,this._attributesNames=f.attributes,this._uniformsNames=f.uniformsNames.concat(f.samplers),this._samplerList=f.samplers.slice(),this.defines=f.defines,this.onError=f.onError,this.onCompiled=f.onCompiled,this._fallbacks=f.fallbacks,this._indexParameters=f.indexParameters,this._transformFeedbackVaryings=f.transformFeedbackVaryings||null,this._multiTarget=!!f.multiTarget,this._shaderLanguage=f.shaderLanguage??0,this._disableParallelShaderCompilation=!!f.disableParallelShaderCompilation,f.uniformBuffersNames){this._uniformBuffersNamesList=f.uniformBuffersNames.slice();for(let v=0;v<f.uniformBuffersNames.length;v++)this._uniformBuffersNames[f.uniformBuffersNames[v]]=v}this._processFinalCode=f.processFinalCode??null,this._processCodeAfterIncludes=f.processCodeAfterIncludes??void 0,X=f.extraInitializationsAsync,U=f.existingPipelineContext}else this._engine=J,this.defines=null==e?"":e,this._uniformsNames=Z.concat(h),this._samplerList=h?h.slice():[],this._attributesNames=v,this._uniformBuffersNamesList=[],this._shaderLanguage=b,this.onError=u,this.onCompiled=O,this._indexParameters=W,this._fallbacks=H;"WEBGL2"===this._engine.shaderPlatformName&&(U=(0,l.h)(F,this._engine._gl)??U),this._attributeLocationByName={},this.uniqueId=C._UniqueIdSeed++,U?(this._pipelineContext=U,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,X),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.C||this.dispose(!0)}))}async _processShaderCodeAsync(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3?arguments[3]:void 0;V&&await V(),this._processingContext=Z||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const h={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:f??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:J.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:J.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,l.c)(h,this.name,this._processFinalCode,((f,Z)=>{this._vertexSourceCode=f,this._fragmentSourceCode=Z,this._prepareEffect(v)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.C||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(f){return this._attributes[f]}getAttributeLocationByName(f){return this._attributeLocationByName[f]}getAttributesCount(){return this._attributes.length}getUniformIndex(f){return this._uniformsNames.indexOf(f)}getUniform(f){return this._uniforms[f]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((f=>{this.executeWhenCompiled(f)}))}executeWhenCompiled(f){this.isReady()?f(this):(this.onCompileObservable.add((v=>{f(v)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(f){(0,e.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(v=>{this._processCompilationErrors(v,f)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var f;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(f=this._pipelineContext)||void 0===f?void 0:f._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var f;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(f=this._pipelineContext)||void 0===f?void 0:f._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(f,v,Z,V){this._isReady=!1,this._vertexSourceCodeOverride=f,this._fragmentSourceCodeOverride=v,this.onError=(f,v)=>{V&&V(v)},this.onCompiled=()=>{var f,v;const V=this.getEngine().scenes;if(V)for(let Z=0;Z<V.length;Z++)V[Z].markAllMaterialsAsDirty(127);null===(f=(v=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===f||f.call(v,Z)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(f){if(this._pipelineContext=f,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let v=0;v<this._attributesNames.length;v++){const f=this._attributesNames[v];this._attributeLocationByName[f]=this._attributes[v]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),C.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this._pipelineContext;this._isReady=!1;try{const Z=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),V=Z?null:this.defines,h=Z?this._vertexSourceCodeOverride:this._vertexSourceCode,J=Z?this._fragmentSourceCodeOverride:this._fragmentSourceCode,e=this._engine;this._pipelineContext=(0,l.f)({existingPipelineContext:f?v:null,vertex:h,fragment:J,context:"WEBGL2"===e.shaderPlatformName||"WEBGL1"===e.shaderPlatformName?e._gl:void 0,rebuildRebind:(f,v,Z,V)=>this._rebuildProgram(f,v,Z,V),defines:V,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:Z,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:Z=>{v&&!f&&this._engine._deletePipelineContext(v),Z&&this._onRenderingStateCompiled(Z)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(v)}catch(Z){this._processCompilationErrors(Z,v)}}_getShaderCodeAndErrorLine(f,v,Z){const V=Z?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let h=null;if(v&&f){const J=v.match(V);if(J&&2===J.length){const v=parseInt(J[1]),V=f.split("\n",-1);V.length>=v&&(h=`Offending line [${v}] in ${Z?"fragment":"vertex"} code: ${V[v-1]}`)}}return[f,h]}_processCompilationErrors(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=f.message;const Z=this._attributesNames,V=this._fallbacks;if(h.e.Error("Unable to compile effect:"),h.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),h.e.Error(`Attributes: ${Z.join(" ")}`),h.e.Error("Defines:\n"+this.defines),C.LogShaderCodeOnCompilationError){var J,l;let f=null,v=null,Z=null;var e;if(null!==(J=this._pipelineContext)&&void 0!==J&&J._getVertexShaderCode()&&([Z,f]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),Z&&(h.e.Error("Vertex code:"),h.e.Error(Z))),null!==(l=this._pipelineContext)&&void 0!==l&&l._getFragmentShaderCode())[Z,v]=this._getShaderCodeAndErrorLine(null===(e=this._pipelineContext)||void 0===e?void 0:e._getFragmentShaderCode(),this._compilationError,!0),Z&&(h.e.Error("Fragment code:"),h.e.Error(Z));f&&h.e.Error(f),v&&h.e.Error(v)}h.e.Error("Error: "+this._compilationError);const H=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};v&&(this._pipelineContext=v,this._isReady=!0,H()),V?(this._pipelineContext=null,V.hasMoreFallbacks?(this._allFallbacksProcessed=!1,h.e.Error("Trying next fallback."),this.defines=V.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,H(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,v||H())}get isSupported(){return""===this._compilationError}_bindTexture(f,v){this._engine._bindTexture(this._samplers[f],v,f)}setTexture(f,v){this._engine.setTexture(this._samplers[f],this._uniforms[f],v,f)}setTextureArray(f,v){const Z=f+"Ex";if(-1===this._samplerList.indexOf(Z+"0")){const V=this._samplerList.indexOf(f);for(let f=1;f<v.length;f++){const v=Z+(f-1).toString();this._samplerList.splice(V+f,0,v)}let h=0;for(const f of this._samplerList)this._samplers[f]=h,h+=1}this._engine.setTextureArray(this._samplers[f],this._uniforms[f],v,f)}bindUniformBuffer(f,v){const Z=this._uniformBuffersNames[v];void 0===Z||C._BaseCache[Z]===f&&this._engine._features.useUBOBindingCache||(C._BaseCache[Z]=f,this._engine.bindUniformBufferBase(f,Z,v))}bindUniformBlock(f,v){this._engine.bindUniformBlock(this._pipelineContext,f,v)}setInt(f,v){return this._pipelineContext.setInt(f,v),this}setInt2(f,v,Z){return this._pipelineContext.setInt2(f,v,Z),this}setInt3(f,v,Z,V){return this._pipelineContext.setInt3(f,v,Z,V),this}setInt4(f,v,Z,V,h){return this._pipelineContext.setInt4(f,v,Z,V,h),this}setIntArray(f,v){return this._pipelineContext.setIntArray(f,v),this}setIntArray2(f,v){return this._pipelineContext.setIntArray2(f,v),this}setIntArray3(f,v){return this._pipelineContext.setIntArray3(f,v),this}setIntArray4(f,v){return this._pipelineContext.setIntArray4(f,v),this}setUInt(f,v){return this._pipelineContext.setUInt(f,v),this}setUInt2(f,v,Z){return this._pipelineContext.setUInt2(f,v,Z),this}setUInt3(f,v,Z,V){return this._pipelineContext.setUInt3(f,v,Z,V),this}setUInt4(f,v,Z,V,h){return this._pipelineContext.setUInt4(f,v,Z,V,h),this}setUIntArray(f,v){return this._pipelineContext.setUIntArray(f,v),this}setUIntArray2(f,v){return this._pipelineContext.setUIntArray2(f,v),this}setUIntArray3(f,v){return this._pipelineContext.setUIntArray3(f,v),this}setUIntArray4(f,v){return this._pipelineContext.setUIntArray4(f,v),this}setFloatArray(f,v){return this._pipelineContext.setArray(f,v),this}setFloatArray2(f,v){return this._pipelineContext.setArray2(f,v),this}setFloatArray3(f,v){return this._pipelineContext.setArray3(f,v),this}setFloatArray4(f,v){return this._pipelineContext.setArray4(f,v),this}setArray(f,v){return this._pipelineContext.setArray(f,v),this}setArray2(f,v){return this._pipelineContext.setArray2(f,v),this}setArray3(f,v){return this._pipelineContext.setArray3(f,v),this}setArray4(f,v){return this._pipelineContext.setArray4(f,v),this}setMatrices(f,v){return this._pipelineContext.setMatrices(f,v),this}setMatrix(f,v){return this._pipelineContext.setMatrix(f,v),this}setMatrix3x3(f,v){return this._pipelineContext.setMatrix3x3(f,v),this}setMatrix2x2(f,v){return this._pipelineContext.setMatrix2x2(f,v),this}setFloat(f,v){return this._pipelineContext.setFloat(f,v),this}setBool(f,v){return this._pipelineContext.setInt(f,v?1:0),this}setVector2(f,v){return this._pipelineContext.setVector2(f,v),this}setFloat2(f,v,Z){return this._pipelineContext.setFloat2(f,v,Z),this}setVector3(f,v){return this._pipelineContext.setVector3(f,v),this}setFloat3(f,v,Z,V){return this._pipelineContext.setFloat3(f,v,Z,V),this}setVector4(f,v){return this._pipelineContext.setVector4(f,v),this}setQuaternion(f,v){return this._pipelineContext.setQuaternion(f,v),this}setFloat4(f,v,Z,V,h){return this._pipelineContext.setFloat4(f,v,Z,V,h),this}setColor3(f,v){return this._pipelineContext.setColor3(f,v),this}setColor4(f,v,Z){return this._pipelineContext.setColor4(f,v,Z),this}setDirectColor4(f,v){return this._pipelineContext.setDirectColor4(f,v),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(C.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,l.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;v&&(J.c.GetShadersStore(V)[`${f}PixelShader`]=v),Z&&(J.c.GetShadersStore(V)[`${f}VertexShader`]=Z)}static ResetCache(){C._BaseCache={}}}C.LogShaderCodeOnCompilationError=!0,C.PersistentMode=!1,C.AutomaticallyClearCodeCache=!1,C._UniqueIdSeed=0,C._BaseCache={},C.ShadersStore=J.c.ShadersStore,C.IncludesShadersStore=J.c.IncludesShadersStore},11263:(f,v,Z)=>{Z.d(v,{e:()=>h});const V={};function h(f){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!V[f])return V[f]=!0,`${f} needs to be imported before as it contains a side-effect required by your code.`}},11239:(f,v,Z)=>{function V(){return"undefined"!==typeof window}function h(){return"undefined"!==typeof navigator}function J(){return"undefined"!==typeof document}function l(f){let v="",Z=f.firstChild;for(;Z;)3===Z.nodeType&&(v+=Z.textContent),Z=Z.nextSibling;return v}Z.d(v,{d:()=>l,h:()=>J,l:()=>h,m:()=>V})},11247:(f,v,Z)=>{Z.d(v,{e:()=>V});class V{static _CheckLimit(f,v){let Z=V._LogLimitOutputs[f];return Z?Z.current++:(Z={limit:v,current:1},V._LogLimitOutputs[f]=Z),Z.current<=Z.limit}static _GenerateLimitMessage(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const Z=V._LogLimitOutputs[f];if(!Z||!V.MessageLimitReached)return;const h=this._Levels[v];Z.current===Z.limit&&V[h.name](V.MessageLimitReached.replace(/%LIMIT%/g,""+Z.limit).replace(/%TYPE%/g,h.name??""))}static _AddLogEntry(f){V._LogCache=f+V._LogCache,V.OnNewCacheEntry&&V.OnNewCacheEntry(f)}static _FormatMessage(f){const v=f=>f<10?"0"+f:""+f,Z=new Date;return"["+v(Z.getHours())+":"+v(Z.getMinutes())+":"+v(Z.getSeconds())+"]: "+f}static _LogDisabled(f,v){}static _LogEnabled(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;const h=Array.isArray(v)?v[0]:v;if(void 0!==Z&&!V._CheckLimit(h,Z))return;const J=V._FormatMessage(h),l=this._Levels[f],e=Array.isArray(v)?v.slice(1):[];l.logFunc&&l.logFunc("BJS - "+J,...e);const C=`<div style='color:${l.color}'>${J}</div><br>`;V._AddLogEntry(C),V._GenerateLimitMessage(h,f)}static get LogCache(){return V._LogCache}static ClearLogCache(){V._LogCache="",V._LogLimitOutputs={},V.errorsCount=0}static set LogLevels(f){V.Log=V._LogDisabled,V.Warn=V._LogDisabled,V.Error=V._LogDisabled;const v=[V.MessageLogLevel,V.WarningLogLevel,V.ErrorLogLevel];for(const Z of v)if((f&Z)===Z){const f=this._Levels[Z];V[f.name]=V._LogEnabled.bind(V,Z)}}}V.NoneLogLevel=0,V.MessageLogLevel=1,V.WarningLogLevel=2,V.ErrorLogLevel=4,V.AllLogLevel=7,V.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",V._LogCache="",V._LogLimitOutputs={},V._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],V.errorsCount=0,V.Log=V._LogEnabled.bind(V,V.MessageLogLevel),V.Warn=V._LogEnabled.bind(V,V.WarningLogLevel),V.Error=V._LogEnabled.bind(V,V.ErrorLogLevel)},11235:(f,v,Z)=>{Z.d(v,{c:()=>l});const V="undefined"!==typeof WeakRef;class h{constructor(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,V=arguments.length>3?arguments[3]:void 0;this.initialize(f,v,Z,V)}initialize(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,V=arguments.length>3?arguments[3]:void 0;return this.mask=f,this.skipNextObservers=v,this.target=Z,this.currentTarget=V,this}}class J{constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=f,this.mask=v,this.scope=Z,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(f)}}class l{static FromPromise(f,v){const Z=new l;return f.then((f=>{Z.notifyObservers(f)})).catch((f=>{if(!v)throw f;v.notifyObservers(f)})),Z}get observers(){return this._observers}constructor(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=v,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new h(0),f&&(this._onObserverAdded=f)}add(f){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!f)return null;const h=new J(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);h.unregisterOnNextCall=Z,v?this._observers.unshift(h):this._observers.push(h),this._onObserverAdded&&this._onObserverAdded(h),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(h,this._lastNotifiedValue);const l=V?new WeakRef(this):{deref:()=>this};return h._remove=function(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=l.deref();v&&(f?v.remove(h):v._remove(h))},h}addOnce(f){return this.add(f,void 0,void 0,void 0,!0)}remove(f){if(!f)return!1;f._remove=null;return-1!==this._observers.indexOf(f)&&(this._deferUnregister(f),!0)}removeCallback(f,v){for(let Z=0;Z<this._observers.length;Z++){const V=this._observers[Z];if(!V._willBeUnregistered&&(V.callback===f&&(!v||v===V.scope)))return this._deferUnregister(V),!0}return!1}_deferUnregister(f){f._willBeUnregistered||(this._numObserversMarkedAsDeleted++,f.unregisterOnNextCall=!1,f._willBeUnregistered=!0,setTimeout((()=>{this._remove(f)}),0))}_remove(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!f)return!1;const Z=this._observers.indexOf(f);return-1!==Z&&(v&&this._numObserversMarkedAsDeleted--,this._observers.splice(Z,1),!0)}makeObserverTopPriority(f){this._remove(f,!1),this._observers.unshift(f)}makeObserverBottomPriority(f){this._remove(f,!1),this._observers.push(f)}notifyObservers(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,Z=arguments.length>2?arguments[2]:void 0,V=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=f),!this._observers.length)return!0;const J=this._eventState;J.mask=v,J.target=Z,J.currentTarget=V,J.skipNextObservers=!1,J.lastReturnValue=f,J.userInfo=h;for(const l of this._observers)if(!l._willBeUnregistered&&(l.mask&v&&(l.unregisterOnNextCall&&this._deferUnregister(l),l.scope?J.lastReturnValue=l.callback.apply(l.scope,[f,J]):J.lastReturnValue=l.callback(f,J)),J.skipNextObservers))return!1;return!0}notifyObserver(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=v),f._willBeUnregistered)return;const V=this._eventState;V.mask=Z,V.skipNextObservers=!1,f.unregisterOnNextCall&&this._deferUnregister(f),f.callback(v,V)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const f=this._observers.pop();f&&(f._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const f=new l;return f._observers=this._observers.slice(0),f}hasSpecificMask(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const v of this._observers)if(v.mask&f||v.mask===f)return!0;return!1}}},11316:(f,v,Z)=>{Z.d(v,{d:()=>h,f:()=>l});let V=[];class h{static SetImmediate(f){0===V.length&&setTimeout((()=>{const f=V;V=[];for(const v of f)v()}),1),V.push(f)}}function J(f,v,Z){try{if(f())return v(),!0}catch(V){return null===Z||void 0===Z||Z(V),!0}return!1}const l=function(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,l=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&J(f,v,Z))return null;const e=setInterval((()=>{J(f,v,Z)?clearInterval(e):(h-=V,h<0&&(clearInterval(e),null===Z||void 0===Z||Z(new Error("Operation timed out after maximum retries. "+(l||"")),!0)))}),V);return()=>clearInterval(e)}}}]);